# Comparing `tmp/mlrun-1.4.0rc2-py3-none-any.whl.zip` & `tmp/mlrun-1.4.0rc3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,396 +1,404 @@
-Zip file size: 1162636 bytes, number of entries: 394
--rw-r--r--  2.0 unx     8727 b- defN 23-Apr-27 10:32 mlrun/__init__.py
--rw-r--r--  2.0 unx    49967 b- defN 23-Apr-27 10:32 mlrun/__main__.py
--rw-r--r--  2.0 unx    24965 b- defN 23-Apr-27 10:32 mlrun/builder.py
--rw-r--r--  2.0 unx    50570 b- defN 23-Apr-27 10:32 mlrun/config.py
--rw-r--r--  2.0 unx     6780 b- defN 23-Apr-27 10:32 mlrun/errors.py
--rw-r--r--  2.0 unx    39096 b- defN 23-Apr-27 10:32 mlrun/execution.py
--rw-r--r--  2.0 unx    15624 b- defN 23-Apr-27 10:32 mlrun/features.py
--rw-r--r--  2.0 unx    31688 b- defN 23-Apr-27 10:32 mlrun/k8s_utils.py
--rw-r--r--  2.0 unx    29645 b- defN 23-Apr-27 10:32 mlrun/kfpops.py
--rw-r--r--  2.0 unx     8360 b- defN 23-Apr-27 10:32 mlrun/lists.py
--rw-r--r--  2.0 unx    53402 b- defN 23-Apr-27 10:32 mlrun/model.py
--rw-r--r--  2.0 unx    11828 b- defN 23-Apr-27 10:32 mlrun/render.py
--rw-r--r--  2.0 unx    64451 b- defN 23-Apr-27 10:32 mlrun/run.py
--rw-r--r--  2.0 unx     7731 b- defN 23-Apr-27 10:32 mlrun/secrets.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/__init__.py
--rw-r--r--  2.0 unx     2105 b- defN 23-Apr-27 10:32 mlrun/api/alembic.ini
--rw-r--r--  2.0 unx      685 b- defN 23-Apr-27 10:32 mlrun/api/constants.py
--rw-r--r--  2.0 unx    23530 b- defN 23-Apr-27 10:32 mlrun/api/initial_data.py
--rw-r--r--  2.0 unx    26180 b- defN 23-Apr-27 10:32 mlrun/api/main.py
--rw-r--r--  2.0 unx     5235 b- defN 23-Apr-27 10:32 mlrun/api/middlewares.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/api/__init__.py
--rw-r--r--  2.0 unx     4267 b- defN 23-Apr-27 10:32 mlrun/api/api/api.py
--rw-r--r--  2.0 unx     3143 b- defN 23-Apr-27 10:32 mlrun/api/api/deps.py
--rw-r--r--  2.0 unx    36224 b- defN 23-Apr-27 10:32 mlrun/api/api/utils.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/__init__.py
--rw-r--r--  2.0 unx     9458 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/artifacts.py
--rw-r--r--  2.0 unx     1190 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/auth.py
--rw-r--r--  2.0 unx     3588 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/background_tasks.py
--rw-r--r--  2.0 unx     1202 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/client_spec.py
--rw-r--r--  2.0 unx     1160 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/clusterization_spec.py
--rw-r--r--  2.0 unx    28813 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/feature_store.py
--rw-r--r--  2.0 unx     6065 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/files.py
--rw-r--r--  2.0 unx     5690 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/frontend_spec.py
--rw-r--r--  2.0 unx    33894 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/functions.py
--rw-r--r--  2.0 unx     5798 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/grafana_proxy.py
--rw-r--r--  2.0 unx     1335 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/healthz.py
--rw-r--r--  2.0 unx     2429 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/logs.py
--rw-r--r--  2.0 unx    10035 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/marketplace.py
--rw-r--r--  2.0 unx    15724 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/model_endpoints.py
--rw-r--r--  2.0 unx     3700 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/operations.py
--rw-r--r--  2.0 unx     9099 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/pipelines.py
--rw-r--r--  2.0 unx    11392 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/projects.py
--rw-r--r--  2.0 unx     9076 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/runs.py
--rw-r--r--  2.0 unx     8988 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/runtime_resources.py
--rw-r--r--  2.0 unx    10579 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/schedules.py
--rw-r--r--  2.0 unx     6057 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/secrets.py
--rw-r--r--  2.0 unx     5265 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/submit.py
--rw-r--r--  2.0 unx     4843 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/tags.py
--rw-r--r--  2.0 unx     1203 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/internal/__init__.py
--rw-r--r--  2.0 unx     1043 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/internal/config.py
--rw-r--r--  2.0 unx     1709 b- defN 23-Apr-27 10:32 mlrun/api/api/endpoints/internal/memory_reports.py
--rw-r--r--  2.0 unx     1225 b- defN 23-Apr-27 10:32 mlrun/api/crud/__init__.py
--rw-r--r--  2.0 unx     5433 b- defN 23-Apr-27 10:32 mlrun/api/crud/artifacts.py
--rw-r--r--  2.0 unx     7341 b- defN 23-Apr-27 10:32 mlrun/api/crud/client_spec.py
--rw-r--r--  2.0 unx     1049 b- defN 23-Apr-27 10:32 mlrun/api/crud/clusterization_spec.py
--rw-r--r--  2.0 unx    18449 b- defN 23-Apr-27 10:32 mlrun/api/crud/feature_store.py
--rw-r--r--  2.0 unx     3550 b- defN 23-Apr-27 10:32 mlrun/api/crud/functions.py
--rw-r--r--  2.0 unx     9578 b- defN 23-Apr-27 10:32 mlrun/api/crud/logs.py
--rw-r--r--  2.0 unx    11769 b- defN 23-Apr-27 10:32 mlrun/api/crud/marketplace.py
--rw-r--r--  2.0 unx     2751 b- defN 23-Apr-27 10:32 mlrun/api/crud/notifications.py
--rw-r--r--  2.0 unx    13982 b- defN 23-Apr-27 10:32 mlrun/api/crud/pipelines.py
--rw-r--r--  2.0 unx    13326 b- defN 23-Apr-27 10:32 mlrun/api/crud/projects.py
--rw-r--r--  2.0 unx     6005 b- defN 23-Apr-27 10:32 mlrun/api/crud/runs.py
--rw-r--r--  2.0 unx     5539 b- defN 23-Apr-27 10:32 mlrun/api/crud/runtime_resources.py
--rw-r--r--  2.0 unx    19921 b- defN 23-Apr-27 10:32 mlrun/api/crud/secrets.py
--rw-r--r--  2.0 unx     3265 b- defN 23-Apr-27 10:32 mlrun/api/crud/tags.py
--rw-r--r--  2.0 unx      722 b- defN 23-Apr-27 10:32 mlrun/api/crud/model_monitoring/__init__.py
--rw-r--r--  2.0 unx    14943 b- defN 23-Apr-27 10:32 mlrun/api/crud/model_monitoring/grafana.py
--rw-r--r--  2.0 unx    40998 b- defN 23-Apr-27 10:32 mlrun/api/crud/model_monitoring/model_endpoints.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/db/__init__.py
--rw-r--r--  2.0 unx    14365 b- defN 23-Apr-27 10:32 mlrun/api/db/base.py
--rw-r--r--  2.0 unx      870 b- defN 23-Apr-27 10:32 mlrun/api/db/init_db.py
--rw-r--r--  2.0 unx      993 b- defN 23-Apr-27 10:32 mlrun/api/db/session.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/__init__.py
--rw-r--r--  2.0 unx   142645 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/db.py
--rw-r--r--  2.0 unx     2340 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/helpers.py
--rw-r--r--  2.0 unx     2542 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/session.py
--rw-r--r--  2.0 unx     1063 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/models/__init__.py
--rw-r--r--  2.0 unx    20624 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/models/models_mysql.py
--rw-r--r--  2.0 unx    18286 b- defN 23-Apr-27 10:32 mlrun/api/db/sqldb/models/models_sqlite.py
--rw-r--r--  2.0 unx     2906 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/env.py
--rw-r--r--  2.0 unx     4614 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
--rw-r--r--  2.0 unx     1936 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
--rw-r--r--  2.0 unx     1909 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
--rw-r--r--  2.0 unx     1415 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py
--rw-r--r--  2.0 unx     1504 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py
--rw-r--r--  2.0 unx     1649 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py
--rw-r--r--  2.0 unx    24057 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py
--rw-r--r--  2.0 unx     2457 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py
--rw-r--r--  2.0 unx     1351 b- defN 23-Apr-27 10:32 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py
--rw-r--r--  2.0 unx     2906 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/env.py
--rw-r--r--  2.0 unx    11473 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py
--rw-r--r--  2.0 unx     1348 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
--rw-r--r--  2.0 unx     5180 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
--rw-r--r--  2.0 unx     1388 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
--rw-r--r--  2.0 unx     1767 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
--rw-r--r--  2.0 unx     1360 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
--rw-r--r--  2.0 unx     1259 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py
--rw-r--r--  2.0 unx     2147 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py
--rw-r--r--  2.0 unx     1482 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py
--rw-r--r--  2.0 unx     1892 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py
--rw-r--r--  2.0 unx     1882 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py
--rw-r--r--  2.0 unx     1420 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py
--rw-r--r--  2.0 unx     2034 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py
--rw-r--r--  2.0 unx     1828 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py
--rw-r--r--  2.0 unx     1380 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py
--rw-r--r--  2.0 unx     1831 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py
--rw-r--r--  2.0 unx     3936 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
--rw-r--r--  2.0 unx     2588 b- defN 23-Apr-27 10:32 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
--rw-r--r--  2.0 unx     4029 b- defN 23-Apr-27 10:32 mlrun/api/schemas/__init__.py
--rw-r--r--  2.0 unx     2070 b- defN 23-Apr-27 10:32 mlrun/api/schemas/artifact.py
--rw-r--r--  2.0 unx     5311 b- defN 23-Apr-27 10:32 mlrun/api/schemas/auth.py
--rw-r--r--  2.0 unx     1563 b- defN 23-Apr-27 10:32 mlrun/api/schemas/background_task.py
--rw-r--r--  2.0 unx     2751 b- defN 23-Apr-27 10:32 mlrun/api/schemas/client_spec.py
--rw-r--r--  2.0 unx      898 b- defN 23-Apr-27 10:32 mlrun/api/schemas/clusterization_spec.py
--rw-r--r--  2.0 unx     6278 b- defN 23-Apr-27 10:32 mlrun/api/schemas/constants.py
--rw-r--r--  2.0 unx     3671 b- defN 23-Apr-27 10:32 mlrun/api/schemas/feature_store.py
--rw-r--r--  2.0 unx     2571 b- defN 23-Apr-27 10:32 mlrun/api/schemas/frontend_spec.py
--rw-r--r--  2.0 unx     3991 b- defN 23-Apr-27 10:32 mlrun/api/schemas/function.py
--rw-r--r--  2.0 unx      715 b- defN 23-Apr-27 10:32 mlrun/api/schemas/http.py
--rw-r--r--  2.0 unx     1405 b- defN 23-Apr-27 10:32 mlrun/api/schemas/k8s.py
--rw-r--r--  2.0 unx     4592 b- defN 23-Apr-27 10:32 mlrun/api/schemas/marketplace.py
--rw-r--r--  2.0 unx      920 b- defN 23-Apr-27 10:32 mlrun/api/schemas/memory_reports.py
--rw-r--r--  2.0 unx    12343 b- defN 23-Apr-27 10:32 mlrun/api/schemas/model_endpoints.py
--rw-r--r--  2.0 unx      894 b- defN 23-Apr-27 10:32 mlrun/api/schemas/notification.py
--rw-r--r--  2.0 unx     1965 b- defN 23-Apr-27 10:32 mlrun/api/schemas/object.py
--rw-r--r--  2.0 unx     1194 b- defN 23-Apr-27 10:32 mlrun/api/schemas/pipeline.py
--rw-r--r--  2.0 unx     3935 b- defN 23-Apr-27 10:32 mlrun/api/schemas/project.py
--rw-r--r--  2.0 unx     1646 b- defN 23-Apr-27 10:32 mlrun/api/schemas/runtime_resource.py
--rw-r--r--  2.0 unx     4192 b- defN 23-Apr-27 10:32 mlrun/api/schemas/schedule.py
--rw-r--r--  2.0 unx     1494 b- defN 23-Apr-27 10:32 mlrun/api/schemas/secret.py
--rw-r--r--  2.0 unx      919 b- defN 23-Apr-27 10:32 mlrun/api/schemas/tag.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/__init__.py
--rw-r--r--  2.0 unx     1092 b- defN 23-Apr-27 10:32 mlrun/api/utils/asyncio.py
--rw-r--r--  2.0 unx     7302 b- defN 23-Apr-27 10:32 mlrun/api/utils/background_tasks.py
--rw-r--r--  2.0 unx     2413 b- defN 23-Apr-27 10:32 mlrun/api/utils/helpers.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Apr-27 10:32 mlrun/api/utils/memory_reports.py
--rw-r--r--  2.0 unx     2599 b- defN 23-Apr-27 10:32 mlrun/api/utils/periodic.py
--rw-r--r--  2.0 unx    38822 b- defN 23-Apr-27 10:32 mlrun/api/utils/scheduler.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/auth/__init__.py
--rw-r--r--  2.0 unx    12249 b- defN 23-Apr-27 10:32 mlrun/api/utils/auth/verifier.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/auth/providers/__init__.py
--rw-r--r--  2.0 unx     1363 b- defN 23-Apr-27 10:32 mlrun/api/utils/auth/providers/base.py
--rw-r--r--  2.0 unx     1470 b- defN 23-Apr-27 10:32 mlrun/api/utils/auth/providers/nop.py
--rw-r--r--  2.0 unx    10835 b- defN 23-Apr-27 10:32 mlrun/api/utils/auth/providers/opa.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/__init__.py
--rw-r--r--  2.0 unx    13232 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/chief.py
--rw-r--r--  2.0 unx    30488 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/iguazio.py
--rw-r--r--  2.0 unx    10775 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/log_collector.py
--rw-r--r--  2.0 unx     9841 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/nuclio.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/protocols/__init__.py
--rw-r--r--  2.0 unx     2564 b- defN 23-Apr-27 10:32 mlrun/api/utils/clients/protocols/grpc.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/db/__init__.py
--rw-r--r--  2.0 unx     3305 b- defN 23-Apr-27 10:32 mlrun/api/utils/db/alembic.py
--rw-r--r--  2.0 unx     8214 b- defN 23-Apr-27 10:32 mlrun/api/utils/db/backup.py
--rw-r--r--  2.0 unx     3795 b- defN 23-Apr-27 10:32 mlrun/api/utils/db/mysql.py
--rw-r--r--  2.0 unx      992 b- defN 23-Apr-27 10:32 mlrun/api/utils/db/sql_collation.py
--rw-r--r--  2.0 unx     3855 b- defN 23-Apr-27 10:32 mlrun/api/utils/db/sqlite_migration.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/__init__.py
--rw-r--r--  2.0 unx    17315 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/follower.py
--rw-r--r--  2.0 unx    19424 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/leader.py
--rw-r--r--  2.0 unx     7040 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/member.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/remotes/__init__.py
--rw-r--r--  2.0 unx     2614 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/remotes/follower.py
--rw-r--r--  2.0 unx     2064 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/remotes/leader.py
--rw-r--r--  2.0 unx     4601 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/remotes/nop_follower.py
--rw-r--r--  2.0 unx     3801 b- defN 23-Apr-27 10:32 mlrun/api/utils/projects/remotes/nop_leader.py
--rw-r--r--  2.0 unx      571 b- defN 23-Apr-27 10:32 mlrun/api/utils/singletons/__init__.py
--rw-r--r--  2.0 unx     1202 b- defN 23-Apr-27 10:32 mlrun/api/utils/singletons/db.py
--rw-r--r--  2.0 unx      694 b- defN 23-Apr-27 10:32 mlrun/api/utils/singletons/k8s.py
--rw-r--r--  2.0 unx      840 b- defN 23-Apr-27 10:32 mlrun/api/utils/singletons/logs_dir.py
--rw-r--r--  2.0 unx     1279 b- defN 23-Apr-27 10:32 mlrun/api/utils/singletons/project_member.py
--rw-r--r--  2.0 unx     1063 b- defN 23-Apr-27 10:32 mlrun/api/utils/singletons/scheduler.py
--rw-r--r--  2.0 unx     1091 b- defN 23-Apr-27 10:32 mlrun/artifacts/__init__.py
--rw-r--r--  2.0 unx    30849 b- defN 23-Apr-27 10:32 mlrun/artifacts/base.py
--rw-r--r--  2.0 unx    20366 b- defN 23-Apr-27 10:32 mlrun/artifacts/dataset.py
--rw-r--r--  2.0 unx    12110 b- defN 23-Apr-27 10:32 mlrun/artifacts/manager.py
--rw-r--r--  2.0 unx    23673 b- defN 23-Apr-27 10:32 mlrun/artifacts/model.py
--rw-r--r--  2.0 unx    15383 b- defN 23-Apr-27 10:32 mlrun/artifacts/plots.py
--rw-r--r--  2.0 unx     1087 b- defN 23-Apr-27 10:32 mlrun/data_types/__init__.py
--rw-r--r--  2.0 unx     4647 b- defN 23-Apr-27 10:32 mlrun/data_types/data_types.py
--rw-r--r--  2.0 unx     5813 b- defN 23-Apr-27 10:32 mlrun/data_types/infer.py
--rw-r--r--  2.0 unx     9426 b- defN 23-Apr-27 10:32 mlrun/data_types/spark.py
--rw-r--r--  2.0 unx     3300 b- defN 23-Apr-27 10:32 mlrun/datastore/__init__.py
--rw-r--r--  2.0 unx     6946 b- defN 23-Apr-27 10:32 mlrun/datastore/azure_blob.py
--rw-r--r--  2.0 unx    17575 b- defN 23-Apr-27 10:32 mlrun/datastore/base.py
--rw-r--r--  2.0 unx     7995 b- defN 23-Apr-27 10:32 mlrun/datastore/datastore.py
--rw-r--r--  2.0 unx     3791 b- defN 23-Apr-27 10:32 mlrun/datastore/filestore.py
--rw-r--r--  2.0 unx     5114 b- defN 23-Apr-27 10:32 mlrun/datastore/google_cloud_storage.py
--rw-r--r--  2.0 unx     2627 b- defN 23-Apr-27 10:32 mlrun/datastore/inmem.py
--rw-r--r--  2.0 unx     4873 b- defN 23-Apr-27 10:32 mlrun/datastore/redis.py
--rw-r--r--  2.0 unx     7035 b- defN 23-Apr-27 10:32 mlrun/datastore/s3.py
--rw-r--r--  2.0 unx    34023 b- defN 23-Apr-27 10:32 mlrun/datastore/sources.py
--rw-r--r--  2.0 unx     1402 b- defN 23-Apr-27 10:32 mlrun/datastore/spark_udf.py
--rw-r--r--  2.0 unx     6889 b- defN 23-Apr-27 10:32 mlrun/datastore/store_resources.py
--rw-r--r--  2.0 unx    62054 b- defN 23-Apr-27 10:32 mlrun/datastore/targets.py
--rw-r--r--  2.0 unx     1660 b- defN 23-Apr-27 10:32 mlrun/datastore/utils.py
--rw-r--r--  2.0 unx     8097 b- defN 23-Apr-27 10:32 mlrun/datastore/v3io.py
--rw-r--r--  2.0 unx     1343 b- defN 23-Apr-27 10:32 mlrun/datastore/wasbfs/__init__.py
--rw-r--r--  2.0 unx     6152 b- defN 23-Apr-27 10:32 mlrun/datastore/wasbfs/fs.py
--rw-r--r--  2.0 unx     2816 b- defN 23-Apr-27 10:32 mlrun/db/__init__.py
--rw-r--r--  2.0 unx    14771 b- defN 23-Apr-27 10:32 mlrun/db/base.py
--rw-r--r--  2.0 unx   129128 b- defN 23-Apr-27 10:32 mlrun/db/httpdb.py
--rw-r--r--  2.0 unx    12257 b- defN 23-Apr-27 10:32 mlrun/db/nopdb.py
--rw-r--r--  2.0 unx    25370 b- defN 23-Apr-27 10:32 mlrun/db/sqldb.py
--rw-r--r--  2.0 unx     1501 b- defN 23-Apr-27 10:32 mlrun/feature_store/__init__.py
--rw-r--r--  2.0 unx    43761 b- defN 23-Apr-27 10:32 mlrun/feature_store/api.py
--rw-r--r--  2.0 unx    12807 b- defN 23-Apr-27 10:32 mlrun/feature_store/common.py
--rw-r--r--  2.0 unx    47059 b- defN 23-Apr-27 10:32 mlrun/feature_store/feature_set.py
--rw-r--r--  2.0 unx    21937 b- defN 23-Apr-27 10:32 mlrun/feature_store/feature_vector.py
--rw-r--r--  2.0 unx    11813 b- defN 23-Apr-27 10:32 mlrun/feature_store/ingestion.py
--rw-r--r--  2.0 unx    28635 b- defN 23-Apr-27 10:32 mlrun/feature_store/steps.py
--rw-r--r--  2.0 unx     1232 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/__init__.py
--rw-r--r--  2.0 unx    25911 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/base.py
--rw-r--r--  2.0 unx     4261 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/dask_merger.py
--rw-r--r--  2.0 unx     7106 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/job.py
--rw-r--r--  2.0 unx     4765 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/local_merger.py
--rw-r--r--  2.0 unx     3352 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/online.py
--rw-r--r--  2.0 unx     9661 b- defN 23-Apr-27 10:32 mlrun/feature_store/retrieval/spark_merger.py
--rw-r--r--  2.0 unx      743 b- defN 23-Apr-27 10:32 mlrun/frameworks/__init__.py
--rw-r--r--  2.0 unx    11466 b- defN 23-Apr-27 10:32 mlrun/frameworks/parallel_coordinates.py
--rw-r--r--  2.0 unx      962 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/__init__.py
--rw-r--r--  2.0 unx     8515 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/artifacts_library.py
--rw-r--r--  2.0 unx    21018 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/mlrun_interface.py
--rw-r--r--  2.0 unx    55376 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/model_handler.py
--rw-r--r--  2.0 unx     3469 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/plan.py
--rw-r--r--  2.0 unx     5757 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/producer.py
--rw-r--r--  2.0 unx     9209 b- defN 23-Apr-27 10:32 mlrun/frameworks/_common/utils.py
--rw-r--r--  2.0 unx      750 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/__init__.py
--rw-r--r--  2.0 unx     1151 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/model_handler.py
--rw-r--r--  2.0 unx      996 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/utils.py
--rw-r--r--  2.0 unx      787 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/loggers/__init__.py
--rw-r--r--  2.0 unx    11531 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/loggers/logger.py
--rw-r--r--  2.0 unx    14777 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/loggers/mlrun_logger.py
--rw-r--r--  2.0 unx    28414 b- defN 23-Apr-27 10:32 mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py
--rw-r--r--  2.0 unx      956 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/__init__.py
--rw-r--r--  2.0 unx     3169 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/artifacts_library.py
--rw-r--r--  2.0 unx    16957 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/model_handler.py
--rw-r--r--  2.0 unx     2368 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/pkl_model_server.py
--rw-r--r--  2.0 unx     4881 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plan.py
--rw-r--r--  2.0 unx     4061 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/producer.py
--rw-r--r--  2.0 unx    10490 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/utils.py
--rw-r--r--  2.0 unx      737 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/loggers/__init__.py
--rw-r--r--  2.0 unx     5684 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/loggers/logger.py
--rw-r--r--  2.0 unx     6453 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/loggers/mlrun_logger.py
--rw-r--r--  2.0 unx      922 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plans/__init__.py
--rw-r--r--  2.0 unx     5212 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py
--rw-r--r--  2.0 unx     6078 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py
--rw-r--r--  2.0 unx     6658 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plans/dataset_plan.py
--rw-r--r--  2.0 unx     5318 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plans/feature_importance_plan.py
--rw-r--r--  2.0 unx     6993 b- defN 23-Apr-27 10:32 mlrun/frameworks/_ml_common/plans/roc_curve_plan.py
--rw-r--r--  2.0 unx      706 b- defN 23-Apr-27 10:32 mlrun/frameworks/auto_mlrun/__init__.py
--rw-r--r--  2.0 unx    23796 b- defN 23-Apr-27 10:32 mlrun/frameworks/auto_mlrun/auto_mlrun.py
--rw-r--r--  2.0 unx      721 b- defN 23-Apr-27 10:32 mlrun/frameworks/huggingface/__init__.py
--rw-r--r--  2.0 unx     6083 b- defN 23-Apr-27 10:32 mlrun/frameworks/huggingface/model_server.py
--rw-r--r--  2.0 unx    15883 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/__init__.py
--rw-r--r--  2.0 unx    13891 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/model_handler.py
--rw-r--r--  2.0 unx     9189 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/model_server.py
--rw-r--r--  2.0 unx     8278 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/utils.py
--rw-r--r--  2.0 unx      857 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/callbacks/__init__.py
--rw-r--r--  2.0 unx     4081 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/callbacks/callback.py
--rw-r--r--  2.0 unx     5156 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     4137 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx      842 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py
--rw-r--r--  2.0 unx     1624 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py
--rw-r--r--  2.0 unx    14256 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py
--rw-r--r--  2.0 unx     1333 b- defN 23-Apr-27 10:32 mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py
--rw-r--r--  2.0 unx      791 b- defN 23-Apr-27 10:32 mlrun/frameworks/onnx/__init__.py
--rw-r--r--  2.0 unx     6098 b- defN 23-Apr-27 10:32 mlrun/frameworks/onnx/dataset.py
--rw-r--r--  2.0 unx     2405 b- defN 23-Apr-27 10:32 mlrun/frameworks/onnx/mlrun_interface.py
--rw-r--r--  2.0 unx     6203 b- defN 23-Apr-27 10:32 mlrun/frameworks/onnx/model_handler.py
--rw-r--r--  2.0 unx     7061 b- defN 23-Apr-27 10:32 mlrun/frameworks/onnx/model_server.py
--rw-r--r--  2.0 unx    22056 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/__init__.py
--rw-r--r--  2.0 unx    27904 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/callbacks_handler.py
--rw-r--r--  2.0 unx    44639 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/mlrun_interface.py
--rw-r--r--  2.0 unx    22465 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/model_handler.py
--rw-r--r--  2.0 unx    10136 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/model_server.py
--rw-r--r--  2.0 unx     4515 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/utils.py
--rw-r--r--  2.0 unx      896 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/callbacks/__init__.py
--rw-r--r--  2.0 unx    11524 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/callbacks/callback.py
--rw-r--r--  2.0 unx    23166 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     9310 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx    26661 b- defN 23-Apr-27 10:32 mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py
--rw-r--r--  2.0 unx    10892 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/__init__.py
--rw-r--r--  2.0 unx     5852 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/estimator.py
--rw-r--r--  2.0 unx     7117 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/metric.py
--rw-r--r--  2.0 unx    12215 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/metrics_library.py
--rw-r--r--  2.0 unx    14126 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/mlrun_interface.py
--rw-r--r--  2.0 unx     4745 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/model_handler.py
--rw-r--r--  2.0 unx     1209 b- defN 23-Apr-27 10:32 mlrun/frameworks/sklearn/utils.py
--rw-r--r--  2.0 unx    10455 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/__init__.py
--rw-r--r--  2.0 unx    16627 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/mlrun_interface.py
--rw-r--r--  2.0 unx    28247 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/model_handler.py
--rw-r--r--  2.0 unx     9565 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/model_server.py
--rw-r--r--  2.0 unx     4284 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/utils.py
--rw-r--r--  2.0 unx      844 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/callbacks/__init__.py
--rw-r--r--  2.0 unx    21886 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     8791 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx    28728 b- defN 23-Apr-27 10:32 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py
--rw-r--r--  2.0 unx    10287 b- defN 23-Apr-27 10:32 mlrun/frameworks/xgboost/__init__.py
--rw-r--r--  2.0 unx      878 b- defN 23-Apr-27 10:32 mlrun/frameworks/xgboost/mlrun_interface.py
--rw-r--r--  2.0 unx    11617 b- defN 23-Apr-27 10:32 mlrun/frameworks/xgboost/model_handler.py
--rw-r--r--  2.0 unx     1069 b- defN 23-Apr-27 10:32 mlrun/frameworks/xgboost/utils.py
--rw-r--r--  2.0 unx      760 b- defN 23-Apr-27 10:32 mlrun/mlutils/__init__.py
--rw-r--r--  2.0 unx     5325 b- defN 23-Apr-27 10:32 mlrun/mlutils/data.py
--rw-r--r--  2.0 unx     2598 b- defN 23-Apr-27 10:32 mlrun/mlutils/models.py
--rw-r--r--  2.0 unx    30120 b- defN 23-Apr-27 10:32 mlrun/mlutils/plots.py
--rw-r--r--  2.0 unx     1307 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/__init__.py
--rw-r--r--  2.0 unx     2962 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/common.py
--rw-r--r--  2.0 unx     3117 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/constants.py
--rw-r--r--  2.0 unx    23948 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/features_drift_table.py
--rw-r--r--  2.0 unx     5935 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/helpers.py
--rw-r--r--  2.0 unx     5176 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/model_endpoint.py
--rw-r--r--  2.0 unx    36191 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/model_monitoring_batch.py
--rw-r--r--  2.0 unx    43025 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stream_processing_fs.py
--rw-r--r--  2.0 unx     4240 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/__init__.py
--rw-r--r--  2.0 unx    16926 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/kv_model_endpoint_store.py
--rw-r--r--  2.0 unx     5695 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/model_endpoint_store.py
--rw-r--r--  2.0 unx    15700 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/sql_model_endpoint_store.py
--rw-r--r--  2.0 unx      884 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/models/__init__.py
--rw-r--r--  2.0 unx      655 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/models/base.py
--rw-r--r--  2.0 unx     3744 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/models/mysql.py
--rw-r--r--  2.0 unx     3661 b- defN 23-Apr-27 10:32 mlrun/model_monitoring/stores/models/sqlite.py
--rw-r--r--  2.0 unx     2400 b- defN 23-Apr-27 10:32 mlrun/platforms/__init__.py
--rw-r--r--  2.0 unx    23113 b- defN 23-Apr-27 10:32 mlrun/platforms/iguazio.py
--rw-r--r--  2.0 unx    11852 b- defN 23-Apr-27 10:32 mlrun/platforms/other.py
--rw-r--r--  2.0 unx     1153 b- defN 23-Apr-27 10:32 mlrun/projects/__init__.py
--rw-r--r--  2.0 unx    17485 b- defN 23-Apr-27 10:32 mlrun/projects/operations.py
--rw-r--r--  2.0 unx    37899 b- defN 23-Apr-27 10:32 mlrun/projects/pipelines.py
--rw-r--r--  2.0 unx   104532 b- defN 23-Apr-27 10:32 mlrun/projects/project.py
--rw-r--r--  2.0 unx     8773 b- defN 23-Apr-27 10:32 mlrun/runtimes/__init__.py
--rw-r--r--  2.0 unx   109502 b- defN 23-Apr-27 10:32 mlrun/runtimes/base.py
--rw-r--r--  2.0 unx     6689 b- defN 23-Apr-27 10:32 mlrun/runtimes/constants.py
--rw-r--r--  2.0 unx    30403 b- defN 23-Apr-27 10:32 mlrun/runtimes/daskjob.py
--rw-r--r--  2.0 unx     9190 b- defN 23-Apr-27 10:32 mlrun/runtimes/funcdoc.py
--rw-r--r--  2.0 unx    70153 b- defN 23-Apr-27 10:32 mlrun/runtimes/function.py
--rw-r--r--  2.0 unx     4911 b- defN 23-Apr-27 10:32 mlrun/runtimes/function_reference.py
--rw-r--r--  2.0 unx     6530 b- defN 23-Apr-27 10:32 mlrun/runtimes/generators.py
--rw-r--r--  2.0 unx    16895 b- defN 23-Apr-27 10:32 mlrun/runtimes/kubejob.py
--rw-r--r--  2.0 unx    18005 b- defN 23-Apr-27 10:32 mlrun/runtimes/local.py
--rw-r--r--  2.0 unx     2885 b- defN 23-Apr-27 10:32 mlrun/runtimes/nuclio.py
--rw-r--r--  2.0 unx    60648 b- defN 23-Apr-27 10:32 mlrun/runtimes/pod.py
--rw-r--r--  2.0 unx     7695 b- defN 23-Apr-27 10:32 mlrun/runtimes/remotesparkjob.py
--rw-r--r--  2.0 unx    29852 b- defN 23-Apr-27 10:32 mlrun/runtimes/serving.py
--rw-r--r--  2.0 unx    21249 b- defN 23-Apr-27 10:32 mlrun/runtimes/utils.py
--rw-r--r--  2.0 unx      790 b- defN 23-Apr-27 10:32 mlrun/runtimes/mpijob/__init__.py
--rw-r--r--  2.0 unx    14782 b- defN 23-Apr-27 10:32 mlrun/runtimes/mpijob/abstract.py
--rw-r--r--  2.0 unx    13845 b- defN 23-Apr-27 10:32 mlrun/runtimes/mpijob/v1.py
--rw-r--r--  2.0 unx     8460 b- defN 23-Apr-27 10:32 mlrun/runtimes/mpijob/v1alpha1.py
--rw-r--r--  2.0 unx      673 b- defN 23-Apr-27 10:32 mlrun/runtimes/package/__init__.py
--rw-r--r--  2.0 unx    27044 b- defN 23-Apr-27 10:32 mlrun/runtimes/package/context_handler.py
--rw-r--r--  2.0 unx      751 b- defN 23-Apr-27 10:32 mlrun/runtimes/sparkjob/__init__.py
--rw-r--r--  2.0 unx    35869 b- defN 23-Apr-27 10:32 mlrun/runtimes/sparkjob/abstract.py
--rw-r--r--  2.0 unx    28722 b- defN 23-Apr-27 10:32 mlrun/runtimes/sparkjob/spark3job.py
--rw-r--r--  2.0 unx     1078 b- defN 23-Apr-27 10:32 mlrun/serving/__init__.py
--rw-r--r--  2.0 unx     6116 b- defN 23-Apr-27 10:32 mlrun/serving/merger.py
--rw-r--r--  2.0 unx    18038 b- defN 23-Apr-27 10:32 mlrun/serving/remote.py
--rw-r--r--  2.0 unx    55209 b- defN 23-Apr-27 10:32 mlrun/serving/routers.py
--rw-r--r--  2.0 unx    19005 b- defN 23-Apr-27 10:32 mlrun/serving/server.py
--rw-r--r--  2.0 unx      836 b- defN 23-Apr-27 10:32 mlrun/serving/serving_wrapper.py
--rw-r--r--  2.0 unx    53940 b- defN 23-Apr-27 10:32 mlrun/serving/states.py
--rw-r--r--  2.0 unx     3468 b- defN 23-Apr-27 10:32 mlrun/serving/utils.py
--rw-r--r--  2.0 unx    11814 b- defN 23-Apr-27 10:32 mlrun/serving/v1_serving.py
--rw-r--r--  2.0 unx    21441 b- defN 23-Apr-27 10:32 mlrun/serving/v2_serving.py
--rw-r--r--  2.0 unx      855 b- defN 23-Apr-27 10:32 mlrun/utils/__init__.py
--rw-r--r--  2.0 unx    10397 b- defN 23-Apr-27 10:32 mlrun/utils/async_http.py
--rw-r--r--  2.0 unx     3456 b- defN 23-Apr-27 10:32 mlrun/utils/azure_vault.py
--rw-r--r--  2.0 unx     6245 b- defN 23-Apr-27 10:32 mlrun/utils/clones.py
--rw-r--r--  2.0 unx     1662 b- defN 23-Apr-27 10:32 mlrun/utils/db.py
--rw-r--r--  2.0 unx    41425 b- defN 23-Apr-27 10:32 mlrun/utils/helpers.py
--rw-r--r--  2.0 unx     7093 b- defN 23-Apr-27 10:32 mlrun/utils/http.py
--rw-r--r--  2.0 unx     5637 b- defN 23-Apr-27 10:32 mlrun/utils/logger.py
--rw-r--r--  2.0 unx     7875 b- defN 23-Apr-27 10:32 mlrun/utils/model_monitoring.py
--rw-r--r--  2.0 unx     3954 b- defN 23-Apr-27 10:32 mlrun/utils/regex.py
--rw-r--r--  2.0 unx      883 b- defN 23-Apr-27 10:32 mlrun/utils/singleton.py
--rw-r--r--  2.0 unx     1319 b- defN 23-Apr-27 10:32 mlrun/utils/v3io_clients.py
--rw-r--r--  2.0 unx     9957 b- defN 23-Apr-27 10:32 mlrun/utils/vault.py
--rw-r--r--  2.0 unx      990 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/__init__.py
--rw-r--r--  2.0 unx    12297 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification_pusher.py
--rw-r--r--  2.0 unx     1803 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification/__init__.py
--rw-r--r--  2.0 unx     2162 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification/base.py
--rw-r--r--  2.0 unx     1962 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification/console.py
--rw-r--r--  2.0 unx     4733 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification/git.py
--rw-r--r--  2.0 unx     2012 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification/ipython.py
--rw-r--r--  2.0 unx     3736 b- defN 23-Apr-27 10:32 mlrun/utils/notifications/notification/slack.py
--rw-r--r--  2.0 unx      614 b- defN 23-Apr-27 10:32 mlrun/utils/version/__init__.py
--rw-r--r--  2.0 unx       88 b- defN 23-Apr-27 10:32 mlrun/utils/version/version.json
--rw-r--r--  2.0 unx     1970 b- defN 23-Apr-27 10:32 mlrun/utils/version/version.py
--rw-r--r--  2.0 unx    11357 b- defN 23-Apr-27 10:32 mlrun-1.4.0rc2.dist-info/LICENSE
--rw-r--r--  2.0 unx    17177 b- defN 23-Apr-27 10:32 mlrun-1.4.0rc2.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-27 10:32 mlrun-1.4.0rc2.dist-info/WHEEL
--rw-r--r--  2.0 unx       47 b- defN 23-Apr-27 10:32 mlrun-1.4.0rc2.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Apr-27 10:32 mlrun-1.4.0rc2.dist-info/top_level.txt
--rw-rw-r--  2.0 unx    36988 b- defN 23-Apr-27 10:32 mlrun-1.4.0rc2.dist-info/RECORD
-394 files, 4344098 bytes uncompressed, 1103636 bytes compressed:  74.6%
+Zip file size: 1176317 bytes, number of entries: 402
+-rw-r--r--  2.0 unx     8727 b- defN 23-May-10 16:31 mlrun/__init__.py
+-rw-r--r--  2.0 unx    49356 b- defN 23-May-10 16:31 mlrun/__main__.py
+-rw-r--r--  2.0 unx    25103 b- defN 23-May-10 16:31 mlrun/builder.py
+-rw-r--r--  2.0 unx    54803 b- defN 23-May-10 16:31 mlrun/config.py
+-rw-r--r--  2.0 unx     6780 b- defN 23-May-10 16:31 mlrun/errors.py
+-rw-r--r--  2.0 unx    39096 b- defN 23-May-10 16:31 mlrun/execution.py
+-rw-r--r--  2.0 unx    15624 b- defN 23-May-10 16:31 mlrun/features.py
+-rw-r--r--  2.0 unx     4880 b- defN 23-May-10 16:31 mlrun/k8s_utils.py
+-rw-r--r--  2.0 unx    29645 b- defN 23-May-10 16:31 mlrun/kfpops.py
+-rw-r--r--  2.0 unx     8360 b- defN 23-May-10 16:31 mlrun/lists.py
+-rw-r--r--  2.0 unx    53415 b- defN 23-May-10 16:31 mlrun/model.py
+-rw-r--r--  2.0 unx    11828 b- defN 23-May-10 16:31 mlrun/render.py
+-rw-r--r--  2.0 unx    64472 b- defN 23-May-10 16:31 mlrun/run.py
+-rw-r--r--  2.0 unx     7783 b- defN 23-May-10 16:31 mlrun/secrets.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/__init__.py
+-rw-r--r--  2.0 unx     2105 b- defN 23-May-10 16:31 mlrun/api/alembic.ini
+-rw-r--r--  2.0 unx      685 b- defN 23-May-10 16:31 mlrun/api/constants.py
+-rw-r--r--  2.0 unx    23464 b- defN 23-May-10 16:31 mlrun/api/initial_data.py
+-rw-r--r--  2.0 unx    26288 b- defN 23-May-10 16:31 mlrun/api/main.py
+-rw-r--r--  2.0 unx     5247 b- defN 23-May-10 16:31 mlrun/api/middlewares.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/api/__init__.py
+-rw-r--r--  2.0 unx     4243 b- defN 23-May-10 16:31 mlrun/api/api/api.py
+-rw-r--r--  2.0 unx     3197 b- defN 23-May-10 16:31 mlrun/api/api/deps.py
+-rw-r--r--  2.0 unx    36432 b- defN 23-May-10 16:31 mlrun/api/api/utils.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/__init__.py
+-rw-r--r--  2.0 unx     9545 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/artifacts.py
+-rw-r--r--  2.0 unx     1199 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/auth.py
+-rw-r--r--  2.0 unx     3618 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/background_tasks.py
+-rw-r--r--  2.0 unx     1214 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/client_spec.py
+-rw-r--r--  2.0 unx     1175 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/clusterization_spec.py
+-rw-r--r--  2.0 unx    29675 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/feature_store.py
+-rw-r--r--  2.0 unx     6104 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/files.py
+-rw-r--r--  2.0 unx     5729 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/frontend_spec.py
+-rw-r--r--  2.0 unx    34608 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/functions.py
+-rw-r--r--  2.0 unx     5986 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/grafana_proxy.py
+-rw-r--r--  2.0 unx     1344 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/healthz.py
+-rw-r--r--  2.0 unx    10399 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/hub.py
+-rw-r--r--  2.0 unx     2450 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/logs.py
+-rw-r--r--  2.0 unx    15817 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/model_endpoints.py
+-rw-r--r--  2.0 unx     3756 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/operations.py
+-rw-r--r--  2.0 unx     9220 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/pipelines.py
+-rw-r--r--  2.0 unx    11494 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/projects.py
+-rw-r--r--  2.0 unx     9151 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/runs.py
+-rw-r--r--  2.0 unx     9063 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/runtime_resources.py
+-rw-r--r--  2.0 unx    10731 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/schedules.py
+-rw-r--r--  2.0 unx     6061 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/secrets.py
+-rw-r--r--  2.0 unx     5298 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/submit.py
+-rw-r--r--  2.0 unx     4894 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/tags.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/internal/__init__.py
+-rw-r--r--  2.0 unx     1043 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/internal/config.py
+-rw-r--r--  2.0 unx     1724 b- defN 23-May-10 16:31 mlrun/api/api/endpoints/internal/memory_reports.py
+-rw-r--r--  2.0 unx     1209 b- defN 23-May-10 16:31 mlrun/api/crud/__init__.py
+-rw-r--r--  2.0 unx     5610 b- defN 23-May-10 16:31 mlrun/api/crud/artifacts.py
+-rw-r--r--  2.0 unx     7331 b- defN 23-May-10 16:31 mlrun/api/crud/client_spec.py
+-rw-r--r--  2.0 unx     1055 b- defN 23-May-10 16:31 mlrun/api/crud/clusterization_spec.py
+-rw-r--r--  2.0 unx    18628 b- defN 23-May-10 16:31 mlrun/api/crud/feature_store.py
+-rw-r--r--  2.0 unx     3556 b- defN 23-May-10 16:31 mlrun/api/crud/functions.py
+-rw-r--r--  2.0 unx    12025 b- defN 23-May-10 16:31 mlrun/api/crud/hub.py
+-rw-r--r--  2.0 unx     9729 b- defN 23-May-10 16:31 mlrun/api/crud/logs.py
+-rw-r--r--  2.0 unx     2751 b- defN 23-May-10 16:31 mlrun/api/crud/notifications.py
+-rw-r--r--  2.0 unx    14030 b- defN 23-May-10 16:31 mlrun/api/crud/pipelines.py
+-rw-r--r--  2.0 unx    14269 b- defN 23-May-10 16:31 mlrun/api/crud/projects.py
+-rw-r--r--  2.0 unx     6020 b- defN 23-May-10 16:31 mlrun/api/crud/runs.py
+-rw-r--r--  2.0 unx     5575 b- defN 23-May-10 16:31 mlrun/api/crud/runtime_resources.py
+-rw-r--r--  2.0 unx    20145 b- defN 23-May-10 16:31 mlrun/api/crud/secrets.py
+-rw-r--r--  2.0 unx     3277 b- defN 23-May-10 16:31 mlrun/api/crud/tags.py
+-rw-r--r--  2.0 unx      722 b- defN 23-May-10 16:31 mlrun/api/crud/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx    15692 b- defN 23-May-10 16:31 mlrun/api/crud/model_monitoring/grafana.py
+-rw-r--r--  2.0 unx    43000 b- defN 23-May-10 16:31 mlrun/api/crud/model_monitoring/model_endpoints.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/crud/runtimes/__init__.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/crud/runtimes/nuclio/__init__.py
+-rw-r--r--  2.0 unx    17168 b- defN 23-May-10 16:31 mlrun/api/crud/runtimes/nuclio/function.py
+-rw-r--r--  2.0 unx    11398 b- defN 23-May-10 16:31 mlrun/api/crud/runtimes/nuclio/helpers.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/db/__init__.py
+-rw-r--r--  2.0 unx    15056 b- defN 23-May-10 16:31 mlrun/api/db/base.py
+-rw-r--r--  2.0 unx      870 b- defN 23-May-10 16:31 mlrun/api/db/init_db.py
+-rw-r--r--  2.0 unx      993 b- defN 23-May-10 16:31 mlrun/api/db/session.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/__init__.py
+-rw-r--r--  2.0 unx   144042 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/db.py
+-rw-r--r--  2.0 unx     2340 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/helpers.py
+-rw-r--r--  2.0 unx     2542 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/session.py
+-rw-r--r--  2.0 unx     1063 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/models/__init__.py
+-rw-r--r--  2.0 unx    20642 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/models/models_mysql.py
+-rw-r--r--  2.0 unx    18304 b- defN 23-May-10 16:31 mlrun/api/db/sqldb/models/models_sqlite.py
+-rw-r--r--  2.0 unx     2906 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/env.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py
+-rw-r--r--  2.0 unx     4614 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
+-rw-r--r--  2.0 unx     1936 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
+-rw-r--r--  2.0 unx     1909 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
+-rw-r--r--  2.0 unx     1415 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py
+-rw-r--r--  2.0 unx     1504 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py
+-rw-r--r--  2.0 unx     1649 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py
+-rw-r--r--  2.0 unx    24057 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py
+-rw-r--r--  2.0 unx     2457 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py
+-rw-r--r--  2.0 unx     1351 b- defN 23-May-10 16:31 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py
+-rw-r--r--  2.0 unx     2906 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/env.py
+-rw-r--r--  2.0 unx    11473 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py
+-rw-r--r--  2.0 unx     1348 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
+-rw-r--r--  2.0 unx     5180 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
+-rw-r--r--  2.0 unx     2595 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py
+-rw-r--r--  2.0 unx     1388 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
+-rw-r--r--  2.0 unx     1767 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
+-rw-r--r--  2.0 unx     1360 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
+-rw-r--r--  2.0 unx     1259 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py
+-rw-r--r--  2.0 unx     2147 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py
+-rw-r--r--  2.0 unx     1482 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py
+-rw-r--r--  2.0 unx     1892 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py
+-rw-r--r--  2.0 unx     1882 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py
+-rw-r--r--  2.0 unx     1420 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py
+-rw-r--r--  2.0 unx     2034 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py
+-rw-r--r--  2.0 unx     1828 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py
+-rw-r--r--  2.0 unx     1380 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py
+-rw-r--r--  2.0 unx     1831 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py
+-rw-r--r--  2.0 unx     3936 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
+-rw-r--r--  2.0 unx     2588 b- defN 23-May-10 16:31 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
+-rw-r--r--  2.0 unx    13338 b- defN 23-May-10 16:31 mlrun/api/schemas/__init__.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/__init__.py
+-rw-r--r--  2.0 unx     1092 b- defN 23-May-10 16:31 mlrun/api/utils/asyncio.py
+-rw-r--r--  2.0 unx     7371 b- defN 23-May-10 16:31 mlrun/api/utils/background_tasks.py
+-rw-r--r--  2.0 unx     2431 b- defN 23-May-10 16:31 mlrun/api/utils/helpers.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-May-10 16:31 mlrun/api/utils/memory_reports.py
+-rw-r--r--  2.0 unx     2599 b- defN 23-May-10 16:31 mlrun/api/utils/periodic.py
+-rw-r--r--  2.0 unx    39305 b- defN 23-May-10 16:31 mlrun/api/utils/scheduler.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/auth/__init__.py
+-rw-r--r--  2.0 unx    12383 b- defN 23-May-10 16:31 mlrun/api/utils/auth/verifier.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/auth/providers/__init__.py
+-rw-r--r--  2.0 unx     1381 b- defN 23-May-10 16:31 mlrun/api/utils/auth/providers/base.py
+-rw-r--r--  2.0 unx     1460 b- defN 23-May-10 16:31 mlrun/api/utils/auth/providers/nop.py
+-rw-r--r--  2.0 unx    10883 b- defN 23-May-10 16:31 mlrun/api/utils/auth/providers/opa.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/clients/__init__.py
+-rw-r--r--  2.0 unx    13271 b- defN 23-May-10 16:31 mlrun/api/utils/clients/chief.py
+-rw-r--r--  2.0 unx    31266 b- defN 23-May-10 16:31 mlrun/api/utils/clients/iguazio.py
+-rw-r--r--  2.0 unx    12109 b- defN 23-May-10 16:31 mlrun/api/utils/clients/log_collector.py
+-rw-r--r--  2.0 unx     9916 b- defN 23-May-10 16:31 mlrun/api/utils/clients/nuclio.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/clients/protocols/__init__.py
+-rw-r--r--  2.0 unx     2567 b- defN 23-May-10 16:31 mlrun/api/utils/clients/protocols/grpc.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/db/__init__.py
+-rw-r--r--  2.0 unx     3305 b- defN 23-May-10 16:31 mlrun/api/utils/db/alembic.py
+-rw-r--r--  2.0 unx     8214 b- defN 23-May-10 16:31 mlrun/api/utils/db/backup.py
+-rw-r--r--  2.0 unx     3795 b- defN 23-May-10 16:31 mlrun/api/utils/db/mysql.py
+-rw-r--r--  2.0 unx      992 b- defN 23-May-10 16:31 mlrun/api/utils/db/sql_collation.py
+-rw-r--r--  2.0 unx     3855 b- defN 23-May-10 16:31 mlrun/api/utils/db/sqlite_migration.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/projects/__init__.py
+-rw-r--r--  2.0 unx    17423 b- defN 23-May-10 16:31 mlrun/api/utils/projects/follower.py
+-rw-r--r--  2.0 unx    19549 b- defN 23-May-10 16:31 mlrun/api/utils/projects/leader.py
+-rw-r--r--  2.0 unx     7133 b- defN 23-May-10 16:31 mlrun/api/utils/projects/member.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/projects/remotes/__init__.py
+-rw-r--r--  2.0 unx     2659 b- defN 23-May-10 16:31 mlrun/api/utils/projects/remotes/follower.py
+-rw-r--r--  2.0 unx     2094 b- defN 23-May-10 16:31 mlrun/api/utils/projects/remotes/leader.py
+-rw-r--r--  2.0 unx     5000 b- defN 23-May-10 16:31 mlrun/api/utils/projects/remotes/nop_follower.py
+-rw-r--r--  2.0 unx     3861 b- defN 23-May-10 16:31 mlrun/api/utils/projects/remotes/nop_leader.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/api/utils/singletons/__init__.py
+-rw-r--r--  2.0 unx     1202 b- defN 23-May-10 16:31 mlrun/api/utils/singletons/db.py
+-rw-r--r--  2.0 unx    22630 b- defN 23-May-10 16:31 mlrun/api/utils/singletons/k8s.py
+-rw-r--r--  2.0 unx      840 b- defN 23-May-10 16:31 mlrun/api/utils/singletons/logs_dir.py
+-rw-r--r--  2.0 unx     1279 b- defN 23-May-10 16:31 mlrun/api/utils/singletons/project_member.py
+-rw-r--r--  2.0 unx     1063 b- defN 23-May-10 16:31 mlrun/api/utils/singletons/scheduler.py
+-rw-r--r--  2.0 unx     1091 b- defN 23-May-10 16:31 mlrun/artifacts/__init__.py
+-rw-r--r--  2.0 unx    30849 b- defN 23-May-10 16:31 mlrun/artifacts/base.py
+-rw-r--r--  2.0 unx    20432 b- defN 23-May-10 16:31 mlrun/artifacts/dataset.py
+-rw-r--r--  2.0 unx    12110 b- defN 23-May-10 16:31 mlrun/artifacts/manager.py
+-rw-r--r--  2.0 unx    23673 b- defN 23-May-10 16:31 mlrun/artifacts/model.py
+-rw-r--r--  2.0 unx    15383 b- defN 23-May-10 16:31 mlrun/artifacts/plots.py
+-rw-r--r--  2.0 unx      571 b- defN 23-May-10 16:31 mlrun/common/__init__.py
+-rw-r--r--  2.0 unx     5670 b- defN 23-May-10 16:31 mlrun/common/model_monitoring.py
+-rw-r--r--  2.0 unx      790 b- defN 23-May-10 16:31 mlrun/common/types.py
+-rw-r--r--  2.0 unx     3973 b- defN 23-May-10 16:31 mlrun/common/schemas/__init__.py
+-rw-r--r--  2.0 unx     1923 b- defN 23-May-10 16:31 mlrun/common/schemas/artifact.py
+-rw-r--r--  2.0 unx     5251 b- defN 23-May-10 16:31 mlrun/common/schemas/auth.py
+-rw-r--r--  2.0 unx     1553 b- defN 23-May-10 16:31 mlrun/common/schemas/background_task.py
+-rw-r--r--  2.0 unx     2751 b- defN 23-May-10 16:31 mlrun/common/schemas/client_spec.py
+-rw-r--r--  2.0 unx      888 b- defN 23-May-10 16:31 mlrun/common/schemas/clusterization_spec.py
+-rw-r--r--  2.0 unx     6243 b- defN 23-May-10 16:31 mlrun/common/schemas/constants.py
+-rw-r--r--  2.0 unx     3671 b- defN 23-May-10 16:31 mlrun/common/schemas/feature_store.py
+-rw-r--r--  2.0 unx     2546 b- defN 23-May-10 16:31 mlrun/common/schemas/frontend_spec.py
+-rw-r--r--  2.0 unx     3971 b- defN 23-May-10 16:31 mlrun/common/schemas/function.py
+-rw-r--r--  2.0 unx      705 b- defN 23-May-10 16:31 mlrun/common/schemas/http.py
+-rw-r--r--  2.0 unx     4245 b- defN 23-May-10 16:31 mlrun/common/schemas/hub.py
+-rw-r--r--  2.0 unx     1395 b- defN 23-May-10 16:31 mlrun/common/schemas/k8s.py
+-rw-r--r--  2.0 unx      920 b- defN 23-May-10 16:31 mlrun/common/schemas/memory_reports.py
+-rw-r--r--  2.0 unx    12528 b- defN 23-May-10 16:31 mlrun/common/schemas/model_endpoints.py
+-rw-r--r--  2.0 unx      879 b- defN 23-May-10 16:31 mlrun/common/schemas/notification.py
+-rw-r--r--  2.0 unx     1907 b- defN 23-May-10 16:31 mlrun/common/schemas/object.py
+-rw-r--r--  2.0 unx     1184 b- defN 23-May-10 16:31 mlrun/common/schemas/pipeline.py
+-rw-r--r--  2.0 unx     4094 b- defN 23-May-10 16:31 mlrun/common/schemas/project.py
+-rw-r--r--  2.0 unx     1636 b- defN 23-May-10 16:31 mlrun/common/schemas/runtime_resource.py
+-rw-r--r--  2.0 unx     4188 b- defN 23-May-10 16:31 mlrun/common/schemas/schedule.py
+-rw-r--r--  2.0 unx     1484 b- defN 23-May-10 16:31 mlrun/common/schemas/secret.py
+-rw-r--r--  2.0 unx      919 b- defN 23-May-10 16:31 mlrun/common/schemas/tag.py
+-rw-r--r--  2.0 unx     1087 b- defN 23-May-10 16:31 mlrun/data_types/__init__.py
+-rw-r--r--  2.0 unx     4647 b- defN 23-May-10 16:31 mlrun/data_types/data_types.py
+-rw-r--r--  2.0 unx     5813 b- defN 23-May-10 16:31 mlrun/data_types/infer.py
+-rw-r--r--  2.0 unx     9426 b- defN 23-May-10 16:31 mlrun/data_types/spark.py
+-rw-r--r--  2.0 unx     3443 b- defN 23-May-10 16:31 mlrun/datastore/__init__.py
+-rw-r--r--  2.0 unx     6946 b- defN 23-May-10 16:31 mlrun/datastore/azure_blob.py
+-rw-r--r--  2.0 unx    18274 b- defN 23-May-10 16:31 mlrun/datastore/base.py
+-rw-r--r--  2.0 unx     7995 b- defN 23-May-10 16:31 mlrun/datastore/datastore.py
+-rw-r--r--  2.0 unx     3791 b- defN 23-May-10 16:31 mlrun/datastore/filestore.py
+-rw-r--r--  2.0 unx     5114 b- defN 23-May-10 16:31 mlrun/datastore/google_cloud_storage.py
+-rw-r--r--  2.0 unx     2627 b- defN 23-May-10 16:31 mlrun/datastore/inmem.py
+-rw-r--r--  2.0 unx     4873 b- defN 23-May-10 16:31 mlrun/datastore/redis.py
+-rw-r--r--  2.0 unx     7035 b- defN 23-May-10 16:31 mlrun/datastore/s3.py
+-rw-r--r--  2.0 unx    34385 b- defN 23-May-10 16:31 mlrun/datastore/sources.py
+-rw-r--r--  2.0 unx     1410 b- defN 23-May-10 16:31 mlrun/datastore/spark_udf.py
+-rw-r--r--  2.0 unx     6895 b- defN 23-May-10 16:31 mlrun/datastore/store_resources.py
+-rw-r--r--  2.0 unx    62060 b- defN 23-May-10 16:31 mlrun/datastore/targets.py
+-rw-r--r--  2.0 unx     2409 b- defN 23-May-10 16:31 mlrun/datastore/utils.py
+-rw-r--r--  2.0 unx     8097 b- defN 23-May-10 16:31 mlrun/datastore/v3io.py
+-rw-r--r--  2.0 unx     1343 b- defN 23-May-10 16:31 mlrun/datastore/wasbfs/__init__.py
+-rw-r--r--  2.0 unx     6152 b- defN 23-May-10 16:31 mlrun/datastore/wasbfs/fs.py
+-rw-r--r--  2.0 unx     2816 b- defN 23-May-10 16:31 mlrun/db/__init__.py
+-rw-r--r--  2.0 unx    15737 b- defN 23-May-10 16:31 mlrun/db/base.py
+-rw-r--r--  2.0 unx   130695 b- defN 23-May-10 16:31 mlrun/db/httpdb.py
+-rw-r--r--  2.0 unx    13197 b- defN 23-May-10 16:31 mlrun/db/nopdb.py
+-rw-r--r--  2.0 unx    25917 b- defN 23-May-10 16:31 mlrun/db/sqldb.py
+-rw-r--r--  2.0 unx     1501 b- defN 23-May-10 16:31 mlrun/feature_store/__init__.py
+-rw-r--r--  2.0 unx    43820 b- defN 23-May-10 16:31 mlrun/feature_store/api.py
+-rw-r--r--  2.0 unx    12781 b- defN 23-May-10 16:31 mlrun/feature_store/common.py
+-rw-r--r--  2.0 unx    47273 b- defN 23-May-10 16:31 mlrun/feature_store/feature_set.py
+-rw-r--r--  2.0 unx    21940 b- defN 23-May-10 16:31 mlrun/feature_store/feature_vector.py
+-rw-r--r--  2.0 unx    11681 b- defN 23-May-10 16:31 mlrun/feature_store/ingestion.py
+-rw-r--r--  2.0 unx    28635 b- defN 23-May-10 16:31 mlrun/feature_store/steps.py
+-rw-r--r--  2.0 unx     1232 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/__init__.py
+-rw-r--r--  2.0 unx    25911 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/base.py
+-rw-r--r--  2.0 unx     4261 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/dask_merger.py
+-rw-r--r--  2.0 unx     7106 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/job.py
+-rw-r--r--  2.0 unx     4765 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/local_merger.py
+-rw-r--r--  2.0 unx     3352 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/online.py
+-rw-r--r--  2.0 unx     9661 b- defN 23-May-10 16:31 mlrun/feature_store/retrieval/spark_merger.py
+-rw-r--r--  2.0 unx      743 b- defN 23-May-10 16:31 mlrun/frameworks/__init__.py
+-rw-r--r--  2.0 unx    11466 b- defN 23-May-10 16:31 mlrun/frameworks/parallel_coordinates.py
+-rw-r--r--  2.0 unx      962 b- defN 23-May-10 16:31 mlrun/frameworks/_common/__init__.py
+-rw-r--r--  2.0 unx     8515 b- defN 23-May-10 16:31 mlrun/frameworks/_common/artifacts_library.py
+-rw-r--r--  2.0 unx    21018 b- defN 23-May-10 16:31 mlrun/frameworks/_common/mlrun_interface.py
+-rw-r--r--  2.0 unx    55376 b- defN 23-May-10 16:31 mlrun/frameworks/_common/model_handler.py
+-rw-r--r--  2.0 unx     3469 b- defN 23-May-10 16:31 mlrun/frameworks/_common/plan.py
+-rw-r--r--  2.0 unx     5757 b- defN 23-May-10 16:31 mlrun/frameworks/_common/producer.py
+-rw-r--r--  2.0 unx     9209 b- defN 23-May-10 16:31 mlrun/frameworks/_common/utils.py
+-rw-r--r--  2.0 unx      750 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/__init__.py
+-rw-r--r--  2.0 unx     1151 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/model_handler.py
+-rw-r--r--  2.0 unx      996 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/utils.py
+-rw-r--r--  2.0 unx      787 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/loggers/__init__.py
+-rw-r--r--  2.0 unx    11531 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/loggers/logger.py
+-rw-r--r--  2.0 unx    14777 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/loggers/mlrun_logger.py
+-rw-r--r--  2.0 unx    28414 b- defN 23-May-10 16:31 mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py
+-rw-r--r--  2.0 unx      956 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/__init__.py
+-rw-r--r--  2.0 unx     3169 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/artifacts_library.py
+-rw-r--r--  2.0 unx    16957 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/model_handler.py
+-rw-r--r--  2.0 unx     2368 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/pkl_model_server.py
+-rw-r--r--  2.0 unx     4881 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plan.py
+-rw-r--r--  2.0 unx     4061 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/producer.py
+-rw-r--r--  2.0 unx    10490 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/utils.py
+-rw-r--r--  2.0 unx      737 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/loggers/__init__.py
+-rw-r--r--  2.0 unx     5684 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/loggers/logger.py
+-rw-r--r--  2.0 unx     6453 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/loggers/mlrun_logger.py
+-rw-r--r--  2.0 unx      922 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plans/__init__.py
+-rw-r--r--  2.0 unx     5212 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py
+-rw-r--r--  2.0 unx     6078 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py
+-rw-r--r--  2.0 unx     6658 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plans/dataset_plan.py
+-rw-r--r--  2.0 unx     5318 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plans/feature_importance_plan.py
+-rw-r--r--  2.0 unx     6993 b- defN 23-May-10 16:31 mlrun/frameworks/_ml_common/plans/roc_curve_plan.py
+-rw-r--r--  2.0 unx      706 b- defN 23-May-10 16:31 mlrun/frameworks/auto_mlrun/__init__.py
+-rw-r--r--  2.0 unx    23796 b- defN 23-May-10 16:31 mlrun/frameworks/auto_mlrun/auto_mlrun.py
+-rw-r--r--  2.0 unx      721 b- defN 23-May-10 16:31 mlrun/frameworks/huggingface/__init__.py
+-rw-r--r--  2.0 unx     6083 b- defN 23-May-10 16:31 mlrun/frameworks/huggingface/model_server.py
+-rw-r--r--  2.0 unx    15883 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/__init__.py
+-rw-r--r--  2.0 unx    13891 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/model_handler.py
+-rw-r--r--  2.0 unx     9189 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/model_server.py
+-rw-r--r--  2.0 unx     8278 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/utils.py
+-rw-r--r--  2.0 unx      857 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/callbacks/__init__.py
+-rw-r--r--  2.0 unx     4081 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/callbacks/callback.py
+-rw-r--r--  2.0 unx     5156 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     4137 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx      842 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py
+-rw-r--r--  2.0 unx     1624 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py
+-rw-r--r--  2.0 unx    14256 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py
+-rw-r--r--  2.0 unx     1333 b- defN 23-May-10 16:31 mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py
+-rw-r--r--  2.0 unx      791 b- defN 23-May-10 16:31 mlrun/frameworks/onnx/__init__.py
+-rw-r--r--  2.0 unx     6098 b- defN 23-May-10 16:31 mlrun/frameworks/onnx/dataset.py
+-rw-r--r--  2.0 unx     2405 b- defN 23-May-10 16:31 mlrun/frameworks/onnx/mlrun_interface.py
+-rw-r--r--  2.0 unx     6203 b- defN 23-May-10 16:31 mlrun/frameworks/onnx/model_handler.py
+-rw-r--r--  2.0 unx     7061 b- defN 23-May-10 16:31 mlrun/frameworks/onnx/model_server.py
+-rw-r--r--  2.0 unx    22056 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/__init__.py
+-rw-r--r--  2.0 unx    27904 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/callbacks_handler.py
+-rw-r--r--  2.0 unx    44639 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/mlrun_interface.py
+-rw-r--r--  2.0 unx    22465 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/model_handler.py
+-rw-r--r--  2.0 unx    10136 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/model_server.py
+-rw-r--r--  2.0 unx     4515 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/utils.py
+-rw-r--r--  2.0 unx      896 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/callbacks/__init__.py
+-rw-r--r--  2.0 unx    11524 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/callbacks/callback.py
+-rw-r--r--  2.0 unx    23166 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     9310 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx    26661 b- defN 23-May-10 16:31 mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py
+-rw-r--r--  2.0 unx    10892 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/__init__.py
+-rw-r--r--  2.0 unx     5852 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/estimator.py
+-rw-r--r--  2.0 unx     7117 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/metric.py
+-rw-r--r--  2.0 unx    12215 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/metrics_library.py
+-rw-r--r--  2.0 unx    14126 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/mlrun_interface.py
+-rw-r--r--  2.0 unx     4745 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/model_handler.py
+-rw-r--r--  2.0 unx     1209 b- defN 23-May-10 16:31 mlrun/frameworks/sklearn/utils.py
+-rw-r--r--  2.0 unx    10455 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/__init__.py
+-rw-r--r--  2.0 unx    16627 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/mlrun_interface.py
+-rw-r--r--  2.0 unx    28247 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/model_handler.py
+-rw-r--r--  2.0 unx     9565 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/model_server.py
+-rw-r--r--  2.0 unx     4284 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/utils.py
+-rw-r--r--  2.0 unx      844 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/callbacks/__init__.py
+-rw-r--r--  2.0 unx    21886 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     8791 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx    28728 b- defN 23-May-10 16:31 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py
+-rw-r--r--  2.0 unx    10287 b- defN 23-May-10 16:31 mlrun/frameworks/xgboost/__init__.py
+-rw-r--r--  2.0 unx      878 b- defN 23-May-10 16:31 mlrun/frameworks/xgboost/mlrun_interface.py
+-rw-r--r--  2.0 unx    11617 b- defN 23-May-10 16:31 mlrun/frameworks/xgboost/model_handler.py
+-rw-r--r--  2.0 unx     1069 b- defN 23-May-10 16:31 mlrun/frameworks/xgboost/utils.py
+-rw-r--r--  2.0 unx      760 b- defN 23-May-10 16:31 mlrun/mlutils/__init__.py
+-rw-r--r--  2.0 unx     5325 b- defN 23-May-10 16:31 mlrun/mlutils/data.py
+-rw-r--r--  2.0 unx     2598 b- defN 23-May-10 16:31 mlrun/mlutils/models.py
+-rw-r--r--  2.0 unx    30120 b- defN 23-May-10 16:31 mlrun/mlutils/plots.py
+-rw-r--r--  2.0 unx     1208 b- defN 23-May-10 16:31 mlrun/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx    23948 b- defN 23-May-10 16:31 mlrun/model_monitoring/features_drift_table.py
+-rw-r--r--  2.0 unx     9756 b- defN 23-May-10 16:31 mlrun/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx     5196 b- defN 23-May-10 16:31 mlrun/model_monitoring/model_endpoint.py
+-rw-r--r--  2.0 unx    36885 b- defN 23-May-10 16:31 mlrun/model_monitoring/model_monitoring_batch.py
+-rw-r--r--  2.0 unx    43172 b- defN 23-May-10 16:31 mlrun/model_monitoring/stream_processing_fs.py
+-rw-r--r--  2.0 unx     4240 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/__init__.py
+-rw-r--r--  2.0 unx    17357 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/kv_model_endpoint_store.py
+-rw-r--r--  2.0 unx     5695 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/model_endpoint_store.py
+-rw-r--r--  2.0 unx    15706 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/sql_model_endpoint_store.py
+-rw-r--r--  2.0 unx      884 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/models/__init__.py
+-rw-r--r--  2.0 unx      655 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/models/base.py
+-rw-r--r--  2.0 unx     3741 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/models/mysql.py
+-rw-r--r--  2.0 unx     3658 b- defN 23-May-10 16:31 mlrun/model_monitoring/stores/models/sqlite.py
+-rw-r--r--  2.0 unx     2400 b- defN 23-May-10 16:31 mlrun/platforms/__init__.py
+-rw-r--r--  2.0 unx    24102 b- defN 23-May-10 16:31 mlrun/platforms/iguazio.py
+-rw-r--r--  2.0 unx    11852 b- defN 23-May-10 16:31 mlrun/platforms/other.py
+-rw-r--r--  2.0 unx     1153 b- defN 23-May-10 16:31 mlrun/projects/__init__.py
+-rw-r--r--  2.0 unx    17480 b- defN 23-May-10 16:31 mlrun/projects/operations.py
+-rw-r--r--  2.0 unx    38336 b- defN 23-May-10 16:31 mlrun/projects/pipelines.py
+-rw-r--r--  2.0 unx   105214 b- defN 23-May-10 16:31 mlrun/projects/project.py
+-rw-r--r--  2.0 unx     8773 b- defN 23-May-10 16:31 mlrun/runtimes/__init__.py
+-rw-r--r--  2.0 unx   109329 b- defN 23-May-10 16:31 mlrun/runtimes/base.py
+-rw-r--r--  2.0 unx     6689 b- defN 23-May-10 16:31 mlrun/runtimes/constants.py
+-rw-r--r--  2.0 unx    30520 b- defN 23-May-10 16:31 mlrun/runtimes/daskjob.py
+-rw-r--r--  2.0 unx     9190 b- defN 23-May-10 16:31 mlrun/runtimes/funcdoc.py
+-rw-r--r--  2.0 unx    45205 b- defN 23-May-10 16:31 mlrun/runtimes/function.py
+-rw-r--r--  2.0 unx     4911 b- defN 23-May-10 16:31 mlrun/runtimes/function_reference.py
+-rw-r--r--  2.0 unx     6530 b- defN 23-May-10 16:31 mlrun/runtimes/generators.py
+-rw-r--r--  2.0 unx    15406 b- defN 23-May-10 16:31 mlrun/runtimes/kubejob.py
+-rw-r--r--  2.0 unx    18005 b- defN 23-May-10 16:31 mlrun/runtimes/local.py
+-rw-r--r--  2.0 unx     2885 b- defN 23-May-10 16:31 mlrun/runtimes/nuclio.py
+-rw-r--r--  2.0 unx    60644 b- defN 23-May-10 16:31 mlrun/runtimes/pod.py
+-rw-r--r--  2.0 unx     7695 b- defN 23-May-10 16:31 mlrun/runtimes/remotesparkjob.py
+-rw-r--r--  2.0 unx    29858 b- defN 23-May-10 16:31 mlrun/runtimes/serving.py
+-rw-r--r--  2.0 unx    21131 b- defN 23-May-10 16:31 mlrun/runtimes/utils.py
+-rw-r--r--  2.0 unx      790 b- defN 23-May-10 16:31 mlrun/runtimes/mpijob/__init__.py
+-rw-r--r--  2.0 unx    14713 b- defN 23-May-10 16:31 mlrun/runtimes/mpijob/abstract.py
+-rw-r--r--  2.0 unx    13845 b- defN 23-May-10 16:31 mlrun/runtimes/mpijob/v1.py
+-rw-r--r--  2.0 unx     8460 b- defN 23-May-10 16:31 mlrun/runtimes/mpijob/v1alpha1.py
+-rw-r--r--  2.0 unx      673 b- defN 23-May-10 16:31 mlrun/runtimes/package/__init__.py
+-rw-r--r--  2.0 unx    27068 b- defN 23-May-10 16:31 mlrun/runtimes/package/context_handler.py
+-rw-r--r--  2.0 unx      751 b- defN 23-May-10 16:31 mlrun/runtimes/sparkjob/__init__.py
+-rw-r--r--  2.0 unx    35028 b- defN 23-May-10 16:31 mlrun/runtimes/sparkjob/abstract.py
+-rw-r--r--  2.0 unx    28746 b- defN 23-May-10 16:31 mlrun/runtimes/sparkjob/spark3job.py
+-rw-r--r--  2.0 unx     1078 b- defN 23-May-10 16:31 mlrun/serving/__init__.py
+-rw-r--r--  2.0 unx     6116 b- defN 23-May-10 16:31 mlrun/serving/merger.py
+-rw-r--r--  2.0 unx    18038 b- defN 23-May-10 16:31 mlrun/serving/remote.py
+-rw-r--r--  2.0 unx    55277 b- defN 23-May-10 16:31 mlrun/serving/routers.py
+-rw-r--r--  2.0 unx    20247 b- defN 23-May-10 16:31 mlrun/serving/server.py
+-rw-r--r--  2.0 unx      836 b- defN 23-May-10 16:31 mlrun/serving/serving_wrapper.py
+-rw-r--r--  2.0 unx    53940 b- defN 23-May-10 16:31 mlrun/serving/states.py
+-rw-r--r--  2.0 unx     3902 b- defN 23-May-10 16:31 mlrun/serving/utils.py
+-rw-r--r--  2.0 unx    11814 b- defN 23-May-10 16:31 mlrun/serving/v1_serving.py
+-rw-r--r--  2.0 unx    21460 b- defN 23-May-10 16:31 mlrun/serving/v2_serving.py
+-rw-r--r--  2.0 unx      826 b- defN 23-May-10 16:31 mlrun/utils/__init__.py
+-rw-r--r--  2.0 unx    10397 b- defN 23-May-10 16:31 mlrun/utils/async_http.py
+-rw-r--r--  2.0 unx     3456 b- defN 23-May-10 16:31 mlrun/utils/azure_vault.py
+-rw-r--r--  2.0 unx     6245 b- defN 23-May-10 16:31 mlrun/utils/clones.py
+-rw-r--r--  2.0 unx     1662 b- defN 23-May-10 16:31 mlrun/utils/db.py
+-rw-r--r--  2.0 unx    42139 b- defN 23-May-10 16:31 mlrun/utils/helpers.py
+-rw-r--r--  2.0 unx     7093 b- defN 23-May-10 16:31 mlrun/utils/http.py
+-rw-r--r--  2.0 unx     5637 b- defN 23-May-10 16:31 mlrun/utils/logger.py
+-rw-r--r--  2.0 unx     9969 b- defN 23-May-10 16:31 mlrun/utils/model_monitoring.py
+-rw-r--r--  2.0 unx     3954 b- defN 23-May-10 16:31 mlrun/utils/regex.py
+-rw-r--r--  2.0 unx      883 b- defN 23-May-10 16:31 mlrun/utils/singleton.py
+-rw-r--r--  2.0 unx     1319 b- defN 23-May-10 16:31 mlrun/utils/v3io_clients.py
+-rw-r--r--  2.0 unx    10447 b- defN 23-May-10 16:31 mlrun/utils/vault.py
+-rw-r--r--  2.0 unx      990 b- defN 23-May-10 16:31 mlrun/utils/notifications/__init__.py
+-rw-r--r--  2.0 unx    12336 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification_pusher.py
+-rw-r--r--  2.0 unx     1803 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification/__init__.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification/base.py
+-rw-r--r--  2.0 unx     1971 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification/console.py
+-rw-r--r--  2.0 unx     4742 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification/git.py
+-rw-r--r--  2.0 unx     2021 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification/ipython.py
+-rw-r--r--  2.0 unx     3751 b- defN 23-May-10 16:31 mlrun/utils/notifications/notification/slack.py
+-rw-r--r--  2.0 unx      614 b- defN 23-May-10 16:31 mlrun/utils/version/__init__.py
+-rw-r--r--  2.0 unx       88 b- defN 23-May-10 16:31 mlrun/utils/version/version.json
+-rw-r--r--  2.0 unx     1970 b- defN 23-May-10 16:31 mlrun/utils/version/version.py
+-rw-r--r--  2.0 unx    11357 b- defN 23-May-10 16:31 mlrun-1.4.0rc3.dist-info/LICENSE
+-rw-r--r--  2.0 unx    17185 b- defN 23-May-10 16:31 mlrun-1.4.0rc3.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-10 16:31 mlrun-1.4.0rc3.dist-info/WHEEL
+-rw-r--r--  2.0 unx       47 b- defN 23-May-10 16:31 mlrun-1.4.0rc3.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-May-10 16:31 mlrun-1.4.0rc3.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx    37832 b- defN 23-May-10 16:31 mlrun-1.4.0rc3.dist-info/RECORD
+402 files, 4396387 bytes uncompressed, 1115935 bytes compressed:  74.6%
```

## zipnote {}

```diff
@@ -102,18 +102,18 @@
 
 Filename: mlrun/api/api/endpoints/grafana_proxy.py
 Comment: 
 
 Filename: mlrun/api/api/endpoints/healthz.py
 Comment: 
 
-Filename: mlrun/api/api/endpoints/logs.py
+Filename: mlrun/api/api/endpoints/hub.py
 Comment: 
 
-Filename: mlrun/api/api/endpoints/marketplace.py
+Filename: mlrun/api/api/endpoints/logs.py
 Comment: 
 
 Filename: mlrun/api/api/endpoints/model_endpoints.py
 Comment: 
 
 Filename: mlrun/api/api/endpoints/operations.py
 Comment: 
@@ -165,18 +165,18 @@
 
 Filename: mlrun/api/crud/feature_store.py
 Comment: 
 
 Filename: mlrun/api/crud/functions.py
 Comment: 
 
-Filename: mlrun/api/crud/logs.py
+Filename: mlrun/api/crud/hub.py
 Comment: 
 
-Filename: mlrun/api/crud/marketplace.py
+Filename: mlrun/api/crud/logs.py
 Comment: 
 
 Filename: mlrun/api/crud/notifications.py
 Comment: 
 
 Filename: mlrun/api/crud/pipelines.py
 Comment: 
@@ -201,14 +201,26 @@
 
 Filename: mlrun/api/crud/model_monitoring/grafana.py
 Comment: 
 
 Filename: mlrun/api/crud/model_monitoring/model_endpoints.py
 Comment: 
 
+Filename: mlrun/api/crud/runtimes/__init__.py
+Comment: 
+
+Filename: mlrun/api/crud/runtimes/nuclio/__init__.py
+Comment: 
+
+Filename: mlrun/api/crud/runtimes/nuclio/function.py
+Comment: 
+
+Filename: mlrun/api/crud/runtimes/nuclio/helpers.py
+Comment: 
+
 Filename: mlrun/api/db/__init__.py
 Comment: 
 
 Filename: mlrun/api/db/base.py
 Comment: 
 
 Filename: mlrun/api/db/init_db.py
@@ -237,14 +249,17 @@
 
 Filename: mlrun/api/db/sqldb/models/models_sqlite.py
 Comment: 
 
 Filename: mlrun/api/migrations_mysql/env.py
 Comment: 
 
+Filename: mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py
+Comment: 
+
 Filename: mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
 Comment: 
 
 Filename: mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
 Comment: 
 
 Filename: mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
@@ -276,14 +291,17 @@
 
 Filename: mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
 Comment: 
 
 Filename: mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
 Comment: 
 
+Filename: mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py
+Comment: 
+
 Filename: mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
 Comment: 
 
 Filename: mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
 Comment: 
 
 Filename: mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
@@ -324,80 +342,14 @@
 
 Filename: mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
 Comment: 
 
 Filename: mlrun/api/schemas/__init__.py
 Comment: 
 
-Filename: mlrun/api/schemas/artifact.py
-Comment: 
-
-Filename: mlrun/api/schemas/auth.py
-Comment: 
-
-Filename: mlrun/api/schemas/background_task.py
-Comment: 
-
-Filename: mlrun/api/schemas/client_spec.py
-Comment: 
-
-Filename: mlrun/api/schemas/clusterization_spec.py
-Comment: 
-
-Filename: mlrun/api/schemas/constants.py
-Comment: 
-
-Filename: mlrun/api/schemas/feature_store.py
-Comment: 
-
-Filename: mlrun/api/schemas/frontend_spec.py
-Comment: 
-
-Filename: mlrun/api/schemas/function.py
-Comment: 
-
-Filename: mlrun/api/schemas/http.py
-Comment: 
-
-Filename: mlrun/api/schemas/k8s.py
-Comment: 
-
-Filename: mlrun/api/schemas/marketplace.py
-Comment: 
-
-Filename: mlrun/api/schemas/memory_reports.py
-Comment: 
-
-Filename: mlrun/api/schemas/model_endpoints.py
-Comment: 
-
-Filename: mlrun/api/schemas/notification.py
-Comment: 
-
-Filename: mlrun/api/schemas/object.py
-Comment: 
-
-Filename: mlrun/api/schemas/pipeline.py
-Comment: 
-
-Filename: mlrun/api/schemas/project.py
-Comment: 
-
-Filename: mlrun/api/schemas/runtime_resource.py
-Comment: 
-
-Filename: mlrun/api/schemas/schedule.py
-Comment: 
-
-Filename: mlrun/api/schemas/secret.py
-Comment: 
-
-Filename: mlrun/api/schemas/tag.py
-Comment: 
-
 Filename: mlrun/api/utils/__init__.py
 Comment: 
 
 Filename: mlrun/api/utils/asyncio.py
 Comment: 
 
 Filename: mlrun/api/utils/background_tasks.py
@@ -531,14 +483,92 @@
 
 Filename: mlrun/artifacts/model.py
 Comment: 
 
 Filename: mlrun/artifacts/plots.py
 Comment: 
 
+Filename: mlrun/common/__init__.py
+Comment: 
+
+Filename: mlrun/common/model_monitoring.py
+Comment: 
+
+Filename: mlrun/common/types.py
+Comment: 
+
+Filename: mlrun/common/schemas/__init__.py
+Comment: 
+
+Filename: mlrun/common/schemas/artifact.py
+Comment: 
+
+Filename: mlrun/common/schemas/auth.py
+Comment: 
+
+Filename: mlrun/common/schemas/background_task.py
+Comment: 
+
+Filename: mlrun/common/schemas/client_spec.py
+Comment: 
+
+Filename: mlrun/common/schemas/clusterization_spec.py
+Comment: 
+
+Filename: mlrun/common/schemas/constants.py
+Comment: 
+
+Filename: mlrun/common/schemas/feature_store.py
+Comment: 
+
+Filename: mlrun/common/schemas/frontend_spec.py
+Comment: 
+
+Filename: mlrun/common/schemas/function.py
+Comment: 
+
+Filename: mlrun/common/schemas/http.py
+Comment: 
+
+Filename: mlrun/common/schemas/hub.py
+Comment: 
+
+Filename: mlrun/common/schemas/k8s.py
+Comment: 
+
+Filename: mlrun/common/schemas/memory_reports.py
+Comment: 
+
+Filename: mlrun/common/schemas/model_endpoints.py
+Comment: 
+
+Filename: mlrun/common/schemas/notification.py
+Comment: 
+
+Filename: mlrun/common/schemas/object.py
+Comment: 
+
+Filename: mlrun/common/schemas/pipeline.py
+Comment: 
+
+Filename: mlrun/common/schemas/project.py
+Comment: 
+
+Filename: mlrun/common/schemas/runtime_resource.py
+Comment: 
+
+Filename: mlrun/common/schemas/schedule.py
+Comment: 
+
+Filename: mlrun/common/schemas/secret.py
+Comment: 
+
+Filename: mlrun/common/schemas/tag.py
+Comment: 
+
 Filename: mlrun/data_types/__init__.py
 Comment: 
 
 Filename: mlrun/data_types/data_types.py
 Comment: 
 
 Filename: mlrun/data_types/infer.py
@@ -918,20 +948,14 @@
 
 Filename: mlrun/mlutils/plots.py
 Comment: 
 
 Filename: mlrun/model_monitoring/__init__.py
 Comment: 
 
-Filename: mlrun/model_monitoring/common.py
-Comment: 
-
-Filename: mlrun/model_monitoring/constants.py
-Comment: 
-
 Filename: mlrun/model_monitoring/features_drift_table.py
 Comment: 
 
 Filename: mlrun/model_monitoring/helpers.py
 Comment: 
 
 Filename: mlrun/model_monitoring/model_endpoint.py
@@ -1158,26 +1182,26 @@
 
 Filename: mlrun/utils/version/version.json
 Comment: 
 
 Filename: mlrun/utils/version/version.py
 Comment: 
 
-Filename: mlrun-1.4.0rc2.dist-info/LICENSE
+Filename: mlrun-1.4.0rc3.dist-info/LICENSE
 Comment: 
 
-Filename: mlrun-1.4.0rc2.dist-info/METADATA
+Filename: mlrun-1.4.0rc3.dist-info/METADATA
 Comment: 
 
-Filename: mlrun-1.4.0rc2.dist-info/WHEEL
+Filename: mlrun-1.4.0rc3.dist-info/WHEEL
 Comment: 
 
-Filename: mlrun-1.4.0rc2.dist-info/entry_points.txt
+Filename: mlrun-1.4.0rc3.dist-info/entry_points.txt
 Comment: 
 
-Filename: mlrun-1.4.0rc2.dist-info/top_level.txt
+Filename: mlrun-1.4.0rc3.dist-info/top_level.txt
 Comment: 
 
-Filename: mlrun-1.4.0rc2.dist-info/RECORD
+Filename: mlrun-1.4.0rc3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mlrun/__main__.py

```diff
@@ -34,15 +34,14 @@
 
 import mlrun
 
 from .builder import upload_tarball
 from .config import config as mlconf
 from .db import get_run_db
 from .errors import err_to_str
-from .k8s_utils import K8sHelper
 from .model import RunTemplate
 from .platforms import auto_mount as auto_mount_modifier
 from .projects import load_project
 from .run import (
     get_object,
     import_function,
     import_function_to_dict,
@@ -697,28 +696,14 @@
     with open("/tmp/output", "w") as fp:
         fp.write(addr)
     with open("/tmp/name", "w") as fp:
         fp.write(function.status.nuclio_name)
 
 
 @main.command(context_settings=dict(ignore_unknown_options=True))
-@click.argument("pod", type=str, callback=validate_base_argument)
-@click.option("--namespace", "-n", help="kubernetes namespace")
-@click.option(
-    "--timeout", "-t", default=600, show_default=True, help="timeout in seconds"
-)
-def watch(pod, namespace, timeout):
-    """Read current or previous task (pod) logs."""
-    print("This command will be deprecated in future version !!!\n")
-    k8s = K8sHelper(namespace)
-    status = k8s.watch(pod, namespace, timeout)
-    print(f"Pod {pod} last status is: {status}")
-
-
-@main.command(context_settings=dict(ignore_unknown_options=True))
 @click.argument("kind", type=str, callback=validate_base_argument)
 @click.argument(
     "name",
     type=str,
     default="",
     required=False,
     callback=validate_base_argument,
@@ -1495,13 +1480,13 @@
     run_id: str, project: mlrun.projects.MlrunProject, error: KeyError
 ):
     message = (
         f":x: Failed to run scheduled workflow {run_id} in Project {project.name} !\n"
         f"error: ```{err_to_str(error)}```"
     )
     project.notifiers.push(
-        message=message, severity=mlrun.api.schemas.NotificationSeverity.ERROR
+        message=message, severity=mlrun.common.schemas.NotificationSeverity.ERROR
     )
 
 
 if __name__ == "__main__":
     main()
```

## mlrun/builder.py

```diff
@@ -18,21 +18,21 @@
 import tempfile
 from base64 import b64decode, b64encode
 from os import path
 from urllib.parse import urlparse
 
 from kubernetes import client
 
-import mlrun.api.schemas
+import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.runtimes.utils
 
 from .config import config
 from .datastore import store_manager
-from .k8s_utils import BasePod, get_k8s_helper
 from .utils import enrich_image_url, get_parsed_docker_registry, logger, normalize_name
 
 IMAGE_NAME_ENRICH_REGISTRY_PREFIX = "."
 
 
 def make_dockerfile(
     base_image: str,
@@ -158,15 +158,15 @@
         "requests", with_gpu=False
     )
     resources = {
         "requests": mlrun.runtimes.utils.generate_resources(
             mem=default_requests.get("memory"), cpu=default_requests.get("cpu")
         )
     }
-    kpod = BasePod(
+    kpod = mlrun.api.utils.singletons.k8s.BasePod(
         name or "mlrun-build",
         config.httpdb.builder.kaniko_image,
         args=args,
         kind="build",
         project=project,
         default_pod_spec_attributes=extra_runtime_spec,
         resources=resources,
@@ -311,15 +311,15 @@
             tar.add(source_dir, arcname="")
         stores = store_manager.set(secrets)
         datastore, subpath = stores.get_or_create_store(target)
         datastore.upload(subpath, temp_fh.name)
 
 
 def build_image(
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     project: str,
     image_target,
     commands=None,
     source="",
     base_image=None,
     requirements=None,
     inline_code=None,
@@ -405,15 +405,15 @@
         else:
             source_to_copy = source
 
     user_unix_id = None
     enriched_group_id = None
     if (
         mlrun.mlconf.function.spec.security_context.enrichment_mode
-        != mlrun.api.schemas.SecurityContextEnrichmentModes.disabled.value
+        != mlrun.common.schemas.SecurityContextEnrichmentModes.disabled.value
     ):
         from mlrun.api.api.utils import ensure_function_security_context
 
         ensure_function_security_context(runtime, auth_info)
         user_unix_id = runtime.spec.security_context.run_as_user
         enriched_group_id = runtime.spec.security_context.run_as_group
 
@@ -463,15 +463,15 @@
         kpod.mount_v3io(
             remote=source_dir_to_mount,
             mount_path="/context",
             access_key=access_key,
             user=username,
         )
 
-    k8s = get_k8s_helper()
+    k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False)
     kpod.namespace = k8s.resolve_namespace(namespace)
 
     if interactive:
         return k8s.run_job(kpod)
     else:
         pod, ns = k8s.create_pod(kpod)
         logger.info(f'started build, to watch build logs use "mlrun watch {pod} {ns}"')
@@ -530,29 +530,29 @@
         if pip_upgrade_regex.match(command):
             return None
 
     return f"python -m pip install --upgrade pip{config.httpdb.builder.pip_version}"
 
 
 def build_runtime(
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     runtime,
     with_mlrun=True,
     mlrun_version_specifier=None,
     skip_deployed=False,
     interactive=False,
     builder_env=None,
     client_version=None,
     client_python_version=None,
 ):
     build = runtime.spec.build
     namespace = runtime.metadata.namespace
     project = runtime.metadata.project
     if skip_deployed and runtime.is_deployed():
-        runtime.status.state = mlrun.api.schemas.FunctionState.ready
+        runtime.status.state = mlrun.common.schemas.FunctionState.ready
         return True
     if build.base_image:
         mlrun_images = [
             "mlrun/mlrun",
             "mlrun/ml-base",
             "mlrun/ml-models",
             "mlrun/ml-models-gpu",
@@ -575,15 +575,15 @@
                     mlrun.mlconf.function_defaults.image_by_kind.to_dict()[runtime.kind]
                 )
         if not runtime.spec.image:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "The deployment was not successful because no image was specified or there are missing build parameters"
                 " (commands/source)"
             )
-        runtime.status.state = mlrun.api.schemas.FunctionState.ready
+        runtime.status.state = mlrun.common.schemas.FunctionState.ready
         return True
 
     build.image = mlrun.runtimes.utils.resolve_function_image_name(runtime, build.image)
     runtime.status.state = ""
 
     inline = None  # noqa: F841
     if build.functionSourceCode:
@@ -625,39 +625,39 @@
         runtime=runtime,
     )
     runtime.status.build_pod = None
     if status == "skipped":
         # using enriched base image for the runtime spec image, because this will be the image that the function will
         # run with
         runtime.spec.image = enriched_base_image
-        runtime.status.state = mlrun.api.schemas.FunctionState.ready
+        runtime.status.state = mlrun.common.schemas.FunctionState.ready
         return True
 
     if status.startswith("build:"):
-        runtime.status.state = mlrun.api.schemas.FunctionState.deploying
+        runtime.status.state = mlrun.common.schemas.FunctionState.deploying
         runtime.status.build_pod = status[6:]
         # using the base_image, and not the enriched one so we won't have the client version in the image, useful for
         # exports and other cases where we don't want to have the client version in the image, but rather enriched on
         # API level
         runtime.spec.build.base_image = base_image
         return False
 
     logger.info(f"build completed with {status}")
     if status in ["failed", "error"]:
-        runtime.status.state = mlrun.api.schemas.FunctionState.error
+        runtime.status.state = mlrun.common.schemas.FunctionState.error
         return False
 
     local = "" if build.secret or build.image.startswith(".") else "."
     runtime.spec.image = local + build.image
-    runtime.status.state = mlrun.api.schemas.FunctionState.ready
+    runtime.status.state = mlrun.common.schemas.FunctionState.ready
     return True
 
 
 def _generate_builder_env(project, builder_env):
-    k8s = get_k8s_helper()
+    k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False)
     secret_name = k8s.get_project_secret_name(project)
     existing_secret_keys = k8s.get_project_secret_keys(project, filter_internal=True)
 
     # generate env list from builder env and project secrets
     env = []
     for key in existing_secret_keys:
         if key not in builder_env:
```

## mlrun/config.py

```diff
@@ -151,15 +151,15 @@
     "function": {
         "spec": {
             "image_pull_secret": {"default": None},
             "security_context": {
                 # default security context to be applied to all functions - json string base64 encoded format
                 # in camelCase format: {"runAsUser": 1000, "runAsGroup": 3000}
                 "default": "e30=",  # encoded empty dict
-                # see mlrun.api.schemas.function.SecurityContextEnrichmentModes for available options
+                # see mlrun.common.schemas.function.SecurityContextEnrichmentModes for available options
                 "enrichment_mode": "disabled",
                 # default 65534 (nogroup), set to -1 to use the user unix id or
                 # function.spec.security_context.pipelines.kfp_pod_user_unix_id for kfp pods
                 "enrichment_group_id": 65534,
                 "pipelines": {
                     # sets the user id to be used for kfp pods when enrichment mode is not disabled
                     "kfp_pod_user_unix_id": 5,
@@ -174,15 +174,15 @@
             "serving": "mlrun/mlrun",
             "nuclio": "mlrun/mlrun",
             "remote": "mlrun/mlrun",
             "dask": "mlrun/ml-base",
             "mpijob": "mlrun/ml-models",
         },
         # see enrich_function_preemption_spec for more info,
-        # and mlrun.api.schemas.function.PreemptionModes for available options
+        # and mlrun.common.schemas.function.PreemptionModes for available options
         "preemption_mode": "prevent",
     },
     "httpdb": {
         "clusterization": {
             # one of chief/worker
             "role": "chief",
             "chief": {
@@ -215,15 +215,15 @@
         "data_volume": "",
         "real_path": "",
         # comma delimited prefixes of paths allowed through the /files API (v3io & the real_path are always allowed).
         # These paths must be schemas (cannot be used for local files). For example "s3://mybucket,gcs://"
         "allowed_file_paths": "s3://,gcs://,gs://,az://",
         "db_type": "sqldb",
         "max_workers": 64,
-        # See mlrun.api.schemas.APIStates for options
+        # See mlrun.common.schemas.APIStates for options
         "state": "online",
         "retry_api_call_on_exception": "enabled",
         "http_connection_timeout_keep_alive": 11,
         "db": {
             "commit_retry_timeout": 30,
             "commit_retry_interval": 3,
             "conflict_retry_timeout": 15,
@@ -381,21 +381,30 @@
             # if set to true, will log a warning for trying to use run db functionality while in nop db mode
             "verbose": True,
         },
     },
     "model_endpoint_monitoring": {
         "serving_stream_args": {"shard_count": 1, "retention_period_hours": 24},
         "drift_thresholds": {"default": {"possible_drift": 0.5, "drift_detected": 0.7}},
+        # Store prefixes are used to handle model monitoring storing policies based on project and kind, such as events,
+        # stream, and endpoints.
         "store_prefixes": {
             "default": "v3io:///users/pipelines/{project}/model-endpoints/{kind}",
             "user_space": "v3io:///projects/{project}/model-endpoints/{kind}",
+            "stream": "",
         },
+        # Offline storage path can be either relative or a full path. This path is used for general offline data
+        # storage such as the parquet file which is generated from the monitoring stream function for the drift analysis
+        "offline_storage_path": "model-endpoints/{kind}",
+        # Default http path that points to the monitoring stream nuclio function. Will be used as a stream path
+        # when the user is working in CE environment and has not provided any stream path.
+        "default_http_sink": "http://nuclio-{project}-model-monitoring-stream.mlrun.svc.cluster.local:8080",
         "batch_processing_function_branch": "master",
         "parquet_batching_max_events": 10000,
-        # See mlrun.api.schemas.ModelEndpointStoreType for available options
+        # See mlrun.common.schemas.ModelEndpointStoreType for available options
         "store_type": "v3io-nosql",
         "endpoint_store_connection": "",
     },
     "secret_stores": {
         "vault": {
             # URLs to access Vault. For example, in a local env (Minikube on Mac) these would be:
             # http://docker.for.mac.localhost:8200
@@ -433,16 +442,16 @@
         "default_job_image": "mlrun/mlrun",
         "flush_interval": 300,
     },
     "ui": {
         "projects_prefix": "projects",  # The UI link prefix for projects
         "url": "",  # remote/external mlrun UI url (for hyperlinks)
     },
-    "marketplace": {
-        "k8s_secrets_project_name": "-marketplace-secrets",
+    "hub": {
+        "k8s_secrets_project_name": "-hub-secrets",
         "catalog_filename": "catalog.json",
         "default_source": {
             # Set false to avoid creating a global source (for example in a dark site)
             "create": True,
             "name": "mlrun_global_hub",
             "description": "MLRun global function hub",
             "url": "https://raw.githubusercontent.com/mlrun/marketplace/master",
@@ -933,14 +942,76 @@
             mock_nuclio = not mlrun.mlconf.is_nuclio_detected()
         return True if mock_nuclio and force_mock is None else force_mock
 
     def get_v3io_access_key(self):
         # Get v3io access key from the environment
         return os.environ.get("V3IO_ACCESS_KEY")
 
+    def get_model_monitoring_file_target_path(
+        self,
+        project: str = "",
+        kind: str = "",
+        target: str = "online",
+        artifact_path: str = None,
+    ) -> str:
+        """Get the full path from the configuration based on the provided project and kind.
+
+        :param project:        Project name.
+        :param kind:           Kind of target path (e.g. events, log_stream, endpoints, etc.)
+        :param target:         Can be either online or offline. If the target is online, then we try to get a specific
+                               path for the provided kind. If it doesn't exist, use the default path.
+                               If the target path is offline and the offline path is already a full path in the
+                               configuration, then the result will be that path as-is. If the offline path is a
+                               relative path, then the result will be based on the project artifact path and the offline
+                               relative path. If project artifact path wasn't provided, then we use MLRun artifact
+                               path instead.
+        :param artifact_path:  Optional artifact path that will be used as a relative path. If not provided, the
+                               relative artifact path will be taken from the global MLRun artifact path.
+
+        :return: Full configured path for the provided kind.
+        """
+
+        if target != "offline":
+            store_prefix_dict = (
+                mlrun.mlconf.model_endpoint_monitoring.store_prefixes.to_dict()
+            )
+            if store_prefix_dict.get(kind):
+                # Target exist in store prefix and has a valid string value
+                return store_prefix_dict[kind].format(project=project)
+            return mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default.format(
+                project=project, kind=kind
+            )
+
+        # Get the current offline path from the configuration
+        file_path = mlrun.mlconf.model_endpoint_monitoring.offline_storage_path.format(
+            project=project, kind=kind
+        )
+
+        # Absolute path
+        if any(value in file_path for value in ["://", ":///"]) or os.path.isabs(
+            file_path
+        ):
+            return file_path
+
+        # Relative path
+        else:
+            artifact_path = artifact_path or config.artifact_path
+            if artifact_path[-1] != "/":
+                artifact_path += "/"
+
+            return mlrun.utils.helpers.fill_artifact_path_template(
+                artifact_path=artifact_path + file_path, project=project
+            )
+
+    def is_ce_mode(self) -> bool:
+        # True if the setup is in CE environment
+        return isinstance(mlrun.mlconf.ce, mlrun.config.Config) and any(
+            ver in mlrun.mlconf.ce.mode for ver in ["lite", "full"]
+        )
+
 
 # Global configuration
 config = Config.from_dict(default_config)
 
 
 def _populate(skip_errors=False):
     """Populate configuration from config file (if exists in environment) and
@@ -990,29 +1061,40 @@
     config._cfg["_iguazio_api_url"] = config._cfg["iguazio_api_url"]
     del config._cfg["iguazio_api_url"]
 
     _validate_config(config)
 
 
 def _validate_config(config):
-    import mlrun.k8s_utils
-
     try:
         limits_gpu = config.default_function_pod_resources.limits.gpu
         requests_gpu = config.default_function_pod_resources.requests.gpu
-        mlrun.k8s_utils.verify_gpu_requests_and_limits(
+        _verify_gpu_requests_and_limits(
             requests_gpu=requests_gpu,
             limits_gpu=limits_gpu,
         )
     except AttributeError:
         pass
 
     config.verify_security_context_enrichment_mode_is_allowed()
 
 
+def _verify_gpu_requests_and_limits(requests_gpu: str = None, limits_gpu: str = None):
+    # https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/
+    if requests_gpu and not limits_gpu:
+        raise mlrun.errors.MLRunConflictError(
+            "You cannot specify GPU requests without specifying limits"
+        )
+    if requests_gpu and limits_gpu and requests_gpu != limits_gpu:
+        raise mlrun.errors.MLRunConflictError(
+            f"When specifying both GPU requests and limits these two values must be equal, "
+            f"requests_gpu={requests_gpu}, limits_gpu={limits_gpu}"
+        )
+
+
 def _convert_resources_to_str(config: dict = None):
     resources_types = ["cpu", "memory", "gpu"]
     resource_requirements = ["requests", "limits"]
     if not config.get("default_function_pod_resources"):
         return
     for requirement in resource_requirements:
         resource_requirement = config.get("default_function_pod_resources").get(
```

## mlrun/k8s_utils.py

```diff
@@ -7,799 +7,44 @@
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-import base64
-import hashlib
-import time
 import typing
-from datetime import datetime
-from sys import stdout
 
 import kubernetes.client
-from kubernetes import client, config
-from kubernetes.client.rest import ApiException
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.errors
 
 from .config import config as mlconfig
-from .errors import err_to_str
-from .platforms.iguazio import v3io_to_vol
-from .utils import logger
 
-_k8s = None
+_running_inside_kubernetes_cluster = None
 
 
-def get_k8s_helper(namespace=None, silent=False, log=False) -> "K8sHelper":
-    """
-    :param silent: set to true if you're calling this function from a code that might run from remotely (outside of a
-    k8s cluster)
-    :param log: sometimes we want to avoid logging when executing init_k8s_config
-    """
-    global _k8s
-    if not _k8s:
-        _k8s = K8sHelper(namespace, silent=silent, log=log)
-    return _k8s
-
-
-class SecretTypes:
-    opaque = "Opaque"
-    v3io_fuse = "v3io/fuse"
-
-
-class K8sHelper:
-    def __init__(self, namespace=None, config_file=None, silent=False, log=True):
-        self.namespace = namespace or mlconfig.namespace
-        self.config_file = config_file
-        self.running_inside_kubernetes_cluster = False
-        try:
-            self._init_k8s_config(log)
-            self.v1api = client.CoreV1Api()
-            self.crdapi = client.CustomObjectsApi()
-        except Exception:
-            if not silent:
-                raise
-
-    def resolve_namespace(self, namespace=None):
-        return namespace or self.namespace
-
-    def _init_k8s_config(self, log=True):
-        try:
-            config.load_incluster_config()
-            self.running_inside_kubernetes_cluster = True
-            if log:
-                logger.info("using in-cluster config.")
-        except Exception:
-            try:
-                config.load_kube_config(self.config_file)
-                if log:
-                    logger.info("using local kubernetes config.")
-            except Exception:
-                raise RuntimeError(
-                    "cannot find local kubernetes config file,"
-                    " place it in ~/.kube/config or specify it in "
-                    "KUBECONFIG env var"
-                )
-
-    def is_running_inside_kubernetes_cluster(self):
-        return self.running_inside_kubernetes_cluster
-
-    def list_pods(self, namespace=None, selector="", states=None):
-        try:
-            resp = self.v1api.list_namespaced_pod(
-                self.resolve_namespace(namespace), label_selector=selector
-            )
-        except ApiException as exc:
-            logger.error(f"failed to list pods: {err_to_str(exc)}")
-            raise exc
-
-        items = []
-        for i in resp.items:
-            if not states or i.status.phase in states:
-                items.append(i)
-        return items
-
-    def clean_pods(self, namespace=None, selector="", states=None):
-        if not selector and not states:
-            raise ValueError("labels selector or states list must be specified")
-        items = self.list_pods(namespace, selector, states)
-        for item in items:
-            self.delete_pod(item.metadata.name, item.metadata.namespace)
-
-    def create_pod(self, pod, max_retry=3, retry_interval=3):
-        if "pod" in dir(pod):
-            pod = pod.pod
-        pod.metadata.namespace = self.resolve_namespace(pod.metadata.namespace)
-
-        retry_count = 0
-        while True:
-            try:
-                resp = self.v1api.create_namespaced_pod(pod.metadata.namespace, pod)
-            except ApiException as exc:
-
-                if retry_count > max_retry:
-                    logger.error(
-                        "failed to create pod after max retries",
-                        retry_count=retry_count,
-                        exc=err_to_str(exc),
-                        pod=pod,
-                    )
-                    raise exc
-
-                logger.error("failed to create pod", exc=err_to_str(exc), pod=pod)
-
-                # known k8s issue, see https://github.com/kubernetes/kubernetes/issues/67761
-                if "gke-resource-quotas" in err_to_str(exc):
-                    logger.warning(
-                        "failed to create pod due to gke resource error, "
-                        f"sleeping {retry_interval} seconds and retrying"
-                    )
-                    retry_count += 1
-                    time.sleep(retry_interval)
-                    continue
-
-                raise exc
-            else:
-                logger.info(f"Pod {resp.metadata.name} created")
-                return resp.metadata.name, resp.metadata.namespace
-
-    def delete_pod(self, name, namespace=None):
-        try:
-            api_response = self.v1api.delete_namespaced_pod(
-                name,
-                self.resolve_namespace(namespace),
-                grace_period_seconds=0,
-                propagation_policy="Background",
-            )
-            return api_response
-        except ApiException as exc:
-            # ignore error if pod is already removed
-            if exc.status != 404:
-                logger.error(f"failed to delete pod: {err_to_str(exc)}", pod_name=name)
-                raise exc
-
-    def get_pod(self, name, namespace=None, raise_on_not_found=False):
-        try:
-            api_response = self.v1api.read_namespaced_pod(
-                name=name, namespace=self.resolve_namespace(namespace)
-            )
-            return api_response
-        except ApiException as exc:
-            if exc.status != 404:
-                logger.error(f"failed to get pod: {err_to_str(exc)}")
-                raise exc
-            else:
-                if raise_on_not_found:
-                    raise mlrun.errors.MLRunNotFoundError(f"Pod not found: {name}")
-            return None
-
-    def get_pod_status(self, name, namespace=None):
-        return self.get_pod(
-            name, namespace, raise_on_not_found=True
-        ).status.phase.lower()
-
-    def delete_crd(self, name, crd_group, crd_version, crd_plural, namespace=None):
-        try:
-            namespace = self.resolve_namespace(namespace)
-            self.crdapi.delete_namespaced_custom_object(
-                crd_group,
-                crd_version,
-                namespace,
-                crd_plural,
-                name,
-            )
-            logger.info(
-                "Deleted crd object",
-                crd_name=name,
-                namespace=namespace,
-            )
-        except ApiException as exc:
-
-            # ignore error if crd is already removed
-            if exc.status != 404:
-                logger.error(
-                    f"failed to delete crd: {err_to_str(exc)}",
-                    crd_name=name,
-                    crd_group=crd_group,
-                    crd_version=crd_version,
-                    crd_plural=crd_plural,
-                )
-                raise exc
-
-    def logs(self, name, namespace=None):
-        try:
-            resp = self.v1api.read_namespaced_pod_log(
-                name=name, namespace=self.resolve_namespace(namespace)
-            )
-        except ApiException as exc:
-            logger.error(f"failed to get pod logs: {err_to_str(exc)}")
-            raise exc
-
-        return resp
-
-    def run_job(self, pod, timeout=600):
-        pod_name, namespace = self.create_pod(pod)
-        if not pod_name:
-            logger.error("failed to create pod")
-            return "error"
-        return self.watch(pod_name, namespace, timeout)
-
-    def watch(self, pod_name, namespace=None, timeout=600, writer=None):
-        namespace = self.resolve_namespace(namespace)
-        start_time = datetime.now()
-        while True:
-            try:
-                pod = self.get_pod(pod_name, namespace)
-                if not pod:
-                    return "error"
-                status = pod.status.phase.lower()
-                if status in ["running", "completed", "succeeded"]:
-                    print("")
-                    break
-                if status == "failed":
-                    return "failed"
-                elapsed_time = (datetime.now() - start_time).seconds
-                if elapsed_time > timeout:
-                    return "timeout"
-                time.sleep(2)
-                stdout.write(".")
-                if status != "pending":
-                    logger.warning(f"pod state in loop is {status}")
-            except ApiException as exc:
-                logger.error(f"failed waiting for pod: {err_to_str(exc)}\n")
-                return "error"
-        outputs = self.v1api.read_namespaced_pod_log(
-            name=pod_name, namespace=namespace, follow=True, _preload_content=False
-        )
-        for out in outputs:
-            print(out.decode("utf-8"), end="")
-            if writer:
-                writer.write(out)
-
-        for i in range(5):
-            pod_state = self.get_pod(pod_name, namespace).status.phase.lower()
-            if pod_state != "running":
-                break
-            logger.warning("pod still running, waiting 2 sec")
-            time.sleep(2)
-
-        if pod_state == "failed":
-            logger.error("pod exited with error")
-        if writer:
-            writer.flush()
-        return pod_state
-
-    def create_cfgmap(self, name, data, namespace="", labels=None):
-        body = client.api_client.V1ConfigMap()
-        namespace = self.resolve_namespace(namespace)
-        body.data = data
-        if name.endswith("*"):
-            body.metadata = client.V1ObjectMeta(
-                generate_name=name[:-1], namespace=namespace, labels=labels
-            )
-        else:
-            body.metadata = client.V1ObjectMeta(
-                name=name, namespace=namespace, labels=labels
-            )
-        try:
-            resp = self.v1api.create_namespaced_config_map(namespace, body)
-        except ApiException as exc:
-            logger.error(f"failed to create configmap: {err_to_str(exc)}")
-            raise exc
-
-        logger.info(f"ConfigMap {resp.metadata.name} created")
-        return resp.metadata.name
-
-    def del_cfgmap(self, name, namespace=None):
-        try:
-            api_response = self.v1api.delete_namespaced_config_map(
-                name,
-                self.resolve_namespace(namespace),
-                grace_period_seconds=0,
-                propagation_policy="Background",
-            )
-
-            return api_response
-        except ApiException as exc:
-            # ignore error if ConfigMap is already removed
-            if exc.status != 404:
-                logger.error(f"failed to delete ConfigMap: {err_to_str(exc)}")
-            raise exc
-
-    def list_cfgmap(self, namespace=None, selector=""):
-        try:
-            resp = self.v1api.list_namespaced_config_map(
-                self.resolve_namespace(namespace), watch=False, label_selector=selector
-            )
-        except ApiException as exc:
-            logger.error(f"failed to list ConfigMaps: {err_to_str(exc)}")
-            raise exc
-
-        items = []
-        for i in resp.items:
-            items.append(i)
-        return items
-
-    def get_logger_pods(self, project, uid, run_kind, namespace=""):
-
-        # As this file is imported in mlrun.runtimes, we sadly cannot have this import in the top level imports
-        # as that will create an import loop.
-        # TODO: Fix the import loops already!
-        import mlrun.runtimes
-
-        namespace = self.resolve_namespace(namespace)
-        mpijob_crd_version = mlrun.runtimes.utils.resolve_mpijob_crd_version(
-            api_context=True
-        )
-        mpijob_role_label = (
-            mlrun.runtimes.constants.MPIJobCRDVersions.role_label_by_version(
-                mpijob_crd_version
-            )
-        )
-        extra_selectors = {
-            "spark": "spark-role=driver",
-            "mpijob": f"{mpijob_role_label}=launcher",
-        }
-
-        # TODO: all mlrun labels are sprinkled in a lot of places - they need to all be defined in a central,
-        #  inclusive place.
-        selectors = [
-            "mlrun/class",
-            f"mlrun/project={project}",
-            f"mlrun/uid={uid}",
-        ]
-
-        # In order to make the `list_pods` request return a lighter and quicker result, we narrow the search for
-        # the relevant pods using the proper label selector according to the run kind
-        if run_kind in extra_selectors:
-            selectors.append(extra_selectors[run_kind])
-
-        selector = ",".join(selectors)
-        pods = self.list_pods(namespace, selector=selector)
-        if not pods:
-            logger.error("no pod matches that uid", uid=uid)
-            return
-
-        return {p.metadata.name: p.status.phase for p in pods}
-
-    def create_project_service_account(self, project, service_account, namespace=""):
-        namespace = self.resolve_namespace(namespace)
-        k8s_service_account = client.V1ServiceAccount()
-        labels = {"mlrun/project": project}
-        k8s_service_account.metadata = client.V1ObjectMeta(
-            name=service_account, namespace=namespace, labels=labels
-        )
-        try:
-            api_response = self.v1api.create_namespaced_service_account(
-                namespace,
-                k8s_service_account,
-            )
-            return api_response
-        except ApiException as exc:
-            logger.error(f"failed to create service account: {err_to_str(exc)}")
-            raise exc
-
-    def get_project_vault_secret_name(
-        self, project, service_account_name, namespace=""
-    ):
-        namespace = self.resolve_namespace(namespace)
-
-        try:
-            service_account = self.v1api.read_namespaced_service_account(
-                service_account_name, namespace
-            )
-        except ApiException as exc:
-            # It's valid for the service account to not exist. Simply return None
-            if exc.status != 404:
-                logger.error(f"failed to retrieve service accounts: {err_to_str(exc)}")
-                raise exc
-            return None
-
-        if len(service_account.secrets) > 1:
-            raise ValueError(
-                f"Service account {service_account_name} has more than one secret"
-            )
-
-        return service_account.secrets[0].name
-
-    def get_project_secret_name(self, project) -> str:
-        return mlconfig.secret_stores.kubernetes.project_secret_name.format(
-            project=project
-        )
-
-    def get_auth_secret_name(self, access_key: str) -> str:
-        hashed_access_key = self._hash_access_key(access_key)
-        return mlconfig.secret_stores.kubernetes.auth_secret_name.format(
-            hashed_access_key=hashed_access_key
-        )
-
-    @staticmethod
-    def _hash_access_key(access_key: str):
-        return hashlib.sha224(access_key.encode()).hexdigest()
-
-    def store_project_secrets(self, project, secrets, namespace=""):
-        secret_name = self.get_project_secret_name(project)
-        self.store_secrets(secret_name, secrets, namespace)
-
-    def read_auth_secret(self, secret_name, namespace="", raise_on_not_found=False):
-        namespace = self.resolve_namespace(namespace)
-
-        try:
-            secret_data = self.v1api.read_namespaced_secret(secret_name, namespace).data
-        except ApiException as exc:
-            logger.error(
-                "Failed to read secret",
-                secret_name=secret_name,
-                namespace=namespace,
-                exc=err_to_str(exc),
-            )
-            if exc.status != 404:
-                raise exc
-            elif raise_on_not_found:
-                raise mlrun.errors.MLRunNotFoundError(
-                    f"Secret '{secret_name}' was not found in namespace '{namespace}'"
-                ) from exc
-
-            return None, None
-
-        def _get_secret_value(key):
-            if secret_data.get(key):
-                return base64.b64decode(secret_data[key]).decode("utf-8")
-            else:
-                return None
-
-        username = _get_secret_value(
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key("username")
-        )
-        access_key = _get_secret_value(
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key("access_key")
-        )
-
-        return username, access_key
-
-    def store_auth_secret(self, username: str, access_key: str, namespace="") -> str:
-        secret_name = self.get_auth_secret_name(access_key)
-        secret_data = {
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key("username"): username,
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key(
-                "access_key"
-            ): access_key,
-        }
-        self.store_secrets(
-            secret_name,
-            secret_data,
-            namespace,
-            type_=SecretTypes.v3io_fuse,
-            labels={"mlrun/username": username},
-        )
-        return secret_name
-
-    def store_secrets(
-        self,
-        secret_name,
-        secrets,
-        namespace="",
-        type_=SecretTypes.opaque,
-        labels: typing.Optional[dict] = None,
-    ):
-        namespace = self.resolve_namespace(namespace)
-        try:
-            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
-        except ApiException as exc:
-            # If secret doesn't exist, we'll simply create it
-            if exc.status != 404:
-                logger.error(f"failed to retrieve k8s secret: {err_to_str(exc)}")
-                raise exc
-            k8s_secret = client.V1Secret(type=type_)
-            k8s_secret.metadata = client.V1ObjectMeta(
-                name=secret_name, namespace=namespace, labels=labels
-            )
-            k8s_secret.string_data = secrets
-            self.v1api.create_namespaced_secret(namespace, k8s_secret)
-            return
-
-        secret_data = k8s_secret.data.copy()
-        for key, value in secrets.items():
-            secret_data[key] = base64.b64encode(value.encode()).decode("utf-8")
-
-        k8s_secret.data = secret_data
-        self.v1api.replace_namespaced_secret(secret_name, namespace, k8s_secret)
-
-    def load_secret(self, secret_name, namespace=""):
-        namespace = namespace or self.resolve_namespace(namespace)
-
-        try:
-            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
-        except ApiException:
-            return None
-
-        return k8s_secret.data
-
-    def delete_project_secrets(self, project, secrets, namespace=""):
-        secret_name = self.get_project_secret_name(project)
-        self.delete_secrets(secret_name, secrets, namespace)
-
-    def delete_auth_secret(self, secret_ref: str, namespace=""):
-        self.delete_secrets(secret_ref, {}, namespace)
-
-    def delete_secrets(self, secret_name, secrets, namespace=""):
-        namespace = self.resolve_namespace(namespace)
-
-        try:
-            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
-        except ApiException as exc:
-            # If secret does not exist, return as if the deletion was successfully
-            if exc.status == 404:
-                return
-            else:
-                logger.error(f"failed to retrieve k8s secret: {err_to_str(exc)}")
-                raise exc
-
-        if not secrets:
-            secret_data = {}
-        else:
-            secret_data = k8s_secret.data.copy()
-            for secret in secrets:
-                secret_data.pop(secret, None)
-
-        if not secret_data:
-            self.v1api.delete_namespaced_secret(secret_name, namespace)
-        else:
-            k8s_secret.data = secret_data
-            self.v1api.replace_namespaced_secret(secret_name, namespace, k8s_secret)
-
-    def _get_project_secrets_raw_data(self, project, namespace=""):
-        secret_name = self.get_project_secret_name(project)
-        return self._get_secret_raw_data(secret_name, namespace)
-
-    def _get_secret_raw_data(self, secret_name, namespace=""):
-        namespace = self.resolve_namespace(namespace)
-
-        try:
-            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
-        except ApiException:
-            return None
-
-        return k8s_secret.data
-
-    def get_project_secret_keys(self, project, namespace="", filter_internal=False):
-        secrets_data = self._get_project_secrets_raw_data(project, namespace)
-        if not secrets_data:
-            return []
-
-        secret_keys = list(secrets_data.keys())
-        if filter_internal:
-            secret_keys = list(
-                filter(lambda key: not key.startswith("mlrun."), secret_keys)
-            )
-        return secret_keys
-
-    def get_project_secret_data(self, project, secret_keys=None, namespace=""):
-        secrets_data = self._get_project_secrets_raw_data(project, namespace)
-        return self._decode_secret_data(secrets_data, secret_keys)
-
-    def get_secret_data(self, secret_name, namespace=""):
-        secrets_data = self._get_secret_raw_data(secret_name, namespace)
-        return self._decode_secret_data(secrets_data)
-
-    def _decode_secret_data(self, secrets_data, secret_keys=None):
-        results = {}
-        if not secrets_data:
-            return results
-
-        # If not asking for specific keys, return all
-        secret_keys = secret_keys or secrets_data.keys()
-
-        for key in secret_keys:
-            encoded_value = secrets_data.get(key)
-            if encoded_value:
-                results[key] = base64.b64decode(secrets_data[key]).decode("utf-8")
-        return results
-
-
-class BasePod:
-    def __init__(
-        self,
-        task_name="",
-        image=None,
-        command=None,
-        args=None,
-        namespace="",
-        kind="job",
-        project=None,
-        default_pod_spec_attributes=None,
-        resources=None,
-    ):
-        self.namespace = namespace
-        self.name = ""
-        self.task_name = task_name
-        self.image = image
-        self.command = command
-        self.args = args
-        self._volumes = []
-        self._mounts = []
-        self.env = None
-        self.node_selector = None
-        self.project = project or mlrun.mlconf.default_project
-        self._labels = {
-            "mlrun/task-name": task_name,
-            "mlrun/class": kind,
-            "mlrun/project": self.project,
-        }
-        self._annotations = {}
-        self._init_containers = []
-        # will be applied on the pod spec only when calling .pod(), allows to override spec attributes
-        self.default_pod_spec_attributes = default_pod_spec_attributes
-        self.resources = resources
-
-    @property
-    def pod(self):
-        return self._get_spec()
-
-    @property
-    def init_containers(self):
-        return self._init_containers
-
-    @init_containers.setter
-    def init_containers(self, containers):
-        self._init_containers = containers
-
-    def append_init_container(
-        self,
-        image,
-        command=None,
-        args=None,
-        env=None,
-        image_pull_policy="IfNotPresent",
-        name="init",
-    ):
-        if isinstance(env, dict):
-            env = [client.V1EnvVar(name=k, value=v) for k, v in env.items()]
-        self._init_containers.append(
-            client.V1Container(
-                name=name,
-                image=image,
-                env=env,
-                command=command,
-                args=args,
-                image_pull_policy=image_pull_policy,
-            )
-        )
-
-    def add_label(self, key, value):
-        self._labels[key] = str(value)
-
-    def add_annotation(self, key, value):
-        self._annotations[key] = str(value)
-
-    def add_volume(self, volume: client.V1Volume, mount_path, name=None, sub_path=None):
-        self._mounts.append(
-            client.V1VolumeMount(
-                name=name or volume.name, mount_path=mount_path, sub_path=sub_path
-            )
-        )
-        self._volumes.append(volume)
-
-    def mount_empty(self, name="empty", mount_path="/empty"):
-        self.add_volume(
-            client.V1Volume(name=name, empty_dir=client.V1EmptyDirVolumeSource()),
-            mount_path=mount_path,
-        )
-
-    def mount_v3io(
-        self, name="v3io", remote="~/", mount_path="/User", access_key="", user=""
-    ):
-        self.add_volume(
-            v3io_to_vol(name, remote, access_key, user),
-            mount_path=mount_path,
-            name=name,
-        )
-
-    def mount_cfgmap(self, name, path="/config"):
-        self.add_volume(
-            client.V1Volume(
-                name=name, config_map=client.V1ConfigMapVolumeSource(name=name)
-            ),
-            mount_path=path,
-        )
-
-    def mount_secret(self, name, path="/secret", items=None, sub_path=None):
-        self.add_volume(
-            client.V1Volume(
-                name=name,
-                secret=client.V1SecretVolumeSource(
-                    secret_name=name,
-                    items=items,
-                ),
-            ),
-            mount_path=path,
-            sub_path=sub_path,
-        )
-
-    def set_node_selector(self, node_selector: typing.Optional[typing.Dict[str, str]]):
-        self.node_selector = node_selector
-
-    def _get_spec(self, template=False):
-
-        pod_obj = client.V1PodTemplate if template else client.V1Pod
-
-        if self.env and isinstance(self.env, dict):
-            env = [client.V1EnvVar(name=k, value=v) for k, v in self.env.items()]
-        else:
-            env = self.env
-        container = client.V1Container(
-            name="base",
-            image=self.image,
-            env=env,
-            command=self.command,
-            args=self.args,
-            volume_mounts=self._mounts,
-            resources=self.resources,
-        )
-
-        pod_spec = client.V1PodSpec(
-            containers=[container],
-            restart_policy="Never",
-            volumes=self._volumes,
-            node_selector=self.node_selector,
-        )
-
-        # if attribute isn't defined use default pod spec attributes
-        for key, val in self.default_pod_spec_attributes.items():
-            if not getattr(pod_spec, key, None):
-                setattr(pod_spec, key, val)
-
-        for init_containers in self._init_containers:
-            init_containers.volume_mounts = self._mounts
-        pod_spec.init_containers = self._init_containers
-
-        pod = pod_obj(
-            metadata=client.V1ObjectMeta(
-                generate_name=f"{self.task_name}-",
-                namespace=self.namespace,
-                labels=self._labels,
-                annotations=self._annotations,
-            ),
-            spec=pod_spec,
-        )
-        return pod
-
-
-def format_labels(labels):
-    """Convert a dictionary of labels into a comma separated string"""
-    if labels:
-        return ",".join([f"{k}={v}" for k, v in labels.items()])
-    else:
-        return ""
-
-
-def verify_gpu_requests_and_limits(requests_gpu: str = None, limits_gpu: str = None):
-    # https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/
-    if requests_gpu and not limits_gpu:
-        raise mlrun.errors.MLRunConflictError(
-            "You cannot specify GPU requests without specifying limits"
-        )
-    if requests_gpu and limits_gpu and requests_gpu != limits_gpu:
-        raise mlrun.errors.MLRunConflictError(
-            f"When specifying both GPU requests and limits these two values must be equal, "
-            f"requests_gpu={requests_gpu}, limits_gpu={limits_gpu}"
-        )
+def is_running_inside_kubernetes_cluster():
+    global _running_inside_kubernetes_cluster
+    if _running_inside_kubernetes_cluster is not None:
+        try:
+            kubernetes.config.load_incluster_config()
+            _running_inside_kubernetes_cluster = True
+        except kubernetes.config.ConfigException:
+            _running_inside_kubernetes_cluster = False
+    return _running_inside_kubernetes_cluster
 
 
 def generate_preemptible_node_selector_requirements(
     node_selector_operator: str,
 ) -> typing.List[kubernetes.client.V1NodeSelectorRequirement]:
     """
     Generate node selector requirements based on the pre-configured node selector of the preemptible nodes.
     node selector operator represents a key's relationship to a set of values.
-    Valid operators are listed in :py:class:`~mlrun.api.schemas.NodeSelectorOperator`
+    Valid operators are listed in :py:class:`~mlrun.common.schemas.NodeSelectorOperator`
     :param node_selector_operator: The operator of V1NodeSelectorRequirement
     :return: List[V1NodeSelectorRequirement]
     """
     match_expressions = []
     for (
         node_selector_key,
         node_selector_value,
@@ -821,20 +66,17 @@
     Generate node selector term containing anti-affinity expressions based on the
     pre-configured node selector of the preemptible nodes.
     Use for purpose of scheduling on node only if all match_expressions are satisfied.
     This function uses a single term with potentially multiple expressions to ensure anti affinity.
     https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity
     :return: List contains one nodeSelectorTerm with multiple expressions.
     """
-    # import here to avoid circular imports
-    from mlrun.api.schemas import NodeSelectorOperator
-
     # compile affinities with operator NotIn to make sure pods are not running on preemptible nodes.
     node_selector_requirements = generate_preemptible_node_selector_requirements(
-        NodeSelectorOperator.node_selector_op_not_in.value
+        mlrun.common.schemas.NodeSelectorOperator.node_selector_op_not_in.value
     )
     return [
         kubernetes.client.V1NodeSelectorTerm(
             match_expressions=node_selector_requirements,
         )
     ]
 
@@ -844,22 +86,19 @@
 ]:
     """
     Use for purpose of scheduling on node having at least one of the node selectors.
     When specifying multiple nodeSelectorTerms associated with nodeAffinity types,
     then the pod can be scheduled onto a node if at least one of the nodeSelectorTerms can be satisfied.
     :return: List of nodeSelectorTerms associated with the preemptible nodes.
     """
-    # import here to avoid circular imports
-    from mlrun.api.schemas import NodeSelectorOperator
-
     node_selector_terms = []
 
     # compile affinities with operator In so pods could schedule on at least one of the preemptible nodes.
     node_selector_requirements = generate_preemptible_node_selector_requirements(
-        NodeSelectorOperator.node_selector_op_in.value
+        mlrun.common.schemas.NodeSelectorOperator.node_selector_op_in.value
     )
     for expression in node_selector_requirements:
         node_selector_terms.append(
             kubernetes.client.V1NodeSelectorTerm(match_expressions=[expression])
         )
     return node_selector_terms
```

## mlrun/model.py

```diff
@@ -367,16 +367,16 @@
         if source and not (
             source.startswith("git://")
             # lenient check for file extension because we support many file types locally and remotely
             or pathlib.Path(source).suffix
             or source in [".", "./"]
         ):
             raise mlrun.errors.MLRunInvalidArgumentError(
-                "source must be a compressed (tar.gz / zip) file, a git repo, "
-                "a file path or in the project's context (.)"
+                f"source ({source}) must be a compressed (tar.gz / zip) file, a git repo, "
+                f"a file path or in the project's context (.)"
             )
 
         self._source = source
 
 
 class Notification(ModelObj):
     """Notification specification"""
```

## mlrun/run.py

```diff
@@ -32,15 +32,15 @@
 from typing import Callable, Dict, List, Optional, Tuple, Type, Union
 
 import nuclio
 import yaml
 from deprecated import deprecated
 from kfp import Client
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 from mlrun.kfpops import format_summary_from_kfp_run, show_kfp_run
 
 from .config import config as mlconf
 from .datastore import store_manager
 from .db import get_or_set_dburl, get_run_db
@@ -1191,16 +1191,16 @@
     return resp
 
 
 def get_pipeline(
     run_id,
     namespace=None,
     format_: Union[
-        str, mlrun.api.schemas.PipelinesFormat
-    ] = mlrun.api.schemas.PipelinesFormat.summary,
+        str, mlrun.common.schemas.PipelinesFormat
+    ] = mlrun.common.schemas.PipelinesFormat.summary,
     project: str = None,
     remote: bool = True,
 ):
     """Get Pipeline status
 
     :param run_id:     id of pipelines run
     :param namespace:  k8s namespace if not default
@@ -1228,15 +1228,15 @@
     else:
         client = Client(namespace=namespace)
         resp = client.get_run(run_id)
         if resp:
             resp = resp.to_dict()
             if (
                 not format_
-                or format_ == mlrun.api.schemas.PipelinesFormat.summary.value
+                or format_ == mlrun.common.schemas.PipelinesFormat.summary.value
             ):
                 resp = format_summary_from_kfp_run(resp)
 
     show_kfp_run(resp)
     return resp
 
 
@@ -1244,15 +1244,15 @@
     full=False,
     page_token="",
     page_size=None,
     sort_by="",
     filter_="",
     namespace=None,
     project="*",
-    format_: mlrun.api.schemas.PipelinesFormat = mlrun.api.schemas.PipelinesFormat.metadata_only,
+    format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
 ) -> Tuple[int, Optional[int], List[dict]]:
     """List pipelines
 
     :param full:       Deprecated, use `format_` instead. if True will set `format_` to full, otherwise `format_` will
                        be used
     :param page_token: A page token to request the next page of results. The token is acquired from the nextPageToken
                        field of the response from the previous call or can be omitted when fetching the first page.
@@ -1264,15 +1264,15 @@
                        [filter.proto](https://github.com/kubeflow/pipelines/ blob/master/backend/api/filter.proto).
     :param namespace:  Kubernetes namespace if other than default
     :param project:    Can be used to retrieve only specific project pipelines. "*" for all projects. Note that
                        filtering by project can't be used together with pagination, sorting, or custom filter.
     :param format_:    Control what will be returned (full/metadata_only/name_only)
     """
     if full:
-        format_ = mlrun.api.schemas.PipelinesFormat.full
+        format_ = mlrun.common.schemas.PipelinesFormat.full
     run_db = mlrun.db.get_run_db()
     pipelines = run_db.list_pipelines(
         project, namespace, sort_by, page_token, filter_, format_, page_size
     )
     return pipelines.total_size, pipelines.next_page_token, pipelines.runs
```

## mlrun/secrets.py

```diff
@@ -12,25 +12,24 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 from ast import literal_eval
 from os import environ, getenv
 from typing import Callable, Dict, Optional, Union
 
-from .utils import AzureVaultStore, VaultStore, list2dict
+from .utils import AzureVaultStore, list2dict
 
 
 class SecretsStore:
     def __init__(self):
         self._secrets = {}
         # Hidden secrets' value must not be serialized. Only the keys can be. These secrets are retrieved externally,
         # for example from Vault, and when adding their source they will be retrieved from the external source.
         self._hidden_sources = []
         self._hidden_secrets = {}
-        self.vault = VaultStore()
 
     @classmethod
     def from_list(cls, src_list: list):
         store = cls()
         if src_list and isinstance(src_list, list):
             for src in src_list:
                 store.add_source(src["kind"], src.get("source"), src.get("prefix", ""))
@@ -56,29 +55,28 @@
                 for k, v in secrets_dict.items():
                     self._secrets[prefix + k] = str(v)
 
         elif kind == "env":
             for key in source.split(","):
                 k = key.strip()
                 self._secrets[prefix + k] = environ.get(k)
-
-        elif kind == "vault":
-            if isinstance(source, str):
-                source = literal_eval(source)
-            if not isinstance(source, dict):
-                raise ValueError("vault secrets must be of type dict")
-
-            for key, value in self.vault.get_secrets(
-                source["secrets"],
-                user=source.get("user"),
-                project=source.get("project"),
-            ).items():
-                self._hidden_secrets[prefix + key] = value
-            self._hidden_sources.append({"kind": kind, "source": source})
-
+        # TODO: Vault: uncomment when vault returns to be relevant
+        # elif kind == "vault":
+        #     if isinstance(source, str):
+        #         source = literal_eval(source)
+        #     if not isinstance(source, dict):
+        #         raise ValueError("vault secrets must be of type dict")
+        #
+        #     for key, value in self.vault.get_secrets(
+        #         source["secrets"],
+        #         user=source.get("user"),
+        #         project=source.get("project"),
+        #     ).items():
+        #         self._hidden_secrets[prefix + key] = value
+        #     self._hidden_sources.append({"kind": kind, "source": source})
         elif kind == "azure_vault":
             if isinstance(source, str):
                 source = literal_eval(source)
             if not isinstance(source, dict):
                 raise ValueError("Azure vault secrets must be of type dict")
             if "name" not in source:
                 raise ValueError(
```

## mlrun/api/initial_data.py

```diff
@@ -22,20 +22,20 @@
 import pymysql.err
 import sqlalchemy.exc
 import sqlalchemy.orm
 
 import mlrun.api.db.sqldb.db
 import mlrun.api.db.sqldb.helpers
 import mlrun.api.db.sqldb.models
-import mlrun.api.schemas
 import mlrun.api.utils.db.alembic
 import mlrun.api.utils.db.backup
 import mlrun.api.utils.db.mysql
 import mlrun.api.utils.db.sqlite_migration
 import mlrun.artifacts
+import mlrun.common.schemas
 from mlrun.api.db.init_db import init_db
 from mlrun.api.db.session import close_session, create_session
 from mlrun.config import config
 from mlrun.errors import err_to_str
 from mlrun.utils import is_legacy_artifact, logger
 
 
@@ -58,26 +58,26 @@
     ) = _resolve_needed_operations(alembic_util, sqlite_migration_util, from_scratch)
 
     if (
         not is_migration_from_scratch
         and not perform_migrations_if_needed
         and is_migration_needed
     ):
-        state = mlrun.api.schemas.APIStates.waiting_for_migrations
+        state = mlrun.common.schemas.APIStates.waiting_for_migrations
         logger.info("Migration is needed, changing API state", state=state)
         config.httpdb.state = state
         return
 
     if is_backup_needed:
         logger.info("DB Backup is needed, backing up...")
         db_backup = mlrun.api.utils.db.backup.DBBackupUtil()
         db_backup.backup_database()
 
     logger.info("Creating initial data")
-    config.httpdb.state = mlrun.api.schemas.APIStates.migrations_in_progress
+    config.httpdb.state = mlrun.common.schemas.APIStates.migrations_in_progress
 
     if is_migration_from_scratch or is_migration_needed:
         try:
             _perform_schema_migrations(alembic_util)
 
             _perform_database_migration(sqlite_migration_util)
 
@@ -85,25 +85,25 @@
             try:
                 init_db(db_session)
                 _add_initial_data(db_session)
                 _perform_data_migrations(db_session)
             finally:
                 close_session(db_session)
         except Exception:
-            state = mlrun.api.schemas.APIStates.migrations_failed
+            state = mlrun.common.schemas.APIStates.migrations_failed
             logger.warning("Migrations failed, changing API state", state=state)
             config.httpdb.state = state
             raise
     # if the above process actually ran a migration - initializations that were skipped on the API initialization
     # should happen - we can't do it here because it requires an asyncio loop which can't be accessible here
     # therefore moving to migration_completed state, and other component will take care of moving to online
     if not is_migration_from_scratch and is_migration_needed:
-        config.httpdb.state = mlrun.api.schemas.APIStates.migrations_completed
+        config.httpdb.state = mlrun.common.schemas.APIStates.migrations_completed
     else:
-        config.httpdb.state = mlrun.api.schemas.APIStates.online
+        config.httpdb.state = mlrun.common.schemas.APIStates.online
     logger.info("Initial data created")
 
 
 # If the data_table version doesn't exist, we can assume the data version is 1.
 # This is because data version 1 points to to a data migration which was added back in 0.6.0, and
 # upgrading from a version earlier than 0.6.0 to v>=0.8.0 is not supported.
 data_version_prior_to_table_addition = 1
@@ -214,15 +214,15 @@
                 _perform_version_2_data_migrations(db, db_session)
             db.create_data_version(db_session, str(latest_data_version))
 
 
 def _add_initial_data(db_session: sqlalchemy.orm.Session):
     # FileDB is not really a thing anymore, so using SQLDB directly
     db = mlrun.api.db.sqldb.db.SQLDB("")
-    _add_default_marketplace_source_if_needed(db, db_session)
+    _add_default_hub_source_if_needed(db, db_session)
     _add_data_version(db, db_session)
 
 
 def _fix_datasets_large_previews(
     db: mlrun.api.db.sqldb.db.SQLDB,
     db_session: sqlalchemy.orm.Session,
 ):
@@ -478,52 +478,52 @@
 ):
     logger.info("Enriching projects state")
     projects = db.list_projects(db_session)
     for project in projects.projects:
         changed = False
         if not project.spec.desired_state:
             changed = True
-            project.spec.desired_state = mlrun.api.schemas.ProjectState.online
+            project.spec.desired_state = mlrun.common.schemas.ProjectState.online
         if not project.status.state:
             changed = True
             project.status.state = project.spec.desired_state
         if changed:
             logger.debug(
                 "Found project without state data. Enriching",
                 name=project.metadata.name,
             )
             db.store_project(db_session, project.metadata.name, project)
 
 
-def _add_default_marketplace_source_if_needed(
+def _add_default_hub_source_if_needed(
     db: mlrun.api.db.sqldb.db.SQLDB, db_session: sqlalchemy.orm.Session
 ):
     try:
-        hub_marketplace_source = db.get_marketplace_source(
-            db_session, config.marketplace.default_source.name
+        hub_marketplace_source = db.get_hub_source(
+            db_session, config.hub.default_source.name
         )
     except mlrun.errors.MLRunNotFoundError:
         hub_marketplace_source = None
 
     if not hub_marketplace_source:
-        hub_source = mlrun.api.schemas.MarketplaceSource.generate_default_source()
-        # hub_source will be None if the configuration has marketplace.default_source.create=False
+        hub_source = mlrun.common.schemas.HubSource.generate_default_source()
+        # hub_source will be None if the configuration has hub.default_source.create=False
         if hub_source:
-            logger.info("Adding default marketplace source")
-            # Not using db.store_marketplace_source() since it doesn't allow changing the default marketplace source.
-            hub_record = db._transform_marketplace_source_schema_to_record(
-                mlrun.api.schemas.IndexedMarketplaceSource(
-                    index=mlrun.api.schemas.marketplace.last_source_index,
+            logger.info("Adding default hub source")
+            # Not using db.store_marketplace_source() since it doesn't allow changing the default hub source.
+            hub_record = db._transform_hub_source_schema_to_record(
+                mlrun.common.schemas.IndexedHubSource(
+                    index=mlrun.common.schemas.hub.last_source_index,
                     source=hub_source,
                 )
             )
             db_session.add(hub_record)
             db_session.commit()
         else:
-            logger.info("Not adding default marketplace source, per configuration")
+            logger.info("Not adding default hub source, per configuration")
     return
 
 
 def _add_data_version(
     db: mlrun.api.db.sqldb.db.SQLDB, db_session: sqlalchemy.orm.Session
 ):
     if db.get_current_data_version(db_session, raise_on_not_found=False) is None:
```

## mlrun/api/main.py

```diff
@@ -21,17 +21,17 @@
 import fastapi
 import fastapi.concurrency
 import sqlalchemy.orm
 import uvicorn
 from fastapi.exception_handlers import http_exception_handler
 
 import mlrun.api.db.base
-import mlrun.api.schemas
 import mlrun.api.utils.clients.chief
 import mlrun.api.utils.clients.log_collector
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.lists
 import mlrun.utils
 import mlrun.utils.notifications
 import mlrun.utils.version
 from mlrun.api.api.api import api_router
 from mlrun.api.db.session import close_session, create_session
@@ -39,23 +39,23 @@
 from mlrun.api.middlewares import init_middlewares
 from mlrun.api.utils.periodic import (
     cancel_all_periodic_functions,
     cancel_periodic_function,
     run_function_periodically,
 )
 from mlrun.api.utils.singletons.db import get_db, initialize_db
+from mlrun.api.utils.singletons.k8s import get_k8s_helper
 from mlrun.api.utils.singletons.logs_dir import initialize_logs_dir
 from mlrun.api.utils.singletons.project_member import (
     get_project_member,
     initialize_project_member,
 )
 from mlrun.api.utils.singletons.scheduler import get_scheduler, initialize_scheduler
 from mlrun.config import config
 from mlrun.errors import err_to_str
-from mlrun.k8s_utils import get_k8s_helper
 from mlrun.runtimes import RuntimeClassMode, RuntimeKinds, get_runtime_handler
 from mlrun.utils import logger
 
 API_PREFIX = "/api"
 BASE_VERSIONED_API_PREFIX = f"{API_PREFIX}/v1"
 
 # When pushing notifications, push notifications only for runs that entered a terminal state
@@ -132,21 +132,21 @@
     )
 
     initialize_logs_dir()
     initialize_db()
 
     if (
         config.httpdb.clusterization.worker.sync_with_chief.mode
-        == mlrun.api.schemas.WaitForChiefToReachOnlineStateFeatureFlag.enabled
+        == mlrun.common.schemas.WaitForChiefToReachOnlineStateFeatureFlag.enabled
         and config.httpdb.clusterization.role
-        == mlrun.api.schemas.ClusterizationRole.worker
+        == mlrun.common.schemas.ClusterizationRole.worker
     ):
         _start_chief_clusterization_spec_sync_loop()
 
-    if config.httpdb.state == mlrun.api.schemas.APIStates.online:
+    if config.httpdb.state == mlrun.common.schemas.APIStates.online:
         await move_api_to_online()
 
 
 @app.on_event("shutdown")
 async def shutdown_event():
     if get_project_member():
         get_project_member().shutdown()
@@ -161,25 +161,28 @@
 
     # In general it makes more sense to initialize the project member before the scheduler but in 1.1.0 in follower
     # we've added the full sync on the project member initialization (see code there for details) which might delete
     # projects which requires the scheduler to be set
     initialize_project_member()
 
     # maintenance periodic functions should only run on the chief instance
-    if config.httpdb.clusterization.role == mlrun.api.schemas.ClusterizationRole.chief:
+    if (
+        config.httpdb.clusterization.role
+        == mlrun.common.schemas.ClusterizationRole.chief
+    ):
         # runs cleanup/monitoring is not needed if we're not inside kubernetes cluster
         if get_k8s_helper(silent=True).is_running_inside_kubernetes_cluster():
             _start_periodic_cleanup()
             _start_periodic_runs_monitoring()
             await _start_logs_collection()
             await _start_periodic_stop_logs()
 
 
 async def _start_logs_collection():
-    if config.log_collector.mode == mlrun.api.schemas.LogsCollectorMode.legacy:
+    if config.log_collector.mode == mlrun.common.schemas.LogsCollectorMode.legacy:
         logger.info(
             "Using legacy logs collection method, skipping logs collection periodic function",
             mode=config.log_collector.mode,
         )
         return
     logger.info(
         "Starting logs collection periodic function",
@@ -406,15 +409,15 @@
         logger.info("Starting periodic runs monitoring", interval=interval)
         run_function_periodically(
             interval, _monitor_runs.__name__, False, _monitor_runs
         )
 
 
 async def _start_periodic_stop_logs():
-    if config.log_collector.mode == mlrun.api.schemas.LogsCollectorMode.legacy:
+    if config.log_collector.mode == mlrun.common.schemas.LogsCollectorMode.legacy:
         logger.info(
             "Using legacy logs collection method, skipping stop logs periodic function",
             mode=config.log_collector.mode,
         )
         return
 
     await _verify_log_collection_stopped_on_startup()
@@ -465,15 +468,15 @@
             _synchronize_with_chief_clusterization_spec,
         )
 
 
 async def _synchronize_with_chief_clusterization_spec():
     # sanity
     # if we are still in the periodic function and the worker has reached the terminal state, then cancel it
-    if config.httpdb.state in mlrun.api.schemas.APIStates.terminal_states():
+    if config.httpdb.state in mlrun.common.schemas.APIStates.terminal_states():
         cancel_periodic_function(_synchronize_with_chief_clusterization_spec.__name__)
 
     try:
         chief_client = mlrun.api.utils.clients.chief.Client()
         clusterization_spec = await chief_client.get_clusterization_spec(
             return_fastapi_response=False, raise_on_failure=True
         )
@@ -484,32 +487,32 @@
             traceback=traceback.format_exc(),
         )
     else:
         await _align_worker_state_with_chief_state(clusterization_spec)
 
 
 async def _align_worker_state_with_chief_state(
-    clusterization_spec: mlrun.api.schemas.ClusterizationSpec,
+    clusterization_spec: mlrun.common.schemas.ClusterizationSpec,
 ):
     chief_state = clusterization_spec.chief_api_state
     if not chief_state:
         logger.warning("Chief did not return any state")
         return
 
-    if chief_state not in mlrun.api.schemas.APIStates.terminal_states():
+    if chief_state not in mlrun.common.schemas.APIStates.terminal_states():
         logger.debug(
             "Chief did not reach online state yet, will retry after sync interval",
             interval=config.httpdb.clusterization.worker.sync_with_chief.interval,
             chief_state=chief_state,
         )
         # we want the worker to be aligned with chief state
         config.httpdb.state = chief_state
         return
 
-    if chief_state == mlrun.api.schemas.APIStates.online:
+    if chief_state == mlrun.common.schemas.APIStates.online:
         logger.info("Chief reached online state! Switching worker state to online")
         await move_api_to_online()
         logger.info("Worker state reached online")
 
     else:
         logger.info(
             "Chief state is terminal, canceling worker periodic chief clusterization spec pulling",
@@ -646,24 +649,27 @@
                 exc=err_to_str(exc),
                 project=project_name,
                 run_uids=run_uids,
             )
 
 
 def main():
-    if config.httpdb.clusterization.role == mlrun.api.schemas.ClusterizationRole.chief:
+    if (
+        config.httpdb.clusterization.role
+        == mlrun.common.schemas.ClusterizationRole.chief
+    ):
         init_data()
     elif (
         config.httpdb.clusterization.worker.sync_with_chief.mode
-        == mlrun.api.schemas.WaitForChiefToReachOnlineStateFeatureFlag.enabled
+        == mlrun.common.schemas.WaitForChiefToReachOnlineStateFeatureFlag.enabled
         and config.httpdb.clusterization.role
-        == mlrun.api.schemas.ClusterizationRole.worker
+        == mlrun.common.schemas.ClusterizationRole.worker
     ):
         # we set this state to mark the phase between the startup of the instance until we able to pull the chief state
-        config.httpdb.state = mlrun.api.schemas.APIStates.waiting_for_chief
+        config.httpdb.state = mlrun.common.schemas.APIStates.waiting_for_chief
 
     logger.info(
         "Starting API server",
         port=config.httpdb.port,
         debug=config.httpdb.debug,
     )
     uvicorn.run(
```

## mlrun/api/middlewares.py

```diff
@@ -17,15 +17,15 @@
 import traceback
 import uuid
 
 import fastapi
 import uvicorn.protocols.utils
 from starlette.middleware.base import BaseHTTPMiddleware
 
-import mlrun.api.schemas.constants
+import mlrun.common.schemas.constants
 from mlrun.config import config
 from mlrun.utils import logger
 
 
 def init_middlewares(app: fastapi.FastAPI):
     for func in [
         log_request_response,
@@ -96,15 +96,15 @@
 
 
 async def ui_clear_cache(request: fastapi.Request, call_next):
     """
     This middleware tells ui when to clear its cache based on backend version changes.
     """
     ui_version = request.headers.get(
-        mlrun.api.schemas.constants.HeaderNames.ui_version, ""
+        mlrun.common.schemas.constants.HeaderNames.ui_version, ""
     )
     response: fastapi.Response = await call_next(request)
     development_version = config.version.startswith("0.0.0")
 
     # ask ui to reload cache if
     #  - ui sent a version
     #  - backend is not a development version
@@ -113,26 +113,26 @@
     if ui_version and not development_version and ui_version != config.version:
 
         # clear site cache
         response.headers["Clear-Site-Data"] = '"cache"'
 
         # tell ui to reload
         response.headers[
-            mlrun.api.schemas.constants.HeaderNames.ui_clear_cache
+            mlrun.common.schemas.constants.HeaderNames.ui_clear_cache
         ] = "true"
     return response
 
 
 async def ensure_be_version(request: fastapi.Request, call_next):
     """
     This middleware ensures response header includes backend version
     """
     response: fastapi.Response = await call_next(request)
     response.headers[
-        mlrun.api.schemas.constants.HeaderNames.backend_version
+        mlrun.common.schemas.constants.HeaderNames.backend_version
     ] = config.version
     return response
 
 
 def _resolve_client_address(scope):
     # uvicorn expects this to be a tuple while starlette test client sets it to be a list
     if isinstance(scope.get("client"), list):
```

## mlrun/api/api/api.py

```diff
@@ -24,17 +24,17 @@
     clusterization_spec,
     feature_store,
     files,
     frontend_spec,
     functions,
     grafana_proxy,
     healthz,
+    hub,
     internal,
     logs,
-    marketplace,
     model_endpoints,
     operations,
     pipelines,
     projects,
     runs,
     runtime_resources,
     schedules,
@@ -121,16 +121,16 @@
     secrets.router,
     tags=["secrets"],
     dependencies=[Depends(mlrun.api.api.deps.authenticate_request)],
 )
 api_router.include_router(grafana_proxy.router, tags=["grafana", "model-endpoints"])
 api_router.include_router(model_endpoints.router, tags=["model-endpoints"])
 api_router.include_router(
-    marketplace.router,
-    tags=["marketplace"],
+    hub.router,
+    tags=["hub"],
     dependencies=[Depends(mlrun.api.api.deps.authenticate_request)],
 )
 api_router.include_router(
     operations.router,
     tags=["operations"],
     dependencies=[Depends(mlrun.api.api.deps.authenticate_request)],
 )
```

## mlrun/api/api/deps.py

```diff
@@ -16,65 +16,67 @@
 
 import uvicorn.protocols.utils
 from fastapi import Request
 from sqlalchemy.orm import Session
 
 import mlrun
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
+import mlrun.common.schemas
 
 
 def get_db_session() -> typing.Generator[Session, None, None]:
     db_session = None
     try:
         db_session = mlrun.api.db.session.create_session()
         yield db_session
     finally:
         if db_session:
             mlrun.api.db.session.close_session(db_session)
 
 
-async def authenticate_request(request: Request) -> mlrun.api.schemas.AuthInfo:
+async def authenticate_request(request: Request) -> mlrun.common.schemas.AuthInfo:
     return await mlrun.api.utils.auth.verifier.AuthVerifier().authenticate_request(
         request
     )
 
 
 def verify_api_state(request: Request):
     path_with_query_string = uvicorn.protocols.utils.get_path_with_query_string(
         request.scope
     )
     path = path_with_query_string.split("?")[0]
-    if mlrun.mlconf.httpdb.state == mlrun.api.schemas.APIStates.offline:
+    if mlrun.mlconf.httpdb.state == mlrun.common.schemas.APIStates.offline:
         enabled_endpoints = [
             # we want to stay healthy
             "healthz",
             # we want the workers to be able to pull chief state even if the state is offline
             "clusterization-spec",
         ]
         if not any(enabled_endpoint in path for enabled_endpoint in enabled_endpoints):
             raise mlrun.errors.MLRunPreconditionFailedError("API is in offline state")
     if mlrun.mlconf.httpdb.state in [
-        mlrun.api.schemas.APIStates.waiting_for_migrations,
-        mlrun.api.schemas.APIStates.migrations_in_progress,
-        mlrun.api.schemas.APIStates.migrations_failed,
-        mlrun.api.schemas.APIStates.waiting_for_chief,
+        mlrun.common.schemas.APIStates.waiting_for_migrations,
+        mlrun.common.schemas.APIStates.migrations_in_progress,
+        mlrun.common.schemas.APIStates.migrations_failed,
+        mlrun.common.schemas.APIStates.waiting_for_chief,
     ]:
         enabled_endpoints = [
             "healthz",
             "background-tasks",
             "client-spec",
             "migrations",
             "clusterization-spec",
             "memory-reports",
         ]
         if not any(enabled_endpoint in path for enabled_endpoint in enabled_endpoints):
-            message = mlrun.api.schemas.APIStates.description(mlrun.mlconf.httpdb.state)
+            message = mlrun.common.schemas.APIStates.description(
+                mlrun.mlconf.httpdb.state
+            )
             raise mlrun.errors.MLRunPreconditionFailedError(message)
 
 
 def expose_internal_endpoints(request: Request):
     if not mlrun.mlconf.debug.expose_internal_api_endpoints:
         path_with_query_string = uvicorn.protocols.utils.get_path_with_query_string(
             request.scope
```

## mlrun/api/api/utils.py

```diff
@@ -27,27 +27,25 @@
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.runtimes.pod
 import mlrun.utils.helpers
-from mlrun.api import schemas
 from mlrun.api.db.sqldb.db import SQLDB
-from mlrun.api.schemas import SecretProviderName, SecurityContextEnrichmentModes
 from mlrun.api.utils.singletons.db import get_db
 from mlrun.api.utils.singletons.logs_dir import get_logs_dir
 from mlrun.api.utils.singletons.scheduler import get_scheduler
 from mlrun.config import config
 from mlrun.db.sqldb import SQLDB as SQLRunDB
 from mlrun.errors import err_to_str
-from mlrun.k8s_utils import get_k8s_helper
 from mlrun.run import import_function, new_function
 from mlrun.runtimes.utils import enrich_function_from_dict
 from mlrun.utils import get_in, logger, parse_versioned_object_uri
 
 
 def log_and_raise(status=HTTPStatus.BAD_REQUEST.value, **kw):
     logger.error(str(kw))
@@ -118,15 +116,19 @@
     ]
     if real_path:
         allowed_paths_list.append(real_path)
     allowed_paths_list.append("v3io://")
     return allowed_paths_list
 
 
-def get_secrets(auth_info: mlrun.api.schemas.AuthInfo):
+def get_secrets(
+    auth_info: typing.Union[
+        mlrun.common.schemas.AuthInfo,
+    ]
+):
     return {
         "V3IO_ACCESS_KEY": auth_info.data_session,
     }
 
 
 def get_run_db_instance(
     db_session: Session,
@@ -151,15 +153,15 @@
             HTTPStatus.BAD_REQUEST.value,
             reason="bad JSON, need to include function/url and task objects",
         )
     return function_dict, function_url, task
 
 
 def _generate_function_and_task_from_submit_run_body(
-    db_session: Session, auth_info: mlrun.api.schemas.AuthInfo, data
+    db_session: Session, auth_info: mlrun.common.schemas.AuthInfo, data
 ):
     function_dict, function_url, task = parse_submit_run_body(data)
     # TODO: block exec for function["kind"] in ["", "local]  (must be a
     # remote/container runtime)
 
     if function_dict and not function_url:
         function = new_function(runtime=function_dict)
@@ -188,15 +190,17 @@
 
     apply_enrichment_and_validation_on_function(function, auth_info)
     apply_enrichment_and_validation_on_task(task)
 
     return function, task
 
 
-async def submit_run(db_session: Session, auth_info: mlrun.api.schemas.AuthInfo, data):
+async def submit_run(
+    db_session: Session, auth_info: mlrun.common.schemas.AuthInfo, data
+):
     _, _, _, response = await run_in_threadpool(
         submit_run_sync, db_session, auth_info, data
     )
     return response
 
 
 def apply_enrichment_and_validation_on_task(task):
@@ -222,16 +226,16 @@
         secret_key = mlrun.api.crud.Secrets().generate_client_project_secret_key(
             mlrun.api.crud.SecretsClientType.notifications,
             run_uid,
             notification_object.name,
         )
         mlrun.api.crud.Secrets().store_project_secrets(
             project,
-            mlrun.api.schemas.SecretsData(
-                provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+            mlrun.common.schemas.SecretsData(
+                provider=mlrun.common.schemas.SecretProviderName.kubernetes,
                 secrets={secret_key: json.dumps(notification_object.params)},
             ),
             allow_internal_secrets=True,
         )
         notification_object.params = {"secret": secret_key}
 
     return notification_object
@@ -252,24 +256,24 @@
     project: str, notification_object: mlrun.model.Notification
 ) -> mlrun.model.Notification:
     params = notification_object.params or {}
     params_secret = params.get("secret", "")
     if not params_secret:
         return notification_object
 
-    k8s = mlrun.api.utils.singletons.k8s.get_k8s()
+    k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper()
     if not k8s:
         raise mlrun.errors.MLRunRuntimeError(
             "Not running in k8s environment, cannot load notification params secret"
         )
 
     notification_object.params = json.loads(
         mlrun.api.crud.Secrets().get_project_secret(
             project,
-            mlrun.api.schemas.SecretProviderName.kubernetes,
+            mlrun.common.schemas.SecretProviderName.kubernetes,
             secret_key=params_secret,
             allow_internal_secrets=True,
             allow_secrets_from_k8s=True,
         )
     )
 
     return notification_object
@@ -279,32 +283,32 @@
     project: str, notification_object: mlrun.model.Notification
 ) -> None:
     params = notification_object.params or {}
     params_secret = params.get("secret", "")
     if not params_secret:
         return
 
-    k8s = mlrun.api.utils.singletons.k8s.get_k8s()
+    k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper()
     if not k8s:
         raise mlrun.errors.MLRunRuntimeError(
             "Not running in k8s environment, cannot delete notification params secret"
         )
 
     mlrun.api.crud.Secrets().delete_project_secret(
         project,
-        mlrun.api.schemas.SecretProviderName.kubernetes,
+        mlrun.common.schemas.SecretProviderName.kubernetes,
         secret_key=params_secret,
         allow_internal_secrets=True,
         allow_secrets_from_k8s=True,
     )
 
 
 def apply_enrichment_and_validation_on_function(
     function,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     ensure_auth: bool = True,
     perform_auto_mount: bool = True,
     validate_service_account: bool = True,
     mask_sensitive_data: bool = True,
     ensure_security_context: bool = True,
 ):
     """
@@ -336,22 +340,22 @@
 
     if ensure_security_context:
         ensure_function_security_context(function, auth_info)
 
 
 def ensure_function_auth_and_sensitive_data_is_masked(
     function,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     allow_empty_access_key: bool = False,
 ):
     ensure_function_has_auth_set(function, auth_info, allow_empty_access_key)
     mask_function_sensitive_data(function, auth_info)
 
 
-def mask_function_sensitive_data(function, auth_info: mlrun.api.schemas.AuthInfo):
+def mask_function_sensitive_data(function, auth_info: mlrun.common.schemas.AuthInfo):
     if not mlrun.runtimes.RuntimeKinds.is_local_runtime(function.kind):
         _mask_v3io_access_key_env_var(function, auth_info)
         _mask_v3io_volume_credentials(function)
 
 
 def _mask_v3io_volume_credentials(function: mlrun.runtimes.pod.KubeResource):
     """
@@ -427,16 +431,16 @@
                 continue
             username = _resolve_v3io_fuse_volume_access_key_matching_username(
                 function, volume, volume["name"], volume_name_to_volume_mounts
             )
             if not username:
                 continue
             secret_name = mlrun.api.crud.Secrets().store_auth_secret(
-                mlrun.api.schemas.AuthSecretData(
-                    provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+                mlrun.common.schemas.AuthSecretData(
+                    provider=mlrun.common.schemas.SecretProviderName.kubernetes,
                     username=username,
                     access_key=access_key,
                 )
             )
 
             del flex_volume["options"]["accessKey"]
             flex_volume["secretRef"] = {"name": secret_name}
@@ -490,15 +494,15 @@
             )
             return None
         username = v3io_username
     return username
 
 
 def _mask_v3io_access_key_env_var(
-    function: mlrun.runtimes.pod.KubeResource, auth_info: mlrun.api.schemas.AuthInfo
+    function: mlrun.runtimes.pod.KubeResource, auth_info: mlrun.common.schemas.AuthInfo
 ):
     v3io_access_key = function.get_env("V3IO_ACCESS_KEY")
     # if it's already a V1EnvVarSource or dict instance, it's already been masked
     if (
         v3io_access_key
         and not isinstance(v3io_access_key, kubernetes.client.V1EnvVarSource)
         and not isinstance(v3io_access_key, dict)
@@ -517,31 +521,31 @@
                 username = auth_info.username
             else:
                 logger.warning(
                     "Could not find matching username for v3io access key in env or session, skipping masking",
                 )
                 return
         secret_name = mlrun.api.crud.Secrets().store_auth_secret(
-            mlrun.api.schemas.AuthSecretData(
-                provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+            mlrun.common.schemas.AuthSecretData(
+                provider=mlrun.common.schemas.SecretProviderName.kubernetes,
                 username=username,
                 access_key=v3io_access_key,
             )
         )
-        access_key_secret_key = mlrun.api.schemas.AuthSecretData.get_field_secret_key(
-            "access_key"
+        access_key_secret_key = (
+            mlrun.common.schemas.AuthSecretData.get_field_secret_key("access_key")
         )
         function.set_env_from_secret(
             "V3IO_ACCESS_KEY", secret_name, access_key_secret_key
         )
 
 
 def ensure_function_has_auth_set(
     function: mlrun.runtimes.BaseRuntime,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     allow_empty_access_key: bool = False,
 ):
     """
     :param function:    Function object.
     :param auth_info:   The auth info of the request.
     :param allow_empty_access_key: Whether to raise an error if access key wasn't set or requested to get generated
     """
@@ -580,42 +584,42 @@
             mlrun.model.Credentials.secret_reference_prefix
         ):
             if not auth_info.username:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     "Username is missing from auth info"
                 )
             secret_name = mlrun.api.crud.Secrets().store_auth_secret(
-                mlrun.api.schemas.AuthSecretData(
-                    provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+                mlrun.common.schemas.AuthSecretData(
+                    provider=mlrun.common.schemas.SecretProviderName.kubernetes,
                     username=auth_info.username,
                     access_key=function.metadata.credentials.access_key,
                 )
             )
             function.metadata.credentials.access_key = (
                 f"{mlrun.model.Credentials.secret_reference_prefix}{secret_name}"
             )
         else:
             secret_name = function.metadata.credentials.access_key.lstrip(
                 mlrun.model.Credentials.secret_reference_prefix
             )
 
-        access_key_secret_key = mlrun.api.schemas.AuthSecretData.get_field_secret_key(
-            "access_key"
+        access_key_secret_key = (
+            mlrun.common.schemas.AuthSecretData.get_field_secret_key("access_key")
         )
         auth_env_vars = {
             mlrun.runtimes.constants.FunctionEnvironmentVariables.auth_session: (
                 secret_name,
                 access_key_secret_key,
             )
         }
         for env_key, (secret_name, secret_key) in auth_env_vars.items():
             function.set_env_from_secret(env_key, secret_name, secret_key)
 
 
-def try_perform_auto_mount(function, auth_info: mlrun.api.schemas.AuthInfo):
+def try_perform_auto_mount(function, auth_info: mlrun.common.schemas.AuthInfo):
     if (
         mlrun.runtimes.RuntimeKinds.is_local_runtime(function.kind)
         or function.spec.disable_auto_mount
     ):
         return
     # Retrieve v3io auth params from the caller auth info
     override_params = {}
@@ -625,15 +629,17 @@
         override_params["user"] = auth_info.username
 
     function.try_auto_mount_based_on_config(override_params)
 
 
 def process_function_service_account(function):
     # If we're not running inside k8s, skip this check as it's not relevant.
-    if not get_k8s_helper(silent=True).is_running_inside_kubernetes_cluster():
+    if not mlrun.api.utils.singletons.k8s.get_k8s_helper(
+        silent=True
+    ).is_running_inside_kubernetes_cluster():
         return
 
     (
         allowed_service_accounts,
         default_service_account,
     ) = resolve_project_default_service_account(function.metadata.project)
 
@@ -641,30 +647,30 @@
         allowed_service_accounts, default_service_account
     )
 
 
 def resolve_project_default_service_account(project_name: str):
     allowed_service_accounts = mlrun.api.crud.secrets.Secrets().get_project_secret(
         project_name,
-        SecretProviderName.kubernetes,
+        mlrun.common.schemas.SecretProviderName.kubernetes,
         mlrun.api.crud.secrets.Secrets().generate_client_project_secret_key(
             mlrun.api.crud.secrets.SecretsClientType.service_accounts, "allowed"
         ),
         allow_secrets_from_k8s=True,
         allow_internal_secrets=True,
     )
     if allowed_service_accounts:
         allowed_service_accounts = [
             service_account.strip()
             for service_account in allowed_service_accounts.split(",")
         ]
 
     default_service_account = mlrun.api.crud.secrets.Secrets().get_project_secret(
         project_name,
-        SecretProviderName.kubernetes,
+        mlrun.common.schemas.SecretProviderName.kubernetes,
         mlrun.api.crud.secrets.Secrets().generate_client_project_secret_key(
             mlrun.api.crud.secrets.SecretsClientType.service_accounts, "default"
         ),
         allow_secrets_from_k8s=True,
         allow_internal_secrets=True,
     )
 
@@ -683,26 +689,28 @@
             f"Default service account {default_service_account} is not in list of allowed "
             + f"service accounts {allowed_service_accounts}"
         )
 
     return allowed_service_accounts, default_service_account
 
 
-def ensure_function_security_context(function, auth_info: mlrun.api.schemas.AuthInfo):
+def ensure_function_security_context(
+    function, auth_info: mlrun.common.schemas.AuthInfo
+):
     """
     For iguazio we enforce that pods run with user id and group id depending on
     mlrun.mlconf.function.spec.security_context.enrichment_mode
     and mlrun.mlconf.function.spec.security_context.enrichment_group_id
     """
 
     # if security context is not required.
     # security context is not yet supported with spark runtime since it requires spark 3.2+
     if (
         mlrun.mlconf.function.spec.security_context.enrichment_mode
-        == SecurityContextEnrichmentModes.disabled.value
+        == mlrun.common.schemas.SecurityContextEnrichmentModes.disabled.value
         or mlrun.runtimes.RuntimeKinds.is_local_runtime(function.kind)
         or function.kind == mlrun.runtimes.RuntimeKinds.spark
         # remote spark image currently requires running with user 1000 or root
         # and by default it runs with user 1000 (when security context is not set)
         or function.kind == mlrun.runtimes.RuntimeKinds.remotespark
         or not mlrun.mlconf.is_running_on_iguazio()
     ):
@@ -710,29 +718,29 @@
 
     function: mlrun.runtimes.pod.KubeResource
 
     # TODO: enrich old functions being triggered after upgrading mlrun with project owner uid.
     #  Enrichment with retain enrichment mode should occur on function creation only.
     if (
         mlrun.mlconf.function.spec.security_context.enrichment_mode
-        == SecurityContextEnrichmentModes.retain.value
+        == mlrun.common.schemas.SecurityContextEnrichmentModes.retain.value
         and function.spec.security_context is not None
         and function.spec.security_context.run_as_user is not None
         and function.spec.security_context.run_as_group is not None
     ):
         logger.debug(
             "Security context is already set",
             mode=mlrun.mlconf.function.spec.security_context.enrichment_mode,
             function_name=function.metadata.name,
         )
         return
 
     if mlrun.mlconf.function.spec.security_context.enrichment_mode in [
-        SecurityContextEnrichmentModes.override.value,
-        SecurityContextEnrichmentModes.retain.value,
+        mlrun.common.schemas.SecurityContextEnrichmentModes.override.value,
+        mlrun.common.schemas.SecurityContextEnrichmentModes.retain.value,
     ]:
 
         # before iguazio 3.6 the user unix id is not passed in the session verification response headers
         # so we need to request it explicitly
         if auth_info.user_unix_id is None:
             iguazio_client = mlrun.api.utils.clients.iguazio.Client()
             if (
@@ -780,15 +788,15 @@
     else:
         raise mlrun.errors.MLRunInvalidArgumentError(
             f"Invalid security context enrichment mode {mlrun.mlconf.function.spec.security_context.enrichment_mode}"
         )
 
 
 def submit_run_sync(
-    db_session: Session, auth_info: mlrun.api.schemas.AuthInfo, data
+    db_session: Session, auth_info: mlrun.common.schemas.AuthInfo, data
 ) -> typing.Tuple[str, str, str, typing.Dict]:
     """
     :return: Tuple with:
         1. str of the project of the run
         2. str of the kind of the function of the run
         3. str of the uid of the run that started execution (None when it was scheduled)
         4. dict of the response info
@@ -810,15 +818,15 @@
         run_db = get_run_db_instance(db_session)
         fn.set_db_connection(run_db)
         logger.info("Submitting run", function=fn.to_dict(), task=task)
         schedule = data.get("schedule")
         if schedule:
             cron_trigger = schedule
             if isinstance(cron_trigger, dict):
-                cron_trigger = schemas.ScheduleCronTrigger(**cron_trigger)
+                cron_trigger = mlrun.common.schemas.ScheduleCronTrigger(**cron_trigger)
             schedule_labels = task["metadata"].get("labels")
             created = False
 
             try:
                 get_scheduler().update_schedule(
                     db_session,
                     auth_info,
@@ -831,15 +839,15 @@
             except mlrun.errors.MLRunNotFoundError:
                 logger.debug("No existing schedule found, creating a new one")
                 get_scheduler().create_schedule(
                     db_session,
                     auth_info,
                     task["metadata"]["project"],
                     task["metadata"]["name"],
-                    schemas.ScheduleKinds.job,
+                    mlrun.common.schemas.ScheduleKinds.job,
                     data,
                     cron_trigger,
                     schedule_labels,
                 )
                 created = True
             project = task["metadata"]["project"]
 
@@ -853,15 +861,15 @@
         else:
             # When processing a hyper-param run, secrets may be needed to access the parameters file (which is accessed
             # locally from the mlrun service pod) - include project secrets and the caller's access key
             param_file_secrets = (
                 mlrun.api.crud.Secrets()
                 .list_project_secrets(
                     task["metadata"]["project"],
-                    mlrun.api.schemas.SecretProviderName.kubernetes,
+                    mlrun.common.schemas.SecretProviderName.kubernetes,
                     allow_secrets_from_k8s=True,
                 )
                 .secrets
             )
             param_file_secrets["V3IO_ACCESS_KEY"] = (
                 auth_info.data_session or auth_info.access_key
             )
```

## mlrun/api/api/endpoints/artifacts.py

```diff
@@ -18,18 +18,18 @@
 from fastapi import APIRouter, Depends, Query, Request
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.singletons.project_member
-from mlrun.api import schemas
+import mlrun.common.schemas
 from mlrun.api.api import deps
 from mlrun.api.api.utils import log_and_raise
-from mlrun.api.schemas.artifact import ArtifactsFormat
+from mlrun.common.schemas.artifact import ArtifactsFormat
 from mlrun.config import config
 from mlrun.utils import is_legacy_artifact, logger
 
 router = APIRouter()
 
 
 # TODO /artifact/{project}/{uid}/{key:path} should be deprecated in 1.4
@@ -38,28 +38,28 @@
 async def store_artifact(
     request: Request,
     project: str,
     uid: str,
     key: str,
     tag: str = "",
     iter: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.artifact,
+        mlrun.common.schemas.AuthorizationResourceTypes.artifact,
         project,
         key,
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
 
     data = None
     try:
         data = await request.json()
     except ValueError:
@@ -78,29 +78,29 @@
     )
     return {}
 
 
 @router.get("/projects/{project}/artifact-tags")
 async def list_artifact_tags(
     project: str,
-    category: schemas.ArtifactCategories = None,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    category: mlrun.common.schemas.ArtifactCategories = None,
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     tag_tuples = await run_in_threadpool(
         mlrun.api.crud.Artifacts().list_artifact_tags, db_session, project, category
     )
     artifact_key_to_tag = {tag_tuple[1]: tag_tuple[2] for tag_tuple in tag_tuples}
     allowed_artifact_keys = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.artifact,
+        mlrun.common.schemas.AuthorizationResourceTypes.artifact,
         list(artifact_key_to_tag.keys()),
         lambda artifact_key: (
             project,
             artifact_key,
         ),
         auth_info,
     )
@@ -121,31 +121,31 @@
 @router.get("/projects/{project}/artifacts/{key:path}")
 async def get_artifact(
     project: str,
     key: str,
     tag: str = "latest",
     iter: int = 0,
     format_: ArtifactsFormat = Query(ArtifactsFormat.full, alias="format"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     data = await run_in_threadpool(
         mlrun.api.crud.Artifacts().get_artifact,
         db_session,
         key,
         tag,
         iter,
         project,
         format_,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.artifact,
+        mlrun.common.schemas.AuthorizationResourceTypes.artifact,
         project,
         key,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return {
         "data": data,
     }
 
 
@@ -153,22 +153,22 @@
 @router.delete("/artifact/{project}/{uid}")
 @router.delete("/projects/{project}/artifacts/{uid}")
 async def delete_artifact(
     project: str,
     uid: str,
     key: str,
     tag: str = "",
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.artifact,
+        mlrun.common.schemas.AuthorizationResourceTypes.artifact,
         project,
         key,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     await run_in_threadpool(
         mlrun.api.crud.Artifacts().delete_artifact, db_session, key, tag, project
     )
     return {}
 
@@ -177,27 +177,27 @@
 @router.get("/artifacts")
 @router.get("/projects/{project}/artifacts")
 async def list_artifacts(
     project: str = None,
     name: str = None,
     tag: str = None,
     kind: str = None,
-    category: schemas.ArtifactCategories = None,
+    category: mlrun.common.schemas.ArtifactCategories = None,
     labels: List[str] = Query([], alias="label"),
     iter: int = Query(None, ge=0),
     best_iteration: bool = Query(False, alias="best-iteration"),
     format_: ArtifactsFormat = Query(ArtifactsFormat.full, alias="format"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if project is None:
         project = config.default_project
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     artifacts = await run_in_threadpool(
         mlrun.api.crud.Artifacts().list_artifacts,
         db_session,
         project,
@@ -208,15 +208,15 @@
         category=category,
         iter=iter,
         best_iteration=best_iteration,
         format_=format_,
     )
 
     artifacts = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.artifact,
+        mlrun.common.schemas.AuthorizationResourceTypes.artifact,
         artifacts,
         _artifact_project_and_resource_name_extractor,
         auth_info,
     )
     return {
         "artifacts": artifacts,
     }
@@ -225,15 +225,15 @@
 # TODO /artifacts should be deprecated in 1.4
 @router.delete("/artifacts")
 async def delete_artifacts_legacy(
     project: str = mlrun.mlconf.default_project,
     name: str = "",
     tag: str = "",
     labels: List[str] = Query([], alias="label"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     return await _delete_artifacts(
         project=project,
         name=name,
         tag=tag,
         labels=labels,
@@ -244,15 +244,15 @@
 
 @router.delete("/projects/{project}/artifacts")
 async def delete_artifacts(
     project: str = mlrun.mlconf.default_project,
     name: str = "",
     tag: str = "",
     labels: List[str] = Query([], alias="label"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     return await _delete_artifacts(
         project=project,
         name=name,
         tag=tag,
         labels=labels,
@@ -262,30 +262,30 @@
 
 
 async def _delete_artifacts(
     project: str = None,
     name: str = None,
     tag: str = None,
     labels: List[str] = None,
-    auth_info: mlrun.api.schemas.AuthInfo = None,
+    auth_info: mlrun.common.schemas.AuthInfo = None,
     db_session: Session = None,
 ):
     artifacts = await run_in_threadpool(
         mlrun.api.crud.Artifacts().list_artifacts,
         db_session,
         project,
         name,
         tag,
         labels,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resources_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.artifact,
+        mlrun.common.schemas.AuthorizationResourceTypes.artifact,
         artifacts,
         _artifact_project_and_resource_name_extractor,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     await run_in_threadpool(
         mlrun.api.crud.Artifacts().delete_artifacts,
         db_session,
         project,
         name,
```

## mlrun/api/api/endpoints/auth.py

```diff
@@ -11,24 +11,24 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import fastapi
 
 import mlrun.api.api.deps
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
+import mlrun.common.schemas
 
 router = fastapi.APIRouter()
 
 
 @router.post("/authorization/verifications")
 async def verify_authorization(
-    authorization_verification_input: mlrun.api.schemas.AuthorizationVerificationInput,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    authorization_verification_input: mlrun.common.schemas.AuthorizationVerificationInput,
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_permissions(
         authorization_verification_input.resource,
         authorization_verification_input.action,
         auth_info,
```

## mlrun/api/api/endpoints/background_tasks.py

```diff
@@ -14,80 +14,80 @@
 #
 import fastapi
 import semver
 import sqlalchemy.orm
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.background_tasks
 import mlrun.api.utils.clients.chief
+import mlrun.common.schemas
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
 
 
 @router.get(
     "/projects/{project}/background-tasks/{name}",
-    response_model=mlrun.api.schemas.BackgroundTask,
+    response_model=mlrun.common.schemas.BackgroundTask,
 )
 async def get_project_background_task(
     project: str,
     name: str,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     # Since there's no not-found option on get_project_background_task - we authorize before getting (unlike other
     # get endpoint)
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.project_background_task,
+        mlrun.common.schemas.AuthorizationResourceTypes.project_background_task,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return await run_in_threadpool(
         mlrun.api.utils.background_tasks.ProjectBackgroundTasksHandler().get_background_task,
         db_session,
         name=name,
         project=project,
     )
 
 
 @router.get(
     "/background-tasks/{name}",
-    response_model=mlrun.api.schemas.BackgroundTask,
+    response_model=mlrun.common.schemas.BackgroundTask,
 )
 async def get_internal_background_task(
     name: str,
     request: fastapi.Request,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     # Since there's no not-found option on get_background_task - we authorize before getting (unlike other get endpoint)
     # In Iguazio 3.2 the manifest doesn't support the global background task resource - therefore we have to just omit
     # authorization
     # we also skip Iguazio 3.6 for now, until it will add support for it (still in development)
     igz_version = mlrun.mlconf.get_parsed_igz_version()
     if igz_version and igz_version >= semver.VersionInfo.parse("3.7.0-b1"):
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.background_task,
+            mlrun.common.schemas.AuthorizationResourceTypes.background_task,
             name,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting internal background task, re-routing to chief",
             internal_background_task=name,
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
         return await chief_client.get_internal_background_task(
```

## mlrun/api/api/endpoints/client_spec.py

```diff
@@ -13,27 +13,27 @@
 # limitations under the License.
 #
 import typing
 
 from fastapi import APIRouter, Header
 
 import mlrun.api.crud
-import mlrun.api.schemas
+import mlrun.common.schemas
 
 router = APIRouter()
 
 
 @router.get(
     "/client-spec",
-    response_model=mlrun.api.schemas.ClientSpec,
+    response_model=mlrun.common.schemas.ClientSpec,
 )
 def get_client_spec(
     client_version: typing.Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.client_version
+        None, alias=mlrun.common.schemas.HeaderNames.client_version
     ),
     client_python_version: typing.Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.python_version
+        None, alias=mlrun.common.schemas.HeaderNames.python_version
     ),
 ):
     return mlrun.api.crud.ClientSpec().get_client_spec(
         client_version=client_version, client_python_version=client_python_version
     )
```

## mlrun/api/api/endpoints/clusterization_spec.py

```diff
@@ -11,24 +11,26 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import fastapi
 
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.clients.chief
+import mlrun.common.schemas
 
 router = fastapi.APIRouter()
 
 
-@router.get("/clusterization-spec", response_model=mlrun.api.schemas.ClusterizationSpec)
+@router.get(
+    "/clusterization-spec", response_model=mlrun.common.schemas.ClusterizationSpec
+)
 async def clusterization_spec():
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         chief_client = mlrun.api.utils.clients.chief.Client()
         return await chief_client.get_clusterization_spec()
 
     # TODO: cache me
     return mlrun.api.crud.ClusterizationSpec().get_clusterization_spec()
```

## mlrun/api/api/endpoints/feature_store.py

```diff
@@ -9,57 +9,60 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import asyncio
+import typing
 from http import HTTPStatus
 from typing import List, Optional
 
 from fastapi import APIRouter, Depends, Header, Query, Response
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.feature_store
 from mlrun import v3io_cred
-from mlrun.api import schemas
 from mlrun.api.api import deps
 from mlrun.api.api.utils import log_and_raise, parse_reference
 from mlrun.data_types import InferOptions
 from mlrun.datastore.targets import get_default_prefix_for_target
 from mlrun.feature_store.api import RunConfig, ingest
 from mlrun.model import DataSource, DataTargetBase
 
 router = APIRouter()
 
 
-@router.post("/projects/{project}/feature-sets", response_model=schemas.FeatureSet)
+@router.post(
+    "/projects/{project}/feature-sets", response_model=mlrun.common.schemas.FeatureSet
+)
 async def create_feature_set(
     project: str,
-    feature_set: schemas.FeatureSet,
+    feature_set: mlrun.common.schemas.FeatureSet,
     versioned: bool = True,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         project,
         feature_set.metadata.name,
-        mlrun.api.schemas.AuthorizationAction.create,
+        mlrun.common.schemas.AuthorizationAction.create,
         auth_info,
     )
     feature_set_uid = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().create_feature_set,
         db_session,
         project,
         feature_set,
@@ -74,36 +77,36 @@
         feature_set.metadata.tag or "latest",
         feature_set_uid,
     )
 
 
 @router.put(
     "/projects/{project}/feature-sets/{name}/references/{reference}",
-    response_model=schemas.FeatureSet,
+    response_model=mlrun.common.schemas.FeatureSet,
 )
 async def store_feature_set(
     project: str,
     name: str,
     reference: str,
-    feature_set: schemas.FeatureSet,
+    feature_set: mlrun.common.schemas.FeatureSet,
     versioned: bool = True,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     tag, uid = parse_reference(reference)
     uid = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().store_feature_set,
         db_session,
         project,
@@ -125,25 +128,26 @@
 
 @router.patch("/projects/{project}/feature-sets/{name}/references/{reference}")
 async def patch_feature_set(
     project: str,
     name: str,
     feature_set_update: dict,
     reference: str,
-    patch_mode: schemas.PatchMode = Header(
-        schemas.PatchMode.replace, alias=schemas.HeaderNames.patch_mode
+    patch_mode: mlrun.common.schemas.PatchMode = Header(
+        mlrun.common.schemas.PatchMode.replace,
+        alias=mlrun.common.schemas.HeaderNames.patch_mode,
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     tag, uid = parse_reference(reference)
     await run_in_threadpool(
         mlrun.api.crud.FeatureStore().patch_feature_set,
         db_session,
         project,
@@ -154,56 +158,56 @@
         patch_mode,
     )
     return Response(status_code=HTTPStatus.OK.value)
 
 
 @router.get(
     "/projects/{project}/feature-sets/{name}/references/{reference}",
-    response_model=schemas.FeatureSet,
+    response_model=mlrun.common.schemas.FeatureSet,
 )
 async def get_feature_set(
     project: str,
     name: str,
     reference: str,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     tag, uid = parse_reference(reference)
     feature_set = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().get_feature_set,
         db_session,
         project,
         name,
         tag,
         uid,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return feature_set
 
 
 @router.delete("/projects/{project}/feature-sets/{name}")
 @router.delete("/projects/{project}/feature-sets/{name}/references/{reference}")
 async def delete_feature_set(
     project: str,
     name: str,
     reference: str = None,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     tag = uid = None
     if reference:
         tag, uid = parse_reference(reference)
     await run_in_threadpool(
         mlrun.api.crud.FeatureStore().delete_feature_set,
@@ -213,38 +217,41 @@
         tag,
         uid,
     )
     return Response(status_code=HTTPStatus.NO_CONTENT.value)
 
 
 @router.get(
-    "/projects/{project}/feature-sets", response_model=schemas.FeatureSetsOutput
+    "/projects/{project}/feature-sets",
+    response_model=mlrun.common.schemas.FeatureSetsOutput,
 )
 async def list_feature_sets(
     project: str,
     name: str = None,
     state: str = None,
     tag: str = None,
     entities: List[str] = Query(None, alias="entity"),
     features: List[str] = Query(None, alias="feature"),
     labels: List[str] = Query(None, alias="label"),
-    partition_by: schemas.FeatureStorePartitionByField = Query(
+    partition_by: mlrun.common.schemas.FeatureStorePartitionByField = Query(
         None, alias="partition-by"
     ),
     rows_per_partition: int = Query(1, alias="rows-per-partition", gt=0),
-    partition_sort_by: schemas.SortField = Query(None, alias="partition-sort-by"),
-    partition_order: schemas.OrderType = Query(
-        schemas.OrderType.desc, alias="partition-order"
+    partition_sort_by: mlrun.common.schemas.SortField = Query(
+        None, alias="partition-sort-by"
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    partition_order: mlrun.common.schemas.OrderType = Query(
+        mlrun.common.schemas.OrderType.desc, alias="partition-order"
+    ),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     feature_sets = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().list_feature_sets,
         db_session,
         project,
         name,
@@ -255,68 +262,68 @@
         labels,
         partition_by,
         rows_per_partition,
         partition_sort_by,
         partition_order,
     )
     feature_sets = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         feature_sets.feature_sets,
         lambda feature_set: (
             feature_set.metadata.project,
             feature_set.metadata.name,
         ),
         auth_info,
     )
-    return mlrun.api.schemas.FeatureSetsOutput(feature_sets=feature_sets)
+    return mlrun.common.schemas.FeatureSetsOutput(feature_sets=feature_sets)
 
 
 @router.get(
     "/projects/{project}/feature-sets/{name}/tags",
-    response_model=schemas.FeatureSetsTagsOutput,
+    response_model=mlrun.common.schemas.FeatureSetsTagsOutput,
 )
 async def list_feature_sets_tags(
     project: str,
     name: str,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if name != "*":
         raise mlrun.errors.MLRunInvalidArgumentError(
             "Listing a specific feature set tags is not supported, set name to *"
         )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     tag_tuples = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().list_feature_sets_tags,
         db_session,
         project,
     )
     feature_set_name_to_tag = {tag_tuple[1]: tag_tuple[2] for tag_tuple in tag_tuples}
     auth_verifier = mlrun.api.utils.auth.verifier.AuthVerifier()
     allowed_feature_set_names = (
         await auth_verifier.filter_project_resources_by_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+            mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
             list(feature_set_name_to_tag.keys()),
             lambda feature_set_name: (
                 project,
                 feature_set_name,
             ),
             auth_info,
         )
     )
     tags = {
         tag_tuple[2]
         for tag_tuple in tag_tuples
         if tag_tuple[1] in allowed_feature_set_names
     }
-    return mlrun.api.schemas.FeatureSetsTagsOutput(tags=list(tags))
+    return mlrun.common.schemas.FeatureSetsTagsOutput(tags=list(tags))
 
 
 def _has_v3io_path(data_source, data_targets, feature_set):
     paths = []
 
     # If no data targets received, then use targets from the feature-set spec. In case it's empty as well, use
     # default targets (by calling set_targets())
@@ -338,55 +345,55 @@
         path and (path.startswith("v3io://") or path.startswith("v3ios://"))
         for path in paths
     )
 
 
 @router.post(
     "/projects/{project}/feature-sets/{name}/references/{reference}/ingest",
-    response_model=schemas.FeatureSetIngestOutput,
+    response_model=mlrun.common.schemas.FeatureSetIngestOutput,
     status_code=HTTPStatus.ACCEPTED.value,
 )
 async def ingest_feature_set(
     project: str,
     name: str,
     reference: str,
     ingest_parameters: Optional[
-        schemas.FeatureSetIngestInput
-    ] = schemas.FeatureSetIngestInput(),
+        mlrun.common.schemas.FeatureSetIngestInput
+    ] = mlrun.common.schemas.FeatureSetIngestInput(),
     username: str = Header(None, alias="x-remote-user"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     """
     This endpoint is being called only through the UI, this is mainly for enrichment of the feature set
     that already being happen on client side
     """
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.run,
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
         project,
         "",
-        mlrun.api.schemas.AuthorizationAction.create,
+        mlrun.common.schemas.AuthorizationAction.create,
         auth_info,
     )
     data_source = data_targets = None
     if ingest_parameters.source:
         data_source = DataSource.from_dict(ingest_parameters.source.dict())
     if data_source.schedule:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+            mlrun.common.schemas.AuthorizationResourceTypes.schedule,
             project,
             "",
-            mlrun.api.schemas.AuthorizationAction.create,
+            mlrun.common.schemas.AuthorizationAction.create,
             auth_info,
         )
     tag, uid = parse_reference(reference)
     feature_set_record = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().get_feature_set,
         db_session,
         project,
@@ -394,18 +401,18 @@
         tag,
         uid,
     )
     feature_set = mlrun.feature_store.FeatureSet.from_dict(feature_set_record.dict())
     if feature_set.spec.function and feature_set.spec.function.function_object:
         function = feature_set.spec.function.function_object
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.function,
+            mlrun.common.schemas.AuthorizationResourceTypes.function,
             function.metadata.project,
             function.metadata.name,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     # Need to override the default rundb since we're in the server.
     # this is done so further down the flow when running the function created for ingestion we won't access the httpdb
     # but rather "understand" that we are running on server side and call the DB.
     await run_in_threadpool(feature_set._override_run_db, db_session)
 
@@ -443,111 +450,120 @@
         data_source,
         data_targets,
         infer_options=infer_options,
         return_df=False,
         run_config=run_config,
     )
     # ingest may modify the feature-set contents, so returning the updated feature-set.
-    result_feature_set = schemas.FeatureSet(**feature_set.to_dict())
-    return schemas.FeatureSetIngestOutput(
+    result_feature_set = mlrun.common.schemas.FeatureSet(**feature_set.to_dict())
+    return mlrun.common.schemas.FeatureSetIngestOutput(
         feature_set=result_feature_set, run_object=run_params.to_dict()
     )
 
 
-@router.get("/projects/{project}/features", response_model=schemas.FeaturesOutput)
+@router.get(
+    "/projects/{project}/features", response_model=mlrun.common.schemas.FeaturesOutput
+)
 async def list_features(
     project: str,
     name: str = None,
     tag: str = None,
     entities: List[str] = Query(None, alias="entity"),
     labels: List[str] = Query(None, alias="label"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     features = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().list_features,
         db_session,
         project,
         name,
         tag,
         entities,
         labels,
     )
     features = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature,
         features.features,
         lambda feature_list_output: (
             feature_list_output.feature_set_digest.metadata.project,
             feature_list_output.feature.name,
         ),
         auth_info,
     )
-    return mlrun.api.schemas.FeaturesOutput(features=features)
+    return mlrun.common.schemas.FeaturesOutput(features=features)
 
 
-@router.get("/projects/{project}/entities", response_model=schemas.EntitiesOutput)
+@router.get(
+    "/projects/{project}/entities", response_model=mlrun.common.schemas.EntitiesOutput
+)
 async def list_entities(
     project: str,
     name: str = None,
     tag: str = None,
     labels: List[str] = Query(None, alias="label"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: typing.Union[
+        mlrun.common.schemas.AuthInfo, mlrun.common.schemas.AuthInfo
+    ] = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     entities = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().list_entities,
         db_session,
         project,
         name,
         tag,
         labels,
     )
     entities = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.entity,
+        mlrun.common.schemas.AuthorizationResourceTypes.entity,
         entities.entities,
         lambda entity_list_output: (
             entity_list_output.feature_set_digest.metadata.project,
             entity_list_output.entity.name,
         ),
         auth_info,
     )
-    return mlrun.api.schemas.EntitiesOutput(entities=entities)
+    return mlrun.common.schemas.EntitiesOutput(entities=entities)
 
 
 @router.post(
-    "/projects/{project}/feature-vectors", response_model=schemas.FeatureVector
+    "/projects/{project}/feature-vectors",
+    response_model=mlrun.common.schemas.FeatureVector,
 )
 async def create_feature_vector(
     project: str,
-    feature_vector: schemas.FeatureVector,
+    feature_vector: mlrun.common.schemas.FeatureVector,
     versioned: bool = True,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: typing.Union[
+        mlrun.common.schemas.AuthInfo, mlrun.common.schemas.AuthInfo
+    ] = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
         project,
         feature_vector.metadata.name,
-        mlrun.api.schemas.AuthorizationAction.create,
+        mlrun.common.schemas.AuthorizationAction.create,
         auth_info,
     )
     await _verify_feature_vector_features_permissions(
         auth_info, project, feature_vector.dict()
     )
     feature_vector_uid = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().create_feature_vector,
@@ -565,68 +581,71 @@
         feature_vector.metadata.tag or "latest",
         feature_vector_uid,
     )
 
 
 @router.get(
     "/projects/{project}/feature-vectors/{name}/references/{reference}",
-    response_model=schemas.FeatureVector,
+    response_model=mlrun.common.schemas.FeatureVector,
 )
 async def get_feature_vector(
     project: str,
     name: str,
     reference: str,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     tag, uid = parse_reference(reference)
     feature_vector = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().get_feature_vector,
         db_session,
         project,
         name,
         tag,
         uid,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     await _verify_feature_vector_features_permissions(
         auth_info, project, feature_vector.dict()
     )
     return feature_vector
 
 
 @router.get(
-    "/projects/{project}/feature-vectors", response_model=schemas.FeatureVectorsOutput
+    "/projects/{project}/feature-vectors",
+    response_model=mlrun.common.schemas.FeatureVectorsOutput,
 )
 async def list_feature_vectors(
     project: str,
     name: str = None,
     state: str = None,
     tag: str = None,
     labels: List[str] = Query(None, alias="label"),
-    partition_by: schemas.FeatureStorePartitionByField = Query(
+    partition_by: mlrun.common.schemas.FeatureStorePartitionByField = Query(
         None, alias="partition-by"
     ),
     rows_per_partition: int = Query(1, alias="rows-per-partition", gt=0),
-    partition_sort_by: schemas.SortField = Query(None, alias="partition-sort-by"),
-    partition_order: schemas.OrderType = Query(
-        schemas.OrderType.desc, alias="partition-order"
+    partition_sort_by: mlrun.common.schemas.SortField = Query(
+        None, alias="partition-sort-by"
+    ),
+    partition_order: mlrun.common.schemas.OrderType = Query(
+        mlrun.common.schemas.OrderType.desc, alias="partition-order"
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     feature_vectors = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().list_feature_vectors,
         db_session,
         project,
         name,
@@ -635,102 +654,102 @@
         labels,
         partition_by,
         rows_per_partition,
         partition_sort_by,
         partition_order,
     )
     feature_vectors = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
         feature_vectors.feature_vectors,
         lambda feature_vector: (
             feature_vector.metadata.project,
             feature_vector.metadata.name,
         ),
         auth_info,
     )
     await asyncio.gather(
         *[
             _verify_feature_vector_features_permissions(auth_info, project, fv.dict())
             for fv in feature_vectors
         ]
     )
-    return mlrun.api.schemas.FeatureVectorsOutput(feature_vectors=feature_vectors)
+    return mlrun.common.schemas.FeatureVectorsOutput(feature_vectors=feature_vectors)
 
 
 @router.get(
     "/projects/{project}/feature-vectors/{name}/tags",
-    response_model=schemas.FeatureVectorsTagsOutput,
+    response_model=mlrun.common.schemas.FeatureVectorsTagsOutput,
 )
 async def list_feature_vectors_tags(
     project: str,
     name: str,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if name != "*":
         raise mlrun.errors.MLRunInvalidArgumentError(
             "Listing a specific feature vector tags is not supported, set name to *"
         )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     tag_tuples = await run_in_threadpool(
         mlrun.api.crud.FeatureStore().list_feature_vectors_tags,
         db_session,
         project,
     )
     feature_vector_name_to_tag = {
         tag_tuple[1]: tag_tuple[2] for tag_tuple in tag_tuples
     }
     auth_verifier = mlrun.api.utils.auth.verifier.AuthVerifier()
     allowed_feature_vector_names = (
         await auth_verifier.filter_project_resources_by_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+            mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
             list(feature_vector_name_to_tag.keys()),
             lambda feature_vector_name: (
                 project,
                 feature_vector_name,
             ),
             auth_info,
         )
     )
     tags = {
         tag_tuple[2]
         for tag_tuple in tag_tuples
         if tag_tuple[1] in allowed_feature_vector_names
     }
-    return mlrun.api.schemas.FeatureVectorsTagsOutput(tags=list(tags))
+    return mlrun.common.schemas.FeatureVectorsTagsOutput(tags=list(tags))
 
 
 @router.put(
     "/projects/{project}/feature-vectors/{name}/references/{reference}",
-    response_model=schemas.FeatureVector,
+    response_model=mlrun.common.schemas.FeatureVector,
 )
 async def store_feature_vector(
     project: str,
     name: str,
     reference: str,
-    feature_vector: schemas.FeatureVector,
+    feature_vector: mlrun.common.schemas.FeatureVector,
     versioned: bool = True,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     await _verify_feature_vector_features_permissions(
         auth_info, project, feature_vector.dict()
     )
     tag, uid = parse_reference(reference)
     uid = await run_in_threadpool(
@@ -756,25 +775,26 @@
 
 @router.patch("/projects/{project}/feature-vectors/{name}/references/{reference}")
 async def patch_feature_vector(
     project: str,
     name: str,
     feature_vector_patch: dict,
     reference: str,
-    patch_mode: schemas.PatchMode = Header(
-        schemas.PatchMode.replace, alias=schemas.HeaderNames.patch_mode
+    patch_mode: mlrun.common.schemas.PatchMode = Header(
+        mlrun.common.schemas.PatchMode.replace,
+        alias=mlrun.common.schemas.HeaderNames.patch_mode,
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     await _verify_feature_vector_features_permissions(
         auth_info, project, feature_vector_patch
     )
     tag, uid = parse_reference(reference)
     await run_in_threadpool(
@@ -792,22 +812,22 @@
 
 @router.delete("/projects/{project}/feature-vectors/{name}")
 @router.delete("/projects/{project}/feature-vectors/{name}/references/{reference}")
 async def delete_feature_vector(
     project: str,
     name: str,
     reference: str = None,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_vector,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     tag = uid = None
     if reference:
         tag, uid = parse_reference(reference)
     await run_in_threadpool(
         mlrun.api.crud.FeatureStore().delete_feature_vector,
@@ -817,15 +837,15 @@
         tag,
         uid,
     )
     return Response(status_code=HTTPStatus.NO_CONTENT.value)
 
 
 async def _verify_feature_vector_features_permissions(
-    auth_info: mlrun.api.schemas.AuthInfo, project: str, feature_vector: dict
+    auth_info: mlrun.common.schemas.AuthInfo, project: str, feature_vector: dict
 ):
     features = []
     if feature_vector.get("spec", {}).get("features"):
         features.extend(feature_vector["spec"]["features"])
     if feature_vector.get("spec", {}).get("label_feature"):
         features.append(feature_vector["spec"]["label_feature"])
     feature_set_project_to_name_set_map = {}
@@ -836,16 +856,16 @@
         )
         feature_set_project_to_name_set_map.setdefault(_project, set()).add(name)
     feature_set_project_name_tuples = []
     for _project, names in feature_set_project_to_name_set_map.items():
         for name in names:
             feature_set_project_name_tuples.append((_project, name))
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resources_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set,
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set,
         feature_set_project_name_tuples,
         lambda feature_set_project_name_tuple: (
             feature_set_project_name_tuple[0],
             feature_set_project_name_tuple[1],
         ),
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
```

## mlrun/api/api/endpoints/files.py

```diff
@@ -16,16 +16,16 @@
 from http import HTTPStatus
 
 import fastapi
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
 import mlrun.api.crud.secrets
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
+import mlrun.common.schemas
 from mlrun.api.api.utils import get_obj_path, get_secrets, log_and_raise
 from mlrun.datastore import store_manager
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
 
@@ -33,15 +33,15 @@
 @router.get("/files")
 def get_files(
     schema: str = "",
     objpath: str = fastapi.Query("", alias="path"),
     user: str = "",
     size: int = 0,
     offset: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     return _get_files(schema, objpath, user, size, offset, auth_info)
 
 
 @router.get("/projects/{project}/files")
@@ -49,21 +49,21 @@
     project: str,
     schema: str = "",
     objpath: str = fastapi.Query("", alias="path"),
     user: str = "",
     size: int = 0,
     offset: int = 0,
     use_secrets: bool = fastapi.Query(True, alias="use-secrets"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     secrets = {}
     if use_secrets:
         secrets = await _verify_and_get_project_secrets(project, auth_info)
 
@@ -72,36 +72,36 @@
     )
 
 
 @router.get("/filestat")
 def get_filestat(
     schema: str = "",
     path: str = "",
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     user: str = "",
 ):
     return _get_filestat(schema, path, user, auth_info)
 
 
 @router.get("/projects/{project}/filestat")
 async def get_filestat_with_project_secrets(
     project: str,
     schema: str = "",
     path: str = "",
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     user: str = "",
     use_secrets: bool = fastapi.Query(True, alias="use-secrets"),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     secrets = {}
     if use_secrets:
         secrets = await _verify_and_get_project_secrets(project, auth_info)
 
@@ -112,15 +112,15 @@
 
 def _get_files(
     schema: str,
     objpath: str,
     user: str,
     size: int,
     offset: int,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     secrets: dict = None,
 ):
     _, filename = objpath.split(objpath)
 
     objpath = get_obj_path(schema, objpath, user=user)
     if not objpath:
         log_and_raise(
@@ -158,15 +158,15 @@
     )
 
 
 def _get_filestat(
     schema: str,
     path: str,
     user: str,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     secrets: dict = None,
 ):
     _, filename = path.split(path)
 
     path = get_obj_path(schema, path, user=user)
     if not path:
         log_and_raise(
@@ -193,20 +193,20 @@
         "modified": stat.modified,
         "mimetype": ctype,
     }
 
 
 async def _verify_and_get_project_secrets(project, auth_info):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.secret,
+        mlrun.common.schemas.AuthorizationResourceTypes.secret,
         project,
-        mlrun.api.schemas.SecretProviderName.kubernetes,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.SecretProviderName.kubernetes,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     secrets_data = await run_in_threadpool(
         mlrun.api.crud.Secrets().list_project_secrets,
         project,
-        mlrun.api.schemas.SecretProviderName.kubernetes,
+        mlrun.common.schemas.SecretProviderName.kubernetes,
         allow_secrets_from_k8s=True,
     )
     return secrets_data.secrets or {}
```

## mlrun/api/api/endpoints/frontend_spec.py

```diff
@@ -14,33 +14,33 @@
 #
 import typing
 
 import fastapi
 import semver
 
 import mlrun.api.api.deps
-import mlrun.api.schemas
 import mlrun.api.utils.clients.iguazio
 import mlrun.builder
+import mlrun.common.schemas
 import mlrun.runtimes
 import mlrun.runtimes.utils
 import mlrun.utils.helpers
 from mlrun.api.api.utils import get_allowed_path_prefixes_list
 from mlrun.config import config
 from mlrun.platforms import is_iguazio_session_cookie
 
 router = fastapi.APIRouter()
 
 
 @router.get(
     "/frontend-spec",
-    response_model=mlrun.api.schemas.FrontendSpec,
+    response_model=mlrun.common.schemas.FrontendSpec,
 )
 def get_frontend_spec(
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     # In Iguazio 3.0 auth is turned off, but for this endpoint specifically the session is a must, so getting it from
     # the cookie like it was before
     # TODO: remove when Iguazio 3.0 is no longer relevant
     session: typing.Optional[str] = fastapi.Cookie(None),
 ):
@@ -62,15 +62,15 @@
     )
     registries_to_enforce_prefix = (
         mlrun.runtimes.utils.resolve_function_target_image_registries_to_enforce_prefix()
     )
     function_target_image_name_prefix_template = (
         config.httpdb.builder.function_target_image_name_prefix_template
     )
-    return mlrun.api.schemas.FrontendSpec(
+    return mlrun.common.schemas.FrontendSpec(
         jobs_dashboard_url=jobs_dashboard_url,
         abortable_function_kinds=mlrun.runtimes.RuntimeKinds.abortable_runtimes(),
         feature_flags=feature_flags,
         default_function_priority_class_name=config.default_function_priority_class_name,
         valid_function_priority_class_names=config.get_valid_function_priority_class_names(),
         default_function_image_by_kind=mlrun.mlconf.function_defaults.image_by_kind.to_dict(),
         function_deployment_target_image_template=function_deployment_target_image_template,
@@ -98,31 +98,31 @@
         return (
             f"{grafana_service_url}/d/mlrun-jobs-monitoring/mlrun-jobs-monitoring?orgId=1&var-groupBy={{filter_name}}"
             f"&var-filter={{filter_value}}"
         )
     return None
 
 
-def _resolve_feature_flags() -> mlrun.api.schemas.FeatureFlags:
-    project_membership = mlrun.api.schemas.ProjectMembershipFeatureFlag.disabled
+def _resolve_feature_flags() -> mlrun.common.schemas.FeatureFlags:
+    project_membership = mlrun.common.schemas.ProjectMembershipFeatureFlag.disabled
     if mlrun.mlconf.httpdb.authorization.mode == "opa":
-        project_membership = mlrun.api.schemas.ProjectMembershipFeatureFlag.enabled
-    authentication = mlrun.api.schemas.AuthenticationFeatureFlag(
+        project_membership = mlrun.common.schemas.ProjectMembershipFeatureFlag.enabled
+    authentication = mlrun.common.schemas.AuthenticationFeatureFlag(
         mlrun.mlconf.httpdb.authentication.mode
     )
-    nuclio_streams = mlrun.api.schemas.NuclioStreamsFeatureFlag.disabled
+    nuclio_streams = mlrun.common.schemas.NuclioStreamsFeatureFlag.disabled
 
     if mlrun.mlconf.get_parsed_igz_version() and semver.VersionInfo.parse(
         mlrun.runtimes.utils.resolve_nuclio_version()
     ) >= semver.VersionInfo.parse("1.7.8"):
-        nuclio_streams = mlrun.api.schemas.NuclioStreamsFeatureFlag.enabled
+        nuclio_streams = mlrun.common.schemas.NuclioStreamsFeatureFlag.enabled
 
-    preemption_nodes = mlrun.api.schemas.PreemptionNodesFeatureFlag.disabled
+    preemption_nodes = mlrun.common.schemas.PreemptionNodesFeatureFlag.disabled
     if mlrun.mlconf.is_preemption_nodes_configured():
-        preemption_nodes = mlrun.api.schemas.PreemptionNodesFeatureFlag.enabled
+        preemption_nodes = mlrun.common.schemas.PreemptionNodesFeatureFlag.enabled
 
-    return mlrun.api.schemas.FeatureFlags(
+    return mlrun.common.schemas.FeatureFlags(
         project_membership=project_membership,
         authentication=authentication,
         nuclio_streams=nuclio_streams,
         preemption_nodes=preemption_nodes,
     )
```

## mlrun/api/api/endpoints/functions.py

```diff
@@ -30,60 +30,59 @@
     Request,
     Response,
 )
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
+import mlrun.api.crud.runtimes.nuclio.function
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.background_tasks
 import mlrun.api.utils.clients.chief
+import mlrun.api.utils.singletons.k8s
 import mlrun.api.utils.singletons.project_member
-import mlrun.model_monitoring.constants
+import mlrun.common.model_monitoring
+import mlrun.common.schemas
 from mlrun.api.api import deps
 from mlrun.api.api.utils import get_run_db_instance, log_and_raise, log_path
 from mlrun.api.crud.secrets import Secrets, SecretsClientType
-from mlrun.api.schemas import SecretProviderName, SecretsData
-from mlrun.api.utils.singletons.k8s import get_k8s
 from mlrun.builder import build_runtime
 from mlrun.config import config
 from mlrun.errors import MLRunRuntimeError, err_to_str
 from mlrun.run import new_function
 from mlrun.runtimes import RuntimeKinds, ServingRuntime, runtime_resources_map
-from mlrun.runtimes.function import deploy_nuclio_function, get_nuclio_deploy_status
 from mlrun.runtimes.utils import get_item_name
 from mlrun.utils import get_in, logger, parse_versioned_object_uri, update_in
 from mlrun.utils.model_monitoring import parse_model_endpoint_store_prefix
 
 router = APIRouter()
 
 
 @router.post("/func/{project}/{name}")
 async def store_function(
     request: Request,
     project: str,
     name: str,
     tag: str = "",
     versioned: bool = False,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     data = None
     try:
         data = await request.json()
     except ValueError:
         log_and_raise(HTTPStatus.BAD_REQUEST.value, reason="bad JSON body")
@@ -106,51 +105,51 @@
 
 @router.get("/func/{project}/{name}")
 async def get_function(
     project: str,
     name: str,
     tag: str = "",
     hash_key="",
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     func = await run_in_threadpool(
         mlrun.api.crud.Functions().get_function,
         db_session,
         name,
         project,
         tag,
         hash_key,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return {
         "func": func,
     }
 
 
 @router.delete(
     "/projects/{project}/functions/{name}", status_code=HTTPStatus.NO_CONTENT.value
 )
 async def delete_function(
     project: str,
     name: str,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     await run_in_threadpool(
         mlrun.api.crud.Functions().delete_function, db_session, project, name
     )
     return Response(status_code=HTTPStatus.NO_CONTENT.value)
 
@@ -158,35 +157,35 @@
 @router.get("/funcs")
 async def list_functions(
     project: str = None,
     name: str = None,
     tag: str = None,
     labels: List[str] = Query([], alias="label"),
     hash_key: str = None,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if project is None:
         project = config.default_project
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     functions = await run_in_threadpool(
         mlrun.api.crud.Functions().list_functions,
         db_session=db_session,
         project=project,
         name=name,
         tag=tag,
         labels=labels,
         hash_key=hash_key,
     )
     functions = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         functions,
         lambda function: (
             function.get("metadata", {}).get("project", mlrun.mlconf.default_project),
             function["metadata"]["name"],
         ),
         auth_info,
     )
@@ -195,21 +194,21 @@
     }
 
 
 @router.post("/build/function")
 @router.post("/build/function/")
 async def build_function(
     request: Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
     client_version: Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.client_version
+        None, alias=mlrun.common.schemas.HeaderNames.client_version
     ),
     client_python_version: Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.python_version
+        None, alias=mlrun.common.schemas.HeaderNames.python_version
     ),
 ):
     data = None
     try:
         data = await request.json()
     except ValueError:
         log_and_raise(HTTPStatus.BAD_REQUEST.value, reason="bad JSON body")
@@ -221,30 +220,30 @@
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         project,
         function_name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
 
     # schedules are meant to be run solely by the chief then if serving function and track_models is enabled,
     # it means that schedules will be created as part of building the function, and if not chief then redirect to chief.
     # to reduce redundant load on the chief, we re-route the request only if the user has permissions
     if function.get("kind", "") == mlrun.runtimes.RuntimeKinds.serving and function.get(
         "spec", {}
     ).get("track_models", False):
         if (
             mlrun.mlconf.httpdb.clusterization.role
-            != mlrun.api.schemas.ClusterizationRole.chief
+            != mlrun.common.schemas.ClusterizationRole.chief
         ):
             logger.info(
                 "Requesting to deploy serving function with track models, re-routing to chief",
                 function_name=function_name,
                 project=project,
                 function=function,
             )
@@ -271,43 +270,43 @@
     )
     return {
         "data": fn.to_dict(),
         "ready": ready,
     }
 
 
-@router.post("/start/function", response_model=mlrun.api.schemas.BackgroundTask)
-@router.post("/start/function/", response_model=mlrun.api.schemas.BackgroundTask)
+@router.post("/start/function", response_model=mlrun.common.schemas.BackgroundTask)
+@router.post("/start/function/", response_model=mlrun.common.schemas.BackgroundTask)
 async def start_function(
     request: Request,
     background_tasks: BackgroundTasks,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
     client_version: Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.client_version
+        None, alias=mlrun.common.schemas.HeaderNames.client_version
     ),
     client_python_version: Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.python_version
+        None, alias=mlrun.common.schemas.HeaderNames.python_version
     ),
 ):
     # TODO: ensure project here !!! for background task
     data = None
     try:
         data = await request.json()
     except ValueError:
         log_and_raise(HTTPStatus.BAD_REQUEST.value, reason="bad JSON body")
 
     logger.info("Got request to start function", body=data)
 
     function = await run_in_threadpool(_parse_start_function_body, db_session, data)
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         function.metadata.project,
         function.metadata.name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     background_timeout = mlrun.mlconf.background_tasks.default_timeouts.runtimes.dask
 
     background_task = await run_in_threadpool(
         mlrun.api.utils.background_tasks.ProjectBackgroundTasksHandler().create_background_task,
         db_session,
@@ -325,15 +324,15 @@
     return background_task
 
 
 @router.post("/status/function")
 @router.post("/status/function/")
 async def function_status(
     request: Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
 ):
     data = None
     try:
         data = await request.json()
     except ValueError:
         log_and_raise(HTTPStatus.BAD_REQUEST.value, reason="bad JSON body")
 
@@ -349,24 +348,24 @@
     name: str = "",
     project: str = "",
     tag: str = "",
     offset: int = 0,
     logs: bool = True,
     last_log_timestamp: float = 0.0,
     verbose: bool = False,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         project or mlrun.mlconf.default_project,
         name,
         # store since with the current mechanism we update the status (and store the function) in the DB when a client
         # query for the status
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     fn = await run_in_threadpool(
         mlrun.api.crud.Functions().get_function, db_session, name, project, tag
     )
     if not fn:
         log_and_raise(HTTPStatus.NOT_FOUND.value, name=name, project=project, tag=tag)
@@ -414,15 +413,15 @@
 ):
     # job deploy status
     state = get_in(fn, "status.state", "")
     pod = get_in(fn, "status.build_pod", "")
     image = get_in(fn, "spec.build.image", "")
     out = b""
     if not pod:
-        if state == mlrun.api.schemas.FunctionState.ready:
+        if state == mlrun.common.schemas.FunctionState.ready:
             # when the function has been built we set the created image into the `spec.image` for reference see at the
             # end of the function where we resolve if the status is ready and then set the spec.build.image to
             # spec.image
             # TODO: spec shouldn't hold backend enriched attributes, but rather in the status block
             #   therefore need set it as a new attribute in status.image which will ease our resolution
             #   of whether it is a user defined image or MLRun enriched one.
             image = image or get_in(fn, "spec.image")
@@ -437,15 +436,15 @@
         )
 
     # read from log file
     terminal_states = ["failed", "error", "ready"]
     log_file = log_path(project, f"build_{name}__{tag or 'latest'}")
     if state in terminal_states and log_file.exists():
 
-        if state == mlrun.api.schemas.FunctionState.ready:
+        if state == mlrun.common.schemas.FunctionState.ready:
             # when the function has been built we set the created image into the `spec.image` for reference see at the
             # end of the function where we resolve if the status is ready and then set the spec.build.image to
             # spec.image
             # TODO: spec shouldn't hold backend enriched attributes, but rather in the status block
             #   therefore need set it as a new attribute in status.image which will ease our resolution
             #   of whether it is a user defined image or MLRun enriched one.
             image = image or get_in(fn, "spec.image")
@@ -461,41 +460,43 @@
                 "function_status": state,
                 "function_image": image,
                 "builder_pod": pod,
             },
         )
 
     logger.info(f"get pod {pod} status")
-    state = get_k8s().get_pod_status(pod)
+    state = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False).get_pod_status(
+        pod
+    )
     logger.info(f"pod state={state}")
 
     if state == "succeeded":
         logger.info("build completed successfully")
-        state = mlrun.api.schemas.FunctionState.ready
+        state = mlrun.common.schemas.FunctionState.ready
     if state in ["failed", "error"]:
         logger.error(f"build {state}, watch the build pod logs: {pod}")
-        state = mlrun.api.schemas.FunctionState.error
+        state = mlrun.common.schemas.FunctionState.error
 
     if (logs and state != "pending") or state in terminal_states:
-        resp = get_k8s().logs(pod)
+        resp = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False).logs(pod)
         if state in terminal_states:
             log_file.parent.mkdir(parents=True, exist_ok=True)
             with log_file.open("wb") as fp:
                 fp.write(resp.encode())
 
         if resp and logs:
             # begin from the offset number and then encode
             out = resp[offset:].encode()
 
     update_in(fn, "status.state", state)
-    if state == mlrun.api.schemas.FunctionState.ready:
+    if state == mlrun.common.schemas.FunctionState.ready:
         update_in(fn, "spec.image", image)
 
     versioned = False
-    if state == mlrun.api.schemas.FunctionState.ready:
+    if state == mlrun.common.schemas.FunctionState.ready:
         versioned = True
     mlrun.api.crud.Functions().store_function(
         db_session,
         fn,
         name,
         project,
         tag,
@@ -520,15 +521,15 @@
     (
         state,
         _,
         nuclio_name,
         last_log_timestamp,
         text,
         status,
-    ) = get_nuclio_deploy_status(
+    ) = mlrun.api.crud.runtimes.nuclio.function.get_nuclio_deploy_status(
         name,
         project,
         tag,
         # Workaround since when passing 0.0 to nuclio current timestamp is used and no logs are returned
         last_log_timestamp=last_log_timestamp or 1.0,
         verbose=verbose,
         auth_info=auth_info,
@@ -592,15 +593,15 @@
             "x-mlrun-name": nuclio_name,
         },
     )
 
 
 def _build_function(
     db_session,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     function,
     with_mlrun=True,
     skip_deployed=False,
     mlrun_version_specifier=None,
     builder_env=None,
     client_version=None,
     client_python_version=None,
@@ -627,34 +628,41 @@
             )
 
             if fn.kind == RuntimeKinds.serving:
                 # Handle model monitoring
                 try:
                     if fn.spec.track_models:
                         logger.info("Tracking enabled, initializing model monitoring")
-                        _init_serving_function_stream_args(fn=fn)
-                        # get model monitoring access key
-                        model_monitoring_access_key = _process_model_monitoring_secret(
-                            db_session,
-                            fn.metadata.project,
-                            mlrun.model_monitoring.constants.ProjectSecretKeys.ACCESS_KEY,
-                        )
 
-                        # initialize model monitoring stream
-                        _create_model_monitoring_stream(project=fn.metadata.project)
+                        # Generating model monitoring access key
+                        model_monitoring_access_key = None
+                        if not mlrun.mlconf.is_ce_mode():
+                            model_monitoring_access_key = _process_model_monitoring_secret(
+                                db_session,
+                                fn.metadata.project,
+                                mlrun.common.model_monitoring.ProjectSecretKeys.ACCESS_KEY,
+                            )
+                            if mlrun.utils.model_monitoring.get_stream_path(
+                                project=fn.metadata.project
+                            ).startswith("v3io://"):
+                                # Initialize model monitoring V3IO stream
+                                _create_model_monitoring_stream(
+                                    project=fn.metadata.project,
+                                    function=fn,
+                                )
 
                         if fn.spec.tracking_policy:
-                            # convert to `TrackingPolicy` object as `fn.spec.tracking_policy` is provided as a dict
+                            # Convert to `TrackingPolicy` object as `fn.spec.tracking_policy` is provided as a dict
                             fn.spec.tracking_policy = (
                                 mlrun.utils.model_monitoring.TrackingPolicy.from_dict(
                                     fn.spec.tracking_policy
                                 )
                             )
                         else:
-                            # initialize tracking policy with default values
+                            # Initialize tracking policy with default values
                             fn.spec.tracking_policy = (
                                 mlrun.utils.model_monitoring.TrackingPolicy()
                             )
 
                         # deploy both model monitoring stream and model monitoring batch job
                         mlrun.api.crud.ModelEndpoints().deploy_monitoring_functions(
                             project=fn.metadata.project,
@@ -667,15 +675,15 @@
                     logger.warning(
                         "Failed deploying model monitoring infrastructure for the project",
                         project=fn.metadata.project,
                         exc=exc,
                         traceback=traceback.format_exc(),
                     )
 
-            deploy_nuclio_function(
+            mlrun.api.crud.runtimes.nuclio.function.deploy_nuclio_function(
                 fn,
                 auth_info=auth_info,
                 client_version=client_version,
                 client_python_version=client_python_version,
                 builder_env=builder_env,
             )
             # deploy only start the process, the get status API is used to check readiness
@@ -729,15 +737,15 @@
         )
 
     return new_function(runtime=runtime)
 
 
 def _start_function(
     function,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     client_version: str = None,
     client_python_version: str = None,
 ):
     db_session = mlrun.api.db.session.create_session()
     try:
         resource = runtime_resources_map.get(function.kind)
         if "start" not in resource:
@@ -767,15 +775,15 @@
                 HTTPStatus.BAD_REQUEST.value,
                 reason=f"runtime error: {err_to_str(err)}",
             )
     finally:
         mlrun.api.db.session.close_session(db_session)
 
 
-async def _get_function_status(data, auth_info: mlrun.api.schemas.AuthInfo):
+async def _get_function_status(data, auth_info: mlrun.common.schemas.AuthInfo):
     logger.info(f"function_status:\n{data}")
     selector = data.get("selector")
     kind = data.get("kind")
     if not selector or not kind:
         log_and_raise(
             HTTPStatus.BAD_REQUEST.value,
             reason="runtime error: selector or runtime kind not specified",
@@ -783,18 +791,18 @@
     project, name = data.get("project"), data.get("name")
     # Only after 0.6.6 the client start sending the project and name, as long as 0.6.6 is a valid version we'll need
     # to try and resolve them from the selector. TODO: remove this when 0.6.6 is not relevant anymore
     if not project or not name:
         project, name, _ = mlrun.runtimes.utils.parse_function_selector(selector)
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.function,
+        mlrun.common.schemas.AuthorizationResourceTypes.function,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     resource = runtime_resources_map.get(kind)
     if "status" not in resource:
         log_and_raise(
             HTTPStatus.BAD_REQUEST.value,
@@ -808,17 +816,20 @@
         logger.error(traceback.format_exc())
         log_and_raise(
             HTTPStatus.BAD_REQUEST.value,
             reason=f"runtime error: {err_to_str(err)}",
         )
 
 
-def _create_model_monitoring_stream(project: str):
-    stream_path = config.model_endpoint_monitoring.store_prefixes.default.format(
-        project=project, kind="stream"
+def _create_model_monitoring_stream(project: str, function):
+
+    _init_serving_function_stream_args(fn=function)
+
+    stream_path = mlrun.mlconf.get_model_monitoring_file_target_path(
+        project=project, kind="events"
     )
 
     _, container, stream_path = parse_model_endpoint_store_prefix(stream_path)
 
     # TODO: How should we configure sharding here?
     logger.info(
         "Creating model endpoint stream for project",
@@ -872,16 +883,15 @@
     # The expected result of this method is an access-key placed in an internal project-secret.
     # If the user provided an access-key as the "regular" secret_key, then we delete this secret and move contents
     # to the internal secret instead. Else, if the internal secret already contained a value, keep it. Last option
     # (which is the recommended option for users) is to retrieve a new access-key from the project owner and use it.
     logger.info(
         "Getting project secret", project_name=project_name, namespace=config.namespace
     )
-
-    provider = SecretProviderName.kubernetes
+    provider = mlrun.common.schemas.SecretProviderName.kubernetes
     secret_value = Secrets().get_project_secret(
         project_name,
         provider,
         secret_key,
         allow_secrets_from_k8s=True,
     )
     user_provided_key = secret_value is not None
@@ -912,15 +922,17 @@
 
             logger.info(
                 "Filling model monitoring access-key from project owner",
                 project_name=project_name,
                 project_owner=project_owner.username,
             )
 
-    secrets = SecretsData(provider=provider, secrets={internal_key_name: secret_value})
+    secrets = mlrun.common.schemas.SecretsData(
+        provider=provider, secrets={internal_key_name: secret_value}
+    )
     Secrets().store_project_secrets(project_name, secrets, allow_internal_secrets=True)
     if user_provided_key:
         logger.info(
             "Deleting user-provided access-key - replaced with an internal secret"
         )
         Secrets().delete_project_secret(project_name, provider, secret_key)
```

## mlrun/api/api/endpoints/grafana_proxy.py

```diff
@@ -19,19 +19,18 @@
 
 from fastapi import APIRouter, Depends, Request, Response
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
 import mlrun.api.crud.model_monitoring.grafana
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
-import mlrun.model_monitoring
+import mlrun.common.model_monitoring
+import mlrun.common.schemas
 from mlrun.api.api import deps
-from mlrun.api.schemas import GrafanaTable, GrafanaTimeSeriesTarget
 
 router = APIRouter()
 
 NAME_TO_SEARCH_FUNCTION_DICTIONARY = {
     "list_projects": mlrun.api.crud.model_monitoring.grafana.grafana_list_projects,
 }
 NAME_TO_QUERY_FUNCTION_DICTIONARY = {
@@ -43,28 +42,29 @@
 
 SUPPORTED_QUERY_FUNCTIONS = set(NAME_TO_QUERY_FUNCTION_DICTIONARY.keys())
 SUPPORTED_SEARCH_FUNCTIONS = set(NAME_TO_SEARCH_FUNCTION_DICTIONARY)
 
 
 @router.get("/grafana-proxy/model-endpoints", status_code=HTTPStatus.OK.value)
 def grafana_proxy_model_endpoints_check_connection(
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
 ):
     """
     Root of grafana proxy for the model-endpoints API, used for validating the model-endpoints data source
     connectivity.
     """
-    mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
+    if not mlrun.mlconf.is_ce_mode():
+        mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
     return Response(status_code=HTTPStatus.OK.value)
 
 
 @router.post("/grafana-proxy/model-endpoints/search", response_model=List[str])
 async def grafana_proxy_model_endpoints_search(
     request: Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ) -> List[str]:
     """
     Search route for model-endpoints grafana proxy API, used for creating an interface between grafana queries and
     model-endpoints logic.
 
     This implementation requires passing target_endpoint query parameter in order to dispatch different
@@ -72,15 +72,16 @@
 
     :param request:    An api request with the required target and parameters.
     :param auth_info:  The auth info of the request.
     :param db_session: A session that manages the current dialog with the database.
 
     :return: List of results. e.g. list of available project names.
     """
-    mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
+    if not mlrun.mlconf.is_ce_mode():
+        mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
     body = await request.json()
     query_parameters = mlrun.api.crud.model_monitoring.grafana.parse_search_parameters(
         body
     )
     mlrun.api.crud.model_monitoring.grafana.validate_query_parameters(
         query_parameters, SUPPORTED_SEARCH_FUNCTIONS
     )
@@ -97,20 +98,29 @@
             function, db_session, auth_info, query_parameters
         )
     return result
 
 
 @router.post(
     "/grafana-proxy/model-endpoints/query",
-    response_model=List[Union[GrafanaTable, GrafanaTimeSeriesTarget]],
+    response_model=List[
+        Union[
+            mlrun.common.schemas.GrafanaTable,
+            mlrun.common.schemas.GrafanaTimeSeriesTarget,
+        ]
+    ],
 )
 async def grafana_proxy_model_endpoints_query(
     request: Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
-) -> List[Union[GrafanaTable, GrafanaTimeSeriesTarget]]:
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
+) -> List[
+    Union[
+        mlrun.common.schemas.GrafanaTable, mlrun.common.schemas.GrafanaTimeSeriesTarget
+    ]
+]:
     """
     Query route for model-endpoints grafana proxy API, used for creating an interface between grafana queries and
     model-endpoints logic.
 
     This implementation requires passing target_endpoint query parameter in order to dispatch different
     model-endpoint monitoring functions.
     """
```

## mlrun/api/api/endpoints/healthz.py

```diff
@@ -12,31 +12,31 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import http
 
 from fastapi import APIRouter
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 from mlrun.config import config as mlconfig
 
 router = APIRouter()
 
 
 @router.get(
     "/healthz",
     status_code=http.HTTPStatus.OK.value,
 )
 def health():
 
     # offline is the initial state
     # waiting for chief is set for workers waiting for chief to be ready and then clusterize against it
     if mlconfig.httpdb.state in [
-        mlrun.api.schemas.APIStates.offline,
-        mlrun.api.schemas.APIStates.waiting_for_chief,
+        mlrun.common.schemas.APIStates.offline,
+        mlrun.common.schemas.APIStates.waiting_for_chief,
     ]:
         raise mlrun.errors.MLRunServiceUnavailableError()
 
     return {
         # for old `align_mlrun.sh` scripts expecting `version` in the response
         # TODO: remove on mlrun >= 1.6.0
         "version": mlconfig.version,
```

## mlrun/api/api/endpoints/logs.py

```diff
@@ -14,35 +14,35 @@
 #
 import fastapi
 import sqlalchemy.orm
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
+import mlrun.common.schemas
 
 router = fastapi.APIRouter()
 
 
 @router.post("/log/{project}/{uid}")
 async def store_log(
     request: fastapi.Request,
     project: str,
     uid: str,
     append: bool = True,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.log,
+        mlrun.common.schemas.AuthorizationResourceTypes.log,
         project,
         uid,
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     body = await request.body()
     await run_in_threadpool(
         mlrun.api.crud.Logs().store_log,
         body,
         project,
@@ -54,26 +54,26 @@
 
 @router.get("/log/{project}/{uid}")
 async def get_log(
     project: str,
     uid: str,
     size: int = -1,
     offset: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.log,
+        mlrun.common.schemas.AuthorizationResourceTypes.log,
         project,
         uid,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     run_state, log_stream = await mlrun.api.crud.Logs().get_logs(
         db_session, project, uid, size, offset
     )
     headers = {
         "x-mlrun-run-state": run_state,
```

## mlrun/api/api/endpoints/model_endpoints.py

```diff
@@ -20,51 +20,51 @@
 
 from fastapi import APIRouter, Depends, Query
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.deps
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
+import mlrun.common.schemas
 from mlrun.errors import MLRunConflictError
 
 router = APIRouter()
 
 
 @router.put(
     "/projects/{project}/model-endpoints/{endpoint_id}",
-    response_model=mlrun.api.schemas.ModelEndpoint,
+    response_model=mlrun.common.schemas.ModelEndpoint,
 )
 async def create_or_patch(
     project: str,
     endpoint_id: str,
-    model_endpoint: mlrun.api.schemas.ModelEndpoint,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    model_endpoint: mlrun.common.schemas.ModelEndpoint,
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-) -> mlrun.api.schemas.ModelEndpoint:
+) -> mlrun.common.schemas.ModelEndpoint:
     """
     Either create or update the record of a given `ModelEndpoint` object.
     Leaving here for backwards compatibility.
     """
 
     warnings.warn(
         "This PUT call is deprecated, please use POST for create or PATCH for update"
         "This will be removed in 1.5.0",
         # TODO: Remove this API in 1.5.0
         FutureWarning,
     )
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project,
         endpoint_id,
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     # get_access_key will validate the needed auth (which is used later) exists in the request
     mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
     if project != model_endpoint.metadata.project:
         raise MLRunConflictError(
             f"Can't store endpoint of project {model_endpoint.metadata.project} into project {project}"
@@ -83,25 +83,25 @@
         model_endpoint=model_endpoint,
         auth_info=auth_info,
     )
 
 
 @router.post(
     "/projects/{project}/model-endpoints/{endpoint_id}",
-    response_model=mlrun.api.schemas.ModelEndpoint,
+    response_model=mlrun.common.schemas.ModelEndpoint,
 )
 async def create_model_endpoint(
     project: str,
     endpoint_id: str,
-    model_endpoint: mlrun.api.schemas.ModelEndpoint,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    model_endpoint: mlrun.common.schemas.ModelEndpoint,
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-) -> mlrun.api.schemas.ModelEndpoint:
+) -> mlrun.common.schemas.ModelEndpoint:
     """
     Create a DB record of a given `ModelEndpoint` object.
 
     :param project:         The name of the project.
     :param endpoint_id:     The unique id of the model endpoint.
     :param model_endpoint:  Model endpoint object to record in DB.
     :param auth_info:       The auth info of the request.
@@ -109,18 +109,18 @@
                             endpoint id record, we need to use the db session for getting information from an existing
                             model artifact and also for storing the new model monitoring feature set.
 
     :return: A Model endpoint object.
     """
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        resource_type=mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        resource_type=mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project_name=project,
         resource_name=endpoint_id,
-        action=mlrun.api.schemas.AuthorizationAction.store,
+        action=mlrun.common.schemas.AuthorizationAction.store,
         auth_info=auth_info,
     )
 
     if project != model_endpoint.metadata.project:
         raise MLRunConflictError(
             f"Can't store endpoint of project {model_endpoint.metadata.project} into project {project}"
         )
@@ -135,24 +135,24 @@
         db_session=db_session,
         model_endpoint=model_endpoint,
     )
 
 
 @router.patch(
     "/projects/{project}/model-endpoints/{endpoint_id}",
-    response_model=mlrun.api.schemas.ModelEndpoint,
+    response_model=mlrun.common.schemas.ModelEndpoint,
 )
 async def patch_model_endpoint(
     project: str,
     endpoint_id: str,
     attributes: str = None,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
-) -> mlrun.api.schemas.ModelEndpoint:
+) -> mlrun.common.schemas.ModelEndpoint:
     """
     Update a DB record of a given `ModelEndpoint` object.
 
     :param project:       The name of the project.
     :param endpoint_id:   The unique id of the model endpoint.
     :param attributes:    Attributes that will be updated. The input is provided in a json structure that will be
                           converted into a dictionary before applying the patch process. Note that the keys of
@@ -164,18 +164,18 @@
 
     :param auth_info:     The auth info of the request.
 
     :return: A Model endpoint object.
     """
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        resource_type=mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        resource_type=mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project_name=project,
         resource_name=endpoint_id,
-        action=mlrun.api.schemas.AuthorizationAction.update,
+        action=mlrun.common.schemas.AuthorizationAction.update,
         auth_info=auth_info,
     )
 
     if not attributes:
         raise mlrun.errors.MLRunNotFoundError(
             f"No attributes provided for patching the model endpoint {endpoint_id}",
         )
@@ -190,60 +190,60 @@
 @router.delete(
     "/projects/{project}/model-endpoints/{endpoint_id}",
     status_code=HTTPStatus.NO_CONTENT.value,
 )
 async def delete_model_endpoint(
     project: str,
     endpoint_id: str,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     """
     Clears endpoint record from the DB based on endpoint_id.
 
     :param project:       The name of the project.
     :param endpoint_id:   The unique id of the model endpoint.
     :param auth_info:     The auth info of the request.
 
     """
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        resource_type=mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        resource_type=mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project_name=project,
         resource_name=endpoint_id,
-        action=mlrun.api.schemas.AuthorizationAction.delete,
+        action=mlrun.common.schemas.AuthorizationAction.delete,
         auth_info=auth_info,
     )
 
     await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().delete_model_endpoint,
         project=project,
         endpoint_id=endpoint_id,
     )
 
 
 @router.get(
     "/projects/{project}/model-endpoints",
-    response_model=mlrun.api.schemas.ModelEndpointList,
+    response_model=mlrun.common.schemas.ModelEndpointList,
 )
 async def list_model_endpoints(
     project: str,
     model: Optional[str] = Query(None),
     function: Optional[str] = Query(None),
     labels: List[str] = Query([], alias="label"),
     start: str = Query(default="now-1h"),
     end: str = Query(default="now"),
     metrics: List[str] = Query([], alias="metric"),
     top_level: bool = Query(False, alias="top-level"),
     uids: List[str] = Query(None, alias="uid"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
-) -> mlrun.api.schemas.ModelEndpointList:
+) -> mlrun.common.schemas.ModelEndpointList:
     """
     Returns a list of endpoints of type 'ModelEndpoint', supports filtering by model, function, tag,
     labels or top level. By default, when no filters are applied, all available endpoints for the given project will be
     listed.
 
     If uids are passed: will return `ModelEndpointList` of endpoints with uid in uids
     Labels can be used to filter on the existence of a label:
@@ -280,15 +280,15 @@
 
     :return: An object of `ModelEndpointList` which is literally a list of model endpoints along with some metadata. To
              get a standard list of model endpoints use ModelEndpointList.endpoints.
     """
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project_name=project,
-        action=mlrun.api.schemas.AuthorizationAction.read,
+        action=mlrun.common.schemas.AuthorizationAction.read,
         auth_info=auth_info,
     )
 
     endpoints = await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().list_model_endpoints,
         auth_info=auth_info,
         project=project,
@@ -298,42 +298,42 @@
         metrics=metrics,
         start=start,
         end=end,
         top_level=top_level,
         uids=uids,
     )
     allowed_endpoints = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         endpoints.endpoints,
         lambda _endpoint: (
             _endpoint.metadata.project,
             _endpoint.metadata.uid,
         ),
         auth_info,
     )
 
     endpoints.endpoints = allowed_endpoints
     return endpoints
 
 
 @router.get(
     "/projects/{project}/model-endpoints/{endpoint_id}",
-    response_model=mlrun.api.schemas.ModelEndpoint,
+    response_model=mlrun.common.schemas.ModelEndpoint,
 )
 async def get_model_endpoint(
     project: str,
     endpoint_id: str,
     start: str = Query(default="now-1h"),
     end: str = Query(default="now"),
     metrics: List[str] = Query([], alias="metric"),
     feature_analysis: bool = Query(default=False),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
-) -> mlrun.api.schemas.ModelEndpoint:
+) -> mlrun.common.schemas.ModelEndpoint:
     """Get a single model endpoint object. You can apply different time series metrics that will be added to the
        result.
 
 
     :param project:                    The name of the project
     :param endpoint_id:                The unique id of the model endpoint.
     :param start:                      The start time of the metrics. Can be represented by a string containing an
@@ -352,18 +352,18 @@
     :param feature_analysis:           When True, the base feature statistics and current feature statistics will
                                        be added to the output of the resulting object.
     :param auth_info:                  The auth info of the request
 
     :return:  A `ModelEndpoint` object.
     """
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project,
         endpoint_id,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     return await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().get_model_endpoint,
         auth_info=auth_info,
         project=project,
```

## mlrun/api/api/endpoints/operations.py

```diff
@@ -17,41 +17,41 @@
 
 import fastapi
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
 import mlrun.api.crud
 import mlrun.api.initial_data
-import mlrun.api.schemas
 import mlrun.api.utils.background_tasks
 import mlrun.api.utils.clients.chief
+import mlrun.common.schemas
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
 
 
 current_migration_background_task_name = None
 
 
 @router.post(
     "/operations/migrations",
     responses={
         http.HTTPStatus.OK.value: {},
-        http.HTTPStatus.ACCEPTED.value: {"model": mlrun.api.schemas.BackgroundTask},
+        http.HTTPStatus.ACCEPTED.value: {"model": mlrun.common.schemas.BackgroundTask},
     },
 )
 async def trigger_migrations(
     background_tasks: fastapi.BackgroundTasks,
     response: fastapi.Response,
     request: fastapi.Request,
 ):
     # only chief can execute migrations, redirecting request to chief
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info("Requesting to trigger migrations, re-routing to chief")
         chief_client = mlrun.api.utils.clients.chief.Client()
         return await chief_client.trigger_migrations(request)
 
     # we didn't yet decide who should have permissions to such actions, therefore no authorization at the moment
     # note in api.py we do declare to use the authenticate_request dependency - meaning we do have authentication
@@ -68,26 +68,30 @@
     response.status_code = http.HTTPStatus.ACCEPTED.value
     current_migration_background_task_name = background_task.metadata.name
     return background_task
 
 
 def _get_or_create_migration_background_task(
     task_name: str, background_tasks
-) -> typing.Optional[mlrun.api.schemas.BackgroundTask]:
-    if mlrun.mlconf.httpdb.state == mlrun.api.schemas.APIStates.migrations_in_progress:
+) -> typing.Optional[mlrun.common.schemas.BackgroundTask]:
+    if (
+        mlrun.mlconf.httpdb.state
+        == mlrun.common.schemas.APIStates.migrations_in_progress
+    ):
         background_task = mlrun.api.utils.background_tasks.InternalBackgroundTasksHandler().get_background_task(
             task_name
         )
         return background_task
-    elif mlrun.mlconf.httpdb.state == mlrun.api.schemas.APIStates.migrations_failed:
+    elif mlrun.mlconf.httpdb.state == mlrun.common.schemas.APIStates.migrations_failed:
         raise mlrun.errors.MLRunPreconditionFailedError(
             "Migrations were already triggered and failed. Restart the API to retry"
         )
     elif (
-        mlrun.mlconf.httpdb.state != mlrun.api.schemas.APIStates.waiting_for_migrations
+        mlrun.mlconf.httpdb.state
+        != mlrun.common.schemas.APIStates.waiting_for_migrations
     ):
         return None
 
     logger.info("Starting the migration process")
     return mlrun.api.utils.background_tasks.InternalBackgroundTasksHandler().create_background_task(
         background_tasks,
         _perform_migration,
@@ -98,8 +102,8 @@
     # import here to prevent import cycle
     import mlrun.api.main
 
     await run_in_threadpool(
         mlrun.api.initial_data.init_data, perform_migrations_if_needed=True
     )
     await mlrun.api.main.move_api_to_online()
-    mlrun.mlconf.httpdb.state = mlrun.api.schemas.APIStates.online
+    mlrun.mlconf.httpdb.state = mlrun.common.schemas.APIStates.online
```

## mlrun/api/api/endpoints/pipelines.py

```diff
@@ -19,124 +19,126 @@
 
 import yaml
 from fastapi import APIRouter, Depends, Query, Request
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
+import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.errors
 from mlrun.api.api import deps
 from mlrun.api.api.utils import log_and_raise
 from mlrun.config import config
-from mlrun.k8s_utils import get_k8s_helper
 from mlrun.utils import logger
 
 router = APIRouter()
 
 
 @router.get(
-    "/projects/{project}/pipelines", response_model=mlrun.api.schemas.PipelinesOutput
+    "/projects/{project}/pipelines", response_model=mlrun.common.schemas.PipelinesOutput
 )
 async def list_pipelines(
     project: str,
     namespace: str = None,
     sort_by: str = "",
     page_token: str = "",
     filter_: str = Query("", alias="filter"),
-    format_: mlrun.api.schemas.PipelinesFormat = Query(
-        mlrun.api.schemas.PipelinesFormat.metadata_only, alias="format"
+    format_: mlrun.common.schemas.PipelinesFormat = Query(
+        mlrun.common.schemas.PipelinesFormat.metadata_only, alias="format"
     ),
     page_size: int = Query(None, gt=0, le=200),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if namespace is None:
         namespace = config.namespace
     if project != "*":
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             project,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     total_size, next_page_token, runs = None, None, []
-    if get_k8s_helper(silent=True).is_running_inside_kubernetes_cluster():
+    if mlrun.api.utils.singletons.k8s.get_k8s_helper(
+        silent=True
+    ).is_running_inside_kubernetes_cluster():
         # we need to resolve the project from the returned run for the opa enforcement (project query param might be
         # "*"), so we can't really get back only the names here
         computed_format = (
-            mlrun.api.schemas.PipelinesFormat.metadata_only
-            if format_ == mlrun.api.schemas.PipelinesFormat.name_only
+            mlrun.common.schemas.PipelinesFormat.metadata_only
+            if format_ == mlrun.common.schemas.PipelinesFormat.name_only
             else format_
         )
         total_size, next_page_token, runs = await run_in_threadpool(
             mlrun.api.crud.Pipelines().list_pipelines,
             db_session,
             project,
             namespace,
             sort_by,
             page_token,
             filter_,
             computed_format,
             page_size,
         )
     allowed_runs = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.pipeline,
+        mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
         runs,
         lambda run: (
             run["project"],
             run["id"],
         ),
         auth_info,
     )
-    if format_ == mlrun.api.schemas.PipelinesFormat.name_only:
+    if format_ == mlrun.common.schemas.PipelinesFormat.name_only:
         allowed_runs = [run["name"] for run in allowed_runs]
-    return mlrun.api.schemas.PipelinesOutput(
+    return mlrun.common.schemas.PipelinesOutput(
         runs=allowed_runs,
         total_size=total_size or 0,
         next_page_token=next_page_token or None,
     )
 
 
 @router.post("/projects/{project}/pipelines")
 async def create_pipeline(
     project: str,
     request: Request,
     namespace: str = None,
     experiment_name: str = Query("Default", alias="experiment"),
     run_name: str = Query("", alias="run"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     if namespace is None:
         namespace = config.namespace
     response = await _create_pipeline(
         auth_info, request, namespace, experiment_name, run_name, project
     )
     return response
 
 
 async def _create_pipeline(
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     request: Request,
     namespace: str,
     experiment_name: str,
     run_name: str,
     project: typing.Optional[str] = None,
 ):
     # If we have the project (new clients from 0.7.0 uses the new endpoint in which it's mandatory) - check auth now
     if project:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.pipeline,
+            mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
             project,
             "",
-            mlrun.api.schemas.AuthorizationAction.create,
+            mlrun.common.schemas.AuthorizationAction.create,
             auth_info,
         )
     run_name = run_name or experiment_name + " " + datetime.now().strftime(
         "%Y-%m-%d %H-%M-%S"
     )
 
     data = await request.body()
@@ -149,24 +151,24 @@
     if not project:
         raise mlrun.errors.MLRunInvalidArgumentError(
             "Pipelines can not be created without a project - you are probably running with old client - try upgrade to"
             " the server version"
         )
     else:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.pipeline,
+            mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
             project,
             "",
-            mlrun.api.schemas.AuthorizationAction.create,
+            mlrun.common.schemas.AuthorizationAction.create,
             auth_info,
         )
 
     arguments = {}
     arguments_data = request.headers.get(
-        mlrun.api.schemas.HeaderNames.pipeline_arguments
+        mlrun.common.schemas.HeaderNames.pipeline_arguments
     )
     if arguments_data:
         arguments = ast.literal_eval(arguments_data)
 
     run = await run_in_threadpool(
         mlrun.api.crud.Pipelines().create_pipeline,
         experiment_name,
@@ -199,18 +201,18 @@
 
 
 @router.get("/projects/{project}/pipelines/{run_id}")
 async def get_pipeline(
     run_id: str,
     project: str,
     namespace: str = Query(config.namespace),
-    format_: mlrun.api.schemas.PipelinesFormat = Query(
-        mlrun.api.schemas.PipelinesFormat.summary, alias="format"
+    format_: mlrun.common.schemas.PipelinesFormat = Query(
+        mlrun.common.schemas.PipelinesFormat.summary, alias="format"
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = Depends(deps.get_db_session),
 ):
     pipeline = mlrun.api.crud.Pipelines().get_pipeline(
         db_session, run_id, project, namespace, format_
     )
@@ -219,43 +221,43 @@
         # backwards compatibility reasons), so the client will just send * in the project, in that case we use the
         # legacy flow in which we first get the pipeline, resolve the project out of it, and only then query permissions
         # we don't use the return value from this function since the user may have asked for a different format than
         # summary which is the one used inside
         await _get_pipeline_without_project(db_session, auth_info, run_id, namespace)
     else:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.pipeline,
+            mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
             project,
             run_id,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     return pipeline
 
 
 async def _get_pipeline_without_project(
     db_session: Session,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     run_id: str,
     namespace: str,
 ):
     """
     This function is for when we receive a get pipeline request without the client specifying the project
     So we first get the pipeline, resolve the project out of it, and now that we know the project, we can verify
     permissions
     """
     run = await run_in_threadpool(
         mlrun.api.crud.Pipelines().get_pipeline,
         db_session,
         run_id,
         namespace=namespace,
         # minimal format that includes the project
-        format_=mlrun.api.schemas.PipelinesFormat.summary,
+        format_=mlrun.common.schemas.PipelinesFormat.summary,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.pipeline,
+        mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
         run["run"]["project"],
         run["run"]["id"],
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return run
```

## mlrun/api/api/endpoints/projects.py

```diff
@@ -16,37 +16,37 @@
 import typing
 
 import fastapi
 import sqlalchemy.orm
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.chief
+import mlrun.common.schemas
 from mlrun.api.utils.singletons.project_member import get_project_member
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
 
 
 @router.post(
     "/projects",
     responses={
-        http.HTTPStatus.CREATED.value: {"model": mlrun.api.schemas.Project},
+        http.HTTPStatus.CREATED.value: {"model": mlrun.common.schemas.Project},
         http.HTTPStatus.ACCEPTED.value: {},
     },
 )
 def create_project(
-    project: mlrun.api.schemas.Project,
+    project: mlrun.common.schemas.Project,
     response: fastapi.Response,
     # TODO: we're in a http request context here, therefore it doesn't make sense that by default it will hold the
     #  request until the process will be completed - after UI supports waiting - change default to False
     wait_for_completion: bool = fastapi.Query(True, alias="wait-for-completion"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     project, is_running_in_background = get_project_member().create_project(
@@ -61,25 +61,25 @@
     response.status_code = http.HTTPStatus.CREATED.value
     return project
 
 
 @router.put(
     "/projects/{name}",
     responses={
-        http.HTTPStatus.OK.value: {"model": mlrun.api.schemas.Project},
+        http.HTTPStatus.OK.value: {"model": mlrun.common.schemas.Project},
         http.HTTPStatus.ACCEPTED.value: {},
     },
 )
 def store_project(
-    project: mlrun.api.schemas.Project,
+    project: mlrun.common.schemas.Project,
     name: str,
     # TODO: we're in a http request context here, therefore it doesn't make sense that by default it will hold the
     #  request until the process will be completed - after UI supports waiting - change default to False
     wait_for_completion: bool = fastapi.Query(True, alias="wait-for-completion"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     project, is_running_in_background = get_project_member().store_project(
@@ -94,29 +94,29 @@
         return fastapi.Response(status_code=http.HTTPStatus.ACCEPTED.value)
     return project
 
 
 @router.patch(
     "/projects/{name}",
     responses={
-        http.HTTPStatus.OK.value: {"model": mlrun.api.schemas.Project},
+        http.HTTPStatus.OK.value: {"model": mlrun.common.schemas.Project},
         http.HTTPStatus.ACCEPTED.value: {},
     },
 )
 def patch_project(
     project: dict,
     name: str,
-    patch_mode: mlrun.api.schemas.PatchMode = fastapi.Header(
-        mlrun.api.schemas.PatchMode.replace,
-        alias=mlrun.api.schemas.HeaderNames.patch_mode,
+    patch_mode: mlrun.common.schemas.PatchMode = fastapi.Header(
+        mlrun.common.schemas.PatchMode.replace,
+        alias=mlrun.common.schemas.HeaderNames.patch_mode,
     ),
     # TODO: we're in a http request context here, therefore it doesn't make sense that by default it will hold the
     #  request until the process will be completed - after UI supports waiting - change default to False
     wait_for_completion: bool = fastapi.Query(True, alias="wait-for-completion"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     project, is_running_in_background = get_project_member().patch_project(
@@ -129,32 +129,32 @@
         wait_for_completion=wait_for_completion,
     )
     if is_running_in_background:
         return fastapi.Response(status_code=http.HTTPStatus.ACCEPTED.value)
     return project
 
 
-@router.get("/projects/{name}", response_model=mlrun.api.schemas.Project)
+@router.get("/projects/{name}", response_model=mlrun.common.schemas.Project)
 async def get_project(
     name: str,
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     project = await run_in_threadpool(
         get_project_member().get_project, db_session, name, auth_info.session
     )
     # skip permission check if it's the leader
     if not _is_request_from_leader(auth_info.projects_role):
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             name,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     return project
 
 
 @router.delete(
     "/projects/{name}",
@@ -162,33 +162,33 @@
         http.HTTPStatus.NO_CONTENT.value: {},
         http.HTTPStatus.ACCEPTED.value: {},
     },
 )
 async def delete_project(
     name: str,
     request: fastapi.Request,
-    deletion_strategy: mlrun.api.schemas.DeletionStrategy = fastapi.Header(
-        mlrun.api.schemas.DeletionStrategy.default(),
-        alias=mlrun.api.schemas.HeaderNames.deletion_strategy,
+    deletion_strategy: mlrun.common.schemas.DeletionStrategy = fastapi.Header(
+        mlrun.common.schemas.DeletionStrategy.default(),
+        alias=mlrun.common.schemas.HeaderNames.deletion_strategy,
     ),
     # TODO: we're in a http request context here, therefore it doesn't make sense that by default it will hold the
     #  request until the process will be completed - after UI supports waiting - change default to False
     wait_for_completion: bool = fastapi.Query(True, alias="wait-for-completion"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     # delete project can be responsible for deleting schedules. Schedules are running only on chief,
     # that is why we re-route requests to chief
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting to delete project, re-routing to chief",
             project=name,
             deletion_strategy=deletion_strategy,
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
@@ -205,37 +205,37 @@
     )
     if is_running_in_background:
         return fastapi.Response(status_code=http.HTTPStatus.ACCEPTED.value)
     await get_project_member().post_delete_project(name)
     return fastapi.Response(status_code=http.HTTPStatus.NO_CONTENT.value)
 
 
-@router.get("/projects", response_model=mlrun.api.schemas.ProjectsOutput)
+@router.get("/projects", response_model=mlrun.common.schemas.ProjectsOutput)
 async def list_projects(
-    format_: mlrun.api.schemas.ProjectsFormat = fastapi.Query(
-        mlrun.api.schemas.ProjectsFormat.full, alias="format"
+    format_: mlrun.common.schemas.ProjectsFormat = fastapi.Query(
+        mlrun.common.schemas.ProjectsFormat.full, alias="format"
     ),
     owner: str = None,
     labels: typing.List[str] = fastapi.Query(None, alias="label"),
-    state: mlrun.api.schemas.ProjectState = None,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    state: mlrun.common.schemas.ProjectState = None,
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     allowed_project_names = None
     # skip permission check if it's the leader
     if not _is_request_from_leader(auth_info.projects_role):
         projects_output = await run_in_threadpool(
             get_project_member().list_projects,
             db_session,
             owner,
-            mlrun.api.schemas.ProjectsFormat.name_only,
+            mlrun.common.schemas.ProjectsFormat.name_only,
             labels,
             state,
             auth_info.projects_role,
             auth_info.session,
         )
         allowed_project_names = await (
             mlrun.api.utils.auth.verifier.AuthVerifier().filter_projects_by_permissions(
@@ -253,32 +253,32 @@
         auth_info.projects_role,
         auth_info.session,
         allowed_project_names,
     )
 
 
 @router.get(
-    "/project-summaries", response_model=mlrun.api.schemas.ProjectSummariesOutput
+    "/project-summaries", response_model=mlrun.common.schemas.ProjectSummariesOutput
 )
 async def list_project_summaries(
     owner: str = None,
     labels: typing.List[str] = fastapi.Query(None, alias="label"),
-    state: mlrun.api.schemas.ProjectState = None,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    state: mlrun.common.schemas.ProjectState = None,
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     projects_output = await run_in_threadpool(
         get_project_member().list_projects,
         db_session,
         owner,
-        mlrun.api.schemas.ProjectsFormat.name_only,
+        mlrun.common.schemas.ProjectsFormat.name_only,
         labels,
         state,
         auth_info.projects_role,
         auth_info.session,
     )
     allowed_project_names = projects_output.projects
     # skip permission check if it's the leader
@@ -295,37 +295,37 @@
         auth_info.projects_role,
         auth_info.session,
         allowed_project_names,
     )
 
 
 @router.get(
-    "/project-summaries/{name}", response_model=mlrun.api.schemas.ProjectSummary
+    "/project-summaries/{name}", response_model=mlrun.common.schemas.ProjectSummary
 )
 async def get_project_summary(
     name: str,
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     project_summary = await get_project_member().get_project_summary(
         db_session, name, auth_info.session
     )
     # skip permission check if it's the leader
     if not _is_request_from_leader(auth_info.projects_role):
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             name,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     return project_summary
 
 
 def _is_request_from_leader(
-    projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole],
+    projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole],
 ) -> bool:
     if projects_role and projects_role.value == mlrun.mlconf.httpdb.projects.leader:
         return True
     return False
```

## mlrun/api/api/endpoints/runs.py

```diff
@@ -17,45 +17,45 @@
 from typing import List
 
 from fastapi import APIRouter, Depends, Query, Request
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 from mlrun.api.api import deps
 from mlrun.api.api.utils import log_and_raise
 from mlrun.utils import logger
 from mlrun.utils.helpers import datetime_from_iso
 
 router = APIRouter()
 
 
 @router.post("/run/{project}/{uid}")
 async def store_run(
     request: Request,
     project: str,
     uid: str,
     iter: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.run,
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
         project,
         uid,
-        mlrun.api.schemas.AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     data = None
     try:
         data = await request.json()
     except ValueError:
         log_and_raise(HTTPStatus.BAD_REQUEST.value, reason="bad JSON body")
@@ -74,22 +74,22 @@
 
 @router.patch("/run/{project}/{uid}")
 async def update_run(
     request: Request,
     project: str,
     uid: str,
     iter: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.run,
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
         project,
         uid,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     data = None
     try:
         data = await request.json()
     except ValueError:
         log_and_raise(HTTPStatus.BAD_REQUEST.value, reason="bad JSON body")
@@ -106,45 +106,45 @@
 
 
 @router.get("/run/{project}/{uid}")
 async def get_run(
     project: str,
     uid: str,
     iter: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     data = await run_in_threadpool(
         mlrun.api.crud.Runs().get_run, db_session, uid, iter, project
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.run,
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
         project,
         uid,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return {
         "data": data,
     }
 
 
 @router.delete("/run/{project}/{uid}")
 async def delete_run(
     project: str,
     uid: str,
     iter: int = 0,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.run,
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
         project,
         uid,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     await run_in_threadpool(
         mlrun.api.crud.Runs().delete_run,
         db_session,
         uid,
         iter,
@@ -163,33 +163,33 @@
     last: int = 0,
     sort: bool = True,
     iter: bool = True,
     start_time_from: str = None,
     start_time_to: str = None,
     last_update_time_from: str = None,
     last_update_time_to: str = None,
-    partition_by: mlrun.api.schemas.RunPartitionByField = Query(
+    partition_by: mlrun.common.schemas.RunPartitionByField = Query(
         None, alias="partition-by"
     ),
     rows_per_partition: int = Query(1, alias="rows-per-partition", gt=0),
-    partition_sort_by: mlrun.api.schemas.SortField = Query(
+    partition_sort_by: mlrun.common.schemas.SortField = Query(
         None, alias="partition-sort-by"
     ),
-    partition_order: mlrun.api.schemas.OrderType = Query(
-        mlrun.api.schemas.OrderType.desc, alias="partition-order"
+    partition_order: mlrun.common.schemas.OrderType = Query(
+        mlrun.common.schemas.OrderType.desc, alias="partition-order"
     ),
     max_partitions: int = Query(0, alias="max-partitions", ge=0),
     with_notifications: bool = Query(False, alias="with-notifications"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if project != "*":
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             project,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     runs = await run_in_threadpool(
         mlrun.api.crud.Runs().list_runs,
         db_session,
         name,
         uid,
@@ -207,15 +207,15 @@
         rows_per_partition,
         partition_sort_by,
         partition_order,
         max_partitions,
         with_notifications=with_notifications,
     )
     filtered_runs = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.run,
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
         runs,
         lambda run: (
             run.get("metadata", {}).get("project", mlrun.mlconf.default_project),
             run.get("metadata", {}).get("uid"),
         ),
         auth_info,
     )
@@ -227,26 +227,26 @@
 @router.delete("/runs")
 async def delete_runs(
     project: str = None,
     name: str = None,
     labels: List[str] = Query([], alias="label"),
     state: str = None,
     days_ago: int = None,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     if not project or project != "*":
         # Currently we don't differentiate between runs permissions inside a project.
         # Meaning there is no reason at the moment to query the permission for each run under the project
         # TODO check for every run when we will manage permission per run inside a project
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.run,
+            mlrun.common.schemas.AuthorizationResourceTypes.run,
             project or mlrun.mlconf.default_project,
             "",
-            mlrun.api.schemas.AuthorizationAction.delete,
+            mlrun.common.schemas.AuthorizationAction.delete,
             auth_info,
         )
     else:
         start_time_from = None
         if days_ago:
             start_time_from = datetime.datetime.now(
                 datetime.timezone.utc
@@ -264,18 +264,18 @@
             run.get("metadata", {}).get("project", mlrun.mlconf.default_project)
             for run in runs
         )
         for run_project in projects:
             # currently we fail if the user doesn't has permissions to delete runs to one of the projects in the system
             # TODO Delete only runs from projects that user has permissions to
             await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-                mlrun.api.schemas.AuthorizationResourceTypes.run,
+                mlrun.common.schemas.AuthorizationResourceTypes.run,
                 run_project,
                 "",
-                mlrun.api.schemas.AuthorizationAction.delete,
+                mlrun.common.schemas.AuthorizationAction.delete,
                 auth_info,
             )
 
     await run_in_threadpool(
         mlrun.api.crud.Runs().delete_runs,
         db_session,
         name,
```

## mlrun/api/api/endpoints/runtime_resources.py

```diff
@@ -19,59 +19,59 @@
 import fastapi
 import sqlalchemy.orm
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun
 import mlrun.api.api.deps
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
+import mlrun.common.schemas
 
 router = fastapi.APIRouter()
 
 
 @router.get(
     "/projects/{project}/runtime-resources",
     response_model=typing.Union[
-        mlrun.api.schemas.RuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ],
 )
 async def list_runtime_resources(
     project: str,
     label_selector: typing.Optional[str] = fastapi.Query(None, alias="label-selector"),
     kind: typing.Optional[str] = None,
     object_id: typing.Optional[str] = fastapi.Query(None, alias="object-id"),
     group_by: typing.Optional[
-        mlrun.api.schemas.ListRuntimeResourcesGroupByField
+        mlrun.common.schemas.ListRuntimeResourcesGroupByField
     ] = fastapi.Query(None, alias="group-by"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     return await _list_runtime_resources(
         project, auth_info, label_selector, group_by, kind, object_id
     )
 
 
 @router.delete(
     "/projects/{project}/runtime-resources",
-    response_model=mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+    response_model=mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
 )
 async def delete_runtime_resources(
     project: str,
     label_selector: typing.Optional[str] = fastapi.Query(None, alias="label-selector"),
     kind: typing.Optional[str] = None,
     object_id: typing.Optional[str] = fastapi.Query(None, alias="object-id"),
     force: bool = False,
     grace_period: int = fastapi.Query(
         mlrun.mlconf.runtime_resources_deletion_grace_period, alias="grace-period"
     ),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     return await _delete_runtime_resources(
@@ -84,37 +84,37 @@
         force,
         grace_period,
     )
 
 
 async def _delete_runtime_resources(
     db_session: sqlalchemy.orm.Session,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     project: str,
     label_selector: typing.Optional[str] = None,
     kind: typing.Optional[str] = None,
     object_id: typing.Optional[str] = None,
     force: bool = False,
     grace_period: int = mlrun.mlconf.runtime_resources_deletion_grace_period,
     return_body: bool = True,
 ) -> typing.Union[
-    mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput, fastapi.Response
+    mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput, fastapi.Response
 ]:
     (
         allowed_projects,
         grouped_by_project_runtime_resources_output,
         is_non_project_runtime_resource_exists,
         not_allowed_projects_exist,
     ) = await _get_runtime_resources_allowed_projects(
         project,
         auth_info,
         label_selector,
         kind,
         object_id,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
     )
 
     # TODO: once we have more granular permissions, we should check if the user is allowed to delete the specific
     #  runtime resources and not just the project in general
     if not_allowed_projects_exist:
 
         # if the user is not allowed to delete at least one of the projects, we return 403 as to:
@@ -158,33 +158,33 @@
     if return_body:
         filtered_projects = copy.deepcopy(allowed_projects)
         if is_non_project_runtime_resource_exists:
             filtered_projects.append("")
         return mlrun.api.crud.RuntimeResources().filter_and_format_grouped_by_project_runtime_resources_output(
             grouped_by_project_runtime_resources_output,
             filtered_projects,
-            mlrun.api.schemas.ListRuntimeResourcesGroupByField.project,
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField.project,
         )
     else:
         return fastapi.Response(status_code=http.HTTPStatus.NO_CONTENT.value)
 
 
 async def _list_runtime_resources(
     project: str,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     label_selector: typing.Optional[str] = None,
     group_by: typing.Optional[
-        mlrun.api.schemas.ListRuntimeResourcesGroupByField
+        mlrun.common.schemas.ListRuntimeResourcesGroupByField
     ] = None,
     kind_filter: typing.Optional[str] = None,
     object_id: typing.Optional[str] = None,
 ) -> typing.Union[
-    mlrun.api.schemas.RuntimeResourcesOutput,
-    mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-    mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+    mlrun.common.schemas.RuntimeResourcesOutput,
+    mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+    mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
 ]:
     (
         allowed_projects,
         grouped_by_project_runtime_resources_output,
         _,
         _,
     ) = await _get_runtime_resources_allowed_projects(
@@ -195,53 +195,53 @@
         allowed_projects,
         group_by,
     )
 
 
 async def _get_runtime_resources_allowed_projects(
     project: str,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     label_selector: typing.Optional[str] = None,
     kind: typing.Optional[str] = None,
     object_id: typing.Optional[str] = None,
-    action: mlrun.api.schemas.AuthorizationAction = mlrun.api.schemas.AuthorizationAction.read,
+    action: mlrun.common.schemas.AuthorizationAction = mlrun.common.schemas.AuthorizationAction.read,
 ) -> typing.Tuple[
     typing.List[str],
-    mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+    mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     bool,
     bool,
 ]:
     if project != "*":
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             project,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
-    grouped_by_project_runtime_resources_output: mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput
+    grouped_by_project_runtime_resources_output: mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput
     grouped_by_project_runtime_resources_output = await run_in_threadpool(
         mlrun.api.crud.RuntimeResources().list_runtime_resources,
         project,
         kind,
         object_id,
         label_selector,
-        mlrun.api.schemas.ListRuntimeResourcesGroupByField.project,
+        mlrun.common.schemas.ListRuntimeResourcesGroupByField.project,
     )
 
     projects = []
     is_non_project_runtime_resource_exists = False
     for (
         project,
         kind_runtime_resources_map,
     ) in grouped_by_project_runtime_resources_output.items():
         if not project:
             is_non_project_runtime_resource_exists = True
             continue
         projects.append(project)
     allowed_projects = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.runtime_resource,
+        mlrun.common.schemas.AuthorizationResourceTypes.runtime_resource,
         projects,
         lambda project: (
             project,
             "",
         ),
         auth_info,
         action=action,
```

## mlrun/api/api/endpoints/schedules.py

```diff
@@ -19,47 +19,47 @@
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.utils
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.chief
 import mlrun.api.utils.singletons.project_member
-from mlrun.api import schemas
+import mlrun.common.schemas
 from mlrun.api.api import deps
 from mlrun.api.utils.singletons.scheduler import get_scheduler
 from mlrun.utils import logger
 
 router = APIRouter()
 
 
 @router.post("/projects/{project}/schedules")
 async def create_schedule(
     project: str,
-    schedule: schemas.ScheduleInput,
+    schedule: mlrun.common.schemas.ScheduleInput,
     request: fastapi.Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         project,
         schedule.name,
-        mlrun.api.schemas.AuthorizationAction.create,
+        mlrun.common.schemas.AuthorizationAction.create,
         auth_info,
     )
     # to reduce redundant load on the chief, we re-route the request only if the user has permissions
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting to create schedule, re-routing to chief",
             project=project,
             schedule=schedule.dict(),
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
@@ -86,30 +86,30 @@
     return Response(status_code=HTTPStatus.CREATED.value)
 
 
 @router.put("/projects/{project}/schedules/{name}")
 async def update_schedule(
     project: str,
     name: str,
-    schedule: schemas.ScheduleUpdate,
+    schedule: mlrun.common.schemas.ScheduleUpdate,
     request: fastapi.Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     # to reduce redundant load on the chief, we re-route the request only if the user has permissions
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting to update schedule, re-routing to chief",
             project=project,
             name=name,
             schedule=schedule.dict(),
         )
@@ -132,101 +132,104 @@
         schedule.scheduled_object,
         schedule.cron_trigger,
         labels=schedule.labels,
     )
     return Response(status_code=HTTPStatus.OK.value)
 
 
-@router.get("/projects/{project}/schedules", response_model=schemas.SchedulesOutput)
+@router.get(
+    "/projects/{project}/schedules", response_model=mlrun.common.schemas.SchedulesOutput
+)
 async def list_schedules(
     project: str,
     name: str = None,
     labels: str = None,
-    kind: schemas.ScheduleKinds = None,
+    kind: mlrun.common.schemas.ScheduleKinds = None,
     include_last_run: bool = False,
     include_credentials: bool = fastapi.Query(False, alias="include-credentials"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
         project,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     schedules = await run_in_threadpool(
         get_scheduler().list_schedules,
         db_session,
         project,
         name,
         kind,
         labels,
         include_last_run,
         include_credentials,
     )
     filtered_schedules = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         schedules.schedules,
         lambda schedule: (
             schedule.project,
             schedule.name,
         ),
         auth_info,
     )
     schedules.schedules = filtered_schedules
     return schedules
 
 
 @router.get(
-    "/projects/{project}/schedules/{name}", response_model=schemas.ScheduleOutput
+    "/projects/{project}/schedules/{name}",
+    response_model=mlrun.common.schemas.ScheduleOutput,
 )
 async def get_schedule(
     project: str,
     name: str,
     include_last_run: bool = False,
     include_credentials: bool = fastapi.Query(False, alias="include-credentials"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     schedule = await run_in_threadpool(
         get_scheduler().get_schedule,
         db_session,
         project,
         name,
         include_last_run,
         include_credentials,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return schedule
 
 
 @router.post("/projects/{project}/schedules/{name}/invoke")
 async def invoke_schedule(
     project: str,
     name: str,
     request: fastapi.Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.update,
+        mlrun.common.schemas.AuthorizationAction.update,
         auth_info,
     )
     # to reduce redundant load on the chief, we re-route the request only if the user has permissions
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting to invoke schedule, re-routing to chief",
             project=project,
             name=name,
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
@@ -240,28 +243,28 @@
 @router.delete(
     "/projects/{project}/schedules/{name}", status_code=HTTPStatus.NO_CONTENT.value
 )
 async def delete_schedule(
     project: str,
     name: str,
     request: fastapi.Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         project,
         name,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     # to reduce redundant load on the chief, we re-route the request only if the user has permissions
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting to delete schedule, re-routing to chief",
             project=project,
             name=name,
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
@@ -273,33 +276,33 @@
     return Response(status_code=HTTPStatus.NO_CONTENT.value)
 
 
 @router.delete("/projects/{project}/schedules", status_code=HTTPStatus.NO_CONTENT.value)
 async def delete_schedules(
     project: str,
     request: fastapi.Request,
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
 ):
     schedules = await run_in_threadpool(
         get_scheduler().list_schedules,
         db_session,
         project,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resources_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
         schedules.schedules,
         lambda schedule: (schedule.project, schedule.name),
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     # to reduce redundant load on the chief, we re-route the request only if the user has permissions
     if (
         mlrun.mlconf.httpdb.clusterization.role
-        != mlrun.api.schemas.ClusterizationRole.chief
+        != mlrun.common.schemas.ClusterizationRole.chief
     ):
         logger.info(
             "Requesting to delete all project schedules, re-routing to chief",
             project=project,
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
         return await chief_client.delete_schedules(project=project, request=request)
```

## mlrun/api/api/endpoints/secrets.py

```diff
@@ -19,26 +19,25 @@
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.deps
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.errors
-from mlrun.api import schemas
-from mlrun.utils.vault import add_vault_user_secrets
 
 router = fastapi.APIRouter()
 
 
 @router.post("/projects/{project}/secrets", status_code=HTTPStatus.CREATED.value)
 async def store_project_secrets(
     project: str,
-    secrets: schemas.SecretsData,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    secrets: mlrun.common.schemas.SecretsData,
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = fastapi.Depends(mlrun.api.api.deps.get_db_session),
 ):
     # Doing a specific check for project existence, because we want to return 404 in the case of a project not
     # existing, rather than returning a permission error, as it misleads the user. We don't even care for return
     # value.
@@ -46,120 +45,126 @@
         mlrun.api.utils.singletons.project_member.get_project_member().get_project,
         db_session,
         project,
         auth_info.session,
     )
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.secret,
+        mlrun.common.schemas.AuthorizationResourceTypes.secret,
         project,
         secrets.provider,
-        mlrun.api.schemas.AuthorizationAction.create,
+        mlrun.common.schemas.AuthorizationAction.create,
         auth_info,
     )
     await run_in_threadpool(
         mlrun.api.crud.Secrets().store_project_secrets, project, secrets
     )
 
     return fastapi.Response(status_code=HTTPStatus.CREATED.value)
 
 
 @router.delete("/projects/{project}/secrets", status_code=HTTPStatus.NO_CONTENT.value)
 async def delete_project_secrets(
     project: str,
-    provider: schemas.SecretProviderName = schemas.SecretProviderName.kubernetes,
+    provider: mlrun.common.schemas.SecretProviderName = mlrun.common.schemas.SecretProviderName.kubernetes,
     secrets: List[str] = fastapi.Query(None, alias="secret"),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = fastapi.Depends(mlrun.api.api.deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().get_project,
         db_session,
         project,
         auth_info.session,
     )
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.secret,
+        mlrun.common.schemas.AuthorizationResourceTypes.secret,
         project,
         provider,
-        mlrun.api.schemas.AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
     await run_in_threadpool(
         mlrun.api.crud.Secrets().delete_project_secrets, project, provider, secrets
     )
 
     return fastapi.Response(status_code=HTTPStatus.NO_CONTENT.value)
 
 
-@router.get("/projects/{project}/secret-keys", response_model=schemas.SecretKeysData)
+@router.get(
+    "/projects/{project}/secret-keys",
+    response_model=mlrun.common.schemas.SecretKeysData,
+)
 async def list_project_secret_keys(
     project: str,
-    provider: schemas.SecretProviderName = schemas.SecretProviderName.kubernetes,
-    token: str = fastapi.Header(None, alias=schemas.HeaderNames.secret_store_token),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    provider: mlrun.common.schemas.SecretProviderName = mlrun.common.schemas.SecretProviderName.kubernetes,
+    token: str = fastapi.Header(
+        None, alias=mlrun.common.schemas.HeaderNames.secret_store_token
+    ),
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = fastapi.Depends(mlrun.api.api.deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().get_project,
         db_session,
         project,
         auth_info.session,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.secret,
+        mlrun.common.schemas.AuthorizationResourceTypes.secret,
         project,
         provider,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return await run_in_threadpool(
         mlrun.api.crud.Secrets().list_project_secret_keys, project, provider, token
     )
 
 
-@router.get("/projects/{project}/secrets", response_model=schemas.SecretsData)
+@router.get(
+    "/projects/{project}/secrets", response_model=mlrun.common.schemas.SecretsData
+)
 async def list_project_secrets(
     project: str,
     secrets: List[str] = fastapi.Query(None, alias="secret"),
-    provider: schemas.SecretProviderName = schemas.SecretProviderName.kubernetes,
-    token: str = fastapi.Header(None, alias=schemas.HeaderNames.secret_store_token),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    provider: mlrun.common.schemas.SecretProviderName = mlrun.common.schemas.SecretProviderName.kubernetes,
+    token: str = fastapi.Header(
+        None, alias=mlrun.common.schemas.HeaderNames.secret_store_token
+    ),
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: Session = fastapi.Depends(mlrun.api.api.deps.get_db_session),
 ):
     await run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().get_project,
         db_session,
         project,
         auth_info.session,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.secret,
+        mlrun.common.schemas.AuthorizationResourceTypes.secret,
         project,
         provider,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     return await run_in_threadpool(
         mlrun.api.crud.Secrets().list_project_secrets, project, provider, secrets, token
     )
 
 
 @router.post("/user-secrets", status_code=HTTPStatus.CREATED.value)
 def add_user_secrets(
-    secrets: schemas.UserSecretCreationRequest,
+    secrets: mlrun.common.schemas.UserSecretCreationRequest,
 ):
-    if secrets.provider != schemas.SecretProviderName.vault:
-        return fastapi.Response(
-            status_code=HTTPStatus.BAD_REQUEST.vault,
-            content=f"Invalid secrets provider {secrets.provider}",
-        )
-
-    add_vault_user_secrets(secrets.user, secrets.secrets)
-    return fastapi.Response(status_code=HTTPStatus.CREATED.value)
+    # vault is not used
+    return fastapi.Response(
+        status_code=HTTPStatus.BAD_REQUEST.value,
+        content=f"Invalid secrets provider {secrets.provider}",
+    )
```

## mlrun/api/api/endpoints/submit.py

```diff
@@ -16,39 +16,39 @@
 from typing import Optional
 
 import fastapi.concurrency
 from fastapi import APIRouter, Depends, Header, Request
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.utils
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.chief
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.utils.helpers
 from mlrun.api.api import deps
 from mlrun.utils import logger
 
 router = APIRouter()
 
 
 @router.post("/submit")
 @router.post("/submit/")
 @router.post("/submit_job")
 @router.post("/submit_job/")
 async def submit_job(
     request: Request,
     username: Optional[str] = Header(None, alias="x-remote-user"),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(deps.authenticate_request),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
     db_session: Session = Depends(deps.get_db_session),
     client_version: Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.client_version
+        None, alias=mlrun.common.schemas.HeaderNames.client_version
     ),
     client_python_version: Optional[str] = Header(
-        None, alias=mlrun.api.schemas.HeaderNames.python_version
+        None, alias=mlrun.common.schemas.HeaderNames.python_version
     ),
 ):
     data = None
     try:
         data = await request.json()
     except ValueError:
         mlrun.api.api.utils.log_and_raise(
@@ -66,50 +66,50 @@
         (
             function_project,
             function_name,
             _,
             _,
         ) = mlrun.utils.helpers.parse_versioned_object_uri(function_url)
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.function,
+            mlrun.common.schemas.AuthorizationResourceTypes.function,
             function_project,
             function_name,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     if data.get("schedule"):
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.schedule,
+            mlrun.common.schemas.AuthorizationResourceTypes.schedule,
             data["task"]["metadata"]["project"],
             data["task"]["metadata"]["name"],
-            mlrun.api.schemas.AuthorizationAction.create,
+            mlrun.common.schemas.AuthorizationAction.create,
             auth_info,
         )
         # schedules are meant to be run solely by the chief, then if run is configured to run as scheduled
         # and we are in worker then we forward the request to the chief.
         # to reduce redundant load on the chief, we re-route the request only if the user has permissions
         if (
             mlrun.mlconf.httpdb.clusterization.role
-            != mlrun.api.schemas.ClusterizationRole.chief
+            != mlrun.common.schemas.ClusterizationRole.chief
         ):
             logger.info(
                 "Requesting to submit job with schedules, re-routing to chief",
                 function=function_dict,
                 url=function_url,
                 task=task,
             )
             chief_client = mlrun.api.utils.clients.chief.Client()
             return await chief_client.submit_job(request=request, json=data)
 
     else:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.api.schemas.AuthorizationResourceTypes.run,
+            mlrun.common.schemas.AuthorizationResourceTypes.run,
             data["task"]["metadata"]["project"],
             "",
-            mlrun.api.schemas.AuthorizationAction.create,
+            mlrun.common.schemas.AuthorizationAction.create,
             auth_info,
         )
 
     # enrich job task with the username from the request header
     if username:
         # if task is missing, we don't want to create one
         if "task" in data:
```

## mlrun/api/api/endpoints/tags.py

```diff
@@ -16,28 +16,28 @@
 
 import fastapi
 import fastapi.concurrency
 import sqlalchemy.orm
 
 import mlrun.api.api.deps
 import mlrun.api.crud.tags
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 from mlrun.utils.helpers import tag_name_regex_as_string
 
 router = fastapi.APIRouter()
 
 
-@router.post("/projects/{project}/tags/{tag}", response_model=mlrun.api.schemas.Tag)
+@router.post("/projects/{project}/tags/{tag}", response_model=mlrun.common.schemas.Tag)
 async def overwrite_object_tags_with_tag(
     project: str,
     tag: str = fastapi.Path(..., regex=tag_name_regex_as_string()),
-    tag_objects: mlrun.api.schemas.TagObjects = fastapi.Body(...),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    tag_objects: mlrun.common.schemas.TagObjects = fastapi.Body(...),
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     await fastapi.concurrency.run_in_threadpool(
@@ -45,96 +45,96 @@
         db_session,
         project,
         auth_info=auth_info,
     )
 
     # check permission per object type
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        getattr(mlrun.api.schemas.AuthorizationResourceTypes, tag_objects.kind),
+        getattr(mlrun.common.schemas.AuthorizationResourceTypes, tag_objects.kind),
         project,
         resource_name="",
         # not actually overwriting objects, just overwriting the objects tags
-        action=mlrun.api.schemas.AuthorizationAction.update,
+        action=mlrun.common.schemas.AuthorizationAction.update,
         auth_info=auth_info,
     )
 
     await fastapi.concurrency.run_in_threadpool(
         mlrun.api.crud.Tags().overwrite_object_tags_with_tag,
         db_session,
         project,
         tag,
         tag_objects,
     )
-    return mlrun.api.schemas.Tag(name=tag, project=project)
+    return mlrun.common.schemas.Tag(name=tag, project=project)
 
 
-@router.put("/projects/{project}/tags/{tag}", response_model=mlrun.api.schemas.Tag)
+@router.put("/projects/{project}/tags/{tag}", response_model=mlrun.common.schemas.Tag)
 async def append_tag_to_objects(
     project: str,
     tag: str = fastapi.Path(..., regex=tag_name_regex_as_string()),
-    tag_objects: mlrun.api.schemas.TagObjects = fastapi.Body(...),
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    tag_objects: mlrun.common.schemas.TagObjects = fastapi.Body(...),
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     await fastapi.concurrency.run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        getattr(mlrun.api.schemas.AuthorizationResourceTypes, tag_objects.kind),
+        getattr(mlrun.common.schemas.AuthorizationResourceTypes, tag_objects.kind),
         project,
         resource_name="",
-        action=mlrun.api.schemas.AuthorizationAction.update,
+        action=mlrun.common.schemas.AuthorizationAction.update,
         auth_info=auth_info,
     )
 
     await fastapi.concurrency.run_in_threadpool(
         mlrun.api.crud.Tags().append_tag_to_objects,
         db_session,
         project,
         tag,
         tag_objects,
     )
-    return mlrun.api.schemas.Tag(name=tag, project=project)
+    return mlrun.common.schemas.Tag(name=tag, project=project)
 
 
 @router.delete(
     "/projects/{project}/tags/{tag}", status_code=http.HTTPStatus.NO_CONTENT.value
 )
 async def delete_tag_from_objects(
     project: str,
     tag: str,
-    tag_objects: mlrun.api.schemas.TagObjects,
-    auth_info: mlrun.api.schemas.AuthInfo = fastapi.Depends(
+    tag_objects: mlrun.common.schemas.TagObjects,
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
         mlrun.api.api.deps.authenticate_request
     ),
     db_session: sqlalchemy.orm.Session = fastapi.Depends(
         mlrun.api.api.deps.get_db_session
     ),
 ):
     await fastapi.concurrency.run_in_threadpool(
         mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
         db_session,
         project,
         auth_info=auth_info,
     )
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        getattr(mlrun.api.schemas.AuthorizationResourceTypes, tag_objects.kind),
+        getattr(mlrun.common.schemas.AuthorizationResourceTypes, tag_objects.kind),
         project,
         resource_name="",
         # not actually deleting objects, just deleting the objects tags
-        action=mlrun.api.schemas.AuthorizationAction.update,
+        action=mlrun.common.schemas.AuthorizationAction.update,
         auth_info=auth_info,
     )
 
     await fastapi.concurrency.run_in_threadpool(
         mlrun.api.crud.Tags().delete_tag_from_objects,
         db_session,
         project,
```

## mlrun/api/api/endpoints/internal/memory_reports.py

```diff
@@ -10,47 +10,47 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import fastapi
 
-import mlrun.api.schemas
 import mlrun.api.utils.memory_reports
+import mlrun.common.schemas
 
 router = fastapi.APIRouter()
 
 
 @router.get(
     "/memory-reports/common-types",
-    response_model=mlrun.api.schemas.MostCommonObjectTypesReport,
+    response_model=mlrun.common.schemas.MostCommonObjectTypesReport,
 )
 def get_most_common_objects_report():
     report = (
         mlrun.api.utils.memory_reports.MemoryUsageReport().create_most_common_objects_report()
     )
-    return mlrun.api.schemas.MostCommonObjectTypesReport(object_types=report)
+    return mlrun.common.schemas.MostCommonObjectTypesReport(object_types=report)
 
 
 @router.get(
     "/memory-reports/{object_type}",
-    response_model=mlrun.api.schemas.ObjectTypeReport,
+    response_model=mlrun.common.schemas.ObjectTypeReport,
 )
 def get_memory_usage_report(
     object_type: str,
     sample_size: int = 1,
     start_index: int = None,
     create_graph: bool = False,
     max_depth: int = 3,
 ):
     report = (
         mlrun.api.utils.memory_reports.MemoryUsageReport().create_memory_usage_report(
             object_type, sample_size, start_index, create_graph, max_depth
         )
     )
-    return mlrun.api.schemas.ObjectTypeReport(
+    return mlrun.common.schemas.ObjectTypeReport(
         object_type=object_type,
         sample_size=sample_size,
         start_index=start_index,
         max_depth=max_depth,
         object_report=report,
     )
```

## mlrun/api/crud/__init__.py

```diff
@@ -15,16 +15,16 @@
 # flake8: noqa: F401  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
 from .artifacts import Artifacts
 from .client_spec import ClientSpec
 from .clusterization_spec import ClusterizationSpec
 from .feature_store import FeatureStore
 from .functions import Functions
+from .hub import Hub
 from .logs import Logs
-from .marketplace import Marketplace
 from .model_monitoring import ModelEndpoints
 from .notifications import Notifications
 from .pipelines import Pipelines
 from .projects import Projects
 from .runs import Runs
 from .runtime_resources import RuntimeResources
 from .secrets import Secrets, SecretsClientType
```

## mlrun/api/crud/artifacts.py

```diff
@@ -12,22 +12,22 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import sqlalchemy.orm
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
+import mlrun.common.schemas.artifact
 import mlrun.config
 import mlrun.errors
 import mlrun.utils.singleton
-from mlrun.api.schemas.artifact import ArtifactsFormat
 
 
 class Artifacts(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     def store_artifact(
         self,
@@ -62,42 +62,42 @@
     def get_artifact(
         self,
         db_session: sqlalchemy.orm.Session,
         key: str,
         tag: str = "latest",
         iter: int = 0,
         project: str = mlrun.mlconf.default_project,
-        format_: ArtifactsFormat = ArtifactsFormat.full,
+        format_: mlrun.common.schemas.artifact.ArtifactsFormat = mlrun.common.schemas.artifact.ArtifactsFormat.full,
     ) -> dict:
         project = project or mlrun.mlconf.default_project
         artifact = mlrun.api.utils.singletons.db.get_db().read_artifact(
             db_session,
             key,
             tag,
             iter,
             project,
         )
-        if format_ == ArtifactsFormat.legacy:
+        if format_ == mlrun.common.schemas.artifact.ArtifactsFormat.legacy:
             return _transform_artifact_struct_to_legacy_format(artifact)
         return artifact
 
     def list_artifacts(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str = mlrun.mlconf.default_project,
         name: str = "",
         tag: str = "",
         labels: typing.List[str] = None,
         since=None,
         until=None,
         kind: typing.Optional[str] = None,
-        category: typing.Optional[mlrun.api.schemas.ArtifactCategories] = None,
+        category: typing.Optional[mlrun.common.schemas.ArtifactCategories] = None,
         iter: typing.Optional[int] = None,
         best_iteration: bool = False,
-        format_: ArtifactsFormat = ArtifactsFormat.full,
+        format_: mlrun.common.schemas.artifact.ArtifactsFormat = mlrun.common.schemas.artifact.ArtifactsFormat.full,
     ) -> typing.List:
         project = project or mlrun.mlconf.default_project
         if labels is None:
             labels = []
         artifacts = mlrun.api.utils.singletons.db.get_db().list_artifacts(
             db_session,
             name,
@@ -107,26 +107,26 @@
             since,
             until,
             kind,
             category,
             iter,
             best_iteration,
         )
-        if format_ != ArtifactsFormat.legacy:
+        if format_ != mlrun.common.schemas.artifact.ArtifactsFormat.legacy:
             return artifacts
         return [
             _transform_artifact_struct_to_legacy_format(artifact)
             for artifact in artifacts
         ]
 
     def list_artifact_tags(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str = mlrun.mlconf.default_project,
-        category: mlrun.api.schemas.ArtifactCategories = None,
+        category: mlrun.common.schemas.ArtifactCategories = None,
     ):
         project = project or mlrun.mlconf.default_project
         return mlrun.api.utils.singletons.db.get_db().list_artifact_tags(
             db_session, project, category
         )
 
     def delete_artifact(
@@ -144,15 +144,15 @@
     def delete_artifacts(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str = mlrun.mlconf.default_project,
         name: str = "",
         tag: str = "latest",
         labels: typing.List[str] = None,
-        auth_info: mlrun.api.schemas.AuthInfo = mlrun.api.schemas.AuthInfo(),
+        auth_info: mlrun.common.schemas.AuthInfo = mlrun.common.schemas.AuthInfo(),
     ):
         project = project or mlrun.mlconf.default_project
         mlrun.api.utils.singletons.db.get_db().del_artifacts(
             db_session, name, project, tag, labels
         )
```

## mlrun/api/crud/client_spec.py

```diff
@@ -8,28 +8,28 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.utils.singleton
 from mlrun.config import Config, config, default_config
 from mlrun.runtimes.utils import resolve_mpijob_crd_version, resolve_nuclio_version
 
 
 class ClientSpec(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     def get_client_spec(
         self, client_version: str = None, client_python_version: str = None
     ):
-        mpijob_crd_version = resolve_mpijob_crd_version(api_context=True)
-        return mlrun.api.schemas.ClientSpec(
+        mpijob_crd_version = resolve_mpijob_crd_version()
+        return mlrun.common.schemas.ClientSpec(
             version=config.version,
             namespace=config.namespace,
             docker_registry=config.httpdb.builder.docker_registry,
             remote_host=config.remote_host,
             mpijob_crd_version=mpijob_crd_version,
             ui_url=config.resolve_ui_url(),
             artifact_path=config.artifact_path,
```

## mlrun/api/crud/clusterization_spec.py

```diff
@@ -9,21 +9,21 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import mlrun
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.utils.singleton
 
 
 class ClusterizationSpec(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     @staticmethod
     def get_clusterization_spec():
         is_chief = mlrun.mlconf.httpdb.clusterization.role == "chief"
-        return mlrun.api.schemas.ClusterizationSpec(
+        return mlrun.common.schemas.ClusterizationSpec(
             chief_api_state=mlrun.mlconf.httpdb.state if is_chief else None,
             chief_version=mlrun.mlconf.version if is_chief else None,
         )
```

## mlrun/api/crud/feature_store.py

```diff
@@ -12,46 +12,46 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import sqlalchemy.orm
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils.singleton
 
 
 class FeatureStore(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     def create_feature_set(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
-        feature_set: mlrun.api.schemas.FeatureSet,
+        feature_set: mlrun.common.schemas.FeatureSet,
         versioned: bool = True,
     ) -> str:
         return self._create_object(
             db_session,
             project,
             feature_set,
             versioned,
         )
 
     def store_feature_set(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
-        feature_set: mlrun.api.schemas.FeatureSet,
+        feature_set: mlrun.common.schemas.FeatureSet,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
         versioned: bool = True,
     ) -> str:
         return self._store_object(
             db_session,
             project,
@@ -66,19 +66,19 @@
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         feature_set_patch: dict,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         return self._patch_object(
             db_session,
-            mlrun.api.schemas.FeatureSet,
+            mlrun.common.schemas.FeatureSet,
             project,
             name,
             feature_set_patch,
             tag,
             uid,
             patch_mode,
         )
@@ -86,46 +86,46 @@
     def get_feature_set(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.FeatureSet:
+    ) -> mlrun.common.schemas.FeatureSet:
         return self._get_object(
-            db_session, mlrun.api.schemas.FeatureSet, project, name, tag, uid
+            db_session, mlrun.common.schemas.FeatureSet, project, name, tag, uid
         )
 
     def list_feature_sets_tags(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
     ) -> typing.List[typing.Tuple[str, str, str]]:
         """
         :return: a list of Tuple of (project, feature_set.name, tag)
         """
         return self._list_object_type_tags(
-            db_session, mlrun.api.schemas.FeatureSet, project
+            db_session, mlrun.common.schemas.FeatureSet, project
         )
 
     def list_feature_sets(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         state: str = None,
         entities: typing.List[str] = None,
         features: typing.List[str] = None,
         labels: typing.List[str] = None,
-        partition_by: mlrun.api.schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: mlrun.api.schemas.SortField = None,
-        partition_order: mlrun.api.schemas.OrderType = mlrun.api.schemas.OrderType.desc,
-    ) -> mlrun.api.schemas.FeatureSetsOutput:
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
+    ) -> mlrun.common.schemas.FeatureSetsOutput:
         project = project or mlrun.mlconf.default_project
         return mlrun.api.utils.singletons.db.get_db().list_feature_sets(
             db_session,
             project,
             name,
             tag,
             state,
@@ -144,30 +144,30 @@
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
     ):
         self._delete_object(
             db_session,
-            mlrun.api.schemas.FeatureSet,
+            mlrun.common.schemas.FeatureSet,
             project,
             name,
             tag,
             uid,
         )
 
     def list_features(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         entities: typing.List[str] = None,
         labels: typing.List[str] = None,
-    ) -> mlrun.api.schemas.FeaturesOutput:
+    ) -> mlrun.common.schemas.FeaturesOutput:
         project = project or mlrun.mlconf.default_project
         return mlrun.api.utils.singletons.db.get_db().list_features(
             db_session,
             project,
             name,
             tag,
             entities,
@@ -177,39 +177,39 @@
     def list_entities(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         labels: typing.List[str] = None,
-    ) -> mlrun.api.schemas.EntitiesOutput:
+    ) -> mlrun.common.schemas.EntitiesOutput:
         project = project or mlrun.mlconf.default_project
         return mlrun.api.utils.singletons.db.get_db().list_entities(
             db_session,
             project,
             name,
             tag,
             labels,
         )
 
     def create_feature_vector(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
-        feature_vector: mlrun.api.schemas.FeatureVector,
+        feature_vector: mlrun.common.schemas.FeatureVector,
         versioned: bool = True,
     ) -> str:
         return self._create_object(db_session, project, feature_vector, versioned)
 
     def store_feature_vector(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
-        feature_vector: mlrun.api.schemas.FeatureVector,
+        feature_vector: mlrun.common.schemas.FeatureVector,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
         versioned: bool = True,
     ) -> str:
         return self._store_object(
             db_session,
             project,
@@ -224,19 +224,19 @@
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         feature_vector_patch: dict,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         return self._patch_object(
             db_session,
-            mlrun.api.schemas.FeatureVector,
+            mlrun.common.schemas.FeatureVector,
             project,
             name,
             feature_vector_patch,
             tag,
             uid,
             patch_mode,
         )
@@ -244,18 +244,18 @@
     def get_feature_vector(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.FeatureVector:
+    ) -> mlrun.common.schemas.FeatureVector:
         return self._get_object(
             db_session,
-            mlrun.api.schemas.FeatureVector,
+            mlrun.common.schemas.FeatureVector,
             project,
             name,
             tag,
             uid,
         )
 
     def list_feature_vectors_tags(
@@ -263,30 +263,30 @@
         db_session: sqlalchemy.orm.Session,
         project: str,
     ) -> typing.List[typing.Tuple[str, str, str]]:
         """
         :return: a list of Tuple of (project, feature_vector.name, tag)
         """
         return self._list_object_type_tags(
-            db_session, mlrun.api.schemas.FeatureVector, project
+            db_session, mlrun.common.schemas.FeatureVector, project
         )
 
     def list_feature_vectors(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         state: str = None,
         labels: typing.List[str] = None,
-        partition_by: mlrun.api.schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: mlrun.api.schemas.SortField = None,
-        partition_order: mlrun.api.schemas.OrderType = mlrun.api.schemas.OrderType.desc,
-    ) -> mlrun.api.schemas.FeatureVectorsOutput:
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
+    ) -> mlrun.common.schemas.FeatureVectorsOutput:
         project = project or mlrun.mlconf.default_project
         return mlrun.api.utils.singletons.db.get_db().list_feature_vectors(
             db_session,
             project,
             name,
             tag,
             state,
@@ -303,72 +303,72 @@
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
     ):
         self._delete_object(
             db_session,
-            mlrun.api.schemas.FeatureVector,
+            mlrun.common.schemas.FeatureVector,
             project,
             name,
             tag,
             uid,
         )
 
     def _create_object(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         object_: typing.Union[
-            mlrun.api.schemas.FeatureSet, mlrun.api.schemas.FeatureVector
+            mlrun.common.schemas.FeatureSet, mlrun.common.schemas.FeatureVector
         ],
         versioned: bool = True,
     ) -> str:
         project = project or mlrun.mlconf.default_project
         self._validate_and_enrich_identity_for_object_creation(project, object_)
-        if isinstance(object_, mlrun.api.schemas.FeatureSet):
+        if isinstance(object_, mlrun.common.schemas.FeatureSet):
             return mlrun.api.utils.singletons.db.get_db().create_feature_set(
                 db_session, project, object_, versioned
             )
-        elif isinstance(object_, mlrun.api.schemas.FeatureVector):
+        elif isinstance(object_, mlrun.common.schemas.FeatureVector):
             return mlrun.api.utils.singletons.db.get_db().create_feature_vector(
                 db_session, project, object_, versioned
             )
         else:
             raise NotImplementedError(
                 f"Provided object type is not supported. object_type={type(object_)}"
             )
 
     def _store_object(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         name: str,
         object_: typing.Union[
-            mlrun.api.schemas.FeatureSet, mlrun.api.schemas.FeatureVector
+            mlrun.common.schemas.FeatureSet, mlrun.common.schemas.FeatureVector
         ],
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
         versioned: bool = True,
     ) -> str:
         project = project or mlrun.mlconf.default_project
         self._validate_and_enrich_identity_for_object_store(
             object_, project, name, tag, uid
         )
-        if isinstance(object_, mlrun.api.schemas.FeatureSet):
+        if isinstance(object_, mlrun.common.schemas.FeatureSet):
             return mlrun.api.utils.singletons.db.get_db().store_feature_set(
                 db_session,
                 project,
                 name,
                 object_,
                 tag,
                 uid,
                 versioned,
             )
-        elif isinstance(object_, mlrun.api.schemas.FeatureVector):
+        elif isinstance(object_, mlrun.common.schemas.FeatureVector):
             return mlrun.api.utils.singletons.db.get_db().store_feature_vector(
                 db_session,
                 project,
                 name,
                 object_,
                 tag,
                 uid,
@@ -384,36 +384,36 @@
         db_session: sqlalchemy.orm.Session,
         object_schema: typing.ClassVar,
         project: str,
         name: str,
         object_patch: dict,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         project = project or mlrun.mlconf.default_project
         self._validate_identity_for_object_patch(
             object_schema.__class__.__name__,
             object_patch,
             project,
             name,
             tag,
             uid,
         )
-        if object_schema.__name__ == mlrun.api.schemas.FeatureSet.__name__:
+        if object_schema.__name__ == mlrun.common.schemas.FeatureSet.__name__:
             return mlrun.api.utils.singletons.db.get_db().patch_feature_set(
                 db_session,
                 project,
                 name,
                 object_patch,
                 tag,
                 uid,
                 patch_mode,
             )
-        elif object_schema.__name__ == mlrun.api.schemas.FeatureVector.__name__:
+        elif object_schema.__name__ == mlrun.common.schemas.FeatureVector.__name__:
             return mlrun.api.utils.singletons.db.get_db().patch_feature_vector(
                 db_session,
                 project,
                 name,
                 object_patch,
                 tag,
                 uid,
@@ -428,21 +428,23 @@
         self,
         db_session: sqlalchemy.orm.Session,
         object_schema: typing.ClassVar,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
-    ) -> typing.Union[mlrun.api.schemas.FeatureSet, mlrun.api.schemas.FeatureVector]:
+    ) -> typing.Union[
+        mlrun.common.schemas.FeatureSet, mlrun.common.schemas.FeatureVector
+    ]:
         project = project or mlrun.mlconf.default_project
-        if object_schema.__name__ == mlrun.api.schemas.FeatureSet.__name__:
+        if object_schema.__name__ == mlrun.common.schemas.FeatureSet.__name__:
             return mlrun.api.utils.singletons.db.get_db().get_feature_set(
                 db_session, project, name, tag, uid
             )
-        elif object_schema.__name__ == mlrun.api.schemas.FeatureVector.__name__:
+        elif object_schema.__name__ == mlrun.common.schemas.FeatureVector.__name__:
             return mlrun.api.utils.singletons.db.get_db().get_feature_vector(
                 db_session, project, name, tag, uid
             )
         else:
             raise NotImplementedError(
                 f"Provided object type is not supported. object_type={object_schema.__class__.__name__}"
             )
@@ -450,19 +452,19 @@
     def _list_object_type_tags(
         self,
         db_session: sqlalchemy.orm.Session,
         object_schema: typing.ClassVar,
         project: str,
     ) -> typing.List[typing.Tuple[str, str, str]]:
         project = project or mlrun.mlconf.default_project
-        if object_schema.__name__ == mlrun.api.schemas.FeatureSet.__name__:
+        if object_schema.__name__ == mlrun.common.schemas.FeatureSet.__name__:
             return mlrun.api.utils.singletons.db.get_db().list_feature_sets_tags(
                 db_session, project
             )
-        elif object_schema.__name__ == mlrun.api.schemas.FeatureVector.__name__:
+        elif object_schema.__name__ == mlrun.common.schemas.FeatureVector.__name__:
             return mlrun.api.utils.singletons.db.get_db().list_feature_vectors_tags(
                 db_session, project
             )
         else:
             raise NotImplementedError(
                 f"Provided object type is not supported. object_type={object_schema.__class__.__name__}"
             )
@@ -473,19 +475,19 @@
         object_schema: typing.ClassVar,
         project: str,
         name: str,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
     ):
         project = project or mlrun.mlconf.default_project
-        if object_schema.__name__ == mlrun.api.schemas.FeatureSet.__name__:
+        if object_schema.__name__ == mlrun.common.schemas.FeatureSet.__name__:
             mlrun.api.utils.singletons.db.get_db().delete_feature_set(
                 db_session, project, name, tag, uid
             )
-        elif object_schema.__name__ == mlrun.api.schemas.FeatureVector.__name__:
+        elif object_schema.__name__ == mlrun.common.schemas.FeatureVector.__name__:
             mlrun.api.utils.singletons.db.get_db().delete_feature_vector(
                 db_session, project, name, tag, uid
             )
         else:
             raise NotImplementedError(
                 f"Provided object type is not supported. object_type={object_schema.__class__.__name__}"
             )
@@ -515,15 +517,15 @@
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Changing name for an existing {object_type}"
             )
 
     @staticmethod
     def _validate_and_enrich_identity_for_object_store(
         object_: typing.Union[
-            mlrun.api.schemas.FeatureSet, mlrun.api.schemas.FeatureVector
+            mlrun.common.schemas.FeatureSet, mlrun.common.schemas.FeatureVector
         ],
         project: str,
         name: str,
         tag: str,
         uid: str,
     ):
         object_type = object_.__class__.__name__
@@ -546,15 +548,15 @@
                 f"Changing name for an existing {object_type}"
             )
 
     @staticmethod
     def _validate_and_enrich_identity_for_object_creation(
         project: str,
         object_: typing.Union[
-            mlrun.api.schemas.FeatureSet, mlrun.api.schemas.FeatureVector
+            mlrun.common.schemas.FeatureSet, mlrun.common.schemas.FeatureVector
         ],
     ):
         object_type = object_.__class__.__name__
         if not object_.metadata.name or not project:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"{object_type} missing name or project"
             )
```

## mlrun/api/crud/functions.py

```diff
@@ -13,18 +13,18 @@
 # limitations under the License.
 #
 import typing
 
 import sqlalchemy.orm
 
 import mlrun.api.api.utils
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils.singleton
 
 
 class Functions(
     metaclass=mlrun.utils.singleton.Singleton,
@@ -33,15 +33,15 @@
         self,
         db_session: sqlalchemy.orm.Session,
         function: dict,
         name: str,
         project: str = mlrun.mlconf.default_project,
         tag: str = "",
         versioned: bool = False,
-        auth_info: mlrun.api.schemas.AuthInfo = None,
+        auth_info: mlrun.common.schemas.AuthInfo = None,
     ) -> str:
         project = project or mlrun.mlconf.default_project
         if auth_info:
             function_obj = mlrun.new_function(
                 name=name, project=project, runtime=function, tag=tag
             )
             # not raising exception if no access key was provided as the store of the function can be part of
```

## mlrun/api/crud/logs.py

```diff
@@ -17,21 +17,21 @@
 import shutil
 import typing
 from http import HTTPStatus
 
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
-import mlrun.api.schemas
 import mlrun.api.utils.clients.log_collector as log_collector
+import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.utils.singleton
 from mlrun.api.api.utils import log_and_raise, log_path, project_logs_path
 from mlrun.api.constants import LogSources
 from mlrun.api.utils.singletons.db import get_db
-from mlrun.api.utils.singletons.k8s import get_k8s
 from mlrun.runtimes.constants import PodPhases
 from mlrun.utils import logger
 
 
 class Logs(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
@@ -81,15 +81,15 @@
         """
         project = project or mlrun.mlconf.default_project
         run = await self._get_run_for_log(db_session, project, uid)
         run_state = run.get("status", {}).get("state", "")
         log_stream = None
         if (
             mlrun.mlconf.log_collector.mode
-            == mlrun.api.schemas.LogsCollectorMode.best_effort
+            == mlrun.common.schemas.LogsCollectorMode.best_effort
             and source == LogSources.AUTO
         ):
             try:
                 log_stream = self._get_logs_from_logs_collector(
                     project,
                     uid,
                     size,
@@ -108,26 +108,26 @@
                     size,
                     offset,
                     source,
                     run,
                 )
         elif (
             mlrun.mlconf.log_collector.mode
-            == mlrun.api.schemas.LogsCollectorMode.sidecar
+            == mlrun.common.schemas.LogsCollectorMode.sidecar
             and source == LogSources.AUTO
         ):
             log_stream = self._get_logs_from_logs_collector(
                 project,
                 uid,
                 size,
                 offset,
             )
         elif (
             mlrun.mlconf.log_collector.mode
-            == mlrun.api.schemas.LogsCollectorMode.legacy
+            == mlrun.common.schemas.LogsCollectorMode.legacy
             or source != LogSources.AUTO
         ):
             log_stream = self._get_logs_legacy_method_generator_wrapper(
                 db_session,
                 project,
                 uid,
                 size,
@@ -174,32 +174,34 @@
         if not run:
             log_and_raise(HTTPStatus.NOT_FOUND.value, project=project, uid=uid)
         if log_file_exists and source in [LogSources.AUTO, LogSources.PERSISTENCY]:
             with log_file.open("rb") as fp:
                 fp.seek(offset)
                 log_contents = fp.read(size)
         elif source in [LogSources.AUTO, LogSources.K8S]:
-            k8s = get_k8s()
+            k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper()
             if k8s and k8s.is_running_inside_kubernetes_cluster():
                 run_kind = run.get("metadata", {}).get("labels", {}).get("kind")
-                pods = get_k8s().get_logger_pods(project, uid, run_kind)
+                pods = mlrun.api.utils.singletons.k8s.get_k8s_helper().get_logger_pods(
+                    project, uid, run_kind
+                )
                 if pods:
                     if len(pods) > 1:
 
                         # This shouldn't happen, but if it does, we log it here. No need to fail.
                         logger.debug(
                             "Got more than one pod in logger pods result",
                             run_uid=uid,
                             run_kind=run_kind,
                             project=project,
                             pods=pods,
                         )
                     pod, pod_phase = list(pods.items())[0]
                     if pod_phase != PodPhases.pending:
-                        resp = get_k8s().logs(pod)
+                        resp = mlrun.api.utils.singletons.k8s.get_k8s_helper().logs(pod)
                         if resp:
                             if size == -1:
                                 log_contents = resp.encode()[offset:]
                             else:
                                 log_contents = resp.encode()[offset : offset + size]
         return log_contents
```

## mlrun/api/crud/pipelines.py

```diff
@@ -20,15 +20,15 @@
 import typing
 
 import kfp
 import sqlalchemy.orm
 
 import mlrun
 import mlrun.api.api.utils
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.kfpops
 import mlrun.utils.helpers
 import mlrun.utils.singleton
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
 
@@ -40,22 +40,22 @@
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         namespace: typing.Optional[str] = None,
         sort_by: str = "",
         page_token: str = "",
         filter_: str = "",
-        format_: mlrun.api.schemas.PipelinesFormat = mlrun.api.schemas.PipelinesFormat.metadata_only,
+        format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
         page_size: typing.Optional[int] = None,
     ) -> typing.Tuple[int, typing.Optional[int], typing.List[dict]]:
         if project != "*" and (page_token or page_size):
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "Filtering by project can not be used together with pagination"
             )
-        if format_ == mlrun.api.schemas.PipelinesFormat.summary:
+        if format_ == mlrun.common.schemas.PipelinesFormat.summary:
             # we don't support summary format in list pipelines since the returned runs doesn't include the workflow
             # manifest status that includes the nodes section we use to generate the DAG.
             # (There is a workflow manifest under the run's pipeline_spec field, but it doesn't include the status)
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "Summary format is not supported for list pipelines, use get instead"
             )
         kfp_url = mlrun.mlconf.resolve_kfp_url(namespace)
@@ -68,15 +68,15 @@
             run_dicts = []
             while page_token is not None:
                 # kfp doesn't allow us to pass both a page_token and the filter. When we have a token from previous
                 # call, we will strip out the filter and use the token to continue (the token contains the details of
                 # the filter that was used to create it)
                 response = kfp_client._run_api.list_runs(
                     page_token=page_token,
-                    page_size=mlrun.api.schemas.PipelinesPagination.max_page_size,
+                    page_size=mlrun.common.schemas.PipelinesPagination.max_page_size,
                     sort_by=sort_by,
                     filter=filter_ if page_token == "" else "",
                 )
                 run_dicts.extend([run.to_dict() for run in response.runs or []])
                 page_token = response.next_page_token
             project_runs = []
             for run_dict in run_dicts:
@@ -86,15 +86,15 @@
             runs = project_runs
             total_size = len(project_runs)
             next_page_token = None
         else:
             response = kfp_client._run_api.list_runs(
                 page_token=page_token,
                 page_size=page_size
-                or mlrun.api.schemas.PipelinesPagination.default_page_size,
+                or mlrun.common.schemas.PipelinesPagination.default_page_size,
                 sort_by=sort_by,
                 filter=filter_,
             )
             runs = [run.to_dict() for run in response.runs or []]
             total_size = response.total_size
             next_page_token = response.next_page_token
         runs = self._format_runs(db_session, runs, format_)
@@ -103,15 +103,15 @@
 
     def get_pipeline(
         self,
         db_session: sqlalchemy.orm.Session,
         run_id: str,
         project: typing.Optional[str] = None,
         namespace: typing.Optional[str] = None,
-        format_: mlrun.api.schemas.PipelinesFormat = mlrun.api.schemas.PipelinesFormat.summary,
+        format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.summary,
     ):
         kfp_url = mlrun.mlconf.resolve_kfp_url(namespace)
         if not kfp_url:
             raise mlrun.errors.MLRunBadRequestError(
                 "KubeFlow Pipelines is not configured"
             )
         kfp_client = kfp.Client(host=kfp_url)
@@ -197,32 +197,32 @@
 
         return run
 
     def _format_runs(
         self,
         db_session: sqlalchemy.orm.Session,
         runs: typing.List[dict],
-        format_: mlrun.api.schemas.PipelinesFormat = mlrun.api.schemas.PipelinesFormat.metadata_only,
+        format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
     ) -> typing.List[dict]:
         formatted_runs = []
         for run in runs:
             formatted_runs.append(self._format_run(db_session, run, format_))
         return formatted_runs
 
     def _format_run(
         self,
         db_session: sqlalchemy.orm.Session,
         run: dict,
-        format_: mlrun.api.schemas.PipelinesFormat = mlrun.api.schemas.PipelinesFormat.metadata_only,
+        format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
         api_run_detail: typing.Optional[dict] = None,
     ) -> dict:
         run["project"] = self.resolve_project_from_pipeline(run)
-        if format_ == mlrun.api.schemas.PipelinesFormat.full:
+        if format_ == mlrun.common.schemas.PipelinesFormat.full:
             return run
-        elif format_ == mlrun.api.schemas.PipelinesFormat.metadata_only:
+        elif format_ == mlrun.common.schemas.PipelinesFormat.metadata_only:
             return {
                 k: str(v)
                 for k, v in run.items()
                 if k
                 in [
                     "id",
                     "name",
@@ -231,17 +231,17 @@
                     "error",
                     "created_at",
                     "scheduled_at",
                     "finished_at",
                     "description",
                 ]
             }
-        elif format_ == mlrun.api.schemas.PipelinesFormat.name_only:
+        elif format_ == mlrun.common.schemas.PipelinesFormat.name_only:
             return run.get("name")
-        elif format_ == mlrun.api.schemas.PipelinesFormat.summary:
+        elif format_ == mlrun.common.schemas.PipelinesFormat.summary:
             if not api_run_detail:
                 raise mlrun.errors.MLRunRuntimeError(
                     "The full kfp api_run_detail object is needed to generate the summary format"
                 )
             return mlrun.kfpops.format_summary_from_kfp_run(
                 api_run_detail, run["project"], db_session
             )
```

## mlrun/api/crud/projects.py

```diff
@@ -19,19 +19,19 @@
 
 import fastapi.concurrency
 import humanfriendly
 import sqlalchemy.orm
 
 import mlrun.api.crud
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.k8s
 import mlrun.api.utils.singletons.scheduler
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class Projects(
     mlrun.api.utils.projects.remotes.follower.Member,
@@ -40,62 +40,82 @@
     def __init__(self) -> None:
         super().__init__()
         self._cache = {
             "project_resources_counters": {"value": None, "ttl": datetime.datetime.min}
         }
 
     def create_project(
-        self, session: sqlalchemy.orm.Session, project: mlrun.api.schemas.Project
+        self, session: sqlalchemy.orm.Session, project: mlrun.common.schemas.Project
     ):
-        logger.debug("Creating project", project=project)
+        logger.debug(
+            "Creating project",
+            name=project.metadata.name,
+            owner=project.spec.owner,
+            created_time=project.metadata.created,
+            desired_state=project.spec.desired_state,
+            state=project.status.state,
+            function_amount=len(project.spec.functions or []),
+            artifact_amount=len(project.spec.artifacts or []),
+            workflows_amount=len(project.spec.workflows or []),
+        )
         mlrun.api.utils.singletons.db.get_db().create_project(session, project)
 
     def store_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
-        logger.debug("Storing project", name=name, project=project)
+        logger.debug(
+            "Storing project",
+            name=project.metadata.name,
+            owner=project.spec.owner,
+            created_time=project.metadata.created,
+            desired_state=project.spec.desired_state,
+            state=project.status.state,
+            function_amount=len(project.spec.functions or []),
+            artifact_amount=len(project.spec.artifacts or []),
+            workflows_amount=len(project.spec.workflows or []),
+        )
         mlrun.api.utils.singletons.db.get_db().store_project(session, name, project)
 
     def patch_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ):
         logger.debug(
             "Patching project", name=name, project=project, patch_mode=patch_mode
         )
         mlrun.api.utils.singletons.db.get_db().patch_project(
             session, name, project, patch_mode
         )
 
     def delete_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         logger.debug("Deleting project", name=name, deletion_strategy=deletion_strategy)
         if (
             deletion_strategy.is_restricted()
-            or deletion_strategy == mlrun.api.schemas.DeletionStrategy.check
+            or deletion_strategy == mlrun.common.schemas.DeletionStrategy.check
         ):
             if not mlrun.api.utils.singletons.db.get_db().is_project_exists(
                 session, name
             ):
                 return
             mlrun.api.utils.singletons.db.get_db().verify_project_has_no_related_resources(
                 session, name
             )
             self._verify_project_has_no_external_resources(name)
-            if deletion_strategy == mlrun.api.schemas.DeletionStrategy.check:
+            if deletion_strategy == mlrun.common.schemas.DeletionStrategy.check:
                 return
         elif deletion_strategy.is_cascading():
             self.delete_project_resources(session, name)
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Unknown deletion strategy: {deletion_strategy}"
             )
@@ -110,15 +130,15 @@
 
         # Note: this check lists also internal secrets. The assumption is that any internal secret that relate to
         # an MLRun resource (such as model-endpoints) was already verified in previous checks. Therefore, any internal
         # secret existing here is something that the user needs to be notified about, as MLRun didn't generate it.
         # Therefore, this check should remain at the end of the verification flow.
         if (
             mlrun.mlconf.is_api_running_on_k8s()
-            and mlrun.api.utils.singletons.k8s.get_k8s().get_project_secret_keys(
+            and mlrun.api.utils.singletons.k8s.get_k8s_helper().get_project_secret_keys(
                 project
             )
         ):
             raise mlrun.errors.MLRunPreconditionFailedError(
                 f"Project {project} can not be deleted since related resources found: project secrets"
             )
 
@@ -138,96 +158,98 @@
             label_selector=f"mlrun/project={name}",
             force=True,
         )
 
         # log collector service will delete the logs, so we don't need to do it here
         if (
             mlrun.mlconf.log_collector.mode
-            == mlrun.api.schemas.LogsCollectorMode.legacy
+            == mlrun.common.schemas.LogsCollectorMode.legacy
         ):
             mlrun.api.crud.Logs().delete_logs(name)
 
         # delete db resources
         mlrun.api.utils.singletons.db.get_db().delete_project_related_resources(
             session, name
         )
 
         # delete model monitoring resources
         mlrun.api.crud.ModelEndpoints().delete_model_endpoints_resources(name)
 
         # delete project secrets - passing None will delete all secrets
         if mlrun.mlconf.is_api_running_on_k8s():
-            mlrun.api.utils.singletons.k8s.get_k8s().delete_project_secrets(name, None)
+            mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_project_secrets(
+                name, None
+            )
 
     def get_project(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         return mlrun.api.utils.singletons.db.get_db().get_project(session, name)
 
     def list_projects(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         return mlrun.api.utils.singletons.db.get_db().list_projects(
             session, owner, format_, labels, state, names
         )
 
     async def list_project_summaries(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         projects_output = await fastapi.concurrency.run_in_threadpool(
             self.list_projects,
             session,
             owner,
-            mlrun.api.schemas.ProjectsFormat.name_only,
+            mlrun.common.schemas.ProjectsFormat.name_only,
             labels,
             state,
             names,
         )
         project_summaries = await self.generate_projects_summaries(
             projects_output.projects
         )
-        return mlrun.api.schemas.ProjectSummariesOutput(
+        return mlrun.common.schemas.ProjectSummariesOutput(
             project_summaries=project_summaries
         )
 
     async def get_project_summary(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         # Call get project so we'll explode if project doesn't exists
         await fastapi.concurrency.run_in_threadpool(self.get_project, session, name)
         project_summaries = await self.generate_projects_summaries([name])
         return project_summaries[0]
 
     async def generate_projects_summaries(
         self, projects: typing.List[str]
-    ) -> typing.List[mlrun.api.schemas.ProjectSummary]:
+    ) -> typing.List[mlrun.common.schemas.ProjectSummary]:
         (
             project_to_files_count,
             project_to_schedule_count,
             project_to_feature_set_count,
             project_to_models_count,
             project_to_recent_failed_runs_count,
             project_to_running_runs_count,
             project_to_running_pipelines_count,
         ) = await self._get_project_resources_counters()
         project_summaries = []
         for project in projects:
             project_summaries.append(
-                mlrun.api.schemas.ProjectSummary(
+                mlrun.common.schemas.ProjectSummary(
                     name=project,
                     files_count=project_to_files_count.get(project, 0),
                     schedules_count=project_to_schedule_count.get(project, 0),
                     feature_sets_count=project_to_feature_set_count.get(project, 0),
                     models_count=project_to_models_count.get(project, 0),
                     runs_failed_recent_count=project_to_recent_failed_runs_count.get(
                         project, 0
@@ -290,15 +312,15 @@
             )
             self._cache["project_resources_counters"]["ttl"] = ttl_time
         return self._cache["project_resources_counters"]["result"]
 
     @staticmethod
     def _list_pipelines(
         session,
-        format_: mlrun.api.schemas.PipelinesFormat = mlrun.api.schemas.PipelinesFormat.metadata_only,
+        format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
     ):
         return mlrun.api.crud.Pipelines().list_pipelines(session, "*", format_=format_)
 
     async def _calculate_pipelines_counters(
         self,
     ) -> typing.Dict[str, typing.Union[int, None]]:
         # creating defaultdict instead of a regular dict, because it possible that not all projects have pipelines
```

## mlrun/api/crud/runs.py

```diff
@@ -12,18 +12,18 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import sqlalchemy.orm
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.lists
 import mlrun.runtimes
 import mlrun.runtimes.constants
 import mlrun.utils.singleton
 from mlrun.utils import logger
@@ -116,18 +116,18 @@
         sort=True,
         last=0,
         iter=False,
         start_time_from=None,
         start_time_to=None,
         last_update_time_from=None,
         last_update_time_to=None,
-        partition_by: mlrun.api.schemas.RunPartitionByField = None,
+        partition_by: mlrun.common.schemas.RunPartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: mlrun.api.schemas.SortField = None,
-        partition_order: mlrun.api.schemas.OrderType = mlrun.api.schemas.OrderType.desc,
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
         requested_logs: bool = None,
         return_as_run_structs: bool = True,
         with_notifications: bool = False,
     ):
         project = project or mlrun.mlconf.default_project
         return mlrun.api.utils.singletons.db.get_db().list_runs(
```

## mlrun/api/crud/runtime_resources.py

```diff
@@ -14,17 +14,17 @@
 #
 import typing
 
 import mergedeep
 import sqlalchemy.orm
 
 import mlrun.api.api.utils
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.runtimes
 import mlrun.utils.singleton
 
 
 class RuntimeResources(
@@ -33,52 +33,52 @@
     def list_runtime_resources(
         self,
         project: str,
         kind: typing.Optional[str] = None,
         object_id: typing.Optional[str] = None,
         label_selector: typing.Optional[str] = None,
         group_by: typing.Optional[
-            mlrun.api.schemas.ListRuntimeResourcesGroupByField
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
         ] = None,
     ) -> typing.Union[
-        mlrun.api.schemas.RuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ]:
         response = [] if group_by is None else {}
         kinds = mlrun.runtimes.RuntimeKinds.runtime_with_handlers()
         if kind is not None:
             self.validate_runtime_resources_kind(kind)
             kinds = [kind]
         for kind in kinds:
             runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
             resources = runtime_handler.list_resources(
                 project, object_id, label_selector, group_by
             )
             if group_by is None:
                 response.append(
-                    mlrun.api.schemas.KindRuntimeResources(
+                    mlrun.common.schemas.KindRuntimeResources(
                         kind=kind, resources=resources
                     )
                 )
             else:
                 mergedeep.merge(response, resources)
         return response
 
     def filter_and_format_grouped_by_project_runtime_resources_output(
         self,
-        grouped_by_project_runtime_resources_output: mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        grouped_by_project_runtime_resources_output: mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
         allowed_projects: typing.List[str],
         group_by: typing.Optional[
-            mlrun.api.schemas.ListRuntimeResourcesGroupByField
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
         ] = None,
     ) -> typing.Union[
-        mlrun.api.schemas.RuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ]:
         runtime_resources_by_kind = {}
         for (
             project,
             kind_runtime_resources_map,
         ) in grouped_by_project_runtime_resources_output.items():
             for kind, runtime_resources in kind_runtime_resources_map.items():
@@ -90,15 +90,15 @@
         for kind, runtime_resources_list in runtime_resources_by_kind.items():
             runtime_handler = mlrun.runtimes.get_runtime_handler(kind)
             resources = runtime_handler.build_output_from_runtime_resources(
                 runtime_resources_list, group_by
             )
             if group_by is None:
                 runtimes_resources_output.append(
-                    mlrun.api.schemas.KindRuntimeResources(
+                    mlrun.common.schemas.KindRuntimeResources(
                         kind=kind, resources=resources
                     )
                 )
             else:
                 mergedeep.merge(runtimes_resources_output, resources)
         return runtimes_resources_output
```

## mlrun/api/crud/secrets.py

```diff
@@ -13,28 +13,28 @@
 # limitations under the License.
 #
 import enum
 import json
 import typing
 import uuid
 
-import mlrun.api.schemas
 import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 import mlrun.utils.vault
 
 
 class SecretsClientType(str, enum.Enum):
     schedules = "schedules"
     model_monitoring = "model-monitoring"
     service_accounts = "service-accounts"
-    marketplace = "marketplace"
+    hub = "hub"
     notifications = "notifications"
 
 
 class Secrets(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     internal_secrets_key_prefix = "mlrun."
@@ -70,15 +70,15 @@
                 f"Not allowed to create/update internal secrets (key starts with "
                 f"{self.internal_secrets_key_prefix})"
             )
 
     def store_project_secrets(
         self,
         project: str,
-        secrets: mlrun.api.schemas.SecretsData,
+        secrets: mlrun.common.schemas.SecretsData,
         allow_internal_secrets: bool = False,
         key_map_secret_key: typing.Optional[str] = None,
         allow_storing_key_maps: bool = False,
     ):
         """
         When secret keys are coming from other object identifiers, which may not be valid secret keys, use
         key_map_secret_key.
@@ -90,85 +90,85 @@
             project,
             secrets,
             allow_internal_secrets,
             key_map_secret_key,
             allow_storing_key_maps,
         )
 
-        if secrets.provider == mlrun.api.schemas.SecretProviderName.vault:
+        if secrets.provider == mlrun.common.schemas.SecretProviderName.vault:
             # Init is idempotent and will do nothing if infra is already in place
             mlrun.utils.vault.init_project_vault_configuration(project)
 
             # If no secrets were passed, no need to touch the actual secrets.
             if secrets_to_store:
                 mlrun.utils.vault.store_vault_project_secrets(project, secrets_to_store)
-        elif secrets.provider == mlrun.api.schemas.SecretProviderName.kubernetes:
-            if mlrun.api.utils.singletons.k8s.get_k8s():
-                mlrun.api.utils.singletons.k8s.get_k8s().store_project_secrets(
+        elif secrets.provider == mlrun.common.schemas.SecretProviderName.kubernetes:
+            if mlrun.api.utils.singletons.k8s.get_k8s_helper():
+                mlrun.api.utils.singletons.k8s.get_k8s_helper().store_project_secrets(
                     project, secrets_to_store
                 )
             else:
                 raise mlrun.errors.MLRunInternalServerError(
                     "K8s provider cannot be initialized"
                 )
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Provider requested is not supported. provider = {secrets.provider}"
             )
 
     def read_auth_secret(
         self, secret_name, raise_on_not_found=False
-    ) -> mlrun.api.schemas.AuthSecretData:
+    ) -> mlrun.common.schemas.AuthSecretData:
         (
             username,
             access_key,
-        ) = mlrun.api.utils.singletons.k8s.get_k8s().read_auth_secret(
+        ) = mlrun.api.utils.singletons.k8s.get_k8s_helper().read_auth_secret(
             secret_name, raise_on_not_found=raise_on_not_found
         )
-        return mlrun.api.schemas.AuthSecretData(
-            provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+        return mlrun.common.schemas.AuthSecretData(
+            provider=mlrun.common.schemas.SecretProviderName.kubernetes,
             username=username,
             access_key=access_key,
         )
 
     def store_auth_secret(
         self,
-        secret: mlrun.api.schemas.AuthSecretData,
+        secret: mlrun.common.schemas.AuthSecretData,
     ) -> str:
-        if secret.provider != mlrun.api.schemas.SecretProviderName.kubernetes:
+        if secret.provider != mlrun.common.schemas.SecretProviderName.kubernetes:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Storing auth secret is not implemented for provider {secret.provider}"
             )
-        if not mlrun.api.utils.singletons.k8s.get_k8s():
+        if not mlrun.api.utils.singletons.k8s.get_k8s_helper():
             raise mlrun.errors.MLRunInternalServerError(
                 "K8s provider cannot be initialized"
             )
-        return mlrun.api.utils.singletons.k8s.get_k8s().store_auth_secret(
+        return mlrun.api.utils.singletons.k8s.get_k8s_helper().store_auth_secret(
             secret.username, secret.access_key
         )
 
     def delete_auth_secret(
         self,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         secret_name: str,
     ):
-        if provider != mlrun.api.schemas.SecretProviderName.kubernetes:
+        if provider != mlrun.common.schemas.SecretProviderName.kubernetes:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Storing auth secret is not implemented for provider {provider}"
             )
-        if not mlrun.api.utils.singletons.k8s.get_k8s():
+        if not mlrun.api.utils.singletons.k8s.get_k8s_helper():
             raise mlrun.errors.MLRunInternalServerError(
                 "K8s provider cannot be initialized"
             )
-        mlrun.api.utils.singletons.k8s.get_k8s().delete_auth_secret(secret_name)
+        mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_auth_secret(secret_name)
 
     def delete_project_secrets(
         self,
         project: str,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         secrets: typing.Optional[typing.List[str]] = None,
         allow_internal_secrets: bool = False,
     ):
         if not allow_internal_secrets:
             if secrets:
                 for secret_key in secrets:
                     if self._is_internal_project_secret_key(secret_key):
@@ -182,57 +182,57 @@
                 secrets = self.list_project_secret_keys(
                     project, provider, allow_internal_secrets=False
                 ).secret_keys
                 if not secrets:
                     # nothing to remove - return
                     return
 
-        if provider == mlrun.api.schemas.SecretProviderName.vault:
+        if provider == mlrun.common.schemas.SecretProviderName.vault:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Delete secret is not implemented for provider {provider}"
             )
-        elif provider == mlrun.api.schemas.SecretProviderName.kubernetes:
-            if mlrun.api.utils.singletons.k8s.get_k8s():
-                mlrun.api.utils.singletons.k8s.get_k8s().delete_project_secrets(
+        elif provider == mlrun.common.schemas.SecretProviderName.kubernetes:
+            if mlrun.api.utils.singletons.k8s.get_k8s_helper():
+                mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_project_secrets(
                     project, secrets
                 )
             else:
                 raise mlrun.errors.MLRunInternalServerError(
                     "K8s provider cannot be initialized"
                 )
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Provider requested is not supported. provider = {provider}"
             )
 
     def list_project_secret_keys(
         self,
         project: str,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         token: typing.Optional[str] = None,
         allow_internal_secrets: bool = False,
-    ) -> mlrun.api.schemas.SecretKeysData:
-        if provider == mlrun.api.schemas.SecretProviderName.vault:
+    ) -> mlrun.common.schemas.SecretKeysData:
+        if provider == mlrun.common.schemas.SecretProviderName.vault:
             if not token:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     "Vault list project secret keys request without providing token"
                 )
 
             vault = mlrun.utils.vault.VaultStore(token)
             secret_values = vault.get_secrets(None, project=project)
             secret_keys = list(secret_values.keys())
-        elif provider == mlrun.api.schemas.SecretProviderName.kubernetes:
+        elif provider == mlrun.common.schemas.SecretProviderName.kubernetes:
             if token:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     "Cannot specify token when requesting k8s secret keys"
                 )
 
-            if mlrun.api.utils.singletons.k8s.get_k8s():
+            if mlrun.api.utils.singletons.k8s.get_k8s_helper():
                 secret_keys = (
-                    mlrun.api.utils.singletons.k8s.get_k8s().get_project_secret_keys(
+                    mlrun.api.utils.singletons.k8s.get_k8s_helper().get_project_secret_keys(
                         project
                     )
                     or []
                 )
             else:
                 raise mlrun.errors.MLRunInternalServerError(
                     "K8s provider cannot be initialized"
@@ -245,62 +245,62 @@
             secret_keys = list(
                 filter(
                     lambda key: not self._is_internal_project_secret_key(key),
                     secret_keys,
                 )
             )
 
-        return mlrun.api.schemas.SecretKeysData(
+        return mlrun.common.schemas.SecretKeysData(
             provider=provider, secret_keys=secret_keys
         )
 
     def list_project_secrets(
         self,
         project: str,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         secrets: typing.Optional[typing.List[str]] = None,
         token: typing.Optional[str] = None,
         allow_secrets_from_k8s: bool = False,
         allow_internal_secrets: bool = False,
-    ) -> mlrun.api.schemas.SecretsData:
-        if provider == mlrun.api.schemas.SecretProviderName.vault:
+    ) -> mlrun.common.schemas.SecretsData:
+        if provider == mlrun.common.schemas.SecretProviderName.vault:
             if not token:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     "Vault list project secrets request without providing token"
                 )
 
             vault = mlrun.utils.vault.VaultStore(token)
             secrets_data = vault.get_secrets(secrets, project=project)
-        elif provider == mlrun.api.schemas.SecretProviderName.kubernetes:
+        elif provider == mlrun.common.schemas.SecretProviderName.kubernetes:
             if not allow_secrets_from_k8s:
                 raise mlrun.errors.MLRunAccessDeniedError(
                     "Not allowed to list secrets data from kubernetes provider"
                 )
             secrets_data = (
-                mlrun.api.utils.singletons.k8s.get_k8s().get_project_secret_data(
+                mlrun.api.utils.singletons.k8s.get_k8s_helper().get_project_secret_data(
                     project, secrets
                 )
             )
 
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Provider requested is not supported. provider = {provider}"
             )
         if not allow_internal_secrets:
             secrets_data = {
                 key: value
                 for key, value in secrets_data.items()
                 if not self._is_internal_project_secret_key(key)
             }
-        return mlrun.api.schemas.SecretsData(provider=provider, secrets=secrets_data)
+        return mlrun.common.schemas.SecretsData(provider=provider, secrets=secrets_data)
 
     def delete_project_secret(
         self,
         project: str,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         secret_key: str,
         token: typing.Optional[str] = None,
         allow_secrets_from_k8s: bool = False,
         allow_internal_secrets: bool = False,
         key_map_secret_key: typing.Optional[str] = None,
     ):
         from_key_map, secret_key_to_remove = self._resolve_project_secret_key(
@@ -318,30 +318,30 @@
         if from_key_map:
             # clean key from key map
             key_map = self._get_project_secret_key_map(project, key_map_secret_key)
             del key_map[secret_key]
             if key_map:
                 self.store_project_secrets(
                     project,
-                    mlrun.api.schemas.SecretsData(
+                    mlrun.common.schemas.SecretsData(
                         provider=provider,
                         secrets={key_map_secret_key: json.dumps(key_map)},
                     ),
                     allow_internal_secrets=True,
                     allow_storing_key_maps=True,
                 )
             else:
                 self.delete_project_secrets(
                     project, provider, [key_map_secret_key], allow_internal_secrets=True
                 )
 
     def get_project_secret(
         self,
         project: str,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         secret_key: str,
         token: typing.Optional[str] = None,
         allow_secrets_from_k8s: bool = False,
         allow_internal_secrets: bool = False,
         key_map_secret_key: typing.Optional[str] = None,
     ) -> typing.Optional[str]:
         from_key_map, secret_key = self._resolve_project_secret_key(
@@ -362,23 +362,23 @@
             allow_internal_secrets,
         )
         return secrets_data.secrets.get(secret_key)
 
     def _resolve_project_secret_key(
         self,
         project: str,
-        provider: mlrun.api.schemas.SecretProviderName,
+        provider: mlrun.common.schemas.SecretProviderName,
         secret_key: str,
         token: typing.Optional[str] = None,
         allow_secrets_from_k8s: bool = False,
         allow_internal_secrets: bool = False,
         key_map_secret_key: typing.Optional[str] = None,
     ) -> typing.Tuple[bool, str]:
         if key_map_secret_key:
-            if provider != mlrun.api.schemas.SecretProviderName.kubernetes:
+            if provider != mlrun.common.schemas.SecretProviderName.kubernetes:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     f"Secret using key map is not implemented for provider {provider}"
                 )
             if self._is_project_secret_stored_in_key_map(secret_key):
                 secrets_data = self.list_project_secrets(
                     project,
                     provider,
@@ -392,15 +392,15 @@
                     if secret_key in key_map:
                         return True, key_map[secret_key]
         return False, secret_key
 
     def _validate_and_enrich_project_secrets_to_store(
         self,
         project: str,
-        secrets: mlrun.api.schemas.SecretsData,
+        secrets: mlrun.common.schemas.SecretsData,
         allow_internal_secrets: bool = False,
         key_map_secret_key: typing.Optional[str] = None,
         allow_storing_key_maps: bool = False,
     ):
         secrets_to_store = secrets.secrets.copy()
         if secrets_to_store:
             for secret_key in secrets_to_store.keys():
@@ -415,15 +415,18 @@
                     and not allow_storing_key_maps
                 ):
                     raise mlrun.errors.MLRunAccessDeniedError(
                         f"Not allowed to create/update key map (key starts with "
                         f"{self.key_map_secrets_key_prefix})"
                     )
             if key_map_secret_key:
-                if secrets.provider != mlrun.api.schemas.SecretProviderName.kubernetes:
+                if (
+                    secrets.provider
+                    != mlrun.common.schemas.SecretProviderName.kubernetes
+                ):
                     raise mlrun.errors.MLRunInvalidArgumentError(
                         f"Storing secret using key map is not implemented for provider {secrets.provider}"
                     )
                 if not self._is_key_map_project_secret_key(key_map_secret_key):
                     raise mlrun.errors.MLRunInvalidArgumentError(
                         f"Key map secret key must start with: {self.key_map_secrets_key_prefix}"
                     )
@@ -463,15 +466,15 @@
     def _get_project_secret_key_map(
         self,
         project: str,
         key_map_secret_key: str,
     ) -> typing.Optional[dict]:
         secrets_data = self.list_project_secrets(
             project,
-            mlrun.api.schemas.SecretProviderName.kubernetes,
+            mlrun.common.schemas.SecretProviderName.kubernetes,
             [key_map_secret_key],
             allow_secrets_from_k8s=True,
             allow_internal_secrets=True,
         )
         value = secrets_data.secrets.get(key_map_secret_key)
         if value:
             value = json.loads(value)
```

## mlrun/api/crud/tags.py

```diff
@@ -11,18 +11,18 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import sqlalchemy.orm
 
 import mlrun.api.db.sqldb.db
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils.singleton
 
 kind_to_function_names = {
     "artifact": {
         "overwrite": mlrun.api.db.sqldb.db.SQLDB.overwrite_artifacts_with_tag.__name__,
@@ -36,15 +36,15 @@
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     @staticmethod
     def overwrite_object_tags_with_tag(
         db_session: sqlalchemy.orm.Session,
         project: str,
         tag: str,
-        tag_objects: mlrun.api.schemas.TagObjects,
+        tag_objects: mlrun.common.schemas.TagObjects,
     ):
         overwrite_func = kind_to_function_names.get(tag_objects.kind, {}).get(
             "overwrite"
         )
         if not overwrite_func:
             raise mlrun.errors.MLRunNotFoundError(
                 f"couldn't find overwrite function for object kind: {tag_objects.kind}"
@@ -57,15 +57,15 @@
         )
 
     @staticmethod
     def append_tag_to_objects(
         db_session: sqlalchemy.orm.Session,
         project: str,
         tag: str,
-        tag_objects: mlrun.api.schemas.TagObjects,
+        tag_objects: mlrun.common.schemas.TagObjects,
     ):
         append_func = kind_to_function_names.get(tag_objects.kind, {}).get("append")
         if not append_func:
             raise mlrun.errors.MLRunNotFoundError(
                 f"couldn't find append function for object kind: {tag_objects.kind}"
             )
         getattr(mlrun.api.utils.singletons.db.get_db(), append_func)(
@@ -76,15 +76,15 @@
         )
 
     @staticmethod
     def delete_tag_from_objects(
         db_session: sqlalchemy.orm.Session,
         project: str,
         tag: str,
-        tag_objects: mlrun.api.schemas.TagObjects,
+        tag_objects: mlrun.common.schemas.TagObjects,
     ):
         delete_func = kind_to_function_names.get(tag_objects.kind, {}).get("delete")
         if not delete_func:
             raise mlrun.errors.MLRunNotFoundError(
                 f"couldn't find delete function for object kind: {tag_objects.kind}"
             )
         getattr(mlrun.api.utils.singletons.db.get_db(), delete_func)(
```

## mlrun/api/crud/model_monitoring/grafana.py

```diff
@@ -17,63 +17,57 @@
 
 import numpy as np
 import pandas as pd
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
-import mlrun.model_monitoring
-from mlrun.api.schemas import (
-    GrafanaColumn,
-    GrafanaDataPoint,
-    GrafanaNumberColumn,
-    GrafanaTable,
-    GrafanaTimeSeriesTarget,
-    ProjectsFormat,
-)
+import mlrun.common.model_monitoring
+import mlrun.common.schemas
 from mlrun.api.utils.singletons.project_member import get_project_member
 from mlrun.errors import MLRunBadRequestError
 from mlrun.utils import config, logger
 from mlrun.utils.model_monitoring import parse_model_endpoint_store_prefix
 from mlrun.utils.v3io_clients import get_frames_client
 
 
 def grafana_list_projects(
     db_session: Session,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     query_parameters: Dict[str, str],
 ) -> List[str]:
     """
     List available project names. Will be used as a filter in each grafana dashboard.
 
     :param db_session:        A session that manages the current dialog with the database.
     :param auth_info:         The auth info of the request.
     :param query_parameters:  Dictionary of query parameters attached to the request. Note that this parameter is
                               required by the API even though it is not being used in this function.
 
     :return: List of available project names.
     """
 
     projects_output = get_project_member().list_projects(
-        db_session, format_=ProjectsFormat.name_only, leader_session=auth_info.session
+        db_session,
+        format_=mlrun.common.schemas.ProjectsFormat.name_only,
+        leader_session=auth_info.session,
     )
     return projects_output.projects
 
 
 # TODO: remove in 1.5.0 the following functions: grafana_list_endpoints, grafana_individual_feature_analysis,
 #  grafana_overall_feature_analysis, grafana_income_features, parse_query_parameters, drop_grafana_escape_chars,
 
 
 async def grafana_list_endpoints(
     body: Dict[str, Any],
     query_parameters: Dict[str, str],
-    auth_info: mlrun.api.schemas.AuthInfo,
-) -> List[GrafanaTable]:
+    auth_info: mlrun.common.schemas.AuthInfo,
+) -> List[mlrun.common.schemas.GrafanaTable]:
     project = query_parameters.get("project")
 
     # Filters
     model = query_parameters.get("model", None)
     function = query_parameters.get("function", None)
     labels = query_parameters.get("labels", "")
     labels = labels.split(",") if labels else []
@@ -85,54 +79,56 @@
     # Time range for metrics
     start = body.get("rangeRaw", {}).get("start", "now-1h")
     end = body.get("rangeRaw", {}).get("end", "now")
 
     if project:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             project,
-            mlrun.api.schemas.AuthorizationAction.read,
+            mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     endpoint_list = await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().list_model_endpoints,
         auth_info=auth_info,
         project=project,
         model=model,
         function=function,
         labels=labels,
         metrics=metrics,
         start=start,
         end=end,
     )
     allowed_endpoints = await mlrun.api.utils.auth.verifier.AuthVerifier().filter_project_resources_by_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         endpoint_list.endpoints,
         lambda _endpoint: (
             _endpoint.metadata.project,
             _endpoint.metadata.uid,
         ),
         auth_info,
     )
     endpoint_list.endpoints = allowed_endpoints
 
     columns = [
-        GrafanaColumn(text="endpoint_id", type="string"),
-        GrafanaColumn(text="endpoint_function", type="string"),
-        GrafanaColumn(text="endpoint_model", type="string"),
-        GrafanaColumn(text="endpoint_model_class", type="string"),
-        GrafanaColumn(text="first_request", type="time"),
-        GrafanaColumn(text="last_request", type="time"),
-        GrafanaColumn(text="accuracy", type="number"),
-        GrafanaColumn(text="error_count", type="number"),
-        GrafanaColumn(text="drift_status", type="number"),
-        GrafanaColumn(text="predictions_per_second", type="number"),
-        GrafanaColumn(text="latency_avg_1h", type="number"),
+        mlrun.common.schemas.GrafanaColumn(text="endpoint_id", type="string"),
+        mlrun.common.schemas.GrafanaColumn(text="endpoint_function", type="string"),
+        mlrun.common.schemas.GrafanaColumn(text="endpoint_model", type="string"),
+        mlrun.common.schemas.GrafanaColumn(text="endpoint_model_class", type="string"),
+        mlrun.common.schemas.GrafanaColumn(text="first_request", type="time"),
+        mlrun.common.schemas.GrafanaColumn(text="last_request", type="time"),
+        mlrun.common.schemas.GrafanaColumn(text="accuracy", type="number"),
+        mlrun.common.schemas.GrafanaColumn(text="error_count", type="number"),
+        mlrun.common.schemas.GrafanaColumn(text="drift_status", type="number"),
+        mlrun.common.schemas.GrafanaColumn(
+            text="predictions_per_second", type="number"
+        ),
+        mlrun.common.schemas.GrafanaColumn(text="latency_avg_1h", type="number"),
     ]
 
-    table = GrafanaTable(columns=columns)
+    table = mlrun.common.schemas.GrafanaTable(columns=columns)
     for endpoint in endpoint_list.endpoints:
         row = [
             endpoint.metadata.uid,
             endpoint.spec.function_uri,
             endpoint.spec.model,
             endpoint.spec.model_class,
             endpoint.status.first_request,
@@ -140,45 +136,47 @@
             "N/A",  # Leaving here for backwards compatibility
             endpoint.status.error_count,
             endpoint.status.drift_status,
         ]
 
         if (
             endpoint.status.metrics
-            and mlrun.model_monitoring.EventKeyMetrics.GENERIC
+            and mlrun.common.model_monitoring.EventKeyMetrics.GENERIC
             in endpoint.status.metrics
         ):
             row.extend(
                 [
                     endpoint.status.metrics[
-                        mlrun.model_monitoring.EventKeyMetrics.GENERIC
-                    ][mlrun.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND],
+                        mlrun.common.model_monitoring.EventKeyMetrics.GENERIC
+                    ][
+                        mlrun.common.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND
+                    ],
                     endpoint.status.metrics[
-                        mlrun.model_monitoring.EventKeyMetrics.GENERIC
-                    ][mlrun.model_monitoring.EventLiveStats.LATENCY_AVG_1H],
+                        mlrun.common.model_monitoring.EventKeyMetrics.GENERIC
+                    ][mlrun.common.model_monitoring.EventLiveStats.LATENCY_AVG_1H],
                 ]
             )
 
         table.add_row(*row)
 
     return [table]
 
 
 async def grafana_individual_feature_analysis(
     body: Dict[str, Any],
     query_parameters: Dict[str, str],
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
 ):
     endpoint_id = query_parameters.get("endpoint_id")
     project = query_parameters.get("project")
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project,
         endpoint_id,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     endpoint = await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().get_model_endpoint,
         auth_info=auth_info,
         project=project,
@@ -187,26 +185,26 @@
     )
 
     # Load JSON data from KV, make sure not to fail if a field is missing
     feature_stats = endpoint.status.feature_stats or {}
     current_stats = endpoint.status.current_stats or {}
     drift_measures = endpoint.status.drift_measures or {}
 
-    table = GrafanaTable(
+    table = mlrun.common.schemas.GrafanaTable(
         columns=[
-            GrafanaColumn(text="feature_name", type="string"),
-            GrafanaColumn(text="actual_min", type="number"),
-            GrafanaColumn(text="actual_mean", type="number"),
-            GrafanaColumn(text="actual_max", type="number"),
-            GrafanaColumn(text="expected_min", type="number"),
-            GrafanaColumn(text="expected_mean", type="number"),
-            GrafanaColumn(text="expected_max", type="number"),
-            GrafanaColumn(text="tvd", type="number"),
-            GrafanaColumn(text="hellinger", type="number"),
-            GrafanaColumn(text="kld", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="feature_name", type="string"),
+            mlrun.common.schemas.GrafanaColumn(text="actual_min", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="actual_mean", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="actual_max", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="expected_min", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="expected_mean", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="expected_max", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="tvd", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="hellinger", type="number"),
+            mlrun.common.schemas.GrafanaColumn(text="kld", type="number"),
         ]
     )
 
     for feature, base_stat in feature_stats.items():
         current_stat = current_stats.get(feature, {})
         drift_measure = drift_measures.get(feature, {})
 
@@ -225,41 +223,41 @@
 
     return [table]
 
 
 async def grafana_overall_feature_analysis(
     body: Dict[str, Any],
     query_parameters: Dict[str, str],
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
 ):
     endpoint_id = query_parameters.get("endpoint_id")
     project = query_parameters.get("project")
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project,
         endpoint_id,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     endpoint = await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().get_model_endpoint,
         auth_info=auth_info,
         project=project,
         endpoint_id=endpoint_id,
         feature_analysis=True,
     )
 
-    table = GrafanaTable(
+    table = mlrun.common.schemas.GrafanaTable(
         columns=[
-            GrafanaNumberColumn(text="tvd_sum"),
-            GrafanaNumberColumn(text="tvd_mean"),
-            GrafanaNumberColumn(text="hellinger_sum"),
-            GrafanaNumberColumn(text="hellinger_mean"),
-            GrafanaNumberColumn(text="kld_sum"),
-            GrafanaNumberColumn(text="kld_mean"),
+            mlrun.common.schemas.GrafanaNumberColumn(text="tvd_sum"),
+            mlrun.common.schemas.GrafanaNumberColumn(text="tvd_mean"),
+            mlrun.common.schemas.GrafanaNumberColumn(text="hellinger_sum"),
+            mlrun.common.schemas.GrafanaNumberColumn(text="hellinger_mean"),
+            mlrun.common.schemas.GrafanaNumberColumn(text="kld_sum"),
+            mlrun.common.schemas.GrafanaNumberColumn(text="kld_mean"),
         ]
     )
 
     if endpoint.status.drift_measures:
         table.add_row(
             endpoint.status.drift_measures.get("tvd_sum"),
             endpoint.status.drift_measures.get("tvd_mean"),
@@ -271,26 +269,26 @@
 
     return [table]
 
 
 async def grafana_incoming_features(
     body: Dict[str, Any],
     query_parameters: Dict[str, str],
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
 ):
     endpoint_id = query_parameters.get("endpoint_id")
     project = query_parameters.get("project")
     start = body.get("rangeRaw", {}).get("from", "now-1h")
     end = body.get("rangeRaw", {}).get("to", "now")
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.model_endpoint,
+        mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project,
         endpoint_id,
-        mlrun.api.schemas.AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     endpoint = await run_in_threadpool(
         mlrun.api.crud.ModelEndpoints().get_model_endpoint,
         auth_info=auth_info,
         project=project,
@@ -305,15 +303,15 @@
         logger.warn(
             "'feature_names' is either missing or not initialized in endpoint record",
             endpoint_id=endpoint.metadata.uid,
         )
         return time_series
 
     path = config.model_endpoint_monitoring.store_prefixes.default.format(
-        project=project, kind=mlrun.api.schemas.ModelMonitoringStoreKinds.EVENTS
+        project=project, kind=mlrun.common.schemas.ModelMonitoringStoreKinds.EVENTS
     )
     _, container, path = parse_model_endpoint_store_prefix(path)
 
     client = get_frames_client(
         token=auth_info.data_session,
         address=config.v3io_framesd,
         container=container,
@@ -329,17 +327,19 @@
         end=end,
     )
 
     data.drop(["endpoint_id"], axis=1, inplace=True, errors="ignore")
     data.index = data.index.astype(np.int64) // 10**6
 
     for feature, indexed_values in data.to_dict().items():
-        target = GrafanaTimeSeriesTarget(target=feature)
+        target = mlrun.common.schemas.GrafanaTimeSeriesTarget(target=feature)
         for index, value in indexed_values.items():
-            data_point = GrafanaDataPoint(value=float(value), timestamp=index)
+            data_point = mlrun.common.schemas.GrafanaDataPoint(
+                value=float(value), timestamp=index
+            )
             target.add_data_point(data_point)
         time_series.append(target)
 
     return time_series
 
 
 def parse_query_parameters(request_body: Dict[str, Any]) -> Dict[str, str]:
```

## mlrun/api/crud/model_monitoring/model_endpoints.py

```diff
@@ -17,42 +17,42 @@
 import typing
 import warnings
 
 import sqlalchemy.orm
 
 import mlrun.api.api.endpoints.functions
 import mlrun.api.api.utils
-import mlrun.api.schemas
-import mlrun.api.schemas.model_endpoints
+import mlrun.api.crud.runtimes.nuclio.function
 import mlrun.api.utils.singletons.k8s
 import mlrun.artifacts
+import mlrun.common.model_monitoring as model_monitoring_constants
+import mlrun.common.schemas
+import mlrun.common.schemas.model_endpoints
 import mlrun.config
 import mlrun.datastore.store_resources
 import mlrun.errors
 import mlrun.feature_store
-import mlrun.model_monitoring.constants as model_monitoring_constants
 import mlrun.model_monitoring.helpers
-import mlrun.runtimes.function
 import mlrun.utils.helpers
 import mlrun.utils.model_monitoring
 import mlrun.utils.v3io_clients
 from mlrun.model_monitoring.stores import get_model_endpoint_store
 from mlrun.utils import logger
 
 
 class ModelEndpoints:
     """Provide different methods for handling model endpoints such as listing, writing and deleting"""
 
     def create_or_patch(
         self,
         db_session: sqlalchemy.orm.Session,
         access_key: str,
-        model_endpoint: mlrun.api.schemas.ModelEndpoint,
-        auth_info: mlrun.api.schemas.AuthInfo = mlrun.api.schemas.AuthInfo(),
-    ) -> mlrun.api.schemas.ModelEndpoint:
+        model_endpoint: mlrun.common.schemas.ModelEndpoint,
+        auth_info: mlrun.common.schemas.AuthInfo = mlrun.common.schemas.AuthInfo(),
+    ) -> mlrun.common.schemas.ModelEndpoint:
         # TODO: deprecated in 1.3.0, remove in 1.5.0.
         warnings.warn(
             "This is deprecated in 1.3.0, and will be removed in 1.5.0."
             "Please use create_model_endpoint() for create or patch_model_endpoint() for update",
             FutureWarning,
         )
         """
@@ -70,16 +70,16 @@
         return self.create_model_endpoint(
             db_session=db_session, model_endpoint=model_endpoint
         )
 
     def create_model_endpoint(
         self,
         db_session: sqlalchemy.orm.Session,
-        model_endpoint: mlrun.api.schemas.ModelEndpoint,
-    ) -> mlrun.api.schemas.ModelEndpoint:
+        model_endpoint: mlrun.common.schemas.ModelEndpoint,
+    ) -> mlrun.common.schemas.ModelEndpoint:
         """
         Creates model endpoint record in DB. The DB target type is defined under
         `mlrun.config.model_endpoint_monitoring.store_type` (V3IO-NOSQL by default).
 
         :param db_session:             A session that manages the current dialog with the database.
         :param model_endpoint:         Model endpoint object to update.
 
@@ -122,15 +122,15 @@
             # Get algorithm from model object if not found in model endpoint object
             if not model_endpoint.spec.algorithm and model_obj.spec.algorithm:
                 model_endpoint.spec.algorithm = model_obj.spec.algorithm
 
             # Create monitoring feature set if monitoring found in model endpoint object
             if (
                 model_endpoint.spec.monitoring_mode
-                == mlrun.model_monitoring.ModelMonitoringMode.enabled.value
+                == mlrun.common.model_monitoring.ModelMonitoringMode.enabled.value
             ):
                 monitoring_feature_set = self.create_monitoring_feature_set(
                     model_endpoint, model_obj, db_session, run_db
                 )
                 # Link model endpoint object to feature set URI
                 model_endpoint.status.monitoring_feature_set_uri = (
                     monitoring_feature_set.uri
@@ -166,17 +166,17 @@
         )
         model_endpoint_store.write_model_endpoint(endpoint=model_endpoint.flat_dict())
 
         logger.info("Model endpoint created", endpoint_id=model_endpoint.metadata.uid)
 
         return model_endpoint
 
-    @staticmethod
     def create_monitoring_feature_set(
-        model_endpoint: mlrun.api.schemas.ModelEndpoint,
+        self,
+        model_endpoint: mlrun.common.schemas.ModelEndpoint,
         model_obj: mlrun.artifacts.ModelArtifact,
         db_session: sqlalchemy.orm.Session,
         run_db: mlrun.db.sqldb.SQLDB,
     ):
         """
         Create monitoring feature set with the relevant parquet target.
 
@@ -194,23 +194,23 @@
             model_endpoint.spec.function_uri
         )
 
         model_name = model_endpoint.spec.model.replace(":", "-")
 
         feature_set = mlrun.feature_store.FeatureSet(
             f"monitoring-{serving_function_name}-{model_name}",
-            entities=["endpoint_id"],
-            timestamp_key="timestamp",
+            entities=[model_monitoring_constants.EventFieldType.ENDPOINT_ID],
+            timestamp_key=model_monitoring_constants.EventFieldType.TIMESTAMP,
             description=f"Monitoring feature set for endpoint: {model_endpoint.spec.model}",
         )
         feature_set.metadata.project = model_endpoint.metadata.project
 
         feature_set.metadata.labels = {
-            "endpoint_id": model_endpoint.metadata.uid,
-            "model_class": model_endpoint.spec.model_class,
+            model_monitoring_constants.EventFieldType.ENDPOINT_ID: model_endpoint.metadata.uid,
+            model_monitoring_constants.EventFieldType.MODEL_CLASS: model_endpoint.spec.model_class,
         }
 
         # Add features to the feature set according to the model object
         if model_obj.spec.inputs:
             for feature in model_obj.spec.inputs:
                 feature_set.add_feature(
                     mlrun.feature_store.Feature(
@@ -235,18 +235,23 @@
         else:
             logger.warn(
                 "Could not find any features in the model object and in the Feature Vector"
             )
 
         # Define parquet target for this feature set
         parquet_path = (
-            f"v3io:///projects/{model_endpoint.metadata.project}"
-            f"/model-endpoints/parquet/key={model_endpoint.metadata.uid}"
+            self._get_monitoring_parquet_path(
+                db_session=db_session, project=model_endpoint.metadata.project
+            )
+            + f"/key={model_endpoint.metadata.uid}"
+        )
+
+        parquet_target = mlrun.datastore.targets.ParquetTarget(
+            model_monitoring_constants.FileTargetKind.PARQUET, parquet_path
         )
-        parquet_target = mlrun.datastore.targets.ParquetTarget("parquet", parquet_path)
         driver = mlrun.datastore.targets.get_target_driver(parquet_target, feature_set)
 
         feature_set.set_targets(
             [mlrun.datastore.targets.ParquetTarget(path=parquet_path)],
             with_defaults=False,
         )
         driver.update_resource_status("created")
@@ -259,14 +264,43 @@
             model_endpoint=model_endpoint.spec.model,
             parquet_target=parquet_path,
         )
 
         return feature_set
 
     @staticmethod
+    def _get_monitoring_parquet_path(
+        db_session: sqlalchemy.orm.Session, project: str
+    ) -> str:
+        """Getting model monitoring parquet target for the current project. The parquet target path is based on the
+        project artifact path. If project artifact path is not defined, the parquet target path will be based on MLRun
+        artifact path.
+
+        :param db_session: A session that manages the current dialog with the database. Will be used in this function
+                           to get the project record from DB.
+        :param project:    Project name.
+
+        :return:           Monitoring parquet target path.
+        """
+
+        # Get the artifact path from the project record that was stored in the DB
+        project_obj = mlrun.api.crud.projects.Projects().get_project(
+            session=db_session, name=project
+        )
+        artifact_path = project_obj.spec.artifact_path
+        # Generate monitoring parquet path value
+        parquet_path = mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=project,
+            kind=model_monitoring_constants.FileTargetKind.PARQUET,
+            target="offline",
+            artifact_path=artifact_path,
+        )
+        return parquet_path
+
+    @staticmethod
     def _validate_length_features_and_labels(model_endpoint):
         """
         Validate that the length of feature_stats is equal to the length of `feature_names` and `label_names`
 
         :param model_endpoint:    An object representing the model endpoint.
         """
 
@@ -317,24 +351,24 @@
         return clean_feature_stats, clean_feature_names
 
     def patch_model_endpoint(
         self,
         project: str,
         endpoint_id: str,
         attributes: dict,
-    ) -> mlrun.api.schemas.ModelEndpoint:
+    ) -> mlrun.common.schemas.ModelEndpoint:
         """
         Update a model endpoint record with a given attributes.
 
         :param project: The name of the project.
         :param endpoint_id: The unique id of the model endpoint.
         :param attributes: Dictionary of attributes that will be used for update the model endpoint. Note that the keys
                            of the attributes dictionary should exist in the DB table. More details about the model
                            endpoint available attributes can be found under
-                           :py:class:`~mlrun.api.schemas.ModelEndpoint`.
+                           :py:class:`~mlrun.common.schemas.ModelEndpoint`.
 
         :return: A patched `ModelEndpoint` object.
         """
 
         # Generate a model endpoint store object and apply the update process
         model_endpoint_store = get_model_endpoint_store(
             project=project,
@@ -362,28 +396,29 @@
 
         :param project:     The name of the project.
         :param endpoint_id: The id of the endpoint.
         """
         model_endpoint_store = get_model_endpoint_store(
             project=project,
         )
+
         model_endpoint_store.delete_model_endpoint(endpoint_id=endpoint_id)
 
         logger.info("Model endpoint table cleared", endpoint_id=endpoint_id)
 
     def get_model_endpoint(
         self,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         project: str,
         endpoint_id: str,
         metrics: typing.List[str] = None,
         start: str = "now-1h",
         end: str = "now",
         feature_analysis: bool = False,
-    ) -> mlrun.api.schemas.ModelEndpoint:
+    ) -> mlrun.common.schemas.ModelEndpoint:
         """Get a single model endpoint object. You can apply different time series metrics that will be added to the
            result.
 
         :param auth_info:                  The auth info of the request
         :param project:                    The name of the project
         :param endpoint_id:                The unique id of the model endpoint.
         :param metrics:                    A list of metrics to return for the model endpoint. There are pre-defined
@@ -434,25 +469,25 @@
                 end=end,
             )
 
         return model_endpoint_object
 
     def list_model_endpoints(
         self,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         project: str,
         model: str = None,
         function: str = None,
         labels: typing.List[str] = None,
         metrics: typing.List[str] = None,
         start: str = "now-1h",
         end: str = "now",
         top_level: bool = False,
         uids: typing.List[str] = None,
-    ) -> mlrun.api.schemas.ModelEndpointList:
+    ) -> mlrun.common.schemas.ModelEndpointList:
         """
         Returns a list of `ModelEndpoint` objects, wrapped in `ModelEndpointList` object. Each `ModelEndpoint`
         object represents the current state of a model endpoint. This functions supports filtering by the following
         parameters:
         1) model
         2) function
         3) labels
@@ -497,15 +532,15 @@
             start=start,
             end=end,
             top_level=top_level,
             uids=uids,
         )
 
         # Initialize an empty model endpoints list
-        endpoint_list = mlrun.api.schemas.model_endpoints.ModelEndpointList(
+        endpoint_list = mlrun.common.schemas.model_endpoints.ModelEndpointList(
             endpoints=[]
         )
 
         # Generate a model endpoint store object and get a list of model endpoint dictionaries
         endpoint_store = get_model_endpoint_store(
             access_key=auth_info.data_session, project=project
         )
@@ -539,19 +574,19 @@
             endpoint_list.endpoints.append(endpoint_obj)
 
         return endpoint_list
 
     @staticmethod
     def _add_real_time_metrics(
         model_endpoint_store: mlrun.model_monitoring.stores.ModelEndpointStore,
-        model_endpoint_object: mlrun.api.schemas.ModelEndpoint,
+        model_endpoint_object: mlrun.common.schemas.ModelEndpoint,
         metrics: typing.List[str] = None,
         start: str = "now-1h",
         end: str = "now",
-    ) -> mlrun.api.schemas.ModelEndpoint:
+    ) -> mlrun.common.schemas.ModelEndpoint:
         """Add real time metrics from the time series DB to a provided `ModelEndpoint` object. The real time metrics
            will be stored under `ModelEndpoint.status.metrics.real_time`
 
         :param model_endpoint_store:  `ModelEndpointStore` object that will be used for communicating with the database
                                        and querying the required metrics.
         :param model_endpoint_object: `ModelEndpoint` object that will be filled with the relevant
                                        real time metrics.
@@ -583,28 +618,28 @@
             model_endpoint_object.status.metrics[
                 model_monitoring_constants.EventKeyMetrics.REAL_TIME
             ] = endpoint_metrics
         return model_endpoint_object
 
     def _convert_into_model_endpoint_object(
         self, endpoint: typing.Dict[str, typing.Any], feature_analysis: bool = False
-    ) -> mlrun.api.schemas.ModelEndpoint:
+    ) -> mlrun.common.schemas.ModelEndpoint:
         """
         Create a `ModelEndpoint` object according to a provided model endpoint dictionary.
 
         :param endpoint:         Dictinoary that represents a DB record of a model endpoint which need to be converted
                                  into a valid `ModelEndpoint` object.
         :param feature_analysis: When True, the base feature statistics and current feature statistics will be added to
                                  the output of the resulting object.
 
         :return: A `ModelEndpoint` object.
         """
 
         # Convert into `ModelEndpoint` object
-        endpoint_obj = mlrun.api.schemas.ModelEndpoint().from_flat_dict(endpoint)
+        endpoint_obj = mlrun.common.schemas.ModelEndpoint().from_flat_dict(endpoint)
 
         # If feature analysis was applied, add feature stats and current stats to the model endpoint result
         if feature_analysis and endpoint_obj.spec.feature_names:
 
             endpoint_features = self.get_endpoint_features(
                 feature_names=endpoint_obj.spec.feature_names,
                 feature_stats=endpoint_obj.status.feature_stats,
@@ -623,43 +658,43 @@
         return endpoint_obj
 
     @staticmethod
     def get_endpoint_features(
         feature_names: typing.List[str],
         feature_stats: dict = None,
         current_stats: dict = None,
-    ) -> typing.List[mlrun.api.schemas.Features]:
+    ) -> typing.List[mlrun.common.schemas.Features]:
         """
         Getting a new list of features that exist in feature_names along with their expected (feature_stats) and
         actual (current_stats) stats. The expected stats were calculated during the creation of the model endpoint,
         usually based on the data from the Model Artifact. The actual stats are based on the results from the latest
         model monitoring batch job.
 
         param feature_names: List of feature names.
         param feature_stats: Dictionary of feature stats that were stored during the creation of the model endpoint
                              object.
         param current_stats: Dictionary of the latest stats that were stored during the last run of the model monitoring
                              batch job.
 
         return: List of feature objects. Each feature has a name, weight, expected values, and actual values. More info
-                can be found under `mlrun.api.schemas.Features`.
+                can be found under `mlrun.common.schemas.Features`.
         """
 
         # Initialize feature and current stats dictionaries
         safe_feature_stats = feature_stats or {}
         safe_current_stats = current_stats or {}
 
         # Create feature object and add it to a general features list
         features = []
         for name in feature_names:
             if feature_stats is not None and name not in feature_stats:
                 logger.warn("Feature missing from 'feature_stats'", name=name)
             if current_stats is not None and name not in current_stats:
                 logger.warn("Feature missing from 'current_stats'", name=name)
-            f = mlrun.api.schemas.Features.new(
+            f = mlrun.common.schemas.Features.new(
                 name, safe_feature_stats.get(name), safe_current_stats.get(name)
             )
             features.append(f)
         return features
 
     @staticmethod
     def _json_loads_if_not_none(field: typing.Any) -> typing.Any:
@@ -670,15 +705,15 @@
         )
 
     def deploy_monitoring_functions(
         self,
         project: str,
         model_monitoring_access_key: str,
         db_session: sqlalchemy.orm.Session,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
     ):
         """
         Invoking monitoring deploying functions.
 
         :param project:                     The name of the project.
         :param model_monitoring_access_key: Access key to apply the model monitoring process.
@@ -698,15 +733,15 @@
             model_monitoring_access_key=model_monitoring_access_key,
             db_session=db_session,
             auth_info=auth_info,
             tracking_policy=tracking_policy,
         )
 
     def verify_project_has_no_model_endpoints(self, project_name: str):
-        auth_info = mlrun.api.schemas.AuthInfo(
+        auth_info = mlrun.common.schemas.AuthInfo(
             data_session=os.getenv("V3IO_ACCESS_KEY")
         )
 
         if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
             return
 
         endpoints = self.list_model_endpoints(auth_info, project_name)
@@ -718,15 +753,15 @@
     @staticmethod
     def delete_model_endpoints_resources(project_name: str):
         """
         Delete all model endpoints resources.
 
         :param project_name: The name of the project.
         """
-        auth_info = mlrun.api.schemas.AuthInfo(
+        auth_info = mlrun.common.schemas.AuthInfo(
             data_session=os.getenv("V3IO_ACCESS_KEY")
         )
 
         # We would ideally base on config.v3io_api but can't for backwards compatibility reasons,
         # we're using the igz version heuristic
         if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
             return
@@ -736,20 +771,20 @@
             access_key=auth_info.data_session, project=project_name
         )
         endpoints = endpoint_store.list_model_endpoints()
 
         # Delete model endpoints resources from databases using the model endpoint store object
         endpoint_store.delete_model_endpoints_resources(endpoints)
 
-    @staticmethod
     def deploy_model_monitoring_stream_processing(
+        self,
         project: str,
         model_monitoring_access_key: str,
         db_session: sqlalchemy.orm.Session,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
     ):
         """
         Deploying model monitoring stream real time nuclio function. The goal of this real time function is
         to monitor the log of the data stream. It is triggered when a new log entry is detected.
         It processes the new events into statistics that are then written to statistics databases.
 
@@ -762,15 +797,15 @@
 
         logger.info(
             "Checking if model monitoring stream is already deployed",
             project=project,
         )
         try:
             # validate that the model monitoring stream has not yet been deployed
-            mlrun.runtimes.function.get_nuclio_deploy_status(
+            mlrun.api.crud.runtimes.nuclio.function.get_nuclio_deploy_status(
                 name="model-monitoring-stream",
                 project=project,
                 tag="",
                 auth_info=auth_info,
             )
             logger.info(
                 "Detected model monitoring stream processing function already deployed",
@@ -778,28 +813,37 @@
             )
             return
         except mlrun.errors.MLRunNotFoundError:
             logger.info(
                 "Deploying model monitoring stream processing function", project=project
             )
 
+        # Get parquet target value for model monitoring stream function
+        parquet_target = self._get_monitoring_parquet_path(
+            db_session=db_session, project=project
+        )
+
         fn = mlrun.model_monitoring.helpers.initial_model_monitoring_stream_processing_function(
-            project, model_monitoring_access_key, db_session, tracking_policy
+            project=project,
+            model_monitoring_access_key=model_monitoring_access_key,
+            tracking_policy=tracking_policy,
+            auth_info=auth_info,
+            parquet_target=parquet_target,
         )
 
         mlrun.api.api.endpoints.functions._build_function(
             db_session=db_session, auth_info=auth_info, function=fn
         )
 
     def deploy_model_monitoring_batch_processing(
         self,
         project: str,
         model_monitoring_access_key: str,
         db_session: sqlalchemy.orm.Session,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
     ):
         """
         Deploying model monitoring batch job. The goal of this job is to identify drift in the data
         based on the latest batch of events. By default, this job is executed on the hour every hour.
         Note that if the monitoring batch job was already deployed then you will have to delete the
         old monitoring batch job before deploying a new one.
@@ -875,15 +919,15 @@
         )
 
     @staticmethod
     def _clean_feature_name(feature_name):
         return feature_name.replace(" ", "_").replace("(", "").replace(")", "")
 
     @staticmethod
-    def get_access_key(auth_info: mlrun.api.schemas.AuthInfo):
+    def get_access_key(auth_info: mlrun.common.schemas.AuthInfo):
         """
         Getting access key from the current data session. This method is usually used to verify that the session
         is valid and contains an access key.
 
         param auth_info: The auth info of the request.
 
         :return: Access key as a string.
@@ -914,13 +958,13 @@
                 else float(f"0{interval.partition('/')[-1]}")
                 for interval in intervals_list
             ]
         )
 
     @staticmethod
     def _convert_to_cron_string(
-        cron_trigger: mlrun.api.schemas.schedule.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.schedule.ScheduleCronTrigger,
     ):
         """Converting the batch interval `ScheduleCronTrigger` into a cron trigger expression"""
         return "{} {} {} * *".format(
             cron_trigger.minute, cron_trigger.hour, cron_trigger.day
         ).replace("None", "*")
```

## mlrun/api/db/base.py

```diff
@@ -13,16 +13,16 @@
 # limitations under the License.
 import datetime
 import typing
 import warnings
 from abc import ABC, abstractmethod
 from typing import Any, Dict, List, Optional, Tuple, Union
 
+import mlrun.common.schemas
 import mlrun.model
-from mlrun.api import schemas
 
 
 class DBError(Exception):
     pass
 
 
 class DBInterface(ABC):
@@ -94,18 +94,18 @@
         sort=True,
         last=0,
         iter=False,
         start_time_from=None,
         start_time_to=None,
         last_update_time_from=None,
         last_update_time_to=None,
-        partition_by: schemas.RunPartitionByField = None,
+        partition_by: mlrun.common.schemas.RunPartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: schemas.SortField = None,
-        partition_order: schemas.OrderType = schemas.OrderType.desc,
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
         requested_logs: bool = None,
         return_as_run_structs: bool = True,
         with_notifications: bool = False,
     ):
         pass
 
@@ -118,33 +118,33 @@
         pass
 
     def overwrite_artifacts_with_tag(
         self,
         session,
         project: str,
         tag: str,
-        identifiers: List[schemas.ArtifactIdentifier],
+        identifiers: List[mlrun.common.schemas.ArtifactIdentifier],
     ):
         pass
 
     def append_tag_to_artifacts(
         self,
         session,
         project: str,
         tag: str,
-        identifiers: List[schemas.ArtifactIdentifier],
+        identifiers: List[mlrun.common.schemas.ArtifactIdentifier],
     ):
         pass
 
     def delete_tag_from_artifacts(
         self,
         session,
         project: str,
         tag: str,
-        identifiers: List[schemas.ArtifactIdentifier],
+        identifiers: List[mlrun.common.schemas.ArtifactIdentifier],
     ):
         pass
 
     @abstractmethod
     def store_artifact(
         self,
         session,
@@ -168,15 +168,15 @@
         name="",
         project="",
         tag="",
         labels=None,
         since=None,
         until=None,
         kind=None,
-        category: schemas.ArtifactCategories = None,
+        category: mlrun.common.schemas.ArtifactCategories = None,
         iter: int = None,
         best_iteration: bool = False,
         as_records: bool = False,
         use_tag_as_uid: bool = None,
     ):
         pass
 
@@ -231,65 +231,67 @@
 
     @abstractmethod
     def create_schedule(
         self,
         session,
         project: str,
         name: str,
-        kind: schemas.ScheduleKinds,
+        kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Any,
-        cron_trigger: schemas.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger,
         concurrency_limit: int,
         labels: Dict = None,
         next_run_time: datetime.datetime = None,
     ):
         pass
 
     @abstractmethod
     def update_schedule(
         self,
         session,
         project: str,
         name: str,
         scheduled_object: Any = None,
-        cron_trigger: schemas.ScheduleCronTrigger = None,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger = None,
         labels: Dict = None,
         last_run_uri: str = None,
         concurrency_limit: int = None,
         next_run_time: datetime.datetime = None,
     ):
         pass
 
     @abstractmethod
     def list_schedules(
         self,
         session,
         project: str = None,
         name: str = None,
         labels: str = None,
-        kind: schemas.ScheduleKinds = None,
-    ) -> List[schemas.ScheduleRecord]:
+        kind: mlrun.common.schemas.ScheduleKinds = None,
+    ) -> List[mlrun.common.schemas.ScheduleRecord]:
         pass
 
     @abstractmethod
-    def get_schedule(self, session, project: str, name: str) -> schemas.ScheduleRecord:
+    def get_schedule(
+        self, session, project: str, name: str
+    ) -> mlrun.common.schemas.ScheduleRecord:
         pass
 
     @abstractmethod
     def delete_schedule(self, session, project: str, name: str):
         pass
 
     @abstractmethod
     def delete_schedules(self, session, project: str):
         pass
 
     @abstractmethod
     def generate_projects_summaries(
         self, session, projects: List[str]
-    ) -> List[schemas.ProjectSummary]:
+    ) -> List[mlrun.common.schemas.ProjectSummary]:
         pass
 
     @abstractmethod
     def delete_project_related_resources(self, session, name: str):
         pass
 
     @abstractmethod
@@ -301,25 +303,25 @@
         pass
 
     @abstractmethod
     def list_projects(
         self,
         session,
         owner: str = None,
-        format_: schemas.ProjectsFormat = schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: List[str] = None,
-        state: schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: Optional[List[str]] = None,
-    ) -> schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         pass
 
     @abstractmethod
     def get_project(
         self, session, name: str = None, project_id: int = None
-    ) -> schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abstractmethod
     async def get_project_resources_counters(
         self,
     ) -> Tuple[
         Dict[str, int],
@@ -328,109 +330,109 @@
         Dict[str, int],
         Dict[str, int],
         Dict[str, int],
     ]:
         pass
 
     @abstractmethod
-    def create_project(self, session, project: schemas.Project):
+    def create_project(self, session, project: mlrun.common.schemas.Project):
         pass
 
     @abstractmethod
-    def store_project(self, session, name: str, project: schemas.Project):
+    def store_project(self, session, name: str, project: mlrun.common.schemas.Project):
         pass
 
     @abstractmethod
     def patch_project(
         self,
         session,
         name: str,
         project: dict,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ):
         pass
 
     @abstractmethod
     def delete_project(
         self,
         session,
         name: str,
-        deletion_strategy: schemas.DeletionStrategy = schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         pass
 
     @abstractmethod
     def create_feature_set(
         self,
         session,
         project,
-        feature_set: schemas.FeatureSet,
+        feature_set: mlrun.common.schemas.FeatureSet,
         versioned=True,
     ) -> str:
         pass
 
     @abstractmethod
     def store_feature_set(
         self,
         session,
         project,
         name,
-        feature_set: schemas.FeatureSet,
+        feature_set: mlrun.common.schemas.FeatureSet,
         tag=None,
         uid=None,
         versioned=True,
         always_overwrite=False,
     ) -> str:
         pass
 
     @abstractmethod
     def get_feature_set(
         self, session, project: str, name: str, tag: str = None, uid: str = None
-    ) -> schemas.FeatureSet:
+    ) -> mlrun.common.schemas.FeatureSet:
         pass
 
     @abstractmethod
     def list_features(
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         entities: List[str] = None,
         labels: List[str] = None,
-    ) -> schemas.FeaturesOutput:
+    ) -> mlrun.common.schemas.FeaturesOutput:
         pass
 
     @abstractmethod
     def list_entities(
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         labels: List[str] = None,
-    ) -> schemas.EntitiesOutput:
+    ) -> mlrun.common.schemas.EntitiesOutput:
         pass
 
     @abstractmethod
     def list_feature_sets(
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         state: str = None,
         entities: List[str] = None,
         features: List[str] = None,
         labels: List[str] = None,
-        partition_by: schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: schemas.SortField = None,
-        partition_order: schemas.OrderType = schemas.OrderType.desc,
-    ) -> schemas.FeatureSetsOutput:
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
+    ) -> mlrun.common.schemas.FeatureSetsOutput:
         pass
 
     @abstractmethod
     def list_feature_sets_tags(
         self,
         session,
         project: str,
@@ -445,52 +447,52 @@
         self,
         session,
         project,
         name,
         feature_set_patch: dict,
         tag=None,
         uid=None,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         pass
 
     @abstractmethod
     def delete_feature_set(self, session, project, name, tag=None, uid=None):
         pass
 
     @abstractmethod
     def create_feature_vector(
         self,
         session,
         project,
-        feature_vector: schemas.FeatureVector,
+        feature_vector: mlrun.common.schemas.FeatureVector,
         versioned=True,
     ) -> str:
         pass
 
     @abstractmethod
     def get_feature_vector(
         self, session, project: str, name: str, tag: str = None, uid: str = None
-    ) -> schemas.FeatureVector:
+    ) -> mlrun.common.schemas.FeatureVector:
         pass
 
     @abstractmethod
     def list_feature_vectors(
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         state: str = None,
         labels: List[str] = None,
-        partition_by: schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: schemas.SortField = None,
-        partition_order: schemas.OrderType = schemas.OrderType.desc,
-    ) -> schemas.FeatureVectorsOutput:
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
+    ) -> mlrun.common.schemas.FeatureVectorsOutput:
         pass
 
     @abstractmethod
     def list_feature_vectors_tags(
         self,
         session,
         project: str,
@@ -502,15 +504,15 @@
 
     @abstractmethod
     def store_feature_vector(
         self,
         session,
         project,
         name,
-        feature_vector: schemas.FeatureVector,
+        feature_vector: mlrun.common.schemas.FeatureVector,
         tag=None,
         uid=None,
         versioned=True,
         always_overwrite=False,
     ) -> str:
         pass
 
@@ -519,15 +521,15 @@
         self,
         session,
         project,
         name,
         feature_vector_update: dict,
         tag=None,
         uid=None,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         pass
 
     @abstractmethod
     def delete_feature_vector(
         self,
         session,
@@ -535,52 +537,56 @@
         name,
         tag=None,
         uid=None,
     ):
         pass
 
     def list_artifact_tags(
-        self, session, project, category: Union[str, schemas.ArtifactCategories] = None
+        self,
+        session,
+        project,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         return []
 
-    def create_marketplace_source(
-        self, session, ordered_source: schemas.IndexedMarketplaceSource
+    def create_hub_source(
+        self, session, ordered_source: mlrun.common.schemas.IndexedHubSource
     ):
         pass
 
-    def store_marketplace_source(
-        self, session, name, ordered_source: schemas.IndexedMarketplaceSource
+    def store_hub_source(
+        self,
+        session,
+        name,
+        ordered_source: mlrun.common.schemas.IndexedHubSource,
     ):
         pass
 
-    def list_marketplace_sources(
-        self, session
-    ) -> List[schemas.IndexedMarketplaceSource]:
+    def list_hub_sources(self, session) -> List[mlrun.common.schemas.IndexedHubSource]:
         pass
 
-    def delete_marketplace_source(self, session, name):
+    def delete_hub_source(self, session, name):
         pass
 
-    def get_marketplace_source(self, session, name) -> schemas.IndexedMarketplaceSource:
+    def get_hub_source(self, session, name) -> mlrun.common.schemas.IndexedHubSource:
         pass
 
     def store_background_task(
         self,
         session,
         name: str,
         project: str,
-        state: str = schemas.BackgroundTaskState.running,
+        state: str = mlrun.common.schemas.BackgroundTaskState.running,
         timeout: int = None,
     ):
         pass
 
     def get_background_task(
         self, session, name: str, project: str
-    ) -> schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         pass
 
     @abstractmethod
     def store_run_notifications(
         self,
         session,
         notification_objects: typing.List[mlrun.model.Notification],
```

## mlrun/api/db/sqldb/db.py

```diff
@@ -26,19 +26,20 @@
 import pytz
 from sqlalchemy import and_, distinct, func, or_
 from sqlalchemy.exc import SQLAlchemyError
 from sqlalchemy.orm import Session, aliased
 
 import mlrun
 import mlrun.api.db.session
+import mlrun.api.utils.helpers
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.model
-from mlrun.api import schemas
 from mlrun.api.db.base import DBInterface
 from mlrun.api.db.sqldb.helpers import (
     generate_query_predicate_for_name,
     label_set,
     run_labels,
     run_start_time,
     run_state,
@@ -49,16 +50,16 @@
     BackgroundTask,
     DataVersion,
     Entity,
     Feature,
     FeatureSet,
     FeatureVector,
     Function,
+    HubSource,
     Log,
-    MarketplaceSource,
     Notification,
     Project,
     Run,
     Schedule,
     User,
     _labeled,
     _tagged,
@@ -317,18 +318,18 @@
         sort=True,
         last=0,
         iter=False,
         start_time_from=None,
         start_time_to=None,
         last_update_time_from=None,
         last_update_time_to=None,
-        partition_by: schemas.RunPartitionByField = None,
+        partition_by: mlrun.common.schemas.RunPartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: schemas.SortField = None,
-        partition_order: schemas.OrderType = schemas.OrderType.desc,
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
         requested_logs: bool = None,
         return_as_run_structs: bool = True,
         with_notifications: bool = False,
     ):
         project = project or config.default_project
         query = self._find_runs(session, uid, project, labels)
@@ -354,15 +355,17 @@
             query = query.limit(last)
         if not iter:
             query = query.filter(Run.iteration == 0)
         if requested_logs is not None:
             query = query.filter(Run.requested_logs == requested_logs)
         if partition_by:
             self._assert_partition_by_parameters(
-                schemas.RunPartitionByField, partition_by, partition_sort_by
+                mlrun.common.schemas.RunPartitionByField,
+                partition_by,
+                partition_sort_by,
             )
             query = self._create_partitioned_query(
                 session,
                 query,
                 Run,
                 partition_by,
                 rows_per_partition,
@@ -452,15 +455,15 @@
 
     @retry_on_conflict
     def overwrite_artifacts_with_tag(
         self,
         session: Session,
         project: str,
         tag: str,
-        identifiers: typing.List[mlrun.api.schemas.ArtifactIdentifier],
+        identifiers: typing.List[mlrun.common.schemas.ArtifactIdentifier],
     ):
         # query all artifacts which match the identifiers
         artifacts = []
         for identifier in identifiers:
             artifacts += self._list_artifacts_for_tagging(
                 session,
                 project_name=project,
@@ -475,15 +478,15 @@
 
     @retry_on_conflict
     def append_tag_to_artifacts(
         self,
         session: Session,
         project: str,
         tag: str,
-        identifiers: typing.List[mlrun.api.schemas.ArtifactIdentifier],
+        identifiers: typing.List[mlrun.common.schemas.ArtifactIdentifier],
     ):
         # query all artifacts which match the identifiers
         artifacts = []
         for identifier in identifiers:
             artifacts += self._list_artifacts_for_tagging(
                 session,
                 project_name=project,
@@ -492,15 +495,15 @@
         self.tag_artifacts(session, artifacts, project, name=tag)
 
     def delete_tag_from_artifacts(
         self,
         session: Session,
         project: str,
         tag: str,
-        identifiers: typing.List[mlrun.api.schemas.ArtifactIdentifier],
+        identifiers: typing.List[mlrun.common.schemas.ArtifactIdentifier],
     ):
         # query all artifacts which match the identifiers
         artifacts = []
         for identifier in identifiers:
             artifacts += self._list_artifacts_for_tagging(
                 session,
                 project_name=project,
@@ -508,15 +511,15 @@
             )
         self._delete_artifacts_tags(session, project, artifacts, tags=[tag])
 
     def _list_artifacts_for_tagging(
         self,
         session: Session,
         project_name: str,
-        identifier: mlrun.api.schemas.ArtifactIdentifier,
+        identifier: mlrun.common.schemas.ArtifactIdentifier,
     ):
         return self.list_artifacts(
             session,
             project=project_name,
             name=identifier.key,
             kind=identifier.kind,
             iter=identifier.iter,
@@ -712,15 +715,15 @@
         name=None,
         project=None,
         tag=None,
         labels=None,
         since=None,
         until=None,
         kind=None,
-        category: schemas.ArtifactCategories = None,
+        category: mlrun.common.schemas.ArtifactCategories = None,
         iter: int = None,
         best_iteration: bool = False,
         as_records: bool = False,
         use_tag_as_uid: bool = None,
     ):
         project = project or config.default_project
 
@@ -1114,15 +1117,15 @@
             session.query(Function.Tag.name)
             .filter(Function.Tag.project == project, Function.Tag.obj_id == function_id)
             .distinct()
         )
         return [row[0] for row in query]
 
     def list_artifact_tags(
-        self, session, project, category: schemas.ArtifactCategories = None
+        self, session, project, category: mlrun.common.schemas.ArtifactCategories = None
     ) -> typing.List[typing.Tuple[str, str, str]]:
         """
         :return: a list of Tuple of (project, artifact.key, tag)
         """
         # TODO - refactor once we have the artifact kind as a field in the DB, the filtering on category can be done
         # as a simple SQL query, and don't need to use the extra processing of listing tags etc.
 
@@ -1145,17 +1148,17 @@
         return results
 
     def create_schedule(
         self,
         session: Session,
         project: str,
         name: str,
-        kind: schemas.ScheduleKinds,
+        kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Any,
-        cron_trigger: schemas.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger,
         concurrency_limit: int,
         labels: Dict = None,
         next_run_time: datetime = None,
     ):
         if next_run_time is not None:
             # We receive the next_run_time with localized timezone info (e.g +03:00). All the timestamps should be
             # saved in the DB in UTC timezone, therefore we transform next_run_time to UTC as well.
@@ -1190,15 +1193,15 @@
 
     def update_schedule(
         self,
         session: Session,
         project: str,
         name: str,
         scheduled_object: Any = None,
-        cron_trigger: schemas.ScheduleCronTrigger = None,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger = None,
         labels: Dict = None,
         last_run_uri: str = None,
         concurrency_limit: int = None,
         next_run_time: datetime = None,
     ):
         schedule = self._get_schedule_record(session, project, name)
 
@@ -1236,16 +1239,16 @@
 
     def list_schedules(
         self,
         session: Session,
         project: str = None,
         name: str = None,
         labels: str = None,
-        kind: schemas.ScheduleKinds = None,
-    ) -> List[schemas.ScheduleRecord]:
+        kind: mlrun.common.schemas.ScheduleKinds = None,
+    ) -> List[mlrun.common.schemas.ScheduleRecord]:
         logger.debug("Getting schedules from db", project=project, name=name, kind=kind)
         query = self._query(session, Schedule, project=project, kind=kind)
         if name is not None:
             query = query.filter(generate_query_predicate_for_name(Schedule.name, name))
         labels = label_set(labels)
         query = self._add_labels_filter(session, query, Schedule, labels)
 
@@ -1253,23 +1256,23 @@
             self._transform_schedule_record_to_scheme(db_schedule)
             for db_schedule in query
         ]
         return schedules
 
     def get_schedule(
         self, session: Session, project: str, name: str
-    ) -> schemas.ScheduleRecord:
+    ) -> mlrun.common.schemas.ScheduleRecord:
         logger.debug("Getting schedule from db", project=project, name=name)
         schedule_record = self._get_schedule_record(session, project, name)
         schedule = self._transform_schedule_record_to_scheme(schedule_record)
         return schedule
 
     def _get_schedule_record(
         self, session: Session, project: str, name: str
-    ) -> schemas.ScheduleRecord:
+    ) -> mlrun.common.schemas.ScheduleRecord:
         query = self._query(session, Schedule, project=project, name=name)
         schedule_record = query.one_or_none()
         if not schedule_record:
             raise mlrun.errors.MLRunNotFoundError(
                 f"Schedule not found: project={project}, name={name}"
             )
         return schedule_record
@@ -1354,15 +1357,15 @@
             tag = query.one_or_none()
             if not tag:
                 tag = obj.Tag(project=project, name=name, obj_name=obj.name)
             tag.obj_id = obj.id
             tags.append(tag)
         self._upsert(session, tags)
 
-    def create_project(self, session: Session, project: schemas.Project):
+    def create_project(self, session: Session, project: mlrun.common.schemas.Project):
         logger.debug("Creating project in DB", project=project)
         created = datetime.utcnow()
         project.metadata.created = created
         # TODO: handle taking out the functions/workflows/artifacts out of the project and save them separately
         project_record = Project(
             name=project.metadata.name,
             description=project.spec.description,
@@ -1373,89 +1376,101 @@
             full_object=project.dict(),
         )
         labels = project.metadata.labels or {}
         update_labels(project_record, labels)
         self._upsert(session, [project_record])
 
     @retry_on_conflict
-    def store_project(self, session: Session, name: str, project: schemas.Project):
+    def store_project(
+        self, session: Session, name: str, project: mlrun.common.schemas.Project
+    ):
         logger.debug("Storing project in DB", name=name, project=project)
         project_record = self._get_project_record(
             session, name, raise_on_not_found=False
         )
         if not project_record:
             self.create_project(session, project)
         else:
             self._update_project_record_from_project(session, project_record, project)
 
     def patch_project(
         self,
         session: Session,
         name: str,
         project: dict,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ):
         logger.debug(
             "Patching project in DB", name=name, project=project, patch_mode=patch_mode
         )
         project_record = self._get_project_record(session, name)
         self._patch_project_record_from_project(
             session, name, project_record, project, patch_mode
         )
 
     def get_project(
         self, session: Session, name: str = None, project_id: int = None
-    ) -> schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         project_record = self._get_project_record(session, name, project_id)
 
         return self._transform_project_record_to_schema(session, project_record)
 
     def delete_project(
         self,
         session: Session,
         name: str,
-        deletion_strategy: schemas.DeletionStrategy = schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         logger.debug(
             "Deleting project from DB", name=name, deletion_strategy=deletion_strategy
         )
         self._delete(session, Project, name=name)
 
     def list_projects(
         self,
         session: Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: typing.Union[
+            mlrun.common.schemas.ProjectsFormat, mlrun.common.schemas.ProjectsFormat
+        ] = mlrun.common.schemas.ProjectsFormat.full,
         labels: List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         query = self._query(session, Project, owner=owner, state=state)
         if labels:
             query = self._add_labels_filter(session, query, Project, labels)
         if names is not None:
             query = query.filter(Project.name.in_(names))
         project_records = query.all()
         projects = []
         for project_record in project_records:
-            if format_ == mlrun.api.schemas.ProjectsFormat.name_only:
+            if format_ == mlrun.common.schemas.ProjectsFormat.name_only:
                 projects = [project_record.name for project_record in project_records]
             # leader format is only for follower mode which will format the projects returned from here
+            elif format_ == mlrun.common.schemas.ProjectsFormat.minimal:
+                projects.append(
+                    mlrun.api.utils.helpers.minimize_project_schema(
+                        self._transform_project_record_to_schema(
+                            session, project_record
+                        )
+                    )
+                )
             elif format_ in [
-                mlrun.api.schemas.ProjectsFormat.full,
-                mlrun.api.schemas.ProjectsFormat.leader,
+                mlrun.common.schemas.ProjectsFormat.full,
+                mlrun.common.schemas.ProjectsFormat.leader,
             ]:
                 projects.append(
                     self._transform_project_record_to_schema(session, project_record)
                 )
             else:
                 raise NotImplementedError(
                     f"Provided format is not supported. format={format_}"
                 )
-        return schemas.ProjectsOutput(projects=projects)
+        return mlrun.common.schemas.ProjectsOutput(projects=projects)
 
     async def get_project_resources_counters(
         self,
     ) -> Tuple[
         Dict[str, int],
         Dict[str, int],
         Dict[str, int],
@@ -1556,15 +1571,18 @@
         import mlrun.artifacts
 
         # The category filter is applied post the query to the DB (manually in python code), so counting should be that
         # way as well, therefore we're doing it here, and can't do it with sql as the above
         # We're using the "latest" which gives us only one version of each artifact key, which is what we want to
         # count (artifact count, not artifact versions count)
         file_artifacts = self._find_artifacts(
-            session, None, "latest", category=mlrun.api.schemas.ArtifactCategories.other
+            session,
+            None,
+            "latest",
+            category=mlrun.common.schemas.ArtifactCategories.other,
         )
         project_to_files_count = collections.defaultdict(int)
         for file_artifact in file_artifacts:
             project_to_files_count[file_artifact.project] += 1
         return project_to_files_count
 
     def _calculate_runs_counters(
@@ -1600,27 +1618,27 @@
         project_to_recent_failed_runs_count = {
             result[0]: result[1] for result in recent_failed_runs_count_per_project
         }
         return project_to_recent_failed_runs_count, project_to_running_runs_count
 
     async def generate_projects_summaries(
         self, session: Session, projects: List[str]
-    ) -> List[mlrun.api.schemas.ProjectSummary]:
+    ) -> List[mlrun.common.schemas.ProjectSummary]:
         (
             project_to_function_count,
             project_to_schedule_count,
             project_to_feature_set_count,
             project_to_models_count,
             project_to_recent_failed_runs_count,
             project_to_running_runs_count,
         ) = await self._get_project_resources_counters(session)
         project_summaries = []
         for project in projects:
             project_summaries.append(
-                mlrun.api.schemas.ProjectSummary(
+                mlrun.common.schemas.ProjectSummary(
                     name=project,
                     functions_count=project_to_function_count.get(project, 0),
                     schedules_count=project_to_schedule_count.get(project, 0),
                     feature_sets_count=project_to_feature_set_count.get(project, 0),
                     models_count=project_to_models_count.get(project, 0),
                     runs_failed_recent_count=project_to_recent_failed_runs_count.get(
                         project, 0
@@ -1630,15 +1648,18 @@
                     # crud layer
                     pipelines_running_count=0,
                 )
             )
         return project_summaries
 
     def _update_project_record_from_project(
-        self, session: Session, project_record: Project, project: schemas.Project
+        self,
+        session: Session,
+        project_record: Project,
+        project: mlrun.common.schemas.Project,
     ):
         project.metadata.created = project_record.created
         project_dict = project.dict()
         # TODO: handle taking out the functions/workflows/artifacts out of the project and save them separately
         project_record.full_object = project_dict
         project_record.description = project.spec.description
         project_record.source = project.spec.source
@@ -1650,23 +1671,23 @@
 
     def _patch_project_record_from_project(
         self,
         session: Session,
         name: str,
         project_record: Project,
         project: dict,
-        patch_mode: schemas.PatchMode,
+        patch_mode: mlrun.common.schemas.PatchMode,
     ):
         project.setdefault("metadata", {})["created"] = project_record.created
         strategy = patch_mode.to_mergedeep_strategy()
         project_record_full_object = project_record.full_object
         mergedeep.merge(project_record_full_object, project, strategy=strategy)
 
         # If a bad kind value was passed, it will fail here (return 422 to caller)
-        project = schemas.Project(**project_record_full_object)
+        project = mlrun.common.schemas.Project(**project_record_full_object)
         self.store_project(
             session,
             name,
             project,
         )
 
         project_record.full_object = project_record_full_object
@@ -1809,15 +1830,15 @@
     def get_feature_set(
         self,
         session,
         project: str,
         name: str,
         tag: str = None,
         uid: str = None,
-    ) -> schemas.FeatureSet:
+    ) -> mlrun.common.schemas.FeatureSet:
         feature_set = self._get_feature_set(session, project, name, tag, uid)
         if not feature_set:
             feature_set_uri = generate_object_uri(project, name, tag)
             raise mlrun.errors.MLRunNotFoundError(
                 f"Feature-set not found {feature_set_uri}"
             )
 
@@ -1857,18 +1878,18 @@
                 results.append(new_object)
             else:
                 for object_tag in object_tags:
                     results.append(transform_fn(object_record, object_tag))
         return results
 
     @staticmethod
-    def _generate_feature_set_digest(feature_set: schemas.FeatureSet):
-        return schemas.FeatureSetDigestOutput(
+    def _generate_feature_set_digest(feature_set: mlrun.common.schemas.FeatureSet):
+        return mlrun.common.schemas.FeatureSetDigestOutput(
             metadata=feature_set.metadata,
-            spec=schemas.FeatureSetDigestSpec(
+            spec=mlrun.common.schemas.FeatureSetDigestSpec(
                 entities=feature_set.spec.entities,
                 features=feature_set.spec.features,
             ),
         )
 
     def _generate_feature_or_entity_list_query(
         self,
@@ -1902,30 +1923,30 @@
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         entities: List[str] = None,
         labels: List[str] = None,
-    ) -> schemas.FeaturesOutput:
+    ) -> mlrun.common.schemas.FeaturesOutput:
         # We don't filter by feature-set name here, as the name parameter refers to features
         feature_set_id_tags = self._get_records_to_tags_map(
             session, FeatureSet, project, tag, name=None
         )
 
         query = self._generate_feature_or_entity_list_query(
             session, Feature, project, feature_set_id_tags.keys(), name, tag, labels
         )
 
         if entities:
             query = query.join(FeatureSet.entities).filter(Entity.name.in_(entities))
 
         features_results = []
         for row in query:
-            feature_record = schemas.FeatureRecord.from_orm(row.Feature)
+            feature_record = mlrun.common.schemas.FeatureRecord.from_orm(row.Feature)
             feature_name = feature_record.name
 
             feature_sets = self._generate_records_with_tags_assigned(
                 row.FeatureSet,
                 self._transform_feature_set_model_to_schema,
                 feature_set_id_tags,
                 tag,
@@ -1944,42 +1965,42 @@
                 )
                 if not feature:
                     raise mlrun.errors.MLRunInternalServerError(
                         "Inconsistent data in DB - features in DB not in feature-set document"
                     )
 
                 features_results.append(
-                    schemas.FeatureListOutput(
+                    mlrun.common.schemas.FeatureListOutput(
                         feature=feature,
                         feature_set_digest=self._generate_feature_set_digest(
                             feature_set
                         ),
                     )
                 )
-        return schemas.FeaturesOutput(features=features_results)
+        return mlrun.common.schemas.FeaturesOutput(features=features_results)
 
     def list_entities(
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         labels: List[str] = None,
-    ) -> schemas.EntitiesOutput:
+    ) -> mlrun.common.schemas.EntitiesOutput:
         feature_set_id_tags = self._get_records_to_tags_map(
             session, FeatureSet, project, tag, name=None
         )
 
         query = self._generate_feature_or_entity_list_query(
             session, Entity, project, feature_set_id_tags.keys(), name, tag, labels
         )
 
         entities_results = []
         for row in query:
-            entity_record = schemas.FeatureRecord.from_orm(row.Entity)
+            entity_record = mlrun.common.schemas.FeatureRecord.from_orm(row.Entity)
             entity_name = entity_record.name
 
             feature_sets = self._generate_records_with_tags_assigned(
                 row.FeatureSet,
                 self._transform_feature_set_model_to_schema,
                 feature_set_id_tags,
                 tag,
@@ -1998,22 +2019,22 @@
                 )
                 if not entity:
                     raise mlrun.errors.MLRunInternalServerError(
                         "Inconsistent data in DB - entities in DB not in feature-set document"
                     )
 
                 entities_results.append(
-                    schemas.EntityListOutput(
+                    mlrun.common.schemas.EntityListOutput(
                         entity=entity,
                         feature_set_digest=self._generate_feature_set_digest(
                             feature_set
                         ),
                     )
                 )
-        return schemas.EntitiesOutput(entities=entities_results)
+        return mlrun.common.schemas.EntitiesOutput(entities=entities_results)
 
     @staticmethod
     def _assert_partition_by_parameters(partition_by_enum_cls, partition_by, sort):
         if sort is None:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "sort parameter must be provided when partition_by is used."
             )
@@ -2028,19 +2049,20 @@
 
     @staticmethod
     def _create_partitioned_query(
         session,
         query,
         cls,
         partition_by: typing.Union[
-            schemas.FeatureStorePartitionByField, schemas.RunPartitionByField
+            mlrun.common.schemas.FeatureStorePartitionByField,
+            mlrun.common.schemas.RunPartitionByField,
         ],
         rows_per_partition: int,
-        partition_sort_by: schemas.SortField,
-        partition_order: schemas.OrderType,
+        partition_sort_by: mlrun.common.schemas.SortField,
+        partition_order: mlrun.common.schemas.OrderType,
         max_partitions: int = 0,
     ):
 
         partition_field = partition_by.to_partition_by_db_field(cls)
         sort_by_field = partition_sort_by.to_db_field(cls)
 
         row_number_column = (
@@ -2098,19 +2120,19 @@
         project: str,
         name: str = None,
         tag: str = None,
         state: str = None,
         entities: List[str] = None,
         features: List[str] = None,
         labels: List[str] = None,
-        partition_by: schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: schemas.SortField = None,
-        partition_order: schemas.OrderType = schemas.OrderType.desc,
-    ) -> schemas.FeatureSetsOutput:
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
+    ) -> mlrun.common.schemas.FeatureSetsOutput:
         obj_id_tags = self._get_records_to_tags_map(
             session, FeatureSet, project, tag, name
         )
 
         # Query the actual objects to be returned
         query = self._query(session, FeatureSet, project=project, state=state)
 
@@ -2125,15 +2147,17 @@
         if features:
             query = query.join(FeatureSet.features).filter(Feature.name.in_(features))
         if labels:
             query = self._add_labels_filter(session, query, FeatureSet, labels)
 
         if partition_by:
             self._assert_partition_by_parameters(
-                schemas.FeatureStorePartitionByField, partition_by, partition_sort_by
+                mlrun.common.schemas.FeatureStorePartitionByField,
+                partition_by,
+                partition_sort_by,
             )
             query = self._create_partitioned_query(
                 session,
                 query,
                 FeatureSet,
                 partition_by,
                 rows_per_partition,
@@ -2147,15 +2171,15 @@
                 self._generate_records_with_tags_assigned(
                     feature_set_record,
                     self._transform_feature_set_model_to_schema,
                     obj_id_tags,
                     tag,
                 )
             )
-        return schemas.FeatureSetsOutput(feature_sets=feature_sets)
+        return mlrun.common.schemas.FeatureSetsOutput(feature_sets=feature_sets)
 
     def list_feature_sets_tags(
         self,
         session,
         project: str,
     ):
         query = (
@@ -2278,15 +2302,15 @@
 
     @retry_on_conflict
     def store_feature_set(
         self,
         session,
         project,
         name,
-        feature_set: schemas.FeatureSet,
+        feature_set: mlrun.common.schemas.FeatureSet,
         tag=None,
         uid=None,
         versioned=True,
         always_overwrite=False,
     ) -> str:
         original_uid = uid
 
@@ -2377,15 +2401,15 @@
 
         return uid, new_object.metadata.tag, object_dict
 
     def create_feature_set(
         self,
         session,
         project,
-        feature_set: schemas.FeatureSet,
+        feature_set: mlrun.common.schemas.FeatureSet,
         versioned=True,
     ) -> str:
         (uid, tag, feature_set_dict,) = self._validate_and_enrich_record_for_creation(
             session, feature_set, FeatureSet, project, versioned
         )
 
         db_feature_set = FeatureSet(project=project)
@@ -2402,15 +2426,15 @@
         self,
         session,
         project,
         name,
         feature_set_patch: dict,
         tag=None,
         uid=None,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         feature_set_record = self._get_feature_set(session, project, name, tag, uid)
         if not feature_set_record:
             feature_set_uri = generate_object_uri(project, name, tag)
             raise mlrun.errors.MLRunNotFoundError(
                 f"Feature-set not found {feature_set_uri}"
             )
@@ -2419,15 +2443,15 @@
         # using mergedeep for merging the patch content into the existing dictionary
         strategy = patch_mode.to_mergedeep_strategy()
         mergedeep.merge(feature_set_struct, feature_set_patch, strategy=strategy)
 
         versioned = feature_set_record.metadata.uid is not None
 
         # If a bad kind value was passed, it will fail here (return 422 to caller)
-        feature_set = schemas.FeatureSet(**feature_set_struct)
+        feature_set = mlrun.common.schemas.FeatureSet(**feature_set_struct)
         return self.store_feature_set(
             session,
             project,
             name,
             feature_set,
             feature_set.metadata.tag,
             uid,
@@ -2470,15 +2494,15 @@
     def delete_feature_set(self, session, project, name, tag=None, uid=None):
         self._delete_feature_store_object(session, FeatureSet, project, name, tag, uid)
 
     def create_feature_vector(
         self,
         session,
         project,
-        feature_vector: schemas.FeatureVector,
+        feature_vector: mlrun.common.schemas.FeatureVector,
         versioned=True,
     ) -> str:
         (
             uid,
             tag,
             feature_vector_dict,
         ) = self._validate_and_enrich_record_for_creation(
@@ -2521,15 +2545,15 @@
                 feature_vector.metadata.tag = computed_tag
             return feature_vector
         else:
             return None
 
     def get_feature_vector(
         self, session, project: str, name: str, tag: str = None, uid: str = None
-    ) -> schemas.FeatureVector:
+    ) -> mlrun.common.schemas.FeatureVector:
         feature_vector = self._get_feature_vector(session, project, name, tag, uid)
         if not feature_vector:
             feature_vector_uri = generate_object_uri(project, name, tag)
             raise mlrun.errors.MLRunNotFoundError(
                 f"Feature-vector not found {feature_vector_uri}"
             )
 
@@ -2539,19 +2563,19 @@
         self,
         session,
         project: str,
         name: str = None,
         tag: str = None,
         state: str = None,
         labels: List[str] = None,
-        partition_by: schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: schemas.SortField = None,
-        partition_order: schemas.OrderType = schemas.OrderType.desc,
-    ) -> schemas.FeatureVectorsOutput:
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
+    ) -> mlrun.common.schemas.FeatureVectorsOutput:
         obj_id_tags = self._get_records_to_tags_map(
             session, FeatureVector, project, tag, name
         )
 
         # Query the actual objects to be returned
         query = self._query(session, FeatureVector, project=project, state=state)
 
@@ -2562,15 +2586,17 @@
         if tag:
             query = query.filter(FeatureVector.id.in_(obj_id_tags.keys()))
         if labels:
             query = self._add_labels_filter(session, query, FeatureVector, labels)
 
         if partition_by:
             self._assert_partition_by_parameters(
-                schemas.FeatureStorePartitionByField, partition_by, partition_sort_by
+                mlrun.common.schemas.FeatureStorePartitionByField,
+                partition_by,
+                partition_sort_by,
             )
             query = self._create_partitioned_query(
                 session,
                 query,
                 FeatureVector,
                 partition_by,
                 rows_per_partition,
@@ -2584,15 +2610,17 @@
                 self._generate_records_with_tags_assigned(
                     feature_vector_record,
                     self._transform_feature_vector_model_to_schema,
                     obj_id_tags,
                     tag,
                 )
             )
-        return schemas.FeatureVectorsOutput(feature_vectors=feature_vectors)
+        return mlrun.common.schemas.FeatureVectorsOutput(
+            feature_vectors=feature_vectors
+        )
 
     def list_feature_vectors_tags(
         self,
         session,
         project: str,
     ):
         query = (
@@ -2605,15 +2633,15 @@
 
     @retry_on_conflict
     def store_feature_vector(
         self,
         session,
         project,
         name,
-        feature_vector: schemas.FeatureVector,
+        feature_vector: mlrun.common.schemas.FeatureVector,
         tag=None,
         uid=None,
         versioned=True,
         always_overwrite=False,
     ) -> str:
         original_uid = uid
 
@@ -2668,15 +2696,15 @@
         self,
         session,
         project,
         name,
         feature_vector_update: dict,
         tag=None,
         uid=None,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ) -> str:
         feature_vector_record = self._get_feature_vector(
             session, project, name, tag, uid
         )
         if not feature_vector_record:
             feature_vector_uri = generate_object_uri(project, name, tag)
             raise mlrun.errors.MLRunNotFoundError(
@@ -2686,15 +2714,15 @@
         feature_vector_struct = feature_vector_record.dict(exclude_none=True)
         # using mergedeep for merging the patch content into the existing dictionary
         strategy = patch_mode.to_mergedeep_strategy()
         mergedeep.merge(feature_vector_struct, feature_vector_update, strategy=strategy)
 
         versioned = feature_vector_record.metadata.uid is not None
 
-        feature_vector = schemas.FeatureVector(**feature_vector_struct)
+        feature_vector = mlrun.common.schemas.FeatureVector(**feature_vector_struct)
         return self.store_feature_vector(
             session,
             project,
             name,
             feature_vector,
             feature_vector.metadata.tag,
             uid,
@@ -2938,15 +2966,15 @@
         project,
         ids,
         labels=None,
         since=None,
         until=None,
         name=None,
         kind=None,
-        category: schemas.ArtifactCategories = None,
+        category: mlrun.common.schemas.ArtifactCategories = None,
         iter=None,
         use_tag_as_uid: bool = None,
     ):
         """
         TODO: refactor this method
         basically ids should be list of strings (representing ids), but we also handle 3 special cases (mainly for
         BC until we refactor the whole artifacts API):
@@ -2989,15 +3017,15 @@
             # TODO - this is a hack needed since link artifacts will be returned even for artifacts of
             #        the wrong category. Remove this when we refactor this area.
             return self._filter_out_extra_link_artifacts(filtered_artifacts)
         else:
             return query.all()
 
     def _filter_artifacts_by_category(
-        self, artifacts, category: schemas.ArtifactCategories
+        self, artifacts, category: mlrun.common.schemas.ArtifactCategories
     ):
         kinds, exclude = category.to_kinds_filter()
         return self._filter_artifacts_by_kinds(artifacts, kinds, exclude)
 
     def _filter_artifacts_by_kinds(
         self, artifacts, kinds: List[str], exclude: bool = False
     ):
@@ -3136,16 +3164,16 @@
             session.delete(label)
         if commit:
             session.commit()
 
     def _transform_schedule_record_to_scheme(
         self,
         schedule_record: Schedule,
-    ) -> schemas.ScheduleRecord:
-        schedule = schemas.ScheduleRecord.from_orm(schedule_record)
+    ) -> mlrun.common.schemas.ScheduleRecord:
+        schedule = mlrun.common.schemas.ScheduleRecord.from_orm(schedule_record)
         schedule.creation_time = self._add_utc_timezone(schedule.creation_time)
         schedule.next_run_time = self._add_utc_timezone(schedule.next_run_time)
         return schedule
 
     @staticmethod
     def _add_utc_timezone(time_value: typing.Optional[datetime]):
         """
@@ -3157,55 +3185,57 @@
                 return pytz.utc.localize(time_value)
         return time_value
 
     @staticmethod
     def _transform_feature_set_model_to_schema(
         feature_set_record: FeatureSet,
         tag=None,
-    ) -> schemas.FeatureSet:
+    ) -> mlrun.common.schemas.FeatureSet:
         feature_set_full_dict = feature_set_record.full_object
-        feature_set_resp = schemas.FeatureSet(**feature_set_full_dict)
+        feature_set_resp = mlrun.common.schemas.FeatureSet(**feature_set_full_dict)
 
         feature_set_resp.metadata.tag = tag
         return feature_set_resp
 
     @staticmethod
     def _transform_feature_vector_model_to_schema(
         feature_vector_record: FeatureVector,
         tag=None,
-    ) -> schemas.FeatureVector:
+    ) -> mlrun.common.schemas.FeatureVector:
         feature_vector_full_dict = feature_vector_record.full_object
-        feature_vector_resp = schemas.FeatureVector(**feature_vector_full_dict)
+        feature_vector_resp = mlrun.common.schemas.FeatureVector(
+            **feature_vector_full_dict
+        )
 
         feature_vector_resp.metadata.tag = tag
         feature_vector_resp.metadata.created = feature_vector_record.created
         return feature_vector_resp
 
     def _transform_project_record_to_schema(
         self, session: Session, project_record: Project
-    ) -> schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         # in projects that was created before 0.6.0 the full object wasn't created properly - fix that, and return
         if not project_record.full_object:
-            project = schemas.Project(
-                metadata=schemas.ProjectMetadata(
+            project = mlrun.common.schemas.Project(
+                metadata=mlrun.common.schemas.ProjectMetadata(
                     name=project_record.name,
                     created=project_record.created,
                 ),
-                spec=schemas.ProjectSpec(
+                spec=mlrun.common.schemas.ProjectSpec(
                     description=project_record.description,
                     source=project_record.source,
                 ),
-                status=schemas.ObjectStatus(
+                status=mlrun.common.schemas.ObjectStatus(
                     state=project_record.state,
                 ),
             )
             self.store_project(session, project_record.name, project)
             return project
         # TODO: handle transforming the functions/workflows/artifacts references to real objects
-        return schemas.Project(**project_record.full_object)
+        return mlrun.common.schemas.Project(**project_record.full_object)
 
     def _transform_notification_record_to_spec_and_status(
         self,
         notification_record: Notification,
     ) -> typing.Tuple[dict, dict]:
         notification_spec = self._transform_notification_record_to_schema(
             notification_record
@@ -3254,194 +3284,180 @@
         else:
             if move_from < move_to:
                 start, end = move_from + 1, move_to
                 modifier = -1
             else:
                 start, end = move_to, move_from - 1
 
-        query = session.query(MarketplaceSource).filter(
-            MarketplaceSource.index >= start
-        )
+        query = session.query(HubSource).filter(HubSource.index >= start)
         if end:
-            query = query.filter(MarketplaceSource.index <= end)
+            query = query.filter(HubSource.index <= end)
 
         for source_record in query:
             source_record.index = source_record.index + modifier
             # using merge since primary key is changing
             session.merge(source_record)
 
         if move_to:
             # using merge since primary key is changing
             session.merge(moved_object)
         else:
             session.delete(moved_object)
         session.commit()
 
     @staticmethod
-    def _transform_marketplace_source_record_to_schema(
-        marketplace_source_record: MarketplaceSource,
-    ) -> schemas.IndexedMarketplaceSource:
-        source_full_dict = marketplace_source_record.full_object
-        marketplace_source = schemas.MarketplaceSource(**source_full_dict)
-        return schemas.IndexedMarketplaceSource(
-            index=marketplace_source_record.index, source=marketplace_source
+    def _transform_hub_source_record_to_schema(
+        hub_source_record: HubSource,
+    ) -> mlrun.common.schemas.IndexedHubSource:
+        source_full_dict = hub_source_record.full_object
+        hub_source = mlrun.common.schemas.HubSource(**source_full_dict)
+        return mlrun.common.schemas.IndexedHubSource(
+            index=hub_source_record.index, source=hub_source
         )
 
     @staticmethod
-    def _transform_marketplace_source_schema_to_record(
-        marketplace_source_schema: schemas.IndexedMarketplaceSource,
-        current_object: MarketplaceSource = None,
+    def _transform_hub_source_schema_to_record(
+        hub_source_schema: mlrun.common.schemas.IndexedHubSource,
+        current_object: HubSource = None,
     ):
         now = datetime.now(timezone.utc)
         if current_object:
-            if current_object.name != marketplace_source_schema.source.metadata.name:
+            if current_object.name != hub_source_schema.source.metadata.name:
                 raise mlrun.errors.MLRunInternalServerError(
                     "Attempt to update object while replacing its name"
                 )
             created_timestamp = current_object.created
         else:
-            created_timestamp = marketplace_source_schema.source.metadata.created or now
-        updated_timestamp = marketplace_source_schema.source.metadata.updated or now
+            created_timestamp = hub_source_schema.source.metadata.created or now
+        updated_timestamp = hub_source_schema.source.metadata.updated or now
 
-        marketplace_source_record = MarketplaceSource(
+        hub_source_record = HubSource(
             id=current_object.id if current_object else None,
-            name=marketplace_source_schema.source.metadata.name,
-            index=marketplace_source_schema.index,
+            name=hub_source_schema.source.metadata.name,
+            index=hub_source_schema.index,
             created=created_timestamp,
             updated=updated_timestamp,
         )
-        full_object = marketplace_source_schema.source.dict()
+        full_object = hub_source_schema.source.dict()
         full_object["metadata"]["created"] = str(created_timestamp)
         full_object["metadata"]["updated"] = str(updated_timestamp)
-        # Make sure we don't keep any credentials in the DB. These are handled in the marketplace crud object.
+        # Make sure we don't keep any credentials in the DB. These are handled in the hub crud object.
         full_object["spec"].pop("credentials", None)
 
-        marketplace_source_record.full_object = full_object
-        return marketplace_source_record
+        hub_source_record.full_object = full_object
+        return hub_source_record
 
     @staticmethod
-    def _validate_and_adjust_marketplace_order(session, order):
-        max_order = session.query(func.max(MarketplaceSource.index)).scalar()
+    def _validate_and_adjust_hub_order(session, order):
+        max_order = session.query(func.max(HubSource.index)).scalar()
         if not max_order or max_order < 0:
             max_order = 0
 
-        if order == schemas.marketplace.last_source_index:
+        if order == mlrun.common.schemas.hub.last_source_index:
             order = max_order + 1
 
         if order > max_order + 1:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Order must not exceed the current maximal order + 1. max_order = {max_order}, order = {order}"
             )
         if order < 1:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "Order of inserted source must be greater than 0 or "
-                + f"{schemas.marketplace.last_source_index} (for last). order = {order}"
+                + f"{mlrun.common.schemas.hub.last_source_index} (for last). order = {order}"
             )
         return order
 
-    def create_marketplace_source(
-        self, session, ordered_source: schemas.IndexedMarketplaceSource
+    def create_hub_source(
+        self, session, ordered_source: mlrun.common.schemas.IndexedHubSource
     ):
         logger.debug(
-            "Creating marketplace source in DB",
+            "Creating hub source in DB",
             index=ordered_source.index,
             name=ordered_source.source.metadata.name,
         )
 
-        order = self._validate_and_adjust_marketplace_order(
-            session, ordered_source.index
-        )
+        order = self._validate_and_adjust_hub_order(session, ordered_source.index)
         name = ordered_source.source.metadata.name
-        source_record = self._query(session, MarketplaceSource, name=name).one_or_none()
+        source_record = self._query(session, HubSource, name=name).one_or_none()
         if source_record:
             raise mlrun.errors.MLRunConflictError(
-                f"Marketplace source name already exists. name = {name}"
+                f"Hub source name already exists. name = {name}"
             )
-        source_record = self._transform_marketplace_source_schema_to_record(
-            ordered_source
-        )
+        source_record = self._transform_hub_source_schema_to_record(ordered_source)
 
         self._move_and_reorder_table_items(
             session, source_record, move_to=order, move_from=None
         )
 
     @retry_on_conflict
-    def store_marketplace_source(
+    def store_hub_source(
         self,
         session,
         name,
-        ordered_source: schemas.IndexedMarketplaceSource,
+        ordered_source: mlrun.common.schemas.IndexedHubSource,
     ):
-        logger.debug(
-            "Storing marketplace source in DB", index=ordered_source.index, name=name
-        )
+        logger.debug("Storing hub source in DB", index=ordered_source.index, name=name)
 
         if name != ordered_source.source.metadata.name:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "Conflict between resource name and metadata.name in the stored object"
             )
-        order = self._validate_and_adjust_marketplace_order(
-            session, ordered_source.index
-        )
+        order = self._validate_and_adjust_hub_order(session, ordered_source.index)
 
-        source_record = self._query(session, MarketplaceSource, name=name).one_or_none()
+        source_record = self._query(session, HubSource, name=name).one_or_none()
         current_order = source_record.index if source_record else None
-        if current_order == schemas.marketplace.last_source_index:
+        if current_order == mlrun.common.schemas.hub.last_source_index:
             raise mlrun.errors.MLRunInvalidArgumentError(
-                "Attempting to modify the global marketplace source."
+                "Attempting to modify the global hub source."
             )
-        source_record = self._transform_marketplace_source_schema_to_record(
+        source_record = self._transform_hub_source_schema_to_record(
             ordered_source, source_record
         )
 
         self._move_and_reorder_table_items(
             session, source_record, move_to=order, move_from=current_order
         )
 
-    def list_marketplace_sources(
-        self, session
-    ) -> List[schemas.IndexedMarketplaceSource]:
+    def list_hub_sources(self, session) -> List[mlrun.common.schemas.IndexedHubSource]:
         results = []
-        query = self._query(session, MarketplaceSource).order_by(
-            MarketplaceSource.index.desc()
-        )
+        query = self._query(session, HubSource).order_by(HubSource.index.desc())
         for record in query:
-            ordered_source = self._transform_marketplace_source_record_to_schema(record)
+            ordered_source = self._transform_hub_source_record_to_schema(record)
             # Need this to make the list return such that the default source is last in the response.
-            if ordered_source.index != schemas.last_source_index:
+            if ordered_source.index != mlrun.common.schemas.last_source_index:
                 results.insert(0, ordered_source)
             else:
                 results.append(ordered_source)
         return results
 
-    def delete_marketplace_source(self, session, name):
-        logger.debug("Deleting marketplace source from DB", name=name)
+    def delete_hub_source(self, session, name):
+        logger.debug("Deleting hub source from DB", name=name)
 
-        source_record = self._query(session, MarketplaceSource, name=name).one_or_none()
+        source_record = self._query(session, HubSource, name=name).one_or_none()
         if not source_record:
             return
 
         current_order = source_record.index
-        if current_order == schemas.marketplace.last_source_index:
+        if current_order == mlrun.common.schemas.hub.last_source_index:
             raise mlrun.errors.MLRunInvalidArgumentError(
-                "Attempting to delete the global marketplace source."
+                "Attempting to delete the global hub source."
             )
 
         self._move_and_reorder_table_items(
             session, source_record, move_to=None, move_from=current_order
         )
 
-    def get_marketplace_source(self, session, name) -> schemas.IndexedMarketplaceSource:
-        source_record = self._query(session, MarketplaceSource, name=name).one_or_none()
+    def get_hub_source(self, session, name) -> mlrun.common.schemas.IndexedHubSource:
+        source_record = self._query(session, HubSource, name=name).one_or_none()
         if not source_record:
             raise mlrun.errors.MLRunNotFoundError(
-                f"Marketplace source not found. name = {name}"
+                f"Hub source not found. name = {name}"
             )
 
-        return self._transform_marketplace_source_record_to_schema(source_record)
+        return self._transform_hub_source_record_to_schema(source_record)
 
     def get_current_data_version(
         self, session, raise_on_not_found=True
     ) -> typing.Optional[str]:
         current_data_version_record = (
             self._query(session, DataVersion)
             .order_by(DataVersion.created.desc())
@@ -3471,29 +3487,29 @@
 
     @retry_on_conflict
     def store_background_task(
         self,
         session,
         name: str,
         project: str,
-        state: str = mlrun.api.schemas.BackgroundTaskState.running,
+        state: str = mlrun.common.schemas.BackgroundTaskState.running,
         timeout: int = None,
     ):
         background_task_record = self._query(
             session,
             BackgroundTask,
             name=name,
             project=project,
         ).one_or_none()
         now = datetime.now(timezone.utc)
         if background_task_record:
             # we don't want to be able to change state after it reached terminal state
             if (
                 background_task_record.state
-                in mlrun.api.schemas.BackgroundTaskState.terminal_states()
+                in mlrun.common.schemas.BackgroundTaskState.terminal_states()
                 and state != background_task_record.state
             ):
                 raise mlrun.errors.MLRunRuntimeError(
                     "Background task already reached terminal state, can not change to another state. Failing"
                 )
 
             if timeout and mlrun.mlconf.background_tasks.timeout_mode == "enabled":
@@ -3512,47 +3528,47 @@
                 updated=now,
                 timeout=int(timeout) if timeout else None,
             )
         self._upsert(session, [background_task_record])
 
     def get_background_task(
         self, session, name: str, project: str
-    ) -> schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         background_task_record = self._get_background_task_record(
             session, name, project
         )
         if self._is_background_task_timeout_exceeded(background_task_record):
             # lazy update of state, only if get background task was requested and the timeout for the update passed
             # and the task still in progress then we change to failed
             self.store_background_task(
                 session,
                 name,
                 project,
-                mlrun.api.schemas.background_task.BackgroundTaskState.failed,
+                mlrun.common.schemas.background_task.BackgroundTaskState.failed,
             )
             background_task_record = self._get_background_task_record(
                 session, name, project
             )
 
         return self._transform_background_task_record_to_schema(background_task_record)
 
     @staticmethod
     def _transform_background_task_record_to_schema(
         background_task_record: BackgroundTask,
-    ) -> schemas.BackgroundTask:
-        return schemas.BackgroundTask(
-            metadata=schemas.BackgroundTaskMetadata(
+    ) -> mlrun.common.schemas.BackgroundTask:
+        return mlrun.common.schemas.BackgroundTask(
+            metadata=mlrun.common.schemas.BackgroundTaskMetadata(
                 name=background_task_record.name,
                 project=background_task_record.project,
                 created=background_task_record.created,
                 updated=background_task_record.updated,
                 timeout=background_task_record.timeout,
             ),
-            spec=schemas.BackgroundTaskSpec(),
-            status=schemas.BackgroundTaskStatus(
+            spec=mlrun.common.schemas.BackgroundTaskSpec(),
+            status=mlrun.common.schemas.BackgroundTaskStatus(
                 state=background_task_record.state,
             ),
         )
 
     def _list_project_background_tasks(
         self, session: Session, project: str
     ) -> typing.List[str]:
@@ -3597,15 +3613,15 @@
         # mlrun.mlconf.background_tasks.timeout_mode == "disabled",
         # it signifies that the background task was initiated while timeout mode was enabled,
         # and we intend to verify it as if timeout mode was enabled
         timeout = background_task_record.timeout
         if (
             timeout
             and background_task_record.state
-            not in mlrun.api.schemas.BackgroundTaskState.terminal_states()
+            not in mlrun.common.schemas.BackgroundTaskState.terminal_states()
             and datetime.utcnow()
             > timedelta(seconds=int(timeout)) + background_task_record.updated
         ):
             return True
         return False
 
     def store_run_notifications(
@@ -3640,15 +3656,15 @@
             notification.message = notification_model.message
             notification.severity = notification_model.severity
             notification.when = ",".join(notification_model.when)
             notification.condition = notification_model.condition
             notification.params = notification_model.params
             notification.status = (
                 notification_model.status
-                or mlrun.api.schemas.NotificationStatus.PENDING
+                or mlrun.common.schemas.NotificationStatus.PENDING
             )
             notification.sent_time = notification_model.sent_time
 
             logger.debug(
                 f"Storing {'new' if new_notification else 'existing'} notification",
                 notification_name=notification.name,
                 run_uid=run_uid,
```

## mlrun/api/db/sqldb/models/models_mysql.py

```diff
@@ -28,16 +28,16 @@
     String,
     Table,
     UniqueConstraint,
 )
 from sqlalchemy.ext.declarative import declarative_base
 from sqlalchemy.orm import relationship
 
+import mlrun.common.schemas
 import mlrun.utils.db
-from mlrun.api import schemas
 from mlrun.api.utils.db.sql_collation import SQLCollationUtil
 
 Base = declarative_base()
 NULL = None  # Avoid flake8 issuing warnings when comparing in filter
 run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
 
 
@@ -103,15 +103,15 @@
         Tag = make_tag(__tablename__)
 
         id = Column(Integer, primary_key=True)
         key = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
         updated = Column(sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(sqlalchemy.dialects.mysql.MEDIUMBLOB)
 
         labels = relationship(Label, cascade="all, delete-orphan")
         tags = relationship(Tag, cascade="all, delete-orphan")
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.key}/{self.uid}"
@@ -125,15 +125,15 @@
         Label = make_label(__tablename__)
         Tag = make_tag_v2(__tablename__)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(sqlalchemy.dialects.mysql.MEDIUMBLOB)
         updated = Column(sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3))
 
         labels = relationship(Label, cascade="all, delete-orphan")
         tags = relationship(Tag, cascade="all, delete-orphan")
 
         def get_identifier_string(self) -> str:
@@ -181,15 +181,15 @@
 
     class Log(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "logs"
 
         id = Column(Integer, primary_key=True)
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(sqlalchemy.dialects.mysql.MEDIUMBLOB)
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.uid}"
 
     class Run(Base, mlrun.utils.db.HasStruct):
         __tablename__ = "runs"
@@ -204,15 +204,15 @@
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         name = Column(
             String(255, collation=SQLCollationUtil.collation()), default="no-name"
         )
         iteration = Column(Integer)
         state = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(sqlalchemy.dialects.mysql.MEDIUMBLOB)
         start_time = Column(sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3))
         updated = Column(
             sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3), default=datetime.utcnow
         )
         # requested logs column indicates whether logs were requested for this run
         # None - old runs prior to the column addition, logs were already collected for them, so no need to collect them
@@ -266,15 +266,15 @@
         )
         kind = Column(String(255, collation=SQLCollationUtil.collation()))
         desired_state = Column(String(255, collation=SQLCollationUtil.collation()))
         state = Column(String(255, collation=SQLCollationUtil.collation()))
         creation_time = Column(sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3))
         cron_trigger_str = Column(String(255, collation=SQLCollationUtil.collation()))
         last_run_uri = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         struct = Column(sqlalchemy.dialects.mysql.MEDIUMBLOB)
         labels = relationship(Label, cascade="all, delete-orphan")
         concurrency_limit = Column(Integer, nullable=False)
         next_run_time = Column(sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3))
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.name}"
@@ -284,19 +284,19 @@
             return pickle.loads(self.struct)
 
         @scheduled_object.setter
         def scheduled_object(self, value):
             self.struct = pickle.dumps(value)
 
         @property
-        def cron_trigger(self) -> schemas.ScheduleCronTrigger:
+        def cron_trigger(self) -> mlrun.common.schemas.ScheduleCronTrigger:
             return orjson.loads(self.cron_trigger_str)
 
         @cron_trigger.setter
-        def cron_trigger(self, trigger: schemas.ScheduleCronTrigger):
+        def cron_trigger(self, trigger: mlrun.common.schemas.ScheduleCronTrigger):
             self.cron_trigger_str = orjson.dumps(trigger.dict(exclude_unset=True))
 
     # Define "many to many" users/projects
     project_users = Table(
         "project_users",
         Base.metadata,
         Column("project_id", Integer, ForeignKey("projects.id")),
@@ -318,15 +318,15 @@
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         description = Column(String(255, collation=SQLCollationUtil.collation()))
         owner = Column(String(255, collation=SQLCollationUtil.collation()))
         source = Column(String(255, collation=SQLCollationUtil.collation()))
         # the attribute name used to be _spec which is just a wrong naming, the attribute was renamed to _full_object
         # leaving the column as is to prevent redundant migration
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         _full_object = Column("spec", sqlalchemy.dialects.mysql.MEDIUMBLOB)
         created = Column(
             sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3), default=datetime.utcnow
         )
         state = Column(String(255, collation=SQLCollationUtil.collation()))
         users = relationship(User, secondary=project_users)
 
@@ -455,17 +455,17 @@
                 return json.loads(self._full_object)
 
         @full_object.setter
         def full_object(self, value):
             # TODO - convert to pickle, to avoid issues with non-json serializable fields such as datetime
             self._full_object = json.dumps(value, default=str)
 
-    class MarketplaceSource(Base, mlrun.utils.db.BaseModel):
-        __tablename__ = "marketplace_sources"
-        __table_args__ = (UniqueConstraint("name", name="_marketplace_sources_uc"),)
+    class HubSource(Base, mlrun.utils.db.BaseModel):
+        __tablename__ = "hub_sources"
+        __table_args__ = (UniqueConstraint("name", name="_hub_sources_uc"),)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         index = Column(Integer)
         created = Column(
             sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3),
             default=datetime.now(timezone.utc),
```

## mlrun/api/db/sqldb/models/models_sqlite.py

```diff
@@ -29,16 +29,16 @@
     String,
     Table,
     UniqueConstraint,
 )
 from sqlalchemy.ext.declarative import declarative_base
 from sqlalchemy.orm import relationship
 
+import mlrun.common.schemas
 import mlrun.utils.db
-from mlrun.api import schemas
 from mlrun.api.utils.db.sql_collation import SQLCollationUtil
 
 Base = declarative_base()
 NULL = None  # Avoid flake8 issuing warnings when comparing in filter
 run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
 
 
@@ -107,15 +107,15 @@
         Tag = make_tag(__tablename__)
 
         id = Column(Integer, primary_key=True)
         key = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
         updated = Column(TIMESTAMP)
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(BLOB)
         labels = relationship(Label)
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.key}/{self.uid}"
 
     class Function(Base, mlrun.utils.db.HasStruct):
@@ -127,29 +127,29 @@
         Label = make_label(__tablename__)
         Tag = make_tag_v2(__tablename__)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(BLOB)
         updated = Column(TIMESTAMP)
         labels = relationship(Label)
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.name}/{self.uid}"
 
     class Log(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "logs"
 
         id = Column(Integer, primary_key=True)
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(BLOB)
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.uid}"
 
     class Notification(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "notifications"
@@ -198,15 +198,15 @@
         uid = Column(String(255, collation=SQLCollationUtil.collation()))
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         name = Column(
             String(255, collation=SQLCollationUtil.collation()), default="no-name"
         )
         iteration = Column(Integer)
         state = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         body = Column(BLOB)
         start_time = Column(TIMESTAMP)
         # requested logs column indicates whether logs were requested for this run
         # None - old runs prior to the column addition, logs were already collected for them, so no need to collect them
         # False - logs were not requested for this run
         # True - logs were requested for this run
         requested_logs = Column(BOOLEAN)
@@ -250,15 +250,15 @@
         )
         kind = Column(String(255, collation=SQLCollationUtil.collation()))
         desired_state = Column(String(255, collation=SQLCollationUtil.collation()))
         state = Column(String(255, collation=SQLCollationUtil.collation()))
         creation_time = Column(TIMESTAMP)
         cron_trigger_str = Column(String(255, collation=SQLCollationUtil.collation()))
         last_run_uri = Column(String(255, collation=SQLCollationUtil.collation()))
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         struct = Column(BLOB)
         labels = relationship(Label, cascade="all, delete-orphan")
         concurrency_limit = Column(Integer, nullable=False)
         next_run_time = Column(TIMESTAMP)
 
         def get_identifier_string(self) -> str:
             return f"{self.project}/{self.name}"
@@ -268,19 +268,19 @@
             return pickle.loads(self.struct)
 
         @scheduled_object.setter
         def scheduled_object(self, value):
             self.struct = pickle.dumps(value)
 
         @property
-        def cron_trigger(self) -> schemas.ScheduleCronTrigger:
+        def cron_trigger(self) -> mlrun.common.schemas.ScheduleCronTrigger:
             return orjson.loads(self.cron_trigger_str)
 
         @cron_trigger.setter
-        def cron_trigger(self, trigger: schemas.ScheduleCronTrigger):
+        def cron_trigger(self, trigger: mlrun.common.schemas.ScheduleCronTrigger):
             self.cron_trigger_str = orjson.dumps(trigger.dict(exclude_unset=True))
 
     # Define "many to many" users/projects
     project_users = Table(
         "project_users",
         Base.metadata,
         Column("project_id", Integer, ForeignKey("projects.id")),
@@ -302,15 +302,15 @@
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         description = Column(String(255, collation=SQLCollationUtil.collation()))
         owner = Column(String(255, collation=SQLCollationUtil.collation()))
         source = Column(String(255, collation=SQLCollationUtil.collation()))
         # the attribute name used to be _spec which is just a wrong naming, the attribute was renamed to _full_object
         # leaving the column as is to prevent redundant migration
-        # TODO: change to JSON, see mlrun/api/schemas/function.py::FunctionState for reasoning
+        # TODO: change to JSON, see mlrun/common/schemas/function.py::FunctionState for reasoning
         _full_object = Column("spec", BLOB)
         created = Column(TIMESTAMP, default=datetime.utcnow)
         state = Column(String(255, collation=SQLCollationUtil.collation()))
         users = relationship(User, secondary=project_users)
 
         Label = make_label(__tablename__)
 
@@ -421,17 +421,17 @@
             if self._full_object:
                 return json.loads(self._full_object)
 
         @full_object.setter
         def full_object(self, value):
             self._full_object = json.dumps(value, default=str)
 
-    class MarketplaceSource(Base, mlrun.utils.db.BaseModel):
-        __tablename__ = "marketplace_sources"
-        __table_args__ = (UniqueConstraint("name", name="_marketplace_sources_uc"),)
+    class HubSource(Base, mlrun.utils.db.BaseModel):
+        __tablename__ = "hub_sources"
+        __table_args__ = (UniqueConstraint("name", name="_hub_sources_uc"),)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         index = Column(Integer)
         created = Column(TIMESTAMP, default=datetime.now(timezone.utc))
         updated = Column(TIMESTAMP, default=datetime.now(timezone.utc))
```

## mlrun/api/schemas/__init__.py

```diff
@@ -10,143 +10,222 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
-from .artifact import ArtifactCategories, ArtifactIdentifier, ArtifactsFormat
-from .auth import (
-    AuthInfo,
-    AuthorizationAction,
-    AuthorizationResourceTypes,
-    AuthorizationVerificationInput,
-    Credentials,
-    ProjectsRole,
-)
-from .background_task import (
-    BackgroundTask,
-    BackgroundTaskMetadata,
-    BackgroundTaskSpec,
-    BackgroundTaskState,
-    BackgroundTaskStatus,
-)
-from .client_spec import ClientSpec
-from .clusterization_spec import (
-    ClusterizationSpec,
-    WaitForChiefToReachOnlineStateFeatureFlag,
-)
-from .constants import (
-    APIStates,
-    ClusterizationRole,
-    DeletionStrategy,
-    FeatureStorePartitionByField,
-    HeaderNames,
-    LogsCollectorMode,
-    OrderType,
-    PatchMode,
-    RunPartitionByField,
-    SortField,
-)
-from .feature_store import (
-    EntitiesOutput,
-    Entity,
-    EntityListOutput,
-    EntityRecord,
-    Feature,
-    FeatureListOutput,
-    FeatureRecord,
-    FeatureSet,
-    FeatureSetDigestOutput,
-    FeatureSetDigestSpec,
-    FeatureSetIngestInput,
-    FeatureSetIngestOutput,
-    FeatureSetRecord,
-    FeatureSetsOutput,
-    FeatureSetSpec,
-    FeatureSetsTagsOutput,
-    FeaturesOutput,
-    FeatureVector,
-    FeatureVectorRecord,
-    FeatureVectorsOutput,
-    FeatureVectorsTagsOutput,
-)
-from .frontend_spec import (
-    AuthenticationFeatureFlag,
-    FeatureFlags,
-    FrontendSpec,
-    NuclioStreamsFeatureFlag,
-    PreemptionNodesFeatureFlag,
-    ProjectMembershipFeatureFlag,
-)
-from .function import FunctionState, PreemptionModes, SecurityContextEnrichmentModes
-from .http import HTTPSessionRetryMode
-from .k8s import NodeSelectorOperator, Resources, ResourceSpec
-from .marketplace import (
-    IndexedMarketplaceSource,
-    MarketplaceCatalog,
-    MarketplaceItem,
-    MarketplaceObjectMetadata,
-    MarketplaceSource,
-    MarketplaceSourceSpec,
-    last_source_index,
-)
-from .memory_reports import MostCommonObjectTypesReport, ObjectTypeReport
-from .model_endpoints import (
-    Features,
-    FeatureValues,
-    GrafanaColumn,
-    GrafanaDataPoint,
-    GrafanaNumberColumn,
-    GrafanaStringColumn,
-    GrafanaTable,
-    GrafanaTimeSeriesTarget,
-    ModelEndpoint,
-    ModelEndpointList,
-    ModelEndpointMetadata,
-    ModelEndpointSpec,
-    ModelEndpointStatus,
-    ModelMonitoringStoreKinds,
-)
-from .notification import NotificationSeverity, NotificationStatus
-from .object import ObjectKind, ObjectMetadata, ObjectSpec, ObjectStatus
-from .pipeline import PipelinesFormat, PipelinesOutput, PipelinesPagination
-from .project import (
-    IguazioProject,
-    Project,
-    ProjectDesiredState,
-    ProjectMetadata,
-    ProjectOwner,
-    ProjectsFormat,
-    ProjectsOutput,
-    ProjectSpec,
-    ProjectState,
-    ProjectStatus,
-    ProjectSummariesOutput,
-    ProjectSummary,
-)
-from .runtime_resource import (
-    GroupedByJobRuntimeResourcesOutput,
-    GroupedByProjectRuntimeResourcesOutput,
-    KindRuntimeResources,
-    ListRuntimeResourcesGroupByField,
-    RuntimeResource,
-    RuntimeResources,
-    RuntimeResourcesOutput,
-)
-from .schedule import (
-    ScheduleCronTrigger,
-    ScheduleInput,
-    ScheduleKinds,
-    ScheduleOutput,
-    ScheduleRecord,
-    SchedulesOutput,
-    ScheduleUpdate,
-)
-from .secret import (
-    AuthSecretData,
-    SecretKeysData,
-    SecretProviderName,
-    SecretsData,
-    UserSecretCreationRequest,
+"""
+Schemas were moved to mlrun.common.schemas.
+For backwards compatibility with mlrun.api.schemas, we use this file to convert the old imports to the new ones.
+The DeprecationHelper class is used to print a deprecation warning when the old import is used, and return the new
+schema.
+"""
+
+import sys
+
+import mlrun.common.schemas
+import mlrun.common.schemas.artifact as old_artifact
+import mlrun.common.schemas.auth as old_auth
+import mlrun.common.schemas.background_task as old_background_task
+import mlrun.common.schemas.client_spec as old_client_spec
+import mlrun.common.schemas.clusterization_spec as old_clusterization_spec
+import mlrun.common.schemas.constants as old_constants
+import mlrun.common.schemas.feature_store as old_feature_store
+import mlrun.common.schemas.frontend_spec as old_frontend_spec
+import mlrun.common.schemas.function as old_function
+import mlrun.common.schemas.http as old_http
+import mlrun.common.schemas.k8s as old_k8s
+import mlrun.common.schemas.memory_reports as old_memory_reports
+import mlrun.common.schemas.object as old_object
+import mlrun.common.schemas.pipeline as old_pipeline
+import mlrun.common.schemas.project as old_project
+import mlrun.common.schemas.runtime_resource as old_runtime_resource
+import mlrun.common.schemas.schedule as old_schedule
+import mlrun.common.schemas.secret as old_secret
+import mlrun.common.schemas.tag as old_tag
+from mlrun.utils.helpers import DeprecationHelper
+
+# for backwards compatibility, we need to inject the old import path to `sys.modules`
+sys.modules["mlrun.api.schemas.artifact"] = old_artifact
+sys.modules["mlrun.api.schemas.auth"] = old_auth
+sys.modules["mlrun.api.schemas.background_task"] = old_background_task
+sys.modules["mlrun.api.schemas.client_spec"] = old_client_spec
+sys.modules["mlrun.api.schemas.clusterization_spec"] = old_clusterization_spec
+sys.modules["mlrun.api.schemas.constants"] = old_constants
+sys.modules["mlrun.api.schemas.feature_store"] = old_feature_store
+sys.modules["mlrun.api.schemas.frontend_spec"] = old_frontend_spec
+sys.modules["mlrun.api.schemas.function"] = old_function
+sys.modules["mlrun.api.schemas.http"] = old_http
+sys.modules["mlrun.api.schemas.k8s"] = old_k8s
+sys.modules["mlrun.api.schemas.memory_reports"] = old_memory_reports
+sys.modules["mlrun.api.schemas.object"] = old_object
+sys.modules["mlrun.api.schemas.pipeline"] = old_pipeline
+sys.modules["mlrun.api.schemas.project"] = old_project
+sys.modules["mlrun.api.schemas.runtime_resource"] = old_runtime_resource
+sys.modules["mlrun.api.schemas.schedule"] = old_schedule
+sys.modules["mlrun.api.schemas.secret"] = old_secret
+sys.modules["mlrun.api.schemas.tag"] = old_tag
+
+# The DeprecationHelper class is used to print a deprecation warning when the old import is used,
+# and return the new schema. This is done for backwards compatibility with mlrun.api.schemas.
+ArtifactCategories = DeprecationHelper(mlrun.common.schemas.ArtifactCategories)
+ArtifactIdentifier = DeprecationHelper(mlrun.common.schemas.ArtifactIdentifier)
+ArtifactsFormat = DeprecationHelper(mlrun.common.schemas.ArtifactsFormat)
+AuthInfo = DeprecationHelper(mlrun.common.schemas.AuthInfo)
+AuthorizationAction = DeprecationHelper(mlrun.common.schemas.AuthorizationAction)
+AuthorizationResourceTypes = DeprecationHelper(
+    mlrun.common.schemas.AuthorizationResourceTypes
+)
+AuthorizationVerificationInput = DeprecationHelper(
+    mlrun.common.schemas.AuthorizationVerificationInput
+)
+Credentials = DeprecationHelper(mlrun.common.schemas.Credentials)
+ProjectsRole = DeprecationHelper(mlrun.common.schemas.ProjectsRole)
+
+BackgroundTask = DeprecationHelper(mlrun.common.schemas.BackgroundTask)
+BackgroundTaskMetadata = DeprecationHelper(mlrun.common.schemas.BackgroundTaskMetadata)
+BackgroundTaskSpec = DeprecationHelper(mlrun.common.schemas.BackgroundTaskSpec)
+BackgroundTaskState = DeprecationHelper(mlrun.common.schemas.BackgroundTaskState)
+BackgroundTaskStatus = DeprecationHelper(mlrun.common.schemas.BackgroundTaskStatus)
+ClientSpe = DeprecationHelper(mlrun.common.schemas.ClientSpec)
+ClusterizationSpec = DeprecationHelper(mlrun.common.schemas.ClusterizationSpec)
+WaitForChiefToReachOnlineStateFeatureFlag = DeprecationHelper(
+    mlrun.common.schemas.WaitForChiefToReachOnlineStateFeatureFlag
+)
+APIStates = DeprecationHelper(mlrun.common.schemas.APIStates)
+ClusterizationRole = DeprecationHelper(mlrun.common.schemas.ClusterizationRole)
+DeletionStrategy = DeprecationHelper(mlrun.common.schemas.DeletionStrategy)
+FeatureStorePartitionByField = DeprecationHelper(
+    mlrun.common.schemas.FeatureStorePartitionByField
+)
+HeaderNames = DeprecationHelper(mlrun.common.schemas.HeaderNames)
+LogsCollectorMode = DeprecationHelper(mlrun.common.schemas.LogsCollectorMode)
+OrderType = DeprecationHelper(mlrun.common.schemas.OrderType)
+PatchMode = DeprecationHelper(mlrun.common.schemas.PatchMode)
+RunPartitionByField = DeprecationHelper(mlrun.common.schemas.RunPartitionByField)
+SortField = DeprecationHelper(mlrun.common.schemas.SortField)
+EntitiesOutput = DeprecationHelper(mlrun.common.schemas.EntitiesOutput)
+Entity = DeprecationHelper(mlrun.common.schemas.Entity)
+EntityListOutput = DeprecationHelper(mlrun.common.schemas.EntityListOutput)
+EntityRecord = DeprecationHelper(mlrun.common.schemas.EntityRecord)
+Feature = DeprecationHelper(mlrun.common.schemas.Feature)
+FeatureListOutput = DeprecationHelper(mlrun.common.schemas.FeatureListOutput)
+FeatureRecord = DeprecationHelper(mlrun.common.schemas.FeatureRecord)
+FeatureSet = DeprecationHelper(mlrun.common.schemas.FeatureSet)
+FeatureSetDigestOutput = DeprecationHelper(mlrun.common.schemas.FeatureSetDigestOutput)
+FeatureSetDigestSpec = DeprecationHelper(mlrun.common.schemas.FeatureSetDigestSpec)
+FeatureSetIngestInput = DeprecationHelper(mlrun.common.schemas.FeatureSetIngestInput)
+FeatureSetIngestOutput = DeprecationHelper(mlrun.common.schemas.FeatureSetIngestOutput)
+FeatureSetRecord = DeprecationHelper(mlrun.common.schemas.FeatureSetRecord)
+FeatureSetsOutput = DeprecationHelper(mlrun.common.schemas.FeatureSetsOutput)
+FeatureSetSpec = DeprecationHelper(mlrun.common.schemas.FeatureSetSpec)
+FeatureSetsTagsOutput = DeprecationHelper(mlrun.common.schemas.FeatureSetsTagsOutput)
+FeaturesOutput = DeprecationHelper(mlrun.common.schemas.FeaturesOutput)
+FeatureVector = DeprecationHelper(mlrun.common.schemas.FeatureVector)
+FeatureVectorRecord = DeprecationHelper(mlrun.common.schemas.FeatureVectorRecord)
+FeatureVectorsOutput = DeprecationHelper(mlrun.common.schemas.FeatureVectorsOutput)
+FeatureVectorsTagsOutput = DeprecationHelper(
+    mlrun.common.schemas.FeatureVectorsTagsOutput
+)
+AuthenticationFeatureFlag = DeprecationHelper(
+    mlrun.common.schemas.AuthenticationFeatureFlag
+)
+FeatureFlags = DeprecationHelper(mlrun.common.schemas.FeatureFlags)
+FrontendSpec = DeprecationHelper(mlrun.common.schemas.FrontendSpec)
+NuclioStreamsFeatureFlag = DeprecationHelper(
+    mlrun.common.schemas.NuclioStreamsFeatureFlag
+)
+PreemptionNodesFeatureFlag = DeprecationHelper(
+    mlrun.common.schemas.PreemptionNodesFeatureFlag
+)
+ProjectMembershipFeatureFlag = DeprecationHelper(
+    mlrun.common.schemas.ProjectMembershipFeatureFlag
+)
+FunctionState = DeprecationHelper(mlrun.common.schemas.FunctionState)
+PreemptionModes = DeprecationHelper(mlrun.common.schemas.PreemptionModes)
+SecurityContextEnrichmentModes = DeprecationHelper(
+    mlrun.common.schemas.SecurityContextEnrichmentModes
+)
+HTTPSessionRetryMode = DeprecationHelper(mlrun.common.schemas.HTTPSessionRetryMode)
+NodeSelectorOperator = DeprecationHelper(mlrun.common.schemas.NodeSelectorOperator)
+Resources = DeprecationHelper(mlrun.common.schemas.Resources)
+ResourceSpec = DeprecationHelper(mlrun.common.schemas.ResourceSpec)
+IndexedHubSource = DeprecationHelper(mlrun.common.schemas.IndexedHubSource)
+HubCatalog = DeprecationHelper(mlrun.common.schemas.HubCatalog)
+HubItem = DeprecationHelper(mlrun.common.schemas.HubItem)
+HubObjectMetadata = DeprecationHelper(mlrun.common.schemas.HubObjectMetadata)
+HubSource = DeprecationHelper(mlrun.common.schemas.HubSource)
+HubSourceSpec = DeprecationHelper(mlrun.common.schemas.HubSourceSpec)
+last_source_index = DeprecationHelper(mlrun.common.schemas.last_source_index)
+MostCommonObjectTypesReport = DeprecationHelper(
+    mlrun.common.schemas.MostCommonObjectTypesReport
+)
+ObjectTypeReport = DeprecationHelper(mlrun.common.schemas.ObjectTypeReport)
+Features = DeprecationHelper(mlrun.common.schemas.Features)
+FeatureValues = DeprecationHelper(mlrun.common.schemas.FeatureValues)
+GrafanaColumn = DeprecationHelper(mlrun.common.schemas.GrafanaColumn)
+GrafanaDataPoint = DeprecationHelper(mlrun.common.schemas.GrafanaDataPoint)
+GrafanaNumberColumn = DeprecationHelper(mlrun.common.schemas.GrafanaNumberColumn)
+GrafanaStringColumn = DeprecationHelper(mlrun.common.schemas.GrafanaStringColumn)
+GrafanaTable = DeprecationHelper(mlrun.common.schemas.GrafanaTable)
+GrafanaTimeSeriesTarget = DeprecationHelper(
+    mlrun.common.schemas.GrafanaTimeSeriesTarget
+)
+ModelEndpoint = DeprecationHelper(mlrun.common.schemas.ModelEndpoint)
+ModelEndpointList = DeprecationHelper(mlrun.common.schemas.ModelEndpointList)
+ModelEndpointMetadata = DeprecationHelper(mlrun.common.schemas.ModelEndpointMetadata)
+ModelEndpointSpec = DeprecationHelper(mlrun.common.schemas.ModelEndpointSpec)
+ModelEndpointStatus = DeprecationHelper(mlrun.common.schemas.ModelEndpointStatus)
+ModelMonitoringStoreKinds = DeprecationHelper(
+    mlrun.common.schemas.ModelMonitoringStoreKinds
+)
+NotificationSeverity = DeprecationHelper(mlrun.common.schemas.NotificationSeverity)
+NotificationStatus = DeprecationHelper(mlrun.common.schemas.NotificationStatus)
+ObjectKind = DeprecationHelper(mlrun.common.schemas.ObjectKind)
+ObjectMetadata = DeprecationHelper(mlrun.common.schemas.ObjectMetadata)
+ObjectSpec = DeprecationHelper(mlrun.common.schemas.ObjectSpec)
+ObjectStatus = DeprecationHelper(mlrun.common.schemas.ObjectStatus)
+PipelinesFormat = DeprecationHelper(mlrun.common.schemas.PipelinesFormat)
+PipelinesOutput = DeprecationHelper(mlrun.common.schemas.PipelinesOutput)
+PipelinesPagination = DeprecationHelper(mlrun.common.schemas.PipelinesPagination)
+IguazioProject = DeprecationHelper(mlrun.common.schemas.IguazioProject)
+Project = DeprecationHelper(mlrun.common.schemas.Project)
+ProjectDesiredState = DeprecationHelper(mlrun.common.schemas.ProjectDesiredState)
+ProjectMetadata = DeprecationHelper(mlrun.common.schemas.ProjectMetadata)
+ProjectOwner = DeprecationHelper(mlrun.common.schemas.ProjectOwner)
+ProjectsFormat = DeprecationHelper(mlrun.common.schemas.ProjectsFormat)
+ProjectsOutput = DeprecationHelper(mlrun.common.schemas.ProjectsOutput)
+ProjectSpec = DeprecationHelper(mlrun.common.schemas.ProjectSpec)
+ProjectState = DeprecationHelper(mlrun.common.schemas.ProjectState)
+ProjectStatus = DeprecationHelper(mlrun.common.schemas.ProjectStatus)
+ProjectSummariesOutput = DeprecationHelper(mlrun.common.schemas.ProjectSummariesOutput)
+ProjectSummary = DeprecationHelper(mlrun.common.schemas.ProjectSummary)
+GroupedByJobRuntimeResourcesOutput = DeprecationHelper(
+    mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput
+)
+GroupedByProjectRuntimeResourcesOutput = DeprecationHelper(
+    mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput
+)
+KindRuntimeResources = DeprecationHelper(mlrun.common.schemas.KindRuntimeResources)
+ListRuntimeResourcesGroupByField = DeprecationHelper(
+    mlrun.common.schemas.ListRuntimeResourcesGroupByField
+)
+RuntimeResource = DeprecationHelper(mlrun.common.schemas.RuntimeResource)
+RuntimeResources = DeprecationHelper(mlrun.common.schemas.RuntimeResources)
+RuntimeResourcesOutput = DeprecationHelper(mlrun.common.schemas.RuntimeResourcesOutput)
+ScheduleCronTrigger = DeprecationHelper(mlrun.common.schemas.ScheduleCronTrigger)
+ScheduleInput = DeprecationHelper(mlrun.common.schemas.ScheduleInput)
+ScheduleKinds = DeprecationHelper(mlrun.common.schemas.ScheduleKinds)
+ScheduleOutput = DeprecationHelper(mlrun.common.schemas.ScheduleOutput)
+ScheduleRecord = DeprecationHelper(mlrun.common.schemas.ScheduleRecord)
+SchedulesOutput = DeprecationHelper(mlrun.common.schemas.SchedulesOutput)
+ScheduleUpdate = DeprecationHelper(mlrun.common.schemas.ScheduleUpdate)
+AuthSecretData = DeprecationHelper(mlrun.common.schemas.AuthSecretData)
+SecretKeysData = DeprecationHelper(mlrun.common.schemas.SecretKeysData)
+SecretProviderName = DeprecationHelper(mlrun.common.schemas.SecretProviderName)
+SecretsData = DeprecationHelper(mlrun.common.schemas.SecretsData)
+UserSecretCreationRequest = DeprecationHelper(
+    mlrun.common.schemas.UserSecretCreationRequest
 )
-from .tag import Tag, TagObjects
+Tag = DeprecationHelper(mlrun.common.schemas.Tag)
+TagObjects = DeprecationHelper(mlrun.common.schemas.TagObjects)
```

## mlrun/api/utils/background_tasks.py

```diff
@@ -18,18 +18,18 @@
 import typing
 import uuid
 
 import fastapi
 import fastapi.concurrency
 import sqlalchemy.orm
 
-import mlrun.api.schemas
 import mlrun.api.utils.helpers
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class ProjectBackgroundTasksHandler(metaclass=mlrun.utils.singleton.Singleton):
     def create_background_task(
@@ -37,21 +37,21 @@
         db_session: sqlalchemy.orm.Session,
         project: str,
         background_tasks: fastapi.BackgroundTasks,
         function,
         timeout: int = None,  # in seconds
         *args,
         **kwargs,
-    ) -> mlrun.api.schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         name = str(uuid.uuid4())
         mlrun.api.utils.singletons.db.get_db().store_background_task(
             db_session,
             name,
             project,
-            mlrun.api.schemas.BackgroundTaskState.running,
+            mlrun.common.schemas.BackgroundTaskState.running,
             timeout,
         )
         background_tasks.add_task(
             self.background_task_wrapper,
             db_session,
             project,
             name,
@@ -62,15 +62,15 @@
         return self.get_background_task(db_session, name, project)
 
     def get_background_task(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         project: str,
-    ) -> mlrun.api.schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         return mlrun.api.utils.singletons.db.get_db().get_background_task(
             db_session, name, project
         )
 
     async def background_task_wrapper(
         self,
         db_session: sqlalchemy.orm.Session,
@@ -89,39 +89,39 @@
             logger.warning(
                 f"Failed during background task execution: {function.__name__}, exc: {traceback.format_exc()}"
             )
             mlrun.api.utils.singletons.db.get_db().store_background_task(
                 db_session,
                 name,
                 project=project,
-                state=mlrun.api.schemas.BackgroundTaskState.failed,
+                state=mlrun.common.schemas.BackgroundTaskState.failed,
             )
         else:
             mlrun.api.utils.singletons.db.get_db().store_background_task(
                 db_session,
                 name,
                 project=project,
-                state=mlrun.api.schemas.BackgroundTaskState.succeeded,
+                state=mlrun.common.schemas.BackgroundTaskState.succeeded,
             )
 
 
 class InternalBackgroundTasksHandler(metaclass=mlrun.utils.singleton.Singleton):
     def __init__(self):
         self._internal_background_tasks: typing.Dict[
-            str, mlrun.api.schemas.BackgroundTask
+            str, mlrun.common.schemas.BackgroundTask
         ] = {}
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
     def create_background_task(
         self,
         background_tasks: fastapi.BackgroundTasks,
         function,
         *args,
         **kwargs,
-    ) -> mlrun.api.schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         name = str(uuid.uuid4())
         # sanity
         if name in self._internal_background_tasks:
             raise RuntimeError("Background task name already exists")
         background_task = self._generate_background_task(name)
         self._internal_background_tasks[name] = background_task
         background_tasks.add_task(
@@ -134,15 +134,15 @@
 
         return self.get_background_task(name)
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
     def get_background_task(
         self,
         name: str,
-    ) -> mlrun.api.schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         """
         :return: returns the background task object and bool whether exists
         """
         if name in self._internal_background_tasks:
             return self._internal_background_tasks[name]
         else:
             return self._generate_background_task_not_found_response(name)
@@ -156,58 +156,58 @@
                 await fastapi.concurrency.run_in_threadpool(function, *args, **kwargs)
 
         except Exception:
             logger.warning(
                 f"Failed during background task execution: {function.__name__}, exc: {traceback.format_exc()}"
             )
             self._update_background_task(
-                name, mlrun.api.schemas.BackgroundTaskState.failed
+                name, mlrun.common.schemas.BackgroundTaskState.failed
             )
         else:
             self._update_background_task(
-                name, mlrun.api.schemas.BackgroundTaskState.succeeded
+                name, mlrun.common.schemas.BackgroundTaskState.succeeded
             )
 
     def _update_background_task(
         self,
         name: str,
-        state: mlrun.api.schemas.BackgroundTaskState,
+        state: mlrun.common.schemas.BackgroundTaskState,
     ):
         background_task = self._internal_background_tasks[name]
         background_task.status.state = state
         background_task.metadata.updated = datetime.datetime.utcnow()
 
     @staticmethod
     def _generate_background_task_not_found_response(
         name: str, project: typing.Optional[str] = None
     ):
         # in order to keep things simple we don't persist the internal background tasks to the DB
         # If for some reason get is called and the background task doesn't exist, it means that probably we got
         # restarted, therefore we want to return a failed background task so the client will retry (if needed)
-        return mlrun.api.schemas.BackgroundTask(
-            metadata=mlrun.api.schemas.BackgroundTaskMetadata(
+        return mlrun.common.schemas.BackgroundTask(
+            metadata=mlrun.common.schemas.BackgroundTaskMetadata(
                 name=name, project=project
             ),
-            spec=mlrun.api.schemas.BackgroundTaskSpec(),
-            status=mlrun.api.schemas.BackgroundTaskStatus(
-                state=mlrun.api.schemas.BackgroundTaskState.failed
+            spec=mlrun.common.schemas.BackgroundTaskSpec(),
+            status=mlrun.common.schemas.BackgroundTaskStatus(
+                state=mlrun.common.schemas.BackgroundTaskState.failed
             ),
         )
 
     @staticmethod
     def _generate_background_task(
         name: str, project: typing.Optional[str] = None
-    ) -> mlrun.api.schemas.BackgroundTask:
+    ) -> mlrun.common.schemas.BackgroundTask:
         now = datetime.datetime.utcnow()
-        metadata = mlrun.api.schemas.BackgroundTaskMetadata(
+        metadata = mlrun.common.schemas.BackgroundTaskMetadata(
             name=name,
             project=project,
             created=now,
             updated=now,
         )
-        spec = mlrun.api.schemas.BackgroundTaskSpec()
-        status = mlrun.api.schemas.BackgroundTaskStatus(
-            state=mlrun.api.schemas.BackgroundTaskState.running
+        spec = mlrun.common.schemas.BackgroundTaskSpec()
+        status = mlrun.common.schemas.BackgroundTaskStatus(
+            state=mlrun.common.schemas.BackgroundTaskState.running
         )
-        return mlrun.api.schemas.BackgroundTask(
+        return mlrun.common.schemas.BackgroundTask(
             metadata=metadata, spec=spec, status=status
         )
```

## mlrun/api/utils/helpers.py

```diff
@@ -9,43 +9,33 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import asyncio
-import enum
 
 import mlrun
-import mlrun.api.schemas
+import mlrun.common.schemas
 from mlrun.utils import logger
 
 
-# TODO: From python 3.11 StrEnum is built-in and this will not be needed
-class StrEnum(str, enum.Enum):
-    def __str__(self):
-        return self.value
-
-    def __repr__(self):
-        return self.value
-
-
 def ensure_running_on_chief(function):
     """
     The motivation of this function is to catch development bugs in which we are accidentally using functions / flows
     that are supposed to run only in chief instance and by mistake got involved in a worker instance flow.
 
     Note that there is an option to disable this behavior, its not recommended at all, because it can cause the
     cluster to get out of synchronization.
     """
 
     def _ensure_running_on_chief():
         if (
             mlrun.mlconf.httpdb.clusterization.role
-            != mlrun.api.schemas.ClusterizationRole.chief
+            != mlrun.common.schemas.ClusterizationRole.chief
         ):
             if (
                 mlrun.mlconf.httpdb.clusterization.ensure_function_running_on_chief_mode
                 == "enabled"
             ):
                 message = (
                     f"{function.__name__} is supposed to run only on chief, re-route."
@@ -64,7 +54,16 @@
     async def async_wrapper(*args, **kwargs):
         _ensure_running_on_chief()
         return await function(*args, **kwargs)
 
     if asyncio.iscoroutinefunction(function):
         return async_wrapper
     return wrapper
+
+
+def minimize_project_schema(
+    project: mlrun.common.schemas.Project,
+) -> mlrun.common.schemas.Project:
+    project.spec.functions = None
+    project.spec.workflows = None
+    project.spec.artifacts = None
+    return project
```

## mlrun/api/utils/scheduler.py

```diff
@@ -26,16 +26,16 @@
 from apscheduler.schedulers.asyncio import AsyncIOScheduler
 from apscheduler.triggers.cron import CronTrigger as APSchedulerCronTrigger
 from sqlalchemy.orm import Session
 
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.helpers
+import mlrun.common.schemas
 import mlrun.errors
-from mlrun.api import schemas
 from mlrun.api.db.session import close_session, create_session
 from mlrun.api.utils.singletons.db import get_db
 from mlrun.config import config
 from mlrun.errors import err_to_str
 from mlrun.model import RunObject
 from mlrun.runtimes.constants import RunStates
 from mlrun.utils import logger
@@ -56,28 +56,28 @@
         scheduler_config = json.loads(config.httpdb.scheduling.scheduler_config)
         self._scheduler = AsyncIOScheduler(gconfig=scheduler_config, prefix=None)
         # this should be something that does not make any sense to be inside project name or job name
         self._job_id_separator = "-_-"
         # we don't allow to schedule a job to run more than one time per X
         # NOTE this cannot be less than one minute - see _validate_cron_trigger
         self._min_allowed_interval = config.httpdb.scheduling.min_allowed_interval
-        self._secrets_provider = schemas.SecretProviderName.kubernetes
+        self._secrets_provider = mlrun.common.schemas.SecretProviderName.kubernetes
 
     async def start(self, db_session: Session):
         logger.info("Starting scheduler")
         self._scheduler.start()
         # the scheduler shutdown and start operation are not fully async compatible yet -
         # https://github.com/agronholm/apscheduler/issues/360 - this sleep make them work
         await asyncio.sleep(0)
 
         # don't fail the start on re-scheduling failure
         try:
             if (
                 mlrun.mlconf.httpdb.clusterization.role
-                == mlrun.api.schemas.ClusterizationRole.chief
+                == mlrun.common.schemas.ClusterizationRole.chief
             ):
                 self._reload_schedules(db_session)
         except Exception as exc:
             logger.warning("Failed reloading schedules", exc=exc)
 
     async def stop(self):
         logger.info("Stopping scheduler")
@@ -89,38 +89,40 @@
     def _append_access_key_secret_to_labels(self, labels, secret_name):
         if secret_name:
             labels = labels or {}
             labels[self._db_record_auth_label] = secret_name
         return labels
 
     def _get_access_key_secret_name_from_db_record(
-        self, db_schedule: schemas.ScheduleRecord
+        self, db_schedule: mlrun.common.schemas.ScheduleRecord
     ):
         schedule_labels = db_schedule.dict()["labels"]
         for label in schedule_labels:
             if label["name"] == self._db_record_auth_label:
                 return label["value"]
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
     def create_schedule(
         self,
         db_session: Session,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         project: str,
         name: str,
-        kind: schemas.ScheduleKinds,
+        kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Union[Dict, Callable],
-        cron_trigger: Union[str, schemas.ScheduleCronTrigger],
+        cron_trigger: Union[str, mlrun.common.schemas.ScheduleCronTrigger],
         labels: Dict = None,
         concurrency_limit: int = None,
     ):
         if concurrency_limit is None:
             concurrency_limit = config.httpdb.scheduling.default_concurrency_limit
         if isinstance(cron_trigger, str):
-            cron_trigger = schemas.ScheduleCronTrigger.from_crontab(cron_trigger)
+            cron_trigger = mlrun.common.schemas.ScheduleCronTrigger.from_crontab(
+                cron_trigger
+            )
 
         self._validate_cron_trigger(cron_trigger)
 
         logger.debug(
             "Creating schedule",
             project=project,
             name=name,
@@ -173,24 +175,26 @@
                 db_session, project_name, schedule_name, next_run_time=job.next_run_time
             )
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
     def update_schedule(
         self,
         db_session: Session,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         project: str,
         name: str,
         scheduled_object: Union[Dict, Callable] = None,
-        cron_trigger: Union[str, schemas.ScheduleCronTrigger] = None,
+        cron_trigger: Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         labels: Dict = None,
         concurrency_limit: int = None,
     ):
         if isinstance(cron_trigger, str):
-            cron_trigger = schemas.ScheduleCronTrigger.from_crontab(cron_trigger)
+            cron_trigger = mlrun.common.schemas.ScheduleCronTrigger.from_crontab(
+                cron_trigger
+            )
 
         if cron_trigger is not None:
             self._validate_cron_trigger(cron_trigger)
 
         logger.debug(
             "Updating schedule",
             project=project,
@@ -237,32 +241,32 @@
         db_session: Session,
         project: str = None,
         name: str = None,
         kind: str = None,
         labels: str = None,
         include_last_run: bool = False,
         include_credentials: bool = False,
-    ) -> schemas.SchedulesOutput:
+    ) -> mlrun.common.schemas.SchedulesOutput:
         db_schedules = get_db().list_schedules(db_session, project, name, labels, kind)
         schedules = []
         for db_schedule in db_schedules:
             schedule = self._transform_and_enrich_db_schedule(
                 db_session, db_schedule, include_last_run, include_credentials
             )
             schedules.append(schedule)
-        return schemas.SchedulesOutput(schedules=schedules)
+        return mlrun.common.schemas.SchedulesOutput(schedules=schedules)
 
     def get_schedule(
         self,
         db_session: Session,
         project: str,
         name: str,
         include_last_run: bool = False,
         include_credentials: bool = False,
-    ) -> schemas.ScheduleOutput:
+    ) -> mlrun.common.schemas.ScheduleOutput:
         logger.debug("Getting schedule", project=project, name=name)
         db_schedule = get_db().get_schedule(db_session, project, name)
         return self._transform_and_enrich_db_schedule(
             db_session, db_schedule, include_last_run, include_credentials
         )
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
@@ -305,15 +309,15 @@
         if job:
             self._scheduler.remove_job(job_id)
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
     async def invoke_schedule(
         self,
         db_session: Session,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         project: str,
         name: str,
     ):
         logger.debug("Invoking schedule", project=project, name=name)
         db_schedule = await fastapi.concurrency.run_in_threadpool(
             get_db().get_schedule,
             db_session,
@@ -331,21 +335,21 @@
             db_schedule.concurrency_limit,
             auth_info,
         )
         return await function(*args, **kwargs)
 
     def _ensure_auth_info_has_access_key(
         self,
-        auth_info: mlrun.api.schemas.AuthInfo,
-        kind: schemas.ScheduleKinds,
+        auth_info: mlrun.common.schemas.AuthInfo,
+        kind: mlrun.common.schemas.ScheduleKinds,
     ):
         import mlrun.api.crud
 
         if (
-            kind not in schemas.ScheduleKinds.local_kinds()
+            kind not in mlrun.common.schemas.ScheduleKinds.local_kinds()
             and mlrun.api.utils.auth.verifier.AuthVerifier().is_jobs_auth_required()
         ):
             if (
                 not auth_info.access_key
                 or auth_info.access_key == mlrun.model.Credentials.generate_access_key
             ):
                 auth_info.access_key = mlrun.api.utils.auth.verifier.AuthVerifier().get_or_create_access_key(
@@ -367,15 +371,15 @@
                     secret_name, raise_on_not_found=True
                 )
                 auth_info.access_key = secret.access_key
                 auth_info.username = secret.username
 
     def _store_schedule_secrets_using_auth_secret(
         self,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> str:
         # import here to avoid circular imports
         import mlrun.api.crud
 
         if mlrun.api.utils.auth.verifier.AuthVerifier().is_jobs_auth_required():
             # sanity
             if not auth_info.access_key:
@@ -384,27 +388,27 @@
                 )
 
             # Pydantic doesn't allow username to be None (may happen in tests)
             if auth_info.username is None:
                 auth_info.username = ""
 
             secret_name = mlrun.api.crud.Secrets().store_auth_secret(
-                mlrun.api.schemas.AuthSecretData(
-                    provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+                mlrun.common.schemas.AuthSecretData(
+                    provider=mlrun.common.schemas.SecretProviderName.kubernetes,
                     username=auth_info.username,
                     access_key=auth_info.access_key,
                 )
             )
             return secret_name
 
     # TODO - this function is no longer used except to simulate "the old way" in tests. Remove this once we
     #       are sure we are far enough that it's no longer going to be used (or keep, and use for other things).
     def _store_schedule_secrets(
         self,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
         project: str,
         name: str,
     ):
         # import here to avoid circular imports
         import mlrun.api.crud
 
         if mlrun.api.utils.auth.verifier.AuthVerifier().is_jobs_auth_required():
@@ -437,15 +441,15 @@
                         name,
                         self._secret_username_subtype,
                     )
                 )
                 secrets[username_secret_key] = auth_info.username
             mlrun.api.crud.Secrets().store_project_secrets(
                 project,
-                schemas.SecretsData(
+                mlrun.common.schemas.SecretsData(
                     provider=self._secrets_provider,
                     secrets=secrets,
                 ),
                 allow_internal_secrets=True,
                 key_map_secret_key=secret_key_map,
             )
 
@@ -541,15 +545,15 @@
                 key_map_secret_key=secret_key_map,
             )
 
         return username, access_key
 
     def _validate_cron_trigger(
         self,
-        cron_trigger: schemas.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger,
         # accepting now from outside for testing purposes
         now: datetime = None,
     ):
         """
         Enforce no more than one job per min_allowed_interval
         """
         apscheduler_cron_trigger = (
@@ -594,19 +598,19 @@
                     f"per {self._min_allowed_interval} is allowed"
                 )
 
     def _create_schedule_in_scheduler(
         self,
         project: str,
         name: str,
-        kind: schemas.ScheduleKinds,
+        kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Any,
-        cron_trigger: schemas.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger,
         concurrency_limit: int,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ):
         job_id = self._resolve_job_id(project, name)
         logger.debug("Adding schedule to scheduler", job_id=job_id)
         function, args, kwargs = self._resolve_job_function(
             kind, scheduled_object, project, name, concurrency_limit, auth_info
         )
 
@@ -624,19 +628,19 @@
             max_instances=concurrency_limit,
         )
 
     def _update_schedule_in_scheduler(
         self,
         project: str,
         name: str,
-        kind: schemas.ScheduleKinds,
+        kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Any,
-        cron_trigger: schemas.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger,
         concurrency_limit: int,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ):
         job_id = self._resolve_job_id(project, name)
         logger.debug("Updating schedule in scheduler", job_id=job_id)
         function, args, kwargs = self._resolve_job_function(
             kind, scheduled_object, project, name, concurrency_limit, auth_info
         )
         trigger = self.transform_schemas_cron_trigger_to_apscheduler_cron_trigger(
@@ -702,15 +706,15 @@
                     else:
                         username, access_key = self._get_schedule_secrets(
                             db_schedule.project, db_schedule.name
                         )
                         if access_key:
                             need_to_update_credentials = True
 
-                auth_info = mlrun.api.schemas.AuthInfo(
+                auth_info = mlrun.common.schemas.AuthInfo(
                     username=username,
                     access_key=access_key,
                     # enriching with control plane tag because scheduling a function requires control plane
                     planes=[mlrun.api.utils.clients.iguazio.SessionPlanes.control],
                 )
 
                 # Schedule was created using the old method. Transform schedule secrets to using auth secrets
@@ -749,29 +753,29 @@
                     traceback=traceback.format_exc(),
                     db_schedule=db_schedule,
                 )
 
     def _transform_and_enrich_db_schedule(
         self,
         db_session: Session,
-        schedule_record: schemas.ScheduleRecord,
+        schedule_record: mlrun.common.schemas.ScheduleRecord,
         include_last_run: bool = False,
         include_credentials: bool = False,
-    ) -> schemas.ScheduleOutput:
+    ) -> mlrun.common.schemas.ScheduleOutput:
         schedule_dict = schedule_record.dict()
         schedule_dict["labels"] = {
             label["name"]: label["value"] for label in schedule_dict["labels"]
         }
-        schedule = schemas.ScheduleOutput(**schedule_dict)
+        schedule = mlrun.common.schemas.ScheduleOutput(**schedule_dict)
 
         # Schedules are running only on chief. Therefore, we query next_run_time from the scheduler only when
         # running on chief.
         if (
             mlrun.mlconf.httpdb.clusterization.role
-            == mlrun.api.schemas.ClusterizationRole.chief
+            == mlrun.common.schemas.ClusterizationRole.chief
         ):
             job_id = self._resolve_job_id(schedule_record.project, schedule_record.name)
             job = self._scheduler.get_job(job_id)
             if job:
                 schedule.next_run_time = job.next_run_time
             else:
 
@@ -784,60 +788,60 @@
         if include_credentials:
             self._enrich_schedule_with_credentials(schedule)
 
         return schedule
 
     @staticmethod
     def _enrich_schedule_with_last_run(
-        db_session: Session, schedule_output: schemas.ScheduleOutput
+        db_session: Session, schedule_output: mlrun.common.schemas.ScheduleOutput
     ):
         if schedule_output.last_run_uri:
             run_project, run_uid, iteration, _ = RunObject.parse_uri(
                 schedule_output.last_run_uri
             )
             run_data = get_db().read_run(db_session, run_uid, run_project, iteration)
             schedule_output.last_run = run_data
 
     def _enrich_schedule_with_credentials(
-        self, schedule_output: schemas.ScheduleOutput
+        self, schedule_output: mlrun.common.schemas.ScheduleOutput
     ):
         secret_name = schedule_output.labels.get(self._db_record_auth_label)
         if secret_name:
             schedule_output.credentials.access_key = (
                 mlrun.model.Credentials.secret_reference_prefix + secret_name
             )
 
     def _resolve_job_function(
         self,
-        scheduled_kind: schemas.ScheduleKinds,
+        scheduled_kind: mlrun.common.schemas.ScheduleKinds,
         scheduled_object: Any,
         project_name: str,
         schedule_name: str,
         schedule_concurrency_limit: int,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> Tuple[Callable, Optional[Union[List, Tuple]], Optional[Dict]]:
         """
         :return: a tuple (function, args, kwargs) to be used with the APScheduler.add_job
         """
 
-        if scheduled_kind == schemas.ScheduleKinds.job:
+        if scheduled_kind == mlrun.common.schemas.ScheduleKinds.job:
             scheduled_object_copy = copy.deepcopy(scheduled_object)
             return (
                 Scheduler.submit_run_wrapper,
                 [
                     self,
                     scheduled_object_copy,
                     project_name,
                     schedule_name,
                     schedule_concurrency_limit,
                     auth_info,
                 ],
                 {},
             )
-        if scheduled_kind == schemas.ScheduleKinds.local_function:
+        if scheduled_kind == mlrun.common.schemas.ScheduleKinds.local_function:
             return scheduled_object, [], {}
 
         # sanity
         message = "Scheduled object kind missing implementation"
         logger.warn(message, scheduled_object_kind=scheduled_kind)
         raise NotImplementedError(message)
 
@@ -854,44 +858,44 @@
     @staticmethod
     async def submit_run_wrapper(
         scheduler,
         scheduled_object,
         project_name,
         schedule_name,
         schedule_concurrency_limit,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ):
 
         # removing the schedule from the body otherwise when the scheduler will submit this task it will go to an
         # endless scheduling loop
         scheduled_object.pop("schedule", None)
 
         # removing the uid from the task metadata so that a new uid will be generated for every run
         # otherwise all runs will have the same uid
         scheduled_object.get("task", {}).get("metadata", {}).pop("uid", None)
 
         if "task" in scheduled_object and "metadata" in scheduled_object["task"]:
             scheduled_object["task"]["metadata"].setdefault("labels", {})
             scheduled_object["task"]["metadata"]["labels"][
-                schemas.constants.LabelNames.schedule_name
+                mlrun.common.schemas.constants.LabelNames.schedule_name
             ] = schedule_name
 
         return await fastapi.concurrency.run_in_threadpool(
             Scheduler._submit_run_wrapper,
             scheduler,
             scheduled_object,
             project_name,
             schedule_name,
             schedule_concurrency_limit,
             auth_info,
         )
 
     @staticmethod
     def transform_schemas_cron_trigger_to_apscheduler_cron_trigger(
-        cron_trigger: schemas.ScheduleCronTrigger,
+        cron_trigger: mlrun.common.schemas.ScheduleCronTrigger,
     ):
         return APSchedulerCronTrigger(
             cron_trigger.year,
             cron_trigger.month,
             cron_trigger.day,
             cron_trigger.week,
             cron_trigger.day_of_week,
@@ -923,15 +927,15 @@
         try:
             db_session = create_session()
 
             active_runs = mlrun.api.crud.Runs().list_runs(
                 db_session,
                 states=RunStates.non_terminal_states(),
                 project=project_name,
-                labels=f"{schemas.constants.LabelNames.schedule_name}={schedule_name}",
+                labels=f"{mlrun.common.schemas.constants.LabelNames.schedule_name}={schedule_name}",
             )
             if len(active_runs) >= schedule_concurrency_limit:
                 logger.warn(
                     "Schedule exceeded concurrency limit, skipping this run",
                     project=project_name,
                     schedule_name=schedule_name,
                     schedule_concurrency_limit=schedule_concurrency_limit,
@@ -961,15 +965,15 @@
 
                 project_owner = mlrun.api.utils.singletons.project_member.get_project_member().get_project_owner(
                     db_session, project_name
                 )
                 # Update the schedule with the new auth info so we won't need to do the above again in the next run
                 scheduler.update_schedule(
                     db_session,
-                    mlrun.api.schemas.AuthInfo(
+                    mlrun.common.schemas.AuthInfo(
                         username=project_owner.username,
                         access_key=project_owner.access_key,
                         # enriching with control plane tag because scheduling a function requires control plane
                         planes=[
                             mlrun.api.utils.clients.iguazio.SessionPlanes.control,
                         ],
                     ),
```

## mlrun/api/utils/auth/verifier.py

```diff
@@ -15,18 +15,18 @@
 import asyncio
 import base64
 import typing
 
 import fastapi
 
 import mlrun
-import mlrun.api.schemas
 import mlrun.api.utils.auth.providers.nop
 import mlrun.api.utils.auth.providers.opa
 import mlrun.api.utils.clients.iguazio
+import mlrun.common.schemas
 import mlrun.utils.singleton
 
 
 class AuthVerifier(metaclass=mlrun.utils.singleton.Singleton):
     _basic_prefix = "Basic "
     _bearer_prefix = "Bearer "
 
@@ -37,50 +37,50 @@
         elif mlrun.mlconf.httpdb.authorization.mode == "opa":
             self._auth_provider = mlrun.api.utils.auth.providers.opa.Provider()
         else:
             raise NotImplementedError("Unsupported authorization mode")
 
     async def filter_project_resources_by_permissions(
         self,
-        resource_type: mlrun.api.schemas.AuthorizationResourceTypes,
+        resource_type: mlrun.common.schemas.AuthorizationResourceTypes,
         resources: typing.List,
         project_and_resource_name_extractor: typing.Callable,
-        auth_info: mlrun.api.schemas.AuthInfo,
-        action: mlrun.api.schemas.AuthorizationAction = mlrun.api.schemas.AuthorizationAction.read,
+        auth_info: mlrun.common.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction = mlrun.common.schemas.AuthorizationAction.read,
     ) -> typing.List:
         def _generate_opa_resource(resource):
             project_name, resource_name = project_and_resource_name_extractor(resource)
             return self._generate_resource_string_from_project_resource(
                 resource_type, project_name, resource_name
             )
 
         return await self.filter_by_permissions(
             resources, _generate_opa_resource, action, auth_info
         )
 
     async def filter_projects_by_permissions(
         self,
         project_names: typing.List[str],
-        auth_info: mlrun.api.schemas.AuthInfo,
-        action: mlrun.api.schemas.AuthorizationAction = mlrun.api.schemas.AuthorizationAction.read,
+        auth_info: mlrun.common.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction = mlrun.common.schemas.AuthorizationAction.read,
     ) -> typing.List:
         return await self.filter_by_permissions(
             project_names,
             self._generate_resource_string_from_project_name,
             action,
             auth_info,
         )
 
     async def query_project_resources_permissions(
         self,
-        resource_type: mlrun.api.schemas.AuthorizationResourceTypes,
+        resource_type: mlrun.common.schemas.AuthorizationResourceTypes,
         resources: typing.List,
         project_and_resource_name_extractor: typing.Callable,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         project_resources = [
             # project name, resource name
             project_and_resource_name_extractor(resource)
             for resource in resources
         ]
@@ -98,108 +98,108 @@
                     for project_resource in project_resources
                 ]
             )
         )
 
     async def query_project_resource_permissions(
         self,
-        resource_type: mlrun.api.schemas.AuthorizationResourceTypes,
+        resource_type: mlrun.common.schemas.AuthorizationResourceTypes,
         project_name: str,
         resource_name: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         return await self.query_permissions(
             self._generate_resource_string_from_project_resource(
                 resource_type, project_name, resource_name
             ),
             action,
             auth_info,
             raise_on_forbidden,
         )
 
     async def query_project_permissions(
         self,
         project_name: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         return await self.query_permissions(
             self._generate_resource_string_from_project_name(project_name),
             action,
             auth_info,
             raise_on_forbidden,
         )
 
     async def query_global_resource_permissions(
         self,
-        resource_type: mlrun.api.schemas.AuthorizationResourceTypes,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        resource_type: mlrun.common.schemas.AuthorizationResourceTypes,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         return await self.query_resource_permissions(
             resource_type,
             "",
             action,
             auth_info,
             raise_on_forbidden,
         )
 
     async def query_resource_permissions(
         self,
-        resource_type: mlrun.api.schemas.AuthorizationResourceTypes,
+        resource_type: mlrun.common.schemas.AuthorizationResourceTypes,
         resource_name: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         return await self.query_permissions(
             resource_type.to_resource_string("", resource_name),
             action=action,
             auth_info=auth_info,
             raise_on_forbidden=raise_on_forbidden,
         )
 
     async def query_permissions(
         self,
         resource: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         return await self._auth_provider.query_permissions(
             resource, action, auth_info, raise_on_forbidden
         )
 
     async def filter_by_permissions(
         self,
         resources: typing.List,
         opa_resource_extractor: typing.Callable,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> typing.List:
         return await self._auth_provider.filter_by_permissions(
             resources,
             opa_resource_extractor,
             action,
             auth_info,
         )
 
     def add_allowed_project_for_owner(
-        self, project_name: str, auth_info: mlrun.api.schemas.AuthInfo
+        self, project_name: str, auth_info: mlrun.common.schemas.AuthInfo
     ):
         self._auth_provider.add_allowed_project_for_owner(project_name, auth_info)
 
     async def authenticate_request(
         self, request: fastapi.Request
-    ) -> mlrun.api.schemas.AuthInfo:
-        auth_info = mlrun.api.schemas.AuthInfo()
+    ) -> mlrun.common.schemas.AuthInfo:
+        auth_info = mlrun.common.schemas.AuthInfo()
         header = request.headers.get("Authorization", "")
         if self._basic_auth_configured():
             if not header.startswith(self._basic_prefix):
                 raise mlrun.errors.MLRunUnauthorizedError("Missing basic auth header")
             username, password = self._parse_basic_auth(header)
             if (
                 username != mlrun.mlconf.httpdb.authentication.basic.username
@@ -224,18 +224,18 @@
                 auth_info.data_session = request.headers["x-data-session-override"]
 
         # Fallback in case auth method didn't fill in the username already, and it is provided by the caller
         if not auth_info.username and "x-remote-user" in request.headers:
             auth_info.username = request.headers["x-remote-user"]
 
         projects_role_header = request.headers.get(
-            mlrun.api.schemas.HeaderNames.projects_role
+            mlrun.common.schemas.HeaderNames.projects_role
         )
         auth_info.projects_role = (
-            mlrun.api.schemas.ProjectsRole(projects_role_header)
+            mlrun.common.schemas.ProjectsRole(projects_role_header)
             if projects_role_header
             else None
         )
         # In Iguazio 3.0 we're running with auth mode none cause auth is done by the ingress, in that auth mode sessions
         # needed for data operations were passed through this header, keep reading it to be backwards compatible
         if not auth_info.data_session and "X-V3io-Session-Key" in request.headers:
             auth_info.data_session = request.headers["X-V3io-Session-Key"]
@@ -244,15 +244,15 @@
         # won't be overridden
         if not auth_info.data_session and "X-V3io-Access-Key" in request.headers:
             auth_info.data_session = request.headers["X-V3io-Access-Key"]
         return auth_info
 
     async def generate_auth_info_from_session(
         self, session: str
-    ) -> mlrun.api.schemas.AuthInfo:
+    ) -> mlrun.common.schemas.AuthInfo:
         if not self._iguazio_auth_configured():
             raise NotImplementedError(
                 "Session is currently supported only for iguazio authentication mode"
             )
         return await mlrun.api.utils.clients.iguazio.AsyncClient().verify_session(
             session
         )
@@ -269,21 +269,23 @@
         )
 
     def is_jobs_auth_required(self):
         return self._iguazio_auth_configured()
 
     @staticmethod
     def _generate_resource_string_from_project_name(project_name: str):
-        return mlrun.api.schemas.AuthorizationResourceTypes.project.to_resource_string(
-            project_name, ""
+        return (
+            mlrun.common.schemas.AuthorizationResourceTypes.project.to_resource_string(
+                project_name, ""
+            )
         )
 
     @staticmethod
     def _generate_resource_string_from_project_resource(
-        resource_type: mlrun.api.schemas.AuthorizationResourceTypes,
+        resource_type: mlrun.common.schemas.AuthorizationResourceTypes,
         project_name: str,
         resource_name: str,
     ):
         if not project_name:
             project_name = "*"
         if not resource_name:
             resource_name = "*"
```

## mlrun/api/utils/auth/providers/base.py

```diff
@@ -11,36 +11,36 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import abc
 import typing
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 
 
 class Provider(abc.ABC):
     @abc.abstractmethod
     async def query_permissions(
         self,
         resource: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         pass
 
     @abc.abstractmethod
     async def filter_by_permissions(
         self,
         resources: typing.List,
         opa_resource_extractor: typing.Callable,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> typing.List:
         pass
 
     @abc.abstractmethod
     def add_allowed_project_for_owner(
-        self, project_name: str, auth_info: mlrun.api.schemas.AuthInfo
+        self, project_name: str, auth_info: mlrun.common.schemas.AuthInfo
     ):
         pass
```

## mlrun/api/utils/auth/providers/nop.py

```diff
@@ -10,38 +10,37 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
-import mlrun.api.schemas
 import mlrun.api.utils.auth.providers.base
 import mlrun.utils.singleton
 
 
 class Provider(
     mlrun.api.utils.auth.providers.base.Provider,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     async def query_permissions(
         self,
         resource: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
         return True
 
     async def filter_by_permissions(
         self,
         resources: typing.List,
         opa_resource_extractor: typing.Callable,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> typing.List:
         return resources
 
     def add_allowed_project_for_owner(
-        self, project_name: str, auth_info: mlrun.api.schemas.AuthInfo
+        self, project_name: str, auth_info: mlrun.common.schemas.AuthInfo
     ):
         pass
```

## mlrun/api/utils/auth/providers/opa.py

```diff
@@ -17,17 +17,17 @@
 import contextlib
 import copy
 import datetime
 import typing
 
 import humanfriendly
 
-import mlrun.api.schemas
 import mlrun.api.utils.auth.providers.base
 import mlrun.api.utils.projects.remotes.leader
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class Provider(
@@ -62,31 +62,31 @@
         self._allowed_project_owners_cache: typing.Dict[
             str, typing.Dict[str, datetime]
         ] = {}
 
     async def query_permissions(
         self,
         resource: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
         raise_on_forbidden: bool = True,
     ) -> bool:
 
         # store is not really a verb in our OPA manifest, we map it to 2 query permissions requests (create & update)
-        if action == mlrun.api.schemas.AuthorizationAction.store:
+        if action == mlrun.common.schemas.AuthorizationAction.store:
             results = await asyncio.gather(
                 self.query_permissions(
                     resource,
-                    mlrun.api.schemas.AuthorizationAction.create,
+                    mlrun.common.schemas.AuthorizationAction.create,
                     auth_info,
                     raise_on_forbidden,
                 ),
                 self.query_permissions(
                     resource,
-                    mlrun.api.schemas.AuthorizationAction.update,
+                    mlrun.common.schemas.AuthorizationAction.update,
                     auth_info,
                     raise_on_forbidden,
                 ),
             )
             create_allowed, update_allowed = results
             return create_allowed and update_allowed
         if self._is_request_from_leader(auth_info.projects_role):
@@ -109,19 +109,19 @@
             )
         return allowed
 
     async def filter_by_permissions(
         self,
         resources: typing.List,
         opa_resource_extractor: typing.Callable,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> typing.List:
         # store is not really a verb in our OPA manifest, we map it to 2 query permissions requests (create & update)
-        if action == mlrun.api.schemas.AuthorizationAction.store:
+        if action == mlrun.common.schemas.AuthorizationAction.store:
             raise NotImplementedError("Store action is not supported in filtering")
         if self._is_request_from_leader(auth_info.projects_role):
             return resources
         opa_resources = []
         for resource in resources:
             opa_resources.append(opa_resource_extractor(resource))
         allowed_by_cache = True
@@ -145,15 +145,15 @@
         allowed_resources = []
         for index, opa_resource in enumerate(opa_resources):
             if opa_resource in allowed_opa_resources:
                 allowed_resources.append(resources[index])
         return allowed_resources
 
     def add_allowed_project_for_owner(
-        self, project_name: str, auth_info: mlrun.api.schemas.AuthInfo
+        self, project_name: str, auth_info: mlrun.common.schemas.AuthInfo
     ):
         if (
             not auth_info.user_id
             or not project_name
             or not self._allowed_project_owners_cache_ttl_seconds
         ):
             # Simply won't be cached, no need to explode
@@ -164,15 +164,15 @@
         ttl = datetime.datetime.now() + datetime.timedelta(
             seconds=self._allowed_project_owners_cache_ttl_seconds
         )
         allowed_projects[project_name] = ttl
         self._allowed_project_owners_cache[auth_info.user_id] = allowed_projects
 
     def _check_allowed_project_owners_cache(
-        self, resource: str, auth_info: mlrun.api.schemas.AuthInfo
+        self, resource: str, auth_info: mlrun.common.schemas.AuthInfo
     ):
         # Cache shouldn't be big, simply clean it on get instead of scheduling it
         self._clean_expired_records_from_cache()
         if auth_info.user_id not in self._allowed_project_owners_cache:
             return False
         allowed_projects = list(
             self._allowed_project_owners_cache[auth_info.user_id].keys()
@@ -195,15 +195,15 @@
             self._allowed_project_owners_cache[user_id] = updated_allowed_projects
             if not updated_allowed_projects:
                 user_ids_to_remove.append(user_id)
         for user_id in user_ids_to_remove:
             del self._allowed_project_owners_cache[user_id]
 
     def _is_request_from_leader(
-        self, projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole]
+        self, projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole]
     ):
         if projects_role and projects_role.value == self._leader_name:
             return True
         return False
 
     @contextlib.asynccontextmanager
     async def _send_request_to_api(self, method, path, **kwargs):
@@ -237,31 +237,31 @@
             log_kwargs.update({"data": data})
         logger.warning("Request to opa failed", **log_kwargs)
         mlrun.errors.raise_for_status(response)
 
     @staticmethod
     def _generate_permission_request_body(
         resource: str,
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> dict:
         body = {
             "input": {
                 "resource": resource,
                 "action": str(action),
                 "ids": auth_info.get_member_ids(),
             },
         }
         return body
 
     @staticmethod
     def _generate_filter_request_body(
         resources: typing.List[str],
-        action: mlrun.api.schemas.AuthorizationAction,
-        auth_info: mlrun.api.schemas.AuthInfo,
+        action: mlrun.common.schemas.AuthorizationAction,
+        auth_info: mlrun.common.schemas.AuthInfo,
     ) -> dict:
         body = {
             "input": {
                 "resources": resources,
                 "action": str(action),
                 "ids": auth_info.get_member_ids(),
             },
```

## mlrun/api/utils/clients/chief.py

```diff
@@ -17,16 +17,16 @@
 import http.cookies
 import typing
 import urllib.parse
 
 import aiohttp
 import fastapi
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 # we were thinking to simply use httpdb, but decided to have a separated class for simplicity for now until
 # this class evolves, but this should be reconsidered when adding more functionality to the class
@@ -153,30 +153,32 @@
         # project resources (depends on the deletion strategy)
         return await self._proxy_request_to_chief(
             "DELETE", f"projects/{name}", request, timeout=120
         )
 
     async def get_clusterization_spec(
         self, return_fastapi_response: bool = True, raise_on_failure: bool = False
-    ) -> typing.Union[fastapi.Response, mlrun.api.schemas.ClusterizationSpec]:
+    ) -> typing.Union[fastapi.Response, mlrun.common.schemas.ClusterizationSpec]:
         """
         This method is used both for proxying requests from worker to chief and for aligning the worker state
         with the clusterization spec brought from the chief
         """
         async with self._send_request_to_api(
             method="GET",
             path="clusterization-spec",
             raise_on_failure=raise_on_failure,
         ) as chief_response:
             if return_fastapi_response:
                 return await self._convert_requests_response_to_fastapi_response(
                     chief_response
                 )
 
-            return mlrun.api.schemas.ClusterizationSpec(**(await chief_response.json()))
+            return mlrun.common.schemas.ClusterizationSpec(
+                **(await chief_response.json())
+            )
 
     async def _proxy_request_to_chief(
         self,
         method,
         path,
         request: fastapi.Request = None,
         json: dict = None,
```

## mlrun/api/utils/clients/iguazio.py

```diff
@@ -23,16 +23,16 @@
 import urllib.parse
 
 import aiohttp
 import fastapi
 import requests.adapters
 from fastapi.concurrency import run_in_threadpool
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.leader
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.singleton
 from mlrun.utils import get_in, logger
 
 
 class JobStates:
@@ -75,15 +75,15 @@
     mlrun.api.utils.projects.remotes.leader.Member,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def __init__(self, *args, **kwargs) -> None:
         super().__init__(*args, **kwargs)
         self._session = mlrun.utils.HTTPSessionWithRetry(
             retry_on_exception=mlrun.mlconf.httpdb.projects.retry_leader_request_on_exception
-            == mlrun.api.schemas.HTTPSessionRetryMode.enabled.value,
+            == mlrun.common.schemas.HTTPSessionRetryMode.enabled.value,
             verbose=True,
         )
         self._api_url = mlrun.mlconf.iguazio_api_url
         # The job is expected to be completed in less than 5 seconds. If 10 seconds have passed and the job
         # has not been completed, increase the interval to retry every 5 seconds
         self._wait_for_job_completion_retry_interval = mlrun.utils.create_step_backoff(
             [[1, 10], [5, None]]
@@ -119,15 +119,15 @@
                     for kind in ["https", "http"]:
                         if kind in url_kind_to_url:
                             return url_kind_to_url[kind]
         return None
 
     def verify_request_session(
         self, request: fastapi.Request
-    ) -> mlrun.api.schemas.AuthInfo:
+    ) -> mlrun.common.schemas.AuthInfo:
         """
         Proxy the request to one of the session verification endpoints (which will verify the session of the request)
         """
         response = self._send_request_to_api(
             "POST",
             mlrun.mlconf.httpdb.authentication.iguazio.session_verification_endpoint,
             "Failed verifying iguazio session",
@@ -136,15 +136,15 @@
                 "cookie": request.headers.get("cookie"),
             },
         )
         return self._generate_auth_info_from_session_verification_response(
             response.headers, response.json()
         )
 
-    def verify_session(self, session: str) -> mlrun.api.schemas.AuthInfo:
+    def verify_session(self, session: str) -> mlrun.common.schemas.AuthInfo:
         response = self._send_request_to_api(
             "POST",
             mlrun.mlconf.httpdb.authentication.iguazio.session_verification_endpoint,
             "Failed verifying iguazio session",
             session,
         )
         return self._generate_auth_info_from_session_verification_response(
@@ -185,48 +185,48 @@
         if response.status_code == http.HTTPStatus.CREATED.value:
             logger.debug("Created access key in Iguazio", planes=planes)
         return response.json()["data"]["id"]
 
     def create_project(
         self,
         session: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
         wait_for_completion: bool = True,
     ) -> bool:
         logger.debug("Creating project in Iguazio", project=project)
         body = self._transform_mlrun_project_to_iguazio_project(project)
         return self._create_project_in_iguazio(
             session, project.metadata.name, body, wait_for_completion
         )
 
     def update_project(
         self,
         session: str,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         logger.debug("Updating project in Iguazio", name=name, project=project)
         body = self._transform_mlrun_project_to_iguazio_project(project)
         self._put_project_to_iguazio(session, name, body)
 
     def delete_project(
         self,
         session: str,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
         wait_for_completion: bool = True,
     ) -> bool:
         logger.debug(
             "Deleting project in Iguazio",
             name=name,
             deletion_strategy=deletion_strategy,
         )
         body = self._transform_mlrun_project_to_iguazio_project(
-            mlrun.api.schemas.Project(
-                metadata=mlrun.api.schemas.ProjectMetadata(name=name)
+            mlrun.common.schemas.Project(
+                metadata=mlrun.common.schemas.ProjectMetadata(name=name)
             )
         )
         headers = {
             "igz-project-deletion-strategy": deletion_strategy.to_iguazio_deletion_strategy(),
         }
         try:
             response = self._send_request_to_api(
@@ -262,56 +262,33 @@
 
     def list_projects(
         self,
         session: str,
         updated_after: typing.Optional[datetime.datetime] = None,
         page_size: typing.Optional[int] = None,
     ) -> typing.Tuple[
-        typing.List[mlrun.api.schemas.Project], typing.Optional[datetime.datetime]
+        typing.List[mlrun.common.schemas.Project], typing.Optional[datetime.datetime]
     ]:
-        params = {}
-        if updated_after is not None:
-            time_string = updated_after.isoformat().split("+")[0]
-            params = {"filter[updated_at]": f"[$gt]{time_string}Z"}
-        if page_size is None:
-            page_size = (
-                mlrun.mlconf.httpdb.projects.iguazio_list_projects_default_page_size
-            )
-        if page_size is not None:
-            params["page[size]"] = int(page_size)
-
-        params["include"] = "owner"
-        response = self._send_request_to_api(
-            "GET",
-            "projects",
-            "Failed listing projects from Iguazio",
-            session,
-            params=params,
+        project_names, latest_updated_at = self._list_project_names(
+            session, updated_after, page_size
         )
-        response_body = response.json()
-        projects = []
-        for iguazio_project in response_body["data"]:
-            projects.append(
-                self._transform_iguazio_project_to_mlrun_project(iguazio_project)
-            )
-        latest_updated_at = self._find_latest_updated_at(response_body)
-        return projects, latest_updated_at
+        return self._list_projects_data(session, project_names), latest_updated_at
 
     def get_project(
         self,
         session: str,
         name: str,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         return self._get_project_from_iguazio(session, name)
 
     def get_project_owner(
         self,
         session: str,
         name: str,
-    ) -> mlrun.api.schemas.ProjectOwner:
+    ) -> mlrun.common.schemas.ProjectOwner:
         response = self._get_project_from_iguazio_without_parsing(
             session, name, enrich_owner_access_key=True
         )
         iguazio_project = response.json()["data"]
         owner_username = iguazio_project.get("attributes", {}).get(
             "owner_username", None
         )
@@ -319,33 +296,73 @@
             "owner_access_key", None
         )
         if not owner_username:
             raise mlrun.errors.MLRunInternalServerError(
                 f"Unable to enrich project owner for project {name},"
                 f" because project has no owner configured"
             )
-        return mlrun.api.schemas.ProjectOwner(
+        return mlrun.common.schemas.ProjectOwner(
             username=owner_username,
             access_key=owner_access_key,
         )
 
     def format_as_leader_project(
-        self, project: mlrun.api.schemas.Project
-    ) -> mlrun.api.schemas.IguazioProject:
-        return mlrun.api.schemas.IguazioProject(
+        self, project: mlrun.common.schemas.Project
+    ) -> mlrun.common.schemas.IguazioProject:
+        return mlrun.common.schemas.IguazioProject(
             data=self._transform_mlrun_project_to_iguazio_project(project)["data"]
         )
 
     @property
     def is_sync(self):
         """
         False because client is synchronous
         """
         return True
 
+    def _list_project_names(
+        self,
+        session: str,
+        updated_after: typing.Optional[datetime.datetime] = None,
+        page_size: typing.Optional[int] = None,
+    ) -> typing.Tuple[typing.List[str], typing.Optional[datetime.datetime]]:
+        params = {}
+        if updated_after is not None:
+            time_string = updated_after.isoformat().split("+")[0]
+            params = {"filter[updated_at]": f"[$gt]{time_string}Z"}
+        if page_size is None:
+            page_size = (
+                mlrun.mlconf.httpdb.projects.iguazio_list_projects_default_page_size
+            )
+        if page_size is not None:
+            params["page[size]"] = int(page_size)
+
+        response = self._send_request_to_api(
+            "GET",
+            "projects",
+            "Failed listing projects from Iguazio",
+            session,
+            params=params,
+        )
+        response_body = response.json()
+        project_names = [
+            iguazio_project["attributes"]["name"]
+            for iguazio_project in response_body["data"]
+        ]
+        latest_updated_at = self._find_latest_updated_at(response_body)
+        return project_names, latest_updated_at
+
+    def _list_projects_data(
+        self, session: str, project_names: typing.List[str]
+    ) -> typing.List[mlrun.common.schemas.Project]:
+        return [
+            self._get_project_from_iguazio(session, project_name)
+            for project_name in project_names
+        ]
+
     def _find_latest_updated_at(
         self, response_body: dict
     ) -> typing.Optional[datetime.datetime]:
         latest_updated_at = None
         for iguazio_project in response_body["data"]:
             updated_at = datetime.datetime.fromisoformat(
                 iguazio_project["attributes"]["updated_at"]
@@ -368,27 +385,27 @@
                 session, job_id, "Project creation job failed"
             )
             return False
         return True
 
     def _post_project_to_iguazio(
         self, session: str, body: dict
-    ) -> typing.Tuple[mlrun.api.schemas.Project, str]:
+    ) -> typing.Tuple[mlrun.common.schemas.Project, str]:
         response = self._send_request_to_api(
             "POST", "projects", "Failed creating project in Iguazio", session, json=body
         )
         response_body = response.json()
         return (
             self._transform_iguazio_project_to_mlrun_project(response_body["data"]),
             response_body["data"]["relationships"]["last_job"]["data"]["id"],
         )
 
     def _put_project_to_iguazio(
         self, session: str, name: str, body: dict
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         response = self._send_request_to_api(
             "PUT",
             f"projects/__name__/{name}",
             "Failed updating project in Iguazio",
             session,
             json=body,
         )
@@ -406,15 +423,15 @@
             "Failed getting project from Iguazio",
             session,
             params=params,
         )
 
     def _get_project_from_iguazio(
         self, session: str, name: str, include_owner_session: bool = False
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         response = self._get_project_from_iguazio_without_parsing(session, name)
         return self._transform_iguazio_project_to_mlrun_project(response.json()["data"])
 
     def _wait_for_job_completion(self, session: str, job_id: str, error_message: str):
         def _verify_job_in_terminal_state():
             response = self._send_request_to_api(
                 "GET", f"jobs/{job_id}", "Failed getting job from Iguazio", session
@@ -462,15 +479,15 @@
             )
         return response
 
     def _generate_auth_info_from_session_verification_response(
         self,
         response_headers: typing.Mapping[str, typing.Any],
         response_body: typing.Mapping[typing.Any, typing.Any],
-    ) -> mlrun.api.schemas.AuthInfo:
+    ) -> mlrun.common.schemas.AuthInfo:
 
         (
             username,
             session,
             planes,
             user_unix_id,
             user_id,
@@ -483,15 +500,15 @@
         ) = self._resolve_params_from_response_body(response_body)
 
         # from iguazio version >= 3.5.2, user and group ids are included in the response body
         # if not, get them from the headers
         user_id = user_id_from_body or user_id
         group_ids = group_ids_from_body or group_ids
 
-        auth_info = mlrun.api.schemas.AuthInfo(
+        auth_info = mlrun.common.schemas.AuthInfo(
             username=username,
             session=session,
             user_id=user_id,
             user_group_ids=group_ids,
             user_unix_id=user_unix_id,
             planes=planes,
         )
@@ -542,15 +559,15 @@
         for gid in gids:
             group_ids.extend(gid.split(","))
 
         return user_id, group_ids
 
     @staticmethod
     def _transform_mlrun_project_to_iguazio_project(
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ) -> dict:
         body = {
             "data": {
                 "type": "project",
                 "attributes": {
                     "name": project.metadata.name,
                     "description": project.spec.description,
@@ -579,15 +596,15 @@
             )
         if project.spec.owner:
             body["data"]["attributes"]["owner_username"] = project.spec.owner
         return body
 
     @staticmethod
     def _transform_mlrun_project_to_iguazio_mlrun_project_attribute(
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         project_dict = project.dict(
             exclude_unset=True,
             exclude={
                 "metadata": {"name", "created", "labels", "annotations"},
                 "spec": {"description", "desired_state", "owner"},
                 "status": {"state"},
@@ -613,30 +630,32 @@
         iguazio_labels: typing.List[dict],
     ) -> dict:
         return {label["name"]: label["value"] for label in iguazio_labels}
 
     @staticmethod
     def _transform_iguazio_project_to_mlrun_project(
         iguazio_project,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         mlrun_project_without_common_fields = json.loads(
             iguazio_project["attributes"].get("mlrun_project", "{}")
         )
         # name is mandatory in the mlrun schema, without adding it the schema initialization will fail
         mlrun_project_without_common_fields.setdefault("metadata", {})[
             "name"
         ] = iguazio_project["attributes"]["name"]
-        mlrun_project = mlrun.api.schemas.Project(**mlrun_project_without_common_fields)
+        mlrun_project = mlrun.common.schemas.Project(
+            **mlrun_project_without_common_fields
+        )
         mlrun_project.metadata.created = datetime.datetime.fromisoformat(
             iguazio_project["attributes"]["created_at"]
         )
-        mlrun_project.spec.desired_state = mlrun.api.schemas.ProjectDesiredState(
+        mlrun_project.spec.desired_state = mlrun.common.schemas.ProjectDesiredState(
             iguazio_project["attributes"]["admin_status"]
         )
-        mlrun_project.status.state = mlrun.api.schemas.ProjectState(
+        mlrun_project.status.state = mlrun.common.schemas.ProjectState(
             iguazio_project["attributes"]["operational_status"]
         )
         if iguazio_project["attributes"].get("description"):
             mlrun_project.spec.description = iguazio_project["attributes"][
                 "description"
             ]
         if iguazio_project["attributes"].get("labels"):
@@ -673,19 +692,19 @@
                     "Session cookie already set"
                 )
             cookies["session"] = session_cookie
             kwargs["cookies"] = cookies
         if kwargs.get("timeout") is None:
             kwargs["timeout"] = 20
         if "projects" in path:
-            if mlrun.api.schemas.HeaderNames.projects_role not in kwargs.get(
+            if mlrun.common.schemas.HeaderNames.projects_role not in kwargs.get(
                 "headers", {}
             ):
                 kwargs.setdefault("headers", {})[
-                    mlrun.api.schemas.HeaderNames.projects_role
+                    mlrun.common.schemas.HeaderNames.projects_role
                 ] = "mlrun"
 
         # requests no longer supports header values to be enum (https://github.com/psf/requests/pull/6154)
         # convert to strings. Do the same for params for niceness
         for kwarg in ["headers", "params"]:
             dict_ = kwargs.get(kwarg, {})
             for key in dict_.keys():
@@ -751,15 +770,15 @@
         def wrapper(*args, **kwargs):
             return self._run_in_threadpool_callback(attr, *args, **kwargs)
 
         return wrapper
 
     async def verify_request_session(
         self, request: fastapi.Request
-    ) -> mlrun.api.schemas.AuthInfo:
+    ) -> mlrun.common.schemas.AuthInfo:
         """
         Proxy the request to one of the session verification endpoints (which will verify the session of the request)
         """
         async with self._send_request_to_api_async(
             "POST",
             mlrun.mlconf.httpdb.authentication.iguazio.session_verification_endpoint,
             "Failed verifying iguazio session",
@@ -768,15 +787,15 @@
                 "cookie": request.headers.get("cookie"),
             },
         ) as response:
             return self._generate_auth_info_from_session_verification_response(
                 response.headers, await response.json()
             )
 
-    async def verify_session(self, session: str) -> mlrun.api.schemas.AuthInfo:
+    async def verify_session(self, session: str) -> mlrun.common.schemas.AuthInfo:
         async with self._send_request_to_api_async(
             "POST",
             mlrun.mlconf.httpdb.authentication.iguazio.session_verification_endpoint,
             "Failed verifying iguazio session",
             session,
         ) as response:
             return self._generate_auth_info_from_session_verification_response(
@@ -808,10 +827,10 @@
             if response:
                 response.release()
 
     async def _ensure_async_session(self):
         if not self._async_session:
             self._async_session = mlrun.utils.AsyncClientWithRetry(
                 retry_on_exception=mlrun.mlconf.httpdb.projects.retry_leader_request_on_exception
-                == mlrun.api.schemas.HTTPSessionRetryMode.enabled.value,
+                == mlrun.common.schemas.HTTPSessionRetryMode.enabled.value,
                 logger=logger,
             )
```

## mlrun/api/utils/clients/log_collector.py

```diff
@@ -10,14 +10,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import asyncio
 import enum
 import http
+import re
 import typing
 
 import mlrun.api.utils.clients.protocols.grpc
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.config import config
 from mlrun.utils import logger
@@ -48,14 +49,28 @@
             LogCollectorErrorCode(error_code),
             mlrun.errors.MLRunInternalServerError,
         )
 
         return mlrun_error_class(message)
 
 
+class LogCollectorErrorRegex:
+    # when multiple routines in the log collector service try to search the same directory,
+    # one of them can fail with this error
+    readdirent_resource_temporarily_unavailable = (
+        "readdirent.*resource temporarily unavailable"
+    )
+
+    @classmethod
+    def has_logs_retryable_errors(cls):
+        return [
+            cls.readdirent_resource_temporarily_unavailable,
+        ]
+
+
 class LogCollectorClient(
     mlrun.api.utils.clients.protocols.grpc.BaseGRPCClient,
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     name = "log_collector"
 
     def __init__(self, address: str = None):
@@ -205,14 +220,26 @@
         """
         request = self._log_collector_pb2.HasLogsRequest(
             runUID=run_uid, projectName=project
         )
 
         response = await self._call("HasLogs", request)
         if not response.success:
+            if self._retryable_error(
+                response.errorMessage,
+                LogCollectorErrorRegex.has_logs_retryable_errors(),
+            ):
+                if verbose:
+                    logger.warning(
+                        "Failed to check if run has logs to collect, retrying",
+                        run_uid=run_uid,
+                        error=response.errorMessage,
+                    )
+                return False
+
             msg = f"Failed to check if run has logs to collect for {run_uid}"
             if verbose:
                 logger.warning(msg, error=response.errorMessage)
             if raise_on_error:
                 raise LogCollectorErrorCode.map_error_code_to_mlrun_error(
                     response.errorCode, response.errorMessage, msg
                 )
@@ -229,15 +256,14 @@
         Stop logs streaming from the log collector service
         :param project: The project name
         :param run_uids: The run uids to stop logs for, if not provided will stop logs for all runs in the project
         :param verbose: Whether to log errors
         :param raise_on_error: Whether to raise an exception on error
         :return: None
         """
-
         request = self._log_collector_pb2.StopLogsRequest(
             project=project, runUIDs=run_uids
         )
 
         response = await self._call("StopLogs", request)
         if not response.success:
             msg = "Failed to stop logs"
@@ -273,7 +299,18 @@
             msg = "Failed to delete logs"
             if raise_on_error:
                 raise LogCollectorErrorCode.map_error_code_to_mlrun_error(
                     response.errorCode, response.errorMessage, msg
                 )
             if verbose:
                 logger.warning(msg, error=response.errorMessage)
+
+    def _retryable_error(self, error_message, retryable_error_patterns) -> bool:
+        """
+        Check if the error is retryable
+        :param error_message: The error message
+        :param retryable_error_patterns: The retryable error regex patterns
+        :return: Whether the error is retryable
+        """
+        if any(re.match(regex, error_message) for regex in retryable_error_patterns):
+            return True
+        return False
```

## mlrun/api/utils/clients/nuclio.py

```diff
@@ -16,16 +16,16 @@
 import enum
 import http
 import typing
 
 import requests.adapters
 import sqlalchemy.orm
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.follower
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class Client(
     mlrun.api.utils.projects.remotes.follower.Member,
@@ -33,25 +33,25 @@
 ):
     def __init__(self) -> None:
         super().__init__()
         self._session = mlrun.utils.HTTPSessionWithRetry(verbose=True)
         self._api_url = mlrun.config.config.nuclio_dashboard_url
 
     def create_project(
-        self, session: sqlalchemy.orm.Session, project: mlrun.api.schemas.Project
+        self, session: sqlalchemy.orm.Session, project: mlrun.common.schemas.Project
     ):
         logger.debug("Creating project in Nuclio", project=project)
         body = self._generate_request_body(project)
         self._post_project_to_nuclio(body)
 
     def store_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         logger.debug("Storing project in Nuclio", name=name, project=project)
         body = self._generate_request_body(project)
         try:
             self._get_project_from_nuclio(name)
         except requests.HTTPError as exc:
             if exc.response.status_code != http.HTTPStatus.NOT_FOUND.value:
@@ -61,15 +61,15 @@
             self._put_project_to_nuclio(body)
 
     def patch_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ):
         logger.debug(
             "Patching project in Nuclio",
             name=name,
             project=project,
             patch_mode=patch_mode,
         )
@@ -89,22 +89,22 @@
             ]
         self._put_project_to_nuclio(response_body)
 
     def delete_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         logger.debug(
             "Deleting project in Nuclio", name=name, deletion_strategy=deletion_strategy
         )
         body = self._generate_request_body(
-            mlrun.api.schemas.Project(
-                metadata=mlrun.api.schemas.ProjectMetadata(name=name)
+            mlrun.common.schemas.Project(
+                metadata=mlrun.common.schemas.ProjectMetadata(name=name)
             )
         )
         headers = {
             "x-nuclio-delete-project-strategy": deletion_strategy.to_nuclio_deletion_strategy(),
         }
         try:
             self._send_request_to_api("DELETE", "projects", json=body, headers=headers)
@@ -115,28 +115,28 @@
                 "Project not found in Nuclio. Considering deletion as successful",
                 name=name,
                 deletion_strategy=deletion_strategy,
             )
 
     def get_project(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         response = self._get_project_from_nuclio(name)
         response_body = response.json()
         return self._transform_nuclio_project_to_schema(response_body)
 
     def list_projects(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         if owner:
             raise NotImplementedError(
                 "Listing nuclio projects by owner is currently not supported"
             )
         if labels:
             raise NotImplementedError(
                 "Filtering nuclio projects by labels is currently not supported"
@@ -150,38 +150,38 @@
                 "Filtering nuclio projects by names is currently not supported"
             )
         response = self._send_request_to_api("GET", "projects")
         response_body = response.json()
         projects = []
         for nuclio_project in response_body.values():
             projects.append(self._transform_nuclio_project_to_schema(nuclio_project))
-        if format_ == mlrun.api.schemas.ProjectsFormat.full:
-            return mlrun.api.schemas.ProjectsOutput(projects=projects)
-        elif format_ == mlrun.api.schemas.ProjectsFormat.name_only:
-            return mlrun.api.schemas.ProjectsOutput(
+        if format_ == mlrun.common.schemas.ProjectsFormat.full:
+            return mlrun.common.schemas.ProjectsOutput(projects=projects)
+        elif format_ == mlrun.common.schemas.ProjectsFormat.name_only:
+            return mlrun.common.schemas.ProjectsOutput(
                 projects=[project.metadata.name for project in projects]
             )
         else:
             raise NotImplementedError(
                 f"Provided format is not supported. format={format_}"
             )
 
     def list_project_summaries(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         raise NotImplementedError("Listing project summaries is not supported")
 
     def get_project_summary(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         raise NotImplementedError("Get project summary is not supported")
 
     def get_dashboard_version(self) -> str:
         response = self._send_request_to_api("GET", "versions")
         response_body = response.json()
         return response_body["dashboard"]["label"]
 
@@ -222,31 +222,31 @@
                         {"error": error, "error_stack_trace": error_stack_trace}
                     )
             logger.warning("Request to nuclio failed", **log_kwargs)
             mlrun.errors.raise_for_status(response)
         return response
 
     @staticmethod
-    def _generate_request_body(project: mlrun.api.schemas.Project):
+    def _generate_request_body(project: mlrun.common.schemas.Project):
         body = {
             "metadata": {"name": project.metadata.name},
         }
         if project.metadata.labels:
             body["metadata"]["labels"] = project.metadata.labels
         if project.metadata.annotations:
             body["metadata"]["annotations"] = project.metadata.annotations
         if project.spec.description:
             body["spec"] = {"description": project.spec.description}
         return body
 
     @staticmethod
     def _transform_nuclio_project_to_schema(nuclio_project):
-        return mlrun.api.schemas.Project(
-            metadata=mlrun.api.schemas.ProjectMetadata(
+        return mlrun.common.schemas.Project(
+            metadata=mlrun.common.schemas.ProjectMetadata(
                 name=nuclio_project["metadata"]["name"],
                 labels=nuclio_project["metadata"].get("labels"),
                 annotations=nuclio_project["metadata"].get("annotations"),
             ),
-            spec=mlrun.api.schemas.ProjectSpec(
+            spec=mlrun.common.schemas.ProjectSpec(
                 description=nuclio_project["spec"].get("description")
             ),
         )
```

## mlrun/api/utils/clients/protocols/grpc.py

```diff
@@ -11,15 +11,15 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import google.protobuf.reflection
 import grpc
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 
 
 class BaseGRPCClient(object):
 
     name = None
```

## mlrun/api/utils/projects/follower.py

```diff
@@ -19,22 +19,22 @@
 import humanfriendly
 import mergedeep
 import pytz
 import sqlalchemy.orm
 
 import mlrun.api.crud
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.clients.nuclio
 import mlrun.api.utils.periodic
 import mlrun.api.utils.projects.member
 import mlrun.api.utils.projects.remotes.leader
 import mlrun.api.utils.projects.remotes.nop_leader
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 from mlrun.errors import err_to_str
@@ -74,15 +74,15 @@
             # introduced the chief/worker mechanism, we needed to change the follower to keep its projects in the DB
             # instead of in cache. On the switch, since we were using cache and the projects table in the DB was not
             # maintained, we know we may have projects that shouldn't be there anymore, ideally we would have trigger
             # the full sync only once on the switch, but since we don't have a good heuristic to identify the switch
             # we're doing a full_sync on every initialization
             full_sync = (
                 mlrun.mlconf.httpdb.clusterization.role
-                == mlrun.api.schemas.ClusterizationRole.chief
+                == mlrun.common.schemas.ClusterizationRole.chief
             )
             self._sync_projects(full_sync=full_sync)
         except Exception as exc:
             logger.warning(
                 "Initial projects sync failed",
                 exc=err_to_str(exc),
                 traceback=traceback.format_exc(),
@@ -92,20 +92,20 @@
     def shutdown(self):
         logger.info("Shutting down projects leader")
         self._stop_periodic_sync()
 
     def create_project(
         self,
         db_session: sqlalchemy.orm.Session,
-        project: mlrun.api.schemas.Project,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        project: mlrun.common.schemas.Project,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
         commit_before_get: bool = False,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         if self._is_request_from_leader(projects_role):
             mlrun.api.crud.Projects().create_project(db_session, project)
             return project, False
         else:
             is_running_in_background = self._leader_client.create_project(
                 leader_session, project, wait_for_completion
             )
@@ -133,19 +133,19 @@
                 )
             return created_project, is_running_in_background
 
     def store_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        project: mlrun.common.schemas.Project,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         if self._is_request_from_leader(projects_role):
             mlrun.api.crud.Projects().store_project(db_session, name, project)
             return project, False
         else:
             try:
                 self.get_project(db_session, name, leader_session)
             except mlrun.errors.MLRunNotFoundError:
@@ -162,44 +162,44 @@
                 return self.get_project(db_session, name, leader_session), False
 
     def patch_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         if self._is_request_from_leader(projects_role):
             # No real scenario for this to be useful currently - in iguazio patch is transformed to store request
             raise NotImplementedError("Patch operation not supported from leader")
         else:
             current_project = self.get_project(db_session, name, leader_session)
             strategy = patch_mode.to_mergedeep_strategy()
             current_project_dict = current_project.dict(exclude_unset=True)
             mergedeep.merge(current_project_dict, project, strategy=strategy)
-            patched_project = mlrun.api.schemas.Project(**current_project_dict)
+            patched_project = mlrun.common.schemas.Project(**current_project_dict)
             return self.store_project(
                 db_session,
                 name,
                 patched_project,
                 projects_role,
                 leader_session,
                 wait_for_completion,
             )
 
     def delete_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
-        auth_info: mlrun.api.schemas.AuthInfo = mlrun.api.schemas.AuthInfo(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
+        auth_info: mlrun.common.schemas.AuthInfo = mlrun.common.schemas.AuthInfo(),
         wait_for_completion: bool = True,
     ) -> bool:
         if self._is_request_from_leader(projects_role):
             mlrun.api.crud.Projects().delete_project(
                 db_session, name, deletion_strategy
             )
         else:
@@ -212,75 +212,75 @@
         return False
 
     def get_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         leader_session: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         return mlrun.api.crud.Projects().get_project(db_session, name)
 
     def get_project_owner(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-    ) -> mlrun.api.schemas.ProjectOwner:
+    ) -> mlrun.common.schemas.ProjectOwner:
         return self._leader_client.get_project_owner(self._sync_session, name)
 
     def list_projects(
         self,
         db_session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         # needed only for external usage when requesting leader format
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         if (
-            format_ == mlrun.api.schemas.ProjectsFormat.leader
+            format_ == mlrun.common.schemas.ProjectsFormat.leader
             and not self._is_request_from_leader(projects_role)
         ):
             raise mlrun.errors.MLRunAccessDeniedError(
                 "Leader format is allowed only to the leader"
             )
 
         projects_output = mlrun.api.crud.Projects().list_projects(
             db_session, owner, format_, labels, state, names
         )
-        if format_ == mlrun.api.schemas.ProjectsFormat.leader:
+        if format_ == mlrun.common.schemas.ProjectsFormat.leader:
             leader_projects = [
                 self._leader_client.format_as_leader_project(project)
                 for project in projects_output.projects
             ]
             projects_output.projects = leader_projects
         return projects_output
 
     async def list_project_summaries(
         self,
         db_session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        state: mlrun.common.schemas.ProjectState = None,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         return await mlrun.api.crud.Projects().list_project_summaries(
             db_session, owner, labels, state, names
         )
 
     async def get_project_summary(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         leader_session: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         return await mlrun.api.crud.Projects().get_project_summary(db_session, name)
 
     def _start_periodic_sync(self):
         # the > 0 condition is to allow ourselves to disable the sync from configuration
         if self._periodic_sync_interval_seconds > 0:
             logger.info(
                 "Starting periodic projects sync",
@@ -312,22 +312,22 @@
             leader_projects, latest_updated_at = self._leader_client.list_projects(
                 self._sync_session
             )
 
         db_session = mlrun.api.db.session.create_session()
         try:
             db_projects = mlrun.api.crud.Projects().list_projects(
-                db_session, format_=mlrun.api.schemas.ProjectsFormat.name_only
+                db_session, format_=mlrun.common.schemas.ProjectsFormat.name_only
             )
             # Don't add projects in non terminal state if they didn't exist before to prevent race conditions
             filtered_projects = []
             for leader_project in leader_projects:
                 if (
                     leader_project.status.state
-                    not in mlrun.api.schemas.ProjectState.terminal_states()
+                    not in mlrun.common.schemas.ProjectState.terminal_states()
                     and leader_project.metadata.name not in db_projects.projects
                 ):
                     continue
                 filtered_projects.append(leader_project)
 
             for project in filtered_projects:
                 mlrun.api.crud.Projects().store_project(
@@ -345,37 +345,37 @@
                     logger.info(
                         "Found project in the DB that is not in leader. Removing",
                         name=project_to_remove,
                     )
                     mlrun.api.crud.Projects().delete_project(
                         db_session,
                         project_to_remove,
-                        mlrun.api.schemas.DeletionStrategy.cascading,
+                        mlrun.common.schemas.DeletionStrategy.cascading,
                     )
             if latest_updated_at:
 
                 # sanity and defensive programming - if the leader returned a latest_updated_at that is older
                 # than the epoch, we'll set it to the epoch
                 epoch = pytz.UTC.localize(datetime.datetime.utcfromtimestamp(0))
                 if latest_updated_at < epoch:
                     latest_updated_at = epoch
                 self._synced_until_datetime = latest_updated_at
         finally:
             mlrun.api.db.session.close_session(db_session)
 
     def _is_request_from_leader(
-        self, projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole]
+        self, projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole]
     ) -> bool:
         if projects_role and projects_role.value == self._leader_name:
             return True
         return False
 
     @staticmethod
     def _is_project_matching_labels(
-        labels: typing.List[str], project: mlrun.api.schemas.Project
+        labels: typing.List[str], project: mlrun.common.schemas.Project
     ):
         if not project.metadata.labels:
             return False
         for label in labels:
             if "=" in label:
                 name, value = [v.strip() for v in label.split("=", 1)]
                 if name not in project.metadata.labels:
```

## mlrun/api/utils/projects/leader.py

```diff
@@ -16,20 +16,20 @@
 import traceback
 import typing
 
 import humanfriendly
 import sqlalchemy.orm
 
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.clients.nuclio
 import mlrun.api.utils.periodic
 import mlrun.api.utils.projects.member
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.projects.remotes.nop_follower
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 from mlrun.errors import err_to_str
@@ -54,63 +54,63 @@
     def shutdown(self):
         logger.info("Shutting down projects leader")
         self._stop_periodic_sync()
 
     def create_project(
         self,
         db_session: sqlalchemy.orm.Session,
-        project: mlrun.api.schemas.Project,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        project: mlrun.common.schemas.Project,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
         commit_before_get: bool = False,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         self._enrich_and_validate_before_creation(project)
         self._run_on_all_followers(True, "create_project", db_session, project)
         return self.get_project(db_session, project.metadata.name), False
 
     def store_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        project: mlrun.common.schemas.Project,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         self._enrich_project(project)
         mlrun.projects.ProjectMetadata.validate_project_name(name)
         self._validate_body_and_path_names_matches(name, project)
         self._run_on_all_followers(True, "store_project", db_session, name, project)
         return self.get_project(db_session, name), False
 
     def patch_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
-    ) -> typing.Tuple[mlrun.api.schemas.Project, bool]:
+    ) -> typing.Tuple[mlrun.common.schemas.Project, bool]:
         self._enrich_project_patch(project)
         self._validate_body_and_path_names_matches(name, project)
         self._run_on_all_followers(
             True, "patch_project", db_session, name, project, patch_mode
         )
         return self.get_project(db_session, name), False
 
     def delete_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
-        auth_info: mlrun.api.schemas.AuthInfo = mlrun.api.schemas.AuthInfo(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
+        auth_info: mlrun.common.schemas.AuthInfo = mlrun.common.schemas.AuthInfo(),
         wait_for_completion: bool = True,
     ) -> bool:
         self._projects_in_deletion.add(name)
         try:
             self._run_on_all_followers(
                 False, "delete_project", db_session, name, deletion_strategy
             )
@@ -119,59 +119,59 @@
         return False
 
     def get_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         leader_session: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         return self._leader_follower.get_project(db_session, name)
 
     def list_projects(
         self,
         db_session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        state: mlrun.common.schemas.ProjectState = None,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         return self._leader_follower.list_projects(
             db_session, owner, format_, labels, state, names
         )
 
     async def list_project_summaries(
         self,
         db_session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        state: mlrun.common.schemas.ProjectState = None,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         return await self._leader_follower.list_project_summaries(
             db_session, owner, labels, state, names
         )
 
     async def get_project_summary(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         leader_session: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         return await self._leader_follower.get_project_summary(db_session, name)
 
     def get_project_owner(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-    ) -> mlrun.api.schemas.ProjectOwner:
+    ) -> mlrun.common.schemas.ProjectOwner:
         raise NotImplementedError()
 
     def _start_periodic_sync(self):
         # if no followers no need for sync
         # the > 0 condition is to allow ourselves to disable the sync from configuration
         if self._periodic_sync_interval_seconds > 0 and self._followers:
             logger.info(
@@ -188,16 +188,16 @@
     def _stop_periodic_sync(self):
         mlrun.api.utils.periodic.cancel_periodic_function(self._sync_projects.__name__)
 
     def _sync_projects(self):
         db_session = mlrun.api.db.session.create_session()
         try:
             # re-generating all of the maps every time since _ensure_follower_projects_synced might cause changes
-            leader_projects: mlrun.api.schemas.ProjectsOutput
-            follower_projects_map: typing.Dict[str, mlrun.api.schemas.ProjectsOutput]
+            leader_projects: mlrun.common.schemas.ProjectsOutput
+            follower_projects_map: typing.Dict[str, mlrun.common.schemas.ProjectsOutput]
             leader_projects, follower_projects_map = self._run_on_all_followers(
                 True, "list_projects", db_session
             )
             leader_project_names = {
                 project.metadata.name for project in leader_projects.projects
             }
             # create reverse map project -> follower names
@@ -241,17 +241,17 @@
     def _ensure_project_synced(
         self,
         db_session: sqlalchemy.orm.Session,
         leader_project_names: typing.Set[str],
         follower_names: typing.Set[str],
         project_name: str,
         followers_projects_map: typing.Dict[
-            str, typing.Dict[str, mlrun.api.schemas.Project]
+            str, typing.Dict[str, mlrun.common.schemas.Project]
         ],
-        leader_projects_map: typing.Dict[str, mlrun.api.schemas.Project],
+        leader_projects_map: typing.Dict[str, mlrun.common.schemas.Project],
     ):
         # FIXME: This function only handles syncing project existence, i.e. if a user updates a project attribute
         #  through one of the followers this change won't be synced and the projects will be left with this discrepancy
         #  for ever
         project = None
         project_follower_name = None
         # first verify that the leader have this project
@@ -304,15 +304,15 @@
                 )
 
     def _store_project_in_followers(
         self,
         db_session: sqlalchemy.orm.Session,
         follower_names: typing.Set[str],
         project_name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         for follower_name in follower_names:
             logger.debug(
                 "Updating project in follower",
                 follower_name=follower_name,
                 project_name=project_name,
                 project=project,
@@ -337,15 +337,15 @@
     def _create_project_in_missing_followers(
         self,
         db_session: sqlalchemy.orm.Session,
         missing_followers: typing.Set[str],
         # the name of the follower which we took the missing project from
         project_follower_name: str,
         project_name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         for missing_follower in missing_followers:
             logger.debug(
                 "Project is missing from follower. Creating",
                 missing_follower_name=missing_follower,
                 project_follower_name=project_follower_name,
                 project_name=project_name,
@@ -424,20 +424,22 @@
             "nop": mlrun.api.utils.projects.remotes.nop_follower.Member(),
             "nop2": mlrun.api.utils.projects.remotes.nop_follower.Member(),
         }
         if name not in followers_classes_map:
             raise ValueError(f"Unknown follower name: {name}")
         return followers_classes_map[name]
 
-    def _enrich_and_validate_before_creation(self, project: mlrun.api.schemas.Project):
+    def _enrich_and_validate_before_creation(
+        self, project: mlrun.common.schemas.Project
+    ):
         self._enrich_project(project)
         mlrun.projects.ProjectMetadata.validate_project_name(project.metadata.name)
 
     @staticmethod
-    def _enrich_project(project: mlrun.api.schemas.Project):
+    def _enrich_project(project: mlrun.common.schemas.Project):
         project.status.state = project.spec.desired_state
 
     @staticmethod
     def _enrich_project_patch(project_patch: dict):
         if project_patch.get("spec", {}).get("desired_state"):
             project_patch.setdefault("status", {})["state"] = project_patch["spec"][
                 "desired_state"
@@ -453,17 +455,17 @@
             if raise_on_failure:
                 raise
             return False
         return True
 
     @staticmethod
     def _validate_body_and_path_names_matches(
-        path_name: str, project: typing.Union[mlrun.api.schemas.Project, dict]
+        path_name: str, project: typing.Union[mlrun.common.schemas.Project, dict]
     ):
-        if isinstance(project, mlrun.api.schemas.Project):
+        if isinstance(project, mlrun.common.schemas.Project):
             body_name = project.metadata.name
         elif isinstance(project, dict):
             body_name = project.get("metadata", {}).get("name")
         else:
             raise NotImplementedError("Unsupported project instance type")
 
         if body_name and path_name != body_name:
```

## mlrun/api/utils/projects/member.py

```diff
@@ -15,16 +15,16 @@
 import abc
 import typing
 
 import sqlalchemy.orm
 
 import mlrun.api.crud
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.clients.log_collector
+import mlrun.common.schemas
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class Member(abc.ABC):
     @abc.abstractmethod
     def initialize(self):
@@ -35,133 +35,133 @@
         pass
 
     def ensure_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         wait_for_completion: bool = True,
-        auth_info: mlrun.api.schemas.AuthInfo = mlrun.api.schemas.AuthInfo(),
+        auth_info: mlrun.common.schemas.AuthInfo = mlrun.common.schemas.AuthInfo(),
     ):
         project_names = self.list_projects(
             db_session,
-            format_=mlrun.api.schemas.ProjectsFormat.name_only,
+            format_=mlrun.common.schemas.ProjectsFormat.name_only,
             leader_session=auth_info.session,
         )
         if name not in project_names.projects:
             raise mlrun.errors.MLRunNotFoundError(f"Project {name} does not exist")
 
     @abc.abstractmethod
     def create_project(
         self,
         db_session: sqlalchemy.orm.Session,
-        project: mlrun.api.schemas.Project,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        project: mlrun.common.schemas.Project,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
         commit_before_get: bool = False,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         pass
 
     @abc.abstractmethod
     def store_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        project: mlrun.common.schemas.Project,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
-    ) -> typing.Tuple[typing.Optional[mlrun.api.schemas.Project], bool]:
+    ) -> typing.Tuple[typing.Optional[mlrun.common.schemas.Project], bool]:
         pass
 
     @abc.abstractmethod
     def patch_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         wait_for_completion: bool = True,
-    ) -> typing.Tuple[mlrun.api.schemas.Project, bool]:
+    ) -> typing.Tuple[mlrun.common.schemas.Project, bool]:
         pass
 
     @abc.abstractmethod
     def delete_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
-        auth_info: mlrun.api.schemas.AuthInfo = mlrun.api.schemas.AuthInfo(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
+        auth_info: mlrun.common.schemas.AuthInfo = mlrun.common.schemas.AuthInfo(),
         wait_for_completion: bool = True,
     ) -> bool:
         pass
 
     @abc.abstractmethod
     def get_project(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         leader_session: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abc.abstractmethod
     def list_projects(
         self,
         db_session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        state: mlrun.common.schemas.ProjectState = None,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         pass
 
     @abc.abstractmethod
     async def get_project_summary(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
         leader_session: typing.Optional[str] = None,
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         pass
 
     @abc.abstractmethod
     async def list_project_summaries(
         self,
         db_session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
-        projects_role: typing.Optional[mlrun.api.schemas.ProjectsRole] = None,
+        state: mlrun.common.schemas.ProjectState = None,
+        projects_role: typing.Optional[mlrun.common.schemas.ProjectsRole] = None,
         leader_session: typing.Optional[str] = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         pass
 
     @abc.abstractmethod
     def get_project_owner(
         self,
         db_session: sqlalchemy.orm.Session,
         name: str,
-    ) -> mlrun.api.schemas.ProjectOwner:
+    ) -> mlrun.common.schemas.ProjectOwner:
         pass
 
     async def post_delete_project(
         self,
         project_name: str,
     ):
         if (
             mlrun.mlconf.log_collector.mode
-            != mlrun.api.schemas.LogsCollectorMode.legacy
+            != mlrun.common.schemas.LogsCollectorMode.legacy
         ):
             await self._stop_logs_for_project(project_name)
             await self._delete_project_logs(project_name)
 
     @staticmethod
     async def _stop_logs_for_project(
         project_name: str,
```

## mlrun/api/utils/projects/remotes/follower.py

```diff
@@ -13,79 +13,79 @@
 # limitations under the License.
 #
 import abc
 import typing
 
 import sqlalchemy.orm
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 
 
 class Member(abc.ABC):
     @abc.abstractmethod
     def create_project(
-        self, session: sqlalchemy.orm.Session, project: mlrun.api.schemas.Project
+        self, session: sqlalchemy.orm.Session, project: mlrun.common.schemas.Project
     ):
         pass
 
     @abc.abstractmethod
     def store_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         pass
 
     @abc.abstractmethod
     def patch_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ):
         pass
 
     @abc.abstractmethod
     def delete_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         pass
 
     @abc.abstractmethod
     def get_project(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abc.abstractmethod
     def list_projects(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         pass
 
     @abc.abstractmethod
     def list_project_summaries(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         pass
 
     @abc.abstractmethod
     def get_project_summary(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         pass
```

## mlrun/api/utils/projects/remotes/leader.py

```diff
@@ -12,70 +12,70 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import abc
 import datetime
 import typing
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 
 
 class Member(abc.ABC):
     @abc.abstractmethod
     def create_project(
         self,
         session: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
         wait_for_completion: bool = True,
     ) -> bool:
         pass
 
     @abc.abstractmethod
     def update_project(
         self,
         session: str,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         pass
 
     @abc.abstractmethod
     def delete_project(
         self,
         session: str,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
         wait_for_completion: bool = True,
     ) -> bool:
         pass
 
     @abc.abstractmethod
     def list_projects(
         self,
         session: str,
         updated_after: typing.Optional[datetime.datetime] = None,
     ) -> typing.Tuple[
-        typing.List[mlrun.api.schemas.Project], typing.Optional[datetime.datetime]
+        typing.List[mlrun.common.schemas.Project], typing.Optional[datetime.datetime]
     ]:
         pass
 
     @abc.abstractmethod
     def get_project(
         self,
         session: str,
         name: str,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abc.abstractmethod
     def format_as_leader_project(
-        self, project: mlrun.api.schemas.Project
-    ) -> mlrun.api.schemas.IguazioProject:
+        self, project: mlrun.common.schemas.Project
+    ) -> mlrun.common.schemas.IguazioProject:
         pass
 
     @abc.abstractmethod
     def get_project_owner(
         self,
         session: str,
         name: str,
-    ) -> mlrun.api.schemas.ProjectOwner:
+    ) -> mlrun.common.schemas.ProjectOwner:
         pass
```

## mlrun/api/utils/projects/remotes/nop_follower.py

```diff
@@ -13,107 +13,115 @@
 # limitations under the License.
 #
 import typing
 
 import mergedeep
 import sqlalchemy.orm
 
-import mlrun.api.schemas
+import mlrun.api.utils.helpers
 import mlrun.api.utils.projects.remotes.follower
+import mlrun.common.schemas
 import mlrun.errors
 
 
 class Member(mlrun.api.utils.projects.remotes.follower.Member):
     def __init__(self) -> None:
         super().__init__()
-        self._projects: typing.Dict[str, mlrun.api.schemas.Project] = {}
+        self._projects: typing.Dict[str, mlrun.common.schemas.Project] = {}
 
     def create_project(
-        self, session: sqlalchemy.orm.Session, project: mlrun.api.schemas.Project
+        self, session: sqlalchemy.orm.Session, project: mlrun.common.schemas.Project
     ):
         if project.metadata.name in self._projects:
             raise mlrun.errors.MLRunConflictError("Project already exists")
         # deep copy so we won't accidentally get changes from tests
         self._projects[project.metadata.name] = project.copy(deep=True)
 
     def store_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         # deep copy so we won't accidentally get changes from tests
         self._projects[name] = project.copy(deep=True)
 
     def patch_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
     ):
         existing_project_dict = self._projects[name].dict()
         strategy = patch_mode.to_mergedeep_strategy()
         mergedeep.merge(existing_project_dict, project, strategy=strategy)
-        self._projects[name] = mlrun.api.schemas.Project(**existing_project_dict)
+        self._projects[name] = mlrun.common.schemas.Project(**existing_project_dict)
 
     def delete_project(
         self,
         session: sqlalchemy.orm.Session,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         if name in self._projects:
             del self._projects[name]
 
     def get_project(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         # deep copy so we won't accidentally get changes from tests
         return self._projects[name].copy(deep=True)
 
     def list_projects(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+    ) -> mlrun.common.schemas.ProjectsOutput:
         if owner or labels or state:
             raise NotImplementedError(
                 "Filtering by owner, labels or state is not supported"
             )
         projects = list(self._projects.values())
         # deep copy so we won't accidentally get changes from tests
         projects = [project.copy(deep=True) for project in projects]
         if names:
             projects = [
                 project
                 for project_name, project in self._projects.items()
                 if project_name in names
             ]
-        if format_ == mlrun.api.schemas.ProjectsFormat.full:
-            return mlrun.api.schemas.ProjectsOutput(projects=projects)
-        elif format_ == mlrun.api.schemas.ProjectsFormat.name_only:
+        if format_ == mlrun.common.schemas.ProjectsFormat.full:
+            return mlrun.common.schemas.ProjectsOutput(projects=projects)
+        elif format_ == mlrun.common.schemas.ProjectsFormat.minimal:
+            return mlrun.common.schemas.ProjectsOutput(
+                projects=[
+                    mlrun.api.utils.helpers.minimize_project_schema(project)
+                    for project in projects
+                ]
+            )
+        elif format_ == mlrun.common.schemas.ProjectsFormat.name_only:
             project_names = [project.metadata.name for project in projects]
-            return mlrun.api.schemas.ProjectsOutput(projects=project_names)
+            return mlrun.common.schemas.ProjectsOutput(projects=project_names)
         else:
             raise NotImplementedError(
                 f"Provided format is not supported. format={format_}"
             )
 
     def list_project_summaries(
         self,
         session: sqlalchemy.orm.Session,
         owner: str = None,
         labels: typing.List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
+        state: mlrun.common.schemas.ProjectState = None,
         names: typing.Optional[typing.List[str]] = None,
-    ) -> mlrun.api.schemas.ProjectSummariesOutput:
+    ) -> mlrun.common.schemas.ProjectSummariesOutput:
         raise NotImplementedError("Listing project summaries is not supported")
 
     def get_project_summary(
         self, session: sqlalchemy.orm.Session, name: str
-    ) -> mlrun.api.schemas.ProjectSummary:
+    ) -> mlrun.common.schemas.ProjectSummary:
         raise NotImplementedError("Get project summary is not supported")
```

## mlrun/api/utils/projects/remotes/nop_leader.py

```diff
@@ -11,31 +11,31 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import datetime
 import typing
 
-import mlrun.api.schemas
 import mlrun.api.utils.projects.remotes.leader
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.schemas
 import mlrun.errors
 
 
 class Member(mlrun.api.utils.projects.remotes.leader.Member):
     def __init__(self) -> None:
         super().__init__()
         self.db_session = None
         self.project_owner_access_key = ""
-        self._project_role = mlrun.api.schemas.ProjectsRole.nop
+        self._project_role = mlrun.common.schemas.ProjectsRole.nop
 
     def create_project(
         self,
         session: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
         wait_for_completion: bool = True,
     ) -> bool:
         self._update_state(project)
         (
             _,
             is_running_in_background,
         ) = mlrun.api.utils.singletons.project_member.get_project_member().create_project(
@@ -43,74 +43,75 @@
         )
         return is_running_in_background
 
     def update_project(
         self,
         session: str,
         name: str,
-        project: mlrun.api.schemas.Project,
+        project: mlrun.common.schemas.Project,
     ):
         self._update_state(project)
         mlrun.api.utils.singletons.project_member.get_project_member().store_project(
             self.db_session, name, project, self._project_role
         )
 
     @staticmethod
-    def _update_state(project: mlrun.api.schemas.Project):
+    def _update_state(project: mlrun.common.schemas.Project):
         if (
             not project.status.state
-            or project.status.state in mlrun.api.schemas.ProjectState.terminal_states()
+            or project.status.state
+            in mlrun.common.schemas.ProjectState.terminal_states()
         ):
-            project.status.state = mlrun.api.schemas.ProjectState(
+            project.status.state = mlrun.common.schemas.ProjectState(
                 project.spec.desired_state
             )
 
     def delete_project(
         self,
         session: str,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
         wait_for_completion: bool = True,
     ) -> bool:
         return mlrun.api.utils.singletons.project_member.get_project_member().delete_project(
             self.db_session, name, deletion_strategy, self._project_role
         )
 
     def list_projects(
         self,
         session: str,
         updated_after: typing.Optional[datetime.datetime] = None,
     ) -> typing.Tuple[
-        typing.List[mlrun.api.schemas.Project], typing.Optional[datetime.datetime]
+        typing.List[mlrun.common.schemas.Project], typing.Optional[datetime.datetime]
     ]:
         return (
             mlrun.api.utils.singletons.project_member.get_project_member()
             .list_projects(self.db_session)
             .projects,
             datetime.datetime.utcnow(),
         )
 
     def get_project(
         self,
         session: str,
         name: str,
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         return (
             mlrun.api.utils.singletons.project_member.get_project_member().get_project(
                 self.db_session, name
             )
         )
 
     def format_as_leader_project(
-        self, project: mlrun.api.schemas.Project
-    ) -> mlrun.api.schemas.IguazioProject:
-        return mlrun.api.schemas.IguazioProject(data=project.dict())
+        self, project: mlrun.common.schemas.Project
+    ) -> mlrun.common.schemas.IguazioProject:
+        return mlrun.common.schemas.IguazioProject(data=project.dict())
 
     def get_project_owner(
         self,
         session: str,
         name: str,
-    ) -> mlrun.api.schemas.ProjectOwner:
+    ) -> mlrun.common.schemas.ProjectOwner:
         project = self.get_project(session, name)
-        return mlrun.api.schemas.ProjectOwner(
+        return mlrun.common.schemas.ProjectOwner(
             username=project.spec.owner, access_key=self.project_owner_access_key
         )
```

## mlrun/api/utils/singletons/k8s.py

```diff
@@ -7,13 +7,644 @@
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#
-from mlrun.k8s_utils import K8sHelper, get_k8s_helper
+import base64
+import hashlib
+import time
+import typing
+
+from kubernetes import client, config
+from kubernetes.client.rest import ApiException
+
+import mlrun.api.schemas
+import mlrun.config as mlconfig
+import mlrun.errors
+import mlrun.platforms.iguazio
+from mlrun.utils import logger
+
+_k8s = None
+
+
+def get_k8s_helper(namespace=None, silent=True, log=False) -> "K8sHelper":
+    """
+    Get a k8s helper singleton object
+    :param namespace: the namespace to use, if not specified will use the namespace configured in mlrun config
+    :param silent: set to true if you're calling this function from a code that might run from remotely (outside of a
+    k8s cluster)
+    :param log: sometimes we want to avoid logging when executing init_k8s_config
+    """
+    global _k8s
+    if not _k8s:
+        _k8s = K8sHelper(namespace, silent=silent, log=log)
+    return _k8s
+
+
+class SecretTypes:
+    opaque = "Opaque"
+    v3io_fuse = "v3io/fuse"
+
+
+class K8sHelper:
+    def __init__(self, namespace=None, config_file=None, silent=False, log=True):
+        self.namespace = namespace or mlconfig.config.namespace
+        self.config_file = config_file
+        self.running_inside_kubernetes_cluster = False
+        try:
+            self._init_k8s_config(log)
+            self.v1api = client.CoreV1Api()
+            self.crdapi = client.CustomObjectsApi()
+        except Exception as exc:
+            logger.warning(
+                "cannot initialize kubernetes client", exc=mlrun.errors.err_to_str(exc)
+            )
+            if not silent:
+                raise
+
+    def resolve_namespace(self, namespace=None):
+        return namespace or self.namespace
+
+    def _init_k8s_config(self, log=True):
+        try:
+            config.load_incluster_config()
+            self.running_inside_kubernetes_cluster = True
+            if log:
+                logger.info("using in-cluster config.")
+        except Exception:
+            try:
+                config.load_kube_config(self.config_file)
+                if log:
+                    logger.info("using local kubernetes config.")
+            except Exception:
+                raise RuntimeError(
+                    "cannot find local kubernetes config file,"
+                    " place it in ~/.kube/config or specify it in "
+                    "KUBECONFIG env var"
+                )
+
+    def is_running_inside_kubernetes_cluster(self):
+        return self.running_inside_kubernetes_cluster
+
+    def list_pods(self, namespace=None, selector="", states=None):
+        try:
+            resp = self.v1api.list_namespaced_pod(
+                self.resolve_namespace(namespace), label_selector=selector
+            )
+        except ApiException as exc:
+            logger.error(f"failed to list pods: {mlrun.errors.err_to_str(exc)}")
+            raise exc
+
+        items = []
+        for i in resp.items:
+            if not states or i.status.phase in states:
+                items.append(i)
+        return items
+
+    def create_pod(self, pod, max_retry=3, retry_interval=3):
+        if "pod" in dir(pod):
+            pod = pod.pod
+        pod.metadata.namespace = self.resolve_namespace(pod.metadata.namespace)
+
+        retry_count = 0
+        while True:
+            try:
+                resp = self.v1api.create_namespaced_pod(pod.metadata.namespace, pod)
+            except ApiException as exc:
+
+                if retry_count > max_retry:
+                    logger.error(
+                        "failed to create pod after max retries",
+                        retry_count=retry_count,
+                        exc=mlrun.errors.err_to_str(exc),
+                        pod=pod,
+                    )
+                    raise exc
+
+                logger.error(
+                    "failed to create pod", exc=mlrun.errors.err_to_str(exc), pod=pod
+                )
+
+                # known k8s issue, see https://github.com/kubernetes/kubernetes/issues/67761
+                if "gke-resource-quotas" in mlrun.errors.err_to_str(exc):
+                    logger.warning(
+                        "failed to create pod due to gke resource error, "
+                        f"sleeping {retry_interval} seconds and retrying"
+                    )
+                    retry_count += 1
+                    time.sleep(retry_interval)
+                    continue
+
+                raise exc
+            else:
+                logger.info(f"Pod {resp.metadata.name} created")
+                return resp.metadata.name, resp.metadata.namespace
+
+    def delete_pod(self, name, namespace=None):
+        try:
+            api_response = self.v1api.delete_namespaced_pod(
+                name,
+                self.resolve_namespace(namespace),
+                grace_period_seconds=0,
+                propagation_policy="Background",
+            )
+            return api_response
+        except ApiException as exc:
+            # ignore error if pod is already removed
+            if exc.status != 404:
+                logger.error(
+                    f"failed to delete pod: {mlrun.errors.err_to_str(exc)}",
+                    pod_name=name,
+                )
+                raise exc
+
+    def get_pod(self, name, namespace=None, raise_on_not_found=False):
+        try:
+            api_response = self.v1api.read_namespaced_pod(
+                name=name, namespace=self.resolve_namespace(namespace)
+            )
+            return api_response
+        except ApiException as exc:
+            if exc.status != 404:
+                logger.error(f"failed to get pod: {mlrun.errors.err_to_str(exc)}")
+                raise exc
+            else:
+                if raise_on_not_found:
+                    raise mlrun.errors.MLRunNotFoundError(f"Pod not found: {name}")
+            return None
+
+    def get_pod_status(self, name, namespace=None):
+        return self.get_pod(
+            name, namespace, raise_on_not_found=True
+        ).status.phase.lower()
+
+    def delete_crd(self, name, crd_group, crd_version, crd_plural, namespace=None):
+        try:
+            namespace = self.resolve_namespace(namespace)
+            self.crdapi.delete_namespaced_custom_object(
+                crd_group,
+                crd_version,
+                namespace,
+                crd_plural,
+                name,
+            )
+            logger.info(
+                "Deleted crd object",
+                crd_name=name,
+                namespace=namespace,
+            )
+        except ApiException as exc:
+
+            # ignore error if crd is already removed
+            if exc.status != 404:
+                logger.error(
+                    f"failed to delete crd: {mlrun.errors.err_to_str(exc)}",
+                    crd_name=name,
+                    crd_group=crd_group,
+                    crd_version=crd_version,
+                    crd_plural=crd_plural,
+                )
+                raise exc
+
+    def logs(self, name, namespace=None):
+        try:
+            resp = self.v1api.read_namespaced_pod_log(
+                name=name, namespace=self.resolve_namespace(namespace)
+            )
+        except ApiException as exc:
+            logger.error(f"failed to get pod logs: {mlrun.errors.err_to_str(exc)}")
+            raise exc
+
+        return resp
+
+    def get_logger_pods(self, project, uid, run_kind, namespace=""):
+
+        # As this file is imported in mlrun.runtimes, we sadly cannot have this import in the top level imports
+        # as that will create an import loop.
+        # TODO: Fix the import loops already!
+        import mlrun.runtimes
+
+        namespace = self.resolve_namespace(namespace)
+        mpijob_crd_version = mlrun.runtimes.utils.resolve_mpijob_crd_version()
+        mpijob_role_label = (
+            mlrun.runtimes.constants.MPIJobCRDVersions.role_label_by_version(
+                mpijob_crd_version
+            )
+        )
+        extra_selectors = {
+            "spark": "spark-role=driver",
+            "mpijob": f"{mpijob_role_label}=launcher",
+        }
+
+        # TODO: all mlrun labels are sprinkled in a lot of places - they need to all be defined in a central,
+        #  inclusive place.
+        selectors = [
+            "mlrun/class",
+            f"mlrun/project={project}",
+            f"mlrun/uid={uid}",
+        ]
+
+        # In order to make the `list_pods` request return a lighter and quicker result, we narrow the search for
+        # the relevant pods using the proper label selector according to the run kind
+        if run_kind in extra_selectors:
+            selectors.append(extra_selectors[run_kind])
+
+        selector = ",".join(selectors)
+        pods = self.list_pods(namespace, selector=selector)
+        if not pods:
+            logger.error("no pod matches that uid", uid=uid)
+            return
+
+        return {p.metadata.name: p.status.phase for p in pods}
+
+    def get_project_vault_secret_name(
+        self, project, service_account_name, namespace=""
+    ):
+        namespace = self.resolve_namespace(namespace)
+
+        try:
+            service_account = self.v1api.read_namespaced_service_account(
+                service_account_name, namespace
+            )
+        except ApiException as exc:
+            # It's valid for the service account to not exist. Simply return None
+            if exc.status != 404:
+                logger.error(
+                    f"failed to retrieve service accounts: {mlrun.errors.err_to_str(exc)}"
+                )
+                raise exc
+            return None
+
+        if len(service_account.secrets) > 1:
+            raise ValueError(
+                f"Service account {service_account_name} has more than one secret"
+            )
+
+        return service_account.secrets[0].name
+
+    def get_project_secret_name(self, project) -> str:
+        return mlconfig.config.secret_stores.kubernetes.project_secret_name.format(
+            project=project
+        )
+
+    def get_auth_secret_name(self, access_key: str) -> str:
+        hashed_access_key = self._hash_access_key(access_key)
+        return mlconfig.config.secret_stores.kubernetes.auth_secret_name.format(
+            hashed_access_key=hashed_access_key
+        )
+
+    @staticmethod
+    def _hash_access_key(access_key: str):
+        return hashlib.sha224(access_key.encode()).hexdigest()
+
+    def store_project_secrets(self, project, secrets, namespace=""):
+        secret_name = self.get_project_secret_name(project)
+        self.store_secrets(secret_name, secrets, namespace)
+
+    def read_auth_secret(self, secret_name, namespace="", raise_on_not_found=False):
+        namespace = self.resolve_namespace(namespace)
+
+        try:
+            secret_data = self.v1api.read_namespaced_secret(secret_name, namespace).data
+        except ApiException as exc:
+            logger.error(
+                "Failed to read secret",
+                secret_name=secret_name,
+                namespace=namespace,
+                exc=mlrun.errors.err_to_str(exc),
+            )
+            if exc.status != 404:
+                raise exc
+            elif raise_on_not_found:
+                raise mlrun.errors.MLRunNotFoundError(
+                    f"Secret '{secret_name}' was not found in namespace '{namespace}'"
+                ) from exc
+
+            return None, None
+
+        def _get_secret_value(key):
+            if secret_data.get(key):
+                return base64.b64decode(secret_data[key]).decode("utf-8")
+            else:
+                return None
+
+        username = _get_secret_value(
+            mlrun.api.schemas.AuthSecretData.get_field_secret_key("username")
+        )
+        access_key = _get_secret_value(
+            mlrun.api.schemas.AuthSecretData.get_field_secret_key("access_key")
+        )
+
+        return username, access_key
+
+    def store_auth_secret(self, username: str, access_key: str, namespace="") -> str:
+        secret_name = self.get_auth_secret_name(access_key)
+        secret_data = {
+            mlrun.api.schemas.AuthSecretData.get_field_secret_key("username"): username,
+            mlrun.api.schemas.AuthSecretData.get_field_secret_key(
+                "access_key"
+            ): access_key,
+        }
+        self.store_secrets(
+            secret_name,
+            secret_data,
+            namespace,
+            type_=SecretTypes.v3io_fuse,
+            labels={"mlrun/username": username},
+        )
+        return secret_name
+
+    def store_secrets(
+        self,
+        secret_name,
+        secrets,
+        namespace="",
+        type_=SecretTypes.opaque,
+        labels: typing.Optional[dict] = None,
+    ):
+        namespace = self.resolve_namespace(namespace)
+        try:
+            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
+        except ApiException as exc:
+            # If secret doesn't exist, we'll simply create it
+            if exc.status != 404:
+                logger.error(
+                    f"failed to retrieve k8s secret: {mlrun.errors.err_to_str(exc)}"
+                )
+                raise exc
+            k8s_secret = client.V1Secret(type=type_)
+            k8s_secret.metadata = client.V1ObjectMeta(
+                name=secret_name, namespace=namespace, labels=labels
+            )
+            k8s_secret.string_data = secrets
+            self.v1api.create_namespaced_secret(namespace, k8s_secret)
+            return
+
+        secret_data = k8s_secret.data.copy()
+        for key, value in secrets.items():
+            secret_data[key] = base64.b64encode(value.encode()).decode("utf-8")
+
+        k8s_secret.data = secret_data
+        self.v1api.replace_namespaced_secret(secret_name, namespace, k8s_secret)
+
+    def load_secret(self, secret_name, namespace=""):
+        namespace = namespace or self.resolve_namespace(namespace)
+
+        try:
+            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
+        except ApiException:
+            return None
+
+        return k8s_secret.data
+
+    def delete_project_secrets(self, project, secrets, namespace=""):
+        secret_name = self.get_project_secret_name(project)
+        self.delete_secrets(secret_name, secrets, namespace)
+
+    def delete_auth_secret(self, secret_ref: str, namespace=""):
+        self.delete_secrets(secret_ref, {}, namespace)
+
+    def delete_secrets(self, secret_name, secrets, namespace=""):
+        namespace = self.resolve_namespace(namespace)
+
+        try:
+            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
+        except ApiException as exc:
+            # If secret does not exist, return as if the deletion was successfully
+            if exc.status == 404:
+                return
+            else:
+                logger.error(
+                    f"failed to retrieve k8s secret: {mlrun.errors.err_to_str(exc)}"
+                )
+                raise exc
+
+        if not secrets:
+            secret_data = {}
+        else:
+            secret_data = k8s_secret.data.copy()
+            for secret in secrets:
+                secret_data.pop(secret, None)
+
+        if not secret_data:
+            self.v1api.delete_namespaced_secret(secret_name, namespace)
+        else:
+            k8s_secret.data = secret_data
+            self.v1api.replace_namespaced_secret(secret_name, namespace, k8s_secret)
+
+    def _get_project_secrets_raw_data(self, project, namespace=""):
+        secret_name = self.get_project_secret_name(project)
+        return self._get_secret_raw_data(secret_name, namespace)
+
+    def _get_secret_raw_data(self, secret_name, namespace=""):
+        namespace = self.resolve_namespace(namespace)
+
+        try:
+            k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
+        except ApiException:
+            return None
+
+        return k8s_secret.data
+
+    def get_project_secret_keys(self, project, namespace="", filter_internal=False):
+        secrets_data = self._get_project_secrets_raw_data(project, namespace)
+        if not secrets_data:
+            return []
+
+        secret_keys = list(secrets_data.keys())
+        if filter_internal:
+            secret_keys = list(
+                filter(lambda key: not key.startswith("mlrun."), secret_keys)
+            )
+        return secret_keys
+
+    def get_project_secret_data(self, project, secret_keys=None, namespace=""):
+        secrets_data = self._get_project_secrets_raw_data(project, namespace)
+        return self._decode_secret_data(secrets_data, secret_keys)
+
+    def get_secret_data(self, secret_name, namespace=""):
+        secrets_data = self._get_secret_raw_data(secret_name, namespace)
+        return self._decode_secret_data(secrets_data)
+
+    def _decode_secret_data(self, secrets_data, secret_keys=None):
+        results = {}
+        if not secrets_data:
+            return results
+
+        # If not asking for specific keys, return all
+        secret_keys = secret_keys or secrets_data.keys()
+
+        for key in secret_keys:
+            encoded_value = secrets_data.get(key)
+            if encoded_value:
+                results[key] = base64.b64decode(secrets_data[key]).decode("utf-8")
+        return results
+
+
+class BasePod:
+    def __init__(
+        self,
+        task_name="",
+        image=None,
+        command=None,
+        args=None,
+        namespace="",
+        kind="job",
+        project=None,
+        default_pod_spec_attributes=None,
+        resources=None,
+    ):
+        self.namespace = namespace
+        self.name = ""
+        self.task_name = task_name
+        self.image = image
+        self.command = command
+        self.args = args
+        self._volumes = []
+        self._mounts = []
+        self.env = None
+        self.node_selector = None
+        self.project = project or mlrun.mlconf.default_project
+        self._labels = {
+            "mlrun/task-name": task_name,
+            "mlrun/class": kind,
+            "mlrun/project": self.project,
+        }
+        self._annotations = {}
+        self._init_containers = []
+        # will be applied on the pod spec only when calling .pod(), allows to override spec attributes
+        self.default_pod_spec_attributes = default_pod_spec_attributes
+        self.resources = resources
+
+    @property
+    def pod(self):
+        return self._get_spec()
+
+    @property
+    def init_containers(self):
+        return self._init_containers
+
+    @init_containers.setter
+    def init_containers(self, containers):
+        self._init_containers = containers
+
+    def append_init_container(
+        self,
+        image,
+        command=None,
+        args=None,
+        env=None,
+        image_pull_policy="IfNotPresent",
+        name="init",
+    ):
+        if isinstance(env, dict):
+            env = [client.V1EnvVar(name=k, value=v) for k, v in env.items()]
+        self._init_containers.append(
+            client.V1Container(
+                name=name,
+                image=image,
+                env=env,
+                command=command,
+                args=args,
+                image_pull_policy=image_pull_policy,
+            )
+        )
+
+    def add_label(self, key, value):
+        self._labels[key] = str(value)
+
+    def add_annotation(self, key, value):
+        self._annotations[key] = str(value)
+
+    def add_volume(self, volume: client.V1Volume, mount_path, name=None, sub_path=None):
+        self._mounts.append(
+            client.V1VolumeMount(
+                name=name or volume.name, mount_path=mount_path, sub_path=sub_path
+            )
+        )
+        self._volumes.append(volume)
+
+    def mount_empty(self, name="empty", mount_path="/empty"):
+        self.add_volume(
+            client.V1Volume(name=name, empty_dir=client.V1EmptyDirVolumeSource()),
+            mount_path=mount_path,
+        )
+
+    def mount_v3io(
+        self, name="v3io", remote="~/", mount_path="/User", access_key="", user=""
+    ):
+        self.add_volume(
+            mlrun.platforms.iguazio.v3io_to_vol(name, remote, access_key, user),
+            mount_path=mount_path,
+            name=name,
+        )
+
+    def mount_cfgmap(self, name, path="/config"):
+        self.add_volume(
+            client.V1Volume(
+                name=name, config_map=client.V1ConfigMapVolumeSource(name=name)
+            ),
+            mount_path=path,
+        )
+
+    def mount_secret(self, name, path="/secret", items=None, sub_path=None):
+        self.add_volume(
+            client.V1Volume(
+                name=name,
+                secret=client.V1SecretVolumeSource(
+                    secret_name=name,
+                    items=items,
+                ),
+            ),
+            mount_path=path,
+            sub_path=sub_path,
+        )
+
+    def set_node_selector(self, node_selector: typing.Optional[typing.Dict[str, str]]):
+        self.node_selector = node_selector
+
+    def _get_spec(self, template=False):
+
+        pod_obj = client.V1PodTemplate if template else client.V1Pod
+
+        if self.env and isinstance(self.env, dict):
+            env = [client.V1EnvVar(name=k, value=v) for k, v in self.env.items()]
+        else:
+            env = self.env
+        container = client.V1Container(
+            name="base",
+            image=self.image,
+            env=env,
+            command=self.command,
+            args=self.args,
+            volume_mounts=self._mounts,
+            resources=self.resources,
+        )
+
+        pod_spec = client.V1PodSpec(
+            containers=[container],
+            restart_policy="Never",
+            volumes=self._volumes,
+            node_selector=self.node_selector,
+        )
+
+        # if attribute isn't defined use default pod spec attributes
+        for key, val in self.default_pod_spec_attributes.items():
+            if not getattr(pod_spec, key, None):
+                setattr(pod_spec, key, val)
 
+        for init_containers in self._init_containers:
+            init_containers.volume_mounts = self._mounts
+        pod_spec.init_containers = self._init_containers
 
-def get_k8s() -> K8sHelper:
-    return get_k8s_helper(silent=True)
+        pod = pod_obj(
+            metadata=client.V1ObjectMeta(
+                generate_name=f"{self.task_name}-",
+                namespace=self.namespace,
+                labels=self._labels,
+                annotations=self._annotations,
+            ),
+            spec=pod_spec,
+        )
+        return pod
```

## mlrun/artifacts/dataset.py

```diff
@@ -18,14 +18,15 @@
 
 import numpy as np
 import pandas as pd
 from deprecated import deprecated
 from pandas.io.json import build_table_schema
 
 import mlrun
+import mlrun.common.schemas
 import mlrun.utils.helpers
 
 from ..datastore import is_store_uri, store_manager
 from .base import Artifact, ArtifactSpec, LegacyArtifact
 
 default_preview_rows_length = 20
 max_preview_columns = 100
@@ -118,15 +119,15 @@
         self.features = None
         self.partition_keys = None
         self.timestamp_key = None
         self.label_column = None
 
 
 class DatasetArtifact(Artifact):
-    kind = "dataset"
+    kind = mlrun.common.schemas.ArtifactCategories.dataset
     # List of all the supported saving formats of a DataFrame:
     SUPPORTED_FORMATS = ["csv", "parquet", "pq", "tsdb", "kv"]
 
     def __init__(
         self,
         key: str = None,
         df=None,
```

## mlrun/datastore/__init__.py

```diff
@@ -29,15 +29,20 @@
     "StreamSource",
     "KafkaSource",
     "RedisStore",
 ]
 
 import mlrun.datastore.wasbfs
 
-from ..platforms.iguazio import KafkaOutputStream, OutputStream, parse_path
+from ..platforms.iguazio import (
+    HTTPOutputStream,
+    KafkaOutputStream,
+    OutputStream,
+    parse_path,
+)
 from ..utils import logger
 from .base import DataItem
 from .datastore import StoreManager, in_memory_store, uri_to_ipython
 from .s3 import parse_s3_bucket_and_key
 from .sources import (
     BigQuerySource,
     CSVSource,
@@ -65,15 +70,15 @@
 
 
 def get_in_memory_items():
     return in_memory_store._items
 
 
 def get_stream_pusher(stream_path: str, **kwargs):
-    """get a stream pusher object from URL, currently only support v3io stream
+    """get a stream pusher object from URL.
 
     common kwargs::
 
         create:             create a new stream if doesnt exist
         shards:             number of shards
         retention_in_hours: stream retention in hours
 
@@ -83,14 +88,16 @@
     if stream_path.startswith("kafka://") or "kafka_bootstrap_servers" in kwargs:
         topic, bootstrap_servers = parse_kafka_url(
             stream_path, kwargs.get("kafka_bootstrap_servers")
         )
         return KafkaOutputStream(
             topic, bootstrap_servers, kwargs.get("kafka_producer_options")
         )
+    elif stream_path.startswith("http://") or stream_path.startswith("https://"):
+        return HTTPOutputStream(stream_path=stream_path)
     elif "://" not in stream_path:
         return OutputStream(stream_path, **kwargs)
     elif stream_path.startswith("v3io"):
         endpoint, stream_path = parse_path(stream_path)
         return OutputStream(stream_path, endpoint=endpoint, **kwargs)
     elif stream_path.startswith("dummy://"):
         return _DummyStream(**kwargs)
```

## mlrun/datastore/base.py

```diff
@@ -519,15 +519,20 @@
     with open(file_path, "rb") as data:
         http_put(url, data, headers, auth)
 
 
 class HttpStore(DataStore):
     def __init__(self, parent, schema, name, endpoint="", secrets: dict = None):
         super().__init__(parent, name, schema, endpoint, secrets)
+        self._https_auth_token = None
+        self._schema = schema
         self.auth = None
+        self._headers = {}
+        self._enrich_https_token()
+        self._validate_https_token()
 
     def get_filesystem(self, silent=True):
         """return fsspec file system object, if supported"""
         if not self._filesystem:
             self._filesystem = fsspec.filesystem("http")
         return self._filesystem
 
@@ -537,13 +542,26 @@
     def upload(self, key, src_path):
         raise ValueError("unimplemented")
 
     def put(self, key, data, append=False):
         raise ValueError("unimplemented")
 
     def get(self, key, size=None, offset=0):
-        data = http_get(self.url + self._join(key), None, self.auth)
+        data = http_get(self.url + self._join(key), self._headers, self.auth)
         if offset:
             data = data[offset:]
         if size:
             data = data[:size]
         return data
+
+    def _enrich_https_token(self):
+        token = self._get_secret_or_env("HTTPS_AUTH_TOKEN")
+        if token:
+            self._https_auth_token = token
+            self._headers.setdefault("Authorization", f"token {token}")
+
+    def _validate_https_token(self):
+        if self._https_auth_token and self._schema in ["http"]:
+            logger.warn(
+                f"A AUTH TOKEN should not be provided while using {self._schema} "
+                f"schema as it is not secure and is not recommended."
+            )
```

## mlrun/datastore/sources.py

```diff
@@ -58,14 +58,19 @@
     def _get_store(self):
         store, _ = mlrun.store_manager.get_or_create_store(self.path)
         return store
 
     def to_step(self, key_field=None, time_field=None, context=None):
         import storey
 
+        if not self.support_storey:
+            raise mlrun.errors.MLRunRuntimeError(
+                f"{type(self).__name__} does not support storey engine"
+            )
+
         return storey.SyncEmitSource(context=context)
 
     def get_table_object(self):
         """get storey Table object"""
         return None
 
     def to_dataframe(self):
@@ -319,16 +324,21 @@
         )
 
 
 class BigQuerySource(BaseSourceDriver):
     """
     Reads Google BigQuery query results as input source for a flow.
 
+    For authentication, set the GCP_CREDENTIALS project secret to the credentials json string.
+
     example::
 
+         # set the credentials
+         project.set_secrets({"GCP_CREDENTIALS": gcp_credentials_json})
+
          # use sql query
          query_string = "SELECT * FROM `the-psf.pypi.downloads20210328` LIMIT 5000"
          source = BigQuerySource("bq1", query=query_string,
                                  gcp_project="my_project",
                                  materialization_dataset="dataviews")
 
          # read a table
@@ -372,14 +382,23 @@
         gcp_project: str = None,
         spark_options: dict = None,
     ):
         if query and table:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "cannot specify both table and query args"
             )
+        # Otherwise, the client library does not fully respect the limit
+        if (
+            max_results_for_table
+            and chunksize
+            and max_results_for_table % chunksize != 0
+        ):
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "max_results_for_table must be a multiple of chunksize"
+            )
         attrs = {
             "query": query,
             "table": table,
             "max_results": max_results_for_table,
             "chunksize": chunksize,
             "gcp_project": gcp_project,
             "spark_options": spark_options,
@@ -391,15 +410,14 @@
             attributes=attrs,
             key_field=key_field,
             time_field=time_field,
             schedule=schedule,
             start_time=start_time,
             end_time=end_time,
         )
-        self._rows_iterator = None
 
     def _get_credentials_string(self):
         gcp_project = self.attributes.get("gcp_project", None)
         key = "GCP_CREDENTIALS"
         gcp_cred_string = os.getenv(key) or os.getenv(
             SecretsStore.k8s_env_variable_name_for_secret(key)
         )
@@ -434,43 +452,36 @@
 
         query = self.attributes.get("query")
         table = self.attributes.get("table")
         chunksize = self.attributes.get("chunksize")
         if query:
             query_job = bqclient.query(query)
 
-            self._rows_iterator = query_job.result(page_size=chunksize)
-            dtypes = schema_to_dtypes(self._rows_iterator.schema)
-            if chunksize:
-                # passing bqstorage_client greatly improves performance
-                return self._rows_iterator.to_dataframe_iterable(
-                    bqstorage_client=BigQueryReadClient(), dtypes=dtypes
-                )
-            else:
-                return self._rows_iterator.to_dataframe(dtypes=dtypes)
+            rows_iterator = query_job.result(page_size=chunksize)
         elif table:
             table = self.attributes.get("table")
             max_results = self.attributes.get("max_results")
 
-            rows = bqclient.list_rows(
+            rows_iterator = bqclient.list_rows(
                 table, page_size=chunksize, max_results=max_results
             )
-            dtypes = schema_to_dtypes(rows.schema)
-            if chunksize:
-                # passing bqstorage_client greatly improves performance
-                return rows.to_dataframe_iterable(
-                    bqstorage_client=BigQueryReadClient(), dtypes=dtypes
-                )
-            else:
-                return rows.to_dataframe(dtypes=dtypes)
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "table or query args must be specified"
             )
 
+        dtypes = schema_to_dtypes(rows_iterator.schema)
+        if chunksize:
+            # passing bqstorage_client greatly improves performance
+            return rows_iterator.to_dataframe_iterable(
+                bqstorage_client=BigQueryReadClient(), dtypes=dtypes
+            )
+        else:
+            return rows_iterator.to_dataframe(dtypes=dtypes)
+
     def is_iterator(self):
         return bool(self.attributes.get("chunksize"))
 
     def to_spark_df(self, session, named_view=False, time_field=None):
         options = copy(self.attributes.get("spark_options", {}))
         credentials, gcp_project = self._get_credentials_string()
         if credentials:
@@ -723,14 +734,17 @@
             "This source type is not supported with ingestion service yet"
         )
 
 
 class HttpSource(OnlineSource):
     kind = "http"
 
+    def __init__(self, path: str = None):
+        super().__init__(path=path)
+
     def add_nuclio_trigger(self, function):
         trigger_args = self.attributes.get("trigger_args")
         if trigger_args:
             function.with_http(**trigger_args)
         return function
```

## mlrun/datastore/spark_udf.py

```diff
@@ -22,19 +22,19 @@
     str_concatted = "".join(list_to_hash)
     sha1 = hashlib.sha1()
     sha1.update(str_concatted.encode("utf8"))
     return sha1.hexdigest()
 
 
 def _redis_stringify_key(key_list):
-    try:
+    suffix = "}:static"
+    if isinstance(key_list, list):
         if len(key_list) >= 2:
-            return str(key_list[0]) + "." + _hash_list(key_list[1:]) + "}:static"
+            return str(key_list[0]) + "." + _hash_list(key_list[1:]) + suffix
         if len(key_list) == 2:
-            return str(key_list[0]) + "." + str(key_list[1]) + "}:static"
-        return str(key_list[0]) + "}:static"
-    except TypeError:
-        return str(key_list) + "}:static"
+            return str(key_list[0]) + "." + str(key_list[1]) + suffix
+        return str(key_list[0]) + suffix
+    return str(key_list) + suffix
 
 
 hash_and_concat_v3io_udf = udf(_hash_list, StringType())
 hash_and_concat_redis_udf = udf(_redis_stringify_key, StringType())
```

## mlrun/datastore/store_resources.py

```diff
@@ -97,16 +97,16 @@
                 flush_interval_secs=mlrun.mlconf.feature_store.flush_interval,
             )
             return self._tabels[uri]
 
         if is_store_uri(uri):
             resource = get_store_resource(uri)
             if resource.kind in [
-                mlrun.api.schemas.ObjectKind.feature_set.value,
-                mlrun.api.schemas.ObjectKind.feature_vector.value,
+                mlrun.common.schemas.ObjectKind.feature_set.value,
+                mlrun.common.schemas.ObjectKind.feature_vector.value,
             ]:
                 target = get_online_target(resource)
                 if not target:
                     raise mlrun.errors.MLRunInvalidArgumentError(
                         f"resource {uri} does not have an online data target"
                     )
                 self._tabels[uri] = target.get_table_object()
```

## mlrun/datastore/targets.py

```diff
@@ -1759,20 +1759,20 @@
 def _get_target_path(driver, resource, run_id_mode=False):
     """return the default target path given the resource and target kind"""
     kind = driver.kind
     suffix = driver.suffix
     if not suffix:
         if (
             kind == ParquetTarget.kind
-            and resource.kind == mlrun.api.schemas.ObjectKind.feature_vector
+            and resource.kind == mlrun.common.schemas.ObjectKind.feature_vector
         ):
             suffix = ".parquet"
     kind_prefix = (
         "sets"
-        if resource.kind == mlrun.api.schemas.ObjectKind.feature_set
+        if resource.kind == mlrun.common.schemas.ObjectKind.feature_set
         else "vectors"
     )
     name = resource.metadata.name
     project = resource.metadata.project or mlrun.mlconf.default_project
     data_prefix = get_default_prefix_for_target(kind).format(
         project=project,
         kind=kind,
```

## mlrun/datastore/utils.py

```diff
@@ -8,15 +8,16 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-from urllib.parse import urlparse
+import typing
+from urllib.parse import parse_qs, urlparse
 
 
 def store_path_to_spark(path):
     if path.startswith("redis://") or path.startswith("rediss://"):
         url = urlparse(path)
         if url.path:
             path = url.path
@@ -32,15 +33,36 @@
                 f"'s3:///' is not supported, try using 's3://' instead.\nE.g: '{valid_path}'"
             )
         else:
             path = "s3a:" + path[len("s3:") :]
     return path
 
 
-def parse_kafka_url(url, bootstrap_servers=None):
+def parse_kafka_url(
+    url: str, bootstrap_servers: typing.List = None
+) -> typing.Tuple[str, typing.List]:
+    """Generating Kafka topic and adjusting a list of bootstrap servers.
+
+    :param url:               URL path to parse using urllib.parse.urlparse.
+    :param bootstrap_servers: List of bootstrap servers for the kafka brokers.
+
+    :return: A tuple of:
+         [0] = Kafka topic value
+         [1] = List of bootstrap servers
+    """
     bootstrap_servers = bootstrap_servers or []
+
+    # Parse the provided URL into six components according to the general structure of a URL
     url = urlparse(url)
+
+    # Add the network location to the bootstrap servers list
     if url.netloc:
         bootstrap_servers = [url.netloc] + bootstrap_servers
-    topic = url.path
-    topic = topic.lstrip("/")
+
+    # Get the topic value from the parsed url
+    query_dict = parse_qs(url.query)
+    if "topic" in query_dict:
+        topic = query_dict["topic"][0]
+    else:
+        topic = url.path
+        topic = topic.lstrip("/")
     return topic, bootstrap_servers
```

## mlrun/db/base.py

```diff
@@ -13,16 +13,16 @@
 # limitations under the License.
 
 import datetime
 import warnings
 from abc import ABC, abstractmethod
 from typing import List, Optional, Union
 
+import mlrun.common.schemas
 import mlrun.model_monitoring.model_endpoint
-from mlrun.api import schemas
 
 
 class RunDBError(Exception):
     pass
 
 
 class RunDBInterface(ABC):
@@ -67,18 +67,20 @@
         sort=True,
         last=0,
         iter=False,
         start_time_from: datetime.datetime = None,
         start_time_to: datetime.datetime = None,
         last_update_time_from: datetime.datetime = None,
         last_update_time_to: datetime.datetime = None,
-        partition_by: Union[schemas.RunPartitionByField, str] = None,
+        partition_by: Union[mlrun.common.schemas.RunPartitionByField, str] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
         with_notifications: bool = False,
     ):
         pass
 
     @abstractmethod
     def del_run(self, uid, project="", iter=0):
@@ -104,15 +106,15 @@
         tag="",
         labels=None,
         since=None,
         until=None,
         iter: int = None,
         best_iteration: bool = False,
         kind: str = None,
-        category: Union[str, schemas.ArtifactCategories] = None,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         pass
 
     @abstractmethod
     def del_artifact(self, key, tag="", project=""):
         pass
 
@@ -144,25 +146,25 @@
         pass
 
     @abstractmethod
     def tag_objects(
         self,
         project: str,
         tag_name: str,
-        tag_objects: schemas.TagObjects,
+        tag_objects: mlrun.common.schemas.TagObjects,
         replace: bool = False,
     ):
         pass
 
     @abstractmethod
     def delete_objects_tag(
         self,
         project: str,
         tag_name: str,
-        tag_objects: schemas.TagObjects,
+        tag_objects: mlrun.common.schemas.TagObjects,
     ):
         pass
 
     @abstractmethod
     def tag_artifacts(
         self,
         artifacts,
@@ -180,19 +182,19 @@
         tag_name: str,
     ):
         pass
 
     @staticmethod
     def _resolve_artifacts_to_tag_objects(
         artifacts,
-    ) -> schemas.TagObjects:
+    ) -> mlrun.common.schemas.TagObjects:
         """
         :param artifacts: Can be a list of :py:class:`~mlrun.artifacts.Artifact` objects or
             dictionaries, or a single object.
-        :return: :py:class:`~mlrun.api.schemas.TagObjects`
+        :return: :py:class:`~mlrun.common.schemas.TagObjects`
         """
         # to avoid circular imports we import here
         import mlrun.artifacts.base
 
         if not isinstance(artifacts, list):
             artifacts = [artifacts]
 
@@ -200,81 +202,88 @@
         for artifact in artifacts:
             artifact_obj = (
                 artifact.to_dict()
                 if isinstance(artifact, mlrun.artifacts.base.Artifact)
                 else artifact
             )
             artifact_identifiers.append(
-                schemas.ArtifactIdentifier(
+                mlrun.common.schemas.ArtifactIdentifier(
                     key=mlrun.utils.get_in_artifact(artifact_obj, "key"),
                     # we are passing tree as uid when storing an artifact, so if uid is not defined,
                     # pass the tree as uid
                     uid=mlrun.utils.get_in_artifact(artifact_obj, "uid")
                     or mlrun.utils.get_in_artifact(artifact_obj, "tree"),
                     kind=mlrun.utils.get_in_artifact(artifact_obj, "kind"),
                     iter=mlrun.utils.get_in_artifact(artifact_obj, "iter"),
                 )
             )
-        return schemas.TagObjects(kind="artifact", identifiers=artifact_identifiers)
+        return mlrun.common.schemas.TagObjects(
+            kind="artifact", identifiers=artifact_identifiers
+        )
 
     @abstractmethod
     def delete_project(
         self,
         name: str,
-        deletion_strategy: schemas.DeletionStrategy = schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         pass
 
     @abstractmethod
     def store_project(
         self,
         name: str,
-        project: schemas.Project,
-    ) -> schemas.Project:
+        project: mlrun.common.schemas.Project,
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abstractmethod
     def patch_project(
         self,
         name: str,
         project: dict,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
-    ) -> schemas.Project:
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abstractmethod
     def create_project(
         self,
-        project: schemas.Project,
-    ) -> schemas.Project:
+        project: mlrun.common.schemas.Project,
+    ) -> mlrun.common.schemas.Project:
         pass
 
     @abstractmethod
     def list_projects(
         self,
         owner: str = None,
-        format_: schemas.ProjectsFormat = schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: List[str] = None,
-        state: schemas.ProjectState = None,
-    ) -> schemas.ProjectsOutput:
+        state: mlrun.common.schemas.ProjectState = None,
+    ) -> mlrun.common.schemas.ProjectsOutput:
         pass
 
     @abstractmethod
-    def get_project(self, name: str) -> schemas.Project:
+    def get_project(self, name: str) -> mlrun.common.schemas.Project:
         pass
 
     @abstractmethod
     def list_artifact_tags(
-        self, project=None, category: Union[str, schemas.ArtifactCategories] = None
+        self,
+        project=None,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         pass
 
     @abstractmethod
     def create_feature_set(
-        self, feature_set: Union[dict, schemas.FeatureSet], project="", versioned=True
+        self,
+        feature_set: Union[dict, mlrun.common.schemas.FeatureSet],
+        project="",
+        versioned=True,
     ) -> dict:
         pass
 
     @abstractmethod
     def get_feature_set(
         self, name: str, project: str = "", tag: str = None, uid: str = None
     ) -> dict:
@@ -284,48 +293,52 @@
     def list_features(
         self,
         project: str,
         name: str = None,
         tag: str = None,
         entities: List[str] = None,
         labels: List[str] = None,
-    ) -> schemas.FeaturesOutput:
+    ) -> mlrun.common.schemas.FeaturesOutput:
         pass
 
     @abstractmethod
     def list_entities(
         self,
         project: str,
         name: str = None,
         tag: str = None,
         labels: List[str] = None,
-    ) -> schemas.EntitiesOutput:
+    ) -> mlrun.common.schemas.EntitiesOutput:
         pass
 
     @abstractmethod
     def list_feature_sets(
         self,
         project: str = "",
         name: str = None,
         tag: str = None,
         state: str = None,
         entities: List[str] = None,
         features: List[str] = None,
         labels: List[str] = None,
-        partition_by: Union[schemas.FeatureStorePartitionByField, str] = None,
+        partition_by: Union[
+            mlrun.common.schemas.FeatureStorePartitionByField, str
+        ] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
     ) -> List[dict]:
         pass
 
     @abstractmethod
     def store_feature_set(
         self,
-        feature_set: Union[dict, schemas.FeatureSet],
+        feature_set: Union[dict, mlrun.common.schemas.FeatureSet],
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
         pass
@@ -334,26 +347,28 @@
     def patch_feature_set(
         self,
         name,
         feature_set: dict,
         project="",
         tag=None,
         uid=None,
-        patch_mode: Union[str, schemas.PatchMode] = schemas.PatchMode.replace,
+        patch_mode: Union[
+            str, mlrun.common.schemas.PatchMode
+        ] = mlrun.common.schemas.PatchMode.replace,
     ):
         pass
 
     @abstractmethod
     def delete_feature_set(self, name, project="", tag=None, uid=None):
         pass
 
     @abstractmethod
     def create_feature_vector(
         self,
-        feature_vector: Union[dict, schemas.FeatureVector],
+        feature_vector: Union[dict, mlrun.common.schemas.FeatureVector],
         project="",
         versioned=True,
     ) -> dict:
         pass
 
     @abstractmethod
     def get_feature_vector(
@@ -365,25 +380,29 @@
     def list_feature_vectors(
         self,
         project: str = "",
         name: str = None,
         tag: str = None,
         state: str = None,
         labels: List[str] = None,
-        partition_by: Union[schemas.FeatureStorePartitionByField, str] = None,
+        partition_by: Union[
+            mlrun.common.schemas.FeatureStorePartitionByField, str
+        ] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
     ) -> List[dict]:
         pass
 
     @abstractmethod
     def store_feature_vector(
         self,
-        feature_vector: Union[dict, schemas.FeatureVector],
+        feature_vector: Union[dict, mlrun.common.schemas.FeatureVector],
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
         pass
@@ -392,15 +411,17 @@
     def patch_feature_vector(
         self,
         name,
         feature_vector_update: dict,
         project="",
         tag=None,
         uid=None,
-        patch_mode: Union[str, schemas.PatchMode] = schemas.PatchMode.replace,
+        patch_mode: Union[
+            str, mlrun.common.schemas.PatchMode
+        ] = mlrun.common.schemas.PatchMode.replace,
     ):
         pass
 
     @abstractmethod
     def delete_feature_vector(self, name, project="", tag=None, uid=None):
         pass
 
@@ -409,72 +430,72 @@
         self,
         project: str,
         namespace: str = None,
         sort_by: str = "",
         page_token: str = "",
         filter_: str = "",
         format_: Union[
-            str, schemas.PipelinesFormat
-        ] = schemas.PipelinesFormat.metadata_only,
+            str, mlrun.common.schemas.PipelinesFormat
+        ] = mlrun.common.schemas.PipelinesFormat.metadata_only,
         page_size: int = None,
-    ) -> schemas.PipelinesOutput:
+    ) -> mlrun.common.schemas.PipelinesOutput:
         pass
 
     @abstractmethod
     def create_project_secrets(
         self,
         project: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: dict = None,
     ):
         pass
 
     @abstractmethod
     def list_project_secrets(
         self,
         project: str,
         token: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: List[str] = None,
-    ) -> schemas.SecretsData:
+    ) -> mlrun.common.schemas.SecretsData:
         pass
 
     @abstractmethod
     def list_project_secret_keys(
         self,
         project: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         token: str = None,
-    ) -> schemas.SecretKeysData:
+    ) -> mlrun.common.schemas.SecretKeysData:
         pass
 
     @abstractmethod
     def delete_project_secrets(
         self,
         project: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: List[str] = None,
     ):
         pass
 
     @abstractmethod
     def create_user_secrets(
         self,
         user: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.vault,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.vault,
         secrets: dict = None,
     ):
         pass
 
     @abstractmethod
     def create_model_endpoint(
         self,
@@ -525,56 +546,59 @@
         project: str,
         endpoint_id: str,
         attributes: dict,
     ):
         pass
 
     @abstractmethod
-    def create_marketplace_source(
-        self, source: Union[dict, schemas.IndexedMarketplaceSource]
+    def create_hub_source(
+        self, source: Union[dict, mlrun.common.schemas.IndexedHubSource]
     ):
         pass
 
     @abstractmethod
-    def store_marketplace_source(
-        self, source_name: str, source: Union[dict, schemas.IndexedMarketplaceSource]
+    def store_hub_source(
+        self,
+        source_name: str,
+        source: Union[dict, mlrun.common.schemas.IndexedHubSource],
     ):
         pass
 
     @abstractmethod
-    def list_marketplace_sources(self):
+    def list_hub_sources(self):
         pass
 
     @abstractmethod
-    def get_marketplace_source(self, source_name: str):
+    def get_hub_source(self, source_name: str):
         pass
 
     @abstractmethod
-    def delete_marketplace_source(self, source_name: str):
+    def delete_hub_source(self, source_name: str):
         pass
 
     @abstractmethod
-    def get_marketplace_catalog(
+    def get_hub_catalog(
         self,
         source_name: str,
         version: str = None,
         tag: str = None,
         force_refresh: bool = False,
     ):
         pass
 
     @abstractmethod
-    def get_marketplace_item(
+    def get_hub_item(
         self,
         source_name: str,
         item_name: str,
         version: str = None,
         tag: str = "latest",
         force_refresh: bool = False,
     ):
         pass
 
     @abstractmethod
     def verify_authorization(
-        self, authorization_verification_input: schemas.AuthorizationVerificationInput
+        self,
+        authorization_verification_input: mlrun.common.schemas.AuthorizationVerificationInput,
     ):
         pass
```

## mlrun/db/httpdb.py

```diff
@@ -46,8026 +46,8124 @@
 000002d0: 656d 6f76 650a 6672 6f6d 2074 7970 696e  emove.from typin
 000002e0: 6720 696d 706f 7274 2044 6963 742c 204c  g import Dict, L
 000002f0: 6973 742c 204f 7074 696f 6e61 6c2c 2055  ist, Optional, U
 00000300: 6e69 6f6e 0a0a 696d 706f 7274 206b 6670  nion..import kfp
 00000310: 0a69 6d70 6f72 7420 7265 7175 6573 7473  .import requests
 00000320: 0a69 6d70 6f72 7420 7365 6d76 6572 0a0a  .import semver..
 00000330: 696d 706f 7274 206d 6c72 756e 0a69 6d70  import mlrun.imp
-00000340: 6f72 7420 6d6c 7275 6e2e 6d6f 6465 6c5f  ort mlrun.model_
-00000350: 6d6f 6e69 746f 7269 6e67 2e6d 6f64 656c  monitoring.model
-00000360: 5f65 6e64 706f 696e 740a 696d 706f 7274  _endpoint.import
-00000370: 206d 6c72 756e 2e70 726f 6a65 6374 730a   mlrun.projects.
-00000380: 6672 6f6d 206d 6c72 756e 2e61 7069 2069  from mlrun.api i
-00000390: 6d70 6f72 7420 7363 6865 6d61 730a 6672  mport schemas.fr
-000003a0: 6f6d 206d 6c72 756e 2e65 7272 6f72 7320  om mlrun.errors 
-000003b0: 696d 706f 7274 204d 4c52 756e 496e 7661  import MLRunInva
-000003c0: 6c69 6441 7267 756d 656e 7445 7272 6f72  lidArgumentError
-000003d0: 2c20 6572 725f 746f 5f73 7472 0a0a 6672  , err_to_str..fr
-000003e0: 6f6d 202e 2e61 7274 6966 6163 7473 2069  om ..artifacts i
-000003f0: 6d70 6f72 7420 4172 7469 6661 6374 0a66  mport Artifact.f
-00000400: 726f 6d20 2e2e 636f 6e66 6967 2069 6d70  rom ..config imp
-00000410: 6f72 7420 636f 6e66 6967 0a66 726f 6d20  ort config.from 
-00000420: 2e2e 6665 6174 7572 655f 7374 6f72 6520  ..feature_store 
-00000430: 696d 706f 7274 2046 6561 7475 7265 5365  import FeatureSe
-00000440: 742c 2046 6561 7475 7265 5665 6374 6f72  t, FeatureVector
-00000450: 0a66 726f 6d20 2e2e 6c69 7374 7320 696d  .from ..lists im
-00000460: 706f 7274 2041 7274 6966 6163 744c 6973  port ArtifactLis
-00000470: 742c 2052 756e 4c69 7374 0a66 726f 6d20  t, RunList.from 
-00000480: 2e2e 7275 6e74 696d 6573 2069 6d70 6f72  ..runtimes impor
-00000490: 7420 4261 7365 5275 6e74 696d 650a 6672  t BaseRuntime.fr
-000004a0: 6f6d 202e 2e75 7469 6c73 2069 6d70 6f72  om ..utils impor
-000004b0: 7420 280a 2020 2020 6461 7465 7469 6d65  t (.    datetime
-000004c0: 5f74 6f5f 6973 6f2c 0a20 2020 2064 6963  _to_iso,.    dic
-000004d0: 745f 746f 5f6a 736f 6e2c 0a20 2020 206c  t_to_json,.    l
-000004e0: 6f67 6765 722c 0a20 2020 206e 6577 5f70  ogger,.    new_p
-000004f0: 6970 655f 6d65 7461 6461 7461 2c0a 2020  ipe_metadata,.  
-00000500: 2020 6e6f 726d 616c 697a 655f 6e61 6d65    normalize_name
-00000510: 2c0a 2020 2020 7665 7273 696f 6e2c 0a29  ,.    version,.)
-00000520: 0a66 726f 6d20 2e62 6173 6520 696d 706f  .from .base impo
-00000530: 7274 2052 756e 4442 4572 726f 722c 2052  rt RunDBError, R
-00000540: 756e 4442 496e 7465 7266 6163 650a 0a5f  unDBInterface.._
-00000550: 6172 7469 6661 6374 5f6b 6579 7320 3d20  artifact_keys = 
-00000560: 5b0a 2020 2020 2266 6f72 6d61 7422 2c0a  [.    "format",.
-00000570: 2020 2020 2269 6e6c 696e 6522 2c0a 2020      "inline",.  
-00000580: 2020 226b 6579 222c 0a20 2020 2022 7372    "key",.    "sr
-00000590: 635f 7061 7468 222c 0a20 2020 2022 7461  c_path",.    "ta
-000005a0: 7267 6574 5f70 6174 6822 2c0a 2020 2020  rget_path",.    
-000005b0: 2276 6965 7765 7222 2c0a 5d0a 0a0a 6465  "viewer",.]...de
-000005c0: 6620 626f 6f6c 3273 7472 2876 616c 293a  f bool2str(val):
-000005d0: 0a20 2020 2072 6574 7572 6e20 2279 6573  .    return "yes
-000005e0: 2220 6966 2076 616c 2065 6c73 6520 226e  " if val else "n
-000005f0: 6f22 0a0a 0a63 6c61 7373 2048 5454 5052  o"...class HTTPR
-00000600: 756e 4442 2852 756e 4442 496e 7465 7266  unDB(RunDBInterf
-00000610: 6163 6529 3a0a 2020 2020 2222 2249 6e74  ace):.    """Int
-00000620: 6572 6661 6365 2066 6f72 2061 6363 6573  erface for acces
-00000630: 7369 6e67 2061 6e64 206d 616e 6970 756c  sing and manipul
-00000640: 6174 696e 6720 7468 6520 3a70 793a 6d6f  ating the :py:mo
-00000650: 643a 606d 6c72 756e 6020 7065 7273 6973  d:`mlrun` persis
-00000660: 7465 6e74 2073 746f 7265 2c20 6d61 696e  tent store, main
-00000670: 7461 696e 696e 6720 7468 6520 6675 6c6c  taining the full
-00000680: 2073 7461 7465 0a20 2020 2061 6e64 2063   state.    and c
-00000690: 6174 616c 6f67 206f 6620 6f62 6a65 6374  atalog of object
-000006a0: 7320 7468 6174 204d 4c52 756e 2075 7365  s that MLRun use
-000006b0: 732e 2054 6865 203a 7079 3a63 6c61 7373  s. The :py:class
-000006c0: 3a60 4854 5450 5275 6e44 4260 2063 6c61  :`HTTPRunDB` cla
-000006d0: 7373 2073 6572 7665 7320 6173 2061 2063  ss serves as a c
-000006e0: 6c69 656e 742d 7369 6465 2070 726f 7879  lient-side proxy
-000006f0: 2074 6f20 7468 6520 4d4c 5275 6e0a 2020   to the MLRun.  
-00000700: 2020 4150 4920 7365 7276 6963 6520 7768    API service wh
-00000710: 6963 6820 6d61 696e 7461 696e 7320 7468  ich maintains th
-00000720: 6520 6163 7475 616c 2064 6174 612d 7374  e actual data-st
-00000730: 6f72 652c 2061 6363 6573 7365 7320 7468  ore, accesses th
-00000740: 6520 7365 7276 6572 2074 6872 6f75 6768  e server through
-00000750: 2052 4553 5420 4150 4973 2e0a 0a20 2020   REST APIs...   
-00000760: 2054 6865 2063 6c61 7373 2070 726f 7669   The class provi
-00000770: 6465 7320 6675 6e63 7469 6f6e 7320 666f  des functions fo
-00000780: 7220 6163 6365 7373 696e 6720 616e 6420  r accessing and 
-00000790: 6d6f 6469 6679 696e 6720 7468 6520 7661  modifying the va
-000007a0: 7269 6f75 7320 6f62 6a65 6374 7320 7468  rious objects th
-000007b0: 6174 2061 7265 2075 7365 6420 6279 204d  at are used by M
-000007c0: 4c52 756e 2069 6e20 6974 730a 2020 2020  LRun in its.    
-000007d0: 6f70 6572 6174 696f 6e2e 2054 6865 2066  operation. The f
-000007e0: 756e 6374 696f 6e73 2070 726f 7669 6465  unctions provide
-000007f0: 6420 666f 6c6c 6f77 2073 6f6d 6520 7374  d follow some st
-00000800: 616e 6461 7264 2067 7569 6465 6c69 6e65  andard guideline
-00000810: 732c 2077 6869 6368 2061 7265 3a0a 0a20  s, which are:.. 
-00000820: 2020 202d 2045 7665 7279 206f 626a 6563     - Every objec
-00000830: 7420 696e 204d 4c52 756e 2065 7869 7374  t in MLRun exist
-00000840: 7320 696e 2074 6865 2063 6f6e 7465 7874  s in the context
-00000850: 206f 6620 6120 7072 6f6a 6563 7420 2865   of a project (e
-00000860: 7863 6570 7420 7072 6f6a 6563 7473 2074  xcept projects t
-00000870: 6865 6d73 656c 7665 7329 2e20 5768 656e  hemselves). When
-00000880: 2072 6566 6572 656e 6369 6e67 2061 6e20   referencing an 
-00000890: 6f62 6a65 6374 0a20 2020 2020 2074 6872  object.      thr
-000008a0: 6f75 6768 2061 6e79 2041 5049 2c20 6120  ough any API, a 
-000008b0: 7072 6f6a 6563 7420 6e61 6d65 206d 7573  project name mus
-000008c0: 7420 6265 2070 726f 7669 6465 642e 2054  t be provided. T
-000008d0: 6865 2064 6566 6175 6c74 2066 6f72 206d  he default for m
-000008e0: 6f73 7420 4150 4973 2069 7320 666f 7220  ost APIs is for 
-000008f0: 616e 2065 6d70 7479 2070 726f 6a65 6374  an empty project
-00000900: 206e 616d 652c 2077 6869 6368 0a20 2020   name, which.   
-00000910: 2020 2077 696c 6c20 6265 2072 6570 6c61     will be repla
-00000920: 6365 6420 6279 2074 6865 206e 616d 6520  ced by the name 
-00000930: 6f66 2074 6865 2064 6566 6175 6c74 2070  of the default p
-00000940: 726f 6a65 6374 2028 7573 7561 6c6c 7920  roject (usually 
-00000950: 6060 6465 6661 756c 7460 6029 2e20 5468  ``default``). Th
-00000960: 6572 6566 6f72 652c 2069 6620 7065 7266  erefore, if perf
-00000970: 6f72 6d69 6e67 2061 6e20 4150 4920 746f  orming an API to
-00000980: 0a20 2020 2020 206c 6973 7420 6675 6e63  .      list func
-00000990: 7469 6f6e 732c 2066 6f72 2065 7861 6d70  tions, for examp
-000009a0: 6c65 2c20 616e 6420 6e6f 7420 7072 6f76  le, and not prov
-000009b0: 6964 696e 6720 6120 7072 6f6a 6563 7420  iding a project 
-000009c0: 6e61 6d65 202d 2074 6865 2072 6573 756c  name - the resul
-000009d0: 7420 7769 6c6c 206e 6f74 2062 6520 6675  t will not be fu
-000009e0: 6e63 7469 6f6e 7320 6672 6f6d 2061 6c6c  nctions from all
-000009f0: 0a20 2020 2020 2070 726f 6a65 6374 7320  .      projects 
-00000a00: 6275 7420 7261 7468 6572 2066 726f 6d20  but rather from 
-00000a10: 7468 6520 6060 6465 6661 756c 7460 6020  the ``default`` 
-00000a20: 7072 6f6a 6563 742e 0a20 2020 202d 204d  project..    - M
-00000a30: 616e 7920 6f62 6a65 6374 7320 6361 6e20  any objects can 
-00000a40: 6265 2061 7373 6967 6e65 6420 6c61 6265  be assigned labe
-00000a50: 6c73 2c20 616e 6420 6c69 7374 6564 2f71  ls, and listed/q
-00000a60: 7565 7269 6564 2062 7920 6c61 6265 6c2e  ueried by label.
-00000a70: 2054 6865 206c 6162 656c 2070 6172 616d   The label param
-00000a80: 6574 6572 2066 6f72 2071 7565 7279 2041  eter for query A
-00000a90: 5049 7320 616c 6c6f 7773 2066 6f72 0a20  PIs allows for. 
-00000aa0: 2020 2020 206c 6973 7469 6e67 206f 626a       listing obj
-00000ab0: 6563 7473 2074 6861 743a 0a0a 2020 2020  ects that:..    
-00000ac0: 2020 2d20 4861 7665 2061 2073 7065 6369    - Have a speci
-00000ad0: 6669 6320 6c61 6265 6c2c 2062 7920 6173  fic label, by as
-00000ae0: 6b69 6e67 2066 6f72 2060 606c 6162 656c  king for ``label
-00000af0: 3d22 3c6c 6162 656c 5f6e 616d 653e 2260  ="<label_name>"`
-00000b00: 602e 2049 6e20 7468 6973 2063 6173 6520  `. In this case 
-00000b10: 7468 6520 6163 7475 616c 2076 616c 7565  the actual value
-00000b20: 206f 6620 7468 6520 6c61 6265 6c0a 2020   of the label.  
-00000b30: 2020 2020 2020 646f 6573 6e27 7420 6d61        doesn't ma
-00000b40: 7474 6572 2061 6e64 2065 7665 7279 206f  tter and every o
-00000b50: 626a 6563 7420 7769 7468 2074 6861 7420  bject with that 
-00000b60: 6c61 6265 6c20 7769 6c6c 2062 6520 7265  label will be re
-00000b70: 7475 726e 6564 0a20 2020 2020 202d 2048  turned.      - H
-00000b80: 6176 6520 6120 6c61 6265 6c20 7769 7468  ave a label with
-00000b90: 2061 2073 7065 6369 6669 6320 7661 6c75   a specific valu
-00000ba0: 652e 2054 6869 7320 6973 2064 6f6e 6520  e. This is done 
-00000bb0: 6279 2073 7065 6369 6679 696e 6720 6060  by specifying ``
-00000bc0: 6c61 6265 6c3d 223c 6c61 6265 6c5f 6e61  label="<label_na
-00000bd0: 6d65 3e3d 3c6c 6162 656c 5f76 616c 7565  me>=<label_value
-00000be0: 3e22 6060 2e20 496e 2074 6869 730a 2020  >"``. In this.  
-00000bf0: 2020 2020 2020 6361 7365 206f 6e6c 7920        case only 
-00000c00: 6f62 6a65 6374 7320 7768 6f73 6520 6c61  objects whose la
-00000c10: 6265 6c20 6d61 7463 6865 7320 7468 6520  bel matches the 
-00000c20: 7661 6c75 6520 7769 6c6c 2062 6520 7265  value will be re
-00000c30: 7475 726e 6564 0a0a 2020 2020 2d20 4d6f  turned..    - Mo
-00000c40: 7374 206f 626a 6563 7473 2068 6176 6520  st objects have 
-00000c50: 6120 6060 6372 6561 7465 6060 206d 6574  a ``create`` met
-00000c60: 686f 6420 6173 2077 656c 6c20 6173 2061  hod as well as a
-00000c70: 2060 6073 746f 7265 6060 206d 6574 686f   ``store`` metho
-00000c80: 642e 2043 7265 6174 6520 6361 6e20 6f6e  d. Create can on
-00000c90: 6c79 2062 6520 6361 6c6c 6564 2077 6865  ly be called whe
-00000ca0: 6e20 7375 6368 2061 6e0a 2020 2020 2020  n such an.      
-00000cb0: 646f 6573 206e 6f74 2065 7869 7374 2079  does not exist y
-00000cc0: 6574 2c20 7768 696c 6520 7374 6f72 6520  et, while store 
-00000cd0: 616c 6c6f 7773 2066 6f72 2065 6974 6865  allows for eithe
-00000ce0: 7220 6372 6561 7469 6e67 2061 206e 6577  r creating a new
-00000cf0: 206f 626a 6563 7420 6f72 206f 7665 7277   object or overw
-00000d00: 7269 7469 6e67 2061 6e20 6578 6973 7469  riting an existi
-00000d10: 6e67 206f 626a 6563 742e 0a20 2020 202d  ng object..    -
-00000d20: 2053 6f6d 6520 6f62 6a65 6374 7320 6861   Some objects ha
-00000d30: 7665 2061 2060 6076 6572 7369 6f6e 6564  ve a ``versioned
-00000d40: 6060 206f 7074 696f 6e2c 2069 6e20 7768  `` option, in wh
-00000d50: 6963 6820 6361 7365 206f 7665 7277 7269  ich case overwri
-00000d60: 7469 6e67 2074 6865 2073 616d 6520 6f62  ting the same ob
-00000d70: 6a65 6374 2077 6974 6820 6120 6469 6666  ject with a diff
-00000d80: 6572 656e 7420 7665 7273 696f 6e20 6f66  erent version of
-00000d90: 0a20 2020 2020 2069 7420 646f 6573 206e  .      it does n
-00000da0: 6f74 2064 656c 6574 6520 7468 6520 7072  ot delete the pr
-00000db0: 6576 696f 7573 2076 6572 7369 6f6e 2c20  evious version, 
-00000dc0: 6275 7420 7261 7468 6572 2063 7265 6174  but rather creat
-00000dd0: 6573 2061 206e 6577 2076 6572 7369 6f6e  es a new version
-00000de0: 206f 6620 7468 6520 6f62 6a65 6374 2061   of the object a
-00000df0: 6e64 206b 6565 7073 2062 6f74 6820 7665  nd keeps both ve
-00000e00: 7273 696f 6e73 2e0a 2020 2020 2020 5665  rsions..      Ve
-00000e10: 7273 696f 6e65 6420 6f62 6a65 6374 7320  rsioned objects 
-00000e20: 7573 7561 6c6c 7920 6861 7665 2061 2060  usually have a `
-00000e30: 6075 6964 6060 2070 726f 7065 7274 7920  `uid`` property 
-00000e40: 7768 6963 6820 6973 2062 6173 6564 206f  which is based o
-00000e50: 6e20 7468 6569 7220 636f 6e74 656e 7420  n their content 
-00000e60: 616e 6420 616c 6c6f 7773 2074 6f20 7265  and allows to re
-00000e70: 6665 7265 6e63 6520 610a 2020 2020 2020  ference a.      
-00000e80: 7370 6563 6966 6963 2076 6572 7369 6f6e  specific version
-00000e90: 206f 6620 616e 206f 626a 6563 7420 286f   of an object (o
-00000ea0: 7468 6572 2074 6861 6e20 7461 6767 696e  ther than taggin
-00000eb0: 6720 6f62 6a65 6374 732c 2077 6869 6368  g objects, which
-00000ec0: 2061 6c73 6f20 616c 6c6f 7773 2066 6f72   also allows for
-00000ed0: 2065 6173 7920 7265 6665 7265 6e63 696e   easy referencin
-00000ee0: 6729 2e0a 2020 2020 2d20 4d61 6e79 206f  g)..    - Many o
-00000ef0: 626a 6563 7473 2068 6176 6520 626f 7468  bjects have both
-00000f00: 2061 2060 6073 746f 7265 6060 2066 756e   a ``store`` fun
-00000f10: 6374 696f 6e20 616e 6420 6120 6060 7061  ction and a ``pa
-00000f20: 7463 6860 6020 6675 6e63 7469 6f6e 2e20  tch`` function. 
-00000f30: 5468 6573 6520 6172 6520 7573 6564 2069  These are used i
-00000f40: 6e20 7468 6520 7361 6d65 2077 6179 2061  n the same way a
-00000f50: 7320 7468 650a 2020 2020 2020 636f 7272  s the.      corr
-00000f60: 6573 706f 6e64 696e 6720 5245 5354 2076  esponding REST v
-00000f70: 6572 6273 202d 2061 2060 6073 746f 7265  erbs - a ``store
-00000f80: 6060 2069 7320 7061 7373 6564 2061 2066  `` is passed a f
-00000f90: 756c 6c20 6f62 6a65 6374 2061 6e64 2077  ull object and w
-00000fa0: 696c 6c20 6261 7369 6361 6c6c 7920 7065  ill basically pe
-00000fb0: 7266 6f72 6d20 6120 5055 5420 6f70 6572  rform a PUT oper
-00000fc0: 6174 696f 6e2c 0a20 2020 2020 2072 6570  ation,.      rep
-00000fd0: 6c61 6369 6e67 2074 6865 2066 756c 6c20  lacing the full 
-00000fe0: 6f62 6a65 6374 2028 6966 2069 7420 6578  object (if it ex
-00000ff0: 6973 7473 2920 7768 696c 6520 6060 7061  ists) while ``pa
-00001000: 7463 6860 6020 7265 6365 6976 6573 206a  tch`` receives j
-00001010: 7573 7420 6120 6469 6374 696f 6e61 7279  ust a dictionary
-00001020: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-00001030: 6469 6666 6572 656e 6365 7320 746f 0a20  differences to. 
-00001040: 2020 2020 2062 6520 6170 706c 6965 6420       be applied 
-00001050: 746f 2074 6865 206f 626a 6563 742c 2061  to the object, a
-00001060: 6e64 2077 696c 6c20 6d65 7267 6520 7468  nd will merge th
-00001070: 6f73 6520 6368 616e 6765 7320 746f 2074  ose changes to t
-00001080: 6865 2065 7869 7374 696e 6720 6f62 6a65  he existing obje
-00001090: 6374 2e20 5468 6520 6060 7061 7463 6860  ct. The ``patch`
-000010a0: 600a 2020 2020 2020 6f70 6572 6174 696f  `.      operatio
-000010b0: 6e20 616c 736f 2068 6173 2061 2073 7472  n also has a str
-000010c0: 6174 6567 7920 6173 7369 676e 6564 2074  ategy assigned t
-000010d0: 6f20 6974 2077 6869 6368 2064 6574 6572  o it which deter
-000010e0: 6d69 6e65 7320 686f 7720 7468 6520 6d65  mines how the me
-000010f0: 7267 6520 6c6f 6769 6320 7368 6f75 6c64  rge logic should
-00001100: 2062 6568 6176 652e 0a20 2020 2020 2054   behave..      T
-00001110: 6865 2073 7472 6174 6567 7920 6361 6e20  he strategy can 
-00001120: 6265 2065 6974 6865 7220 6060 7265 706c  be either ``repl
-00001130: 6163 6560 6020 6f72 2060 6061 6464 6974  ace`` or ``addit
-00001140: 6976 6560 602e 2046 6f72 2066 7572 7468  ive``. For furth
-00001150: 6572 2064 6574 6169 6c73 206f 6e20 7468  er details on th
-00001160: 6f73 6520 7374 7261 7465 6769 6573 2c20  ose strategies, 
-00001170: 7265 6665 720a 2020 2020 2020 746f 2068  refer.      to h
-00001180: 7474 7073 3a2f 2f70 7970 692e 6f72 672f  ttps://pypi.org/
-00001190: 7072 6f6a 6563 742f 6d65 7267 6564 6565  project/mergedee
-000011a0: 702f 0a20 2020 2022 2222 0a0a 2020 2020  p/.    """..    
-000011b0: 6b69 6e64 203d 2022 6874 7470 220a 0a20  kind = "http".. 
-000011c0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-000011d0: 7365 6c66 2c20 6261 7365 5f75 726c 2c20  self, base_url, 
-000011e0: 7573 6572 3d22 222c 2070 6173 7377 6f72  user="", passwor
-000011f0: 643d 2222 2c20 746f 6b65 6e3d 2222 293a  d="", token=""):
-00001200: 0a20 2020 2020 2020 2073 656c 662e 6261  .        self.ba
-00001210: 7365 5f75 726c 203d 2062 6173 655f 7572  se_url = base_ur
-00001220: 6c0a 2020 2020 2020 2020 7365 6c66 2e75  l.        self.u
-00001230: 7365 7220 3d20 7573 6572 0a20 2020 2020  ser = user.     
-00001240: 2020 2073 656c 662e 7061 7373 776f 7264     self.password
-00001250: 203d 2070 6173 7377 6f72 640a 2020 2020   = password.    
-00001260: 2020 2020 7365 6c66 2e74 6f6b 656e 203d      self.token =
-00001270: 2074 6f6b 656e 0a20 2020 2020 2020 2073   token.        s
-00001280: 656c 662e 7365 7276 6572 5f76 6572 7369  elf.server_versi
-00001290: 6f6e 203d 2022 220a 2020 2020 2020 2020  on = "".        
-000012a0: 7365 6c66 2e73 6573 7369 6f6e 203d 204e  self.session = N
-000012b0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-000012c0: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
-000012d0: 6374 5f74 6572 6d69 6e61 6c5f 7374 6174  ct_terminal_stat
-000012e0: 655f 7265 7472 795f 696e 7465 7276 616c  e_retry_interval
-000012f0: 203d 2033 0a20 2020 2020 2020 2073 656c   = 3.        sel
-00001300: 662e 5f77 6169 745f 666f 725f 6261 636b  f._wait_for_back
-00001310: 6772 6f75 6e64 5f74 6173 6b5f 7465 726d  ground_task_term
-00001320: 696e 616c 5f73 7461 7465 5f72 6574 7279  inal_state_retry
-00001330: 5f69 6e74 6572 7661 6c20 3d20 330a 2020  _interval = 3.  
-00001340: 2020 2020 2020 7365 6c66 2e5f 7761 6974        self._wait
-00001350: 5f66 6f72 5f70 726f 6a65 6374 5f64 656c  _for_project_del
-00001360: 6574 696f 6e5f 696e 7465 7276 616c 203d  etion_interval =
-00001370: 2033 0a20 2020 2020 2020 2073 656c 662e   3.        self.
-00001380: 636c 6965 6e74 5f76 6572 7369 6f6e 203d  client_version =
-00001390: 2076 6572 7369 6f6e 2e56 6572 7369 6f6e   version.Version
-000013a0: 2829 2e67 6574 2829 5b22 7665 7273 696f  ().get()["versio
-000013b0: 6e22 5d0a 2020 2020 2020 2020 7365 6c66  n"].        self
-000013c0: 2e70 7974 686f 6e5f 7665 7273 696f 6e20  .python_version 
-000013d0: 3d20 7374 7228 7665 7273 696f 6e2e 5665  = str(version.Ve
-000013e0: 7273 696f 6e28 292e 6765 745f 7079 7468  rsion().get_pyth
-000013f0: 6f6e 5f76 6572 7369 6f6e 2829 290a 0a20  on_version()).. 
-00001400: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-00001410: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
-00001420: 6c73 203d 2073 656c 662e 5f5f 636c 6173  ls = self.__clas
-00001430: 735f 5f2e 5f5f 6e61 6d65 5f5f 0a20 2020  s__.__name__.   
-00001440: 2020 2020 2072 6574 7572 6e20 6622 7b63       return f"{c
-00001450: 6c73 7d28 7b73 656c 662e 6261 7365 5f75  ls}({self.base_u
-00001460: 726c 2172 7d29 220a 0a20 2020 2040 7374  rl!r})"..    @st
-00001470: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00001480: 6566 2067 6574 5f61 7069 5f70 6174 685f  ef get_api_path_
-00001490: 7072 6566 6978 2876 6572 7369 6f6e 3a20  prefix(version: 
-000014a0: 7374 7220 3d20 4e6f 6e65 2920 2d3e 2073  str = None) -> s
-000014b0: 7472 3a0a 2020 2020 2020 2020 2222 220a  tr:.        """.
-000014c0: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
-000014d0: 6572 7369 6f6e 3a20 4150 4920 7665 7273  ersion: API vers
-000014e0: 696f 6e20 746f 2075 7365 2c20 4e6f 6e65  ion to use, None
-000014f0: 2028 7468 6520 6465 6661 756c 7429 2077   (the default) w
-00001500: 696c 6c20 6d65 616e 2074 6f20 7573 6520  ill mean to use 
-00001510: 7468 6520 6465 6661 756c 7420 7661 6c75  the default valu
-00001520: 6520 6672 6f6d 206d 6c63 6f6e 662c 0a20  e from mlconf,. 
-00001530: 2020 2020 2020 2020 666f 7220 756e 2d76          for un-v
-00001540: 6572 7369 6f6e 6564 2061 7069 2073 6574  ersioned api set
-00001550: 2061 6e20 656d 7074 7920 7374 7269 6e67   an empty string
-00001560: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00001570: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
-00001580: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00001590: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000015a0: 2066 2261 7069 2f7b 7665 7273 696f 6e7d   f"api/{version}
-000015b0: 2220 6966 2076 6572 7369 6f6e 2065 6c73  " if version els
-000015c0: 6520 2261 7069 220a 0a20 2020 2020 2020  e "api"..       
-000015d0: 2061 7069 5f76 6572 7369 6f6e 5f70 6174   api_version_pat
-000015e0: 6820 3d20 280a 2020 2020 2020 2020 2020  h = (.          
-000015f0: 2020 6622 6170 692f 7b63 6f6e 6669 672e    f"api/{config.
-00001600: 6170 695f 6261 7365 5f76 6572 7369 6f6e  api_base_version
-00001610: 7d22 2069 6620 636f 6e66 6967 2e61 7069  }" if config.api
-00001620: 5f62 6173 655f 7665 7273 696f 6e20 656c  _base_version el
-00001630: 7365 2022 6170 6922 0a20 2020 2020 2020  se "api".       
-00001640: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00001650: 6e20 6170 695f 7665 7273 696f 6e5f 7061  n api_version_pa
-00001660: 7468 0a0a 2020 2020 6465 6620 6765 745f  th..    def get_
-00001670: 6261 7365 5f61 7069 5f75 726c 2873 656c  base_api_url(sel
-00001680: 662c 2070 6174 683a 2073 7472 2c20 7665  f, path: str, ve
-00001690: 7273 696f 6e3a 2073 7472 203d 204e 6f6e  rsion: str = Non
-000016a0: 6529 202d 3e20 7374 723a 0a20 2020 2020  e) -> str:.     
-000016b0: 2020 2070 6174 685f 7072 6566 6978 203d     path_prefix =
-000016c0: 2073 656c 662e 6765 745f 6170 695f 7061   self.get_api_pa
-000016d0: 7468 5f70 7265 6669 7828 7665 7273 696f  th_prefix(versio
-000016e0: 6e29 0a20 2020 2020 2020 2075 726c 203d  n).        url =
-000016f0: 2066 227b 7365 6c66 2e62 6173 655f 7572   f"{self.base_ur
-00001700: 6c7d 2f7b 7061 7468 5f70 7265 6669 787d  l}/{path_prefix}
-00001710: 2f7b 7061 7468 7d22 0a20 2020 2020 2020  /{path}".       
-00001720: 2072 6574 7572 6e20 7572 6c0a 0a20 2020   return url..   
-00001730: 2064 6566 2061 7069 5f63 616c 6c28 0a20   def api_call(. 
-00001740: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00001750: 2020 2020 206d 6574 686f 642c 0a20 2020       method,.   
-00001760: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-00001770: 2020 2065 7272 6f72 3d4e 6f6e 652c 0a20     error=None,. 
-00001780: 2020 2020 2020 2070 6172 616d 733d 4e6f         params=No
-00001790: 6e65 2c0a 2020 2020 2020 2020 626f 6479  ne,.        body
-000017a0: 3d4e 6f6e 652c 0a20 2020 2020 2020 206a  =None,.        j
-000017b0: 736f 6e3d 4e6f 6e65 2c0a 2020 2020 2020  son=None,.      
-000017c0: 2020 6865 6164 6572 733d 4e6f 6e65 2c0a    headers=None,.
-000017d0: 2020 2020 2020 2020 7469 6d65 6f75 743d          timeout=
-000017e0: 3435 2c0a 2020 2020 2020 2020 7665 7273  45,.        vers
-000017f0: 696f 6e3d 4e6f 6e65 2c0a 2020 2020 293a  ion=None,.    ):
-00001800: 0a20 2020 2020 2020 2022 2222 5065 7266  .        """Perf
-00001810: 6f72 6d20 6120 6469 7265 6374 2052 4553  orm a direct RES
-00001820: 5420 4150 4920 6361 6c6c 206f 6e20 7468  T API call on th
-00001830: 6520 3a70 793a 6d6f 643a 606d 6c72 756e  e :py:mod:`mlrun
-00001840: 6020 4150 4920 7365 7276 6572 2e0a 0a20  ` API server... 
-00001850: 2020 2020 2020 2043 6175 7469 6f6e 3a0a         Caution:.
-00001860: 2020 2020 2020 2020 2020 2020 466f 7220              For 
-00001870: 6164 7661 6e63 6564 2075 7361 6765 202d  advanced usage -
-00001880: 2070 7265 6665 7220 7573 696e 6720 7468   prefer using th
-00001890: 6520 7661 7269 6f75 7320 4150 4973 2065  e various APIs e
-000018a0: 7870 6f73 6564 2074 6872 6f75 6768 2074  xposed through t
-000018b0: 6869 7320 636c 6173 732c 2072 6174 6865  his class, rathe
-000018c0: 7220 7468 616e 0a20 2020 2020 2020 2020  r than.         
-000018d0: 2020 2064 6972 6563 746c 7920 696e 766f     directly invo
-000018e0: 6b69 6e67 2052 4553 5420 6361 6c6c 732e  king REST calls.
-000018f0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00001900: 206d 6574 686f 643a 2052 4553 5420 6d65   method: REST me
-00001910: 7468 6f64 2028 504f 5354 2c20 4745 542c  thod (POST, GET,
-00001920: 2050 5554 2e2e 2e29 0a20 2020 2020 2020   PUT...).       
-00001930: 203a 7061 7261 6d20 7061 7468 3a20 5061   :param path: Pa
-00001940: 7468 2074 6f20 656e 6470 6f69 6e74 2065  th to endpoint e
-00001950: 7865 6375 7465 642c 2066 6f72 2065 7861  xecuted, for exa
-00001960: 6d70 6c65 2060 6022 7072 6f6a 6563 7473  mple ``"projects
-00001970: 2260 600a 2020 2020 2020 2020 3a70 6172  "``.        :par
-00001980: 616d 2065 7272 6f72 3a20 4572 726f 7220  am error: Error 
-00001990: 746f 2072 6574 7572 6e20 6966 2041 5049  to return if API
-000019a0: 2069 6e76 6f63 6174 696f 6e20 6661 696c   invocation fail
-000019b0: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
-000019c0: 2070 6172 616d 733a 2052 6573 7420 7061   params: Rest pa
-000019d0: 7261 6d65 7465 7273 2c20 7061 7373 6564  rameters, passed
-000019e0: 2061 7320 6120 6469 6374 696f 6e61 7279   as a dictionary
-000019f0: 3a20 6060 7b22 3c70 6172 616d 2d6e 616d  : ``{"<param-nam
-00001a00: 653e 223a 203c 2270 6172 616d 2d76 616c  e>": <"param-val
-00001a10: 7565 223e 7d60 600a 2020 2020 2020 2020  ue">}``.        
-00001a20: 3a70 6172 616d 2062 6f64 793a 2050 6179  :param body: Pay
-00001a30: 6c6f 6164 2074 6f20 6265 2070 6173 7365  load to be passe
-00001a40: 6420 696e 2074 6865 2063 616c 6c2e 2049  d in the call. I
-00001a50: 6620 7573 696e 6720 4a53 4f4e 206f 626a  f using JSON obj
-00001a60: 6563 7473 2c20 7072 6566 6572 2075 7369  ects, prefer usi
-00001a70: 6e67 2074 6865 2060 606a 736f 6e60 6020  ng the ``json`` 
-00001a80: 7061 7261 6d0a 2020 2020 2020 2020 3a70  param.        :p
-00001a90: 6172 616d 206a 736f 6e3a 204a 534f 4e20  aram json: JSON 
-00001aa0: 7061 796c 6f61 6420 746f 2062 6520 7061  payload to be pa
-00001ab0: 7373 6564 2069 6e20 7468 6520 6361 6c6c  ssed in the call
-00001ac0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00001ad0: 6865 6164 6572 733a 2052 4553 5420 6865  headers: REST he
-00001ae0: 6164 6572 732c 2070 6173 7365 6420 6173  aders, passed as
-00001af0: 2061 2064 6963 7469 6f6e 6172 793a 2060   a dictionary: `
-00001b00: 607b 223c 6865 6164 6572 2d6e 616d 653e  `{"<header-name>
-00001b10: 223a 2022 3c68 6561 6465 722d 7661 6c75  ": "<header-valu
-00001b20: 653e 227d 6060 0a20 2020 2020 2020 203a  e>"}``.        :
-00001b30: 7061 7261 6d20 7469 6d65 6f75 743a 2041  param timeout: A
-00001b40: 5049 2063 616c 6c20 7469 6d65 6f75 740a  PI call timeout.
-00001b50: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
-00001b60: 6572 7369 6f6e 3a20 4150 4920 7665 7273  ersion: API vers
-00001b70: 696f 6e20 746f 2075 7365 2c20 4e6f 6e65  ion to use, None
-00001b80: 2028 7468 6520 6465 6661 756c 7429 2077   (the default) w
-00001b90: 696c 6c20 6d65 616e 2074 6f20 7573 6520  ill mean to use 
-00001ba0: 7468 6520 6465 6661 756c 7420 7661 6c75  the default valu
-00001bb0: 6520 6672 6f6d 2063 6f6e 6669 672c 0a20  e from config,. 
-00001bc0: 2020 2020 2020 2020 666f 7220 756e 2d76          for un-v
-00001bd0: 6572 7369 6f6e 6564 2061 7069 2073 6574  ersioned api set
-00001be0: 2061 6e20 656d 7074 7920 7374 7269 6e67   an empty string
-00001bf0: 2e0a 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
-00001c00: 726e 3a20 5079 7468 6f6e 2048 5454 5020  rn: Python HTTP 
-00001c10: 7265 7370 6f6e 7365 206f 626a 6563 740a  response object.
-00001c20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00001c30: 2020 2020 7572 6c20 3d20 7365 6c66 2e67      url = self.g
-00001c40: 6574 5f62 6173 655f 6170 695f 7572 6c28  et_base_api_url(
-00001c50: 7061 7468 2c20 7665 7273 696f 6e29 0a20  path, version). 
-00001c60: 2020 2020 2020 206b 7720 3d20 7b0a 2020         kw = {.  
-00001c70: 2020 2020 2020 2020 2020 6b65 793a 2076            key: v
-00001c80: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
-00001c90: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
-00001ca0: 696e 2028 0a20 2020 2020 2020 2020 2020  in (.           
-00001cb0: 2020 2020 2028 2270 6172 616d 7322 2c20       ("params", 
-00001cc0: 7061 7261 6d73 292c 0a20 2020 2020 2020  params),.       
-00001cd0: 2020 2020 2020 2020 2028 2264 6174 6122           ("data"
-00001ce0: 2c20 626f 6479 292c 0a20 2020 2020 2020  , body),.       
-00001cf0: 2020 2020 2020 2020 2028 226a 736f 6e22           ("json"
-00001d00: 2c20 6a73 6f6e 292c 0a20 2020 2020 2020  , json),.       
-00001d10: 2020 2020 2020 2020 2028 2268 6561 6465           ("heade
-00001d20: 7273 222c 2068 6561 6465 7273 292c 0a20  rs", headers),. 
-00001d30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00001d40: 2020 2020 2020 2020 2069 6620 7661 6c75           if valu
-00001d50: 6520 6973 206e 6f74 204e 6f6e 650a 2020  e is not None.  
-00001d60: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00001d70: 2069 6620 7365 6c66 2e75 7365 723a 0a20   if self.user:. 
-00001d80: 2020 2020 2020 2020 2020 206b 775b 2261             kw["a
-00001d90: 7574 6822 5d20 3d20 2873 656c 662e 7573  uth"] = (self.us
-00001da0: 6572 2c20 7365 6c66 2e70 6173 7377 6f72  er, self.passwor
-00001db0: 6429 0a20 2020 2020 2020 2065 6c69 6620  d).        elif 
-00001dc0: 7365 6c66 2e74 6f6b 656e 3a0a 2020 2020  self.token:.    
-00001dd0: 2020 2020 2020 2020 2320 4967 7561 7a69          # Iguazi
-00001de0: 6f20 6175 7468 2064 6f65 736e 2774 2073  o auth doesn't s
-00001df0: 7570 706f 7274 2070 6173 7369 6e67 2074  upport passing t
-00001e00: 6f6b 656e 2074 6872 6f75 6768 2062 6561  oken through bea
-00001e10: 7265 722c 2073 6f20 7573 6520 636f 6f6b  rer, so use cook
-00001e20: 6965 2069 6e73 7465 6164 0a20 2020 2020  ie instead.     
-00001e30: 2020 2020 2020 2069 6620 6d6c 7275 6e2e         if mlrun.
-00001e40: 706c 6174 666f 726d 732e 6967 7561 7a69  platforms.iguazi
-00001e50: 6f2e 6973 5f69 6775 617a 696f 5f73 6573  o.is_iguazio_ses
-00001e60: 7369 6f6e 2873 656c 662e 746f 6b65 6e29  sion(self.token)
-00001e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001e80: 2020 7365 7373 696f 6e5f 636f 6f6b 6965    session_cookie
-00001e90: 203d 2066 276a 3a7b 7b22 7369 6422 3a20   = f'j:{{"sid": 
-00001ea0: 227b 7365 6c66 2e74 6f6b 656e 7d22 7d7d  "{self.token}"}}
-00001eb0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00001ec0: 2020 636f 6f6b 6965 7320 3d20 7b0a 2020    cookies = {.  
-00001ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ee0: 2020 2273 6573 7369 6f6e 223a 2073 6573    "session": ses
-00001ef0: 7369 6f6e 5f63 6f6f 6b69 652c 0a20 2020  sion_cookie,.   
-00001f00: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00001f10: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00001f20: 775b 2263 6f6f 6b69 6573 225d 203d 2063  w["cookies"] = c
-00001f30: 6f6f 6b69 6573 0a20 2020 2020 2020 2020  ookies.         
-00001f40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00001f50: 2020 2020 2020 2020 2069 6620 2241 7574           if "Aut
-00001f60: 686f 7269 7a61 7469 6f6e 2220 6e6f 7420  horization" not 
-00001f70: 696e 206b 772e 7365 7464 6566 6175 6c74  in kw.setdefault
-00001f80: 2822 6865 6164 6572 7322 2c20 7b7d 293a  ("headers", {}):
-00001f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001fa0: 2020 2020 206b 775b 2268 6561 6465 7273       kw["headers
-00001fb0: 225d 2e75 7064 6174 6528 7b22 4175 7468  "].update({"Auth
-00001fc0: 6f72 697a 6174 696f 6e22 3a20 2242 6561  orization": "Bea
-00001fd0: 7265 7220 2220 2b20 7365 6c66 2e74 6f6b  rer " + self.tok
-00001fe0: 656e 7d29 0a0a 2020 2020 2020 2020 6966  en})..        if
-00001ff0: 206d 6c72 756e 2e61 7069 2e73 6368 656d   mlrun.api.schem
-00002000: 6173 2e48 6561 6465 724e 616d 6573 2e63  as.HeaderNames.c
-00002010: 6c69 656e 745f 7665 7273 696f 6e20 6e6f  lient_version no
-00002020: 7420 696e 206b 772e 7365 7464 6566 6175  t in kw.setdefau
-00002030: 6c74 280a 2020 2020 2020 2020 2020 2020  lt(.            
-00002040: 2268 6561 6465 7273 222c 207b 7d0a 2020  "headers", {}.  
-00002050: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00002060: 2020 2020 206b 775b 2268 6561 6465 7273       kw["headers
-00002070: 225d 2e75 7064 6174 6528 0a20 2020 2020  "].update(.     
-00002080: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
-00002090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020a0: 206d 6c72 756e 2e61 7069 2e73 6368 656d   mlrun.api.schem
-000020b0: 6173 2e48 6561 6465 724e 616d 6573 2e63  as.HeaderNames.c
-000020c0: 6c69 656e 745f 7665 7273 696f 6e3a 2073  lient_version: s
-000020d0: 656c 662e 636c 6965 6e74 5f76 6572 7369  elf.client_versi
-000020e0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-000020f0: 2020 2020 2020 2020 6d6c 7275 6e2e 6170          mlrun.ap
-00002100: 692e 7363 6865 6d61 732e 4865 6164 6572  i.schemas.Header
-00002110: 4e61 6d65 732e 7079 7468 6f6e 5f76 6572  Names.python_ver
-00002120: 7369 6f6e 3a20 7365 6c66 2e70 7974 686f  sion: self.pytho
-00002130: 6e5f 7665 7273 696f 6e2c 0a20 2020 2020  n_version,.     
-00002140: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00002150: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00002160: 2020 2020 2320 7265 7175 6573 7473 206e      # requests n
-00002170: 6f20 6c6f 6e67 6572 2073 7570 706f 7274  o longer support
-00002180: 7320 6865 6164 6572 2076 616c 7565 7320  s header values 
-00002190: 746f 2062 6520 656e 756d 2028 6874 7470  to be enum (http
-000021a0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
-000021b0: 7366 2f72 6571 7565 7374 732f 7075 6c6c  sf/requests/pull
-000021c0: 2f36 3135 3429 0a20 2020 2020 2020 2023  /6154).        #
-000021d0: 2063 6f6e 7665 7274 2074 6f20 7374 7269   convert to stri
-000021e0: 6e67 732e 2044 6f20 7468 6520 7361 6d65  ngs. Do the same
-000021f0: 2066 6f72 2070 6172 616d 7320 666f 7220   for params for 
-00002200: 6e69 6365 6e65 7373 0a20 2020 2020 2020  niceness.       
-00002210: 2066 6f72 2064 6963 745f 2069 6e20 5b68   for dict_ in [h
-00002220: 6561 6465 7273 2c20 7061 7261 6d73 5d3a  eaders, params]:
-00002230: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00002240: 6469 6374 5f20 6973 206e 6f74 204e 6f6e  dict_ is not Non
-00002250: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00002260: 2020 2066 6f72 206b 6579 2069 6e20 6469     for key in di
-00002270: 6374 5f2e 6b65 7973 2829 3a0a 2020 2020  ct_.keys():.    
-00002280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002290: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
-000022a0: 6374 5f5b 6b65 795d 2c20 656e 756d 2e45  ct_[key], enum.E
-000022b0: 6e75 6d29 3a0a 2020 2020 2020 2020 2020  num):.          
-000022c0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-000022d0: 6374 5f5b 6b65 795d 203d 2064 6963 745f  ct_[key] = dict_
-000022e0: 5b6b 6579 5d2e 7661 6c75 650a 0a20 2020  [key].value..   
-000022f0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00002300: 2e73 6573 7369 6f6e 3a0a 2020 2020 2020  .session:.      
-00002310: 2020 2020 2020 7365 6c66 2e73 6573 7369        self.sessi
-00002320: 6f6e 203d 2073 656c 662e 5f69 6e69 745f  on = self._init_
-00002330: 7365 7373 696f 6e28 290a 0a20 2020 2020  session()..     
-00002340: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00002350: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
-00002360: 656c 662e 7365 7373 696f 6e2e 7265 7175  elf.session.requ
-00002370: 6573 7428 0a20 2020 2020 2020 2020 2020  est(.           
-00002380: 2020 2020 206d 6574 686f 642c 2075 726c       method, url
-00002390: 2c20 7469 6d65 6f75 743d 7469 6d65 6f75  , timeout=timeou
-000023a0: 742c 2076 6572 6966 793d 4661 6c73 652c  t, verify=False,
-000023b0: 202a 2a6b 770a 2020 2020 2020 2020 2020   **kw.          
-000023c0: 2020 290a 2020 2020 2020 2020 6578 6365    ).        exce
-000023d0: 7074 2072 6571 7565 7374 732e 5265 7175  pt requests.Requ
-000023e0: 6573 7445 7863 6570 7469 6f6e 2061 7320  estException as 
-000023f0: 6578 633a 0a20 2020 2020 2020 2020 2020  exc:.           
-00002400: 2065 7272 6f72 203d 2066 227b 6572 725f   error = f"{err_
-00002410: 746f 5f73 7472 2865 7863 297d 3a20 7b65  to_str(exc)}: {e
-00002420: 7272 6f72 7d22 2069 6620 6572 726f 7220  rror}" if error 
-00002430: 656c 7365 2065 7272 5f74 6f5f 7374 7228  else err_to_str(
-00002440: 6578 6329 0a20 2020 2020 2020 2020 2020  exc).           
-00002450: 2072 6169 7365 206d 6c72 756e 2e65 7272   raise mlrun.err
-00002460: 6f72 732e 4d4c 5275 6e52 756e 7469 6d65  ors.MLRunRuntime
-00002470: 4572 726f 7228 6572 726f 7229 2066 726f  Error(error) fro
-00002480: 6d20 6578 630a 0a20 2020 2020 2020 2069  m exc..        i
-00002490: 6620 6e6f 7420 7265 7370 6f6e 7365 2e6f  f not response.o
-000024a0: 6b3a 0a20 2020 2020 2020 2020 2020 2069  k:.            i
-000024b0: 6620 7265 7370 6f6e 7365 2e63 6f6e 7465  f response.conte
-000024c0: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-000024d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000024e0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000024f0: 6120 3d20 7265 7370 6f6e 7365 2e6a 736f  a = response.jso
-00002500: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
-00002510: 2020 2020 2020 2020 6572 726f 725f 6465          error_de
-00002520: 7461 696c 7320 3d20 6461 7461 2e67 6574  tails = data.get
-00002530: 2822 6465 7461 696c 222c 207b 7d29 0a20  ("detail", {}). 
-00002540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002550: 2020 2069 6620 6e6f 7420 6572 726f 725f     if not error_
-00002560: 6465 7461 696c 733a 0a20 2020 2020 2020  details:.       
-00002570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002580: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-00002590: 2246 6169 6c65 6420 7061 7273 696e 6720  "Failed parsing 
-000025a0: 6572 726f 7220 7265 7370 6f6e 7365 2062  error response b
-000025b0: 6f64 7922 2c20 6461 7461 3d64 6174 6129  ody", data=data)
-000025c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000025d0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000025e0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-000025f0: 2020 2020 2020 2065 7272 6f72 5f64 6574         error_det
-00002600: 6169 6c73 203d 2022 220a 2020 2020 2020  ails = "".      
-00002610: 2020 2020 2020 2020 2020 6966 2065 7272            if err
-00002620: 6f72 5f64 6574 6169 6c73 3a0a 2020 2020  or_details:.    
+00000340: 6f72 7420 6d6c 7275 6e2e 6170 692e 7574  ort mlrun.api.ut
+00000350: 696c 732e 6865 6c70 6572 730a 696d 706f  ils.helpers.impo
+00000360: 7274 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rt mlrun.common.
+00000370: 7363 6865 6d61 730a 696d 706f 7274 206d  schemas.import m
+00000380: 6c72 756e 2e6d 6f64 656c 5f6d 6f6e 6974  lrun.model_monit
+00000390: 6f72 696e 672e 6d6f 6465 6c5f 656e 6470  oring.model_endp
+000003a0: 6f69 6e74 0a69 6d70 6f72 7420 6d6c 7275  oint.import mlru
+000003b0: 6e2e 7072 6f6a 6563 7473 0a66 726f 6d20  n.projects.from 
+000003c0: 6d6c 7275 6e2e 6572 726f 7273 2069 6d70  mlrun.errors imp
+000003d0: 6f72 7420 4d4c 5275 6e49 6e76 616c 6964  ort MLRunInvalid
+000003e0: 4172 6775 6d65 6e74 4572 726f 722c 2065  ArgumentError, e
+000003f0: 7272 5f74 6f5f 7374 720a 0a66 726f 6d20  rr_to_str..from 
+00000400: 2e2e 6172 7469 6661 6374 7320 696d 706f  ..artifacts impo
+00000410: 7274 2041 7274 6966 6163 740a 6672 6f6d  rt Artifact.from
+00000420: 202e 2e63 6f6e 6669 6720 696d 706f 7274   ..config import
+00000430: 2063 6f6e 6669 670a 6672 6f6d 202e 2e66   config.from ..f
+00000440: 6561 7475 7265 5f73 746f 7265 2069 6d70  eature_store imp
+00000450: 6f72 7420 4665 6174 7572 6553 6574 2c20  ort FeatureSet, 
+00000460: 4665 6174 7572 6556 6563 746f 720a 6672  FeatureVector.fr
+00000470: 6f6d 202e 2e6c 6973 7473 2069 6d70 6f72  om ..lists impor
+00000480: 7420 4172 7469 6661 6374 4c69 7374 2c20  t ArtifactList, 
+00000490: 5275 6e4c 6973 740a 6672 6f6d 202e 2e72  RunList.from ..r
+000004a0: 756e 7469 6d65 7320 696d 706f 7274 2042  untimes import B
+000004b0: 6173 6552 756e 7469 6d65 0a66 726f 6d20  aseRuntime.from 
+000004c0: 2e2e 7574 696c 7320 696d 706f 7274 2028  ..utils import (
+000004d0: 0a20 2020 2064 6174 6574 696d 655f 746f  .    datetime_to
+000004e0: 5f69 736f 2c0a 2020 2020 6469 6374 5f74  _iso,.    dict_t
+000004f0: 6f5f 6a73 6f6e 2c0a 2020 2020 6c6f 6767  o_json,.    logg
+00000500: 6572 2c0a 2020 2020 6e65 775f 7069 7065  er,.    new_pipe
+00000510: 5f6d 6574 6164 6174 612c 0a20 2020 206e  _metadata,.    n
+00000520: 6f72 6d61 6c69 7a65 5f6e 616d 652c 0a20  ormalize_name,. 
+00000530: 2020 2076 6572 7369 6f6e 2c0a 290a 6672     version,.).fr
+00000540: 6f6d 202e 6261 7365 2069 6d70 6f72 7420  om .base import 
+00000550: 5275 6e44 4245 7272 6f72 2c20 5275 6e44  RunDBError, RunD
+00000560: 4249 6e74 6572 6661 6365 0a0a 5f61 7274  BInterface.._art
+00000570: 6966 6163 745f 6b65 7973 203d 205b 0a20  ifact_keys = [. 
+00000580: 2020 2022 666f 726d 6174 222c 0a20 2020     "format",.   
+00000590: 2022 696e 6c69 6e65 222c 0a20 2020 2022   "inline",.    "
+000005a0: 6b65 7922 2c0a 2020 2020 2273 7263 5f70  key",.    "src_p
+000005b0: 6174 6822 2c0a 2020 2020 2274 6172 6765  ath",.    "targe
+000005c0: 745f 7061 7468 222c 0a20 2020 2022 7669  t_path",.    "vi
+000005d0: 6577 6572 222c 0a5d 0a0a 0a64 6566 2062  ewer",.]...def b
+000005e0: 6f6f 6c32 7374 7228 7661 6c29 3a0a 2020  ool2str(val):.  
+000005f0: 2020 7265 7475 726e 2022 7965 7322 2069    return "yes" i
+00000600: 6620 7661 6c20 656c 7365 2022 6e6f 220a  f val else "no".
+00000610: 0a0a 636c 6173 7320 4854 5450 5275 6e44  ..class HTTPRunD
+00000620: 4228 5275 6e44 4249 6e74 6572 6661 6365  B(RunDBInterface
+00000630: 293a 0a20 2020 2022 2222 496e 7465 7266  ):.    """Interf
+00000640: 6163 6520 666f 7220 6163 6365 7373 696e  ace for accessin
+00000650: 6720 616e 6420 6d61 6e69 7075 6c61 7469  g and manipulati
+00000660: 6e67 2074 6865 203a 7079 3a6d 6f64 3a60  ng the :py:mod:`
+00000670: 6d6c 7275 6e60 2070 6572 7369 7374 656e  mlrun` persisten
+00000680: 7420 7374 6f72 652c 206d 6169 6e74 6169  t store, maintai
+00000690: 6e69 6e67 2074 6865 2066 756c 6c20 7374  ning the full st
+000006a0: 6174 650a 2020 2020 616e 6420 6361 7461  ate.    and cata
+000006b0: 6c6f 6720 6f66 206f 626a 6563 7473 2074  log of objects t
+000006c0: 6861 7420 4d4c 5275 6e20 7573 6573 2e20  hat MLRun uses. 
+000006d0: 5468 6520 3a70 793a 636c 6173 733a 6048  The :py:class:`H
+000006e0: 5454 5052 756e 4442 6020 636c 6173 7320  TTPRunDB` class 
+000006f0: 7365 7276 6573 2061 7320 6120 636c 6965  serves as a clie
+00000700: 6e74 2d73 6964 6520 7072 6f78 7920 746f  nt-side proxy to
+00000710: 2074 6865 204d 4c52 756e 0a20 2020 2041   the MLRun.    A
+00000720: 5049 2073 6572 7669 6365 2077 6869 6368  PI service which
+00000730: 206d 6169 6e74 6169 6e73 2074 6865 2061   maintains the a
+00000740: 6374 7561 6c20 6461 7461 2d73 746f 7265  ctual data-store
+00000750: 2c20 6163 6365 7373 6573 2074 6865 2073  , accesses the s
+00000760: 6572 7665 7220 7468 726f 7567 6820 5245  erver through RE
+00000770: 5354 2041 5049 732e 0a0a 2020 2020 5468  ST APIs...    Th
+00000780: 6520 636c 6173 7320 7072 6f76 6964 6573  e class provides
+00000790: 2066 756e 6374 696f 6e73 2066 6f72 2061   functions for a
+000007a0: 6363 6573 7369 6e67 2061 6e64 206d 6f64  ccessing and mod
+000007b0: 6966 7969 6e67 2074 6865 2076 6172 696f  ifying the vario
+000007c0: 7573 206f 626a 6563 7473 2074 6861 7420  us objects that 
+000007d0: 6172 6520 7573 6564 2062 7920 4d4c 5275  are used by MLRu
+000007e0: 6e20 696e 2069 7473 0a20 2020 206f 7065  n in its.    ope
+000007f0: 7261 7469 6f6e 2e20 5468 6520 6675 6e63  ration. The func
+00000800: 7469 6f6e 7320 7072 6f76 6964 6564 2066  tions provided f
+00000810: 6f6c 6c6f 7720 736f 6d65 2073 7461 6e64  ollow some stand
+00000820: 6172 6420 6775 6964 656c 696e 6573 2c20  ard guidelines, 
+00000830: 7768 6963 6820 6172 653a 0a0a 2020 2020  which are:..    
+00000840: 2d20 4576 6572 7920 6f62 6a65 6374 2069  - Every object i
+00000850: 6e20 4d4c 5275 6e20 6578 6973 7473 2069  n MLRun exists i
+00000860: 6e20 7468 6520 636f 6e74 6578 7420 6f66  n the context of
+00000870: 2061 2070 726f 6a65 6374 2028 6578 6365   a project (exce
+00000880: 7074 2070 726f 6a65 6374 7320 7468 656d  pt projects them
+00000890: 7365 6c76 6573 292e 2057 6865 6e20 7265  selves). When re
+000008a0: 6665 7265 6e63 696e 6720 616e 206f 626a  ferencing an obj
+000008b0: 6563 740a 2020 2020 2020 7468 726f 7567  ect.      throug
+000008c0: 6820 616e 7920 4150 492c 2061 2070 726f  h any API, a pro
+000008d0: 6a65 6374 206e 616d 6520 6d75 7374 2062  ject name must b
+000008e0: 6520 7072 6f76 6964 6564 2e20 5468 6520  e provided. The 
+000008f0: 6465 6661 756c 7420 666f 7220 6d6f 7374  default for most
+00000900: 2041 5049 7320 6973 2066 6f72 2061 6e20   APIs is for an 
+00000910: 656d 7074 7920 7072 6f6a 6563 7420 6e61  empty project na
+00000920: 6d65 2c20 7768 6963 680a 2020 2020 2020  me, which.      
+00000930: 7769 6c6c 2062 6520 7265 706c 6163 6564  will be replaced
+00000940: 2062 7920 7468 6520 6e61 6d65 206f 6620   by the name of 
+00000950: 7468 6520 6465 6661 756c 7420 7072 6f6a  the default proj
+00000960: 6563 7420 2875 7375 616c 6c79 2060 6064  ect (usually ``d
+00000970: 6566 6175 6c74 6060 292e 2054 6865 7265  efault``). There
+00000980: 666f 7265 2c20 6966 2070 6572 666f 726d  fore, if perform
+00000990: 696e 6720 616e 2041 5049 2074 6f0a 2020  ing an API to.  
+000009a0: 2020 2020 6c69 7374 2066 756e 6374 696f      list functio
+000009b0: 6e73 2c20 666f 7220 6578 616d 706c 652c  ns, for example,
+000009c0: 2061 6e64 206e 6f74 2070 726f 7669 6469   and not providi
+000009d0: 6e67 2061 2070 726f 6a65 6374 206e 616d  ng a project nam
+000009e0: 6520 2d20 7468 6520 7265 7375 6c74 2077  e - the result w
+000009f0: 696c 6c20 6e6f 7420 6265 2066 756e 6374  ill not be funct
+00000a00: 696f 6e73 2066 726f 6d20 616c 6c0a 2020  ions from all.  
+00000a10: 2020 2020 7072 6f6a 6563 7473 2062 7574      projects but
+00000a20: 2072 6174 6865 7220 6672 6f6d 2074 6865   rather from the
+00000a30: 2060 6064 6566 6175 6c74 6060 2070 726f   ``default`` pro
+00000a40: 6a65 6374 2e0a 2020 2020 2d20 4d61 6e79  ject..    - Many
+00000a50: 206f 626a 6563 7473 2063 616e 2062 6520   objects can be 
+00000a60: 6173 7369 676e 6564 206c 6162 656c 732c  assigned labels,
+00000a70: 2061 6e64 206c 6973 7465 642f 7175 6572   and listed/quer
+00000a80: 6965 6420 6279 206c 6162 656c 2e20 5468  ied by label. Th
+00000a90: 6520 6c61 6265 6c20 7061 7261 6d65 7465  e label paramete
+00000aa0: 7220 666f 7220 7175 6572 7920 4150 4973  r for query APIs
+00000ab0: 2061 6c6c 6f77 7320 666f 720a 2020 2020   allows for.    
+00000ac0: 2020 6c69 7374 696e 6720 6f62 6a65 6374    listing object
+00000ad0: 7320 7468 6174 3a0a 0a20 2020 2020 202d  s that:..      -
+00000ae0: 2048 6176 6520 6120 7370 6563 6966 6963   Have a specific
+00000af0: 206c 6162 656c 2c20 6279 2061 736b 696e   label, by askin
+00000b00: 6720 666f 7220 6060 6c61 6265 6c3d 223c  g for ``label="<
+00000b10: 6c61 6265 6c5f 6e61 6d65 3e22 6060 2e20  label_name>"``. 
+00000b20: 496e 2074 6869 7320 6361 7365 2074 6865  In this case the
+00000b30: 2061 6374 7561 6c20 7661 6c75 6520 6f66   actual value of
+00000b40: 2074 6865 206c 6162 656c 0a20 2020 2020   the label.     
+00000b50: 2020 2064 6f65 736e 2774 206d 6174 7465     doesn't matte
+00000b60: 7220 616e 6420 6576 6572 7920 6f62 6a65  r and every obje
+00000b70: 6374 2077 6974 6820 7468 6174 206c 6162  ct with that lab
+00000b80: 656c 2077 696c 6c20 6265 2072 6574 7572  el will be retur
+00000b90: 6e65 640a 2020 2020 2020 2d20 4861 7665  ned.      - Have
+00000ba0: 2061 206c 6162 656c 2077 6974 6820 6120   a label with a 
+00000bb0: 7370 6563 6966 6963 2076 616c 7565 2e20  specific value. 
+00000bc0: 5468 6973 2069 7320 646f 6e65 2062 7920  This is done by 
+00000bd0: 7370 6563 6966 7969 6e67 2060 606c 6162  specifying ``lab
+00000be0: 656c 3d22 3c6c 6162 656c 5f6e 616d 653e  el="<label_name>
+00000bf0: 3d3c 6c61 6265 6c5f 7661 6c75 653e 2260  =<label_value>"`
+00000c00: 602e 2049 6e20 7468 6973 0a20 2020 2020  `. In this.     
+00000c10: 2020 2063 6173 6520 6f6e 6c79 206f 626a     case only obj
+00000c20: 6563 7473 2077 686f 7365 206c 6162 656c  ects whose label
+00000c30: 206d 6174 6368 6573 2074 6865 2076 616c   matches the val
+00000c40: 7565 2077 696c 6c20 6265 2072 6574 7572  ue will be retur
+00000c50: 6e65 640a 0a20 2020 202d 204d 6f73 7420  ned..    - Most 
+00000c60: 6f62 6a65 6374 7320 6861 7665 2061 2060  objects have a `
+00000c70: 6063 7265 6174 6560 6020 6d65 7468 6f64  `create`` method
+00000c80: 2061 7320 7765 6c6c 2061 7320 6120 6060   as well as a ``
+00000c90: 7374 6f72 6560 6020 6d65 7468 6f64 2e20  store`` method. 
+00000ca0: 4372 6561 7465 2063 616e 206f 6e6c 7920  Create can only 
+00000cb0: 6265 2063 616c 6c65 6420 7768 656e 2073  be called when s
+00000cc0: 7563 6820 616e 0a20 2020 2020 2064 6f65  uch an.      doe
+00000cd0: 7320 6e6f 7420 6578 6973 7420 7965 742c  s not exist yet,
+00000ce0: 2077 6869 6c65 2073 746f 7265 2061 6c6c   while store all
+00000cf0: 6f77 7320 666f 7220 6569 7468 6572 2063  ows for either c
+00000d00: 7265 6174 696e 6720 6120 6e65 7720 6f62  reating a new ob
+00000d10: 6a65 6374 206f 7220 6f76 6572 7772 6974  ject or overwrit
+00000d20: 696e 6720 616e 2065 7869 7374 696e 6720  ing an existing 
+00000d30: 6f62 6a65 6374 2e0a 2020 2020 2d20 536f  object..    - So
+00000d40: 6d65 206f 626a 6563 7473 2068 6176 6520  me objects have 
+00000d50: 6120 6060 7665 7273 696f 6e65 6460 6020  a ``versioned`` 
+00000d60: 6f70 7469 6f6e 2c20 696e 2077 6869 6368  option, in which
+00000d70: 2063 6173 6520 6f76 6572 7772 6974 696e   case overwritin
+00000d80: 6720 7468 6520 7361 6d65 206f 626a 6563  g the same objec
+00000d90: 7420 7769 7468 2061 2064 6966 6665 7265  t with a differe
+00000da0: 6e74 2076 6572 7369 6f6e 206f 660a 2020  nt version of.  
+00000db0: 2020 2020 6974 2064 6f65 7320 6e6f 7420      it does not 
+00000dc0: 6465 6c65 7465 2074 6865 2070 7265 7669  delete the previ
+00000dd0: 6f75 7320 7665 7273 696f 6e2c 2062 7574  ous version, but
+00000de0: 2072 6174 6865 7220 6372 6561 7465 7320   rather creates 
+00000df0: 6120 6e65 7720 7665 7273 696f 6e20 6f66  a new version of
+00000e00: 2074 6865 206f 626a 6563 7420 616e 6420   the object and 
+00000e10: 6b65 6570 7320 626f 7468 2076 6572 7369  keeps both versi
+00000e20: 6f6e 732e 0a20 2020 2020 2056 6572 7369  ons..      Versi
+00000e30: 6f6e 6564 206f 626a 6563 7473 2075 7375  oned objects usu
+00000e40: 616c 6c79 2068 6176 6520 6120 6060 7569  ally have a ``ui
+00000e50: 6460 6020 7072 6f70 6572 7479 2077 6869  d`` property whi
+00000e60: 6368 2069 7320 6261 7365 6420 6f6e 2074  ch is based on t
+00000e70: 6865 6972 2063 6f6e 7465 6e74 2061 6e64  heir content and
+00000e80: 2061 6c6c 6f77 7320 746f 2072 6566 6572   allows to refer
+00000e90: 656e 6365 2061 0a20 2020 2020 2073 7065  ence a.      spe
+00000ea0: 6369 6669 6320 7665 7273 696f 6e20 6f66  cific version of
+00000eb0: 2061 6e20 6f62 6a65 6374 2028 6f74 6865   an object (othe
+00000ec0: 7220 7468 616e 2074 6167 6769 6e67 206f  r than tagging o
+00000ed0: 626a 6563 7473 2c20 7768 6963 6820 616c  bjects, which al
+00000ee0: 736f 2061 6c6c 6f77 7320 666f 7220 6561  so allows for ea
+00000ef0: 7379 2072 6566 6572 656e 6369 6e67 292e  sy referencing).
+00000f00: 0a20 2020 202d 204d 616e 7920 6f62 6a65  .    - Many obje
+00000f10: 6374 7320 6861 7665 2062 6f74 6820 6120  cts have both a 
+00000f20: 6060 7374 6f72 6560 6020 6675 6e63 7469  ``store`` functi
+00000f30: 6f6e 2061 6e64 2061 2060 6070 6174 6368  on and a ``patch
+00000f40: 6060 2066 756e 6374 696f 6e2e 2054 6865  `` function. The
+00000f50: 7365 2061 7265 2075 7365 6420 696e 2074  se are used in t
+00000f60: 6865 2073 616d 6520 7761 7920 6173 2074  he same way as t
+00000f70: 6865 0a20 2020 2020 2063 6f72 7265 7370  he.      corresp
+00000f80: 6f6e 6469 6e67 2052 4553 5420 7665 7262  onding REST verb
+00000f90: 7320 2d20 6120 6060 7374 6f72 6560 6020  s - a ``store`` 
+00000fa0: 6973 2070 6173 7365 6420 6120 6675 6c6c  is passed a full
+00000fb0: 206f 626a 6563 7420 616e 6420 7769 6c6c   object and will
+00000fc0: 2062 6173 6963 616c 6c79 2070 6572 666f   basically perfo
+00000fd0: 726d 2061 2050 5554 206f 7065 7261 7469  rm a PUT operati
+00000fe0: 6f6e 2c0a 2020 2020 2020 7265 706c 6163  on,.      replac
+00000ff0: 696e 6720 7468 6520 6675 6c6c 206f 626a  ing the full obj
+00001000: 6563 7420 2869 6620 6974 2065 7869 7374  ect (if it exist
+00001010: 7329 2077 6869 6c65 2060 6070 6174 6368  s) while ``patch
+00001020: 6060 2072 6563 6569 7665 7320 6a75 7374  `` receives just
+00001030: 2061 2064 6963 7469 6f6e 6172 7920 636f   a dictionary co
+00001040: 6e74 6169 6e69 6e67 2074 6865 2064 6966  ntaining the dif
+00001050: 6665 7265 6e63 6573 2074 6f0a 2020 2020  ferences to.    
+00001060: 2020 6265 2061 7070 6c69 6564 2074 6f20    be applied to 
+00001070: 7468 6520 6f62 6a65 6374 2c20 616e 6420  the object, and 
+00001080: 7769 6c6c 206d 6572 6765 2074 686f 7365  will merge those
+00001090: 2063 6861 6e67 6573 2074 6f20 7468 6520   changes to the 
+000010a0: 6578 6973 7469 6e67 206f 626a 6563 742e  existing object.
+000010b0: 2054 6865 2060 6070 6174 6368 6060 0a20   The ``patch``. 
+000010c0: 2020 2020 206f 7065 7261 7469 6f6e 2061       operation a
+000010d0: 6c73 6f20 6861 7320 6120 7374 7261 7465  lso has a strate
+000010e0: 6779 2061 7373 6967 6e65 6420 746f 2069  gy assigned to i
+000010f0: 7420 7768 6963 6820 6465 7465 726d 696e  t which determin
+00001100: 6573 2068 6f77 2074 6865 206d 6572 6765  es how the merge
+00001110: 206c 6f67 6963 2073 686f 756c 6420 6265   logic should be
+00001120: 6861 7665 2e0a 2020 2020 2020 5468 6520  have..      The 
+00001130: 7374 7261 7465 6779 2063 616e 2062 6520  strategy can be 
+00001140: 6569 7468 6572 2060 6072 6570 6c61 6365  either ``replace
+00001150: 6060 206f 7220 6060 6164 6469 7469 7665  `` or ``additive
+00001160: 6060 2e20 466f 7220 6675 7274 6865 7220  ``. For further 
+00001170: 6465 7461 696c 7320 6f6e 2074 686f 7365  details on those
+00001180: 2073 7472 6174 6567 6965 732c 2072 6566   strategies, ref
+00001190: 6572 0a20 2020 2020 2074 6f20 6874 7470  er.      to http
+000011a0: 733a 2f2f 7079 7069 2e6f 7267 2f70 726f  s://pypi.org/pro
+000011b0: 6a65 6374 2f6d 6572 6765 6465 6570 2f0a  ject/mergedeep/.
+000011c0: 2020 2020 2222 220a 0a20 2020 206b 696e      """..    kin
+000011d0: 6420 3d20 2268 7474 7022 0a0a 2020 2020  d = "http"..    
+000011e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000011f0: 662c 2062 6173 655f 7572 6c2c 2075 7365  f, base_url, use
+00001200: 723d 2222 2c20 7061 7373 776f 7264 3d22  r="", password="
+00001210: 222c 2074 6f6b 656e 3d22 2229 3a0a 2020  ", token=""):.  
+00001220: 2020 2020 2020 7365 6c66 2e62 6173 655f        self.base_
+00001230: 7572 6c20 3d20 6261 7365 5f75 726c 0a20  url = base_url. 
+00001240: 2020 2020 2020 2073 656c 662e 7573 6572         self.user
+00001250: 203d 2075 7365 720a 2020 2020 2020 2020   = user.        
+00001260: 7365 6c66 2e70 6173 7377 6f72 6420 3d20  self.password = 
+00001270: 7061 7373 776f 7264 0a20 2020 2020 2020  password.       
+00001280: 2073 656c 662e 746f 6b65 6e20 3d20 746f   self.token = to
+00001290: 6b65 6e0a 2020 2020 2020 2020 7365 6c66  ken.        self
+000012a0: 2e73 6572 7665 725f 7665 7273 696f 6e20  .server_version 
+000012b0: 3d20 2222 0a20 2020 2020 2020 2073 656c  = "".        sel
+000012c0: 662e 7365 7373 696f 6e20 3d20 4e6f 6e65  f.session = None
+000012d0: 0a20 2020 2020 2020 2073 656c 662e 5f77  .        self._w
+000012e0: 6169 745f 666f 725f 7072 6f6a 6563 745f  ait_for_project_
+000012f0: 7465 726d 696e 616c 5f73 7461 7465 5f72  terminal_state_r
+00001300: 6574 7279 5f69 6e74 6572 7661 6c20 3d20  etry_interval = 
+00001310: 330a 2020 2020 2020 2020 7365 6c66 2e5f  3.        self._
+00001320: 7761 6974 5f66 6f72 5f62 6163 6b67 726f  wait_for_backgro
+00001330: 756e 645f 7461 736b 5f74 6572 6d69 6e61  und_task_termina
+00001340: 6c5f 7374 6174 655f 7265 7472 795f 696e  l_state_retry_in
+00001350: 7465 7276 616c 203d 2033 0a20 2020 2020  terval = 3.     
+00001360: 2020 2073 656c 662e 5f77 6169 745f 666f     self._wait_fo
+00001370: 725f 7072 6f6a 6563 745f 6465 6c65 7469  r_project_deleti
+00001380: 6f6e 5f69 6e74 6572 7661 6c20 3d20 330a  on_interval = 3.
+00001390: 2020 2020 2020 2020 7365 6c66 2e63 6c69          self.cli
+000013a0: 656e 745f 7665 7273 696f 6e20 3d20 7665  ent_version = ve
+000013b0: 7273 696f 6e2e 5665 7273 696f 6e28 292e  rsion.Version().
+000013c0: 6765 7428 295b 2276 6572 7369 6f6e 225d  get()["version"]
+000013d0: 0a20 2020 2020 2020 2073 656c 662e 7079  .        self.py
+000013e0: 7468 6f6e 5f76 6572 7369 6f6e 203d 2073  thon_version = s
+000013f0: 7472 2876 6572 7369 6f6e 2e56 6572 7369  tr(version.Versi
+00001400: 6f6e 2829 2e67 6574 5f70 7974 686f 6e5f  on().get_python_
+00001410: 7665 7273 696f 6e28 2929 0a0a 2020 2020  version())..    
+00001420: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+00001430: 6629 3a0a 2020 2020 2020 2020 636c 7320  f):.        cls 
+00001440: 3d20 7365 6c66 2e5f 5f63 6c61 7373 5f5f  = self.__class__
+00001450: 2e5f 5f6e 616d 655f 5f0a 2020 2020 2020  .__name__.      
+00001460: 2020 7265 7475 726e 2066 227b 636c 737d    return f"{cls}
+00001470: 287b 7365 6c66 2e62 6173 655f 7572 6c21  ({self.base_url!
+00001480: 727d 2922 0a0a 2020 2020 4073 7461 7469  r})"..    @stati
+00001490: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+000014a0: 6765 745f 6170 695f 7061 7468 5f70 7265  get_api_path_pre
+000014b0: 6669 7828 7665 7273 696f 6e3a 2073 7472  fix(version: str
+000014c0: 203d 204e 6f6e 6529 202d 3e20 7374 723a   = None) -> str:
+000014d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000014e0: 2020 2020 203a 7061 7261 6d20 7665 7273       :param vers
+000014f0: 696f 6e3a 2041 5049 2076 6572 7369 6f6e  ion: API version
+00001500: 2074 6f20 7573 652c 204e 6f6e 6520 2874   to use, None (t
+00001510: 6865 2064 6566 6175 6c74 2920 7769 6c6c  he default) will
+00001520: 206d 6561 6e20 746f 2075 7365 2074 6865   mean to use the
+00001530: 2064 6566 6175 6c74 2076 616c 7565 2066   default value f
+00001540: 726f 6d20 6d6c 636f 6e66 2c0a 2020 2020  rom mlconf,.    
+00001550: 2020 2020 2066 6f72 2075 6e2d 7665 7273       for un-vers
+00001560: 696f 6e65 6420 6170 6920 7365 7420 616e  ioned api set an
+00001570: 2065 6d70 7479 2073 7472 696e 672e 0a20   empty string.. 
+00001580: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00001590: 2020 2069 6620 7665 7273 696f 6e20 6973     if version is
+000015a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000015b0: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
+000015c0: 6170 692f 7b76 6572 7369 6f6e 7d22 2069  api/{version}" i
+000015d0: 6620 7665 7273 696f 6e20 656c 7365 2022  f version else "
+000015e0: 6170 6922 0a0a 2020 2020 2020 2020 6170  api"..        ap
+000015f0: 695f 7665 7273 696f 6e5f 7061 7468 203d  i_version_path =
+00001600: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
+00001610: 2261 7069 2f7b 636f 6e66 6967 2e61 7069  "api/{config.api
+00001620: 5f62 6173 655f 7665 7273 696f 6e7d 2220  _base_version}" 
+00001630: 6966 2063 6f6e 6669 672e 6170 695f 6261  if config.api_ba
+00001640: 7365 5f76 6572 7369 6f6e 2065 6c73 6520  se_version else 
+00001650: 2261 7069 220a 2020 2020 2020 2020 290a  "api".        ).
+00001660: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00001670: 7069 5f76 6572 7369 6f6e 5f70 6174 680a  pi_version_path.
+00001680: 0a20 2020 2064 6566 2067 6574 5f62 6173  .    def get_bas
+00001690: 655f 6170 695f 7572 6c28 7365 6c66 2c20  e_api_url(self, 
+000016a0: 7061 7468 3a20 7374 722c 2076 6572 7369  path: str, versi
+000016b0: 6f6e 3a20 7374 7220 3d20 4e6f 6e65 2920  on: str = None) 
+000016c0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+000016d0: 7061 7468 5f70 7265 6669 7820 3d20 7365  path_prefix = se
+000016e0: 6c66 2e67 6574 5f61 7069 5f70 6174 685f  lf.get_api_path_
+000016f0: 7072 6566 6978 2876 6572 7369 6f6e 290a  prefix(version).
+00001700: 2020 2020 2020 2020 7572 6c20 3d20 6622          url = f"
+00001710: 7b73 656c 662e 6261 7365 5f75 726c 7d2f  {self.base_url}/
+00001720: 7b70 6174 685f 7072 6566 6978 7d2f 7b70  {path_prefix}/{p
+00001730: 6174 687d 220a 2020 2020 2020 2020 7265  ath}".        re
+00001740: 7475 726e 2075 726c 0a0a 2020 2020 6465  turn url..    de
+00001750: 6620 6170 695f 6361 6c6c 280a 2020 2020  f api_call(.    
+00001760: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00001770: 2020 6d65 7468 6f64 2c0a 2020 2020 2020    method,.      
+00001780: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
+00001790: 6572 726f 723d 4e6f 6e65 2c0a 2020 2020  error=None,.    
+000017a0: 2020 2020 7061 7261 6d73 3d4e 6f6e 652c      params=None,
+000017b0: 0a20 2020 2020 2020 2062 6f64 793d 4e6f  .        body=No
+000017c0: 6e65 2c0a 2020 2020 2020 2020 6a73 6f6e  ne,.        json
+000017d0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2068  =None,.        h
+000017e0: 6561 6465 7273 3d4e 6f6e 652c 0a20 2020  eaders=None,.   
+000017f0: 2020 2020 2074 696d 656f 7574 3d34 352c       timeout=45,
+00001800: 0a20 2020 2020 2020 2076 6572 7369 6f6e  .        version
+00001810: 3d4e 6f6e 652c 0a20 2020 2029 3a0a 2020  =None,.    ):.  
+00001820: 2020 2020 2020 2222 2250 6572 666f 726d        """Perform
+00001830: 2061 2064 6972 6563 7420 5245 5354 2041   a direct REST A
+00001840: 5049 2063 616c 6c20 6f6e 2074 6865 203a  PI call on the :
+00001850: 7079 3a6d 6f64 3a60 6d6c 7275 6e60 2041  py:mod:`mlrun` A
+00001860: 5049 2073 6572 7665 722e 0a0a 2020 2020  PI server...    
+00001870: 2020 2020 4361 7574 696f 6e3a 0a20 2020      Caution:.   
+00001880: 2020 2020 2020 2020 2046 6f72 2061 6476           For adv
+00001890: 616e 6365 6420 7573 6167 6520 2d20 7072  anced usage - pr
+000018a0: 6566 6572 2075 7369 6e67 2074 6865 2076  efer using the v
+000018b0: 6172 696f 7573 2041 5049 7320 6578 706f  arious APIs expo
+000018c0: 7365 6420 7468 726f 7567 6820 7468 6973  sed through this
+000018d0: 2063 6c61 7373 2c20 7261 7468 6572 2074   class, rather t
+000018e0: 6861 6e0a 2020 2020 2020 2020 2020 2020  han.            
+000018f0: 6469 7265 6374 6c79 2069 6e76 6f6b 696e  directly invokin
+00001900: 6720 5245 5354 2063 616c 6c73 2e0a 0a20  g REST calls... 
+00001910: 2020 2020 2020 203a 7061 7261 6d20 6d65         :param me
+00001920: 7468 6f64 3a20 5245 5354 206d 6574 686f  thod: REST metho
+00001930: 6420 2850 4f53 542c 2047 4554 2c20 5055  d (POST, GET, PU
+00001940: 542e 2e2e 290a 2020 2020 2020 2020 3a70  T...).        :p
+00001950: 6172 616d 2070 6174 683a 2050 6174 6820  aram path: Path 
+00001960: 746f 2065 6e64 706f 696e 7420 6578 6563  to endpoint exec
+00001970: 7574 6564 2c20 666f 7220 6578 616d 706c  uted, for exampl
+00001980: 6520 6060 2270 726f 6a65 6374 7322 6060  e ``"projects"``
+00001990: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000019a0: 6572 726f 723a 2045 7272 6f72 2074 6f20  error: Error to 
+000019b0: 7265 7475 726e 2069 6620 4150 4920 696e  return if API in
+000019c0: 766f 6361 7469 6f6e 2066 6169 6c73 0a20  vocation fails. 
+000019d0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+000019e0: 7261 6d73 3a20 5265 7374 2070 6172 616d  rams: Rest param
+000019f0: 6574 6572 732c 2070 6173 7365 6420 6173  eters, passed as
+00001a00: 2061 2064 6963 7469 6f6e 6172 793a 2060   a dictionary: `
+00001a10: 607b 223c 7061 7261 6d2d 6e61 6d65 3e22  `{"<param-name>"
+00001a20: 3a20 3c22 7061 7261 6d2d 7661 6c75 6522  : <"param-value"
+00001a30: 3e7d 6060 0a20 2020 2020 2020 203a 7061  >}``.        :pa
+00001a40: 7261 6d20 626f 6479 3a20 5061 796c 6f61  ram body: Payloa
+00001a50: 6420 746f 2062 6520 7061 7373 6564 2069  d to be passed i
+00001a60: 6e20 7468 6520 6361 6c6c 2e20 4966 2075  n the call. If u
+00001a70: 7369 6e67 204a 534f 4e20 6f62 6a65 6374  sing JSON object
+00001a80: 732c 2070 7265 6665 7220 7573 696e 6720  s, prefer using 
+00001a90: 7468 6520 6060 6a73 6f6e 6060 2070 6172  the ``json`` par
+00001aa0: 616d 0a20 2020 2020 2020 203a 7061 7261  am.        :para
+00001ab0: 6d20 6a73 6f6e 3a20 4a53 4f4e 2070 6179  m json: JSON pay
+00001ac0: 6c6f 6164 2074 6f20 6265 2070 6173 7365  load to be passe
+00001ad0: 6420 696e 2074 6865 2063 616c 6c0a 2020  d in the call.  
+00001ae0: 2020 2020 2020 3a70 6172 616d 2068 6561        :param hea
+00001af0: 6465 7273 3a20 5245 5354 2068 6561 6465  ders: REST heade
+00001b00: 7273 2c20 7061 7373 6564 2061 7320 6120  rs, passed as a 
+00001b10: 6469 6374 696f 6e61 7279 3a20 6060 7b22  dictionary: ``{"
+00001b20: 3c68 6561 6465 722d 6e61 6d65 3e22 3a20  <header-name>": 
+00001b30: 223c 6865 6164 6572 2d76 616c 7565 3e22  "<header-value>"
+00001b40: 7d60 600a 2020 2020 2020 2020 3a70 6172  }``.        :par
+00001b50: 616d 2074 696d 656f 7574 3a20 4150 4920  am timeout: API 
+00001b60: 6361 6c6c 2074 696d 656f 7574 0a20 2020  call timeout.   
+00001b70: 2020 2020 203a 7061 7261 6d20 7665 7273       :param vers
+00001b80: 696f 6e3a 2041 5049 2076 6572 7369 6f6e  ion: API version
+00001b90: 2074 6f20 7573 652c 204e 6f6e 6520 2874   to use, None (t
+00001ba0: 6865 2064 6566 6175 6c74 2920 7769 6c6c  he default) will
+00001bb0: 206d 6561 6e20 746f 2075 7365 2074 6865   mean to use the
+00001bc0: 2064 6566 6175 6c74 2076 616c 7565 2066   default value f
+00001bd0: 726f 6d20 636f 6e66 6967 2c0a 2020 2020  rom config,.    
+00001be0: 2020 2020 2066 6f72 2075 6e2d 7665 7273       for un-vers
+00001bf0: 696f 6e65 6420 6170 6920 7365 7420 616e  ioned api set an
+00001c00: 2065 6d70 7479 2073 7472 696e 672e 0a0a   empty string...
+00001c10: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00001c20: 2050 7974 686f 6e20 4854 5450 2072 6573   Python HTTP res
+00001c30: 706f 6e73 6520 6f62 6a65 6374 0a20 2020  ponse object.   
+00001c40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00001c50: 2075 726c 203d 2073 656c 662e 6765 745f   url = self.get_
+00001c60: 6261 7365 5f61 7069 5f75 726c 2870 6174  base_api_url(pat
+00001c70: 682c 2076 6572 7369 6f6e 290a 2020 2020  h, version).    
+00001c80: 2020 2020 6b77 203d 207b 0a20 2020 2020      kw = {.     
+00001c90: 2020 2020 2020 206b 6579 3a20 7661 6c75         key: valu
+00001ca0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+00001cb0: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+00001cc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00001cd0: 2020 2822 7061 7261 6d73 222c 2070 6172    ("params", par
+00001ce0: 616d 7329 2c0a 2020 2020 2020 2020 2020  ams),.          
+00001cf0: 2020 2020 2020 2822 6461 7461 222c 2062        ("data", b
+00001d00: 6f64 7929 2c0a 2020 2020 2020 2020 2020  ody),.          
+00001d10: 2020 2020 2020 2822 6a73 6f6e 222c 206a        ("json", j
+00001d20: 736f 6e29 2c0a 2020 2020 2020 2020 2020  son),.          
+00001d30: 2020 2020 2020 2822 6865 6164 6572 7322        ("headers"
+00001d40: 2c20 6865 6164 6572 7329 2c0a 2020 2020  , headers),.    
+00001d50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00001d60: 2020 2020 2020 6966 2076 616c 7565 2069        if value i
+00001d70: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+00001d80: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
+00001d90: 2073 656c 662e 7573 6572 3a0a 2020 2020   self.user:.    
+00001da0: 2020 2020 2020 2020 6b77 5b22 6175 7468          kw["auth
+00001db0: 225d 203d 2028 7365 6c66 2e75 7365 722c  "] = (self.user,
+00001dc0: 2073 656c 662e 7061 7373 776f 7264 290a   self.password).
+00001dd0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00001de0: 662e 746f 6b65 6e3a 0a20 2020 2020 2020  f.token:.       
+00001df0: 2020 2020 2023 2049 6775 617a 696f 2061       # Iguazio a
+00001e00: 7574 6820 646f 6573 6e27 7420 7375 7070  uth doesn't supp
+00001e10: 6f72 7420 7061 7373 696e 6720 746f 6b65  ort passing toke
+00001e20: 6e20 7468 726f 7567 6820 6265 6172 6572  n through bearer
+00001e30: 2c20 736f 2075 7365 2063 6f6f 6b69 6520  , so use cookie 
+00001e40: 696e 7374 6561 640a 2020 2020 2020 2020  instead.        
+00001e50: 2020 2020 6966 206d 6c72 756e 2e70 6c61      if mlrun.pla
+00001e60: 7466 6f72 6d73 2e69 6775 617a 696f 2e69  tforms.iguazio.i
+00001e70: 735f 6967 7561 7a69 6f5f 7365 7373 696f  s_iguazio_sessio
+00001e80: 6e28 7365 6c66 2e74 6f6b 656e 293a 0a20  n(self.token):. 
+00001e90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00001ea0: 6573 7369 6f6e 5f63 6f6f 6b69 6520 3d20  ession_cookie = 
+00001eb0: 6627 6a3a 7b7b 2273 6964 223a 2022 7b73  f'j:{{"sid": "{s
+00001ec0: 656c 662e 746f 6b65 6e7d 227d 7d27 0a20  elf.token}"}}'. 
+00001ed0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00001ee0: 6f6f 6b69 6573 203d 207b 0a20 2020 2020  ookies = {.     
+00001ef0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00001f00: 7365 7373 696f 6e22 3a20 7365 7373 696f  session": sessio
+00001f10: 6e5f 636f 6f6b 6965 2c0a 2020 2020 2020  n_cookie,.      
+00001f20: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00001f30: 2020 2020 2020 2020 2020 2020 6b77 5b22              kw["
+00001f40: 636f 6f6b 6965 7322 5d20 3d20 636f 6f6b  cookies"] = cook
+00001f50: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
+00001f60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00001f70: 2020 2020 2020 6966 2022 4175 7468 6f72        if "Author
+00001f80: 697a 6174 696f 6e22 206e 6f74 2069 6e20  ization" not in 
+00001f90: 6b77 2e73 6574 6465 6661 756c 7428 2268  kw.setdefault("h
+00001fa0: 6561 6465 7273 222c 207b 7d29 3a0a 2020  eaders", {}):.  
+00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001fc0: 2020 6b77 5b22 6865 6164 6572 7322 5d2e    kw["headers"].
+00001fd0: 7570 6461 7465 287b 2241 7574 686f 7269  update({"Authori
+00001fe0: 7a61 7469 6f6e 223a 2022 4265 6172 6572  zation": "Bearer
+00001ff0: 2022 202b 2073 656c 662e 746f 6b65 6e7d   " + self.token}
+00002000: 290a 0a20 2020 2020 2020 2069 6620 6d6c  )..        if ml
+00002010: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00002020: 6173 2e48 6561 6465 724e 616d 6573 2e63  as.HeaderNames.c
+00002030: 6c69 656e 745f 7665 7273 696f 6e20 6e6f  lient_version no
+00002040: 7420 696e 206b 772e 7365 7464 6566 6175  t in kw.setdefau
+00002050: 6c74 280a 2020 2020 2020 2020 2020 2020  lt(.            
+00002060: 2268 6561 6465 7273 222c 207b 7d0a 2020  "headers", {}.  
+00002070: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00002080: 2020 2020 206b 775b 2268 6561 6465 7273       kw["headers
+00002090: 225d 2e75 7064 6174 6528 0a20 2020 2020  "].update(.     
+000020a0: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
+000020b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000020c0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+000020d0: 6865 6d61 732e 4865 6164 6572 4e61 6d65  hemas.HeaderName
+000020e0: 732e 636c 6965 6e74 5f76 6572 7369 6f6e  s.client_version
+000020f0: 3a20 7365 6c66 2e63 6c69 656e 745f 7665  : self.client_ve
+00002100: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
+00002110: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
+00002120: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00002130: 4865 6164 6572 4e61 6d65 732e 7079 7468  HeaderNames.pyth
+00002140: 6f6e 5f76 6572 7369 6f6e 3a20 7365 6c66  on_version: self
+00002150: 2e70 7974 686f 6e5f 7665 7273 696f 6e2c  .python_version,
+00002160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002170: 207d 0a20 2020 2020 2020 2020 2020 2029   }.            )
+00002180: 0a0a 2020 2020 2020 2020 2320 7265 7175  ..        # requ
+00002190: 6573 7473 206e 6f20 6c6f 6e67 6572 2073  ests no longer s
+000021a0: 7570 706f 7274 7320 6865 6164 6572 2076  upports header v
+000021b0: 616c 7565 7320 746f 2062 6520 656e 756d  alues to be enum
+000021c0: 2028 6874 7470 733a 2f2f 6769 7468 7562   (https://github
+000021d0: 2e63 6f6d 2f70 7366 2f72 6571 7565 7374  .com/psf/request
+000021e0: 732f 7075 6c6c 2f36 3135 3429 0a20 2020  s/pull/6154).   
+000021f0: 2020 2020 2023 2063 6f6e 7665 7274 2074       # convert t
+00002200: 6f20 7374 7269 6e67 732e 2044 6f20 7468  o strings. Do th
+00002210: 6520 7361 6d65 2066 6f72 2070 6172 616d  e same for param
+00002220: 7320 666f 7220 6e69 6365 6e65 7373 0a20  s for niceness. 
+00002230: 2020 2020 2020 2066 6f72 2064 6963 745f         for dict_
+00002240: 2069 6e20 5b68 6561 6465 7273 2c20 7061   in [headers, pa
+00002250: 7261 6d73 5d3a 0a20 2020 2020 2020 2020  rams]:.         
+00002260: 2020 2069 6620 6469 6374 5f20 6973 206e     if dict_ is n
+00002270: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00002280: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+00002290: 2069 6e20 6469 6374 5f2e 6b65 7973 2829   in dict_.keys()
+000022a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000022b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000022c0: 6e63 6528 6469 6374 5f5b 6b65 795d 2c20  nce(dict_[key], 
+000022d0: 656e 756d 2e45 6e75 6d29 3a0a 2020 2020  enum.Enum):.    
+000022e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022f0: 2020 2020 6469 6374 5f5b 6b65 795d 203d      dict_[key] =
+00002300: 2064 6963 745f 5b6b 6579 5d2e 7661 6c75   dict_[key].valu
+00002310: 650a 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
+00002320: 7420 7365 6c66 2e73 6573 7369 6f6e 3a0a  t self.session:.
+00002330: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002340: 2e73 6573 7369 6f6e 203d 2073 656c 662e  .session = self.
+00002350: 5f69 6e69 745f 7365 7373 696f 6e28 290a  _init_session().
+00002360: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00002370: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+00002380: 7365 203d 2073 656c 662e 7365 7373 696f  se = self.sessio
+00002390: 6e2e 7265 7175 6573 7428 0a20 2020 2020  n.request(.     
+000023a0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+000023b0: 642c 2075 726c 2c20 7469 6d65 6f75 743d  d, url, timeout=
+000023c0: 7469 6d65 6f75 742c 2076 6572 6966 793d  timeout, verify=
+000023d0: 4661 6c73 652c 202a 2a6b 770a 2020 2020  False, **kw.    
+000023e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000023f0: 2020 6578 6365 7074 2072 6571 7565 7374    except request
+00002400: 732e 5265 7175 6573 7445 7863 6570 7469  s.RequestExcepti
+00002410: 6f6e 2061 7320 6578 633a 0a20 2020 2020  on as exc:.     
+00002420: 2020 2020 2020 2065 7272 6f72 203d 2066         error = f
+00002430: 227b 6572 725f 746f 5f73 7472 2865 7863  "{err_to_str(exc
+00002440: 297d 3a20 7b65 7272 6f72 7d22 2069 6620  )}: {error}" if 
+00002450: 6572 726f 7220 656c 7365 2065 7272 5f74  error else err_t
+00002460: 6f5f 7374 7228 6578 6329 0a20 2020 2020  o_str(exc).     
+00002470: 2020 2020 2020 2072 6169 7365 206d 6c72         raise mlr
+00002480: 756e 2e65 7272 6f72 732e 4d4c 5275 6e52  un.errors.MLRunR
+00002490: 756e 7469 6d65 4572 726f 7228 6572 726f  untimeError(erro
+000024a0: 7229 2066 726f 6d20 6578 630a 0a20 2020  r) from exc..   
+000024b0: 2020 2020 2069 6620 6e6f 7420 7265 7370       if not resp
+000024c0: 6f6e 7365 2e6f 6b3a 0a20 2020 2020 2020  onse.ok:.       
+000024d0: 2020 2020 2069 6620 7265 7370 6f6e 7365       if response
+000024e0: 2e63 6f6e 7465 6e74 3a0a 2020 2020 2020  .content:.      
+000024f0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002510: 2020 2064 6174 6120 3d20 7265 7370 6f6e     data = respon
+00002520: 7365 2e6a 736f 6e28 290a 2020 2020 2020  se.json().      
+00002530: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00002540: 726f 725f 6465 7461 696c 7320 3d20 6461  ror_details = da
+00002550: 7461 2e67 6574 2822 6465 7461 696c 222c  ta.get("detail",
+00002560: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
+00002570: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00002580: 6572 726f 725f 6465 7461 696c 733a 0a20  error_details:. 
+00002590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025a0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+000025b0: 726e 696e 6728 2246 6169 6c65 6420 7061  rning("Failed pa
+000025c0: 7273 696e 6720 6572 726f 7220 7265 7370  rsing error resp
+000025d0: 6f6e 7365 2062 6f64 7922 2c20 6461 7461  onse body", data
+000025e0: 3d64 6174 6129 0a20 2020 2020 2020 2020  =data).         
+000025f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00002600: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00002610: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00002620: 6f72 5f64 6574 6169 6c73 203d 2022 220a  or_details = "".
 00002630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002640: 6572 726f 725f 6465 7461 696c 7320 3d20  error_details = 
-00002650: 6622 6465 7461 696c 733a 207b 6572 726f  f"details: {erro
-00002660: 725f 6465 7461 696c 737d 220a 2020 2020  r_details}".    
-00002670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002680: 6572 726f 7220 3d20 6622 7b65 7272 6f72  error = f"{error
-00002690: 7d20 7b65 7272 6f72 5f64 6574 6169 6c73  } {error_details
-000026a0: 7d22 2069 6620 6572 726f 7220 656c 7365  }" if error else
-000026b0: 2065 7272 6f72 5f64 6574 6169 6c73 0a20   error_details. 
-000026c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000026d0: 2020 206d 6c72 756e 2e65 7272 6f72 732e     mlrun.errors.
-000026e0: 7261 6973 655f 666f 725f 7374 6174 7573  raise_for_status
-000026f0: 2872 6573 706f 6e73 652c 2065 7272 6f72  (response, error
-00002700: 290a 0a20 2020 2020 2020 2020 2020 206d  )..            m
-00002710: 6c72 756e 2e65 7272 6f72 732e 7261 6973  lrun.errors.rais
-00002720: 655f 666f 725f 7374 6174 7573 2872 6573  e_for_status(res
-00002730: 706f 6e73 652c 2065 7272 6f72 290a 0a20  ponse, error).. 
-00002740: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00002750: 7370 6f6e 7365 0a0a 2020 2020 6465 6620  sponse..    def 
-00002760: 5f69 6e69 745f 7365 7373 696f 6e28 7365  _init_session(se
-00002770: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00002780: 7572 6e20 6d6c 7275 6e2e 7574 696c 732e  urn mlrun.utils.
-00002790: 4854 5450 5365 7373 696f 6e57 6974 6852  HTTPSessionWithR
-000027a0: 6574 7279 280a 2020 2020 2020 2020 2020  etry(.          
-000027b0: 2020 7265 7472 795f 6f6e 5f65 7863 6570    retry_on_excep
-000027c0: 7469 6f6e 3d63 6f6e 6669 672e 6874 7470  tion=config.http
-000027d0: 6462 2e72 6574 7279 5f61 7069 5f63 616c  db.retry_api_cal
-000027e0: 6c5f 6f6e 5f65 7863 6570 7469 6f6e 0a20  l_on_exception. 
-000027f0: 2020 2020 2020 2020 2020 203d 3d20 6d6c             == ml
-00002800: 7275 6e2e 6170 692e 7363 6865 6d61 732e  run.api.schemas.
-00002810: 4854 5450 5365 7373 696f 6e52 6574 7279  HTTPSessionRetry
-00002820: 4d6f 6465 2e65 6e61 626c 6564 2e76 616c  Mode.enabled.val
-00002830: 7565 0a20 2020 2020 2020 2029 0a0a 2020  ue.        )..  
-00002840: 2020 6465 6620 5f70 6174 685f 6f66 2873    def _path_of(s
-00002850: 656c 662c 2070 7265 6669 782c 2070 726f  elf, prefix, pro
-00002860: 6a65 6374 2c20 7569 6429 3a0a 2020 2020  ject, uid):.    
-00002870: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-00002880: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-00002890: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-000028a0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-000028b0: 227b 7072 6566 6978 7d2f 7b70 726f 6a65  "{prefix}/{proje
-000028c0: 6374 7d2f 7b75 6964 7d22 0a0a 2020 2020  ct}/{uid}"..    
-000028d0: 6465 6620 636f 6e6e 6563 7428 7365 6c66  def connect(self
-000028e0: 2c20 7365 6372 6574 733d 4e6f 6e65 293a  , secrets=None):
-000028f0: 0a20 2020 2020 2020 2022 2222 436f 6e6e  .        """Conn
-00002900: 6563 7420 746f 2074 6865 204d 4c52 756e  ect to the MLRun
-00002910: 2041 5049 2073 6572 7665 722e 204d 7573   API server. Mus
-00002920: 7420 6265 2063 616c 6c65 6420 7072 696f  t be called prio
-00002930: 7220 746f 2065 7865 6375 7469 6e67 2061  r to executing a
-00002940: 6e79 206f 7468 6572 206d 6574 686f 642e  ny other method.
-00002950: 0a20 2020 2020 2020 2054 6865 2063 6f64  .        The cod
-00002960: 6520 7574 696c 697a 6573 2074 6865 2055  e utilizes the U
-00002970: 524c 2066 6f72 2074 6865 2041 5049 2073  RL for the API s
-00002980: 6572 7665 7220 6672 6f6d 2074 6865 2063  erver from the c
-00002990: 6f6e 6669 6775 7261 7469 6f6e 202d 2060  onfiguration - `
-000029a0: 606d 6c63 6f6e 662e 6462 7061 7468 6060  `mlconf.dbpath``
-000029b0: 2e0a 0a20 2020 2020 2020 2046 6f72 2065  ...        For e
-000029c0: 7861 6d70 6c65 3a3a 0a0a 2020 2020 2020  xample::..      
-000029d0: 2020 2020 2020 6d6c 636f 6e66 2e64 6270        mlconf.dbp
-000029e0: 6174 6820 3d20 6d6c 636f 6e66 2e64 6270  ath = mlconf.dbp
-000029f0: 6174 6820 6f72 2027 6874 7470 3a2f 2f6d  ath or 'http://m
-00002a00: 6c72 756e 2d61 7069 3a38 3038 3027 0a20  lrun-api:8080'. 
-00002a10: 2020 2020 2020 2020 2020 2064 6220 3d20             db = 
-00002a20: 6765 745f 7275 6e5f 6462 2829 2e63 6f6e  get_run_db().con
-00002a30: 6e65 6374 2829 0a20 2020 2020 2020 2022  nect().        "
-00002a40: 2222 0a20 2020 2020 2020 2023 2068 6163  "".        # hac
-00002a50: 6b20 746f 2061 6c6c 6f77 2075 6e69 7420  k to allow unit 
-00002a60: 7465 7374 7320 746f 2069 6e73 7461 6e74  tests to instant
-00002a70: 6961 7465 2048 5454 5052 756e 4442 2077  iate HTTPRunDB w
-00002a80: 6974 686f 7574 2061 2072 6561 6c20 7365  ithout a real se
-00002a90: 7276 6572 2062 6568 696e 640a 2020 2020  rver behind.    
-00002aa0: 2020 2020 6966 2022 6d6f 636b 2d73 6572      if "mock-ser
-00002ab0: 7665 7222 2069 6e20 7365 6c66 2e62 6173  ver" in self.bas
-00002ac0: 655f 7572 6c3a 0a20 2020 2020 2020 2020  e_url:.         
-00002ad0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-00002ae0: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-00002af0: 695f 6361 6c6c 2822 4745 5422 2c20 2263  i_call("GET", "c
-00002b00: 6c69 656e 742d 7370 6563 222c 2074 696d  lient-spec", tim
-00002b10: 656f 7574 3d35 290a 2020 2020 2020 2020  eout=5).        
-00002b20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00002b30: 2073 6572 7665 725f 6366 6720 3d20 7265   server_cfg = re
-00002b40: 7370 2e6a 736f 6e28 290a 2020 2020 2020  sp.json().      
-00002b50: 2020 2020 2020 7365 6c66 2e73 6572 7665        self.serve
-00002b60: 725f 7665 7273 696f 6e20 3d20 7365 7276  r_version = serv
-00002b70: 6572 5f63 6667 5b22 7665 7273 696f 6e22  er_cfg["version"
-00002b80: 5d0a 2020 2020 2020 2020 2020 2020 7365  ].            se
-00002b90: 6c66 2e5f 7661 6c69 6461 7465 5f76 6572  lf._validate_ver
-00002ba0: 7369 6f6e 5f63 6f6d 7061 7469 6269 6c69  sion_compatibili
-00002bb0: 7479 2873 656c 662e 7365 7276 6572 5f76  ty(self.server_v
-00002bc0: 6572 7369 6f6e 2c20 636f 6e66 6967 2e76  ersion, config.v
-00002bd0: 6572 7369 6f6e 290a 2020 2020 2020 2020  ersion).        
-00002be0: 2020 2020 636f 6e66 6967 2e6e 616d 6573      config.names
-00002bf0: 7061 6365 203d 2063 6f6e 6669 672e 6e61  pace = config.na
-00002c00: 6d65 7370 6163 6520 6f72 2073 6572 7665  mespace or serve
-00002c10: 725f 6366 672e 6765 7428 226e 616d 6573  r_cfg.get("names
-00002c20: 7061 6365 2229 0a20 2020 2020 2020 2020  pace").         
-00002c30: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00002c40: 2020 2020 2020 2020 226e 616d 6573 7061          "namespa
-00002c50: 6365 2220 696e 2073 6572 7665 725f 6366  ce" in server_cf
-00002c60: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00002c70: 2020 616e 6420 7365 7276 6572 5f63 6667    and server_cfg
-00002c80: 5b22 6e61 6d65 7370 6163 6522 5d20 213d  ["namespace"] !=
-00002c90: 2063 6f6e 6669 672e 6e61 6d65 7370 6163   config.namespac
-00002ca0: 650a 2020 2020 2020 2020 2020 2020 293a  e.            ):
-00002cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002cc0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-00002cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ce0: 2020 2020 2066 2277 6172 6e69 6e67 212c       f"warning!,
-00002cf0: 2073 6572 7665 7220 287b 7365 7276 6572   server ({server
-00002d00: 5f63 6667 5b27 6e61 6d65 7370 6163 6527  _cfg['namespace'
-00002d10: 5d7d 2920 616e 6420 636c 6965 6e74 2028  ]}) and client (
-00002d20: 7b63 6f6e 6669 672e 6e61 6d65 7370 6163  {config.namespac
-00002d30: 657d 2922 0a20 2020 2020 2020 2020 2020  e})".           
-00002d40: 2020 2020 2020 2020 2022 206e 616d 6573           " names
-00002d50: 7061 6365 2064 6f6e 2774 206d 6174 6368  pace don't match
-00002d60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00002d70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00002d80: 6966 2063 6f6e 6669 672e 6365 2e6d 6f64  if config.ce.mod
-00002d90: 6520 616e 6420 636f 6e66 6967 2e63 652e  e and config.ce.
-00002da0: 6d6f 6465 2021 3d20 7365 7276 6572 5f63  mode != server_c
-00002db0: 6667 2e67 6574 2822 6365 5f6d 6f64 6522  fg.get("ce_mode"
-00002dc0: 2c20 2222 293a 0a20 2020 2020 2020 2020  , ""):.         
-00002dd0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-00002de0: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
-00002df0: 2020 2020 2020 2020 2020 2066 2277 6172             f"war
-00002e00: 6e69 6e67 212c 2073 6572 7665 7220 287b  ning!, server ({
-00002e10: 7365 7276 6572 5f63 6667 5b27 6365 5f6d  server_cfg['ce_m
-00002e20: 6f64 6527 5d7d 2920 616e 6420 636c 6965  ode']}) and clie
-00002e30: 6e74 2028 7b63 6f6e 6669 672e 6365 2e6d  nt ({config.ce.m
-00002e40: 6f64 657d 2922 0a20 2020 2020 2020 2020  ode})".         
-00002e50: 2020 2020 2020 2020 2020 2022 2043 4520             " CE 
-00002e60: 6d6f 6465 2064 6f6e 2774 206d 6174 6368  mode don't match
-00002e70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00002e80: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00002e90: 636f 6e66 6967 2e63 6520 3d20 7365 7276  config.ce = serv
-00002ea0: 6572 5f63 6667 2e67 6574 2822 6365 2229  er_cfg.get("ce")
-00002eb0: 206f 7220 636f 6e66 6967 2e63 650a 0a20   or config.ce.. 
-00002ec0: 2020 2020 2020 2020 2020 2023 2067 6574             # get
-00002ed0: 2064 6566 6175 6c74 7320 6672 6f6d 2072   defaults from r
-00002ee0: 656d 6f74 6520 7365 7276 6572 0a20 2020  emote server.   
-00002ef0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00002f00: 7265 6d6f 7465 5f68 6f73 7420 3d20 636f  remote_host = co
-00002f10: 6e66 6967 2e72 656d 6f74 655f 686f 7374  nfig.remote_host
-00002f20: 206f 7220 7365 7276 6572 5f63 6667 2e67   or server_cfg.g
-00002f30: 6574 2822 7265 6d6f 7465 5f68 6f73 7422  et("remote_host"
-00002f40: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00002f50: 6e66 6967 2e6d 7069 6a6f 625f 6372 645f  nfig.mpijob_crd_
-00002f60: 7665 7273 696f 6e20 3d20 636f 6e66 6967  version = config
-00002f70: 2e6d 7069 6a6f 625f 6372 645f 7665 7273  .mpijob_crd_vers
-00002f80: 696f 6e20 6f72 2073 6572 7665 725f 6366  ion or server_cf
-00002f90: 672e 6765 7428 0a20 2020 2020 2020 2020  g.get(.         
-00002fa0: 2020 2020 2020 2022 6d70 696a 6f62 5f63         "mpijob_c
-00002fb0: 7264 5f76 6572 7369 6f6e 220a 2020 2020  rd_version".    
-00002fc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00002fd0: 2020 2020 2020 636f 6e66 6967 2e75 692e        config.ui.
-00002fe0: 7572 6c20 3d20 636f 6e66 6967 2e72 6573  url = config.res
-00002ff0: 6f6c 7665 5f75 695f 7572 6c28 2920 6f72  olve_ui_url() or
-00003000: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00003010: 2275 695f 7572 6c22 290a 2020 2020 2020  "ui_url").      
-00003020: 2020 2020 2020 636f 6e66 6967 2e61 7274        config.art
-00003030: 6966 6163 745f 7061 7468 203d 2063 6f6e  ifact_path = con
-00003040: 6669 672e 6172 7469 6661 6374 5f70 6174  fig.artifact_pat
-00003050: 6820 6f72 2073 6572 7665 725f 6366 672e  h or server_cfg.
-00003060: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
-00003070: 2020 2020 2022 6172 7469 6661 6374 5f70       "artifact_p
-00003080: 6174 6822 0a20 2020 2020 2020 2020 2020  ath".           
-00003090: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-000030a0: 6f6e 6669 672e 6665 6174 7572 655f 7374  onfig.feature_st
-000030b0: 6f72 652e 6461 7461 5f70 7265 6669 7865  ore.data_prefixe
-000030c0: 7320 3d20 280a 2020 2020 2020 2020 2020  s = (.          
-000030d0: 2020 2020 2020 636f 6e66 6967 2e66 6561        config.fea
-000030e0: 7475 7265 5f73 746f 7265 2e64 6174 615f  ture_store.data_
-000030f0: 7072 6566 6978 6573 0a20 2020 2020 2020  prefixes.       
-00003100: 2020 2020 2020 2020 206f 7220 7365 7276           or serv
-00003110: 6572 5f63 6667 2e67 6574 2822 6665 6174  er_cfg.get("feat
-00003120: 7572 655f 7374 6f72 655f 6461 7461 5f70  ure_store_data_p
-00003130: 7265 6669 7865 7322 290a 2020 2020 2020  refixes").      
-00003140: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00003150: 2020 2020 636f 6e66 6967 2e73 7061 726b      config.spark
-00003160: 5f61 7070 5f69 6d61 6765 203d 2063 6f6e  _app_image = con
-00003170: 6669 672e 7370 6172 6b5f 6170 705f 696d  fig.spark_app_im
-00003180: 6167 6520 6f72 2073 6572 7665 725f 6366  age or server_cf
-00003190: 672e 6765 7428 0a20 2020 2020 2020 2020  g.get(.         
-000031a0: 2020 2020 2020 2022 7370 6172 6b5f 6170         "spark_ap
-000031b0: 705f 696d 6167 6522 0a20 2020 2020 2020  p_image".       
-000031c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000031d0: 2020 2063 6f6e 6669 672e 7370 6172 6b5f     config.spark_
-000031e0: 6170 705f 696d 6167 655f 7461 6720 3d20  app_image_tag = 
-000031f0: 636f 6e66 6967 2e73 7061 726b 5f61 7070  config.spark_app
-00003200: 5f69 6d61 6765 5f74 6167 206f 7220 7365  _image_tag or se
-00003210: 7276 6572 5f63 6667 2e67 6574 280a 2020  rver_cfg.get(.  
-00003220: 2020 2020 2020 2020 2020 2020 2020 2273                "s
-00003230: 7061 726b 5f61 7070 5f69 6d61 6765 5f74  park_app_image_t
-00003240: 6167 220a 2020 2020 2020 2020 2020 2020  ag".            
-00003250: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00003260: 6e66 6967 2e73 7061 726b 5f68 6973 746f  nfig.spark_histo
-00003270: 7279 5f73 6572 7665 725f 7061 7468 203d  ry_server_path =
-00003280: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00003290: 2020 2063 6f6e 6669 672e 7370 6172 6b5f     config.spark_
-000032a0: 6869 7374 6f72 795f 7365 7276 6572 5f70  history_server_p
-000032b0: 6174 680a 2020 2020 2020 2020 2020 2020  ath.            
-000032c0: 2020 2020 6f72 2073 6572 7665 725f 6366      or server_cf
-000032d0: 672e 6765 7428 2273 7061 726b 5f68 6973  g.get("spark_his
-000032e0: 746f 7279 5f73 6572 7665 725f 7061 7468  tory_server_path
-000032f0: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-00003300: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00003310: 6669 672e 6874 7470 6462 2e62 7569 6c64  fig.httpdb.build
-00003320: 6572 2e64 6f63 6b65 725f 7265 6769 7374  er.docker_regist
-00003330: 7279 203d 2028 0a20 2020 2020 2020 2020  ry = (.         
-00003340: 2020 2020 2020 2063 6f6e 6669 672e 6874         config.ht
-00003350: 7470 6462 2e62 7569 6c64 6572 2e64 6f63  tpdb.builder.doc
-00003360: 6b65 725f 7265 6769 7374 7279 0a20 2020  ker_registry.   
-00003370: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-00003380: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003390: 646f 636b 6572 5f72 6567 6973 7472 7922  docker_registry"
-000033a0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-000033b0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-000033c0: 6967 2e68 7474 7064 622e 6170 695f 7572  ig.httpdb.api_ur
-000033d0: 6c20 3d20 636f 6e66 6967 2e68 7474 7064  l = config.httpd
-000033e0: 622e 6170 695f 7572 6c20 6f72 2073 6572  b.api_url or ser
-000033f0: 7665 725f 6366 672e 6765 7428 2261 7069  ver_cfg.get("api
-00003400: 5f75 726c 2229 0a20 2020 2020 2020 2020  _url").         
-00003410: 2020 2063 6f6e 6669 672e 6e75 636c 696f     config.nuclio
-00003420: 5f76 6572 7369 6f6e 203d 2063 6f6e 6669  _version = confi
-00003430: 672e 6e75 636c 696f 5f76 6572 7369 6f6e  g.nuclio_version
-00003440: 206f 7220 7365 7276 6572 5f63 6667 2e67   or server_cfg.g
-00003450: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-00003460: 2020 2020 226e 7563 6c69 6f5f 7665 7273      "nuclio_vers
-00003470: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
-00003480: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-00003490: 6f6e 6669 672e 6465 6661 756c 745f 6675  onfig.default_fu
-000034a0: 6e63 7469 6f6e 5f70 7269 6f72 6974 795f  nction_priority_
-000034b0: 636c 6173 735f 6e61 6d65 203d 2028 0a20  class_name = (. 
-000034c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000034d0: 6f6e 6669 672e 6465 6661 756c 745f 6675  onfig.default_fu
-000034e0: 6e63 7469 6f6e 5f70 7269 6f72 6974 795f  nction_priority_
-000034f0: 636c 6173 735f 6e61 6d65 0a20 2020 2020  class_name.     
-00003500: 2020 2020 2020 2020 2020 206f 7220 7365             or se
-00003510: 7276 6572 5f63 6667 2e67 6574 2822 6465  rver_cfg.get("de
-00003520: 6661 756c 745f 6675 6e63 7469 6f6e 5f70  fault_function_p
-00003530: 7269 6f72 6974 795f 636c 6173 735f 6e61  riority_class_na
-00003540: 6d65 2229 0a20 2020 2020 2020 2020 2020  me").           
-00003550: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-00003560: 6f6e 6669 672e 7661 6c69 645f 6675 6e63  onfig.valid_func
-00003570: 7469 6f6e 5f70 7269 6f72 6974 795f 636c  tion_priority_cl
-00003580: 6173 735f 6e61 6d65 7320 3d20 280a 2020  ass_names = (.  
-00003590: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000035a0: 6e66 6967 2e76 616c 6964 5f66 756e 6374  nfig.valid_funct
-000035b0: 696f 6e5f 7072 696f 7269 7479 5f63 6c61  ion_priority_cla
-000035c0: 7373 5f6e 616d 6573 0a20 2020 2020 2020  ss_names.       
-000035d0: 2020 2020 2020 2020 206f 7220 7365 7276           or serv
-000035e0: 6572 5f63 6667 2e67 6574 2822 7661 6c69  er_cfg.get("vali
-000035f0: 645f 6675 6e63 7469 6f6e 5f70 7269 6f72  d_function_prior
-00003600: 6974 795f 636c 6173 735f 6e61 6d65 7322  ity_class_names"
-00003610: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00003620: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00003630: 6967 2e61 7274 6966 6163 7473 2e63 616c  ig.artifacts.cal
-00003640: 6375 6c61 7465 5f68 6173 6820 3d20 280a  culate_hash = (.
-00003650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003660: 636f 6e66 6967 2e61 7274 6966 6163 7473  config.artifacts
-00003670: 2e63 616c 6375 6c61 7465 5f68 6173 680a  .calculate_hash.
-00003680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003690: 6966 2063 6f6e 6669 672e 6172 7469 6661  if config.artifa
-000036a0: 6374 732e 6361 6c63 756c 6174 655f 6861  cts.calculate_ha
-000036b0: 7368 2069 7320 6e6f 7420 4e6f 6e65 0a20  sh is not None. 
-000036c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000036d0: 6c73 6520 7365 7276 6572 5f63 6667 2e67  lse server_cfg.g
-000036e0: 6574 2822 6361 6c63 756c 6174 655f 6172  et("calculate_ar
-000036f0: 7469 6661 6374 5f68 6173 6822 290a 2020  tifact_hash").  
-00003700: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003710: 2020 2020 2020 2020 636f 6e66 6967 2e61          config.a
-00003720: 7274 6966 6163 7473 2e67 656e 6572 6174  rtifacts.generat
-00003730: 655f 7461 7267 6574 5f70 6174 685f 6672  e_target_path_fr
-00003740: 6f6d 5f61 7274 6966 6163 745f 6861 7368  om_artifact_hash
-00003750: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00003760: 2020 2020 2063 6f6e 6669 672e 6172 7469       config.arti
-00003770: 6661 6374 732e 6765 6e65 7261 7465 5f74  facts.generate_t
-00003780: 6172 6765 745f 7061 7468 5f66 726f 6d5f  arget_path_from_
-00003790: 6172 7469 6661 6374 5f68 6173 680a 2020  artifact_hash.  
-000037a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000037b0: 2063 6f6e 6669 672e 6172 7469 6661 6374   config.artifact
-000037c0: 732e 6765 6e65 7261 7465 5f74 6172 6765  s.generate_targe
-000037d0: 745f 7061 7468 5f66 726f 6d5f 6172 7469  t_path_from_arti
-000037e0: 6661 6374 5f68 6173 6820 6973 206e 6f74  fact_hash is not
-000037f0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00003800: 2020 2020 2020 656c 7365 2073 6572 7665        else serve
-00003810: 725f 6366 672e 6765 7428 2267 656e 6572  r_cfg.get("gener
-00003820: 6174 655f 6172 7469 6661 6374 5f74 6172  ate_artifact_tar
-00003830: 6765 745f 7061 7468 5f66 726f 6d5f 6172  get_path_from_ar
-00003840: 7469 6661 6374 5f68 6173 6822 290a 2020  tifact_hash").  
-00003850: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00003860: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003870: 7265 6469 732e 7572 6c20 3d20 636f 6e66  redis.url = conf
-00003880: 6967 2e72 6564 6973 2e75 726c 206f 7220  ig.redis.url or 
-00003890: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-000038a0: 7265 6469 735f 7572 6c22 290a 2020 2020  redis_url").    
-000038b0: 2020 2020 2020 2020 2320 616c 6c6f 7720          # allow 
-000038c0: 636c 6965 6e74 2074 6f20 7365 7420 7468  client to set th
-000038d0: 6520 6465 6661 756c 7420 7061 7274 6961  e default partia
-000038e0: 6c20 5741 2066 6f72 206c 6163 6b20 6f66  l WA for lack of
-000038f0: 2073 7570 706f 7274 206f 6620 7065 722d   support of per-
-00003900: 7461 7267 6574 2061 7578 696c 6961 7279  target auxiliary
-00003910: 206f 7074 696f 6e73 0a20 2020 2020 2020   options.       
-00003920: 2020 2020 2063 6f6e 6669 672e 7265 6469       config.redi
-00003930: 732e 7479 7065 203d 2063 6f6e 6669 672e  s.type = config.
-00003940: 7265 6469 732e 7479 7065 206f 7220 7365  redis.type or se
-00003950: 7276 6572 5f63 6667 2e67 6574 2822 7265  rver_cfg.get("re
-00003960: 6469 735f 7479 7065 2229 0a0a 2020 2020  dis_type")..    
-00003970: 2020 2020 2020 2020 636f 6e66 6967 2e73          config.s
-00003980: 716c 2e75 726c 203d 2063 6f6e 6669 672e  ql.url = config.
-00003990: 7371 6c2e 7572 6c20 6f72 2073 6572 7665  sql.url or serve
-000039a0: 725f 6366 672e 6765 7428 2273 716c 5f75  r_cfg.get("sql_u
-000039b0: 726c 2229 0a20 2020 2020 2020 2020 2020  rl").           
-000039c0: 2023 2054 6865 7365 2068 6176 6520 6120   # These have a 
-000039d0: 6465 6661 756c 7420 7661 6c75 652c 2074  default value, t
-000039e0: 6865 7265 666f 7265 206c 6f63 616c 2063  herefore local c
-000039f0: 6f6e 6669 6720 7769 6c6c 2061 6c77 6179  onfig will alway
-00003a00: 7320 6861 7665 2061 2076 616c 7565 2c20  s have a value, 
-00003a10: 7072 696f 7269 7469 7a65 2074 6865 0a20  prioritize the. 
-00003a20: 2020 2020 2020 2020 2020 2023 2041 5049             # API
-00003a30: 2076 616c 7565 2066 6972 7374 0a20 2020   value first.   
-00003a40: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003a50: 7569 2e70 726f 6a65 6374 735f 7072 6566  ui.projects_pref
-00003a60: 6978 203d 2028 0a20 2020 2020 2020 2020  ix = (.         
-00003a70: 2020 2020 2020 2073 6572 7665 725f 6366         server_cf
-00003a80: 672e 6765 7428 2275 695f 7072 6f6a 6563  g.get("ui_projec
-00003a90: 7473 5f70 7265 6669 7822 2920 6f72 2063  ts_prefix") or c
-00003aa0: 6f6e 6669 672e 7569 2e70 726f 6a65 6374  onfig.ui.project
-00003ab0: 735f 7072 6566 6978 0a20 2020 2020 2020  s_prefix.       
-00003ac0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00003ad0: 2020 2063 6f6e 6669 672e 6b66 705f 696d     config.kfp_im
-00003ae0: 6167 6520 3d20 7365 7276 6572 5f63 6667  age = server_cfg
-00003af0: 2e67 6574 2822 6b66 705f 696d 6167 6522  .get("kfp_image"
-00003b00: 2920 6f72 2063 6f6e 6669 672e 6b66 705f  ) or config.kfp_
-00003b10: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
-00003b20: 2020 636f 6e66 6967 2e6b 6670 5f75 726c    config.kfp_url
-00003b30: 203d 2073 6572 7665 725f 6366 672e 6765   = server_cfg.ge
-00003b40: 7428 226b 6670 5f75 726c 2229 206f 7220  t("kfp_url") or 
-00003b50: 636f 6e66 6967 2e6b 6670 5f75 726c 0a20  config.kfp_url. 
-00003b60: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00003b70: 672e 6461 736b 5f6b 6670 5f69 6d61 6765  g.dask_kfp_image
-00003b80: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00003b90: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
-00003ba0: 6765 7428 2264 6173 6b5f 6b66 705f 696d  get("dask_kfp_im
-00003bb0: 6167 6522 2920 6f72 2063 6f6e 6669 672e  age") or config.
-00003bc0: 6461 736b 5f6b 6670 5f69 6d61 6765 0a20  dask_kfp_image. 
-00003bd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00003be0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003bf0: 7363 7261 7065 5f6d 6574 7269 6373 203d  scrape_metrics =
-00003c00: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00003c10: 2020 2073 6572 7665 725f 6366 672e 6765     server_cfg.ge
-00003c20: 7428 2273 6372 6170 655f 6d65 7472 6963  t("scrape_metric
-00003c30: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
-00003c40: 2020 2020 6966 2073 6572 7665 725f 6366      if server_cf
-00003c50: 672e 6765 7428 2273 6372 6170 655f 6d65  g.get("scrape_me
-00003c60: 7472 6963 7322 2920 6973 206e 6f74 204e  trics") is not N
-00003c70: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00003c80: 2020 2020 656c 7365 2063 6f6e 6669 672e      else config.
-00003c90: 7363 7261 7065 5f6d 6574 7269 6373 0a20  scrape_metrics. 
-00003ca0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00003cb0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003cc0: 6875 625f 7572 6c20 3d20 7365 7276 6572  hub_url = server
-00003cd0: 5f63 6667 2e67 6574 2822 6875 625f 7572  _cfg.get("hub_ur
-00003ce0: 6c22 2920 6f72 2063 6f6e 6669 672e 6875  l") or config.hu
-00003cf0: 625f 7572 6c0a 2020 2020 2020 2020 2020  b_url.          
-00003d00: 2020 636f 6e66 6967 2e64 6566 6175 6c74    config.default
-00003d10: 5f66 756e 6374 696f 6e5f 6e6f 6465 5f73  _function_node_s
-00003d20: 656c 6563 746f 7220 3d20 280a 2020 2020  elector = (.    
-00003d30: 2020 2020 2020 2020 2020 2020 7365 7276              serv
-00003d40: 6572 5f63 6667 2e67 6574 2822 6465 6661  er_cfg.get("defa
-00003d50: 756c 745f 6675 6e63 7469 6f6e 5f6e 6f64  ult_function_nod
-00003d60: 655f 7365 6c65 6374 6f72 2229 0a20 2020  e_selector").   
-00003d70: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-00003d80: 636f 6e66 6967 2e64 6566 6175 6c74 5f66  config.default_f
-00003d90: 756e 6374 696f 6e5f 6e6f 6465 5f73 656c  unction_node_sel
-00003da0: 6563 746f 720a 2020 2020 2020 2020 2020  ector.          
-00003db0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00003dc0: 636f 6e66 6967 2e69 677a 5f76 6572 7369  config.igz_versi
-00003dd0: 6f6e 203d 2073 6572 7665 725f 6366 672e  on = server_cfg.
-00003de0: 6765 7428 2269 677a 5f76 6572 7369 6f6e  get("igz_version
-00003df0: 2229 206f 7220 636f 6e66 6967 2e69 677a  ") or config.igz
-00003e00: 5f76 6572 7369 6f6e 0a20 2020 2020 2020  _version.       
-00003e10: 2020 2020 2063 6f6e 6669 672e 7374 6f72       config.stor
-00003e20: 6167 652e 6175 746f 5f6d 6f75 6e74 5f74  age.auto_mount_t
-00003e30: 7970 6520 3d20 280a 2020 2020 2020 2020  ype = (.        
-00003e40: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
-00003e50: 6667 2e67 6574 2822 6175 746f 5f6d 6f75  fg.get("auto_mou
-00003e60: 6e74 5f74 7970 6522 2920 6f72 2063 6f6e  nt_type") or con
-00003e70: 6669 672e 7374 6f72 6167 652e 6175 746f  fig.storage.auto
-00003e80: 5f6d 6f75 6e74 5f74 7970 650a 2020 2020  _mount_type.    
-00003e90: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003ea0: 2020 2020 2020 636f 6e66 6967 2e73 746f        config.sto
-00003eb0: 7261 6765 2e61 7574 6f5f 6d6f 756e 745f  rage.auto_mount_
-00003ec0: 7061 7261 6d73 203d 2028 0a20 2020 2020  params = (.     
-00003ed0: 2020 2020 2020 2020 2020 2073 6572 7665             serve
-00003ee0: 725f 6366 672e 6765 7428 2261 7574 6f5f  r_cfg.get("auto_
-00003ef0: 6d6f 756e 745f 7061 7261 6d73 2229 206f  mount_params") o
-00003f00: 7220 636f 6e66 6967 2e73 746f 7261 6765  r config.storage
-00003f10: 2e61 7574 6f5f 6d6f 756e 745f 7061 7261  .auto_mount_para
-00003f20: 6d73 0a20 2020 2020 2020 2020 2020 2029  ms.            )
-00003f30: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00003f40: 6669 672e 7370 6172 6b5f 6f70 6572 6174  fig.spark_operat
-00003f50: 6f72 5f76 6572 7369 6f6e 203d 2028 0a20  or_version = (. 
-00003f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003f70: 6572 7665 725f 6366 672e 6765 7428 2273  erver_cfg.get("s
-00003f80: 7061 726b 5f6f 7065 7261 746f 725f 7665  park_operator_ve
-00003f90: 7273 696f 6e22 290a 2020 2020 2020 2020  rsion").        
-00003fa0: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
-00003fb0: 672e 7370 6172 6b5f 6f70 6572 6174 6f72  g.spark_operator
-00003fc0: 5f76 6572 7369 6f6e 0a20 2020 2020 2020  _version.       
-00003fd0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00003fe0: 2020 2063 6f6e 6669 672e 6465 6661 756c     config.defaul
-00003ff0: 745f 7465 6e73 6f72 626f 6172 645f 6c6f  t_tensorboard_lo
-00004000: 6773 5f70 6174 6820 3d20 280a 2020 2020  gs_path = (.    
-00004010: 2020 2020 2020 2020 2020 2020 7365 7276              serv
-00004020: 6572 5f63 6667 2e67 6574 2822 6465 6661  er_cfg.get("defa
-00004030: 756c 745f 7465 6e73 6f72 626f 6172 645f  ult_tensorboard_
-00004040: 6c6f 6773 5f70 6174 6822 290a 2020 2020  logs_path").    
-00004050: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
-00004060: 6f6e 6669 672e 6465 6661 756c 745f 7465  onfig.default_te
-00004070: 6e73 6f72 626f 6172 645f 6c6f 6773 5f70  nsorboard_logs_p
-00004080: 6174 680a 2020 2020 2020 2020 2020 2020  ath.            
-00004090: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-000040a0: 6e66 6967 2e64 6566 6175 6c74 5f66 756e  nfig.default_fun
-000040b0: 6374 696f 6e5f 706f 645f 7265 736f 7572  ction_pod_resour
-000040c0: 6365 7320 3d20 280a 2020 2020 2020 2020  ces = (.        
-000040d0: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
-000040e0: 6667 2e67 6574 2822 6465 6661 756c 745f  fg.get("default_
-000040f0: 6675 6e63 7469 6f6e 5f70 6f64 5f72 6573  function_pod_res
-00004100: 6f75 7263 6573 2229 0a20 2020 2020 2020  ources").       
-00004110: 2020 2020 2020 2020 206f 7220 636f 6e66           or conf
-00004120: 6967 2e64 6566 6175 6c74 5f66 756e 6374  ig.default_funct
-00004130: 696f 6e5f 706f 645f 7265 736f 7572 6365  ion_pod_resource
-00004140: 730a 2020 2020 2020 2020 2020 2020 290a  s.            ).
-00004150: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00004160: 6967 2e66 756e 6374 696f 6e5f 6465 6661  ig.function_defa
-00004170: 756c 7473 2e70 7265 656d 7074 696f 6e5f  ults.preemption_
-00004180: 6d6f 6465 203d 2028 0a20 2020 2020 2020  mode = (.       
-00004190: 2020 2020 2020 2020 2073 6572 7665 725f           server_
-000041a0: 6366 672e 6765 7428 2264 6566 6175 6c74  cfg.get("default
-000041b0: 5f70 7265 656d 7074 696f 6e5f 6d6f 6465  _preemption_mode
-000041c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000041d0: 2020 206f 7220 636f 6e66 6967 2e66 756e     or config.fun
-000041e0: 6374 696f 6e5f 6465 6661 756c 7473 2e70  ction_defaults.p
-000041f0: 7265 656d 7074 696f 6e5f 6d6f 6465 0a20  reemption_mode. 
-00004200: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004210: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00004220: 7072 6565 6d70 7469 626c 655f 6e6f 6465  preemptible_node
-00004230: 732e 6e6f 6465 5f73 656c 6563 746f 7220  s.node_selector 
-00004240: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00004250: 2020 2020 7365 7276 6572 5f63 6667 2e67      server_cfg.g
-00004260: 6574 2822 7072 6565 6d70 7469 626c 655f  et("preemptible_
-00004270: 6e6f 6465 735f 6e6f 6465 5f73 656c 6563  nodes_node_selec
-00004280: 746f 7222 290a 2020 2020 2020 2020 2020  tor").          
-00004290: 2020 2020 2020 6f72 2063 6f6e 6669 672e        or config.
-000042a0: 7072 6565 6d70 7469 626c 655f 6e6f 6465  preemptible_node
-000042b0: 732e 6e6f 6465 5f73 656c 6563 746f 720a  s.node_selector.
-000042c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000042d0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-000042e0: 2e70 7265 656d 7074 6962 6c65 5f6e 6f64  .preemptible_nod
-000042f0: 6573 2e74 6f6c 6572 6174 696f 6e73 203d  es.tolerations =
-00004300: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00004310: 2020 2073 6572 7665 725f 6366 672e 6765     server_cfg.ge
-00004320: 7428 2270 7265 656d 7074 6962 6c65 5f6e  t("preemptible_n
-00004330: 6f64 6573 5f74 6f6c 6572 6174 696f 6e73  odes_tolerations
-00004340: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00004350: 2020 206f 7220 636f 6e66 6967 2e70 7265     or config.pre
-00004360: 656d 7074 6962 6c65 5f6e 6f64 6573 2e74  emptible_nodes.t
-00004370: 6f6c 6572 6174 696f 6e73 0a20 2020 2020  olerations.     
-00004380: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00004390: 2020 2020 2063 6f6e 6669 672e 666f 7263       config.forc
-000043a0: 655f 7275 6e5f 6c6f 6361 6c20 3d20 280a  e_run_local = (.
-000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043c0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-000043d0: 666f 7263 655f 7275 6e5f 6c6f 6361 6c22  force_run_local"
-000043e0: 2920 6f72 2063 6f6e 6669 672e 666f 7263  ) or config.forc
-000043f0: 655f 7275 6e5f 6c6f 6361 6c0a 2020 2020  e_run_local.    
-00004400: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00004410: 2020 2020 2020 636f 6e66 6967 2e66 756e        config.fun
-00004420: 6374 696f 6e20 3d20 7365 7276 6572 5f63  ction = server_c
-00004430: 6667 2e67 6574 2822 6675 6e63 7469 6f6e  fg.get("function
-00004440: 2229 206f 7220 636f 6e66 6967 2e66 756e  ") or config.fun
-00004450: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
-00004460: 2020 636f 6e66 6967 2e68 7474 7064 622e    config.httpdb.
-00004470: 6c6f 6773 203d 2073 6572 7665 725f 6366  logs = server_cf
-00004480: 672e 6765 7428 226c 6f67 7322 2920 6f72  g.get("logs") or
-00004490: 2063 6f6e 6669 672e 6874 7470 6462 2e6c   config.httpdb.l
-000044a0: 6f67 730a 0a20 2020 2020 2020 2065 7863  ogs..        exc
-000044b0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-000044c0: 2065 7863 3a0a 2020 2020 2020 2020 2020   exc:.          
-000044d0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-000044e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000044f0: 2020 2246 6169 6c65 6420 7379 6e63 696e    "Failed syncin
-00004500: 6720 636f 6e66 6967 2066 726f 6d20 7365  g config from se
-00004510: 7276 6572 222c 0a20 2020 2020 2020 2020  rver",.         
-00004520: 2020 2020 2020 2065 7863 3d65 7272 5f74         exc=err_t
-00004530: 6f5f 7374 7228 6578 6329 2c0a 2020 2020  o_str(exc),.    
-00004540: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-00004550: 6562 6163 6b3d 7472 6163 6562 6163 6b2e  eback=traceback.
-00004560: 666f 726d 6174 5f65 7863 2829 2c0a 2020  format_exc(),.  
-00004570: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00004580: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
-00004590: 0a20 2020 2064 6566 2073 746f 7265 5f6c  .    def store_l
-000045a0: 6f67 2873 656c 662c 2075 6964 2c20 7072  og(self, uid, pr
-000045b0: 6f6a 6563 743d 2222 2c20 626f 6479 3d4e  oject="", body=N
-000045c0: 6f6e 652c 2061 7070 656e 643d 4661 6c73  one, append=Fals
-000045d0: 6529 3a0a 2020 2020 2020 2020 2222 2253  e):.        """S
-000045e0: 6176 6520 6120 6c6f 6720 7065 7273 6973  ave a log persis
-000045f0: 7465 6e74 6c79 2e0a 0a20 2020 2020 2020  tently...       
-00004600: 203a 7061 7261 6d20 7569 643a 204c 6f67   :param uid: Log
-00004610: 2075 6e69 7175 6520 4944 0a20 2020 2020   unique ID.     
-00004620: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00004630: 743a 2050 726f 6a65 6374 206e 616d 6520  t: Project name 
-00004640: 666f 7220 7768 6963 6820 7468 6973 206c  for which this l
-00004650: 6f67 2062 656c 6f6e 6773 0a20 2020 2020  og belongs.     
-00004660: 2020 203a 7061 7261 6d20 626f 6479 3a20     :param body: 
-00004670: 5468 6520 6163 7475 616c 206c 6f67 2074  The actual log t
-00004680: 6f20 7374 6f72 650a 2020 2020 2020 2020  o store.        
-00004690: 3a70 6172 616d 2061 7070 656e 643a 2057  :param append: W
-000046a0: 6865 7468 6572 2074 6f20 6170 7065 6e64  hether to append
-000046b0: 2074 6865 206c 6f67 2070 726f 7669 6465   the log provide
-000046c0: 6420 696e 2060 6062 6f64 7960 6020 746f  d in ``body`` to
-000046d0: 2061 6e20 6578 6973 7469 6e67 206c 6f67   an existing log
-000046e0: 2077 6974 6820 7468 6520 7361 6d65 2060   with the same `
-000046f0: 6075 6964 6060 206f 7220 746f 0a20 2020  `uid`` or to.   
-00004700: 2020 2020 2020 2020 2063 7265 6174 6520           create 
-00004710: 6120 6e65 7720 6c6f 672e 2049 6620 7365  a new log. If se
-00004720: 7420 746f 2060 6046 616c 7365 6060 2c20  t to ``False``, 
-00004730: 616e 2065 7869 7374 696e 6720 6c6f 6720  an existing log 
-00004740: 7769 7468 2073 616d 6520 6060 7569 6460  with same ``uid`
-00004750: 6020 7769 6c6c 2062 6520 6f76 6572 7772  ` will be overwr
-00004760: 6974 7465 6e0a 2020 2020 2020 2020 2222  itten.        ""
-00004770: 220a 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
-00004780: 7420 626f 6479 3a0a 2020 2020 2020 2020  t body:.        
-00004790: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-000047a0: 2020 2020 7061 7468 203d 2073 656c 662e      path = self.
-000047b0: 5f70 6174 685f 6f66 2822 6c6f 6722 2c20  _path_of("log", 
-000047c0: 7072 6f6a 6563 742c 2075 6964 290a 2020  project, uid).  
-000047d0: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
-000047e0: 2261 7070 656e 6422 3a20 626f 6f6c 3273  "append": bool2s
-000047f0: 7472 2861 7070 656e 6429 7d0a 2020 2020  tr(append)}.    
-00004800: 2020 2020 6572 726f 7220 3d20 6622 7374      error = f"st
-00004810: 6f72 6520 6c6f 6720 7b70 726f 6a65 6374  ore log {project
-00004820: 7d2f 7b75 6964 7d22 0a20 2020 2020 2020  }/{uid}".       
-00004830: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00004840: 504f 5354 222c 2070 6174 682c 2065 7272  POST", path, err
-00004850: 6f72 2c20 7061 7261 6d73 2c20 626f 6479  or, params, body
-00004860: 290a 0a20 2020 2064 6566 2067 6574 5f6c  )..    def get_l
-00004870: 6f67 2873 656c 662c 2075 6964 2c20 7072  og(self, uid, pr
-00004880: 6f6a 6563 743d 2222 2c20 6f66 6673 6574  oject="", offset
-00004890: 3d30 2c20 7369 7a65 3d2d 3129 3a0a 2020  =0, size=-1):.  
-000048a0: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
-000048b0: 6520 6120 6c6f 672e 0a0a 2020 2020 2020  e a log...      
-000048c0: 2020 3a70 6172 616d 2075 6964 3a20 4c6f    :param uid: Lo
-000048d0: 6720 756e 6971 7565 2049 440a 2020 2020  g unique ID.    
-000048e0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-000048f0: 6374 3a20 5072 6f6a 6563 7420 6e61 6d65  ct: Project name
-00004900: 2066 6f72 2077 6869 6368 2074 6865 206c   for which the l
-00004910: 6f67 2062 656c 6f6e 6773 0a20 2020 2020  og belongs.     
-00004920: 2020 203a 7061 7261 6d20 6f66 6673 6574     :param offset
-00004930: 3a20 5265 7472 6965 7665 2070 6172 7469  : Retrieve parti
-00004940: 616c 206c 6f67 2c20 6765 7420 7570 2074  al log, get up t
-00004950: 6f20 6060 7369 7a65 6060 2062 7974 6573  o ``size`` bytes
-00004960: 2073 7461 7274 696e 6720 6174 206f 6666   starting at off
-00004970: 7365 7420 6060 6f66 6673 6574 6060 0a20  set ``offset``. 
-00004980: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-00004990: 6265 6769 6e6e 696e 6720 6f66 206c 6f67  beginning of log
-000049a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000049b0: 7369 7a65 3a20 5365 6520 6060 6f66 6673  size: See ``offs
-000049c0: 6574 6060 2e20 4966 2073 6574 2074 6f20  et``. If set to 
-000049d0: 6060 2d31 6060 2028 7468 6520 6465 6661  ``-1`` (the defa
-000049e0: 756c 7429 2077 696c 6c20 7265 7472 6965  ult) will retrie
-000049f0: 7665 2061 6c6c 2064 6174 6120 746f 2065  ve all data to e
-00004a00: 6e64 206f 6620 6c6f 672e 0a20 2020 2020  nd of log..     
-00004a10: 2020 203a 7265 7475 726e 733a 2054 6865     :returns: The
-00004a20: 2066 6f6c 6c6f 7769 6e67 206f 626a 6563   following objec
-00004a30: 7473 3a0a 0a20 2020 2020 2020 2020 2020  ts:..           
-00004a40: 202d 2073 7461 7465 202d 2054 6865 2073   - state - The s
-00004a50: 7461 7465 206f 6620 7468 6520 7275 6e74  tate of the runt
-00004a60: 696d 6520 6f62 6a65 6374 2077 6869 6368  ime object which
-00004a70: 2067 656e 6572 6174 6573 2074 6869 7320   generates this 
-00004a80: 6c6f 672c 2069 6620 6974 2065 7869 7374  log, if it exist
-00004a90: 732e 2049 6e20 6361 7365 206e 6f20 6b6e  s. In case no kn
-00004aa0: 6f77 6e20 7374 6174 650a 2020 2020 2020  own state.      
-00004ab0: 2020 2020 2020 2020 6578 6973 7473 2c20          exists, 
-00004ac0: 7468 6973 2077 696c 6c20 6265 2060 6075  this will be ``u
-00004ad0: 6e6b 6e6f 776e 6060 2e0a 2020 2020 2020  nknown``..      
-00004ae0: 2020 2020 2020 2d20 636f 6e74 656e 7420        - content 
-00004af0: 2d20 5468 6520 6163 7475 616c 206c 6f67  - The actual log
-00004b00: 2063 6f6e 7465 6e74 2e0a 2020 2020 2020   content..      
-00004b10: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
-00004b20: 6172 616d 7320 3d20 7b22 6f66 6673 6574  arams = {"offset
-00004b30: 223a 206f 6666 7365 742c 2022 7369 7a65  ": offset, "size
-00004b40: 223a 2073 697a 657d 0a20 2020 2020 2020  ": size}.       
-00004b50: 2070 6174 6820 3d20 7365 6c66 2e5f 7061   path = self._pa
-00004b60: 7468 5f6f 6628 226c 6f67 222c 2070 726f  th_of("log", pro
-00004b70: 6a65 6374 2c20 7569 6429 0a20 2020 2020  ject, uid).     
-00004b80: 2020 2065 7272 6f72 203d 2066 2267 6574     error = f"get
-00004b90: 206c 6f67 207b 7072 6f6a 6563 747d 2f7b   log {project}/{
-00004ba0: 7569 647d 220a 2020 2020 2020 2020 7265  uid}".        re
-00004bb0: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
-00004bc0: 6c6c 2822 4745 5422 2c20 7061 7468 2c20  ll("GET", path, 
-00004bd0: 6572 726f 722c 2070 6172 616d 733d 7061  error, params=pa
-00004be0: 7261 6d73 290a 2020 2020 2020 2020 6966  rams).        if
-00004bf0: 2072 6573 702e 6865 6164 6572 733a 0a20   resp.headers:. 
-00004c00: 2020 2020 2020 2020 2020 2073 7461 7465             state
-00004c10: 203d 2072 6573 702e 6865 6164 6572 732e   = resp.headers.
-00004c20: 6765 7428 2278 2d6d 6c72 756e 2d72 756e  get("x-mlrun-run
-00004c30: 2d73 7461 7465 222c 2022 2229 0a20 2020  -state", "").   
-00004c40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004c50: 7374 6174 652e 6c6f 7765 7228 292c 2072  state.lower(), r
-00004c60: 6573 702e 636f 6e74 656e 740a 0a20 2020  esp.content..   
-00004c70: 2020 2020 2072 6574 7572 6e20 2275 6e6b       return "unk
-00004c80: 6e6f 776e 222c 2072 6573 702e 636f 6e74  nown", resp.cont
-00004c90: 656e 740a 0a20 2020 2064 6566 2077 6174  ent..    def wat
-00004ca0: 6368 5f6c 6f67 2873 656c 662c 2075 6964  ch_log(self, uid
-00004cb0: 2c20 7072 6f6a 6563 743d 2222 2c20 7761  , project="", wa
-00004cc0: 7463 683d 5472 7565 2c20 6f66 6673 6574  tch=True, offset
-00004cd0: 3d30 293a 0a20 2020 2020 2020 2022 2222  =0):.        """
-00004ce0: 5265 7472 6965 7665 206c 6f67 7320 6f66  Retrieve logs of
-00004cf0: 2061 2072 756e 6e69 6e67 2070 726f 6365   a running proce
-00004d00: 7373 2c20 616e 6420 7761 7463 6820 7468  ss, and watch th
-00004d10: 6520 7072 6f67 7265 7373 206f 6620 7468  e progress of th
-00004d20: 6520 6578 6563 7574 696f 6e20 756e 7469  e execution unti
-00004d30: 6c20 6974 2063 6f6d 706c 6574 6573 2e20  l it completes. 
-00004d40: 5468 6973 0a20 2020 2020 2020 206d 6574  This.        met
-00004d50: 686f 6420 7769 6c6c 2070 7269 6e74 206f  hod will print o
-00004d60: 7574 2074 6865 206c 6f67 7320 616e 6420  ut the logs and 
-00004d70: 636f 6e74 696e 7565 2074 6f20 7065 7269  continue to peri
-00004d80: 6f64 6963 616c 6c79 2070 6f6c 6c20 666f  odically poll fo
-00004d90: 722c 2061 6e64 2070 7269 6e74 2c20 6e65  r, and print, ne
-00004da0: 7720 6c6f 6773 2061 7320 6c6f 6e67 2061  w logs as long a
-00004db0: 7320 7468 650a 2020 2020 2020 2020 7374  s the.        st
-00004dc0: 6174 6520 6f66 2074 6865 2072 756e 7469  ate of the runti
-00004dd0: 6d65 2077 6869 6368 2067 656e 6572 6174  me which generat
-00004de0: 6573 2074 6869 7320 6c6f 6720 6973 2065  es this log is e
-00004df0: 6974 6865 7220 6060 7065 6e64 696e 6760  ither ``pending`
-00004e00: 6020 6f72 2060 6072 756e 6e69 6e67 6060  ` or ``running``
-00004e10: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00004e20: 6d20 7569 643a 2054 6865 2075 6964 206f  m uid: The uid o
-00004e30: 6620 7468 6520 6c6f 6720 6f62 6a65 6374  f the log object
-00004e40: 2074 6f20 7761 7463 682e 0a20 2020 2020   to watch..     
-00004e50: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00004e60: 743a 2050 726f 6a65 6374 2074 6861 7420  t: Project that 
-00004e70: 7468 6520 6c6f 6720 6265 6c6f 6e67 7320  the log belongs 
-00004e80: 746f 2e0a 2020 2020 2020 2020 3a70 6172  to..        :par
-00004e90: 616d 2077 6174 6368 3a20 4966 2073 6574  am watch: If set
-00004ea0: 2074 6f20 6060 5472 7565 6060 2077 696c   to ``True`` wil
-00004eb0: 6c20 636f 6e74 696e 7565 2074 7261 636b  l continue track
-00004ec0: 696e 6720 7468 6520 6c6f 6720 6173 2064  ing the log as d
-00004ed0: 6573 6372 6962 6564 2061 626f 7665 2e20  escribed above. 
-00004ee0: 4f74 6865 7277 6973 6520 7468 6973 2066  Otherwise this f
-00004ef0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
-00004f00: 2020 2020 6973 2070 7261 6374 6963 616c      is practical
-00004f10: 6c79 2065 7175 6976 616c 656e 7420 746f  ly equivalent to
-00004f20: 2074 6865 203a 7079 3a66 756e 633a 607e   the :py:func:`~
-00004f30: 6765 745f 6c6f 6760 2066 756e 6374 696f  get_log` functio
-00004f40: 6e2e 0a20 2020 2020 2020 203a 7061 7261  n..        :para
-00004f50: 6d20 6f66 6673 6574 3a20 4d69 6e69 6d61  m offset: Minima
-00004f60: 6c20 6f66 6673 6574 2069 6e20 7468 6520  l offset in the 
-00004f70: 6c6f 6720 746f 2077 6174 6368 2e0a 2020  log to watch..  
-00004f80: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-00004f90: 5468 6520 6669 6e61 6c20 7374 6174 6520  The final state 
-00004fa0: 6f66 2074 6865 206c 6f67 2062 6569 6e67  of the log being
-00004fb0: 2077 6174 6368 6564 2e0a 2020 2020 2020   watched..      
-00004fc0: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
-00004fd0: 7461 7465 2c20 7465 7874 203d 2073 656c  tate, text = sel
-00004fe0: 662e 6765 745f 6c6f 6728 7569 642c 2070  f.get_log(uid, p
-00004ff0: 726f 6a65 6374 2c20 6f66 6673 6574 3d6f  roject, offset=o
-00005000: 6666 7365 7429 0a20 2020 2020 2020 2069  ffset).        i
-00005010: 6620 7465 7874 3a0a 2020 2020 2020 2020  f text:.        
-00005020: 2020 2020 7072 696e 7428 7465 7874 2e64      print(text.d
-00005030: 6563 6f64 6528 6572 726f 7273 3d6d 6c72  ecode(errors=mlr
-00005040: 756e 2e6d 6c63 6f6e 662e 6874 7470 6462  un.mlconf.httpdb
-00005050: 2e6c 6f67 732e 6465 636f 6465 2e65 7272  .logs.decode.err
-00005060: 6f72 7329 290a 2020 2020 2020 2020 6966  ors)).        if
-00005070: 2077 6174 6368 3a0a 2020 2020 2020 2020   watch:.        
-00005080: 2020 2020 6e69 6c5f 7265 7370 203d 2030      nil_resp = 0
-00005090: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
-000050a0: 6c65 2073 7461 7465 2069 6e20 5b22 7065  le state in ["pe
-000050b0: 6e64 696e 6722 2c20 2272 756e 6e69 6e67  nding", "running
-000050c0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-000050d0: 2020 2020 6f66 6673 6574 202b 3d20 6c65      offset += le
-000050e0: 6e28 7465 7874 290a 2020 2020 2020 2020  n(text).        
-000050f0: 2020 2020 2020 2020 2320 6966 2077 6520          # if we 
-00005100: 6765 7420 3320 6e69 6c20 7265 7370 6f6e  get 3 nil respon
-00005110: 7365 7320 696e 2061 2072 6f77 2c20 696e  ses in a row, in
-00005120: 6372 6561 7365 2074 6865 2073 6c65 6570  crease the sleep
-00005130: 2074 696d 6520 746f 2031 3020 7365 636f   time to 10 seco
-00005140: 6e64 730a 2020 2020 2020 2020 2020 2020  nds.            
-00005150: 2020 2020 2320 544f 444f 3a20 7265 6661      # TODO: refa
-00005160: 6374 6f72 2074 6869 7320 746f 2075 7365  ctor this to use
-00005170: 2061 2063 6f6e 6469 7469 6f6e 616c 2062   a conditional b
-00005180: 6163 6b6f 6666 206d 6563 6861 6e69 736d  ackoff mechanism
-00005190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000051a0: 2069 6620 6e69 6c5f 7265 7370 203c 2033   if nil_resp < 3
-000051b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000051c0: 2020 2020 2020 7469 6d65 2e73 6c65 6570        time.sleep
-000051d0: 2869 6e74 286d 6c72 756e 2e6d 6c63 6f6e  (int(mlrun.mlcon
-000051e0: 662e 6874 7470 6462 2e6c 6f67 732e 7075  f.httpdb.logs.pu
-000051f0: 6c6c 5f6c 6f67 735f 6465 6661 756c 745f  ll_logs_default_
-00005200: 696e 7465 7276 616c 2929 0a20 2020 2020  interval)).     
-00005210: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00005220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005230: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
-00005240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005250: 2020 2020 2020 2020 2069 6e74 280a 2020           int(.  
-00005260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005270: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
-00005280: 6d6c 636f 6e66 2e68 7474 7064 622e 6c6f  mlconf.httpdb.lo
-00005290: 6773 2e70 756c 6c5f 6c6f 6773 5f62 6163  gs.pull_logs_bac
-000052a0: 6b6f 6666 5f6e 6f5f 6c6f 6773 5f64 6566  koff_no_logs_def
-000052b0: 6175 6c74 5f69 6e74 6572 7661 6c0a 2020  ault_interval.  
-000052c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000052e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000052f0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00005300: 6174 652c 2074 6578 7420 3d20 7365 6c66  ate, text = self
-00005310: 2e67 6574 5f6c 6f67 2875 6964 2c20 7072  .get_log(uid, pr
-00005320: 6f6a 6563 742c 206f 6666 7365 743d 6f66  oject, offset=of
-00005330: 6673 6574 290a 2020 2020 2020 2020 2020  fset).          
-00005340: 2020 2020 2020 6966 2074 6578 743a 0a20        if text:. 
-00005350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005360: 2020 206e 696c 5f72 6573 7020 3d20 300a     nil_resp = 0.
-00005370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005380: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-00005390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053a0: 2020 2074 6578 742e 6465 636f 6465 2865     text.decode(e
-000053b0: 7272 6f72 733d 6d6c 7275 6e2e 6d6c 636f  rrors=mlrun.mlco
-000053c0: 6e66 2e68 7474 7064 622e 6c6f 6773 2e64  nf.httpdb.logs.d
-000053d0: 6563 6f64 652e 6572 726f 7273 292c 0a20  ecode.errors),. 
-000053e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053f0: 2020 2020 2020 2065 6e64 3d22 222c 0a20         end="",. 
-00005400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005410: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00005420: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005430: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00005440: 696c 5f72 6573 7020 2b3d 2031 0a20 2020  il_resp += 1.   
-00005450: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005460: 2020 2020 2020 206f 6666 7365 7420 2b3d         offset +=
-00005470: 206c 656e 2874 6578 7429 0a0a 2020 2020   len(text)..    
-00005480: 2020 2020 7265 7475 726e 2073 7461 7465      return state
-00005490: 2c20 6f66 6673 6574 0a0a 2020 2020 6465  , offset..    de
-000054a0: 6620 7374 6f72 655f 7275 6e28 7365 6c66  f store_run(self
-000054b0: 2c20 7374 7275 6374 2c20 7569 642c 2070  , struct, uid, p
-000054c0: 726f 6a65 6374 3d22 222c 2069 7465 723d  roject="", iter=
-000054d0: 3029 3a0a 2020 2020 2020 2020 2222 2253  0):.        """S
-000054e0: 746f 7265 2072 756e 2064 6574 6169 6c73  tore run details
-000054f0: 2069 6e20 7468 6520 4442 2e20 5468 6973   in the DB. This
-00005500: 206d 6574 686f 6420 6973 2075 7375 616c   method is usual
-00005510: 6c79 2063 616c 6c65 6420 6672 6f6d 2077  ly called from w
-00005520: 6974 6869 6e20 6f74 6865 7220 3a70 793a  ithin other :py:
-00005530: 6d6f 643a 606d 6c72 756e 6020 666c 6f77  mod:`mlrun` flow
-00005540: 730a 2020 2020 2020 2020 616e 6420 6e6f  s.        and no
-00005550: 7420 6361 6c6c 6564 2064 6972 6563 746c  t called directl
-00005560: 7920 6279 2074 6865 2075 7365 722e 2222  y by the user.""
-00005570: 220a 0a20 2020 2020 2020 2070 6174 6820  "..        path 
-00005580: 3d20 7365 6c66 2e5f 7061 7468 5f6f 6628  = self._path_of(
-00005590: 2272 756e 222c 2070 726f 6a65 6374 2c20  "run", project, 
-000055a0: 7569 6429 0a20 2020 2020 2020 2070 6172  uid).        par
-000055b0: 616d 7320 3d20 7b22 6974 6572 223a 2069  ams = {"iter": i
-000055c0: 7465 727d 0a20 2020 2020 2020 2065 7272  ter}.        err
-000055d0: 6f72 203d 2066 2273 746f 7265 2072 756e  or = f"store run
-000055e0: 207b 7072 6f6a 6563 747d 2f7b 7569 647d   {project}/{uid}
-000055f0: 220a 2020 2020 2020 2020 626f 6479 203d  ".        body =
-00005600: 205f 6173 5f6a 736f 6e28 7374 7275 6374   _as_json(struct
-00005610: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00005620: 7069 5f63 616c 6c28 2250 4f53 5422 2c20  pi_call("POST", 
-00005630: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
-00005640: 616d 733d 7061 7261 6d73 2c20 626f 6479  ams=params, body
-00005650: 3d62 6f64 7929 0a0a 2020 2020 6465 6620  =body)..    def 
-00005660: 7570 6461 7465 5f72 756e 2873 656c 662c  update_run(self,
-00005670: 2075 7064 6174 6573 3a20 6469 6374 2c20   updates: dict, 
-00005680: 7569 642c 2070 726f 6a65 6374 3d22 222c  uid, project="",
-00005690: 2069 7465 723d 3029 3a0a 2020 2020 2020   iter=0):.      
-000056a0: 2020 2222 2255 7064 6174 6520 7468 6520    """Update the 
-000056b0: 6465 7461 696c 7320 6f66 2061 2073 746f  details of a sto
-000056c0: 7265 6420 7275 6e20 696e 2074 6865 2044  red run in the D
-000056d0: 422e 2222 220a 0a20 2020 2020 2020 2070  B."""..        p
-000056e0: 6174 6820 3d20 7365 6c66 2e5f 7061 7468  ath = self._path
-000056f0: 5f6f 6628 2272 756e 222c 2070 726f 6a65  _of("run", proje
-00005700: 6374 2c20 7569 6429 0a20 2020 2020 2020  ct, uid).       
-00005710: 2070 6172 616d 7320 3d20 7b22 6974 6572   params = {"iter
-00005720: 223a 2069 7465 727d 0a20 2020 2020 2020  ": iter}.       
-00005730: 2065 7272 6f72 203d 2066 2275 7064 6174   error = f"updat
-00005740: 6520 7275 6e20 7b70 726f 6a65 6374 7d2f  e run {project}/
-00005750: 7b75 6964 7d22 0a20 2020 2020 2020 2062  {uid}".        b
-00005760: 6f64 7920 3d20 5f61 735f 6a73 6f6e 2875  ody = _as_json(u
-00005770: 7064 6174 6573 290a 2020 2020 2020 2020  pdates).        
-00005780: 7365 6c66 2e61 7069 5f63 616c 6c28 2250  self.api_call("P
-00005790: 4154 4348 222c 2070 6174 682c 2065 7272  ATCH", path, err
-000057a0: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
-000057b0: 732c 2062 6f64 793d 626f 6479 290a 0a20  s, body=body).. 
-000057c0: 2020 2064 6566 2061 626f 7274 5f72 756e     def abort_run
-000057d0: 2873 656c 662c 2075 6964 2c20 7072 6f6a  (self, uid, proj
-000057e0: 6563 743d 2222 2c20 6974 6572 3d30 293a  ect="", iter=0):
-000057f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00005800: 2020 2020 2041 626f 7274 2061 2072 756e       Abort a run
-00005810: 6e69 6e67 2072 756e 202d 2077 696c 6c20  ning run - will 
-00005820: 7265 6d6f 7665 2074 6865 2072 756e 2773  remove the run's
-00005830: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
-00005840: 6573 2061 6e64 206d 6172 6b20 6974 7320  es and mark its 
-00005850: 7374 6174 6520 6173 2061 626f 7274 6564  state as aborted
-00005860: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00005870: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-00005880: 5f72 756e 280a 2020 2020 2020 2020 2020  _run(.          
-00005890: 2020 7b22 7374 6174 7573 2e73 7461 7465    {"status.state
-000058a0: 223a 206d 6c72 756e 2e72 756e 7469 6d65  ": mlrun.runtime
-000058b0: 732e 636f 6e73 7461 6e74 732e 5275 6e53  s.constants.RunS
-000058c0: 7461 7465 732e 6162 6f72 7465 647d 2c0a  tates.aborted},.
-000058d0: 2020 2020 2020 2020 2020 2020 7569 642c              uid,
-000058e0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-000058f0: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
-00005900: 2020 6974 6572 2c0a 2020 2020 2020 2020    iter,.        
-00005910: 290a 0a20 2020 2064 6566 2072 6561 645f  )..    def read_
-00005920: 7275 6e28 7365 6c66 2c20 7569 642c 2070  run(self, uid, p
-00005930: 726f 6a65 6374 3d22 222c 2069 7465 723d  roject="", iter=
-00005940: 3029 3a0a 2020 2020 2020 2020 2222 2252  0):.        """R
-00005950: 6561 6420 7468 6520 6465 7461 696c 7320  ead the details 
-00005960: 6f66 2061 2073 746f 7265 6420 7275 6e20  of a stored run 
-00005970: 6672 6f6d 2074 6865 2044 422e 0a0a 2020  from the DB...  
-00005980: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
-00005990: 3a20 5468 6520 7275 6e27 7320 756e 6971  : The run's uniq
-000059a0: 7565 2049 442e 0a20 2020 2020 2020 203a  ue ID..        :
-000059b0: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-000059c0: 726f 6a65 6374 206e 616d 652e 0a20 2020  roject name..   
-000059d0: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
-000059e0: 3a20 4974 6572 6174 696f 6e20 7769 7468  : Iteration with
-000059f0: 696e 2061 2073 7065 6369 6669 6320 6578  in a specific ex
-00005a00: 6563 7574 696f 6e2e 0a20 2020 2020 2020  ecution..       
-00005a10: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
-00005a20: 7468 203d 2073 656c 662e 5f70 6174 685f  th = self._path_
-00005a30: 6f66 2822 7275 6e22 2c20 7072 6f6a 6563  of("run", projec
-00005a40: 742c 2075 6964 290a 2020 2020 2020 2020  t, uid).        
-00005a50: 7061 7261 6d73 203d 207b 2269 7465 7222  params = {"iter"
-00005a60: 3a20 6974 6572 7d0a 2020 2020 2020 2020  : iter}.        
-00005a70: 6572 726f 7220 3d20 6622 6765 7420 7275  error = f"get ru
-00005a80: 6e20 7b70 726f 6a65 6374 7d2f 7b75 6964  n {project}/{uid
-00005a90: 7d22 0a20 2020 2020 2020 2072 6573 7020  }".        resp 
-00005aa0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-00005ab0: 2247 4554 222c 2070 6174 682c 2065 7272  "GET", path, err
-00005ac0: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
-00005ad0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00005ae0: 6e20 7265 7370 2e6a 736f 6e28 295b 2264  n resp.json()["d
-00005af0: 6174 6122 5d0a 0a20 2020 2064 6566 2064  ata"]..    def d
-00005b00: 656c 5f72 756e 2873 656c 662c 2075 6964  el_run(self, uid
-00005b10: 2c20 7072 6f6a 6563 743d 2222 2c20 6974  , project="", it
-00005b20: 6572 3d30 293a 0a20 2020 2020 2020 2022  er=0):.        "
-00005b30: 2222 4465 6c65 7465 2064 6574 6169 6c73  ""Delete details
-00005b40: 206f 6620 6120 7370 6563 6966 6963 2072   of a specific r
-00005b50: 756e 2066 726f 6d20 4442 2e0a 0a20 2020  un from DB...   
-00005b60: 2020 2020 203a 7061 7261 6d20 7569 643a       :param uid:
-00005b70: 2055 6e69 7175 6520 4944 2066 6f72 2074   Unique ID for t
-00005b80: 6865 2073 7065 6369 6669 6320 7275 6e20  he specific run 
-00005b90: 746f 2064 656c 6574 652e 0a20 2020 2020  to delete..     
-00005ba0: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00005bb0: 743a 2050 726f 6a65 6374 2074 6861 7420  t: Project that 
-00005bc0: 7468 6520 7275 6e20 6265 6c6f 6e67 7320  the run belongs 
-00005bd0: 746f 2e0a 2020 2020 2020 2020 3a70 6172  to..        :par
-00005be0: 616d 2069 7465 723a 2049 7465 7261 7469  am iter: Iterati
-00005bf0: 6f6e 2077 6974 6869 6e20 6120 7370 6563  on within a spec
-00005c00: 6966 6963 2074 6173 6b2e 0a20 2020 2020  ific task..     
-00005c10: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00005c20: 7061 7468 203d 2073 656c 662e 5f70 6174  path = self._pat
-00005c30: 685f 6f66 2822 7275 6e22 2c20 7072 6f6a  h_of("run", proj
-00005c40: 6563 742c 2075 6964 290a 2020 2020 2020  ect, uid).      
-00005c50: 2020 7061 7261 6d73 203d 207b 2269 7465    params = {"ite
-00005c60: 7222 3a20 6974 6572 7d0a 2020 2020 2020  r": iter}.      
-00005c70: 2020 6572 726f 7220 3d20 6622 6465 6c20    error = f"del 
-00005c80: 7275 6e20 7b70 726f 6a65 6374 7d2f 7b75  run {project}/{u
-00005c90: 6964 7d22 0a20 2020 2020 2020 2073 656c  id}".        sel
-00005ca0: 662e 6170 695f 6361 6c6c 2822 4445 4c45  f.api_call("DELE
-00005cb0: 5445 222c 2070 6174 682c 2065 7272 6f72  TE", path, error
-00005cc0: 2c20 7061 7261 6d73 3d70 6172 616d 7329  , params=params)
-00005cd0: 0a0a 2020 2020 6465 6620 6c69 7374 5f72  ..    def list_r
-00005ce0: 756e 7328 0a20 2020 2020 2020 2073 656c  uns(.        sel
-00005cf0: 662c 0a20 2020 2020 2020 206e 616d 653d  f,.        name=
-00005d00: 4e6f 6e65 2c0a 2020 2020 2020 2020 7569  None,.        ui
-00005d10: 643a 204f 7074 696f 6e61 6c5b 556e 696f  d: Optional[Unio
-00005d20: 6e5b 7374 722c 204c 6973 745b 7374 725d  n[str, List[str]
-00005d30: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
-00005d40: 2020 2070 726f 6a65 6374 3d4e 6f6e 652c     project=None,
-00005d50: 0a20 2020 2020 2020 206c 6162 656c 733d  .        labels=
-00005d60: 4e6f 6e65 2c0a 2020 2020 2020 2020 7374  None,.        st
-00005d70: 6174 653d 4e6f 6e65 2c0a 2020 2020 2020  ate=None,.      
-00005d80: 2020 736f 7274 3d54 7275 652c 0a20 2020    sort=True,.   
-00005d90: 2020 2020 206c 6173 743d 302c 0a20 2020       last=0,.   
-00005da0: 2020 2020 2069 7465 723d 4661 6c73 652c       iter=False,
-00005db0: 0a20 2020 2020 2020 2073 7461 7274 5f74  .        start_t
-00005dc0: 696d 655f 6672 6f6d 3a20 6461 7465 7469  ime_from: dateti
-00005dd0: 6d65 203d 204e 6f6e 652c 0a20 2020 2020  me = None,.     
-00005de0: 2020 2073 7461 7274 5f74 696d 655f 746f     start_time_to
-00005df0: 3a20 6461 7465 7469 6d65 203d 204e 6f6e  : datetime = Non
-00005e00: 652c 0a20 2020 2020 2020 206c 6173 745f  e,.        last_
-00005e10: 7570 6461 7465 5f74 696d 655f 6672 6f6d  update_time_from
-00005e20: 3a20 6461 7465 7469 6d65 203d 204e 6f6e  : datetime = Non
-00005e30: 652c 0a20 2020 2020 2020 206c 6173 745f  e,.        last_
-00005e40: 7570 6461 7465 5f74 696d 655f 746f 3a20  update_time_to: 
-00005e50: 6461 7465 7469 6d65 203d 204e 6f6e 652c  datetime = None,
-00005e60: 0a20 2020 2020 2020 2070 6172 7469 7469  .        partiti
-00005e70: 6f6e 5f62 793a 2055 6e69 6f6e 5b73 6368  on_by: Union[sch
-00005e80: 656d 6173 2e52 756e 5061 7274 6974 696f  emas.RunPartitio
-00005e90: 6e42 7946 6965 6c64 2c20 7374 725d 203d  nByField, str] =
-00005ea0: 204e 6f6e 652c 0a20 2020 2020 2020 2072   None,.        r
-00005eb0: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
-00005ec0: 6e3a 2069 6e74 203d 2031 2c0a 2020 2020  n: int = 1,.    
-00005ed0: 2020 2020 7061 7274 6974 696f 6e5f 736f      partition_so
-00005ee0: 7274 5f62 793a 2055 6e69 6f6e 5b73 6368  rt_by: Union[sch
-00005ef0: 656d 6173 2e53 6f72 7446 6965 6c64 2c20  emas.SortField, 
-00005f00: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00005f10: 2020 2020 2070 6172 7469 7469 6f6e 5f6f       partition_o
-00005f20: 7264 6572 3a20 556e 696f 6e5b 7363 6865  rder: Union[sche
-00005f30: 6d61 732e 4f72 6465 7254 7970 652c 2073  mas.OrderType, s
-00005f40: 7472 5d20 3d20 7363 6865 6d61 732e 4f72  tr] = schemas.Or
-00005f50: 6465 7254 7970 652e 6465 7363 2c0a 2020  derType.desc,.  
-00005f60: 2020 2020 2020 6d61 785f 7061 7274 6974        max_partit
-00005f70: 696f 6e73 3a20 696e 7420 3d20 302c 0a20  ions: int = 0,. 
-00005f80: 2020 2020 2020 2077 6974 685f 6e6f 7469         with_noti
-00005f90: 6669 6361 7469 6f6e 733a 2062 6f6f 6c20  fications: bool 
-00005fa0: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
-00005fb0: 3e20 5275 6e4c 6973 743a 0a20 2020 2020  > RunList:.     
-00005fc0: 2020 2022 2222 5265 7472 6965 7665 2061     """Retrieve a
-00005fd0: 206c 6973 7420 6f66 2072 756e 732c 2066   list of runs, f
-00005fe0: 696c 7465 7265 6420 6279 2076 6172 696f  iltered by vario
-00005ff0: 7573 206f 7074 696f 6e73 2e0a 2020 2020  us options..    
-00006000: 2020 2020 4578 616d 706c 653a 3a0a 0a20      Example::.. 
-00006010: 2020 2020 2020 2020 2020 2072 756e 7320             runs 
-00006020: 3d20 6462 2e6c 6973 745f 7275 6e73 286e  = db.list_runs(n
-00006030: 616d 653d 2764 6f77 6e6c 6f61 6427 2c20  ame='download', 
-00006040: 7072 6f6a 6563 743d 2769 7269 7327 2c20  project='iris', 
-00006050: 6c61 6265 6c73 3d27 6f77 6e65 723d 6164  labels='owner=ad
-00006060: 6d69 6e27 290a 2020 2020 2020 2020 2020  min').          
-00006070: 2020 2320 4966 2072 756e 6e69 6e67 2069    # If running i
-00006080: 6e20 4a75 7079 7465 722c 2063 616e 2075  n Jupyter, can u
-00006090: 7365 2074 6865 202e 7368 6f77 2829 2066  se the .show() f
-000060a0: 756e 6374 696f 6e20 746f 2064 6973 706c  unction to displ
-000060b0: 6179 2074 6865 2072 6573 756c 7473 0a20  ay the results. 
-000060c0: 2020 2020 2020 2020 2020 2064 622e 6c69             db.li
-000060d0: 7374 5f72 756e 7328 6e61 6d65 3d27 272c  st_runs(name='',
-000060e0: 2070 726f 6a65 6374 3d70 726f 6a65 6374   project=project
-000060f0: 5f6e 616d 6529 2e73 686f 7728 290a 0a0a  _name).show()...
-00006100: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
-00006110: 616d 653a 204e 616d 6520 6f66 2074 6865  ame: Name of the
-00006120: 2072 756e 2074 6f20 7265 7472 6965 7665   run to retrieve
-00006130: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00006140: 2075 6964 3a20 556e 6971 7565 2049 4420   uid: Unique ID 
-00006150: 6f66 2074 6865 2072 756e 2c20 6f72 2061  of the run, or a
-00006160: 206c 6973 7420 6f66 2072 756e 2055 4944   list of run UID
-00006170: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-00006180: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
-00006190: 6374 2074 6861 7420 7468 6520 7275 6e73  ct that the runs
-000061a0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
-000061b0: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
-000061c0: 6c73 3a20 4c69 7374 2072 756e 7320 7468  ls: List runs th
-000061d0: 6174 2068 6176 6520 6120 7370 6563 6966  at have a specif
-000061e0: 6963 206c 6162 656c 2061 7373 6967 6e65  ic label assigne
-000061f0: 642e 2043 7572 7265 6e74 6c79 206f 6e6c  d. Currently onl
-00006200: 7920 6120 7369 6e67 6c65 206c 6162 656c  y a single label
-00006210: 2066 696c 7465 7220 6361 6e20 6265 0a20   filter can be. 
-00006220: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00006230: 6564 2c20 6f74 6865 7277 6973 6520 7265  ed, otherwise re
-00006240: 7375 6c74 2077 696c 6c20 6265 2065 6d70  sult will be emp
-00006250: 7479 2e0a 2020 2020 2020 2020 3a70 6172  ty..        :par
-00006260: 616d 2073 7461 7465 3a20 4c69 7374 206f  am state: List o
-00006270: 6e6c 7920 7275 6e73 2077 686f 7365 2073  nly runs whose s
-00006280: 7461 7465 2069 7320 7370 6563 6966 6965  tate is specifie
-00006290: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-000062a0: 6d20 736f 7274 3a20 5768 6574 6865 7220  m sort: Whether 
-000062b0: 746f 2073 6f72 7420 7468 6520 7265 7375  to sort the resu
-000062c0: 6c74 2061 6363 6f72 6469 6e67 2074 6f20  lt according to 
-000062d0: 7468 6569 7220 7374 6172 7420 7469 6d65  their start time
-000062e0: 2e20 4f74 6865 7277 6973 652c 2072 6573  . Otherwise, res
-000062f0: 756c 7473 2077 696c 6c20 6265 0a20 2020  ults will be.   
-00006300: 2020 2020 2020 2020 2072 6574 7572 6e65           returne
-00006310: 6420 6279 2074 6865 6972 2069 6e74 6572  d by their inter
-00006320: 6e61 6c20 6f72 6465 7220 696e 2074 6865  nal order in the
-00006330: 2044 4220 286f 7264 6572 2077 696c 6c20   DB (order will 
-00006340: 6e6f 7420 6265 2067 7561 7261 6e74 6565  not be guarantee
-00006350: 6429 2e0a 2020 2020 2020 2020 3a70 6172  d)..        :par
-00006360: 616d 206c 6173 743a 2044 6570 7265 6361  am last: Depreca
-00006370: 7465 6420 2d20 6375 7272 656e 746c 7920  ted - currently 
-00006380: 6e6f 7420 7573 6564 2e0a 2020 2020 2020  not used..      
-00006390: 2020 3a70 6172 616d 2069 7465 723a 2049    :param iter: I
-000063a0: 6620 6060 5472 7565 6060 2072 6574 7572  f ``True`` retur
-000063b0: 6e20 7275 6e73 2066 726f 6d20 616c 6c20  n runs from all 
-000063c0: 6974 6572 6174 696f 6e73 2e20 4f74 6865  iterations. Othe
-000063d0: 7277 6973 652c 2072 6574 7572 6e20 6f6e  rwise, return on
-000063e0: 6c79 2072 756e 7320 7768 6f73 6520 6060  ly runs whose ``
-000063f0: 6974 6572 6060 2069 7320 302e 0a20 2020  iter`` is 0..   
-00006400: 2020 2020 203a 7061 7261 6d20 7374 6172       :param star
-00006410: 745f 7469 6d65 5f66 726f 6d3a 2046 696c  t_time_from: Fil
-00006420: 7465 7220 6279 2072 756e 2073 7461 7274  ter by run start
-00006430: 2074 696d 6520 696e 2060 605b 7374 6172   time in ``[star
-00006440: 745f 7469 6d65 5f66 726f 6d2c 2073 7461  t_time_from, sta
-00006450: 7274 5f74 696d 655f 746f 5d60 602e 0a20  rt_time_to]``.. 
-00006460: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00006470: 6172 745f 7469 6d65 5f74 6f3a 2046 696c  art_time_to: Fil
-00006480: 7465 7220 6279 2072 756e 2073 7461 7274  ter by run start
-00006490: 2074 696d 6520 696e 2060 605b 7374 6172   time in ``[star
-000064a0: 745f 7469 6d65 5f66 726f 6d2c 2073 7461  t_time_from, sta
-000064b0: 7274 5f74 696d 655f 746f 5d60 602e 0a20  rt_time_to]``.. 
-000064c0: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
-000064d0: 7374 5f75 7064 6174 655f 7469 6d65 5f66  st_update_time_f
-000064e0: 726f 6d3a 2046 696c 7465 7220 6279 2072  rom: Filter by r
-000064f0: 756e 206c 6173 7420 7570 6461 7465 2074  un last update t
-00006500: 696d 6520 696e 2060 6028 6c61 7374 5f75  ime in ``(last_u
-00006510: 7064 6174 655f 7469 6d65 5f66 726f 6d2c  pdate_time_from,
-00006520: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-00006530: 745f 7570 6461 7465 5f74 696d 655f 746f  t_update_time_to
-00006540: 2960 602e 0a20 2020 2020 2020 203a 7061  )``..        :pa
-00006550: 7261 6d20 6c61 7374 5f75 7064 6174 655f  ram last_update_
-00006560: 7469 6d65 5f74 6f3a 2046 696c 7465 7220  time_to: Filter 
-00006570: 6279 2072 756e 206c 6173 7420 7570 6461  by run last upda
-00006580: 7465 2074 696d 6520 696e 2060 6028 6c61  te time in ``(la
-00006590: 7374 5f75 7064 6174 655f 7469 6d65 5f66  st_update_time_f
-000065a0: 726f 6d2c 206c 6173 745f 7570 6461 7465  rom, last_update
-000065b0: 5f74 696d 655f 746f 2960 602e 0a20 2020  _time_to)``..   
-000065c0: 2020 2020 203a 7061 7261 6d20 7061 7274       :param part
-000065d0: 6974 696f 6e5f 6279 3a20 4669 656c 6420  ition_by: Field 
-000065e0: 746f 2067 726f 7570 2072 6573 756c 7473  to group results
-000065f0: 2062 792e 204f 6e6c 7920 616c 6c6f 7765   by. Only allowe
-00006600: 6420 7661 6c75 6520 6973 2060 6e61 6d65  d value is `name
-00006610: 602e 2057 6865 6e20 6070 6172 7469 7469  `. When `partiti
-00006620: 6f6e 5f62 7960 2069 7320 7370 6563 6966  on_by` is specif
-00006630: 6965 642c 0a20 2020 2020 2020 2020 2020  ied,.           
-00006640: 2074 6865 2060 7061 7274 6974 696f 6e5f   the `partition_
-00006650: 736f 7274 5f62 7960 2070 6172 616d 6574  sort_by` paramet
-00006660: 6572 206d 7573 7420 6265 2070 726f 7669  er must be provi
-00006670: 6465 6420 6173 2077 656c 6c2e 0a20 2020  ded as well..   
-00006680: 2020 2020 203a 7061 7261 6d20 726f 7773       :param rows
-00006690: 5f70 6572 5f70 6172 7469 7469 6f6e 3a20  _per_partition: 
-000066a0: 486f 7720 6d61 6e79 2074 6f70 2072 6f77  How many top row
-000066b0: 7320 2870 6572 2073 6f72 7469 6e67 2064  s (per sorting d
-000066c0: 6566 696e 6564 2062 7920 6070 6172 7469  efined by `parti
-000066d0: 7469 6f6e 5f73 6f72 745f 6279 6020 616e  tion_sort_by` an
-000066e0: 6420 6070 6172 7469 7469 6f6e 5f6f 7264  d `partition_ord
-000066f0: 6572 6029 0a20 2020 2020 2020 2020 2020  er`).           
-00006700: 2074 6f20 7265 7475 726e 2070 6572 2067   to return per g
-00006710: 726f 7570 2e20 4465 6661 756c 7420 7661  roup. Default va
-00006720: 6c75 6520 6973 2031 2e0a 2020 2020 2020  lue is 1..      
-00006730: 2020 3a70 6172 616d 2070 6172 7469 7469    :param partiti
-00006740: 6f6e 5f73 6f72 745f 6279 3a20 5768 6174  on_sort_by: What
-00006750: 2066 6965 6c64 2074 6f20 736f 7274 2074   field to sort t
-00006760: 6865 2072 6573 756c 7473 2062 792c 2077  he results by, w
-00006770: 6974 6869 6e20 6561 6368 2070 6172 7469  ithin each parti
-00006780: 7469 6f6e 2064 6566 696e 6564 2062 7920  tion defined by 
-00006790: 6070 6172 7469 7469 6f6e 5f62 7960 2e0a  `partition_by`..
-000067a0: 2020 2020 2020 2020 2020 2020 4375 7272              Curr
-000067b0: 656e 746c 7920 7468 6520 6f6e 6c79 2061  ently the only a
-000067c0: 6c6c 6f77 6564 2076 616c 7565 7320 6172  llowed values ar
-000067d0: 6520 6063 7265 6174 6564 6020 616e 6420  e `created` and 
-000067e0: 6075 7064 6174 6564 602e 0a20 2020 2020  `updated`..     
-000067f0: 2020 203a 7061 7261 6d20 7061 7274 6974     :param partit
-00006800: 696f 6e5f 6f72 6465 723a 204f 7264 6572  ion_order: Order
-00006810: 206f 6620 736f 7274 696e 6720 7769 7468   of sorting with
-00006820: 696e 2070 6172 7469 7469 6f6e 7320 2d20  in partitions - 
-00006830: 6061 7363 6020 6f72 2060 6465 7363 602e  `asc` or `desc`.
-00006840: 2044 6566 6175 6c74 2069 7320 6064 6573   Default is `des
-00006850: 6360 2e0a 2020 2020 2020 2020 3a70 6172  c`..        :par
-00006860: 616d 206d 6178 5f70 6172 7469 7469 6f6e  am max_partition
-00006870: 733a 204d 6178 696d 616c 206e 756d 6265  s: Maximal numbe
-00006880: 7220 6f66 2070 6172 7469 7469 6f6e 7320  r of partitions 
-00006890: 746f 2069 6e63 6c75 6465 2069 6e20 7468  to include in th
-000068a0: 6520 7265 7375 6c74 2e20 4465 6661 756c  e result. Defaul
-000068b0: 7420 6973 2060 3060 2077 6869 6368 206d  t is `0` which m
-000068c0: 6561 6e73 206e 6f0a 2020 2020 2020 2020  eans no.        
-000068d0: 2020 2020 6c69 6d69 742e 0a20 2020 2020      limit..     
-000068e0: 2020 203a 7061 7261 6d20 7769 7468 5f6e     :param with_n
-000068f0: 6f74 6966 6963 6174 696f 6e73 3a20 5265  otifications: Re
-00006900: 7475 726e 2072 756e 7320 7769 7468 206e  turn runs with n
-00006910: 6f74 6966 6963 6174 696f 6e73 2c20 616e  otifications, an
-00006920: 6420 6a6f 696e 2074 6865 6d20 746f 2074  d join them to t
-00006930: 6865 2072 6573 706f 6e73 652e 2044 6566  he response. Def
-00006940: 6175 6c74 2069 7320 6046 616c 7365 602e  ault is `False`.
-00006950: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00006960: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-00006970: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
-00006980: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-00006990: 740a 2020 2020 2020 2020 7061 7261 6d73  t.        params
-000069a0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-000069b0: 2022 6e61 6d65 223a 206e 616d 652c 0a20   "name": name,. 
-000069c0: 2020 2020 2020 2020 2020 2022 7569 6422             "uid"
-000069d0: 3a20 7569 642c 0a20 2020 2020 2020 2020  : uid,.         
-000069e0: 2020 2022 7072 6f6a 6563 7422 3a20 7072     "project": pr
-000069f0: 6f6a 6563 742c 0a20 2020 2020 2020 2020  oject,.         
-00006a00: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
-00006a10: 6c73 206f 7220 5b5d 2c0a 2020 2020 2020  ls or [],.      
-00006a20: 2020 2020 2020 2273 7461 7465 223a 2073        "state": s
-00006a30: 7461 7465 2c0a 2020 2020 2020 2020 2020  tate,.          
-00006a40: 2020 2273 6f72 7422 3a20 626f 6f6c 3273    "sort": bool2s
-00006a50: 7472 2873 6f72 7429 2c0a 2020 2020 2020  tr(sort),.      
-00006a60: 2020 2020 2020 2269 7465 7222 3a20 626f        "iter": bo
-00006a70: 6f6c 3273 7472 2869 7465 7229 2c0a 2020  ol2str(iter),.  
-00006a80: 2020 2020 2020 2020 2020 2273 7461 7274            "start
-00006a90: 5f74 696d 655f 6672 6f6d 223a 2064 6174  _time_from": dat
-00006aa0: 6574 696d 655f 746f 5f69 736f 2873 7461  etime_to_iso(sta
-00006ab0: 7274 5f74 696d 655f 6672 6f6d 292c 0a20  rt_time_from),. 
-00006ac0: 2020 2020 2020 2020 2020 2022 7374 6172             "star
-00006ad0: 745f 7469 6d65 5f74 6f22 3a20 6461 7465  t_time_to": date
-00006ae0: 7469 6d65 5f74 6f5f 6973 6f28 7374 6172  time_to_iso(star
-00006af0: 745f 7469 6d65 5f74 6f29 2c0a 2020 2020  t_time_to),.    
-00006b00: 2020 2020 2020 2020 226c 6173 745f 7570          "last_up
-00006b10: 6461 7465 5f74 696d 655f 6672 6f6d 223a  date_time_from":
-00006b20: 2064 6174 6574 696d 655f 746f 5f69 736f   datetime_to_iso
-00006b30: 286c 6173 745f 7570 6461 7465 5f74 696d  (last_update_tim
-00006b40: 655f 6672 6f6d 292c 0a20 2020 2020 2020  e_from),.       
-00006b50: 2020 2020 2022 6c61 7374 5f75 7064 6174       "last_updat
-00006b60: 655f 7469 6d65 5f74 6f22 3a20 6461 7465  e_time_to": date
-00006b70: 7469 6d65 5f74 6f5f 6973 6f28 6c61 7374  time_to_iso(last
-00006b80: 5f75 7064 6174 655f 7469 6d65 5f74 6f29  _update_time_to)
-00006b90: 2c0a 2020 2020 2020 2020 2020 2020 2277  ,.            "w
-00006ba0: 6974 685f 6e6f 7469 6669 6361 7469 6f6e  ith_notification
-00006bb0: 7322 3a20 7769 7468 5f6e 6f74 6966 6963  s": with_notific
-00006bc0: 6174 696f 6e73 2c0a 2020 2020 2020 2020  ations,.        
-00006bd0: 7d0a 0a20 2020 2020 2020 2069 6620 7061  }..        if pa
-00006be0: 7274 6974 696f 6e5f 6279 3a0a 2020 2020  rtition_by:.    
-00006bf0: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
-00006c00: 7064 6174 6528 0a20 2020 2020 2020 2020  pdate(.         
-00006c10: 2020 2020 2020 2073 656c 662e 5f67 656e         self._gen
-00006c20: 6572 6174 655f 7061 7274 6974 696f 6e5f  erate_partition_
-00006c30: 6279 5f70 6172 616d 7328 0a20 2020 2020  by_params(.     
-00006c40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006c50: 6368 656d 6173 2e52 756e 5061 7274 6974  chemas.RunPartit
-00006c60: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
-00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c80: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
-00006c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ca0: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
-00006cb0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00006cc0: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00006cd0: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
-00006ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cf0: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00006d00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006d10: 2020 2020 2020 6d61 785f 7061 7274 6974        max_partit
-00006d20: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
-00006d30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006d40: 2020 2020 290a 2020 2020 2020 2020 6572      ).        er
-00006d50: 726f 7220 3d20 226c 6973 7420 7275 6e73  ror = "list runs
-00006d60: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
-00006d70: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00006d80: 4745 5422 2c20 2272 756e 7322 2c20 6572  GET", "runs", er
-00006d90: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-00006da0: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
-00006db0: 726e 2052 756e 4c69 7374 2872 6573 702e  rn RunList(resp.
-00006dc0: 6a73 6f6e 2829 5b22 7275 6e73 225d 290a  json()["runs"]).
-00006dd0: 0a20 2020 2064 6566 2064 656c 5f72 756e  .    def del_run
-00006de0: 7328 7365 6c66 2c20 6e61 6d65 3d4e 6f6e  s(self, name=Non
-00006df0: 652c 2070 726f 6a65 6374 3d4e 6f6e 652c  e, project=None,
-00006e00: 206c 6162 656c 733d 4e6f 6e65 2c20 7374   labels=None, st
-00006e10: 6174 653d 4e6f 6e65 2c20 6461 7973 5f61  ate=None, days_a
-00006e20: 676f 3d30 293a 0a20 2020 2020 2020 2022  go=0):.        "
-00006e30: 2222 4465 6c65 7465 2061 2067 726f 7570  ""Delete a group
-00006e40: 206f 6620 7275 6e73 2069 6465 6e74 6966   of runs identif
-00006e50: 6965 6420 6279 2074 6865 2070 6172 616d  ied by the param
-00006e60: 6574 6572 7320 6f66 2074 6865 2066 756e  eters of the fun
-00006e70: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
-00006e80: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
-00006e90: 2020 2020 2020 2064 622e 6465 6c5f 7275         db.del_ru
-00006ea0: 6e73 2873 7461 7465 3d27 636f 6d70 6c65  ns(state='comple
-00006eb0: 7465 6427 290a 0a20 2020 2020 2020 203a  ted')..        :
-00006ec0: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
-00006ed0: 206f 6620 7468 6520 7461 736b 2077 6869   of the task whi
-00006ee0: 6368 2074 6865 2072 756e 7320 6265 6c6f  ch the runs belo
-00006ef0: 6e67 2074 6f2e 0a20 2020 2020 2020 203a  ng to..        :
-00006f00: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00006f10: 726f 6a65 6374 2074 6f20 7768 6963 6820  roject to which 
-00006f20: 7468 6520 7275 6e73 2062 656c 6f6e 672e  the runs belong.
-00006f30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00006f40: 6c61 6265 6c73 3a20 4669 6c74 6572 2072  labels: Filter r
-00006f50: 756e 7320 7468 6174 2061 7265 206c 6162  uns that are lab
-00006f60: 656c 6564 2075 7369 6e67 2074 6865 7365  eled using these
-00006f70: 2073 7065 6369 6669 6320 6c61 6265 6c20   specific label 
-00006f80: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
-00006f90: 3a70 6172 616d 2073 7461 7465 3a20 4669  :param state: Fi
-00006fa0: 6c74 6572 206f 6e6c 7920 7275 6e73 2077  lter only runs w
-00006fb0: 6869 6368 2061 7265 2069 6e20 7468 6973  hich are in this
-00006fc0: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
-00006fd0: 3a70 6172 616d 2064 6179 735f 6167 6f3a  :param days_ago:
-00006fe0: 2046 696c 7465 7220 7275 6e73 2077 686f   Filter runs who
-00006ff0: 7365 2073 7461 7274 2074 696d 6520 6973  se start time is
-00007000: 206e 6577 6572 2074 6861 6e20 7468 6973   newer than this
-00007010: 2070 6172 616d 6574 6572 2e0a 2020 2020   parameter..    
-00007020: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00007030: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00007040: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-00007050: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-00007060: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-00007070: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00007080: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
-00007090: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
-000070a0: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
-000070b0: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-000070c0: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-000070d0: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
-000070e0: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
-000070f0: 2020 2020 2022 6461 7973 5f61 676f 223a       "days_ago":
-00007100: 2073 7472 2864 6179 735f 6167 6f29 2c0a   str(days_ago),.
-00007110: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00007120: 2020 6572 726f 7220 3d20 2264 656c 2072    error = "del r
-00007130: 756e 7322 0a20 2020 2020 2020 2073 656c  uns".        sel
-00007140: 662e 6170 695f 6361 6c6c 2822 4445 4c45  f.api_call("DELE
-00007150: 5445 222c 2022 7275 6e73 222c 2065 7272  TE", "runs", err
-00007160: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
-00007170: 7329 0a0a 2020 2020 6465 6620 7374 6f72  s)..    def stor
-00007180: 655f 6172 7469 6661 6374 2873 656c 662c  e_artifact(self,
-00007190: 206b 6579 2c20 6172 7469 6661 6374 2c20   key, artifact, 
-000071a0: 7569 642c 2069 7465 723d 4e6f 6e65 2c20  uid, iter=None, 
-000071b0: 7461 673d 4e6f 6e65 2c20 7072 6f6a 6563  tag=None, projec
-000071c0: 743d 2222 293a 0a20 2020 2020 2020 2022  t=""):.        "
-000071d0: 2222 5374 6f72 6520 616e 2061 7274 6966  ""Store an artif
-000071e0: 6163 7420 696e 2074 6865 2044 422e 0a0a  act in the DB...
-000071f0: 2020 2020 2020 2020 3a70 6172 616d 206b          :param k
-00007200: 6579 3a20 4964 656e 7469 6679 696e 6720  ey: Identifying 
-00007210: 6b65 7920 6f66 2074 6865 2061 7274 6966  key of the artif
-00007220: 6163 742e 0a20 2020 2020 2020 203a 7061  act..        :pa
-00007230: 7261 6d20 6172 7469 6661 6374 3a20 5468  ram artifact: Th
-00007240: 6520 6163 7475 616c 2061 7274 6966 6163  e actual artifac
-00007250: 7420 746f 2073 746f 7265 2e0a 2020 2020  t to store..    
-00007260: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
-00007270: 4120 756e 6971 7565 2049 4420 666f 7220  A unique ID for 
-00007280: 7468 6973 2073 7065 6369 6669 6320 7665  this specific ve
-00007290: 7273 696f 6e20 6f66 2074 6865 2061 7274  rsion of the art
-000072a0: 6966 6163 742e 0a20 2020 2020 2020 203a  ifact..        :
-000072b0: 7061 7261 6d20 6974 6572 3a20 5468 6520  param iter: The 
-000072c0: 7461 736b 2069 7465 7261 7469 6f6e 2077  task iteration w
-000072d0: 6869 6368 2067 656e 6572 6174 6564 2074  hich generated t
-000072e0: 6869 7320 6172 7469 6661 6374 2e20 4966  his artifact. If
-000072f0: 2060 6069 7465 7260 6020 6973 206e 6f74   ``iter`` is not
-00007300: 2060 604e 6f6e 6560 6020 7468 6520 6974   ``None`` the it
-00007310: 6572 6174 696f 6e20 7769 6c6c 0a20 2020  eration will.   
-00007320: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
-00007330: 6420 746f 2074 6865 206b 6579 2070 726f  d to the key pro
-00007340: 7669 6465 6420 746f 2067 656e 6572 6174  vided to generat
-00007350: 6520 6120 756e 6971 7565 206b 6579 2066  e a unique key f
-00007360: 6f72 2074 6865 2061 7274 6966 6163 7420  or the artifact 
-00007370: 6f66 2074 6865 2073 7065 6369 6669 6320  of the specific 
-00007380: 6974 6572 6174 696f 6e2e 0a20 2020 2020  iteration..     
-00007390: 2020 203a 7061 7261 6d20 7461 673a 2054     :param tag: T
-000073a0: 6167 206f 6620 7468 6520 6172 7469 6661  ag of the artifa
-000073b0: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
-000073c0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-000073d0: 6563 7420 7468 6174 2074 6865 2061 7274  ect that the art
-000073e0: 6966 6163 7420 6265 6c6f 6e67 7320 746f  ifact belongs to
-000073f0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00007400: 2020 2020 2020 2065 6e64 706f 696e 745f         endpoint_
-00007410: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-00007420: 732f 7b70 726f 6a65 6374 7d2f 6172 7469  s/{project}/arti
-00007430: 6661 6374 732f 7b75 6964 7d2f 7b6b 6579  facts/{uid}/{key
-00007440: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
-00007450: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-00007460: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
-00007470: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00007480: 6966 2069 7465 723a 0a20 2020 2020 2020  if iter:.       
-00007490: 2020 2020 2070 6172 616d 735b 2269 7465       params["ite
-000074a0: 7222 5d20 3d20 7374 7228 6974 6572 290a  r"] = str(iter).
-000074b0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
-000074c0: 2066 2273 746f 7265 2061 7274 6966 6163   f"store artifac
-000074d0: 7420 7b70 726f 6a65 6374 7d2f 7b75 6964  t {project}/{uid
-000074e0: 7d2f 7b6b 6579 7d22 0a0a 2020 2020 2020  }/{key}"..      
-000074f0: 2020 626f 6479 203d 205f 6173 5f6a 736f    body = _as_jso
-00007500: 6e28 6172 7469 6661 6374 290a 2020 2020  n(artifact).    
-00007510: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
-00007520: 6c28 2250 4f53 5422 2c20 656e 6470 6f69  l("POST", endpoi
-00007530: 6e74 5f70 6174 682c 2065 7272 6f72 2c20  nt_path, error, 
-00007540: 7061 7261 6d73 3d70 6172 616d 732c 2062  params=params, b
-00007550: 6f64 793d 626f 6479 290a 0a20 2020 2064  ody=body)..    d
-00007560: 6566 2072 6561 645f 6172 7469 6661 6374  ef read_artifact
-00007570: 2873 656c 662c 206b 6579 2c20 7461 673d  (self, key, tag=
-00007580: 4e6f 6e65 2c20 6974 6572 3d4e 6f6e 652c  None, iter=None,
-00007590: 2070 726f 6a65 6374 3d22 2229 3a0a 2020   project=""):.  
-000075a0: 2020 2020 2020 2222 2252 6561 6420 616e        """Read an
-000075b0: 2061 7274 6966 6163 742c 2069 6465 6e74   artifact, ident
-000075c0: 6966 6965 6420 6279 2069 7473 206b 6579  ified by its key
-000075d0: 2c20 7461 6720 616e 6420 6974 6572 6174  , tag and iterat
-000075e0: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
-000075f0: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00007600: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-00007610: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-00007620: 2020 2020 2074 6167 203d 2074 6167 206f       tag = tag o
-00007630: 7220 226c 6174 6573 7422 0a20 2020 2020  r "latest".     
-00007640: 2020 2065 6e64 706f 696e 745f 7061 7468     endpoint_path
-00007650: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-00007660: 726f 6a65 6374 7d2f 6172 7469 6661 6374  roject}/artifact
-00007670: 732f 7b6b 6579 7d3f 7461 673d 7b74 6167  s/{key}?tag={tag
-00007680: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
-00007690: 203d 2066 2272 6561 6420 6172 7469 6661   = f"read artifa
-000076a0: 6374 207b 7072 6f6a 6563 747d 2f7b 6b65  ct {project}/{ke
-000076b0: 797d 220a 2020 2020 2020 2020 2320 6578  y}".        # ex
-000076c0: 706c 6963 6974 6c79 2073 6574 2061 7274  plicitly set art
-000076d0: 6966 6163 7473 2066 6f72 6d61 7420 746f  ifacts format to
-000076e0: 2027 6675 6c6c 2720 7369 6e63 6520 6f6c   'full' since ol
-000076f0: 6420 7365 7276 6572 7320 6d61 7920 6465  d servers may de
-00007700: 6661 756c 7420 746f 2027 6c65 6761 6379  fault to 'legacy
-00007710: 270a 2020 2020 2020 2020 7061 7261 6d73  '.        params
-00007720: 203d 207b 2266 6f72 6d61 7422 3a20 7363   = {"format": sc
-00007730: 6865 6d61 732e 4172 7469 6661 6374 7346  hemas.ArtifactsF
-00007740: 6f72 6d61 742e 6675 6c6c 2e76 616c 7565  ormat.full.value
-00007750: 7d0a 2020 2020 2020 2020 6966 2069 7465  }.        if ite
-00007760: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
-00007770: 6172 616d 735b 2269 7465 7222 5d20 3d20  arams["iter"] = 
-00007780: 7374 7228 6974 6572 290a 2020 2020 2020  str(iter).      
-00007790: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-000077a0: 695f 6361 6c6c 2822 4745 5422 2c20 656e  i_call("GET", en
-000077b0: 6470 6f69 6e74 5f70 6174 682c 2065 7272  dpoint_path, err
-000077c0: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
-000077d0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-000077e0: 6e20 7265 7370 2e6a 736f 6e28 295b 2264  n resp.json()["d
-000077f0: 6174 6122 5d0a 0a20 2020 2064 6566 2064  ata"]..    def d
-00007800: 656c 5f61 7274 6966 6163 7428 7365 6c66  el_artifact(self
-00007810: 2c20 6b65 792c 2074 6167 3d4e 6f6e 652c  , key, tag=None,
-00007820: 2070 726f 6a65 6374 3d22 2229 3a0a 2020   project=""):.  
-00007830: 2020 2020 2020 2222 2244 656c 6574 6520        """Delete 
-00007840: 616e 2061 7274 6966 6163 742e 2222 220a  an artifact.""".
-00007850: 0a20 2020 2020 2020 2065 6e64 706f 696e  .        endpoin
-00007860: 745f 7061 7468 203d 2066 2270 726f 6a65  t_path = f"proje
-00007870: 6374 732f 7b70 726f 6a65 6374 7d2f 6172  cts/{project}/ar
-00007880: 7469 6661 6374 732f 7b6b 6579 7d22 0a20  tifacts/{key}". 
-00007890: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-000078a0: 7b0a 2020 2020 2020 2020 2020 2020 226b  {.            "k
-000078b0: 6579 223a 206b 6579 2c0a 2020 2020 2020  ey": key,.      
-000078c0: 2020 2020 2020 2274 6167 223a 2074 6167        "tag": tag
-000078d0: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-000078e0: 2020 2020 6572 726f 7220 3d20 6622 6465      error = f"de
-000078f0: 6c20 6172 7469 6661 6374 207b 7072 6f6a  l artifact {proj
-00007900: 6563 747d 2f7b 6b65 797d 220a 2020 2020  ect}/{key}".    
-00007910: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
-00007920: 6c28 2244 454c 4554 4522 2c20 656e 6470  l("DELETE", endp
-00007930: 6f69 6e74 5f70 6174 682c 2065 7272 6f72  oint_path, error
-00007940: 2c20 7061 7261 6d73 3d70 6172 616d 7329  , params=params)
-00007950: 0a0a 2020 2020 6465 6620 6c69 7374 5f61  ..    def list_a
-00007960: 7274 6966 6163 7473 280a 2020 2020 2020  rtifacts(.      
-00007970: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00007980: 6e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  name=None,.     
-00007990: 2020 2070 726f 6a65 6374 3d4e 6f6e 652c     project=None,
-000079a0: 0a20 2020 2020 2020 2074 6167 3d4e 6f6e  .        tag=Non
-000079b0: 652c 0a20 2020 2020 2020 206c 6162 656c  e,.        label
-000079c0: 733a 204f 7074 696f 6e61 6c5b 556e 696f  s: Optional[Unio
-000079d0: 6e5b 4469 6374 5b73 7472 2c20 7374 725d  n[Dict[str, str]
-000079e0: 2c20 4c69 7374 5b73 7472 5d5d 5d20 3d20  , List[str]]] = 
-000079f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7369  None,.        si
-00007a00: 6e63 653d 4e6f 6e65 2c0a 2020 2020 2020  nce=None,.      
-00007a10: 2020 756e 7469 6c3d 4e6f 6e65 2c0a 2020    until=None,.  
-00007a20: 2020 2020 2020 6974 6572 3a20 696e 7420        iter: int 
-00007a30: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00007a40: 6265 7374 5f69 7465 7261 7469 6f6e 3a20  best_iteration: 
-00007a50: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-00007a60: 2020 2020 2020 6b69 6e64 3a20 7374 7220        kind: str 
-00007a70: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00007a80: 6361 7465 676f 7279 3a20 556e 696f 6e5b  category: Union[
-00007a90: 7374 722c 2073 6368 656d 6173 2e41 7274  str, schemas.Art
-00007aa0: 6966 6163 7443 6174 6567 6f72 6965 735d  ifactCategories]
-00007ab0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00007ac0: 3e20 4172 7469 6661 6374 4c69 7374 3a0a  > ArtifactList:.
-00007ad0: 2020 2020 2020 2020 2222 224c 6973 7420          """List 
-00007ae0: 6172 7469 6661 6374 7320 6669 6c74 6572  artifacts filter
-00007af0: 6564 2062 7920 7661 7269 6f75 7320 7061  ed by various pa
-00007b00: 7261 6d65 7465 7273 2e0a 0a20 2020 2020  rameters...     
-00007b10: 2020 2045 7861 6d70 6c65 733a 3a0a 0a20     Examples::.. 
-00007b20: 2020 2020 2020 2020 2020 2023 2053 686f             # Sho
-00007b30: 7720 6c61 7465 7374 2076 6572 7369 6f6e  w latest version
-00007b40: 206f 6620 616c 6c20 6172 7469 6661 6374   of all artifact
-00007b50: 7320 696e 2070 726f 6a65 6374 0a20 2020  s in project.   
-00007b60: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
-00007b70: 6172 7469 6661 6374 7320 3d20 6462 2e6c  artifacts = db.l
-00007b80: 6973 745f 6172 7469 6661 6374 7328 2727  ist_artifacts(''
-00007b90: 2c20 7461 673d 276c 6174 6573 7427 2c20  , tag='latest', 
-00007ba0: 7072 6f6a 6563 743d 2769 7269 7327 290a  project='iris').
-00007bb0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-00007bc0: 6563 6b20 6469 6666 6572 656e 7420 6172  eck different ar
-00007bd0: 7469 6661 6374 2076 6572 7369 6f6e 7320  tifact versions 
-00007be0: 666f 7220 6120 7370 6563 6966 6963 2061  for a specific a
-00007bf0: 7274 6966 6163 740a 2020 2020 2020 2020  rtifact.        
-00007c00: 2020 2020 7265 7375 6c74 5f76 6572 7369      result_versi
-00007c10: 6f6e 7320 3d20 6462 2e6c 6973 745f 6172  ons = db.list_ar
-00007c20: 7469 6661 6374 7328 2772 6573 756c 7473  tifacts('results
-00007c30: 272c 2074 6167 3d27 2a27 2c20 7072 6f6a  ', tag='*', proj
-00007c40: 6563 743d 2769 7269 7327 290a 2020 2020  ect='iris').    
-00007c50: 2020 2020 2020 2020 2320 5368 6f77 2061          # Show a
-00007c60: 7274 6966 6163 7473 2077 6974 6820 6c61  rtifacts with la
-00007c70: 6265 6c20 6669 6c74 6572 7320 2d20 626f  bel filters - bo
-00007c80: 7468 2075 706c 6f61 6465 6420 616e 6420  th uploaded and 
-00007c90: 6f66 2062 696e 6172 7920 7479 7065 0a20  of binary type. 
-00007ca0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00007cb0: 745f 6c61 6265 6c73 203d 2064 622e 6c69  t_labels = db.li
-00007cc0: 7374 5f61 7274 6966 6163 7473 2827 7265  st_artifacts('re
-00007cd0: 7375 6c74 7327 2c20 7461 673d 272a 272c  sults', tag='*',
-00007ce0: 2070 726f 6a65 6374 3d27 6972 6973 272c   project='iris',
-00007cf0: 206c 6162 656c 733d 5b27 7570 6c6f 6164   labels=['upload
-00007d00: 6564 272c 2027 7479 7065 3d62 696e 6172  ed', 'type=binar
-00007d10: 7927 5d29 0a0a 2020 2020 2020 2020 3a70  y'])..        :p
-00007d20: 6172 616d 206e 616d 653a 204e 616d 6520  aram name: Name 
-00007d30: 6f66 2061 7274 6966 6163 7473 2074 6f20  of artifacts to 
-00007d40: 7265 7472 6965 7665 2e20 4e61 6d65 2069  retrieve. Name i
-00007d50: 7320 7573 6564 2061 7320 6120 6c69 6b65  s used as a like
-00007d60: 2071 7565 7279 2c20 616e 6420 6973 206e   query, and is n
-00007d70: 6f74 2063 6173 652d 7365 6e73 6974 6976  ot case-sensitiv
-00007d80: 652e 2054 6869 7320 6d65 616e 730a 2020  e. This means.  
-00007d90: 2020 2020 2020 2020 2020 7468 6174 2071            that q
-00007da0: 7565 7279 696e 6720 666f 7220 6060 6e61  uerying for ``na
-00007db0: 6d65 6060 206d 6179 2072 6574 7572 6e20  me`` may return 
-00007dc0: 6172 7469 6661 6374 7320 6e61 6d65 6420  artifacts named 
-00007dd0: 6060 6d79 5f4e 616d 655f 3160 6020 6f72  ``my_Name_1`` or
-00007de0: 2060 6073 7572 6e61 6d65 6060 2e0a 2020   ``surname``..  
-00007df0: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
-00007e00: 6a65 6374 3a20 5072 6f6a 6563 7420 6e61  ject: Project na
-00007e10: 6d65 2e0a 2020 2020 2020 2020 3a70 6172  me..        :par
-00007e20: 616d 2074 6167 3a20 5265 7475 726e 2061  am tag: Return a
-00007e30: 7274 6966 6163 7473 2061 7373 6967 6e65  rtifacts assigne
-00007e40: 6420 7468 6973 2074 6167 2e0a 2020 2020  d this tag..    
-00007e50: 2020 2020 3a70 6172 616d 206c 6162 656c      :param label
-00007e60: 733a 2052 6574 7572 6e20 6172 7469 6661  s: Return artifa
-00007e70: 6374 7320 7468 6174 2068 6176 6520 7468  cts that have th
-00007e80: 6573 6520 6c61 6265 6c73 2e20 4c61 6265  ese labels. Labe
-00007e90: 6c73 2063 616e 2065 6974 6865 7220 6265  ls can either be
-00007ea0: 2061 2064 6963 7469 6f6e 6172 7920 7b22   a dictionary {"
-00007eb0: 6c61 6265 6c22 3a20 2276 616c 7565 227d  label": "value"}
-00007ec0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-00007ed0: 6120 6c69 7374 206f 6620 226c 6162 656c  a list of "label
-00007ee0: 3d76 616c 7565 2220 286d 6174 6368 206c  =value" (match l
-00007ef0: 6162 656c 206b 6579 2061 6e64 2076 616c  abel key and val
-00007f00: 7565 2920 6f72 2022 6c61 6265 6c22 2028  ue) or "label" (
-00007f10: 6d61 7463 6820 6a75 7374 206c 6162 656c  match just label
-00007f20: 206b 6579 2920 7374 7269 6e67 732e 0a20   key) strings.. 
-00007f30: 2020 2020 2020 203a 7061 7261 6d20 7369         :param si
-00007f40: 6e63 653a 204e 6f74 2069 6e20 7573 6520  nce: Not in use 
-00007f50: 696e 203a 7079 3a63 6c61 7373 3a60 4854  in :py:class:`HT
-00007f60: 5450 5275 6e44 4260 2e0a 2020 2020 2020  TPRunDB`..      
-00007f70: 2020 3a70 6172 616d 2075 6e74 696c 3a20    :param until: 
-00007f80: 4e6f 7420 696e 2075 7365 2069 6e20 3a70  Not in use in :p
-00007f90: 793a 636c 6173 733a 6048 5454 5052 756e  y:class:`HTTPRun
-00007fa0: 4442 602e 0a20 2020 2020 2020 203a 7061  DB`..        :pa
-00007fb0: 7261 6d20 6974 6572 3a20 5265 7475 726e  ram iter: Return
-00007fc0: 2061 7274 6966 6163 7473 2066 726f 6d20   artifacts from 
-00007fd0: 6120 7370 6563 6966 6963 2069 7465 7261  a specific itera
-00007fe0: 7469 6f6e 2028 7768 6572 6520 6060 6974  tion (where ``it
-00007ff0: 6572 3d30 6060 206d 6561 6e73 2074 6865  er=0`` means the
-00008000: 2072 6f6f 7420 6974 6572 6174 696f 6e29   root iteration)
-00008010: 2e20 4966 0a20 2020 2020 2020 2020 2020  . If.           
-00008020: 2060 604e 6f6e 6560 6020 2864 6566 6175   ``None`` (defau
-00008030: 6c74 2920 7265 7475 726e 2061 7274 6966  lt) return artif
-00008040: 6163 7473 2066 726f 6d20 616c 6c20 6974  acts from all it
-00008050: 6572 6174 696f 6e73 2e0a 2020 2020 2020  erations..      
-00008060: 2020 3a70 6172 616d 2062 6573 745f 6974    :param best_it
-00008070: 6572 6174 696f 6e3a 2052 6574 7572 6e73  eration: Returns
-00008080: 2074 6865 2061 7274 6966 6163 7420 7768   the artifact wh
-00008090: 6963 6820 6265 6c6f 6e67 7320 746f 2074  ich belongs to t
-000080a0: 6865 2062 6573 7420 6974 6572 6174 696f  he best iteratio
-000080b0: 6e20 6f66 2061 2067 6976 656e 2072 756e  n of a given run
-000080c0: 2c20 696e 2074 6865 2063 6173 6520 6f66  , in the case of
-000080d0: 0a20 2020 2020 2020 2020 2020 2061 7274  .            art
-000080e0: 6966 6163 7473 2067 656e 6572 6174 6564  ifacts generated
-000080f0: 2066 726f 6d20 6120 6879 7065 722d 7061   from a hyper-pa
-00008100: 7261 6d20 7275 6e2e 2049 6620 6f6e 6c79  ram run. If only
-00008110: 2061 2073 696e 676c 6520 6974 6572 6174   a single iterat
-00008120: 696f 6e20 6578 6973 7473 2c20 7769 6c6c  ion exists, will
-00008130: 2072 6574 7572 6e20 7468 6520 6172 7469   return the arti
-00008140: 6661 6374 0a20 2020 2020 2020 2020 2020  fact.           
-00008150: 2066 726f 6d20 7468 6174 2069 7465 7261   from that itera
-00008160: 7469 6f6e 2e20 4966 2075 7369 6e67 2060  tion. If using `
-00008170: 6062 6573 745f 6974 6572 6060 2c20 7468  `best_iter``, th
-00008180: 6520 6060 6974 6572 6060 2070 6172 616d  e ``iter`` param
-00008190: 6574 6572 206d 7573 7420 6e6f 7420 6265  eter must not be
-000081a0: 2075 7365 642e 0a20 2020 2020 2020 203a   used..        :
-000081b0: 7061 7261 6d20 6b69 6e64 3a20 5265 7475  param kind: Retu
-000081c0: 726e 2061 7274 6966 6163 7473 206f 6620  rn artifacts of 
-000081d0: 7468 6520 7265 7175 6573 7465 6420 6b69  the requested ki
-000081e0: 6e64 2e0a 2020 2020 2020 2020 3a70 6172  nd..        :par
-000081f0: 616d 2063 6174 6567 6f72 793a 2052 6574  am category: Ret
-00008200: 7572 6e20 6172 7469 6661 6374 7320 6f66  urn artifacts of
-00008210: 2074 6865 2072 6571 7565 7374 6564 2063   the requested c
-00008220: 6174 6567 6f72 792e 0a20 2020 2020 2020  ategory..       
-00008230: 2022 2222 0a0a 2020 2020 2020 2020 7072   """..        pr
-00008240: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
-00008250: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
-00008260: 745f 7072 6f6a 6563 740a 0a20 2020 2020  t_project..     
-00008270: 2020 206c 6162 656c 7320 3d20 6c61 6265     labels = labe
-00008280: 6c73 206f 7220 5b5d 0a20 2020 2020 2020  ls or [].       
-00008290: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
-000082a0: 6162 656c 732c 2064 6963 7429 3a0a 2020  abels, dict):.  
-000082b0: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
-000082c0: 203d 205b 6622 7b6b 6579 7d3d 7b76 616c   = [f"{key}={val
-000082d0: 7565 7d22 2066 6f72 206b 6579 2c20 7661  ue}" for key, va
-000082e0: 6c75 6520 696e 206c 6162 656c 732e 6974  lue in labels.it
-000082f0: 656d 7328 295d 0a0a 2020 2020 2020 2020  ems()]..        
-00008300: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
-00008310: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
-00008320: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00008330: 2022 7461 6722 3a20 7461 672c 0a20 2020   "tag": tag,.   
-00008340: 2020 2020 2020 2020 2022 6c61 6265 6c22           "label"
-00008350: 3a20 6c61 6265 6c73 2c0a 2020 2020 2020  : labels,.      
-00008360: 2020 2020 2020 2269 7465 7222 3a20 6974        "iter": it
-00008370: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00008380: 2262 6573 742d 6974 6572 6174 696f 6e22  "best-iteration"
-00008390: 3a20 6265 7374 5f69 7465 7261 7469 6f6e  : best_iteration
-000083a0: 2c0a 2020 2020 2020 2020 2020 2020 226b  ,.            "k
-000083b0: 696e 6422 3a20 6b69 6e64 2c0a 2020 2020  ind": kind,.    
-000083c0: 2020 2020 2020 2020 2263 6174 6567 6f72          "categor
-000083d0: 7922 3a20 6361 7465 676f 7279 2c0a 2020  y": category,.  
-000083e0: 2020 2020 2020 2020 2020 2266 6f72 6d61            "forma
-000083f0: 7422 3a20 7363 6865 6d61 732e 4172 7469  t": schemas.Arti
-00008400: 6661 6374 7346 6f72 6d61 742e 6675 6c6c  factsFormat.full
-00008410: 2e76 616c 7565 2c0a 2020 2020 2020 2020  .value,.        
-00008420: 7d0a 2020 2020 2020 2020 6572 726f 7220  }.        error 
-00008430: 3d20 226c 6973 7420 6172 7469 6661 6374  = "list artifact
-00008440: 7322 0a20 2020 2020 2020 2065 6e64 706f  s".        endpo
-00008450: 696e 745f 7061 7468 203d 2066 2270 726f  int_path = f"pro
-00008460: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-00008470: 6172 7469 6661 6374 7322 0a20 2020 2020  artifacts".     
-00008480: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
-00008490: 7069 5f63 616c 6c28 2247 4554 222c 2065  pi_call("GET", e
-000084a0: 6e64 706f 696e 745f 7061 7468 2c20 6572  ndpoint_path, er
-000084b0: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-000084c0: 6d73 290a 2020 2020 2020 2020 7661 6c75  ms).        valu
-000084d0: 6573 203d 2041 7274 6966 6163 744c 6973  es = ArtifactLis
-000084e0: 7428 7265 7370 2e6a 736f 6e28 295b 2261  t(resp.json()["a
-000084f0: 7274 6966 6163 7473 225d 290a 2020 2020  rtifacts"]).    
-00008500: 2020 2020 7661 6c75 6573 2e74 6167 203d      values.tag =
-00008510: 2074 6167 0a20 2020 2020 2020 2072 6574   tag.        ret
-00008520: 7572 6e20 7661 6c75 6573 0a0a 2020 2020  urn values..    
-00008530: 6465 6620 6465 6c5f 6172 7469 6661 6374  def del_artifact
-00008540: 7328 7365 6c66 2c20 6e61 6d65 3d4e 6f6e  s(self, name=Non
-00008550: 652c 2070 726f 6a65 6374 3d4e 6f6e 652c  e, project=None,
-00008560: 2074 6167 3d4e 6f6e 652c 206c 6162 656c   tag=None, label
-00008570: 733d 4e6f 6e65 2c20 6461 7973 5f61 676f  s=None, days_ago
-00008580: 3d30 293a 0a20 2020 2020 2020 2022 2222  =0):.        """
-00008590: 4465 6c65 7465 2061 7274 6966 6163 7473  Delete artifacts
-000085a0: 2072 6566 6572 656e 6365 6420 6279 2074   referenced by t
-000085b0: 6865 2070 6172 616d 6574 6572 732e 0a0a  he parameters...
-000085c0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
-000085d0: 616d 653a 204e 616d 6520 6f66 2061 7274  ame: Name of art
-000085e0: 6966 6163 7473 2074 6f20 6465 6c65 7465  ifacts to delete
-000085f0: 2e20 4e6f 7465 2074 6861 7420 7468 6973  . Note that this
-00008600: 2069 7320 6120 6c69 6b65 2071 7565 7279   is a like query
-00008610: 2c20 616e 6420 6973 2063 6173 652d 696e  , and is case-in
-00008620: 7365 6e73 6974 6976 652e 2053 6565 0a20  sensitive. See. 
-00008630: 2020 2020 2020 2020 2020 203a 7079 3a66             :py:f
-00008640: 756e 633a 607e 6c69 7374 5f61 7274 6966  unc:`~list_artif
-00008650: 6163 7473 6020 666f 7220 6d6f 7265 2064  acts` for more d
-00008660: 6574 6169 6c73 2e0a 2020 2020 2020 2020  etails..        
-00008670: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-00008680: 5072 6f6a 6563 7420 7468 6174 2061 7274  Project that art
-00008690: 6966 6163 7473 2062 656c 6f6e 6720 746f  ifacts belong to
-000086a0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000086b0: 2074 6167 3a20 4368 6f6f 7365 2061 7274   tag: Choose art
-000086c0: 6966 6163 7473 2077 686f 2061 7265 2061  ifacts who are a
-000086d0: 7373 6967 6e65 6420 7468 6973 2074 6167  ssigned this tag
-000086e0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000086f0: 206c 6162 656c 733a 2043 686f 6f73 6520   labels: Choose 
-00008700: 6172 7469 6661 6374 7320 7768 6963 6820  artifacts which 
-00008710: 6172 6520 6c61 6265 6c65 642e 0a20 2020  are labeled..   
-00008720: 2020 2020 203a 7061 7261 6d20 6461 7973       :param days
-00008730: 5f61 676f 3a20 5468 6973 2070 6172 616d  _ago: This param
-00008740: 6574 6572 2069 7320 6465 7072 6563 6174  eter is deprecat
-00008750: 6564 2061 6e64 206e 6f74 2075 7365 642e  ed and not used.
-00008760: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008770: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
-00008780: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
-00008790: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-000087a0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-000087b0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-000087c0: 226e 616d 6522 3a20 6e61 6d65 2c0a 2020  "name": name,.  
-000087d0: 2020 2020 2020 2020 2020 2274 6167 223a            "tag":
-000087e0: 2074 6167 2c0a 2020 2020 2020 2020 2020   tag,.          
-000087f0: 2020 226c 6162 656c 223a 206c 6162 656c    "label": label
-00008800: 7320 6f72 205b 5d2c 0a20 2020 2020 2020  s or [],.       
-00008810: 2020 2020 2022 6461 7973 5f61 676f 223a       "days_ago":
-00008820: 2073 7472 2864 6179 735f 6167 6f29 2c0a   str(days_ago),.
-00008830: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00008840: 2020 6572 726f 7220 3d20 2264 656c 2061    error = "del a
-00008850: 7274 6966 6163 7473 220a 2020 2020 2020  rtifacts".      
-00008860: 2020 656e 6470 6f69 6e74 5f70 6174 6820    endpoint_path 
-00008870: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00008880: 6f6a 6563 747d 2f61 7274 6966 6163 7473  oject}/artifacts
-00008890: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-000088a0: 7069 5f63 616c 6c28 2244 454c 4554 4522  pi_call("DELETE"
-000088b0: 2c20 656e 6470 6f69 6e74 5f70 6174 682c  , endpoint_path,
-000088c0: 2065 7272 6f72 2c20 7061 7261 6d73 3d70   error, params=p
-000088d0: 6172 616d 7329 0a0a 2020 2020 6465 6620  arams)..    def 
-000088e0: 6c69 7374 5f61 7274 6966 6163 745f 7461  list_artifact_ta
-000088f0: 6773 280a 2020 2020 2020 2020 7365 6c66  gs(.        self
-00008900: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00008910: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
-00008920: 6361 7465 676f 7279 3a20 556e 696f 6e5b  category: Union[
-00008930: 7374 722c 2073 6368 656d 6173 2e41 7274  str, schemas.Art
-00008940: 6966 6163 7443 6174 6567 6f72 6965 735d  ifactCategories]
-00008950: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00008960: 3e20 4c69 7374 5b73 7472 5d3a 0a20 2020  > List[str]:.   
-00008970: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
-00008980: 206c 6973 7420 6f66 2061 6c6c 2074 6865   list of all the
-00008990: 2074 6167 7320 6173 7369 676e 6564 2074   tags assigned t
-000089a0: 6f20 6172 7469 6661 6374 7320 696e 2074  o artifacts in t
-000089b0: 6865 2073 636f 7065 206f 6620 7468 6520  he scope of the 
-000089c0: 6769 7665 6e20 7072 6f6a 6563 742e 2222  given project.""
-000089d0: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
-000089e0: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
-000089f0: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
-00008a00: 726f 6a65 6374 0a20 2020 2020 2020 2065  roject.        e
-00008a10: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-00008a20: 2246 6169 6c65 6420 6c69 7374 696e 6720  "Failed listing 
-00008a30: 6172 7469 6661 6374 2074 6167 732e 2070  artifact tags. p
-00008a40: 726f 6a65 6374 3d7b 7072 6f6a 6563 747d  roject={project}
-00008a50: 220a 2020 2020 2020 2020 7061 7261 6d73  ".        params
-00008a60: 203d 207b 2263 6174 6567 6f72 7922 3a20   = {"category": 
-00008a70: 6361 7465 676f 7279 7d20 6966 2063 6174  category} if cat
-00008a80: 6567 6f72 7920 656c 7365 207b 7d0a 0a20  egory else {}.. 
-00008a90: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-00008aa0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-00008ab0: 0a20 2020 2020 2020 2020 2020 2022 4745  .            "GE
-00008ac0: 5422 2c20 6622 7072 6f6a 6563 7473 2f7b  T", f"projects/{
-00008ad0: 7072 6f6a 6563 747d 2f61 7274 6966 6163  project}/artifac
-00008ae0: 742d 7461 6773 222c 2065 7272 6f72 5f6d  t-tags", error_m
-00008af0: 6573 7361 6765 2c20 7061 7261 6d73 3d70  essage, params=p
-00008b00: 6172 616d 730a 2020 2020 2020 2020 290a  arams.        ).
-00008b10: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00008b20: 6573 706f 6e73 652e 6a73 6f6e 2829 5b22  esponse.json()["
-00008b30: 7461 6773 225d 0a0a 2020 2020 6465 6620  tags"]..    def 
-00008b40: 7374 6f72 655f 6675 6e63 7469 6f6e 280a  store_function(.
-00008b50: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00008b60: 2020 2020 2020 6675 6e63 7469 6f6e 3a20        function: 
-00008b70: 7479 7069 6e67 2e55 6e69 6f6e 5b6d 6c72  typing.Union[mlr
-00008b80: 756e 2e72 756e 7469 6d65 732e 4261 7365  un.runtimes.Base
-00008b90: 5275 6e74 696d 652c 2064 6963 745d 2c0a  Runtime, dict],.
-00008ba0: 2020 2020 2020 2020 6e61 6d65 2c0a 2020          name,.  
-00008bb0: 2020 2020 2020 7072 6f6a 6563 743d 2222        project=""
-00008bc0: 2c0a 2020 2020 2020 2020 7461 673d 4e6f  ,.        tag=No
-00008bd0: 6e65 2c0a 2020 2020 2020 2020 7665 7273  ne,.        vers
-00008be0: 696f 6e65 643d 4661 6c73 652c 0a20 2020  ioned=False,.   
-00008bf0: 2029 3a0a 2020 2020 2020 2020 2222 2253   ):.        """S
-00008c00: 746f 7265 2061 2066 756e 6374 696f 6e20  tore a function 
-00008c10: 6f62 6a65 6374 2e20 4675 6e63 7469 6f6e  object. Function
-00008c20: 2069 7320 6964 656e 7469 6669 6564 2062   is identified b
-00008c30: 7920 6974 7320 6e61 6d65 2061 6e64 2074  y its name and t
-00008c40: 6167 2c20 616e 6420 6361 6e20 6265 2076  ag, and can be v
-00008c50: 6572 7369 6f6e 6564 2e22 2222 0a20 2020  ersioned.""".   
-00008c60: 2020 2020 206e 616d 6520 3d20 6d6c 7275       name = mlru
-00008c70: 6e2e 7574 696c 732e 6e6f 726d 616c 697a  n.utils.normaliz
-00008c80: 655f 6e61 6d65 286e 616d 6529 0a20 2020  e_name(name).   
-00008c90: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00008ca0: 6675 6e63 7469 6f6e 2c20 2274 6f5f 6469  function, "to_di
-00008cb0: 6374 2229 3a0a 2020 2020 2020 2020 2020  ct"):.          
-00008cc0: 2020 6675 6e63 7469 6f6e 203d 2066 756e    function = fun
-00008cd0: 6374 696f 6e2e 746f 5f64 6963 7428 290a  ction.to_dict().
-00008ce0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00008cf0: 3d20 7b22 7461 6722 3a20 7461 672c 2022  = {"tag": tag, "
-00008d00: 7665 7273 696f 6e65 6422 3a20 7665 7273  versioned": vers
-00008d10: 696f 6e65 647d 0a20 2020 2020 2020 2070  ioned}.        p
-00008d20: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-00008d30: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-00008d40: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
-00008d50: 2020 2070 6174 6820 3d20 7365 6c66 2e5f     path = self._
-00008d60: 7061 7468 5f6f 6628 2266 756e 6322 2c20  path_of("func", 
-00008d70: 7072 6f6a 6563 742c 206e 616d 6529 0a0a  project, name)..
-00008d80: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
-00008d90: 6622 7374 6f72 6520 6675 6e63 7469 6f6e  f"store function
-00008da0: 207b 7072 6f6a 6563 747d 2f7b 6e61 6d65   {project}/{name
-00008db0: 7d22 0a20 2020 2020 2020 2072 6573 7020  }".        resp 
-00008dc0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-00008dd0: 0a20 2020 2020 2020 2020 2020 2022 504f  .            "PO
-00008de0: 5354 222c 2070 6174 682c 2065 7272 6f72  ST", path, error
-00008df0: 2c20 7061 7261 6d73 3d70 6172 616d 732c  , params=params,
-00008e00: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
-00008e10: 6f6e 2866 756e 6374 696f 6e29 0a20 2020  on(function).   
-00008e20: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00008e30: 2320 6861 7368 206b 6579 206f 7074 696f  # hash key optio
-00008e40: 6e61 6c20 746f 2062 6520 6261 636b 7761  nal to be backwa
-00008e50: 7264 7320 636f 6d70 6174 6962 6c65 2074  rds compatible t
-00008e60: 6f20 4150 4920 763c 302e 342e 3130 2069  o API v<0.4.10 i
-00008e70: 6e20 7768 6963 6820 6974 2077 6173 6e27  n which it wasn'
-00008e80: 7420 696e 2074 6865 2072 6573 706f 6e73  t in the respons
-00008e90: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00008ea0: 2072 6573 702e 6a73 6f6e 2829 2e67 6574   resp.json().get
-00008eb0: 2822 6861 7368 5f6b 6579 2229 0a0a 2020  ("hash_key")..  
-00008ec0: 2020 6465 6620 6765 745f 6675 6e63 7469    def get_functi
-00008ed0: 6f6e 2873 656c 662c 206e 616d 652c 2070  on(self, name, p
-00008ee0: 726f 6a65 6374 3d22 222c 2074 6167 3d4e  roject="", tag=N
-00008ef0: 6f6e 652c 2068 6173 685f 6b65 793d 2222  one, hash_key=""
-00008f00: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-00008f10: 7472 6965 7665 2064 6574 6169 6c73 206f  trieve details o
-00008f20: 6620 6120 7370 6563 6966 6963 2066 756e  f a specific fun
-00008f30: 6374 696f 6e2c 2069 6465 6e74 6966 6965  ction, identifie
-00008f40: 6420 6279 2069 7473 206e 616d 6520 616e  d by its name an
-00008f50: 6420 706f 7465 6e74 6961 6c6c 7920 6120  d potentially a 
-00008f60: 7461 6720 6f72 2066 756e 6374 696f 6e20  tag or function 
-00008f70: 6861 7368 2e22 2222 0a0a 2020 2020 2020  hash."""..      
-00008f80: 2020 7061 7261 6d73 203d 207b 2274 6167    params = {"tag
-00008f90: 223a 2074 6167 2c20 2268 6173 685f 6b65  ": tag, "hash_ke
-00008fa0: 7922 3a20 6861 7368 5f6b 6579 7d0a 2020  y": hash_key}.  
-00008fb0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-00008fc0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
-00008fd0: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-00008fe0: 740a 2020 2020 2020 2020 7061 7468 203d  t.        path =
-00008ff0: 2073 656c 662e 5f70 6174 685f 6f66 2822   self._path_of("
-00009000: 6675 6e63 222c 2070 726f 6a65 6374 2c20  func", project, 
-00009010: 6e61 6d65 290a 2020 2020 2020 2020 6572  name).        er
-00009020: 726f 7220 3d20 6622 6765 7420 6675 6e63  ror = f"get func
-00009030: 7469 6f6e 207b 7072 6f6a 6563 747d 2f7b  tion {project}/{
-00009040: 6e61 6d65 7d22 0a20 2020 2020 2020 2072  name}".        r
-00009050: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
-00009060: 616c 6c28 2247 4554 222c 2070 6174 682c  all("GET", path,
-00009070: 2065 7272 6f72 2c20 7061 7261 6d73 3d70   error, params=p
-00009080: 6172 616d 7329 0a20 2020 2020 2020 2072  arams).        r
-00009090: 6574 7572 6e20 7265 7370 2e6a 736f 6e28  eturn resp.json(
-000090a0: 295b 2266 756e 6322 5d0a 0a20 2020 2064  )["func"]..    d
-000090b0: 6566 2064 656c 6574 655f 6675 6e63 7469  ef delete_functi
-000090c0: 6f6e 2873 656c 662c 206e 616d 653a 2073  on(self, name: s
-000090d0: 7472 2c20 7072 6f6a 6563 743a 2073 7472  tr, project: str
-000090e0: 203d 2022 2229 3a0a 2020 2020 2020 2020   = ""):.        
-000090f0: 2222 2244 656c 6574 6520 6120 6675 6e63  """Delete a func
-00009100: 7469 6f6e 2062 656c 6f6e 6769 6e67 2074  tion belonging t
-00009110: 6f20 6120 7370 6563 6966 6963 2070 726f  o a specific pro
-00009120: 6a65 6374 2e22 2222 0a0a 2020 2020 2020  ject."""..      
-00009130: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
-00009140: 6563 7420 6f72 2063 6f6e 6669 672e 6465  ect or config.de
-00009150: 6661 756c 745f 7072 6f6a 6563 740a 2020  fault_project.  
-00009160: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
-00009170: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-00009180: 7d2f 6675 6e63 7469 6f6e 732f 7b6e 616d  }/functions/{nam
-00009190: 657d 220a 2020 2020 2020 2020 6572 726f  e}".        erro
-000091a0: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-000091b0: 696c 6564 2064 656c 6574 696e 6720 6675  iled deleting fu
-000091c0: 6e63 7469 6f6e 207b 7072 6f6a 6563 747d  nction {project}
-000091d0: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-000091e0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-000091f0: 4445 4c45 5445 222c 2070 6174 682c 2065  DELETE", path, e
-00009200: 7272 6f72 5f6d 6573 7361 6765 290a 0a20  rror_message).. 
-00009210: 2020 2064 6566 206c 6973 745f 6675 6e63     def list_func
-00009220: 7469 6f6e 7328 7365 6c66 2c20 6e61 6d65  tions(self, name
-00009230: 3d4e 6f6e 652c 2070 726f 6a65 6374 3d4e  =None, project=N
-00009240: 6f6e 652c 2074 6167 3d4e 6f6e 652c 206c  one, tag=None, l
-00009250: 6162 656c 733d 4e6f 6e65 293a 0a20 2020  abels=None):.   
-00009260: 2020 2020 2022 2222 5265 7472 6965 7665       """Retrieve
-00009270: 2061 206c 6973 7420 6f66 2066 756e 6374   a list of funct
-00009280: 696f 6e73 2c20 6669 6c74 6572 6564 2062  ions, filtered b
-00009290: 7920 7370 6563 6966 6963 2063 7269 7465  y specific crite
-000092a0: 7269 612e 0a0a 2020 2020 2020 2020 3a70  ria...        :p
-000092b0: 6172 616d 206e 616d 653a 2052 6574 7572  aram name: Retur
-000092c0: 6e20 6f6e 6c79 2066 756e 6374 696f 6e73  n only functions
-000092d0: 2077 6974 6820 6120 7370 6563 6966 6963   with a specific
-000092e0: 206e 616d 652e 0a20 2020 2020 2020 203a   name..        :
-000092f0: 7061 7261 6d20 7072 6f6a 6563 743a 2052  param project: R
-00009300: 6574 7572 6e20 6675 6e63 7469 6f6e 7320  eturn functions 
-00009310: 6265 6c6f 6e67 696e 6720 746f 2074 6869  belonging to thi
-00009320: 7320 7072 6f6a 6563 742e 2049 6620 6e6f  s project. If no
-00009330: 7420 7370 6563 6966 6965 642c 2074 6865  t specified, the
-00009340: 2064 6566 6175 6c74 2070 726f 6a65 6374   default project
-00009350: 2069 7320 7573 6564 2e0a 2020 2020 2020   is used..      
-00009360: 2020 3a70 6172 616d 2074 6167 3a20 5265    :param tag: Re
-00009370: 7475 726e 2066 756e 6374 696f 6e20 7665  turn function ve
-00009380: 7273 696f 6e73 2077 6974 6820 7370 6563  rsions with spec
-00009390: 6966 6963 2074 6167 732e 0a20 2020 2020  ific tags..     
-000093a0: 2020 203a 7061 7261 6d20 6c61 6265 6c73     :param labels
-000093b0: 3a20 5265 7475 726e 2066 756e 6374 696f  : Return functio
-000093c0: 6e73 2074 6861 7420 6861 7665 2073 7065  ns that have spe
-000093d0: 6369 6669 6320 6c61 6265 6c73 2061 7373  cific labels ass
-000093e0: 6967 6e65 6420 746f 2074 6865 6d2e 0a20  igned to them.. 
-000093f0: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-00009400: 204c 6973 7420 6f66 2066 756e 6374 696f   List of functio
-00009410: 6e20 6f62 6a65 6374 7320 2861 7320 6469  n objects (as di
-00009420: 6374 696f 6e61 7279 292e 0a20 2020 2020  ctionary)..     
-00009430: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00009440: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
-00009450: 2020 2020 2020 2022 7072 6f6a 6563 7422         "project"
-00009460: 3a20 7072 6f6a 6563 7420 6f72 2063 6f6e  : project or con
-00009470: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
-00009480: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
-00009490: 2022 6e61 6d65 223a 206e 616d 652c 0a20   "name": name,. 
-000094a0: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
-000094b0: 3a20 7461 672c 0a20 2020 2020 2020 2020  : tag,.         
-000094c0: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
-000094d0: 6c73 206f 7220 5b5d 2c0a 2020 2020 2020  ls or [],.      
-000094e0: 2020 7d0a 2020 2020 2020 2020 6572 726f    }.        erro
-000094f0: 7220 3d20 226c 6973 7420 6675 6e63 7469  r = "list functi
-00009500: 6f6e 7322 0a20 2020 2020 2020 2072 6573  ons".        res
-00009510: 7020 3d20 7365 6c66 2e61 7069 5f63 616c  p = self.api_cal
-00009520: 6c28 2247 4554 222c 2022 6675 6e63 7322  l("GET", "funcs"
-00009530: 2c20 6572 726f 722c 2070 6172 616d 733d  , error, params=
-00009540: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
-00009550: 7265 7475 726e 2072 6573 702e 6a73 6f6e  return resp.json
-00009560: 2829 5b22 6675 6e63 7322 5d0a 0a20 2020  ()["funcs"]..   
-00009570: 2064 6566 206c 6973 745f 7275 6e74 696d   def list_runtim
-00009580: 655f 7265 736f 7572 6365 7328 0a20 2020  e_resources(.   
-00009590: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000095a0: 2020 2070 726f 6a65 6374 3a20 4f70 7469     project: Opti
-000095b0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-000095c0: 2c0a 2020 2020 2020 2020 6c61 6265 6c5f  ,.        label_
-000095d0: 7365 6c65 6374 6f72 3a20 4f70 7469 6f6e  selector: Option
-000095e0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-000095f0: 2020 2020 2020 2020 6b69 6e64 3a20 4f70          kind: Op
-00009600: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-00009610: 6e65 2c0a 2020 2020 2020 2020 6f62 6a65  ne,.        obje
-00009620: 6374 5f69 643a 204f 7074 696f 6e61 6c5b  ct_id: Optional[
-00009630: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00009640: 2020 2020 2067 726f 7570 5f62 793a 204f       group_by: O
-00009650: 7074 696f 6e61 6c5b 6d6c 7275 6e2e 6170  ptional[mlrun.ap
-00009660: 692e 7363 6865 6d61 732e 4c69 7374 5275  i.schemas.ListRu
-00009670: 6e74 696d 6552 6573 6f75 7263 6573 4772  ntimeResourcesGr
-00009680: 6f75 7042 7946 6965 6c64 5d20 3d20 4e6f  oupByField] = No
-00009690: 6e65 2c0a 2020 2020 2920 2d3e 2055 6e69  ne,.    ) -> Uni
-000096a0: 6f6e 5b0a 2020 2020 2020 2020 6d6c 7275  on[.        mlru
-000096b0: 6e2e 6170 692e 7363 6865 6d61 732e 5275  n.api.schemas.Ru
-000096c0: 6e74 696d 6552 6573 6f75 7263 6573 4f75  ntimeResourcesOu
-000096d0: 7470 7574 2c0a 2020 2020 2020 2020 6d6c  tput,.        ml
-000096e0: 7275 6e2e 6170 692e 7363 6865 6d61 732e  run.api.schemas.
-000096f0: 4772 6f75 7065 6442 794a 6f62 5275 6e74  GroupedByJobRunt
-00009700: 696d 6552 6573 6f75 7263 6573 4f75 7470  imeResourcesOutp
-00009710: 7574 2c0a 2020 2020 2020 2020 6d6c 7275  ut,.        mlru
-00009720: 6e2e 6170 692e 7363 6865 6d61 732e 4772  n.api.schemas.Gr
-00009730: 6f75 7065 6442 7950 726f 6a65 6374 5275  oupedByProjectRu
-00009740: 6e74 696d 6552 6573 6f75 7263 6573 4f75  ntimeResourcesOu
-00009750: 7470 7574 2c0a 2020 2020 5d3a 0a20 2020  tput,.    ]:.   
-00009760: 2020 2020 2022 2222 4c69 7374 2063 7572       """List cur
-00009770: 7265 6e74 2072 756e 7469 6d65 2072 6573  rent runtime res
-00009780: 6f75 7263 6573 2c20 7768 6963 6820 6172  ources, which ar
-00009790: 6520 7573 7561 6c6c 7920 2862 7574 206e  e usually (but n
-000097a0: 6f74 206c 696d 6974 6564 2074 6f29 204b  ot limited to) K
-000097b0: 7562 6572 6e65 7465 7320 706f 6473 206f  ubernetes pods o
-000097c0: 7220 4352 4473 2e0a 2020 2020 2020 2020  r CRDs..        
-000097d0: 4675 6e63 7469 6f6e 2061 7070 6c69 6573  Function applies
-000097e0: 2066 6f72 2072 756e 7320 6f66 2074 7970   for runs of typ
-000097f0: 6520 605b 2764 6173 6b27 2c20 276a 6f62  e `['dask', 'job
-00009800: 272c 2027 7370 6172 6b27 2c20 2772 656d  ', 'spark', 'rem
-00009810: 6f74 652d 7370 6172 6b27 2c20 276d 7069  ote-spark', 'mpi
-00009820: 6a6f 6227 5d60 2c20 616e 6420 7769 6c6c  job']`, and will
-00009830: 2072 6574 7572 6e20 7065 720a 2020 2020   return per.    
-00009840: 2020 2020 7275 6e74 696d 6520 6b69 6e64      runtime kind
-00009850: 2061 206c 6973 7420 6f66 2074 6865 2072   a list of the r
-00009860: 756e 7469 6d65 2072 6573 6f75 7263 6573  untime resources
-00009870: 2028 7768 6963 6820 6d61 7920 6861 7665   (which may have
-00009880: 2061 6c72 6561 6479 2063 6f6d 706c 6574   already complet
-00009890: 6564 2074 6865 6972 2065 7865 6375 7469  ed their executi
-000098a0: 6f6e 292e 0a0a 2020 2020 2020 2020 3a70  on)...        :p
-000098b0: 6172 616d 2070 726f 6a65 6374 3a20 4765  aram project: Ge
-000098c0: 7420 6f6e 6c79 2072 756e 7469 6d65 2072  t only runtime r
-000098d0: 6573 6f75 7263 6573 206f 6620 6120 7370  esources of a sp
-000098e0: 6563 6966 6963 2070 726f 6a65 6374 2c20  ecific project, 
-000098f0: 6279 2064 6566 6175 6c74 204e 6f6e 652c  by default None,
-00009900: 2077 6869 6368 2077 696c 6c20 7265 7475   which will retu
-00009910: 726e 206f 6e6c 7920 7468 650a 2020 2020  rn only the.    
-00009920: 2020 2020 2020 2020 7072 6f6a 6563 7473          projects
-00009930: 2079 6f75 2772 6520 6175 7468 6f72 697a   you're authoriz
-00009940: 6564 2074 6f20 7365 652e 0a20 2020 2020  ed to see..     
-00009950: 2020 203a 7061 7261 6d20 6c61 6265 6c5f     :param label_
-00009960: 7365 6c65 6374 6f72 3a20 4120 6c61 6265  selector: A labe
-00009970: 6c20 6669 6c74 6572 2074 6861 7420 7769  l filter that wi
-00009980: 6c6c 2062 6520 7061 7373 6564 2074 6f20  ll be passed to 
-00009990: 4b75 6265 726e 6574 6573 2066 6f72 2066  Kubernetes for f
-000099a0: 696c 7465 7269 6e67 2074 6865 2072 6573  iltering the res
-000099b0: 756c 7473 2061 6363 6f72 6469 6e67 0a20  ults according. 
-000099c0: 2020 2020 2020 2020 2020 2074 6f20 7468             to th
-000099d0: 6569 7220 6c61 6265 6c73 2e0a 2020 2020  eir labels..    
-000099e0: 2020 2020 3a70 6172 616d 206b 696e 643a      :param kind:
-000099f0: 2054 6865 206b 696e 6420 6f66 2072 756e   The kind of run
-00009a00: 7469 6d65 2074 6f20 7175 6572 792e 204d  time to query. M
-00009a10: 6179 2062 6520 6f6e 6520 6f66 2060 5b27  ay be one of `['
-00009a20: 6461 736b 272c 2027 6a6f 6227 2c20 2773  dask', 'job', 's
-00009a30: 7061 726b 272c 2027 7265 6d6f 7465 2d73  park', 'remote-s
-00009a40: 7061 726b 272c 2027 6d70 696a 6f62 275d  park', 'mpijob']
-00009a50: 600a 2020 2020 2020 2020 3a70 6172 616d  `.        :param
-00009a60: 206f 626a 6563 745f 6964 3a20 5468 6520   object_id: The 
-00009a70: 6964 656e 7469 6669 6572 206f 6620 7468  identifier of th
-00009a80: 6520 6d6c 7275 6e20 6f62 6a65 6374 2074  e mlrun object t
-00009a90: 6f20 7175 6572 7920 6974 7320 7275 6e74  o query its runt
-00009aa0: 696d 6520 7265 736f 7572 6365 732e 2066  ime resources. f
-00009ab0: 6f72 206d 6f73 7420 6675 6e63 7469 6f6e  or most function
-00009ac0: 2072 756e 7469 6d65 732c 0a20 2020 2020   runtimes,.     
-00009ad0: 2020 2020 2020 2072 756e 7469 6d65 2072         runtime r
-00009ae0: 6573 6f75 7263 6573 2061 7265 2070 6572  esources are per
-00009af0: 2052 756e 2c20 666f 7220 7768 6963 6820   Run, for which 
-00009b00: 7468 6520 6964 656e 7469 6669 6572 2069  the identifier i
-00009b10: 7320 7468 6520 5275 6e27 7320 5549 442e  s the Run's UID.
-00009b20: 2046 6f72 2064 6173 6b20 7275 6e74 696d   For dask runtim
-00009b30: 652c 2074 6865 2072 756e 7469 6d65 0a20  e, the runtime. 
-00009b40: 2020 2020 2020 2020 2020 2072 6573 6f75             resou
-00009b50: 7263 6573 2061 7265 2070 6572 2046 756e  rces are per Fun
-00009b60: 6374 696f 6e2c 2066 6f72 2077 6869 6368  ction, for which
-00009b70: 2074 6865 2069 6465 6e74 6966 6965 7220   the identifier 
-00009b80: 6973 2074 6865 2046 756e 6374 696f 6e27  is the Function'
-00009b90: 7320 6e61 6d65 2e0a 2020 2020 2020 2020  s name..        
-00009ba0: 3a70 6172 616d 2067 726f 7570 5f62 793a  :param group_by:
-00009bb0: 204f 626a 6563 7420 746f 2067 726f 7570   Object to group
-00009bc0: 2072 6573 756c 7473 2062 792e 2041 6c6c   results by. All
-00009bd0: 6f77 6564 2076 616c 7565 7320 6172 6520  owed values are 
-00009be0: 606a 6f62 6020 616e 6420 6070 726f 6a65  `job` and `proje
-00009bf0: 6374 602e 0a20 2020 2020 2020 2022 2222  ct`..        """
-00009c00: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00009c10: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00009c20: 226c 6162 656c 5f73 656c 6563 746f 7222  "label_selector"
-00009c30: 3a20 6c61 6265 6c5f 7365 6c65 6374 6f72  : label_selector
-00009c40: 2c0a 2020 2020 2020 2020 2020 2020 2267  ,.            "g
-00009c50: 726f 7570 2d62 7922 3a20 6772 6f75 705f  roup-by": group_
-00009c60: 6279 2c0a 2020 2020 2020 2020 2020 2020  by,.            
-00009c70: 226b 696e 6422 3a20 6b69 6e64 2c0a 2020  "kind": kind,.  
-00009c80: 2020 2020 2020 2020 2020 226f 626a 6563            "objec
-00009c90: 742d 6964 223a 206f 626a 6563 745f 6964  t-id": object_id
-00009ca0: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-00009cb0: 2020 2020 7072 6f6a 6563 745f 7061 7468      project_path
-00009cc0: 203d 2070 726f 6a65 6374 2069 6620 7072   = project if pr
-00009cd0: 6f6a 6563 7420 656c 7365 2022 2a22 0a20  oject else "*". 
-00009ce0: 2020 2020 2020 2065 7272 6f72 203d 2022         error = "
-00009cf0: 4661 696c 6564 206c 6973 7469 6e67 2072  Failed listing r
-00009d00: 756e 7469 6d65 2072 6573 6f75 7263 6573  untime resources
-00009d10: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
-00009d20: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
-00009d30: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-00009d40: 2247 4554 222c 2066 2270 726f 6a65 6374  "GET", f"project
-00009d50: 732f 7b70 726f 6a65 6374 5f70 6174 687d  s/{project_path}
-00009d60: 2f72 756e 7469 6d65 2d72 6573 6f75 7263  /runtime-resourc
-00009d70: 6573 222c 2065 7272 6f72 2c20 7061 7261  es", error, para
-00009d80: 6d73 3d70 6172 616d 730a 2020 2020 2020  ms=params.      
-00009d90: 2020 290a 2020 2020 2020 2020 6966 2067    ).        if g
-00009da0: 726f 7570 5f62 7920 6973 204e 6f6e 653a  roup_by is None:
-00009db0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-00009dc0: 7563 7475 7265 645f 6c69 7374 203d 205b  uctured_list = [
-00009dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009de0: 206d 6c72 756e 2e61 7069 2e73 6368 656d   mlrun.api.schem
-00009df0: 6173 2e4b 696e 6452 756e 7469 6d65 5265  as.KindRuntimeRe
-00009e00: 736f 7572 6365 7328 2a2a 6b69 6e64 5f72  sources(**kind_r
-00009e10: 756e 7469 6d65 5f72 6573 6f75 7263 6573  untime_resources
-00009e20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009e30: 2020 666f 7220 6b69 6e64 5f72 756e 7469    for kind_runti
-00009e40: 6d65 5f72 6573 6f75 7263 6573 2069 6e20  me_resources in 
-00009e50: 7265 7370 6f6e 7365 2e6a 736f 6e28 290a  response.json().
-00009e60: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-00009e70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009e80: 2073 7472 7563 7475 7265 645f 6c69 7374   structured_list
-00009e90: 0a20 2020 2020 2020 2065 6c69 6620 6772  .        elif gr
-00009ea0: 6f75 705f 6279 203d 3d20 6d6c 7275 6e2e  oup_by == mlrun.
-00009eb0: 6170 692e 7363 6865 6d61 732e 4c69 7374  api.schemas.List
-00009ec0: 5275 6e74 696d 6552 6573 6f75 7263 6573  RuntimeResources
-00009ed0: 4772 6f75 7042 7946 6965 6c64 2e6a 6f62  GroupByField.job
-00009ee0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-00009ef0: 7275 6374 7572 6564 5f64 6963 7420 3d20  ructured_dict = 
-00009f00: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-00009f10: 6f72 2070 726f 6a65 6374 2c20 6a6f 625f  or project, job_
-00009f20: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-00009f30: 735f 6d61 7020 696e 2072 6573 706f 6e73  s_map in respons
-00009f40: 652e 6a73 6f6e 2829 2e69 7465 6d73 2829  e.json().items()
-00009f50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009f60: 2020 666f 7220 6a6f 625f 6964 2c20 7275    for job_id, ru
-00009f70: 6e74 696d 655f 7265 736f 7572 6365 7320  ntime_resources 
-00009f80: 696e 206a 6f62 5f72 756e 7469 6d65 5f72  in job_runtime_r
-00009f90: 6573 6f75 7263 6573 5f6d 6170 2e69 7465  esources_map.ite
-00009fa0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00009fb0: 2020 2020 2020 2020 2020 7374 7275 6374            struct
-00009fc0: 7572 6564 5f64 6963 742e 7365 7464 6566  ured_dict.setdef
-00009fd0: 6175 6c74 2870 726f 6a65 6374 2c20 7b7d  ault(project, {}
-00009fe0: 295b 0a20 2020 2020 2020 2020 2020 2020  )[.             
-00009ff0: 2020 2020 2020 2020 2020 206a 6f62 5f69             job_i
-0000a000: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0000a010: 2020 2020 2020 5d20 3d20 6d6c 7275 6e2e        ] = mlrun.
-0000a020: 6170 692e 7363 6865 6d61 732e 5275 6e74  api.schemas.Runt
-0000a030: 696d 6552 6573 6f75 7263 6573 282a 2a72  imeResources(**r
-0000a040: 756e 7469 6d65 5f72 6573 6f75 7263 6573  untime_resources
-0000a050: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000a060: 7475 726e 2073 7472 7563 7475 7265 645f  turn structured_
-0000a070: 6469 6374 0a20 2020 2020 2020 2065 6c69  dict.        eli
-0000a080: 6620 6772 6f75 705f 6279 203d 3d20 6d6c  f group_by == ml
-0000a090: 7275 6e2e 6170 692e 7363 6865 6d61 732e  run.api.schemas.
-0000a0a0: 4c69 7374 5275 6e74 696d 6552 6573 6f75  ListRuntimeResou
-0000a0b0: 7263 6573 4772 6f75 7042 7946 6965 6c64  rcesGroupByField
-0000a0c0: 2e70 726f 6a65 6374 3a0a 2020 2020 2020  .project:.      
-0000a0d0: 2020 2020 2020 7374 7275 6374 7572 6564        structured
-0000a0e0: 5f64 6963 7420 3d20 7b7d 0a20 2020 2020  _dict = {}.     
-0000a0f0: 2020 2020 2020 2066 6f72 2070 726f 6a65         for proje
-0000a100: 6374 2c20 6b69 6e64 5f72 756e 7469 6d65  ct, kind_runtime
-0000a110: 5f72 6573 6f75 7263 6573 5f6d 6170 2069  _resources_map i
-0000a120: 6e20 7265 7370 6f6e 7365 2e6a 736f 6e28  n response.json(
-0000a130: 292e 6974 656d 7328 293a 0a20 2020 2020  ).items():.     
-0000a140: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-0000a150: 696e 642c 2072 756e 7469 6d65 5f72 6573  ind, runtime_res
-0000a160: 6f75 7263 6573 2069 6e20 6b69 6e64 5f72  ources in kind_r
-0000a170: 756e 7469 6d65 5f72 6573 6f75 7263 6573  untime_resources
-0000a180: 5f6d 6170 2e69 7465 6d73 2829 3a0a 2020  _map.items():.  
-0000a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1a0: 2020 7374 7275 6374 7572 6564 5f64 6963    structured_dic
-0000a1b0: 742e 7365 7464 6566 6175 6c74 2870 726f  t.setdefault(pro
-0000a1c0: 6a65 6374 2c20 7b7d 295b 0a20 2020 2020  ject, {})[.     
-0000a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1e0: 2020 206b 696e 640a 2020 2020 2020 2020     kind.        
-0000a1f0: 2020 2020 2020 2020 2020 2020 5d20 3d20              ] = 
-0000a200: 6d6c 7275 6e2e 6170 692e 7363 6865 6d61  mlrun.api.schema
-0000a210: 732e 5275 6e74 696d 6552 6573 6f75 7263  s.RuntimeResourc
-0000a220: 6573 282a 2a72 756e 7469 6d65 5f72 6573  es(**runtime_res
-0000a230: 6f75 7263 6573 290a 2020 2020 2020 2020  ources).        
-0000a240: 2020 2020 7265 7475 726e 2073 7472 7563      return struc
-0000a250: 7475 7265 645f 6469 6374 0a20 2020 2020  tured_dict.     
-0000a260: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a270: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-0000a280: 706c 656d 656e 7465 6445 7272 6f72 280a  plementedError(.
-0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2a0: 6622 5072 6f76 6964 6564 2067 726f 7570  f"Provided group
-0000a2b0: 2062 7920 6669 656c 6420 6973 206e 6f74   by field is not
-0000a2c0: 2073 7570 706f 7274 6564 2e20 6772 6f75   supported. grou
-0000a2d0: 705f 6279 3d7b 6772 6f75 705f 6279 7d22  p_by={group_by}"
-0000a2e0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0000a2f0: 2020 2020 6465 6620 6465 6c65 7465 5f72      def delete_r
-0000a300: 756e 7469 6d65 5f72 6573 6f75 7263 6573  untime_resources
-0000a310: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000a320: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
-0000a330: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0000a340: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-0000a350: 6162 656c 5f73 656c 6563 746f 723a 204f  abel_selector: O
-0000a360: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000a370: 6f6e 652c 0a20 2020 2020 2020 206b 696e  one,.        kin
-0000a380: 643a 204f 7074 696f 6e61 6c5b 7374 725d  d: Optional[str]
-0000a390: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000a3a0: 206f 626a 6563 745f 6964 3a20 4f70 7469   object_id: Opti
-0000a3b0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0000a3c0: 2c0a 2020 2020 2020 2020 666f 7263 653a  ,.        force:
-0000a3d0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000a3e0: 2020 2020 2020 2067 7261 6365 5f70 6572         grace_per
-0000a3f0: 696f 643a 2069 6e74 203d 204e 6f6e 652c  iod: int = None,
-0000a400: 0a20 2020 2029 202d 3e20 6d6c 7275 6e2e  .    ) -> mlrun.
-0000a410: 6170 692e 7363 6865 6d61 732e 4772 6f75  api.schemas.Grou
-0000a420: 7065 6442 7950 726f 6a65 6374 5275 6e74  pedByProjectRunt
-0000a430: 696d 6552 6573 6f75 7263 6573 4f75 7470  imeResourcesOutp
-0000a440: 7574 3a0a 2020 2020 2020 2020 2222 2244  ut:.        """D
-0000a450: 656c 6574 6520 616c 6c20 7275 6e74 696d  elete all runtim
-0000a460: 6520 7265 736f 7572 6365 7320 7768 6963  e resources whic
-0000a470: 6820 6172 6520 696e 2074 6572 6d69 6e61  h are in termina
-0000a480: 6c20 7374 6174 652e 0a0a 2020 2020 2020  l state...      
-0000a490: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-0000a4a0: 3a20 4465 6c65 7465 206f 6e6c 7920 7275  : Delete only ru
-0000a4b0: 6e74 696d 6520 7265 736f 7572 6365 7320  ntime resources 
-0000a4c0: 6f66 2061 2073 7065 6369 6669 6320 7072  of a specific pr
-0000a4d0: 6f6a 6563 742c 2062 7920 6465 6661 756c  oject, by defaul
-0000a4e0: 7420 4e6f 6e65 2c20 7768 6963 6820 7769  t None, which wi
-0000a4f0: 6c6c 2064 656c 6574 6520 6f6e 6c79 0a20  ll delete only. 
-0000a500: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-0000a510: 7468 6520 7072 6f6a 6563 7473 2079 6f75  the projects you
-0000a520: 2772 6520 6175 7468 6f72 697a 6564 2074  're authorized t
-0000a530: 6f20 6465 6c65 7465 2066 726f 6d2e 0a20  o delete from.. 
-0000a540: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
-0000a550: 6265 6c5f 7365 6c65 6374 6f72 3a20 4465  bel_selector: De
-0000a560: 6c65 7465 206f 6e6c 7920 7275 6e74 696d  lete only runtim
-0000a570: 6520 7265 736f 7572 6365 7320 6d61 7463  e resources matc
-0000a580: 6869 6e67 2074 6865 206c 6162 656c 2073  hing the label s
-0000a590: 656c 6563 746f 722e 0a20 2020 2020 2020  elector..       
-0000a5a0: 203a 7061 7261 6d20 6b69 6e64 3a20 5468   :param kind: Th
-0000a5b0: 6520 6b69 6e64 206f 6620 7275 6e74 696d  e kind of runtim
-0000a5c0: 6520 746f 2064 656c 6574 652e 204d 6179  e to delete. May
-0000a5d0: 2062 6520 6f6e 6520 6f66 2060 5b27 6461   be one of `['da
-0000a5e0: 736b 272c 2027 6a6f 6227 2c20 2773 7061  sk', 'job', 'spa
-0000a5f0: 726b 272c 2027 7265 6d6f 7465 2d73 7061  rk', 'remote-spa
-0000a600: 726b 272c 2027 6d70 696a 6f62 275d 600a  rk', 'mpijob']`.
-0000a610: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-0000a620: 626a 6563 745f 6964 3a20 5468 6520 6964  bject_id: The id
-0000a630: 656e 7469 6669 6572 206f 6620 7468 6520  entifier of the 
-0000a640: 6d6c 7275 6e20 6f62 6a65 6374 2074 6f20  mlrun object to 
-0000a650: 6465 6c65 7465 2069 7473 2072 756e 7469  delete its runti
-0000a660: 6d65 2072 6573 6f75 7263 6573 2e20 666f  me resources. fo
-0000a670: 7220 6d6f 7374 2066 756e 6374 696f 6e0a  r most function.
-0000a680: 2020 2020 2020 2020 2020 2020 7275 6e74              runt
-0000a690: 696d 6573 2c20 7275 6e74 696d 6520 7265  imes, runtime re
-0000a6a0: 736f 7572 6365 7320 6172 6520 7065 7220  sources are per 
-0000a6b0: 5275 6e2c 2066 6f72 2077 6869 6368 2074  Run, for which t
-0000a6c0: 6865 2069 6465 6e74 6966 6965 7220 6973  he identifier is
-0000a6d0: 2074 6865 2052 756e 2773 2055 4944 2e20   the Run's UID. 
-0000a6e0: 466f 7220 6461 736b 2072 756e 7469 6d65  For dask runtime
-0000a6f0: 2c20 7468 650a 2020 2020 2020 2020 2020  , the.          
-0000a700: 2020 7275 6e74 696d 6520 7265 736f 7572    runtime resour
-0000a710: 6365 7320 6172 6520 7065 7220 4675 6e63  ces are per Func
-0000a720: 7469 6f6e 2c20 666f 7220 7768 6963 6820  tion, for which 
-0000a730: 7468 6520 6964 656e 7469 6669 6572 2069  the identifier i
-0000a740: 7320 7468 6520 4675 6e63 7469 6f6e 2773  s the Function's
-0000a750: 206e 616d 652e 0a20 2020 2020 2020 203a   name..        :
-0000a760: 7061 7261 6d20 666f 7263 653a 2046 6f72  param force: For
-0000a770: 6365 2064 656c 6574 696f 6e20 2d20 6465  ce deletion - de
-0000a780: 6c65 7465 2074 6865 2072 756e 7469 6d65  lete the runtime
-0000a790: 2072 6573 6f75 7263 6520 6576 656e 2069   resource even i
-0000a7a0: 6620 6974 2773 206e 6f74 2069 6e20 7465  f it's not in te
-0000a7b0: 726d 696e 616c 2073 7461 7465 206f 7220  rminal state or 
-0000a7c0: 6966 2074 6865 2067 7261 6365 0a20 2020  if the grace.   
-0000a7d0: 2020 2020 2020 2020 2070 6572 696f 6420           period 
-0000a7e0: 6469 646e 2774 2070 6173 732e 0a20 2020  didn't pass..   
-0000a7f0: 2020 2020 203a 7061 7261 6d20 6772 6163       :param grac
-0000a800: 655f 7065 7269 6f64 3a20 4772 6163 6520  e_period: Grace 
-0000a810: 7065 7269 6f64 2067 6976 656e 2074 6f20  period given to 
-0000a820: 7468 6520 7275 6e74 696d 6520 7265 736f  the runtime reso
-0000a830: 7572 6365 2062 6566 6f72 6520 7468 6579  urce before they
-0000a840: 2061 7265 2061 6374 7561 6c6c 7920 7265   are actually re
-0000a850: 6d6f 7665 642c 2063 6f75 6e74 6564 2066  moved, counted f
-0000a860: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
-0000a870: 7468 6520 6d6f 6d65 6e74 2074 6865 7920  the moment they 
-0000a880: 6d6f 7665 6420 746f 2074 6572 6d69 6e61  moved to termina
-0000a890: 6c20 7374 6174 6520 2864 6566 6175 6c74  l state (default
-0000a8a0: 7320 746f 206d 6c72 756e 2e6d 6c63 6f6e  s to mlrun.mlcon
-0000a8b0: 662e 7275 6e74 696d 655f 7265 736f 7572  f.runtime_resour
-0000a8c0: 6365 735f 6465 6c65 7469 6f6e 5f67 7261  ces_deletion_gra
-0000a8d0: 6365 5f70 6572 696f 6429 2e0a 0a20 2020  ce_period)...   
-0000a8e0: 2020 2020 203a 7265 7475 726e 733a 203a       :returns: :
-0000a8f0: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
-0000a900: 2e61 7069 2e73 6368 656d 6173 2e47 726f  .api.schemas.Gro
-0000a910: 7570 6564 4279 5072 6f6a 6563 7452 756e  upedByProjectRun
-0000a920: 7469 6d65 5265 736f 7572 6365 734f 7574  timeResourcesOut
-0000a930: 7075 7460 206c 6973 7469 6e67 2074 6865  put` listing the
-0000a940: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
-0000a950: 6573 0a20 2020 2020 2020 2020 2020 2074  es.            t
-0000a960: 6861 7420 7765 7265 2072 656d 6f76 6564  hat were removed
-0000a970: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000a980: 2020 2020 2020 6966 2067 7261 6365 5f70        if grace_p
-0000a990: 6572 696f 6420 6973 204e 6f6e 653a 0a20  eriod is None:. 
-0000a9a0: 2020 2020 2020 2020 2020 2067 7261 6365             grace
-0000a9b0: 5f70 6572 696f 6420 3d20 636f 6e66 6967  _period = config
-0000a9c0: 2e72 756e 7469 6d65 5f72 6573 6f75 7263  .runtime_resourc
-0000a9d0: 6573 5f64 656c 6574 696f 6e5f 6772 6163  es_deletion_grac
-0000a9e0: 655f 7065 7269 6f64 0a20 2020 2020 2020  e_period.       
-0000a9f0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-0000aa00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000aa10: 2020 2255 7369 6e67 2064 6566 6175 6c74    "Using default
-0000aa20: 2067 7261 6365 2070 6572 696f 6420 666f   grace period fo
-0000aa30: 7220 7275 6e74 696d 6520 7265 736f 7572  r runtime resour
-0000aa40: 6365 7320 6465 6c65 7469 6f6e 222c 0a20  ces deletion",. 
-0000aa50: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000aa60: 7261 6365 5f70 6572 696f 643d 6772 6163  race_period=grac
-0000aa70: 655f 7065 7269 6f64 2c0a 2020 2020 2020  e_period,.      
-0000aa80: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000aa90: 2070 6172 616d 7320 3d20 7b0a 2020 2020   params = {.    
-0000aaa0: 2020 2020 2020 2020 226c 6162 656c 2d73          "label-s
-0000aab0: 656c 6563 746f 7222 3a20 6c61 6265 6c5f  elector": label_
-0000aac0: 7365 6c65 6374 6f72 2c0a 2020 2020 2020  selector,.      
-0000aad0: 2020 2020 2020 226b 696e 6422 3a20 6b69        "kind": ki
-0000aae0: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
-0000aaf0: 226f 626a 6563 742d 6964 223a 206f 626a  "object-id": obj
-0000ab00: 6563 745f 6964 2c0a 2020 2020 2020 2020  ect_id,.        
-0000ab10: 2020 2020 2266 6f72 6365 223a 2066 6f72      "force": for
-0000ab20: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-0000ab30: 2267 7261 6365 2d70 6572 696f 6422 3a20  "grace-period": 
-0000ab40: 6772 6163 655f 7065 7269 6f64 2c0a 2020  grace_period,.  
-0000ab50: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000ab60: 6572 726f 7220 3d20 2246 6169 6c65 6420  error = "Failed 
-0000ab70: 6465 6c65 7469 6e67 2072 756e 7469 6d65  deleting runtime
-0000ab80: 2072 6573 6f75 7263 6573 220a 2020 2020   resources".    
-0000ab90: 2020 2020 7072 6f6a 6563 745f 7061 7468      project_path
-0000aba0: 203d 2070 726f 6a65 6374 2069 6620 7072   = project if pr
-0000abb0: 6f6a 6563 7420 656c 7365 2022 2a22 0a20  oject else "*". 
-0000abc0: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-0000abd0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0000abe0: 0a20 2020 2020 2020 2020 2020 2022 4445  .            "DE
-0000abf0: 4c45 5445 222c 0a20 2020 2020 2020 2020  LETE",.         
-0000ac00: 2020 2066 2270 726f 6a65 6374 732f 7b70     f"projects/{p
-0000ac10: 726f 6a65 6374 5f70 6174 687d 2f72 756e  roject_path}/run
-0000ac20: 7469 6d65 2d72 6573 6f75 7263 6573 222c  time-resources",
-0000ac30: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-0000ac40: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0000ac50: 7061 7261 6d73 3d70 6172 616d 732c 0a20  params=params,. 
-0000ac60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000ac70: 2073 7472 7563 7475 7265 645f 6469 6374   structured_dict
-0000ac80: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-0000ac90: 7220 7072 6f6a 6563 742c 206b 696e 645f  r project, kind_
-0000aca0: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-0000acb0: 735f 6d61 7020 696e 2072 6573 706f 6e73  s_map in respons
-0000acc0: 652e 6a73 6f6e 2829 2e69 7465 6d73 2829  e.json().items()
-0000acd0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000ace0: 7220 6b69 6e64 2c20 7275 6e74 696d 655f  r kind, runtime_
-0000acf0: 7265 736f 7572 6365 7320 696e 206b 696e  resources in kin
-0000ad00: 645f 7275 6e74 696d 655f 7265 736f 7572  d_runtime_resour
-0000ad10: 6365 735f 6d61 702e 6974 656d 7328 293a  ces_map.items():
-0000ad20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad30: 2073 7472 7563 7475 7265 645f 6469 6374   structured_dict
-0000ad40: 2e73 6574 6465 6661 756c 7428 7072 6f6a  .setdefault(proj
-0000ad50: 6563 742c 207b 7d29 5b0a 2020 2020 2020  ect, {})[.      
-0000ad60: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
-0000ad70: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
-0000ad80: 2020 205d 203d 206d 6c72 756e 2e61 7069     ] = mlrun.api
-0000ad90: 2e73 6368 656d 6173 2e52 756e 7469 6d65  .schemas.Runtime
-0000ada0: 5265 736f 7572 6365 7328 2a2a 7275 6e74  Resources(**runt
-0000adb0: 696d 655f 7265 736f 7572 6365 7329 0a20  ime_resources). 
-0000adc0: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
-0000add0: 7275 6374 7572 6564 5f64 6963 740a 0a20  ructured_dict.. 
-0000ade0: 2020 2064 6566 2063 7265 6174 655f 7363     def create_sc
-0000adf0: 6865 6475 6c65 2873 656c 662c 2070 726f  hedule(self, pro
-0000ae00: 6a65 6374 3a20 7374 722c 2073 6368 6564  ject: str, sched
-0000ae10: 756c 653a 2073 6368 656d 6173 2e53 6368  ule: schemas.Sch
-0000ae20: 6564 756c 6549 6e70 7574 293a 0a20 2020  eduleInput):.   
-0000ae30: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
-0000ae40: 206e 6577 2073 6368 6564 756c 6520 6f6e   new schedule on
-0000ae50: 2074 6865 2067 6976 656e 2070 726f 6a65   the given proje
-0000ae60: 6374 2e20 5468 6520 6465 7461 696c 7320  ct. The details 
-0000ae70: 6f6e 2074 6865 2061 6374 7561 6c20 6f62  on the actual ob
-0000ae80: 6a65 6374 2074 6f20 7363 6865 6475 6c65  ject to schedule
-0000ae90: 2061 7320 7765 6c6c 2061 7320 7468 650a   as well as the.
-0000aea0: 2020 2020 2020 2020 7363 6865 6475 6c65          schedule
-0000aeb0: 2069 7473 656c 6620 6172 6520 7769 7468   itself are with
-0000aec0: 696e 2074 6865 2073 6368 6564 756c 6520  in the schedule 
-0000aed0: 6f62 6a65 6374 2070 726f 7669 6465 642e  object provided.
-0000aee0: 0a20 2020 2020 2020 2054 6865 203a 7079  .        The :py
-0000aef0: 3a63 6c61 7373 3a60 7e53 6368 6564 756c  :class:`~Schedul
-0000af00: 6543 726f 6e54 7269 6767 6572 6020 666f  eCronTrigger` fo
-0000af10: 6c6c 6f77 7320 7468 6520 6775 6964 656c  llows the guidel
-0000af20: 696e 6573 2069 6e0a 2020 2020 2020 2020  ines in.        
-0000af30: 6874 7470 733a 2f2f 6170 7363 6865 6475  https://apschedu
-0000af40: 6c65 722e 7265 6164 7468 6564 6f63 732e  ler.readthedocs.
-0000af50: 696f 2f65 6e2f 332e 782f 6d6f 6475 6c65  io/en/3.x/module
-0000af60: 732f 7472 6967 6765 7273 2f63 726f 6e2e  s/triggers/cron.
-0000af70: 6874 6d6c 2e0a 2020 2020 2020 2020 4974  html..        It
-0000af80: 2061 6c73 6f20 7375 7070 6f72 7473 2061   also supports a
-0000af90: 203a 7079 3a66 756e 633a 607e 5363 6865   :py:func:`~Sche
-0000afa0: 6475 6c65 4372 6f6e 5472 6967 6765 722e  duleCronTrigger.
-0000afb0: 6672 6f6d 5f63 726f 6e74 6162 6020 6675  from_crontab` fu
-0000afc0: 6e63 7469 6f6e 2074 6861 7420 6163 6365  nction that acce
-0000afd0: 7074 7320 610a 2020 2020 2020 2020 6372  pts a.        cr
-0000afe0: 6f6e 7461 622d 666f 726d 6174 7465 6420  ontab-formatted 
-0000aff0: 7374 7269 6e67 2028 7365 6520 6874 7470  string (see http
-0000b000: 733a 2f2f 656e 2e77 696b 6970 6564 6961  s://en.wikipedia
-0000b010: 2e6f 7267 2f77 696b 692f 4372 6f6e 2066  .org/wiki/Cron f
-0000b020: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
-0000b030: 696f 6e20 6f6e 2074 6865 2066 6f72 6d61  ion on the forma
-0000b040: 7420 616e 640a 2020 2020 2020 2020 6e6f  t and.        no
-0000b050: 7465 2074 6861 7420 7468 6520 3020 7765  te that the 0 we
-0000b060: 656b 6461 7920 6973 2061 6c77 6179 7320  ekday is always 
-0000b070: 6d6f 6e64 6179 292e 0a0a 0a20 2020 2020  monday)....     
-0000b080: 2020 2045 7861 6d70 6c65 3a3a 0a0a 2020     Example::..  
-0000b090: 2020 2020 2020 2020 2020 6672 6f6d 206d            from m
-0000b0a0: 6c72 756e 2e61 7069 2069 6d70 6f72 7420  lrun.api import 
-0000b0b0: 7363 6865 6d61 730a 0a20 2020 2020 2020  schemas..       
-0000b0c0: 2020 2020 2023 2045 7865 6375 7465 2074       # Execute t
-0000b0d0: 6865 2067 6574 5f64 6174 615f 6675 6e63  he get_data_func
-0000b0e0: 2066 756e 6374 696f 6e20 6576 6572 7920   function every 
-0000b0f0: 5475 6573 6461 7920 6174 2031 353a 3330  Tuesday at 15:30
-0000b100: 0a20 2020 2020 2020 2020 2020 2073 6368  .            sch
-0000b110: 6564 756c 6520 3d20 7363 6865 6d61 732e  edule = schemas.
-0000b120: 5363 6865 6475 6c65 496e 7075 7428 0a20  ScheduleInput(. 
-0000b130: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000b140: 616d 653d 2272 756e 5f66 756e 635f 6f6e  ame="run_func_on
-0000b150: 5f74 7565 7364 6179 7322 2c0a 2020 2020  _tuesdays",.    
-0000b160: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
-0000b170: 3d22 6a6f 6222 2c0a 2020 2020 2020 2020  ="job",.        
-0000b180: 2020 2020 2020 2020 7363 6865 6475 6c65          schedule
-0000b190: 645f 6f62 6a65 6374 3d67 6574 5f64 6174  d_object=get_dat
-0000b1a0: 615f 6675 6e63 2c0a 2020 2020 2020 2020  a_func,.        
-0000b1b0: 2020 2020 2020 2020 6372 6f6e 5f74 7269          cron_tri
-0000b1c0: 6767 6572 3d73 6368 656d 6173 2e53 6368  gger=schemas.Sch
-0000b1d0: 6564 756c 6543 726f 6e54 7269 6767 6572  eduleCronTrigger
-0000b1e0: 2864 6179 5f6f 665f 7765 656b 3d27 7475  (day_of_week='tu
-0000b1f0: 6527 2c20 686f 7572 3d31 352c 206d 696e  e', hour=15, min
-0000b200: 7574 653d 3330 292c 0a20 2020 2020 2020  ute=30),.       
-0000b210: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000b220: 2020 2064 622e 6372 6561 7465 5f73 6368     db.create_sch
-0000b230: 6564 756c 6528 7072 6f6a 6563 745f 6e61  edule(project_na
-0000b240: 6d65 2c20 7363 6865 6475 6c65 290a 2020  me, schedule).  
-0000b250: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000b260: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
-0000b270: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
-0000b280: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
-0000b290: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-0000b2a0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-0000b2b0: 747d 2f73 6368 6564 756c 6573 220a 0a20  t}/schedules".. 
-0000b2c0: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-0000b2d0: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-0000b2e0: 6372 6561 7469 6e67 2073 6368 6564 756c  creating schedul
-0000b2f0: 6520 7b70 726f 6a65 6374 7d2f 7b73 6368  e {project}/{sch
-0000b300: 6564 756c 652e 6e61 6d65 7d22 0a20 2020  edule.name}".   
-0000b310: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
-0000b320: 6c6c 2822 504f 5354 222c 2070 6174 682c  ll("POST", path,
-0000b330: 2065 7272 6f72 5f6d 6573 7361 6765 2c20   error_message, 
-0000b340: 626f 6479 3d64 6963 745f 746f 5f6a 736f  body=dict_to_jso
-0000b350: 6e28 7363 6865 6475 6c65 2e64 6963 7428  n(schedule.dict(
-0000b360: 2929 290a 0a20 2020 2064 6566 2075 7064  )))..    def upd
-0000b370: 6174 655f 7363 6865 6475 6c65 280a 2020  ate_schedule(.  
-0000b380: 2020 2020 2020 7365 6c66 2c20 7072 6f6a        self, proj
-0000b390: 6563 743a 2073 7472 2c20 6e61 6d65 3a20  ect: str, name: 
-0000b3a0: 7374 722c 2073 6368 6564 756c 653a 2073  str, schedule: s
-0000b3b0: 6368 656d 6173 2e53 6368 6564 756c 6555  chemas.ScheduleU
-0000b3c0: 7064 6174 650a 2020 2020 293a 0a20 2020  pdate.    ):.   
-0000b3d0: 2020 2020 2022 2222 5570 6461 7465 2061       """Update a
-0000b3e0: 6e20 6578 6973 7469 6e67 2073 6368 6564  n existing sched
-0000b3f0: 756c 652c 2072 6570 6c61 6365 2069 7420  ule, replace it 
-0000b400: 7769 7468 2074 6865 2064 6574 6169 6c73  with the details
-0000b410: 2063 6f6e 7461 696e 6564 2069 6e20 7468   contained in th
-0000b420: 6520 7363 6865 6475 6c65 206f 626a 6563  e schedule objec
-0000b430: 742e 2222 220a 0a20 2020 2020 2020 2070  t."""..        p
-0000b440: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-0000b450: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-0000b460: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
-0000b470: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-0000b480: 6563 7473 2f7b 7072 6f6a 6563 747d 2f73  ects/{project}/s
-0000b490: 6368 6564 756c 6573 2f7b 6e61 6d65 7d22  chedules/{name}"
-0000b4a0: 0a0a 2020 2020 2020 2020 6572 726f 725f  ..        error_
-0000b4b0: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-0000b4c0: 6564 2075 7064 6174 696e 6720 7363 6865  ed updating sche
-0000b4d0: 6475 6c65 207b 7072 6f6a 6563 747d 2f7b  dule {project}/{
-0000b4e0: 6e61 6d65 7d22 0a20 2020 2020 2020 2073  name}".        s
-0000b4f0: 656c 662e 6170 695f 6361 6c6c 2822 5055  elf.api_call("PU
-0000b500: 5422 2c20 7061 7468 2c20 6572 726f 725f  T", path, error_
-0000b510: 6d65 7373 6167 652c 2062 6f64 793d 6469  message, body=di
-0000b520: 6374 5f74 6f5f 6a73 6f6e 2873 6368 6564  ct_to_json(sched
-0000b530: 756c 652e 6469 6374 2829 2929 0a0a 2020  ule.dict()))..  
-0000b540: 2020 6465 6620 6765 745f 7363 6865 6475    def get_schedu
-0000b550: 6c65 280a 2020 2020 2020 2020 7365 6c66  le(.        self
-0000b560: 2c20 7072 6f6a 6563 743a 2073 7472 2c20  , project: str, 
-0000b570: 6e61 6d65 3a20 7374 722c 2069 6e63 6c75  name: str, inclu
-0000b580: 6465 5f6c 6173 745f 7275 6e3a 2062 6f6f  de_last_run: boo
-0000b590: 6c20 3d20 4661 6c73 650a 2020 2020 2920  l = False.    ) 
-0000b5a0: 2d3e 2073 6368 656d 6173 2e53 6368 6564  -> schemas.Sched
-0000b5b0: 756c 654f 7574 7075 743a 0a20 2020 2020  uleOutput:.     
-0000b5c0: 2020 2022 2222 5265 7472 6965 7665 2064     """Retrieve d
-0000b5d0: 6574 6169 6c73 206f 6620 7468 6520 7363  etails of the sc
-0000b5e0: 6865 6475 6c65 2069 6e20 7175 6573 7469  hedule in questi
-0000b5f0: 6f6e 2e20 4265 7369 6465 7320 7265 7475  on. Besides retu
-0000b600: 726e 696e 6720 7468 6520 6465 7461 696c  rning the detail
-0000b610: 7320 6f66 2074 6865 2073 6368 6564 756c  s of the schedul
-0000b620: 6520 6f62 6a65 6374 2069 7473 656c 662c  e object itself,
-0000b630: 0a20 2020 2020 2020 2074 6869 7320 6675  .        this fu
-0000b640: 6e63 7469 6f6e 2061 6c73 6f20 7265 7475  nction also retu
-0000b650: 726e 7320 7468 6520 6e65 7874 2073 6368  rns the next sch
-0000b660: 6564 756c 6564 2072 756e 2066 6f72 2074  eduled run for t
-0000b670: 6869 7320 7370 6563 6966 6963 2073 6368  his specific sch
-0000b680: 6564 756c 652c 2061 7320 7765 6c6c 2061  edule, as well a
-0000b690: 7320 706f 7465 6e74 6961 6c6c 7920 7468  s potentially th
-0000b6a0: 650a 2020 2020 2020 2020 7265 7375 6c74  e.        result
-0000b6b0: 7320 6f66 2074 6865 206c 6173 7420 7275  s of the last ru
-0000b6c0: 6e20 6578 6563 7574 6564 2074 6872 6f75  n executed throu
-0000b6d0: 6768 2074 6869 7320 7363 6865 6475 6c65  gh this schedule
-0000b6e0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0000b6f0: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
-0000b700: 6374 206e 616d 652e 0a20 2020 2020 2020  ct name..       
-0000b710: 203a 7061 7261 6d20 6e61 6d65 3a20 4e61   :param name: Na
-0000b720: 6d65 206f 6620 7468 6520 7363 6865 6475  me of the schedu
-0000b730: 6c65 206f 626a 6563 7420 746f 2071 7565  le object to que
-0000b740: 7279 2e0a 2020 2020 2020 2020 3a70 6172  ry..        :par
-0000b750: 616d 2069 6e63 6c75 6465 5f6c 6173 745f  am include_last_
-0000b760: 7275 6e3a 2057 6865 7468 6572 2074 6f20  run: Whether to 
-0000b770: 696e 636c 7564 6520 7468 6520 7265 7375  include the resu
-0000b780: 6c74 7320 6f66 2074 6865 2073 6368 6564  lts of the sched
-0000b790: 756c 6527 7320 6c61 7374 2072 756e 2069  ule's last run i
-0000b7a0: 6e20 7468 6520 7265 7370 6f6e 7365 2e0a  n the response..
-0000b7b0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000b7c0: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
-0000b7d0: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
-0000b7e0: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-0000b7f0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0000b800: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
-0000b810: 6563 747d 2f73 6368 6564 756c 6573 2f7b  ect}/schedules/{
-0000b820: 6e61 6d65 7d22 0a20 2020 2020 2020 2065  name}".        e
-0000b830: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-0000b840: 2246 6169 6c65 6420 6765 7474 696e 6720  "Failed getting 
-0000b850: 7363 6865 6475 6c65 2066 6f72 207b 7072  schedule for {pr
-0000b860: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
-0000b870: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-0000b880: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-0000b890: 2020 2020 2020 2020 2022 4745 5422 2c20           "GET", 
-0000b8a0: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-0000b8b0: 6167 652c 2070 6172 616d 733d 7b22 696e  age, params={"in
-0000b8c0: 636c 7564 655f 6c61 7374 5f72 756e 223a  clude_last_run":
-0000b8d0: 2069 6e63 6c75 6465 5f6c 6173 745f 7275   include_last_ru
-0000b8e0: 6e7d 0a20 2020 2020 2020 2029 0a20 2020  n}.        ).   
-0000b8f0: 2020 2020 2072 6574 7572 6e20 7363 6865       return sche
-0000b900: 6d61 732e 5363 6865 6475 6c65 4f75 7470  mas.ScheduleOutp
-0000b910: 7574 282a 2a72 6573 702e 6a73 6f6e 2829  ut(**resp.json()
-0000b920: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
-0000b930: 7363 6865 6475 6c65 7328 0a20 2020 2020  schedules(.     
-0000b940: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000b950: 2070 726f 6a65 6374 3a20 7374 722c 0a20   project: str,. 
-0000b960: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
-0000b970: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000b980: 206b 696e 643a 2073 6368 656d 6173 2e53   kind: schemas.S
-0000b990: 6368 6564 756c 654b 696e 6473 203d 204e  cheduleKinds = N
-0000b9a0: 6f6e 652c 0a20 2020 2020 2020 2069 6e63  one,.        inc
-0000b9b0: 6c75 6465 5f6c 6173 745f 7275 6e3a 2062  lude_last_run: b
-0000b9c0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000b9d0: 2029 202d 3e20 7363 6865 6d61 732e 5363   ) -> schemas.Sc
-0000b9e0: 6865 6475 6c65 734f 7574 7075 743a 0a20  hedulesOutput:. 
-0000b9f0: 2020 2020 2020 2022 2222 5265 7472 6965         """Retrie
-0000ba00: 7665 206c 6973 7420 6f66 2073 6368 6564  ve list of sched
-0000ba10: 756c 6573 206f 6620 7370 6563 6966 6963  ules of specific
-0000ba20: 206e 616d 6520 6f72 206b 696e 642e 0a0a   name or kind...
-0000ba30: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0000ba40: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
-0000ba50: 6e61 6d65 2e0a 2020 2020 2020 2020 3a70  name..        :p
-0000ba60: 6172 616d 206e 616d 653a 204e 616d 6520  aram name: Name 
-0000ba70: 6f66 2073 6368 6564 756c 6520 746f 2072  of schedule to r
-0000ba80: 6574 7269 6576 652e 2043 616e 2062 6520  etrieve. Can be 
-0000ba90: 6f6d 6974 7465 6420 746f 206c 6973 7420  omitted to list 
-0000baa0: 616c 6c20 7363 6865 6475 6c65 732e 0a20  all schedules.. 
-0000bab0: 2020 2020 2020 203a 7061 7261 6d20 6b69         :param ki
-0000bac0: 6e64 3a20 4b69 6e64 206f 6620 7363 6865  nd: Kind of sche
-0000bad0: 6475 6c65 206f 626a 6563 7473 2074 6f20  dule objects to 
-0000bae0: 7265 7472 6965 7665 2c20 6361 6e20 6265  retrieve, can be
-0000baf0: 2065 6974 6865 7220 6060 6a6f 6260 6020   either ``job`` 
-0000bb00: 6f72 2060 6070 6970 656c 696e 6560 602e  or ``pipeline``.
-0000bb10: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000bb20: 696e 636c 7564 655f 6c61 7374 5f72 756e  include_last_run
-0000bb30: 3a20 5768 6574 6865 7220 746f 2072 6574  : Whether to ret
-0000bb40: 7572 6e20 666f 7220 6561 6368 2073 6368  urn for each sch
-0000bb50: 6564 756c 6520 7265 7475 726e 6564 2061  edule returned a
-0000bb60: 6c73 6f20 7468 6520 7265 7375 6c74 7320  lso the results 
-0000bb70: 6f66 2074 6865 206c 6173 7420 7275 6e20  of the last run 
-0000bb80: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
-0000bb90: 6861 7420 7363 6865 6475 6c65 2e0a 2020  hat schedule..  
-0000bba0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000bbb0: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
-0000bbc0: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
-0000bbd0: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
-0000bbe0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-0000bbf0: 7b22 6b69 6e64 223a 206b 696e 642c 2022  {"kind": kind, "
-0000bc00: 6e61 6d65 223a 206e 616d 652c 2022 696e  name": name, "in
-0000bc10: 636c 7564 655f 6c61 7374 5f72 756e 223a  clude_last_run":
-0000bc20: 2069 6e63 6c75 6465 5f6c 6173 745f 7275   include_last_ru
-0000bc30: 6e7d 0a20 2020 2020 2020 2070 6174 6820  n}.        path 
-0000bc40: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-0000bc50: 6f6a 6563 747d 2f73 6368 6564 756c 6573  oject}/schedules
-0000bc60: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
-0000bc70: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-0000bc80: 6564 206c 6973 7469 6e67 2073 6368 6564  ed listing sched
-0000bc90: 756c 6573 2066 6f72 207b 7072 6f6a 6563  ules for {projec
-0000bca0: 747d 203f 207b 6b69 6e64 7d20 7b6e 616d  t} ? {kind} {nam
-0000bcb0: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
-0000bcc0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-0000bcd0: 2822 4745 5422 2c20 7061 7468 2c20 6572  ("GET", path, er
-0000bce0: 726f 725f 6d65 7373 6167 652c 2070 6172  ror_message, par
-0000bcf0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-0000bd00: 2020 2020 7265 7475 726e 2073 6368 656d      return schem
-0000bd10: 6173 2e53 6368 6564 756c 6573 4f75 7470  as.SchedulesOutp
-0000bd20: 7574 282a 2a72 6573 702e 6a73 6f6e 2829  ut(**resp.json()
-0000bd30: 290a 0a20 2020 2064 6566 2064 656c 6574  )..    def delet
-0000bd40: 655f 7363 6865 6475 6c65 2873 656c 662c  e_schedule(self,
-0000bd50: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
-0000bd60: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
-0000bd70: 2020 2022 2222 4465 6c65 7465 2061 2073     """Delete a s
-0000bd80: 7065 6369 6669 6320 7363 6865 6475 6c65  pecific schedule
-0000bd90: 2062 7920 6e61 6d65 2e22 2222 0a0a 2020   by name."""..  
-0000bda0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-0000bdb0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
-0000bdc0: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-0000bdd0: 740a 2020 2020 2020 2020 7061 7468 203d  t.        path =
-0000bde0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0000bdf0: 6a65 6374 7d2f 7363 6865 6475 6c65 732f  ject}/schedules/
-0000be00: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-0000be10: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-0000be20: 6622 4661 696c 6564 2064 656c 6574 696e  f"Failed deletin
-0000be30: 6720 7363 6865 6475 6c65 207b 7072 6f6a  g schedule {proj
-0000be40: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
-0000be50: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
-0000be60: 6c6c 2822 4445 4c45 5445 222c 2070 6174  ll("DELETE", pat
-0000be70: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
-0000be80: 290a 0a20 2020 2064 6566 2069 6e76 6f6b  )..    def invok
-0000be90: 655f 7363 6865 6475 6c65 2873 656c 662c  e_schedule(self,
-0000bea0: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
-0000beb0: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
-0000bec0: 2020 2022 2222 4578 6563 7574 6520 7468     """Execute th
-0000bed0: 6520 6f62 6a65 6374 2072 6566 6572 656e  e object referen
-0000bee0: 6365 6420 6279 2074 6865 2073 6368 6564  ced by the sched
-0000bef0: 756c 6520 696d 6d65 6469 6174 656c 792e  ule immediately.
-0000bf00: 2222 220a 0a20 2020 2020 2020 2070 726f  """..        pro
-0000bf10: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
-0000bf20: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
-0000bf30: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
-0000bf40: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
-0000bf50: 7473 2f7b 7072 6f6a 6563 747d 2f73 6368  ts/{project}/sch
-0000bf60: 6564 756c 6573 2f7b 6e61 6d65 7d2f 696e  edules/{name}/in
-0000bf70: 766f 6b65 220a 2020 2020 2020 2020 6572  voke".        er
-0000bf80: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
-0000bf90: 4661 696c 6564 2069 6e76 6f6b 696e 6720  Failed invoking 
-0000bfa0: 7363 6865 6475 6c65 207b 7072 6f6a 6563  schedule {projec
-0000bfb0: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
-0000bfc0: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
-0000bfd0: 2822 504f 5354 222c 2070 6174 682c 2065  ("POST", path, e
-0000bfe0: 7272 6f72 5f6d 6573 7361 6765 290a 0a20  rror_message).. 
-0000bff0: 2020 2064 6566 2072 656d 6f74 655f 6275     def remote_bu
-0000c000: 696c 6465 7228 0a20 2020 2020 2020 2073  ilder(.        s
-0000c010: 656c 662c 0a20 2020 2020 2020 2066 756e  elf,.        fun
-0000c020: 632c 0a20 2020 2020 2020 2077 6974 685f  c,.        with_
-0000c030: 6d6c 7275 6e2c 0a20 2020 2020 2020 206d  mlrun,.        m
-0000c040: 6c72 756e 5f76 6572 7369 6f6e 5f73 7065  lrun_version_spe
-0000c050: 6369 6669 6572 3d4e 6f6e 652c 0a20 2020  cifier=None,.   
-0000c060: 2020 2020 2073 6b69 705f 6465 706c 6f79       skip_deploy
-0000c070: 6564 3d46 616c 7365 2c0a 2020 2020 2020  ed=False,.      
-0000c080: 2020 6275 696c 6465 725f 656e 763d 4e6f    builder_env=No
-0000c090: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
-0000c0a0: 2020 2022 2222 4275 696c 6420 7468 6520     """Build the 
-0000c0b0: 706f 6420 696d 6167 6520 666f 7220 6120  pod image for a 
-0000c0c0: 6675 6e63 7469 6f6e 2c20 666f 7220 6578  function, for ex
-0000c0d0: 6563 7574 696f 6e20 6f6e 2061 2072 656d  ecution on a rem
-0000c0e0: 6f74 6520 636c 7573 7465 722e 2054 6869  ote cluster. Thi
-0000c0f0: 7320 6973 2065 7865 6375 7465 6420 6279  s is executed by
-0000c100: 2074 6865 204d 4c52 756e 0a20 2020 2020   the MLRun.     
-0000c110: 2020 2041 5049 2073 6572 7665 722c 2061     API server, a
-0000c120: 6e64 2063 7265 6174 6573 2061 2044 6f63  nd creates a Doc
-0000c130: 6b65 7220 696d 6167 6520 6f75 7420 6f66  ker image out of
-0000c140: 2074 6865 2066 756e 6374 696f 6e20 7072   the function pr
-0000c150: 6f76 6964 6564 2061 6e64 2061 6e79 2073  ovided and any s
-0000c160: 7065 6369 6669 6320 6275 696c 640a 2020  pecific build.  
-0000c170: 2020 2020 2020 696e 7374 7275 6374 696f        instructio
-0000c180: 6e73 2070 726f 7669 6465 6420 7769 7468  ns provided with
-0000c190: 696e 2e20 5468 6973 2069 7320 6120 7072  in. This is a pr
-0000c1a0: 652d 7265 7175 6973 6974 6520 666f 7220  e-requisite for 
-0000c1b0: 7265 6d6f 7465 6c79 2065 7865 6375 7469  remotely executi
-0000c1c0: 6e67 2061 2066 756e 6374 696f 6e2c 2075  ng a function, u
-0000c1d0: 6e6c 6573 7320 7573 696e 670a 2020 2020  nless using.    
-0000c1e0: 2020 2020 6120 7072 652d 6465 706c 6f79      a pre-deploy
-0000c1f0: 6564 2069 6d61 6765 2e0a 0a20 2020 2020  ed image...     
-0000c200: 2020 203a 7061 7261 6d20 6675 6e63 3a20     :param func: 
-0000c210: 4675 6e63 7469 6f6e 2074 6f20 6275 696c  Function to buil
-0000c220: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-0000c230: 6d20 7769 7468 5f6d 6c72 756e 3a20 5768  m with_mlrun: Wh
-0000c240: 6574 6865 7220 746f 2061 6464 204d 4c52  ether to add MLR
-0000c250: 756e 2070 6163 6b61 6765 2074 6f20 7468  un package to th
-0000c260: 6520 6275 696c 7420 7061 636b 6167 652e  e built package.
-0000c270: 2054 6869 7320 6973 206e 6f74 2072 6571   This is not req
-0000c280: 7569 7265 6420 6966 2075 7369 6e67 2061  uired if using a
-0000c290: 2062 6173 650a 2020 2020 2020 2020 2020   base.          
-0000c2a0: 2020 696d 6167 6520 7468 6174 2061 6c72    image that alr
-0000c2b0: 6561 6479 2068 6173 204d 4c52 756e 2069  eady has MLRun i
-0000c2c0: 6e20 6974 2e0a 2020 2020 2020 2020 3a70  n it..        :p
-0000c2d0: 6172 616d 206d 6c72 756e 5f76 6572 7369  aram mlrun_versi
-0000c2e0: 6f6e 5f73 7065 6369 6669 6572 3a20 5665  on_specifier: Ve
-0000c2f0: 7273 696f 6e20 6f66 204d 4c52 756e 2074  rsion of MLRun t
-0000c300: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
-0000c310: 2062 7569 6c74 2069 6d61 6765 2e0a 2020   built image..  
-0000c320: 2020 2020 2020 3a70 6172 616d 2073 6b69        :param ski
-0000c330: 705f 6465 706c 6f79 6564 3a20 536b 6970  p_deployed: Skip
-0000c340: 2074 6865 2062 7569 6c64 2069 6620 7765   the build if we
-0000c350: 2061 6c72 6561 6479 2068 6176 6520 616e   already have an
-0000c360: 2069 6d61 6765 2066 6f72 2074 6865 2066   image for the f
-0000c370: 756e 6374 696f 6e2e 0a20 2020 2020 2020  unction..       
-0000c380: 203a 7061 7261 6d20 6275 696c 6465 725f   :param builder_
-0000c390: 656e 763a 2020 204b 616e 696b 6f20 6275  env:   Kaniko bu
-0000c3a0: 696c 6465 7220 706f 6420 656e 7620 7661  ilder pod env va
-0000c3b0: 7273 2064 6963 7420 2866 6f72 2063 6f6e  rs dict (for con
-0000c3c0: 6669 672f 6372 6564 656e 7469 616c 7329  fig/credentials)
-0000c3d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000c3e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000c3f0: 2020 2020 2020 2072 6571 203d 207b 0a20         req = {. 
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000c410: 6675 6e63 7469 6f6e 223a 2066 756e 632e  function": func.
-0000c420: 746f 5f64 6963 7428 292c 0a20 2020 2020  to_dict(),.     
-0000c430: 2020 2020 2020 2020 2020 2022 7769 7468             "with
-0000c440: 5f6d 6c72 756e 223a 2062 6f6f 6c32 7374  _mlrun": bool2st
-0000c450: 7228 7769 7468 5f6d 6c72 756e 292c 0a20  r(with_mlrun),. 
-0000c460: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000c470: 736b 6970 5f64 6570 6c6f 7965 6422 3a20  skip_deployed": 
-0000c480: 736b 6970 5f64 6570 6c6f 7965 642c 0a20  skip_deployed,. 
-0000c490: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0000c4a0: 2020 2020 2020 2020 2069 6620 6d6c 7275           if mlru
-0000c4b0: 6e5f 7665 7273 696f 6e5f 7370 6563 6966  n_version_specif
-0000c4c0: 6965 723a 0a20 2020 2020 2020 2020 2020  ier:.           
-0000c4d0: 2020 2020 2072 6571 5b22 6d6c 7275 6e5f       req["mlrun_
-0000c4e0: 7665 7273 696f 6e5f 7370 6563 6966 6965  version_specifie
-0000c4f0: 7222 5d20 3d20 6d6c 7275 6e5f 7665 7273  r"] = mlrun_vers
-0000c500: 696f 6e5f 7370 6563 6966 6965 720a 2020  ion_specifier.  
-0000c510: 2020 2020 2020 2020 2020 6966 2062 7569            if bui
-0000c520: 6c64 6572 5f65 6e76 3a0a 2020 2020 2020  lder_env:.      
-0000c530: 2020 2020 2020 2020 2020 7265 715b 2262            req["b
-0000c540: 7569 6c64 6572 5f65 6e76 225d 203d 2062  uilder_env"] = b
-0000c550: 7569 6c64 6572 5f65 6e76 0a20 2020 2020  uilder_env.     
-0000c560: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-0000c570: 6c66 2e61 7069 5f63 616c 6c28 2250 4f53  lf.api_call("POS
-0000c580: 5422 2c20 2262 7569 6c64 2f66 756e 6374  T", "build/funct
-0000c590: 696f 6e22 2c20 6a73 6f6e 3d72 6571 290a  ion", json=req).
-0000c5a0: 2020 2020 2020 2020 6578 6365 7074 204f          except O
-0000c5b0: 5345 7272 6f72 2061 7320 6572 723a 0a20  SError as err:. 
-0000c5c0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000c5d0: 722e 6572 726f 7228 6622 6572 726f 7220  r.error(f"error 
-0000c5e0: 7375 626d 6974 7469 6e67 2062 7569 6c64  submitting build
-0000c5f0: 2074 6173 6b3a 207b 6572 725f 746f 5f73   task: {err_to_s
-0000c600: 7472 2865 7272 297d 2229 0a20 2020 2020  tr(err)}").     
-0000c610: 2020 2020 2020 2072 6169 7365 204f 5345         raise OSE
-0000c620: 7272 6f72 2866 2265 7272 6f72 3a20 6361  rror(f"error: ca
-0000c630: 6e6e 6f74 2073 7562 6d69 7420 6275 696c  nnot submit buil
-0000c640: 642c 207b 6572 725f 746f 5f73 7472 2865  d, {err_to_str(e
-0000c650: 7272 297d 2229 0a0a 2020 2020 2020 2020  rr)}")..        
-0000c660: 6966 206e 6f74 2072 6573 702e 6f6b 3a0a  if not resp.ok:.
-0000c670: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000c680: 6572 2e65 7272 6f72 2866 2262 6164 2072  er.error(f"bad r
-0000c690: 6573 7021 215c 6e7b 7265 7370 2e74 6578  esp!!\n{resp.tex
-0000c6a0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
-0000c6b0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000c6c0: 7228 2262 6164 2066 756e 6374 696f 6e20  r("bad function 
-0000c6d0: 7275 6e20 7265 7370 6f6e 7365 2229 0a0a  run response")..
-0000c6e0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0000c6f0: 6573 702e 6a73 6f6e 2829 0a0a 2020 2020  esp.json()..    
-0000c700: 6465 6620 6765 745f 6275 696c 6465 725f  def get_builder_
-0000c710: 7374 6174 7573 280a 2020 2020 2020 2020  status(.        
-0000c720: 7365 6c66 2c0a 2020 2020 2020 2020 6675  self,.        fu
-0000c730: 6e63 3a20 4261 7365 5275 6e74 696d 652c  nc: BaseRuntime,
-0000c740: 0a20 2020 2020 2020 206f 6666 7365 743d  .        offset=
-0000c750: 302c 0a20 2020 2020 2020 206c 6f67 733d  0,.        logs=
-0000c760: 5472 7565 2c0a 2020 2020 2020 2020 6c61  True,.        la
-0000c770: 7374 5f6c 6f67 5f74 696d 6573 7461 6d70  st_log_timestamp
-0000c780: 3d30 2c0a 2020 2020 2020 2020 7665 7262  =0,.        verb
-0000c790: 6f73 653d 4661 6c73 652c 0a20 2020 2029  ose=False,.    )
-0000c7a0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0000c7b0: 7269 6576 6520 7468 6520 7374 6174 7573  rieve the status
-0000c7c0: 206f 6620 6120 6275 696c 6420 6f70 6572   of a build oper
-0000c7d0: 6174 696f 6e20 6375 7272 656e 746c 7920  ation currently 
-0000c7e0: 696e 2070 726f 6772 6573 732e 0a0a 2020  in progress...  
-0000c7f0: 2020 2020 2020 3a70 6172 616d 2066 756e        :param fun
-0000c800: 633a 2046 756e 6374 696f 6e20 6f62 6a65  c: Function obje
-0000c810: 6374 2074 6861 7420 6973 2062 6569 6e67  ct that is being
-0000c820: 2062 7569 6c74 2e0a 2020 2020 2020 2020   built..        
-0000c830: 3a70 6172 616d 206f 6666 7365 743a 204f  :param offset: O
-0000c840: 6666 7365 7420 696e 746f 2074 6865 2062  ffset into the b
-0000c850: 7569 6c64 206c 6f67 7320 746f 2072 6574  uild logs to ret
-0000c860: 7269 6576 6520 6c6f 6773 2066 726f 6d2e  rieve logs from.
-0000c870: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000c880: 6c6f 6773 3a20 5368 6f75 6c64 2062 7569  logs: Should bui
-0000c890: 6c64 206c 6f67 7320 6265 2072 6574 7269  ld logs be retri
-0000c8a0: 6576 6564 2e0a 2020 2020 2020 2020 3a70  eved..        :p
-0000c8b0: 6172 616d 206c 6173 745f 6c6f 675f 7469  aram last_log_ti
-0000c8c0: 6d65 7374 616d 703a 204c 6173 7420 7469  mestamp: Last ti
-0000c8d0: 6d65 7374 616d 7020 6f66 206c 6f67 7320  mestamp of logs 
-0000c8e0: 7468 6174 2077 6572 6520 616c 7265 6164  that were alread
-0000c8f0: 7920 7265 7472 6965 7665 642e 2046 756e  y retrieved. Fun
-0000c900: 6374 696f 6e20 7769 6c6c 2072 6574 7572  ction will retur
-0000c910: 6e20 6f6e 6c79 206c 6f67 730a 2020 2020  n only logs.    
-0000c920: 2020 2020 2020 2020 6c61 7465 7220 7468          later th
-0000c930: 616e 2074 6869 7320 7061 7261 6d65 7465  an this paramete
-0000c940: 722e 0a20 2020 2020 2020 203a 7061 7261  r..        :para
-0000c950: 6d20 7665 7262 6f73 653a 2041 6464 2076  m verbose: Add v
-0000c960: 6572 626f 7365 206c 6f67 7320 696e 746f  erbose logs into
-0000c970: 2074 6865 206f 7574 7075 742e 0a20 2020   the output..   
-0000c980: 2020 2020 203a 7265 7475 726e 733a 2054       :returns: T
-0000c990: 6865 2066 6f6c 6c6f 7769 6e67 2070 6172  he following par
-0000c9a0: 616d 6574 6572 733a 0a0a 2020 2020 2020  ameters:..      
-0000c9b0: 2020 2020 2020 2d20 5465 7874 206f 6620        - Text of 
-0000c9c0: 6275 696c 6465 7220 6c6f 6773 2e0a 2020  builder logs..  
-0000c9d0: 2020 2020 2020 2020 2020 2d20 5469 6d65            - Time
-0000c9e0: 7374 616d 7020 6f66 206c 6173 7420 6c6f  stamp of last lo
-0000c9f0: 6720 7265 7472 6965 7665 642c 2074 6f20  g retrieved, to 
-0000ca00: 6265 2075 7365 6420 696e 2073 7562 7365  be used in subse
-0000ca10: 7175 656e 7420 6361 6c6c 7320 746f 2074  quent calls to t
-0000ca20: 6869 7320 6675 6e63 7469 6f6e 2e0a 0a20  his function... 
-0000ca30: 2020 2020 2020 2020 2020 2054 6865 2066             The f
-0000ca40: 756e 6374 696f 6e20 616c 736f 2075 7064  unction also upd
-0000ca50: 6174 6573 2069 6e74 6572 6e61 6c20 6d65  ates internal me
-0000ca60: 6d62 6572 7320 6f66 2074 6865 2060 6066  mbers of the ``f
-0000ca70: 756e 6360 6020 6f62 6a65 6374 2074 6f20  unc`` object to 
-0000ca80: 7265 666c 6563 7420 6275 696c 6420 7072  reflect build pr
-0000ca90: 6f63 6573 7320 696e 666f 2e0a 2020 2020  ocess info..    
-0000caa0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0000cab0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000cac0: 2020 7061 7261 6d73 203d 207b 0a20 2020    params = {.   
-0000cad0: 2020 2020 2020 2020 2020 2020 2022 6e61               "na
-0000cae0: 6d65 223a 206e 6f72 6d61 6c69 7a65 5f6e  me": normalize_n
-0000caf0: 616d 6528 6675 6e63 2e6d 6574 6164 6174  ame(func.metadat
-0000cb00: 612e 6e61 6d65 292c 0a20 2020 2020 2020  a.name),.       
-0000cb10: 2020 2020 2020 2020 2022 7072 6f6a 6563           "projec
-0000cb20: 7422 3a20 6675 6e63 2e6d 6574 6164 6174  t": func.metadat
-0000cb30: 612e 7072 6f6a 6563 742c 0a20 2020 2020  a.project,.     
-0000cb40: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
-0000cb50: 3a20 6675 6e63 2e6d 6574 6164 6174 612e  : func.metadata.
-0000cb60: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
-0000cb70: 2020 2020 2022 6c6f 6773 223a 2062 6f6f       "logs": boo
-0000cb80: 6c32 7374 7228 6c6f 6773 292c 0a20 2020  l2str(logs),.   
-0000cb90: 2020 2020 2020 2020 2020 2020 2022 6f66               "of
-0000cba0: 6673 6574 223a 2073 7472 286f 6666 7365  fset": str(offse
-0000cbb0: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
-0000cbc0: 2020 2020 226c 6173 745f 6c6f 675f 7469      "last_log_ti
-0000cbd0: 6d65 7374 616d 7022 3a20 7374 7228 6c61  mestamp": str(la
-0000cbe0: 7374 5f6c 6f67 5f74 696d 6573 7461 6d70  st_log_timestamp
-0000cbf0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000cc00: 2020 2022 7665 7262 6f73 6522 3a20 626f     "verbose": bo
-0000cc10: 6f6c 3273 7472 2876 6572 626f 7365 292c  ol2str(verbose),
-0000cc20: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-0000cc30: 2020 2020 2020 2020 2020 2072 6573 7020             resp 
-0000cc40: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0000cc50: 2247 4554 222c 2022 6275 696c 642f 7374  "GET", "build/st
-0000cc60: 6174 7573 222c 2070 6172 616d 733d 7061  atus", params=pa
-0000cc70: 7261 6d73 290a 2020 2020 2020 2020 6578  rams).        ex
-0000cc80: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
-0000cc90: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
-0000cca0: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
-0000ccb0: 6572 726f 7220 6765 7474 696e 6720 6275  error getting bu
-0000ccc0: 696c 6420 7374 6174 7573 3a20 7b65 7272  ild status: {err
-0000ccd0: 5f74 6f5f 7374 7228 6572 7229 7d22 290a  _to_str(err)}").
-0000cce0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000ccf0: 6520 4f53 4572 726f 7228 6622 6572 726f  e OSError(f"erro
-0000cd00: 723a 2063 616e 6e6f 7420 6765 7420 6275  r: cannot get bu
-0000cd10: 696c 6420 7374 6174 7573 2c20 7b65 7272  ild status, {err
-0000cd20: 5f74 6f5f 7374 7228 6572 7229 7d22 290a  _to_str(err)}").
-0000cd30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000cd40: 7265 7370 2e6f 6b3a 0a20 2020 2020 2020  resp.ok:.       
-0000cd50: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-0000cd60: 696e 6728 6622 6661 696c 6564 2072 6573  ing(f"failed res
-0000cd70: 702c 207b 7265 7370 2e74 6578 747d 2229  p, {resp.text}")
-0000cd80: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000cd90: 7365 2052 756e 4442 4572 726f 7228 2262  se RunDBError("b
-0000cda0: 6164 2066 756e 6374 696f 6e20 6275 696c  ad function buil
-0000cdb0: 6420 7265 7370 6f6e 7365 2229 0a0a 2020  d response")..  
-0000cdc0: 2020 2020 2020 6966 2072 6573 702e 6865        if resp.he
-0000cdd0: 6164 6572 733a 0a20 2020 2020 2020 2020  aders:.         
-0000cde0: 2020 2066 756e 632e 7374 6174 7573 2e73     func.status.s
-0000cdf0: 7461 7465 203d 2072 6573 702e 6865 6164  tate = resp.head
-0000ce00: 6572 732e 6765 7428 2278 2d6d 6c72 756e  ers.get("x-mlrun
-0000ce10: 2d66 756e 6374 696f 6e2d 7374 6174 7573  -function-status
-0000ce20: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
-0000ce30: 2020 206c 6173 745f 6c6f 675f 7469 6d65     last_log_time
-0000ce40: 7374 616d 7020 3d20 666c 6f61 7428 0a20  stamp = float(. 
-0000ce50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ce60: 6573 702e 6865 6164 6572 732e 6765 7428  esp.headers.get(
-0000ce70: 2278 2d6d 6c72 756e 2d6c 6173 742d 7469  "x-mlrun-last-ti
-0000ce80: 6d65 7374 616d 7022 2c20 2230 2e30 2229  mestamp", "0.0")
-0000ce90: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000cea0: 2020 2020 2020 2020 2020 2069 6620 6675             if fu
-0000ceb0: 6e63 2e6b 696e 6420 696e 206d 6c72 756e  nc.kind in mlrun
-0000cec0: 2e72 756e 7469 6d65 732e 5275 6e74 696d  .runtimes.Runtim
-0000ced0: 654b 696e 6473 2e6e 7563 6c69 6f5f 7275  eKinds.nuclio_ru
-0000cee0: 6e74 696d 6573 2829 3a0a 2020 2020 2020  ntimes():.      
-0000cef0: 2020 2020 2020 2020 2020 6675 6e63 2e73            func.s
-0000cf00: 7461 7475 732e 6164 6472 6573 7320 3d20  tatus.address = 
-0000cf10: 7265 7370 2e68 6561 6465 7273 2e67 6574  resp.headers.get
-0000cf20: 2822 782d 6d6c 7275 6e2d 6164 6472 6573  ("x-mlrun-addres
-0000cf30: 7322 2c20 2222 290a 2020 2020 2020 2020  s", "").        
-0000cf40: 2020 2020 2020 2020 6675 6e63 2e73 7461          func.sta
-0000cf50: 7475 732e 6e75 636c 696f 5f6e 616d 6520  tus.nuclio_name 
-0000cf60: 3d20 7265 7370 2e68 6561 6465 7273 2e67  = resp.headers.g
-0000cf70: 6574 2822 782d 6d6c 7275 6e2d 6e61 6d65  et("x-mlrun-name
-0000cf80: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
-0000cf90: 2020 2020 2020 2066 756e 632e 7374 6174         func.stat
-0000cfa0: 7573 2e69 6e74 6572 6e61 6c5f 696e 766f  us.internal_invo
-0000cfb0: 6361 7469 6f6e 5f75 726c 7320 3d20 7265  cation_urls = re
-0000cfc0: 7370 2e68 6561 6465 7273 2e67 6574 280a  sp.headers.get(.
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfe0: 2020 2020 2278 2d6d 6c72 756e 2d69 6e74      "x-mlrun-int
-0000cff0: 6572 6e61 6c2d 696e 766f 6361 7469 6f6e  ernal-invocation
-0000d000: 2d75 726c 7322 2c20 2222 0a20 2020 2020  -urls", "".     
-0000d010: 2020 2020 2020 2020 2020 2029 2e73 706c             ).spl
-0000d020: 6974 2822 2c22 290a 2020 2020 2020 2020  it(",").        
-0000d030: 2020 2020 2020 2020 6675 6e63 2e73 7461          func.sta
-0000d040: 7475 732e 6578 7465 726e 616c 5f69 6e76  tus.external_inv
-0000d050: 6f63 6174 696f 6e5f 7572 6c73 203d 2072  ocation_urls = r
-0000d060: 6573 702e 6865 6164 6572 732e 6765 7428  esp.headers.get(
-0000d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d080: 2020 2020 2022 782d 6d6c 7275 6e2d 6578       "x-mlrun-ex
-0000d090: 7465 726e 616c 2d69 6e76 6f63 6174 696f  ternal-invocatio
-0000d0a0: 6e2d 7572 6c73 222c 2022 220a 2020 2020  n-urls", "".    
-0000d0b0: 2020 2020 2020 2020 2020 2020 292e 7370              ).sp
-0000d0c0: 6c69 7428 222c 2229 0a20 2020 2020 2020  lit(",").       
-0000d0d0: 2020 2020 2020 2020 2066 756e 632e 7374           func.st
-0000d0e0: 6174 7573 2e63 6f6e 7461 696e 6572 5f69  atus.container_i
-0000d0f0: 6d61 6765 203d 2072 6573 702e 6865 6164  mage = resp.head
-0000d100: 6572 732e 6765 7428 0a20 2020 2020 2020  ers.get(.       
-0000d110: 2020 2020 2020 2020 2020 2020 2022 782d               "x-
-0000d120: 6d6c 7275 6e2d 636f 6e74 6169 6e65 722d  mlrun-container-
-0000d130: 696d 6167 6522 2c20 2222 0a20 2020 2020  image", "".     
-0000d140: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000d150: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000d160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d170: 756e 632e 7374 6174 7573 2e62 7569 6c64  unc.status.build
-0000d180: 5f70 6f64 203d 2072 6573 702e 6865 6164  _pod = resp.head
-0000d190: 6572 732e 6765 7428 2262 7569 6c64 6572  ers.get("builder
-0000d1a0: 5f70 6f64 222c 2022 2229 0a20 2020 2020  _pod", "").     
-0000d1b0: 2020 2020 2020 2020 2020 2066 756e 632e             func.
-0000d1c0: 7370 6563 2e69 6d61 6765 203d 2072 6573  spec.image = res
-0000d1d0: 702e 6865 6164 6572 732e 6765 7428 2266  p.headers.get("f
-0000d1e0: 756e 6374 696f 6e5f 696d 6167 6522 2c20  unction_image", 
-0000d1f0: 2222 290a 0a20 2020 2020 2020 2074 6578  "")..        tex
-0000d200: 7420 3d20 2222 0a20 2020 2020 2020 2069  t = "".        i
-0000d210: 6620 7265 7370 2e63 6f6e 7465 6e74 3a0a  f resp.content:.
-0000d220: 2020 2020 2020 2020 2020 2020 7465 7874              text
-0000d230: 203d 2072 6573 702e 636f 6e74 656e 742e   = resp.content.
-0000d240: 6465 636f 6465 2829 0a20 2020 2020 2020  decode().       
-0000d250: 2072 6574 7572 6e20 7465 7874 2c20 6c61   return text, la
-0000d260: 7374 5f6c 6f67 5f74 696d 6573 7461 6d70  st_log_timestamp
-0000d270: 0a0a 2020 2020 6465 6620 7265 6d6f 7465  ..    def remote
-0000d280: 5f73 7461 7274 2873 656c 662c 2066 756e  _start(self, fun
-0000d290: 635f 7572 6c29 202d 3e20 7363 6865 6d61  c_url) -> schema
-0000d2a0: 732e 4261 636b 6772 6f75 6e64 5461 736b  s.BackgroundTask
-0000d2b0: 3a0a 2020 2020 2020 2020 2222 2245 7865  :.        """Exe
-0000d2c0: 6375 7465 2061 2066 756e 6374 696f 6e20  cute a function 
-0000d2d0: 7265 6d6f 7465 6c79 2c20 5573 6564 2066  remotely, Used f
-0000d2e0: 6f72 2060 6064 6173 6b60 6020 6675 6e63  or ``dask`` func
-0000d2f0: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
-0000d300: 3a70 6172 616d 2066 756e 635f 7572 6c3a  :param func_url:
-0000d310: 2055 524c 2074 6f20 7468 6520 6675 6e63   URL to the func
-0000d320: 7469 6f6e 2074 6f20 6265 2065 7865 6375  tion to be execu
-0000d330: 7465 642e 0a20 2020 2020 2020 203a 7265  ted..        :re
-0000d340: 7475 726e 733a 2041 2042 6163 6b67 726f  turns: A Backgro
-0000d350: 756e 6454 6173 6b20 6f62 6a65 6374 2c20  undTask object, 
-0000d360: 7769 7468 2064 6574 6169 6c73 206f 6e20  with details on 
-0000d370: 6578 6563 7574 696f 6e20 7072 6f63 6573  execution proces
-0000d380: 7320 616e 6420 6974 7320 7374 6174 7573  s and its status
-0000d390: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000d3a0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000d3b0: 2020 2020 2020 2020 7265 7120 3d20 7b22          req = {"
-0000d3c0: 6675 6e63 7469 6f6e 5572 6c22 3a20 6675  functionUrl": fu
-0000d3d0: 6e63 5f75 726c 7d0a 2020 2020 2020 2020  nc_url}.        
-0000d3e0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-0000d3f0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-0000d400: 2020 2020 2020 2020 2020 2250 4f53 5422            "POST"
-0000d410: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000d420: 2020 2273 7461 7274 2f66 756e 6374 696f    "start/functio
-0000d430: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-0000d440: 2020 2020 6a73 6f6e 3d72 6571 2c0a 2020      json=req,.  
-0000d450: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0000d460: 6d65 6f75 743d 696e 7428 636f 6e66 6967  meout=int(config
-0000d470: 2e73 7562 6d69 745f 7469 6d65 6f75 7429  .submit_timeout)
-0000d480: 206f 7220 3630 2c0a 2020 2020 2020 2020   or 60,.        
-0000d490: 2020 2020 290a 2020 2020 2020 2020 6578      ).        ex
-0000d4a0: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
-0000d4b0: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
-0000d4c0: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
-0000d4d0: 6572 726f 7220 7374 6172 7469 6e67 2066  error starting f
-0000d4e0: 756e 6374 696f 6e3a 207b 6572 725f 746f  unction: {err_to
-0000d4f0: 5f73 7472 2865 7272 297d 2229 0a20 2020  _str(err)}").   
-0000d500: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0000d510: 5345 7272 6f72 2866 2265 7272 6f72 3a20  SError(f"error: 
-0000d520: 6361 6e6e 6f74 2073 7461 7274 2066 756e  cannot start fun
-0000d530: 6374 696f 6e2c 207b 6572 725f 746f 5f73  ction, {err_to_s
-0000d540: 7472 2865 7272 297d 2229 0a0a 2020 2020  tr(err)}")..    
-0000d550: 2020 2020 6966 206e 6f74 2072 6573 702e      if not resp.
-0000d560: 6f6b 3a0a 2020 2020 2020 2020 2020 2020  ok:.            
-0000d570: 6c6f 6767 6572 2e65 7272 6f72 2866 2262  logger.error(f"b
-0000d580: 6164 2072 6573 7021 215c 6e7b 7265 7370  ad resp!!\n{resp
-0000d590: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
-0000d5a0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000d5b0: 4572 726f 7228 2262 6164 2066 756e 6374  Error("bad funct
-0000d5c0: 696f 6e20 7374 6172 7420 7265 7370 6f6e  ion start respon
-0000d5d0: 7365 2229 0a0a 2020 2020 2020 2020 7265  se")..        re
-0000d5e0: 7475 726e 2073 6368 656d 6173 2e42 6163  turn schemas.Bac
-0000d5f0: 6b67 726f 756e 6454 6173 6b28 2a2a 7265  kgroundTask(**re
-0000d600: 7370 2e6a 736f 6e28 2929 0a0a 2020 2020  sp.json())..    
-0000d610: 6465 6620 6765 745f 7072 6f6a 6563 745f  def get_project_
-0000d620: 6261 636b 6772 6f75 6e64 5f74 6173 6b28  background_task(
-0000d630: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0000d640: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-0000d650: 7374 722c 0a20 2020 2020 2020 206e 616d  str,.        nam
-0000d660: 653a 2073 7472 2c0a 2020 2020 2920 2d3e  e: str,.    ) ->
-0000d670: 2073 6368 656d 6173 2e42 6163 6b67 726f   schemas.Backgro
-0000d680: 756e 6454 6173 6b3a 0a20 2020 2020 2020  undTask:.       
-0000d690: 2022 2222 5265 7472 6965 7665 2075 7064   """Retrieve upd
-0000d6a0: 6174 6564 2069 6e66 6f72 6d61 7469 6f6e  ated information
-0000d6b0: 206f 6e20 6120 7072 6f6a 6563 7420 6261   on a project ba
-0000d6c0: 636b 6772 6f75 6e64 2074 6173 6b20 6265  ckground task be
-0000d6d0: 696e 6720 6578 6563 7574 6564 2e22 2222  ing executed."""
-0000d6e0: 0a0a 2020 2020 2020 2020 7072 6f6a 6563  ..        projec
-0000d6f0: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
-0000d700: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
-0000d710: 6f6a 6563 740a 2020 2020 2020 2020 7061  oject.        pa
-0000d720: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-0000d730: 7b70 726f 6a65 6374 7d2f 6261 636b 6772  {project}/backgr
-0000d740: 6f75 6e64 2d74 6173 6b73 2f7b 6e61 6d65  ound-tasks/{name
-0000d750: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
-0000d760: 5f6d 6573 7361 6765 203d 2028 0a20 2020  _message = (.   
-0000d770: 2020 2020 2020 2020 2066 2246 6169 6c65           f"Faile
-0000d780: 6420 6765 7474 696e 6720 7072 6f6a 6563  d getting projec
-0000d790: 7420 6261 636b 6772 6f75 6e64 2074 6173  t background tas
-0000d7a0: 6b2e 2070 726f 6a65 6374 3d7b 7072 6f6a  k. project={proj
-0000d7b0: 6563 747d 2c20 6e61 6d65 3d7b 6e61 6d65  ect}, name={name
-0000d7c0: 7d22 0a20 2020 2020 2020 2029 0a20 2020  }".        ).   
-0000d7d0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-0000d7e0: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
-0000d7f0: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
-0000d800: 5f6d 6573 7361 6765 290a 2020 2020 2020  _message).      
-0000d810: 2020 7265 7475 726e 2073 6368 656d 6173    return schemas
-0000d820: 2e42 6163 6b67 726f 756e 6454 6173 6b28  .BackgroundTask(
-0000d830: 2a2a 7265 7370 6f6e 7365 2e6a 736f 6e28  **response.json(
-0000d840: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
-0000d850: 6261 636b 6772 6f75 6e64 5f74 6173 6b28  background_task(
-0000d860: 7365 6c66 2c20 6e61 6d65 3a20 7374 7229  self, name: str)
-0000d870: 202d 3e20 7363 6865 6d61 732e 4261 636b   -> schemas.Back
-0000d880: 6772 6f75 6e64 5461 736b 3a0a 2020 2020  groundTask:.    
-0000d890: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
-0000d8a0: 7570 6461 7465 6420 696e 666f 726d 6174  updated informat
-0000d8b0: 696f 6e20 6f6e 2061 2062 6163 6b67 726f  ion on a backgro
-0000d8c0: 756e 6420 7461 736b 2062 6569 6e67 2065  und task being e
-0000d8d0: 7865 6375 7465 642e 2222 220a 0a20 2020  xecuted."""..   
-0000d8e0: 2020 2020 2070 6174 6820 3d20 6622 6261       path = f"ba
-0000d8f0: 636b 6772 6f75 6e64 2d74 6173 6b73 2f7b  ckground-tasks/{
-0000d900: 6e61 6d65 7d22 0a20 2020 2020 2020 2065  name}".        e
-0000d910: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-0000d920: 2246 6169 6c65 6420 6765 7474 696e 6720  "Failed getting 
-0000d930: 6261 636b 6772 6f75 6e64 2074 6173 6b2e  background task.
-0000d940: 206e 616d 653d 7b6e 616d 657d 220a 2020   name={name}".  
+00002640: 6966 2065 7272 6f72 5f64 6574 6169 6c73  if error_details
+00002650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002660: 2020 2020 2020 6572 726f 725f 6465 7461        error_deta
+00002670: 696c 7320 3d20 6622 6465 7461 696c 733a  ils = f"details:
+00002680: 207b 6572 726f 725f 6465 7461 696c 737d   {error_details}
+00002690: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000026a0: 2020 2020 2020 6572 726f 7220 3d20 6622        error = f"
+000026b0: 7b65 7272 6f72 7d20 7b65 7272 6f72 5f64  {error} {error_d
+000026c0: 6574 6169 6c73 7d22 2069 6620 6572 726f  etails}" if erro
+000026d0: 7220 656c 7365 2065 7272 6f72 5f64 6574  r else error_det
+000026e0: 6169 6c73 0a20 2020 2020 2020 2020 2020  ails.           
+000026f0: 2020 2020 2020 2020 206d 6c72 756e 2e65           mlrun.e
+00002700: 7272 6f72 732e 7261 6973 655f 666f 725f  rrors.raise_for_
+00002710: 7374 6174 7573 2872 6573 706f 6e73 652c  status(response,
+00002720: 2065 7272 6f72 290a 0a20 2020 2020 2020   error)..       
+00002730: 2020 2020 206d 6c72 756e 2e65 7272 6f72       mlrun.error
+00002740: 732e 7261 6973 655f 666f 725f 7374 6174  s.raise_for_stat
+00002750: 7573 2872 6573 706f 6e73 652c 2065 7272  us(response, err
+00002760: 6f72 290a 0a20 2020 2020 2020 2072 6574  or)..        ret
+00002770: 7572 6e20 7265 7370 6f6e 7365 0a0a 2020  urn response..  
+00002780: 2020 6465 6620 5f69 6e69 745f 7365 7373    def _init_sess
+00002790: 696f 6e28 7365 6c66 293a 0a20 2020 2020  ion(self):.     
+000027a0: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+000027b0: 7574 696c 732e 4854 5450 5365 7373 696f  utils.HTTPSessio
+000027c0: 6e57 6974 6852 6574 7279 280a 2020 2020  nWithRetry(.    
+000027d0: 2020 2020 2020 2020 7265 7472 795f 6f6e          retry_on
+000027e0: 5f65 7863 6570 7469 6f6e 3d63 6f6e 6669  _exception=confi
+000027f0: 672e 6874 7470 6462 2e72 6574 7279 5f61  g.httpdb.retry_a
+00002800: 7069 5f63 616c 6c5f 6f6e 5f65 7863 6570  pi_call_on_excep
+00002810: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00002820: 203d 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e   == mlrun.common
+00002830: 2e73 6368 656d 6173 2e48 5454 5053 6573  .schemas.HTTPSes
+00002840: 7369 6f6e 5265 7472 794d 6f64 652e 656e  sionRetryMode.en
+00002850: 6162 6c65 642e 7661 6c75 650a 2020 2020  abled.value.    
+00002860: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+00002870: 7061 7468 5f6f 6628 7365 6c66 2c20 7072  path_of(self, pr
+00002880: 6566 6978 2c20 7072 6f6a 6563 742c 2075  efix, project, u
+00002890: 6964 293a 0a20 2020 2020 2020 2070 726f  id):.        pro
+000028a0: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
+000028b0: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
+000028c0: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
+000028d0: 2072 6574 7572 6e20 6622 7b70 7265 6669   return f"{prefi
+000028e0: 787d 2f7b 7072 6f6a 6563 747d 2f7b 7569  x}/{project}/{ui
+000028f0: 647d 220a 0a20 2020 2064 6566 2063 6f6e  d}"..    def con
+00002900: 6e65 6374 2873 656c 662c 2073 6563 7265  nect(self, secre
+00002910: 7473 3d4e 6f6e 6529 3a0a 2020 2020 2020  ts=None):.      
+00002920: 2020 2222 2243 6f6e 6e65 6374 2074 6f20    """Connect to 
+00002930: 7468 6520 4d4c 5275 6e20 4150 4920 7365  the MLRun API se
+00002940: 7276 6572 2e20 4d75 7374 2062 6520 6361  rver. Must be ca
+00002950: 6c6c 6564 2070 7269 6f72 2074 6f20 6578  lled prior to ex
+00002960: 6563 7574 696e 6720 616e 7920 6f74 6865  ecuting any othe
+00002970: 7220 6d65 7468 6f64 2e0a 2020 2020 2020  r method..      
+00002980: 2020 5468 6520 636f 6465 2075 7469 6c69    The code utili
+00002990: 7a65 7320 7468 6520 5552 4c20 666f 7220  zes the URL for 
+000029a0: 7468 6520 4150 4920 7365 7276 6572 2066  the API server f
+000029b0: 726f 6d20 7468 6520 636f 6e66 6967 7572  rom the configur
+000029c0: 6174 696f 6e20 2d20 6060 6d6c 636f 6e66  ation - ``mlconf
+000029d0: 2e64 6270 6174 6860 602e 0a0a 2020 2020  .dbpath``...    
+000029e0: 2020 2020 466f 7220 6578 616d 706c 653a      For example:
+000029f0: 3a0a 0a20 2020 2020 2020 2020 2020 206d  :..            m
+00002a00: 6c63 6f6e 662e 6462 7061 7468 203d 206d  lconf.dbpath = m
+00002a10: 6c63 6f6e 662e 6462 7061 7468 206f 7220  lconf.dbpath or 
+00002a20: 2768 7474 703a 2f2f 6d6c 7275 6e2d 6170  'http://mlrun-ap
+00002a30: 693a 3830 3830 270a 2020 2020 2020 2020  i:8080'.        
+00002a40: 2020 2020 6462 203d 2067 6574 5f72 756e      db = get_run
+00002a50: 5f64 6228 292e 636f 6e6e 6563 7428 290a  _db().connect().
+00002a60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00002a70: 2020 2020 2320 6861 636b 2074 6f20 616c      # hack to al
+00002a80: 6c6f 7720 756e 6974 2074 6573 7473 2074  low unit tests t
+00002a90: 6f20 696e 7374 616e 7469 6174 6520 4854  o instantiate HT
+00002aa0: 5450 5275 6e44 4220 7769 7468 6f75 7420  TPRunDB without 
+00002ab0: 6120 7265 616c 2073 6572 7665 7220 6265  a real server be
+00002ac0: 6869 6e64 0a20 2020 2020 2020 2069 6620  hind.        if 
+00002ad0: 226d 6f63 6b2d 7365 7276 6572 2220 696e  "mock-server" in
+00002ae0: 2073 656c 662e 6261 7365 5f75 726c 3a0a   self.base_url:.
+00002af0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00002b00: 726e 0a20 2020 2020 2020 2072 6573 7020  rn.        resp 
+00002b10: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+00002b20: 2247 4554 222c 2022 636c 6965 6e74 2d73  "GET", "client-s
+00002b30: 7065 6322 2c20 7469 6d65 6f75 743d 3529  pec", timeout=5)
+00002b40: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00002b50: 2020 2020 2020 2020 2020 7365 7276 6572            server
+00002b60: 5f63 6667 203d 2072 6573 702e 6a73 6f6e  _cfg = resp.json
+00002b70: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00002b80: 656c 662e 7365 7276 6572 5f76 6572 7369  elf.server_versi
+00002b90: 6f6e 203d 2073 6572 7665 725f 6366 675b  on = server_cfg[
+00002ba0: 2276 6572 7369 6f6e 225d 0a20 2020 2020  "version"].     
+00002bb0: 2020 2020 2020 2073 656c 662e 5f76 616c         self._val
+00002bc0: 6964 6174 655f 7665 7273 696f 6e5f 636f  idate_version_co
+00002bd0: 6d70 6174 6962 696c 6974 7928 7365 6c66  mpatibility(self
+00002be0: 2e73 6572 7665 725f 7665 7273 696f 6e2c  .server_version,
+00002bf0: 2063 6f6e 6669 672e 7665 7273 696f 6e29   config.version)
+00002c00: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00002c10: 6669 672e 6e61 6d65 7370 6163 6520 3d20  fig.namespace = 
+00002c20: 636f 6e66 6967 2e6e 616d 6573 7061 6365  config.namespace
+00002c30: 206f 7220 7365 7276 6572 5f63 6667 2e67   or server_cfg.g
+00002c40: 6574 2822 6e61 6d65 7370 6163 6522 290a  et("namespace").
+00002c50: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00002c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002c70: 2022 6e61 6d65 7370 6163 6522 2069 6e20   "namespace" in 
+00002c80: 7365 7276 6572 5f63 6667 0a20 2020 2020  server_cfg.     
+00002c90: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
+00002ca0: 6572 7665 725f 6366 675b 226e 616d 6573  erver_cfg["names
+00002cb0: 7061 6365 225d 2021 3d20 636f 6e66 6967  pace"] != config
+00002cc0: 2e6e 616d 6573 7061 6365 0a20 2020 2020  .namespace.     
+00002cd0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00002ce0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00002cf0: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+00002d00: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00002d10: 7761 726e 696e 6721 2c20 7365 7276 6572  warning!, server
+00002d20: 2028 7b73 6572 7665 725f 6366 675b 276e   ({server_cfg['n
+00002d30: 616d 6573 7061 6365 275d 7d29 2061 6e64  amespace']}) and
+00002d40: 2063 6c69 656e 7420 287b 636f 6e66 6967   client ({config
+00002d50: 2e6e 616d 6573 7061 6365 7d29 220a 2020  .namespace})".  
+00002d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d70: 2020 2220 6e61 6d65 7370 6163 6520 646f    " namespace do
+00002d80: 6e27 7420 6d61 7463 6822 0a20 2020 2020  n't match".     
+00002d90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00002da0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+00002db0: 6967 2e63 652e 6d6f 6465 2061 6e64 2063  ig.ce.mode and c
+00002dc0: 6f6e 6669 672e 6365 2e6d 6f64 6520 213d  onfig.ce.mode !=
+00002dd0: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00002de0: 2263 655f 6d6f 6465 222c 2022 2229 3a0a  "ce_mode", ""):.
+00002df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e00: 6c6f 6767 6572 2e77 6172 6e69 6e67 280a  logger.warning(.
+00002e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e20: 2020 2020 6622 7761 726e 696e 6721 2c20      f"warning!, 
+00002e30: 7365 7276 6572 2028 7b73 6572 7665 725f  server ({server_
+00002e40: 6366 675b 2763 655f 6d6f 6465 275d 7d29  cfg['ce_mode']})
+00002e50: 2061 6e64 2063 6c69 656e 7420 287b 636f   and client ({co
+00002e60: 6e66 6967 2e63 652e 6d6f 6465 7d29 220a  nfig.ce.mode})".
+00002e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e80: 2020 2020 2220 4345 206d 6f64 6520 646f      " CE mode do
+00002e90: 6e27 7420 6d61 7463 6822 0a20 2020 2020  n't match".     
+00002ea0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00002eb0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00002ec0: 6365 203d 2073 6572 7665 725f 6366 672e  ce = server_cfg.
+00002ed0: 6765 7428 2263 6522 2920 6f72 2063 6f6e  get("ce") or con
+00002ee0: 6669 672e 6365 0a0a 2020 2020 2020 2020  fig.ce..        
+00002ef0: 2020 2020 2320 6765 7420 6465 6661 756c      # get defaul
+00002f00: 7473 2066 726f 6d20 7265 6d6f 7465 2073  ts from remote s
+00002f10: 6572 7665 720a 2020 2020 2020 2020 2020  erver.          
+00002f20: 2020 636f 6e66 6967 2e72 656d 6f74 655f    config.remote_
+00002f30: 686f 7374 203d 2063 6f6e 6669 672e 7265  host = config.re
+00002f40: 6d6f 7465 5f68 6f73 7420 6f72 2073 6572  mote_host or ser
+00002f50: 7665 725f 6366 672e 6765 7428 2272 656d  ver_cfg.get("rem
+00002f60: 6f74 655f 686f 7374 2229 0a20 2020 2020  ote_host").     
+00002f70: 2020 2020 2020 2063 6f6e 6669 672e 6d70         config.mp
+00002f80: 696a 6f62 5f63 7264 5f76 6572 7369 6f6e  ijob_crd_version
+00002f90: 203d 2063 6f6e 6669 672e 6d70 696a 6f62   = config.mpijob
+00002fa0: 5f63 7264 5f76 6572 7369 6f6e 206f 7220  _crd_version or 
+00002fb0: 7365 7276 6572 5f63 6667 2e67 6574 280a  server_cfg.get(.
+00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fd0: 226d 7069 6a6f 625f 6372 645f 7665 7273  "mpijob_crd_vers
+00002fe0: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
+00002ff0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
+00003000: 6f6e 6669 672e 7569 2e75 726c 203d 2063  onfig.ui.url = c
+00003010: 6f6e 6669 672e 7265 736f 6c76 655f 7569  onfig.resolve_ui
+00003020: 5f75 726c 2829 206f 7220 7365 7276 6572  _url() or server
+00003030: 5f63 6667 2e67 6574 2822 7569 5f75 726c  _cfg.get("ui_url
+00003040: 2229 0a20 2020 2020 2020 2020 2020 2063  ").            c
+00003050: 6f6e 6669 672e 6172 7469 6661 6374 5f70  onfig.artifact_p
+00003060: 6174 6820 3d20 636f 6e66 6967 2e61 7274  ath = config.art
+00003070: 6966 6163 745f 7061 7468 206f 7220 7365  ifact_path or se
+00003080: 7276 6572 5f63 6667 2e67 6574 280a 2020  rver_cfg.get(.  
+00003090: 2020 2020 2020 2020 2020 2020 2020 2261                "a
+000030a0: 7274 6966 6163 745f 7061 7468 220a 2020  rtifact_path".  
+000030b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000030c0: 2020 2020 2020 2020 636f 6e66 6967 2e66          config.f
+000030d0: 6561 7475 7265 5f73 746f 7265 2e64 6174  eature_store.dat
+000030e0: 615f 7072 6566 6978 6573 203d 2028 0a20  a_prefixes = (. 
+000030f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00003100: 6f6e 6669 672e 6665 6174 7572 655f 7374  onfig.feature_st
+00003110: 6f72 652e 6461 7461 5f70 7265 6669 7865  ore.data_prefixe
+00003120: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00003130: 2020 6f72 2073 6572 7665 725f 6366 672e    or server_cfg.
+00003140: 6765 7428 2266 6561 7475 7265 5f73 746f  get("feature_sto
+00003150: 7265 5f64 6174 615f 7072 6566 6978 6573  re_data_prefixes
+00003160: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+00003170: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00003180: 6669 672e 7370 6172 6b5f 6170 705f 696d  fig.spark_app_im
+00003190: 6167 6520 3d20 636f 6e66 6967 2e73 7061  age = config.spa
+000031a0: 726b 5f61 7070 5f69 6d61 6765 206f 7220  rk_app_image or 
+000031b0: 7365 7276 6572 5f63 6667 2e67 6574 280a  server_cfg.get(.
+000031c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031d0: 2273 7061 726b 5f61 7070 5f69 6d61 6765  "spark_app_image
+000031e0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+000031f0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00003200: 6967 2e73 7061 726b 5f61 7070 5f69 6d61  ig.spark_app_ima
+00003210: 6765 5f74 6167 203d 2063 6f6e 6669 672e  ge_tag = config.
+00003220: 7370 6172 6b5f 6170 705f 696d 6167 655f  spark_app_image_
+00003230: 7461 6720 6f72 2073 6572 7665 725f 6366  tag or server_cf
+00003240: 672e 6765 7428 0a20 2020 2020 2020 2020  g.get(.         
+00003250: 2020 2020 2020 2022 7370 6172 6b5f 6170         "spark_ap
+00003260: 705f 696d 6167 655f 7461 6722 0a20 2020  p_image_tag".   
+00003270: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00003280: 2020 2020 2020 2063 6f6e 6669 672e 7370         config.sp
+00003290: 6172 6b5f 6869 7374 6f72 795f 7365 7276  ark_history_serv
+000032a0: 6572 5f70 6174 6820 3d20 280a 2020 2020  er_path = (.    
+000032b0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+000032c0: 6967 2e73 7061 726b 5f68 6973 746f 7279  ig.spark_history
+000032d0: 5f73 6572 7665 725f 7061 7468 0a20 2020  _server_path.   
+000032e0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+000032f0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00003300: 7370 6172 6b5f 6869 7374 6f72 795f 7365  spark_history_se
+00003310: 7276 6572 5f70 6174 6822 290a 2020 2020  rver_path").    
+00003320: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003330: 2020 2020 2020 636f 6e66 6967 2e68 7474        config.htt
+00003340: 7064 622e 6275 696c 6465 722e 646f 636b  pdb.builder.dock
+00003350: 6572 5f72 6567 6973 7472 7920 3d20 280a  er_registry = (.
+00003360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003370: 636f 6e66 6967 2e68 7474 7064 622e 6275  config.httpdb.bu
+00003380: 696c 6465 722e 646f 636b 6572 5f72 6567  ilder.docker_reg
+00003390: 6973 7472 790a 2020 2020 2020 2020 2020  istry.          
+000033a0: 2020 2020 2020 6f72 2073 6572 7665 725f        or server_
+000033b0: 6366 672e 6765 7428 2264 6f63 6b65 725f  cfg.get("docker_
+000033c0: 7265 6769 7374 7279 2229 0a20 2020 2020  registry").     
+000033d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000033e0: 2020 2020 2063 6f6e 6669 672e 6874 7470       config.http
+000033f0: 6462 2e61 7069 5f75 726c 203d 2063 6f6e  db.api_url = con
+00003400: 6669 672e 6874 7470 6462 2e61 7069 5f75  fig.httpdb.api_u
+00003410: 726c 206f 7220 7365 7276 6572 5f63 6667  rl or server_cfg
+00003420: 2e67 6574 2822 6170 695f 7572 6c22 290a  .get("api_url").
+00003430: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00003440: 6967 2e6e 7563 6c69 6f5f 7665 7273 696f  ig.nuclio_versio
+00003450: 6e20 3d20 636f 6e66 6967 2e6e 7563 6c69  n = config.nucli
+00003460: 6f5f 7665 7273 696f 6e20 6f72 2073 6572  o_version or ser
+00003470: 7665 725f 6366 672e 6765 7428 0a20 2020  ver_cfg.get(.   
+00003480: 2020 2020 2020 2020 2020 2020 2022 6e75               "nu
+00003490: 636c 696f 5f76 6572 7369 6f6e 220a 2020  clio_version".  
+000034a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000034b0: 2020 2020 2020 2020 636f 6e66 6967 2e64          config.d
+000034c0: 6566 6175 6c74 5f66 756e 6374 696f 6e5f  efault_function_
+000034d0: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
+000034e0: 616d 6520 3d20 280a 2020 2020 2020 2020  ame = (.        
+000034f0: 2020 2020 2020 2020 636f 6e66 6967 2e64          config.d
+00003500: 6566 6175 6c74 5f66 756e 6374 696f 6e5f  efault_function_
+00003510: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
+00003520: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+00003530: 2020 2020 6f72 2073 6572 7665 725f 6366      or server_cf
+00003540: 672e 6765 7428 2264 6566 6175 6c74 5f66  g.get("default_f
+00003550: 756e 6374 696f 6e5f 7072 696f 7269 7479  unction_priority
+00003560: 5f63 6c61 7373 5f6e 616d 6522 290a 2020  _class_name").  
+00003570: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003580: 2020 2020 2020 2020 636f 6e66 6967 2e76          config.v
+00003590: 616c 6964 5f66 756e 6374 696f 6e5f 7072  alid_function_pr
+000035a0: 696f 7269 7479 5f63 6c61 7373 5f6e 616d  iority_class_nam
+000035b0: 6573 203d 2028 0a20 2020 2020 2020 2020  es = (.         
+000035c0: 2020 2020 2020 2063 6f6e 6669 672e 7661         config.va
+000035d0: 6c69 645f 6675 6e63 7469 6f6e 5f70 7269  lid_function_pri
+000035e0: 6f72 6974 795f 636c 6173 735f 6e61 6d65  ority_class_name
+000035f0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00003600: 2020 6f72 2073 6572 7665 725f 6366 672e    or server_cfg.
+00003610: 6765 7428 2276 616c 6964 5f66 756e 6374  get("valid_funct
+00003620: 696f 6e5f 7072 696f 7269 7479 5f63 6c61  ion_priority_cla
+00003630: 7373 5f6e 616d 6573 2229 0a20 2020 2020  ss_names").     
+00003640: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00003650: 2020 2020 2063 6f6e 6669 672e 6172 7469       config.arti
+00003660: 6661 6374 732e 6361 6c63 756c 6174 655f  facts.calculate_
+00003670: 6861 7368 203d 2028 0a20 2020 2020 2020  hash = (.       
+00003680: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00003690: 6172 7469 6661 6374 732e 6361 6c63 756c  artifacts.calcul
+000036a0: 6174 655f 6861 7368 0a20 2020 2020 2020  ate_hash.       
+000036b0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+000036c0: 6967 2e61 7274 6966 6163 7473 2e63 616c  ig.artifacts.cal
+000036d0: 6375 6c61 7465 5f68 6173 6820 6973 206e  culate_hash is n
+000036e0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+000036f0: 2020 2020 2020 2020 656c 7365 2073 6572          else ser
+00003700: 7665 725f 6366 672e 6765 7428 2263 616c  ver_cfg.get("cal
+00003710: 6375 6c61 7465 5f61 7274 6966 6163 745f  culate_artifact_
+00003720: 6861 7368 2229 0a20 2020 2020 2020 2020  hash").         
+00003730: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00003740: 2063 6f6e 6669 672e 6172 7469 6661 6374   config.artifact
+00003750: 732e 6765 6e65 7261 7465 5f74 6172 6765  s.generate_targe
+00003760: 745f 7061 7468 5f66 726f 6d5f 6172 7469  t_path_from_arti
+00003770: 6661 6374 5f68 6173 6820 3d20 280a 2020  fact_hash = (.  
+00003780: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00003790: 6e66 6967 2e61 7274 6966 6163 7473 2e67  nfig.artifacts.g
+000037a0: 656e 6572 6174 655f 7461 7267 6574 5f70  enerate_target_p
+000037b0: 6174 685f 6672 6f6d 5f61 7274 6966 6163  ath_from_artifac
+000037c0: 745f 6861 7368 0a20 2020 2020 2020 2020  t_hash.         
+000037d0: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
+000037e0: 2e61 7274 6966 6163 7473 2e67 656e 6572  .artifacts.gener
+000037f0: 6174 655f 7461 7267 6574 5f70 6174 685f  ate_target_path_
+00003800: 6672 6f6d 5f61 7274 6966 6163 745f 6861  from_artifact_ha
+00003810: 7368 2069 7320 6e6f 7420 4e6f 6e65 0a20  sh is not None. 
+00003820: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003830: 6c73 6520 7365 7276 6572 5f63 6667 2e67  lse server_cfg.g
+00003840: 6574 2822 6765 6e65 7261 7465 5f61 7274  et("generate_art
+00003850: 6966 6163 745f 7461 7267 6574 5f70 6174  ifact_target_pat
+00003860: 685f 6672 6f6d 5f61 7274 6966 6163 745f  h_from_artifact_
+00003870: 6861 7368 2229 0a20 2020 2020 2020 2020  hash").         
+00003880: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+00003890: 2020 636f 6e66 6967 2e72 6564 6973 2e75    config.redis.u
+000038a0: 726c 203d 2063 6f6e 6669 672e 7265 6469  rl = config.redi
+000038b0: 732e 7572 6c20 6f72 2073 6572 7665 725f  s.url or server_
+000038c0: 6366 672e 6765 7428 2272 6564 6973 5f75  cfg.get("redis_u
+000038d0: 726c 2229 0a20 2020 2020 2020 2020 2020  rl").           
+000038e0: 2023 2061 6c6c 6f77 2063 6c69 656e 7420   # allow client 
+000038f0: 746f 2073 6574 2074 6865 2064 6566 6175  to set the defau
+00003900: 6c74 2070 6172 7469 616c 2057 4120 666f  lt partial WA fo
+00003910: 7220 6c61 636b 206f 6620 7375 7070 6f72  r lack of suppor
+00003920: 7420 6f66 2070 6572 2d74 6172 6765 7420  t of per-target 
+00003930: 6175 7869 6c69 6172 7920 6f70 7469 6f6e  auxiliary option
+00003940: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
+00003950: 6e66 6967 2e72 6564 6973 2e74 7970 6520  nfig.redis.type 
+00003960: 3d20 636f 6e66 6967 2e72 6564 6973 2e74  = config.redis.t
+00003970: 7970 6520 6f72 2073 6572 7665 725f 6366  ype or server_cf
+00003980: 672e 6765 7428 2272 6564 6973 5f74 7970  g.get("redis_typ
+00003990: 6522 290a 0a20 2020 2020 2020 2020 2020  e")..           
+000039a0: 2063 6f6e 6669 672e 7371 6c2e 7572 6c20   config.sql.url 
+000039b0: 3d20 636f 6e66 6967 2e73 716c 2e75 726c  = config.sql.url
+000039c0: 206f 7220 7365 7276 6572 5f63 6667 2e67   or server_cfg.g
+000039d0: 6574 2822 7371 6c5f 7572 6c22 290a 2020  et("sql_url").  
+000039e0: 2020 2020 2020 2020 2020 2320 5468 6573            # Thes
+000039f0: 6520 6861 7665 2061 2064 6566 6175 6c74  e have a default
+00003a00: 2076 616c 7565 2c20 7468 6572 6566 6f72   value, therefor
+00003a10: 6520 6c6f 6361 6c20 636f 6e66 6967 2077  e local config w
+00003a20: 696c 6c20 616c 7761 7973 2068 6176 6520  ill always have 
+00003a30: 6120 7661 6c75 652c 2070 7269 6f72 6974  a value, priorit
+00003a40: 697a 6520 7468 650a 2020 2020 2020 2020  ize the.        
+00003a50: 2020 2020 2320 4150 4920 7661 6c75 6520      # API value 
+00003a60: 6669 7273 740a 2020 2020 2020 2020 2020  first.          
+00003a70: 2020 636f 6e66 6967 2e75 692e 7072 6f6a    config.ui.proj
+00003a80: 6563 7473 5f70 7265 6669 7820 3d20 280a  ects_prefix = (.
+00003a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003aa0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00003ab0: 7569 5f70 726f 6a65 6374 735f 7072 6566  ui_projects_pref
+00003ac0: 6978 2229 206f 7220 636f 6e66 6967 2e75  ix") or config.u
+00003ad0: 692e 7072 6f6a 6563 7473 5f70 7265 6669  i.projects_prefi
+00003ae0: 780a 2020 2020 2020 2020 2020 2020 290a  x.            ).
+00003af0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00003b00: 6967 2e6b 6670 5f69 6d61 6765 203d 2073  ig.kfp_image = s
+00003b10: 6572 7665 725f 6366 672e 6765 7428 226b  erver_cfg.get("k
+00003b20: 6670 5f69 6d61 6765 2229 206f 7220 636f  fp_image") or co
+00003b30: 6e66 6967 2e6b 6670 5f69 6d61 6765 0a20  nfig.kfp_image. 
+00003b40: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00003b50: 672e 6b66 705f 7572 6c20 3d20 7365 7276  g.kfp_url = serv
+00003b60: 6572 5f63 6667 2e67 6574 2822 6b66 705f  er_cfg.get("kfp_
+00003b70: 7572 6c22 2920 6f72 2063 6f6e 6669 672e  url") or config.
+00003b80: 6b66 705f 7572 6c0a 2020 2020 2020 2020  kfp_url.        
+00003b90: 2020 2020 636f 6e66 6967 2e64 6173 6b5f      config.dask_
+00003ba0: 6b66 705f 696d 6167 6520 3d20 280a 2020  kfp_image = (.  
+00003bb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003bc0: 7276 6572 5f63 6667 2e67 6574 2822 6461  rver_cfg.get("da
+00003bd0: 736b 5f6b 6670 5f69 6d61 6765 2229 206f  sk_kfp_image") o
+00003be0: 7220 636f 6e66 6967 2e64 6173 6b5f 6b66  r config.dask_kf
+00003bf0: 705f 696d 6167 650a 2020 2020 2020 2020  p_image.        
+00003c00: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00003c10: 2020 636f 6e66 6967 2e73 6372 6170 655f    config.scrape_
+00003c20: 6d65 7472 6963 7320 3d20 280a 2020 2020  metrics = (.    
+00003c30: 2020 2020 2020 2020 2020 2020 7365 7276              serv
+00003c40: 6572 5f63 6667 2e67 6574 2822 7363 7261  er_cfg.get("scra
+00003c50: 7065 5f6d 6574 7269 6373 2229 0a20 2020  pe_metrics").   
+00003c60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00003c70: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00003c80: 7363 7261 7065 5f6d 6574 7269 6373 2229  scrape_metrics")
+00003c90: 2069 7320 6e6f 7420 4e6f 6e65 0a20 2020   is not None.   
+00003ca0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00003cb0: 6520 636f 6e66 6967 2e73 6372 6170 655f  e config.scrape_
+00003cc0: 6d65 7472 6963 730a 2020 2020 2020 2020  metrics.        
+00003cd0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00003ce0: 2020 636f 6e66 6967 2e68 7562 5f75 726c    config.hub_url
+00003cf0: 203d 2073 6572 7665 725f 6366 672e 6765   = server_cfg.ge
+00003d00: 7428 2268 7562 5f75 726c 2229 206f 7220  t("hub_url") or 
+00003d10: 636f 6e66 6967 2e68 7562 5f75 726c 0a20  config.hub_url. 
+00003d20: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00003d30: 672e 6465 6661 756c 745f 6675 6e63 7469  g.default_functi
+00003d40: 6f6e 5f6e 6f64 655f 7365 6c65 6374 6f72  on_node_selector
+00003d50: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00003d60: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
+00003d70: 6765 7428 2264 6566 6175 6c74 5f66 756e  get("default_fun
+00003d80: 6374 696f 6e5f 6e6f 6465 5f73 656c 6563  ction_node_selec
+00003d90: 746f 7222 290a 2020 2020 2020 2020 2020  tor").          
+00003da0: 2020 2020 2020 6f72 2063 6f6e 6669 672e        or config.
+00003db0: 6465 6661 756c 745f 6675 6e63 7469 6f6e  default_function
+00003dc0: 5f6e 6f64 655f 7365 6c65 6374 6f72 0a20  _node_selector. 
+00003dd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00003de0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00003df0: 6967 7a5f 7665 7273 696f 6e20 3d20 7365  igz_version = se
+00003e00: 7276 6572 5f63 6667 2e67 6574 2822 6967  rver_cfg.get("ig
+00003e10: 7a5f 7665 7273 696f 6e22 2920 6f72 2063  z_version") or c
+00003e20: 6f6e 6669 672e 6967 7a5f 7665 7273 696f  onfig.igz_versio
+00003e30: 6e0a 2020 2020 2020 2020 2020 2020 636f  n.            co
+00003e40: 6e66 6967 2e73 746f 7261 6765 2e61 7574  nfig.storage.aut
+00003e50: 6f5f 6d6f 756e 745f 7479 7065 203d 2028  o_mount_type = (
+00003e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003e70: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00003e80: 2261 7574 6f5f 6d6f 756e 745f 7479 7065  "auto_mount_type
+00003e90: 2229 206f 7220 636f 6e66 6967 2e73 746f  ") or config.sto
+00003ea0: 7261 6765 2e61 7574 6f5f 6d6f 756e 745f  rage.auto_mount_
+00003eb0: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
+00003ec0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
+00003ed0: 6f6e 6669 672e 7374 6f72 6167 652e 6175  onfig.storage.au
+00003ee0: 746f 5f6d 6f75 6e74 5f70 6172 616d 7320  to_mount_params 
+00003ef0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00003f00: 2020 2020 7365 7276 6572 5f63 6667 2e67      server_cfg.g
+00003f10: 6574 2822 6175 746f 5f6d 6f75 6e74 5f70  et("auto_mount_p
+00003f20: 6172 616d 7322 2920 6f72 2063 6f6e 6669  arams") or confi
+00003f30: 672e 7374 6f72 6167 652e 6175 746f 5f6d  g.storage.auto_m
+00003f40: 6f75 6e74 5f70 6172 616d 730a 2020 2020  ount_params.    
+00003f50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003f60: 2020 2020 2020 636f 6e66 6967 2e73 7061        config.spa
+00003f70: 726b 5f6f 7065 7261 746f 725f 7665 7273  rk_operator_vers
+00003f80: 696f 6e20 3d20 280a 2020 2020 2020 2020  ion = (.        
+00003f90: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
+00003fa0: 6667 2e67 6574 2822 7370 6172 6b5f 6f70  fg.get("spark_op
+00003fb0: 6572 6174 6f72 5f76 6572 7369 6f6e 2229  erator_version")
+00003fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003fd0: 206f 7220 636f 6e66 6967 2e73 7061 726b   or config.spark
+00003fe0: 5f6f 7065 7261 746f 725f 7665 7273 696f  _operator_versio
+00003ff0: 6e0a 2020 2020 2020 2020 2020 2020 290a  n.            ).
+00004000: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00004010: 6967 2e64 6566 6175 6c74 5f74 656e 736f  ig.default_tenso
+00004020: 7262 6f61 7264 5f6c 6f67 735f 7061 7468  rboard_logs_path
+00004030: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00004040: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
+00004050: 6765 7428 2264 6566 6175 6c74 5f74 656e  get("default_ten
+00004060: 736f 7262 6f61 7264 5f6c 6f67 735f 7061  sorboard_logs_pa
+00004070: 7468 2229 0a20 2020 2020 2020 2020 2020  th").           
+00004080: 2020 2020 206f 7220 636f 6e66 6967 2e64       or config.d
+00004090: 6566 6175 6c74 5f74 656e 736f 7262 6f61  efault_tensorboa
+000040a0: 7264 5f6c 6f67 735f 7061 7468 0a20 2020  rd_logs_path.   
+000040b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000040c0: 2020 2020 2020 2063 6f6e 6669 672e 6465         config.de
+000040d0: 6661 756c 745f 6675 6e63 7469 6f6e 5f70  fault_function_p
+000040e0: 6f64 5f72 6573 6f75 7263 6573 203d 2028  od_resources = (
+000040f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004100: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00004110: 2264 6566 6175 6c74 5f66 756e 6374 696f  "default_functio
+00004120: 6e5f 706f 645f 7265 736f 7572 6365 7322  n_pod_resources"
+00004130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004140: 2020 6f72 2063 6f6e 6669 672e 6465 6661    or config.defa
+00004150: 756c 745f 6675 6e63 7469 6f6e 5f70 6f64  ult_function_pod
+00004160: 5f72 6573 6f75 7263 6573 0a20 2020 2020  _resources.     
+00004170: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00004180: 2020 2020 2063 6f6e 6669 672e 6675 6e63       config.func
+00004190: 7469 6f6e 5f64 6566 6175 6c74 732e 7072  tion_defaults.pr
+000041a0: 6565 6d70 7469 6f6e 5f6d 6f64 6520 3d20  eemption_mode = 
+000041b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000041c0: 2020 7365 7276 6572 5f63 6667 2e67 6574    server_cfg.get
+000041d0: 2822 6465 6661 756c 745f 7072 6565 6d70  ("default_preemp
+000041e0: 7469 6f6e 5f6d 6f64 6522 290a 2020 2020  tion_mode").    
+000041f0: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
+00004200: 6f6e 6669 672e 6675 6e63 7469 6f6e 5f64  onfig.function_d
+00004210: 6566 6175 6c74 732e 7072 6565 6d70 7469  efaults.preempti
+00004220: 6f6e 5f6d 6f64 650a 2020 2020 2020 2020  on_mode.        
+00004230: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00004240: 2020 636f 6e66 6967 2e70 7265 656d 7074    config.preempt
+00004250: 6962 6c65 5f6e 6f64 6573 2e6e 6f64 655f  ible_nodes.node_
+00004260: 7365 6c65 6374 6f72 203d 2028 0a20 2020  selector = (.   
+00004270: 2020 2020 2020 2020 2020 2020 2073 6572               ser
+00004280: 7665 725f 6366 672e 6765 7428 2270 7265  ver_cfg.get("pre
+00004290: 656d 7074 6962 6c65 5f6e 6f64 6573 5f6e  emptible_nodes_n
+000042a0: 6f64 655f 7365 6c65 6374 6f72 2229 0a20  ode_selector"). 
+000042b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000042c0: 7220 636f 6e66 6967 2e70 7265 656d 7074  r config.preempt
+000042d0: 6962 6c65 5f6e 6f64 6573 2e6e 6f64 655f  ible_nodes.node_
+000042e0: 7365 6c65 6374 6f72 0a20 2020 2020 2020  selector.       
+000042f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00004300: 2020 2063 6f6e 6669 672e 7072 6565 6d70     config.preemp
+00004310: 7469 626c 655f 6e6f 6465 732e 746f 6c65  tible_nodes.tole
+00004320: 7261 7469 6f6e 7320 3d20 280a 2020 2020  rations = (.    
+00004330: 2020 2020 2020 2020 2020 2020 7365 7276              serv
+00004340: 6572 5f63 6667 2e67 6574 2822 7072 6565  er_cfg.get("pree
+00004350: 6d70 7469 626c 655f 6e6f 6465 735f 746f  mptible_nodes_to
+00004360: 6c65 7261 7469 6f6e 7322 290a 2020 2020  lerations").    
+00004370: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
+00004380: 6f6e 6669 672e 7072 6565 6d70 7469 626c  onfig.preemptibl
+00004390: 655f 6e6f 6465 732e 746f 6c65 7261 7469  e_nodes.tolerati
+000043a0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+000043b0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+000043c0: 6e66 6967 2e66 6f72 6365 5f72 756e 5f6c  nfig.force_run_l
+000043d0: 6f63 616c 203d 2028 0a20 2020 2020 2020  ocal = (.       
+000043e0: 2020 2020 2020 2020 2073 6572 7665 725f           server_
+000043f0: 6366 672e 6765 7428 2266 6f72 6365 5f72  cfg.get("force_r
+00004400: 756e 5f6c 6f63 616c 2229 206f 7220 636f  un_local") or co
+00004410: 6e66 6967 2e66 6f72 6365 5f72 756e 5f6c  nfig.force_run_l
+00004420: 6f63 616c 0a20 2020 2020 2020 2020 2020  ocal.           
+00004430: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
+00004440: 6f6e 6669 672e 6675 6e63 7469 6f6e 203d  onfig.function =
+00004450: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00004460: 2266 756e 6374 696f 6e22 2920 6f72 2063  "function") or c
+00004470: 6f6e 6669 672e 6675 6e63 7469 6f6e 0a20  onfig.function. 
+00004480: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00004490: 672e 6874 7470 6462 2e6c 6f67 7320 3d20  g.httpdb.logs = 
+000044a0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+000044b0: 6c6f 6773 2229 206f 7220 636f 6e66 6967  logs") or config
+000044c0: 2e68 7474 7064 622e 6c6f 6773 0a0a 2020  .httpdb.logs..  
+000044d0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+000044e0: 6570 7469 6f6e 2061 7320 6578 633a 0a20  eption as exc:. 
+000044f0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00004500: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
+00004510: 2020 2020 2020 2020 2020 2022 4661 696c             "Fail
+00004520: 6564 2073 796e 6369 6e67 2063 6f6e 6669  ed syncing confi
+00004530: 6720 6672 6f6d 2073 6572 7665 7222 2c0a  g from server",.
+00004540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004550: 6578 633d 6572 725f 746f 5f73 7472 2865  exc=err_to_str(e
+00004560: 7863 292c 0a20 2020 2020 2020 2020 2020  xc),.           
+00004570: 2020 2020 2074 7261 6365 6261 636b 3d74       traceback=t
+00004580: 7261 6365 6261 636b 2e66 6f72 6d61 745f  raceback.format_
+00004590: 6578 6328 292c 0a20 2020 2020 2020 2020  exc(),.         
+000045a0: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+000045b0: 7572 6e20 7365 6c66 0a0a 2020 2020 6465  urn self..    de
+000045c0: 6620 7374 6f72 655f 6c6f 6728 7365 6c66  f store_log(self
+000045d0: 2c20 7569 642c 2070 726f 6a65 6374 3d22  , uid, project="
+000045e0: 222c 2062 6f64 793d 4e6f 6e65 2c20 6170  ", body=None, ap
+000045f0: 7065 6e64 3d46 616c 7365 293a 0a20 2020  pend=False):.   
+00004600: 2020 2020 2022 2222 5361 7665 2061 206c       """Save a l
+00004610: 6f67 2070 6572 7369 7374 656e 746c 792e  og persistently.
+00004620: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00004630: 2075 6964 3a20 4c6f 6720 756e 6971 7565   uid: Log unique
+00004640: 2049 440a 2020 2020 2020 2020 3a70 6172   ID.        :par
+00004650: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+00004660: 6563 7420 6e61 6d65 2066 6f72 2077 6869  ect name for whi
+00004670: 6368 2074 6869 7320 6c6f 6720 6265 6c6f  ch this log belo
+00004680: 6e67 730a 2020 2020 2020 2020 3a70 6172  ngs.        :par
+00004690: 616d 2062 6f64 793a 2054 6865 2061 6374  am body: The act
+000046a0: 7561 6c20 6c6f 6720 746f 2073 746f 7265  ual log to store
+000046b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000046c0: 6170 7065 6e64 3a20 5768 6574 6865 7220  append: Whether 
+000046d0: 746f 2061 7070 656e 6420 7468 6520 6c6f  to append the lo
+000046e0: 6720 7072 6f76 6964 6564 2069 6e20 6060  g provided in ``
+000046f0: 626f 6479 6060 2074 6f20 616e 2065 7869  body`` to an exi
+00004700: 7374 696e 6720 6c6f 6720 7769 7468 2074  sting log with t
+00004710: 6865 2073 616d 6520 6060 7569 6460 6020  he same ``uid`` 
+00004720: 6f72 2074 6f0a 2020 2020 2020 2020 2020  or to.          
+00004730: 2020 6372 6561 7465 2061 206e 6577 206c    create a new l
+00004740: 6f67 2e20 4966 2073 6574 2074 6f20 6060  og. If set to ``
+00004750: 4661 6c73 6560 602c 2061 6e20 6578 6973  False``, an exis
+00004760: 7469 6e67 206c 6f67 2077 6974 6820 7361  ting log with sa
+00004770: 6d65 2060 6075 6964 6060 2077 696c 6c20  me ``uid`` will 
+00004780: 6265 206f 7665 7277 7269 7474 656e 0a20  be overwritten. 
+00004790: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000047a0: 2020 2020 6966 206e 6f74 2062 6f64 793a      if not body:
+000047b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000047c0: 7572 6e0a 0a20 2020 2020 2020 2070 6174  urn..        pat
+000047d0: 6820 3d20 7365 6c66 2e5f 7061 7468 5f6f  h = self._path_o
+000047e0: 6628 226c 6f67 222c 2070 726f 6a65 6374  f("log", project
+000047f0: 2c20 7569 6429 0a20 2020 2020 2020 2070  , uid).        p
+00004800: 6172 616d 7320 3d20 7b22 6170 7065 6e64  arams = {"append
+00004810: 223a 2062 6f6f 6c32 7374 7228 6170 7065  ": bool2str(appe
+00004820: 6e64 297d 0a20 2020 2020 2020 2065 7272  nd)}.        err
+00004830: 6f72 203d 2066 2273 746f 7265 206c 6f67  or = f"store log
+00004840: 207b 7072 6f6a 6563 747d 2f7b 7569 647d   {project}/{uid}
+00004850: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+00004860: 7069 5f63 616c 6c28 2250 4f53 5422 2c20  pi_call("POST", 
+00004870: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
+00004880: 616d 732c 2062 6f64 7929 0a0a 2020 2020  ams, body)..    
+00004890: 6465 6620 6765 745f 6c6f 6728 7365 6c66  def get_log(self
+000048a0: 2c20 7569 642c 2070 726f 6a65 6374 3d22  , uid, project="
+000048b0: 222c 206f 6666 7365 743d 302c 2073 697a  ", offset=0, siz
+000048c0: 653d 2d31 293a 0a20 2020 2020 2020 2022  e=-1):.        "
+000048d0: 2222 5265 7472 6965 7665 2061 206c 6f67  ""Retrieve a log
+000048e0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+000048f0: 6d20 7569 643a 204c 6f67 2075 6e69 7175  m uid: Log uniqu
+00004900: 6520 4944 0a20 2020 2020 2020 203a 7061  e ID.        :pa
+00004910: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
+00004920: 6a65 6374 206e 616d 6520 666f 7220 7768  ject name for wh
+00004930: 6963 6820 7468 6520 6c6f 6720 6265 6c6f  ich the log belo
+00004940: 6e67 730a 2020 2020 2020 2020 3a70 6172  ngs.        :par
+00004950: 616d 206f 6666 7365 743a 2052 6574 7269  am offset: Retri
+00004960: 6576 6520 7061 7274 6961 6c20 6c6f 672c  eve partial log,
+00004970: 2067 6574 2075 7020 746f 2060 6073 697a   get up to ``siz
+00004980: 6560 6020 6279 7465 7320 7374 6172 7469  e`` bytes starti
+00004990: 6e67 2061 7420 6f66 6673 6574 2060 606f  ng at offset ``o
+000049a0: 6666 7365 7460 600a 2020 2020 2020 2020  ffset``.        
+000049b0: 2020 2020 6672 6f6d 2062 6567 696e 6e69      from beginni
+000049c0: 6e67 206f 6620 6c6f 670a 2020 2020 2020  ng of log.      
+000049d0: 2020 3a70 6172 616d 2073 697a 653a 2053    :param size: S
+000049e0: 6565 2060 606f 6666 7365 7460 602e 2049  ee ``offset``. I
+000049f0: 6620 7365 7420 746f 2060 602d 3160 6020  f set to ``-1`` 
+00004a00: 2874 6865 2064 6566 6175 6c74 2920 7769  (the default) wi
+00004a10: 6c6c 2072 6574 7269 6576 6520 616c 6c20  ll retrieve all 
+00004a20: 6461 7461 2074 6f20 656e 6420 6f66 206c  data to end of l
+00004a30: 6f67 2e0a 2020 2020 2020 2020 3a72 6574  og..        :ret
+00004a40: 7572 6e73 3a20 5468 6520 666f 6c6c 6f77  urns: The follow
+00004a50: 696e 6720 6f62 6a65 6374 733a 0a0a 2020  ing objects:..  
+00004a60: 2020 2020 2020 2020 2020 2d20 7374 6174            - stat
+00004a70: 6520 2d20 5468 6520 7374 6174 6520 6f66  e - The state of
+00004a80: 2074 6865 2072 756e 7469 6d65 206f 626a   the runtime obj
+00004a90: 6563 7420 7768 6963 6820 6765 6e65 7261  ect which genera
+00004aa0: 7465 7320 7468 6973 206c 6f67 2c20 6966  tes this log, if
+00004ab0: 2069 7420 6578 6973 7473 2e20 496e 2063   it exists. In c
+00004ac0: 6173 6520 6e6f 206b 6e6f 776e 2073 7461  ase no known sta
+00004ad0: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
+00004ae0: 2065 7869 7374 732c 2074 6869 7320 7769   exists, this wi
+00004af0: 6c6c 2062 6520 6060 756e 6b6e 6f77 6e60  ll be ``unknown`
+00004b00: 602e 0a20 2020 2020 2020 2020 2020 202d  `..            -
+00004b10: 2063 6f6e 7465 6e74 202d 2054 6865 2061   content - The a
+00004b20: 6374 7561 6c20 6c6f 6720 636f 6e74 656e  ctual log conten
+00004b30: 742e 0a20 2020 2020 2020 2022 2222 0a0a  t..        """..
+00004b40: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00004b50: 207b 226f 6666 7365 7422 3a20 6f66 6673   {"offset": offs
+00004b60: 6574 2c20 2273 697a 6522 3a20 7369 7a65  et, "size": size
+00004b70: 7d0a 2020 2020 2020 2020 7061 7468 203d  }.        path =
+00004b80: 2073 656c 662e 5f70 6174 685f 6f66 2822   self._path_of("
+00004b90: 6c6f 6722 2c20 7072 6f6a 6563 742c 2075  log", project, u
+00004ba0: 6964 290a 2020 2020 2020 2020 6572 726f  id).        erro
+00004bb0: 7220 3d20 6622 6765 7420 6c6f 6720 7b70  r = f"get log {p
+00004bc0: 726f 6a65 6374 7d2f 7b75 6964 7d22 0a20  roject}/{uid}". 
+00004bd0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+00004be0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
+00004bf0: 222c 2070 6174 682c 2065 7272 6f72 2c20  ", path, error, 
+00004c00: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
+00004c10: 2020 2020 2020 2069 6620 7265 7370 2e68         if resp.h
+00004c20: 6561 6465 7273 3a0a 2020 2020 2020 2020  eaders:.        
+00004c30: 2020 2020 7374 6174 6520 3d20 7265 7370      state = resp
+00004c40: 2e68 6561 6465 7273 2e67 6574 2822 782d  .headers.get("x-
+00004c50: 6d6c 7275 6e2d 7275 6e2d 7374 6174 6522  mlrun-run-state"
+00004c60: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
+00004c70: 2020 7265 7475 726e 2073 7461 7465 2e6c    return state.l
+00004c80: 6f77 6572 2829 2c20 7265 7370 2e63 6f6e  ower(), resp.con
+00004c90: 7465 6e74 0a0a 2020 2020 2020 2020 7265  tent..        re
+00004ca0: 7475 726e 2022 756e 6b6e 6f77 6e22 2c20  turn "unknown", 
+00004cb0: 7265 7370 2e63 6f6e 7465 6e74 0a0a 2020  resp.content..  
+00004cc0: 2020 6465 6620 7761 7463 685f 6c6f 6728    def watch_log(
+00004cd0: 7365 6c66 2c20 7569 642c 2070 726f 6a65  self, uid, proje
+00004ce0: 6374 3d22 222c 2077 6174 6368 3d54 7275  ct="", watch=Tru
+00004cf0: 652c 206f 6666 7365 743d 3029 3a0a 2020  e, offset=0):.  
+00004d00: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
+00004d10: 6520 6c6f 6773 206f 6620 6120 7275 6e6e  e logs of a runn
+00004d20: 696e 6720 7072 6f63 6573 732c 2061 6e64  ing process, and
+00004d30: 2077 6174 6368 2074 6865 2070 726f 6772   watch the progr
+00004d40: 6573 7320 6f66 2074 6865 2065 7865 6375  ess of the execu
+00004d50: 7469 6f6e 2075 6e74 696c 2069 7420 636f  tion until it co
+00004d60: 6d70 6c65 7465 732e 2054 6869 730a 2020  mpletes. This.  
+00004d70: 2020 2020 2020 6d65 7468 6f64 2077 696c        method wil
+00004d80: 6c20 7072 696e 7420 6f75 7420 7468 6520  l print out the 
+00004d90: 6c6f 6773 2061 6e64 2063 6f6e 7469 6e75  logs and continu
+00004da0: 6520 746f 2070 6572 696f 6469 6361 6c6c  e to periodicall
+00004db0: 7920 706f 6c6c 2066 6f72 2c20 616e 6420  y poll for, and 
+00004dc0: 7072 696e 742c 206e 6577 206c 6f67 7320  print, new logs 
+00004dd0: 6173 206c 6f6e 6720 6173 2074 6865 0a20  as long as the. 
+00004de0: 2020 2020 2020 2073 7461 7465 206f 6620         state of 
+00004df0: 7468 6520 7275 6e74 696d 6520 7768 6963  the runtime whic
+00004e00: 6820 6765 6e65 7261 7465 7320 7468 6973  h generates this
+00004e10: 206c 6f67 2069 7320 6569 7468 6572 2060   log is either `
+00004e20: 6070 656e 6469 6e67 6060 206f 7220 6060  `pending`` or ``
+00004e30: 7275 6e6e 696e 6760 602e 0a0a 2020 2020  running``...    
+00004e40: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
+00004e50: 5468 6520 7569 6420 6f66 2074 6865 206c  The uid of the l
+00004e60: 6f67 206f 626a 6563 7420 746f 2077 6174  og object to wat
+00004e70: 6368 2e0a 2020 2020 2020 2020 3a70 6172  ch..        :par
+00004e80: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+00004e90: 6563 7420 7468 6174 2074 6865 206c 6f67  ect that the log
+00004ea0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
+00004eb0: 2020 2020 203a 7061 7261 6d20 7761 7463       :param watc
+00004ec0: 683a 2049 6620 7365 7420 746f 2060 6054  h: If set to ``T
+00004ed0: 7275 6560 6020 7769 6c6c 2063 6f6e 7469  rue`` will conti
+00004ee0: 6e75 6520 7472 6163 6b69 6e67 2074 6865  nue tracking the
+00004ef0: 206c 6f67 2061 7320 6465 7363 7269 6265   log as describe
+00004f00: 6420 6162 6f76 652e 204f 7468 6572 7769  d above. Otherwi
+00004f10: 7365 2074 6869 7320 6675 6e63 7469 6f6e  se this function
+00004f20: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
+00004f30: 7072 6163 7469 6361 6c6c 7920 6571 7569  practically equi
+00004f40: 7661 6c65 6e74 2074 6f20 7468 6520 3a70  valent to the :p
+00004f50: 793a 6675 6e63 3a60 7e67 6574 5f6c 6f67  y:func:`~get_log
+00004f60: 6020 6675 6e63 7469 6f6e 2e0a 2020 2020  ` function..    
+00004f70: 2020 2020 3a70 6172 616d 206f 6666 7365      :param offse
+00004f80: 743a 204d 696e 696d 616c 206f 6666 7365  t: Minimal offse
+00004f90: 7420 696e 2074 6865 206c 6f67 2074 6f20  t in the log to 
+00004fa0: 7761 7463 682e 0a20 2020 2020 2020 203a  watch..        :
+00004fb0: 7265 7475 726e 733a 2054 6865 2066 696e  returns: The fin
+00004fc0: 616c 2073 7461 7465 206f 6620 7468 6520  al state of the 
+00004fd0: 6c6f 6720 6265 696e 6720 7761 7463 6865  log being watche
+00004fe0: 642e 0a20 2020 2020 2020 2022 2222 0a0a  d..        """..
+00004ff0: 2020 2020 2020 2020 7374 6174 652c 2074          state, t
+00005000: 6578 7420 3d20 7365 6c66 2e67 6574 5f6c  ext = self.get_l
+00005010: 6f67 2875 6964 2c20 7072 6f6a 6563 742c  og(uid, project,
+00005020: 206f 6666 7365 743d 6f66 6673 6574 290a   offset=offset).
+00005030: 2020 2020 2020 2020 6966 2074 6578 743a          if text:
+00005040: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00005050: 6e74 2874 6578 742e 6465 636f 6465 2865  nt(text.decode(e
+00005060: 7272 6f72 733d 6d6c 7275 6e2e 6d6c 636f  rrors=mlrun.mlco
+00005070: 6e66 2e68 7474 7064 622e 6c6f 6773 2e64  nf.httpdb.logs.d
+00005080: 6563 6f64 652e 6572 726f 7273 2929 0a20  ecode.errors)). 
+00005090: 2020 2020 2020 2069 6620 7761 7463 683a         if watch:
+000050a0: 0a20 2020 2020 2020 2020 2020 206e 696c  .            nil
+000050b0: 5f72 6573 7020 3d20 300a 2020 2020 2020  _resp = 0.      
+000050c0: 2020 2020 2020 7768 696c 6520 7374 6174        while stat
+000050d0: 6520 696e 205b 2270 656e 6469 6e67 222c  e in ["pending",
+000050e0: 2022 7275 6e6e 696e 6722 5d3a 0a20 2020   "running"]:.   
+000050f0: 2020 2020 2020 2020 2020 2020 206f 6666               off
+00005100: 7365 7420 2b3d 206c 656e 2874 6578 7429  set += len(text)
+00005110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005120: 2023 2069 6620 7765 2067 6574 2033 206e   # if we get 3 n
+00005130: 696c 2072 6573 706f 6e73 6573 2069 6e20  il responses in 
+00005140: 6120 726f 772c 2069 6e63 7265 6173 6520  a row, increase 
+00005150: 7468 6520 736c 6565 7020 7469 6d65 2074  the sleep time t
+00005160: 6f20 3130 2073 6563 6f6e 6473 0a20 2020  o 10 seconds.   
+00005170: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00005180: 4f44 4f3a 2072 6566 6163 746f 7220 7468  ODO: refactor th
+00005190: 6973 2074 6f20 7573 6520 6120 636f 6e64  is to use a cond
+000051a0: 6974 696f 6e61 6c20 6261 636b 6f66 6620  itional backoff 
+000051b0: 6d65 6368 616e 6973 6d0a 2020 2020 2020  mechanism.      
+000051c0: 2020 2020 2020 2020 2020 6966 206e 696c            if nil
+000051d0: 5f72 6573 7020 3c20 333a 0a20 2020 2020  _resp < 3:.     
+000051e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000051f0: 696d 652e 736c 6565 7028 696e 7428 6d6c  ime.sleep(int(ml
+00005200: 7275 6e2e 6d6c 636f 6e66 2e68 7474 7064  run.mlconf.httpd
+00005210: 622e 6c6f 6773 2e70 756c 6c5f 6c6f 6773  b.logs.pull_logs
+00005220: 5f64 6566 6175 6c74 5f69 6e74 6572 7661  _default_interva
+00005230: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+00005240: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005250: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00005260: 6d65 2e73 6c65 6570 280a 2020 2020 2020  me.sleep(.      
+00005270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005280: 2020 696e 7428 0a20 2020 2020 2020 2020    int(.         
+00005290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052a0: 2020 206d 6c72 756e 2e6d 6c63 6f6e 662e     mlrun.mlconf.
+000052b0: 6874 7470 6462 2e6c 6f67 732e 7075 6c6c  httpdb.logs.pull
+000052c0: 5f6c 6f67 735f 6261 636b 6f66 665f 6e6f  _logs_backoff_no
+000052d0: 5f6c 6f67 735f 6465 6661 756c 745f 696e  _logs_default_in
+000052e0: 7465 7276 616c 0a20 2020 2020 2020 2020  terval.         
+000052f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00005300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005310: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005320: 2020 2020 2020 2073 7461 7465 2c20 7465         state, te
+00005330: 7874 203d 2073 656c 662e 6765 745f 6c6f  xt = self.get_lo
+00005340: 6728 7569 642c 2070 726f 6a65 6374 2c20  g(uid, project, 
+00005350: 6f66 6673 6574 3d6f 6666 7365 7429 0a20  offset=offset). 
+00005360: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00005370: 6620 7465 7874 3a0a 2020 2020 2020 2020  f text:.        
+00005380: 2020 2020 2020 2020 2020 2020 6e69 6c5f              nil_
+00005390: 7265 7370 203d 2030 0a20 2020 2020 2020  resp = 0.       
+000053a0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+000053b0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+000053c0: 2020 2020 2020 2020 2020 2020 7465 7874              text
+000053d0: 2e64 6563 6f64 6528 6572 726f 7273 3d6d  .decode(errors=m
+000053e0: 6c72 756e 2e6d 6c63 6f6e 662e 6874 7470  lrun.mlconf.http
+000053f0: 6462 2e6c 6f67 732e 6465 636f 6465 2e65  db.logs.decode.e
+00005400: 7272 6f72 7329 2c0a 2020 2020 2020 2020  rrors),.        
+00005410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005420: 656e 643d 2222 2c0a 2020 2020 2020 2020  end="",.        
+00005430: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00005440: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00005450: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005460: 2020 2020 2020 2020 6e69 6c5f 7265 7370          nil_resp
+00005470: 202b 3d20 310a 2020 2020 2020 2020 656c   += 1.        el
+00005480: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005490: 6f66 6673 6574 202b 3d20 6c65 6e28 7465  offset += len(te
+000054a0: 7874 290a 0a20 2020 2020 2020 2072 6574  xt)..        ret
+000054b0: 7572 6e20 7374 6174 652c 206f 6666 7365  urn state, offse
+000054c0: 740a 0a20 2020 2064 6566 2073 746f 7265  t..    def store
+000054d0: 5f72 756e 2873 656c 662c 2073 7472 7563  _run(self, struc
+000054e0: 742c 2075 6964 2c20 7072 6f6a 6563 743d  t, uid, project=
+000054f0: 2222 2c20 6974 6572 3d30 293a 0a20 2020  "", iter=0):.   
+00005500: 2020 2020 2022 2222 5374 6f72 6520 7275       """Store ru
+00005510: 6e20 6465 7461 696c 7320 696e 2074 6865  n details in the
+00005520: 2044 422e 2054 6869 7320 6d65 7468 6f64   DB. This method
+00005530: 2069 7320 7573 7561 6c6c 7920 6361 6c6c   is usually call
+00005540: 6564 2066 726f 6d20 7769 7468 696e 206f  ed from within o
+00005550: 7468 6572 203a 7079 3a6d 6f64 3a60 6d6c  ther :py:mod:`ml
+00005560: 7275 6e60 2066 6c6f 7773 0a20 2020 2020  run` flows.     
+00005570: 2020 2061 6e64 206e 6f74 2063 616c 6c65     and not calle
+00005580: 6420 6469 7265 6374 6c79 2062 7920 7468  d directly by th
+00005590: 6520 7573 6572 2e22 2222 0a0a 2020 2020  e user."""..    
+000055a0: 2020 2020 7061 7468 203d 2073 656c 662e      path = self.
+000055b0: 5f70 6174 685f 6f66 2822 7275 6e22 2c20  _path_of("run", 
+000055c0: 7072 6f6a 6563 742c 2075 6964 290a 2020  project, uid).  
+000055d0: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+000055e0: 2269 7465 7222 3a20 6974 6572 7d0a 2020  "iter": iter}.  
+000055f0: 2020 2020 2020 6572 726f 7220 3d20 6622        error = f"
+00005600: 7374 6f72 6520 7275 6e20 7b70 726f 6a65  store run {proje
+00005610: 6374 7d2f 7b75 6964 7d22 0a20 2020 2020  ct}/{uid}".     
+00005620: 2020 2062 6f64 7920 3d20 5f61 735f 6a73     body = _as_js
+00005630: 6f6e 2873 7472 7563 7429 0a20 2020 2020  on(struct).     
+00005640: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
+00005650: 2822 504f 5354 222c 2070 6174 682c 2065  ("POST", path, e
+00005660: 7272 6f72 2c20 7061 7261 6d73 3d70 6172  rror, params=par
+00005670: 616d 732c 2062 6f64 793d 626f 6479 290a  ams, body=body).
+00005680: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+00005690: 7275 6e28 7365 6c66 2c20 7570 6461 7465  run(self, update
+000056a0: 733a 2064 6963 742c 2075 6964 2c20 7072  s: dict, uid, pr
+000056b0: 6f6a 6563 743d 2222 2c20 6974 6572 3d30  oject="", iter=0
+000056c0: 293a 0a20 2020 2020 2020 2022 2222 5570  ):.        """Up
+000056d0: 6461 7465 2074 6865 2064 6574 6169 6c73  date the details
+000056e0: 206f 6620 6120 7374 6f72 6564 2072 756e   of a stored run
+000056f0: 2069 6e20 7468 6520 4442 2e22 2222 0a0a   in the DB."""..
+00005700: 2020 2020 2020 2020 7061 7468 203d 2073          path = s
+00005710: 656c 662e 5f70 6174 685f 6f66 2822 7275  elf._path_of("ru
+00005720: 6e22 2c20 7072 6f6a 6563 742c 2075 6964  n", project, uid
+00005730: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
+00005740: 203d 207b 2269 7465 7222 3a20 6974 6572   = {"iter": iter
+00005750: 7d0a 2020 2020 2020 2020 6572 726f 7220  }.        error 
+00005760: 3d20 6622 7570 6461 7465 2072 756e 207b  = f"update run {
+00005770: 7072 6f6a 6563 747d 2f7b 7569 647d 220a  project}/{uid}".
+00005780: 2020 2020 2020 2020 626f 6479 203d 205f          body = _
+00005790: 6173 5f6a 736f 6e28 7570 6461 7465 7329  as_json(updates)
+000057a0: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
+000057b0: 695f 6361 6c6c 2822 5041 5443 4822 2c20  i_call("PATCH", 
+000057c0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
+000057d0: 616d 733d 7061 7261 6d73 2c20 626f 6479  ams=params, body
+000057e0: 3d62 6f64 7929 0a0a 2020 2020 6465 6620  =body)..    def 
+000057f0: 6162 6f72 745f 7275 6e28 7365 6c66 2c20  abort_run(self, 
+00005800: 7569 642c 2070 726f 6a65 6374 3d22 222c  uid, project="",
+00005810: 2069 7465 723d 3029 3a0a 2020 2020 2020   iter=0):.      
+00005820: 2020 2222 220a 2020 2020 2020 2020 4162    """.        Ab
+00005830: 6f72 7420 6120 7275 6e6e 696e 6720 7275  ort a running ru
+00005840: 6e20 2d20 7769 6c6c 2072 656d 6f76 6520  n - will remove 
+00005850: 7468 6520 7275 6e27 7320 7275 6e74 696d  the run's runtim
+00005860: 6520 7265 736f 7572 6365 7320 616e 6420  e resources and 
+00005870: 6d61 726b 2069 7473 2073 7461 7465 2061  mark its state a
+00005880: 7320 6162 6f72 7465 640a 2020 2020 2020  s aborted.      
+00005890: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+000058a0: 6c66 2e75 7064 6174 655f 7275 6e28 0a20  lf.update_run(. 
+000058b0: 2020 2020 2020 2020 2020 207b 2273 7461             {"sta
+000058c0: 7475 732e 7374 6174 6522 3a20 6d6c 7275  tus.state": mlru
+000058d0: 6e2e 7275 6e74 696d 6573 2e63 6f6e 7374  n.runtimes.const
+000058e0: 616e 7473 2e52 756e 5374 6174 6573 2e61  ants.RunStates.a
+000058f0: 626f 7274 6564 7d2c 0a20 2020 2020 2020  borted},.       
+00005900: 2020 2020 2075 6964 2c0a 2020 2020 2020       uid,.      
+00005910: 2020 2020 2020 7072 6f6a 6563 742c 0a20        project,. 
+00005920: 2020 2020 2020 2020 2020 2069 7465 722c             iter,
+00005930: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00005940: 6465 6620 7265 6164 5f72 756e 2873 656c  def read_run(sel
+00005950: 662c 2075 6964 2c20 7072 6f6a 6563 743d  f, uid, project=
+00005960: 2222 2c20 6974 6572 3d30 293a 0a20 2020  "", iter=0):.   
+00005970: 2020 2020 2022 2222 5265 6164 2074 6865       """Read the
+00005980: 2064 6574 6169 6c73 206f 6620 6120 7374   details of a st
+00005990: 6f72 6564 2072 756e 2066 726f 6d20 7468  ored run from th
+000059a0: 6520 4442 2e0a 0a20 2020 2020 2020 203a  e DB...        :
+000059b0: 7061 7261 6d20 7569 643a 2054 6865 2072  param uid: The r
+000059c0: 756e 2773 2075 6e69 7175 6520 4944 2e0a  un's unique ID..
+000059d0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+000059e0: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
+000059f0: 6e61 6d65 2e0a 2020 2020 2020 2020 3a70  name..        :p
+00005a00: 6172 616d 2069 7465 723a 2049 7465 7261  aram iter: Itera
+00005a10: 7469 6f6e 2077 6974 6869 6e20 6120 7370  tion within a sp
+00005a20: 6563 6966 6963 2065 7865 6375 7469 6f6e  ecific execution
+00005a30: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00005a40: 2020 2020 2020 2070 6174 6820 3d20 7365         path = se
+00005a50: 6c66 2e5f 7061 7468 5f6f 6628 2272 756e  lf._path_of("run
+00005a60: 222c 2070 726f 6a65 6374 2c20 7569 6429  ", project, uid)
+00005a70: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+00005a80: 3d20 7b22 6974 6572 223a 2069 7465 727d  = {"iter": iter}
+00005a90: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+00005aa0: 2066 2267 6574 2072 756e 207b 7072 6f6a   f"get run {proj
+00005ab0: 6563 747d 2f7b 7569 647d 220a 2020 2020  ect}/{uid}".    
+00005ac0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00005ad0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+00005ae0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
+00005af0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+00005b00: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
+00005b10: 6a73 6f6e 2829 5b22 6461 7461 225d 0a0a  json()["data"]..
+00005b20: 2020 2020 6465 6620 6465 6c5f 7275 6e28      def del_run(
+00005b30: 7365 6c66 2c20 7569 642c 2070 726f 6a65  self, uid, proje
+00005b40: 6374 3d22 222c 2069 7465 723d 3029 3a0a  ct="", iter=0):.
+00005b50: 2020 2020 2020 2020 2222 2244 656c 6574          """Delet
+00005b60: 6520 6465 7461 696c 7320 6f66 2061 2073  e details of a s
+00005b70: 7065 6369 6669 6320 7275 6e20 6672 6f6d  pecific run from
+00005b80: 2044 422e 0a0a 2020 2020 2020 2020 3a70   DB...        :p
+00005b90: 6172 616d 2075 6964 3a20 556e 6971 7565  aram uid: Unique
+00005ba0: 2049 4420 666f 7220 7468 6520 7370 6563   ID for the spec
+00005bb0: 6966 6963 2072 756e 2074 6f20 6465 6c65  ific run to dele
+00005bc0: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
+00005bd0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+00005be0: 6563 7420 7468 6174 2074 6865 2072 756e  ect that the run
+00005bf0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
+00005c00: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
+00005c10: 3a20 4974 6572 6174 696f 6e20 7769 7468  : Iteration with
+00005c20: 696e 2061 2073 7065 6369 6669 6320 7461  in a specific ta
+00005c30: 736b 2e0a 2020 2020 2020 2020 2222 220a  sk..        """.
+00005c40: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00005c50: 7365 6c66 2e5f 7061 7468 5f6f 6628 2272  self._path_of("r
+00005c60: 756e 222c 2070 726f 6a65 6374 2c20 7569  un", project, ui
+00005c70: 6429 0a20 2020 2020 2020 2070 6172 616d  d).        param
+00005c80: 7320 3d20 7b22 6974 6572 223a 2069 7465  s = {"iter": ite
+00005c90: 727d 0a20 2020 2020 2020 2065 7272 6f72  r}.        error
+00005ca0: 203d 2066 2264 656c 2072 756e 207b 7072   = f"del run {pr
+00005cb0: 6f6a 6563 747d 2f7b 7569 647d 220a 2020  oject}/{uid}".  
+00005cc0: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+00005cd0: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
+00005ce0: 7468 2c20 6572 726f 722c 2070 6172 616d  th, error, param
+00005cf0: 733d 7061 7261 6d73 290a 0a20 2020 2064  s=params)..    d
+00005d00: 6566 206c 6973 745f 7275 6e73 280a 2020  ef list_runs(.  
+00005d10: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00005d20: 2020 2020 6e61 6d65 3d4e 6f6e 652c 0a20      name=None,. 
+00005d30: 2020 2020 2020 2075 6964 3a20 4f70 7469         uid: Opti
+00005d40: 6f6e 616c 5b55 6e69 6f6e 5b73 7472 2c20  onal[Union[str, 
+00005d50: 4c69 7374 5b73 7472 5d5d 5d20 3d20 4e6f  List[str]]] = No
+00005d60: 6e65 2c0a 2020 2020 2020 2020 7072 6f6a  ne,.        proj
+00005d70: 6563 743d 4e6f 6e65 2c0a 2020 2020 2020  ect=None,.      
+00005d80: 2020 6c61 6265 6c73 3d4e 6f6e 652c 0a20    labels=None,. 
+00005d90: 2020 2020 2020 2073 7461 7465 3d4e 6f6e         state=Non
+00005da0: 652c 0a20 2020 2020 2020 2073 6f72 743d  e,.        sort=
+00005db0: 5472 7565 2c0a 2020 2020 2020 2020 6c61  True,.        la
+00005dc0: 7374 3d30 2c0a 2020 2020 2020 2020 6974  st=0,.        it
+00005dd0: 6572 3d46 616c 7365 2c0a 2020 2020 2020  er=False,.      
+00005de0: 2020 7374 6172 745f 7469 6d65 5f66 726f    start_time_fro
+00005df0: 6d3a 2064 6174 6574 696d 6520 3d20 4e6f  m: datetime = No
+00005e00: 6e65 2c0a 2020 2020 2020 2020 7374 6172  ne,.        star
+00005e10: 745f 7469 6d65 5f74 6f3a 2064 6174 6574  t_time_to: datet
+00005e20: 696d 6520 3d20 4e6f 6e65 2c0a 2020 2020  ime = None,.    
+00005e30: 2020 2020 6c61 7374 5f75 7064 6174 655f      last_update_
+00005e40: 7469 6d65 5f66 726f 6d3a 2064 6174 6574  time_from: datet
+00005e50: 696d 6520 3d20 4e6f 6e65 2c0a 2020 2020  ime = None,.    
+00005e60: 2020 2020 6c61 7374 5f75 7064 6174 655f      last_update_
+00005e70: 7469 6d65 5f74 6f3a 2064 6174 6574 696d  time_to: datetim
+00005e80: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00005e90: 2020 7061 7274 6974 696f 6e5f 6279 3a20    partition_by: 
+00005ea0: 556e 696f 6e5b 6d6c 7275 6e2e 636f 6d6d  Union[mlrun.comm
+00005eb0: 6f6e 2e73 6368 656d 6173 2e52 756e 5061  on.schemas.RunPa
+00005ec0: 7274 6974 696f 6e42 7946 6965 6c64 2c20  rtitionByField, 
+00005ed0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00005ee0: 2020 2020 2072 6f77 735f 7065 725f 7061       rows_per_pa
+00005ef0: 7274 6974 696f 6e3a 2069 6e74 203d 2031  rtition: int = 1
+00005f00: 2c0a 2020 2020 2020 2020 7061 7274 6974  ,.        partit
+00005f10: 696f 6e5f 736f 7274 5f62 793a 2055 6e69  ion_sort_by: Uni
+00005f20: 6f6e 5b6d 6c72 756e 2e63 6f6d 6d6f 6e2e  on[mlrun.common.
+00005f30: 7363 6865 6d61 732e 536f 7274 4669 656c  schemas.SortFiel
+00005f40: 642c 2073 7472 5d20 3d20 4e6f 6e65 2c0a  d, str] = None,.
+00005f50: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
+00005f60: 6e5f 6f72 6465 723a 2055 6e69 6f6e 5b0a  n_order: Union[.
+00005f70: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
+00005f80: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00005f90: 2e4f 7264 6572 5479 7065 2c20 7374 720a  .OrderType, str.
+00005fa0: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
+00005fb0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00005fc0: 2e4f 7264 6572 5479 7065 2e64 6573 632c  .OrderType.desc,
+00005fd0: 0a20 2020 2020 2020 206d 6178 5f70 6172  .        max_par
+00005fe0: 7469 7469 6f6e 733a 2069 6e74 203d 2030  titions: int = 0
+00005ff0: 2c0a 2020 2020 2020 2020 7769 7468 5f6e  ,.        with_n
+00006000: 6f74 6966 6963 6174 696f 6e73 3a20 626f  otifications: bo
+00006010: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00006020: 2920 2d3e 2052 756e 4c69 7374 3a0a 2020  ) -> RunList:.  
+00006030: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
+00006040: 6520 6120 6c69 7374 206f 6620 7275 6e73  e a list of runs
+00006050: 2c20 6669 6c74 6572 6564 2062 7920 7661  , filtered by va
+00006060: 7269 6f75 7320 6f70 7469 6f6e 732e 0a20  rious options.. 
+00006070: 2020 2020 2020 2045 7861 6d70 6c65 3a3a         Example::
+00006080: 0a0a 2020 2020 2020 2020 2020 2020 7275  ..            ru
+00006090: 6e73 203d 2064 622e 6c69 7374 5f72 756e  ns = db.list_run
+000060a0: 7328 6e61 6d65 3d27 646f 776e 6c6f 6164  s(name='download
+000060b0: 272c 2070 726f 6a65 6374 3d27 6972 6973  ', project='iris
+000060c0: 272c 206c 6162 656c 733d 276f 776e 6572  ', labels='owner
+000060d0: 3d61 646d 696e 2729 0a20 2020 2020 2020  =admin').       
+000060e0: 2020 2020 2023 2049 6620 7275 6e6e 696e       # If runnin
+000060f0: 6720 696e 204a 7570 7974 6572 2c20 6361  g in Jupyter, ca
+00006100: 6e20 7573 6520 7468 6520 2e73 686f 7728  n use the .show(
+00006110: 2920 6675 6e63 7469 6f6e 2074 6f20 6469  ) function to di
+00006120: 7370 6c61 7920 7468 6520 7265 7375 6c74  splay the result
+00006130: 730a 2020 2020 2020 2020 2020 2020 6462  s.            db
+00006140: 2e6c 6973 745f 7275 6e73 286e 616d 653d  .list_runs(name=
+00006150: 2727 2c20 7072 6f6a 6563 743d 7072 6f6a  '', project=proj
+00006160: 6563 745f 6e61 6d65 292e 7368 6f77 2829  ect_name).show()
+00006170: 0a0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00006180: 6d20 6e61 6d65 3a20 4e61 6d65 206f 6620  m name: Name of 
+00006190: 7468 6520 7275 6e20 746f 2072 6574 7269  the run to retri
+000061a0: 6576 652e 0a20 2020 2020 2020 203a 7061  eve..        :pa
+000061b0: 7261 6d20 7569 643a 2055 6e69 7175 6520  ram uid: Unique 
+000061c0: 4944 206f 6620 7468 6520 7275 6e2c 206f  ID of the run, o
+000061d0: 7220 6120 6c69 7374 206f 6620 7275 6e20  r a list of run 
+000061e0: 5549 4473 2e0a 2020 2020 2020 2020 3a70  UIDs..        :p
+000061f0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+00006200: 6f6a 6563 7420 7468 6174 2074 6865 2072  oject that the r
+00006210: 756e 7320 6265 6c6f 6e67 7320 746f 2e0a  uns belongs to..
+00006220: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+00006230: 6162 656c 733a 204c 6973 7420 7275 6e73  abels: List runs
+00006240: 2074 6861 7420 6861 7665 2061 2073 7065   that have a spe
+00006250: 6369 6669 6320 6c61 6265 6c20 6173 7369  cific label assi
+00006260: 676e 6564 2e20 4375 7272 656e 746c 7920  gned. Currently 
+00006270: 6f6e 6c79 2061 2073 696e 676c 6520 6c61  only a single la
+00006280: 6265 6c20 6669 6c74 6572 2063 616e 2062  bel filter can b
+00006290: 650a 2020 2020 2020 2020 2020 2020 6170  e.            ap
+000062a0: 706c 6965 642c 206f 7468 6572 7769 7365  plied, otherwise
+000062b0: 2072 6573 756c 7420 7769 6c6c 2062 6520   result will be 
+000062c0: 656d 7074 792e 0a20 2020 2020 2020 203a  empty..        :
+000062d0: 7061 7261 6d20 7374 6174 653a 204c 6973  param state: Lis
+000062e0: 7420 6f6e 6c79 2072 756e 7320 7768 6f73  t only runs whos
+000062f0: 6520 7374 6174 6520 6973 2073 7065 6369  e state is speci
+00006300: 6669 6564 2e0a 2020 2020 2020 2020 3a70  fied..        :p
+00006310: 6172 616d 2073 6f72 743a 2057 6865 7468  aram sort: Wheth
+00006320: 6572 2074 6f20 736f 7274 2074 6865 2072  er to sort the r
+00006330: 6573 756c 7420 6163 636f 7264 696e 6720  esult according 
+00006340: 746f 2074 6865 6972 2073 7461 7274 2074  to their start t
+00006350: 696d 652e 204f 7468 6572 7769 7365 2c20  ime. Otherwise, 
+00006360: 7265 7375 6c74 7320 7769 6c6c 2062 650a  results will be.
+00006370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006380: 726e 6564 2062 7920 7468 6569 7220 696e  rned by their in
+00006390: 7465 726e 616c 206f 7264 6572 2069 6e20  ternal order in 
+000063a0: 7468 6520 4442 2028 6f72 6465 7220 7769  the DB (order wi
+000063b0: 6c6c 206e 6f74 2062 6520 6775 6172 616e  ll not be guaran
+000063c0: 7465 6564 292e 0a20 2020 2020 2020 203a  teed)..        :
+000063d0: 7061 7261 6d20 6c61 7374 3a20 4465 7072  param last: Depr
+000063e0: 6563 6174 6564 202d 2063 7572 7265 6e74  ecated - current
+000063f0: 6c79 206e 6f74 2075 7365 642e 0a20 2020  ly not used..   
+00006400: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
+00006410: 3a20 4966 2060 6054 7275 6560 6020 7265  : If ``True`` re
+00006420: 7475 726e 2072 756e 7320 6672 6f6d 2061  turn runs from a
+00006430: 6c6c 2069 7465 7261 7469 6f6e 732e 204f  ll iterations. O
+00006440: 7468 6572 7769 7365 2c20 7265 7475 726e  therwise, return
+00006450: 206f 6e6c 7920 7275 6e73 2077 686f 7365   only runs whose
+00006460: 2060 6069 7465 7260 6020 6973 2030 2e0a   ``iter`` is 0..
+00006470: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00006480: 7461 7274 5f74 696d 655f 6672 6f6d 3a20  tart_time_from: 
+00006490: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
+000064a0: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
+000064b0: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
+000064c0: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
+000064d0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000064e0: 2073 7461 7274 5f74 696d 655f 746f 3a20   start_time_to: 
+000064f0: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
+00006500: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
+00006510: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
+00006520: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
+00006530: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00006540: 206c 6173 745f 7570 6461 7465 5f74 696d   last_update_tim
+00006550: 655f 6672 6f6d 3a20 4669 6c74 6572 2062  e_from: Filter b
+00006560: 7920 7275 6e20 6c61 7374 2075 7064 6174  y run last updat
+00006570: 6520 7469 6d65 2069 6e20 6060 286c 6173  e time in ``(las
+00006580: 745f 7570 6461 7465 5f74 696d 655f 6672  t_update_time_fr
+00006590: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
+000065a0: 6c61 7374 5f75 7064 6174 655f 7469 6d65  last_update_time
+000065b0: 5f74 6f29 6060 2e0a 2020 2020 2020 2020  _to)``..        
+000065c0: 3a70 6172 616d 206c 6173 745f 7570 6461  :param last_upda
+000065d0: 7465 5f74 696d 655f 746f 3a20 4669 6c74  te_time_to: Filt
+000065e0: 6572 2062 7920 7275 6e20 6c61 7374 2075  er by run last u
+000065f0: 7064 6174 6520 7469 6d65 2069 6e20 6060  pdate time in ``
+00006600: 286c 6173 745f 7570 6461 7465 5f74 696d  (last_update_tim
+00006610: 655f 6672 6f6d 2c20 6c61 7374 5f75 7064  e_from, last_upd
+00006620: 6174 655f 7469 6d65 5f74 6f29 6060 2e0a  ate_time_to)``..
+00006630: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00006640: 6172 7469 7469 6f6e 5f62 793a 2046 6965  artition_by: Fie
+00006650: 6c64 2074 6f20 6772 6f75 7020 7265 7375  ld to group resu
+00006660: 6c74 7320 6279 2e20 4f6e 6c79 2061 6c6c  lts by. Only all
+00006670: 6f77 6564 2076 616c 7565 2069 7320 606e  owed value is `n
+00006680: 616d 6560 2e20 5768 656e 2060 7061 7274  ame`. When `part
+00006690: 6974 696f 6e5f 6279 6020 6973 2073 7065  ition_by` is spe
+000066a0: 6369 6669 6564 2c0a 2020 2020 2020 2020  cified,.        
+000066b0: 2020 2020 7468 6520 6070 6172 7469 7469      the `partiti
+000066c0: 6f6e 5f73 6f72 745f 6279 6020 7061 7261  on_sort_by` para
+000066d0: 6d65 7465 7220 6d75 7374 2062 6520 7072  meter must be pr
+000066e0: 6f76 6964 6564 2061 7320 7765 6c6c 2e0a  ovided as well..
+000066f0: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
+00006700: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
+00006710: 6e3a 2048 6f77 206d 616e 7920 746f 7020  n: How many top 
+00006720: 726f 7773 2028 7065 7220 736f 7274 696e  rows (per sortin
+00006730: 6720 6465 6669 6e65 6420 6279 2060 7061  g defined by `pa
+00006740: 7274 6974 696f 6e5f 736f 7274 5f62 7960  rtition_sort_by`
+00006750: 2061 6e64 2060 7061 7274 6974 696f 6e5f   and `partition_
+00006760: 6f72 6465 7260 290a 2020 2020 2020 2020  order`).        
+00006770: 2020 2020 746f 2072 6574 7572 6e20 7065      to return pe
+00006780: 7220 6772 6f75 702e 2044 6566 6175 6c74  r group. Default
+00006790: 2076 616c 7565 2069 7320 312e 0a20 2020   value is 1..   
+000067a0: 2020 2020 203a 7061 7261 6d20 7061 7274       :param part
+000067b0: 6974 696f 6e5f 736f 7274 5f62 793a 2057  ition_sort_by: W
+000067c0: 6861 7420 6669 656c 6420 746f 2073 6f72  hat field to sor
+000067d0: 7420 7468 6520 7265 7375 6c74 7320 6279  t the results by
+000067e0: 2c20 7769 7468 696e 2065 6163 6820 7061  , within each pa
+000067f0: 7274 6974 696f 6e20 6465 6669 6e65 6420  rtition defined 
+00006800: 6279 2060 7061 7274 6974 696f 6e5f 6279  by `partition_by
+00006810: 602e 0a20 2020 2020 2020 2020 2020 2043  `..            C
+00006820: 7572 7265 6e74 6c79 2074 6865 206f 6e6c  urrently the onl
+00006830: 7920 616c 6c6f 7765 6420 7661 6c75 6573  y allowed values
+00006840: 2061 7265 2060 6372 6561 7465 6460 2061   are `created` a
+00006850: 6e64 2060 7570 6461 7465 6460 2e0a 2020  nd `updated`..  
+00006860: 2020 2020 2020 3a70 6172 616d 2070 6172        :param par
+00006870: 7469 7469 6f6e 5f6f 7264 6572 3a20 4f72  tition_order: Or
+00006880: 6465 7220 6f66 2073 6f72 7469 6e67 2077  der of sorting w
+00006890: 6974 6869 6e20 7061 7274 6974 696f 6e73  ithin partitions
+000068a0: 202d 2060 6173 6360 206f 7220 6064 6573   - `asc` or `des
+000068b0: 6360 2e20 4465 6661 756c 7420 6973 2060  c`. Default is `
+000068c0: 6465 7363 602e 0a20 2020 2020 2020 203a  desc`..        :
+000068d0: 7061 7261 6d20 6d61 785f 7061 7274 6974  param max_partit
+000068e0: 696f 6e73 3a20 4d61 7869 6d61 6c20 6e75  ions: Maximal nu
+000068f0: 6d62 6572 206f 6620 7061 7274 6974 696f  mber of partitio
+00006900: 6e73 2074 6f20 696e 636c 7564 6520 696e  ns to include in
+00006910: 2074 6865 2072 6573 756c 742e 2044 6566   the result. Def
+00006920: 6175 6c74 2069 7320 6030 6020 7768 6963  ault is `0` whic
+00006930: 6820 6d65 616e 7320 6e6f 0a20 2020 2020  h means no.     
+00006940: 2020 2020 2020 206c 696d 6974 2e0a 2020         limit..  
+00006950: 2020 2020 2020 3a70 6172 616d 2077 6974        :param wit
+00006960: 685f 6e6f 7469 6669 6361 7469 6f6e 733a  h_notifications:
+00006970: 2052 6574 7572 6e20 7275 6e73 2077 6974   Return runs wit
+00006980: 6820 6e6f 7469 6669 6361 7469 6f6e 732c  h notifications,
+00006990: 2061 6e64 206a 6f69 6e20 7468 656d 2074   and join them t
+000069a0: 6f20 7468 6520 7265 7370 6f6e 7365 2e20  o the response. 
+000069b0: 4465 6661 756c 7420 6973 2060 4661 6c73  Default is `Fals
+000069c0: 6560 2e0a 2020 2020 2020 2020 2222 220a  e`..        """.
+000069d0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+000069e0: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
+000069f0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+00006a00: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
+00006a10: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
+00006a20: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
+00006a30: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
+00006a40: 6964 223a 2075 6964 2c0a 2020 2020 2020  id": uid,.      
+00006a50: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
+00006a60: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
+00006a70: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+00006a80: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
+00006a90: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
+00006aa0: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+00006ab0: 2020 2020 2022 736f 7274 223a 2062 6f6f       "sort": boo
+00006ac0: 6c32 7374 7228 736f 7274 292c 0a20 2020  l2str(sort),.   
+00006ad0: 2020 2020 2020 2020 2022 6974 6572 223a           "iter":
+00006ae0: 2062 6f6f 6c32 7374 7228 6974 6572 292c   bool2str(iter),
+00006af0: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
+00006b00: 6172 745f 7469 6d65 5f66 726f 6d22 3a20  art_time_from": 
+00006b10: 6461 7465 7469 6d65 5f74 6f5f 6973 6f28  datetime_to_iso(
+00006b20: 7374 6172 745f 7469 6d65 5f66 726f 6d29  start_time_from)
+00006b30: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00006b40: 7461 7274 5f74 696d 655f 746f 223a 2064  tart_time_to": d
+00006b50: 6174 6574 696d 655f 746f 5f69 736f 2873  atetime_to_iso(s
+00006b60: 7461 7274 5f74 696d 655f 746f 292c 0a20  tart_time_to),. 
+00006b70: 2020 2020 2020 2020 2020 2022 6c61 7374             "last
+00006b80: 5f75 7064 6174 655f 7469 6d65 5f66 726f  _update_time_fro
+00006b90: 6d22 3a20 6461 7465 7469 6d65 5f74 6f5f  m": datetime_to_
+00006ba0: 6973 6f28 6c61 7374 5f75 7064 6174 655f  iso(last_update_
+00006bb0: 7469 6d65 5f66 726f 6d29 2c0a 2020 2020  time_from),.    
+00006bc0: 2020 2020 2020 2020 226c 6173 745f 7570          "last_up
+00006bd0: 6461 7465 5f74 696d 655f 746f 223a 2064  date_time_to": d
+00006be0: 6174 6574 696d 655f 746f 5f69 736f 286c  atetime_to_iso(l
+00006bf0: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
+00006c00: 746f 292c 0a20 2020 2020 2020 2020 2020  to),.           
+00006c10: 2022 7769 7468 2d6e 6f74 6966 6963 6174   "with-notificat
+00006c20: 696f 6e73 223a 2077 6974 685f 6e6f 7469  ions": with_noti
+00006c30: 6669 6361 7469 6f6e 732c 0a20 2020 2020  fications,.     
+00006c40: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
+00006c50: 2070 6172 7469 7469 6f6e 5f62 793a 0a20   partition_by:. 
+00006c60: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00006c70: 732e 7570 6461 7465 280a 2020 2020 2020  s.update(.      
+00006c80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00006c90: 6765 6e65 7261 7465 5f70 6172 7469 7469  generate_partiti
+00006ca0: 6f6e 5f62 795f 7061 7261 6d73 280a 2020  on_by_params(.  
+00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cc0: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
+00006cd0: 6368 656d 6173 2e52 756e 5061 7274 6974  chemas.RunPartit
+00006ce0: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
+00006cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d00: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
+00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d20: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
+00006d30: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+00006d40: 2020 2020 2020 2020 2020 7061 7274 6974            partit
+00006d50: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
+00006d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d70: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
+00006d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006d90: 2020 2020 2020 6d61 785f 7061 7274 6974        max_partit
+00006da0: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
+00006db0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006dc0: 2020 2020 290a 2020 2020 2020 2020 6572      ).        er
+00006dd0: 726f 7220 3d20 226c 6973 7420 7275 6e73  ror = "list runs
+00006de0: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
+00006df0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00006e00: 4745 5422 2c20 2272 756e 7322 2c20 6572  GET", "runs", er
+00006e10: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
+00006e20: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
+00006e30: 726e 2052 756e 4c69 7374 2872 6573 702e  rn RunList(resp.
+00006e40: 6a73 6f6e 2829 5b22 7275 6e73 225d 290a  json()["runs"]).
+00006e50: 0a20 2020 2064 6566 2064 656c 5f72 756e  .    def del_run
+00006e60: 7328 7365 6c66 2c20 6e61 6d65 3d4e 6f6e  s(self, name=Non
+00006e70: 652c 2070 726f 6a65 6374 3d4e 6f6e 652c  e, project=None,
+00006e80: 206c 6162 656c 733d 4e6f 6e65 2c20 7374   labels=None, st
+00006e90: 6174 653d 4e6f 6e65 2c20 6461 7973 5f61  ate=None, days_a
+00006ea0: 676f 3d30 293a 0a20 2020 2020 2020 2022  go=0):.        "
+00006eb0: 2222 4465 6c65 7465 2061 2067 726f 7570  ""Delete a group
+00006ec0: 206f 6620 7275 6e73 2069 6465 6e74 6966   of runs identif
+00006ed0: 6965 6420 6279 2074 6865 2070 6172 616d  ied by the param
+00006ee0: 6574 6572 7320 6f66 2074 6865 2066 756e  eters of the fun
+00006ef0: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
+00006f00: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
+00006f10: 2020 2020 2020 2064 622e 6465 6c5f 7275         db.del_ru
+00006f20: 6e73 2873 7461 7465 3d27 636f 6d70 6c65  ns(state='comple
+00006f30: 7465 6427 290a 0a20 2020 2020 2020 203a  ted')..        :
+00006f40: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
+00006f50: 206f 6620 7468 6520 7461 736b 2077 6869   of the task whi
+00006f60: 6368 2074 6865 2072 756e 7320 6265 6c6f  ch the runs belo
+00006f70: 6e67 2074 6f2e 0a20 2020 2020 2020 203a  ng to..        :
+00006f80: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
+00006f90: 726f 6a65 6374 2074 6f20 7768 6963 6820  roject to which 
+00006fa0: 7468 6520 7275 6e73 2062 656c 6f6e 672e  the runs belong.
+00006fb0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00006fc0: 6c61 6265 6c73 3a20 4669 6c74 6572 2072  labels: Filter r
+00006fd0: 756e 7320 7468 6174 2061 7265 206c 6162  uns that are lab
+00006fe0: 656c 6564 2075 7369 6e67 2074 6865 7365  eled using these
+00006ff0: 2073 7065 6369 6669 6320 6c61 6265 6c20   specific label 
+00007000: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+00007010: 3a70 6172 616d 2073 7461 7465 3a20 4669  :param state: Fi
+00007020: 6c74 6572 206f 6e6c 7920 7275 6e73 2077  lter only runs w
+00007030: 6869 6368 2061 7265 2069 6e20 7468 6973  hich are in this
+00007040: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
+00007050: 3a70 6172 616d 2064 6179 735f 6167 6f3a  :param days_ago:
+00007060: 2046 696c 7465 7220 7275 6e73 2077 686f   Filter runs who
+00007070: 7365 2073 7461 7274 2074 696d 6520 6973  se start time is
+00007080: 206e 6577 6572 2074 6861 6e20 7468 6973   newer than this
+00007090: 2070 6172 616d 6574 6572 2e0a 2020 2020   parameter..    
+000070a0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+000070b0: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+000070c0: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+000070d0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+000070e0: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
+000070f0: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
+00007100: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
+00007110: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
+00007120: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
+00007130: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+00007140: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
+00007150: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
+00007160: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+00007170: 2020 2020 2022 6461 7973 5f61 676f 223a       "days_ago":
+00007180: 2073 7472 2864 6179 735f 6167 6f29 2c0a   str(days_ago),.
+00007190: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000071a0: 2020 6572 726f 7220 3d20 2264 656c 2072    error = "del r
+000071b0: 756e 7322 0a20 2020 2020 2020 2073 656c  uns".        sel
+000071c0: 662e 6170 695f 6361 6c6c 2822 4445 4c45  f.api_call("DELE
+000071d0: 5445 222c 2022 7275 6e73 222c 2065 7272  TE", "runs", err
+000071e0: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
+000071f0: 7329 0a0a 2020 2020 6465 6620 7374 6f72  s)..    def stor
+00007200: 655f 6172 7469 6661 6374 2873 656c 662c  e_artifact(self,
+00007210: 206b 6579 2c20 6172 7469 6661 6374 2c20   key, artifact, 
+00007220: 7569 642c 2069 7465 723d 4e6f 6e65 2c20  uid, iter=None, 
+00007230: 7461 673d 4e6f 6e65 2c20 7072 6f6a 6563  tag=None, projec
+00007240: 743d 2222 293a 0a20 2020 2020 2020 2022  t=""):.        "
+00007250: 2222 5374 6f72 6520 616e 2061 7274 6966  ""Store an artif
+00007260: 6163 7420 696e 2074 6865 2044 422e 0a0a  act in the DB...
+00007270: 2020 2020 2020 2020 3a70 6172 616d 206b          :param k
+00007280: 6579 3a20 4964 656e 7469 6679 696e 6720  ey: Identifying 
+00007290: 6b65 7920 6f66 2074 6865 2061 7274 6966  key of the artif
+000072a0: 6163 742e 0a20 2020 2020 2020 203a 7061  act..        :pa
+000072b0: 7261 6d20 6172 7469 6661 6374 3a20 5468  ram artifact: Th
+000072c0: 6520 6163 7475 616c 2061 7274 6966 6163  e actual artifac
+000072d0: 7420 746f 2073 746f 7265 2e0a 2020 2020  t to store..    
+000072e0: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
+000072f0: 4120 756e 6971 7565 2049 4420 666f 7220  A unique ID for 
+00007300: 7468 6973 2073 7065 6369 6669 6320 7665  this specific ve
+00007310: 7273 696f 6e20 6f66 2074 6865 2061 7274  rsion of the art
+00007320: 6966 6163 742e 0a20 2020 2020 2020 203a  ifact..        :
+00007330: 7061 7261 6d20 6974 6572 3a20 5468 6520  param iter: The 
+00007340: 7461 736b 2069 7465 7261 7469 6f6e 2077  task iteration w
+00007350: 6869 6368 2067 656e 6572 6174 6564 2074  hich generated t
+00007360: 6869 7320 6172 7469 6661 6374 2e20 4966  his artifact. If
+00007370: 2060 6069 7465 7260 6020 6973 206e 6f74   ``iter`` is not
+00007380: 2060 604e 6f6e 6560 6020 7468 6520 6974   ``None`` the it
+00007390: 6572 6174 696f 6e20 7769 6c6c 0a20 2020  eration will.   
+000073a0: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
+000073b0: 6420 746f 2074 6865 206b 6579 2070 726f  d to the key pro
+000073c0: 7669 6465 6420 746f 2067 656e 6572 6174  vided to generat
+000073d0: 6520 6120 756e 6971 7565 206b 6579 2066  e a unique key f
+000073e0: 6f72 2074 6865 2061 7274 6966 6163 7420  or the artifact 
+000073f0: 6f66 2074 6865 2073 7065 6369 6669 6320  of the specific 
+00007400: 6974 6572 6174 696f 6e2e 0a20 2020 2020  iteration..     
+00007410: 2020 203a 7061 7261 6d20 7461 673a 2054     :param tag: T
+00007420: 6167 206f 6620 7468 6520 6172 7469 6661  ag of the artifa
+00007430: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
+00007440: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+00007450: 6563 7420 7468 6174 2074 6865 2061 7274  ect that the art
+00007460: 6966 6163 7420 6265 6c6f 6e67 7320 746f  ifact belongs to
+00007470: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00007480: 2020 2020 2020 2065 6e64 706f 696e 745f         endpoint_
+00007490: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
+000074a0: 732f 7b70 726f 6a65 6374 7d2f 6172 7469  s/{project}/arti
+000074b0: 6661 6374 732f 7b75 6964 7d2f 7b6b 6579  facts/{uid}/{key
+000074c0: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
+000074d0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+000074e0: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
+000074f0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00007500: 6966 2069 7465 723a 0a20 2020 2020 2020  if iter:.       
+00007510: 2020 2020 2070 6172 616d 735b 2269 7465       params["ite
+00007520: 7222 5d20 3d20 7374 7228 6974 6572 290a  r"] = str(iter).
+00007530: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+00007540: 2066 2273 746f 7265 2061 7274 6966 6163   f"store artifac
+00007550: 7420 7b70 726f 6a65 6374 7d2f 7b75 6964  t {project}/{uid
+00007560: 7d2f 7b6b 6579 7d22 0a0a 2020 2020 2020  }/{key}"..      
+00007570: 2020 626f 6479 203d 205f 6173 5f6a 736f    body = _as_jso
+00007580: 6e28 6172 7469 6661 6374 290a 2020 2020  n(artifact).    
+00007590: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
+000075a0: 6c28 2250 4f53 5422 2c20 656e 6470 6f69  l("POST", endpoi
+000075b0: 6e74 5f70 6174 682c 2065 7272 6f72 2c20  nt_path, error, 
+000075c0: 7061 7261 6d73 3d70 6172 616d 732c 2062  params=params, b
+000075d0: 6f64 793d 626f 6479 290a 0a20 2020 2064  ody=body)..    d
+000075e0: 6566 2072 6561 645f 6172 7469 6661 6374  ef read_artifact
+000075f0: 2873 656c 662c 206b 6579 2c20 7461 673d  (self, key, tag=
+00007600: 4e6f 6e65 2c20 6974 6572 3d4e 6f6e 652c  None, iter=None,
+00007610: 2070 726f 6a65 6374 3d22 2229 3a0a 2020   project=""):.  
+00007620: 2020 2020 2020 2222 2252 6561 6420 616e        """Read an
+00007630: 2061 7274 6966 6163 742c 2069 6465 6e74   artifact, ident
+00007640: 6966 6965 6420 6279 2069 7473 206b 6579  ified by its key
+00007650: 2c20 7461 6720 616e 6420 6974 6572 6174  , tag and iterat
+00007660: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
+00007670: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+00007680: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+00007690: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+000076a0: 2020 2020 2074 6167 203d 2074 6167 206f       tag = tag o
+000076b0: 7220 226c 6174 6573 7422 0a20 2020 2020  r "latest".     
+000076c0: 2020 2065 6e64 706f 696e 745f 7061 7468     endpoint_path
+000076d0: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
+000076e0: 726f 6a65 6374 7d2f 6172 7469 6661 6374  roject}/artifact
+000076f0: 732f 7b6b 6579 7d3f 7461 673d 7b74 6167  s/{key}?tag={tag
+00007700: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
+00007710: 203d 2066 2272 6561 6420 6172 7469 6661   = f"read artifa
+00007720: 6374 207b 7072 6f6a 6563 747d 2f7b 6b65  ct {project}/{ke
+00007730: 797d 220a 2020 2020 2020 2020 2320 6578  y}".        # ex
+00007740: 706c 6963 6974 6c79 2073 6574 2061 7274  plicitly set art
+00007750: 6966 6163 7473 2066 6f72 6d61 7420 746f  ifacts format to
+00007760: 2027 6675 6c6c 2720 7369 6e63 6520 6f6c   'full' since ol
+00007770: 6420 7365 7276 6572 7320 6d61 7920 6465  d servers may de
+00007780: 6661 756c 7420 746f 2027 6c65 6761 6379  fault to 'legacy
+00007790: 270a 2020 2020 2020 2020 7061 7261 6d73  '.        params
+000077a0: 203d 207b 2266 6f72 6d61 7422 3a20 6d6c   = {"format": ml
+000077b0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+000077c0: 6173 2e41 7274 6966 6163 7473 466f 726d  as.ArtifactsForm
+000077d0: 6174 2e66 756c 6c2e 7661 6c75 657d 0a20  at.full.value}. 
+000077e0: 2020 2020 2020 2069 6620 6974 6572 3a0a         if iter:.
+000077f0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00007800: 6d73 5b22 6974 6572 225d 203d 2073 7472  ms["iter"] = str
+00007810: 2869 7465 7229 0a20 2020 2020 2020 2072  (iter).        r
+00007820: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
+00007830: 616c 6c28 2247 4554 222c 2065 6e64 706f  all("GET", endpo
+00007840: 696e 745f 7061 7468 2c20 6572 726f 722c  int_path, error,
+00007850: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
+00007860: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00007870: 6573 702e 6a73 6f6e 2829 5b22 6461 7461  esp.json()["data
+00007880: 225d 0a0a 2020 2020 6465 6620 6465 6c5f  "]..    def del_
+00007890: 6172 7469 6661 6374 2873 656c 662c 206b  artifact(self, k
+000078a0: 6579 2c20 7461 673d 4e6f 6e65 2c20 7072  ey, tag=None, pr
+000078b0: 6f6a 6563 743d 2222 293a 0a20 2020 2020  oject=""):.     
+000078c0: 2020 2022 2222 4465 6c65 7465 2061 6e20     """Delete an 
+000078d0: 6172 7469 6661 6374 2e22 2222 0a0a 2020  artifact."""..  
+000078e0: 2020 2020 2020 656e 6470 6f69 6e74 5f70        endpoint_p
+000078f0: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+00007900: 2f7b 7072 6f6a 6563 747d 2f61 7274 6966  /{project}/artif
+00007910: 6163 7473 2f7b 6b65 797d 220a 2020 2020  acts/{key}".    
+00007920: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
+00007930: 2020 2020 2020 2020 2020 2022 6b65 7922             "key"
+00007940: 3a20 6b65 792c 0a20 2020 2020 2020 2020  : key,.         
+00007950: 2020 2022 7461 6722 3a20 7461 672c 0a20     "tag": tag,. 
+00007960: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00007970: 2065 7272 6f72 203d 2066 2264 656c 2061   error = f"del a
+00007980: 7274 6966 6163 7420 7b70 726f 6a65 6374  rtifact {project
+00007990: 7d2f 7b6b 6579 7d22 0a20 2020 2020 2020  }/{key}".       
+000079a0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+000079b0: 4445 4c45 5445 222c 2065 6e64 706f 696e  DELETE", endpoin
+000079c0: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
+000079d0: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
+000079e0: 2020 2064 6566 206c 6973 745f 6172 7469     def list_arti
+000079f0: 6661 6374 7328 0a20 2020 2020 2020 2073  facts(.        s
+00007a00: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+00007a10: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00007a20: 7072 6f6a 6563 743d 4e6f 6e65 2c0a 2020  project=None,.  
+00007a30: 2020 2020 2020 7461 673d 4e6f 6e65 2c0a        tag=None,.
+00007a40: 2020 2020 2020 2020 6c61 6265 6c73 3a20          labels: 
+00007a50: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b44  Optional[Union[D
+00007a60: 6963 745b 7374 722c 2073 7472 5d2c 204c  ict[str, str], L
+00007a70: 6973 745b 7374 725d 5d5d 203d 204e 6f6e  ist[str]]] = Non
+00007a80: 652c 0a20 2020 2020 2020 2073 696e 6365  e,.        since
+00007a90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2075  =None,.        u
+00007aa0: 6e74 696c 3d4e 6f6e 652c 0a20 2020 2020  ntil=None,.     
+00007ab0: 2020 2069 7465 723a 2069 6e74 203d 204e     iter: int = N
+00007ac0: 6f6e 652c 0a20 2020 2020 2020 2062 6573  one,.        bes
+00007ad0: 745f 6974 6572 6174 696f 6e3a 2062 6f6f  t_iteration: boo
+00007ae0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00007af0: 2020 206b 696e 643a 2073 7472 203d 204e     kind: str = N
+00007b00: 6f6e 652c 0a20 2020 2020 2020 2063 6174  one,.        cat
+00007b10: 6567 6f72 793a 2055 6e69 6f6e 5b73 7472  egory: Union[str
+00007b20: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+00007b30: 6368 656d 6173 2e41 7274 6966 6163 7443  chemas.ArtifactC
+00007b40: 6174 6567 6f72 6965 735d 203d 204e 6f6e  ategories] = Non
+00007b50: 652c 0a20 2020 2029 202d 3e20 4172 7469  e,.    ) -> Arti
+00007b60: 6661 6374 4c69 7374 3a0a 2020 2020 2020  factList:.      
+00007b70: 2020 2222 224c 6973 7420 6172 7469 6661    """List artifa
+00007b80: 6374 7320 6669 6c74 6572 6564 2062 7920  cts filtered by 
+00007b90: 7661 7269 6f75 7320 7061 7261 6d65 7465  various paramete
+00007ba0: 7273 2e0a 0a20 2020 2020 2020 2045 7861  rs...        Exa
+00007bb0: 6d70 6c65 733a 3a0a 0a20 2020 2020 2020  mples::..       
+00007bc0: 2020 2020 2023 2053 686f 7720 6c61 7465       # Show late
+00007bd0: 7374 2076 6572 7369 6f6e 206f 6620 616c  st version of al
+00007be0: 6c20 6172 7469 6661 6374 7320 696e 2070  l artifacts in p
+00007bf0: 726f 6a65 6374 0a20 2020 2020 2020 2020  roject.         
+00007c00: 2020 206c 6174 6573 745f 6172 7469 6661     latest_artifa
+00007c10: 6374 7320 3d20 6462 2e6c 6973 745f 6172  cts = db.list_ar
+00007c20: 7469 6661 6374 7328 2727 2c20 7461 673d  tifacts('', tag=
+00007c30: 276c 6174 6573 7427 2c20 7072 6f6a 6563  'latest', projec
+00007c40: 743d 2769 7269 7327 290a 2020 2020 2020  t='iris').      
+00007c50: 2020 2020 2020 2320 6368 6563 6b20 6469        # check di
+00007c60: 6666 6572 656e 7420 6172 7469 6661 6374  fferent artifact
+00007c70: 2076 6572 7369 6f6e 7320 666f 7220 6120   versions for a 
+00007c80: 7370 6563 6966 6963 2061 7274 6966 6163  specific artifac
+00007c90: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
+00007ca0: 7375 6c74 5f76 6572 7369 6f6e 7320 3d20  sult_versions = 
+00007cb0: 6462 2e6c 6973 745f 6172 7469 6661 6374  db.list_artifact
+00007cc0: 7328 2772 6573 756c 7473 272c 2074 6167  s('results', tag
+00007cd0: 3d27 2a27 2c20 7072 6f6a 6563 743d 2769  ='*', project='i
+00007ce0: 7269 7327 290a 2020 2020 2020 2020 2020  ris').          
+00007cf0: 2020 2320 5368 6f77 2061 7274 6966 6163    # Show artifac
+00007d00: 7473 2077 6974 6820 6c61 6265 6c20 6669  ts with label fi
+00007d10: 6c74 6572 7320 2d20 626f 7468 2075 706c  lters - both upl
+00007d20: 6f61 6465 6420 616e 6420 6f66 2062 696e  oaded and of bin
+00007d30: 6172 7920 7479 7065 0a20 2020 2020 2020  ary type.       
+00007d40: 2020 2020 2072 6573 756c 745f 6c61 6265       result_labe
+00007d50: 6c73 203d 2064 622e 6c69 7374 5f61 7274  ls = db.list_art
+00007d60: 6966 6163 7473 2827 7265 7375 6c74 7327  ifacts('results'
+00007d70: 2c20 7461 673d 272a 272c 2070 726f 6a65  , tag='*', proje
+00007d80: 6374 3d27 6972 6973 272c 206c 6162 656c  ct='iris', label
+00007d90: 733d 5b27 7570 6c6f 6164 6564 272c 2027  s=['uploaded', '
+00007da0: 7479 7065 3d62 696e 6172 7927 5d29 0a0a  type=binary'])..
+00007db0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+00007dc0: 616d 653a 204e 616d 6520 6f66 2061 7274  ame: Name of art
+00007dd0: 6966 6163 7473 2074 6f20 7265 7472 6965  ifacts to retrie
+00007de0: 7665 2e20 4e61 6d65 2069 7320 7573 6564  ve. Name is used
+00007df0: 2061 7320 6120 6c69 6b65 2071 7565 7279   as a like query
+00007e00: 2c20 616e 6420 6973 206e 6f74 2063 6173  , and is not cas
+00007e10: 652d 7365 6e73 6974 6976 652e 2054 6869  e-sensitive. Thi
+00007e20: 7320 6d65 616e 730a 2020 2020 2020 2020  s means.        
+00007e30: 2020 2020 7468 6174 2071 7565 7279 696e      that queryin
+00007e40: 6720 666f 7220 6060 6e61 6d65 6060 206d  g for ``name`` m
+00007e50: 6179 2072 6574 7572 6e20 6172 7469 6661  ay return artifa
+00007e60: 6374 7320 6e61 6d65 6420 6060 6d79 5f4e  cts named ``my_N
+00007e70: 616d 655f 3160 6020 6f72 2060 6073 7572  ame_1`` or ``sur
+00007e80: 6e61 6d65 6060 2e0a 2020 2020 2020 2020  name``..        
+00007e90: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+00007ea0: 5072 6f6a 6563 7420 6e61 6d65 2e0a 2020  Project name..  
+00007eb0: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
+00007ec0: 3a20 5265 7475 726e 2061 7274 6966 6163  : Return artifac
+00007ed0: 7473 2061 7373 6967 6e65 6420 7468 6973  ts assigned this
+00007ee0: 2074 6167 2e0a 2020 2020 2020 2020 3a70   tag..        :p
+00007ef0: 6172 616d 206c 6162 656c 733a 2052 6574  aram labels: Ret
+00007f00: 7572 6e20 6172 7469 6661 6374 7320 7468  urn artifacts th
+00007f10: 6174 2068 6176 6520 7468 6573 6520 6c61  at have these la
+00007f20: 6265 6c73 2e20 4c61 6265 6c73 2063 616e  bels. Labels can
+00007f30: 2065 6974 6865 7220 6265 2061 2064 6963   either be a dic
+00007f40: 7469 6f6e 6172 7920 7b22 6c61 6265 6c22  tionary {"label"
+00007f50: 3a20 2276 616c 7565 227d 206f 720a 2020  : "value"} or.  
+00007f60: 2020 2020 2020 2020 2020 6120 6c69 7374            a list
+00007f70: 206f 6620 226c 6162 656c 3d76 616c 7565   of "label=value
+00007f80: 2220 286d 6174 6368 206c 6162 656c 206b  " (match label k
+00007f90: 6579 2061 6e64 2076 616c 7565 2920 6f72  ey and value) or
+00007fa0: 2022 6c61 6265 6c22 2028 6d61 7463 6820   "label" (match 
+00007fb0: 6a75 7374 206c 6162 656c 206b 6579 2920  just label key) 
+00007fc0: 7374 7269 6e67 732e 0a20 2020 2020 2020  strings..       
+00007fd0: 203a 7061 7261 6d20 7369 6e63 653a 204e   :param since: N
+00007fe0: 6f74 2069 6e20 7573 6520 696e 203a 7079  ot in use in :py
+00007ff0: 3a63 6c61 7373 3a60 4854 5450 5275 6e44  :class:`HTTPRunD
+00008000: 4260 2e0a 2020 2020 2020 2020 3a70 6172  B`..        :par
+00008010: 616d 2075 6e74 696c 3a20 4e6f 7420 696e  am until: Not in
+00008020: 2075 7365 2069 6e20 3a70 793a 636c 6173   use in :py:clas
+00008030: 733a 6048 5454 5052 756e 4442 602e 0a20  s:`HTTPRunDB`.. 
+00008040: 2020 2020 2020 203a 7061 7261 6d20 6974         :param it
+00008050: 6572 3a20 5265 7475 726e 2061 7274 6966  er: Return artif
+00008060: 6163 7473 2066 726f 6d20 6120 7370 6563  acts from a spec
+00008070: 6966 6963 2069 7465 7261 7469 6f6e 2028  ific iteration (
+00008080: 7768 6572 6520 6060 6974 6572 3d30 6060  where ``iter=0``
+00008090: 206d 6561 6e73 2074 6865 2072 6f6f 7420   means the root 
+000080a0: 6974 6572 6174 696f 6e29 2e20 4966 0a20  iteration). If. 
+000080b0: 2020 2020 2020 2020 2020 2060 604e 6f6e             ``Non
+000080c0: 6560 6020 2864 6566 6175 6c74 2920 7265  e`` (default) re
+000080d0: 7475 726e 2061 7274 6966 6163 7473 2066  turn artifacts f
+000080e0: 726f 6d20 616c 6c20 6974 6572 6174 696f  rom all iteratio
+000080f0: 6e73 2e0a 2020 2020 2020 2020 3a70 6172  ns..        :par
+00008100: 616d 2062 6573 745f 6974 6572 6174 696f  am best_iteratio
+00008110: 6e3a 2052 6574 7572 6e73 2074 6865 2061  n: Returns the a
+00008120: 7274 6966 6163 7420 7768 6963 6820 6265  rtifact which be
+00008130: 6c6f 6e67 7320 746f 2074 6865 2062 6573  longs to the bes
+00008140: 7420 6974 6572 6174 696f 6e20 6f66 2061  t iteration of a
+00008150: 2067 6976 656e 2072 756e 2c20 696e 2074   given run, in t
+00008160: 6865 2063 6173 6520 6f66 0a20 2020 2020  he case of.     
+00008170: 2020 2020 2020 2061 7274 6966 6163 7473         artifacts
+00008180: 2067 656e 6572 6174 6564 2066 726f 6d20   generated from 
+00008190: 6120 6879 7065 722d 7061 7261 6d20 7275  a hyper-param ru
+000081a0: 6e2e 2049 6620 6f6e 6c79 2061 2073 696e  n. If only a sin
+000081b0: 676c 6520 6974 6572 6174 696f 6e20 6578  gle iteration ex
+000081c0: 6973 7473 2c20 7769 6c6c 2072 6574 7572  ists, will retur
+000081d0: 6e20 7468 6520 6172 7469 6661 6374 0a20  n the artifact. 
+000081e0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+000081f0: 7468 6174 2069 7465 7261 7469 6f6e 2e20  that iteration. 
+00008200: 4966 2075 7369 6e67 2060 6062 6573 745f  If using ``best_
+00008210: 6974 6572 6060 2c20 7468 6520 6060 6974  iter``, the ``it
+00008220: 6572 6060 2070 6172 616d 6574 6572 206d  er`` parameter m
+00008230: 7573 7420 6e6f 7420 6265 2075 7365 642e  ust not be used.
+00008240: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00008250: 6b69 6e64 3a20 5265 7475 726e 2061 7274  kind: Return art
+00008260: 6966 6163 7473 206f 6620 7468 6520 7265  ifacts of the re
+00008270: 7175 6573 7465 6420 6b69 6e64 2e0a 2020  quested kind..  
+00008280: 2020 2020 2020 3a70 6172 616d 2063 6174        :param cat
+00008290: 6567 6f72 793a 2052 6574 7572 6e20 6172  egory: Return ar
+000082a0: 7469 6661 6374 7320 6f66 2074 6865 2072  tifacts of the r
+000082b0: 6571 7565 7374 6564 2063 6174 6567 6f72  equested categor
+000082c0: 792e 0a20 2020 2020 2020 2022 2222 0a0a  y..        """..
+000082d0: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
+000082e0: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
+000082f0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
+00008300: 6563 740a 0a20 2020 2020 2020 206c 6162  ect..        lab
+00008310: 656c 7320 3d20 6c61 6265 6c73 206f 7220  els = labels or 
+00008320: 5b5d 0a20 2020 2020 2020 2069 6620 6973  [].        if is
+00008330: 696e 7374 616e 6365 286c 6162 656c 732c  instance(labels,
+00008340: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+00008350: 2020 2020 6c61 6265 6c73 203d 205b 6622      labels = [f"
+00008360: 7b6b 6579 7d3d 7b76 616c 7565 7d22 2066  {key}={value}" f
+00008370: 6f72 206b 6579 2c20 7661 6c75 6520 696e  or key, value in
+00008380: 206c 6162 656c 732e 6974 656d 7328 295d   labels.items()]
+00008390: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+000083a0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+000083b0: 2022 6e61 6d65 223a 206e 616d 652c 0a20   "name": name,. 
+000083c0: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
+000083d0: 3a20 7461 672c 0a20 2020 2020 2020 2020  : tag,.         
+000083e0: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
+000083f0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00008400: 2269 7465 7222 3a20 6974 6572 2c0a 2020  "iter": iter,.  
+00008410: 2020 2020 2020 2020 2020 2262 6573 742d            "best-
+00008420: 6974 6572 6174 696f 6e22 3a20 6265 7374  iteration": best
+00008430: 5f69 7465 7261 7469 6f6e 2c0a 2020 2020  _iteration,.    
+00008440: 2020 2020 2020 2020 226b 696e 6422 3a20          "kind": 
+00008450: 6b69 6e64 2c0a 2020 2020 2020 2020 2020  kind,.          
+00008460: 2020 2263 6174 6567 6f72 7922 3a20 6361    "category": ca
+00008470: 7465 676f 7279 2c0a 2020 2020 2020 2020  tegory,.        
+00008480: 2020 2020 2266 6f72 6d61 7422 3a20 6d6c      "format": ml
+00008490: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+000084a0: 6173 2e41 7274 6966 6163 7473 466f 726d  as.ArtifactsForm
+000084b0: 6174 2e66 756c 6c2e 7661 6c75 652c 0a20  at.full.value,. 
+000084c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000084d0: 2065 7272 6f72 203d 2022 6c69 7374 2061   error = "list a
+000084e0: 7274 6966 6163 7473 220a 2020 2020 2020  rtifacts".      
+000084f0: 2020 656e 6470 6f69 6e74 5f70 6174 6820    endpoint_path 
+00008500: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+00008510: 6f6a 6563 747d 2f61 7274 6966 6163 7473  oject}/artifacts
+00008520: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
+00008530: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00008540: 4745 5422 2c20 656e 6470 6f69 6e74 5f70  GET", endpoint_p
+00008550: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
+00008560: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
+00008570: 2020 2076 616c 7565 7320 3d20 4172 7469     values = Arti
+00008580: 6661 6374 4c69 7374 2872 6573 702e 6a73  factList(resp.js
+00008590: 6f6e 2829 5b22 6172 7469 6661 6374 7322  on()["artifacts"
+000085a0: 5d29 0a20 2020 2020 2020 2076 616c 7565  ]).        value
+000085b0: 732e 7461 6720 3d20 7461 670a 2020 2020  s.tag = tag.    
+000085c0: 2020 2020 7265 7475 726e 2076 616c 7565      return value
+000085d0: 730a 0a20 2020 2064 6566 2064 656c 5f61  s..    def del_a
+000085e0: 7274 6966 6163 7473 2873 656c 662c 206e  rtifacts(self, n
+000085f0: 616d 653d 4e6f 6e65 2c20 7072 6f6a 6563  ame=None, projec
+00008600: 743d 4e6f 6e65 2c20 7461 673d 4e6f 6e65  t=None, tag=None
+00008610: 2c20 6c61 6265 6c73 3d4e 6f6e 652c 2064  , labels=None, d
+00008620: 6179 735f 6167 6f3d 3029 3a0a 2020 2020  ays_ago=0):.    
+00008630: 2020 2020 2222 2244 656c 6574 6520 6172      """Delete ar
+00008640: 7469 6661 6374 7320 7265 6665 7265 6e63  tifacts referenc
+00008650: 6564 2062 7920 7468 6520 7061 7261 6d65  ed by the parame
+00008660: 7465 7273 2e0a 0a20 2020 2020 2020 203a  ters...        :
+00008670: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
+00008680: 206f 6620 6172 7469 6661 6374 7320 746f   of artifacts to
+00008690: 2064 656c 6574 652e 204e 6f74 6520 7468   delete. Note th
+000086a0: 6174 2074 6869 7320 6973 2061 206c 696b  at this is a lik
+000086b0: 6520 7175 6572 792c 2061 6e64 2069 7320  e query, and is 
+000086c0: 6361 7365 2d69 6e73 656e 7369 7469 7665  case-insensitive
+000086d0: 2e20 5365 650a 2020 2020 2020 2020 2020  . See.          
+000086e0: 2020 3a70 793a 6675 6e63 3a60 7e6c 6973    :py:func:`~lis
+000086f0: 745f 6172 7469 6661 6374 7360 2066 6f72  t_artifacts` for
+00008700: 206d 6f72 6520 6465 7461 696c 732e 0a20   more details.. 
+00008710: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00008720: 6f6a 6563 743a 2050 726f 6a65 6374 2074  oject: Project t
+00008730: 6861 7420 6172 7469 6661 6374 7320 6265  hat artifacts be
+00008740: 6c6f 6e67 2074 6f2e 0a20 2020 2020 2020  long to..       
+00008750: 203a 7061 7261 6d20 7461 673a 2043 686f   :param tag: Cho
+00008760: 6f73 6520 6172 7469 6661 6374 7320 7768  ose artifacts wh
+00008770: 6f20 6172 6520 6173 7369 676e 6564 2074  o are assigned t
+00008780: 6869 7320 7461 672e 0a20 2020 2020 2020  his tag..       
+00008790: 203a 7061 7261 6d20 6c61 6265 6c73 3a20   :param labels: 
+000087a0: 4368 6f6f 7365 2061 7274 6966 6163 7473  Choose artifacts
+000087b0: 2077 6869 6368 2061 7265 206c 6162 656c   which are label
+000087c0: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
+000087d0: 616d 2064 6179 735f 6167 6f3a 2054 6869  am days_ago: Thi
+000087e0: 7320 7061 7261 6d65 7465 7220 6973 2064  s parameter is d
+000087f0: 6570 7265 6361 7465 6420 616e 6420 6e6f  eprecated and no
+00008800: 7420 7573 6564 2e0a 2020 2020 2020 2020  t used..        
+00008810: 2222 220a 2020 2020 2020 2020 7072 6f6a  """.        proj
+00008820: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+00008830: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+00008840: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+00008850: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
+00008860: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
+00008870: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00008880: 2022 7461 6722 3a20 7461 672c 0a20 2020   "tag": tag,.   
+00008890: 2020 2020 2020 2020 2022 6c61 6265 6c22           "label"
+000088a0: 3a20 6c61 6265 6c73 206f 7220 5b5d 2c0a  : labels or [],.
+000088b0: 2020 2020 2020 2020 2020 2020 2264 6179              "day
+000088c0: 735f 6167 6f22 3a20 7374 7228 6461 7973  s_ago": str(days
+000088d0: 5f61 676f 292c 0a20 2020 2020 2020 207d  _ago),.        }
+000088e0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+000088f0: 2022 6465 6c20 6172 7469 6661 6374 7322   "del artifacts"
+00008900: 0a20 2020 2020 2020 2065 6e64 706f 696e  .        endpoin
+00008910: 745f 7061 7468 203d 2066 2270 726f 6a65  t_path = f"proje
+00008920: 6374 732f 7b70 726f 6a65 6374 7d2f 6172  cts/{project}/ar
+00008930: 7469 6661 6374 7322 0a20 2020 2020 2020  tifacts".       
+00008940: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00008950: 4445 4c45 5445 222c 2065 6e64 706f 696e  DELETE", endpoin
+00008960: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
+00008970: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
+00008980: 2020 2064 6566 206c 6973 745f 6172 7469     def list_arti
+00008990: 6661 6374 5f74 6167 7328 0a20 2020 2020  fact_tags(.     
+000089a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+000089b0: 2070 726f 6a65 6374 3d4e 6f6e 652c 0a20   project=None,. 
+000089c0: 2020 2020 2020 2063 6174 6567 6f72 793a         category:
+000089d0: 2055 6e69 6f6e 5b73 7472 2c20 6d6c 7275   Union[str, mlru
+000089e0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+000089f0: 2e41 7274 6966 6163 7443 6174 6567 6f72  .ArtifactCategor
+00008a00: 6965 735d 203d 204e 6f6e 652c 0a20 2020  ies] = None,.   
+00008a10: 2029 202d 3e20 4c69 7374 5b73 7472 5d3a   ) -> List[str]:
+00008a20: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00008a30: 726e 2061 206c 6973 7420 6f66 2061 6c6c  rn a list of all
+00008a40: 2074 6865 2074 6167 7320 6173 7369 676e   the tags assign
+00008a50: 6564 2074 6f20 6172 7469 6661 6374 7320  ed to artifacts 
+00008a60: 696e 2074 6865 2073 636f 7065 206f 6620  in the scope of 
+00008a70: 7468 6520 6769 7665 6e20 7072 6f6a 6563  the given projec
+00008a80: 742e 2222 220a 0a20 2020 2020 2020 2070  t."""..        p
+00008a90: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
+00008aa0: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+00008ab0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
+00008ac0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+00008ad0: 203d 2066 2246 6169 6c65 6420 6c69 7374   = f"Failed list
+00008ae0: 696e 6720 6172 7469 6661 6374 2074 6167  ing artifact tag
+00008af0: 732e 2070 726f 6a65 6374 3d7b 7072 6f6a  s. project={proj
+00008b00: 6563 747d 220a 2020 2020 2020 2020 7061  ect}".        pa
+00008b10: 7261 6d73 203d 207b 2263 6174 6567 6f72  rams = {"categor
+00008b20: 7922 3a20 6361 7465 676f 7279 7d20 6966  y": category} if
+00008b30: 2063 6174 6567 6f72 7920 656c 7365 207b   category else {
+00008b40: 7d0a 0a20 2020 2020 2020 2072 6573 706f  }..        respo
+00008b50: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+00008b60: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+00008b70: 2022 4745 5422 2c20 6622 7072 6f6a 6563   "GET", f"projec
+00008b80: 7473 2f7b 7072 6f6a 6563 747d 2f61 7274  ts/{project}/art
+00008b90: 6966 6163 742d 7461 6773 222c 2065 7272  ifact-tags", err
+00008ba0: 6f72 5f6d 6573 7361 6765 2c20 7061 7261  or_message, para
+00008bb0: 6d73 3d70 6172 616d 730a 2020 2020 2020  ms=params.      
+00008bc0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+00008bd0: 726e 2072 6573 706f 6e73 652e 6a73 6f6e  rn response.json
+00008be0: 2829 5b22 7461 6773 225d 0a0a 2020 2020  ()["tags"]..    
+00008bf0: 6465 6620 7374 6f72 655f 6675 6e63 7469  def store_functi
+00008c00: 6f6e 280a 2020 2020 2020 2020 7365 6c66  on(.        self
+00008c10: 2c0a 2020 2020 2020 2020 6675 6e63 7469  ,.        functi
+00008c20: 6f6e 3a20 7479 7069 6e67 2e55 6e69 6f6e  on: typing.Union
+00008c30: 5b6d 6c72 756e 2e72 756e 7469 6d65 732e  [mlrun.runtimes.
+00008c40: 4261 7365 5275 6e74 696d 652c 2064 6963  BaseRuntime, dic
+00008c50: 745d 2c0a 2020 2020 2020 2020 6e61 6d65  t],.        name
+00008c60: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+00008c70: 743d 2222 2c0a 2020 2020 2020 2020 7461  t="",.        ta
+00008c80: 673d 4e6f 6e65 2c0a 2020 2020 2020 2020  g=None,.        
+00008c90: 7665 7273 696f 6e65 643d 4661 6c73 652c  versioned=False,
+00008ca0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+00008cb0: 2222 2253 746f 7265 2061 2066 756e 6374  """Store a funct
+00008cc0: 696f 6e20 6f62 6a65 6374 2e20 4675 6e63  ion object. Func
+00008cd0: 7469 6f6e 2069 7320 6964 656e 7469 6669  tion is identifi
+00008ce0: 6564 2062 7920 6974 7320 6e61 6d65 2061  ed by its name a
+00008cf0: 6e64 2074 6167 2c20 616e 6420 6361 6e20  nd tag, and can 
+00008d00: 6265 2076 6572 7369 6f6e 6564 2e22 2222  be versioned."""
+00008d10: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
+00008d20: 6d6c 7275 6e2e 7574 696c 732e 6e6f 726d  mlrun.utils.norm
+00008d30: 616c 697a 655f 6e61 6d65 286e 616d 6529  alize_name(name)
+00008d40: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
+00008d50: 7474 7228 6675 6e63 7469 6f6e 2c20 2274  ttr(function, "t
+00008d60: 6f5f 6469 6374 2229 3a0a 2020 2020 2020  o_dict"):.      
+00008d70: 2020 2020 2020 6675 6e63 7469 6f6e 203d        function =
+00008d80: 2066 756e 6374 696f 6e2e 746f 5f64 6963   function.to_dic
+00008d90: 7428 290a 0a20 2020 2020 2020 2070 6172  t()..        par
+00008da0: 616d 7320 3d20 7b22 7461 6722 3a20 7461  ams = {"tag": ta
+00008db0: 672c 2022 7665 7273 696f 6e65 6422 3a20  g, "versioned": 
+00008dc0: 7665 7273 696f 6e65 647d 0a20 2020 2020  versioned}.     
+00008dd0: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+00008de0: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
+00008df0: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
+00008e00: 2020 2020 2020 2070 6174 6820 3d20 7365         path = se
+00008e10: 6c66 2e5f 7061 7468 5f6f 6628 2266 756e  lf._path_of("fun
+00008e20: 6322 2c20 7072 6f6a 6563 742c 206e 616d  c", project, nam
+00008e30: 6529 0a0a 2020 2020 2020 2020 6572 726f  e)..        erro
+00008e40: 7220 3d20 6622 7374 6f72 6520 6675 6e63  r = f"store func
+00008e50: 7469 6f6e 207b 7072 6f6a 6563 747d 2f7b  tion {project}/{
+00008e60: 6e61 6d65 7d22 0a20 2020 2020 2020 2072  name}".        r
+00008e70: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
+00008e80: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+00008e90: 2022 504f 5354 222c 2070 6174 682c 2065   "POST", path, e
+00008ea0: 7272 6f72 2c20 7061 7261 6d73 3d70 6172  rror, params=par
+00008eb0: 616d 732c 2062 6f64 793d 6469 6374 5f74  ams, body=dict_t
+00008ec0: 6f5f 6a73 6f6e 2866 756e 6374 696f 6e29  o_json(function)
+00008ed0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00008ee0: 2020 2020 2320 6861 7368 206b 6579 206f      # hash key o
+00008ef0: 7074 696f 6e61 6c20 746f 2062 6520 6261  ptional to be ba
+00008f00: 636b 7761 7264 7320 636f 6d70 6174 6962  ckwards compatib
+00008f10: 6c65 2074 6f20 4150 4920 763c 302e 342e  le to API v<0.4.
+00008f20: 3130 2069 6e20 7768 6963 6820 6974 2077  10 in which it w
+00008f30: 6173 6e27 7420 696e 2074 6865 2072 6573  asn't in the res
+00008f40: 706f 6e73 650a 2020 2020 2020 2020 7265  ponse.        re
+00008f50: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
+00008f60: 2e67 6574 2822 6861 7368 5f6b 6579 2229  .get("hash_key")
+00008f70: 0a0a 2020 2020 6465 6620 6765 745f 6675  ..    def get_fu
+00008f80: 6e63 7469 6f6e 2873 656c 662c 206e 616d  nction(self, nam
+00008f90: 652c 2070 726f 6a65 6374 3d22 222c 2074  e, project="", t
+00008fa0: 6167 3d4e 6f6e 652c 2068 6173 685f 6b65  ag=None, hash_ke
+00008fb0: 793d 2222 293a 0a20 2020 2020 2020 2022  y=""):.        "
+00008fc0: 2222 5265 7472 6965 7665 2064 6574 6169  ""Retrieve detai
+00008fd0: 6c73 206f 6620 6120 7370 6563 6966 6963  ls of a specific
+00008fe0: 2066 756e 6374 696f 6e2c 2069 6465 6e74   function, ident
+00008ff0: 6966 6965 6420 6279 2069 7473 206e 616d  ified by its nam
+00009000: 6520 616e 6420 706f 7465 6e74 6961 6c6c  e and potentiall
+00009010: 7920 6120 7461 6720 6f72 2066 756e 6374  y a tag or funct
+00009020: 696f 6e20 6861 7368 2e22 2222 0a0a 2020  ion hash."""..  
+00009030: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+00009040: 2274 6167 223a 2074 6167 2c20 2268 6173  "tag": tag, "has
+00009050: 685f 6b65 7922 3a20 6861 7368 5f6b 6579  h_key": hash_key
+00009060: 7d0a 2020 2020 2020 2020 7072 6f6a 6563  }.        projec
+00009070: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
+00009080: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
+00009090: 6f6a 6563 740a 2020 2020 2020 2020 7061  oject.        pa
+000090a0: 7468 203d 2073 656c 662e 5f70 6174 685f  th = self._path_
+000090b0: 6f66 2822 6675 6e63 222c 2070 726f 6a65  of("func", proje
+000090c0: 6374 2c20 6e61 6d65 290a 2020 2020 2020  ct, name).      
+000090d0: 2020 6572 726f 7220 3d20 6622 6765 7420    error = f"get 
+000090e0: 6675 6e63 7469 6f6e 207b 7072 6f6a 6563  function {projec
+000090f0: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
+00009100: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
+00009110: 7069 5f63 616c 6c28 2247 4554 222c 2070  pi_call("GET", p
+00009120: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
+00009130: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
+00009140: 2020 2072 6574 7572 6e20 7265 7370 2e6a     return resp.j
+00009150: 736f 6e28 295b 2266 756e 6322 5d0a 0a20  son()["func"].. 
+00009160: 2020 2064 6566 2064 656c 6574 655f 6675     def delete_fu
+00009170: 6e63 7469 6f6e 2873 656c 662c 206e 616d  nction(self, nam
+00009180: 653a 2073 7472 2c20 7072 6f6a 6563 743a  e: str, project:
+00009190: 2073 7472 203d 2022 2229 3a0a 2020 2020   str = ""):.    
+000091a0: 2020 2020 2222 2244 656c 6574 6520 6120      """Delete a 
+000091b0: 6675 6e63 7469 6f6e 2062 656c 6f6e 6769  function belongi
+000091c0: 6e67 2074 6f20 6120 7370 6563 6966 6963  ng to a specific
+000091d0: 2070 726f 6a65 6374 2e22 2222 0a0a 2020   project."""..  
+000091e0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
+000091f0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
+00009200: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
+00009210: 740a 2020 2020 2020 2020 7061 7468 203d  t.        path =
+00009220: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+00009230: 6a65 6374 7d2f 6675 6e63 7469 6f6e 732f  ject}/functions/
+00009240: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+00009250: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00009260: 6622 4661 696c 6564 2064 656c 6574 696e  f"Failed deletin
+00009270: 6720 6675 6e63 7469 6f6e 207b 7072 6f6a  g function {proj
+00009280: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
+00009290: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
+000092a0: 6c6c 2822 4445 4c45 5445 222c 2070 6174  ll("DELETE", pat
+000092b0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
+000092c0: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
+000092d0: 6675 6e63 7469 6f6e 7328 7365 6c66 2c20  functions(self, 
+000092e0: 6e61 6d65 3d4e 6f6e 652c 2070 726f 6a65  name=None, proje
+000092f0: 6374 3d4e 6f6e 652c 2074 6167 3d4e 6f6e  ct=None, tag=Non
+00009300: 652c 206c 6162 656c 733d 4e6f 6e65 293a  e, labels=None):
+00009310: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
+00009320: 6965 7665 2061 206c 6973 7420 6f66 2066  ieve a list of f
+00009330: 756e 6374 696f 6e73 2c20 6669 6c74 6572  unctions, filter
+00009340: 6564 2062 7920 7370 6563 6966 6963 2063  ed by specific c
+00009350: 7269 7465 7269 612e 0a0a 2020 2020 2020  riteria...      
+00009360: 2020 3a70 6172 616d 206e 616d 653a 2052    :param name: R
+00009370: 6574 7572 6e20 6f6e 6c79 2066 756e 6374  eturn only funct
+00009380: 696f 6e73 2077 6974 6820 6120 7370 6563  ions with a spec
+00009390: 6966 6963 206e 616d 652e 0a20 2020 2020  ific name..     
+000093a0: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+000093b0: 743a 2052 6574 7572 6e20 6675 6e63 7469  t: Return functi
+000093c0: 6f6e 7320 6265 6c6f 6e67 696e 6720 746f  ons belonging to
+000093d0: 2074 6869 7320 7072 6f6a 6563 742e 2049   this project. I
+000093e0: 6620 6e6f 7420 7370 6563 6966 6965 642c  f not specified,
+000093f0: 2074 6865 2064 6566 6175 6c74 2070 726f   the default pro
+00009400: 6a65 6374 2069 7320 7573 6564 2e0a 2020  ject is used..  
+00009410: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
+00009420: 3a20 5265 7475 726e 2066 756e 6374 696f  : Return functio
+00009430: 6e20 7665 7273 696f 6e73 2077 6974 6820  n versions with 
+00009440: 7370 6563 6966 6963 2074 6167 732e 0a20  specific tags.. 
+00009450: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
+00009460: 6265 6c73 3a20 5265 7475 726e 2066 756e  bels: Return fun
+00009470: 6374 696f 6e73 2074 6861 7420 6861 7665  ctions that have
+00009480: 2073 7065 6369 6669 6320 6c61 6265 6c73   specific labels
+00009490: 2061 7373 6967 6e65 6420 746f 2074 6865   assigned to the
+000094a0: 6d2e 0a20 2020 2020 2020 203a 7265 7475  m..        :retu
+000094b0: 726e 733a 204c 6973 7420 6f66 2066 756e  rns: List of fun
+000094c0: 6374 696f 6e20 6f62 6a65 6374 7320 2861  ction objects (a
+000094d0: 7320 6469 6374 696f 6e61 7279 292e 0a20  s dictionary).. 
+000094e0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000094f0: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
+00009500: 2020 2020 2020 2020 2020 2022 7072 6f6a             "proj
+00009510: 6563 7422 3a20 7072 6f6a 6563 7420 6f72  ect": project or
+00009520: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+00009530: 7072 6f6a 6563 742c 0a20 2020 2020 2020  project,.       
+00009540: 2020 2020 2022 6e61 6d65 223a 206e 616d       "name": nam
+00009550: 652c 0a20 2020 2020 2020 2020 2020 2022  e,.            "
+00009560: 7461 6722 3a20 7461 672c 0a20 2020 2020  tag": tag,.     
+00009570: 2020 2020 2020 2022 6c61 6265 6c22 3a20         "label": 
+00009580: 6c61 6265 6c73 206f 7220 5b5d 2c0a 2020  labels or [],.  
+00009590: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+000095a0: 6572 726f 7220 3d20 226c 6973 7420 6675  error = "list fu
+000095b0: 6e63 7469 6f6e 7322 0a20 2020 2020 2020  nctions".       
+000095c0: 2072 6573 7020 3d20 7365 6c66 2e61 7069   resp = self.api
+000095d0: 5f63 616c 6c28 2247 4554 222c 2022 6675  _call("GET", "fu
+000095e0: 6e63 7322 2c20 6572 726f 722c 2070 6172  ncs", error, par
+000095f0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+00009600: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
+00009610: 6a73 6f6e 2829 5b22 6675 6e63 7322 5d0a  json()["funcs"].
+00009620: 0a20 2020 2064 6566 206c 6973 745f 7275  .    def list_ru
+00009630: 6e74 696d 655f 7265 736f 7572 6365 7328  ntime_resources(
+00009640: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00009650: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+00009660: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00009670: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
+00009680: 6265 6c5f 7365 6c65 6374 6f72 3a20 4f70  bel_selector: Op
+00009690: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+000096a0: 6e65 2c0a 2020 2020 2020 2020 6b69 6e64  ne,.        kind
+000096b0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+000096c0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000096d0: 6f62 6a65 6374 5f69 643a 204f 7074 696f  object_id: Optio
+000096e0: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+000096f0: 0a20 2020 2020 2020 2067 726f 7570 5f62  .        group_b
+00009700: 793a 204f 7074 696f 6e61 6c5b 0a20 2020  y: Optional[.   
+00009710: 2020 2020 2020 2020 206d 6c72 756e 2e63           mlrun.c
+00009720: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4c69  ommon.schemas.Li
+00009730: 7374 5275 6e74 696d 6552 6573 6f75 7263  stRuntimeResourc
+00009740: 6573 4772 6f75 7042 7946 6965 6c64 0a20  esGroupByField. 
+00009750: 2020 2020 2020 205d 203d 204e 6f6e 652c         ] = None,
+00009760: 0a20 2020 2029 202d 3e20 556e 696f 6e5b  .    ) -> Union[
+00009770: 0a20 2020 2020 2020 206d 6c72 756e 2e63  .        mlrun.c
+00009780: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5275  ommon.schemas.Ru
+00009790: 6e74 696d 6552 6573 6f75 7263 6573 4f75  ntimeResourcesOu
+000097a0: 7470 7574 2c0a 2020 2020 2020 2020 6d6c  tput,.        ml
+000097b0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+000097c0: 6173 2e47 726f 7570 6564 4279 4a6f 6252  as.GroupedByJobR
+000097d0: 756e 7469 6d65 5265 736f 7572 6365 734f  untimeResourcesO
+000097e0: 7574 7075 742c 0a20 2020 2020 2020 206d  utput,.        m
+000097f0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00009800: 6d61 732e 4772 6f75 7065 6442 7950 726f  mas.GroupedByPro
+00009810: 6a65 6374 5275 6e74 696d 6552 6573 6f75  jectRuntimeResou
+00009820: 7263 6573 4f75 7470 7574 2c0a 2020 2020  rcesOutput,.    
+00009830: 5d3a 0a20 2020 2020 2020 2022 2222 4c69  ]:.        """Li
+00009840: 7374 2063 7572 7265 6e74 2072 756e 7469  st current runti
+00009850: 6d65 2072 6573 6f75 7263 6573 2c20 7768  me resources, wh
+00009860: 6963 6820 6172 6520 7573 7561 6c6c 7920  ich are usually 
+00009870: 2862 7574 206e 6f74 206c 696d 6974 6564  (but not limited
+00009880: 2074 6f29 204b 7562 6572 6e65 7465 7320   to) Kubernetes 
+00009890: 706f 6473 206f 7220 4352 4473 2e0a 2020  pods or CRDs..  
+000098a0: 2020 2020 2020 4675 6e63 7469 6f6e 2061        Function a
+000098b0: 7070 6c69 6573 2066 6f72 2072 756e 7320  pplies for runs 
+000098c0: 6f66 2074 7970 6520 605b 2764 6173 6b27  of type `['dask'
+000098d0: 2c20 276a 6f62 272c 2027 7370 6172 6b27  , 'job', 'spark'
+000098e0: 2c20 2772 656d 6f74 652d 7370 6172 6b27  , 'remote-spark'
+000098f0: 2c20 276d 7069 6a6f 6227 5d60 2c20 616e  , 'mpijob']`, an
+00009900: 6420 7769 6c6c 2072 6574 7572 6e20 7065  d will return pe
+00009910: 720a 2020 2020 2020 2020 7275 6e74 696d  r.        runtim
+00009920: 6520 6b69 6e64 2061 206c 6973 7420 6f66  e kind a list of
+00009930: 2074 6865 2072 756e 7469 6d65 2072 6573   the runtime res
+00009940: 6f75 7263 6573 2028 7768 6963 6820 6d61  ources (which ma
+00009950: 7920 6861 7665 2061 6c72 6561 6479 2063  y have already c
+00009960: 6f6d 706c 6574 6564 2074 6865 6972 2065  ompleted their e
+00009970: 7865 6375 7469 6f6e 292e 0a0a 2020 2020  xecution)...    
+00009980: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+00009990: 6374 3a20 4765 7420 6f6e 6c79 2072 756e  ct: Get only run
+000099a0: 7469 6d65 2072 6573 6f75 7263 6573 206f  time resources o
+000099b0: 6620 6120 7370 6563 6966 6963 2070 726f  f a specific pro
+000099c0: 6a65 6374 2c20 6279 2064 6566 6175 6c74  ject, by default
+000099d0: 204e 6f6e 652c 2077 6869 6368 2077 696c   None, which wil
+000099e0: 6c20 7265 7475 726e 206f 6e6c 7920 7468  l return only th
+000099f0: 650a 2020 2020 2020 2020 2020 2020 7072  e.            pr
+00009a00: 6f6a 6563 7473 2079 6f75 2772 6520 6175  ojects you're au
+00009a10: 7468 6f72 697a 6564 2074 6f20 7365 652e  thorized to see.
+00009a20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00009a30: 6c61 6265 6c5f 7365 6c65 6374 6f72 3a20  label_selector: 
+00009a40: 4120 6c61 6265 6c20 6669 6c74 6572 2074  A label filter t
+00009a50: 6861 7420 7769 6c6c 2062 6520 7061 7373  hat will be pass
+00009a60: 6564 2074 6f20 4b75 6265 726e 6574 6573  ed to Kubernetes
+00009a70: 2066 6f72 2066 696c 7465 7269 6e67 2074   for filtering t
+00009a80: 6865 2072 6573 756c 7473 2061 6363 6f72  he results accor
+00009a90: 6469 6e67 0a20 2020 2020 2020 2020 2020  ding.           
+00009aa0: 2074 6f20 7468 6569 7220 6c61 6265 6c73   to their labels
+00009ab0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00009ac0: 206b 696e 643a 2054 6865 206b 696e 6420   kind: The kind 
+00009ad0: 6f66 2072 756e 7469 6d65 2074 6f20 7175  of runtime to qu
+00009ae0: 6572 792e 204d 6179 2062 6520 6f6e 6520  ery. May be one 
+00009af0: 6f66 2060 5b27 6461 736b 272c 2027 6a6f  of `['dask', 'jo
+00009b00: 6227 2c20 2773 7061 726b 272c 2027 7265  b', 'spark', 're
+00009b10: 6d6f 7465 2d73 7061 726b 272c 2027 6d70  mote-spark', 'mp
+00009b20: 696a 6f62 275d 600a 2020 2020 2020 2020  ijob']`.        
+00009b30: 3a70 6172 616d 206f 626a 6563 745f 6964  :param object_id
+00009b40: 3a20 5468 6520 6964 656e 7469 6669 6572  : The identifier
+00009b50: 206f 6620 7468 6520 6d6c 7275 6e20 6f62   of the mlrun ob
+00009b60: 6a65 6374 2074 6f20 7175 6572 7920 6974  ject to query it
+00009b70: 7320 7275 6e74 696d 6520 7265 736f 7572  s runtime resour
+00009b80: 6365 732e 2066 6f72 206d 6f73 7420 6675  ces. for most fu
+00009b90: 6e63 7469 6f6e 2072 756e 7469 6d65 732c  nction runtimes,
+00009ba0: 0a20 2020 2020 2020 2020 2020 2072 756e  .            run
+00009bb0: 7469 6d65 2072 6573 6f75 7263 6573 2061  time resources a
+00009bc0: 7265 2070 6572 2052 756e 2c20 666f 7220  re per Run, for 
+00009bd0: 7768 6963 6820 7468 6520 6964 656e 7469  which the identi
+00009be0: 6669 6572 2069 7320 7468 6520 5275 6e27  fier is the Run'
+00009bf0: 7320 5549 442e 2046 6f72 2064 6173 6b20  s UID. For dask 
+00009c00: 7275 6e74 696d 652c 2074 6865 2072 756e  runtime, the run
+00009c10: 7469 6d65 0a20 2020 2020 2020 2020 2020  time.           
+00009c20: 2072 6573 6f75 7263 6573 2061 7265 2070   resources are p
+00009c30: 6572 2046 756e 6374 696f 6e2c 2066 6f72  er Function, for
+00009c40: 2077 6869 6368 2074 6865 2069 6465 6e74   which the ident
+00009c50: 6966 6965 7220 6973 2074 6865 2046 756e  ifier is the Fun
+00009c60: 6374 696f 6e27 7320 6e61 6d65 2e0a 2020  ction's name..  
+00009c70: 2020 2020 2020 3a70 6172 616d 2067 726f        :param gro
+00009c80: 7570 5f62 793a 204f 626a 6563 7420 746f  up_by: Object to
+00009c90: 2067 726f 7570 2072 6573 756c 7473 2062   group results b
+00009ca0: 792e 2041 6c6c 6f77 6564 2076 616c 7565  y. Allowed value
+00009cb0: 7320 6172 6520 606a 6f62 6020 616e 6420  s are `job` and 
+00009cc0: 6070 726f 6a65 6374 602e 0a20 2020 2020  `project`..     
+00009cd0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+00009ce0: 6172 616d 7320 3d20 7b0a 2020 2020 2020  arams = {.      
+00009cf0: 2020 2020 2020 226c 6162 656c 5f73 656c        "label_sel
+00009d00: 6563 746f 7222 3a20 6c61 6265 6c5f 7365  ector": label_se
+00009d10: 6c65 6374 6f72 2c0a 2020 2020 2020 2020  lector,.        
+00009d20: 2020 2020 2267 726f 7570 2d62 7922 3a20      "group-by": 
+00009d30: 6772 6f75 705f 6279 2c0a 2020 2020 2020  group_by,.      
+00009d40: 2020 2020 2020 226b 696e 6422 3a20 6b69        "kind": ki
+00009d50: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
+00009d60: 226f 626a 6563 742d 6964 223a 206f 626a  "object-id": obj
+00009d70: 6563 745f 6964 2c0a 2020 2020 2020 2020  ect_id,.        
+00009d80: 7d0a 2020 2020 2020 2020 7072 6f6a 6563  }.        projec
+00009d90: 745f 7061 7468 203d 2070 726f 6a65 6374  t_path = project
+00009da0: 2069 6620 7072 6f6a 6563 7420 656c 7365   if project else
+00009db0: 2022 2a22 0a20 2020 2020 2020 2065 7272   "*".        err
+00009dc0: 6f72 203d 2022 4661 696c 6564 206c 6973  or = "Failed lis
+00009dd0: 7469 6e67 2072 756e 7469 6d65 2072 6573  ting runtime res
+00009de0: 6f75 7263 6573 220a 2020 2020 2020 2020  ources".        
+00009df0: 7265 7370 6f6e 7365 203d 2073 656c 662e  response = self.
+00009e00: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+00009e10: 2020 2020 2020 2247 4554 222c 2066 2270        "GET", f"p
+00009e20: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+00009e30: 5f70 6174 687d 2f72 756e 7469 6d65 2d72  _path}/runtime-r
+00009e40: 6573 6f75 7263 6573 222c 2065 7272 6f72  esources", error
+00009e50: 2c20 7061 7261 6d73 3d70 6172 616d 730a  , params=params.
+00009e60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00009e70: 2020 6966 2067 726f 7570 5f62 7920 6973    if group_by is
+00009e80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00009e90: 2020 2073 7472 7563 7475 7265 645f 6c69     structured_li
+00009ea0: 7374 203d 205b 0a20 2020 2020 2020 2020  st = [.         
+00009eb0: 2020 2020 2020 206d 6c72 756e 2e63 6f6d         mlrun.com
+00009ec0: 6d6f 6e2e 7363 6865 6d61 732e 4b69 6e64  mon.schemas.Kind
+00009ed0: 5275 6e74 696d 6552 6573 6f75 7263 6573  RuntimeResources
+00009ee0: 282a 2a6b 696e 645f 7275 6e74 696d 655f  (**kind_runtime_
+00009ef0: 7265 736f 7572 6365 7329 0a20 2020 2020  resources).     
+00009f00: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00009f10: 696e 645f 7275 6e74 696d 655f 7265 736f  ind_runtime_reso
+00009f20: 7572 6365 7320 696e 2072 6573 706f 6e73  urces in respons
+00009f30: 652e 6a73 6f6e 2829 0a20 2020 2020 2020  e.json().       
+00009f40: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+00009f50: 2020 2072 6574 7572 6e20 7374 7275 6374     return struct
+00009f60: 7572 6564 5f6c 6973 740a 2020 2020 2020  ured_list.      
+00009f70: 2020 656c 6966 2067 726f 7570 5f62 7920    elif group_by 
+00009f80: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
+00009f90: 7363 6865 6d61 732e 4c69 7374 5275 6e74  schemas.ListRunt
+00009fa0: 696d 6552 6573 6f75 7263 6573 4772 6f75  imeResourcesGrou
+00009fb0: 7042 7946 6965 6c64 2e6a 6f62 3a0a 2020  pByField.job:.  
+00009fc0: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+00009fd0: 7572 6564 5f64 6963 7420 3d20 7b7d 0a20  ured_dict = {}. 
+00009fe0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+00009ff0: 726f 6a65 6374 2c20 6a6f 625f 7275 6e74  roject, job_runt
+0000a000: 696d 655f 7265 736f 7572 6365 735f 6d61  ime_resources_ma
+0000a010: 7020 696e 2072 6573 706f 6e73 652e 6a73  p in response.js
+0000a020: 6f6e 2829 2e69 7465 6d73 2829 3a0a 2020  on().items():.  
+0000a030: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000a040: 7220 6a6f 625f 6964 2c20 7275 6e74 696d  r job_id, runtim
+0000a050: 655f 7265 736f 7572 6365 7320 696e 206a  e_resources in j
+0000a060: 6f62 5f72 756e 7469 6d65 5f72 6573 6f75  ob_runtime_resou
+0000a070: 7263 6573 5f6d 6170 2e69 7465 6d73 2829  rces_map.items()
+0000a080: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a090: 2020 2020 2020 7374 7275 6374 7572 6564        structured
+0000a0a0: 5f64 6963 742e 7365 7464 6566 6175 6c74  _dict.setdefault
+0000a0b0: 2870 726f 6a65 6374 2c20 7b7d 295b 0a20  (project, {})[. 
+0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0d0: 2020 2020 2020 206a 6f62 5f69 640a 2020         job_id.  
+0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0f0: 2020 5d20 3d20 6d6c 7275 6e2e 636f 6d6d    ] = mlrun.comm
+0000a100: 6f6e 2e73 6368 656d 6173 2e52 756e 7469  on.schemas.Runti
+0000a110: 6d65 5265 736f 7572 6365 7328 2a2a 7275  meResources(**ru
+0000a120: 6e74 696d 655f 7265 736f 7572 6365 7329  ntime_resources)
+0000a130: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a140: 7572 6e20 7374 7275 6374 7572 6564 5f64  urn structured_d
+0000a150: 6963 740a 2020 2020 2020 2020 656c 6966  ict.        elif
+0000a160: 2067 726f 7570 5f62 7920 3d3d 206d 6c72   group_by == mlr
+0000a170: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0000a180: 732e 4c69 7374 5275 6e74 696d 6552 6573  s.ListRuntimeRes
+0000a190: 6f75 7263 6573 4772 6f75 7042 7946 6965  ourcesGroupByFie
+0000a1a0: 6c64 2e70 726f 6a65 6374 3a0a 2020 2020  ld.project:.    
+0000a1b0: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+0000a1c0: 6564 5f64 6963 7420 3d20 7b7d 0a20 2020  ed_dict = {}.   
+0000a1d0: 2020 2020 2020 2020 2066 6f72 2070 726f           for pro
+0000a1e0: 6a65 6374 2c20 6b69 6e64 5f72 756e 7469  ject, kind_runti
+0000a1f0: 6d65 5f72 6573 6f75 7263 6573 5f6d 6170  me_resources_map
+0000a200: 2069 6e20 7265 7370 6f6e 7365 2e6a 736f   in response.jso
+0000a210: 6e28 292e 6974 656d 7328 293a 0a20 2020  n().items():.   
+0000a220: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000a230: 206b 696e 642c 2072 756e 7469 6d65 5f72   kind, runtime_r
+0000a240: 6573 6f75 7263 6573 2069 6e20 6b69 6e64  esources in kind
+0000a250: 5f72 756e 7469 6d65 5f72 6573 6f75 7263  _runtime_resourc
+0000a260: 6573 5f6d 6170 2e69 7465 6d73 2829 3a0a  es_map.items():.
+0000a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a280: 2020 2020 7374 7275 6374 7572 6564 5f64      structured_d
+0000a290: 6963 742e 7365 7464 6566 6175 6c74 2870  ict.setdefault(p
+0000a2a0: 726f 6a65 6374 2c20 7b7d 295b 0a20 2020  roject, {})[.   
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2c0: 2020 2020 206b 696e 640a 2020 2020 2020       kind.      
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 5d20                ] 
+0000a2e0: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0000a2f0: 6368 656d 6173 2e52 756e 7469 6d65 5265  chemas.RuntimeRe
+0000a300: 736f 7572 6365 7328 2a2a 7275 6e74 696d  sources(**runtim
+0000a310: 655f 7265 736f 7572 6365 7329 0a20 2020  e_resources).   
+0000a320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000a330: 7374 7275 6374 7572 6564 5f64 6963 740a  structured_dict.
+0000a340: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a350: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000a360: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+0000a370: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000a380: 2020 2020 2066 2250 726f 7669 6465 6420       f"Provided 
+0000a390: 6772 6f75 7020 6279 2066 6965 6c64 2069  group by field i
+0000a3a0: 7320 6e6f 7420 7375 7070 6f72 7465 642e  s not supported.
+0000a3b0: 2067 726f 7570 5f62 793d 7b67 726f 7570   group_by={group
+0000a3c0: 5f62 797d 220a 2020 2020 2020 2020 2020  _by}".          
+0000a3d0: 2020 290a 0a20 2020 2064 6566 2064 656c    )..    def del
+0000a3e0: 6574 655f 7275 6e74 696d 655f 7265 736f  ete_runtime_reso
+0000a3f0: 7572 6365 7328 0a20 2020 2020 2020 2073  urces(.        s
+0000a400: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
+0000a410: 6a65 6374 3a20 4f70 7469 6f6e 616c 5b73  ject: Optional[s
+0000a420: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+0000a430: 2020 2020 6c61 6265 6c5f 7365 6c65 6374      label_select
+0000a440: 6f72 3a20 4f70 7469 6f6e 616c 5b73 7472  or: Optional[str
+0000a450: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0000a460: 2020 6b69 6e64 3a20 4f70 7469 6f6e 616c    kind: Optional
+0000a470: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0000a480: 2020 2020 2020 6f62 6a65 6374 5f69 643a        object_id:
+0000a490: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+0000a4a0: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+0000a4b0: 6f72 6365 3a20 626f 6f6c 203d 2046 616c  orce: bool = Fal
+0000a4c0: 7365 2c0a 2020 2020 2020 2020 6772 6163  se,.        grac
+0000a4d0: 655f 7065 7269 6f64 3a20 696e 7420 3d20  e_period: int = 
+0000a4e0: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 206d  None,.    ) -> m
+0000a4f0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0000a500: 6d61 732e 4772 6f75 7065 6442 7950 726f  mas.GroupedByPro
+0000a510: 6a65 6374 5275 6e74 696d 6552 6573 6f75  jectRuntimeResou
+0000a520: 7263 6573 4f75 7470 7574 3a0a 2020 2020  rcesOutput:.    
+0000a530: 2020 2020 2222 2244 656c 6574 6520 616c      """Delete al
+0000a540: 6c20 7275 6e74 696d 6520 7265 736f 7572  l runtime resour
+0000a550: 6365 7320 7768 6963 6820 6172 6520 696e  ces which are in
+0000a560: 2074 6572 6d69 6e61 6c20 7374 6174 652e   terminal state.
+0000a570: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000a580: 2070 726f 6a65 6374 3a20 4465 6c65 7465   project: Delete
+0000a590: 206f 6e6c 7920 7275 6e74 696d 6520 7265   only runtime re
+0000a5a0: 736f 7572 6365 7320 6f66 2061 2073 7065  sources of a spe
+0000a5b0: 6369 6669 6320 7072 6f6a 6563 742c 2062  cific project, b
+0000a5c0: 7920 6465 6661 756c 7420 4e6f 6e65 2c20  y default None, 
+0000a5d0: 7768 6963 6820 7769 6c6c 2064 656c 6574  which will delet
+0000a5e0: 6520 6f6e 6c79 0a20 2020 2020 2020 2020  e only.         
+0000a5f0: 2020 2066 726f 6d20 7468 6520 7072 6f6a     from the proj
+0000a600: 6563 7473 2079 6f75 2772 6520 6175 7468  ects you're auth
+0000a610: 6f72 697a 6564 2074 6f20 6465 6c65 7465  orized to delete
+0000a620: 2066 726f 6d2e 0a20 2020 2020 2020 203a   from..        :
+0000a630: 7061 7261 6d20 6c61 6265 6c5f 7365 6c65  param label_sele
+0000a640: 6374 6f72 3a20 4465 6c65 7465 206f 6e6c  ctor: Delete onl
+0000a650: 7920 7275 6e74 696d 6520 7265 736f 7572  y runtime resour
+0000a660: 6365 7320 6d61 7463 6869 6e67 2074 6865  ces matching the
+0000a670: 206c 6162 656c 2073 656c 6563 746f 722e   label selector.
+0000a680: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000a690: 6b69 6e64 3a20 5468 6520 6b69 6e64 206f  kind: The kind o
+0000a6a0: 6620 7275 6e74 696d 6520 746f 2064 656c  f runtime to del
+0000a6b0: 6574 652e 204d 6179 2062 6520 6f6e 6520  ete. May be one 
+0000a6c0: 6f66 2060 5b27 6461 736b 272c 2027 6a6f  of `['dask', 'jo
+0000a6d0: 6227 2c20 2773 7061 726b 272c 2027 7265  b', 'spark', 're
+0000a6e0: 6d6f 7465 2d73 7061 726b 272c 2027 6d70  mote-spark', 'mp
+0000a6f0: 696a 6f62 275d 600a 2020 2020 2020 2020  ijob']`.        
+0000a700: 3a70 6172 616d 206f 626a 6563 745f 6964  :param object_id
+0000a710: 3a20 5468 6520 6964 656e 7469 6669 6572  : The identifier
+0000a720: 206f 6620 7468 6520 6d6c 7275 6e20 6f62   of the mlrun ob
+0000a730: 6a65 6374 2074 6f20 6465 6c65 7465 2069  ject to delete i
+0000a740: 7473 2072 756e 7469 6d65 2072 6573 6f75  ts runtime resou
+0000a750: 7263 6573 2e20 666f 7220 6d6f 7374 2066  rces. for most f
+0000a760: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+0000a770: 2020 2020 7275 6e74 696d 6573 2c20 7275      runtimes, ru
+0000a780: 6e74 696d 6520 7265 736f 7572 6365 7320  ntime resources 
+0000a790: 6172 6520 7065 7220 5275 6e2c 2066 6f72  are per Run, for
+0000a7a0: 2077 6869 6368 2074 6865 2069 6465 6e74   which the ident
+0000a7b0: 6966 6965 7220 6973 2074 6865 2052 756e  ifier is the Run
+0000a7c0: 2773 2055 4944 2e20 466f 7220 6461 736b  's UID. For dask
+0000a7d0: 2072 756e 7469 6d65 2c20 7468 650a 2020   runtime, the.  
+0000a7e0: 2020 2020 2020 2020 2020 7275 6e74 696d            runtim
+0000a7f0: 6520 7265 736f 7572 6365 7320 6172 6520  e resources are 
+0000a800: 7065 7220 4675 6e63 7469 6f6e 2c20 666f  per Function, fo
+0000a810: 7220 7768 6963 6820 7468 6520 6964 656e  r which the iden
+0000a820: 7469 6669 6572 2069 7320 7468 6520 4675  tifier is the Fu
+0000a830: 6e63 7469 6f6e 2773 206e 616d 652e 0a20  nction's name.. 
+0000a840: 2020 2020 2020 203a 7061 7261 6d20 666f         :param fo
+0000a850: 7263 653a 2046 6f72 6365 2064 656c 6574  rce: Force delet
+0000a860: 696f 6e20 2d20 6465 6c65 7465 2074 6865  ion - delete the
+0000a870: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
+0000a880: 6520 6576 656e 2069 6620 6974 2773 206e  e even if it's n
+0000a890: 6f74 2069 6e20 7465 726d 696e 616c 2073  ot in terminal s
+0000a8a0: 7461 7465 206f 7220 6966 2074 6865 2067  tate or if the g
+0000a8b0: 7261 6365 0a20 2020 2020 2020 2020 2020  race.           
+0000a8c0: 2070 6572 696f 6420 6469 646e 2774 2070   period didn't p
+0000a8d0: 6173 732e 0a20 2020 2020 2020 203a 7061  ass..        :pa
+0000a8e0: 7261 6d20 6772 6163 655f 7065 7269 6f64  ram grace_period
+0000a8f0: 3a20 4772 6163 6520 7065 7269 6f64 2067  : Grace period g
+0000a900: 6976 656e 2074 6f20 7468 6520 7275 6e74  iven to the runt
+0000a910: 696d 6520 7265 736f 7572 6365 2062 6566  ime resource bef
+0000a920: 6f72 6520 7468 6579 2061 7265 2061 6374  ore they are act
+0000a930: 7561 6c6c 7920 7265 6d6f 7665 642c 2063  ually removed, c
+0000a940: 6f75 6e74 6564 2066 726f 6d0a 2020 2020  ounted from.    
+0000a950: 2020 2020 2020 2020 7468 6520 6d6f 6d65          the mome
+0000a960: 6e74 2074 6865 7920 6d6f 7665 6420 746f  nt they moved to
+0000a970: 2074 6572 6d69 6e61 6c20 7374 6174 6520   terminal state 
+0000a980: 2864 6566 6175 6c74 7320 746f 206d 6c72  (defaults to mlr
+0000a990: 756e 2e6d 6c63 6f6e 662e 7275 6e74 696d  un.mlconf.runtim
+0000a9a0: 655f 7265 736f 7572 6365 735f 6465 6c65  e_resources_dele
+0000a9b0: 7469 6f6e 5f67 7261 6365 5f70 6572 696f  tion_grace_perio
+0000a9c0: 6429 2e0a 0a20 2020 2020 2020 203a 7265  d)...        :re
+0000a9d0: 7475 726e 733a 203a 7079 3a63 6c61 7373  turns: :py:class
+0000a9e0: 3a60 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e  :`~mlrun.common.
+0000a9f0: 7363 6865 6d61 732e 4772 6f75 7065 6442  schemas.GroupedB
+0000aa00: 7950 726f 6a65 6374 5275 6e74 696d 6552  yProjectRuntimeR
+0000aa10: 6573 6f75 7263 6573 4f75 7470 7574 6020  esourcesOutput` 
+0000aa20: 6c69 7374 696e 6720 7468 6520 7275 6e74  listing the runt
+0000aa30: 696d 6520 7265 736f 7572 6365 730a 2020  ime resources.  
+0000aa40: 2020 2020 2020 2020 2020 7468 6174 2077            that w
+0000aa50: 6572 6520 7265 6d6f 7665 642e 0a20 2020  ere removed..   
+0000aa60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000aa70: 2069 6620 6772 6163 655f 7065 7269 6f64   if grace_period
+0000aa80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000aa90: 2020 2020 2020 6772 6163 655f 7065 7269        grace_peri
+0000aaa0: 6f64 203d 2063 6f6e 6669 672e 7275 6e74  od = config.runt
+0000aab0: 696d 655f 7265 736f 7572 6365 735f 6465  ime_resources_de
+0000aac0: 6c65 7469 6f6e 5f67 7261 6365 5f70 6572  letion_grace_per
+0000aad0: 696f 640a 2020 2020 2020 2020 2020 2020  iod.            
+0000aae0: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
+0000aaf0: 2020 2020 2020 2020 2020 2020 2022 5573               "Us
+0000ab00: 696e 6720 6465 6661 756c 7420 6772 6163  ing default grac
+0000ab10: 6520 7065 7269 6f64 2066 6f72 2072 756e  e period for run
+0000ab20: 7469 6d65 2072 6573 6f75 7263 6573 2064  time resources d
+0000ab30: 656c 6574 696f 6e22 2c0a 2020 2020 2020  eletion",.      
+0000ab40: 2020 2020 2020 2020 2020 6772 6163 655f            grace_
+0000ab50: 7065 7269 6f64 3d67 7261 6365 5f70 6572  period=grace_per
+0000ab60: 696f 642c 0a20 2020 2020 2020 2020 2020  iod,.           
+0000ab70: 2029 0a0a 2020 2020 2020 2020 7061 7261   )..        para
+0000ab80: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
+0000ab90: 2020 2022 6c61 6265 6c2d 7365 6c65 6374     "label-select
+0000aba0: 6f72 223a 206c 6162 656c 5f73 656c 6563  or": label_selec
+0000abb0: 746f 722c 0a20 2020 2020 2020 2020 2020  tor,.           
+0000abc0: 2022 6b69 6e64 223a 206b 696e 642c 0a20   "kind": kind,. 
+0000abd0: 2020 2020 2020 2020 2020 2022 6f62 6a65             "obje
+0000abe0: 6374 2d69 6422 3a20 6f62 6a65 6374 5f69  ct-id": object_i
+0000abf0: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
+0000ac00: 666f 7263 6522 3a20 666f 7263 652c 0a20  force": force,. 
+0000ac10: 2020 2020 2020 2020 2020 2022 6772 6163             "grac
+0000ac20: 652d 7065 7269 6f64 223a 2067 7261 6365  e-period": grace
+0000ac30: 5f70 6572 696f 642c 0a20 2020 2020 2020  _period,.       
+0000ac40: 207d 0a20 2020 2020 2020 2065 7272 6f72   }.        error
+0000ac50: 203d 2022 4661 696c 6564 2064 656c 6574   = "Failed delet
+0000ac60: 696e 6720 7275 6e74 696d 6520 7265 736f  ing runtime reso
+0000ac70: 7572 6365 7322 0a20 2020 2020 2020 2070  urces".        p
+0000ac80: 726f 6a65 6374 5f70 6174 6820 3d20 7072  roject_path = pr
+0000ac90: 6f6a 6563 7420 6966 2070 726f 6a65 6374  oject if project
+0000aca0: 2065 6c73 6520 222a 220a 2020 2020 2020   else "*".      
+0000acb0: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
+0000acc0: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+0000acd0: 2020 2020 2020 2020 2244 454c 4554 4522          "DELETE"
+0000ace0: 2c0a 2020 2020 2020 2020 2020 2020 6622  ,.            f"
+0000acf0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+0000ad00: 745f 7061 7468 7d2f 7275 6e74 696d 652d  t_path}/runtime-
+0000ad10: 7265 736f 7572 6365 7322 2c0a 2020 2020  resources",.    
+0000ad20: 2020 2020 2020 2020 6572 726f 722c 0a20          error,. 
+0000ad30: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000ad40: 733d 7061 7261 6d73 2c0a 2020 2020 2020  s=params,.      
+0000ad50: 2020 290a 2020 2020 2020 2020 7374 7275    ).        stru
+0000ad60: 6374 7572 6564 5f64 6963 7420 3d20 7b7d  ctured_dict = {}
+0000ad70: 0a20 2020 2020 2020 2066 6f72 2070 726f  .        for pro
+0000ad80: 6a65 6374 2c20 6b69 6e64 5f72 756e 7469  ject, kind_runti
+0000ad90: 6d65 5f72 6573 6f75 7263 6573 5f6d 6170  me_resources_map
+0000ada0: 2069 6e20 7265 7370 6f6e 7365 2e6a 736f   in response.jso
+0000adb0: 6e28 292e 6974 656d 7328 293a 0a20 2020  n().items():.   
+0000adc0: 2020 2020 2020 2020 2066 6f72 206b 696e           for kin
+0000add0: 642c 2072 756e 7469 6d65 5f72 6573 6f75  d, runtime_resou
+0000ade0: 7263 6573 2069 6e20 6b69 6e64 5f72 756e  rces in kind_run
+0000adf0: 7469 6d65 5f72 6573 6f75 7263 6573 5f6d  time_resources_m
+0000ae00: 6170 2e69 7465 6d73 2829 3a0a 2020 2020  ap.items():.    
+0000ae10: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+0000ae20: 6374 7572 6564 5f64 6963 742e 7365 7464  ctured_dict.setd
+0000ae30: 6566 6175 6c74 2870 726f 6a65 6374 2c20  efault(project, 
+0000ae40: 7b7d 295b 0a20 2020 2020 2020 2020 2020  {})[.           
+0000ae50: 2020 2020 2020 2020 206b 696e 640a 2020           kind.  
+0000ae60: 2020 2020 2020 2020 2020 2020 2020 5d20                ] 
+0000ae70: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0000ae80: 6368 656d 6173 2e52 756e 7469 6d65 5265  chemas.RuntimeRe
+0000ae90: 736f 7572 6365 7328 2a2a 7275 6e74 696d  sources(**runtim
+0000aea0: 655f 7265 736f 7572 6365 7329 0a20 2020  e_resources).   
+0000aeb0: 2020 2020 2072 6574 7572 6e20 7374 7275       return stru
+0000aec0: 6374 7572 6564 5f64 6963 740a 0a20 2020  ctured_dict..   
+0000aed0: 2064 6566 2063 7265 6174 655f 7363 6865   def create_sche
+0000aee0: 6475 6c65 280a 2020 2020 2020 2020 7365  dule(.        se
+0000aef0: 6c66 2c20 7072 6f6a 6563 743a 2073 7472  lf, project: str
+0000af00: 2c20 7363 6865 6475 6c65 3a20 6d6c 7275  , schedule: mlru
+0000af10: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0000af20: 2e53 6368 6564 756c 6549 6e70 7574 0a20  .ScheduleInput. 
+0000af30: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0000af40: 2243 7265 6174 6520 6120 6e65 7720 7363  "Create a new sc
+0000af50: 6865 6475 6c65 206f 6e20 7468 6520 6769  hedule on the gi
+0000af60: 7665 6e20 7072 6f6a 6563 742e 2054 6865  ven project. The
+0000af70: 2064 6574 6169 6c73 206f 6e20 7468 6520   details on the 
+0000af80: 6163 7475 616c 206f 626a 6563 7420 746f  actual object to
+0000af90: 2073 6368 6564 756c 6520 6173 2077 656c   schedule as wel
+0000afa0: 6c20 6173 2074 6865 0a20 2020 2020 2020  l as the.       
+0000afb0: 2073 6368 6564 756c 6520 6974 7365 6c66   schedule itself
+0000afc0: 2061 7265 2077 6974 6869 6e20 7468 6520   are within the 
+0000afd0: 7363 6865 6475 6c65 206f 626a 6563 7420  schedule object 
+0000afe0: 7072 6f76 6964 6564 2e0a 2020 2020 2020  provided..      
+0000aff0: 2020 5468 6520 3a70 793a 636c 6173 733a    The :py:class:
+0000b000: 607e 5363 6865 6475 6c65 4372 6f6e 5472  `~ScheduleCronTr
+0000b010: 6967 6765 7260 2066 6f6c 6c6f 7773 2074  igger` follows t
+0000b020: 6865 2067 7569 6465 6c69 6e65 7320 696e  he guidelines in
+0000b030: 0a20 2020 2020 2020 2068 7474 7073 3a2f  .        https:/
+0000b040: 2f61 7073 6368 6564 756c 6572 2e72 6561  /apscheduler.rea
+0000b050: 6474 6865 646f 6373 2e69 6f2f 656e 2f33  dthedocs.io/en/3
+0000b060: 2e78 2f6d 6f64 756c 6573 2f74 7269 6767  .x/modules/trigg
+0000b070: 6572 732f 6372 6f6e 2e68 746d 6c2e 0a20  ers/cron.html.. 
+0000b080: 2020 2020 2020 2049 7420 616c 736f 2073         It also s
+0000b090: 7570 706f 7274 7320 6120 3a70 793a 6675  upports a :py:fu
+0000b0a0: 6e63 3a60 7e53 6368 6564 756c 6543 726f  nc:`~ScheduleCro
+0000b0b0: 6e54 7269 6767 6572 2e66 726f 6d5f 6372  nTrigger.from_cr
+0000b0c0: 6f6e 7461 6260 2066 756e 6374 696f 6e20  ontab` function 
+0000b0d0: 7468 6174 2061 6363 6570 7473 2061 0a20  that accepts a. 
+0000b0e0: 2020 2020 2020 2063 726f 6e74 6162 2d66         crontab-f
+0000b0f0: 6f72 6d61 7474 6564 2073 7472 696e 6720  ormatted string 
+0000b100: 2873 6565 2068 7474 7073 3a2f 2f65 6e2e  (see https://en.
+0000b110: 7769 6b69 7065 6469 612e 6f72 672f 7769  wikipedia.org/wi
+0000b120: 6b69 2f43 726f 6e20 666f 7220 6d6f 7265  ki/Cron for more
+0000b130: 2069 6e66 6f72 6d61 7469 6f6e 206f 6e20   information on 
+0000b140: 7468 6520 666f 726d 6174 2061 6e64 0a20  the format and. 
+0000b150: 2020 2020 2020 206e 6f74 6520 7468 6174         note that
+0000b160: 2074 6865 2030 2077 6565 6b64 6179 2069   the 0 weekday i
+0000b170: 7320 616c 7761 7973 206d 6f6e 6461 7929  s always monday)
+0000b180: 2e0a 0a0a 2020 2020 2020 2020 4578 616d  ....        Exam
+0000b190: 706c 653a 3a0a 0a20 2020 2020 2020 2020  ple::..         
+0000b1a0: 2020 2066 726f 6d20 6d6c 7275 6e2e 636f     from mlrun.co
+0000b1b0: 6d6d 6f6e 2069 6d70 6f72 7420 7363 6865  mmon import sche
+0000b1c0: 6d61 730a 0a20 2020 2020 2020 2020 2020  mas..           
+0000b1d0: 2023 2045 7865 6375 7465 2074 6865 2067   # Execute the g
+0000b1e0: 6574 5f64 6174 615f 6675 6e63 2066 756e  et_data_func fun
+0000b1f0: 6374 696f 6e20 6576 6572 7920 5475 6573  ction every Tues
+0000b200: 6461 7920 6174 2031 353a 3330 0a20 2020  day at 15:30.   
+0000b210: 2020 2020 2020 2020 2073 6368 6564 756c           schedul
+0000b220: 6520 3d20 7363 6865 6d61 732e 5363 6865  e = schemas.Sche
+0000b230: 6475 6c65 496e 7075 7428 0a20 2020 2020  duleInput(.     
+0000b240: 2020 2020 2020 2020 2020 206e 616d 653d             name=
+0000b250: 2272 756e 5f66 756e 635f 6f6e 5f74 7565  "run_func_on_tue
+0000b260: 7364 6179 7322 2c0a 2020 2020 2020 2020  sdays",.        
+0000b270: 2020 2020 2020 2020 6b69 6e64 3d22 6a6f          kind="jo
+0000b280: 6222 2c0a 2020 2020 2020 2020 2020 2020  b",.            
+0000b290: 2020 2020 7363 6865 6475 6c65 645f 6f62      scheduled_ob
+0000b2a0: 6a65 6374 3d67 6574 5f64 6174 615f 6675  ject=get_data_fu
+0000b2b0: 6e63 2c0a 2020 2020 2020 2020 2020 2020  nc,.            
+0000b2c0: 2020 2020 6372 6f6e 5f74 7269 6767 6572      cron_trigger
+0000b2d0: 3d73 6368 656d 6173 2e53 6368 6564 756c  =schemas.Schedul
+0000b2e0: 6543 726f 6e54 7269 6767 6572 2864 6179  eCronTrigger(day
+0000b2f0: 5f6f 665f 7765 656b 3d27 7475 6527 2c20  _of_week='tue', 
+0000b300: 686f 7572 3d31 352c 206d 696e 7574 653d  hour=15, minute=
+0000b310: 3330 292c 0a20 2020 2020 2020 2020 2020  30),.           
+0000b320: 2029 0a20 2020 2020 2020 2020 2020 2064   ).            d
+0000b330: 622e 6372 6561 7465 5f73 6368 6564 756c  b.create_schedul
+0000b340: 6528 7072 6f6a 6563 745f 6e61 6d65 2c20  e(project_name, 
+0000b350: 7363 6865 6475 6c65 290a 2020 2020 2020  schedule).      
+0000b360: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
+0000b370: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
+0000b380: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+0000b390: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
+0000b3a0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+0000b3b0: 6563 7473 2f7b 7072 6f6a 6563 747d 2f73  ects/{project}/s
+0000b3c0: 6368 6564 756c 6573 220a 0a20 2020 2020  chedules"..     
+0000b3d0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+0000b3e0: 203d 2066 2246 6169 6c65 6420 6372 6561   = f"Failed crea
+0000b3f0: 7469 6e67 2073 6368 6564 756c 6520 7b70  ting schedule {p
+0000b400: 726f 6a65 6374 7d2f 7b73 6368 6564 756c  roject}/{schedul
+0000b410: 652e 6e61 6d65 7d22 0a20 2020 2020 2020  e.name}".       
+0000b420: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+0000b430: 504f 5354 222c 2070 6174 682c 2065 7272  POST", path, err
+0000b440: 6f72 5f6d 6573 7361 6765 2c20 626f 6479  or_message, body
+0000b450: 3d64 6963 745f 746f 5f6a 736f 6e28 7363  =dict_to_json(sc
+0000b460: 6865 6475 6c65 2e64 6963 7428 2929 290a  hedule.dict())).
+0000b470: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+0000b480: 7363 6865 6475 6c65 280a 2020 2020 2020  schedule(.      
+0000b490: 2020 7365 6c66 2c20 7072 6f6a 6563 743a    self, project:
+0000b4a0: 2073 7472 2c20 6e61 6d65 3a20 7374 722c   str, name: str,
+0000b4b0: 2073 6368 6564 756c 653a 206d 6c72 756e   schedule: mlrun
+0000b4c0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0000b4d0: 5363 6865 6475 6c65 5570 6461 7465 0a20  ScheduleUpdate. 
+0000b4e0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0000b4f0: 2255 7064 6174 6520 616e 2065 7869 7374  "Update an exist
+0000b500: 696e 6720 7363 6865 6475 6c65 2c20 7265  ing schedule, re
+0000b510: 706c 6163 6520 6974 2077 6974 6820 7468  place it with th
+0000b520: 6520 6465 7461 696c 7320 636f 6e74 6169  e details contai
+0000b530: 6e65 6420 696e 2074 6865 2073 6368 6564  ned in the sched
+0000b540: 756c 6520 6f62 6a65 6374 2e22 2222 0a0a  ule object."""..
+0000b550: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
+0000b560: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
+0000b570: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
+0000b580: 6563 740a 2020 2020 2020 2020 7061 7468  ect.        path
+0000b590: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
+0000b5a0: 726f 6a65 6374 7d2f 7363 6865 6475 6c65  roject}/schedule
+0000b5b0: 732f 7b6e 616d 657d 220a 0a20 2020 2020  s/{name}"..     
+0000b5c0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+0000b5d0: 203d 2066 2246 6169 6c65 6420 7570 6461   = f"Failed upda
+0000b5e0: 7469 6e67 2073 6368 6564 756c 6520 7b70  ting schedule {p
+0000b5f0: 726f 6a65 6374 7d2f 7b6e 616d 657d 220a  roject}/{name}".
+0000b600: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
+0000b610: 5f63 616c 6c28 2250 5554 222c 2070 6174  _call("PUT", pat
+0000b620: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
+0000b630: 2c20 626f 6479 3d64 6963 745f 746f 5f6a  , body=dict_to_j
+0000b640: 736f 6e28 7363 6865 6475 6c65 2e64 6963  son(schedule.dic
+0000b650: 7428 2929 290a 0a20 2020 2064 6566 2067  t()))..    def g
+0000b660: 6574 5f73 6368 6564 756c 6528 0a20 2020  et_schedule(.   
+0000b670: 2020 2020 2073 656c 662c 2070 726f 6a65       self, proje
+0000b680: 6374 3a20 7374 722c 206e 616d 653a 2073  ct: str, name: s
+0000b690: 7472 2c20 696e 636c 7564 655f 6c61 7374  tr, include_last
+0000b6a0: 5f72 756e 3a20 626f 6f6c 203d 2046 616c  _run: bool = Fal
+0000b6b0: 7365 0a20 2020 2029 202d 3e20 6d6c 7275  se.    ) -> mlru
+0000b6c0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0000b6d0: 2e53 6368 6564 756c 654f 7574 7075 743a  .ScheduleOutput:
+0000b6e0: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
+0000b6f0: 6965 7665 2064 6574 6169 6c73 206f 6620  ieve details of 
+0000b700: 7468 6520 7363 6865 6475 6c65 2069 6e20  the schedule in 
+0000b710: 7175 6573 7469 6f6e 2e20 4265 7369 6465  question. Beside
+0000b720: 7320 7265 7475 726e 696e 6720 7468 6520  s returning the 
+0000b730: 6465 7461 696c 7320 6f66 2074 6865 2073  details of the s
+0000b740: 6368 6564 756c 6520 6f62 6a65 6374 2069  chedule object i
+0000b750: 7473 656c 662c 0a20 2020 2020 2020 2074  tself,.        t
+0000b760: 6869 7320 6675 6e63 7469 6f6e 2061 6c73  his function als
+0000b770: 6f20 7265 7475 726e 7320 7468 6520 6e65  o returns the ne
+0000b780: 7874 2073 6368 6564 756c 6564 2072 756e  xt scheduled run
+0000b790: 2066 6f72 2074 6869 7320 7370 6563 6966   for this specif
+0000b7a0: 6963 2073 6368 6564 756c 652c 2061 7320  ic schedule, as 
+0000b7b0: 7765 6c6c 2061 7320 706f 7465 6e74 6961  well as potentia
+0000b7c0: 6c6c 7920 7468 650a 2020 2020 2020 2020  lly the.        
+0000b7d0: 7265 7375 6c74 7320 6f66 2074 6865 206c  results of the l
+0000b7e0: 6173 7420 7275 6e20 6578 6563 7574 6564  ast run executed
+0000b7f0: 2074 6872 6f75 6768 2074 6869 7320 7363   through this sc
+0000b800: 6865 6475 6c65 2e0a 0a20 2020 2020 2020  hedule...       
+0000b810: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
+0000b820: 2050 726f 6a65 6374 206e 616d 652e 0a20   Project name.. 
+0000b830: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
+0000b840: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
+0000b850: 7363 6865 6475 6c65 206f 626a 6563 7420  schedule object 
+0000b860: 746f 2071 7565 7279 2e0a 2020 2020 2020  to query..      
+0000b870: 2020 3a70 6172 616d 2069 6e63 6c75 6465    :param include
+0000b880: 5f6c 6173 745f 7275 6e3a 2057 6865 7468  _last_run: Wheth
+0000b890: 6572 2074 6f20 696e 636c 7564 6520 7468  er to include th
+0000b8a0: 6520 7265 7375 6c74 7320 6f66 2074 6865  e results of the
+0000b8b0: 2073 6368 6564 756c 6527 7320 6c61 7374   schedule's last
+0000b8c0: 2072 756e 2069 6e20 7468 6520 7265 7370   run in the resp
+0000b8d0: 6f6e 7365 2e0a 2020 2020 2020 2020 2222  onse..        ""
+0000b8e0: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
+0000b8f0: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
+0000b900: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
+0000b910: 726f 6a65 6374 0a20 2020 2020 2020 2070  roject.        p
+0000b920: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+0000b930: 2f7b 7072 6f6a 6563 747d 2f73 6368 6564  /{project}/sched
+0000b940: 756c 6573 2f7b 6e61 6d65 7d22 0a20 2020  ules/{name}".   
+0000b950: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+0000b960: 6765 203d 2066 2246 6169 6c65 6420 6765  ge = f"Failed ge
+0000b970: 7474 696e 6720 7363 6865 6475 6c65 2066  tting schedule f
+0000b980: 6f72 207b 7072 6f6a 6563 747d 2f7b 6e61  or {project}/{na
+0000b990: 6d65 7d22 0a20 2020 2020 2020 2072 6573  me}".        res
+0000b9a0: 7020 3d20 7365 6c66 2e61 7069 5f63 616c  p = self.api_cal
+0000b9b0: 6c28 0a20 2020 2020 2020 2020 2020 2022  l(.            "
+0000b9c0: 4745 5422 2c20 7061 7468 2c20 6572 726f  GET", path, erro
+0000b9d0: 725f 6d65 7373 6167 652c 2070 6172 616d  r_message, param
+0000b9e0: 733d 7b22 696e 636c 7564 655f 6c61 7374  s={"include_last
+0000b9f0: 5f72 756e 223a 2069 6e63 6c75 6465 5f6c  _run": include_l
+0000ba00: 6173 745f 7275 6e7d 0a20 2020 2020 2020  ast_run}.       
+0000ba10: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+0000ba20: 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  n mlrun.common.s
+0000ba30: 6368 656d 6173 2e53 6368 6564 756c 654f  chemas.ScheduleO
+0000ba40: 7574 7075 7428 2a2a 7265 7370 2e6a 736f  utput(**resp.jso
+0000ba50: 6e28 2929 0a0a 2020 2020 6465 6620 6c69  n())..    def li
+0000ba60: 7374 5f73 6368 6564 756c 6573 280a 2020  st_schedules(.  
+0000ba70: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000ba80: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
+0000ba90: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+0000baa0: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
+0000bab0: 2020 2020 6b69 6e64 3a20 6d6c 7275 6e2e      kind: mlrun.
+0000bac0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+0000bad0: 6368 6564 756c 654b 696e 6473 203d 204e  cheduleKinds = N
+0000bae0: 6f6e 652c 0a20 2020 2020 2020 2069 6e63  one,.        inc
+0000baf0: 6c75 6465 5f6c 6173 745f 7275 6e3a 2062  lude_last_run: b
+0000bb00: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000bb10: 2029 202d 3e20 6d6c 7275 6e2e 636f 6d6d   ) -> mlrun.comm
+0000bb20: 6f6e 2e73 6368 656d 6173 2e53 6368 6564  on.schemas.Sched
+0000bb30: 756c 6573 4f75 7470 7574 3a0a 2020 2020  ulesOutput:.    
+0000bb40: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
+0000bb50: 6c69 7374 206f 6620 7363 6865 6475 6c65  list of schedule
+0000bb60: 7320 6f66 2073 7065 6369 6669 6320 6e61  s of specific na
+0000bb70: 6d65 206f 7220 6b69 6e64 2e0a 0a20 2020  me or kind...   
+0000bb80: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+0000bb90: 6563 743a 2050 726f 6a65 6374 206e 616d  ect: Project nam
+0000bba0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0000bbb0: 6d20 6e61 6d65 3a20 4e61 6d65 206f 6620  m name: Name of 
+0000bbc0: 7363 6865 6475 6c65 2074 6f20 7265 7472  schedule to retr
+0000bbd0: 6965 7665 2e20 4361 6e20 6265 206f 6d69  ieve. Can be omi
+0000bbe0: 7474 6564 2074 6f20 6c69 7374 2061 6c6c  tted to list all
+0000bbf0: 2073 6368 6564 756c 6573 2e0a 2020 2020   schedules..    
+0000bc00: 2020 2020 3a70 6172 616d 206b 696e 643a      :param kind:
+0000bc10: 204b 696e 6420 6f66 2073 6368 6564 756c   Kind of schedul
+0000bc20: 6520 6f62 6a65 6374 7320 746f 2072 6574  e objects to ret
+0000bc30: 7269 6576 652c 2063 616e 2062 6520 6569  rieve, can be ei
+0000bc40: 7468 6572 2060 606a 6f62 6060 206f 7220  ther ``job`` or 
+0000bc50: 6060 7069 7065 6c69 6e65 6060 2e0a 2020  ``pipeline``..  
+0000bc60: 2020 2020 2020 3a70 6172 616d 2069 6e63        :param inc
+0000bc70: 6c75 6465 5f6c 6173 745f 7275 6e3a 2057  lude_last_run: W
+0000bc80: 6865 7468 6572 2074 6f20 7265 7475 726e  hether to return
+0000bc90: 2066 6f72 2065 6163 6820 7363 6865 6475   for each schedu
+0000bca0: 6c65 2072 6574 7572 6e65 6420 616c 736f  le returned also
+0000bcb0: 2074 6865 2072 6573 756c 7473 206f 6620   the results of 
+0000bcc0: 7468 6520 6c61 7374 2072 756e 206f 660a  the last run of.
+0000bcd0: 2020 2020 2020 2020 2020 2020 7468 6174              that
+0000bce0: 2073 6368 6564 756c 652e 0a20 2020 2020   schedule..     
+0000bcf0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0000bd00: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+0000bd10: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+0000bd20: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+0000bd30: 2020 2020 7061 7261 6d73 203d 207b 226b      params = {"k
+0000bd40: 696e 6422 3a20 6b69 6e64 2c20 226e 616d  ind": kind, "nam
+0000bd50: 6522 3a20 6e61 6d65 2c20 2269 6e63 6c75  e": name, "inclu
+0000bd60: 6465 5f6c 6173 745f 7275 6e22 3a20 696e  de_last_run": in
+0000bd70: 636c 7564 655f 6c61 7374 5f72 756e 7d0a  clude_last_run}.
+0000bd80: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+0000bd90: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+0000bda0: 6374 7d2f 7363 6865 6475 6c65 7322 0a20  ct}/schedules". 
+0000bdb0: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
+0000bdc0: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
+0000bdd0: 6c69 7374 696e 6720 7363 6865 6475 6c65  listing schedule
+0000bde0: 7320 666f 7220 7b70 726f 6a65 6374 7d20  s for {project} 
+0000bdf0: 3f20 7b6b 696e 647d 207b 6e61 6d65 7d22  ? {kind} {name}"
+0000be00: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+0000be10: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
+0000be20: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
+0000be30: 5f6d 6573 7361 6765 2c20 7061 7261 6d73  _message, params
+0000be40: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+0000be50: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
+0000be60: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
+0000be70: 6564 756c 6573 4f75 7470 7574 282a 2a72  edulesOutput(**r
+0000be80: 6573 702e 6a73 6f6e 2829 290a 0a20 2020  esp.json())..   
+0000be90: 2064 6566 2064 656c 6574 655f 7363 6865   def delete_sche
+0000bea0: 6475 6c65 2873 656c 662c 2070 726f 6a65  dule(self, proje
+0000beb0: 6374 3a20 7374 722c 206e 616d 653a 2073  ct: str, name: s
+0000bec0: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
+0000bed0: 4465 6c65 7465 2061 2073 7065 6369 6669  Delete a specifi
+0000bee0: 6320 7363 6865 6475 6c65 2062 7920 6e61  c schedule by na
+0000bef0: 6d65 2e22 2222 0a0a 2020 2020 2020 2020  me."""..        
+0000bf00: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+0000bf10: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+0000bf20: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+0000bf30: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
+0000bf40: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+0000bf50: 7363 6865 6475 6c65 732f 7b6e 616d 657d  schedules/{name}
+0000bf60: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
+0000bf70: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+0000bf80: 6564 2064 656c 6574 696e 6720 7363 6865  ed deleting sche
+0000bf90: 6475 6c65 207b 7072 6f6a 6563 747d 2f7b  dule {project}/{
+0000bfa0: 6e61 6d65 7d22 0a20 2020 2020 2020 2073  name}".        s
+0000bfb0: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
+0000bfc0: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
+0000bfd0: 6f72 5f6d 6573 7361 6765 290a 0a20 2020  or_message)..   
+0000bfe0: 2064 6566 2069 6e76 6f6b 655f 7363 6865   def invoke_sche
+0000bff0: 6475 6c65 2873 656c 662c 2070 726f 6a65  dule(self, proje
+0000c000: 6374 3a20 7374 722c 206e 616d 653a 2073  ct: str, name: s
+0000c010: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
+0000c020: 4578 6563 7574 6520 7468 6520 6f62 6a65  Execute the obje
+0000c030: 6374 2072 6566 6572 656e 6365 6420 6279  ct referenced by
+0000c040: 2074 6865 2073 6368 6564 756c 6520 696d   the schedule im
+0000c050: 6d65 6469 6174 656c 792e 2222 220a 0a20  mediately.""".. 
+0000c060: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+0000c070: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+0000c080: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+0000c090: 6374 0a20 2020 2020 2020 2070 6174 6820  ct.        path 
+0000c0a0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+0000c0b0: 6f6a 6563 747d 2f73 6368 6564 756c 6573  oject}/schedules
+0000c0c0: 2f7b 6e61 6d65 7d2f 696e 766f 6b65 220a  /{name}/invoke".
+0000c0d0: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
+0000c0e0: 7373 6167 6520 3d20 6622 4661 696c 6564  ssage = f"Failed
+0000c0f0: 2069 6e76 6f6b 696e 6720 7363 6865 6475   invoking schedu
+0000c100: 6c65 207b 7072 6f6a 6563 747d 2f7b 6e61  le {project}/{na
+0000c110: 6d65 7d22 0a20 2020 2020 2020 2073 656c  me}".        sel
+0000c120: 662e 6170 695f 6361 6c6c 2822 504f 5354  f.api_call("POST
+0000c130: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+0000c140: 6573 7361 6765 290a 0a20 2020 2064 6566  essage)..    def
+0000c150: 2072 656d 6f74 655f 6275 696c 6465 7228   remote_builder(
+0000c160: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0000c170: 2020 2020 2020 2066 756e 632c 0a20 2020         func,.   
+0000c180: 2020 2020 2077 6974 685f 6d6c 7275 6e2c       with_mlrun,
+0000c190: 0a20 2020 2020 2020 206d 6c72 756e 5f76  .        mlrun_v
+0000c1a0: 6572 7369 6f6e 5f73 7065 6369 6669 6572  ersion_specifier
+0000c1b0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2073  =None,.        s
+0000c1c0: 6b69 705f 6465 706c 6f79 6564 3d46 616c  kip_deployed=Fal
+0000c1d0: 7365 2c0a 2020 2020 2020 2020 6275 696c  se,.        buil
+0000c1e0: 6465 725f 656e 763d 4e6f 6e65 2c0a 2020  der_env=None,.  
+0000c1f0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000c200: 4275 696c 6420 7468 6520 706f 6420 696d  Build the pod im
+0000c210: 6167 6520 666f 7220 6120 6675 6e63 7469  age for a functi
+0000c220: 6f6e 2c20 666f 7220 6578 6563 7574 696f  on, for executio
+0000c230: 6e20 6f6e 2061 2072 656d 6f74 6520 636c  n on a remote cl
+0000c240: 7573 7465 722e 2054 6869 7320 6973 2065  uster. This is e
+0000c250: 7865 6375 7465 6420 6279 2074 6865 204d  xecuted by the M
+0000c260: 4c52 756e 0a20 2020 2020 2020 2041 5049  LRun.        API
+0000c270: 2073 6572 7665 722c 2061 6e64 2063 7265   server, and cre
+0000c280: 6174 6573 2061 2044 6f63 6b65 7220 696d  ates a Docker im
+0000c290: 6167 6520 6f75 7420 6f66 2074 6865 2066  age out of the f
+0000c2a0: 756e 6374 696f 6e20 7072 6f76 6964 6564  unction provided
+0000c2b0: 2061 6e64 2061 6e79 2073 7065 6369 6669   and any specifi
+0000c2c0: 6320 6275 696c 640a 2020 2020 2020 2020  c build.        
+0000c2d0: 696e 7374 7275 6374 696f 6e73 2070 726f  instructions pro
+0000c2e0: 7669 6465 6420 7769 7468 696e 2e20 5468  vided within. Th
+0000c2f0: 6973 2069 7320 6120 7072 652d 7265 7175  is is a pre-requ
+0000c300: 6973 6974 6520 666f 7220 7265 6d6f 7465  isite for remote
+0000c310: 6c79 2065 7865 6375 7469 6e67 2061 2066  ly executing a f
+0000c320: 756e 6374 696f 6e2c 2075 6e6c 6573 7320  unction, unless 
+0000c330: 7573 696e 670a 2020 2020 2020 2020 6120  using.        a 
+0000c340: 7072 652d 6465 706c 6f79 6564 2069 6d61  pre-deployed ima
+0000c350: 6765 2e0a 0a20 2020 2020 2020 203a 7061  ge...        :pa
+0000c360: 7261 6d20 6675 6e63 3a20 4675 6e63 7469  ram func: Functi
+0000c370: 6f6e 2074 6f20 6275 696c 642e 0a20 2020  on to build..   
+0000c380: 2020 2020 203a 7061 7261 6d20 7769 7468       :param with
+0000c390: 5f6d 6c72 756e 3a20 5768 6574 6865 7220  _mlrun: Whether 
+0000c3a0: 746f 2061 6464 204d 4c52 756e 2070 6163  to add MLRun pac
+0000c3b0: 6b61 6765 2074 6f20 7468 6520 6275 696c  kage to the buil
+0000c3c0: 7420 7061 636b 6167 652e 2054 6869 7320  t package. This 
+0000c3d0: 6973 206e 6f74 2072 6571 7569 7265 6420  is not required 
+0000c3e0: 6966 2075 7369 6e67 2061 2062 6173 650a  if using a base.
+0000c3f0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+0000c400: 6520 7468 6174 2061 6c72 6561 6479 2068  e that already h
+0000c410: 6173 204d 4c52 756e 2069 6e20 6974 2e0a  as MLRun in it..
+0000c420: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+0000c430: 6c72 756e 5f76 6572 7369 6f6e 5f73 7065  lrun_version_spe
+0000c440: 6369 6669 6572 3a20 5665 7273 696f 6e20  cifier: Version 
+0000c450: 6f66 204d 4c52 756e 2074 6f20 696e 636c  of MLRun to incl
+0000c460: 7564 6520 696e 2074 6865 2062 7569 6c74  ude in the built
+0000c470: 2069 6d61 6765 2e0a 2020 2020 2020 2020   image..        
+0000c480: 3a70 6172 616d 2073 6b69 705f 6465 706c  :param skip_depl
+0000c490: 6f79 6564 3a20 536b 6970 2074 6865 2062  oyed: Skip the b
+0000c4a0: 7569 6c64 2069 6620 7765 2061 6c72 6561  uild if we alrea
+0000c4b0: 6479 2068 6176 6520 616e 2069 6d61 6765  dy have an image
+0000c4c0: 2066 6f72 2074 6865 2066 756e 6374 696f   for the functio
+0000c4d0: 6e2e 0a20 2020 2020 2020 203a 7061 7261  n..        :para
+0000c4e0: 6d20 6275 696c 6465 725f 656e 763a 2020  m builder_env:  
+0000c4f0: 204b 616e 696b 6f20 6275 696c 6465 7220   Kaniko builder 
+0000c500: 706f 6420 656e 7620 7661 7273 2064 6963  pod env vars dic
+0000c510: 7420 2866 6f72 2063 6f6e 6669 672f 6372  t (for config/cr
+0000c520: 6564 656e 7469 616c 7329 0a20 2020 2020  edentials).     
+0000c530: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0000c540: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000c550: 2072 6571 203d 207b 0a20 2020 2020 2020   req = {.       
+0000c560: 2020 2020 2020 2020 2022 6675 6e63 7469           "functi
+0000c570: 6f6e 223a 2066 756e 632e 746f 5f64 6963  on": func.to_dic
+0000c580: 7428 292c 0a20 2020 2020 2020 2020 2020  t(),.           
+0000c590: 2020 2020 2022 7769 7468 5f6d 6c72 756e       "with_mlrun
+0000c5a0: 223a 2062 6f6f 6c32 7374 7228 7769 7468  ": bool2str(with
+0000c5b0: 5f6d 6c72 756e 292c 0a20 2020 2020 2020  _mlrun),.       
+0000c5c0: 2020 2020 2020 2020 2022 736b 6970 5f64           "skip_d
+0000c5d0: 6570 6c6f 7965 6422 3a20 736b 6970 5f64  eployed": skip_d
+0000c5e0: 6570 6c6f 7965 642c 0a20 2020 2020 2020  eployed,.       
+0000c5f0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0000c600: 2020 2069 6620 6d6c 7275 6e5f 7665 7273     if mlrun_vers
+0000c610: 696f 6e5f 7370 6563 6966 6965 723a 0a20  ion_specifier:. 
+0000c620: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000c630: 6571 5b22 6d6c 7275 6e5f 7665 7273 696f  eq["mlrun_versio
+0000c640: 6e5f 7370 6563 6966 6965 7222 5d20 3d20  n_specifier"] = 
+0000c650: 6d6c 7275 6e5f 7665 7273 696f 6e5f 7370  mlrun_version_sp
+0000c660: 6563 6966 6965 720a 2020 2020 2020 2020  ecifier.        
+0000c670: 2020 2020 6966 2062 7569 6c64 6572 5f65      if builder_e
+0000c680: 6e76 3a0a 2020 2020 2020 2020 2020 2020  nv:.            
+0000c690: 2020 2020 7265 715b 2262 7569 6c64 6572      req["builder
+0000c6a0: 5f65 6e76 225d 203d 2062 7569 6c64 6572  _env"] = builder
+0000c6b0: 5f65 6e76 0a20 2020 2020 2020 2020 2020  _env.           
+0000c6c0: 2072 6573 7020 3d20 7365 6c66 2e61 7069   resp = self.api
+0000c6d0: 5f63 616c 6c28 2250 4f53 5422 2c20 2262  _call("POST", "b
+0000c6e0: 7569 6c64 2f66 756e 6374 696f 6e22 2c20  uild/function", 
+0000c6f0: 6a73 6f6e 3d72 6571 290a 2020 2020 2020  json=req).      
+0000c700: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
+0000c710: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
+0000c720: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
+0000c730: 7228 6622 6572 726f 7220 7375 626d 6974  r(f"error submit
+0000c740: 7469 6e67 2062 7569 6c64 2074 6173 6b3a  ting build task:
+0000c750: 207b 6572 725f 746f 5f73 7472 2865 7272   {err_to_str(err
+0000c760: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
+0000c770: 2072 6169 7365 204f 5345 7272 6f72 2866   raise OSError(f
+0000c780: 2265 7272 6f72 3a20 6361 6e6e 6f74 2073  "error: cannot s
+0000c790: 7562 6d69 7420 6275 696c 642c 207b 6572  ubmit build, {er
+0000c7a0: 725f 746f 5f73 7472 2865 7272 297d 2229  r_to_str(err)}")
+0000c7b0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000c7c0: 2072 6573 702e 6f6b 3a0a 2020 2020 2020   resp.ok:.      
+0000c7d0: 2020 2020 2020 6c6f 6767 6572 2e65 7272        logger.err
+0000c7e0: 6f72 2866 2262 6164 2072 6573 7021 215c  or(f"bad resp!!\
+0000c7f0: 6e7b 7265 7370 2e74 6578 747d 2229 0a20  n{resp.text}"). 
+0000c800: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c810: 2056 616c 7565 4572 726f 7228 2262 6164   ValueError("bad
+0000c820: 2066 756e 6374 696f 6e20 7275 6e20 7265   function run re
+0000c830: 7370 6f6e 7365 2229 0a0a 2020 2020 2020  sponse")..      
+0000c840: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
+0000c850: 6f6e 2829 0a0a 2020 2020 6465 6620 6765  on()..    def ge
+0000c860: 745f 6275 696c 6465 725f 7374 6174 7573  t_builder_status
+0000c870: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000c880: 2020 2020 2020 2020 6675 6e63 3a20 4261          func: Ba
+0000c890: 7365 5275 6e74 696d 652c 0a20 2020 2020  seRuntime,.     
+0000c8a0: 2020 206f 6666 7365 743d 302c 0a20 2020     offset=0,.   
+0000c8b0: 2020 2020 206c 6f67 733d 5472 7565 2c0a       logs=True,.
+0000c8c0: 2020 2020 2020 2020 6c61 7374 5f6c 6f67          last_log
+0000c8d0: 5f74 696d 6573 7461 6d70 3d30 2c0a 2020  _timestamp=0,.  
+0000c8e0: 2020 2020 2020 7665 7262 6f73 653d 4661        verbose=Fa
+0000c8f0: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
+0000c900: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
+0000c910: 7468 6520 7374 6174 7573 206f 6620 6120  the status of a 
+0000c920: 6275 696c 6420 6f70 6572 6174 696f 6e20  build operation 
+0000c930: 6375 7272 656e 746c 7920 696e 2070 726f  currently in pro
+0000c940: 6772 6573 732e 0a0a 2020 2020 2020 2020  gress...        
+0000c950: 3a70 6172 616d 2066 756e 633a 2046 756e  :param func: Fun
+0000c960: 6374 696f 6e20 6f62 6a65 6374 2074 6861  ction object tha
+0000c970: 7420 6973 2062 6569 6e67 2062 7569 6c74  t is being built
+0000c980: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000c990: 206f 6666 7365 743a 204f 6666 7365 7420   offset: Offset 
+0000c9a0: 696e 746f 2074 6865 2062 7569 6c64 206c  into the build l
+0000c9b0: 6f67 7320 746f 2072 6574 7269 6576 6520  ogs to retrieve 
+0000c9c0: 6c6f 6773 2066 726f 6d2e 0a20 2020 2020  logs from..     
+0000c9d0: 2020 203a 7061 7261 6d20 6c6f 6773 3a20     :param logs: 
+0000c9e0: 5368 6f75 6c64 2062 7569 6c64 206c 6f67  Should build log
+0000c9f0: 7320 6265 2072 6574 7269 6576 6564 2e0a  s be retrieved..
+0000ca00: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+0000ca10: 6173 745f 6c6f 675f 7469 6d65 7374 616d  ast_log_timestam
+0000ca20: 703a 204c 6173 7420 7469 6d65 7374 616d  p: Last timestam
+0000ca30: 7020 6f66 206c 6f67 7320 7468 6174 2077  p of logs that w
+0000ca40: 6572 6520 616c 7265 6164 7920 7265 7472  ere already retr
+0000ca50: 6965 7665 642e 2046 756e 6374 696f 6e20  ieved. Function 
+0000ca60: 7769 6c6c 2072 6574 7572 6e20 6f6e 6c79  will return only
+0000ca70: 206c 6f67 730a 2020 2020 2020 2020 2020   logs.          
+0000ca80: 2020 6c61 7465 7220 7468 616e 2074 6869    later than thi
+0000ca90: 7320 7061 7261 6d65 7465 722e 0a20 2020  s parameter..   
+0000caa0: 2020 2020 203a 7061 7261 6d20 7665 7262       :param verb
+0000cab0: 6f73 653a 2041 6464 2076 6572 626f 7365  ose: Add verbose
+0000cac0: 206c 6f67 7320 696e 746f 2074 6865 206f   logs into the o
+0000cad0: 7574 7075 742e 0a20 2020 2020 2020 203a  utput..        :
+0000cae0: 7265 7475 726e 733a 2054 6865 2066 6f6c  returns: The fol
+0000caf0: 6c6f 7769 6e67 2070 6172 616d 6574 6572  lowing parameter
+0000cb00: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
+0000cb10: 2d20 5465 7874 206f 6620 6275 696c 6465  - Text of builde
+0000cb20: 7220 6c6f 6773 2e0a 2020 2020 2020 2020  r logs..        
+0000cb30: 2020 2020 2d20 5469 6d65 7374 616d 7020      - Timestamp 
+0000cb40: 6f66 206c 6173 7420 6c6f 6720 7265 7472  of last log retr
+0000cb50: 6965 7665 642c 2074 6f20 6265 2075 7365  ieved, to be use
+0000cb60: 6420 696e 2073 7562 7365 7175 656e 7420  d in subsequent 
+0000cb70: 6361 6c6c 7320 746f 2074 6869 7320 6675  calls to this fu
+0000cb80: 6e63 7469 6f6e 2e0a 0a20 2020 2020 2020  nction...       
+0000cb90: 2020 2020 2054 6865 2066 756e 6374 696f       The functio
+0000cba0: 6e20 616c 736f 2075 7064 6174 6573 2069  n also updates i
+0000cbb0: 6e74 6572 6e61 6c20 6d65 6d62 6572 7320  nternal members 
+0000cbc0: 6f66 2074 6865 2060 6066 756e 6360 6020  of the ``func`` 
+0000cbd0: 6f62 6a65 6374 2074 6f20 7265 666c 6563  object to reflec
+0000cbe0: 7420 6275 696c 6420 7072 6f63 6573 7320  t build process 
+0000cbf0: 696e 666f 2e0a 2020 2020 2020 2020 2222  info..        ""
+0000cc00: 220a 0a20 2020 2020 2020 2074 7279 3a0a  "..        try:.
+0000cc10: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0000cc20: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
+0000cc30: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
+0000cc40: 6f72 6d61 6c69 7a65 5f6e 616d 6528 6675  ormalize_name(fu
+0000cc50: 6e63 2e6d 6574 6164 6174 612e 6e61 6d65  nc.metadata.name
+0000cc60: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000cc70: 2020 2022 7072 6f6a 6563 7422 3a20 6675     "project": fu
+0000cc80: 6e63 2e6d 6574 6164 6174 612e 7072 6f6a  nc.metadata.proj
+0000cc90: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
+0000cca0: 2020 2020 2022 7461 6722 3a20 6675 6e63       "tag": func
+0000ccb0: 2e6d 6574 6164 6174 612e 7461 672c 0a20  .metadata.tag,. 
+0000ccc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000ccd0: 6c6f 6773 223a 2062 6f6f 6c32 7374 7228  logs": bool2str(
+0000cce0: 6c6f 6773 292c 0a20 2020 2020 2020 2020  logs),.         
+0000ccf0: 2020 2020 2020 2022 6f66 6673 6574 223a         "offset":
+0000cd00: 2073 7472 286f 6666 7365 7429 2c0a 2020   str(offset),.  
+0000cd10: 2020 2020 2020 2020 2020 2020 2020 226c                "l
+0000cd20: 6173 745f 6c6f 675f 7469 6d65 7374 616d  ast_log_timestam
+0000cd30: 7022 3a20 7374 7228 6c61 7374 5f6c 6f67  p": str(last_log
+0000cd40: 5f74 696d 6573 7461 6d70 292c 0a20 2020  _timestamp),.   
+0000cd50: 2020 2020 2020 2020 2020 2020 2022 7665               "ve
+0000cd60: 7262 6f73 6522 3a20 626f 6f6c 3273 7472  rbose": bool2str
+0000cd70: 2876 6572 626f 7365 292c 0a20 2020 2020  (verbose),.     
+0000cd80: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000cd90: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
+0000cda0: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
+0000cdb0: 2022 6275 696c 642f 7374 6174 7573 222c   "build/status",
+0000cdc0: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
+0000cdd0: 2020 2020 2020 2020 6578 6365 7074 204f          except O
+0000cde0: 5345 7272 6f72 2061 7320 6572 723a 0a20  SError as err:. 
+0000cdf0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000ce00: 722e 6572 726f 7228 6622 6572 726f 7220  r.error(f"error 
+0000ce10: 6765 7474 696e 6720 6275 696c 6420 7374  getting build st
+0000ce20: 6174 7573 3a20 7b65 7272 5f74 6f5f 7374  atus: {err_to_st
+0000ce30: 7228 6572 7229 7d22 290a 2020 2020 2020  r(err)}").      
+0000ce40: 2020 2020 2020 7261 6973 6520 4f53 4572        raise OSEr
+0000ce50: 726f 7228 6622 6572 726f 723a 2063 616e  ror(f"error: can
+0000ce60: 6e6f 7420 6765 7420 6275 696c 6420 7374  not get build st
+0000ce70: 6174 7573 2c20 7b65 7272 5f74 6f5f 7374  atus, {err_to_st
+0000ce80: 7228 6572 7229 7d22 290a 0a20 2020 2020  r(err)}")..     
+0000ce90: 2020 2069 6620 6e6f 7420 7265 7370 2e6f     if not resp.o
+0000cea0: 6b3a 0a20 2020 2020 2020 2020 2020 206c  k:.            l
+0000ceb0: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
+0000cec0: 6661 696c 6564 2072 6573 702c 207b 7265  failed resp, {re
+0000ced0: 7370 2e74 6578 747d 2229 0a20 2020 2020  sp.text}").     
+0000cee0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
+0000cef0: 4442 4572 726f 7228 2262 6164 2066 756e  DBError("bad fun
+0000cf00: 6374 696f 6e20 6275 696c 6420 7265 7370  ction build resp
+0000cf10: 6f6e 7365 2229 0a0a 2020 2020 2020 2020  onse")..        
+0000cf20: 6966 2072 6573 702e 6865 6164 6572 733a  if resp.headers:
+0000cf30: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+0000cf40: 632e 7374 6174 7573 2e73 7461 7465 203d  c.status.state =
+0000cf50: 2072 6573 702e 6865 6164 6572 732e 6765   resp.headers.ge
+0000cf60: 7428 2278 2d6d 6c72 756e 2d66 756e 6374  t("x-mlrun-funct
+0000cf70: 696f 6e2d 7374 6174 7573 222c 2022 2229  ion-status", "")
+0000cf80: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
+0000cf90: 745f 6c6f 675f 7469 6d65 7374 616d 7020  t_log_timestamp 
+0000cfa0: 3d20 666c 6f61 7428 0a20 2020 2020 2020  = float(.       
+0000cfb0: 2020 2020 2020 2020 2072 6573 702e 6865           resp.he
+0000cfc0: 6164 6572 732e 6765 7428 2278 2d6d 6c72  aders.get("x-mlr
+0000cfd0: 756e 2d6c 6173 742d 7469 6d65 7374 616d  un-last-timestam
+0000cfe0: 7022 2c20 2230 2e30 2229 0a20 2020 2020  p", "0.0").     
+0000cff0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000d000: 2020 2020 2069 6620 6675 6e63 2e6b 696e       if func.kin
+0000d010: 6420 696e 206d 6c72 756e 2e72 756e 7469  d in mlrun.runti
+0000d020: 6d65 732e 5275 6e74 696d 654b 696e 6473  mes.RuntimeKinds
+0000d030: 2e6e 7563 6c69 6f5f 7275 6e74 696d 6573  .nuclio_runtimes
+0000d040: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000d050: 2020 2020 6675 6e63 2e73 7461 7475 732e      func.status.
+0000d060: 6164 6472 6573 7320 3d20 7265 7370 2e68  address = resp.h
+0000d070: 6561 6465 7273 2e67 6574 2822 782d 6d6c  eaders.get("x-ml
+0000d080: 7275 6e2d 6164 6472 6573 7322 2c20 2222  run-address", ""
+0000d090: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d0a0: 2020 6675 6e63 2e73 7461 7475 732e 6e75    func.status.nu
+0000d0b0: 636c 696f 5f6e 616d 6520 3d20 7265 7370  clio_name = resp
+0000d0c0: 2e68 6561 6465 7273 2e67 6574 2822 782d  .headers.get("x-
+0000d0d0: 6d6c 7275 6e2d 6e61 6d65 222c 2022 2229  mlrun-name", "")
+0000d0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d0f0: 2066 756e 632e 7374 6174 7573 2e69 6e74   func.status.int
+0000d100: 6572 6e61 6c5f 696e 766f 6361 7469 6f6e  ernal_invocation
+0000d110: 5f75 726c 7320 3d20 7265 7370 2e68 6561  _urls = resp.hea
+0000d120: 6465 7273 2e67 6574 280a 2020 2020 2020  ders.get(.      
+0000d130: 2020 2020 2020 2020 2020 2020 2020 2278                "x
+0000d140: 2d6d 6c72 756e 2d69 6e74 6572 6e61 6c2d  -mlrun-internal-
+0000d150: 696e 766f 6361 7469 6f6e 2d75 726c 7322  invocation-urls"
+0000d160: 2c20 2222 0a20 2020 2020 2020 2020 2020  , "".           
+0000d170: 2020 2020 2029 2e73 706c 6974 2822 2c22       ).split(","
+0000d180: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d190: 2020 6675 6e63 2e73 7461 7475 732e 6578    func.status.ex
+0000d1a0: 7465 726e 616c 5f69 6e76 6f63 6174 696f  ternal_invocatio
+0000d1b0: 6e5f 7572 6c73 203d 2072 6573 702e 6865  n_urls = resp.he
+0000d1c0: 6164 6572 732e 6765 7428 0a20 2020 2020  aders.get(.     
+0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000d1e0: 782d 6d6c 7275 6e2d 6578 7465 726e 616c  x-mlrun-external
+0000d1f0: 2d69 6e76 6f63 6174 696f 6e2d 7572 6c73  -invocation-urls
+0000d200: 222c 2022 220a 2020 2020 2020 2020 2020  ", "".          
+0000d210: 2020 2020 2020 292e 7370 6c69 7428 222c        ).split(",
+0000d220: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000d230: 2020 2066 756e 632e 7374 6174 7573 2e63     func.status.c
+0000d240: 6f6e 7461 696e 6572 5f69 6d61 6765 203d  ontainer_image =
+0000d250: 2072 6573 702e 6865 6164 6572 732e 6765   resp.headers.ge
+0000d260: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0000d270: 2020 2020 2020 2022 782d 6d6c 7275 6e2d         "x-mlrun-
+0000d280: 636f 6e74 6169 6e65 722d 696d 6167 6522  container-image"
+0000d290: 2c20 2222 0a20 2020 2020 2020 2020 2020  , "".           
+0000d2a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d2b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000d2c0: 2020 2020 2020 2020 2066 756e 632e 7374           func.st
+0000d2d0: 6174 7573 2e62 7569 6c64 5f70 6f64 203d  atus.build_pod =
+0000d2e0: 2072 6573 702e 6865 6164 6572 732e 6765   resp.headers.ge
+0000d2f0: 7428 2262 7569 6c64 6572 5f70 6f64 222c  t("builder_pod",
+0000d300: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
+0000d310: 2020 2020 2066 756e 632e 7370 6563 2e69       func.spec.i
+0000d320: 6d61 6765 203d 2072 6573 702e 6865 6164  mage = resp.head
+0000d330: 6572 732e 6765 7428 2266 756e 6374 696f  ers.get("functio
+0000d340: 6e5f 696d 6167 6522 2c20 2222 290a 0a20  n_image", "").. 
+0000d350: 2020 2020 2020 2074 6578 7420 3d20 2222         text = ""
+0000d360: 0a20 2020 2020 2020 2069 6620 7265 7370  .        if resp
+0000d370: 2e63 6f6e 7465 6e74 3a0a 2020 2020 2020  .content:.      
+0000d380: 2020 2020 2020 7465 7874 203d 2072 6573        text = res
+0000d390: 702e 636f 6e74 656e 742e 6465 636f 6465  p.content.decode
+0000d3a0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+0000d3b0: 6e20 7465 7874 2c20 6c61 7374 5f6c 6f67  n text, last_log
+0000d3c0: 5f74 696d 6573 7461 6d70 0a0a 2020 2020  _timestamp..    
+0000d3d0: 6465 6620 7265 6d6f 7465 5f73 7461 7274  def remote_start
+0000d3e0: 2873 656c 662c 2066 756e 635f 7572 6c29  (self, func_url)
+0000d3f0: 202d 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e   -> mlrun.common
+0000d400: 2e73 6368 656d 6173 2e42 6163 6b67 726f  .schemas.Backgro
+0000d410: 756e 6454 6173 6b3a 0a20 2020 2020 2020  undTask:.       
+0000d420: 2022 2222 4578 6563 7574 6520 6120 6675   """Execute a fu
+0000d430: 6e63 7469 6f6e 2072 656d 6f74 656c 792c  nction remotely,
+0000d440: 2055 7365 6420 666f 7220 6060 6461 736b   Used for ``dask
+0000d450: 6060 2066 756e 6374 696f 6e73 2e0a 0a20  `` functions... 
+0000d460: 2020 2020 2020 203a 7061 7261 6d20 6675         :param fu
+0000d470: 6e63 5f75 726c 3a20 5552 4c20 746f 2074  nc_url: URL to t
+0000d480: 6865 2066 756e 6374 696f 6e20 746f 2062  he function to b
+0000d490: 6520 6578 6563 7574 6564 2e0a 2020 2020  e executed..    
+0000d4a0: 2020 2020 3a72 6574 7572 6e73 3a20 4120      :returns: A 
+0000d4b0: 4261 636b 6772 6f75 6e64 5461 736b 206f  BackgroundTask o
+0000d4c0: 626a 6563 742c 2077 6974 6820 6465 7461  bject, with deta
+0000d4d0: 696c 7320 6f6e 2065 7865 6375 7469 6f6e  ils on execution
+0000d4e0: 2070 726f 6365 7373 2061 6e64 2069 7473   process and its
+0000d4f0: 2073 7461 7475 732e 0a20 2020 2020 2020   status..       
+0000d500: 2022 2222 0a0a 2020 2020 2020 2020 7472   """..        tr
+0000d510: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+0000d520: 6571 203d 207b 2266 756e 6374 696f 6e55  eq = {"functionU
+0000d530: 726c 223a 2066 756e 635f 7572 6c7d 0a20  rl": func_url}. 
+0000d540: 2020 2020 2020 2020 2020 2072 6573 7020             resp 
+0000d550: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+0000d560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d570: 2022 504f 5354 222c 0a20 2020 2020 2020   "POST",.       
+0000d580: 2020 2020 2020 2020 2022 7374 6172 742f           "start/
+0000d590: 6675 6e63 7469 6f6e 222c 0a20 2020 2020  function",.     
+0000d5a0: 2020 2020 2020 2020 2020 206a 736f 6e3d             json=
+0000d5b0: 7265 712c 0a20 2020 2020 2020 2020 2020  req,.           
+0000d5c0: 2020 2020 2074 696d 656f 7574 3d69 6e74       timeout=int
+0000d5d0: 2863 6f6e 6669 672e 7375 626d 6974 5f74  (config.submit_t
+0000d5e0: 696d 656f 7574 2920 6f72 2036 302c 0a20  imeout) or 60,. 
+0000d5f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000d600: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+0000d610: 726f 7220 6173 2065 7272 3a0a 2020 2020  ror as err:.    
+0000d620: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
+0000d630: 7272 6f72 2866 2265 7272 6f72 2073 7461  rror(f"error sta
+0000d640: 7274 696e 6720 6675 6e63 7469 6f6e 3a20  rting function: 
+0000d650: 7b65 7272 5f74 6f5f 7374 7228 6572 7229  {err_to_str(err)
+0000d660: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000d670: 7261 6973 6520 4f53 4572 726f 7228 6622  raise OSError(f"
+0000d680: 6572 726f 723a 2063 616e 6e6f 7420 7374  error: cannot st
+0000d690: 6172 7420 6675 6e63 7469 6f6e 2c20 7b65  art function, {e
+0000d6a0: 7272 5f74 6f5f 7374 7228 6572 7229 7d22  rr_to_str(err)}"
+0000d6b0: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0000d6c0: 7420 7265 7370 2e6f 6b3a 0a20 2020 2020  t resp.ok:.     
+0000d6d0: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
+0000d6e0: 726f 7228 6622 6261 6420 7265 7370 2121  ror(f"bad resp!!
+0000d6f0: 5c6e 7b72 6573 702e 7465 7874 7d22 290a  \n{resp.text}").
+0000d700: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000d710: 6520 5661 6c75 6545 7272 6f72 2822 6261  e ValueError("ba
+0000d720: 6420 6675 6e63 7469 6f6e 2073 7461 7274  d function start
+0000d730: 2072 6573 706f 6e73 6522 290a 0a20 2020   response")..   
+0000d740: 2020 2020 2072 6574 7572 6e20 6d6c 7275       return mlru
+0000d750: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0000d760: 2e42 6163 6b67 726f 756e 6454 6173 6b28  .BackgroundTask(
+0000d770: 2a2a 7265 7370 2e6a 736f 6e28 2929 0a0a  **resp.json())..
+0000d780: 2020 2020 6465 6620 6765 745f 7072 6f6a      def get_proj
+0000d790: 6563 745f 6261 636b 6772 6f75 6e64 5f74  ect_background_t
+0000d7a0: 6173 6b28 0a20 2020 2020 2020 2073 656c  ask(.        sel
+0000d7b0: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
+0000d7c0: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
+0000d7d0: 206e 616d 653a 2073 7472 2c0a 2020 2020   name: str,.    
+0000d7e0: 2920 2d3e 206d 6c72 756e 2e63 6f6d 6d6f  ) -> mlrun.commo
+0000d7f0: 6e2e 7363 6865 6d61 732e 4261 636b 6772  n.schemas.Backgr
+0000d800: 6f75 6e64 5461 736b 3a0a 2020 2020 2020  oundTask:.      
+0000d810: 2020 2222 2252 6574 7269 6576 6520 7570    """Retrieve up
+0000d820: 6461 7465 6420 696e 666f 726d 6174 696f  dated informatio
+0000d830: 6e20 6f6e 2061 2070 726f 6a65 6374 2062  n on a project b
+0000d840: 6163 6b67 726f 756e 6420 7461 736b 2062  ackground task b
+0000d850: 6569 6e67 2065 7865 6375 7465 642e 2222  eing executed.""
+0000d860: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
+0000d870: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
+0000d880: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
+0000d890: 726f 6a65 6374 0a20 2020 2020 2020 2070  roject.        p
+0000d8a0: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+0000d8b0: 2f7b 7072 6f6a 6563 747d 2f62 6163 6b67  /{project}/backg
+0000d8c0: 726f 756e 642d 7461 736b 732f 7b6e 616d  round-tasks/{nam
+0000d8d0: 657d 220a 2020 2020 2020 2020 6572 726f  e}".        erro
+0000d8e0: 725f 6d65 7373 6167 6520 3d20 280a 2020  r_message = (.  
+0000d8f0: 2020 2020 2020 2020 2020 6622 4661 696c            f"Fail
+0000d900: 6564 2067 6574 7469 6e67 2070 726f 6a65  ed getting proje
+0000d910: 6374 2062 6163 6b67 726f 756e 6420 7461  ct background ta
+0000d920: 736b 2e20 7072 6f6a 6563 743d 7b70 726f  sk. project={pro
+0000d930: 6a65 6374 7d2c 206e 616d 653d 7b6e 616d  ject}, name={nam
+0000d940: 657d 220a 2020 2020 2020 2020 290a 2020  e}".        ).  
 0000d950: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
 0000d960: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
 0000d970: 4745 5422 2c20 7061 7468 2c20 6572 726f  GET", path, erro
 0000d980: 725f 6d65 7373 6167 6529 0a20 2020 2020  r_message).     
-0000d990: 2020 2072 6574 7572 6e20 7363 6865 6d61     return schema
-0000d9a0: 732e 4261 636b 6772 6f75 6e64 5461 736b  s.BackgroundTask
-0000d9b0: 282a 2a72 6573 706f 6e73 652e 6a73 6f6e  (**response.json
-0000d9c0: 2829 290a 0a20 2020 2064 6566 2072 656d  ())..    def rem
-0000d9d0: 6f74 655f 7374 6174 7573 2873 656c 662c  ote_status(self,
-0000d9e0: 2070 726f 6a65 6374 2c20 6e61 6d65 2c20   project, name, 
-0000d9f0: 6b69 6e64 2c20 7365 6c65 6374 6f72 293a  kind, selector):
-0000da00: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
-0000da10: 6965 7665 2073 7461 7475 7320 6f66 2061  ieve status of a
-0000da20: 2066 756e 6374 696f 6e20 6265 696e 6720   function being 
-0000da30: 6578 6563 7574 6564 2072 656d 6f74 656c  executed remotel
-0000da40: 7920 2872 656c 6576 616e 7420 746f 2060  y (relevant to `
-0000da50: 6064 6173 6b60 6020 6675 6e63 7469 6f6e  `dask`` function
-0000da60: 7329 2e0a 0a20 2020 2020 2020 203a 7061  s)...        :pa
-0000da70: 7261 6d20 7072 6f6a 6563 743a 2054 6865  ram project: The
-0000da80: 2070 726f 6a65 6374 206f 6620 7468 6520   project of the 
-0000da90: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-0000daa0: 203a 7061 7261 6d20 6e61 6d65 3a20 5468   :param name: Th
-0000dab0: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
-0000dac0: 6e63 7469 6f6e 0a20 2020 2020 2020 203a  nction.        :
-0000dad0: 7061 7261 6d20 6b69 6e64 3a20 5468 6520  param kind: The 
-0000dae0: 6b69 6e64 206f 6620 7468 6520 6675 6e63  kind of the func
-0000daf0: 7469 6f6e 2c20 6375 7272 656e 746c 7920  tion, currently 
-0000db00: 6060 6461 736b 6060 2069 7320 7375 7070  ``dask`` is supp
-0000db10: 6f72 7465 642e 0a20 2020 2020 2020 203a  orted..        :
-0000db20: 7061 7261 6d20 7365 6c65 6374 6f72 3a20  param selector: 
-0000db30: 5365 6c65 6374 6f72 2063 6c61 7573 6520  Selector clause 
-0000db40: 746f 2062 6520 6170 706c 6965 6420 746f  to be applied to
-0000db50: 2074 6865 204b 7562 6572 6e65 7465 7320   the Kubernetes 
-0000db60: 7374 6174 7573 2071 7565 7279 2074 6f20  status query to 
-0000db70: 6669 6c74 6572 2074 6865 2072 6573 756c  filter the resul
-0000db80: 7473 2e0a 2020 2020 2020 2020 2222 220a  ts..        """.
-0000db90: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000dba0: 2020 2020 2020 2020 2020 7265 7120 3d20            req = 
-0000dbb0: 7b22 6b69 6e64 223a 206b 696e 642c 2022  {"kind": kind, "
-0000dbc0: 7365 6c65 6374 6f72 223a 2073 656c 6563  selector": selec
-0000dbd0: 746f 722c 2022 7072 6f6a 6563 7422 3a20  tor, "project": 
-0000dbe0: 7072 6f6a 6563 742c 2022 6e61 6d65 223a  project, "name":
-0000dbf0: 206e 616d 657d 0a20 2020 2020 2020 2020   name}.         
-0000dc00: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
-0000dc10: 7069 5f63 616c 6c28 2250 4f53 5422 2c20  pi_call("POST", 
-0000dc20: 2273 7461 7475 732f 6675 6e63 7469 6f6e  "status/function
-0000dc30: 222c 206a 736f 6e3d 7265 7129 0a20 2020  ", json=req).   
-0000dc40: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
-0000dc50: 726f 7220 6173 2065 7272 3a0a 2020 2020  ror as err:.    
-0000dc60: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-0000dc70: 7272 6f72 2866 2265 7272 6f72 2073 7461  rror(f"error sta
-0000dc80: 7274 696e 6720 6675 6e63 7469 6f6e 3a20  rting function: 
-0000dc90: 7b65 7272 5f74 6f5f 7374 7228 6572 7229  {err_to_str(err)
-0000dca0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000dcb0: 7261 6973 6520 4f53 4572 726f 7228 6622  raise OSError(f"
-0000dcc0: 6572 726f 723a 2063 616e 6e6f 7420 7374  error: cannot st
-0000dcd0: 6172 7420 6675 6e63 7469 6f6e 2c20 7b65  art function, {e
-0000dce0: 7272 5f74 6f5f 7374 7228 6572 7229 7d22  rr_to_str(err)}"
-0000dcf0: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-0000dd00: 7420 7265 7370 2e6f 6b3a 0a20 2020 2020  t resp.ok:.     
-0000dd10: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-0000dd20: 726f 7228 6622 6261 6420 7265 7370 2121  ror(f"bad resp!!
-0000dd30: 5c6e 7b72 6573 702e 7465 7874 7d22 290a  \n{resp.text}").
-0000dd40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000dd50: 6520 5661 6c75 6545 7272 6f72 2822 6261  e ValueError("ba
-0000dd60: 6420 6675 6e63 7469 6f6e 2073 7461 7475  d function statu
-0000dd70: 7320 7265 7370 6f6e 7365 2229 0a0a 2020  s response")..  
-0000dd80: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0000dd90: 702e 6a73 6f6e 2829 5b22 6461 7461 225d  p.json()["data"]
-0000dda0: 0a0a 2020 2020 6465 6620 7375 626d 6974  ..    def submit
-0000ddb0: 5f6a 6f62 280a 2020 2020 2020 2020 7365  _job(.        se
-0000ddc0: 6c66 2c20 7275 6e73 7065 632c 2073 6368  lf, runspec, sch
-0000ddd0: 6564 756c 653a 2055 6e69 6f6e 5b73 7472  edule: Union[str
-0000dde0: 2c20 7363 6865 6d61 732e 5363 6865 6475  , schemas.Schedu
-0000ddf0: 6c65 4372 6f6e 5472 6967 6765 725d 203d  leCronTrigger] =
-0000de00: 204e 6f6e 650a 2020 2020 293a 0a20 2020   None.    ):.   
-0000de10: 2020 2020 2022 2222 5375 626d 6974 2061       """Submit a
-0000de20: 206a 6f62 2066 6f72 2072 656d 6f74 6520   job for remote 
-0000de30: 6578 6563 7574 696f 6e2e 0a0a 2020 2020  execution...    
-0000de40: 2020 2020 3a70 6172 616d 2072 756e 7370      :param runsp
-0000de50: 6563 3a20 5468 6520 7275 6e74 696d 6520  ec: The runtime 
-0000de60: 6f62 6a65 6374 2073 7065 6320 2854 6173  object spec (Tas
-0000de70: 6b29 2074 6f20 6578 6563 7574 652e 0a20  k) to execute.. 
-0000de80: 2020 2020 2020 203a 7061 7261 6d20 7363         :param sc
-0000de90: 6865 6475 6c65 3a20 5768 6574 6865 7220  hedule: Whether 
-0000dea0: 746f 2073 6368 6564 756c 6520 7468 6973  to schedule this
-0000deb0: 206a 6f62 2075 7369 6e67 2061 2043 726f   job using a Cro
-0000dec0: 6e20 7472 6967 6765 722e 2049 6620 6e6f  n trigger. If no
-0000ded0: 7420 7370 6563 6966 6965 642c 2074 6865  t specified, the
-0000dee0: 206a 6f62 2077 696c 6c20 6265 2073 7562   job will be sub
-0000def0: 6d69 7474 6564 0a20 2020 2020 2020 2020  mitted.         
-0000df00: 2020 2069 6d6d 6564 6961 7465 6c79 2e0a     immediately..
-0000df10: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000df20: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000df30: 2020 2020 2020 7265 7120 3d20 7b22 7461        req = {"ta
-0000df40: 736b 223a 2072 756e 7370 6563 2e74 6f5f  sk": runspec.to_
-0000df50: 6469 6374 2829 7d0a 2020 2020 2020 2020  dict()}.        
-0000df60: 2020 2020 6966 2073 6368 6564 756c 653a      if schedule:
-0000df70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000df80: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-0000df90: 6368 6564 756c 652c 2073 6368 656d 6173  chedule, schemas
-0000dfa0: 2e53 6368 6564 756c 6543 726f 6e54 7269  .ScheduleCronTri
-0000dfb0: 6767 6572 293a 0a20 2020 2020 2020 2020  gger):.         
-0000dfc0: 2020 2020 2020 2020 2020 2073 6368 6564             sched
-0000dfd0: 756c 6520 3d20 7363 6865 6475 6c65 2e64  ule = schedule.d
-0000dfe0: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
-0000dff0: 2020 2020 2020 7265 715b 2273 6368 6564        req["sched
-0000e000: 756c 6522 5d20 3d20 7363 6865 6475 6c65  ule"] = schedule
-0000e010: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-0000e020: 656f 7574 203d 2028 696e 7428 636f 6e66  eout = (int(conf
-0000e030: 6967 2e73 7562 6d69 745f 7469 6d65 6f75  ig.submit_timeou
-0000e040: 7429 206f 7220 3132 3029 202b 2032 300a  t) or 120) + 20.
-0000e050: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-0000e060: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-0000e070: 2822 504f 5354 222c 2022 7375 626d 6974  ("POST", "submit
-0000e080: 5f6a 6f62 222c 206a 736f 6e3d 7265 712c  _job", json=req,
-0000e090: 2074 696d 656f 7574 3d74 696d 656f 7574   timeout=timeout
-0000e0a0: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-0000e0b0: 7420 7265 7175 6573 7473 2e48 5454 5045  t requests.HTTPE
-0000e0c0: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
-0000e0d0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000e0e0: 6572 726f 7228 6622 6572 726f 7220 7375  error(f"error su
-0000e0f0: 626d 6974 7469 6e67 2074 6173 6b3a 207b  bmitting task: {
-0000e100: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
-0000e110: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-0000e120: 206e 6f74 2063 7265 6174 696e 6720 6120   not creating a 
-0000e130: 6e65 7720 6578 6365 7074 696f 6e20 6865  new exception he
-0000e140: 7265 2c20 696e 206f 7264 6572 2074 6f20  re, in order to 
-0000e150: 6b65 6570 2074 6865 2072 6573 706f 6e73  keep the respons
-0000e160: 6520 616e 6420 7374 6174 7573 2063 6f64  e and status cod
-0000e170: 6520 696e 2074 6865 2065 7863 6570 7469  e in the excepti
-0000e180: 6f6e 0a20 2020 2020 2020 2020 2020 2072  on.            r
-0000e190: 6169 7365 0a0a 2020 2020 2020 2020 6578  aise..        ex
-0000e1a0: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
-0000e1b0: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
-0000e1c0: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
-0000e1d0: 6572 726f 7220 7375 626d 6974 7469 6e67  error submitting
-0000e1e0: 2074 6173 6b3a 207b 6572 725f 746f 5f73   task: {err_to_s
-0000e1f0: 7472 2865 7272 297d 2229 0a20 2020 2020  tr(err)}").     
-0000e200: 2020 2020 2020 2072 6169 7365 204f 5345         raise OSE
-0000e210: 7272 6f72 2822 6572 726f 723a 2063 616e  rror("error: can
-0000e220: 6e6f 7420 7375 626d 6974 2074 6173 6b22  not submit task"
-0000e230: 2920 6672 6f6d 2065 7272 0a0a 2020 2020  ) from err..    
-0000e240: 2020 2020 6966 206e 6f74 2072 6573 702e      if not resp.
-0000e250: 6f6b 3a0a 2020 2020 2020 2020 2020 2020  ok:.            
-0000e260: 6c6f 6767 6572 2e65 7272 6f72 2866 2262  logger.error(f"b
-0000e270: 6164 2072 6573 7021 215c 6e7b 7265 7370  ad resp!!\n{resp
-0000e280: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
-0000e290: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000e2a0: 4572 726f 7228 6622 6261 6420 6675 6e63  Error(f"bad func
-0000e2b0: 7469 6f6e 2072 756e 2072 6573 706f 6e73  tion run respons
-0000e2c0: 652c 207b 7265 7370 2e74 6578 747d 2229  e, {resp.text}")
-0000e2d0: 0a0a 2020 2020 2020 2020 7265 7370 203d  ..        resp =
-0000e2e0: 2072 6573 702e 6a73 6f6e 2829 0a20 2020   resp.json().   
-0000e2f0: 2020 2020 2072 6574 7572 6e20 7265 7370       return resp
-0000e300: 5b22 6461 7461 225d 0a0a 2020 2020 6465  ["data"]..    de
-0000e310: 6620 7375 626d 6974 5f70 6970 656c 696e  f submit_pipelin
-0000e320: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0000e330: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-0000e340: 2c0a 2020 2020 2020 2020 7069 7065 6c69  ,.        pipeli
-0000e350: 6e65 2c0a 2020 2020 2020 2020 6172 6775  ne,.        argu
-0000e360: 6d65 6e74 733d 4e6f 6e65 2c0a 2020 2020  ments=None,.    
-0000e370: 2020 2020 6578 7065 7269 6d65 6e74 3d4e      experiment=N
-0000e380: 6f6e 652c 0a20 2020 2020 2020 2072 756e  one,.        run
-0000e390: 3d4e 6f6e 652c 0a20 2020 2020 2020 206e  =None,.        n
-0000e3a0: 616d 6573 7061 6365 3d4e 6f6e 652c 0a20  amespace=None,. 
-0000e3b0: 2020 2020 2020 2061 7274 6966 6163 745f         artifact_
-0000e3c0: 7061 7468 3d4e 6f6e 652c 0a20 2020 2020  path=None,.     
-0000e3d0: 2020 206f 7073 3d4e 6f6e 652c 0a20 2020     ops=None,.   
-0000e3e0: 2020 2020 2023 2054 4f44 4f3a 2064 6570       # TODO: dep
-0000e3f0: 7265 6361 7465 642c 2072 656d 6f76 6520  recated, remove 
-0000e400: 696e 2031 2e35 2e30 0a20 2020 2020 2020  in 1.5.0.       
-0000e410: 2074 746c 3d4e 6f6e 652c 0a20 2020 2020   ttl=None,.     
-0000e420: 2020 2063 6c65 616e 7570 5f74 746c 3d4e     cleanup_ttl=N
-0000e430: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-0000e440: 2020 2020 2222 2253 7562 6d69 7420 6120      """Submit a 
-0000e450: 4b46 5020 7069 7065 6c69 6e65 2066 6f72  KFP pipeline for
-0000e460: 2065 7865 6375 7469 6f6e 2e0a 0a20 2020   execution...   
-0000e470: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
-0000e480: 6563 743a 2054 6865 2070 726f 6a65 6374  ect: The project
-0000e490: 206f 6620 7468 6520 7069 7065 6c69 6e65   of the pipeline
-0000e4a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000e4b0: 7069 7065 6c69 6e65 3a20 5069 7065 6c69  pipeline: Pipeli
-0000e4c0: 6e65 2066 756e 6374 696f 6e20 6f72 2070  ne function or p
-0000e4d0: 6174 6820 746f 202e 7961 6d6c 2f2e 7a69  ath to .yaml/.zi
-0000e4e0: 7020 7069 7065 6c69 6e65 2066 696c 652e  p pipeline file.
-0000e4f0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000e500: 6172 6775 6d65 6e74 733a 2041 2064 6963  arguments: A dic
-0000e510: 7469 6f6e 6172 7920 6f66 2061 7267 756d  tionary of argum
-0000e520: 656e 7473 2074 6f20 7061 7373 2074 6f20  ents to pass to 
-0000e530: 7468 6520 7069 7065 6c69 6e65 2e0a 2020  the pipeline..  
-0000e540: 2020 2020 2020 3a70 6172 616d 2065 7870        :param exp
-0000e550: 6572 696d 656e 743a 2041 206e 616d 6520  eriment: A name 
-0000e560: 746f 2061 7373 6967 6e20 666f 7220 7468  to assign for th
-0000e570: 6520 7370 6563 6966 6963 2065 7870 6572  e specific exper
-0000e580: 696d 656e 742e 0a20 2020 2020 2020 203a  iment..        :
-0000e590: 7061 7261 6d20 7275 6e3a 2041 206e 616d  param run: A nam
-0000e5a0: 6520 666f 7220 7468 6973 2073 7065 6369  e for this speci
-0000e5b0: 6669 6320 7275 6e2e 0a20 2020 2020 2020  fic run..       
-0000e5c0: 203a 7061 7261 6d20 6e61 6d65 7370 6163   :param namespac
-0000e5d0: 653a 204b 7562 6572 6e65 7465 7320 6e61  e: Kubernetes na
-0000e5e0: 6d65 7370 6163 6520 746f 2065 7865 6375  mespace to execu
-0000e5f0: 7465 2074 6865 2070 6970 656c 696e 6520  te the pipeline 
-0000e600: 696e 2e0a 2020 2020 2020 2020 3a70 6172  in..        :par
-0000e610: 616d 2061 7274 6966 6163 745f 7061 7468  am artifact_path
-0000e620: 3a20 4120 7061 7468 2074 6f20 6172 7469  : A path to arti
-0000e630: 6661 6374 7320 7573 6564 2062 7920 7468  facts used by th
-0000e640: 6973 2070 6970 656c 696e 652e 0a20 2020  is pipeline..   
-0000e650: 2020 2020 203a 7061 7261 6d20 6f70 733a       :param ops:
-0000e660: 2054 7261 6e73 666f 726d 6572 7320 746f   Transformers to
-0000e670: 2061 7070 6c79 206f 6e20 616c 6c20 6f70   apply on all op
-0000e680: 7320 696e 2074 6865 2070 6970 656c 696e  s in the pipelin
-0000e690: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0000e6a0: 6d20 7474 6c3a 2070 6970 656c 696e 6520  m ttl: pipeline 
-0000e6b0: 636c 6561 6e75 7020 7474 6c20 696e 2073  cleanup ttl in s
-0000e6c0: 6563 7320 2874 696d 6520 746f 2077 6169  ecs (time to wai
-0000e6d0: 7420 6166 7465 7220 776f 726b 666c 6f77  t after workflow
-0000e6e0: 2063 6f6d 706c 6574 696f 6e2c 2061 7420   completion, at 
-0000e6f0: 7768 6963 6820 706f 696e 7420 7468 6520  which point the 
-0000e700: 776f 726b 666c 6f77 0a20 2020 2020 2020  workflow.       
-0000e710: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0000e720: 2061 6c6c 2069 7473 2072 6573 6f75 7263   all its resourc
-0000e730: 6573 2061 7265 2064 656c 6574 6564 2920  es are deleted) 
-0000e740: 2864 6570 7265 6361 7465 642c 2075 7365  (deprecated, use
-0000e750: 2063 6c65 616e 7570 5f74 746c 2069 6e73   cleanup_ttl ins
-0000e760: 7465 6164 290a 2020 2020 2020 2020 3a70  tead).        :p
-0000e770: 6172 616d 2063 6c65 616e 7570 5f74 746c  aram cleanup_ttl
-0000e780: 3a20 7069 7065 6c69 6e65 2063 6c65 616e  : pipeline clean
-0000e790: 7570 2074 746c 2069 6e20 7365 6373 2028  up ttl in secs (
-0000e7a0: 7469 6d65 2074 6f20 7761 6974 2061 6674  time to wait aft
-0000e7b0: 6572 2077 6f72 6b66 6c6f 7720 636f 6d70  er workflow comp
-0000e7c0: 6c65 7469 6f6e 2c20 6174 2077 6869 6368  letion, at which
-0000e7d0: 2070 6f69 6e74 2074 6865 0a20 2020 2020   point the.     
-0000e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7f0: 2020 2020 2020 2077 6f72 6b66 6c6f 7720         workflow 
-0000e800: 616e 6420 616c 6c20 6974 7320 7265 736f  and all its reso
-0000e810: 7572 6365 7320 6172 6520 6465 6c65 7465  urces are delete
-0000e820: 6429 0a20 2020 2020 2020 2022 2222 0a0a  d).        """..
-0000e830: 2020 2020 2020 2020 6966 2074 746c 3a0a          if ttl:.
-0000e840: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0000e850: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
-0000e860: 2020 2020 2020 2020 2020 2022 2774 746c             "'ttl
-0000e870: 2720 6973 2064 6570 7265 6361 7465 642c  ' is deprecated,
-0000e880: 2075 7365 2027 636c 6561 6e75 705f 7474   use 'cleanup_tt
-0000e890: 6c27 2069 6e73 7465 6164 2e20 220a 2020  l' instead. ".  
-0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2254                "T
-0000e8b0: 6869 7320 7769 6c6c 2062 6520 7265 6d6f  his will be remo
-0000e8c0: 7665 6420 696e 2031 2e35 2e30 222c 0a20  ved in 1.5.0",. 
-0000e8d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000e8e0: 2054 4f44 4f3a 2052 656d 6f76 6520 7468   TODO: Remove th
-0000e8f0: 6973 2069 6e20 312e 352e 300a 2020 2020  is in 1.5.0.    
-0000e900: 2020 2020 2020 2020 2020 2020 4675 7475              Futu
-0000e910: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
-0000e920: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000e930: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000e940: 7069 7065 6c69 6e65 2c20 7374 7229 3a0a  pipeline, str):.
-0000e950: 2020 2020 2020 2020 2020 2020 7069 7065              pipe
-0000e960: 5f66 696c 6520 3d20 7069 7065 6c69 6e65  _file = pipeline
-0000e970: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000e980: 2020 2020 2020 2020 2020 2070 6970 655f             pipe_
-0000e990: 6669 6c65 203d 2074 656d 7066 696c 652e  file = tempfile.
-0000e9a0: 4e61 6d65 6454 656d 706f 7261 7279 4669  NamedTemporaryFi
-0000e9b0: 6c65 2873 7566 6669 783d 222e 7961 6d6c  le(suffix=".yaml
-0000e9c0: 222c 2064 656c 6574 653d 4661 6c73 6529  ", delete=False)
-0000e9d0: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
-0000e9e0: 2020 636f 6e66 203d 206e 6577 5f70 6970    conf = new_pip
-0000e9f0: 655f 6d65 7461 6461 7461 280a 2020 2020  e_metadata(.    
-0000ea00: 2020 2020 2020 2020 2020 2020 6172 7469              arti
-0000ea10: 6661 6374 5f70 6174 683d 6172 7469 6661  fact_path=artifa
-0000ea20: 6374 5f70 6174 682c 0a20 2020 2020 2020  ct_path,.       
-0000ea30: 2020 2020 2020 2020 2063 6c65 616e 7570           cleanup
-0000ea40: 5f74 746c 3d63 6c65 616e 7570 5f74 746c  _ttl=cleanup_ttl
-0000ea50: 206f 7220 7474 6c2c 0a20 2020 2020 2020   or ttl,.       
-0000ea60: 2020 2020 2020 2020 206f 705f 7472 616e           op_tran
-0000ea70: 7366 6f72 6d65 7273 3d6f 7073 2c0a 2020  sformers=ops,.  
-0000ea80: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000ea90: 2020 2020 2020 2020 6b66 702e 636f 6d70          kfp.comp
-0000eaa0: 696c 6572 2e43 6f6d 7069 6c65 7228 292e  iler.Compiler().
-0000eab0: 636f 6d70 696c 6528 0a20 2020 2020 2020  compile(.       
-0000eac0: 2020 2020 2020 2020 2070 6970 656c 696e           pipelin
-0000ead0: 652c 2070 6970 655f 6669 6c65 2c20 7479  e, pipe_file, ty
-0000eae0: 7065 5f63 6865 636b 3d46 616c 7365 2c20  pe_check=False, 
-0000eaf0: 7069 7065 6c69 6e65 5f63 6f6e 663d 636f  pipeline_conf=co
-0000eb00: 6e66 0a20 2020 2020 2020 2020 2020 2029  nf.            )
-0000eb10: 0a0a 2020 2020 2020 2020 6966 2070 6970  ..        if pip
-0000eb20: 655f 6669 6c65 2e65 6e64 7377 6974 6828  e_file.endswith(
-0000eb30: 222e 7961 6d6c 2229 3a0a 2020 2020 2020  ".yaml"):.      
-0000eb40: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-0000eb50: 7b22 636f 6e74 656e 742d 7479 7065 223a  {"content-type":
-0000eb60: 2022 6170 706c 6963 6174 696f 6e2f 7961   "application/ya
-0000eb70: 6d6c 227d 0a20 2020 2020 2020 2065 6c69  ml"}.        eli
-0000eb80: 6620 7069 7065 5f66 696c 652e 656e 6473  f pipe_file.ends
-0000eb90: 7769 7468 2822 2e7a 6970 2229 3a0a 2020  with(".zip"):.  
-0000eba0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-0000ebb0: 7320 3d20 7b22 636f 6e74 656e 742d 7479  s = {"content-ty
-0000ebc0: 7065 223a 2022 6170 706c 6963 6174 696f  pe": "applicatio
-0000ebd0: 6e2f 7a69 7022 7d0a 2020 2020 2020 2020  n/zip"}.        
-0000ebe0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000ebf0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000ec00: 6f72 2822 7069 7065 6c69 6e65 2066 696c  or("pipeline fil
-0000ec10: 6520 6d75 7374 2062 6520 2e79 616d 6c20  e must be .yaml 
-0000ec20: 6f72 202e 7a69 7022 290a 2020 2020 2020  or .zip").      
-0000ec30: 2020 6966 2061 7267 756d 656e 7473 3a0a    if arguments:.
-0000ec40: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000ec50: 6f74 2069 7369 6e73 7461 6e63 6528 6172  ot isinstance(ar
-0000ec60: 6775 6d65 6e74 732c 2064 6963 7429 3a0a  guments, dict):.
-0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec80: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000ec90: 2822 6172 6775 6d65 6e74 7320 6d75 7374  ("arguments must
-0000eca0: 2062 6520 6469 6374 2074 7970 6522 290a   be dict type").
-0000ecb0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-0000ecc0: 6572 735b 7363 6865 6d61 732e 4865 6164  ers[schemas.Head
-0000ecd0: 6572 4e61 6d65 732e 7069 7065 6c69 6e65  erNames.pipeline
-0000ece0: 5f61 7267 756d 656e 7473 5d20 3d20 7374  _arguments] = st
-0000ecf0: 7228 6172 6775 6d65 6e74 7329 0a0a 2020  r(arguments)..  
-0000ed00: 2020 2020 2020 6966 206e 6f74 2070 6174        if not pat
-0000ed10: 682e 6973 6669 6c65 2870 6970 655f 6669  h.isfile(pipe_fi
-0000ed20: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-0000ed30: 2072 6169 7365 204f 5345 7272 6f72 2866   raise OSError(f
-0000ed40: 2266 696c 6520 7b70 6970 655f 6669 6c65  "file {pipe_file
-0000ed50: 7d20 646f 6573 6e74 2065 7869 7374 2229  } doesnt exist")
-0000ed60: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-0000ed70: 656e 2870 6970 655f 6669 6c65 2c20 2272  en(pipe_file, "r
-0000ed80: 6222 2920 6173 2066 703a 0a20 2020 2020  b") as fp:.     
-0000ed90: 2020 2020 2020 2064 6174 6120 3d20 6670         data = fp
-0000eda0: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-0000edb0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000edc0: 6528 7069 7065 6c69 6e65 2c20 7374 7229  e(pipeline, str)
-0000edd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000ede0: 6d6f 7665 2870 6970 655f 6669 6c65 290a  move(pipe_file).
-0000edf0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000ee00: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000ee10: 203d 207b 226e 616d 6573 7061 6365 223a   = {"namespace":
-0000ee20: 206e 616d 6573 7061 6365 2c20 2265 7870   namespace, "exp
-0000ee30: 6572 696d 656e 7422 3a20 6578 7065 7269  eriment": experi
-0000ee40: 6d65 6e74 2c20 2272 756e 223a 2072 756e  ment, "run": run
-0000ee50: 7d0a 2020 2020 2020 2020 2020 2020 7265  }.            re
-0000ee60: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
-0000ee70: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-0000ee80: 2020 2020 2250 4f53 5422 2c0a 2020 2020      "POST",.    
-0000ee90: 2020 2020 2020 2020 2020 2020 6622 7072              f"pr
-0000eea0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
-0000eeb0: 2f70 6970 656c 696e 6573 222c 0a20 2020  /pipelines",.   
-0000eec0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000eed0: 616d 733d 7061 7261 6d73 2c0a 2020 2020  ams=params,.    
-0000eee0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-0000eef0: 6f75 743d 3230 2c0a 2020 2020 2020 2020  out=20,.        
-0000ef00: 2020 2020 2020 2020 626f 6479 3d64 6174          body=dat
-0000ef10: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
-0000ef20: 2020 2068 6561 6465 7273 3d68 6561 6465     headers=heade
-0000ef30: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-0000ef40: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0000ef50: 204f 5345 7272 6f72 2061 7320 6572 723a   OSError as err:
-0000ef60: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000ef70: 6765 722e 6572 726f 7228 6622 6572 726f  ger.error(f"erro
-0000ef80: 7220 6361 6e6e 6f74 2073 7562 6d69 7420  r cannot submit 
-0000ef90: 7069 7065 6c69 6e65 3a20 7b65 7272 5f74  pipeline: {err_t
-0000efa0: 6f5f 7374 7228 6572 7229 7d22 290a 2020  o_str(err)}").  
-0000efb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000efc0: 4f53 4572 726f 7228 6622 6572 726f 723a  OSError(f"error:
-0000efd0: 2063 616e 6e6f 7420 6361 6e6e 6f74 2073   cannot cannot s
-0000efe0: 7562 6d69 7420 7069 7065 6c69 6e65 2c20  ubmit pipeline, 
-0000eff0: 7b65 7272 5f74 6f5f 7374 7228 6572 7229  {err_to_str(err)
-0000f000: 7d22 290a 0a20 2020 2020 2020 2069 6620  }")..        if 
-0000f010: 6e6f 7420 7265 7370 2e6f 6b3a 0a20 2020  not resp.ok:.   
-0000f020: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000f030: 6572 726f 7228 6622 6261 6420 7265 7370  error(f"bad resp
-0000f040: 2121 5c6e 7b72 6573 702e 7465 7874 7d22  !!\n{resp.text}"
-0000f050: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
-0000f060: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-0000f070: 2262 6164 2073 7562 6d69 7420 7069 7065  "bad submit pipe
-0000f080: 6c69 6e65 2072 6573 706f 6e73 652c 207b  line response, {
-0000f090: 7265 7370 2e74 6578 747d 2229 0a0a 2020  resp.text}")..  
-0000f0a0: 2020 2020 2020 7265 7370 203d 2072 6573        resp = res
-0000f0b0: 702e 6a73 6f6e 2829 0a20 2020 2020 2020  p.json().       
-0000f0c0: 206c 6f67 6765 722e 696e 666f 2866 2273   logger.info(f"s
-0000f0d0: 7562 6d69 7474 6564 2070 6970 656c 696e  ubmitted pipelin
-0000f0e0: 6520 7b72 6573 705b 276e 616d 6527 5d7d  e {resp['name']}
-0000f0f0: 2069 643d 7b72 6573 705b 2769 6427 5d7d   id={resp['id']}
-0000f100: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-0000f110: 6e20 7265 7370 5b22 6964 225d 0a0a 2020  n resp["id"]..  
-0000f120: 2020 6465 6620 6c69 7374 5f70 6970 656c    def list_pipel
-0000f130: 696e 6573 280a 2020 2020 2020 2020 7365  ines(.        se
-0000f140: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
-0000f150: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
-0000f160: 2020 6e61 6d65 7370 6163 653a 2073 7472    namespace: str
-0000f170: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000f180: 2073 6f72 745f 6279 3a20 7374 7220 3d20   sort_by: str = 
-0000f190: 2222 2c0a 2020 2020 2020 2020 7061 6765  "",.        page
-0000f1a0: 5f74 6f6b 656e 3a20 7374 7220 3d20 2222  _token: str = ""
-0000f1b0: 2c0a 2020 2020 2020 2020 6669 6c74 6572  ,.        filter
-0000f1c0: 5f3a 2073 7472 203d 2022 222c 0a20 2020  _: str = "",.   
-0000f1d0: 2020 2020 2066 6f72 6d61 745f 3a20 556e       format_: Un
-0000f1e0: 696f 6e5b 0a20 2020 2020 2020 2020 2020  ion[.           
-0000f1f0: 2073 7472 2c20 6d6c 7275 6e2e 6170 692e   str, mlrun.api.
-0000f200: 7363 6865 6d61 732e 5069 7065 6c69 6e65  schemas.Pipeline
-0000f210: 7346 6f72 6d61 740a 2020 2020 2020 2020  sFormat.        
-0000f220: 5d20 3d20 6d6c 7275 6e2e 6170 692e 7363  ] = mlrun.api.sc
-0000f230: 6865 6d61 732e 5069 7065 6c69 6e65 7346  hemas.PipelinesF
-0000f240: 6f72 6d61 742e 6d65 7461 6461 7461 5f6f  ormat.metadata_o
-0000f250: 6e6c 792c 0a20 2020 2020 2020 2070 6167  nly,.        pag
-0000f260: 655f 7369 7a65 3a20 696e 7420 3d20 4e6f  e_size: int = No
-0000f270: 6e65 2c0a 2020 2020 2920 2d3e 206d 6c72  ne,.    ) -> mlr
-0000f280: 756e 2e61 7069 2e73 6368 656d 6173 2e50  un.api.schemas.P
-0000f290: 6970 656c 696e 6573 4f75 7470 7574 3a0a  ipelinesOutput:.
-0000f2a0: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
-0000f2b0: 6576 6520 6120 6c69 7374 206f 6620 4b46  eve a list of KF
-0000f2c0: 5020 7069 7065 6c69 6e65 732e 2054 6869  P pipelines. Thi
-0000f2d0: 7320 6675 6e63 7469 6f6e 2063 616e 2062  s function can b
-0000f2e0: 6520 696e 766f 6b65 6420 746f 2067 6574  e invoked to get
-0000f2f0: 2061 6c6c 2070 6970 656c 696e 6573 2066   all pipelines f
-0000f300: 726f 6d20 616c 6c20 7072 6f6a 6563 7473  rom all projects
-0000f310: 2c0a 2020 2020 2020 2020 6279 2073 7065  ,.        by spe
-0000f320: 6369 6679 696e 6720 6060 7072 6f6a 6563  cifying ``projec
-0000f330: 743d 2a60 602c 2069 6e20 7768 6963 6820  t=*``, in which 
-0000f340: 6361 7365 2070 6167 696e 6174 696f 6e20  case pagination 
-0000f350: 6361 6e20 6265 2075 7365 6420 616e 6420  can be used and 
-0000f360: 7468 6520 7661 7269 6f75 7320 736f 7274  the various sort
-0000f370: 696e 6720 616e 6420 7061 6769 6e61 7469  ing and paginati
-0000f380: 6f6e 0a20 2020 2020 2020 2070 726f 7065  on.        prope
-0000f390: 7274 6965 7320 6361 6e20 6265 2061 7070  rties can be app
-0000f3a0: 6c69 6564 2e20 4966 2061 2073 7065 6369  lied. If a speci
-0000f3b0: 6669 6320 7072 6f6a 6563 7420 6973 2072  fic project is r
-0000f3c0: 6571 7565 7374 6564 2c20 7468 656e 2074  equested, then t
-0000f3d0: 6865 2070 6167 696e 6174 696f 6e20 6f70  he pagination op
-0000f3e0: 7469 6f6e 7320 6361 6e6e 6f74 2062 650a  tions cannot be.
-0000f3f0: 2020 2020 2020 2020 7573 6564 2061 6e64          used and
-0000f400: 2070 6167 696e 6174 696f 6e20 6973 206e   pagination is n
-0000f410: 6f74 2061 7070 6c69 6564 2e0a 0a20 2020  ot applied...   
-0000f420: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
-0000f430: 6563 743a 2050 726f 6a65 6374 206e 616d  ect: Project nam
-0000f440: 652e 2043 616e 2062 6520 6060 2a60 6020  e. Can be ``*`` 
-0000f450: 666f 7220 7175 6572 7920 6163 726f 7373  for query across
-0000f460: 2061 6c6c 2070 726f 6a65 6374 732e 0a20   all projects.. 
-0000f470: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
-0000f480: 6d65 7370 6163 653a 204b 7562 6572 6e65  mespace: Kuberne
-0000f490: 7465 7320 6e61 6d65 7370 6163 6520 696e  tes namespace in
-0000f4a0: 2077 6869 6368 2074 6865 2070 6970 656c   which the pipel
-0000f4b0: 696e 6573 2061 7265 2065 7865 6375 7469  ines are executi
-0000f4c0: 6e67 2e0a 2020 2020 2020 2020 3a70 6172  ng..        :par
-0000f4d0: 616d 2073 6f72 745f 6279 3a20 4669 656c  am sort_by: Fiel
-0000f4e0: 6420 746f 2073 6f72 7420 7468 6520 7265  d to sort the re
-0000f4f0: 7375 6c74 7320 6279 2e0a 2020 2020 2020  sults by..      
-0000f500: 2020 3a70 6172 616d 2070 6167 655f 746f    :param page_to
-0000f510: 6b65 6e3a 2055 7365 2066 6f72 2070 6167  ken: Use for pag
-0000f520: 696e 6174 696f 6e2c 2074 6f20 7265 7472  ination, to retr
-0000f530: 6965 7665 206e 6578 7420 7061 6765 2e0a  ieve next page..
-0000f540: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-0000f550: 696c 7465 725f 3a20 4b75 6265 726e 6574  ilter_: Kubernet
-0000f560: 6573 2066 696c 7465 7220 746f 2061 7070  es filter to app
-0000f570: 6c79 2074 6f20 7468 6520 7175 6572 792c  ly to the query,
-0000f580: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
-0000f590: 6669 6c74 6572 206f 6e20 7370 6563 6966  filter on specif
-0000f5a0: 6963 206f 626a 6563 7420 6669 656c 6473  ic object fields
-0000f5b0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000f5c0: 2066 6f72 6d61 745f 3a20 5265 7375 6c74   format_: Result
-0000f5d0: 2066 6f72 6d61 742e 2043 616e 2062 6520   format. Can be 
-0000f5e0: 6f6e 6520 6f66 3a0a 0a20 2020 2020 2020  one of:..       
-0000f5f0: 2020 2020 202d 2060 6066 756c 6c60 6020       - ``full`` 
-0000f600: 2d20 7265 7475 726e 2074 6865 2066 756c  - return the ful
-0000f610: 6c20 6f62 6a65 6374 732e 0a20 2020 2020  l objects..     
-0000f620: 2020 2020 2020 202d 2060 606d 6574 6164         - ``metad
-0000f630: 6174 615f 6f6e 6c79 6060 2028 6465 6661  ata_only`` (defa
-0000f640: 756c 7429 202d 2072 6574 7572 6e20 6a75  ult) - return ju
-0000f650: 7374 206d 6574 6164 6174 6120 6f66 2074  st metadata of t
-0000f660: 6865 2070 6970 656c 696e 6573 206f 626a  he pipelines obj
-0000f670: 6563 7473 2e0a 2020 2020 2020 2020 2020  ects..          
-0000f680: 2020 2d20 6060 6e61 6d65 5f6f 6e6c 7960    - ``name_only`
-0000f690: 6020 2d20 7265 7475 726e 206a 7573 7420  ` - return just 
-0000f6a0: 7468 6520 6e61 6d65 7320 6f66 2074 6865  the names of the
-0000f6b0: 2070 6970 656c 696e 6520 6f62 6a65 6374   pipeline object
-0000f6c0: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-0000f6d0: 6d20 7061 6765 5f73 697a 653a 2053 697a  m page_size: Siz
-0000f6e0: 6520 6f66 2061 2073 696e 676c 6520 7061  e of a single pa
-0000f6f0: 6765 2077 6865 6e20 6170 706c 7969 6e67  ge when applying
-0000f700: 2070 6167 696e 6174 696f 6e2e 0a20 2020   pagination..   
-0000f710: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0000f720: 2020 6966 2070 726f 6a65 6374 2021 3d20    if project != 
-0000f730: 222a 2220 616e 6420 2870 6167 655f 746f  "*" and (page_to
-0000f740: 6b65 6e20 6f72 2070 6167 655f 7369 7a65  ken or page_size
-0000f750: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000f760: 6169 7365 206d 6c72 756e 2e65 7272 6f72  aise mlrun.error
-0000f770: 732e 4d4c 5275 6e49 6e76 616c 6964 4172  s.MLRunInvalidAr
-0000f780: 6775 6d65 6e74 4572 726f 7228 0a20 2020  gumentError(.   
-0000f790: 2020 2020 2020 2020 2020 2020 2022 4669               "Fi
-0000f7a0: 6c74 6572 696e 6720 6279 2070 726f 6a65  ltering by proje
-0000f7b0: 6374 2063 616e 206e 6f74 2062 6520 7573  ct can not be us
-0000f7c0: 6564 2074 6f67 6574 6865 7220 7769 7468  ed together with
-0000f7d0: 2070 6167 696e 6174 696f 6e22 0a20 2020   pagination".   
-0000f7e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000f7f0: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
-0000f800: 2020 2020 2020 2020 2020 226e 616d 6573            "names
-0000f810: 7061 6365 223a 206e 616d 6573 7061 6365  pace": namespace
-0000f820: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-0000f830: 6f72 745f 6279 223a 2073 6f72 745f 6279  ort_by": sort_by
-0000f840: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
-0000f850: 6167 655f 746f 6b65 6e22 3a20 7061 6765  age_token": page
-0000f860: 5f74 6f6b 656e 2c0a 2020 2020 2020 2020  _token,.        
-0000f870: 2020 2020 2266 696c 7465 7222 3a20 6669      "filter": fi
-0000f880: 6c74 6572 5f2c 0a20 2020 2020 2020 2020  lter_,.         
-0000f890: 2020 2022 666f 726d 6174 223a 2066 6f72     "format": for
-0000f8a0: 6d61 745f 2c0a 2020 2020 2020 2020 2020  mat_,.          
-0000f8b0: 2020 2270 6167 655f 7369 7a65 223a 2070    "page_size": p
-0000f8c0: 6167 655f 7369 7a65 2c0a 2020 2020 2020  age_size,.      
-0000f8d0: 2020 7d0a 0a20 2020 2020 2020 2065 7272    }..        err
-0000f8e0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-0000f8f0: 6169 6c65 6420 6c69 7374 696e 6720 7069  ailed listing pi
-0000f900: 7065 6c69 6e65 732c 2071 7565 7279 3a20  pelines, query: 
-0000f910: 7b70 6172 616d 737d 220a 2020 2020 2020  {params}".      
-0000f920: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
-0000f930: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-0000f940: 2020 2020 2020 2020 2247 4554 222c 2066          "GET", f
-0000f950: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-0000f960: 6374 7d2f 7069 7065 6c69 6e65 7322 2c20  ct}/pipelines", 
-0000f970: 6572 726f 725f 6d65 7373 6167 652c 2070  error_message, p
-0000f980: 6172 616d 733d 7061 7261 6d73 0a20 2020  arams=params.   
-0000f990: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0000f9a0: 6574 7572 6e20 6d6c 7275 6e2e 6170 692e  eturn mlrun.api.
-0000f9b0: 7363 6865 6d61 732e 5069 7065 6c69 6e65  schemas.Pipeline
-0000f9c0: 734f 7574 7075 7428 2a2a 7265 7370 6f6e  sOutput(**respon
-0000f9d0: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
-0000f9e0: 6465 6620 6765 745f 7069 7065 6c69 6e65  def get_pipeline
-0000f9f0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000fa00: 2020 2020 2020 2020 7275 6e5f 6964 3a20          run_id: 
-0000fa10: 7374 722c 0a20 2020 2020 2020 206e 616d  str,.        nam
-0000fa20: 6573 7061 6365 3a20 7374 7220 3d20 4e6f  espace: str = No
-0000fa30: 6e65 2c0a 2020 2020 2020 2020 7469 6d65  ne,.        time
-0000fa40: 6f75 743a 2069 6e74 203d 2031 302c 0a20  out: int = 10,. 
-0000fa50: 2020 2020 2020 2066 6f72 6d61 745f 3a20         format_: 
-0000fa60: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
-0000fa70: 2020 2073 7472 2c20 6d6c 7275 6e2e 6170     str, mlrun.ap
-0000fa80: 692e 7363 6865 6d61 732e 5069 7065 6c69  i.schemas.Pipeli
-0000fa90: 6e65 7346 6f72 6d61 740a 2020 2020 2020  nesFormat.      
-0000faa0: 2020 5d20 3d20 6d6c 7275 6e2e 6170 692e    ] = mlrun.api.
-0000fab0: 7363 6865 6d61 732e 5069 7065 6c69 6e65  schemas.Pipeline
-0000fac0: 7346 6f72 6d61 742e 7375 6d6d 6172 792c  sFormat.summary,
-0000fad0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-0000fae0: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
-0000faf0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0000fb00: 5265 7472 6965 7665 2064 6574 6169 6c73  Retrieve details
-0000fb10: 206f 6620 6120 7370 6563 6966 6963 2070   of a specific p
-0000fb20: 6970 656c 696e 6520 7573 696e 6720 6974  ipeline using it
-0000fb30: 7320 7275 6e20 4944 2028 6173 2070 726f  s run ID (as pro
-0000fb40: 7669 6465 6420 7768 656e 2074 6865 2070  vided when the p
-0000fb50: 6970 656c 696e 6520 7761 7320 6578 6563  ipeline was exec
-0000fb60: 7574 6564 292e 2222 220a 0a20 2020 2020  uted)."""..     
-0000fb70: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000fb80: 2020 2020 7061 7261 6d73 203d 207b 7d0a      params = {}.
-0000fb90: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000fba0: 616d 6573 7061 6365 3a0a 2020 2020 2020  amespace:.      
-0000fbb0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000fbc0: 5b22 6e61 6d65 7370 6163 6522 5d20 3d20  ["namespace"] = 
-0000fbd0: 6e61 6d65 7370 6163 650a 2020 2020 2020  namespace.      
-0000fbe0: 2020 2020 2020 7061 7261 6d73 5b22 666f        params["fo
-0000fbf0: 726d 6174 225d 203d 2066 6f72 6d61 745f  rmat"] = format_
-0000fc00: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-0000fc10: 6a65 6374 5f70 6174 6820 3d20 7072 6f6a  ject_path = proj
-0000fc20: 6563 7420 6966 2070 726f 6a65 6374 2065  ect if project e
-0000fc30: 6c73 6520 222a 220a 2020 2020 2020 2020  lse "*".        
-0000fc40: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-0000fc50: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-0000fc60: 2020 2020 2020 2020 2020 2247 4554 222c            "GET",
-0000fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc80: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-0000fc90: 6a65 6374 5f70 6174 687d 2f70 6970 656c  ject_path}/pipel
-0000fca0: 696e 6573 2f7b 7275 6e5f 6964 7d22 2c0a  ines/{run_id}",.
-0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcc0: 7061 7261 6d73 3d70 6172 616d 732c 0a20  params=params,. 
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000fce0: 696d 656f 7574 3d74 696d 656f 7574 2c0a  imeout=timeout,.
-0000fcf0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000fd00: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
-0000fd10: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
-0000fd20: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000fd30: 6572 726f 7228 6622 6572 726f 7220 6361  error(f"error ca
-0000fd40: 6e6e 6f74 2067 6574 2070 6970 656c 696e  nnot get pipelin
-0000fd50: 653a 207b 6572 725f 746f 5f73 7472 2865  e: {err_to_str(e
-0000fd60: 7272 297d 2229 0a20 2020 2020 2020 2020  rr)}").         
-0000fd70: 2020 2072 6169 7365 204f 5345 7272 6f72     raise OSError
-0000fd80: 2866 2265 7272 6f72 3a20 6361 6e6e 6f74  (f"error: cannot
-0000fd90: 2067 6574 2070 6970 656c 696e 652c 207b   get pipeline, {
-0000fda0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
-0000fdb0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
-0000fdc0: 6f74 2072 6573 702e 6f6b 3a0a 2020 2020  ot resp.ok:.    
-0000fdd0: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-0000fde0: 7272 6f72 2866 2262 6164 2072 6573 7021  rror(f"bad resp!
-0000fdf0: 215c 6e7b 7265 7370 2e74 6578 747d 2229  !\n{resp.text}")
-0000fe00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000fe10: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0000fe20: 6261 6420 6765 7420 7069 7065 6c69 6e65  bad get pipeline
-0000fe30: 2072 6573 706f 6e73 652c 207b 7265 7370   response, {resp
-0000fe40: 2e74 6578 747d 2229 0a0a 2020 2020 2020  .text}")..      
-0000fe50: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
-0000fe60: 6f6e 2829 0a0a 2020 2020 4073 7461 7469  on()..    @stati
-0000fe70: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-0000fe80: 5f72 6573 6f6c 7665 5f72 6566 6572 656e  _resolve_referen
-0000fe90: 6365 2874 6167 2c20 7569 6429 3a0a 2020  ce(tag, uid):.  
-0000fea0: 2020 2020 2020 6966 2075 6964 2061 6e64        if uid and
-0000feb0: 2074 6167 3a0a 2020 2020 2020 2020 2020   tag:.          
-0000fec0: 2020 7261 6973 6520 4d4c 5275 6e49 6e76    raise MLRunInv
-0000fed0: 616c 6964 4172 6775 6d65 6e74 4572 726f  alidArgumentErro
-0000fee0: 7228 2262 6f74 6820 7569 6420 616e 6420  r("both uid and 
-0000fef0: 7461 6720 7765 7265 2070 726f 7669 6465  tag were provide
-0000ff00: 6422 290a 2020 2020 2020 2020 7265 7475  d").        retu
-0000ff10: 726e 2075 6964 206f 7220 7461 6720 6f72  rn uid or tag or
-0000ff20: 2022 6c61 7465 7374 220a 0a20 2020 2064   "latest"..    d
-0000ff30: 6566 2063 7265 6174 655f 6665 6174 7572  ef create_featur
-0000ff40: 655f 7365 7428 0a20 2020 2020 2020 2073  e_set(.        s
-0000ff50: 656c 662c 0a20 2020 2020 2020 2066 6561  elf,.        fea
-0000ff60: 7475 7265 5f73 6574 3a20 556e 696f 6e5b  ture_set: Union[
-0000ff70: 6469 6374 2c20 7363 6865 6d61 732e 4665  dict, schemas.Fe
-0000ff80: 6174 7572 6553 6574 2c20 4665 6174 7572  atureSet, Featur
-0000ff90: 6553 6574 5d2c 0a20 2020 2020 2020 2070  eSet],.        p
-0000ffa0: 726f 6a65 6374 3d22 222c 0a20 2020 2020  roject="",.     
-0000ffb0: 2020 2076 6572 7369 6f6e 6564 3d54 7275     versioned=Tru
-0000ffc0: 652c 0a20 2020 2029 202d 3e20 6469 6374  e,.    ) -> dict
-0000ffd0: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-0000ffe0: 6174 6520 6120 6e65 7720 3a70 793a 636c  ate a new :py:cl
-0000fff0: 6173 733a 607e 6d6c 7275 6e2e 6665 6174  ass:`~mlrun.feat
-00010000: 7572 655f 7374 6f72 652e 4665 6174 7572  ure_store.Featur
-00010010: 6553 6574 6020 616e 6420 7361 7665 2069  eSet` and save i
-00010020: 6e20 7468 6520 3a70 793a 6d6f 643a 606d  n the :py:mod:`m
-00010030: 6c72 756e 6020 4442 2e20 5468 650a 2020  lrun` DB. The.  
-00010040: 2020 2020 2020 6665 6174 7572 652d 7365        feature-se
-00010050: 7420 6d75 7374 206e 6f74 2070 7265 7669  t must not previ
-00010060: 6f75 736c 7920 6578 6973 7420 696e 2074  ously exist in t
-00010070: 6865 2044 422e 0a0a 2020 2020 2020 2020  he DB...        
-00010080: 3a70 6172 616d 2066 6561 7475 7265 5f73  :param feature_s
-00010090: 6574 3a20 5468 6520 6e65 7720 3a70 793a  et: The new :py:
-000100a0: 636c 6173 733a 607e 6d6c 7275 6e2e 6665  class:`~mlrun.fe
-000100b0: 6174 7572 655f 7374 6f72 652e 4665 6174  ature_store.Feat
-000100c0: 7572 6553 6574 6020 746f 2063 7265 6174  ureSet` to creat
-000100d0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-000100e0: 6d20 7072 6f6a 6563 743a 204e 616d 6520  m project: Name 
-000100f0: 6f66 2070 726f 6a65 6374 2074 6869 7320  of project this 
-00010100: 6665 6174 7572 652d 7365 7420 6265 6c6f  feature-set belo
-00010110: 6e67 7320 746f 2e0a 2020 2020 2020 2020  ngs to..        
-00010120: 3a70 6172 616d 2076 6572 7369 6f6e 6564  :param versioned
-00010130: 3a20 5768 6574 6865 7220 746f 206d 6169  : Whether to mai
-00010140: 6e74 6169 6e20 7665 7273 696f 6e73 2066  ntain versions f
-00010150: 6f72 2074 6869 7320 6665 6174 7572 652d  or this feature-
-00010160: 7365 742e 2041 6c6c 2076 6572 7369 6f6e  set. All version
-00010170: 7320 6f66 2061 2076 6572 7369 6f6e 6564  s of a versioned
-00010180: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
-00010190: 2020 2020 7769 6c6c 2062 6520 6b65 7074      will be kept
-000101a0: 2069 6e20 7468 6520 4442 2061 6e64 2063   in the DB and c
-000101b0: 616e 2062 6520 7265 7472 6965 7665 6420  an be retrieved 
-000101c0: 756e 7469 6c20 6578 706c 6963 6974 6c79  until explicitly
-000101d0: 2064 656c 6574 6564 2e0a 2020 2020 2020   deleted..      
-000101e0: 2020 3a72 6574 7572 6e73 3a20 5468 6520    :returns: The 
-000101f0: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-00010200: 6e2e 6665 6174 7572 655f 7374 6f72 652e  n.feature_store.
-00010210: 4665 6174 7572 6553 6574 6020 6f62 6a65  FeatureSet` obje
-00010220: 6374 2028 6173 2064 6963 7429 2e0a 2020  ct (as dict)..  
-00010230: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010240: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00010250: 6665 6174 7572 655f 7365 742c 2073 6368  feature_set, sch
-00010260: 656d 6173 2e46 6561 7475 7265 5365 7429  emas.FeatureSet)
-00010270: 3a0a 2020 2020 2020 2020 2020 2020 6665  :.            fe
-00010280: 6174 7572 655f 7365 7420 3d20 6665 6174  ature_set = feat
-00010290: 7572 655f 7365 742e 6469 6374 2829 0a20  ure_set.dict(). 
-000102a0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-000102b0: 7374 616e 6365 2866 6561 7475 7265 5f73  stance(feature_s
-000102c0: 6574 2c20 4665 6174 7572 6553 6574 293a  et, FeatureSet):
-000102d0: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-000102e0: 7475 7265 5f73 6574 203d 2066 6561 7475  ture_set = featu
-000102f0: 7265 5f73 6574 2e74 6f5f 6469 6374 2829  re_set.to_dict()
-00010300: 0a0a 2020 2020 2020 2020 7072 6f6a 6563  ..        projec
-00010310: 7420 3d20 280a 2020 2020 2020 2020 2020  t = (.          
-00010320: 2020 7072 6f6a 6563 740a 2020 2020 2020    project.      
-00010330: 2020 2020 2020 6f72 2066 6561 7475 7265        or feature
-00010340: 5f73 6574 5b22 6d65 7461 6461 7461 225d  _set["metadata"]
-00010350: 2e67 6574 2822 7072 6f6a 6563 7422 2c20  .get("project", 
-00010360: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00010370: 2020 6f72 2063 6f6e 6669 672e 6465 6661    or config.defa
-00010380: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
-00010390: 2020 2020 290a 2020 2020 2020 2020 7061      ).        pa
-000103a0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-000103b0: 7b70 726f 6a65 6374 7d2f 6665 6174 7572  {project}/featur
-000103c0: 652d 7365 7473 220a 2020 2020 2020 2020  e-sets".        
-000103d0: 7061 7261 6d73 203d 207b 2276 6572 7369  params = {"versi
-000103e0: 6f6e 6564 223a 2076 6572 7369 6f6e 6564  oned": versioned
-000103f0: 7d0a 0a20 2020 2020 2020 206e 616d 6520  }..        name 
-00010400: 3d20 6665 6174 7572 655f 7365 745b 226d  = feature_set["m
-00010410: 6574 6164 6174 6122 5d5b 226e 616d 6522  etadata"]["name"
-00010420: 5d0a 2020 2020 2020 2020 6572 726f 725f  ].        error_
-00010430: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00010440: 6564 2063 7265 6174 696e 6720 6665 6174  ed creating feat
-00010450: 7572 652d 7365 7420 7b70 726f 6a65 6374  ure-set {project
-00010460: 7d2f 7b6e 616d 657d 220a 2020 2020 2020  }/{name}".      
-00010470: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-00010480: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
-00010490: 2020 2020 2250 4f53 5422 2c0a 2020 2020      "POST",.    
-000104a0: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-000104b0: 2020 2020 2020 2020 2020 6572 726f 725f            error_
-000104c0: 6d65 7373 6167 652c 0a20 2020 2020 2020  message,.       
-000104d0: 2020 2020 2070 6172 616d 733d 7061 7261       params=para
-000104e0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
-000104f0: 626f 6479 3d64 6963 745f 746f 5f6a 736f  body=dict_to_jso
-00010500: 6e28 6665 6174 7572 655f 7365 7429 2c0a  n(feature_set),.
-00010510: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00010520: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
-00010530: 6f6e 2829 0a0a 2020 2020 6465 6620 6765  on()..    def ge
-00010540: 745f 6665 6174 7572 655f 7365 7428 0a20  t_feature_set(. 
-00010550: 2020 2020 2020 2073 656c 662c 206e 616d         self, nam
-00010560: 653a 2073 7472 2c20 7072 6f6a 6563 743a  e: str, project:
-00010570: 2073 7472 203d 2022 222c 2074 6167 3a20   str = "", tag: 
-00010580: 7374 7220 3d20 4e6f 6e65 2c20 7569 643a  str = None, uid:
-00010590: 2073 7472 203d 204e 6f6e 650a 2020 2020   str = None.    
-000105a0: 2920 2d3e 2046 6561 7475 7265 5365 743a  ) -> FeatureSet:
-000105b0: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
-000105c0: 6965 7665 2061 207e 6d6c 7275 6e2e 6665  ieve a ~mlrun.fe
-000105d0: 6174 7572 655f 7374 6f72 652e 4665 6174  ature_store.Feat
-000105e0: 7572 6553 6574 6020 6f62 6a65 6374 2e20  ureSet` object. 
-000105f0: 4966 2062 6f74 6820 6060 7461 6760 6020  If both ``tag`` 
-00010600: 616e 6420 6060 7569 6460 6020 6172 6520  and ``uid`` are 
-00010610: 6e6f 7420 7370 6563 6966 6965 642c 2074  not specified, t
-00010620: 6865 6e0a 2020 2020 2020 2020 7468 6520  hen.        the 
-00010630: 6f62 6a65 6374 2074 6167 6765 6420 6060  object tagged ``
-00010640: 6c61 7465 7374 6060 2077 696c 6c20 6265  latest`` will be
-00010650: 2072 6574 7269 6576 6564 2e0a 0a20 2020   retrieved...   
-00010660: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
-00010670: 3a20 4e61 6d65 206f 6620 6f62 6a65 6374  : Name of object
-00010680: 2074 6f20 7265 7472 6965 7665 2e0a 2020   to retrieve..  
-00010690: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
-000106a0: 6a65 6374 3a20 5072 6f6a 6563 7420 7468  ject: Project th
-000106b0: 6520 4665 6174 7572 6553 6574 2062 656c  e FeatureSet bel
-000106c0: 6f6e 6773 2074 6f2e 0a20 2020 2020 2020  ongs to..       
-000106d0: 203a 7061 7261 6d20 7461 673a 2054 6167   :param tag: Tag
-000106e0: 206f 6620 7468 6520 7370 6563 6966 6963   of the specific
-000106f0: 206f 626a 6563 7420 7665 7273 696f 6e20   object version 
-00010700: 746f 2072 6574 7269 6576 652e 0a20 2020  to retrieve..   
-00010710: 2020 2020 203a 7061 7261 6d20 7569 643a       :param uid:
-00010720: 2075 6964 206f 6620 7468 6520 6f62 6a65   uid of the obje
-00010730: 6374 2074 6f20 7265 7472 6965 7665 2028  ct to retrieve (
-00010740: 6361 6e20 6f6e 6c79 2062 6520 7573 6564  can only be used
-00010750: 2066 6f72 2076 6572 7369 6f6e 6564 206f   for versioned o
-00010760: 626a 6563 7473 292e 0a20 2020 2020 2020  bjects)..       
-00010770: 2022 2222 0a0a 2020 2020 2020 2020 7072   """..        pr
-00010780: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
-00010790: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
-000107a0: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
-000107b0: 2020 7265 6665 7265 6e63 6520 3d20 7365    reference = se
-000107c0: 6c66 2e5f 7265 736f 6c76 655f 7265 6665  lf._resolve_refe
-000107d0: 7265 6e63 6528 7461 672c 2075 6964 290a  rence(tag, uid).
-000107e0: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-000107f0: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-00010800: 6374 7d2f 6665 6174 7572 652d 7365 7473  ct}/feature-sets
-00010810: 2f7b 6e61 6d65 7d2f 7265 6665 7265 6e63  /{name}/referenc
-00010820: 6573 2f7b 7265 6665 7265 6e63 657d 220a  es/{reference}".
-00010830: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-00010840: 7373 6167 6520 3d20 6622 4661 696c 6564  ssage = f"Failed
-00010850: 2072 6574 7269 6576 696e 6720 6665 6174   retrieving feat
-00010860: 7572 652d 7365 7420 7b70 726f 6a65 6374  ure-set {project
-00010870: 7d2f 7b6e 616d 657d 220a 2020 2020 2020  }/{name}".      
-00010880: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-00010890: 695f 6361 6c6c 2822 4745 5422 2c20 7061  i_call("GET", pa
-000108a0: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-000108b0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-000108c0: 6e20 4665 6174 7572 6553 6574 2e66 726f  n FeatureSet.fro
-000108d0: 6d5f 6469 6374 2872 6573 702e 6a73 6f6e  m_dict(resp.json
-000108e0: 2829 290a 0a20 2020 2064 6566 206c 6973  ())..    def lis
-000108f0: 745f 6665 6174 7572 6573 280a 2020 2020  t_features(.    
-00010900: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00010910: 2020 7072 6f6a 6563 743a 2073 7472 2c0a    project: str,.
-00010920: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
-00010930: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-00010940: 2020 7461 673a 2073 7472 203d 204e 6f6e    tag: str = Non
-00010950: 652c 0a20 2020 2020 2020 2065 6e74 6974  e,.        entit
-00010960: 6965 733a 204c 6973 745b 7374 725d 203d  ies: List[str] =
-00010970: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-00010980: 6162 656c 733a 204c 6973 745b 7374 725d  abels: List[str]
-00010990: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-000109a0: 3e20 4c69 7374 5b64 6963 745d 3a0a 2020  > List[dict]:.  
-000109b0: 2020 2020 2020 2222 224c 6973 7420 6665        """List fe
-000109c0: 6174 7572 652d 7365 7473 2077 6869 6368  ature-sets which
-000109d0: 2063 6f6e 7461 696e 2073 7065 6369 6669   contain specifi
-000109e0: 6320 6665 6174 7572 6573 2e20 5468 6973  c features. This
-000109f0: 2066 756e 6374 696f 6e20 6d61 7920 7265   function may re
-00010a00: 7475 726e 206d 756c 7469 706c 6520 7665  turn multiple ve
-00010a10: 7273 696f 6e73 206f 6620 7468 6520 7361  rsions of the sa
-00010a20: 6d65 0a20 2020 2020 2020 2066 6561 7475  me.        featu
-00010a30: 7265 2d73 6574 2069 6620 6120 7370 6563  re-set if a spec
-00010a40: 6966 6963 2074 6167 2069 7320 6e6f 7420  ific tag is not 
-00010a50: 7265 7175 6573 7465 642e 204e 6f74 6520  requested. Note 
-00010a60: 7468 6174 2074 6865 2076 6172 696f 7573  that the various
-00010a70: 2066 696c 7465 7273 206f 6620 7468 6973   filters of this
-00010a80: 2066 756e 6374 696f 6e20 6163 7475 616c   function actual
-00010a90: 6c79 0a20 2020 2020 2020 2072 6566 6572  ly.        refer
-00010aa0: 2074 6f20 7468 6520 6665 6174 7572 652d   to the feature-
-00010ab0: 7365 7420 6f62 6a65 6374 2063 6f6e 7461  set object conta
-00010ac0: 696e 696e 6720 7468 6520 6665 6174 7572  ining the featur
-00010ad0: 6573 2c20 6e6f 7420 746f 2074 6865 2066  es, not to the f
-00010ae0: 6561 7475 7265 7320 7468 656d 7365 6c76  eatures themselv
-00010af0: 6573 2e0a 0a20 2020 2020 2020 203a 7061  es...        :pa
-00010b00: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
-00010b10: 6a65 6374 2077 6869 6368 2063 6f6e 7461  ject which conta
-00010b20: 696e 7320 7468 6573 6520 6665 6174 7572  ins these featur
-00010b30: 6573 2e0a 2020 2020 2020 2020 3a70 6172  es..        :par
-00010b40: 616d 206e 616d 653a 204e 616d 6520 6f66  am name: Name of
-00010b50: 2074 6865 2066 6561 7475 7265 2074 6f20   the feature to 
-00010b60: 6c6f 6f6b 2066 6f72 2e20 5468 6520 6e61  look for. The na
-00010b70: 6d65 2069 7320 7573 6564 2069 6e20 6120  me is used in a 
-00010b80: 6c69 6b65 2071 7565 7279 2c20 616e 6420  like query, and 
-00010b90: 6973 206e 6f74 2063 6173 652d 7365 6e73  is not case-sens
-00010ba0: 6974 6976 652e 2046 6f72 0a20 2020 2020  itive. For.     
-00010bb0: 2020 2020 2020 2065 7861 6d70 6c65 2c20         example, 
-00010bc0: 6c6f 6f6b 696e 6720 666f 7220 6060 6665  looking for ``fe
-00010bd0: 6174 6060 2077 696c 6c20 7265 7475 726e  at`` will return
-00010be0: 2066 6561 7475 7265 7320 7768 6963 6820   features which 
-00010bf0: 6172 6520 6e61 6d65 6420 6060 4d79 4665  are named ``MyFe
-00010c00: 6174 7572 6560 6020 6173 2077 656c 6c20  ature`` as well 
-00010c10: 6173 2060 6064 6566 6561 7460 602e 0a20  as ``defeat``.. 
-00010c20: 2020 2020 2020 203a 7061 7261 6d20 7461         :param ta
-00010c30: 673a 2052 6574 7572 6e20 6665 6174 7572  g: Return featur
-00010c40: 652d 7365 7473 2077 6869 6368 2063 6f6e  e-sets which con
-00010c50: 7461 696e 2074 6865 2066 6561 7475 7265  tain the feature
-00010c60: 7320 6c6f 6f6b 6564 2066 6f72 2c20 616e  s looked for, an
-00010c70: 6420 6172 6520 7461 6767 6564 2077 6974  d are tagged wit
-00010c80: 6820 7468 6520 7370 6563 6966 6963 2074  h the specific t
-00010c90: 6167 2e0a 2020 2020 2020 2020 3a70 6172  ag..        :par
-00010ca0: 616d 2065 6e74 6974 6965 733a 2052 6574  am entities: Ret
-00010cb0: 7572 6e20 6f6e 6c79 2066 6561 7475 7265  urn only feature
-00010cc0: 2d73 6574 7320 7768 6963 6820 636f 6e74  -sets which cont
-00010cd0: 6169 6e20 616e 2065 6e74 6974 7920 7768  ain an entity wh
-00010ce0: 6f73 6520 6e61 6d65 2069 7320 636f 6e74  ose name is cont
-00010cf0: 6169 6e65 6420 696e 2074 6869 7320 6c69  ained in this li
-00010d00: 7374 2e0a 2020 2020 2020 2020 3a70 6172  st..        :par
-00010d10: 616d 206c 6162 656c 733a 2052 6574 7572  am labels: Retur
-00010d20: 6e20 6f6e 6c79 2066 6561 7475 7265 2d73  n only feature-s
-00010d30: 6574 7320 7768 6963 6820 6172 6520 6c61  ets which are la
-00010d40: 6265 6c65 6420 6173 2072 6571 7565 7374  beled as request
-00010d50: 6564 2e0a 2020 2020 2020 2020 3a72 6574  ed..        :ret
-00010d60: 7572 6e73 3a20 4120 6c69 7374 206f 6620  urns: A list of 
-00010d70: 6d61 7070 696e 6720 6672 6f6d 2066 6561  mapping from fea
-00010d80: 7475 7265 2074 6f20 6120 6469 6765 7374  ture to a digest
-00010d90: 206f 6620 7468 6520 6665 6174 7572 652d   of the feature-
-00010da0: 7365 742c 2077 6869 6368 2063 6f6e 7461  set, which conta
-00010db0: 696e 7320 7468 6520 6665 6174 7572 652d  ins the feature-
-00010dc0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-00010dd0: 6d65 7461 2d64 6174 612e 204d 756c 7469  meta-data. Multi
-00010de0: 706c 6520 656e 7472 6965 7320 6d61 7920  ple entries may 
-00010df0: 6265 2072 6574 7572 6e65 6420 666f 7220  be returned for 
-00010e00: 616e 7920 7370 6563 6966 6963 2066 6561  any specific fea
-00010e10: 7475 7265 2064 7565 2074 6f20 6d75 6c74  ture due to mult
-00010e20: 6970 6c65 2074 6167 7320 6f72 2076 6572  iple tags or ver
-00010e30: 7369 6f6e 730a 2020 2020 2020 2020 2020  sions.          
-00010e40: 2020 6f66 2074 6865 2066 6561 7475 7265    of the feature
-00010e50: 2d73 6574 2e0a 2020 2020 2020 2020 2222  -set..        ""
-00010e60: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
-00010e70: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
-00010e80: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
-00010e90: 726f 6a65 6374 0a20 2020 2020 2020 2070  roject.        p
-00010ea0: 6172 616d 7320 3d20 7b0a 2020 2020 2020  arams = {.      
-00010eb0: 2020 2020 2020 226e 616d 6522 3a20 6e61        "name": na
-00010ec0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00010ed0: 2274 6167 223a 2074 6167 2c0a 2020 2020  "tag": tag,.    
-00010ee0: 2020 2020 2020 2020 2265 6e74 6974 7922          "entity"
-00010ef0: 3a20 656e 7469 7469 6573 206f 7220 5b5d  : entities or []
-00010f00: 2c0a 2020 2020 2020 2020 2020 2020 226c  ,.            "l
-00010f10: 6162 656c 223a 206c 6162 656c 7320 6f72  abel": labels or
-00010f20: 205b 5d2c 0a20 2020 2020 2020 207d 0a0a   [],.        }..
-00010f30: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-00010f40: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-00010f50: 6374 7d2f 6665 6174 7572 6573 220a 0a20  ct}/features".. 
-00010f60: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00010f70: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-00010f80: 6c69 7374 696e 6720 6665 6174 7572 6573  listing features
-00010f90: 2c20 7072 6f6a 6563 743a 207b 7072 6f6a  , project: {proj
-00010fa0: 6563 747d 2c20 7175 6572 793a 207b 7061  ect}, query: {pa
-00010fb0: 7261 6d73 7d22 0a20 2020 2020 2020 2072  rams}".        r
-00010fc0: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
-00010fd0: 616c 6c28 2247 4554 222c 2070 6174 682c  all("GET", path,
-00010fe0: 2065 7272 6f72 5f6d 6573 7361 6765 2c20   error_message, 
-00010ff0: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
-00011000: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00011010: 7370 2e6a 736f 6e28 295b 2266 6561 7475  sp.json()["featu
-00011020: 7265 7322 5d0a 0a20 2020 2064 6566 206c  res"]..    def l
-00011030: 6973 745f 656e 7469 7469 6573 280a 2020  ist_entities(.  
-00011040: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00011050: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
-00011060: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
-00011070: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
-00011080: 2020 2020 7461 673a 2073 7472 203d 204e      tag: str = N
-00011090: 6f6e 652c 0a20 2020 2020 2020 206c 6162  one,.        lab
-000110a0: 656c 733a 204c 6973 745b 7374 725d 203d  els: List[str] =
-000110b0: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-000110c0: 4c69 7374 5b64 6963 745d 3a0a 2020 2020  List[dict]:.    
-000110d0: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
-000110e0: 6120 6c69 7374 206f 6620 656e 7469 7469  a list of entiti
-000110f0: 6573 2061 6e64 2074 6865 6972 206d 6170  es and their map
-00011100: 7069 6e67 2074 6f20 7468 6520 636f 6e74  ping to the cont
-00011110: 6169 6e69 6e67 2066 6561 7475 7265 2d73  aining feature-s
-00011120: 6574 732e 2054 6869 7320 6675 6e63 7469  ets. This functi
-00011130: 6f6e 2069 7320 7369 6d69 6c61 720a 2020  on is similar.  
-00011140: 2020 2020 2020 746f 2074 6865 203a 7079        to the :py
-00011150: 3a66 756e 633a 607e 6c69 7374 5f66 6561  :func:`~list_fea
-00011160: 7475 7265 7360 2066 756e 6374 696f 6e2c  tures` function,
-00011170: 2061 6e64 2075 7365 7320 7468 6520 7361   and uses the sa
-00011180: 6d65 206c 6f67 6963 2e20 486f 7765 7665  me logic. Howeve
-00011190: 722c 2074 6865 2065 6e74 6974 6965 7320  r, the entities 
-000111a0: 6172 6520 6d61 7463 6865 640a 2020 2020  are matched.    
-000111b0: 2020 2020 6167 6169 6e73 7420 7468 6520      against the 
-000111c0: 6e61 6d65 2072 6174 6865 7220 7468 616e  name rather than
-000111d0: 2074 6865 2066 6561 7475 7265 732e 0a20   the features.. 
-000111e0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000111f0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-00011200: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-00011210: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-00011220: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-00011230: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-00011240: 6e61 6d65 223a 206e 616d 652c 0a20 2020  name": name,.   
-00011250: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
-00011260: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
-00011270: 2022 6c61 6265 6c22 3a20 6c61 6265 6c73   "label": labels
-00011280: 206f 7220 5b5d 2c0a 2020 2020 2020 2020   or [],.        
-00011290: 7d0a 0a20 2020 2020 2020 2070 6174 6820  }..        path 
-000112a0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-000112b0: 6f6a 6563 747d 2f65 6e74 6974 6965 7322  oject}/entities"
-000112c0: 0a0a 2020 2020 2020 2020 6572 726f 725f  ..        error_
-000112d0: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-000112e0: 6564 206c 6973 7469 6e67 2065 6e74 6974  ed listing entit
-000112f0: 6965 732c 2070 726f 6a65 6374 3a20 7b70  ies, project: {p
-00011300: 726f 6a65 6374 7d2c 2071 7565 7279 3a20  roject}, query: 
-00011310: 7b70 6172 616d 737d 220a 2020 2020 2020  {params}".      
-00011320: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-00011330: 695f 6361 6c6c 2822 4745 5422 2c20 7061  i_call("GET", pa
-00011340: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-00011350: 652c 2070 6172 616d 733d 7061 7261 6d73  e, params=params
-00011360: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00011370: 2072 6573 702e 6a73 6f6e 2829 5b22 656e   resp.json()["en
-00011380: 7469 7469 6573 225d 0a0a 2020 2020 4073  tities"]..    @s
-00011390: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-000113a0: 6465 6620 5f67 656e 6572 6174 655f 7061  def _generate_pa
-000113b0: 7274 6974 696f 6e5f 6279 5f70 6172 616d  rtition_by_param
-000113c0: 7328 0a20 2020 2020 2020 2070 6172 7469  s(.        parti
-000113d0: 7469 6f6e 5f62 795f 636c 732c 0a20 2020  tion_by_cls,.   
-000113e0: 2020 2020 2070 6172 7469 7469 6f6e 5f62       partition_b
-000113f0: 792c 0a20 2020 2020 2020 2072 6f77 735f  y,.        rows_
-00011400: 7065 725f 7061 7274 6974 696f 6e2c 0a20  per_partition,. 
-00011410: 2020 2020 2020 2073 6f72 745f 6279 2c0a         sort_by,.
-00011420: 2020 2020 2020 2020 6f72 6465 722c 0a20          order,. 
-00011430: 2020 2020 2020 206d 6178 5f70 6172 7469         max_parti
-00011440: 7469 6f6e 733d 4e6f 6e65 2c0a 2020 2020  tions=None,.    
-00011450: 293a 0a0a 2020 2020 2020 2020 7061 7274  ):..        part
-00011460: 6974 696f 6e5f 7061 7261 6d73 203d 207b  ition_params = {
-00011470: 0a20 2020 2020 2020 2020 2020 2022 7061  .            "pa
-00011480: 7274 6974 696f 6e2d 6279 223a 2070 6172  rtition-by": par
-00011490: 7469 7469 6f6e 5f62 792c 0a20 2020 2020  tition_by,.     
-000114a0: 2020 2020 2020 2022 726f 7773 2d70 6572         "rows-per
-000114b0: 2d70 6172 7469 7469 6f6e 223a 2072 6f77  -partition": row
-000114c0: 735f 7065 725f 7061 7274 6974 696f 6e2c  s_per_partition,
-000114d0: 0a20 2020 2020 2020 2020 2020 2022 7061  .            "pa
-000114e0: 7274 6974 696f 6e2d 736f 7274 2d62 7922  rtition-sort-by"
-000114f0: 3a20 736f 7274 5f62 792c 0a20 2020 2020  : sort_by,.     
-00011500: 2020 2020 2020 2022 7061 7274 6974 696f         "partitio
-00011510: 6e2d 6f72 6465 7222 3a20 6f72 6465 722c  n-order": order,
-00011520: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-00011530: 2020 2069 6620 6d61 785f 7061 7274 6974     if max_partit
-00011540: 696f 6e73 2069 7320 6e6f 7420 4e6f 6e65  ions is not None
-00011550: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00011560: 7274 6974 696f 6e5f 7061 7261 6d73 5b22  rtition_params["
-00011570: 6d61 782d 7061 7274 6974 696f 6e73 225d  max-partitions"]
-00011580: 203d 206d 6178 5f70 6172 7469 7469 6f6e   = max_partition
-00011590: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-000115a0: 2070 6172 7469 7469 6f6e 5f70 6172 616d   partition_param
-000115b0: 730a 0a20 2020 2064 6566 206c 6973 745f  s..    def list_
-000115c0: 6665 6174 7572 655f 7365 7473 280a 2020  feature_sets(.  
-000115d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000115e0: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
-000115f0: 203d 2022 222c 0a20 2020 2020 2020 206e   = "",.        n
-00011600: 616d 653a 2073 7472 203d 204e 6f6e 652c  ame: str = None,
-00011610: 0a20 2020 2020 2020 2074 6167 3a20 7374  .        tag: st
-00011620: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-00011630: 2020 7374 6174 653a 2073 7472 203d 204e    state: str = N
-00011640: 6f6e 652c 0a20 2020 2020 2020 2065 6e74  one,.        ent
-00011650: 6974 6965 733a 204c 6973 745b 7374 725d  ities: List[str]
-00011660: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00011670: 2066 6561 7475 7265 733a 204c 6973 745b   features: List[
-00011680: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00011690: 2020 2020 206c 6162 656c 733a 204c 6973       labels: Lis
-000116a0: 745b 7374 725d 203d 204e 6f6e 652c 0a20  t[str] = None,. 
-000116b0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-000116c0: 5f62 793a 2055 6e69 6f6e 5b73 6368 656d  _by: Union[schem
-000116d0: 6173 2e46 6561 7475 7265 5374 6f72 6550  as.FeatureStoreP
-000116e0: 6172 7469 7469 6f6e 4279 4669 656c 642c  artitionByField,
-000116f0: 2073 7472 5d20 3d20 4e6f 6e65 2c0a 2020   str] = None,.  
-00011700: 2020 2020 2020 726f 7773 5f70 6572 5f70        rows_per_p
-00011710: 6172 7469 7469 6f6e 3a20 696e 7420 3d20  artition: int = 
-00011720: 312c 0a20 2020 2020 2020 2070 6172 7469  1,.        parti
-00011730: 7469 6f6e 5f73 6f72 745f 6279 3a20 556e  tion_sort_by: Un
-00011740: 696f 6e5b 7363 6865 6d61 732e 536f 7274  ion[schemas.Sort
-00011750: 4669 656c 642c 2073 7472 5d20 3d20 4e6f  Field, str] = No
-00011760: 6e65 2c0a 2020 2020 2020 2020 7061 7274  ne,.        part
-00011770: 6974 696f 6e5f 6f72 6465 723a 2055 6e69  ition_order: Uni
-00011780: 6f6e 5b73 6368 656d 6173 2e4f 7264 6572  on[schemas.Order
-00011790: 5479 7065 2c20 7374 725d 203d 2073 6368  Type, str] = sch
-000117a0: 656d 6173 2e4f 7264 6572 5479 7065 2e64  emas.OrderType.d
-000117b0: 6573 632c 0a20 2020 2029 202d 3e20 4c69  esc,.    ) -> Li
-000117c0: 7374 5b46 6561 7475 7265 5365 745d 3a0a  st[FeatureSet]:.
-000117d0: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
-000117e0: 6576 6520 6120 6c69 7374 206f 6620 6665  eve a list of fe
-000117f0: 6174 7572 652d 7365 7473 206d 6174 6368  ature-sets match
-00011800: 696e 6720 7468 6520 6372 6974 6572 6961  ing the criteria
-00011810: 2070 726f 7669 6465 642e 0a0a 2020 2020   provided...    
-00011820: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-00011830: 6374 3a20 5072 6f6a 6563 7420 6e61 6d65  ct: Project name
-00011840: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00011850: 206e 616d 653a 204e 616d 6520 6f66 2066   name: Name of f
-00011860: 6561 7475 7265 2d73 6574 2074 6f20 6d61  eature-set to ma
-00011870: 7463 682e 2054 6869 7320 6973 2061 206c  tch. This is a l
-00011880: 696b 6520 7175 6572 792c 2061 6e64 2069  ike query, and i
-00011890: 7320 6361 7365 2d69 6e73 656e 7369 7469  s case-insensiti
-000118a0: 7665 2e0a 2020 2020 2020 2020 3a70 6172  ve..        :par
-000118b0: 616d 2074 6167 3a20 4d61 7463 6820 6665  am tag: Match fe
-000118c0: 6174 7572 652d 7365 7473 2077 6974 6820  ature-sets with 
-000118d0: 7370 6563 6966 6963 2074 6167 2e0a 2020  specific tag..  
-000118e0: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
-000118f0: 7465 3a20 4d61 7463 6820 6665 6174 7572  te: Match featur
-00011900: 652d 7365 7473 2077 6974 6820 6120 7370  e-sets with a sp
-00011910: 6563 6966 6963 2073 7461 7465 2e0a 2020  ecific state..  
-00011920: 2020 2020 2020 3a70 6172 616d 2065 6e74        :param ent
-00011930: 6974 6965 733a 204d 6174 6368 2066 6561  ities: Match fea
-00011940: 7475 7265 2d73 6574 7320 7768 6963 6820  ture-sets which 
-00011950: 636f 6e74 6169 6e20 656e 7469 7469 6573  contain entities
-00011960: 2077 686f 7365 206e 616d 6520 6973 2069   whose name is i
-00011970: 6e20 7468 6973 206c 6973 742e 0a20 2020  n this list..   
-00011980: 2020 2020 203a 7061 7261 6d20 6665 6174       :param feat
-00011990: 7572 6573 3a20 4d61 7463 6820 6665 6174  ures: Match feat
-000119a0: 7572 652d 7365 7473 2077 6869 6368 2063  ure-sets which c
-000119b0: 6f6e 7461 696e 2066 6561 7475 7265 7320  ontain features 
-000119c0: 7768 6f73 6520 6e61 6d65 2069 7320 696e  whose name is in
-000119d0: 2074 6869 7320 6c69 7374 2e0a 2020 2020   this list..    
-000119e0: 2020 2020 3a70 6172 616d 206c 6162 656c      :param label
-000119f0: 733a 204d 6174 6368 2066 6561 7475 7265  s: Match feature
-00011a00: 2d73 6574 7320 7768 6963 6820 6861 7665  -sets which have
-00011a10: 2074 6865 7365 206c 6162 656c 732e 0a20   these labels.. 
-00011a20: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-00011a30: 7274 6974 696f 6e5f 6279 3a20 4669 656c  rtition_by: Fiel
-00011a40: 6420 746f 2067 726f 7570 2072 6573 756c  d to group resul
-00011a50: 7473 2062 792e 204f 6e6c 7920 616c 6c6f  ts by. Only allo
-00011a60: 7765 6420 7661 6c75 6520 6973 2060 6e61  wed value is `na
-00011a70: 6d65 602e 2057 6865 6e20 6070 6172 7469  me`. When `parti
-00011a80: 7469 6f6e 5f62 7960 2069 7320 7370 6563  tion_by` is spec
-00011a90: 6966 6965 642c 0a20 2020 2020 2020 2020  ified,.         
-00011aa0: 2020 2074 6865 2060 7061 7274 6974 696f     the `partitio
-00011ab0: 6e5f 736f 7274 5f62 7960 2070 6172 616d  n_sort_by` param
-00011ac0: 6574 6572 206d 7573 7420 6265 2070 726f  eter must be pro
-00011ad0: 7669 6465 6420 6173 2077 656c 6c2e 0a20  vided as well.. 
-00011ae0: 2020 2020 2020 203a 7061 7261 6d20 726f         :param ro
-00011af0: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
-00011b00: 3a20 486f 7720 6d61 6e79 2074 6f70 2072  : How many top r
-00011b10: 6f77 7320 2870 6572 2073 6f72 7469 6e67  ows (per sorting
-00011b20: 2064 6566 696e 6564 2062 7920 6070 6172   defined by `par
-00011b30: 7469 7469 6f6e 5f73 6f72 745f 6279 6020  tition_sort_by` 
-00011b40: 616e 6420 6070 6172 7469 7469 6f6e 5f6f  and `partition_o
-00011b50: 7264 6572 6029 0a20 2020 2020 2020 2020  rder`).         
-00011b60: 2020 2074 6f20 7265 7475 726e 2070 6572     to return per
-00011b70: 2067 726f 7570 2e20 4465 6661 756c 7420   group. Default 
-00011b80: 7661 6c75 6520 6973 2031 2e0a 2020 2020  value is 1..    
-00011b90: 2020 2020 3a70 6172 616d 2070 6172 7469      :param parti
-00011ba0: 7469 6f6e 5f73 6f72 745f 6279 3a20 5768  tion_sort_by: Wh
-00011bb0: 6174 2066 6965 6c64 2074 6f20 736f 7274  at field to sort
-00011bc0: 2074 6865 2072 6573 756c 7473 2062 792c   the results by,
-00011bd0: 2077 6974 6869 6e20 6561 6368 2070 6172   within each par
-00011be0: 7469 7469 6f6e 2064 6566 696e 6564 2062  tition defined b
-00011bf0: 7920 6070 6172 7469 7469 6f6e 5f62 7960  y `partition_by`
-00011c00: 2e0a 2020 2020 2020 2020 2020 2020 4375  ..            Cu
-00011c10: 7272 656e 746c 7920 7468 6520 6f6e 6c79  rrently the only
-00011c20: 2061 6c6c 6f77 6564 2076 616c 7565 2061   allowed value a
-00011c30: 7265 2060 6372 6561 7465 6460 2061 6e64  re `created` and
-00011c40: 2060 7570 6461 7465 6460 2e0a 2020 2020   `updated`..    
-00011c50: 2020 2020 3a70 6172 616d 2070 6172 7469      :param parti
-00011c60: 7469 6f6e 5f6f 7264 6572 3a20 4f72 6465  tion_order: Orde
-00011c70: 7220 6f66 2073 6f72 7469 6e67 2077 6974  r of sorting wit
-00011c80: 6869 6e20 7061 7274 6974 696f 6e73 202d  hin partitions -
-00011c90: 2060 6173 6360 206f 7220 6064 6573 6360   `asc` or `desc`
-00011ca0: 2e20 4465 6661 756c 7420 6973 2060 6465  . Default is `de
-00011cb0: 7363 602e 0a20 2020 2020 2020 203a 7265  sc`..        :re
-00011cc0: 7475 726e 733a 204c 6973 7420 6f66 206d  turns: List of m
-00011cd0: 6174 6368 696e 6720 3a70 793a 636c 6173  atching :py:clas
-00011ce0: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
-00011cf0: 655f 7374 6f72 652e 4665 6174 7572 6553  e_store.FeatureS
-00011d00: 6574 6020 6f62 6a65 6374 732e 0a20 2020  et` objects..   
-00011d10: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00011d20: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
-00011d30: 6563 7420 6f72 2063 6f6e 6669 672e 6465  ect or config.de
-00011d40: 6661 756c 745f 7072 6f6a 6563 740a 0a20  fault_project.. 
-00011d50: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-00011d60: 7b0a 2020 2020 2020 2020 2020 2020 226e  {.            "n
-00011d70: 616d 6522 3a20 6e61 6d65 2c0a 2020 2020  ame": name,.    
-00011d80: 2020 2020 2020 2020 2273 7461 7465 223a          "state":
-00011d90: 2073 7461 7465 2c0a 2020 2020 2020 2020   state,.        
-00011da0: 2020 2020 2274 6167 223a 2074 6167 2c0a      "tag": tag,.
-00011db0: 2020 2020 2020 2020 2020 2020 2265 6e74              "ent
-00011dc0: 6974 7922 3a20 656e 7469 7469 6573 206f  ity": entities o
-00011dd0: 7220 5b5d 2c0a 2020 2020 2020 2020 2020  r [],.          
-00011de0: 2020 2266 6561 7475 7265 223a 2066 6561    "feature": fea
-00011df0: 7475 7265 7320 6f72 205b 5d2c 0a20 2020  tures or [],.   
-00011e00: 2020 2020 2020 2020 2022 6c61 6265 6c22           "label"
-00011e10: 3a20 6c61 6265 6c73 206f 7220 5b5d 2c0a  : labels or [],.
-00011e20: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00011e30: 2020 6966 2070 6172 7469 7469 6f6e 5f62    if partition_b
-00011e40: 793a 0a20 2020 2020 2020 2020 2020 2070  y:.            p
-00011e50: 6172 616d 732e 7570 6461 7465 280a 2020  arams.update(.  
-00011e60: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00011e70: 6c66 2e5f 6765 6e65 7261 7465 5f70 6172  lf._generate_par
-00011e80: 7469 7469 6f6e 5f62 795f 7061 7261 6d73  tition_by_params
-00011e90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00011ea0: 2020 2020 2020 7363 6865 6d61 732e 4665        schemas.Fe
-00011eb0: 6174 7572 6553 746f 7265 5061 7274 6974  atureStorePartit
-00011ec0: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
-00011ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ee0: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
-00011ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f00: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
-00011f10: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00011f20: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00011f30: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
-00011f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f50: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00011f60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011f70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00011f80: 290a 0a20 2020 2020 2020 2070 6174 6820  )..        path 
-00011f90: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00011fa0: 6f6a 6563 747d 2f66 6561 7475 7265 2d73  oject}/feature-s
-00011fb0: 6574 7322 0a0a 2020 2020 2020 2020 6572  ets"..        er
-00011fc0: 726f 725f 6d65 7373 6167 6520 3d20 280a  ror_message = (.
-00011fd0: 2020 2020 2020 2020 2020 2020 6622 4661              f"Fa
-00011fe0: 696c 6564 206c 6973 7469 6e67 2066 6561  iled listing fea
-00011ff0: 7475 7265 2d73 6574 732c 2070 726f 6a65  ture-sets, proje
-00012000: 6374 3a20 7b70 726f 6a65 6374 7d2c 2071  ct: {project}, q
-00012010: 7565 7279 3a20 7b70 6172 616d 737d 220a  uery: {params}".
-00012020: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00012030: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-00012040: 695f 6361 6c6c 2822 4745 5422 2c20 7061  i_call("GET", pa
-00012050: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-00012060: 652c 2070 6172 616d 733d 7061 7261 6d73  e, params=params
-00012070: 290a 2020 2020 2020 2020 6665 6174 7572  ).        featur
-00012080: 655f 7365 7473 203d 2072 6573 702e 6a73  e_sets = resp.js
-00012090: 6f6e 2829 5b22 6665 6174 7572 655f 7365  on()["feature_se
-000120a0: 7473 225d 0a20 2020 2020 2020 2069 6620  ts"].        if 
-000120b0: 6665 6174 7572 655f 7365 7473 3a0a 2020  feature_sets:.  
-000120c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000120d0: 205b 4665 6174 7572 6553 6574 2e66 726f   [FeatureSet.fro
-000120e0: 6d5f 6469 6374 286f 626a 2920 666f 7220  m_dict(obj) for 
-000120f0: 6f62 6a20 696e 2066 6561 7475 7265 5f73  obj in feature_s
-00012100: 6574 735d 0a0a 2020 2020 6465 6620 7374  ets]..    def st
-00012110: 6f72 655f 6665 6174 7572 655f 7365 7428  ore_feature_set(
-00012120: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00012130: 2020 2020 2020 2066 6561 7475 7265 5f73         feature_s
-00012140: 6574 3a20 556e 696f 6e5b 6469 6374 2c20  et: Union[dict, 
-00012150: 7363 6865 6d61 732e 4665 6174 7572 6553  schemas.FeatureS
-00012160: 6574 2c20 4665 6174 7572 6553 6574 5d2c  et, FeatureSet],
-00012170: 0a20 2020 2020 2020 206e 616d 653d 4e6f  .        name=No
-00012180: 6e65 2c0a 2020 2020 2020 2020 7072 6f6a  ne,.        proj
-00012190: 6563 743d 2222 2c0a 2020 2020 2020 2020  ect="",.        
-000121a0: 7461 673d 4e6f 6e65 2c0a 2020 2020 2020  tag=None,.      
-000121b0: 2020 7569 643d 4e6f 6e65 2c0a 2020 2020    uid=None,.    
-000121c0: 2020 2020 7665 7273 696f 6e65 643d 5472      versioned=Tr
-000121d0: 7565 2c0a 2020 2020 2920 2d3e 2064 6963  ue,.    ) -> dic
-000121e0: 743a 0a20 2020 2020 2020 2022 2222 5361  t:.        """Sa
-000121f0: 7665 2061 203a 7079 3a63 6c61 7373 3a60  ve a :py:class:`
-00012200: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-00012210: 746f 7265 2e46 6561 7475 7265 5365 7460  tore.FeatureSet`
-00012220: 206f 626a 6563 7420 696e 2074 6865 203a   object in the :
-00012230: 7079 3a6d 6f64 3a60 6d6c 7275 6e60 2044  py:mod:`mlrun` D
-00012240: 422e 2054 6865 0a20 2020 2020 2020 2066  B. The.        f
-00012250: 6561 7475 7265 2d73 6574 2063 616e 2062  eature-set can b
-00012260: 6520 6569 7468 6572 2061 206e 6577 206f  e either a new o
-00012270: 626a 6563 7420 6f72 2061 206d 6f64 6966  bject or a modif
-00012280: 6963 6174 696f 6e20 746f 2065 7869 7374  ication to exist
-00012290: 696e 6720 6f62 6a65 6374 2072 6566 6572  ing object refer
-000122a0: 656e 6365 6420 6279 2074 6865 2070 6172  enced by the par
-000122b0: 616d 7320 6f66 0a20 2020 2020 2020 2074  ams of.        t
-000122c0: 6865 2066 756e 6374 696f 6e2e 0a0a 2020  he function...  
-000122d0: 2020 2020 2020 3a70 6172 616d 2066 6561        :param fea
-000122e0: 7475 7265 5f73 6574 3a20 5468 6520 3a70  ture_set: The :p
-000122f0: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-00012300: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-00012310: 6174 7572 6553 6574 6020 746f 2073 746f  atureSet` to sto
-00012320: 7265 2e0a 2020 2020 2020 2020 3a70 6172  re..        :par
-00012330: 616d 206e 616d 653a 2020 2020 4e61 6d65  am name:    Name
-00012340: 206f 6620 6665 6174 7572 6520 7365 742e   of feature set.
-00012350: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00012360: 7072 6f6a 6563 743a 204e 616d 6520 6f66  project: Name of
-00012370: 2070 726f 6a65 6374 2074 6869 7320 6665   project this fe
-00012380: 6174 7572 652d 7365 7420 6265 6c6f 6e67  ature-set belong
-00012390: 7320 746f 2e0a 2020 2020 2020 2020 3a70  s to..        :p
-000123a0: 6172 616d 2074 6167 3a20 5468 6520 6060  aram tag: The ``
-000123b0: 7461 6760 6020 6f66 2074 6865 206f 626a  tag`` of the obj
-000123c0: 6563 7420 746f 2072 6570 6c61 6365 2069  ect to replace i
-000123d0: 6e20 7468 6520 4442 2c20 666f 7220 6578  n the DB, for ex
-000123e0: 616d 706c 6520 6060 6c61 7465 7374 6060  ample ``latest``
-000123f0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00012400: 2075 6964 3a20 5468 6520 6060 7569 6460   uid: The ``uid`
-00012410: 6020 6f66 2074 6865 206f 626a 6563 7420  ` of the object 
-00012420: 746f 2072 6570 6c61 6365 2069 6e20 7468  to replace in th
-00012430: 6520 4442 2e20 4966 2075 7369 6e67 2074  e DB. If using t
-00012440: 6869 7320 7061 7261 6d65 7465 722c 2074  his parameter, t
-00012450: 6865 206d 6f64 6966 6965 6420 6f62 6a65  he modified obje
-00012460: 6374 0a20 2020 2020 2020 2020 2020 206d  ct.            m
-00012470: 7573 7420 6861 7665 2074 6865 2073 616d  ust have the sam
-00012480: 6520 6060 7569 6460 6020 6f66 2074 6865  e ``uid`` of the
-00012490: 2070 7265 7669 6f75 736c 792d 6578 6973   previously-exis
-000124a0: 7469 6e67 206f 626a 6563 742e 2054 6869  ting object. Thi
-000124b0: 7320 6361 6e6e 6f74 2062 6520 7573 6564  s cannot be used
-000124c0: 2066 6f72 206e 6f6e 2d76 6572 7369 6f6e   for non-version
-000124d0: 6564 206f 626a 6563 7473 2e0a 2020 2020  ed objects..    
-000124e0: 2020 2020 3a70 6172 616d 2076 6572 7369      :param versi
-000124f0: 6f6e 6564 3a20 5768 6574 6865 7220 746f  oned: Whether to
-00012500: 206d 6169 6e74 6169 6e20 7665 7273 696f   maintain versio
-00012510: 6e73 2066 6f72 2074 6869 7320 6665 6174  ns for this feat
-00012520: 7572 652d 7365 742e 2041 6c6c 2076 6572  ure-set. All ver
-00012530: 7369 6f6e 7320 6f66 2061 2076 6572 7369  sions of a versi
-00012540: 6f6e 6564 206f 626a 6563 740a 2020 2020  oned object.    
-00012550: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-00012560: 6b65 7074 2069 6e20 7468 6520 4442 2061  kept in the DB a
-00012570: 6e64 2063 616e 2062 6520 7265 7472 6965  nd can be retrie
-00012580: 7665 6420 756e 7469 6c20 6578 706c 6963  ved until explic
-00012590: 6974 6c79 2064 656c 6574 6564 2e0a 2020  itly deleted..  
-000125a0: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-000125b0: 5468 6520 3a70 793a 636c 6173 733a 607e  The :py:class:`~
-000125c0: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
-000125d0: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
-000125e0: 6f62 6a65 6374 2028 6173 2064 6963 7429  object (as dict)
-000125f0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00012600: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00012610: 203d 2073 656c 662e 5f72 6573 6f6c 7665   = self._resolve
-00012620: 5f72 6566 6572 656e 6365 2874 6167 2c20  _reference(tag, 
-00012630: 7569 6429 0a20 2020 2020 2020 2070 6172  uid).        par
-00012640: 616d 7320 3d20 7b22 7665 7273 696f 6e65  ams = {"versione
-00012650: 6422 3a20 7665 7273 696f 6e65 647d 0a0a  d": versioned}..
-00012660: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00012670: 7461 6e63 6528 6665 6174 7572 655f 7365  tance(feature_se
-00012680: 742c 2073 6368 656d 6173 2e46 6561 7475  t, schemas.Featu
-00012690: 7265 5365 7429 3a0a 2020 2020 2020 2020  reSet):.        
-000126a0: 2020 2020 6665 6174 7572 655f 7365 7420      feature_set 
-000126b0: 3d20 6665 6174 7572 655f 7365 742e 6469  = feature_set.di
-000126c0: 6374 2829 0a20 2020 2020 2020 2065 6c69  ct().        eli
-000126d0: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
-000126e0: 7475 7265 5f73 6574 2c20 4665 6174 7572  ture_set, Featur
-000126f0: 6553 6574 293a 0a20 2020 2020 2020 2020  eSet):.         
-00012700: 2020 2066 6561 7475 7265 5f73 6574 203d     feature_set =
-00012710: 2066 6561 7475 7265 5f73 6574 2e74 6f5f   feature_set.to_
-00012720: 6469 6374 2829 0a0a 2020 2020 2020 2020  dict()..        
-00012730: 6e61 6d65 203d 206e 616d 6520 6f72 2066  name = name or f
-00012740: 6561 7475 7265 5f73 6574 5b22 6d65 7461  eature_set["meta
-00012750: 6461 7461 225d 5b22 6e61 6d65 225d 0a20  data"]["name"]. 
-00012760: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-00012770: 2028 0a20 2020 2020 2020 2020 2020 2070   (.            p
-00012780: 726f 6a65 6374 206f 7220 6665 6174 7572  roject or featur
-00012790: 655f 7365 745b 226d 6574 6164 6174 6122  e_set["metadata"
-000127a0: 5d2e 6765 7428 2270 726f 6a65 6374 2229  ].get("project")
-000127b0: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-000127c0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
-000127d0: 2020 2029 0a20 2020 2020 2020 2070 6174     ).        pat
-000127e0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-000127f0: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
-00012800: 2d73 6574 732f 7b6e 616d 657d 2f72 6566  -sets/{name}/ref
-00012810: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
-00012820: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
-00012830: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-00012840: 6169 6c65 6420 7374 6f72 696e 6720 6665  ailed storing fe
-00012850: 6174 7572 652d 7365 7420 7b70 726f 6a65  ature-set {proje
-00012860: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
-00012870: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-00012880: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-00012890: 2020 2020 2020 2250 5554 222c 2070 6174        "PUT", pat
-000128a0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
-000128b0: 2c20 7061 7261 6d73 3d70 6172 616d 732c  , params=params,
-000128c0: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
-000128d0: 6f6e 2866 6561 7475 7265 5f73 6574 290a  on(feature_set).
-000128e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000128f0: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
-00012900: 6f6e 2829 0a0a 2020 2020 6465 6620 7061  on()..    def pa
-00012910: 7463 685f 6665 6174 7572 655f 7365 7428  tch_feature_set(
-00012920: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00012930: 2020 2020 2020 206e 616d 652c 0a20 2020         name,.   
-00012940: 2020 2020 2066 6561 7475 7265 5f73 6574       feature_set
-00012950: 5f75 7064 6174 653a 2064 6963 742c 0a20  _update: dict,. 
-00012960: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
-00012970: 222c 0a20 2020 2020 2020 2074 6167 3d4e  ",.        tag=N
-00012980: 6f6e 652c 0a20 2020 2020 2020 2075 6964  one,.        uid
-00012990: 3d4e 6f6e 652c 0a20 2020 2020 2020 2070  =None,.        p
-000129a0: 6174 6368 5f6d 6f64 653a 2055 6e69 6f6e  atch_mode: Union
-000129b0: 5b73 7472 2c20 7363 6865 6d61 732e 5061  [str, schemas.Pa
-000129c0: 7463 684d 6f64 655d 203d 2073 6368 656d  tchMode] = schem
-000129d0: 6173 2e50 6174 6368 4d6f 6465 2e72 6570  as.PatchMode.rep
-000129e0: 6c61 6365 2c0a 2020 2020 293a 0a20 2020  lace,.    ):.   
-000129f0: 2020 2020 2022 2222 4d6f 6469 6679 2028       """Modify (
-00012a00: 7061 7463 6829 2061 6e20 6578 6973 7469  patch) an existi
-00012a10: 6e67 203a 7079 3a63 6c61 7373 3a60 7e6d  ng :py:class:`~m
-00012a20: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
-00012a30: 7265 2e46 6561 7475 7265 5365 7460 206f  re.FeatureSet` o
-00012a40: 626a 6563 742e 0a20 2020 2020 2020 2054  bject..        T
-00012a50: 6865 206f 626a 6563 7420 6973 2069 6465  he object is ide
-00012a60: 6e74 6966 6965 6420 6279 2069 7473 206e  ntified by its n
-00012a70: 616d 6520 2861 6e64 2070 726f 6a65 6374  ame (and project
-00012a80: 2069 7420 6265 6c6f 6e67 7320 746f 292c   it belongs to),
-00012a90: 2061 7320 7765 6c6c 2061 7320 6f70 7469   as well as opti
-00012aa0: 6f6e 616c 6c79 2061 2060 6074 6167 6060  onally a ``tag``
-00012ab0: 206f 7220 6974 730a 2020 2020 2020 2020   or its.        
-00012ac0: 6060 7569 6460 6020 2866 6f72 2076 6572  ``uid`` (for ver
-00012ad0: 7369 6f6e 6564 206f 626a 6563 7429 2e20  sioned object). 
-00012ae0: 4966 2062 6f74 6820 6060 7461 6760 6020  If both ``tag`` 
-00012af0: 616e 6420 6060 7569 6460 6020 6172 6520  and ``uid`` are 
-00012b00: 6f6d 6974 7465 6420 7468 656e 2074 6865  omitted then the
-00012b10: 206f 626a 6563 7420 7769 7468 2074 6167   object with tag
-00012b20: 2060 606c 6174 6573 7460 600a 2020 2020   ``latest``.    
-00012b30: 2020 2020 6973 206d 6f64 6966 6965 642e      is modified.
-00012b40: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00012b50: 206e 616d 653a 204e 616d 6520 6f66 2074   name: Name of t
-00012b60: 6865 206f 626a 6563 7420 746f 2070 6174  he object to pat
-00012b70: 6368 2e0a 2020 2020 2020 2020 3a70 6172  ch..        :par
-00012b80: 616d 2066 6561 7475 7265 5f73 6574 5f75  am feature_set_u
-00012b90: 7064 6174 653a 2054 6865 206d 6f64 6966  pdate: The modif
-00012ba0: 6963 6174 696f 6e73 206e 6565 6465 6420  ications needed 
-00012bb0: 696e 2074 6865 206f 626a 6563 742e 2054  in the object. T
-00012bc0: 6869 7320 7061 7261 6d65 7465 7220 6f6e  his parameter on
-00012bd0: 6c79 2068 6173 2074 6865 2063 6861 6e67  ly has the chang
-00012be0: 6573 2069 6e20 6974 2c0a 2020 2020 2020  es in it,.      
-00012bf0: 2020 2020 2020 6e6f 7420 6120 6675 6c6c        not a full
-00012c00: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
-00012c10: 2020 2020 2045 7861 6d70 6c65 3a3a 0a0a       Example::..
-00012c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c30: 6665 6174 7572 655f 7365 745f 7570 6461  feature_set_upda
-00012c40: 7465 203d 207b 2273 7461 7475 7322 3a20  te = {"status": 
-00012c50: 7b22 7072 6f63 6573 7365 6422 203a 2054  {"processed" : T
-00012c60: 7275 657d 7d0a 0a20 2020 2020 2020 2020  rue}}..         
-00012c70: 2020 2057 696c 6c20 6170 706c 7920 7468     Will apply th
-00012c80: 6520 6669 656c 6420 6060 7374 6174 7573  e field ``status
-00012c90: 2e70 726f 6365 7373 6564 6060 2074 6f20  .processed`` to 
-00012ca0: 7468 6520 6578 6973 7469 6e67 206f 626a  the existing obj
-00012cb0: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
-00012cc0: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
-00012cd0: 6a65 6374 2077 6869 6368 2063 6f6e 7461  ject which conta
-00012ce0: 696e 7320 7468 6520 6d6f 6469 6669 6564  ins the modified
-00012cf0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
-00012d00: 203a 7061 7261 6d20 7461 673a 2054 6865   :param tag: The
-00012d10: 2074 6167 206f 6620 7468 6520 6f62 6a65   tag of the obje
-00012d20: 6374 2074 6f20 6d6f 6469 6679 2e0a 2020  ct to modify..  
-00012d30: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
-00012d40: 3a20 7569 6420 6f66 2074 6865 206f 626a  : uid of the obj
-00012d50: 6563 7420 746f 206d 6f64 6966 792e 0a20  ect to modify.. 
-00012d60: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-00012d70: 7463 685f 6d6f 6465 3a20 5468 6520 7374  tch_mode: The st
-00012d80: 7261 7465 6779 2066 6f72 206d 6572 6769  rategy for mergi
-00012d90: 6e67 2074 6865 2063 6861 6e67 6573 2077  ng the changes w
-00012da0: 6974 6820 7468 6520 6578 6973 7469 6e67  ith the existing
-00012db0: 206f 626a 6563 742e 2043 616e 2062 6520   object. Can be 
-00012dc0: 6569 7468 6572 2060 6072 6570 6c61 6365  either ``replace
-00012dd0: 6060 0a20 2020 2020 2020 2020 2020 206f  ``.            o
-00012de0: 7220 6060 6164 6469 7469 7665 6060 2e0a  r ``additive``..
-00012df0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012e00: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-00012e10: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-00012e20: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-00012e30: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
-00012e40: 6520 3d20 7365 6c66 2e5f 7265 736f 6c76  e = self._resolv
-00012e50: 655f 7265 6665 7265 6e63 6528 7461 672c  e_reference(tag,
-00012e60: 2075 6964 290a 2020 2020 2020 2020 6865   uid).        he
-00012e70: 6164 6572 7320 3d20 7b73 6368 656d 6173  aders = {schemas
-00012e80: 2e48 6561 6465 724e 616d 6573 2e70 6174  .HeaderNames.pat
-00012e90: 6368 5f6d 6f64 653a 2070 6174 6368 5f6d  ch_mode: patch_m
-00012ea0: 6f64 657d 0a20 2020 2020 2020 2070 6174  ode}.        pat
-00012eb0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-00012ec0: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
-00012ed0: 2d73 6574 732f 7b6e 616d 657d 2f72 6566  -sets/{name}/ref
-00012ee0: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
-00012ef0: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
-00012f00: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-00012f10: 6169 6c65 6420 7570 6461 7469 6e67 2066  ailed updating f
-00012f20: 6561 7475 7265 2d73 6574 207b 7072 6f6a  eature-set {proj
-00012f30: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
-00012f40: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
-00012f50: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-00012f60: 2250 4154 4348 222c 0a20 2020 2020 2020  "PATCH",.       
-00012f70: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-00012f80: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00012f90: 7361 6765 2c0a 2020 2020 2020 2020 2020  sage,.          
-00012fa0: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
-00012fb0: 736f 6e28 6665 6174 7572 655f 7365 745f  son(feature_set_
-00012fc0: 7570 6461 7465 292c 0a20 2020 2020 2020  update),.       
-00012fd0: 2020 2020 2068 6561 6465 7273 3d68 6561       headers=hea
-00012fe0: 6465 7273 2c0a 2020 2020 2020 2020 290a  ders,.        ).
-00012ff0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
-00013000: 6665 6174 7572 655f 7365 7428 7365 6c66  feature_set(self
-00013010: 2c20 6e61 6d65 2c20 7072 6f6a 6563 743d  , name, project=
-00013020: 2222 2c20 7461 673d 4e6f 6e65 2c20 7569  "", tag=None, ui
-00013030: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
-00013040: 2022 2222 4465 6c65 7465 2061 203a 7079   """Delete a :py
-00013050: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
-00013060: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
-00013070: 7475 7265 5365 7460 206f 626a 6563 7420  tureSet` object 
-00013080: 6672 6f6d 2074 6865 2044 422e 0a20 2020  from the DB..   
-00013090: 2020 2020 2049 6620 6060 7461 6760 6020       If ``tag`` 
-000130a0: 6f72 2060 6075 6964 6060 2061 7265 2073  or ``uid`` are s
-000130b0: 7065 6369 6669 6564 2c20 7468 656e 206a  pecified, then j
-000130c0: 7573 7420 7468 6520 7665 7273 696f 6e20  ust the version 
-000130d0: 7265 6665 7265 6e63 6564 2062 7920 7468  referenced by th
-000130e0: 656d 2077 696c 6c20 6265 2064 656c 6574  em will be delet
-000130f0: 6564 2e20 5573 696e 6720 626f 7468 0a20  ed. Using both. 
-00013100: 2020 2020 2020 2069 7320 6e6f 7420 616c         is not al
-00013110: 6c6f 7765 642e 0a20 2020 2020 2020 2049  lowed..        I
-00013120: 6620 6e6f 6e65 2061 7265 2073 7065 6369  f none are speci
-00013130: 6669 6564 2c20 7468 656e 2061 6c6c 2069  fied, then all i
-00013140: 6e73 7461 6e63 6573 206f 6620 7468 6520  nstances of the 
-00013150: 6f62 6a65 6374 2077 686f 7365 206e 616d  object whose nam
-00013160: 6520 6973 2060 606e 616d 6560 6020 7769  e is ``name`` wi
-00013170: 6c6c 2062 6520 6465 6c65 7465 642e 0a20  ll be deleted.. 
-00013180: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013190: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
-000131a0: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
-000131b0: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
-000131c0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-000131d0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-000131e0: 747d 2f66 6561 7475 7265 2d73 6574 732f  t}/feature-sets/
-000131f0: 7b6e 616d 657d 220a 0a20 2020 2020 2020  {name}"..       
-00013200: 2069 6620 7461 6720 6f72 2075 6964 3a0a   if tag or uid:.
-00013210: 2020 2020 2020 2020 2020 2020 7265 6665              refe
-00013220: 7265 6e63 6520 3d20 7365 6c66 2e5f 7265  rence = self._re
-00013230: 736f 6c76 655f 7265 6665 7265 6e63 6528  solve_reference(
-00013240: 7461 672c 2075 6964 290a 2020 2020 2020  tag, uid).      
-00013250: 2020 2020 2020 7061 7468 203d 2070 6174        path = pat
-00013260: 6820 2b20 6622 2f72 6566 6572 656e 6365  h + f"/reference
-00013270: 732f 7b72 6566 6572 656e 6365 7d22 0a0a  s/{reference}"..
-00013280: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-00013290: 7373 6167 6520 3d20 6622 4661 696c 6564  ssage = f"Failed
-000132a0: 2064 656c 6574 696e 6720 6665 6174 7572   deleting featur
-000132b0: 652d 7365 7420 7b6e 616d 657d 220a 2020  e-set {name}".  
-000132c0: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-000132d0: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
-000132e0: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-000132f0: 6529 0a0a 2020 2020 6465 6620 6372 6561  e)..    def crea
-00013300: 7465 5f66 6561 7475 7265 5f76 6563 746f  te_feature_vecto
-00013310: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
-00013320: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00013330: 5f76 6563 746f 723a 2055 6e69 6f6e 5b64  _vector: Union[d
-00013340: 6963 742c 2073 6368 656d 6173 2e46 6561  ict, schemas.Fea
-00013350: 7475 7265 5665 6374 6f72 2c20 4665 6174  tureVector, Feat
-00013360: 7572 6556 6563 746f 725d 2c0a 2020 2020  ureVector],.    
-00013370: 2020 2020 7072 6f6a 6563 743d 2222 2c0a      project="",.
-00013380: 2020 2020 2020 2020 7665 7273 696f 6e65          versione
-00013390: 643d 5472 7565 2c0a 2020 2020 2920 2d3e  d=True,.    ) ->
-000133a0: 2064 6963 743a 0a20 2020 2020 2020 2022   dict:.        "
-000133b0: 2222 4372 6561 7465 2061 206e 6577 203a  ""Create a new :
-000133c0: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
-000133d0: 2e66 6561 7475 7265 5f73 746f 7265 2e46  .feature_store.F
-000133e0: 6561 7475 7265 5665 6374 6f72 6020 616e  eatureVector` an
-000133f0: 6420 7361 7665 2069 6e20 7468 6520 3a70  d save in the :p
-00013400: 793a 6d6f 643a 606d 6c72 756e 6020 4442  y:mod:`mlrun` DB
-00013410: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00013420: 6d20 6665 6174 7572 655f 7665 6374 6f72  m feature_vector
-00013430: 3a20 5468 6520 6e65 7720 3a70 793a 636c  : The new :py:cl
-00013440: 6173 733a 607e 6d6c 7275 6e2e 6665 6174  ass:`~mlrun.feat
-00013450: 7572 655f 7374 6f72 652e 4665 6174 7572  ure_store.Featur
-00013460: 6556 6563 746f 7260 2074 6f20 6372 6561  eVector` to crea
-00013470: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
-00013480: 616d 2070 726f 6a65 6374 3a20 4e61 6d65  am project: Name
-00013490: 206f 6620 7072 6f6a 6563 7420 7468 6973   of project this
-000134a0: 2066 6561 7475 7265 2d76 6563 746f 7220   feature-vector 
-000134b0: 6265 6c6f 6e67 7320 746f 2e0a 2020 2020  belongs to..    
-000134c0: 2020 2020 3a70 6172 616d 2076 6572 7369      :param versi
-000134d0: 6f6e 6564 3a20 5768 6574 6865 7220 746f  oned: Whether to
-000134e0: 206d 6169 6e74 6169 6e20 7665 7273 696f   maintain versio
-000134f0: 6e73 2066 6f72 2074 6869 7320 6665 6174  ns for this feat
-00013500: 7572 652d 7665 6374 6f72 2e20 416c 6c20  ure-vector. All 
-00013510: 7665 7273 696f 6e73 206f 6620 6120 7665  versions of a ve
-00013520: 7273 696f 6e65 6420 6f62 6a65 6374 0a20  rsioned object. 
-00013530: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-00013540: 6265 206b 6570 7420 696e 2074 6865 2044  be kept in the D
-00013550: 4220 616e 6420 6361 6e20 6265 2072 6574  B and can be ret
-00013560: 7269 6576 6564 2075 6e74 696c 2065 7870  rieved until exp
-00013570: 6c69 6369 746c 7920 6465 6c65 7465 642e  licitly deleted.
-00013580: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00013590: 733a 2054 6865 203a 7079 3a63 6c61 7373  s: The :py:class
-000135a0: 3a60 7e6d 6c72 756e 2e66 6561 7475 7265  :`~mlrun.feature
-000135b0: 5f73 746f 7265 2e46 6561 7475 7265 5665  _store.FeatureVe
-000135c0: 6374 6f72 6020 6f62 6a65 6374 2028 6173  ctor` object (as
-000135d0: 2064 6963 7429 2e0a 2020 2020 2020 2020   dict)..        
-000135e0: 2222 220a 2020 2020 2020 2020 6966 2069  """.        if i
-000135f0: 7369 6e73 7461 6e63 6528 6665 6174 7572  sinstance(featur
-00013600: 655f 7665 6374 6f72 2c20 7363 6865 6d61  e_vector, schema
-00013610: 732e 4665 6174 7572 6556 6563 746f 7229  s.FeatureVector)
-00013620: 3a0a 2020 2020 2020 2020 2020 2020 6665  :.            fe
-00013630: 6174 7572 655f 7665 6374 6f72 203d 2066  ature_vector = f
-00013640: 6561 7475 7265 5f76 6563 746f 722e 6469  eature_vector.di
-00013650: 6374 2829 0a20 2020 2020 2020 2065 6c69  ct().        eli
-00013660: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
-00013670: 7475 7265 5f76 6563 746f 722c 2046 6561  ture_vector, Fea
-00013680: 7475 7265 5665 6374 6f72 293a 0a20 2020  tureVector):.   
-00013690: 2020 2020 2020 2020 2066 6561 7475 7265           feature
-000136a0: 5f76 6563 746f 7220 3d20 6665 6174 7572  _vector = featur
-000136b0: 655f 7665 6374 6f72 2e74 6f5f 6469 6374  e_vector.to_dict
-000136c0: 2829 0a0a 2020 2020 2020 2020 7072 6f6a  ()..        proj
-000136d0: 6563 7420 3d20 280a 2020 2020 2020 2020  ect = (.        
-000136e0: 2020 2020 7072 6f6a 6563 740a 2020 2020      project.    
-000136f0: 2020 2020 2020 2020 6f72 2066 6561 7475          or featu
-00013700: 7265 5f76 6563 746f 725b 226d 6574 6164  re_vector["metad
-00013710: 6174 6122 5d2e 6765 7428 2270 726f 6a65  ata"].get("proje
-00013720: 6374 222c 204e 6f6e 6529 0a20 2020 2020  ct", None).     
-00013730: 2020 2020 2020 206f 7220 636f 6e66 6967         or config
-00013740: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
-00013750: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00013760: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-00013770: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
-00013780: 6561 7475 7265 2d76 6563 746f 7273 220a  eature-vectors".
-00013790: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-000137a0: 207b 2276 6572 7369 6f6e 6564 223a 2076   {"versioned": v
-000137b0: 6572 7369 6f6e 6564 7d0a 0a20 2020 2020  ersioned}..     
-000137c0: 2020 206e 616d 6520 3d20 6665 6174 7572     name = featur
-000137d0: 655f 7665 6374 6f72 5b22 6d65 7461 6461  e_vector["metada
-000137e0: 7461 225d 5b22 6e61 6d65 225d 0a20 2020  ta"]["name"].   
-000137f0: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-00013800: 6765 203d 2066 2246 6169 6c65 6420 6372  ge = f"Failed cr
-00013810: 6561 7469 6e67 2066 6561 7475 7265 2d76  eating feature-v
-00013820: 6563 746f 7220 7b70 726f 6a65 6374 7d2f  ector {project}/
-00013830: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-00013840: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
-00013850: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-00013860: 2020 2250 4f53 5422 2c0a 2020 2020 2020    "POST",.      
-00013870: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
-00013880: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-00013890: 7373 6167 652c 0a20 2020 2020 2020 2020  ssage,.         
-000138a0: 2020 2070 6172 616d 733d 7061 7261 6d73     params=params
-000138b0: 2c0a 2020 2020 2020 2020 2020 2020 626f  ,.            bo
-000138c0: 6479 3d64 6963 745f 746f 5f6a 736f 6e28  dy=dict_to_json(
-000138d0: 6665 6174 7572 655f 7665 6374 6f72 292c  feature_vector),
-000138e0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000138f0: 2020 2072 6574 7572 6e20 7265 7370 2e6a     return resp.j
-00013900: 736f 6e28 290a 0a20 2020 2064 6566 2067  son()..    def g
-00013910: 6574 5f66 6561 7475 7265 5f76 6563 746f  et_feature_vecto
-00013920: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
-00013930: 206e 616d 653a 2073 7472 2c20 7072 6f6a   name: str, proj
-00013940: 6563 743a 2073 7472 203d 2022 222c 2074  ect: str = "", t
-00013950: 6167 3a20 7374 7220 3d20 4e6f 6e65 2c20  ag: str = None, 
-00013960: 7569 643a 2073 7472 203d 204e 6f6e 650a  uid: str = None.
-00013970: 2020 2020 2920 2d3e 2046 6561 7475 7265      ) -> Feature
-00013980: 5665 6374 6f72 3a0a 2020 2020 2020 2020  Vector:.        
-00013990: 2222 2252 6574 7572 6e20 6120 7370 6563  """Return a spec
-000139a0: 6966 6963 2066 6561 7475 7265 2d76 6563  ific feature-vec
-000139b0: 746f 7220 7265 6665 7265 6e63 6564 2062  tor referenced b
-000139c0: 7920 6974 7320 7461 6720 6f72 2075 6964  y its tag or uid
-000139d0: 2e20 4966 206e 6f6e 6520 6172 6520 7072  . If none are pr
-000139e0: 6f76 6964 6564 2c20 6060 6c61 7465 7374  ovided, ``latest
-000139f0: 6060 2074 6167 2077 696c 6c0a 2020 2020  `` tag will.    
-00013a00: 2020 2020 6265 2075 7365 642e 2222 220a      be used.""".
-00013a10: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00013a20: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-00013a30: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00013a40: 6a65 6374 0a20 2020 2020 2020 2072 6566  ject.        ref
-00013a50: 6572 656e 6365 203d 2073 656c 662e 5f72  erence = self._r
-00013a60: 6573 6f6c 7665 5f72 6566 6572 656e 6365  esolve_reference
-00013a70: 2874 6167 2c20 7569 6429 0a20 2020 2020  (tag, uid).     
-00013a80: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-00013a90: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
-00013aa0: 6561 7475 7265 2d76 6563 746f 7273 2f7b  eature-vectors/{
-00013ab0: 6e61 6d65 7d2f 7265 6665 7265 6e63 6573  name}/references
-00013ac0: 2f7b 7265 6665 7265 6e63 657d 220a 2020  /{reference}".  
-00013ad0: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-00013ae0: 6167 6520 3d20 6622 4661 696c 6564 2072  age = f"Failed r
-00013af0: 6574 7269 6576 696e 6720 6665 6174 7572  etrieving featur
-00013b00: 652d 7665 6374 6f72 207b 7072 6f6a 6563  e-vector {projec
-00013b10: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
-00013b20: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
-00013b30: 7069 5f63 616c 6c28 2247 4554 222c 2070  pi_call("GET", p
-00013b40: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
-00013b50: 6765 290a 2020 2020 2020 2020 7265 7475  ge).        retu
-00013b60: 726e 2046 6561 7475 7265 5665 6374 6f72  rn FeatureVector
-00013b70: 2e66 726f 6d5f 6469 6374 2872 6573 702e  .from_dict(resp.
-00013b80: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-00013b90: 206c 6973 745f 6665 6174 7572 655f 7665   list_feature_ve
-00013ba0: 6374 6f72 7328 0a20 2020 2020 2020 2073  ctors(.        s
-00013bb0: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
-00013bc0: 6a65 6374 3a20 7374 7220 3d20 2222 2c0a  ject: str = "",.
-00013bd0: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
-00013be0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-00013bf0: 2020 7461 673a 2073 7472 203d 204e 6f6e    tag: str = Non
-00013c00: 652c 0a20 2020 2020 2020 2073 7461 7465  e,.        state
-00013c10: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
-00013c20: 2020 2020 2020 6c61 6265 6c73 3a20 4c69        labels: Li
-00013c30: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  st[str] = None,.
-00013c40: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
-00013c50: 6e5f 6279 3a20 556e 696f 6e5b 7363 6865  n_by: Union[sche
-00013c60: 6d61 732e 4665 6174 7572 6553 746f 7265  mas.FeatureStore
-00013c70: 5061 7274 6974 696f 6e42 7946 6965 6c64  PartitionByField
-00013c80: 2c20 7374 725d 203d 204e 6f6e 652c 0a20  , str] = None,. 
-00013c90: 2020 2020 2020 2072 6f77 735f 7065 725f         rows_per_
-00013ca0: 7061 7274 6974 696f 6e3a 2069 6e74 203d  partition: int =
-00013cb0: 2031 2c0a 2020 2020 2020 2020 7061 7274   1,.        part
-00013cc0: 6974 696f 6e5f 736f 7274 5f62 793a 2055  ition_sort_by: U
-00013cd0: 6e69 6f6e 5b73 6368 656d 6173 2e53 6f72  nion[schemas.Sor
-00013ce0: 7446 6965 6c64 2c20 7374 725d 203d 204e  tField, str] = N
-00013cf0: 6f6e 652c 0a20 2020 2020 2020 2070 6172  one,.        par
-00013d00: 7469 7469 6f6e 5f6f 7264 6572 3a20 556e  tition_order: Un
-00013d10: 696f 6e5b 7363 6865 6d61 732e 4f72 6465  ion[schemas.Orde
-00013d20: 7254 7970 652c 2073 7472 5d20 3d20 7363  rType, str] = sc
-00013d30: 6865 6d61 732e 4f72 6465 7254 7970 652e  hemas.OrderType.
-00013d40: 6465 7363 2c0a 2020 2020 2920 2d3e 204c  desc,.    ) -> L
-00013d50: 6973 745b 4665 6174 7572 6556 6563 746f  ist[FeatureVecto
-00013d60: 725d 3a0a 2020 2020 2020 2020 2222 2252  r]:.        """R
-00013d70: 6574 7269 6576 6520 6120 6c69 7374 206f  etrieve a list o
-00013d80: 6620 6665 6174 7572 652d 7665 6374 6f72  f feature-vector
-00013d90: 7320 6d61 7463 6869 6e67 2074 6865 2063  s matching the c
-00013da0: 7269 7465 7269 6120 7072 6f76 6964 6564  riteria provided
-00013db0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00013dc0: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
-00013dd0: 6374 206e 616d 652e 0a20 2020 2020 2020  ct name..       
-00013de0: 203a 7061 7261 6d20 6e61 6d65 3a20 4e61   :param name: Na
-00013df0: 6d65 206f 6620 6665 6174 7572 652d 7665  me of feature-ve
-00013e00: 6374 6f72 2074 6f20 6d61 7463 682e 2054  ctor to match. T
-00013e10: 6869 7320 6973 2061 206c 696b 6520 7175  his is a like qu
-00013e20: 6572 792c 2061 6e64 2069 7320 6361 7365  ery, and is case
-00013e30: 2d69 6e73 656e 7369 7469 7665 2e0a 2020  -insensitive..  
-00013e40: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
-00013e50: 3a20 4d61 7463 6820 6665 6174 7572 652d  : Match feature-
-00013e60: 7665 6374 6f72 7320 7769 7468 2073 7065  vectors with spe
-00013e70: 6369 6669 6320 7461 672e 0a20 2020 2020  cific tag..     
-00013e80: 2020 203a 7061 7261 6d20 7374 6174 653a     :param state:
-00013e90: 204d 6174 6368 2066 6561 7475 7265 2d76   Match feature-v
-00013ea0: 6563 746f 7273 2077 6974 6820 6120 7370  ectors with a sp
-00013eb0: 6563 6966 6963 2073 7461 7465 2e0a 2020  ecific state..  
-00013ec0: 2020 2020 2020 3a70 6172 616d 206c 6162        :param lab
-00013ed0: 656c 733a 204d 6174 6368 2066 6561 7475  els: Match featu
-00013ee0: 7265 2d76 6563 746f 7273 2077 6869 6368  re-vectors which
-00013ef0: 2068 6176 6520 7468 6573 6520 6c61 6265   have these labe
-00013f00: 6c73 2e0a 2020 2020 2020 2020 3a70 6172  ls..        :par
-00013f10: 616d 2070 6172 7469 7469 6f6e 5f62 793a  am partition_by:
-00013f20: 2046 6965 6c64 2074 6f20 6772 6f75 7020   Field to group 
-00013f30: 7265 7375 6c74 7320 6279 2e20 4f6e 6c79  results by. Only
-00013f40: 2061 6c6c 6f77 6564 2076 616c 7565 2069   allowed value i
-00013f50: 7320 606e 616d 6560 2e20 5768 656e 2060  s `name`. When `
-00013f60: 7061 7274 6974 696f 6e5f 6279 6020 6973  partition_by` is
-00013f70: 2073 7065 6369 6669 6564 2c0a 2020 2020   specified,.    
-00013f80: 2020 2020 2020 2020 7468 6520 6070 6172          the `par
-00013f90: 7469 7469 6f6e 5f73 6f72 745f 6279 6020  tition_sort_by` 
-00013fa0: 7061 7261 6d65 7465 7220 6d75 7374 2062  parameter must b
-00013fb0: 6520 7072 6f76 6964 6564 2061 7320 7765  e provided as we
-00013fc0: 6c6c 2e0a 2020 2020 2020 2020 3a70 6172  ll..        :par
-00013fd0: 616d 2072 6f77 735f 7065 725f 7061 7274  am rows_per_part
-00013fe0: 6974 696f 6e3a 2048 6f77 206d 616e 7920  ition: How many 
-00013ff0: 746f 7020 726f 7773 2028 7065 7220 736f  top rows (per so
-00014000: 7274 696e 6720 6465 6669 6e65 6420 6279  rting defined by
-00014010: 2060 7061 7274 6974 696f 6e5f 736f 7274   `partition_sort
-00014020: 5f62 7960 2061 6e64 2060 7061 7274 6974  _by` and `partit
-00014030: 696f 6e5f 6f72 6465 7260 290a 2020 2020  ion_order`).    
-00014040: 2020 2020 2020 2020 746f 2072 6574 7572          to retur
-00014050: 6e20 7065 7220 6772 6f75 702e 2044 6566  n per group. Def
-00014060: 6175 6c74 2076 616c 7565 2069 7320 312e  ault value is 1.
-00014070: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00014080: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
-00014090: 793a 2057 6861 7420 6669 656c 6420 746f  y: What field to
-000140a0: 2073 6f72 7420 7468 6520 7265 7375 6c74   sort the result
-000140b0: 7320 6279 2c20 7769 7468 696e 2065 6163  s by, within eac
-000140c0: 6820 7061 7274 6974 696f 6e20 6465 6669  h partition defi
-000140d0: 6e65 6420 6279 2060 7061 7274 6974 696f  ned by `partitio
-000140e0: 6e5f 6279 602e 0a20 2020 2020 2020 2020  n_by`..         
-000140f0: 2020 2043 7572 7265 6e74 6c79 2074 6865     Currently the
-00014100: 206f 6e6c 7920 616c 6c6f 7765 6420 7661   only allowed va
-00014110: 6c75 6573 2061 7265 2060 6372 6561 7465  lues are `create
-00014120: 6460 2061 6e64 2060 7570 6461 7465 6460  d` and `updated`
-00014130: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00014140: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00014150: 3a20 4f72 6465 7220 6f66 2073 6f72 7469  : Order of sorti
-00014160: 6e67 2077 6974 6869 6e20 7061 7274 6974  ng within partit
-00014170: 696f 6e73 202d 2060 6173 6360 206f 7220  ions - `asc` or 
-00014180: 6064 6573 6360 2e20 4465 6661 756c 7420  `desc`. Default 
-00014190: 6973 2060 6465 7363 602e 0a20 2020 2020  is `desc`..     
-000141a0: 2020 203a 7265 7475 726e 733a 204c 6973     :returns: Lis
-000141b0: 7420 6f66 206d 6174 6368 696e 6720 3a70  t of matching :p
-000141c0: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-000141d0: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-000141e0: 6174 7572 6556 6563 746f 7260 206f 626a  atureVector` obj
-000141f0: 6563 7473 2e0a 2020 2020 2020 2020 2222  ects..        ""
-00014200: 220a 0a20 2020 2020 2020 2070 726f 6a65  "..        proje
-00014210: 6374 203d 2070 726f 6a65 6374 206f 7220  ct = project or 
-00014220: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
-00014230: 726f 6a65 6374 0a0a 2020 2020 2020 2020  roject..        
-00014240: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
-00014250: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
-00014260: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00014270: 2022 7374 6174 6522 3a20 7374 6174 652c   "state": state,
-00014280: 0a20 2020 2020 2020 2020 2020 2022 7461  .            "ta
-00014290: 6722 3a20 7461 672c 0a20 2020 2020 2020  g": tag,.       
-000142a0: 2020 2020 2022 6c61 6265 6c22 3a20 6c61       "label": la
-000142b0: 6265 6c73 206f 7220 5b5d 2c0a 2020 2020  bels or [],.    
-000142c0: 2020 2020 7d0a 2020 2020 2020 2020 6966      }.        if
-000142d0: 2070 6172 7469 7469 6f6e 5f62 793a 0a20   partition_by:. 
-000142e0: 2020 2020 2020 2020 2020 2070 6172 616d             param
-000142f0: 732e 7570 6461 7465 280a 2020 2020 2020  s.update(.      
-00014300: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00014310: 6765 6e65 7261 7465 5f70 6172 7469 7469  generate_partiti
-00014320: 6f6e 5f62 795f 7061 7261 6d73 280a 2020  on_by_params(.  
-00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014340: 2020 7363 6865 6d61 732e 4665 6174 7572    schemas.Featur
-00014350: 6553 746f 7265 5061 7274 6974 696f 6e42  eStorePartitionB
-00014360: 7946 6965 6c64 2c0a 2020 2020 2020 2020  yField,.        
-00014370: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00014380: 6974 696f 6e5f 6279 2c0a 2020 2020 2020  ition_by,.      
-00014390: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000143a0: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
-000143b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000143c0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-000143d0: 736f 7274 5f62 792c 0a20 2020 2020 2020  sort_by,.       
-000143e0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-000143f0: 7469 7469 6f6e 5f6f 7264 6572 2c0a 2020  tition_order,.  
-00014400: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00014410: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00014420: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00014430: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00014440: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
-00014450: 7273 220a 0a20 2020 2020 2020 2065 7272  rs"..        err
-00014460: 6f72 5f6d 6573 7361 6765 203d 2028 0a20  or_message = (. 
-00014470: 2020 2020 2020 2020 2020 2066 2246 6169             f"Fai
-00014480: 6c65 6420 6c69 7374 696e 6720 6665 6174  led listing feat
-00014490: 7572 652d 7665 6374 6f72 732c 2070 726f  ure-vectors, pro
-000144a0: 6a65 6374 3a20 7b70 726f 6a65 6374 7d2c  ject: {project},
-000144b0: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
-000144c0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-000144d0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-000144e0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
-000144f0: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-00014500: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
-00014510: 6d73 290a 2020 2020 2020 2020 6665 6174  ms).        feat
-00014520: 7572 655f 7665 6374 6f72 7320 3d20 7265  ure_vectors = re
-00014530: 7370 2e6a 736f 6e28 295b 2266 6561 7475  sp.json()["featu
-00014540: 7265 5f76 6563 746f 7273 225d 0a20 2020  re_vectors"].   
-00014550: 2020 2020 2069 6620 6665 6174 7572 655f       if feature_
-00014560: 7665 6374 6f72 733a 0a20 2020 2020 2020  vectors:.       
-00014570: 2020 2020 2072 6574 7572 6e20 5b46 6561       return [Fea
-00014580: 7475 7265 5665 6374 6f72 2e66 726f 6d5f  tureVector.from_
-00014590: 6469 6374 286f 626a 2920 666f 7220 6f62  dict(obj) for ob
-000145a0: 6a20 696e 2066 6561 7475 7265 5f76 6563  j in feature_vec
-000145b0: 746f 7273 5d0a 0a20 2020 2064 6566 2073  tors]..    def s
-000145c0: 746f 7265 5f66 6561 7475 7265 5f76 6563  tore_feature_vec
-000145d0: 746f 7228 0a20 2020 2020 2020 2073 656c  tor(.        sel
-000145e0: 662c 0a20 2020 2020 2020 2066 6561 7475  f,.        featu
-000145f0: 7265 5f76 6563 746f 723a 2055 6e69 6f6e  re_vector: Union
-00014600: 5b64 6963 742c 2073 6368 656d 6173 2e46  [dict, schemas.F
-00014610: 6561 7475 7265 5665 6374 6f72 2c20 4665  eatureVector, Fe
-00014620: 6174 7572 6556 6563 746f 725d 2c0a 2020  atureVector],.  
-00014630: 2020 2020 2020 6e61 6d65 3d4e 6f6e 652c        name=None,
-00014640: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00014650: 3d22 222c 0a20 2020 2020 2020 2074 6167  ="",.        tag
-00014660: 3d4e 6f6e 652c 0a20 2020 2020 2020 2075  =None,.        u
-00014670: 6964 3d4e 6f6e 652c 0a20 2020 2020 2020  id=None,.       
-00014680: 2076 6572 7369 6f6e 6564 3d54 7275 652c   versioned=True,
-00014690: 0a20 2020 2029 202d 3e20 6469 6374 3a0a  .    ) -> dict:.
-000146a0: 2020 2020 2020 2020 2222 2253 746f 7265          """Store
-000146b0: 2061 203a 7079 3a63 6c61 7373 3a60 7e6d   a :py:class:`~m
-000146c0: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
-000146d0: 7265 2e46 6561 7475 7265 5665 6374 6f72  re.FeatureVector
-000146e0: 6020 6f62 6a65 6374 2069 6e20 7468 6520  ` object in the 
-000146f0: 3a70 793a 6d6f 643a 606d 6c72 756e 6020  :py:mod:`mlrun` 
-00014700: 4442 2e20 5468 650a 2020 2020 2020 2020  DB. The.        
-00014710: 6665 6174 7572 652d 7665 6374 6f72 2063  feature-vector c
-00014720: 616e 2062 6520 6569 7468 6572 2061 206e  an be either a n
-00014730: 6577 206f 626a 6563 7420 6f72 2061 206d  ew object or a m
-00014740: 6f64 6966 6963 6174 696f 6e20 746f 2065  odification to e
-00014750: 7869 7374 696e 6720 6f62 6a65 6374 2072  xisting object r
-00014760: 6566 6572 656e 6365 6420 6279 2074 6865  eferenced by the
-00014770: 2070 6172 616d 730a 2020 2020 2020 2020   params.        
-00014780: 6f66 2074 6865 2066 756e 6374 696f 6e2e  of the function.
-00014790: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000147a0: 2066 6561 7475 7265 5f76 6563 746f 723a   feature_vector:
-000147b0: 2054 6865 203a 7079 3a63 6c61 7373 3a60   The :py:class:`
-000147c0: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-000147d0: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
-000147e0: 6f72 6020 746f 2073 746f 7265 2e0a 2020  or` to store..  
-000147f0: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
-00014800: 653a 2020 2020 4e61 6d65 206f 6620 6665  e:    Name of fe
-00014810: 6174 7572 6520 7665 6374 6f72 2e0a 2020  ature vector..  
-00014820: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
-00014830: 6a65 6374 3a20 4e61 6d65 206f 6620 7072  ject: Name of pr
-00014840: 6f6a 6563 7420 7468 6973 2066 6561 7475  oject this featu
-00014850: 7265 2d76 6563 746f 7220 6265 6c6f 6e67  re-vector belong
-00014860: 7320 746f 2e0a 2020 2020 2020 2020 3a70  s to..        :p
-00014870: 6172 616d 2074 6167 3a20 5468 6520 6060  aram tag: The ``
-00014880: 7461 6760 6020 6f66 2074 6865 206f 626a  tag`` of the obj
-00014890: 6563 7420 746f 2072 6570 6c61 6365 2069  ect to replace i
-000148a0: 6e20 7468 6520 4442 2c20 666f 7220 6578  n the DB, for ex
-000148b0: 616d 706c 6520 6060 6c61 7465 7374 6060  ample ``latest``
-000148c0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000148d0: 2075 6964 3a20 5468 6520 6060 7569 6460   uid: The ``uid`
-000148e0: 6020 6f66 2074 6865 206f 626a 6563 7420  ` of the object 
-000148f0: 746f 2072 6570 6c61 6365 2069 6e20 7468  to replace in th
-00014900: 6520 4442 2e20 4966 2075 7369 6e67 2074  e DB. If using t
-00014910: 6869 7320 7061 7261 6d65 7465 722c 2074  his parameter, t
-00014920: 6865 206d 6f64 6966 6965 6420 6f62 6a65  he modified obje
-00014930: 6374 0a20 2020 2020 2020 2020 2020 206d  ct.            m
-00014940: 7573 7420 6861 7665 2074 6865 2073 616d  ust have the sam
-00014950: 6520 6060 7569 6460 6020 6f66 2074 6865  e ``uid`` of the
-00014960: 2070 7265 7669 6f75 736c 792d 6578 6973   previously-exis
-00014970: 7469 6e67 206f 626a 6563 742e 2054 6869  ting object. Thi
-00014980: 7320 6361 6e6e 6f74 2062 6520 7573 6564  s cannot be used
-00014990: 2066 6f72 206e 6f6e 2d76 6572 7369 6f6e   for non-version
-000149a0: 6564 206f 626a 6563 7473 2e0a 2020 2020  ed objects..    
-000149b0: 2020 2020 3a70 6172 616d 2076 6572 7369      :param versi
-000149c0: 6f6e 6564 3a20 5768 6574 6865 7220 746f  oned: Whether to
-000149d0: 206d 6169 6e74 6169 6e20 7665 7273 696f   maintain versio
-000149e0: 6e73 2066 6f72 2074 6869 7320 6665 6174  ns for this feat
-000149f0: 7572 652d 7665 6374 6f72 2e20 416c 6c20  ure-vector. All 
-00014a00: 7665 7273 696f 6e73 206f 6620 6120 7665  versions of a ve
-00014a10: 7273 696f 6e65 6420 6f62 6a65 6374 0a20  rsioned object. 
-00014a20: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-00014a30: 6265 206b 6570 7420 696e 2074 6865 2044  be kept in the D
-00014a40: 4220 616e 6420 6361 6e20 6265 2072 6574  B and can be ret
-00014a50: 7269 6576 6564 2075 6e74 696c 2065 7870  rieved until exp
-00014a60: 6c69 6369 746c 7920 6465 6c65 7465 642e  licitly deleted.
-00014a70: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00014a80: 733a 2054 6865 203a 7079 3a63 6c61 7373  s: The :py:class
-00014a90: 3a60 7e6d 6c72 756e 2e66 6561 7475 7265  :`~mlrun.feature
-00014aa0: 5f73 746f 7265 2e46 6561 7475 7265 5665  _store.FeatureVe
-00014ab0: 6374 6f72 6020 6f62 6a65 6374 2028 6173  ctor` object (as
-00014ac0: 2064 6963 7429 2e0a 2020 2020 2020 2020   dict)..        
-00014ad0: 2222 220a 0a20 2020 2020 2020 2072 6566  """..        ref
-00014ae0: 6572 656e 6365 203d 2073 656c 662e 5f72  erence = self._r
-00014af0: 6573 6f6c 7665 5f72 6566 6572 656e 6365  esolve_reference
-00014b00: 2874 6167 2c20 7569 6429 0a20 2020 2020  (tag, uid).     
-00014b10: 2020 2070 6172 616d 7320 3d20 7b22 7665     params = {"ve
-00014b20: 7273 696f 6e65 6422 3a20 7665 7273 696f  rsioned": versio
-00014b30: 6e65 647d 0a0a 2020 2020 2020 2020 6966  ned}..        if
-00014b40: 2069 7369 6e73 7461 6e63 6528 6665 6174   isinstance(feat
-00014b50: 7572 655f 7665 6374 6f72 2c20 7363 6865  ure_vector, sche
-00014b60: 6d61 732e 4665 6174 7572 6556 6563 746f  mas.FeatureVecto
-00014b70: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00014b80: 6665 6174 7572 655f 7665 6374 6f72 203d  feature_vector =
-00014b90: 2066 6561 7475 7265 5f76 6563 746f 722e   feature_vector.
-00014ba0: 6469 6374 2829 0a20 2020 2020 2020 2065  dict().        e
-00014bb0: 6c69 6620 6973 696e 7374 616e 6365 2866  lif isinstance(f
-00014bc0: 6561 7475 7265 5f76 6563 746f 722c 2046  eature_vector, F
-00014bd0: 6561 7475 7265 5665 6374 6f72 293a 0a20  eatureVector):. 
-00014be0: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00014bf0: 7265 5f76 6563 746f 7220 3d20 6665 6174  re_vector = feat
-00014c00: 7572 655f 7665 6374 6f72 2e74 6f5f 6469  ure_vector.to_di
-00014c10: 6374 2829 0a0a 2020 2020 2020 2020 6e61  ct()..        na
-00014c20: 6d65 203d 206e 616d 6520 6f72 2066 6561  me = name or fea
-00014c30: 7475 7265 5f76 6563 746f 725b 226d 6574  ture_vector["met
-00014c40: 6164 6174 6122 5d5b 226e 616d 6522 5d0a  adata"]["name"].
-00014c50: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
-00014c60: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00014c70: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-00014c80: 2020 2020 6f72 2066 6561 7475 7265 5f76      or feature_v
-00014c90: 6563 746f 725b 226d 6574 6164 6174 6122  ector["metadata"
-00014ca0: 5d2e 6765 7428 2270 726f 6a65 6374 2229  ].get("project")
-00014cb0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-00014cc0: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
-00014cd0: 726f 6a65 6374 0a20 2020 2020 2020 2029  roject.        )
-00014ce0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00014cf0: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
-00014d00: 6563 747d 2f66 6561 7475 7265 2d76 6563  ect}/feature-vec
-00014d10: 746f 7273 2f7b 6e61 6d65 7d2f 7265 6665  tors/{name}/refe
-00014d20: 7265 6e63 6573 2f7b 7265 6665 7265 6e63  rences/{referenc
-00014d30: 657d 220a 2020 2020 2020 2020 6572 726f  e}".        erro
-00014d40: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-00014d50: 696c 6564 2073 746f 7269 6e67 2066 6561  iled storing fea
-00014d60: 7475 7265 2d76 6563 746f 7220 7b70 726f  ture-vector {pro
-00014d70: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
-00014d80: 2020 2020 2020 7265 7370 203d 2073 656c        resp = sel
-00014d90: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-00014da0: 2020 2020 2020 2020 2250 5554 222c 2070          "PUT", p
-00014db0: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
-00014dc0: 6765 2c20 7061 7261 6d73 3d70 6172 616d  ge, params=param
-00014dd0: 732c 2062 6f64 793d 6469 6374 5f74 6f5f  s, body=dict_to_
-00014de0: 6a73 6f6e 2866 6561 7475 7265 5f76 6563  json(feature_vec
-00014df0: 746f 7229 0a20 2020 2020 2020 2029 0a20  tor).        ). 
-00014e00: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00014e10: 7370 2e6a 736f 6e28 290a 0a20 2020 2064  sp.json()..    d
-00014e20: 6566 2070 6174 6368 5f66 6561 7475 7265  ef patch_feature
-00014e30: 5f76 6563 746f 7228 0a20 2020 2020 2020  _vector(.       
-00014e40: 2073 656c 662c 0a20 2020 2020 2020 206e   self,.        n
-00014e50: 616d 652c 0a20 2020 2020 2020 2066 6561  ame,.        fea
-00014e60: 7475 7265 5f76 6563 746f 725f 7570 6461  ture_vector_upda
-00014e70: 7465 3a20 6469 6374 2c0a 2020 2020 2020  te: dict,.      
-00014e80: 2020 7072 6f6a 6563 743d 2222 2c0a 2020    project="",.  
-00014e90: 2020 2020 2020 7461 673d 4e6f 6e65 2c0a        tag=None,.
-00014ea0: 2020 2020 2020 2020 7569 643d 4e6f 6e65          uid=None
-00014eb0: 2c0a 2020 2020 2020 2020 7061 7463 685f  ,.        patch_
-00014ec0: 6d6f 6465 3a20 556e 696f 6e5b 7374 722c  mode: Union[str,
-00014ed0: 2073 6368 656d 6173 2e50 6174 6368 4d6f   schemas.PatchMo
-00014ee0: 6465 5d20 3d20 7363 6865 6d61 732e 5061  de] = schemas.Pa
-00014ef0: 7463 684d 6f64 652e 7265 706c 6163 652c  tchMode.replace,
-00014f00: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00014f10: 2222 224d 6f64 6966 7920 2870 6174 6368  """Modify (patch
-00014f20: 2920 616e 2065 7869 7374 696e 6720 3a70  ) an existing :p
-00014f30: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-00014f40: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-00014f50: 6174 7572 6556 6563 746f 7260 206f 626a  atureVector` obj
-00014f60: 6563 742e 0a20 2020 2020 2020 2054 6865  ect..        The
-00014f70: 206f 626a 6563 7420 6973 2069 6465 6e74   object is ident
-00014f80: 6966 6965 6420 6279 2069 7473 206e 616d  ified by its nam
-00014f90: 6520 2861 6e64 2070 726f 6a65 6374 2069  e (and project i
-00014fa0: 7420 6265 6c6f 6e67 7320 746f 292c 2061  t belongs to), a
-00014fb0: 7320 7765 6c6c 2061 7320 6f70 7469 6f6e  s well as option
-00014fc0: 616c 6c79 2061 2060 6074 6167 6060 206f  ally a ``tag`` o
-00014fd0: 7220 6974 730a 2020 2020 2020 2020 6060  r its.        ``
-00014fe0: 7569 6460 6020 2866 6f72 2076 6572 7369  uid`` (for versi
-00014ff0: 6f6e 6564 206f 626a 6563 7429 2e20 4966  oned object). If
-00015000: 2062 6f74 6820 6060 7461 6760 6020 616e   both ``tag`` an
-00015010: 6420 6060 7569 6460 6020 6172 6520 6f6d  d ``uid`` are om
-00015020: 6974 7465 6420 7468 656e 2074 6865 206f  itted then the o
-00015030: 626a 6563 7420 7769 7468 2074 6167 2060  bject with tag `
-00015040: 606c 6174 6573 7460 600a 2020 2020 2020  `latest``.      
-00015050: 2020 6973 206d 6f64 6966 6965 642e 0a0a    is modified...
-00015060: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
-00015070: 616d 653a 204e 616d 6520 6f66 2074 6865  ame: Name of the
-00015080: 206f 626a 6563 7420 746f 2070 6174 6368   object to patch
-00015090: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000150a0: 2066 6561 7475 7265 5f76 6563 746f 725f   feature_vector_
-000150b0: 7570 6461 7465 3a20 5468 6520 6d6f 6469  update: The modi
-000150c0: 6669 6361 7469 6f6e 7320 6e65 6564 6564  fications needed
-000150d0: 2069 6e20 7468 6520 6f62 6a65 6374 2e20   in the object. 
-000150e0: 5468 6973 2070 6172 616d 6574 6572 206f  This parameter o
-000150f0: 6e6c 7920 6861 7320 7468 6520 6368 616e  nly has the chan
-00015100: 6765 7320 696e 2069 742c 0a20 2020 2020  ges in it,.     
-00015110: 2020 2020 2020 206e 6f74 2061 2066 756c         not a ful
-00015120: 6c20 6f62 6a65 6374 2e0a 2020 2020 2020  l object..      
-00015130: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-00015140: 3a20 5072 6f6a 6563 7420 7768 6963 6820  : Project which 
-00015150: 636f 6e74 6169 6e73 2074 6865 206d 6f64  contains the mod
-00015160: 6966 6965 6420 6f62 6a65 6374 2e0a 2020  ified object..  
-00015170: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
-00015180: 3a20 5468 6520 7461 6720 6f66 2074 6865  : The tag of the
-00015190: 206f 626a 6563 7420 746f 206d 6f64 6966   object to modif
-000151a0: 792e 0a20 2020 2020 2020 203a 7061 7261  y..        :para
-000151b0: 6d20 7569 643a 2075 6964 206f 6620 7468  m uid: uid of th
-000151c0: 6520 6f62 6a65 6374 2074 6f20 6d6f 6469  e object to modi
-000151d0: 6679 2e0a 2020 2020 2020 2020 3a70 6172  fy..        :par
-000151e0: 616d 2070 6174 6368 5f6d 6f64 653a 2054  am patch_mode: T
-000151f0: 6865 2073 7472 6174 6567 7920 666f 7220  he strategy for 
-00015200: 6d65 7267 696e 6720 7468 6520 6368 616e  merging the chan
-00015210: 6765 7320 7769 7468 2074 6865 2065 7869  ges with the exi
-00015220: 7374 696e 6720 6f62 6a65 6374 2e20 4361  sting object. Ca
-00015230: 6e20 6265 2065 6974 6865 7220 6060 7265  n be either ``re
-00015240: 706c 6163 6560 600a 2020 2020 2020 2020  place``.        
-00015250: 2020 2020 6f72 2060 6061 6464 6974 6976      or ``additiv
-00015260: 6560 602e 0a20 2020 2020 2020 2022 2222  e``..        """
-00015270: 0a20 2020 2020 2020 2072 6566 6572 656e  .        referen
-00015280: 6365 203d 2073 656c 662e 5f72 6573 6f6c  ce = self._resol
-00015290: 7665 5f72 6566 6572 656e 6365 2874 6167  ve_reference(tag
-000152a0: 2c20 7569 6429 0a20 2020 2020 2020 2070  , uid).        p
-000152b0: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-000152c0: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-000152d0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
-000152e0: 2020 2068 6561 6465 7273 203d 207b 7363     headers = {sc
-000152f0: 6865 6d61 732e 4865 6164 6572 4e61 6d65  hemas.HeaderName
-00015300: 732e 7061 7463 685f 6d6f 6465 3a20 7061  s.patch_mode: pa
-00015310: 7463 685f 6d6f 6465 7d0a 2020 2020 2020  tch_mode}.      
-00015320: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
-00015330: 6374 732f 7b70 726f 6a65 6374 7d2f 6665  cts/{project}/fe
-00015340: 6174 7572 652d 7665 6374 6f72 732f 7b6e  ature-vectors/{n
-00015350: 616d 657d 2f72 6566 6572 656e 6365 732f  ame}/references/
-00015360: 7b72 6566 6572 656e 6365 7d22 0a20 2020  {reference}".   
-00015370: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-00015380: 6765 203d 2066 2246 6169 6c65 6420 7570  ge = f"Failed up
-00015390: 6461 7469 6e67 2066 6561 7475 7265 2d76  dating feature-v
-000153a0: 6563 746f 7220 7b70 726f 6a65 6374 7d2f  ector {project}/
-000153b0: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-000153c0: 7365 6c66 2e61 7069 5f63 616c 6c28 0a20  self.api_call(. 
-000153d0: 2020 2020 2020 2020 2020 2022 5041 5443             "PATC
-000153e0: 4822 2c0a 2020 2020 2020 2020 2020 2020  H",.            
-000153f0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-00015400: 2020 6572 726f 725f 6d65 7373 6167 652c    error_message,
-00015410: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
-00015420: 793d 6469 6374 5f74 6f5f 6a73 6f6e 2866  y=dict_to_json(f
-00015430: 6561 7475 7265 5f76 6563 746f 725f 7570  eature_vector_up
-00015440: 6461 7465 292c 0a20 2020 2020 2020 2020  date),.         
-00015450: 2020 2068 6561 6465 7273 3d68 6561 6465     headers=heade
-00015460: 7273 2c0a 2020 2020 2020 2020 290a 0a20  rs,.        ).. 
-00015470: 2020 2064 6566 2064 656c 6574 655f 6665     def delete_fe
-00015480: 6174 7572 655f 7665 6374 6f72 2873 656c  ature_vector(sel
-00015490: 662c 206e 616d 652c 2070 726f 6a65 6374  f, name, project
-000154a0: 3d22 222c 2074 6167 3d4e 6f6e 652c 2075  ="", tag=None, u
-000154b0: 6964 3d4e 6f6e 6529 3a0a 2020 2020 2020  id=None):.      
-000154c0: 2020 2222 2244 656c 6574 6520 6120 3a70    """Delete a :p
-000154d0: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-000154e0: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-000154f0: 6174 7572 6556 6563 746f 7260 206f 626a  atureVector` obj
-00015500: 6563 7420 6672 6f6d 2074 6865 2044 422e  ect from the DB.
-00015510: 0a20 2020 2020 2020 2049 6620 6060 7461  .        If ``ta
-00015520: 6760 6020 6f72 2060 6075 6964 6060 2061  g`` or ``uid`` a
-00015530: 7265 2073 7065 6369 6669 6564 2c20 7468  re specified, th
-00015540: 656e 206a 7573 7420 7468 6520 7665 7273  en just the vers
-00015550: 696f 6e20 7265 6665 7265 6e63 6564 2062  ion referenced b
-00015560: 7920 7468 656d 2077 696c 6c20 6265 2064  y them will be d
-00015570: 656c 6574 6564 2e20 5573 696e 6720 626f  eleted. Using bo
-00015580: 7468 0a20 2020 2020 2020 2069 7320 6e6f  th.        is no
-00015590: 7420 616c 6c6f 7765 642e 0a20 2020 2020  t allowed..     
-000155a0: 2020 2049 6620 6e6f 6e65 2061 7265 2073     If none are s
-000155b0: 7065 6369 6669 6564 2c20 7468 656e 2061  pecified, then a
-000155c0: 6c6c 2069 6e73 7461 6e63 6573 206f 6620  ll instances of 
-000155d0: 7468 6520 6f62 6a65 6374 2077 686f 7365  the object whose
-000155e0: 206e 616d 6520 6973 2060 606e 616d 6560   name is ``name`
-000155f0: 6020 7769 6c6c 2062 6520 6465 6c65 7465  ` will be delete
-00015600: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-00015610: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-00015620: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
-00015630: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
-00015640: 6374 0a20 2020 2020 2020 2070 6174 6820  ct.        path 
-00015650: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00015660: 6f6a 6563 747d 2f66 6561 7475 7265 2d76  oject}/feature-v
-00015670: 6563 746f 7273 2f7b 6e61 6d65 7d22 0a20  ectors/{name}". 
-00015680: 2020 2020 2020 2069 6620 7461 6720 6f72         if tag or
-00015690: 2075 6964 3a0a 2020 2020 2020 2020 2020   uid:.          
-000156a0: 2020 7265 6665 7265 6e63 6520 3d20 7365    reference = se
-000156b0: 6c66 2e5f 7265 736f 6c76 655f 7265 6665  lf._resolve_refe
-000156c0: 7265 6e63 6528 7461 672c 2075 6964 290a  rence(tag, uid).
-000156d0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-000156e0: 203d 2070 6174 6820 2b20 6622 2f72 6566   = path + f"/ref
-000156f0: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
-00015700: 6365 7d22 0a0a 2020 2020 2020 2020 6572  ce}"..        er
-00015710: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
-00015720: 4661 696c 6564 2064 656c 6574 696e 6720  Failed deleting 
-00015730: 6665 6174 7572 652d 7665 6374 6f72 207b  feature-vector {
-00015740: 6e61 6d65 7d22 0a20 2020 2020 2020 2073  name}".        s
-00015750: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
-00015760: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
-00015770: 6f72 5f6d 6573 7361 6765 290a 0a20 2020  or_message)..   
-00015780: 2064 6566 2074 6167 5f6f 626a 6563 7473   def tag_objects
-00015790: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000157a0: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
-000157b0: 2073 7472 2c0a 2020 2020 2020 2020 7461   str,.        ta
-000157c0: 675f 6e61 6d65 3a20 7374 722c 0a20 2020  g_name: str,.   
-000157d0: 2020 2020 206f 626a 6563 7473 3a20 556e       objects: Un
-000157e0: 696f 6e5b 6d6c 7275 6e2e 6170 692e 7363  ion[mlrun.api.sc
-000157f0: 6865 6d61 732e 5461 674f 626a 6563 7473  hemas.TagObjects
-00015800: 2c20 6469 6374 5d2c 0a20 2020 2020 2020  , dict],.       
-00015810: 2072 6570 6c61 6365 3a20 626f 6f6c 203d   replace: bool =
-00015820: 2046 616c 7365 2c0a 2020 2020 293a 0a20   False,.    ):. 
-00015830: 2020 2020 2020 2022 2222 5461 6720 6120         """Tag a 
-00015840: 6c69 7374 206f 6620 6f62 6a65 6374 732e  list of objects.
-00015850: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00015860: 2070 726f 6a65 6374 3a20 5072 6f6a 6563   project: Projec
-00015870: 7420 7768 6963 6820 636f 6e74 6169 6e73  t which contains
-00015880: 2074 6865 206f 626a 6563 7473 2e0a 2020   the objects..  
-00015890: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
-000158a0: 5f6e 616d 653a 2054 6865 2074 6167 2074  _name: The tag t
-000158b0: 6f20 7365 7420 6f6e 2074 6865 206f 626a  o set on the obj
-000158c0: 6563 7473 2e0a 2020 2020 2020 2020 3a70  ects..        :p
-000158d0: 6172 616d 206f 626a 6563 7473 3a20 5468  aram objects: Th
-000158e0: 6520 6f62 6a65 6374 7320 746f 2074 6167  e objects to tag
-000158f0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00015900: 2072 6570 6c61 6365 3a20 5768 6574 6865   replace: Whethe
-00015910: 7220 746f 2072 6570 6c61 6365 2074 6865  r to replace the
-00015920: 2065 7869 7374 696e 6720 7461 6773 206f   existing tags o
-00015930: 6620 7468 6520 6f62 6a65 6374 7320 6f72  f the objects or
-00015940: 2074 6f20 6164 6420 7468 6520 6e65 7720   to add the new 
-00015950: 7461 6720 746f 2074 6865 6d2e 0a20 2020  tag to them..   
-00015960: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00015970: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
-00015980: 6374 732f 7b70 726f 6a65 6374 7d2f 7461  cts/{project}/ta
-00015990: 6773 2f7b 7461 675f 6e61 6d65 7d22 0a20  gs/{tag_name}". 
-000159a0: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-000159b0: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-000159c0: 746f 2074 6167 207b 7461 675f 6e61 6d65  to tag {tag_name
-000159d0: 7d20 6f6e 206f 626a 6563 7473 207b 6f62  } on objects {ob
-000159e0: 6a65 6374 737d 220a 2020 2020 2020 2020  jects}".        
-000159f0: 6d65 7468 6f64 203d 2022 504f 5354 2220  method = "POST" 
-00015a00: 6966 2072 6570 6c61 6365 2065 6c73 6520  if replace else 
-00015a10: 2250 5554 220a 2020 2020 2020 2020 7365  "PUT".        se
-00015a20: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-00015a30: 2020 2020 2020 2020 206d 6574 686f 642c           method,
-00015a40: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00015a50: 682c 0a20 2020 2020 2020 2020 2020 2065  h,.            e
-00015a60: 7272 6f72 5f6d 6573 7361 6765 2c0a 2020  rror_message,.  
-00015a70: 2020 2020 2020 2020 2020 626f 6479 3d64            body=d
-00015a80: 6963 745f 746f 5f6a 736f 6e28 0a20 2020  ict_to_json(.   
-00015a90: 2020 2020 2020 2020 2020 2020 206f 626a               obj
-00015aa0: 6563 7473 2e64 6963 7428 290a 2020 2020  ects.dict().    
-00015ab0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00015ac0: 7369 6e73 7461 6e63 6528 6f62 6a65 6374  sinstance(object
-00015ad0: 732c 206d 6c72 756e 2e61 7069 2e73 6368  s, mlrun.api.sch
-00015ae0: 656d 6173 2e54 6167 4f62 6a65 6374 7329  emas.TagObjects)
-00015af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015b00: 2065 6c73 6520 6f62 6a65 6374 730a 2020   else objects.  
-00015b10: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00015b20: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00015b30: 6465 6c65 7465 5f6f 626a 6563 7473 5f74  delete_objects_t
-00015b40: 6167 280a 2020 2020 2020 2020 7365 6c66  ag(.        self
-00015b50: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00015b60: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
-00015b70: 7461 675f 6e61 6d65 3a20 7374 722c 0a20  tag_name: str,. 
-00015b80: 2020 2020 2020 2074 6167 5f6f 626a 6563         tag_objec
-00015b90: 7473 3a20 556e 696f 6e5b 6d6c 7275 6e2e  ts: Union[mlrun.
-00015ba0: 6170 692e 7363 6865 6d61 732e 5461 674f  api.schemas.TagO
-00015bb0: 626a 6563 7473 2c20 6469 6374 5d2c 0a20  bjects, dict],. 
-00015bc0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00015bd0: 2244 656c 6574 6520 6120 7461 6720 6672  "Delete a tag fr
-00015be0: 6f6d 2061 206c 6973 7420 6f66 206f 626a  om a list of obj
-00015bf0: 6563 7473 2e0a 0a20 2020 2020 2020 203a  ects...        :
-00015c00: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00015c10: 726f 6a65 6374 2077 6869 6368 2063 6f6e  roject which con
-00015c20: 7461 696e 7320 7468 6520 6f62 6a65 6374  tains the object
-00015c30: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-00015c40: 6d20 7461 675f 6e61 6d65 3a20 5468 6520  m tag_name: The 
-00015c50: 7461 6720 746f 2064 656c 6574 6520 6672  tag to delete fr
-00015c60: 6f6d 2074 6865 206f 626a 6563 7473 2e0a  om the objects..
-00015c70: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-00015c80: 6167 5f6f 626a 6563 7473 3a20 5468 6520  ag_objects: The 
-00015c90: 6f62 6a65 6374 7320 746f 2064 656c 6574  objects to delet
-00015ca0: 6520 7468 6520 7461 6720 6672 6f6d 2e0a  e the tag from..
-00015cb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015cc0: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
-00015cd0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
-00015ce0: 2f74 6167 732f 7b74 6167 5f6e 616d 657d  /tags/{tag_name}
-00015cf0: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
-00015d00: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00015d10: 6564 2064 656c 6574 696e 6720 7461 6720  ed deleting tag 
-00015d20: 6672 6f6d 207b 7461 675f 6e61 6d65 7d22  from {tag_name}"
-00015d30: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-00015d40: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
-00015d50: 2020 2020 2244 454c 4554 4522 2c0a 2020      "DELETE",.  
-00015d60: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
-00015d70: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00015d80: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
-00015d90: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
-00015da0: 5f74 6f5f 6a73 6f6e 280a 2020 2020 2020  _to_json(.      
-00015db0: 2020 2020 2020 2020 2020 7461 675f 6f62            tag_ob
-00015dc0: 6a65 6374 732e 6469 6374 2829 0a20 2020  jects.dict().   
-00015dd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015de0: 6973 696e 7374 616e 6365 2874 6167 5f6f  isinstance(tag_o
-00015df0: 626a 6563 7473 2c20 6d6c 7275 6e2e 6170  bjects, mlrun.ap
-00015e00: 692e 7363 6865 6d61 732e 5461 674f 626a  i.schemas.TagObj
-00015e10: 6563 7473 290a 2020 2020 2020 2020 2020  ects).          
-00015e20: 2020 2020 2020 656c 7365 2074 6167 5f6f        else tag_o
-00015e30: 626a 6563 7473 0a20 2020 2020 2020 2020  bjects.         
-00015e40: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
-00015e50: 0a20 2020 2064 6566 2074 6167 5f61 7274  .    def tag_art
-00015e60: 6966 6163 7473 280a 2020 2020 2020 2020  ifacts(.        
-00015e70: 7365 6c66 2c0a 2020 2020 2020 2020 6172  self,.        ar
-00015e80: 7469 6661 6374 733a 2055 6e69 6f6e 5b4c  tifacts: Union[L
-00015e90: 6973 745b 4172 7469 6661 6374 5d2c 204c  ist[Artifact], L
-00015ea0: 6973 745b 6469 6374 5d2c 2041 7274 6966  ist[dict], Artif
-00015eb0: 6163 742c 2064 6963 745d 2c0a 2020 2020  act, dict],.    
-00015ec0: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
-00015ed0: 2c0a 2020 2020 2020 2020 7461 675f 6e61  ,.        tag_na
-00015ee0: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-00015ef0: 2072 6570 6c61 6365 3a20 626f 6f6c 203d   replace: bool =
-00015f00: 2046 616c 7365 2c0a 2020 2020 293a 0a20   False,.    ):. 
-00015f10: 2020 2020 2020 2022 2222 5461 6720 6120         """Tag a 
-00015f20: 6c69 7374 206f 6620 6172 7469 6661 6374  list of artifact
-00015f30: 732e 0a0a 2020 2020 2020 2020 3a70 6172  s...        :par
-00015f40: 616d 2061 7274 6966 6163 7473 3a20 5468  am artifacts: Th
-00015f50: 6520 6172 7469 6661 6374 7320 746f 2074  e artifacts to t
-00015f60: 6167 2e20 4361 6e20 6265 2061 206c 6973  ag. Can be a lis
-00015f70: 7420 6f66 203a 7079 3a63 6c61 7373 3a60  t of :py:class:`
-00015f80: 7e6d 6c72 756e 2e61 7274 6966 6163 7473  ~mlrun.artifacts
-00015f90: 2e41 7274 6966 6163 7460 206f 626a 6563  .Artifact` objec
-00015fa0: 7473 206f 720a 2020 2020 2020 2020 2020  ts or.          
-00015fb0: 2020 6469 6374 696f 6e61 7269 6573 2c20    dictionaries, 
-00015fc0: 6f72 2061 2073 696e 676c 6520 6f62 6a65  or a single obje
-00015fd0: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
-00015fe0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00015ff0: 6563 7420 7768 6963 6820 636f 6e74 6169  ect which contai
-00016000: 6e73 2074 6865 2061 7274 6966 6163 7473  ns the artifacts
-00016010: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00016020: 2074 6167 5f6e 616d 653a 2054 6865 2074   tag_name: The t
-00016030: 6167 2074 6f20 7365 7420 6f6e 2074 6865  ag to set on the
-00016040: 2061 7274 6966 6163 7473 2e0a 2020 2020   artifacts..    
-00016050: 2020 2020 3a70 6172 616d 2072 6570 6c61      :param repla
-00016060: 6365 3a20 4966 2054 7275 652c 2072 6570  ce: If True, rep
-00016070: 6c61 6365 2065 7869 7374 696e 6720 7461  lace existing ta
-00016080: 6773 2c20 6f74 6865 7277 6973 6520 6170  gs, otherwise ap
-00016090: 7065 6e64 2074 6f20 6578 6973 7469 6e67  pend to existing
-000160a0: 2074 6167 732e 0a20 2020 2020 2020 2022   tags..        "
-000160b0: 2222 0a20 2020 2020 2020 2074 6167 5f6f  "".        tag_o
-000160c0: 626a 6563 7473 203d 2073 656c 662e 5f72  bjects = self._r
-000160d0: 6573 6f6c 7665 5f61 7274 6966 6163 7473  esolve_artifacts
-000160e0: 5f74 6f5f 7461 675f 6f62 6a65 6374 7328  _to_tag_objects(
-000160f0: 6172 7469 6661 6374 7329 0a20 2020 2020  artifacts).     
-00016100: 2020 2073 656c 662e 7461 675f 6f62 6a65     self.tag_obje
-00016110: 6374 7328 7072 6f6a 6563 742c 2074 6167  cts(project, tag
-00016120: 5f6e 616d 652c 206f 626a 6563 7473 3d74  _name, objects=t
-00016130: 6167 5f6f 626a 6563 7473 2c20 7265 706c  ag_objects, repl
-00016140: 6163 653d 7265 706c 6163 6529 0a0a 2020  ace=replace)..  
-00016150: 2020 6465 6620 6465 6c65 7465 5f61 7274    def delete_art
-00016160: 6966 6163 7473 5f74 6167 7328 0a20 2020  ifacts_tags(.   
-00016170: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00016180: 2020 2061 7274 6966 6163 7473 2c0a 2020     artifacts,.  
-00016190: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
-000161a0: 7472 2c0a 2020 2020 2020 2020 7461 675f  tr,.        tag_
-000161b0: 6e61 6d65 3a20 7374 722c 0a20 2020 2029  name: str,.    )
-000161c0: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
-000161d0: 6574 6520 7461 6720 6672 6f6d 2061 206c  ete tag from a l
-000161e0: 6973 7420 6f66 2061 7274 6966 6163 7473  ist of artifacts
-000161f0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00016200: 6d20 6172 7469 6661 6374 733a 2054 6865  m artifacts: The
-00016210: 2061 7274 6966 6163 7473 2074 6f20 6465   artifacts to de
-00016220: 6c65 7465 2074 6865 2074 6167 2066 726f  lete the tag fro
-00016230: 6d2e 2043 616e 2062 6520 6120 6c69 7374  m. Can be a list
-00016240: 206f 6620 3a70 793a 636c 6173 733a 607e   of :py:class:`~
-00016250: 6d6c 7275 6e2e 6172 7469 6661 6374 732e  mlrun.artifacts.
-00016260: 4172 7469 6661 6374 600a 2020 2020 2020  Artifact`.      
-00016270: 2020 2020 2020 6f62 6a65 6374 7320 6f72        objects or
-00016280: 2064 6963 7469 6f6e 6172 6965 732c 206f   dictionaries, o
-00016290: 7220 6120 7369 6e67 6c65 206f 626a 6563  r a single objec
-000162a0: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
-000162b0: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
-000162c0: 6374 2077 6869 6368 2063 6f6e 7461 696e  ct which contain
-000162d0: 7320 7468 6520 6172 7469 6661 6374 732e  s the artifacts.
-000162e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000162f0: 7461 675f 6e61 6d65 3a20 5468 6520 7461  tag_name: The ta
-00016300: 6720 746f 2073 6574 206f 6e20 7468 6520  g to set on the 
-00016310: 6172 7469 6661 6374 732e 0a20 2020 2020  artifacts..     
-00016320: 2020 2022 2222 0a20 2020 2020 2020 2074     """.        t
-00016330: 6167 5f6f 626a 6563 7473 203d 2073 656c  ag_objects = sel
-00016340: 662e 5f72 6573 6f6c 7665 5f61 7274 6966  f._resolve_artif
-00016350: 6163 7473 5f74 6f5f 7461 675f 6f62 6a65  acts_to_tag_obje
-00016360: 6374 7328 6172 7469 6661 6374 7329 0a20  cts(artifacts). 
-00016370: 2020 2020 2020 2073 656c 662e 6465 6c65         self.dele
-00016380: 7465 5f6f 626a 6563 7473 5f74 6167 2870  te_objects_tag(p
-00016390: 726f 6a65 6374 2c20 7461 675f 6e61 6d65  roject, tag_name
-000163a0: 2c20 7461 675f 6f62 6a65 6374 7329 0a0a  , tag_objects)..
-000163b0: 2020 2020 6465 6620 6c69 7374 5f70 726f      def list_pro
-000163c0: 6a65 6374 7328 0a20 2020 2020 2020 2073  jects(.        s
-000163d0: 656c 662c 0a20 2020 2020 2020 206f 776e  elf,.        own
-000163e0: 6572 3a20 7374 7220 3d20 4e6f 6e65 2c0a  er: str = None,.
-000163f0: 2020 2020 2020 2020 666f 726d 6174 5f3a          format_:
-00016400: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
-00016410: 2020 2020 7374 722c 206d 6c72 756e 2e61      str, mlrun.a
-00016420: 7069 2e73 6368 656d 6173 2e50 726f 6a65  pi.schemas.Proje
-00016430: 6374 7346 6f72 6d61 740a 2020 2020 2020  ctsFormat.      
-00016440: 2020 5d20 3d20 6d6c 7275 6e2e 6170 692e    ] = mlrun.api.
-00016450: 7363 6865 6d61 732e 5072 6f6a 6563 7473  schemas.Projects
-00016460: 466f 726d 6174 2e66 756c 6c2c 0a20 2020  Format.full,.   
-00016470: 2020 2020 206c 6162 656c 733a 204c 6973       labels: Lis
-00016480: 745b 7374 725d 203d 204e 6f6e 652c 0a20  t[str] = None,. 
-00016490: 2020 2020 2020 2073 7461 7465 3a20 556e         state: Un
-000164a0: 696f 6e5b 7374 722c 206d 6c72 756e 2e61  ion[str, mlrun.a
-000164b0: 7069 2e73 6368 656d 6173 2e50 726f 6a65  pi.schemas.Proje
-000164c0: 6374 5374 6174 655d 203d 204e 6f6e 652c  ctState] = None,
-000164d0: 0a20 2020 2029 202d 3e20 4c69 7374 5b55  .    ) -> List[U
-000164e0: 6e69 6f6e 5b6d 6c72 756e 2e70 726f 6a65  nion[mlrun.proje
-000164f0: 6374 732e 4d6c 7275 6e50 726f 6a65 6374  cts.MlrunProject
-00016500: 2c20 7374 725d 5d3a 0a20 2020 2020 2020  , str]]:.       
-00016510: 2022 2222 5265 7475 726e 2061 206c 6973   """Return a lis
-00016520: 7420 6f66 2074 6865 2065 7869 7374 696e  t of the existin
-00016530: 6720 7072 6f6a 6563 7473 2c20 706f 7465  g projects, pote
-00016540: 6e74 6961 6c6c 7920 6669 6c74 6572 6564  ntially filtered
-00016550: 2062 7920 7370 6563 6966 6963 2063 7269   by specific cri
-00016560: 7465 7269 612e 0a0a 2020 2020 2020 2020  teria...        
-00016570: 3a70 6172 616d 206f 776e 6572 3a20 4c69  :param owner: Li
-00016580: 7374 206f 6e6c 7920 7072 6f6a 6563 7473  st only projects
-00016590: 2062 656c 6f6e 6769 6e67 2074 6f20 7468   belonging to th
-000165a0: 6973 2073 7065 6369 6669 6320 6f77 6e65  is specific owne
-000165b0: 722e 0a20 2020 2020 2020 203a 7061 7261  r..        :para
-000165c0: 6d20 666f 726d 6174 5f3a 2046 6f72 6d61  m format_: Forma
-000165d0: 7420 6f66 2074 6865 2072 6573 756c 7473  t of the results
-000165e0: 2e20 506f 7373 6962 6c65 2076 616c 7565  . Possible value
-000165f0: 7320 6172 653a 0a0a 2020 2020 2020 2020  s are:..        
-00016600: 2020 2020 2d20 6060 6675 6c6c 6060 2028      - ``full`` (
-00016610: 6465 6661 756c 7420 7661 6c75 6529 202d  default value) -
-00016620: 2052 6574 7572 6e20 6675 6c6c 2070 726f   Return full pro
-00016630: 6a65 6374 206f 626a 6563 7473 2e0a 2020  ject objects..  
-00016640: 2020 2020 2020 2020 2020 2d20 6060 6e61            - ``na
-00016650: 6d65 5f6f 6e6c 7960 6020 2d20 5265 7475  me_only`` - Retu
-00016660: 726e 206a 7573 7420 7468 6520 6e61 6d65  rn just the name
-00016670: 7320 6f66 2074 6865 2070 726f 6a65 6374  s of the project
-00016680: 732e 0a0a 2020 2020 2020 2020 3a70 6172  s...        :par
-00016690: 616d 206c 6162 656c 733a 2046 696c 7465  am labels: Filte
-000166a0: 7220 6279 206c 6162 656c 7320 6174 7461  r by labels atta
-000166b0: 6368 6564 2074 6f20 7468 6520 7072 6f6a  ched to the proj
-000166c0: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
-000166d0: 7261 6d20 7374 6174 653a 2046 696c 7465  ram state: Filte
-000166e0: 7220 6279 2070 726f 6a65 6374 2773 2073  r by project's s
-000166f0: 7461 7465 2e20 4361 6e20 6265 2065 6974  tate. Can be eit
-00016700: 6865 7220 6060 6f6e 6c69 6e65 6060 206f  her ``online`` o
-00016710: 7220 6060 6172 6368 6976 6564 6060 2e0a  r ``archived``..
-00016720: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00016730: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-00016740: 2020 2020 2020 2020 2020 2020 226f 776e              "own
-00016750: 6572 223a 206f 776e 6572 2c0a 2020 2020  er": owner,.    
-00016760: 2020 2020 2020 2020 2273 7461 7465 223a          "state":
-00016770: 2073 7461 7465 2c0a 2020 2020 2020 2020   state,.        
-00016780: 2020 2020 2266 6f72 6d61 7422 3a20 666f      "format": fo
-00016790: 726d 6174 5f2c 0a20 2020 2020 2020 2020  rmat_,.         
-000167a0: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
-000167b0: 6c73 206f 7220 5b5d 2c0a 2020 2020 2020  ls or [],.      
-000167c0: 2020 7d0a 0a20 2020 2020 2020 2065 7272    }..        err
-000167d0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-000167e0: 6169 6c65 6420 6c69 7374 696e 6720 7072  ailed listing pr
-000167f0: 6f6a 6563 7473 2c20 7175 6572 793a 207b  ojects, query: {
-00016800: 7061 7261 6d73 7d22 0a20 2020 2020 2020  params}".       
-00016810: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
-00016820: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
-00016830: 2022 7072 6f6a 6563 7473 222c 2065 7272   "projects", err
-00016840: 6f72 5f6d 6573 7361 6765 2c20 7061 7261  or_message, para
-00016850: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
-00016860: 2020 2069 6620 666f 726d 6174 5f20 3d3d     if format_ ==
-00016870: 206d 6c72 756e 2e61 7069 2e73 6368 656d   mlrun.api.schem
-00016880: 6173 2e50 726f 6a65 6374 7346 6f72 6d61  as.ProjectsForma
-00016890: 742e 6e61 6d65 5f6f 6e6c 793a 0a20 2020  t.name_only:.   
-000168a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000168b0: 7265 7370 6f6e 7365 2e6a 736f 6e28 295b  response.json()[
-000168c0: 2270 726f 6a65 6374 7322 5d0a 2020 2020  "projects"].    
-000168d0: 2020 2020 656c 6966 2066 6f72 6d61 745f      elif format_
-000168e0: 203d 3d20 6d6c 7275 6e2e 6170 692e 7363   == mlrun.api.sc
-000168f0: 6865 6d61 732e 5072 6f6a 6563 7473 466f  hemas.ProjectsFo
-00016900: 726d 6174 2e66 756c 6c3a 0a20 2020 2020  rmat.full:.     
-00016910: 2020 2020 2020 2072 6574 7572 6e20 5b0a         return [.
-00016920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016930: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
-00016940: 6c72 756e 5072 6f6a 6563 742e 6672 6f6d  lrunProject.from
-00016950: 5f64 6963 7428 7072 6f6a 6563 745f 6469  _dict(project_di
-00016960: 6374 290a 2020 2020 2020 2020 2020 2020  ct).            
-00016970: 2020 2020 666f 7220 7072 6f6a 6563 745f      for project_
-00016980: 6469 6374 2069 6e20 7265 7370 6f6e 7365  dict in response
-00016990: 2e6a 736f 6e28 295b 2270 726f 6a65 6374  .json()["project
-000169a0: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
-000169b0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-000169c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000169d0: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
-000169e0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-000169f0: 2020 2020 2020 2066 2250 726f 7669 6465         f"Provide
-00016a00: 6420 666f 726d 6174 2069 7320 6e6f 7420  d format is not 
-00016a10: 7375 7070 6f72 7465 642e 2066 6f72 6d61  supported. forma
-00016a20: 743d 7b66 6f72 6d61 745f 7d22 0a20 2020  t={format_}".   
-00016a30: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00016a40: 6465 6620 6765 745f 7072 6f6a 6563 7428  def get_project(
-00016a50: 7365 6c66 2c20 6e61 6d65 3a20 7374 7229  self, name: str)
-00016a60: 202d 3e20 6d6c 7275 6e2e 7072 6f6a 6563   -> mlrun.projec
-00016a70: 7473 2e4d 6c72 756e 5072 6f6a 6563 743a  ts.MlrunProject:
-00016a80: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00016a90: 6465 7461 696c 7320 666f 7220 6120 7370  details for a sp
-00016aa0: 6563 6966 6963 2070 726f 6a65 6374 2e22  ecific project."
-00016ab0: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
-00016ac0: 6f74 206e 616d 653a 0a20 2020 2020 2020  ot name:.       
-00016ad0: 2020 2020 2072 6169 7365 204d 4c52 756e       raise MLRun
-00016ae0: 496e 7661 6c69 6441 7267 756d 656e 7445  InvalidArgumentE
-00016af0: 7272 6f72 2822 4e61 6d65 206d 7573 7420  rror("Name must 
-00016b00: 6265 2070 726f 7669 6465 6422 290a 0a20  be provided").. 
-00016b10: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00016b20: 7072 6f6a 6563 7473 2f7b 6e61 6d65 7d22  projects/{name}"
-00016b30: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-00016b40: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
-00016b50: 6420 7265 7472 6965 7669 6e67 2070 726f  d retrieving pro
-00016b60: 6a65 6374 207b 6e61 6d65 7d22 0a20 2020  ject {name}".   
-00016b70: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-00016b80: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
-00016b90: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
-00016ba0: 5f6d 6573 7361 6765 290a 2020 2020 2020  _message).      
-00016bb0: 2020 7265 7475 726e 206d 6c72 756e 2e70    return mlrun.p
-00016bc0: 726f 6a65 6374 732e 4d6c 7275 6e50 726f  rojects.MlrunPro
-00016bd0: 6a65 6374 2e66 726f 6d5f 6469 6374 2872  ject.from_dict(r
-00016be0: 6573 706f 6e73 652e 6a73 6f6e 2829 290a  esponse.json()).
-00016bf0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
-00016c00: 7072 6f6a 6563 7428 0a20 2020 2020 2020  project(.       
-00016c10: 2073 656c 662c 0a20 2020 2020 2020 206e   self,.        n
-00016c20: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
-00016c30: 2020 6465 6c65 7469 6f6e 5f73 7472 6174    deletion_strat
-00016c40: 6567 793a 2055 6e69 6f6e 5b0a 2020 2020  egy: Union[.    
-00016c50: 2020 2020 2020 2020 7374 722c 206d 6c72          str, mlr
-00016c60: 756e 2e61 7069 2e73 6368 656d 6173 2e44  un.api.schemas.D
-00016c70: 656c 6574 696f 6e53 7472 6174 6567 790a  eletionStrategy.
-00016c80: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-00016c90: 6e2e 6170 692e 7363 6865 6d61 732e 4465  n.api.schemas.De
-00016ca0: 6c65 7469 6f6e 5374 7261 7465 6779 2e64  letionStrategy.d
-00016cb0: 6566 6175 6c74 2829 2c0a 2020 2020 293a  efault(),.    ):
-00016cc0: 0a20 2020 2020 2020 2022 2222 4465 6c65  .        """Dele
-00016cd0: 7465 2061 2070 726f 6a65 6374 2e0a 0a20  te a project... 
-00016ce0: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
-00016cf0: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
-00016d00: 7072 6f6a 6563 7420 746f 2064 656c 6574  project to delet
-00016d10: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-00016d20: 6d20 6465 6c65 7469 6f6e 5f73 7472 6174  m deletion_strat
-00016d30: 6567 793a 2048 6f77 2074 6f20 7472 6561  egy: How to trea
-00016d40: 7420 6368 696c 6420 6f62 6a65 6374 7320  t child objects 
-00016d50: 6f66 2074 6865 2070 726f 6a65 6374 2e20  of the project. 
-00016d60: 506f 7373 6962 6c65 2076 616c 7565 7320  Possible values 
-00016d70: 6172 653a 0a0a 2020 2020 2020 2020 2020  are:..          
-00016d80: 2020 2d20 6060 7265 7374 7269 6374 6060    - ``restrict``
-00016d90: 2028 6465 6661 756c 7429 202d 2050 726f   (default) - Pro
-00016da0: 6a65 6374 206d 7573 7420 6e6f 7420 6861  ject must not ha
-00016db0: 7665 2061 6e79 2063 6869 6c64 206f 626a  ve any child obj
-00016dc0: 6563 7473 2077 6865 6e20 6465 6c65 7465  ects when delete
-00016dd0: 642e 2049 6620 7573 696e 6720 7468 6973  d. If using this
-00016de0: 206d 6f64 6520 7768 696c 650a 2020 2020   mode while.    
-00016df0: 2020 2020 2020 2020 2020 6368 696c 6420            child 
-00016e00: 6f62 6a65 6374 7320 6578 6973 742c 2074  objects exist, t
-00016e10: 6865 206f 7065 7261 7469 6f6e 2077 696c  he operation wil
-00016e20: 6c20 6661 696c 2e0a 2020 2020 2020 2020  l fail..        
-00016e30: 2020 2020 2d20 6060 6361 7363 6164 6560      - ``cascade`
-00016e40: 6020 2d20 4175 746f 6d61 7469 6361 6c6c  ` - Automaticall
-00016e50: 7920 6465 6c65 7465 2061 6c6c 2063 6869  y delete all chi
-00016e60: 6c64 206f 626a 6563 7473 2077 6865 6e20  ld objects when 
-00016e70: 6465 6c65 7469 6e67 2074 6865 2070 726f  deleting the pro
-00016e80: 6a65 6374 2e0a 2020 2020 2020 2020 2222  ject..        ""
-00016e90: 220a 0a20 2020 2020 2020 2070 6174 6820  "..        path 
-00016ea0: 3d20 6622 7072 6f6a 6563 7473 2f7b 6e61  = f"projects/{na
-00016eb0: 6d65 7d22 0a20 2020 2020 2020 2068 6561  me}".        hea
-00016ec0: 6465 7273 203d 207b 7363 6865 6d61 732e  ders = {schemas.
-00016ed0: 4865 6164 6572 4e61 6d65 732e 6465 6c65  HeaderNames.dele
-00016ee0: 7469 6f6e 5f73 7472 6174 6567 793a 2064  tion_strategy: d
-00016ef0: 656c 6574 696f 6e5f 7374 7261 7465 6779  eletion_strategy
-00016f00: 7d0a 2020 2020 2020 2020 6572 726f 725f  }.        error_
-00016f10: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00016f20: 6564 2064 656c 6574 696e 6720 7072 6f6a  ed deleting proj
-00016f30: 6563 7420 7b6e 616d 657d 220a 2020 2020  ect {name}".    
-00016f40: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
-00016f50: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
-00016f60: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
-00016f70: 6f72 5f6d 6573 7361 6765 2c20 6865 6164  or_message, head
-00016f80: 6572 733d 6865 6164 6572 7329 0a20 2020  ers=headers).   
-00016f90: 2020 2020 2069 6620 7265 7370 6f6e 7365       if response
-00016fa0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
-00016fb0: 6874 7470 2e48 5454 5053 7461 7475 732e  http.HTTPStatus.
-00016fc0: 4143 4345 5054 4544 3a0a 2020 2020 2020  ACCEPTED:.      
-00016fd0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00016fe0: 662e 5f77 6169 745f 666f 725f 7072 6f6a  f._wait_for_proj
-00016ff0: 6563 745f 746f 5f62 655f 6465 6c65 7465  ect_to_be_delete
-00017000: 6428 6e61 6d65 290a 0a20 2020 2064 6566  d(name)..    def
-00017010: 2073 746f 7265 5f70 726f 6a65 6374 280a   store_project(.
-00017020: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00017030: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
-00017040: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-00017050: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
-00017060: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
-00017070: 756e 5072 6f6a 6563 742c 206d 6c72 756e  unProject, mlrun
-00017080: 2e61 7069 2e73 6368 656d 6173 2e50 726f  .api.schemas.Pro
-00017090: 6a65 6374 5d2c 0a20 2020 2029 202d 3e20  ject],.    ) -> 
-000170a0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
-000170b0: 6c72 756e 5072 6f6a 6563 743a 0a20 2020  lrunProject:.   
-000170c0: 2020 2020 2022 2222 5374 6f72 6520 6120       """Store a 
-000170d0: 7072 6f6a 6563 7420 696e 2074 6865 2044  project in the D
-000170e0: 422e 2054 6869 7320 6f70 6572 6174 696f  B. This operatio
-000170f0: 6e20 7769 6c6c 206f 7665 7277 7269 7465  n will overwrite
-00017100: 2065 7869 7374 696e 6720 7072 6f6a 6563   existing projec
-00017110: 7420 6f66 2074 6865 2073 616d 6520 6e61  t of the same na
-00017120: 6d65 2069 6620 6578 6973 7473 2e22 2222  me if exists."""
-00017130: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-00017140: 2066 2270 726f 6a65 6374 732f 7b6e 616d   f"projects/{nam
-00017150: 657d 220a 2020 2020 2020 2020 6572 726f  e}".        erro
-00017160: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-00017170: 696c 6564 2073 746f 7269 6e67 2070 726f  iled storing pro
-00017180: 6a65 6374 207b 6e61 6d65 7d22 0a20 2020  ject {name}".   
-00017190: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000171a0: 6365 2870 726f 6a65 6374 2c20 6d6c 7275  ce(project, mlru
-000171b0: 6e2e 6170 692e 7363 6865 6d61 732e 5072  n.api.schemas.Pr
-000171c0: 6f6a 6563 7429 3a0a 2020 2020 2020 2020  oject):.        
-000171d0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-000171e0: 6f6a 6563 742e 6469 6374 2829 0a20 2020  oject.dict().   
-000171f0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00017200: 616e 6365 2870 726f 6a65 6374 2c20 6d6c  ance(project, ml
-00017210: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
-00017220: 756e 5072 6f6a 6563 7429 3a0a 2020 2020  unProject):.    
-00017230: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
-00017240: 3d20 7072 6f6a 6563 742e 746f 5f64 6963  = project.to_dic
-00017250: 7428 290a 2020 2020 2020 2020 7265 7370  t().        resp
-00017260: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
-00017270: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-00017280: 2020 2250 5554 222c 0a20 2020 2020 2020    "PUT",.       
-00017290: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-000172a0: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-000172b0: 7361 6765 2c0a 2020 2020 2020 2020 2020  sage,.          
-000172c0: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
-000172d0: 736f 6e28 7072 6f6a 6563 7429 2c0a 2020  son(project),.  
-000172e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000172f0: 6966 2072 6573 706f 6e73 652e 7374 6174  if response.stat
-00017300: 7573 5f63 6f64 6520 3d3d 2068 7474 702e  us_code == http.
-00017310: 4854 5450 5374 6174 7573 2e41 4343 4550  HTTPStatus.ACCEP
-00017320: 5445 443a 0a20 2020 2020 2020 2020 2020  TED:.           
-00017330: 2072 6574 7572 6e20 7365 6c66 2e5f 7761   return self._wa
-00017340: 6974 5f66 6f72 5f70 726f 6a65 6374 5f74  it_for_project_t
-00017350: 6f5f 7265 6163 685f 7465 726d 696e 616c  o_reach_terminal
-00017360: 5f73 7461 7465 286e 616d 6529 0a20 2020  _state(name).   
-00017370: 2020 2020 2072 6574 7572 6e20 6d6c 7275       return mlru
-00017380: 6e2e 7072 6f6a 6563 7473 2e4d 6c72 756e  n.projects.Mlrun
-00017390: 5072 6f6a 6563 742e 6672 6f6d 5f64 6963  Project.from_dic
-000173a0: 7428 7265 7370 6f6e 7365 2e6a 736f 6e28  t(response.json(
-000173b0: 2929 0a0a 2020 2020 6465 6620 7061 7463  ))..    def patc
-000173c0: 685f 7072 6f6a 6563 7428 0a20 2020 2020  h_project(.     
-000173d0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000173e0: 206e 616d 653a 2073 7472 2c0a 2020 2020   name: str,.    
-000173f0: 2020 2020 7072 6f6a 6563 743a 2064 6963      project: dic
-00017400: 742c 0a20 2020 2020 2020 2070 6174 6368  t,.        patch
-00017410: 5f6d 6f64 653a 2055 6e69 6f6e 5b73 7472  _mode: Union[str
-00017420: 2c20 7363 6865 6d61 732e 5061 7463 684d  , schemas.PatchM
-00017430: 6f64 655d 203d 2073 6368 656d 6173 2e50  ode] = schemas.P
-00017440: 6174 6368 4d6f 6465 2e72 6570 6c61 6365  atchMode.replace
-00017450: 2c0a 2020 2020 2920 2d3e 206d 6c72 756e  ,.    ) -> mlrun
-00017460: 2e70 726f 6a65 6374 732e 4d6c 7275 6e50  .projects.MlrunP
-00017470: 726f 6a65 6374 3a0a 2020 2020 2020 2020  roject:.        
-00017480: 2222 2250 6174 6368 2061 6e20 6578 6973  """Patch an exis
-00017490: 7469 6e67 2070 726f 6a65 6374 206f 626a  ting project obj
-000174a0: 6563 742e 0a0a 2020 2020 2020 2020 3a70  ect...        :p
-000174b0: 6172 616d 206e 616d 653a 204e 616d 6520  aram name: Name 
-000174c0: 6f66 2070 726f 6a65 6374 2074 6f20 7061  of project to pa
-000174d0: 7463 682e 0a20 2020 2020 2020 203a 7061  tch..        :pa
-000174e0: 7261 6d20 7072 6f6a 6563 743a 2054 6865  ram project: The
-000174f0: 2061 6374 7561 6c20 6368 616e 6765 7320   actual changes 
-00017500: 746f 2074 6865 2070 726f 6a65 6374 206f  to the project o
-00017510: 626a 6563 742e 0a20 2020 2020 2020 203a  bject..        :
-00017520: 7061 7261 6d20 7061 7463 685f 6d6f 6465  param patch_mode
-00017530: 3a20 5468 6520 7374 7261 7465 6779 2066  : The strategy f
-00017540: 6f72 206d 6572 6769 6e67 2074 6865 2063  or merging the c
-00017550: 6861 6e67 6573 2077 6974 6820 7468 6520  hanges with the 
-00017560: 6578 6973 7469 6e67 206f 626a 6563 742e  existing object.
-00017570: 2043 616e 2062 6520 6569 7468 6572 2060   Can be either `
-00017580: 6072 6570 6c61 6365 6060 0a20 2020 2020  `replace``.     
-00017590: 2020 2020 2020 206f 7220 6060 6164 6469         or ``addi
-000175a0: 7469 7665 6060 2e0a 2020 2020 2020 2020  tive``..        
-000175b0: 2222 220a 0a20 2020 2020 2020 2070 6174  """..        pat
-000175c0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-000175d0: 6e61 6d65 7d22 0a20 2020 2020 2020 2068  name}".        h
-000175e0: 6561 6465 7273 203d 207b 7363 6865 6d61  eaders = {schema
-000175f0: 732e 4865 6164 6572 4e61 6d65 732e 7061  s.HeaderNames.pa
-00017600: 7463 685f 6d6f 6465 3a20 7061 7463 685f  tch_mode: patch_
-00017610: 6d6f 6465 7d0a 2020 2020 2020 2020 6572  mode}.        er
+0000d990: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+0000d9a0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e42  common.schemas.B
+0000d9b0: 6163 6b67 726f 756e 6454 6173 6b28 2a2a  ackgroundTask(**
+0000d9c0: 7265 7370 6f6e 7365 2e6a 736f 6e28 2929  response.json())
+0000d9d0: 0a0a 2020 2020 6465 6620 6765 745f 6261  ..    def get_ba
+0000d9e0: 636b 6772 6f75 6e64 5f74 6173 6b28 7365  ckground_task(se
+0000d9f0: 6c66 2c20 6e61 6d65 3a20 7374 7229 202d  lf, name: str) -
+0000da00: 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  > mlrun.common.s
+0000da10: 6368 656d 6173 2e42 6163 6b67 726f 756e  chemas.Backgroun
+0000da20: 6454 6173 6b3a 0a20 2020 2020 2020 2022  dTask:.        "
+0000da30: 2222 5265 7472 6965 7665 2075 7064 6174  ""Retrieve updat
+0000da40: 6564 2069 6e66 6f72 6d61 7469 6f6e 206f  ed information o
+0000da50: 6e20 6120 6261 636b 6772 6f75 6e64 2074  n a background t
+0000da60: 6173 6b20 6265 696e 6720 6578 6563 7574  ask being execut
+0000da70: 6564 2e22 2222 0a0a 2020 2020 2020 2020  ed."""..        
+0000da80: 7061 7468 203d 2066 2262 6163 6b67 726f  path = f"backgro
+0000da90: 756e 642d 7461 736b 732f 7b6e 616d 657d  und-tasks/{name}
+0000daa0: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
+0000dab0: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+0000dac0: 6564 2067 6574 7469 6e67 2062 6163 6b67  ed getting backg
+0000dad0: 726f 756e 6420 7461 736b 2e20 6e61 6d65  round task. name
+0000dae0: 3d7b 6e61 6d65 7d22 0a20 2020 2020 2020  ={name}".       
+0000daf0: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
+0000db00: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
+0000db10: 2070 6174 682c 2065 7272 6f72 5f6d 6573   path, error_mes
+0000db20: 7361 6765 290a 2020 2020 2020 2020 7265  sage).        re
+0000db30: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
+0000db40: 6e2e 7363 6865 6d61 732e 4261 636b 6772  n.schemas.Backgr
+0000db50: 6f75 6e64 5461 736b 282a 2a72 6573 706f  oundTask(**respo
+0000db60: 6e73 652e 6a73 6f6e 2829 290a 0a20 2020  nse.json())..   
+0000db70: 2064 6566 2072 656d 6f74 655f 7374 6174   def remote_stat
+0000db80: 7573 2873 656c 662c 2070 726f 6a65 6374  us(self, project
+0000db90: 2c20 6e61 6d65 2c20 6b69 6e64 2c20 7365  , name, kind, se
+0000dba0: 6c65 6374 6f72 293a 0a20 2020 2020 2020  lector):.       
+0000dbb0: 2022 2222 5265 7472 6965 7665 2073 7461   """Retrieve sta
+0000dbc0: 7475 7320 6f66 2061 2066 756e 6374 696f  tus of a functio
+0000dbd0: 6e20 6265 696e 6720 6578 6563 7574 6564  n being executed
+0000dbe0: 2072 656d 6f74 656c 7920 2872 656c 6576   remotely (relev
+0000dbf0: 616e 7420 746f 2060 6064 6173 6b60 6020  ant to ``dask`` 
+0000dc00: 6675 6e63 7469 6f6e 7329 2e0a 0a20 2020  functions)...   
+0000dc10: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+0000dc20: 6563 743a 2054 6865 2070 726f 6a65 6374  ect: The project
+0000dc30: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+0000dc40: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000dc50: 6e61 6d65 3a20 5468 6520 6e61 6d65 206f  name: The name o
+0000dc60: 6620 7468 6520 6675 6e63 7469 6f6e 0a20  f the function. 
+0000dc70: 2020 2020 2020 203a 7061 7261 6d20 6b69         :param ki
+0000dc80: 6e64 3a20 5468 6520 6b69 6e64 206f 6620  nd: The kind of 
+0000dc90: 7468 6520 6675 6e63 7469 6f6e 2c20 6375  the function, cu
+0000dca0: 7272 656e 746c 7920 6060 6461 736b 6060  rrently ``dask``
+0000dcb0: 2069 7320 7375 7070 6f72 7465 642e 0a20   is supported.. 
+0000dcc0: 2020 2020 2020 203a 7061 7261 6d20 7365         :param se
+0000dcd0: 6c65 6374 6f72 3a20 5365 6c65 6374 6f72  lector: Selector
+0000dce0: 2063 6c61 7573 6520 746f 2062 6520 6170   clause to be ap
+0000dcf0: 706c 6965 6420 746f 2074 6865 204b 7562  plied to the Kub
+0000dd00: 6572 6e65 7465 7320 7374 6174 7573 2071  ernetes status q
+0000dd10: 7565 7279 2074 6f20 6669 6c74 6572 2074  uery to filter t
+0000dd20: 6865 2072 6573 756c 7473 2e0a 2020 2020  he results..    
+0000dd30: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0000dd40: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000dd50: 2020 7265 7120 3d20 7b22 6b69 6e64 223a    req = {"kind":
+0000dd60: 206b 696e 642c 2022 7365 6c65 6374 6f72   kind, "selector
+0000dd70: 223a 2073 656c 6563 746f 722c 2022 7072  ": selector, "pr
+0000dd80: 6f6a 6563 7422 3a20 7072 6f6a 6563 742c  oject": project,
+0000dd90: 2022 6e61 6d65 223a 206e 616d 657d 0a20   "name": name}. 
+0000dda0: 2020 2020 2020 2020 2020 2072 6573 7020             resp 
+0000ddb0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+0000ddc0: 2250 4f53 5422 2c20 2273 7461 7475 732f  "POST", "status/
+0000ddd0: 6675 6e63 7469 6f6e 222c 206a 736f 6e3d  function", json=
+0000dde0: 7265 7129 0a20 2020 2020 2020 2065 7863  req).        exc
+0000ddf0: 6570 7420 4f53 4572 726f 7220 6173 2065  ept OSError as e
+0000de00: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
+0000de10: 6c6f 6767 6572 2e65 7272 6f72 2866 2265  logger.error(f"e
+0000de20: 7272 6f72 2073 7461 7274 696e 6720 6675  rror starting fu
+0000de30: 6e63 7469 6f6e 3a20 7b65 7272 5f74 6f5f  nction: {err_to_
+0000de40: 7374 7228 6572 7229 7d22 290a 2020 2020  str(err)}").    
+0000de50: 2020 2020 2020 2020 7261 6973 6520 4f53          raise OS
+0000de60: 4572 726f 7228 6622 6572 726f 723a 2063  Error(f"error: c
+0000de70: 616e 6e6f 7420 7374 6172 7420 6675 6e63  annot start func
+0000de80: 7469 6f6e 2c20 7b65 7272 5f74 6f5f 7374  tion, {err_to_st
+0000de90: 7228 6572 7229 7d22 290a 0a20 2020 2020  r(err)}")..     
+0000dea0: 2020 2069 6620 6e6f 7420 7265 7370 2e6f     if not resp.o
+0000deb0: 6b3a 0a20 2020 2020 2020 2020 2020 206c  k:.            l
+0000dec0: 6f67 6765 722e 6572 726f 7228 6622 6261  ogger.error(f"ba
+0000ded0: 6420 7265 7370 2121 5c6e 7b72 6573 702e  d resp!!\n{resp.
+0000dee0: 7465 7874 7d22 290a 2020 2020 2020 2020  text}").        
+0000def0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000df00: 7272 6f72 2822 6261 6420 6675 6e63 7469  rror("bad functi
+0000df10: 6f6e 2073 7461 7475 7320 7265 7370 6f6e  on status respon
+0000df20: 7365 2229 0a0a 2020 2020 2020 2020 7265  se")..        re
+0000df30: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
+0000df40: 5b22 6461 7461 225d 0a0a 2020 2020 6465  ["data"]..    de
+0000df50: 6620 7375 626d 6974 5f6a 6f62 280a 2020  f submit_job(.  
+0000df60: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000df70: 2020 2020 7275 6e73 7065 632c 0a20 2020      runspec,.   
+0000df80: 2020 2020 2073 6368 6564 756c 653a 2055       schedule: U
+0000df90: 6e69 6f6e 5b73 7472 2c20 6d6c 7275 6e2e  nion[str, mlrun.
+0000dfa0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+0000dfb0: 6368 6564 756c 6543 726f 6e54 7269 6767  cheduleCronTrigg
+0000dfc0: 6572 5d20 3d20 4e6f 6e65 2c0a 2020 2020  er] = None,.    
+0000dfd0: 293a 0a20 2020 2020 2020 2022 2222 5375  ):.        """Su
+0000dfe0: 626d 6974 2061 206a 6f62 2066 6f72 2072  bmit a job for r
+0000dff0: 656d 6f74 6520 6578 6563 7574 696f 6e2e  emote execution.
+0000e000: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000e010: 2072 756e 7370 6563 3a20 5468 6520 7275   runspec: The ru
+0000e020: 6e74 696d 6520 6f62 6a65 6374 2073 7065  ntime object spe
+0000e030: 6320 2854 6173 6b29 2074 6f20 6578 6563  c (Task) to exec
+0000e040: 7574 652e 0a20 2020 2020 2020 203a 7061  ute..        :pa
+0000e050: 7261 6d20 7363 6865 6475 6c65 3a20 5768  ram schedule: Wh
+0000e060: 6574 6865 7220 746f 2073 6368 6564 756c  ether to schedul
+0000e070: 6520 7468 6973 206a 6f62 2075 7369 6e67  e this job using
+0000e080: 2061 2043 726f 6e20 7472 6967 6765 722e   a Cron trigger.
+0000e090: 2049 6620 6e6f 7420 7370 6563 6966 6965   If not specifie
+0000e0a0: 642c 2074 6865 206a 6f62 2077 696c 6c20  d, the job will 
+0000e0b0: 6265 2073 7562 6d69 7474 6564 0a20 2020  be submitted.   
+0000e0c0: 2020 2020 2020 2020 2069 6d6d 6564 6961           immedia
+0000e0d0: 7465 6c79 2e0a 2020 2020 2020 2020 2222  tely..        ""
+0000e0e0: 220a 0a20 2020 2020 2020 2074 7279 3a0a  "..        try:.
+0000e0f0: 2020 2020 2020 2020 2020 2020 7265 7120              req 
+0000e100: 3d20 7b22 7461 736b 223a 2072 756e 7370  = {"task": runsp
+0000e110: 6563 2e74 6f5f 6469 6374 2829 7d0a 2020  ec.to_dict()}.  
+0000e120: 2020 2020 2020 2020 2020 6966 2073 6368            if sch
+0000e130: 6564 756c 653a 0a20 2020 2020 2020 2020  edule:.         
+0000e140: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000e150: 616e 6365 2873 6368 6564 756c 652c 206d  ance(schedule, m
+0000e160: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0000e170: 6d61 732e 5363 6865 6475 6c65 4372 6f6e  mas.ScheduleCron
+0000e180: 5472 6967 6765 7229 3a0a 2020 2020 2020  Trigger):.      
+0000e190: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0000e1a0: 6865 6475 6c65 203d 2073 6368 6564 756c  hedule = schedul
+0000e1b0: 652e 6469 6374 2829 0a20 2020 2020 2020  e.dict().       
+0000e1c0: 2020 2020 2020 2020 2072 6571 5b22 7363           req["sc
+0000e1d0: 6865 6475 6c65 225d 203d 2073 6368 6564  hedule"] = sched
+0000e1e0: 756c 650a 2020 2020 2020 2020 2020 2020  ule.            
+0000e1f0: 7469 6d65 6f75 7420 3d20 2869 6e74 2863  timeout = (int(c
+0000e200: 6f6e 6669 672e 7375 626d 6974 5f74 696d  onfig.submit_tim
+0000e210: 656f 7574 2920 6f72 2031 3230 2920 2b20  eout) or 120) + 
+0000e220: 3230 0a20 2020 2020 2020 2020 2020 2072  20.            r
+0000e230: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
+0000e240: 616c 6c28 2250 4f53 5422 2c20 2273 7562  all("POST", "sub
+0000e250: 6d69 745f 6a6f 6222 2c20 6a73 6f6e 3d72  mit_job", json=r
+0000e260: 6571 2c20 7469 6d65 6f75 743d 7469 6d65  eq, timeout=time
+0000e270: 6f75 7429 0a0a 2020 2020 2020 2020 6578  out)..        ex
+0000e280: 6365 7074 2072 6571 7565 7374 732e 4854  cept requests.HT
+0000e290: 5450 4572 726f 7220 6173 2065 7272 3a0a  TPError as err:.
+0000e2a0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000e2b0: 6572 2e65 7272 6f72 2866 2265 7272 6f72  er.error(f"error
+0000e2c0: 2073 7562 6d69 7474 696e 6720 7461 736b   submitting task
+0000e2d0: 3a20 7b65 7272 5f74 6f5f 7374 7228 6572  : {err_to_str(er
+0000e2e0: 7229 7d22 290a 2020 2020 2020 2020 2020  r)}").          
+0000e2f0: 2020 2320 6e6f 7420 6372 6561 7469 6e67    # not creating
+0000e300: 2061 206e 6577 2065 7863 6570 7469 6f6e   a new exception
+0000e310: 2068 6572 652c 2069 6e20 6f72 6465 7220   here, in order 
+0000e320: 746f 206b 6565 7020 7468 6520 7265 7370  to keep the resp
+0000e330: 6f6e 7365 2061 6e64 2073 7461 7475 7320  onse and status 
+0000e340: 636f 6465 2069 6e20 7468 6520 6578 6365  code in the exce
+0000e350: 7074 696f 6e0a 2020 2020 2020 2020 2020  ption.          
+0000e360: 2020 7261 6973 650a 0a20 2020 2020 2020    raise..       
+0000e370: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
+0000e380: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
+0000e390: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
+0000e3a0: 2866 2265 7272 6f72 2073 7562 6d69 7474  (f"error submitt
+0000e3b0: 696e 6720 7461 736b 3a20 7b65 7272 5f74  ing task: {err_t
+0000e3c0: 6f5f 7374 7228 6572 7229 7d22 290a 2020  o_str(err)}").  
+0000e3d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000e3e0: 4f53 4572 726f 7228 2265 7272 6f72 3a20  OSError("error: 
+0000e3f0: 6361 6e6e 6f74 2073 7562 6d69 7420 7461  cannot submit ta
+0000e400: 736b 2229 2066 726f 6d20 6572 720a 0a20  sk") from err.. 
+0000e410: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
+0000e420: 7370 2e6f 6b3a 0a20 2020 2020 2020 2020  sp.ok:.         
+0000e430: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
+0000e440: 6622 6261 6420 7265 7370 2121 5c6e 7b72  f"bad resp!!\n{r
+0000e450: 6573 702e 7465 7874 7d22 290a 2020 2020  esp.text}").    
+0000e460: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000e470: 6c75 6545 7272 6f72 2866 2262 6164 2066  lueError(f"bad f
+0000e480: 756e 6374 696f 6e20 7275 6e20 7265 7370  unction run resp
+0000e490: 6f6e 7365 2c20 7b72 6573 702e 7465 7874  onse, {resp.text
+0000e4a0: 7d22 290a 0a20 2020 2020 2020 2072 6573  }")..        res
+0000e4b0: 7020 3d20 7265 7370 2e6a 736f 6e28 290a  p = resp.json().
+0000e4c0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000e4d0: 6573 705b 2264 6174 6122 5d0a 0a20 2020  esp["data"]..   
+0000e4e0: 2064 6566 2073 7562 6d69 745f 7069 7065   def submit_pipe
+0000e4f0: 6c69 6e65 280a 2020 2020 2020 2020 7365  line(.        se
+0000e500: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
+0000e510: 6563 742c 0a20 2020 2020 2020 2070 6970  ect,.        pip
+0000e520: 656c 696e 652c 0a20 2020 2020 2020 2061  eline,.        a
+0000e530: 7267 756d 656e 7473 3d4e 6f6e 652c 0a20  rguments=None,. 
+0000e540: 2020 2020 2020 2065 7870 6572 696d 656e         experimen
+0000e550: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
+0000e560: 7275 6e3d 4e6f 6e65 2c0a 2020 2020 2020  run=None,.      
+0000e570: 2020 6e61 6d65 7370 6163 653d 4e6f 6e65    namespace=None
+0000e580: 2c0a 2020 2020 2020 2020 6172 7469 6661  ,.        artifa
+0000e590: 6374 5f70 6174 683d 4e6f 6e65 2c0a 2020  ct_path=None,.  
+0000e5a0: 2020 2020 2020 6f70 733d 4e6f 6e65 2c0a        ops=None,.
+0000e5b0: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
+0000e5c0: 6465 7072 6563 6174 6564 2c20 7265 6d6f  deprecated, remo
+0000e5d0: 7665 2069 6e20 312e 352e 300a 2020 2020  ve in 1.5.0.    
+0000e5e0: 2020 2020 7474 6c3d 4e6f 6e65 2c0a 2020      ttl=None,.  
+0000e5f0: 2020 2020 2020 636c 6561 6e75 705f 7474        cleanup_tt
+0000e600: 6c3d 4e6f 6e65 2c0a 2020 2020 293a 0a20  l=None,.    ):. 
+0000e610: 2020 2020 2020 2022 2222 5375 626d 6974         """Submit
+0000e620: 2061 204b 4650 2070 6970 656c 696e 6520   a KFP pipeline 
+0000e630: 666f 7220 6578 6563 7574 696f 6e2e 0a0a  for execution...
+0000e640: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+0000e650: 726f 6a65 6374 3a20 5468 6520 7072 6f6a  roject: The proj
+0000e660: 6563 7420 6f66 2074 6865 2070 6970 656c  ect of the pipel
+0000e670: 696e 650a 2020 2020 2020 2020 3a70 6172  ine.        :par
+0000e680: 616d 2070 6970 656c 696e 653a 2050 6970  am pipeline: Pip
+0000e690: 656c 696e 6520 6675 6e63 7469 6f6e 206f  eline function o
+0000e6a0: 7220 7061 7468 2074 6f20 2e79 616d 6c2f  r path to .yaml/
+0000e6b0: 2e7a 6970 2070 6970 656c 696e 6520 6669  .zip pipeline fi
+0000e6c0: 6c65 2e0a 2020 2020 2020 2020 3a70 6172  le..        :par
+0000e6d0: 616d 2061 7267 756d 656e 7473 3a20 4120  am arguments: A 
+0000e6e0: 6469 6374 696f 6e61 7279 206f 6620 6172  dictionary of ar
+0000e6f0: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
+0000e700: 746f 2074 6865 2070 6970 656c 696e 652e  to the pipeline.
+0000e710: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000e720: 6578 7065 7269 6d65 6e74 3a20 4120 6e61  experiment: A na
+0000e730: 6d65 2074 6f20 6173 7369 676e 2066 6f72  me to assign for
+0000e740: 2074 6865 2073 7065 6369 6669 6320 6578   the specific ex
+0000e750: 7065 7269 6d65 6e74 2e0a 2020 2020 2020  periment..      
+0000e760: 2020 3a70 6172 616d 2072 756e 3a20 4120    :param run: A 
+0000e770: 6e61 6d65 2066 6f72 2074 6869 7320 7370  name for this sp
+0000e780: 6563 6966 6963 2072 756e 2e0a 2020 2020  ecific run..    
+0000e790: 2020 2020 3a70 6172 616d 206e 616d 6573      :param names
+0000e7a0: 7061 6365 3a20 4b75 6265 726e 6574 6573  pace: Kubernetes
+0000e7b0: 206e 616d 6573 7061 6365 2074 6f20 6578   namespace to ex
+0000e7c0: 6563 7574 6520 7468 6520 7069 7065 6c69  ecute the pipeli
+0000e7d0: 6e65 2069 6e2e 0a20 2020 2020 2020 203a  ne in..        :
+0000e7e0: 7061 7261 6d20 6172 7469 6661 6374 5f70  param artifact_p
+0000e7f0: 6174 683a 2041 2070 6174 6820 746f 2061  ath: A path to a
+0000e800: 7274 6966 6163 7473 2075 7365 6420 6279  rtifacts used by
+0000e810: 2074 6869 7320 7069 7065 6c69 6e65 2e0a   this pipeline..
+0000e820: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+0000e830: 7073 3a20 5472 616e 7366 6f72 6d65 7273  ps: Transformers
+0000e840: 2074 6f20 6170 706c 7920 6f6e 2061 6c6c   to apply on all
+0000e850: 206f 7073 2069 6e20 7468 6520 7069 7065   ops in the pipe
+0000e860: 6c69 6e65 2e0a 2020 2020 2020 2020 3a70  line..        :p
+0000e870: 6172 616d 2074 746c 3a20 7069 7065 6c69  aram ttl: pipeli
+0000e880: 6e65 2063 6c65 616e 7570 2074 746c 2069  ne cleanup ttl i
+0000e890: 6e20 7365 6373 2028 7469 6d65 2074 6f20  n secs (time to 
+0000e8a0: 7761 6974 2061 6674 6572 2077 6f72 6b66  wait after workf
+0000e8b0: 6c6f 7720 636f 6d70 6c65 7469 6f6e 2c20  low completion, 
+0000e8c0: 6174 2077 6869 6368 2070 6f69 6e74 2074  at which point t
+0000e8d0: 6865 2077 6f72 6b66 6c6f 770a 2020 2020  he workflow.    
+0000e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8f0: 616e 6420 616c 6c20 6974 7320 7265 736f  and all its reso
+0000e900: 7572 6365 7320 6172 6520 6465 6c65 7465  urces are delete
+0000e910: 6429 2028 6465 7072 6563 6174 6564 2c20  d) (deprecated, 
+0000e920: 7573 6520 636c 6561 6e75 705f 7474 6c20  use cleanup_ttl 
+0000e930: 696e 7374 6561 6429 0a20 2020 2020 2020  instead).       
+0000e940: 203a 7061 7261 6d20 636c 6561 6e75 705f   :param cleanup_
+0000e950: 7474 6c3a 2070 6970 656c 696e 6520 636c  ttl: pipeline cl
+0000e960: 6561 6e75 7020 7474 6c20 696e 2073 6563  eanup ttl in sec
+0000e970: 7320 2874 696d 6520 746f 2077 6169 7420  s (time to wait 
+0000e980: 6166 7465 7220 776f 726b 666c 6f77 2063  after workflow c
+0000e990: 6f6d 706c 6574 696f 6e2c 2061 7420 7768  ompletion, at wh
+0000e9a0: 6963 6820 706f 696e 7420 7468 650a 2020  ich point the.  
+0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9c0: 2020 2020 2020 2020 2020 776f 726b 666c            workfl
+0000e9d0: 6f77 2061 6e64 2061 6c6c 2069 7473 2072  ow and all its r
+0000e9e0: 6573 6f75 7263 6573 2061 7265 2064 656c  esources are del
+0000e9f0: 6574 6564 290a 2020 2020 2020 2020 2222  eted).        ""
+0000ea00: 220a 0a20 2020 2020 2020 2069 6620 7474  "..        if tt
+0000ea10: 6c3a 0a20 2020 2020 2020 2020 2020 2077  l:.            w
+0000ea20: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2227                "'
+0000ea40: 7474 6c27 2069 7320 6465 7072 6563 6174  ttl' is deprecat
+0000ea50: 6564 2c20 7573 6520 2763 6c65 616e 7570  ed, use 'cleanup
+0000ea60: 5f74 746c 2720 696e 7374 6561 642e 2022  _ttl' instead. "
+0000ea70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ea80: 2022 5468 6973 2077 696c 6c20 6265 2072   "This will be r
+0000ea90: 656d 6f76 6564 2069 6e20 312e 352e 3022  emoved in 1.5.0"
+0000eaa0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000eab0: 2020 2320 544f 444f 3a20 5265 6d6f 7665    # TODO: Remove
+0000eac0: 2074 6869 7320 696e 2031 2e35 2e30 0a20   this in 1.5.0. 
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+0000eae0: 7574 7572 6557 6172 6e69 6e67 2c0a 2020  utureWarning,.  
+0000eaf0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000eb00: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000eb10: 6365 2870 6970 656c 696e 652c 2073 7472  ce(pipeline, str
+0000eb20: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+0000eb30: 6970 655f 6669 6c65 203d 2070 6970 656c  ipe_file = pipel
+0000eb40: 696e 650a 2020 2020 2020 2020 656c 7365  ine.        else
+0000eb50: 3a0a 2020 2020 2020 2020 2020 2020 7069  :.            pi
+0000eb60: 7065 5f66 696c 6520 3d20 7465 6d70 6669  pe_file = tempfi
+0000eb70: 6c65 2e4e 616d 6564 5465 6d70 6f72 6172  le.NamedTemporar
+0000eb80: 7946 696c 6528 7375 6666 6978 3d22 2e79  yFile(suffix=".y
+0000eb90: 616d 6c22 2c20 6465 6c65 7465 3d46 616c  aml", delete=Fal
+0000eba0: 7365 292e 6e61 6d65 0a20 2020 2020 2020  se).name.       
+0000ebb0: 2020 2020 2063 6f6e 6620 3d20 6e65 775f       conf = new_
+0000ebc0: 7069 7065 5f6d 6574 6164 6174 6128 0a20  pipe_metadata(. 
+0000ebd0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000ebe0: 7274 6966 6163 745f 7061 7468 3d61 7274  rtifact_path=art
+0000ebf0: 6966 6163 745f 7061 7468 2c0a 2020 2020  ifact_path,.    
+0000ec00: 2020 2020 2020 2020 2020 2020 636c 6561              clea
+0000ec10: 6e75 705f 7474 6c3d 636c 6561 6e75 705f  nup_ttl=cleanup_
+0000ec20: 7474 6c20 6f72 2074 746c 2c0a 2020 2020  ttl or ttl,.    
+0000ec30: 2020 2020 2020 2020 2020 2020 6f70 5f74              op_t
+0000ec40: 7261 6e73 666f 726d 6572 733d 6f70 732c  ransformers=ops,
+0000ec50: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000ec60: 2020 2020 2020 2020 2020 206b 6670 2e63             kfp.c
+0000ec70: 6f6d 7069 6c65 722e 436f 6d70 696c 6572  ompiler.Compiler
+0000ec80: 2829 2e63 6f6d 7069 6c65 280a 2020 2020  ().compile(.    
+0000ec90: 2020 2020 2020 2020 2020 2020 7069 7065              pipe
+0000eca0: 6c69 6e65 2c20 7069 7065 5f66 696c 652c  line, pipe_file,
+0000ecb0: 2074 7970 655f 6368 6563 6b3d 4661 6c73   type_check=Fals
+0000ecc0: 652c 2070 6970 656c 696e 655f 636f 6e66  e, pipeline_conf
+0000ecd0: 3d63 6f6e 660a 2020 2020 2020 2020 2020  =conf.          
+0000ece0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0000ecf0: 7069 7065 5f66 696c 652e 656e 6473 7769  pipe_file.endswi
+0000ed00: 7468 2822 2e79 616d 6c22 293a 0a20 2020  th(".yaml"):.   
+0000ed10: 2020 2020 2020 2020 2068 6561 6465 7273           headers
+0000ed20: 203d 207b 2263 6f6e 7465 6e74 2d74 7970   = {"content-typ
+0000ed30: 6522 3a20 2261 7070 6c69 6361 7469 6f6e  e": "application
+0000ed40: 2f79 616d 6c22 7d0a 2020 2020 2020 2020  /yaml"}.        
+0000ed50: 656c 6966 2070 6970 655f 6669 6c65 2e65  elif pipe_file.e
+0000ed60: 6e64 7377 6974 6828 222e 7a69 7022 293a  ndswith(".zip"):
+0000ed70: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+0000ed80: 6465 7273 203d 207b 2263 6f6e 7465 6e74  ders = {"content
+0000ed90: 2d74 7970 6522 3a20 2261 7070 6c69 6361  -type": "applica
+0000eda0: 7469 6f6e 2f7a 6970 227d 0a20 2020 2020  tion/zip"}.     
+0000edb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000edc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000edd0: 4572 726f 7228 2270 6970 656c 696e 6520  Error("pipeline 
+0000ede0: 6669 6c65 206d 7573 7420 6265 202e 7961  file must be .ya
+0000edf0: 6d6c 206f 7220 2e7a 6970 2229 0a20 2020  ml or .zip").   
+0000ee00: 2020 2020 2069 6620 6172 6775 6d65 6e74       if argument
+0000ee10: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0000ee20: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0000ee30: 2861 7267 756d 656e 7473 2c20 6469 6374  (arguments, dict
+0000ee40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000ee50: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000ee60: 726f 7228 2261 7267 756d 656e 7473 206d  ror("arguments m
+0000ee70: 7573 7420 6265 2064 6963 7420 7479 7065  ust be dict type
+0000ee80: 2229 0a20 2020 2020 2020 2020 2020 2068  ").            h
+0000ee90: 6561 6465 7273 5b6d 6c72 756e 2e63 6f6d  eaders[mlrun.com
+0000eea0: 6d6f 6e2e 7363 6865 6d61 732e 4865 6164  mon.schemas.Head
+0000eeb0: 6572 4e61 6d65 732e 7069 7065 6c69 6e65  erNames.pipeline
+0000eec0: 5f61 7267 756d 656e 7473 5d20 3d20 7374  _arguments] = st
+0000eed0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000eee0: 2020 2061 7267 756d 656e 7473 0a20 2020     arguments.   
+0000eef0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000ef00: 2020 2020 6966 206e 6f74 2070 6174 682e      if not path.
+0000ef10: 6973 6669 6c65 2870 6970 655f 6669 6c65  isfile(pipe_file
+0000ef20: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000ef30: 6169 7365 204f 5345 7272 6f72 2866 2266  aise OSError(f"f
+0000ef40: 696c 6520 7b70 6970 655f 6669 6c65 7d20  ile {pipe_file} 
+0000ef50: 646f 6573 6e74 2065 7869 7374 2229 0a20  doesnt exist"). 
+0000ef60: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0000ef70: 2870 6970 655f 6669 6c65 2c20 2272 6222  (pipe_file, "rb"
+0000ef80: 2920 6173 2066 703a 0a20 2020 2020 2020  ) as fp:.       
+0000ef90: 2020 2020 2064 6174 6120 3d20 6670 2e72       data = fp.r
+0000efa0: 6561 6428 290a 2020 2020 2020 2020 6966  ead().        if
+0000efb0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0000efc0: 7069 7065 6c69 6e65 2c20 7374 7229 3a0a  pipeline, str):.
+0000efd0: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
+0000efe0: 7665 2870 6970 655f 6669 6c65 290a 0a20  ve(pipe_file).. 
+0000eff0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000f000: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0000f010: 207b 226e 616d 6573 7061 6365 223a 206e   {"namespace": n
+0000f020: 616d 6573 7061 6365 2c20 2265 7870 6572  amespace, "exper
+0000f030: 696d 656e 7422 3a20 6578 7065 7269 6d65  iment": experime
+0000f040: 6e74 2c20 2272 756e 223a 2072 756e 7d0a  nt, "run": run}.
+0000f050: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+0000f060: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+0000f070: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000f080: 2020 2250 4f53 5422 2c0a 2020 2020 2020    "POST",.      
+0000f090: 2020 2020 2020 2020 2020 6622 7072 6f6a            f"proj
+0000f0a0: 6563 7473 2f7b 7072 6f6a 6563 747d 2f70  ects/{project}/p
+0000f0b0: 6970 656c 696e 6573 222c 0a20 2020 2020  ipelines",.     
+0000f0c0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000f0d0: 733d 7061 7261 6d73 2c0a 2020 2020 2020  s=params,.      
+0000f0e0: 2020 2020 2020 2020 2020 7469 6d65 6f75            timeou
+0000f0f0: 743d 3230 2c0a 2020 2020 2020 2020 2020  t=20,.          
+0000f100: 2020 2020 2020 626f 6479 3d64 6174 612c        body=data,
+0000f110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f120: 2068 6561 6465 7273 3d68 6561 6465 7273   headers=headers
+0000f130: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000f140: 2020 2020 2020 2020 6578 6365 7074 204f          except O
+0000f150: 5345 7272 6f72 2061 7320 6572 723a 0a20  SError as err:. 
+0000f160: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000f170: 722e 6572 726f 7228 6622 6572 726f 7220  r.error(f"error 
+0000f180: 6361 6e6e 6f74 2073 7562 6d69 7420 7069  cannot submit pi
+0000f190: 7065 6c69 6e65 3a20 7b65 7272 5f74 6f5f  peline: {err_to_
+0000f1a0: 7374 7228 6572 7229 7d22 290a 2020 2020  str(err)}").    
+0000f1b0: 2020 2020 2020 2020 7261 6973 6520 4f53          raise OS
+0000f1c0: 4572 726f 7228 6622 6572 726f 723a 2063  Error(f"error: c
+0000f1d0: 616e 6e6f 7420 6361 6e6e 6f74 2073 7562  annot cannot sub
+0000f1e0: 6d69 7420 7069 7065 6c69 6e65 2c20 7b65  mit pipeline, {e
+0000f1f0: 7272 5f74 6f5f 7374 7228 6572 7229 7d22  rr_to_str(err)}"
+0000f200: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0000f210: 7420 7265 7370 2e6f 6b3a 0a20 2020 2020  t resp.ok:.     
+0000f220: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
+0000f230: 726f 7228 6622 6261 6420 7265 7370 2121  ror(f"bad resp!!
+0000f240: 5c6e 7b72 6573 702e 7465 7874 7d22 290a  \n{resp.text}").
+0000f250: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f260: 6520 5661 6c75 6545 7272 6f72 2866 2262  e ValueError(f"b
+0000f270: 6164 2073 7562 6d69 7420 7069 7065 6c69  ad submit pipeli
+0000f280: 6e65 2072 6573 706f 6e73 652c 207b 7265  ne response, {re
+0000f290: 7370 2e74 6578 747d 2229 0a0a 2020 2020  sp.text}")..    
+0000f2a0: 2020 2020 7265 7370 203d 2072 6573 702e      resp = resp.
+0000f2b0: 6a73 6f6e 2829 0a20 2020 2020 2020 206c  json().        l
+0000f2c0: 6f67 6765 722e 696e 666f 2866 2273 7562  ogger.info(f"sub
+0000f2d0: 6d69 7474 6564 2070 6970 656c 696e 6520  mitted pipeline 
+0000f2e0: 7b72 6573 705b 276e 616d 6527 5d7d 2069  {resp['name']} i
+0000f2f0: 643d 7b72 6573 705b 2769 6427 5d7d 2229  d={resp['id']}")
+0000f300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f310: 7265 7370 5b22 6964 225d 0a0a 2020 2020  resp["id"]..    
+0000f320: 6465 6620 6c69 7374 5f70 6970 656c 696e  def list_pipelin
+0000f330: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
+0000f340: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+0000f350: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
+0000f360: 6e61 6d65 7370 6163 653a 2073 7472 203d  namespace: str =
+0000f370: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+0000f380: 6f72 745f 6279 3a20 7374 7220 3d20 2222  ort_by: str = ""
+0000f390: 2c0a 2020 2020 2020 2020 7061 6765 5f74  ,.        page_t
+0000f3a0: 6f6b 656e 3a20 7374 7220 3d20 2222 2c0a  oken: str = "",.
+0000f3b0: 2020 2020 2020 2020 6669 6c74 6572 5f3a          filter_:
+0000f3c0: 2073 7472 203d 2022 222c 0a20 2020 2020   str = "",.     
+0000f3d0: 2020 2066 6f72 6d61 745f 3a20 556e 696f     format_: Unio
+0000f3e0: 6e5b 0a20 2020 2020 2020 2020 2020 2073  n[.            s
+0000f3f0: 7472 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  tr, mlrun.common
+0000f400: 2e73 6368 656d 6173 2e50 6970 656c 696e  .schemas.Pipelin
+0000f410: 6573 466f 726d 6174 0a20 2020 2020 2020  esFormat.       
+0000f420: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
+0000f430: 6e2e 7363 6865 6d61 732e 5069 7065 6c69  n.schemas.Pipeli
+0000f440: 6e65 7346 6f72 6d61 742e 6d65 7461 6461  nesFormat.metada
+0000f450: 7461 5f6f 6e6c 792c 0a20 2020 2020 2020  ta_only,.       
+0000f460: 2070 6167 655f 7369 7a65 3a20 696e 7420   page_size: int 
+0000f470: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+0000f480: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+0000f490: 6865 6d61 732e 5069 7065 6c69 6e65 734f  hemas.PipelinesO
+0000f4a0: 7574 7075 743a 0a20 2020 2020 2020 2022  utput:.        "
+0000f4b0: 2222 5265 7472 6965 7665 2061 206c 6973  ""Retrieve a lis
+0000f4c0: 7420 6f66 204b 4650 2070 6970 656c 696e  t of KFP pipelin
+0000f4d0: 6573 2e20 5468 6973 2066 756e 6374 696f  es. This functio
+0000f4e0: 6e20 6361 6e20 6265 2069 6e76 6f6b 6564  n can be invoked
+0000f4f0: 2074 6f20 6765 7420 616c 6c20 7069 7065   to get all pipe
+0000f500: 6c69 6e65 7320 6672 6f6d 2061 6c6c 2070  lines from all p
+0000f510: 726f 6a65 6374 732c 0a20 2020 2020 2020  rojects,.       
+0000f520: 2062 7920 7370 6563 6966 7969 6e67 2060   by specifying `
+0000f530: 6070 726f 6a65 6374 3d2a 6060 2c20 696e  `project=*``, in
+0000f540: 2077 6869 6368 2063 6173 6520 7061 6769   which case pagi
+0000f550: 6e61 7469 6f6e 2063 616e 2062 6520 7573  nation can be us
+0000f560: 6564 2061 6e64 2074 6865 2076 6172 696f  ed and the vario
+0000f570: 7573 2073 6f72 7469 6e67 2061 6e64 2070  us sorting and p
+0000f580: 6167 696e 6174 696f 6e0a 2020 2020 2020  agination.      
+0000f590: 2020 7072 6f70 6572 7469 6573 2063 616e    properties can
+0000f5a0: 2062 6520 6170 706c 6965 642e 2049 6620   be applied. If 
+0000f5b0: 6120 7370 6563 6966 6963 2070 726f 6a65  a specific proje
+0000f5c0: 6374 2069 7320 7265 7175 6573 7465 642c  ct is requested,
+0000f5d0: 2074 6865 6e20 7468 6520 7061 6769 6e61   then the pagina
+0000f5e0: 7469 6f6e 206f 7074 696f 6e73 2063 616e  tion options can
+0000f5f0: 6e6f 7420 6265 0a20 2020 2020 2020 2075  not be.        u
+0000f600: 7365 6420 616e 6420 7061 6769 6e61 7469  sed and paginati
+0000f610: 6f6e 2069 7320 6e6f 7420 6170 706c 6965  on is not applie
+0000f620: 642e 0a0a 2020 2020 2020 2020 3a70 6172  d...        :par
+0000f630: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+0000f640: 6563 7420 6e61 6d65 2e20 4361 6e20 6265  ect name. Can be
+0000f650: 2060 602a 6060 2066 6f72 2071 7565 7279   ``*`` for query
+0000f660: 2061 6372 6f73 7320 616c 6c20 7072 6f6a   across all proj
+0000f670: 6563 7473 2e0a 2020 2020 2020 2020 3a70  ects..        :p
+0000f680: 6172 616d 206e 616d 6573 7061 6365 3a20  aram namespace: 
+0000f690: 4b75 6265 726e 6574 6573 206e 616d 6573  Kubernetes names
+0000f6a0: 7061 6365 2069 6e20 7768 6963 6820 7468  pace in which th
+0000f6b0: 6520 7069 7065 6c69 6e65 7320 6172 6520  e pipelines are 
+0000f6c0: 6578 6563 7574 696e 672e 0a20 2020 2020  executing..     
+0000f6d0: 2020 203a 7061 7261 6d20 736f 7274 5f62     :param sort_b
+0000f6e0: 793a 2046 6965 6c64 2074 6f20 736f 7274  y: Field to sort
+0000f6f0: 2074 6865 2072 6573 756c 7473 2062 792e   the results by.
+0000f700: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000f710: 7061 6765 5f74 6f6b 656e 3a20 5573 6520  page_token: Use 
+0000f720: 666f 7220 7061 6769 6e61 7469 6f6e 2c20  for pagination, 
+0000f730: 746f 2072 6574 7269 6576 6520 6e65 7874  to retrieve next
+0000f740: 2070 6167 652e 0a20 2020 2020 2020 203a   page..        :
+0000f750: 7061 7261 6d20 6669 6c74 6572 5f3a 204b  param filter_: K
+0000f760: 7562 6572 6e65 7465 7320 6669 6c74 6572  ubernetes filter
+0000f770: 2074 6f20 6170 706c 7920 746f 2074 6865   to apply to the
+0000f780: 2071 7565 7279 2c20 6361 6e20 6265 2075   query, can be u
+0000f790: 7365 6420 746f 2066 696c 7465 7220 6f6e  sed to filter on
+0000f7a0: 2073 7065 6369 6669 6320 6f62 6a65 6374   specific object
+0000f7b0: 2066 6965 6c64 732e 0a20 2020 2020 2020   fields..       
+0000f7c0: 203a 7061 7261 6d20 666f 726d 6174 5f3a   :param format_:
+0000f7d0: 2052 6573 756c 7420 666f 726d 6174 2e20   Result format. 
+0000f7e0: 4361 6e20 6265 206f 6e65 206f 663a 0a0a  Can be one of:..
+0000f7f0: 2020 2020 2020 2020 2020 2020 2d20 6060              - ``
+0000f800: 6675 6c6c 6060 202d 2072 6574 7572 6e20  full`` - return 
+0000f810: 7468 6520 6675 6c6c 206f 626a 6563 7473  the full objects
+0000f820: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
+0000f830: 6060 6d65 7461 6461 7461 5f6f 6e6c 7960  ``metadata_only`
+0000f840: 6020 2864 6566 6175 6c74 2920 2d20 7265  ` (default) - re
+0000f850: 7475 726e 206a 7573 7420 6d65 7461 6461  turn just metada
+0000f860: 7461 206f 6620 7468 6520 7069 7065 6c69  ta of the pipeli
+0000f870: 6e65 7320 6f62 6a65 6374 732e 0a20 2020  nes objects..   
+0000f880: 2020 2020 2020 2020 202d 2060 606e 616d           - ``nam
+0000f890: 655f 6f6e 6c79 6060 202d 2072 6574 7572  e_only`` - retur
+0000f8a0: 6e20 6a75 7374 2074 6865 206e 616d 6573  n just the names
+0000f8b0: 206f 6620 7468 6520 7069 7065 6c69 6e65   of the pipeline
+0000f8c0: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
+0000f8d0: 2020 3a70 6172 616d 2070 6167 655f 7369    :param page_si
+0000f8e0: 7a65 3a20 5369 7a65 206f 6620 6120 7369  ze: Size of a si
+0000f8f0: 6e67 6c65 2070 6167 6520 7768 656e 2061  ngle page when a
+0000f900: 7070 6c79 696e 6720 7061 6769 6e61 7469  pplying paginati
+0000f910: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
+0000f920: 0a20 2020 2020 2020 2069 6620 7072 6f6a  .        if proj
+0000f930: 6563 7420 213d 2022 2a22 2061 6e64 2028  ect != "*" and (
+0000f940: 7061 6765 5f74 6f6b 656e 206f 7220 7061  page_token or pa
+0000f950: 6765 5f73 697a 6529 3a0a 2020 2020 2020  ge_size):.      
+0000f960: 2020 2020 2020 7261 6973 6520 6d6c 7275        raise mlru
+0000f970: 6e2e 6572 726f 7273 2e4d 4c52 756e 496e  n.errors.MLRunIn
+0000f980: 7661 6c69 6441 7267 756d 656e 7445 7272  validArgumentErr
+0000f990: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000f9a0: 2020 2020 2246 696c 7465 7269 6e67 2062      "Filtering b
+0000f9b0: 7920 7072 6f6a 6563 7420 6361 6e20 6e6f  y project can no
+0000f9c0: 7420 6265 2075 7365 6420 746f 6765 7468  t be used togeth
+0000f9d0: 6572 2077 6974 6820 7061 6769 6e61 7469  er with paginati
+0000f9e0: 6f6e 220a 2020 2020 2020 2020 2020 2020  on".            
+0000f9f0: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
+0000fa00: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0000fa10: 2022 6e61 6d65 7370 6163 6522 3a20 6e61   "namespace": na
+0000fa20: 6d65 7370 6163 652c 0a20 2020 2020 2020  mespace,.       
+0000fa30: 2020 2020 2022 736f 7274 5f62 7922 3a20       "sort_by": 
+0000fa40: 736f 7274 5f62 792c 0a20 2020 2020 2020  sort_by,.       
+0000fa50: 2020 2020 2022 7061 6765 5f74 6f6b 656e       "page_token
+0000fa60: 223a 2070 6167 655f 746f 6b65 6e2c 0a20  ": page_token,. 
+0000fa70: 2020 2020 2020 2020 2020 2022 6669 6c74             "filt
+0000fa80: 6572 223a 2066 696c 7465 725f 2c0a 2020  er": filter_,.  
+0000fa90: 2020 2020 2020 2020 2020 2266 6f72 6d61            "forma
+0000faa0: 7422 3a20 666f 726d 6174 5f2c 0a20 2020  t": format_,.   
+0000fab0: 2020 2020 2020 2020 2022 7061 6765 5f73           "page_s
+0000fac0: 697a 6522 3a20 7061 6765 5f73 697a 652c  ize": page_size,
+0000fad0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+0000fae0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+0000faf0: 6520 3d20 6622 4661 696c 6564 206c 6973  e = f"Failed lis
+0000fb00: 7469 6e67 2070 6970 656c 696e 6573 2c20  ting pipelines, 
+0000fb10: 7175 6572 793a 207b 7061 7261 6d73 7d22  query: {params}"
+0000fb20: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
+0000fb30: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
+0000fb40: 6c28 0a20 2020 2020 2020 2020 2020 2022  l(.            "
+0000fb50: 4745 5422 2c20 6622 7072 6f6a 6563 7473  GET", f"projects
+0000fb60: 2f7b 7072 6f6a 6563 747d 2f70 6970 656c  /{project}/pipel
+0000fb70: 696e 6573 222c 2065 7272 6f72 5f6d 6573  ines", error_mes
+0000fb80: 7361 6765 2c20 7061 7261 6d73 3d70 6172  sage, params=par
+0000fb90: 616d 730a 2020 2020 2020 2020 290a 2020  ams.        ).  
+0000fba0: 2020 2020 2020 7265 7475 726e 206d 6c72        return mlr
+0000fbb0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0000fbc0: 732e 5069 7065 6c69 6e65 734f 7574 7075  s.PipelinesOutpu
+0000fbd0: 7428 2a2a 7265 7370 6f6e 7365 2e6a 736f  t(**response.jso
+0000fbe0: 6e28 2929 0a0a 2020 2020 6465 6620 6765  n())..    def ge
+0000fbf0: 745f 7069 7065 6c69 6e65 280a 2020 2020  t_pipeline(.    
+0000fc00: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000fc10: 2020 7275 6e5f 6964 3a20 7374 722c 0a20    run_id: str,. 
+0000fc20: 2020 2020 2020 206e 616d 6573 7061 6365         namespace
+0000fc30: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
+0000fc40: 2020 2020 2020 7469 6d65 6f75 743a 2069        timeout: i
+0000fc50: 6e74 203d 2031 302c 0a20 2020 2020 2020  nt = 10,.       
+0000fc60: 2066 6f72 6d61 745f 3a20 556e 696f 6e5b   format_: Union[
+0000fc70: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0000fc80: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+0000fc90: 6368 656d 6173 2e50 6970 656c 696e 6573  chemas.Pipelines
+0000fca0: 466f 726d 6174 0a20 2020 2020 2020 205d  Format.        ]
+0000fcb0: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
+0000fcc0: 7363 6865 6d61 732e 5069 7065 6c69 6e65  schemas.Pipeline
+0000fcd0: 7346 6f72 6d61 742e 7375 6d6d 6172 792c  sFormat.summary,
+0000fce0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+0000fcf0: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
+0000fd00: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000fd10: 5265 7472 6965 7665 2064 6574 6169 6c73  Retrieve details
+0000fd20: 206f 6620 6120 7370 6563 6966 6963 2070   of a specific p
+0000fd30: 6970 656c 696e 6520 7573 696e 6720 6974  ipeline using it
+0000fd40: 7320 7275 6e20 4944 2028 6173 2070 726f  s run ID (as pro
+0000fd50: 7669 6465 6420 7768 656e 2074 6865 2070  vided when the p
+0000fd60: 6970 656c 696e 6520 7761 7320 6578 6563  ipeline was exec
+0000fd70: 7574 6564 292e 2222 220a 0a20 2020 2020  uted)."""..     
+0000fd80: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000fd90: 2020 2020 7061 7261 6d73 203d 207b 7d0a      params = {}.
+0000fda0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000fdb0: 616d 6573 7061 6365 3a0a 2020 2020 2020  amespace:.      
+0000fdc0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+0000fdd0: 5b22 6e61 6d65 7370 6163 6522 5d20 3d20  ["namespace"] = 
+0000fde0: 6e61 6d65 7370 6163 650a 2020 2020 2020  namespace.      
+0000fdf0: 2020 2020 2020 7061 7261 6d73 5b22 666f        params["fo
+0000fe00: 726d 6174 225d 203d 2066 6f72 6d61 745f  rmat"] = format_
+0000fe10: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0000fe20: 6a65 6374 5f70 6174 6820 3d20 7072 6f6a  ject_path = proj
+0000fe30: 6563 7420 6966 2070 726f 6a65 6374 2065  ect if project e
+0000fe40: 6c73 6520 222a 220a 2020 2020 2020 2020  lse "*".        
+0000fe50: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+0000fe60: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+0000fe70: 2020 2020 2020 2020 2020 2247 4554 222c            "GET",
+0000fe80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe90: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0000fea0: 6a65 6374 5f70 6174 687d 2f70 6970 656c  ject_path}/pipel
+0000feb0: 696e 6573 2f7b 7275 6e5f 6964 7d22 2c0a  ines/{run_id}",.
+0000fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fed0: 7061 7261 6d73 3d70 6172 616d 732c 0a20  params=params,. 
+0000fee0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000fef0: 696d 656f 7574 3d74 696d 656f 7574 2c0a  imeout=timeout,.
+0000ff00: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000ff10: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
+0000ff20: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
+0000ff30: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+0000ff40: 6572 726f 7228 6622 6572 726f 7220 6361  error(f"error ca
+0000ff50: 6e6e 6f74 2067 6574 2070 6970 656c 696e  nnot get pipelin
+0000ff60: 653a 207b 6572 725f 746f 5f73 7472 2865  e: {err_to_str(e
+0000ff70: 7272 297d 2229 0a20 2020 2020 2020 2020  rr)}").         
+0000ff80: 2020 2072 6169 7365 204f 5345 7272 6f72     raise OSError
+0000ff90: 2866 2265 7272 6f72 3a20 6361 6e6e 6f74  (f"error: cannot
+0000ffa0: 2067 6574 2070 6970 656c 696e 652c 207b   get pipeline, {
+0000ffb0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
+0000ffc0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
+0000ffd0: 6f74 2072 6573 702e 6f6b 3a0a 2020 2020  ot resp.ok:.    
+0000ffe0: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
+0000fff0: 7272 6f72 2866 2262 6164 2072 6573 7021  rror(f"bad resp!
+00010000: 215c 6e7b 7265 7370 2e74 6578 747d 2229  !\n{resp.text}")
+00010010: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010020: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+00010030: 6261 6420 6765 7420 7069 7065 6c69 6e65  bad get pipeline
+00010040: 2072 6573 706f 6e73 652c 207b 7265 7370   response, {resp
+00010050: 2e74 6578 747d 2229 0a0a 2020 2020 2020  .text}")..      
+00010060: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
+00010070: 6f6e 2829 0a0a 2020 2020 4073 7461 7469  on()..    @stati
+00010080: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00010090: 5f72 6573 6f6c 7665 5f72 6566 6572 656e  _resolve_referen
+000100a0: 6365 2874 6167 2c20 7569 6429 3a0a 2020  ce(tag, uid):.  
+000100b0: 2020 2020 2020 6966 2075 6964 2061 6e64        if uid and
+000100c0: 2074 6167 3a0a 2020 2020 2020 2020 2020   tag:.          
+000100d0: 2020 7261 6973 6520 4d4c 5275 6e49 6e76    raise MLRunInv
+000100e0: 616c 6964 4172 6775 6d65 6e74 4572 726f  alidArgumentErro
+000100f0: 7228 2262 6f74 6820 7569 6420 616e 6420  r("both uid and 
+00010100: 7461 6720 7765 7265 2070 726f 7669 6465  tag were provide
+00010110: 6422 290a 2020 2020 2020 2020 7265 7475  d").        retu
+00010120: 726e 2075 6964 206f 7220 7461 6720 6f72  rn uid or tag or
+00010130: 2022 6c61 7465 7374 220a 0a20 2020 2064   "latest"..    d
+00010140: 6566 2063 7265 6174 655f 6665 6174 7572  ef create_featur
+00010150: 655f 7365 7428 0a20 2020 2020 2020 2073  e_set(.        s
+00010160: 656c 662c 0a20 2020 2020 2020 2066 6561  elf,.        fea
+00010170: 7475 7265 5f73 6574 3a20 556e 696f 6e5b  ture_set: Union[
+00010180: 6469 6374 2c20 6d6c 7275 6e2e 636f 6d6d  dict, mlrun.comm
+00010190: 6f6e 2e73 6368 656d 6173 2e46 6561 7475  on.schemas.Featu
+000101a0: 7265 5365 742c 2046 6561 7475 7265 5365  reSet, FeatureSe
+000101b0: 745d 2c0a 2020 2020 2020 2020 7072 6f6a  t],.        proj
+000101c0: 6563 743d 2222 2c0a 2020 2020 2020 2020  ect="",.        
+000101d0: 7665 7273 696f 6e65 643d 5472 7565 2c0a  versioned=True,.
+000101e0: 2020 2020 2920 2d3e 2064 6963 743a 0a20      ) -> dict:. 
+000101f0: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
+00010200: 2061 206e 6577 203a 7079 3a63 6c61 7373   a new :py:class
+00010210: 3a60 7e6d 6c72 756e 2e66 6561 7475 7265  :`~mlrun.feature
+00010220: 5f73 746f 7265 2e46 6561 7475 7265 5365  _store.FeatureSe
+00010230: 7460 2061 6e64 2073 6176 6520 696e 2074  t` and save in t
+00010240: 6865 203a 7079 3a6d 6f64 3a60 6d6c 7275  he :py:mod:`mlru
+00010250: 6e60 2044 422e 2054 6865 0a20 2020 2020  n` DB. The.     
+00010260: 2020 2066 6561 7475 7265 2d73 6574 206d     feature-set m
+00010270: 7573 7420 6e6f 7420 7072 6576 696f 7573  ust not previous
+00010280: 6c79 2065 7869 7374 2069 6e20 7468 6520  ly exist in the 
+00010290: 4442 2e0a 0a20 2020 2020 2020 203a 7061  DB...        :pa
+000102a0: 7261 6d20 6665 6174 7572 655f 7365 743a  ram feature_set:
+000102b0: 2054 6865 206e 6577 203a 7079 3a63 6c61   The new :py:cla
+000102c0: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
+000102d0: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
+000102e0: 5365 7460 2074 6f20 6372 6561 7465 2e0a  Set` to create..
+000102f0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00010300: 726f 6a65 6374 3a20 4e61 6d65 206f 6620  roject: Name of 
+00010310: 7072 6f6a 6563 7420 7468 6973 2066 6561  project this fea
+00010320: 7475 7265 2d73 6574 2062 656c 6f6e 6773  ture-set belongs
+00010330: 2074 6f2e 0a20 2020 2020 2020 203a 7061   to..        :pa
+00010340: 7261 6d20 7665 7273 696f 6e65 643a 2057  ram versioned: W
+00010350: 6865 7468 6572 2074 6f20 6d61 696e 7461  hether to mainta
+00010360: 696e 2076 6572 7369 6f6e 7320 666f 7220  in versions for 
+00010370: 7468 6973 2066 6561 7475 7265 2d73 6574  this feature-set
+00010380: 2e20 416c 6c20 7665 7273 696f 6e73 206f  . All versions o
+00010390: 6620 6120 7665 7273 696f 6e65 6420 6f62  f a versioned ob
+000103a0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+000103b0: 2077 696c 6c20 6265 206b 6570 7420 696e   will be kept in
+000103c0: 2074 6865 2044 4220 616e 6420 6361 6e20   the DB and can 
+000103d0: 6265 2072 6574 7269 6576 6564 2075 6e74  be retrieved unt
+000103e0: 696c 2065 7870 6c69 6369 746c 7920 6465  il explicitly de
+000103f0: 6c65 7465 642e 0a20 2020 2020 2020 203a  leted..        :
+00010400: 7265 7475 726e 733a 2054 6865 203a 7079  returns: The :py
+00010410: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
+00010420: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
+00010430: 7475 7265 5365 7460 206f 626a 6563 7420  tureSet` object 
+00010440: 2861 7320 6469 6374 292e 0a20 2020 2020  (as dict)..     
+00010450: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00010460: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
+00010470: 7475 7265 5f73 6574 2c20 6d6c 7275 6e2e  ture_set, mlrun.
+00010480: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e46  common.schemas.F
+00010490: 6561 7475 7265 5365 7429 3a0a 2020 2020  eatureSet):.    
+000104a0: 2020 2020 2020 2020 6665 6174 7572 655f          feature_
+000104b0: 7365 7420 3d20 6665 6174 7572 655f 7365  set = feature_se
+000104c0: 742e 6469 6374 2829 0a20 2020 2020 2020  t.dict().       
+000104d0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+000104e0: 2866 6561 7475 7265 5f73 6574 2c20 4665  (feature_set, Fe
+000104f0: 6174 7572 6553 6574 293a 0a20 2020 2020  atureSet):.     
+00010500: 2020 2020 2020 2066 6561 7475 7265 5f73         feature_s
+00010510: 6574 203d 2066 6561 7475 7265 5f73 6574  et = feature_set
+00010520: 2e74 6f5f 6469 6374 2829 0a0a 2020 2020  .to_dict()..    
+00010530: 2020 2020 7072 6f6a 6563 7420 3d20 280a      project = (.
+00010540: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
+00010550: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+00010560: 6f72 2066 6561 7475 7265 5f73 6574 5b22  or feature_set["
+00010570: 6d65 7461 6461 7461 225d 2e67 6574 2822  metadata"].get("
+00010580: 7072 6f6a 6563 7422 2c20 4e6f 6e65 290a  project", None).
+00010590: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
+000105a0: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
+000105b0: 6f6a 6563 740a 2020 2020 2020 2020 290a  oject.        ).
+000105c0: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+000105d0: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+000105e0: 6374 7d2f 6665 6174 7572 652d 7365 7473  ct}/feature-sets
+000105f0: 220a 2020 2020 2020 2020 7061 7261 6d73  ".        params
+00010600: 203d 207b 2276 6572 7369 6f6e 6564 223a   = {"versioned":
+00010610: 2076 6572 7369 6f6e 6564 7d0a 0a20 2020   versioned}..   
+00010620: 2020 2020 206e 616d 6520 3d20 6665 6174       name = feat
+00010630: 7572 655f 7365 745b 226d 6574 6164 6174  ure_set["metadat
+00010640: 6122 5d5b 226e 616d 6522 5d0a 2020 2020  a"]["name"].    
+00010650: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+00010660: 6520 3d20 6622 4661 696c 6564 2063 7265  e = f"Failed cre
+00010670: 6174 696e 6720 6665 6174 7572 652d 7365  ating feature-se
+00010680: 7420 7b70 726f 6a65 6374 7d2f 7b6e 616d  t {project}/{nam
+00010690: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
+000106a0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+000106b0: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
+000106c0: 4f53 5422 2c0a 2020 2020 2020 2020 2020  OST",.          
+000106d0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
+000106e0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+000106f0: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
+00010700: 6172 616d 733d 7061 7261 6d73 2c0a 2020  arams=params,.  
+00010710: 2020 2020 2020 2020 2020 626f 6479 3d64            body=d
+00010720: 6963 745f 746f 5f6a 736f 6e28 6665 6174  ict_to_json(feat
+00010730: 7572 655f 7365 7429 2c0a 2020 2020 2020  ure_set),.      
+00010740: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+00010750: 726e 2072 6573 702e 6a73 6f6e 2829 0a0a  rn resp.json()..
+00010760: 2020 2020 6465 6620 6765 745f 6665 6174      def get_feat
+00010770: 7572 655f 7365 7428 0a20 2020 2020 2020  ure_set(.       
+00010780: 2073 656c 662c 206e 616d 653a 2073 7472   self, name: str
+00010790: 2c20 7072 6f6a 6563 743a 2073 7472 203d  , project: str =
+000107a0: 2022 222c 2074 6167 3a20 7374 7220 3d20   "", tag: str = 
+000107b0: 4e6f 6e65 2c20 7569 643a 2073 7472 203d  None, uid: str =
+000107c0: 204e 6f6e 650a 2020 2020 2920 2d3e 2046   None.    ) -> F
+000107d0: 6561 7475 7265 5365 743a 0a20 2020 2020  eatureSet:.     
+000107e0: 2020 2022 2222 5265 7472 6965 7665 2061     """Retrieve a
+000107f0: 207e 6d6c 7275 6e2e 6665 6174 7572 655f   ~mlrun.feature_
+00010800: 7374 6f72 652e 4665 6174 7572 6553 6574  store.FeatureSet
+00010810: 6020 6f62 6a65 6374 2e20 4966 2062 6f74  ` object. If bot
+00010820: 6820 6060 7461 6760 6020 616e 6420 6060  h ``tag`` and ``
+00010830: 7569 6460 6020 6172 6520 6e6f 7420 7370  uid`` are not sp
+00010840: 6563 6966 6965 642c 2074 6865 6e0a 2020  ecified, then.  
+00010850: 2020 2020 2020 7468 6520 6f62 6a65 6374        the object
+00010860: 2074 6167 6765 6420 6060 6c61 7465 7374   tagged ``latest
+00010870: 6060 2077 696c 6c20 6265 2072 6574 7269  `` will be retri
+00010880: 6576 6564 2e0a 0a20 2020 2020 2020 203a  eved...        :
+00010890: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
+000108a0: 206f 6620 6f62 6a65 6374 2074 6f20 7265   of object to re
+000108b0: 7472 6965 7665 2e0a 2020 2020 2020 2020  trieve..        
+000108c0: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+000108d0: 5072 6f6a 6563 7420 7468 6520 4665 6174  Project the Feat
+000108e0: 7572 6553 6574 2062 656c 6f6e 6773 2074  ureSet belongs t
+000108f0: 6f2e 0a20 2020 2020 2020 203a 7061 7261  o..        :para
+00010900: 6d20 7461 673a 2054 6167 206f 6620 7468  m tag: Tag of th
+00010910: 6520 7370 6563 6966 6963 206f 626a 6563  e specific objec
+00010920: 7420 7665 7273 696f 6e20 746f 2072 6574  t version to ret
+00010930: 7269 6576 652e 0a20 2020 2020 2020 203a  rieve..        :
+00010940: 7061 7261 6d20 7569 643a 2075 6964 206f  param uid: uid o
+00010950: 6620 7468 6520 6f62 6a65 6374 2074 6f20  f the object to 
+00010960: 7265 7472 6965 7665 2028 6361 6e20 6f6e  retrieve (can on
+00010970: 6c79 2062 6520 7573 6564 2066 6f72 2076  ly be used for v
+00010980: 6572 7369 6f6e 6564 206f 626a 6563 7473  ersioned objects
+00010990: 292e 0a20 2020 2020 2020 2022 2222 0a0a  )..        """..
+000109a0: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
+000109b0: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
+000109c0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
+000109d0: 6563 740a 2020 2020 2020 2020 7265 6665  ect.        refe
+000109e0: 7265 6e63 6520 3d20 7365 6c66 2e5f 7265  rence = self._re
+000109f0: 736f 6c76 655f 7265 6665 7265 6e63 6528  solve_reference(
+00010a00: 7461 672c 2075 6964 290a 2020 2020 2020  tag, uid).      
+00010a10: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+00010a20: 6374 732f 7b70 726f 6a65 6374 7d2f 6665  cts/{project}/fe
+00010a30: 6174 7572 652d 7365 7473 2f7b 6e61 6d65  ature-sets/{name
+00010a40: 7d2f 7265 6665 7265 6e63 6573 2f7b 7265  }/references/{re
+00010a50: 6665 7265 6e63 657d 220a 2020 2020 2020  ference}".      
+00010a60: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
+00010a70: 3d20 6622 4661 696c 6564 2072 6574 7269  = f"Failed retri
+00010a80: 6576 696e 6720 6665 6174 7572 652d 7365  eving feature-se
+00010a90: 7420 7b70 726f 6a65 6374 7d2f 7b6e 616d  t {project}/{nam
+00010aa0: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
+00010ab0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+00010ac0: 2822 4745 5422 2c20 7061 7468 2c20 6572  ("GET", path, er
+00010ad0: 726f 725f 6d65 7373 6167 6529 0a20 2020  ror_message).   
+00010ae0: 2020 2020 2072 6574 7572 6e20 4665 6174       return Feat
+00010af0: 7572 6553 6574 2e66 726f 6d5f 6469 6374  ureSet.from_dict
+00010b00: 2872 6573 702e 6a73 6f6e 2829 290a 0a20  (resp.json()).. 
+00010b10: 2020 2064 6566 206c 6973 745f 6665 6174     def list_feat
+00010b20: 7572 6573 280a 2020 2020 2020 2020 7365  ures(.        se
+00010b30: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
+00010b40: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
+00010b50: 2020 6e61 6d65 3a20 7374 7220 3d20 4e6f    name: str = No
+00010b60: 6e65 2c0a 2020 2020 2020 2020 7461 673a  ne,.        tag:
+00010b70: 2073 7472 203d 204e 6f6e 652c 0a20 2020   str = None,.   
+00010b80: 2020 2020 2065 6e74 6974 6965 733a 204c       entities: L
+00010b90: 6973 745b 7374 725d 203d 204e 6f6e 652c  ist[str] = None,
+00010ba0: 0a20 2020 2020 2020 206c 6162 656c 733a  .        labels:
+00010bb0: 204c 6973 745b 7374 725d 203d 204e 6f6e   List[str] = Non
+00010bc0: 652c 0a20 2020 2029 202d 3e20 4c69 7374  e,.    ) -> List
+00010bd0: 5b64 6963 745d 3a0a 2020 2020 2020 2020  [dict]:.        
+00010be0: 2222 224c 6973 7420 6665 6174 7572 652d  """List feature-
+00010bf0: 7365 7473 2077 6869 6368 2063 6f6e 7461  sets which conta
+00010c00: 696e 2073 7065 6369 6669 6320 6665 6174  in specific feat
+00010c10: 7572 6573 2e20 5468 6973 2066 756e 6374  ures. This funct
+00010c20: 696f 6e20 6d61 7920 7265 7475 726e 206d  ion may return m
+00010c30: 756c 7469 706c 6520 7665 7273 696f 6e73  ultiple versions
+00010c40: 206f 6620 7468 6520 7361 6d65 0a20 2020   of the same.   
+00010c50: 2020 2020 2066 6561 7475 7265 2d73 6574       feature-set
+00010c60: 2069 6620 6120 7370 6563 6966 6963 2074   if a specific t
+00010c70: 6167 2069 7320 6e6f 7420 7265 7175 6573  ag is not reques
+00010c80: 7465 642e 204e 6f74 6520 7468 6174 2074  ted. Note that t
+00010c90: 6865 2076 6172 696f 7573 2066 696c 7465  he various filte
+00010ca0: 7273 206f 6620 7468 6973 2066 756e 6374  rs of this funct
+00010cb0: 696f 6e20 6163 7475 616c 6c79 0a20 2020  ion actually.   
+00010cc0: 2020 2020 2072 6566 6572 2074 6f20 7468       refer to th
+00010cd0: 6520 6665 6174 7572 652d 7365 7420 6f62  e feature-set ob
+00010ce0: 6a65 6374 2063 6f6e 7461 696e 696e 6720  ject containing 
+00010cf0: 7468 6520 6665 6174 7572 6573 2c20 6e6f  the features, no
+00010d00: 7420 746f 2074 6865 2066 6561 7475 7265  t to the feature
+00010d10: 7320 7468 656d 7365 6c76 6573 2e0a 0a20  s themselves... 
+00010d20: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00010d30: 6f6a 6563 743a 2050 726f 6a65 6374 2077  oject: Project w
+00010d40: 6869 6368 2063 6f6e 7461 696e 7320 7468  hich contains th
+00010d50: 6573 6520 6665 6174 7572 6573 2e0a 2020  ese features..  
+00010d60: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
+00010d70: 653a 204e 616d 6520 6f66 2074 6865 2066  e: Name of the f
+00010d80: 6561 7475 7265 2074 6f20 6c6f 6f6b 2066  eature to look f
+00010d90: 6f72 2e20 5468 6520 6e61 6d65 2069 7320  or. The name is 
+00010da0: 7573 6564 2069 6e20 6120 6c69 6b65 2071  used in a like q
+00010db0: 7565 7279 2c20 616e 6420 6973 206e 6f74  uery, and is not
+00010dc0: 2063 6173 652d 7365 6e73 6974 6976 652e   case-sensitive.
+00010dd0: 2046 6f72 0a20 2020 2020 2020 2020 2020   For.           
+00010de0: 2065 7861 6d70 6c65 2c20 6c6f 6f6b 696e   example, lookin
+00010df0: 6720 666f 7220 6060 6665 6174 6060 2077  g for ``feat`` w
+00010e00: 696c 6c20 7265 7475 726e 2066 6561 7475  ill return featu
+00010e10: 7265 7320 7768 6963 6820 6172 6520 6e61  res which are na
+00010e20: 6d65 6420 6060 4d79 4665 6174 7572 6560  med ``MyFeature`
+00010e30: 6020 6173 2077 656c 6c20 6173 2060 6064  ` as well as ``d
+00010e40: 6566 6561 7460 602e 0a20 2020 2020 2020  efeat``..       
+00010e50: 203a 7061 7261 6d20 7461 673a 2052 6574   :param tag: Ret
+00010e60: 7572 6e20 6665 6174 7572 652d 7365 7473  urn feature-sets
+00010e70: 2077 6869 6368 2063 6f6e 7461 696e 2074   which contain t
+00010e80: 6865 2066 6561 7475 7265 7320 6c6f 6f6b  he features look
+00010e90: 6564 2066 6f72 2c20 616e 6420 6172 6520  ed for, and are 
+00010ea0: 7461 6767 6564 2077 6974 6820 7468 6520  tagged with the 
+00010eb0: 7370 6563 6966 6963 2074 6167 2e0a 2020  specific tag..  
+00010ec0: 2020 2020 2020 3a70 6172 616d 2065 6e74        :param ent
+00010ed0: 6974 6965 733a 2052 6574 7572 6e20 6f6e  ities: Return on
+00010ee0: 6c79 2066 6561 7475 7265 2d73 6574 7320  ly feature-sets 
+00010ef0: 7768 6963 6820 636f 6e74 6169 6e20 616e  which contain an
+00010f00: 2065 6e74 6974 7920 7768 6f73 6520 6e61   entity whose na
+00010f10: 6d65 2069 7320 636f 6e74 6169 6e65 6420  me is contained 
+00010f20: 696e 2074 6869 7320 6c69 7374 2e0a 2020  in this list..  
+00010f30: 2020 2020 2020 3a70 6172 616d 206c 6162        :param lab
+00010f40: 656c 733a 2052 6574 7572 6e20 6f6e 6c79  els: Return only
+00010f50: 2066 6561 7475 7265 2d73 6574 7320 7768   feature-sets wh
+00010f60: 6963 6820 6172 6520 6c61 6265 6c65 6420  ich are labeled 
+00010f70: 6173 2072 6571 7565 7374 6564 2e0a 2020  as requested..  
+00010f80: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+00010f90: 4120 6c69 7374 206f 6620 6d61 7070 696e  A list of mappin
+00010fa0: 6720 6672 6f6d 2066 6561 7475 7265 2074  g from feature t
+00010fb0: 6f20 6120 6469 6765 7374 206f 6620 7468  o a digest of th
+00010fc0: 6520 6665 6174 7572 652d 7365 742c 2077  e feature-set, w
+00010fd0: 6869 6368 2063 6f6e 7461 696e 7320 7468  hich contains th
+00010fe0: 6520 6665 6174 7572 652d 7365 740a 2020  e feature-set.  
+00010ff0: 2020 2020 2020 2020 2020 6d65 7461 2d64            meta-d
+00011000: 6174 612e 204d 756c 7469 706c 6520 656e  ata. Multiple en
+00011010: 7472 6965 7320 6d61 7920 6265 2072 6574  tries may be ret
+00011020: 7572 6e65 6420 666f 7220 616e 7920 7370  urned for any sp
+00011030: 6563 6966 6963 2066 6561 7475 7265 2064  ecific feature d
+00011040: 7565 2074 6f20 6d75 6c74 6970 6c65 2074  ue to multiple t
+00011050: 6167 7320 6f72 2076 6572 7369 6f6e 730a  ags or versions.
+00011060: 2020 2020 2020 2020 2020 2020 6f66 2074              of t
+00011070: 6865 2066 6561 7475 7265 2d73 6574 2e0a  he feature-set..
+00011080: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00011090: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
+000110a0: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
+000110b0: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
+000110c0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+000110d0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+000110e0: 226e 616d 6522 3a20 6e61 6d65 2c0a 2020  "name": name,.  
+000110f0: 2020 2020 2020 2020 2020 2274 6167 223a            "tag":
+00011100: 2074 6167 2c0a 2020 2020 2020 2020 2020   tag,.          
+00011110: 2020 2265 6e74 6974 7922 3a20 656e 7469    "entity": enti
+00011120: 7469 6573 206f 7220 5b5d 2c0a 2020 2020  ties or [],.    
+00011130: 2020 2020 2020 2020 226c 6162 656c 223a          "label":
+00011140: 206c 6162 656c 7320 6f72 205b 5d2c 0a20   labels or [],. 
+00011150: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+00011160: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+00011170: 6374 732f 7b70 726f 6a65 6374 7d2f 6665  cts/{project}/fe
+00011180: 6174 7572 6573 220a 0a20 2020 2020 2020  atures"..       
+00011190: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+000111a0: 2066 2246 6169 6c65 6420 6c69 7374 696e   f"Failed listin
+000111b0: 6720 6665 6174 7572 6573 2c20 7072 6f6a  g features, proj
+000111c0: 6563 743a 207b 7072 6f6a 6563 747d 2c20  ect: {project}, 
+000111d0: 7175 6572 793a 207b 7061 7261 6d73 7d22  query: {params}"
+000111e0: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+000111f0: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
+00011200: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
+00011210: 5f6d 6573 7361 6765 2c20 7061 7261 6d73  _message, params
+00011220: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+00011230: 2072 6574 7572 6e20 7265 7370 2e6a 736f   return resp.jso
+00011240: 6e28 295b 2266 6561 7475 7265 7322 5d0a  n()["features"].
+00011250: 0a20 2020 2064 6566 206c 6973 745f 656e  .    def list_en
+00011260: 7469 7469 6573 280a 2020 2020 2020 2020  tities(.        
+00011270: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+00011280: 6f6a 6563 743a 2073 7472 2c0a 2020 2020  oject: str,.    
+00011290: 2020 2020 6e61 6d65 3a20 7374 7220 3d20      name: str = 
+000112a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
+000112b0: 673a 2073 7472 203d 204e 6f6e 652c 0a20  g: str = None,. 
+000112c0: 2020 2020 2020 206c 6162 656c 733a 204c         labels: L
+000112d0: 6973 745b 7374 725d 203d 204e 6f6e 652c  ist[str] = None,
+000112e0: 0a20 2020 2029 202d 3e20 4c69 7374 5b64  .    ) -> List[d
+000112f0: 6963 745d 3a0a 2020 2020 2020 2020 2222  ict]:.        ""
+00011300: 2252 6574 7269 6576 6520 6120 6c69 7374  "Retrieve a list
+00011310: 206f 6620 656e 7469 7469 6573 2061 6e64   of entities and
+00011320: 2074 6865 6972 206d 6170 7069 6e67 2074   their mapping t
+00011330: 6f20 7468 6520 636f 6e74 6169 6e69 6e67  o the containing
+00011340: 2066 6561 7475 7265 2d73 6574 732e 2054   feature-sets. T
+00011350: 6869 7320 6675 6e63 7469 6f6e 2069 7320  his function is 
+00011360: 7369 6d69 6c61 720a 2020 2020 2020 2020  similar.        
+00011370: 746f 2074 6865 203a 7079 3a66 756e 633a  to the :py:func:
+00011380: 607e 6c69 7374 5f66 6561 7475 7265 7360  `~list_features`
+00011390: 2066 756e 6374 696f 6e2c 2061 6e64 2075   function, and u
+000113a0: 7365 7320 7468 6520 7361 6d65 206c 6f67  ses the same log
+000113b0: 6963 2e20 486f 7765 7665 722c 2074 6865  ic. However, the
+000113c0: 2065 6e74 6974 6965 7320 6172 6520 6d61   entities are ma
+000113d0: 7463 6865 640a 2020 2020 2020 2020 6167  tched.        ag
+000113e0: 6169 6e73 7420 7468 6520 6e61 6d65 2072  ainst the name r
+000113f0: 6174 6865 7220 7468 616e 2074 6865 2066  ather than the f
+00011400: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
+00011410: 2022 2222 0a0a 2020 2020 2020 2020 7072   """..        pr
+00011420: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
+00011430: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
+00011440: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
+00011450: 2020 7061 7261 6d73 203d 207b 0a20 2020    params = {.   
+00011460: 2020 2020 2020 2020 2022 6e61 6d65 223a           "name":
+00011470: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
+00011480: 2020 2022 7461 6722 3a20 7461 672c 0a20     "tag": tag,. 
+00011490: 2020 2020 2020 2020 2020 2022 6c61 6265             "labe
+000114a0: 6c22 3a20 6c61 6265 6c73 206f 7220 5b5d  l": labels or []
+000114b0: 2c0a 2020 2020 2020 2020 7d0a 0a20 2020  ,.        }..   
+000114c0: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
+000114d0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+000114e0: 2f65 6e74 6974 6965 7322 0a0a 2020 2020  /entities"..    
+000114f0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+00011500: 6520 3d20 6622 4661 696c 6564 206c 6973  e = f"Failed lis
+00011510: 7469 6e67 2065 6e74 6974 6965 732c 2070  ting entities, p
+00011520: 726f 6a65 6374 3a20 7b70 726f 6a65 6374  roject: {project
+00011530: 7d2c 2071 7565 7279 3a20 7b70 6172 616d  }, query: {param
+00011540: 737d 220a 2020 2020 2020 2020 7265 7370  s}".        resp
+00011550: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+00011560: 2822 4745 5422 2c20 7061 7468 2c20 6572  ("GET", path, er
+00011570: 726f 725f 6d65 7373 6167 652c 2070 6172  ror_message, par
+00011580: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+00011590: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
+000115a0: 6a73 6f6e 2829 5b22 656e 7469 7469 6573  json()["entities
+000115b0: 225d 0a0a 2020 2020 4073 7461 7469 636d  "]..    @staticm
+000115c0: 6574 686f 640a 2020 2020 6465 6620 5f67  ethod.    def _g
+000115d0: 656e 6572 6174 655f 7061 7274 6974 696f  enerate_partitio
+000115e0: 6e5f 6279 5f70 6172 616d 7328 0a20 2020  n_by_params(.   
+000115f0: 2020 2020 2070 6172 7469 7469 6f6e 5f62       partition_b
+00011600: 795f 636c 732c 0a20 2020 2020 2020 2070  y_cls,.        p
+00011610: 6172 7469 7469 6f6e 5f62 792c 0a20 2020  artition_by,.   
+00011620: 2020 2020 2072 6f77 735f 7065 725f 7061       rows_per_pa
+00011630: 7274 6974 696f 6e2c 0a20 2020 2020 2020  rtition,.       
+00011640: 2073 6f72 745f 6279 2c0a 2020 2020 2020   sort_by,.      
+00011650: 2020 6f72 6465 722c 0a20 2020 2020 2020    order,.       
+00011660: 206d 6178 5f70 6172 7469 7469 6f6e 733d   max_partitions=
+00011670: 4e6f 6e65 2c0a 2020 2020 293a 0a0a 2020  None,.    ):..  
+00011680: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+00011690: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
+000116a0: 2020 2020 2020 2022 7061 7274 6974 696f         "partitio
+000116b0: 6e2d 6279 223a 2070 6172 7469 7469 6f6e  n-by": partition
+000116c0: 5f62 792c 0a20 2020 2020 2020 2020 2020  _by,.           
+000116d0: 2022 726f 7773 2d70 6572 2d70 6172 7469   "rows-per-parti
+000116e0: 7469 6f6e 223a 2072 6f77 735f 7065 725f  tion": rows_per_
+000116f0: 7061 7274 6974 696f 6e2c 0a20 2020 2020  partition,.     
+00011700: 2020 2020 2020 2022 7061 7274 6974 696f         "partitio
+00011710: 6e2d 736f 7274 2d62 7922 3a20 736f 7274  n-sort-by": sort
+00011720: 5f62 792c 0a20 2020 2020 2020 2020 2020  _by,.           
+00011730: 2022 7061 7274 6974 696f 6e2d 6f72 6465   "partition-orde
+00011740: 7222 3a20 6f72 6465 722c 0a20 2020 2020  r": order,.     
+00011750: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
+00011760: 6d61 785f 7061 7274 6974 696f 6e73 2069  max_partitions i
+00011770: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00011780: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
+00011790: 6e5f 7061 7261 6d73 5b22 6d61 782d 7061  n_params["max-pa
+000117a0: 7274 6974 696f 6e73 225d 203d 206d 6178  rtitions"] = max
+000117b0: 5f70 6172 7469 7469 6f6e 730a 2020 2020  _partitions.    
+000117c0: 2020 2020 7265 7475 726e 2070 6172 7469      return parti
+000117d0: 7469 6f6e 5f70 6172 616d 730a 0a20 2020  tion_params..   
+000117e0: 2064 6566 206c 6973 745f 6665 6174 7572   def list_featur
+000117f0: 655f 7365 7473 280a 2020 2020 2020 2020  e_sets(.        
+00011800: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+00011810: 6f6a 6563 743a 2073 7472 203d 2022 222c  oject: str = "",
+00011820: 0a20 2020 2020 2020 206e 616d 653a 2073  .        name: s
+00011830: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+00011840: 2020 2074 6167 3a20 7374 7220 3d20 4e6f     tag: str = No
+00011850: 6e65 2c0a 2020 2020 2020 2020 7374 6174  ne,.        stat
+00011860: 653a 2073 7472 203d 204e 6f6e 652c 0a20  e: str = None,. 
+00011870: 2020 2020 2020 2065 6e74 6974 6965 733a         entities:
+00011880: 204c 6973 745b 7374 725d 203d 204e 6f6e   List[str] = Non
+00011890: 652c 0a20 2020 2020 2020 2066 6561 7475  e,.        featu
+000118a0: 7265 733a 204c 6973 745b 7374 725d 203d  res: List[str] =
+000118b0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+000118c0: 6162 656c 733a 204c 6973 745b 7374 725d  abels: List[str]
+000118d0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000118e0: 2070 6172 7469 7469 6f6e 5f62 793a 2055   partition_by: U
+000118f0: 6e69 6f6e 5b0a 2020 2020 2020 2020 2020  nion[.          
+00011900: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
+00011910: 6368 656d 6173 2e46 6561 7475 7265 5374  chemas.FeatureSt
+00011920: 6f72 6550 6172 7469 7469 6f6e 4279 4669  orePartitionByFi
+00011930: 656c 642c 2073 7472 0a20 2020 2020 2020  eld, str.       
+00011940: 205d 203d 204e 6f6e 652c 0a20 2020 2020   ] = None,.     
+00011950: 2020 2072 6f77 735f 7065 725f 7061 7274     rows_per_part
+00011960: 6974 696f 6e3a 2069 6e74 203d 2031 2c0a  ition: int = 1,.
+00011970: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
+00011980: 6e5f 736f 7274 5f62 793a 2055 6e69 6f6e  n_sort_by: Union
+00011990: 5b6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  [mlrun.common.sc
+000119a0: 6865 6d61 732e 536f 7274 4669 656c 642c  hemas.SortField,
+000119b0: 2073 7472 5d20 3d20 4e6f 6e65 2c0a 2020   str] = None,.  
+000119c0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+000119d0: 6f72 6465 723a 2055 6e69 6f6e 5b0a 2020  order: Union[.  
+000119e0: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
+000119f0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e4f  common.schemas.O
+00011a00: 7264 6572 5479 7065 2c20 7374 720a 2020  rderType, str.  
+00011a10: 2020 2020 2020 5d20 3d20 6d6c 7275 6e2e        ] = mlrun.
+00011a20: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e4f  common.schemas.O
+00011a30: 7264 6572 5479 7065 2e64 6573 632c 0a20  rderType.desc,. 
+00011a40: 2020 2029 202d 3e20 4c69 7374 5b46 6561     ) -> List[Fea
+00011a50: 7475 7265 5365 745d 3a0a 2020 2020 2020  tureSet]:.      
+00011a60: 2020 2222 2252 6574 7269 6576 6520 6120    """Retrieve a 
+00011a70: 6c69 7374 206f 6620 6665 6174 7572 652d  list of feature-
+00011a80: 7365 7473 206d 6174 6368 696e 6720 7468  sets matching th
+00011a90: 6520 6372 6974 6572 6961 2070 726f 7669  e criteria provi
+00011aa0: 6465 642e 0a0a 2020 2020 2020 2020 3a70  ded...        :p
+00011ab0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+00011ac0: 6f6a 6563 7420 6e61 6d65 2e0a 2020 2020  oject name..    
+00011ad0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
+00011ae0: 204e 616d 6520 6f66 2066 6561 7475 7265   Name of feature
+00011af0: 2d73 6574 2074 6f20 6d61 7463 682e 2054  -set to match. T
+00011b00: 6869 7320 6973 2061 206c 696b 6520 7175  his is a like qu
+00011b10: 6572 792c 2061 6e64 2069 7320 6361 7365  ery, and is case
+00011b20: 2d69 6e73 656e 7369 7469 7665 2e0a 2020  -insensitive..  
+00011b30: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
+00011b40: 3a20 4d61 7463 6820 6665 6174 7572 652d  : Match feature-
+00011b50: 7365 7473 2077 6974 6820 7370 6563 6966  sets with specif
+00011b60: 6963 2074 6167 2e0a 2020 2020 2020 2020  ic tag..        
+00011b70: 3a70 6172 616d 2073 7461 7465 3a20 4d61  :param state: Ma
+00011b80: 7463 6820 6665 6174 7572 652d 7365 7473  tch feature-sets
+00011b90: 2077 6974 6820 6120 7370 6563 6966 6963   with a specific
+00011ba0: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
+00011bb0: 3a70 6172 616d 2065 6e74 6974 6965 733a  :param entities:
+00011bc0: 204d 6174 6368 2066 6561 7475 7265 2d73   Match feature-s
+00011bd0: 6574 7320 7768 6963 6820 636f 6e74 6169  ets which contai
+00011be0: 6e20 656e 7469 7469 6573 2077 686f 7365  n entities whose
+00011bf0: 206e 616d 6520 6973 2069 6e20 7468 6973   name is in this
+00011c00: 206c 6973 742e 0a20 2020 2020 2020 203a   list..        :
+00011c10: 7061 7261 6d20 6665 6174 7572 6573 3a20  param features: 
+00011c20: 4d61 7463 6820 6665 6174 7572 652d 7365  Match feature-se
+00011c30: 7473 2077 6869 6368 2063 6f6e 7461 696e  ts which contain
+00011c40: 2066 6561 7475 7265 7320 7768 6f73 6520   features whose 
+00011c50: 6e61 6d65 2069 7320 696e 2074 6869 7320  name is in this 
+00011c60: 6c69 7374 2e0a 2020 2020 2020 2020 3a70  list..        :p
+00011c70: 6172 616d 206c 6162 656c 733a 204d 6174  aram labels: Mat
+00011c80: 6368 2066 6561 7475 7265 2d73 6574 7320  ch feature-sets 
+00011c90: 7768 6963 6820 6861 7665 2074 6865 7365  which have these
+00011ca0: 206c 6162 656c 732e 0a20 2020 2020 2020   labels..       
+00011cb0: 203a 7061 7261 6d20 7061 7274 6974 696f   :param partitio
+00011cc0: 6e5f 6279 3a20 4669 656c 6420 746f 2067  n_by: Field to g
+00011cd0: 726f 7570 2072 6573 756c 7473 2062 792e  roup results by.
+00011ce0: 204f 6e6c 7920 616c 6c6f 7765 6420 7661   Only allowed va
+00011cf0: 6c75 6520 6973 2060 6e61 6d65 602e 2057  lue is `name`. W
+00011d00: 6865 6e20 6070 6172 7469 7469 6f6e 5f62  hen `partition_b
+00011d10: 7960 2069 7320 7370 6563 6966 6965 642c  y` is specified,
+00011d20: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00011d30: 2060 7061 7274 6974 696f 6e5f 736f 7274   `partition_sort
+00011d40: 5f62 7960 2070 6172 616d 6574 6572 206d  _by` parameter m
+00011d50: 7573 7420 6265 2070 726f 7669 6465 6420  ust be provided 
+00011d60: 6173 2077 656c 6c2e 0a20 2020 2020 2020  as well..       
+00011d70: 203a 7061 7261 6d20 726f 7773 5f70 6572   :param rows_per
+00011d80: 5f70 6172 7469 7469 6f6e 3a20 486f 7720  _partition: How 
+00011d90: 6d61 6e79 2074 6f70 2072 6f77 7320 2870  many top rows (p
+00011da0: 6572 2073 6f72 7469 6e67 2064 6566 696e  er sorting defin
+00011db0: 6564 2062 7920 6070 6172 7469 7469 6f6e  ed by `partition
+00011dc0: 5f73 6f72 745f 6279 6020 616e 6420 6070  _sort_by` and `p
+00011dd0: 6172 7469 7469 6f6e 5f6f 7264 6572 6029  artition_order`)
+00011de0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+00011df0: 7265 7475 726e 2070 6572 2067 726f 7570  return per group
+00011e00: 2e20 4465 6661 756c 7420 7661 6c75 6520  . Default value 
+00011e10: 6973 2031 2e0a 2020 2020 2020 2020 3a70  is 1..        :p
+00011e20: 6172 616d 2070 6172 7469 7469 6f6e 5f73  aram partition_s
+00011e30: 6f72 745f 6279 3a20 5768 6174 2066 6965  ort_by: What fie
+00011e40: 6c64 2074 6f20 736f 7274 2074 6865 2072  ld to sort the r
+00011e50: 6573 756c 7473 2062 792c 2077 6974 6869  esults by, withi
+00011e60: 6e20 6561 6368 2070 6172 7469 7469 6f6e  n each partition
+00011e70: 2064 6566 696e 6564 2062 7920 6070 6172   defined by `par
+00011e80: 7469 7469 6f6e 5f62 7960 2e0a 2020 2020  tition_by`..    
+00011e90: 2020 2020 2020 2020 4375 7272 656e 746c          Currentl
+00011ea0: 7920 7468 6520 6f6e 6c79 2061 6c6c 6f77  y the only allow
+00011eb0: 6564 2076 616c 7565 2061 7265 2060 6372  ed value are `cr
+00011ec0: 6561 7465 6460 2061 6e64 2060 7570 6461  eated` and `upda
+00011ed0: 7465 6460 2e0a 2020 2020 2020 2020 3a70  ted`..        :p
+00011ee0: 6172 616d 2070 6172 7469 7469 6f6e 5f6f  aram partition_o
+00011ef0: 7264 6572 3a20 4f72 6465 7220 6f66 2073  rder: Order of s
+00011f00: 6f72 7469 6e67 2077 6974 6869 6e20 7061  orting within pa
+00011f10: 7274 6974 696f 6e73 202d 2060 6173 6360  rtitions - `asc`
+00011f20: 206f 7220 6064 6573 6360 2e20 4465 6661   or `desc`. Defa
+00011f30: 756c 7420 6973 2060 6465 7363 602e 0a20  ult is `desc`.. 
+00011f40: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
+00011f50: 204c 6973 7420 6f66 206d 6174 6368 696e   List of matchin
+00011f60: 6720 3a70 793a 636c 6173 733a 607e 6d6c  g :py:class:`~ml
+00011f70: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
+00011f80: 652e 4665 6174 7572 6553 6574 6020 6f62  e.FeatureSet` ob
+00011f90: 6a65 6374 732e 0a20 2020 2020 2020 2022  jects..        "
+00011fa0: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
+00011fb0: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+00011fc0: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+00011fd0: 7072 6f6a 6563 740a 0a20 2020 2020 2020  project..       
+00011fe0: 2070 6172 616d 7320 3d20 7b0a 2020 2020   params = {.    
+00011ff0: 2020 2020 2020 2020 226e 616d 6522 3a20          "name": 
+00012000: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00012010: 2020 2273 7461 7465 223a 2073 7461 7465    "state": state
+00012020: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+00012030: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
+00012040: 2020 2020 2020 2265 6e74 6974 7922 3a20        "entity": 
+00012050: 656e 7469 7469 6573 206f 7220 5b5d 2c0a  entities or [],.
+00012060: 2020 2020 2020 2020 2020 2020 2266 6561              "fea
+00012070: 7475 7265 223a 2066 6561 7475 7265 7320  ture": features 
+00012080: 6f72 205b 5d2c 0a20 2020 2020 2020 2020  or [],.         
+00012090: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
+000120a0: 6c73 206f 7220 5b5d 2c0a 2020 2020 2020  ls or [],.      
+000120b0: 2020 7d0a 2020 2020 2020 2020 6966 2070    }.        if p
+000120c0: 6172 7469 7469 6f6e 5f62 793a 0a20 2020  artition_by:.   
+000120d0: 2020 2020 2020 2020 2070 6172 616d 732e           params.
+000120e0: 7570 6461 7465 280a 2020 2020 2020 2020  update(.        
+000120f0: 2020 2020 2020 2020 7365 6c66 2e5f 6765          self._ge
+00012100: 6e65 7261 7465 5f70 6172 7469 7469 6f6e  nerate_partition
+00012110: 5f62 795f 7061 7261 6d73 280a 2020 2020  _by_params(.    
+00012120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012130: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00012140: 656d 6173 2e46 6561 7475 7265 5374 6f72  emas.FeatureStor
+00012150: 6550 6172 7469 7469 6f6e 4279 4669 656c  ePartitionByFiel
+00012160: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00012170: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00012180: 5f62 792c 0a20 2020 2020 2020 2020 2020  _by,.           
+00012190: 2020 2020 2020 2020 2072 6f77 735f 7065           rows_pe
+000121a0: 725f 7061 7274 6974 696f 6e2c 0a20 2020  r_partition,.   
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121c0: 2070 6172 7469 7469 6f6e 5f73 6f72 745f   partition_sort_
+000121d0: 6279 2c0a 2020 2020 2020 2020 2020 2020  by,.            
+000121e0: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
+000121f0: 6e5f 6f72 6465 722c 0a20 2020 2020 2020  n_order,.       
+00012200: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00012210: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00012220: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+00012230: 6374 732f 7b70 726f 6a65 6374 7d2f 6665  cts/{project}/fe
+00012240: 6174 7572 652d 7365 7473 220a 0a20 2020  ature-sets"..   
+00012250: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00012260: 6765 203d 2028 0a20 2020 2020 2020 2020  ge = (.         
+00012270: 2020 2066 2246 6169 6c65 6420 6c69 7374     f"Failed list
+00012280: 696e 6720 6665 6174 7572 652d 7365 7473  ing feature-sets
+00012290: 2c20 7072 6f6a 6563 743a 207b 7072 6f6a  , project: {proj
+000122a0: 6563 747d 2c20 7175 6572 793a 207b 7061  ect}, query: {pa
+000122b0: 7261 6d73 7d22 0a20 2020 2020 2020 2029  rams}".        )
+000122c0: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+000122d0: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
+000122e0: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
+000122f0: 5f6d 6573 7361 6765 2c20 7061 7261 6d73  _message, params
+00012300: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+00012310: 2066 6561 7475 7265 5f73 6574 7320 3d20   feature_sets = 
+00012320: 7265 7370 2e6a 736f 6e28 295b 2266 6561  resp.json()["fea
+00012330: 7475 7265 5f73 6574 7322 5d0a 2020 2020  ture_sets"].    
+00012340: 2020 2020 6966 2066 6561 7475 7265 5f73      if feature_s
+00012350: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+00012360: 2072 6574 7572 6e20 5b46 6561 7475 7265   return [Feature
+00012370: 5365 742e 6672 6f6d 5f64 6963 7428 6f62  Set.from_dict(ob
+00012380: 6a29 2066 6f72 206f 626a 2069 6e20 6665  j) for obj in fe
+00012390: 6174 7572 655f 7365 7473 5d0a 0a20 2020  ature_sets]..   
+000123a0: 2064 6566 2073 746f 7265 5f66 6561 7475   def store_featu
+000123b0: 7265 5f73 6574 280a 2020 2020 2020 2020  re_set(.        
+000123c0: 7365 6c66 2c0a 2020 2020 2020 2020 6665  self,.        fe
+000123d0: 6174 7572 655f 7365 743a 2055 6e69 6f6e  ature_set: Union
+000123e0: 5b64 6963 742c 206d 6c72 756e 2e63 6f6d  [dict, mlrun.com
+000123f0: 6d6f 6e2e 7363 6865 6d61 732e 4665 6174  mon.schemas.Feat
+00012400: 7572 6553 6574 2c20 4665 6174 7572 6553  ureSet, FeatureS
+00012410: 6574 5d2c 0a20 2020 2020 2020 206e 616d  et],.        nam
+00012420: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00012430: 7072 6f6a 6563 743d 2222 2c0a 2020 2020  project="",.    
+00012440: 2020 2020 7461 673d 4e6f 6e65 2c0a 2020      tag=None,.  
+00012450: 2020 2020 2020 7569 643d 4e6f 6e65 2c0a        uid=None,.
+00012460: 2020 2020 2020 2020 7665 7273 696f 6e65          versione
+00012470: 643d 5472 7565 2c0a 2020 2020 2920 2d3e  d=True,.    ) ->
+00012480: 2064 6963 743a 0a20 2020 2020 2020 2022   dict:.        "
+00012490: 2222 5361 7665 2061 203a 7079 3a63 6c61  ""Save a :py:cla
+000124a0: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
+000124b0: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
+000124c0: 5365 7460 206f 626a 6563 7420 696e 2074  Set` object in t
+000124d0: 6865 203a 7079 3a6d 6f64 3a60 6d6c 7275  he :py:mod:`mlru
+000124e0: 6e60 2044 422e 2054 6865 0a20 2020 2020  n` DB. The.     
+000124f0: 2020 2066 6561 7475 7265 2d73 6574 2063     feature-set c
+00012500: 616e 2062 6520 6569 7468 6572 2061 206e  an be either a n
+00012510: 6577 206f 626a 6563 7420 6f72 2061 206d  ew object or a m
+00012520: 6f64 6966 6963 6174 696f 6e20 746f 2065  odification to e
+00012530: 7869 7374 696e 6720 6f62 6a65 6374 2072  xisting object r
+00012540: 6566 6572 656e 6365 6420 6279 2074 6865  eferenced by the
+00012550: 2070 6172 616d 7320 6f66 0a20 2020 2020   params of.     
+00012560: 2020 2074 6865 2066 756e 6374 696f 6e2e     the function.
+00012570: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00012580: 2066 6561 7475 7265 5f73 6574 3a20 5468   feature_set: Th
+00012590: 6520 3a70 793a 636c 6173 733a 607e 6d6c  e :py:class:`~ml
+000125a0: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
+000125b0: 652e 4665 6174 7572 6553 6574 6020 746f  e.FeatureSet` to
+000125c0: 2073 746f 7265 2e0a 2020 2020 2020 2020   store..        
+000125d0: 3a70 6172 616d 206e 616d 653a 2020 2020  :param name:    
+000125e0: 4e61 6d65 206f 6620 6665 6174 7572 6520  Name of feature 
+000125f0: 7365 742e 0a20 2020 2020 2020 203a 7061  set..        :pa
+00012600: 7261 6d20 7072 6f6a 6563 743a 204e 616d  ram project: Nam
+00012610: 6520 6f66 2070 726f 6a65 6374 2074 6869  e of project thi
+00012620: 7320 6665 6174 7572 652d 7365 7420 6265  s feature-set be
+00012630: 6c6f 6e67 7320 746f 2e0a 2020 2020 2020  longs to..      
+00012640: 2020 3a70 6172 616d 2074 6167 3a20 5468    :param tag: Th
+00012650: 6520 6060 7461 6760 6020 6f66 2074 6865  e ``tag`` of the
+00012660: 206f 626a 6563 7420 746f 2072 6570 6c61   object to repla
+00012670: 6365 2069 6e20 7468 6520 4442 2c20 666f  ce in the DB, fo
+00012680: 7220 6578 616d 706c 6520 6060 6c61 7465  r example ``late
+00012690: 7374 6060 2e0a 2020 2020 2020 2020 3a70  st``..        :p
+000126a0: 6172 616d 2075 6964 3a20 5468 6520 6060  aram uid: The ``
+000126b0: 7569 6460 6020 6f66 2074 6865 206f 626a  uid`` of the obj
+000126c0: 6563 7420 746f 2072 6570 6c61 6365 2069  ect to replace i
+000126d0: 6e20 7468 6520 4442 2e20 4966 2075 7369  n the DB. If usi
+000126e0: 6e67 2074 6869 7320 7061 7261 6d65 7465  ng this paramete
+000126f0: 722c 2074 6865 206d 6f64 6966 6965 6420  r, the modified 
+00012700: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
+00012710: 2020 206d 7573 7420 6861 7665 2074 6865     must have the
+00012720: 2073 616d 6520 6060 7569 6460 6020 6f66   same ``uid`` of
+00012730: 2074 6865 2070 7265 7669 6f75 736c 792d   the previously-
+00012740: 6578 6973 7469 6e67 206f 626a 6563 742e  existing object.
+00012750: 2054 6869 7320 6361 6e6e 6f74 2062 6520   This cannot be 
+00012760: 7573 6564 2066 6f72 206e 6f6e 2d76 6572  used for non-ver
+00012770: 7369 6f6e 6564 206f 626a 6563 7473 2e0a  sioned objects..
+00012780: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
+00012790: 6572 7369 6f6e 6564 3a20 5768 6574 6865  ersioned: Whethe
+000127a0: 7220 746f 206d 6169 6e74 6169 6e20 7665  r to maintain ve
+000127b0: 7273 696f 6e73 2066 6f72 2074 6869 7320  rsions for this 
+000127c0: 6665 6174 7572 652d 7365 742e 2041 6c6c  feature-set. All
+000127d0: 2076 6572 7369 6f6e 7320 6f66 2061 2076   versions of a v
+000127e0: 6572 7369 6f6e 6564 206f 626a 6563 740a  ersioned object.
+000127f0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00012800: 2062 6520 6b65 7074 2069 6e20 7468 6520   be kept in the 
+00012810: 4442 2061 6e64 2063 616e 2062 6520 7265  DB and can be re
+00012820: 7472 6965 7665 6420 756e 7469 6c20 6578  trieved until ex
+00012830: 706c 6963 6974 6c79 2064 656c 6574 6564  plicitly deleted
+00012840: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00012850: 6e73 3a20 5468 6520 3a70 793a 636c 6173  ns: The :py:clas
+00012860: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
+00012870: 655f 7374 6f72 652e 4665 6174 7572 6553  e_store.FeatureS
+00012880: 6574 6020 6f62 6a65 6374 2028 6173 2064  et` object (as d
+00012890: 6963 7429 2e0a 2020 2020 2020 2020 2222  ict)..        ""
+000128a0: 220a 0a20 2020 2020 2020 2072 6566 6572  "..        refer
+000128b0: 656e 6365 203d 2073 656c 662e 5f72 6573  ence = self._res
+000128c0: 6f6c 7665 5f72 6566 6572 656e 6365 2874  olve_reference(t
+000128d0: 6167 2c20 7569 6429 0a20 2020 2020 2020  ag, uid).       
+000128e0: 2070 6172 616d 7320 3d20 7b22 7665 7273   params = {"vers
+000128f0: 696f 6e65 6422 3a20 7665 7273 696f 6e65  ioned": versione
+00012900: 647d 0a0a 2020 2020 2020 2020 6966 2069  d}..        if i
+00012910: 7369 6e73 7461 6e63 6528 6665 6174 7572  sinstance(featur
+00012920: 655f 7365 742c 206d 6c72 756e 2e63 6f6d  e_set, mlrun.com
+00012930: 6d6f 6e2e 7363 6865 6d61 732e 4665 6174  mon.schemas.Feat
+00012940: 7572 6553 6574 293a 0a20 2020 2020 2020  ureSet):.       
+00012950: 2020 2020 2066 6561 7475 7265 5f73 6574       feature_set
+00012960: 203d 2066 6561 7475 7265 5f73 6574 2e64   = feature_set.d
+00012970: 6963 7428 290a 2020 2020 2020 2020 656c  ict().        el
+00012980: 6966 2069 7369 6e73 7461 6e63 6528 6665  if isinstance(fe
+00012990: 6174 7572 655f 7365 742c 2046 6561 7475  ature_set, Featu
+000129a0: 7265 5365 7429 3a0a 2020 2020 2020 2020  reSet):.        
+000129b0: 2020 2020 6665 6174 7572 655f 7365 7420      feature_set 
+000129c0: 3d20 6665 6174 7572 655f 7365 742e 746f  = feature_set.to
+000129d0: 5f64 6963 7428 290a 0a20 2020 2020 2020  _dict()..       
+000129e0: 206e 616d 6520 3d20 6e61 6d65 206f 7220   name = name or 
+000129f0: 6665 6174 7572 655f 7365 745b 226d 6574  feature_set["met
+00012a00: 6164 6174 6122 5d5b 226e 616d 6522 5d0a  adata"]["name"].
+00012a10: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
+00012a20: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00012a30: 7072 6f6a 6563 7420 6f72 2066 6561 7475  project or featu
+00012a40: 7265 5f73 6574 5b22 6d65 7461 6461 7461  re_set["metadata
+00012a50: 225d 2e67 6574 2822 7072 6f6a 6563 7422  "].get("project"
+00012a60: 2920 6f72 2063 6f6e 6669 672e 6465 6661  ) or config.defa
+00012a70: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+00012a80: 2020 2020 290a 2020 2020 2020 2020 7061      ).        pa
+00012a90: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+00012aa0: 7b70 726f 6a65 6374 7d2f 6665 6174 7572  {project}/featur
+00012ab0: 652d 7365 7473 2f7b 6e61 6d65 7d2f 7265  e-sets/{name}/re
+00012ac0: 6665 7265 6e63 6573 2f7b 7265 6665 7265  ferences/{refere
+00012ad0: 6e63 657d 220a 2020 2020 2020 2020 6572  nce}".        er
+00012ae0: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00012af0: 4661 696c 6564 2073 746f 7269 6e67 2066  Failed storing f
+00012b00: 6561 7475 7265 2d73 6574 207b 7072 6f6a  eature-set {proj
+00012b10: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
+00012b20: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
+00012b30: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+00012b40: 2020 2020 2020 2022 5055 5422 2c20 7061         "PUT", pa
+00012b50: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
+00012b60: 652c 2070 6172 616d 733d 7061 7261 6d73  e, params=params
+00012b70: 2c20 626f 6479 3d64 6963 745f 746f 5f6a  , body=dict_to_j
+00012b80: 736f 6e28 6665 6174 7572 655f 7365 7429  son(feature_set)
+00012b90: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00012ba0: 2020 2072 6574 7572 6e20 7265 7370 2e6a     return resp.j
+00012bb0: 736f 6e28 290a 0a20 2020 2064 6566 2070  son()..    def p
+00012bc0: 6174 6368 5f66 6561 7475 7265 5f73 6574  atch_feature_set
+00012bd0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00012be0: 2020 2020 2020 2020 6e61 6d65 2c0a 2020          name,.  
+00012bf0: 2020 2020 2020 6665 6174 7572 655f 7365        feature_se
+00012c00: 745f 7570 6461 7465 3a20 6469 6374 2c0a  t_update: dict,.
+00012c10: 2020 2020 2020 2020 7072 6f6a 6563 743d          project=
+00012c20: 2222 2c0a 2020 2020 2020 2020 7461 673d  "",.        tag=
+00012c30: 4e6f 6e65 2c0a 2020 2020 2020 2020 7569  None,.        ui
+00012c40: 643d 4e6f 6e65 2c0a 2020 2020 2020 2020  d=None,.        
+00012c50: 7061 7463 685f 6d6f 6465 3a20 556e 696f  patch_mode: Unio
+00012c60: 6e5b 0a20 2020 2020 2020 2020 2020 2073  n[.            s
+00012c70: 7472 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  tr, mlrun.common
+00012c80: 2e73 6368 656d 6173 2e50 6174 6368 4d6f  .schemas.PatchMo
+00012c90: 6465 0a20 2020 2020 2020 205d 203d 206d  de.        ] = m
+00012ca0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00012cb0: 6d61 732e 5061 7463 684d 6f64 652e 7265  mas.PatchMode.re
+00012cc0: 706c 6163 652c 0a20 2020 2029 3a0a 2020  place,.    ):.  
+00012cd0: 2020 2020 2020 2222 224d 6f64 6966 7920        """Modify 
+00012ce0: 2870 6174 6368 2920 616e 2065 7869 7374  (patch) an exist
+00012cf0: 696e 6720 3a70 793a 636c 6173 733a 607e  ing :py:class:`~
+00012d00: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
+00012d10: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
+00012d20: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
+00012d30: 5468 6520 6f62 6a65 6374 2069 7320 6964  The object is id
+00012d40: 656e 7469 6669 6564 2062 7920 6974 7320  entified by its 
+00012d50: 6e61 6d65 2028 616e 6420 7072 6f6a 6563  name (and projec
+00012d60: 7420 6974 2062 656c 6f6e 6773 2074 6f29  t it belongs to)
+00012d70: 2c20 6173 2077 656c 6c20 6173 206f 7074  , as well as opt
+00012d80: 696f 6e61 6c6c 7920 6120 6060 7461 6760  ionally a ``tag`
+00012d90: 6020 6f72 2069 7473 0a20 2020 2020 2020  ` or its.       
+00012da0: 2060 6075 6964 6060 2028 666f 7220 7665   ``uid`` (for ve
+00012db0: 7273 696f 6e65 6420 6f62 6a65 6374 292e  rsioned object).
+00012dc0: 2049 6620 626f 7468 2060 6074 6167 6060   If both ``tag``
+00012dd0: 2061 6e64 2060 6075 6964 6060 2061 7265   and ``uid`` are
+00012de0: 206f 6d69 7474 6564 2074 6865 6e20 7468   omitted then th
+00012df0: 6520 6f62 6a65 6374 2077 6974 6820 7461  e object with ta
+00012e00: 6720 6060 6c61 7465 7374 6060 0a20 2020  g ``latest``.   
+00012e10: 2020 2020 2069 7320 6d6f 6469 6669 6564       is modified
+00012e20: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00012e30: 6d20 6e61 6d65 3a20 4e61 6d65 206f 6620  m name: Name of 
+00012e40: 7468 6520 6f62 6a65 6374 2074 6f20 7061  the object to pa
+00012e50: 7463 682e 0a20 2020 2020 2020 203a 7061  tch..        :pa
+00012e60: 7261 6d20 6665 6174 7572 655f 7365 745f  ram feature_set_
+00012e70: 7570 6461 7465 3a20 5468 6520 6d6f 6469  update: The modi
+00012e80: 6669 6361 7469 6f6e 7320 6e65 6564 6564  fications needed
+00012e90: 2069 6e20 7468 6520 6f62 6a65 6374 2e20   in the object. 
+00012ea0: 5468 6973 2070 6172 616d 6574 6572 206f  This parameter o
+00012eb0: 6e6c 7920 6861 7320 7468 6520 6368 616e  nly has the chan
+00012ec0: 6765 7320 696e 2069 742c 0a20 2020 2020  ges in it,.     
+00012ed0: 2020 2020 2020 206e 6f74 2061 2066 756c         not a ful
+00012ee0: 6c20 6f62 6a65 6374 2e0a 2020 2020 2020  l object..      
+00012ef0: 2020 2020 2020 4578 616d 706c 653a 3a0a        Example::.
+00012f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f10: 2066 6561 7475 7265 5f73 6574 5f75 7064   feature_set_upd
+00012f20: 6174 6520 3d20 7b22 7374 6174 7573 223a  ate = {"status":
+00012f30: 207b 2270 726f 6365 7373 6564 2220 3a20   {"processed" : 
+00012f40: 5472 7565 7d7d 0a0a 2020 2020 2020 2020  True}}..        
+00012f50: 2020 2020 5769 6c6c 2061 7070 6c79 2074      Will apply t
+00012f60: 6865 2066 6965 6c64 2060 6073 7461 7475  he field ``statu
+00012f70: 732e 7072 6f63 6573 7365 6460 6020 746f  s.processed`` to
+00012f80: 2074 6865 2065 7869 7374 696e 6720 6f62   the existing ob
+00012f90: 6a65 6374 2e0a 2020 2020 2020 2020 3a70  ject..        :p
+00012fa0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+00012fb0: 6f6a 6563 7420 7768 6963 6820 636f 6e74  oject which cont
+00012fc0: 6169 6e73 2074 6865 206d 6f64 6966 6965  ains the modifie
+00012fd0: 6420 6f62 6a65 6374 2e0a 2020 2020 2020  d object..      
+00012fe0: 2020 3a70 6172 616d 2074 6167 3a20 5468    :param tag: Th
+00012ff0: 6520 7461 6720 6f66 2074 6865 206f 626a  e tag of the obj
+00013000: 6563 7420 746f 206d 6f64 6966 792e 0a20  ect to modify.. 
+00013010: 2020 2020 2020 203a 7061 7261 6d20 7569         :param ui
+00013020: 643a 2075 6964 206f 6620 7468 6520 6f62  d: uid of the ob
+00013030: 6a65 6374 2074 6f20 6d6f 6469 6679 2e0a  ject to modify..
+00013040: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00013050: 6174 6368 5f6d 6f64 653a 2054 6865 2073  atch_mode: The s
+00013060: 7472 6174 6567 7920 666f 7220 6d65 7267  trategy for merg
+00013070: 696e 6720 7468 6520 6368 616e 6765 7320  ing the changes 
+00013080: 7769 7468 2074 6865 2065 7869 7374 696e  with the existin
+00013090: 6720 6f62 6a65 6374 2e20 4361 6e20 6265  g object. Can be
+000130a0: 2065 6974 6865 7220 6060 7265 706c 6163   either ``replac
+000130b0: 6560 600a 2020 2020 2020 2020 2020 2020  e``.            
+000130c0: 6f72 2060 6061 6464 6974 6976 6560 602e  or ``additive``.
+000130d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000130e0: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
+000130f0: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
+00013100: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
+00013110: 0a20 2020 2020 2020 2072 6566 6572 656e  .        referen
+00013120: 6365 203d 2073 656c 662e 5f72 6573 6f6c  ce = self._resol
+00013130: 7665 5f72 6566 6572 656e 6365 2874 6167  ve_reference(tag
+00013140: 2c20 7569 6429 0a20 2020 2020 2020 2068  , uid).        h
+00013150: 6561 6465 7273 203d 207b 6d6c 7275 6e2e  eaders = {mlrun.
+00013160: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e48  common.schemas.H
+00013170: 6561 6465 724e 616d 6573 2e70 6174 6368  eaderNames.patch
+00013180: 5f6d 6f64 653a 2070 6174 6368 5f6d 6f64  _mode: patch_mod
+00013190: 657d 0a20 2020 2020 2020 2070 6174 6820  e}.        path 
+000131a0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+000131b0: 6f6a 6563 747d 2f66 6561 7475 7265 2d73  oject}/feature-s
+000131c0: 6574 732f 7b6e 616d 657d 2f72 6566 6572  ets/{name}/refer
+000131d0: 656e 6365 732f 7b72 6566 6572 656e 6365  ences/{reference
+000131e0: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
+000131f0: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
+00013200: 6c65 6420 7570 6461 7469 6e67 2066 6561  led updating fea
+00013210: 7475 7265 2d73 6574 207b 7072 6f6a 6563  ture-set {projec
+00013220: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
+00013230: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
+00013240: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
+00013250: 4154 4348 222c 0a20 2020 2020 2020 2020  ATCH",.         
+00013260: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
+00013270: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00013280: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
+00013290: 626f 6479 3d64 6963 745f 746f 5f6a 736f  body=dict_to_jso
+000132a0: 6e28 6665 6174 7572 655f 7365 745f 7570  n(feature_set_up
+000132b0: 6461 7465 292c 0a20 2020 2020 2020 2020  date),.         
+000132c0: 2020 2068 6561 6465 7273 3d68 6561 6465     headers=heade
+000132d0: 7273 2c0a 2020 2020 2020 2020 290a 0a20  rs,.        ).. 
+000132e0: 2020 2064 6566 2064 656c 6574 655f 6665     def delete_fe
+000132f0: 6174 7572 655f 7365 7428 7365 6c66 2c20  ature_set(self, 
+00013300: 6e61 6d65 2c20 7072 6f6a 6563 743d 2222  name, project=""
+00013310: 2c20 7461 673d 4e6f 6e65 2c20 7569 643d  , tag=None, uid=
+00013320: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00013330: 2222 4465 6c65 7465 2061 203a 7079 3a63  ""Delete a :py:c
+00013340: 6c61 7373 3a60 7e6d 6c72 756e 2e66 6561  lass:`~mlrun.fea
+00013350: 7475 7265 5f73 746f 7265 2e46 6561 7475  ture_store.Featu
+00013360: 7265 5365 7460 206f 626a 6563 7420 6672  reSet` object fr
+00013370: 6f6d 2074 6865 2044 422e 0a20 2020 2020  om the DB..     
+00013380: 2020 2049 6620 6060 7461 6760 6020 6f72     If ``tag`` or
+00013390: 2060 6075 6964 6060 2061 7265 2073 7065   ``uid`` are spe
+000133a0: 6369 6669 6564 2c20 7468 656e 206a 7573  cified, then jus
+000133b0: 7420 7468 6520 7665 7273 696f 6e20 7265  t the version re
+000133c0: 6665 7265 6e63 6564 2062 7920 7468 656d  ferenced by them
+000133d0: 2077 696c 6c20 6265 2064 656c 6574 6564   will be deleted
+000133e0: 2e20 5573 696e 6720 626f 7468 0a20 2020  . Using both.   
+000133f0: 2020 2020 2069 7320 6e6f 7420 616c 6c6f       is not allo
+00013400: 7765 642e 0a20 2020 2020 2020 2049 6620  wed..        If 
+00013410: 6e6f 6e65 2061 7265 2073 7065 6369 6669  none are specifi
+00013420: 6564 2c20 7468 656e 2061 6c6c 2069 6e73  ed, then all ins
+00013430: 7461 6e63 6573 206f 6620 7468 6520 6f62  tances of the ob
+00013440: 6a65 6374 2077 686f 7365 206e 616d 6520  ject whose name 
+00013450: 6973 2060 606e 616d 6560 6020 7769 6c6c  is ``name`` will
+00013460: 2062 6520 6465 6c65 7465 642e 0a20 2020   be deleted..   
+00013470: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013480: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+00013490: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+000134a0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+000134b0: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
+000134c0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+000134d0: 2f66 6561 7475 7265 2d73 6574 732f 7b6e  /feature-sets/{n
+000134e0: 616d 657d 220a 0a20 2020 2020 2020 2069  ame}"..        i
+000134f0: 6620 7461 6720 6f72 2075 6964 3a0a 2020  f tag or uid:.  
+00013500: 2020 2020 2020 2020 2020 7265 6665 7265            refere
+00013510: 6e63 6520 3d20 7365 6c66 2e5f 7265 736f  nce = self._reso
+00013520: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
+00013530: 672c 2075 6964 290a 2020 2020 2020 2020  g, uid).        
+00013540: 2020 2020 7061 7468 203d 2070 6174 6820      path = path 
+00013550: 2b20 6622 2f72 6566 6572 656e 6365 732f  + f"/references/
+00013560: 7b72 6566 6572 656e 6365 7d22 0a0a 2020  {reference}"..  
+00013570: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+00013580: 6167 6520 3d20 6622 4661 696c 6564 2064  age = f"Failed d
+00013590: 656c 6574 696e 6720 6665 6174 7572 652d  eleting feature-
+000135a0: 7365 7420 7b6e 616d 657d 220a 2020 2020  set {name}".    
+000135b0: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
+000135c0: 6c28 2244 454c 4554 4522 2c20 7061 7468  l("DELETE", path
+000135d0: 2c20 6572 726f 725f 6d65 7373 6167 6529  , error_message)
+000135e0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+000135f0: 5f66 6561 7475 7265 5f76 6563 746f 7228  _feature_vector(
+00013600: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00013610: 2020 2020 2020 2066 6561 7475 7265 5f76         feature_v
+00013620: 6563 746f 723a 2055 6e69 6f6e 5b64 6963  ector: Union[dic
+00013630: 742c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  t, mlrun.common.
+00013640: 7363 6865 6d61 732e 4665 6174 7572 6556  schemas.FeatureV
+00013650: 6563 746f 722c 2046 6561 7475 7265 5665  ector, FeatureVe
+00013660: 6374 6f72 5d2c 0a20 2020 2020 2020 2070  ctor],.        p
+00013670: 726f 6a65 6374 3d22 222c 0a20 2020 2020  roject="",.     
+00013680: 2020 2076 6572 7369 6f6e 6564 3d54 7275     versioned=Tru
+00013690: 652c 0a20 2020 2029 202d 3e20 6469 6374  e,.    ) -> dict
+000136a0: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
+000136b0: 6174 6520 6120 6e65 7720 3a70 793a 636c  ate a new :py:cl
+000136c0: 6173 733a 607e 6d6c 7275 6e2e 6665 6174  ass:`~mlrun.feat
+000136d0: 7572 655f 7374 6f72 652e 4665 6174 7572  ure_store.Featur
+000136e0: 6556 6563 746f 7260 2061 6e64 2073 6176  eVector` and sav
+000136f0: 6520 696e 2074 6865 203a 7079 3a6d 6f64  e in the :py:mod
+00013700: 3a60 6d6c 7275 6e60 2044 422e 0a0a 2020  :`mlrun` DB...  
+00013710: 2020 2020 2020 3a70 6172 616d 2066 6561        :param fea
+00013720: 7475 7265 5f76 6563 746f 723a 2054 6865  ture_vector: The
+00013730: 206e 6577 203a 7079 3a63 6c61 7373 3a60   new :py:class:`
+00013740: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
+00013750: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
+00013760: 6f72 6020 746f 2063 7265 6174 652e 0a20  or` to create.. 
+00013770: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+00013780: 6f6a 6563 743a 204e 616d 6520 6f66 2070  oject: Name of p
+00013790: 726f 6a65 6374 2074 6869 7320 6665 6174  roject this feat
+000137a0: 7572 652d 7665 6374 6f72 2062 656c 6f6e  ure-vector belon
+000137b0: 6773 2074 6f2e 0a20 2020 2020 2020 203a  gs to..        :
+000137c0: 7061 7261 6d20 7665 7273 696f 6e65 643a  param versioned:
+000137d0: 2057 6865 7468 6572 2074 6f20 6d61 696e   Whether to main
+000137e0: 7461 696e 2076 6572 7369 6f6e 7320 666f  tain versions fo
+000137f0: 7220 7468 6973 2066 6561 7475 7265 2d76  r this feature-v
+00013800: 6563 746f 722e 2041 6c6c 2076 6572 7369  ector. All versi
+00013810: 6f6e 7320 6f66 2061 2076 6572 7369 6f6e  ons of a version
+00013820: 6564 206f 626a 6563 740a 2020 2020 2020  ed object.      
+00013830: 2020 2020 2020 7769 6c6c 2062 6520 6b65        will be ke
+00013840: 7074 2069 6e20 7468 6520 4442 2061 6e64  pt in the DB and
+00013850: 2063 616e 2062 6520 7265 7472 6965 7665   can be retrieve
+00013860: 6420 756e 7469 6c20 6578 706c 6963 6974  d until explicit
+00013870: 6c79 2064 656c 6574 6564 2e0a 2020 2020  ly deleted..    
+00013880: 2020 2020 3a72 6574 7572 6e73 3a20 5468      :returns: Th
+00013890: 6520 3a70 793a 636c 6173 733a 607e 6d6c  e :py:class:`~ml
+000138a0: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
+000138b0: 652e 4665 6174 7572 6556 6563 746f 7260  e.FeatureVector`
+000138c0: 206f 626a 6563 7420 2861 7320 6469 6374   object (as dict
+000138d0: 292e 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
+000138e0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000138f0: 616e 6365 2866 6561 7475 7265 5f76 6563  ance(feature_vec
+00013900: 746f 722c 206d 6c72 756e 2e63 6f6d 6d6f  tor, mlrun.commo
+00013910: 6e2e 7363 6865 6d61 732e 4665 6174 7572  n.schemas.Featur
+00013920: 6556 6563 746f 7229 3a0a 2020 2020 2020  eVector):.      
+00013930: 2020 2020 2020 6665 6174 7572 655f 7665        feature_ve
+00013940: 6374 6f72 203d 2066 6561 7475 7265 5f76  ctor = feature_v
+00013950: 6563 746f 722e 6469 6374 2829 0a20 2020  ector.dict().   
+00013960: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00013970: 616e 6365 2866 6561 7475 7265 5f76 6563  ance(feature_vec
+00013980: 746f 722c 2046 6561 7475 7265 5665 6374  tor, FeatureVect
+00013990: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+000139a0: 2066 6561 7475 7265 5f76 6563 746f 7220   feature_vector 
+000139b0: 3d20 6665 6174 7572 655f 7665 6374 6f72  = feature_vector
+000139c0: 2e74 6f5f 6469 6374 2829 0a0a 2020 2020  .to_dict()..    
+000139d0: 2020 2020 7072 6f6a 6563 7420 3d20 280a      project = (.
+000139e0: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
+000139f0: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+00013a00: 6f72 2066 6561 7475 7265 5f76 6563 746f  or feature_vecto
+00013a10: 725b 226d 6574 6164 6174 6122 5d2e 6765  r["metadata"].ge
+00013a20: 7428 2270 726f 6a65 6374 222c 204e 6f6e  t("project", Non
+00013a30: 6529 0a20 2020 2020 2020 2020 2020 206f  e).            o
+00013a40: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
+00013a50: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
+00013a60: 2029 0a20 2020 2020 2020 2070 6174 6820   ).        path 
+00013a70: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+00013a80: 6f6a 6563 747d 2f66 6561 7475 7265 2d76  oject}/feature-v
+00013a90: 6563 746f 7273 220a 2020 2020 2020 2020  ectors".        
+00013aa0: 7061 7261 6d73 203d 207b 2276 6572 7369  params = {"versi
+00013ab0: 6f6e 6564 223a 2076 6572 7369 6f6e 6564  oned": versioned
+00013ac0: 7d0a 0a20 2020 2020 2020 206e 616d 6520  }..        name 
+00013ad0: 3d20 6665 6174 7572 655f 7665 6374 6f72  = feature_vector
+00013ae0: 5b22 6d65 7461 6461 7461 225d 5b22 6e61  ["metadata"]["na
+00013af0: 6d65 225d 0a20 2020 2020 2020 2065 7272  me"].        err
+00013b00: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
+00013b10: 6169 6c65 6420 6372 6561 7469 6e67 2066  ailed creating f
+00013b20: 6561 7475 7265 2d76 6563 746f 7220 7b70  eature-vector {p
+00013b30: 726f 6a65 6374 7d2f 7b6e 616d 657d 220a  roject}/{name}".
+00013b40: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+00013b50: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
+00013b60: 2020 2020 2020 2020 2020 2250 4f53 5422            "POST"
+00013b70: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00013b80: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00013b90: 6572 726f 725f 6d65 7373 6167 652c 0a20  error_message,. 
+00013ba0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00013bb0: 733d 7061 7261 6d73 2c0a 2020 2020 2020  s=params,.      
+00013bc0: 2020 2020 2020 626f 6479 3d64 6963 745f        body=dict_
+00013bd0: 746f 5f6a 736f 6e28 6665 6174 7572 655f  to_json(feature_
+00013be0: 7665 6374 6f72 292c 0a20 2020 2020 2020  vector),.       
+00013bf0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00013c00: 6e20 7265 7370 2e6a 736f 6e28 290a 0a20  n resp.json().. 
+00013c10: 2020 2064 6566 2067 6574 5f66 6561 7475     def get_featu
+00013c20: 7265 5f76 6563 746f 7228 0a20 2020 2020  re_vector(.     
+00013c30: 2020 2073 656c 662c 206e 616d 653a 2073     self, name: s
+00013c40: 7472 2c20 7072 6f6a 6563 743a 2073 7472  tr, project: str
+00013c50: 203d 2022 222c 2074 6167 3a20 7374 7220   = "", tag: str 
+00013c60: 3d20 4e6f 6e65 2c20 7569 643a 2073 7472  = None, uid: str
+00013c70: 203d 204e 6f6e 650a 2020 2020 2920 2d3e   = None.    ) ->
+00013c80: 2046 6561 7475 7265 5665 6374 6f72 3a0a   FeatureVector:.
+00013c90: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00013ca0: 6e20 6120 7370 6563 6966 6963 2066 6561  n a specific fea
+00013cb0: 7475 7265 2d76 6563 746f 7220 7265 6665  ture-vector refe
+00013cc0: 7265 6e63 6564 2062 7920 6974 7320 7461  renced by its ta
+00013cd0: 6720 6f72 2075 6964 2e20 4966 206e 6f6e  g or uid. If non
+00013ce0: 6520 6172 6520 7072 6f76 6964 6564 2c20  e are provided, 
+00013cf0: 6060 6c61 7465 7374 6060 2074 6167 2077  ``latest`` tag w
+00013d00: 696c 6c0a 2020 2020 2020 2020 6265 2075  ill.        be u
+00013d10: 7365 642e 2222 220a 0a20 2020 2020 2020  sed."""..       
+00013d20: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+00013d30: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+00013d40: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+00013d50: 2020 2020 2072 6566 6572 656e 6365 203d       reference =
+00013d60: 2073 656c 662e 5f72 6573 6f6c 7665 5f72   self._resolve_r
+00013d70: 6566 6572 656e 6365 2874 6167 2c20 7569  eference(tag, ui
+00013d80: 6429 0a20 2020 2020 2020 2070 6174 6820  d).        path 
+00013d90: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+00013da0: 6f6a 6563 747d 2f66 6561 7475 7265 2d76  oject}/feature-v
+00013db0: 6563 746f 7273 2f7b 6e61 6d65 7d2f 7265  ectors/{name}/re
+00013dc0: 6665 7265 6e63 6573 2f7b 7265 6665 7265  ferences/{refere
+00013dd0: 6e63 657d 220a 2020 2020 2020 2020 6572  nce}".        er
+00013de0: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00013df0: 4661 696c 6564 2072 6574 7269 6576 696e  Failed retrievin
+00013e00: 6720 6665 6174 7572 652d 7665 6374 6f72  g feature-vector
+00013e10: 207b 7072 6f6a 6563 747d 2f7b 6e61 6d65   {project}/{name
+00013e20: 7d22 0a20 2020 2020 2020 2072 6573 7020  }".        resp 
+00013e30: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+00013e40: 2247 4554 222c 2070 6174 682c 2065 7272  "GET", path, err
+00013e50: 6f72 5f6d 6573 7361 6765 290a 2020 2020  or_message).    
+00013e60: 2020 2020 7265 7475 726e 2046 6561 7475      return Featu
+00013e70: 7265 5665 6374 6f72 2e66 726f 6d5f 6469  reVector.from_di
+00013e80: 6374 2872 6573 702e 6a73 6f6e 2829 290a  ct(resp.json()).
+00013e90: 0a20 2020 2064 6566 206c 6973 745f 6665  .    def list_fe
+00013ea0: 6174 7572 655f 7665 6374 6f72 7328 0a20  ature_vectors(. 
+00013eb0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00013ec0: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
+00013ed0: 7220 3d20 2222 2c0a 2020 2020 2020 2020  r = "",.        
+00013ee0: 6e61 6d65 3a20 7374 7220 3d20 4e6f 6e65  name: str = None
+00013ef0: 2c0a 2020 2020 2020 2020 7461 673a 2073  ,.        tag: s
+00013f00: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+00013f10: 2020 2073 7461 7465 3a20 7374 7220 3d20     state: str = 
+00013f20: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
+00013f30: 6265 6c73 3a20 4c69 7374 5b73 7472 5d20  bels: List[str] 
+00013f40: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00013f50: 7061 7274 6974 696f 6e5f 6279 3a20 556e  partition_by: Un
+00013f60: 696f 6e5b 0a20 2020 2020 2020 2020 2020  ion[.           
+00013f70: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00013f80: 6865 6d61 732e 4665 6174 7572 6553 746f  hemas.FeatureSto
+00013f90: 7265 5061 7274 6974 696f 6e42 7946 6965  rePartitionByFie
+00013fa0: 6c64 2c20 7374 720a 2020 2020 2020 2020  ld, str.        
+00013fb0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00013fc0: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
+00013fd0: 7469 6f6e 3a20 696e 7420 3d20 312c 0a20  tion: int = 1,. 
+00013fe0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00013ff0: 5f73 6f72 745f 6279 3a20 556e 696f 6e5b  _sort_by: Union[
+00014000: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00014010: 656d 6173 2e53 6f72 7446 6965 6c64 2c20  emas.SortField, 
+00014020: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00014030: 2020 2020 2070 6172 7469 7469 6f6e 5f6f       partition_o
+00014040: 7264 6572 3a20 556e 696f 6e5b 0a20 2020  rder: Union[.   
+00014050: 2020 2020 2020 2020 206d 6c72 756e 2e63           mlrun.c
+00014060: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4f72  ommon.schemas.Or
+00014070: 6465 7254 7970 652c 2073 7472 0a20 2020  derType, str.   
+00014080: 2020 2020 205d 203d 206d 6c72 756e 2e63       ] = mlrun.c
+00014090: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4f72  ommon.schemas.Or
+000140a0: 6465 7254 7970 652e 6465 7363 2c0a 2020  derType.desc,.  
+000140b0: 2020 2920 2d3e 204c 6973 745b 4665 6174    ) -> List[Feat
+000140c0: 7572 6556 6563 746f 725d 3a0a 2020 2020  ureVector]:.    
+000140d0: 2020 2020 2222 2252 6574 7269 6576 6520      """Retrieve 
+000140e0: 6120 6c69 7374 206f 6620 6665 6174 7572  a list of featur
+000140f0: 652d 7665 6374 6f72 7320 6d61 7463 6869  e-vectors matchi
+00014100: 6e67 2074 6865 2063 7269 7465 7269 6120  ng the criteria 
+00014110: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
+00014120: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00014130: 743a 2050 726f 6a65 6374 206e 616d 652e  t: Project name.
+00014140: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00014150: 6e61 6d65 3a20 4e61 6d65 206f 6620 6665  name: Name of fe
+00014160: 6174 7572 652d 7665 6374 6f72 2074 6f20  ature-vector to 
+00014170: 6d61 7463 682e 2054 6869 7320 6973 2061  match. This is a
+00014180: 206c 696b 6520 7175 6572 792c 2061 6e64   like query, and
+00014190: 2069 7320 6361 7365 2d69 6e73 656e 7369   is case-insensi
+000141a0: 7469 7665 2e0a 2020 2020 2020 2020 3a70  tive..        :p
+000141b0: 6172 616d 2074 6167 3a20 4d61 7463 6820  aram tag: Match 
+000141c0: 6665 6174 7572 652d 7665 6374 6f72 7320  feature-vectors 
+000141d0: 7769 7468 2073 7065 6369 6669 6320 7461  with specific ta
+000141e0: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
+000141f0: 6d20 7374 6174 653a 204d 6174 6368 2066  m state: Match f
+00014200: 6561 7475 7265 2d76 6563 746f 7273 2077  eature-vectors w
+00014210: 6974 6820 6120 7370 6563 6966 6963 2073  ith a specific s
+00014220: 7461 7465 2e0a 2020 2020 2020 2020 3a70  tate..        :p
+00014230: 6172 616d 206c 6162 656c 733a 204d 6174  aram labels: Mat
+00014240: 6368 2066 6561 7475 7265 2d76 6563 746f  ch feature-vecto
+00014250: 7273 2077 6869 6368 2068 6176 6520 7468  rs which have th
+00014260: 6573 6520 6c61 6265 6c73 2e0a 2020 2020  ese labels..    
+00014270: 2020 2020 3a70 6172 616d 2070 6172 7469      :param parti
+00014280: 7469 6f6e 5f62 793a 2046 6965 6c64 2074  tion_by: Field t
+00014290: 6f20 6772 6f75 7020 7265 7375 6c74 7320  o group results 
+000142a0: 6279 2e20 4f6e 6c79 2061 6c6c 6f77 6564  by. Only allowed
+000142b0: 2076 616c 7565 2069 7320 606e 616d 6560   value is `name`
+000142c0: 2e20 5768 656e 2060 7061 7274 6974 696f  . When `partitio
+000142d0: 6e5f 6279 6020 6973 2073 7065 6369 6669  n_by` is specifi
+000142e0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+000142f0: 7468 6520 6070 6172 7469 7469 6f6e 5f73  the `partition_s
+00014300: 6f72 745f 6279 6020 7061 7261 6d65 7465  ort_by` paramete
+00014310: 7220 6d75 7374 2062 6520 7072 6f76 6964  r must be provid
+00014320: 6564 2061 7320 7765 6c6c 2e0a 2020 2020  ed as well..    
+00014330: 2020 2020 3a70 6172 616d 2072 6f77 735f      :param rows_
+00014340: 7065 725f 7061 7274 6974 696f 6e3a 2048  per_partition: H
+00014350: 6f77 206d 616e 7920 746f 7020 726f 7773  ow many top rows
+00014360: 2028 7065 7220 736f 7274 696e 6720 6465   (per sorting de
+00014370: 6669 6e65 6420 6279 2060 7061 7274 6974  fined by `partit
+00014380: 696f 6e5f 736f 7274 5f62 7960 2061 6e64  ion_sort_by` and
+00014390: 2060 7061 7274 6974 696f 6e5f 6f72 6465   `partition_orde
+000143a0: 7260 290a 2020 2020 2020 2020 2020 2020  r`).            
+000143b0: 746f 2072 6574 7572 6e20 7065 7220 6772  to return per gr
+000143c0: 6f75 702e 2044 6566 6175 6c74 2076 616c  oup. Default val
+000143d0: 7565 2069 7320 312e 0a20 2020 2020 2020  ue is 1..       
+000143e0: 203a 7061 7261 6d20 7061 7274 6974 696f   :param partitio
+000143f0: 6e5f 736f 7274 5f62 793a 2057 6861 7420  n_sort_by: What 
+00014400: 6669 656c 6420 746f 2073 6f72 7420 7468  field to sort th
+00014410: 6520 7265 7375 6c74 7320 6279 2c20 7769  e results by, wi
+00014420: 7468 696e 2065 6163 6820 7061 7274 6974  thin each partit
+00014430: 696f 6e20 6465 6669 6e65 6420 6279 2060  ion defined by `
+00014440: 7061 7274 6974 696f 6e5f 6279 602e 0a20  partition_by`.. 
+00014450: 2020 2020 2020 2020 2020 2043 7572 7265             Curre
+00014460: 6e74 6c79 2074 6865 206f 6e6c 7920 616c  ntly the only al
+00014470: 6c6f 7765 6420 7661 6c75 6573 2061 7265  lowed values are
+00014480: 2060 6372 6561 7465 6460 2061 6e64 2060   `created` and `
+00014490: 7570 6461 7465 6460 2e0a 2020 2020 2020  updated`..      
+000144a0: 2020 3a70 6172 616d 2070 6172 7469 7469    :param partiti
+000144b0: 6f6e 5f6f 7264 6572 3a20 4f72 6465 7220  on_order: Order 
+000144c0: 6f66 2073 6f72 7469 6e67 2077 6974 6869  of sorting withi
+000144d0: 6e20 7061 7274 6974 696f 6e73 202d 2060  n partitions - `
+000144e0: 6173 6360 206f 7220 6064 6573 6360 2e20  asc` or `desc`. 
+000144f0: 4465 6661 756c 7420 6973 2060 6465 7363  Default is `desc
+00014500: 602e 0a20 2020 2020 2020 203a 7265 7475  `..        :retu
+00014510: 726e 733a 204c 6973 7420 6f66 206d 6174  rns: List of mat
+00014520: 6368 696e 6720 3a70 793a 636c 6173 733a  ching :py:class:
+00014530: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
+00014540: 7374 6f72 652e 4665 6174 7572 6556 6563  store.FeatureVec
+00014550: 746f 7260 206f 626a 6563 7473 2e0a 2020  tor` objects..  
+00014560: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00014570: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+00014580: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
+00014590: 6566 6175 6c74 5f70 726f 6a65 6374 0a0a  efault_project..
+000145a0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+000145b0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+000145c0: 6e61 6d65 223a 206e 616d 652c 0a20 2020  name": name,.   
+000145d0: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
+000145e0: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+000145f0: 2020 2020 2022 7461 6722 3a20 7461 672c       "tag": tag,
+00014600: 0a20 2020 2020 2020 2020 2020 2022 6c61  .            "la
+00014610: 6265 6c22 3a20 6c61 6265 6c73 206f 7220  bel": labels or 
+00014620: 5b5d 2c0a 2020 2020 2020 2020 7d0a 2020  [],.        }.  
+00014630: 2020 2020 2020 6966 2070 6172 7469 7469        if partiti
+00014640: 6f6e 5f62 793a 0a20 2020 2020 2020 2020  on_by:.         
+00014650: 2020 2070 6172 616d 732e 7570 6461 7465     params.update
+00014660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00014670: 2020 7365 6c66 2e5f 6765 6e65 7261 7465    self._generate
+00014680: 5f70 6172 7469 7469 6f6e 5f62 795f 7061  _partition_by_pa
+00014690: 7261 6d73 280a 2020 2020 2020 2020 2020  rams(.          
+000146a0: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
+000146b0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e46  common.schemas.F
+000146c0: 6561 7475 7265 5374 6f72 6550 6172 7469  eatureStoreParti
+000146d0: 7469 6f6e 4279 4669 656c 642c 0a20 2020  tionByField,.   
+000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146f0: 2070 6172 7469 7469 6f6e 5f62 792c 0a20   partition_by,. 
+00014700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014710: 2020 2072 6f77 735f 7065 725f 7061 7274     rows_per_part
+00014720: 6974 696f 6e2c 0a20 2020 2020 2020 2020  ition,.         
+00014730: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+00014740: 7469 6f6e 5f73 6f72 745f 6279 2c0a 2020  tion_sort_by,.  
+00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014760: 2020 7061 7274 6974 696f 6e5f 6f72 6465    partition_orde
+00014770: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00014780: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00014790: 2029 0a0a 2020 2020 2020 2020 7061 7468   )..        path
+000147a0: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
+000147b0: 726f 6a65 6374 7d2f 6665 6174 7572 652d  roject}/feature-
+000147c0: 7665 6374 6f72 7322 0a0a 2020 2020 2020  vectors"..      
+000147d0: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
+000147e0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+000147f0: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
+00014800: 2066 6561 7475 7265 2d76 6563 746f 7273   feature-vectors
+00014810: 2c20 7072 6f6a 6563 743a 207b 7072 6f6a  , project: {proj
+00014820: 6563 747d 2c20 7175 6572 793a 207b 7061  ect}, query: {pa
+00014830: 7261 6d73 7d22 0a20 2020 2020 2020 2029  rams}".        )
+00014840: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+00014850: 7365 6c66 2e61 7069 5f63 616c 6c28 2247  self.api_call("G
+00014860: 4554 222c 2070 6174 682c 2065 7272 6f72  ET", path, error
+00014870: 5f6d 6573 7361 6765 2c20 7061 7261 6d73  _message, params
+00014880: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+00014890: 2066 6561 7475 7265 5f76 6563 746f 7273   feature_vectors
+000148a0: 203d 2072 6573 702e 6a73 6f6e 2829 5b22   = resp.json()["
+000148b0: 6665 6174 7572 655f 7665 6374 6f72 7322  feature_vectors"
+000148c0: 5d0a 2020 2020 2020 2020 6966 2066 6561  ].        if fea
+000148d0: 7475 7265 5f76 6563 746f 7273 3a0a 2020  ture_vectors:.  
+000148e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000148f0: 205b 4665 6174 7572 6556 6563 746f 722e   [FeatureVector.
+00014900: 6672 6f6d 5f64 6963 7428 6f62 6a29 2066  from_dict(obj) f
+00014910: 6f72 206f 626a 2069 6e20 6665 6174 7572  or obj in featur
+00014920: 655f 7665 6374 6f72 735d 0a0a 2020 2020  e_vectors]..    
+00014930: 6465 6620 7374 6f72 655f 6665 6174 7572  def store_featur
+00014940: 655f 7665 6374 6f72 280a 2020 2020 2020  e_vector(.      
+00014950: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00014960: 6665 6174 7572 655f 7665 6374 6f72 3a20  feature_vector: 
+00014970: 556e 696f 6e5b 6469 6374 2c20 6d6c 7275  Union[dict, mlru
+00014980: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00014990: 2e46 6561 7475 7265 5665 6374 6f72 2c20  .FeatureVector, 
+000149a0: 4665 6174 7572 6556 6563 746f 725d 2c0a  FeatureVector],.
+000149b0: 2020 2020 2020 2020 6e61 6d65 3d4e 6f6e          name=Non
+000149c0: 652c 0a20 2020 2020 2020 2070 726f 6a65  e,.        proje
+000149d0: 6374 3d22 222c 0a20 2020 2020 2020 2074  ct="",.        t
+000149e0: 6167 3d4e 6f6e 652c 0a20 2020 2020 2020  ag=None,.       
+000149f0: 2075 6964 3d4e 6f6e 652c 0a20 2020 2020   uid=None,.     
+00014a00: 2020 2076 6572 7369 6f6e 6564 3d54 7275     versioned=Tru
+00014a10: 652c 0a20 2020 2029 202d 3e20 6469 6374  e,.    ) -> dict
+00014a20: 3a0a 2020 2020 2020 2020 2222 2253 746f  :.        """Sto
+00014a30: 7265 2061 203a 7079 3a63 6c61 7373 3a60  re a :py:class:`
+00014a40: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
+00014a50: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
+00014a60: 6f72 6020 6f62 6a65 6374 2069 6e20 7468  or` object in th
+00014a70: 6520 3a70 793a 6d6f 643a 606d 6c72 756e  e :py:mod:`mlrun
+00014a80: 6020 4442 2e20 5468 650a 2020 2020 2020  ` DB. The.      
+00014a90: 2020 6665 6174 7572 652d 7665 6374 6f72    feature-vector
+00014aa0: 2063 616e 2062 6520 6569 7468 6572 2061   can be either a
+00014ab0: 206e 6577 206f 626a 6563 7420 6f72 2061   new object or a
+00014ac0: 206d 6f64 6966 6963 6174 696f 6e20 746f   modification to
+00014ad0: 2065 7869 7374 696e 6720 6f62 6a65 6374   existing object
+00014ae0: 2072 6566 6572 656e 6365 6420 6279 2074   referenced by t
+00014af0: 6865 2070 6172 616d 730a 2020 2020 2020  he params.      
+00014b00: 2020 6f66 2074 6865 2066 756e 6374 696f    of the functio
+00014b10: 6e2e 0a0a 2020 2020 2020 2020 3a70 6172  n...        :par
+00014b20: 616d 2066 6561 7475 7265 5f76 6563 746f  am feature_vecto
+00014b30: 723a 2054 6865 203a 7079 3a63 6c61 7373  r: The :py:class
+00014b40: 3a60 7e6d 6c72 756e 2e66 6561 7475 7265  :`~mlrun.feature
+00014b50: 5f73 746f 7265 2e46 6561 7475 7265 5665  _store.FeatureVe
+00014b60: 6374 6f72 6020 746f 2073 746f 7265 2e0a  ctor` to store..
+00014b70: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+00014b80: 616d 653a 2020 2020 4e61 6d65 206f 6620  ame:    Name of 
+00014b90: 6665 6174 7572 6520 7665 6374 6f72 2e0a  feature vector..
+00014ba0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00014bb0: 726f 6a65 6374 3a20 4e61 6d65 206f 6620  roject: Name of 
+00014bc0: 7072 6f6a 6563 7420 7468 6973 2066 6561  project this fea
+00014bd0: 7475 7265 2d76 6563 746f 7220 6265 6c6f  ture-vector belo
+00014be0: 6e67 7320 746f 2e0a 2020 2020 2020 2020  ngs to..        
+00014bf0: 3a70 6172 616d 2074 6167 3a20 5468 6520  :param tag: The 
+00014c00: 6060 7461 6760 6020 6f66 2074 6865 206f  ``tag`` of the o
+00014c10: 626a 6563 7420 746f 2072 6570 6c61 6365  bject to replace
+00014c20: 2069 6e20 7468 6520 4442 2c20 666f 7220   in the DB, for 
+00014c30: 6578 616d 706c 6520 6060 6c61 7465 7374  example ``latest
+00014c40: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
+00014c50: 616d 2075 6964 3a20 5468 6520 6060 7569  am uid: The ``ui
+00014c60: 6460 6020 6f66 2074 6865 206f 626a 6563  d`` of the objec
+00014c70: 7420 746f 2072 6570 6c61 6365 2069 6e20  t to replace in 
+00014c80: 7468 6520 4442 2e20 4966 2075 7369 6e67  the DB. If using
+00014c90: 2074 6869 7320 7061 7261 6d65 7465 722c   this parameter,
+00014ca0: 2074 6865 206d 6f64 6966 6965 6420 6f62   the modified ob
+00014cb0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+00014cc0: 206d 7573 7420 6861 7665 2074 6865 2073   must have the s
+00014cd0: 616d 6520 6060 7569 6460 6020 6f66 2074  ame ``uid`` of t
+00014ce0: 6865 2070 7265 7669 6f75 736c 792d 6578  he previously-ex
+00014cf0: 6973 7469 6e67 206f 626a 6563 742e 2054  isting object. T
+00014d00: 6869 7320 6361 6e6e 6f74 2062 6520 7573  his cannot be us
+00014d10: 6564 2066 6f72 206e 6f6e 2d76 6572 7369  ed for non-versi
+00014d20: 6f6e 6564 206f 626a 6563 7473 2e0a 2020  oned objects..  
+00014d30: 2020 2020 2020 3a70 6172 616d 2076 6572        :param ver
+00014d40: 7369 6f6e 6564 3a20 5768 6574 6865 7220  sioned: Whether 
+00014d50: 746f 206d 6169 6e74 6169 6e20 7665 7273  to maintain vers
+00014d60: 696f 6e73 2066 6f72 2074 6869 7320 6665  ions for this fe
+00014d70: 6174 7572 652d 7665 6374 6f72 2e20 416c  ature-vector. Al
+00014d80: 6c20 7665 7273 696f 6e73 206f 6620 6120  l versions of a 
+00014d90: 7665 7273 696f 6e65 6420 6f62 6a65 6374  versioned object
+00014da0: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00014db0: 6c20 6265 206b 6570 7420 696e 2074 6865  l be kept in the
+00014dc0: 2044 4220 616e 6420 6361 6e20 6265 2072   DB and can be r
+00014dd0: 6574 7269 6576 6564 2075 6e74 696c 2065  etrieved until e
+00014de0: 7870 6c69 6369 746c 7920 6465 6c65 7465  xplicitly delete
+00014df0: 642e 0a20 2020 2020 2020 203a 7265 7475  d..        :retu
+00014e00: 726e 733a 2054 6865 203a 7079 3a63 6c61  rns: The :py:cla
+00014e10: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
+00014e20: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
+00014e30: 5665 6374 6f72 6020 6f62 6a65 6374 2028  Vector` object (
+00014e40: 6173 2064 6963 7429 2e0a 2020 2020 2020  as dict)..      
+00014e50: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
+00014e60: 6566 6572 656e 6365 203d 2073 656c 662e  eference = self.
+00014e70: 5f72 6573 6f6c 7665 5f72 6566 6572 656e  _resolve_referen
+00014e80: 6365 2874 6167 2c20 7569 6429 0a20 2020  ce(tag, uid).   
+00014e90: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
+00014ea0: 7665 7273 696f 6e65 6422 3a20 7665 7273  versioned": vers
+00014eb0: 696f 6e65 647d 0a0a 2020 2020 2020 2020  ioned}..        
+00014ec0: 6966 2069 7369 6e73 7461 6e63 6528 6665  if isinstance(fe
+00014ed0: 6174 7572 655f 7665 6374 6f72 2c20 6d6c  ature_vector, ml
+00014ee0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00014ef0: 6173 2e46 6561 7475 7265 5665 6374 6f72  as.FeatureVector
+00014f00: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00014f10: 6561 7475 7265 5f76 6563 746f 7220 3d20  eature_vector = 
+00014f20: 6665 6174 7572 655f 7665 6374 6f72 2e64  feature_vector.d
+00014f30: 6963 7428 290a 2020 2020 2020 2020 656c  ict().        el
+00014f40: 6966 2069 7369 6e73 7461 6e63 6528 6665  if isinstance(fe
+00014f50: 6174 7572 655f 7665 6374 6f72 2c20 4665  ature_vector, Fe
+00014f60: 6174 7572 6556 6563 746f 7229 3a0a 2020  atureVector):.  
+00014f70: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+00014f80: 655f 7665 6374 6f72 203d 2066 6561 7475  e_vector = featu
+00014f90: 7265 5f76 6563 746f 722e 746f 5f64 6963  re_vector.to_dic
+00014fa0: 7428 290a 0a20 2020 2020 2020 206e 616d  t()..        nam
+00014fb0: 6520 3d20 6e61 6d65 206f 7220 6665 6174  e = name or feat
+00014fc0: 7572 655f 7665 6374 6f72 5b22 6d65 7461  ure_vector["meta
+00014fd0: 6461 7461 225d 5b22 6e61 6d65 225d 0a20  data"]["name"]. 
+00014fe0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00014ff0: 2028 0a20 2020 2020 2020 2020 2020 2070   (.            p
+00015000: 726f 6a65 6374 0a20 2020 2020 2020 2020  roject.         
+00015010: 2020 206f 7220 6665 6174 7572 655f 7665     or feature_ve
+00015020: 6374 6f72 5b22 6d65 7461 6461 7461 225d  ctor["metadata"]
+00015030: 2e67 6574 2822 7072 6f6a 6563 7422 290a  .get("project").
+00015040: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
+00015050: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
+00015060: 6f6a 6563 740a 2020 2020 2020 2020 290a  oject.        ).
+00015070: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+00015080: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+00015090: 6374 7d2f 6665 6174 7572 652d 7665 6374  ct}/feature-vect
+000150a0: 6f72 732f 7b6e 616d 657d 2f72 6566 6572  ors/{name}/refer
+000150b0: 656e 6365 732f 7b72 6566 6572 656e 6365  ences/{reference
+000150c0: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
+000150d0: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
+000150e0: 6c65 6420 7374 6f72 696e 6720 6665 6174  led storing feat
+000150f0: 7572 652d 7665 6374 6f72 207b 7072 6f6a  ure-vector {proj
+00015100: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
+00015110: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
+00015120: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+00015130: 2020 2020 2020 2022 5055 5422 2c20 7061         "PUT", pa
+00015140: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
+00015150: 652c 2070 6172 616d 733d 7061 7261 6d73  e, params=params
+00015160: 2c20 626f 6479 3d64 6963 745f 746f 5f6a  , body=dict_to_j
+00015170: 736f 6e28 6665 6174 7572 655f 7665 6374  son(feature_vect
+00015180: 6f72 290a 2020 2020 2020 2020 290a 2020  or).        ).  
+00015190: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+000151a0: 702e 6a73 6f6e 2829 0a0a 2020 2020 6465  p.json()..    de
+000151b0: 6620 7061 7463 685f 6665 6174 7572 655f  f patch_feature_
+000151c0: 7665 6374 6f72 280a 2020 2020 2020 2020  vector(.        
+000151d0: 7365 6c66 2c0a 2020 2020 2020 2020 6e61  self,.        na
+000151e0: 6d65 2c0a 2020 2020 2020 2020 6665 6174  me,.        feat
+000151f0: 7572 655f 7665 6374 6f72 5f75 7064 6174  ure_vector_updat
+00015200: 653a 2064 6963 742c 0a20 2020 2020 2020  e: dict,.       
+00015210: 2070 726f 6a65 6374 3d22 222c 0a20 2020   project="",.   
+00015220: 2020 2020 2074 6167 3d4e 6f6e 652c 0a20       tag=None,. 
+00015230: 2020 2020 2020 2075 6964 3d4e 6f6e 652c         uid=None,
+00015240: 0a20 2020 2020 2020 2070 6174 6368 5f6d  .        patch_m
+00015250: 6f64 653a 2055 6e69 6f6e 5b0a 2020 2020  ode: Union[.    
+00015260: 2020 2020 2020 2020 7374 722c 206d 6c72          str, mlr
+00015270: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00015280: 732e 5061 7463 684d 6f64 650a 2020 2020  s.PatchMode.    
+00015290: 2020 2020 5d20 3d20 6d6c 7275 6e2e 636f      ] = mlrun.co
+000152a0: 6d6d 6f6e 2e73 6368 656d 6173 2e50 6174  mmon.schemas.Pat
+000152b0: 6368 4d6f 6465 2e72 6570 6c61 6365 2c0a  chMode.replace,.
+000152c0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+000152d0: 2222 4d6f 6469 6679 2028 7061 7463 6829  ""Modify (patch)
+000152e0: 2061 6e20 6578 6973 7469 6e67 203a 7079   an existing :py
+000152f0: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
+00015300: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
+00015310: 7475 7265 5665 6374 6f72 6020 6f62 6a65  tureVector` obje
+00015320: 6374 2e0a 2020 2020 2020 2020 5468 6520  ct..        The 
+00015330: 6f62 6a65 6374 2069 7320 6964 656e 7469  object is identi
+00015340: 6669 6564 2062 7920 6974 7320 6e61 6d65  fied by its name
+00015350: 2028 616e 6420 7072 6f6a 6563 7420 6974   (and project it
+00015360: 2062 656c 6f6e 6773 2074 6f29 2c20 6173   belongs to), as
+00015370: 2077 656c 6c20 6173 206f 7074 696f 6e61   well as optiona
+00015380: 6c6c 7920 6120 6060 7461 6760 6020 6f72  lly a ``tag`` or
+00015390: 2069 7473 0a20 2020 2020 2020 2060 6075   its.        ``u
+000153a0: 6964 6060 2028 666f 7220 7665 7273 696f  id`` (for versio
+000153b0: 6e65 6420 6f62 6a65 6374 292e 2049 6620  ned object). If 
+000153c0: 626f 7468 2060 6074 6167 6060 2061 6e64  both ``tag`` and
+000153d0: 2060 6075 6964 6060 2061 7265 206f 6d69   ``uid`` are omi
+000153e0: 7474 6564 2074 6865 6e20 7468 6520 6f62  tted then the ob
+000153f0: 6a65 6374 2077 6974 6820 7461 6720 6060  ject with tag ``
+00015400: 6c61 7465 7374 6060 0a20 2020 2020 2020  latest``.       
+00015410: 2069 7320 6d6f 6469 6669 6564 2e0a 0a20   is modified... 
+00015420: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
+00015430: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
+00015440: 6f62 6a65 6374 2074 6f20 7061 7463 682e  object to patch.
+00015450: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00015460: 6665 6174 7572 655f 7665 6374 6f72 5f75  feature_vector_u
+00015470: 7064 6174 653a 2054 6865 206d 6f64 6966  pdate: The modif
+00015480: 6963 6174 696f 6e73 206e 6565 6465 6420  ications needed 
+00015490: 696e 2074 6865 206f 626a 6563 742e 2054  in the object. T
+000154a0: 6869 7320 7061 7261 6d65 7465 7220 6f6e  his parameter on
+000154b0: 6c79 2068 6173 2074 6865 2063 6861 6e67  ly has the chang
+000154c0: 6573 2069 6e20 6974 2c0a 2020 2020 2020  es in it,.      
+000154d0: 2020 2020 2020 6e6f 7420 6120 6675 6c6c        not a full
+000154e0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+000154f0: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
+00015500: 2050 726f 6a65 6374 2077 6869 6368 2063   Project which c
+00015510: 6f6e 7461 696e 7320 7468 6520 6d6f 6469  ontains the modi
+00015520: 6669 6564 206f 626a 6563 742e 0a20 2020  fied object..   
+00015530: 2020 2020 203a 7061 7261 6d20 7461 673a       :param tag:
+00015540: 2054 6865 2074 6167 206f 6620 7468 6520   The tag of the 
+00015550: 6f62 6a65 6374 2074 6f20 6d6f 6469 6679  object to modify
+00015560: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00015570: 2075 6964 3a20 7569 6420 6f66 2074 6865   uid: uid of the
+00015580: 206f 626a 6563 7420 746f 206d 6f64 6966   object to modif
+00015590: 792e 0a20 2020 2020 2020 203a 7061 7261  y..        :para
+000155a0: 6d20 7061 7463 685f 6d6f 6465 3a20 5468  m patch_mode: Th
+000155b0: 6520 7374 7261 7465 6779 2066 6f72 206d  e strategy for m
+000155c0: 6572 6769 6e67 2074 6865 2063 6861 6e67  erging the chang
+000155d0: 6573 2077 6974 6820 7468 6520 6578 6973  es with the exis
+000155e0: 7469 6e67 206f 626a 6563 742e 2043 616e  ting object. Can
+000155f0: 2062 6520 6569 7468 6572 2060 6072 6570   be either ``rep
+00015600: 6c61 6365 6060 0a20 2020 2020 2020 2020  lace``.         
+00015610: 2020 206f 7220 6060 6164 6469 7469 7665     or ``additive
+00015620: 6060 2e0a 2020 2020 2020 2020 2222 220a  ``..        """.
+00015630: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+00015640: 6520 3d20 7365 6c66 2e5f 7265 736f 6c76  e = self._resolv
+00015650: 655f 7265 6665 7265 6e63 6528 7461 672c  e_reference(tag,
+00015660: 2075 6964 290a 2020 2020 2020 2020 7072   uid).        pr
+00015670: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
+00015680: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
+00015690: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
+000156a0: 2020 6865 6164 6572 7320 3d20 7b6d 6c72    headers = {mlr
+000156b0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+000156c0: 732e 4865 6164 6572 4e61 6d65 732e 7061  s.HeaderNames.pa
+000156d0: 7463 685f 6d6f 6465 3a20 7061 7463 685f  tch_mode: patch_
+000156e0: 6d6f 6465 7d0a 2020 2020 2020 2020 7061  mode}.        pa
+000156f0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+00015700: 7b70 726f 6a65 6374 7d2f 6665 6174 7572  {project}/featur
+00015710: 652d 7665 6374 6f72 732f 7b6e 616d 657d  e-vectors/{name}
+00015720: 2f72 6566 6572 656e 6365 732f 7b72 6566  /references/{ref
+00015730: 6572 656e 6365 7d22 0a20 2020 2020 2020  erence}".       
+00015740: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00015750: 2066 2246 6169 6c65 6420 7570 6461 7469   f"Failed updati
+00015760: 6e67 2066 6561 7475 7265 2d76 6563 746f  ng feature-vecto
+00015770: 7220 7b70 726f 6a65 6374 7d2f 7b6e 616d  r {project}/{nam
+00015780: 657d 220a 2020 2020 2020 2020 7365 6c66  e}".        self
+00015790: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+000157a0: 2020 2020 2020 2022 5041 5443 4822 2c0a         "PATCH",.
+000157b0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+000157c0: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
+000157d0: 726f 725f 6d65 7373 6167 652c 0a20 2020  ror_message,.   
+000157e0: 2020 2020 2020 2020 2062 6f64 793d 6469           body=di
+000157f0: 6374 5f74 6f5f 6a73 6f6e 2866 6561 7475  ct_to_json(featu
+00015800: 7265 5f76 6563 746f 725f 7570 6461 7465  re_vector_update
+00015810: 292c 0a20 2020 2020 2020 2020 2020 2068  ),.            h
+00015820: 6561 6465 7273 3d68 6561 6465 7273 2c0a  eaders=headers,.
+00015830: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00015840: 6566 2064 656c 6574 655f 6665 6174 7572  ef delete_featur
+00015850: 655f 7665 6374 6f72 2873 656c 662c 206e  e_vector(self, n
+00015860: 616d 652c 2070 726f 6a65 6374 3d22 222c  ame, project="",
+00015870: 2074 6167 3d4e 6f6e 652c 2075 6964 3d4e   tag=None, uid=N
+00015880: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00015890: 2244 656c 6574 6520 6120 3a70 793a 636c  "Delete a :py:cl
+000158a0: 6173 733a 607e 6d6c 7275 6e2e 6665 6174  ass:`~mlrun.feat
+000158b0: 7572 655f 7374 6f72 652e 4665 6174 7572  ure_store.Featur
+000158c0: 6556 6563 746f 7260 206f 626a 6563 7420  eVector` object 
+000158d0: 6672 6f6d 2074 6865 2044 422e 0a20 2020  from the DB..   
+000158e0: 2020 2020 2049 6620 6060 7461 6760 6020       If ``tag`` 
+000158f0: 6f72 2060 6075 6964 6060 2061 7265 2073  or ``uid`` are s
+00015900: 7065 6369 6669 6564 2c20 7468 656e 206a  pecified, then j
+00015910: 7573 7420 7468 6520 7665 7273 696f 6e20  ust the version 
+00015920: 7265 6665 7265 6e63 6564 2062 7920 7468  referenced by th
+00015930: 656d 2077 696c 6c20 6265 2064 656c 6574  em will be delet
+00015940: 6564 2e20 5573 696e 6720 626f 7468 0a20  ed. Using both. 
+00015950: 2020 2020 2020 2069 7320 6e6f 7420 616c         is not al
+00015960: 6c6f 7765 642e 0a20 2020 2020 2020 2049  lowed..        I
+00015970: 6620 6e6f 6e65 2061 7265 2073 7065 6369  f none are speci
+00015980: 6669 6564 2c20 7468 656e 2061 6c6c 2069  fied, then all i
+00015990: 6e73 7461 6e63 6573 206f 6620 7468 6520  nstances of the 
+000159a0: 6f62 6a65 6374 2077 686f 7365 206e 616d  object whose nam
+000159b0: 6520 6973 2060 606e 616d 6560 6020 7769  e is ``name`` wi
+000159c0: 6c6c 2062 6520 6465 6c65 7465 642e 0a20  ll be deleted.. 
+000159d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000159e0: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+000159f0: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
+00015a00: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
+00015a10: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+00015a20: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+00015a30: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
+00015a40: 7273 2f7b 6e61 6d65 7d22 0a20 2020 2020  rs/{name}".     
+00015a50: 2020 2069 6620 7461 6720 6f72 2075 6964     if tag or uid
+00015a60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00015a70: 6665 7265 6e63 6520 3d20 7365 6c66 2e5f  ference = self._
+00015a80: 7265 736f 6c76 655f 7265 6665 7265 6e63  resolve_referenc
+00015a90: 6528 7461 672c 2075 6964 290a 2020 2020  e(tag, uid).    
+00015aa0: 2020 2020 2020 2020 7061 7468 203d 2070          path = p
+00015ab0: 6174 6820 2b20 6622 2f72 6566 6572 656e  ath + f"/referen
+00015ac0: 6365 732f 7b72 6566 6572 656e 6365 7d22  ces/{reference}"
+00015ad0: 0a0a 2020 2020 2020 2020 6572 726f 725f  ..        error_
+00015ae0: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00015af0: 6564 2064 656c 6574 696e 6720 6665 6174  ed deleting feat
+00015b00: 7572 652d 7665 6374 6f72 207b 6e61 6d65  ure-vector {name
+00015b10: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
+00015b20: 6170 695f 6361 6c6c 2822 4445 4c45 5445  api_call("DELETE
+00015b30: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+00015b40: 6573 7361 6765 290a 0a20 2020 2064 6566  essage)..    def
+00015b50: 2074 6167 5f6f 626a 6563 7473 280a 2020   tag_objects(.  
+00015b60: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00015b70: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
+00015b80: 2c0a 2020 2020 2020 2020 7461 675f 6e61  ,.        tag_na
+00015b90: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
+00015ba0: 206f 626a 6563 7473 3a20 556e 696f 6e5b   objects: Union[
+00015bb0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00015bc0: 656d 6173 2e54 6167 4f62 6a65 6374 732c  emas.TagObjects,
+00015bd0: 2064 6963 745d 2c0a 2020 2020 2020 2020   dict],.        
+00015be0: 7265 706c 6163 653a 2062 6f6f 6c20 3d20  replace: bool = 
+00015bf0: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
+00015c00: 2020 2020 2020 2222 2254 6167 2061 206c        """Tag a l
+00015c10: 6973 7420 6f66 206f 626a 6563 7473 2e0a  ist of objects..
+00015c20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00015c30: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
+00015c40: 2077 6869 6368 2063 6f6e 7461 696e 7320   which contains 
+00015c50: 7468 6520 6f62 6a65 6374 732e 0a20 2020  the objects..   
+00015c60: 2020 2020 203a 7061 7261 6d20 7461 675f       :param tag_
+00015c70: 6e61 6d65 3a20 5468 6520 7461 6720 746f  name: The tag to
+00015c80: 2073 6574 206f 6e20 7468 6520 6f62 6a65   set on the obje
+00015c90: 6374 732e 0a20 2020 2020 2020 203a 7061  cts..        :pa
+00015ca0: 7261 6d20 6f62 6a65 6374 733a 2054 6865  ram objects: The
+00015cb0: 206f 626a 6563 7473 2074 6f20 7461 672e   objects to tag.
+00015cc0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00015cd0: 7265 706c 6163 653a 2057 6865 7468 6572  replace: Whether
+00015ce0: 2074 6f20 7265 706c 6163 6520 7468 6520   to replace the 
+00015cf0: 6578 6973 7469 6e67 2074 6167 7320 6f66  existing tags of
+00015d00: 2074 6865 206f 626a 6563 7473 206f 7220   the objects or 
+00015d10: 746f 2061 6464 2074 6865 206e 6577 2074  to add the new t
+00015d20: 6167 2074 6f20 7468 656d 2e0a 2020 2020  ag to them..    
+00015d30: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00015d40: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+00015d50: 7473 2f7b 7072 6f6a 6563 747d 2f74 6167  ts/{project}/tag
+00015d60: 732f 7b74 6167 5f6e 616d 657d 220a 2020  s/{tag_name}".  
+00015d70: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+00015d80: 6167 6520 3d20 6622 4661 696c 6564 2074  age = f"Failed t
+00015d90: 6f20 7461 6720 7b74 6167 5f6e 616d 657d  o tag {tag_name}
+00015da0: 206f 6e20 6f62 6a65 6374 7320 7b6f 626a   on objects {obj
+00015db0: 6563 7473 7d22 0a20 2020 2020 2020 206d  ects}".        m
+00015dc0: 6574 686f 6420 3d20 2250 4f53 5422 2069  ethod = "POST" i
+00015dd0: 6620 7265 706c 6163 6520 656c 7365 2022  f replace else "
+00015de0: 5055 5422 0a20 2020 2020 2020 2073 656c  PUT".        sel
+00015df0: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+00015e00: 2020 2020 2020 2020 6d65 7468 6f64 2c0a          method,.
+00015e10: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00015e20: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
+00015e30: 726f 725f 6d65 7373 6167 652c 0a20 2020  ror_message,.   
+00015e40: 2020 2020 2020 2020 2062 6f64 793d 6469           body=di
+00015e50: 6374 5f74 6f5f 6a73 6f6e 280a 2020 2020  ct_to_json(.    
+00015e60: 2020 2020 2020 2020 2020 2020 6f62 6a65              obje
+00015e70: 6374 732e 6469 6374 2829 0a20 2020 2020  cts.dict().     
+00015e80: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00015e90: 696e 7374 616e 6365 286f 626a 6563 7473  instance(objects
+00015ea0: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+00015eb0: 6368 656d 6173 2e54 6167 4f62 6a65 6374  chemas.TagObject
+00015ec0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00015ed0: 2020 2065 6c73 6520 6f62 6a65 6374 730a     else objects.
+00015ee0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00015ef0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00015f00: 6620 6465 6c65 7465 5f6f 626a 6563 7473  f delete_objects
+00015f10: 5f74 6167 280a 2020 2020 2020 2020 7365  _tag(.        se
+00015f20: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
+00015f30: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
+00015f40: 2020 7461 675f 6e61 6d65 3a20 7374 722c    tag_name: str,
+00015f50: 0a20 2020 2020 2020 2074 6167 5f6f 626a  .        tag_obj
+00015f60: 6563 7473 3a20 556e 696f 6e5b 6d6c 7275  ects: Union[mlru
+00015f70: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00015f80: 2e54 6167 4f62 6a65 6374 732c 2064 6963  .TagObjects, dic
+00015f90: 745d 2c0a 2020 2020 293a 0a20 2020 2020  t],.    ):.     
+00015fa0: 2020 2022 2222 4465 6c65 7465 2061 2074     """Delete a t
+00015fb0: 6167 2066 726f 6d20 6120 6c69 7374 206f  ag from a list o
+00015fc0: 6620 6f62 6a65 6374 732e 0a0a 2020 2020  f objects...    
+00015fd0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+00015fe0: 6374 3a20 5072 6f6a 6563 7420 7768 6963  ct: Project whic
+00015ff0: 6820 636f 6e74 6169 6e73 2074 6865 206f  h contains the o
+00016000: 626a 6563 7473 2e0a 2020 2020 2020 2020  bjects..        
+00016010: 3a70 6172 616d 2074 6167 5f6e 616d 653a  :param tag_name:
+00016020: 2054 6865 2074 6167 2074 6f20 6465 6c65   The tag to dele
+00016030: 7465 2066 726f 6d20 7468 6520 6f62 6a65  te from the obje
+00016040: 6374 732e 0a20 2020 2020 2020 203a 7061  cts..        :pa
+00016050: 7261 6d20 7461 675f 6f62 6a65 6374 733a  ram tag_objects:
+00016060: 2054 6865 206f 626a 6563 7473 2074 6f20   The objects to 
+00016070: 6465 6c65 7465 2074 6865 2074 6167 2066  delete the tag f
+00016080: 726f 6d2e 0a0a 2020 2020 2020 2020 2222  rom...        ""
+00016090: 220a 2020 2020 2020 2020 7061 7468 203d  ".        path =
+000160a0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+000160b0: 6a65 6374 7d2f 7461 6773 2f7b 7461 675f  ject}/tags/{tag_
+000160c0: 6e61 6d65 7d22 0a20 2020 2020 2020 2065  name}".        e
+000160d0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+000160e0: 2246 6169 6c65 6420 6465 6c65 7469 6e67  "Failed deleting
+000160f0: 2074 6167 2066 726f 6d20 7b74 6167 5f6e   tag from {tag_n
+00016100: 616d 657d 220a 2020 2020 2020 2020 7365  ame}".        se
+00016110: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+00016120: 2020 2020 2020 2020 2022 4445 4c45 5445           "DELETE
+00016130: 222c 0a20 2020 2020 2020 2020 2020 2070  ",.            p
+00016140: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+00016150: 2065 7272 6f72 5f6d 6573 7361 6765 2c0a   error_message,.
+00016160: 2020 2020 2020 2020 2020 2020 626f 6479              body
+00016170: 3d64 6963 745f 746f 5f6a 736f 6e28 0a20  =dict_to_json(. 
+00016180: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00016190: 6167 5f6f 626a 6563 7473 2e64 6963 7428  ag_objects.dict(
+000161a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000161b0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000161c0: 7461 675f 6f62 6a65 6374 732c 206d 6c72  tag_objects, mlr
+000161d0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+000161e0: 732e 5461 674f 626a 6563 7473 290a 2020  s.TagObjects).  
+000161f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00016200: 7365 2074 6167 5f6f 626a 6563 7473 0a20  se tag_objects. 
+00016210: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00016220: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00016230: 2074 6167 5f61 7274 6966 6163 7473 280a   tag_artifacts(.
+00016240: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00016250: 2020 2020 2020 6172 7469 6661 6374 733a        artifacts:
+00016260: 2055 6e69 6f6e 5b4c 6973 745b 4172 7469   Union[List[Arti
+00016270: 6661 6374 5d2c 204c 6973 745b 6469 6374  fact], List[dict
+00016280: 5d2c 2041 7274 6966 6163 742c 2064 6963  ], Artifact, dic
+00016290: 745d 2c0a 2020 2020 2020 2020 7072 6f6a  t],.        proj
+000162a0: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
+000162b0: 2020 7461 675f 6e61 6d65 3a20 7374 722c    tag_name: str,
+000162c0: 0a20 2020 2020 2020 2072 6570 6c61 6365  .        replace
+000162d0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+000162e0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+000162f0: 2222 5461 6720 6120 6c69 7374 206f 6620  ""Tag a list of 
+00016300: 6172 7469 6661 6374 732e 0a0a 2020 2020  artifacts...    
+00016310: 2020 2020 3a70 6172 616d 2061 7274 6966      :param artif
+00016320: 6163 7473 3a20 5468 6520 6172 7469 6661  acts: The artifa
+00016330: 6374 7320 746f 2074 6167 2e20 4361 6e20  cts to tag. Can 
+00016340: 6265 2061 206c 6973 7420 6f66 203a 7079  be a list of :py
+00016350: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e61  :class:`~mlrun.a
+00016360: 7274 6966 6163 7473 2e41 7274 6966 6163  rtifacts.Artifac
+00016370: 7460 206f 626a 6563 7473 206f 720a 2020  t` objects or.  
+00016380: 2020 2020 2020 2020 2020 6469 6374 696f            dictio
+00016390: 6e61 7269 6573 2c20 6f72 2061 2073 696e  naries, or a sin
+000163a0: 676c 6520 6f62 6a65 6374 2e0a 2020 2020  gle object..    
+000163b0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+000163c0: 6374 3a20 5072 6f6a 6563 7420 7768 6963  ct: Project whic
+000163d0: 6820 636f 6e74 6169 6e73 2074 6865 2061  h contains the a
+000163e0: 7274 6966 6163 7473 2e0a 2020 2020 2020  rtifacts..      
+000163f0: 2020 3a70 6172 616d 2074 6167 5f6e 616d    :param tag_nam
+00016400: 653a 2054 6865 2074 6167 2074 6f20 7365  e: The tag to se
+00016410: 7420 6f6e 2074 6865 2061 7274 6966 6163  t on the artifac
+00016420: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
+00016430: 616d 2072 6570 6c61 6365 3a20 4966 2054  am replace: If T
+00016440: 7275 652c 2072 6570 6c61 6365 2065 7869  rue, replace exi
+00016450: 7374 696e 6720 7461 6773 2c20 6f74 6865  sting tags, othe
+00016460: 7277 6973 6520 6170 7065 6e64 2074 6f20  rwise append to 
+00016470: 6578 6973 7469 6e67 2074 6167 732e 0a20  existing tags.. 
+00016480: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00016490: 2020 2074 6167 5f6f 626a 6563 7473 203d     tag_objects =
+000164a0: 2073 656c 662e 5f72 6573 6f6c 7665 5f61   self._resolve_a
+000164b0: 7274 6966 6163 7473 5f74 6f5f 7461 675f  rtifacts_to_tag_
+000164c0: 6f62 6a65 6374 7328 6172 7469 6661 6374  objects(artifact
+000164d0: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+000164e0: 7461 675f 6f62 6a65 6374 7328 7072 6f6a  tag_objects(proj
+000164f0: 6563 742c 2074 6167 5f6e 616d 652c 206f  ect, tag_name, o
+00016500: 626a 6563 7473 3d74 6167 5f6f 626a 6563  bjects=tag_objec
+00016510: 7473 2c20 7265 706c 6163 653d 7265 706c  ts, replace=repl
+00016520: 6163 6529 0a0a 2020 2020 6465 6620 6465  ace)..    def de
+00016530: 6c65 7465 5f61 7274 6966 6163 7473 5f74  lete_artifacts_t
+00016540: 6167 7328 0a20 2020 2020 2020 2073 656c  ags(.        sel
+00016550: 662c 0a20 2020 2020 2020 2061 7274 6966  f,.        artif
+00016560: 6163 7473 2c0a 2020 2020 2020 2020 7072  acts,.        pr
+00016570: 6f6a 6563 743a 2073 7472 2c0a 2020 2020  oject: str,.    
+00016580: 2020 2020 7461 675f 6e61 6d65 3a20 7374      tag_name: st
+00016590: 722c 0a20 2020 2029 3a0a 2020 2020 2020  r,.    ):.      
+000165a0: 2020 2222 2244 656c 6574 6520 7461 6720    """Delete tag 
+000165b0: 6672 6f6d 2061 206c 6973 7420 6f66 2061  from a list of a
+000165c0: 7274 6966 6163 7473 2e0a 0a20 2020 2020  rtifacts...     
+000165d0: 2020 203a 7061 7261 6d20 6172 7469 6661     :param artifa
+000165e0: 6374 733a 2054 6865 2061 7274 6966 6163  cts: The artifac
+000165f0: 7473 2074 6f20 6465 6c65 7465 2074 6865  ts to delete the
+00016600: 2074 6167 2066 726f 6d2e 2043 616e 2062   tag from. Can b
+00016610: 6520 6120 6c69 7374 206f 6620 3a70 793a  e a list of :py:
+00016620: 636c 6173 733a 607e 6d6c 7275 6e2e 6172  class:`~mlrun.ar
+00016630: 7469 6661 6374 732e 4172 7469 6661 6374  tifacts.Artifact
+00016640: 600a 2020 2020 2020 2020 2020 2020 6f62  `.            ob
+00016650: 6a65 6374 7320 6f72 2064 6963 7469 6f6e  jects or diction
+00016660: 6172 6965 732c 206f 7220 6120 7369 6e67  aries, or a sing
+00016670: 6c65 206f 626a 6563 742e 0a20 2020 2020  le object..     
+00016680: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00016690: 743a 2050 726f 6a65 6374 2077 6869 6368  t: Project which
+000166a0: 2063 6f6e 7461 696e 7320 7468 6520 6172   contains the ar
+000166b0: 7469 6661 6374 732e 0a20 2020 2020 2020  tifacts..       
+000166c0: 203a 7061 7261 6d20 7461 675f 6e61 6d65   :param tag_name
+000166d0: 3a20 5468 6520 7461 6720 746f 2073 6574  : The tag to set
+000166e0: 206f 6e20 7468 6520 6172 7469 6661 6374   on the artifact
+000166f0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00016700: 2020 2020 2020 2074 6167 5f6f 626a 6563         tag_objec
+00016710: 7473 203d 2073 656c 662e 5f72 6573 6f6c  ts = self._resol
+00016720: 7665 5f61 7274 6966 6163 7473 5f74 6f5f  ve_artifacts_to_
+00016730: 7461 675f 6f62 6a65 6374 7328 6172 7469  tag_objects(arti
+00016740: 6661 6374 7329 0a20 2020 2020 2020 2073  facts).        s
+00016750: 656c 662e 6465 6c65 7465 5f6f 626a 6563  elf.delete_objec
+00016760: 7473 5f74 6167 2870 726f 6a65 6374 2c20  ts_tag(project, 
+00016770: 7461 675f 6e61 6d65 2c20 7461 675f 6f62  tag_name, tag_ob
+00016780: 6a65 6374 7329 0a0a 2020 2020 6465 6620  jects)..    def 
+00016790: 6c69 7374 5f70 726f 6a65 6374 7328 0a20  list_projects(. 
+000167a0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+000167b0: 2020 2020 206f 776e 6572 3a20 7374 7220       owner: str 
+000167c0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000167d0: 666f 726d 6174 5f3a 2055 6e69 6f6e 5b0a  format_: Union[.
+000167e0: 2020 2020 2020 2020 2020 2020 7374 722c              str,
+000167f0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00016800: 6865 6d61 732e 5072 6f6a 6563 7473 466f  hemas.ProjectsFo
+00016810: 726d 6174 0a20 2020 2020 2020 205d 203d  rmat.        ] =
+00016820: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00016830: 6865 6d61 732e 5072 6f6a 6563 7473 466f  hemas.ProjectsFo
+00016840: 726d 6174 2e66 756c 6c2c 0a20 2020 2020  rmat.full,.     
+00016850: 2020 206c 6162 656c 733a 204c 6973 745b     labels: List[
+00016860: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00016870: 2020 2020 2073 7461 7465 3a20 556e 696f       state: Unio
+00016880: 6e5b 7374 722c 206d 6c72 756e 2e63 6f6d  n[str, mlrun.com
+00016890: 6d6f 6e2e 7363 6865 6d61 732e 5072 6f6a  mon.schemas.Proj
+000168a0: 6563 7453 7461 7465 5d20 3d20 4e6f 6e65  ectState] = None
+000168b0: 2c0a 2020 2020 2920 2d3e 204c 6973 745b  ,.    ) -> List[
+000168c0: 556e 696f 6e5b 6d6c 7275 6e2e 7072 6f6a  Union[mlrun.proj
+000168d0: 6563 7473 2e4d 6c72 756e 5072 6f6a 6563  ects.MlrunProjec
+000168e0: 742c 2073 7472 5d5d 3a0a 2020 2020 2020  t, str]]:.      
+000168f0: 2020 2222 2252 6574 7572 6e20 6120 6c69    """Return a li
+00016900: 7374 206f 6620 7468 6520 6578 6973 7469  st of the existi
+00016910: 6e67 2070 726f 6a65 6374 732c 2070 6f74  ng projects, pot
+00016920: 656e 7469 616c 6c79 2066 696c 7465 7265  entially filtere
+00016930: 6420 6279 2073 7065 6369 6669 6320 6372  d by specific cr
+00016940: 6974 6572 6961 2e0a 0a20 2020 2020 2020  iteria...       
+00016950: 203a 7061 7261 6d20 6f77 6e65 723a 204c   :param owner: L
+00016960: 6973 7420 6f6e 6c79 2070 726f 6a65 6374  ist only project
+00016970: 7320 6265 6c6f 6e67 696e 6720 746f 2074  s belonging to t
+00016980: 6869 7320 7370 6563 6966 6963 206f 776e  his specific own
+00016990: 6572 2e0a 2020 2020 2020 2020 3a70 6172  er..        :par
+000169a0: 616d 2066 6f72 6d61 745f 3a20 466f 726d  am format_: Form
+000169b0: 6174 206f 6620 7468 6520 7265 7375 6c74  at of the result
+000169c0: 732e 2050 6f73 7369 626c 6520 7661 6c75  s. Possible valu
+000169d0: 6573 2061 7265 3a0a 0a20 2020 2020 2020  es are:..       
+000169e0: 2020 2020 202d 2060 6066 756c 6c60 6020       - ``full`` 
+000169f0: 2864 6566 6175 6c74 2076 616c 7565 2920  (default value) 
+00016a00: 2d20 5265 7475 726e 2066 756c 6c20 7072  - Return full pr
+00016a10: 6f6a 6563 7420 6f62 6a65 6374 732e 0a20  oject objects.. 
+00016a20: 2020 2020 2020 2020 2020 202d 2060 606d             - ``m
+00016a30: 696e 696d 616c 6060 202d 2052 6574 7572  inimal`` - Retur
+00016a40: 6e20 6d69 6e69 6d61 6c20 7072 6f6a 6563  n minimal projec
+00016a50: 7420 6f62 6a65 6374 7320 286d 696e 696d  t objects (minim
+00016a60: 697a 6174 696f 6e20 6861 7070 656e 7320  ization happens 
+00016a70: 696e 2074 6865 2042 4529 2e0a 2020 2020  in the BE)..    
+00016a80: 2020 2020 2020 2020 2d20 6060 6e61 6d65          - ``name
+00016a90: 5f6f 6e6c 7960 6020 2d20 5265 7475 726e  _only`` - Return
+00016aa0: 206a 7573 7420 7468 6520 6e61 6d65 7320   just the names 
+00016ab0: 6f66 2074 6865 2070 726f 6a65 6374 732e  of the projects.
+00016ac0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00016ad0: 206c 6162 656c 733a 2046 696c 7465 7220   labels: Filter 
+00016ae0: 6279 206c 6162 656c 7320 6174 7461 6368  by labels attach
+00016af0: 6564 2074 6f20 7468 6520 7072 6f6a 6563  ed to the projec
+00016b00: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
+00016b10: 6d20 7374 6174 653a 2046 696c 7465 7220  m state: Filter 
+00016b20: 6279 2070 726f 6a65 6374 2773 2073 7461  by project's sta
+00016b30: 7465 2e20 4361 6e20 6265 2065 6974 6865  te. Can be eithe
+00016b40: 7220 6060 6f6e 6c69 6e65 6060 206f 7220  r ``online`` or 
+00016b50: 6060 6172 6368 6976 6564 6060 2e0a 2020  ``archived``..  
+00016b60: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00016b70: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+00016b80: 2020 2020 2020 2020 2020 226f 776e 6572            "owner
+00016b90: 223a 206f 776e 6572 2c0a 2020 2020 2020  ": owner,.      
+00016ba0: 2020 2020 2020 2273 7461 7465 223a 2073        "state": s
+00016bb0: 7461 7465 2c0a 2020 2020 2020 2020 2020  tate,.          
+00016bc0: 2020 2266 6f72 6d61 7422 3a20 666f 726d    "format": form
+00016bd0: 6174 5f2c 0a20 2020 2020 2020 2020 2020  at_,.           
+00016be0: 2022 6c61 6265 6c22 3a20 6c61 6265 6c73   "label": labels
+00016bf0: 206f 7220 5b5d 2c0a 2020 2020 2020 2020   or [],.        
+00016c00: 7d0a 0a20 2020 2020 2020 2065 7272 6f72  }..        error
+00016c10: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
+00016c20: 6c65 6420 6c69 7374 696e 6720 7072 6f6a  led listing proj
+00016c30: 6563 7473 2c20 7175 6572 793a 207b 7061  ects, query: {pa
+00016c40: 7261 6d73 7d22 0a20 2020 2020 2020 2072  rams}".        r
+00016c50: 6573 706f 6e73 6520 3d20 7365 6c66 2e61  esponse = self.a
+00016c60: 7069 5f63 616c 6c28 2247 4554 222c 2022  pi_call("GET", "
+00016c70: 7072 6f6a 6563 7473 222c 2065 7272 6f72  projects", error
+00016c80: 5f6d 6573 7361 6765 2c20 7061 7261 6d73  _message, params
+00016c90: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+00016ca0: 2069 6620 666f 726d 6174 5f20 3d3d 206d   if format_ == m
+00016cb0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00016cc0: 6d61 732e 5072 6f6a 6563 7473 466f 726d  mas.ProjectsForm
+00016cd0: 6174 2e6e 616d 655f 6f6e 6c79 3a0a 2020  at.name_only:.  
+00016ce0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016cf0: 2072 6573 706f 6e73 652e 6a73 6f6e 2829   response.json()
+00016d00: 5b22 7072 6f6a 6563 7473 225d 0a20 2020  ["projects"].   
+00016d10: 2020 2020 2065 6c69 6620 666f 726d 6174       elif format
+00016d20: 5f20 696e 205b 0a20 2020 2020 2020 2020  _ in [.         
+00016d30: 2020 206d 6c72 756e 2e63 6f6d 6d6f 6e2e     mlrun.common.
+00016d40: 7363 6865 6d61 732e 5072 6f6a 6563 7473  schemas.Projects
+00016d50: 466f 726d 6174 2e66 756c 6c2c 0a20 2020  Format.full,.   
+00016d60: 2020 2020 2020 2020 206d 6c72 756e 2e63           mlrun.c
+00016d70: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5072  ommon.schemas.Pr
+00016d80: 6f6a 6563 7473 466f 726d 6174 2e6d 696e  ojectsFormat.min
+00016d90: 696d 616c 2c0a 2020 2020 2020 2020 5d3a  imal,.        ]:
+00016da0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00016db0: 7572 6e20 5b0a 2020 2020 2020 2020 2020  urn [.          
+00016dc0: 2020 2020 2020 6d6c 7275 6e2e 7072 6f6a        mlrun.proj
+00016dd0: 6563 7473 2e4d 6c72 756e 5072 6f6a 6563  ects.MlrunProjec
+00016de0: 742e 6672 6f6d 5f64 6963 7428 7072 6f6a  t.from_dict(proj
+00016df0: 6563 745f 6469 6374 290a 2020 2020 2020  ect_dict).      
+00016e00: 2020 2020 2020 2020 2020 666f 7220 7072            for pr
+00016e10: 6f6a 6563 745f 6469 6374 2069 6e20 7265  oject_dict in re
+00016e20: 7370 6f6e 7365 2e6a 736f 6e28 295b 2270  sponse.json()["p
+00016e30: 726f 6a65 6374 7322 5d0a 2020 2020 2020  rojects"].      
+00016e40: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00016e50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00016e60: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00016e70: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
+00016e80: 2020 2020 2020 2020 2020 2020 2066 2250               f"P
+00016e90: 726f 7669 6465 6420 666f 726d 6174 2069  rovided format i
+00016ea0: 7320 6e6f 7420 7375 7070 6f72 7465 642e  s not supported.
+00016eb0: 2066 6f72 6d61 743d 7b66 6f72 6d61 745f   format={format_
+00016ec0: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
+00016ed0: 0a0a 2020 2020 6465 6620 6765 745f 7072  ..    def get_pr
+00016ee0: 6f6a 6563 7428 7365 6c66 2c20 6e61 6d65  oject(self, name
+00016ef0: 3a20 7374 7229 202d 3e20 6d6c 7275 6e2e  : str) -> mlrun.
+00016f00: 7072 6f6a 6563 7473 2e4d 6c72 756e 5072  projects.MlrunPr
+00016f10: 6f6a 6563 743a 0a20 2020 2020 2020 2022  oject:.        "
+00016f20: 2222 4765 7420 6465 7461 696c 7320 666f  ""Get details fo
+00016f30: 7220 6120 7370 6563 6966 6963 2070 726f  r a specific pro
+00016f40: 6a65 6374 2e22 2222 0a0a 2020 2020 2020  ject."""..      
+00016f50: 2020 6966 206e 6f74 206e 616d 653a 0a20    if not name:. 
+00016f60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00016f70: 204d 4c52 756e 496e 7661 6c69 6441 7267   MLRunInvalidArg
+00016f80: 756d 656e 7445 7272 6f72 2822 4e61 6d65  umentError("Name
+00016f90: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
+00016fa0: 6422 290a 0a20 2020 2020 2020 2070 6174  d")..        pat
+00016fb0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+00016fc0: 6e61 6d65 7d22 0a20 2020 2020 2020 2065  name}".        e
+00016fd0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+00016fe0: 2246 6169 6c65 6420 7265 7472 6965 7669  "Failed retrievi
+00016ff0: 6e67 2070 726f 6a65 6374 207b 6e61 6d65  ng project {name
+00017000: 7d22 0a20 2020 2020 2020 2072 6573 706f  }".        respo
+00017010: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+00017020: 616c 6c28 2247 4554 222c 2070 6174 682c  all("GET", path,
+00017030: 2065 7272 6f72 5f6d 6573 7361 6765 290a   error_message).
+00017040: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00017050: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
+00017060: 7275 6e50 726f 6a65 6374 2e66 726f 6d5f  runProject.from_
+00017070: 6469 6374 2872 6573 706f 6e73 652e 6a73  dict(response.js
+00017080: 6f6e 2829 290a 0a20 2020 2064 6566 2064  on())..    def d
+00017090: 656c 6574 655f 7072 6f6a 6563 7428 0a20  elete_project(. 
+000170a0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+000170b0: 2020 2020 206e 616d 653a 2073 7472 2c0a       name: str,.
+000170c0: 2020 2020 2020 2020 6465 6c65 7469 6f6e          deletion
+000170d0: 5f73 7472 6174 6567 793a 2055 6e69 6f6e  _strategy: Union
+000170e0: 5b0a 2020 2020 2020 2020 2020 2020 7374  [.            st
+000170f0: 722c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  r, mlrun.common.
+00017100: 7363 6865 6d61 732e 4465 6c65 7469 6f6e  schemas.Deletion
+00017110: 5374 7261 7465 6779 0a20 2020 2020 2020  Strategy.       
+00017120: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
+00017130: 6e2e 7363 6865 6d61 732e 4465 6c65 7469  n.schemas.Deleti
+00017140: 6f6e 5374 7261 7465 6779 2e64 6566 6175  onStrategy.defau
+00017150: 6c74 2829 2c0a 2020 2020 293a 0a20 2020  lt(),.    ):.   
+00017160: 2020 2020 2022 2222 4465 6c65 7465 2061       """Delete a
+00017170: 2070 726f 6a65 6374 2e0a 0a20 2020 2020   project...     
+00017180: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+00017190: 4e61 6d65 206f 6620 7468 6520 7072 6f6a  Name of the proj
+000171a0: 6563 7420 746f 2064 656c 6574 652e 0a20  ect to delete.. 
+000171b0: 2020 2020 2020 203a 7061 7261 6d20 6465         :param de
+000171c0: 6c65 7469 6f6e 5f73 7472 6174 6567 793a  letion_strategy:
+000171d0: 2048 6f77 2074 6f20 7472 6561 7420 6368   How to treat ch
+000171e0: 696c 6420 6f62 6a65 6374 7320 6f66 2074  ild objects of t
+000171f0: 6865 2070 726f 6a65 6374 2e20 506f 7373  he project. Poss
+00017200: 6962 6c65 2076 616c 7565 7320 6172 653a  ible values are:
+00017210: 0a0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
+00017220: 6060 7265 7374 7269 6374 6060 2028 6465  ``restrict`` (de
+00017230: 6661 756c 7429 202d 2050 726f 6a65 6374  fault) - Project
+00017240: 206d 7573 7420 6e6f 7420 6861 7665 2061   must not have a
+00017250: 6e79 2063 6869 6c64 206f 626a 6563 7473  ny child objects
+00017260: 2077 6865 6e20 6465 6c65 7465 642e 2049   when deleted. I
+00017270: 6620 7573 696e 6720 7468 6973 206d 6f64  f using this mod
+00017280: 6520 7768 696c 650a 2020 2020 2020 2020  e while.        
+00017290: 2020 2020 2020 6368 696c 6420 6f62 6a65        child obje
+000172a0: 6374 7320 6578 6973 742c 2074 6865 206f  cts exist, the o
+000172b0: 7065 7261 7469 6f6e 2077 696c 6c20 6661  peration will fa
+000172c0: 696c 2e0a 2020 2020 2020 2020 2020 2020  il..            
+000172d0: 2d20 6060 6361 7363 6164 6560 6020 2d20  - ``cascade`` - 
+000172e0: 4175 746f 6d61 7469 6361 6c6c 7920 6465  Automatically de
+000172f0: 6c65 7465 2061 6c6c 2063 6869 6c64 206f  lete all child o
+00017300: 626a 6563 7473 2077 6865 6e20 6465 6c65  bjects when dele
+00017310: 7469 6e67 2074 6865 2070 726f 6a65 6374  ting the project
+00017320: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00017330: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+00017340: 7072 6f6a 6563 7473 2f7b 6e61 6d65 7d22  projects/{name}"
+00017350: 0a20 2020 2020 2020 2068 6561 6465 7273  .        headers
+00017360: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00017370: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00017380: 6865 6d61 732e 4865 6164 6572 4e61 6d65  hemas.HeaderName
+00017390: 732e 6465 6c65 7469 6f6e 5f73 7472 6174  s.deletion_strat
+000173a0: 6567 793a 2064 656c 6574 696f 6e5f 7374  egy: deletion_st
+000173b0: 7261 7465 6779 0a20 2020 2020 2020 207d  rategy.        }
+000173c0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+000173d0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+000173e0: 6420 6465 6c65 7469 6e67 2070 726f 6a65  d deleting proje
+000173f0: 6374 207b 6e61 6d65 7d22 0a20 2020 2020  ct {name}".     
+00017400: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
+00017410: 6c66 2e61 7069 5f63 616c 6c28 2244 454c  lf.api_call("DEL
+00017420: 4554 4522 2c20 7061 7468 2c20 6572 726f  ETE", path, erro
+00017430: 725f 6d65 7373 6167 652c 2068 6561 6465  r_message, heade
+00017440: 7273 3d68 6561 6465 7273 290a 2020 2020  rs=headers).    
+00017450: 2020 2020 6966 2072 6573 706f 6e73 652e      if response.
+00017460: 7374 6174 7573 5f63 6f64 6520 3d3d 2068  status_code == h
+00017470: 7474 702e 4854 5450 5374 6174 7573 2e41  ttp.HTTPStatus.A
+00017480: 4343 4550 5445 443a 0a20 2020 2020 2020  CCEPTED:.       
+00017490: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000174a0: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
+000174b0: 6374 5f74 6f5f 6265 5f64 656c 6574 6564  ct_to_be_deleted
+000174c0: 286e 616d 6529 0a0a 2020 2020 6465 6620  (name)..    def 
+000174d0: 7374 6f72 655f 7072 6f6a 6563 7428 0a20  store_project(. 
+000174e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+000174f0: 2020 2020 206e 616d 653a 2073 7472 2c0a       name: str,.
+00017500: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
+00017510: 2055 6e69 6f6e 5b64 6963 742c 206d 6c72   Union[dict, mlr
+00017520: 756e 2e70 726f 6a65 6374 732e 4d6c 7275  un.projects.Mlru
+00017530: 6e50 726f 6a65 6374 2c20 6d6c 7275 6e2e  nProject, mlrun.
+00017540: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
+00017550: 726f 6a65 6374 5d2c 0a20 2020 2029 202d  roject],.    ) -
+00017560: 3e20 6d6c 7275 6e2e 7072 6f6a 6563 7473  > mlrun.projects
+00017570: 2e4d 6c72 756e 5072 6f6a 6563 743a 0a20  .MlrunProject:. 
+00017580: 2020 2020 2020 2022 2222 5374 6f72 6520         """Store 
+00017590: 6120 7072 6f6a 6563 7420 696e 2074 6865  a project in the
+000175a0: 2044 422e 2054 6869 7320 6f70 6572 6174   DB. This operat
+000175b0: 696f 6e20 7769 6c6c 206f 7665 7277 7269  ion will overwri
+000175c0: 7465 2065 7869 7374 696e 6720 7072 6f6a  te existing proj
+000175d0: 6563 7420 6f66 2074 6865 2073 616d 6520  ect of the same 
+000175e0: 6e61 6d65 2069 6620 6578 6973 7473 2e22  name if exists."
+000175f0: 2222 0a0a 2020 2020 2020 2020 7061 7468  ""..        path
+00017600: 203d 2066 2270 726f 6a65 6374 732f 7b6e   = f"projects/{n
+00017610: 616d 657d 220a 2020 2020 2020 2020 6572  ame}".        er
 00017620: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
-00017630: 4661 696c 6564 2070 6174 6368 696e 6720  Failed patching 
-00017640: 7072 6f6a 6563 7420 7b6e 616d 657d 220a  project {name}".
-00017650: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-00017660: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-00017670: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
-00017680: 4154 4348 222c 2070 6174 682c 2065 7272  ATCH", path, err
-00017690: 6f72 5f6d 6573 7361 6765 2c20 626f 6479  or_message, body
-000176a0: 3d64 6963 745f 746f 5f6a 736f 6e28 7072  =dict_to_json(pr
-000176b0: 6f6a 6563 7429 2c20 6865 6164 6572 733d  oject), headers=
-000176c0: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
-000176d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000176e0: 206d 6c72 756e 2e70 726f 6a65 6374 732e   mlrun.projects.
-000176f0: 4d6c 7275 6e50 726f 6a65 6374 2e66 726f  MlrunProject.fro
-00017700: 6d5f 6469 6374 2872 6573 706f 6e73 652e  m_dict(response.
-00017710: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-00017720: 2063 7265 6174 655f 7072 6f6a 6563 7428   create_project(
-00017730: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00017740: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-00017750: 556e 696f 6e5b 6469 6374 2c20 6d6c 7275  Union[dict, mlru
-00017760: 6e2e 7072 6f6a 6563 7473 2e4d 6c72 756e  n.projects.Mlrun
-00017770: 5072 6f6a 6563 742c 206d 6c72 756e 2e61  Project, mlrun.a
-00017780: 7069 2e73 6368 656d 6173 2e50 726f 6a65  pi.schemas.Proje
-00017790: 6374 5d2c 0a20 2020 2029 202d 3e20 6d6c  ct],.    ) -> ml
-000177a0: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
-000177b0: 756e 5072 6f6a 6563 743a 0a20 2020 2020  unProject:.     
-000177c0: 2020 2022 2222 4372 6561 7465 2061 206e     """Create a n
-000177d0: 6577 2070 726f 6a65 6374 2e20 4120 7072  ew project. A pr
-000177e0: 6f6a 6563 7420 7769 7468 2074 6865 2073  oject with the s
-000177f0: 616d 6520 6e61 6d65 206d 7573 7420 6e6f  ame name must no
-00017800: 7420 6578 6973 7420 7072 696f 7220 746f  t exist prior to
-00017810: 2063 7265 6174 696f 6e2e 2222 220a 0a20   creation.""".. 
-00017820: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00017830: 616e 6365 2870 726f 6a65 6374 2c20 6d6c  ance(project, ml
-00017840: 7275 6e2e 6170 692e 7363 6865 6d61 732e  run.api.schemas.
-00017850: 5072 6f6a 6563 7429 3a0a 2020 2020 2020  Project):.      
-00017860: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-00017870: 7072 6f6a 6563 742e 6469 6374 2829 0a20  project.dict(). 
-00017880: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00017890: 7374 616e 6365 2870 726f 6a65 6374 2c20  stance(project, 
-000178a0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
-000178b0: 6c72 756e 5072 6f6a 6563 7429 3a0a 2020  lrunProject):.  
-000178c0: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-000178d0: 7420 3d20 7072 6f6a 6563 742e 746f 5f64  t = project.to_d
-000178e0: 6963 7428 290a 2020 2020 2020 2020 7072  ict().        pr
-000178f0: 6f6a 6563 745f 6e61 6d65 203d 2070 726f  oject_name = pro
-00017900: 6a65 6374 5b22 6d65 7461 6461 7461 225d  ject["metadata"]
-00017910: 5b22 6e61 6d65 225d 0a20 2020 2020 2020  ["name"].       
-00017920: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00017930: 2066 2246 6169 6c65 6420 6372 6561 7469   f"Failed creati
-00017940: 6e67 2070 726f 6a65 6374 207b 7072 6f6a  ng project {proj
-00017950: 6563 745f 6e61 6d65 7d22 0a20 2020 2020  ect_name}".     
-00017960: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
-00017970: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-00017980: 2020 2020 2020 2020 2022 504f 5354 222c           "POST",
-00017990: 0a20 2020 2020 2020 2020 2020 2022 7072  .            "pr
-000179a0: 6f6a 6563 7473 222c 0a20 2020 2020 2020  ojects",.       
-000179b0: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-000179c0: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
-000179d0: 626f 6479 3d64 6963 745f 746f 5f6a 736f  body=dict_to_jso
-000179e0: 6e28 7072 6f6a 6563 7429 2c0a 2020 2020  n(project),.    
-000179f0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-00017a00: 2072 6573 706f 6e73 652e 7374 6174 7573   response.status
-00017a10: 5f63 6f64 6520 3d3d 2068 7474 702e 4854  _code == http.HT
-00017a20: 5450 5374 6174 7573 2e41 4343 4550 5445  TPStatus.ACCEPTE
-00017a30: 443a 0a20 2020 2020 2020 2020 2020 2072  D:.            r
-00017a40: 6574 7572 6e20 7365 6c66 2e5f 7761 6974  eturn self._wait
-00017a50: 5f66 6f72 5f70 726f 6a65 6374 5f74 6f5f  _for_project_to_
-00017a60: 7265 6163 685f 7465 726d 696e 616c 5f73  reach_terminal_s
-00017a70: 7461 7465 2870 726f 6a65 6374 5f6e 616d  tate(project_nam
-00017a80: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00017a90: 6e20 6d6c 7275 6e2e 7072 6f6a 6563 7473  n mlrun.projects
-00017aa0: 2e4d 6c72 756e 5072 6f6a 6563 742e 6672  .MlrunProject.fr
-00017ab0: 6f6d 5f64 6963 7428 7265 7370 6f6e 7365  om_dict(response
-00017ac0: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
-00017ad0: 6620 5f77 6169 745f 666f 725f 7072 6f6a  f _wait_for_proj
-00017ae0: 6563 745f 746f 5f72 6561 6368 5f74 6572  ect_to_reach_ter
-00017af0: 6d69 6e61 6c5f 7374 6174 6528 0a20 2020  minal_state(.   
-00017b00: 2020 2020 2073 656c 662c 2070 726f 6a65       self, proje
-00017b10: 6374 5f6e 616d 653a 2073 7472 0a20 2020  ct_name: str.   
-00017b20: 2029 202d 3e20 6d6c 7275 6e2e 7072 6f6a   ) -> mlrun.proj
-00017b30: 6563 7473 2e4d 6c72 756e 5072 6f6a 6563  ects.MlrunProjec
-00017b40: 743a 0a20 2020 2020 2020 2064 6566 205f  t:.        def _
-00017b50: 7665 7269 6679 5f70 726f 6a65 6374 5f69  verify_project_i
-00017b60: 6e5f 7465 726d 696e 616c 5f73 7461 7465  n_terminal_state
-00017b70: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00017b80: 7072 6f6a 6563 7420 3d20 7365 6c66 2e67  project = self.g
-00017b90: 6574 5f70 726f 6a65 6374 2870 726f 6a65  et_project(proje
-00017ba0: 6374 5f6e 616d 6529 0a20 2020 2020 2020  ct_name).       
-00017bb0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00017bc0: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-00017bd0: 742e 7374 6174 7573 2e73 7461 7465 0a20  t.status.state. 
-00017be0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00017bf0: 6f74 2069 6e20 6d6c 7275 6e2e 6170 692e  ot in mlrun.api.
-00017c00: 7363 6865 6d61 732e 5072 6f6a 6563 7453  schemas.ProjectS
-00017c10: 7461 7465 2e74 6572 6d69 6e61 6c5f 7374  tate.terminal_st
-00017c20: 6174 6573 2829 0a20 2020 2020 2020 2020  ates().         
-00017c30: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00017c40: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00017c50: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-00017c60: 2020 2020 2020 2020 2020 2066 2250 726f             f"Pro
-00017c70: 6a65 6374 206e 6f74 2069 6e20 7465 726d  ject not in term
-00017c80: 696e 616c 2073 7461 7465 2e20 5374 6174  inal state. Stat
-00017c90: 653a 207b 7072 6f6a 6563 742e 7374 6174  e: {project.stat
-00017ca0: 7573 2e73 7461 7465 7d22 0a20 2020 2020  us.state}".     
-00017cb0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00017cc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00017cd0: 7072 6f6a 6563 740a 0a20 2020 2020 2020  project..       
-00017ce0: 2072 6574 7572 6e20 6d6c 7275 6e2e 7574   return mlrun.ut
-00017cf0: 696c 732e 6865 6c70 6572 732e 7265 7472  ils.helpers.retr
-00017d00: 795f 756e 7469 6c5f 7375 6363 6573 7366  y_until_successf
-00017d10: 756c 280a 2020 2020 2020 2020 2020 2020  ul(.            
-00017d20: 7365 6c66 2e5f 7761 6974 5f66 6f72 5f70  self._wait_for_p
-00017d30: 726f 6a65 6374 5f74 6572 6d69 6e61 6c5f  roject_terminal_
-00017d40: 7374 6174 655f 7265 7472 795f 696e 7465  state_retry_inte
-00017d50: 7276 616c 2c0a 2020 2020 2020 2020 2020  rval,.          
-00017d60: 2020 3132 302c 0a20 2020 2020 2020 2020    120,.         
-00017d70: 2020 206c 6f67 6765 722c 0a20 2020 2020     logger,.     
-00017d80: 2020 2020 2020 2046 616c 7365 2c0a 2020         False,.  
-00017d90: 2020 2020 2020 2020 2020 5f76 6572 6966            _verif
-00017da0: 795f 7072 6f6a 6563 745f 696e 5f74 6572  y_project_in_ter
-00017db0: 6d69 6e61 6c5f 7374 6174 652c 0a20 2020  minal_state,.   
-00017dc0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00017dd0: 5f77 6169 745f 666f 725f 6261 636b 6772  _wait_for_backgr
-00017de0: 6f75 6e64 5f74 6173 6b5f 746f 5f72 6561  ound_task_to_rea
-00017df0: 6368 5f74 6572 6d69 6e61 6c5f 7374 6174  ch_terminal_stat
-00017e00: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-00017e10: 206e 616d 653a 2073 7472 0a20 2020 2029   name: str.    )
-00017e20: 202d 3e20 7363 6865 6d61 732e 4261 636b   -> schemas.Back
-00017e30: 6772 6f75 6e64 5461 736b 3a0a 2020 2020  groundTask:.    
-00017e40: 2020 2020 6465 6620 5f76 6572 6966 795f      def _verify_
-00017e50: 6261 636b 6772 6f75 6e64 5f74 6173 6b5f  background_task_
-00017e60: 696e 5f74 6572 6d69 6e61 6c5f 7374 6174  in_terminal_stat
-00017e70: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
-00017e80: 2062 6163 6b67 726f 756e 645f 7461 736b   background_task
-00017e90: 203d 2073 656c 662e 6765 745f 6261 636b   = self.get_back
-00017ea0: 6772 6f75 6e64 5f74 6173 6b28 6e61 6d65  ground_task(name
-00017eb0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-00017ec0: 6174 6520 3d20 6261 636b 6772 6f75 6e64  ate = background
-00017ed0: 5f74 6173 6b2e 7374 6174 7573 2e73 7461  _task.status.sta
-00017ee0: 7465 0a20 2020 2020 2020 2020 2020 2069  te.            i
-00017ef0: 6620 7374 6174 6520 6e6f 7420 696e 206d  f state not in m
-00017f00: 6c72 756e 2e61 7069 2e73 6368 656d 6173  lrun.api.schemas
-00017f10: 2e42 6163 6b67 726f 756e 6454 6173 6b53  .BackgroundTaskS
-00017f20: 7461 7465 2e74 6572 6d69 6e61 6c5f 7374  tate.terminal_st
-00017f30: 6174 6573 2829 3a0a 2020 2020 2020 2020  ates():.        
-00017f40: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00017f50: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-00017f60: 2020 2020 2020 2020 2020 2020 2066 2242               f"B
-00017f70: 6163 6b67 726f 756e 6420 7461 736b 206e  ackground task n
-00017f80: 6f74 2069 6e20 7465 726d 696e 616c 2073  ot in terminal s
-00017f90: 7461 7465 2e20 6e61 6d65 3d7b 6e61 6d65  tate. name={name
-00017fa0: 7d2c 2073 7461 7465 3d7b 7374 6174 657d  }, state={state}
-00017fb0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00017fc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00017fd0: 7265 7475 726e 2062 6163 6b67 726f 756e  return backgroun
-00017fe0: 645f 7461 736b 0a0a 2020 2020 2020 2020  d_task..        
-00017ff0: 7265 7475 726e 206d 6c72 756e 2e75 7469  return mlrun.uti
-00018000: 6c73 2e68 656c 7065 7273 2e72 6574 7279  ls.helpers.retry
-00018010: 5f75 6e74 696c 5f73 7563 6365 7373 6675  _until_successfu
-00018020: 6c28 0a20 2020 2020 2020 2020 2020 2073  l(.            s
-00018030: 656c 662e 5f77 6169 745f 666f 725f 6261  elf._wait_for_ba
-00018040: 636b 6772 6f75 6e64 5f74 6173 6b5f 7465  ckground_task_te
-00018050: 726d 696e 616c 5f73 7461 7465 5f72 6574  rminal_state_ret
-00018060: 7279 5f69 6e74 6572 7661 6c2c 0a20 2020  ry_interval,.   
-00018070: 2020 2020 2020 2020 2036 3020 2a20 3630           60 * 60
-00018080: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
-00018090: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
-000180a0: 2020 4661 6c73 652c 0a20 2020 2020 2020    False,.       
-000180b0: 2020 2020 205f 7665 7269 6679 5f62 6163       _verify_bac
-000180c0: 6b67 726f 756e 645f 7461 736b 5f69 6e5f  kground_task_in_
-000180d0: 7465 726d 696e 616c 5f73 7461 7465 2c0a  terminal_state,.
-000180e0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000180f0: 6566 205f 7761 6974 5f66 6f72 5f70 726f  ef _wait_for_pro
-00018100: 6a65 6374 5f74 6f5f 6265 5f64 656c 6574  ject_to_be_delet
-00018110: 6564 2873 656c 662c 2070 726f 6a65 6374  ed(self, project
-00018120: 5f6e 616d 653a 2073 7472 293a 0a20 2020  _name: str):.   
-00018130: 2020 2020 2064 6566 205f 7665 7269 6679       def _verify
-00018140: 5f70 726f 6a65 6374 5f64 656c 6574 6564  _project_deleted
-00018150: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00018160: 7072 6f6a 6563 7473 203d 2073 656c 662e  projects = self.
-00018170: 6c69 7374 5f70 726f 6a65 6374 7328 0a20  list_projects(. 
-00018180: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018190: 6f72 6d61 745f 3d6d 6c72 756e 2e61 7069  ormat_=mlrun.api
-000181a0: 2e73 6368 656d 6173 2e50 726f 6a65 6374  .schemas.Project
-000181b0: 7346 6f72 6d61 742e 6e61 6d65 5f6f 6e6c  sFormat.name_onl
-000181c0: 790a 2020 2020 2020 2020 2020 2020 290a  y.            ).
-000181d0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000181e0: 726f 6a65 6374 5f6e 616d 6520 696e 2070  roject_name in p
-000181f0: 726f 6a65 6374 733a 0a20 2020 2020 2020  rojects:.       
-00018200: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-00018210: 7863 6570 7469 6f6e 2822 5072 6f6a 6563  xception("Projec
-00018220: 7420 7374 696c 6c20 6578 6973 7473 2229  t still exists")
-00018230: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00018240: 206d 6c72 756e 2e75 7469 6c73 2e68 656c   mlrun.utils.hel
-00018250: 7065 7273 2e72 6574 7279 5f75 6e74 696c  pers.retry_until
-00018260: 5f73 7563 6365 7373 6675 6c28 0a20 2020  _successful(.   
-00018270: 2020 2020 2020 2020 2073 656c 662e 5f77           self._w
-00018280: 6169 745f 666f 725f 7072 6f6a 6563 745f  ait_for_project_
-00018290: 6465 6c65 7469 6f6e 5f69 6e74 6572 7661  deletion_interva
-000182a0: 6c2c 0a20 2020 2020 2020 2020 2020 2031  l,.            1
-000182b0: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
-000182c0: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
-000182d0: 2020 2020 4661 6c73 652c 0a20 2020 2020      False,.     
-000182e0: 2020 2020 2020 205f 7665 7269 6679 5f70         _verify_p
-000182f0: 726f 6a65 6374 5f64 656c 6574 6564 2c0a  roject_deleted,.
-00018300: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00018310: 6566 2063 7265 6174 655f 7072 6f6a 6563  ef create_projec
-00018320: 745f 7365 6372 6574 7328 0a20 2020 2020  t_secrets(.     
-00018330: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00018340: 2070 726f 6a65 6374 3a20 7374 722c 0a20   project: str,. 
-00018350: 2020 2020 2020 2070 726f 7669 6465 723a         provider:
-00018360: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
-00018370: 2020 2020 7374 722c 2073 6368 656d 6173      str, schemas
-00018380: 2e53 6563 7265 7450 726f 7669 6465 724e  .SecretProviderN
-00018390: 616d 650a 2020 2020 2020 2020 5d20 3d20  ame.        ] = 
-000183a0: 7363 6865 6d61 732e 5365 6372 6574 5072  schemas.SecretPr
-000183b0: 6f76 6964 6572 4e61 6d65 2e6b 7562 6572  oviderName.kuber
-000183c0: 6e65 7465 732c 0a20 2020 2020 2020 2073  netes,.        s
-000183d0: 6563 7265 7473 3a20 6469 6374 203d 204e  ecrets: dict = N
-000183e0: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-000183f0: 2020 2020 2222 2243 7265 6174 6520 7072      """Create pr
-00018400: 6f6a 6563 742d 636f 6e74 6578 7420 7365  oject-context se
-00018410: 6372 6574 7320 7573 696e 6720 6569 7468  crets using eith
-00018420: 6572 2060 6076 6175 6c74 6060 206f 7220  er ``vault`` or 
-00018430: 6060 6b75 6265 726e 6574 6573 6060 2070  ``kubernetes`` p
-00018440: 726f 7669 6465 722e 0a20 2020 2020 2020  rovider..       
-00018450: 2057 6865 6e20 7573 696e 6720 7769 7468   When using with
-00018460: 2056 6175 6c74 2c20 7468 6973 2077 696c   Vault, this wil
-00018470: 6c20 6372 6561 7465 206e 6565 6465 6420  l create needed 
-00018480: 5661 756c 7420 7374 7275 6374 7572 6573  Vault structures
-00018490: 2066 6f72 2073 746f 7269 6e67 2073 6563   for storing sec
-000184a0: 7265 7473 2069 6e20 7072 6f6a 6563 742d  rets in project-
-000184b0: 636f 6e74 6578 742c 2061 6e64 0a20 2020  context, and.   
-000184c0: 2020 2020 2073 746f 7265 2061 2073 6574       store a set
-000184d0: 206f 6620 7365 6372 6574 2076 616c 7565   of secret value
-000184e0: 732e 2054 6865 206d 6574 686f 6420 6765  s. The method ge
-000184f0: 6e65 7261 7465 7320 4b75 6265 726e 6574  nerates Kubernet
-00018500: 6573 2073 6572 7669 6365 2d61 6363 6f75  es service-accou
-00018510: 6e74 2061 6e64 2074 6865 2056 6175 6c74  nt and the Vault
-00018520: 2061 7574 6865 6e74 6963 6174 696f 6e0a   authentication.
-00018530: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-00018540: 6573 2074 6861 7420 6172 6520 7265 7175  es that are requ
-00018550: 6972 6564 2066 6f72 2066 756e 6374 696f  ired for functio
-00018560: 6e20 506f 6473 2074 6f20 6175 7468 656e  n Pods to authen
-00018570: 7469 6361 7465 2077 6974 6820 5661 756c  ticate with Vaul
-00018580: 7420 616e 6420 6265 2061 626c 6520 746f  t and be able to
-00018590: 2065 7874 7261 6374 2073 6563 7265 7420   extract secret 
-000185a0: 7661 6c75 6573 0a20 2020 2020 2020 2070  values.        p
-000185b0: 6173 7365 6420 6173 2070 6172 7420 6f66  assed as part of
-000185c0: 2074 6865 6972 2063 6f6e 7465 7874 2e0a   their context..
-000185d0: 0a20 2020 2020 2020 204e 6f74 653a 0a20  .        Note:. 
-000185e0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-000185f0: 6869 7320 6d65 7468 6f64 2075 7365 6420  his method used 
-00018600: 7769 7468 2056 6175 6c74 2069 7320 6375  with Vault is cu
-00018610: 7272 656e 746c 7920 696e 2074 6563 686e  rrently in techn
-00018620: 6963 616c 2070 7265 7669 6577 2c20 616e  ical preview, an
-00018630: 6420 7265 7175 6972 6573 2061 2048 6173  d requires a Has
-00018640: 6869 436f 7270 2056 6175 6c74 0a20 2020  hiCorp Vault.   
-00018650: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
-00018660: 7261 7374 7275 6374 7572 6520 7072 6f70  rastructure prop
-00018670: 6572 6c79 2073 6574 2075 7020 616e 6420  erly set up and 
-00018680: 636f 6e6e 6563 7465 6420 746f 2074 6865  connected to the
-00018690: 204d 4c52 756e 2041 5049 2073 6572 7665   MLRun API serve
-000186a0: 722e 0a0a 2020 2020 2020 2020 5768 656e  r...        When
-000186b0: 2075 7365 6420 7769 7468 204b 7562 6572   used with Kuber
-000186c0: 6e65 7465 732c 2074 6869 7320 7769 6c6c  netes, this will
-000186d0: 206d 616b 6520 7375 7265 2074 6861 7420   make sure that 
-000186e0: 7468 6520 7072 6f6a 6563 742d 7370 6563  the project-spec
-000186f0: 6966 6963 206b 3873 2073 6563 7265 7420  ific k8s secret 
-00018700: 6973 2063 7265 6174 6564 2c20 616e 6420  is created, and 
-00018710: 7769 6c6c 0a20 2020 2020 2020 2070 6f70  will.        pop
-00018720: 756c 6174 6520 6974 2077 6974 6820 7468  ulate it with th
-00018730: 6520 7365 6372 6574 7320 7072 6f76 6964  e secrets provid
-00018740: 6564 2c20 7265 706c 6163 696e 6720 7468  ed, replacing th
-00018750: 6569 7220 7661 6c75 6573 2069 6620 7468  eir values if th
-00018760: 6579 2065 7869 7374 2e0a 0a20 2020 2020  ey exist...     
-00018770: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00018780: 743a 2054 6865 2070 726f 6a65 6374 2063  t: The project c
-00018790: 6f6e 7465 7874 2066 6f72 2077 6869 6368  ontext for which
-000187a0: 2074 6f20 6765 6e65 7261 7465 2074 6865   to generate the
-000187b0: 2069 6e66 7261 2061 6e64 2073 746f 7265   infra and store
-000187c0: 2073 6563 7265 7473 2e0a 2020 2020 2020   secrets..      
-000187d0: 2020 3a70 6172 616d 2070 726f 7669 6465    :param provide
-000187e0: 723a 2054 6865 206e 616d 6520 6f66 2074  r: The name of t
-000187f0: 6865 2073 6563 7265 7473 2d70 726f 7669  he secrets-provi
-00018800: 6465 7220 746f 2077 6f72 6b20 7769 7468  der to work with
-00018810: 2e20 4163 6365 7074 7320 610a 2020 2020  . Accepts a.    
-00018820: 2020 2020 2020 2020 3a70 793a 636c 6173          :py:clas
-00018830: 733a 607e 6d6c 7275 6e2e 6170 692e 7363  s:`~mlrun.api.sc
-00018840: 6865 6d61 732e 7365 6372 6574 2e53 6563  hemas.secret.Sec
-00018850: 7265 7450 726f 7669 6465 724e 616d 6560  retProviderName`
-00018860: 2065 6e75 6d2e 0a20 2020 2020 2020 203a   enum..        :
-00018870: 7061 7261 6d20 7365 6372 6574 733a 2041  param secrets: A
-00018880: 2073 6574 206f 6620 7365 6372 6574 2076   set of secret v
-00018890: 616c 7565 7320 746f 2073 746f 7265 2e0a  alues to store..
-000188a0: 2020 2020 2020 2020 2020 2020 4578 616d              Exam
-000188b0: 706c 653a 3a0a 0a20 2020 2020 2020 2020  ple::..         
-000188c0: 2020 2020 2020 2073 6563 7265 7473 203d         secrets =
-000188d0: 207b 2770 6173 7377 6f72 6427 3a20 276d   {'password': 'm
-000188e0: 7950 6173 7377 3072 6427 2c20 2761 7773  yPassw0rd', 'aws
-000188f0: 5f6b 6579 273a 2027 3131 3132 3232 3333  _key': '11122233
-00018900: 3327 7d0a 2020 2020 2020 2020 2020 2020  3'}.            
-00018910: 2020 2020 6462 2e63 7265 6174 655f 7072      db.create_pr
-00018920: 6f6a 6563 745f 7365 6372 6574 7328 0a20  oject_secrets(. 
-00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018940: 2020 2022 7072 6f6a 6563 7431 222c 0a20     "project1",. 
-00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018960: 2020 2070 726f 7669 6465 723d 6d6c 7275     provider=mlru
-00018970: 6e2e 6170 692e 7363 6865 6d61 732e 5365  n.api.schemas.Se
-00018980: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
-00018990: 2e6b 7562 6572 6e65 7465 732c 0a20 2020  .kubernetes,.   
-000189a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189b0: 2073 6563 7265 7473 3d73 6563 7265 7473   secrets=secrets
-000189c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000189d0: 2029 0a20 2020 2020 2020 2022 2222 0a20   ).        """. 
-000189e0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-000189f0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00018a00: 747d 2f73 6563 7265 7473 220a 2020 2020  t}/secrets".    
-00018a10: 2020 2020 7365 6372 6574 735f 696e 7075      secrets_inpu
-00018a20: 7420 3d20 7363 6865 6d61 732e 5365 6372  t = schemas.Secr
-00018a30: 6574 7344 6174 6128 7365 6372 6574 733d  etsData(secrets=
-00018a40: 7365 6372 6574 732c 2070 726f 7669 6465  secrets, provide
-00018a50: 723d 7072 6f76 6964 6572 290a 2020 2020  r=provider).    
-00018a60: 2020 2020 626f 6479 203d 2073 6563 7265      body = secre
-00018a70: 7473 5f69 6e70 7574 2e64 6963 7428 290a  ts_input.dict().
-00018a80: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-00018a90: 7373 6167 6520 3d20 6622 4661 696c 6564  ssage = f"Failed
-00018aa0: 2063 7265 6174 696e 6720 7365 6372 6574   creating secret
-00018ab0: 2070 726f 7669 6465 7220 7b70 726f 6a65   provider {proje
-00018ac0: 6374 7d2f 7b70 726f 7669 6465 727d 220a  ct}/{provider}".
-00018ad0: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
-00018ae0: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-00018af0: 2020 2022 504f 5354 222c 0a20 2020 2020     "POST",.     
-00018b00: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
-00018b10: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
-00018b20: 6573 7361 6765 2c0a 2020 2020 2020 2020  essage,.        
-00018b30: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
-00018b40: 5f6a 736f 6e28 626f 6479 292c 0a20 2020  _json(body),.   
-00018b50: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00018b60: 6c69 7374 5f70 726f 6a65 6374 5f73 6563  list_project_sec
-00018b70: 7265 7473 280a 2020 2020 2020 2020 7365  rets(.        se
-00018b80: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
-00018b90: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
-00018ba0: 2020 746f 6b65 6e3a 2073 7472 203d 204e    token: str = N
-00018bb0: 6f6e 652c 0a20 2020 2020 2020 2070 726f  one,.        pro
-00018bc0: 7669 6465 723a 2055 6e69 6f6e 5b0a 2020  vider: Union[.  
-00018bd0: 2020 2020 2020 2020 2020 7374 722c 2073            str, s
-00018be0: 6368 656d 6173 2e53 6563 7265 7450 726f  chemas.SecretPro
-00018bf0: 7669 6465 724e 616d 650a 2020 2020 2020  viderName.      
-00018c00: 2020 5d20 3d20 7363 6865 6d61 732e 5365    ] = schemas.Se
-00018c10: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
-00018c20: 2e6b 7562 6572 6e65 7465 732c 0a20 2020  .kubernetes,.   
-00018c30: 2020 2020 2073 6563 7265 7473 3a20 4c69       secrets: Li
-00018c40: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  st[str] = None,.
-00018c50: 2020 2020 2920 2d3e 2073 6368 656d 6173      ) -> schemas
-00018c60: 2e53 6563 7265 7473 4461 7461 3a0a 2020  .SecretsData:.  
-00018c70: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
-00018c80: 6520 7072 6f6a 6563 742d 636f 6e74 6578  e project-contex
-00018c90: 7420 7365 6372 6574 7320 6672 6f6d 2056  t secrets from V
-00018ca0: 6175 6c74 2e0a 0a20 2020 2020 2020 204e  ault...        N
-00018cb0: 6f74 653a 0a20 2020 2020 2020 2020 2020  ote:.           
-00018cc0: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
-00018cd0: 2066 6f72 2056 6175 6c74 2066 756e 6374   for Vault funct
-00018ce0: 696f 6e61 6c69 7479 2069 7320 6375 7272  ionality is curr
-00018cf0: 656e 746c 7920 696e 2074 6563 686e 6963  ently in technic
-00018d00: 616c 2070 7265 7669 6577 2c20 616e 6420  al preview, and 
-00018d10: 7265 7175 6972 6573 2061 2048 6173 6869  requires a Hashi
-00018d20: 436f 7270 2056 6175 6c74 0a20 2020 2020  Corp Vault.     
-00018d30: 2020 2020 2020 2020 2020 2069 6e66 7261             infra
-00018d40: 7374 7275 6374 7572 6520 7072 6f70 6572  structure proper
-00018d50: 6c79 2073 6574 2075 7020 616e 6420 636f  ly set up and co
-00018d60: 6e6e 6563 7465 6420 746f 2074 6865 204d  nnected to the M
-00018d70: 4c52 756e 2041 5049 2073 6572 7665 722e  LRun API server.
-00018d80: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00018d90: 2070 726f 6a65 6374 3a20 5468 6520 7072   project: The pr
-00018da0: 6f6a 6563 7420 6e61 6d65 2e0a 2020 2020  oject name..    
-00018db0: 2020 2020 3a70 6172 616d 2074 6f6b 656e      :param token
-00018dc0: 3a20 5661 756c 7420 746f 6b65 6e20 746f  : Vault token to
-00018dd0: 2075 7365 2066 6f72 2072 6574 7269 6576   use for retriev
-00018de0: 696e 6720 7365 6372 6574 732e 0a20 2020  ing secrets..   
-00018df0: 2020 2020 2020 2020 204d 7573 7420 6265           Must be
-00018e00: 2061 2076 616c 6964 2056 6175 6c74 2074   a valid Vault t
-00018e10: 6f6b 656e 2c20 7769 7468 2070 6572 6d69  oken, with permi
-00018e20: 7373 696f 6e73 2074 6f20 7265 7472 6965  ssions to retrie
-00018e30: 7665 2073 6563 7265 7473 206f 6620 7468  ve secrets of th
-00018e40: 6520 7072 6f6a 6563 7420 696e 2071 7565  e project in que
-00018e50: 7374 696f 6e2e 0a20 2020 2020 2020 203a  stion..        :
-00018e60: 7061 7261 6d20 7072 6f76 6964 6572 3a20  param provider: 
-00018e70: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
-00018e80: 7365 6372 6574 732d 7072 6f76 6964 6572  secrets-provider
-00018e90: 2074 6f20 776f 726b 2077 6974 682e 2043   to work with. C
-00018ea0: 7572 7265 6e74 6c79 206f 6e6c 7920 6060  urrently only ``
-00018eb0: 7661 756c 7460 6020 6973 2061 6363 6570  vault`` is accep
-00018ec0: 7465 642e 0a20 2020 2020 2020 203a 7061  ted..        :pa
-00018ed0: 7261 6d20 7365 6372 6574 733a 2041 206c  ram secrets: A l
-00018ee0: 6973 7420 6f66 2073 6563 7265 7420 6e61  ist of secret na
-00018ef0: 6d65 7320 746f 2072 6574 7269 6576 652e  mes to retrieve.
-00018f00: 2041 6e20 656d 7074 7920 6c69 7374 2060   An empty list `
-00018f10: 605b 5d60 6020 7769 6c6c 2072 6574 7269  `[]`` will retri
-00018f20: 6576 6520 616c 6c20 7365 6372 6574 7320  eve all secrets 
-00018f30: 6173 7369 676e 6564 0a20 2020 2020 2020  assigned.       
-00018f40: 2020 2020 2074 6f20 7468 6973 2073 7065       to this spe
-00018f50: 6369 6669 6320 7072 6f6a 6563 742e 2060  cific project. `
-00018f60: 606b 7562 6572 6e65 7465 7360 6020 7072  `kubernetes`` pr
-00018f70: 6f76 6964 6572 206f 6e6c 7920 7375 7070  ovider only supp
-00018f80: 6f72 7473 2061 6e20 656d 7074 7920 6c69  orts an empty li
-00018f90: 7374 2e0a 2020 2020 2020 2020 2222 220a  st..        """.
-00018fa0: 0a20 2020 2020 2020 2069 6620 7072 6f76  .        if prov
-00018fb0: 6964 6572 203d 3d20 7363 6865 6d61 732e  ider == schemas.
-00018fc0: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
-00018fd0: 6d65 2e76 6175 6c74 2e76 616c 7565 2061  me.vault.value a
-00018fe0: 6e64 206e 6f74 2074 6f6b 656e 3a0a 2020  nd not token:.  
-00018ff0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00019000: 4d4c 5275 6e49 6e76 616c 6964 4172 6775  MLRunInvalidArgu
-00019010: 6d65 6e74 4572 726f 7228 0a20 2020 2020  mentError(.     
-00019020: 2020 2020 2020 2020 2020 2022 4120 7661             "A va
-00019030: 756c 7420 746f 6b65 6e20 6d75 7374 2062  ult token must b
-00019040: 6520 7072 6f76 6964 6564 2077 6865 6e20  e provided when 
-00019050: 6163 6365 7373 696e 6720 7661 756c 7420  accessing vault 
-00019060: 7365 6372 6574 7322 0a20 2020 2020 2020  secrets".       
-00019070: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00019080: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-00019090: 732f 7b70 726f 6a65 6374 7d2f 7365 6372  s/{project}/secr
-000190a0: 6574 7322 0a20 2020 2020 2020 2070 6172  ets".        par
-000190b0: 616d 7320 3d20 7b22 7072 6f76 6964 6572  ams = {"provider
-000190c0: 223a 2070 726f 7669 6465 722c 2022 7365  ": provider, "se
-000190d0: 6372 6574 223a 2073 6563 7265 7473 7d0a  cret": secrets}.
-000190e0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
-000190f0: 3d20 7b73 6368 656d 6173 2e48 6561 6465  = {schemas.Heade
-00019100: 724e 616d 6573 2e73 6563 7265 745f 7374  rNames.secret_st
-00019110: 6f72 655f 746f 6b65 6e3a 2074 6f6b 656e  ore_token: token
-00019120: 7d0a 2020 2020 2020 2020 6572 726f 725f  }.        error_
-00019130: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00019140: 6564 2072 6574 7269 6576 696e 6720 7365  ed retrieving se
-00019150: 6372 6574 7320 7b70 726f 6a65 6374 7d2f  crets {project}/
-00019160: 7b70 726f 7669 6465 727d 220a 2020 2020  {provider}".    
-00019170: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00019180: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-00019190: 2020 2020 2020 2020 2247 4554 222c 0a20          "GET",. 
-000191a0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-000191b0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-000191c0: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
-000191d0: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
-000191e0: 6172 616d 732c 0a20 2020 2020 2020 2020  arams,.         
-000191f0: 2020 2068 6561 6465 7273 3d68 6561 6465     headers=heade
-00019200: 7273 2c0a 2020 2020 2020 2020 290a 2020  rs,.        ).  
-00019210: 2020 2020 2020 7265 7475 726e 2073 6368        return sch
-00019220: 656d 6173 2e53 6563 7265 7473 4461 7461  emas.SecretsData
-00019230: 282a 2a72 6573 756c 742e 6a73 6f6e 2829  (**result.json()
-00019240: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
-00019250: 7072 6f6a 6563 745f 7365 6372 6574 5f6b  project_secret_k
-00019260: 6579 7328 0a20 2020 2020 2020 2073 656c  eys(.        sel
-00019270: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
-00019280: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
-00019290: 2070 726f 7669 6465 723a 2055 6e69 6f6e   provider: Union
-000192a0: 5b0a 2020 2020 2020 2020 2020 2020 7374  [.            st
-000192b0: 722c 2073 6368 656d 6173 2e53 6563 7265  r, schemas.Secre
-000192c0: 7450 726f 7669 6465 724e 616d 650a 2020  tProviderName.  
-000192d0: 2020 2020 2020 5d20 3d20 7363 6865 6d61        ] = schema
-000192e0: 732e 5365 6372 6574 5072 6f76 6964 6572  s.SecretProvider
-000192f0: 4e61 6d65 2e6b 7562 6572 6e65 7465 732c  Name.kubernetes,
-00019300: 0a20 2020 2020 2020 2074 6f6b 656e 3a20  .        token: 
-00019310: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
-00019320: 2920 2d3e 2073 6368 656d 6173 2e53 6563  ) -> schemas.Sec
-00019330: 7265 744b 6579 7344 6174 613a 0a20 2020  retKeysData:.   
-00019340: 2020 2020 2022 2222 5265 7472 6965 7665       """Retrieve
-00019350: 2070 726f 6a65 6374 2d63 6f6e 7465 7874   project-context
-00019360: 2073 6563 7265 7420 6b65 7973 2066 726f   secret keys fro
-00019370: 6d20 5661 756c 7420 6f72 204b 7562 6572  m Vault or Kuber
-00019380: 6e65 7465 732e 0a0a 2020 2020 2020 2020  netes...        
-00019390: 4e6f 7465 3a0a 2020 2020 2020 2020 2020  Note:.          
-000193a0: 2020 2020 2020 5468 6973 206d 6574 686f        This metho
-000193b0: 6420 666f 7220 5661 756c 7420 6675 6e63  d for Vault func
-000193c0: 7469 6f6e 616c 6974 7920 6973 2063 7572  tionality is cur
-000193d0: 7265 6e74 6c79 2069 6e20 7465 6368 6e69  rently in techni
-000193e0: 6361 6c20 7072 6576 6965 772c 2061 6e64  cal preview, and
-000193f0: 2072 6571 7569 7265 7320 6120 4861 7368   requires a Hash
-00019400: 6943 6f72 7020 5661 756c 740a 2020 2020  iCorp Vault.    
-00019410: 2020 2020 2020 2020 2020 2020 696e 6672              infr
-00019420: 6173 7472 7563 7475 7265 2070 726f 7065  astructure prope
-00019430: 726c 7920 7365 7420 7570 2061 6e64 2063  rly set up and c
-00019440: 6f6e 6e65 6374 6564 2074 6f20 7468 6520  onnected to the 
-00019450: 4d4c 5275 6e20 4150 4920 7365 7276 6572  MLRun API server
-00019460: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00019470: 6d20 7072 6f6a 6563 743a 2054 6865 2070  m project: The p
-00019480: 726f 6a65 6374 206e 616d 652e 0a20 2020  roject name..   
-00019490: 2020 2020 203a 7061 7261 6d20 7072 6f76       :param prov
-000194a0: 6964 6572 3a20 5468 6520 6e61 6d65 206f  ider: The name o
-000194b0: 6620 7468 6520 7365 6372 6574 732d 7072  f the secrets-pr
-000194c0: 6f76 6964 6572 2074 6f20 776f 726b 2077  ovider to work w
-000194d0: 6974 682e 2041 6363 6570 7473 2061 0a20  ith. Accepts a. 
-000194e0: 2020 2020 2020 2020 2020 203a 7079 3a63             :py:c
-000194f0: 6c61 7373 3a60 7e6d 6c72 756e 2e61 7069  lass:`~mlrun.api
-00019500: 2e73 6368 656d 6173 2e73 6563 7265 742e  .schemas.secret.
-00019510: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
-00019520: 6d65 6020 656e 756d 2e0a 2020 2020 2020  me` enum..      
-00019530: 2020 3a70 6172 616d 2074 6f6b 656e 3a20    :param token: 
-00019540: 5661 756c 7420 746f 6b65 6e20 746f 2075  Vault token to u
-00019550: 7365 2066 6f72 2072 6574 7269 6576 696e  se for retrievin
-00019560: 6720 7365 6372 6574 732e 204f 6e6c 7920  g secrets. Only 
-00019570: 696e 2075 7365 2069 6620 6060 7072 6f76  in use if ``prov
-00019580: 6964 6572 6060 2069 7320 6060 7661 756c  ider`` is ``vaul
-00019590: 7460 602e 0a20 2020 2020 2020 2020 2020  t``..           
-000195a0: 204d 7573 7420 6265 2061 2076 616c 6964   Must be a valid
-000195b0: 2056 6175 6c74 2074 6f6b 656e 2c20 7769   Vault token, wi
-000195c0: 7468 2070 6572 6d69 7373 696f 6e73 2074  th permissions t
-000195d0: 6f20 7265 7472 6965 7665 2073 6563 7265  o retrieve secre
-000195e0: 7473 206f 6620 7468 6520 7072 6f6a 6563  ts of the projec
-000195f0: 7420 696e 2071 7565 7374 696f 6e2e 0a20  t in question.. 
-00019600: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00019610: 2020 2020 6966 2070 726f 7669 6465 7220      if provider 
-00019620: 3d3d 2073 6368 656d 6173 2e53 6563 7265  == schemas.Secre
-00019630: 7450 726f 7669 6465 724e 616d 652e 7661  tProviderName.va
-00019640: 756c 742e 7661 6c75 6520 616e 6420 6e6f  ult.value and no
-00019650: 7420 746f 6b65 6e3a 0a20 2020 2020 2020  t token:.       
-00019660: 2020 2020 2072 6169 7365 204d 4c52 756e       raise MLRun
-00019670: 496e 7661 6c69 6441 7267 756d 656e 7445  InvalidArgumentE
-00019680: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00019690: 2020 2020 2020 2241 2076 6175 6c74 2074        "A vault t
-000196a0: 6f6b 656e 206d 7573 7420 6265 2070 726f  oken must be pro
-000196b0: 7669 6465 6420 7768 656e 2061 6363 6573  vided when acces
-000196c0: 7369 6e67 2076 6175 6c74 2073 6563 7265  sing vault secre
-000196d0: 7473 220a 2020 2020 2020 2020 2020 2020  ts".            
-000196e0: 290a 0a20 2020 2020 2020 2070 6174 6820  )..        path 
-000196f0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00019700: 6f6a 6563 747d 2f73 6563 7265 742d 6b65  oject}/secret-ke
-00019710: 7973 220a 2020 2020 2020 2020 7061 7261  ys".        para
-00019720: 6d73 203d 207b 2270 726f 7669 6465 7222  ms = {"provider"
-00019730: 3a20 7072 6f76 6964 6572 7d0a 2020 2020  : provider}.    
-00019740: 2020 2020 6865 6164 6572 7320 3d20 280a      headers = (.
-00019750: 2020 2020 2020 2020 2020 2020 7b73 6368              {sch
-00019760: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
-00019770: 2e73 6563 7265 745f 7374 6f72 655f 746f  .secret_store_to
-00019780: 6b65 6e3a 2074 6f6b 656e 7d0a 2020 2020  ken: token}.    
-00019790: 2020 2020 2020 2020 6966 2070 726f 7669          if provi
-000197a0: 6465 7220 3d3d 2073 6368 656d 6173 2e53  der == schemas.S
-000197b0: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
-000197c0: 652e 7661 756c 742e 7661 6c75 650a 2020  e.vault.value.  
-000197d0: 2020 2020 2020 2020 2020 656c 7365 204e            else N
-000197e0: 6f6e 650a 2020 2020 2020 2020 290a 2020  one.        ).  
-000197f0: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-00019800: 6167 6520 3d20 6622 4661 696c 6564 2072  age = f"Failed r
-00019810: 6574 7269 6576 696e 6720 7365 6372 6574  etrieving secret
-00019820: 206b 6579 7320 7b70 726f 6a65 6374 7d2f   keys {project}/
-00019830: 7b70 726f 7669 6465 727d 220a 2020 2020  {provider}".    
-00019840: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00019850: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-00019860: 2020 2020 2020 2020 2247 4554 222c 0a20          "GET",. 
-00019870: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-00019880: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-00019890: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
-000198a0: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
-000198b0: 6172 616d 732c 0a20 2020 2020 2020 2020  arams,.         
-000198c0: 2020 2068 6561 6465 7273 3d68 6561 6465     headers=heade
-000198d0: 7273 2c0a 2020 2020 2020 2020 290a 2020  rs,.        ).  
-000198e0: 2020 2020 2020 7265 7475 726e 2073 6368        return sch
-000198f0: 656d 6173 2e53 6563 7265 744b 6579 7344  emas.SecretKeysD
-00019900: 6174 6128 2a2a 7265 7375 6c74 2e6a 736f  ata(**result.jso
-00019910: 6e28 2929 0a0a 2020 2020 6465 6620 6465  n())..    def de
-00019920: 6c65 7465 5f70 726f 6a65 6374 5f73 6563  lete_project_sec
-00019930: 7265 7473 280a 2020 2020 2020 2020 7365  rets(.        se
-00019940: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
-00019950: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
-00019960: 2020 7072 6f76 6964 6572 3a20 556e 696f    provider: Unio
-00019970: 6e5b 0a20 2020 2020 2020 2020 2020 2073  n[.            s
-00019980: 7472 2c20 7363 6865 6d61 732e 5365 6372  tr, schemas.Secr
-00019990: 6574 5072 6f76 6964 6572 4e61 6d65 0a20  etProviderName. 
-000199a0: 2020 2020 2020 205d 203d 2073 6368 656d         ] = schem
-000199b0: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
-000199c0: 724e 616d 652e 6b75 6265 726e 6574 6573  rName.kubernetes
-000199d0: 2c0a 2020 2020 2020 2020 7365 6372 6574  ,.        secret
-000199e0: 733a 204c 6973 745b 7374 725d 203d 204e  s: List[str] = N
-000199f0: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-00019a00: 2020 2020 2222 2244 656c 6574 6520 7072      """Delete pr
-00019a10: 6f6a 6563 742d 636f 6e74 6578 7420 7365  oject-context se
-00019a20: 6372 6574 7320 6672 6f6d 204b 7562 6572  crets from Kuber
-00019a30: 6e65 7465 732e 0a0a 2020 2020 2020 2020  netes...        
-00019a40: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-00019a50: 5468 6520 7072 6f6a 6563 7420 6e61 6d65  The project name
-00019a60: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00019a70: 2070 726f 7669 6465 723a 2054 6865 206e   provider: The n
-00019a80: 616d 6520 6f66 2074 6865 2073 6563 7265  ame of the secre
-00019a90: 7473 2d70 726f 7669 6465 7220 746f 2077  ts-provider to w
-00019aa0: 6f72 6b20 7769 7468 2e20 4375 7272 656e  ork with. Curren
-00019ab0: 746c 7920 6f6e 6c79 2060 606b 7562 6572  tly only ``kuber
-00019ac0: 6e65 7465 7360 6020 6973 2073 7570 706f  netes`` is suppo
-00019ad0: 7274 6564 2e0a 2020 2020 2020 2020 3a70  rted..        :p
-00019ae0: 6172 616d 2073 6563 7265 7473 3a20 4120  aram secrets: A 
-00019af0: 6c69 7374 206f 6620 7365 6372 6574 206e  list of secret n
-00019b00: 616d 6573 2074 6f20 6465 6c65 7465 2e20  ames to delete. 
-00019b10: 416e 2065 6d70 7479 206c 6973 7420 7769  An empty list wi
-00019b20: 6c6c 2064 656c 6574 6520 616c 6c20 7365  ll delete all se
-00019b30: 6372 6574 7320 6173 7369 676e 6564 0a20  crets assigned. 
-00019b40: 2020 2020 2020 2020 2020 2074 6f20 7468             to th
-00019b50: 6973 2073 7065 6369 6669 6320 7072 6f6a  is specific proj
-00019b60: 6563 742e 0a20 2020 2020 2020 2022 2222  ect..        """
-00019b70: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
-00019b80: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-00019b90: 6a65 6374 7d2f 7365 6372 6574 7322 0a20  ject}/secrets". 
-00019ba0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-00019bb0: 7b22 7072 6f76 6964 6572 223a 2070 726f  {"provider": pro
-00019bc0: 7669 6465 722c 2022 7365 6372 6574 223a  vider, "secret":
-00019bd0: 2073 6563 7265 7473 7d0a 2020 2020 2020   secrets}.      
-00019be0: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
-00019bf0: 3d20 6622 4661 696c 6564 2064 656c 6574  = f"Failed delet
-00019c00: 696e 6720 7365 6372 6574 7320 7b70 726f  ing secrets {pro
-00019c10: 6a65 6374 7d2f 7b70 726f 7669 6465 727d  ject}/{provider}
-00019c20: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-00019c30: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-00019c40: 2020 2020 2022 4445 4c45 5445 222c 0a20       "DELETE",. 
-00019c50: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-00019c60: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-00019c70: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
-00019c80: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
-00019c90: 6172 616d 732c 0a20 2020 2020 2020 2029  arams,.        )
-00019ca0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00019cb0: 5f75 7365 725f 7365 6372 6574 7328 0a20  _user_secrets(. 
-00019cc0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00019cd0: 2020 2020 2075 7365 723a 2073 7472 2c0a       user: str,.
-00019ce0: 2020 2020 2020 2020 7072 6f76 6964 6572          provider
-00019cf0: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
-00019d00: 2020 2020 2073 7472 2c20 7363 6865 6d61       str, schema
-00019d10: 732e 5365 6372 6574 5072 6f76 6964 6572  s.SecretProvider
-00019d20: 4e61 6d65 0a20 2020 2020 2020 205d 203d  Name.        ] =
-00019d30: 2073 6368 656d 6173 2e53 6563 7265 7450   schemas.SecretP
-00019d40: 726f 7669 6465 724e 616d 652e 7661 756c  roviderName.vaul
-00019d50: 742c 0a20 2020 2020 2020 2073 6563 7265  t,.        secre
-00019d60: 7473 3a20 6469 6374 203d 204e 6f6e 652c  ts: dict = None,
-00019d70: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00019d80: 2222 2243 7265 6174 6520 7573 6572 2d63  """Create user-c
-00019d90: 6f6e 7465 7874 2073 6563 7265 7420 696e  ontext secret in
-00019da0: 2056 6175 6c74 2e20 506c 6561 7365 2072   Vault. Please r
-00019db0: 6566 6572 2074 6f20 3a70 793a 6675 6e63  efer to :py:func
-00019dc0: 3a60 6372 6561 7465 5f70 726f 6a65 6374  :`create_project
-00019dd0: 5f73 6563 7265 7473 6020 666f 7220 6d6f  _secrets` for mo
-00019de0: 7265 2064 6574 6169 6c73 0a20 2020 2020  re details.     
-00019df0: 2020 2061 6e64 2073 7461 7475 7320 6f66     and status of
-00019e00: 2074 6869 7320 6675 6e63 7469 6f6e 616c   this functional
-00019e10: 6974 792e 0a0a 2020 2020 2020 2020 4e6f  ity...        No
-00019e20: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-00019e30: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
-00019e40: 6973 2063 7572 7265 6e74 6c79 2069 6e20  is currently in 
-00019e50: 7465 6368 6e69 6361 6c20 7072 6576 6965  technical previe
-00019e60: 772c 2061 6e64 2072 6571 7569 7265 7320  w, and requires 
-00019e70: 6120 4861 7368 6943 6f72 7020 5661 756c  a HashiCorp Vaul
-00019e80: 7420 696e 6672 6173 7472 7563 7475 7265  t infrastructure
-00019e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019ea0: 2070 726f 7065 726c 7920 7365 7420 7570   properly set up
-00019eb0: 2061 6e64 2063 6f6e 6e65 6374 6564 2074   and connected t
-00019ec0: 6f20 7468 6520 4d4c 5275 6e20 4150 4920  o the MLRun API 
-00019ed0: 7365 7276 6572 2e0a 0a20 2020 2020 2020  server...       
-00019ee0: 203a 7061 7261 6d20 7573 6572 3a20 5468   :param user: Th
-00019ef0: 6520 7573 6572 2063 6f6e 7465 7874 2066  e user context f
-00019f00: 6f72 2077 6869 6368 2074 6f20 6765 6e65  or which to gene
-00019f10: 7261 7465 2074 6865 2069 6e66 7261 2061  rate the infra a
-00019f20: 6e64 2073 746f 7265 2073 6563 7265 7473  nd store secrets
-00019f30: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00019f40: 2070 726f 7669 6465 723a 2054 6865 206e   provider: The n
-00019f50: 616d 6520 6f66 2074 6865 2073 6563 7265  ame of the secre
-00019f60: 7473 2d70 726f 7669 6465 7220 746f 2077  ts-provider to w
-00019f70: 6f72 6b20 7769 7468 2e20 4375 7272 656e  ork with. Curren
-00019f80: 746c 7920 6f6e 6c79 2060 6076 6175 6c74  tly only ``vault
-00019f90: 6060 2069 7320 7375 7070 6f72 7465 642e  `` is supported.
-00019fa0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00019fb0: 7365 6372 6574 733a 2041 2073 6574 206f  secrets: A set o
-00019fc0: 6620 7365 6372 6574 2076 616c 7565 7320  f secret values 
-00019fd0: 746f 2073 746f 7265 2077 6974 6869 6e20  to store within 
-00019fe0: 7468 6520 5661 756c 742e 0a20 2020 2020  the Vault..     
-00019ff0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-0001a000: 6174 6820 3d20 2275 7365 722d 7365 6372  ath = "user-secr
-0001a010: 6574 7322 0a20 2020 2020 2020 2073 6563  ets".        sec
-0001a020: 7265 7473 5f63 7265 6174 696f 6e5f 7265  rets_creation_re
-0001a030: 7175 6573 7420 3d20 7363 6865 6d61 732e  quest = schemas.
-0001a040: 5573 6572 5365 6372 6574 4372 6561 7469  UserSecretCreati
-0001a050: 6f6e 5265 7175 6573 7428 0a20 2020 2020  onRequest(.     
-0001a060: 2020 2020 2020 2075 7365 723d 7573 6572         user=user
-0001a070: 2c0a 2020 2020 2020 2020 2020 2020 7072  ,.            pr
-0001a080: 6f76 6964 6572 3d70 726f 7669 6465 722c  ovider=provider,
-0001a090: 0a20 2020 2020 2020 2020 2020 2073 6563  .            sec
-0001a0a0: 7265 7473 3d73 6563 7265 7473 2c0a 2020  rets=secrets,.  
-0001a0b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001a0c0: 626f 6479 203d 2073 6563 7265 7473 5f63  body = secrets_c
-0001a0d0: 7265 6174 696f 6e5f 7265 7175 6573 742e  reation_request.
-0001a0e0: 6469 6374 2829 0a20 2020 2020 2020 2065  dict().        e
-0001a0f0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
-0001a100: 2246 6169 6c65 6420 6372 6561 7469 6e67  "Failed creating
-0001a110: 2075 7365 7220 7365 6372 6574 7320 2d20   user secrets - 
-0001a120: 7b75 7365 727d 220a 2020 2020 2020 2020  {user}".        
-0001a130: 7365 6c66 2e61 7069 5f63 616c 6c28 0a20  self.api_call(. 
-0001a140: 2020 2020 2020 2020 2020 2022 504f 5354             "POST
-0001a150: 222c 0a20 2020 2020 2020 2020 2020 2070  ",.            p
-0001a160: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0001a170: 2065 7272 6f72 5f6d 6573 7361 6765 2c0a   error_message,.
-0001a180: 2020 2020 2020 2020 2020 2020 626f 6479              body
-0001a190: 3d64 6963 745f 746f 5f6a 736f 6e28 626f  =dict_to_json(bo
-0001a1a0: 6479 292c 0a20 2020 2020 2020 2029 0a0a  dy),.        )..
-0001a1b0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-0001a1c0: 640a 2020 2020 6465 6620 5f76 616c 6964  d.    def _valid
-0001a1d0: 6174 655f 7665 7273 696f 6e5f 636f 6d70  ate_version_comp
-0001a1e0: 6174 6962 696c 6974 7928 7365 7276 6572  atibility(server
-0001a1f0: 5f76 6572 7369 6f6e 2c20 636c 6965 6e74  _version, client
-0001a200: 5f76 6572 7369 6f6e 2920 2d3e 2062 6f6f  _version) -> boo
-0001a210: 6c3a 0a20 2020 2020 2020 2074 7279 3a0a  l:.        try:.
-0001a220: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-0001a230: 6564 5f73 6572 7665 725f 7665 7273 696f  ed_server_versio
-0001a240: 6e20 3d20 7365 6d76 6572 2e56 6572 7369  n = semver.Versi
-0001a250: 6f6e 496e 666f 2e70 6172 7365 2873 6572  onInfo.parse(ser
-0001a260: 7665 725f 7665 7273 696f 6e29 0a20 2020  ver_version).   
-0001a270: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
-0001a280: 636c 6965 6e74 5f76 6572 7369 6f6e 203d  client_version =
-0001a290: 2073 656d 7665 722e 5665 7273 696f 6e49   semver.VersionI
-0001a2a0: 6e66 6f2e 7061 7273 6528 636c 6965 6e74  nfo.parse(client
-0001a2b0: 5f76 6572 7369 6f6e 290a 2020 2020 2020  _version).      
-0001a2c0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
-0001a2d0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0001a2e0: 2023 2054 6869 7320 7769 6c6c 206d 6f73   # This will mos
-0001a2f0: 746c 7920 6861 7070 656e 2069 6e20 6465  tly happen in de
-0001a300: 7620 7363 656e 6172 696f 7320 7768 656e  v scenarios when
-0001a310: 2074 6865 2076 6572 7369 6f6e 2069 7320   the version is 
-0001a320: 756e 7374 6162 6c65 2061 6e64 2073 7563  unstable and suc
-0001a330: 6820 2d20 7468 6572 6566 6f72 6520 7765  h - therefore we
-0001a340: 2772 6520 6967 6e6f 7269 6e67 0a20 2020  're ignoring.   
-0001a350: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0001a360: 7761 726e 696e 6728 0a20 2020 2020 2020  warning(.       
-0001a370: 2020 2020 2020 2020 2022 556e 6162 6c65           "Unable
-0001a380: 2074 6f20 7061 7273 6520 7365 7276 6572   to parse server
-0001a390: 206f 7220 636c 6965 6e74 2076 6572 7369   or client versi
-0001a3a0: 6f6e 2e20 4173 7375 6d69 6e67 2063 6f6d  on. Assuming com
-0001a3b0: 7061 7469 626c 6522 2c0a 2020 2020 2020  patible",.      
-0001a3c0: 2020 2020 2020 2020 2020 7365 7276 6572            server
-0001a3d0: 5f76 6572 7369 6f6e 3d73 6572 7665 725f  _version=server_
-0001a3e0: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
-0001a3f0: 2020 2020 2020 2020 2063 6c69 656e 745f           client_
-0001a400: 7665 7273 696f 6e3d 636c 6965 6e74 5f76  version=client_v
-0001a410: 6572 7369 6f6e 2c0a 2020 2020 2020 2020  ersion,.        
-0001a420: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001a430: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-0001a440: 2020 2020 2020 6966 2028 7061 7273 6564        if (parsed
-0001a450: 5f73 6572 7665 725f 7665 7273 696f 6e2e  _server_version.
-0001a460: 6d61 6a6f 7220 3d3d 2030 2061 6e64 2070  major == 0 and p
-0001a470: 6172 7365 645f 7365 7276 6572 5f76 6572  arsed_server_ver
-0001a480: 7369 6f6e 2e6d 696e 6f72 203d 3d20 3029  sion.minor == 0)
-0001a490: 206f 7220 280a 2020 2020 2020 2020 2020   or (.          
-0001a4a0: 2020 7061 7273 6564 5f63 6c69 656e 745f    parsed_client_
-0001a4b0: 7665 7273 696f 6e2e 6d61 6a6f 7220 3d3d  version.major ==
-0001a4c0: 2030 2061 6e64 2070 6172 7365 645f 636c   0 and parsed_cl
-0001a4d0: 6965 6e74 5f76 6572 7369 6f6e 2e6d 696e  ient_version.min
-0001a4e0: 6f72 203d 3d20 300a 2020 2020 2020 2020  or == 0.        
-0001a4f0: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
-0001a500: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
-0001a510: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001a520: 5365 7276 6572 206f 7220 636c 6965 6e74  Server or client
-0001a530: 2076 6572 7369 6f6e 2069 7320 756e 7374   version is unst
-0001a540: 6162 6c65 2e20 4173 7375 6d69 6e67 2063  able. Assuming c
-0001a550: 6f6d 7061 7469 626c 6522 2c0a 2020 2020  ompatible",.    
-0001a560: 2020 2020 2020 2020 2020 2020 7365 7276              serv
-0001a570: 6572 5f76 6572 7369 6f6e 3d73 6572 7665  er_version=serve
-0001a580: 725f 7665 7273 696f 6e2c 0a20 2020 2020  r_version,.     
-0001a590: 2020 2020 2020 2020 2020 2063 6c69 656e             clien
-0001a5a0: 745f 7665 7273 696f 6e3d 636c 6965 6e74  t_version=client
-0001a5b0: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
-0001a5c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001a5d0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-0001a5e0: 2020 2020 2020 2020 6966 2070 6172 7365          if parse
-0001a5f0: 645f 7365 7276 6572 5f76 6572 7369 6f6e  d_server_version
-0001a600: 2e6d 616a 6f72 2021 3d20 7061 7273 6564  .major != parsed
-0001a610: 5f63 6c69 656e 745f 7665 7273 696f 6e2e  _client_version.
-0001a620: 6d61 6a6f 723a 0a20 2020 2020 2020 2020  major:.         
-0001a630: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-0001a640: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
-0001a650: 2020 2022 5365 7276 6572 2061 6e64 2063     "Server and c
-0001a660: 6c69 656e 7420 7665 7273 696f 6e73 2061  lient versions a
-0001a670: 7265 2069 6e63 6f6d 7061 7469 626c 6522  re incompatible"
-0001a680: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a690: 2020 7061 7273 6564 5f73 6572 7665 725f    parsed_server_
-0001a6a0: 7665 7273 696f 6e3d 7061 7273 6564 5f73  version=parsed_s
-0001a6b0: 6572 7665 725f 7665 7273 696f 6e2c 0a20  erver_version,. 
-0001a6c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001a6d0: 6172 7365 645f 636c 6965 6e74 5f76 6572  arsed_client_ver
-0001a6e0: 7369 6f6e 3d70 6172 7365 645f 636c 6965  sion=parsed_clie
-0001a6f0: 6e74 5f76 6572 7369 6f6e 2c0a 2020 2020  nt_version,.    
-0001a700: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001a710: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001a720: 7365 0a20 2020 2020 2020 2069 6620 7061  se.        if pa
-0001a730: 7273 6564 5f73 6572 7665 725f 7665 7273  rsed_server_vers
-0001a740: 696f 6e2e 6d69 6e6f 7220 3e20 7061 7273  ion.minor > pars
-0001a750: 6564 5f63 6c69 656e 745f 7665 7273 696f  ed_client_versio
-0001a760: 6e2e 6d69 6e6f 7220 2b20 323a 0a20 2020  n.minor + 2:.   
-0001a770: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0001a780: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-0001a790: 2020 2020 2020 2242 6163 6b77 6172 6473        "Backwards
-0001a7a0: 2063 6f6d 7061 7469 6269 6c69 7479 206d   compatibility m
-0001a7b0: 6967 6874 206e 6f74 2061 7070 6c79 2062  ight not apply b
-0001a7c0: 6574 7765 656e 2074 6865 2073 6572 7665  etween the serve
-0001a7d0: 7220 616e 6420 636c 6965 6e74 2076 6572  r and client ver
-0001a7e0: 7369 6f6e 222c 0a20 2020 2020 2020 2020  sion",.         
-0001a7f0: 2020 2020 2020 2070 6172 7365 645f 7365         parsed_se
-0001a800: 7276 6572 5f76 6572 7369 6f6e 3d70 6172  rver_version=par
-0001a810: 7365 645f 7365 7276 6572 5f76 6572 7369  sed_server_versi
-0001a820: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0001a830: 2020 2020 7061 7273 6564 5f63 6c69 656e      parsed_clien
-0001a840: 745f 7665 7273 696f 6e3d 7061 7273 6564  t_version=parsed
-0001a850: 5f63 6c69 656e 745f 7665 7273 696f 6e2c  _client_version,
-0001a860: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001a870: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001a880: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-0001a890: 6966 2070 6172 7365 645f 636c 6965 6e74  if parsed_client
-0001a8a0: 5f76 6572 7369 6f6e 2e6d 696e 6f72 203e  _version.minor >
-0001a8b0: 2070 6172 7365 645f 7365 7276 6572 5f76   parsed_server_v
-0001a8c0: 6572 7369 6f6e 2e6d 696e 6f72 3a0a 2020  ersion.minor:.  
-0001a8d0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0001a8e0: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
-0001a8f0: 2020 2020 2020 2020 2020 2243 6c69 656e            "Clien
-0001a900: 7420 7665 7273 696f 6e20 7769 7468 2068  t version with h
-0001a910: 6967 6865 7220 7665 7273 696f 6e20 7468  igher version th
-0001a920: 616e 2073 6572 7665 7220 7665 7273 696f  an server versio
-0001a930: 6e20 6973 6e27 7420 7375 7070 6f72 7465  n isn't supporte
-0001a940: 642c 220a 2020 2020 2020 2020 2020 2020  d,".            
-0001a950: 2020 2020 2220 616c 6967 6e20 796f 7572      " align your
-0001a960: 2063 6c69 656e 7420 746f 2074 6865 2073   client to the s
-0001a970: 6572 7665 7220 7665 7273 696f 6e22 2c0a  erver version",.
-0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a990: 7061 7273 6564 5f73 6572 7665 725f 7665  parsed_server_ve
-0001a9a0: 7273 696f 6e3d 7061 7273 6564 5f73 6572  rsion=parsed_ser
-0001a9b0: 7665 725f 7665 7273 696f 6e2c 0a20 2020  ver_version,.   
-0001a9c0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0001a9d0: 7365 645f 636c 6965 6e74 5f76 6572 7369  sed_client_versi
-0001a9e0: 6f6e 3d70 6172 7365 645f 636c 6965 6e74  on=parsed_client
-0001a9f0: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
-0001aa00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001aa10: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001aa20: 0a20 2020 2020 2020 2069 6620 7061 7273  .        if pars
-0001aa30: 6564 5f73 6572 7665 725f 7665 7273 696f  ed_server_versio
-0001aa40: 6e2e 6d69 6e6f 7220 213d 2070 6172 7365  n.minor != parse
-0001aa50: 645f 636c 6965 6e74 5f76 6572 7369 6f6e  d_client_version
-0001aa60: 2e6d 696e 6f72 3a0a 2020 2020 2020 2020  .minor:.        
-0001aa70: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-0001aa80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa90: 2022 5365 7276 6572 2061 6e64 2063 6c69   "Server and cli
-0001aaa0: 656e 7420 7665 7273 696f 6e73 2061 7265  ent versions are
-0001aab0: 206e 6f74 2074 6865 2073 616d 6520 6275   not the same bu
-0001aac0: 7420 636f 6d70 6174 6962 6c65 222c 0a20  t compatible",. 
-0001aad0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001aae0: 6172 7365 645f 7365 7276 6572 5f76 6572  arsed_server_ver
-0001aaf0: 7369 6f6e 3d70 6172 7365 645f 7365 7276  sion=parsed_serv
-0001ab00: 6572 5f76 6572 7369 6f6e 2c0a 2020 2020  er_version,.    
-0001ab10: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-0001ab20: 6564 5f63 6c69 656e 745f 7665 7273 696f  ed_client_versio
-0001ab30: 6e3d 7061 7273 6564 5f63 6c69 656e 745f  n=parsed_client_
-0001ab40: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
-0001ab50: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0001ab60: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-0001ab70: 6465 6620 6372 6561 7465 5f6d 6f64 656c  def create_model
-0001ab80: 5f65 6e64 706f 696e 7428 0a20 2020 2020  _endpoint(.     
-0001ab90: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0001aba0: 2070 726f 6a65 6374 3a20 7374 722c 0a20   project: str,. 
-0001abb0: 2020 2020 2020 2065 6e64 706f 696e 745f         endpoint_
-0001abc0: 6964 3a20 7374 722c 0a20 2020 2020 2020  id: str,.       
-0001abd0: 206d 6f64 656c 5f65 6e64 706f 696e 743a   model_endpoint:
-0001abe0: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
-0001abf0: 2020 2020 6d6c 7275 6e2e 6d6f 6465 6c5f      mlrun.model_
-0001ac00: 6d6f 6e69 746f 7269 6e67 2e6d 6f64 656c  monitoring.model
-0001ac10: 5f65 6e64 706f 696e 742e 4d6f 6465 6c45  _endpoint.ModelE
-0001ac20: 6e64 706f 696e 742c 2064 6963 740a 2020  ndpoint, dict.  
-0001ac30: 2020 2020 2020 5d2c 0a20 2020 2029 3a0a        ],.    ):.
-0001ac40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ac50: 2020 2020 4372 6561 7465 7320 6120 4442      Creates a DB
-0001ac60: 2072 6563 6f72 6420 7769 7468 2074 6865   record with the
-0001ac70: 2067 6976 656e 206d 6f64 656c 5f65 6e64   given model_end
-0001ac80: 706f 696e 7420 7265 636f 7264 2e0a 0a20  point record... 
-0001ac90: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
-0001aca0: 6f6a 6563 743a 2054 6865 206e 616d 6520  oject: The name 
-0001acb0: 6f66 2074 6865 2070 726f 6a65 6374 2e0a  of the project..
-0001acc0: 2020 2020 2020 2020 3a70 6172 616d 2065          :param e
-0001acd0: 6e64 706f 696e 745f 6964 3a20 5468 6520  ndpoint_id: The 
-0001ace0: 6964 206f 6620 7468 6520 656e 6470 6f69  id of the endpoi
-0001acf0: 6e74 2e0a 2020 2020 2020 2020 3a70 6172  nt..        :par
-0001ad00: 616d 206d 6f64 656c 5f65 6e64 706f 696e  am model_endpoin
-0001ad10: 743a 2041 6e20 6f62 6a65 6374 2072 6570  t: An object rep
-0001ad20: 7265 7365 6e74 696e 6720 7468 6520 6d6f  resenting the mo
-0001ad30: 6465 6c20 656e 6470 6f69 6e74 2e0a 2020  del endpoint..  
-0001ad40: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0001ad50: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0001ad60: 280a 2020 2020 2020 2020 2020 2020 6d6f  (.            mo
-0001ad70: 6465 6c5f 656e 6470 6f69 6e74 2c20 6d6c  del_endpoint, ml
-0001ad80: 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f  run.model_monito
-0001ad90: 7269 6e67 2e6d 6f64 656c 5f65 6e64 706f  ring.model_endpo
-0001ada0: 696e 742e 4d6f 6465 6c45 6e64 706f 696e  int.ModelEndpoin
-0001adb0: 740a 2020 2020 2020 2020 293a 0a20 2020  t.        ):.   
-0001adc0: 2020 2020 2020 2020 206d 6f64 656c 5f65           model_e
-0001add0: 6e64 706f 696e 7420 3d20 6d6f 6465 6c5f  ndpoint = model_
-0001ade0: 656e 6470 6f69 6e74 2e74 6f5f 6469 6374  endpoint.to_dict
-0001adf0: 2829 0a0a 2020 2020 2020 2020 7061 7468  ()..        path
-0001ae00: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-0001ae10: 726f 6a65 6374 7d2f 6d6f 6465 6c2d 656e  roject}/model-en
-0001ae20: 6470 6f69 6e74 732f 7b65 6e64 706f 696e  dpoints/{endpoin
-0001ae30: 745f 6964 7d22 0a20 2020 2020 2020 2073  t_id}".        s
-0001ae40: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-0001ae50: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0001ae60: 3d22 504f 5354 222c 0a20 2020 2020 2020  ="POST",.       
-0001ae70: 2020 2020 2070 6174 683d 7061 7468 2c0a       path=path,.
-0001ae80: 2020 2020 2020 2020 2020 2020 626f 6479              body
-0001ae90: 3d64 6963 745f 746f 5f6a 736f 6e28 6d6f  =dict_to_json(mo
-0001aea0: 6465 6c5f 656e 6470 6f69 6e74 292c 0a20  del_endpoint),. 
-0001aeb0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0001aec0: 6620 6465 6c65 7465 5f6d 6f64 656c 5f65  f delete_model_e
-0001aed0: 6e64 706f 696e 7428 0a20 2020 2020 2020  ndpoint(.       
-0001aee0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-0001aef0: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
-0001af00: 2020 2020 2065 6e64 706f 696e 745f 6964       endpoint_id
-0001af10: 3a20 7374 722c 0a20 2020 2029 3a0a 2020  : str,.    ):.  
-0001af20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001af30: 2020 4465 6c65 7465 7320 7468 6520 4442    Deletes the DB
-0001af40: 2072 6563 6f72 6420 6f66 2061 2067 6976   record of a giv
-0001af50: 656e 206d 6f64 656c 2065 6e64 706f 696e  en model endpoin
-0001af60: 742c 2070 726f 6a65 6374 2061 6e64 2065  t, project and e
-0001af70: 6e64 706f 696e 745f 6964 2061 7265 2075  ndpoint_id are u
-0001af80: 7365 6420 666f 7220 6c6f 6f6b 7570 0a0a  sed for lookup..
-0001af90: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0001afa0: 726f 6a65 6374 3a20 5468 6520 6e61 6d65  roject: The name
-0001afb0: 206f 6620 7468 6520 7072 6f6a 6563 740a   of the project.
-0001afc0: 2020 2020 2020 2020 3a70 6172 616d 2065          :param e
-0001afd0: 6e64 706f 696e 745f 6964 3a20 5468 6520  ndpoint_id: The 
-0001afe0: 6964 206f 6620 7468 6520 656e 6470 6f69  id of the endpoi
-0001aff0: 6e74 0a20 2020 2020 2020 2022 2222 0a0a  nt.        """..
-0001b000: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-0001b010: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-0001b020: 6374 7d2f 6d6f 6465 6c2d 656e 6470 6f69  ct}/model-endpoi
-0001b030: 6e74 732f 7b65 6e64 706f 696e 745f 6964  nts/{endpoint_id
-0001b040: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
-0001b050: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-0001b060: 2020 2020 2020 6d65 7468 6f64 3d22 4445        method="DE
-0001b070: 4c45 5445 222c 0a20 2020 2020 2020 2020  LETE",.         
-0001b080: 2020 2070 6174 683d 7061 7468 2c0a 2020     path=path,.  
-0001b090: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0001b0a0: 206c 6973 745f 6d6f 6465 6c5f 656e 6470   list_model_endp
-0001b0b0: 6f69 6e74 7328 0a20 2020 2020 2020 2073  oints(.        s
-0001b0c0: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
-0001b0d0: 6a65 6374 3a20 7374 722c 0a20 2020 2020  ject: str,.     
-0001b0e0: 2020 206d 6f64 656c 3a20 4f70 7469 6f6e     model: Option
-0001b0f0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0001b100: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-0001b110: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-0001b120: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0001b130: 6c61 6265 6c73 3a20 4c69 7374 5b73 7472  labels: List[str
-0001b140: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0001b150: 2020 7374 6172 743a 2073 7472 203d 2022    start: str = "
-0001b160: 6e6f 772d 3168 222c 0a20 2020 2020 2020  now-1h",.       
-0001b170: 2065 6e64 3a20 7374 7220 3d20 226e 6f77   end: str = "now
-0001b180: 222c 0a20 2020 2020 2020 206d 6574 7269  ",.        metri
-0001b190: 6373 3a20 4f70 7469 6f6e 616c 5b4c 6973  cs: Optional[Lis
-0001b1a0: 745b 7374 725d 5d20 3d20 4e6f 6e65 2c0a  t[str]] = None,.
-0001b1b0: 2020 2020 2020 2020 746f 705f 6c65 7665          top_leve
-0001b1c0: 6c3a 2062 6f6f 6c20 3d20 4661 6c73 652c  l: bool = False,
-0001b1d0: 0a20 2020 2020 2020 2075 6964 733a 204f  .        uids: O
-0001b1e0: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
-0001b1f0: 5d5d 203d 204e 6f6e 652c 0a20 2020 2029  ]] = None,.    )
-0001b200: 202d 3e20 4c69 7374 5b6d 6c72 756e 2e6d   -> List[mlrun.m
-0001b210: 6f64 656c 5f6d 6f6e 6974 6f72 696e 672e  odel_monitoring.
-0001b220: 6d6f 6465 6c5f 656e 6470 6f69 6e74 2e4d  model_endpoint.M
-0001b230: 6f64 656c 456e 6470 6f69 6e74 5d3a 0a20  odelEndpoint]:. 
-0001b240: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001b250: 2020 2052 6574 7572 6e73 2061 206c 6973     Returns a lis
-0001b260: 7420 6f66 204d 6f64 656c 456e 6470 6f69  t of ModelEndpoi
-0001b270: 6e74 5374 6174 6520 6f62 6a65 6374 732e  ntState objects.
-0001b280: 2045 6163 6820 6f62 6a65 6374 2072 6570   Each object rep
-0001b290: 7265 7365 6e74 7320 7468 6520 6375 7272  resents the curr
-0001b2a0: 656e 7420 7374 6174 6520 6f66 2061 206d  ent state of a m
-0001b2b0: 6f64 656c 2065 6e64 706f 696e 742e 0a20  odel endpoint.. 
-0001b2c0: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
-0001b2d0: 7469 6f6e 7320 7375 7070 6f72 7473 2066  tions supports f
-0001b2e0: 696c 7465 7269 6e67 2062 7920 7468 6520  iltering by the 
-0001b2f0: 666f 6c6c 6f77 696e 6720 7061 7261 6d65  following parame
-0001b300: 7465 7273 3a0a 2020 2020 2020 2020 3129  ters:.        1)
-0001b310: 206d 6f64 656c 0a20 2020 2020 2020 2032   model.        2
-0001b320: 2920 6675 6e63 7469 6f6e 0a20 2020 2020  ) function.     
-0001b330: 2020 2033 2920 6c61 6265 6c73 0a20 2020     3) labels.   
-0001b340: 2020 2020 2042 7920 6465 6661 756c 742c       By default,
-0001b350: 2077 6865 6e20 6e6f 2066 696c 7465 7273   when no filters
-0001b360: 2061 7265 2061 7070 6c69 6564 2c20 616c   are applied, al
-0001b370: 6c20 6176 6169 6c61 626c 6520 656e 6470  l available endp
-0001b380: 6f69 6e74 7320 666f 7220 7468 6520 6769  oints for the gi
-0001b390: 7665 6e20 7072 6f6a 6563 7420 7769 6c6c  ven project will
-0001b3a0: 2062 6520 6c69 7374 6564 2e0a 0a20 2020   be listed...   
-0001b3b0: 2020 2020 2049 6e20 6164 6469 7469 6f6e       In addition
-0001b3c0: 2c20 7468 6973 2066 756e 6374 696f 6e73  , this functions
-0001b3d0: 2070 726f 7669 6465 7320 6120 6661 6361   provides a faca
-0001b3e0: 6465 2066 6f72 206c 6973 7469 6e67 2065  de for listing e
-0001b3f0: 6e64 706f 696e 7420 7265 6c61 7465 6420  ndpoint related 
-0001b400: 6d65 7472 6963 732e 2054 6869 7320 6661  metrics. This fa
-0001b410: 6361 6465 2069 7320 7469 6d65 2d62 6173  cade is time-bas
-0001b420: 6564 0a20 2020 2020 2020 2061 6e64 2064  ed.        and d
-0001b430: 6570 656e 6473 206f 6e20 7468 6520 2773  epends on the 's
-0001b440: 7461 7274 2720 616e 6420 2765 6e64 2720  tart' and 'end' 
-0001b450: 7061 7261 6d65 7465 7273 2e20 4279 2064  parameters. By d
-0001b460: 6566 6175 6c74 2c20 7768 656e 2074 6865  efault, when the
-0001b470: 206d 6574 7269 6373 2070 6172 616d 6574   metrics paramet
-0001b480: 6572 2069 7320 4e6f 6e65 2c20 6e6f 206d  er is None, no m
-0001b490: 6574 7269 6373 2061 7265 0a20 2020 2020  etrics are.     
-0001b4a0: 2020 2061 6464 6564 2074 6f20 7468 6520     added to the 
-0001b4b0: 6f75 7470 7574 206f 6620 7468 6973 2066  output of this f
-0001b4c0: 756e 6374 696f 6e2e 0a0a 2020 2020 2020  unction...      
-0001b4d0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
-0001b4e0: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
-0001b4f0: 6520 7072 6f6a 6563 740a 2020 2020 2020  e project.      
-0001b500: 2020 3a70 6172 616d 206d 6f64 656c 3a20    :param model: 
-0001b510: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
-0001b520: 6d6f 6465 6c20 746f 2066 696c 7465 7220  model to filter 
-0001b530: 6279 0a20 2020 2020 2020 203a 7061 7261  by.        :para
-0001b540: 6d20 6675 6e63 7469 6f6e 3a20 5468 6520  m function: The 
-0001b550: 6e61 6d65 206f 6620 7468 6520 6675 6e63  name of the func
-0001b560: 7469 6f6e 2074 6f20 6669 6c74 6572 2062  tion to filter b
-0001b570: 790a 2020 2020 2020 2020 3a70 6172 616d  y.        :param
-0001b580: 206c 6162 656c 733a 2041 206c 6973 7420   labels: A list 
-0001b590: 6f66 206c 6162 656c 7320 746f 2066 696c  of labels to fil
-0001b5a0: 7465 7220 6279 2e20 4c61 6265 6c20 6669  ter by. Label fi
-0001b5b0: 6c74 6572 7320 776f 726b 2062 7920 6569  lters work by ei
-0001b5c0: 7468 6572 2066 696c 7465 7269 6e67 2061  ther filtering a
-0001b5d0: 2073 7065 6369 6669 6320 7661 6c75 6520   specific value 
-0001b5e0: 6f66 2061 0a20 2020 2020 2020 2020 6c61  of a.         la
-0001b5f0: 6265 6c20 2869 2e65 2e20 6c69 7374 2822  bel (i.e. list("
-0001b600: 6b65 793d 7661 6c75 6522 2929 206f 7220  key=value")) or 
-0001b610: 6279 206c 6f6f 6b69 6e67 2066 6f72 2074  by looking for t
-0001b620: 6865 2065 7869 7374 656e 6365 206f 6620  he existence of 
-0001b630: 6120 6769 7665 6e20 6b65 7920 2869 2e65  a given key (i.e
-0001b640: 2e20 226b 6579 2229 0a20 2020 2020 2020  . "key").       
-0001b650: 203a 7061 7261 6d20 6d65 7472 6963 733a   :param metrics:
-0001b660: 2041 206c 6973 7420 6f66 206d 6574 7269   A list of metri
-0001b670: 6373 2074 6f20 7265 7475 726e 2066 6f72  cs to return for
-0001b680: 2065 6163 6820 656e 6470 6f69 6e74 2c20   each endpoint, 
-0001b690: 7265 6164 206d 6f72 6520 696e 2027 5469  read more in 'Ti
-0001b6a0: 6d65 4d65 7472 6963 270a 2020 2020 2020  meMetric'.      
-0001b6b0: 2020 3a70 6172 616d 2073 7461 7274 3a20    :param start: 
-0001b6c0: 5468 6520 7374 6172 7420 7469 6d65 206f  The start time o
-0001b6d0: 6620 7468 6520 6d65 7472 6963 732e 2043  f the metrics. C
-0001b6e0: 616e 2062 6520 7265 7072 6573 656e 7465  an be represente
-0001b6f0: 6420 6279 2061 2073 7472 696e 6720 636f  d by a string co
-0001b700: 6e74 6169 6e69 6e67 2061 6e20 5246 4320  ntaining an RFC 
-0001b710: 3333 3339 0a20 2020 2020 2020 2020 2020  3339.           
-0001b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b730: 2020 2020 2020 7469 6d65 2c20 6120 556e        time, a Un
-0001b740: 6978 2074 696d 6573 7461 6d70 2069 6e20  ix timestamp in 
-0001b750: 6d69 6c6c 6973 6563 6f6e 6473 2c20 6120  milliseconds, a 
-0001b760: 7265 6c61 7469 7665 2074 696d 6520 2860  relative time (`
-0001b770: 276e 6f77 2760 206f 720a 2020 2020 2020  'now'` or.      
-0001b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b790: 2020 2020 2020 2020 2020 2060 276e 6f77             `'now
-0001b7a0: 2d5b 302d 395d 2b5b 6d68 645d 2760 2c20  -[0-9]+[mhd]'`, 
-0001b7b0: 7768 6572 6520 606d 6020 3d20 6d69 6e75  where `m` = minu
-0001b7c0: 7465 732c 2060 6860 203d 2068 6f75 7273  tes, `h` = hours
-0001b7d0: 2c20 616e 6420 6027 6427 6020 3d0a 2020  , and `'d'` =.  
-0001b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001b800: 6179 7329 2c20 6f72 2030 2066 6f72 2074  ays), or 0 for t
-0001b810: 6865 2065 6172 6c69 6573 7420 7469 6d65  he earliest time
-0001b820: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001b830: 2065 6e64 3a20 5468 6520 656e 6420 7469   end: The end ti
-0001b840: 6d65 206f 6620 7468 6520 6d65 7472 6963  me of the metric
-0001b850: 732e 2043 616e 2062 6520 7265 7072 6573  s. Can be repres
-0001b860: 656e 7465 6420 6279 2061 2073 7472 696e  ented by a strin
-0001b870: 6720 636f 6e74 6169 6e69 6e67 2061 6e20  g containing an 
-0001b880: 5246 4320 3333 3339 0a20 2020 2020 2020  RFC 3339.       
-0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8a0: 2020 2020 2020 2020 2020 7469 6d65 2c20            time, 
-0001b8b0: 6120 556e 6978 2074 696d 6573 7461 6d70  a Unix timestamp
-0001b8c0: 2069 6e20 6d69 6c6c 6973 6563 6f6e 6473   in milliseconds
-0001b8d0: 2c20 6120 7265 6c61 7469 7665 2074 696d  , a relative tim
-0001b8e0: 6520 2860 276e 6f77 2760 206f 720a 2020  e (`'now'` or.  
-0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b900: 2020 2020 2020 2020 2020 2020 2020 2060                 `
-0001b910: 276e 6f77 2d5b 302d 395d 2b5b 6d68 645d  'now-[0-9]+[mhd]
-0001b920: 2760 2c20 7768 6572 6520 606d 6020 3d20  '`, where `m` = 
-0001b930: 6d69 6e75 7465 732c 2060 6860 203d 2068  minutes, `h` = h
-0001b940: 6f75 7273 2c20 616e 6420 6027 6427 6020  ours, and `'d'` 
-0001b950: 3d0a 2020 2020 2020 2020 2020 2020 2020  =.              
-0001b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b970: 2020 2064 6179 7329 2c20 6f72 2030 2066     days), or 0 f
-0001b980: 6f72 2074 6865 2065 6172 6c69 6573 7420  or the earliest 
-0001b990: 7469 6d65 2e0a 2020 2020 2020 2020 3a70  time..        :p
-0001b9a0: 6172 616d 2074 6f70 5f6c 6576 656c 3a20  aram top_level: 
-0001b9b0: 6966 2074 7275 6520 7769 6c6c 2072 6574  if true will ret
-0001b9c0: 7572 6e20 6f6e 6c79 2072 6f75 7465 7273  urn only routers
-0001b9d0: 2061 6e64 2065 6e64 706f 696e 7420 7468   and endpoint th
-0001b9e0: 6174 2061 7265 204e 4f54 2063 6869 6c64  at are NOT child
-0001b9f0: 7265 6e20 6f66 2061 6e79 2072 6f75 7465  ren of any route
-0001ba00: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-0001ba10: 2075 6964 733a 2069 6620 7061 7373 6564   uids: if passed
-0001ba20: 2077 696c 6c20 7265 7475 726e 2060 4d6f   will return `Mo
-0001ba30: 6465 6c45 6e64 706f 696e 744c 6973 7460  delEndpointList`
-0001ba40: 206f 6620 656e 6470 6f69 6e74 7320 7769   of endpoints wi
-0001ba50: 7468 2075 6964 2069 6e20 7569 6473 0a20  th uid in uids. 
-0001ba60: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0001ba70: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-0001ba80: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-0001ba90: 6d6f 6465 6c2d 656e 6470 6f69 6e74 7322  model-endpoints"
-0001baa0: 0a0a 2020 2020 2020 2020 6966 206c 6162  ..        if lab
-0001bab0: 656c 7320 616e 6420 6973 696e 7374 616e  els and isinstan
-0001bac0: 6365 286c 6162 656c 732c 2064 6963 7429  ce(labels, dict)
-0001bad0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-0001bae0: 6265 6c73 203d 205b 6622 7b6b 6579 7d3d  bels = [f"{key}=
-0001baf0: 7b76 616c 7565 7d22 2066 6f72 206b 6579  {value}" for key
-0001bb00: 2c20 7661 6c75 6520 696e 206c 6162 656c  , value in label
-0001bb10: 732e 6974 656d 7328 295d 0a0a 2020 2020  s.items()]..    
-0001bb20: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
-0001bb30: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-0001bb40: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0001bb50: 3d22 4745 5422 2c0a 2020 2020 2020 2020  ="GET",.        
-0001bb60: 2020 2020 7061 7468 3d70 6174 682c 0a20      path=path,. 
-0001bb70: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0001bb80: 733d 7b0a 2020 2020 2020 2020 2020 2020  s={.            
-0001bb90: 2020 2020 226d 6f64 656c 223a 206d 6f64      "model": mod
-0001bba0: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-0001bbb0: 2020 2020 2266 756e 6374 696f 6e22 3a20      "function": 
-0001bbc0: 6675 6e63 7469 6f6e 2c0a 2020 2020 2020  function,.      
-0001bbd0: 2020 2020 2020 2020 2020 226c 6162 656c            "label
-0001bbe0: 223a 206c 6162 656c 7320 6f72 205b 5d2c  ": labels or [],
-0001bbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bc00: 2022 7374 6172 7422 3a20 7374 6172 742c   "start": start,
-0001bc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bc20: 2022 656e 6422 3a20 656e 642c 0a20 2020   "end": end,.   
-0001bc30: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
-0001bc40: 7472 6963 223a 206d 6574 7269 6373 206f  tric": metrics o
-0001bc50: 7220 5b5d 2c0a 2020 2020 2020 2020 2020  r [],.          
-0001bc60: 2020 2020 2020 2274 6f70 2d6c 6576 656c        "top-level
-0001bc70: 223a 2074 6f70 5f6c 6576 656c 2c0a 2020  ": top_level,.  
-0001bc80: 2020 2020 2020 2020 2020 2020 2020 2275                "u
-0001bc90: 6964 223a 2075 6964 732c 0a20 2020 2020  id": uids,.     
-0001bca0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-0001bcb0: 2020 290a 0a20 2020 2020 2020 2023 2047    )..        # G
-0001bcc0: 656e 6572 6174 6520 6120 6c69 7374 206f  enerate a list o
-0001bcd0: 6620 6120 6d6f 6465 6c20 656e 6470 6f69  f a model endpoi
-0001bce0: 6e74 2064 6963 7469 6f6e 6172 6965 730a  nt dictionaries.
-0001bcf0: 2020 2020 2020 2020 6d6f 6465 6c5f 656e          model_en
-0001bd00: 6470 6f69 6e74 7320 3d20 7265 7370 6f6e  dpoints = respon
-0001bd10: 7365 2e6a 736f 6e28 295b 2265 6e64 706f  se.json()["endpo
-0001bd20: 696e 7473 225d 0a20 2020 2020 2020 2069  ints"].        i
-0001bd30: 6620 6d6f 6465 6c5f 656e 6470 6f69 6e74  f model_endpoint
-0001bd40: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0001bd50: 6574 7572 6e20 5b0a 2020 2020 2020 2020  eturn [.        
-0001bd60: 2020 2020 2020 2020 6d6c 7275 6e2e 6d6f          mlrun.mo
-0001bd70: 6465 6c5f 6d6f 6e69 746f 7269 6e67 2e6d  del_monitoring.m
-0001bd80: 6f64 656c 5f65 6e64 706f 696e 742e 4d6f  odel_endpoint.Mo
-0001bd90: 6465 6c45 6e64 706f 696e 742e 6672 6f6d  delEndpoint.from
-0001bda0: 5f64 6963 7428 6f62 6a29 0a20 2020 2020  _dict(obj).     
-0001bdb0: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
-0001bdc0: 626a 2069 6e20 6d6f 6465 6c5f 656e 6470  bj in model_endp
-0001bdd0: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
-0001bde0: 2020 5d0a 2020 2020 2020 2020 7265 7475    ].        retu
-0001bdf0: 726e 205b 5d0a 0a20 2020 2064 6566 2067  rn []..    def g
-0001be00: 6574 5f6d 6f64 656c 5f65 6e64 706f 696e  et_model_endpoin
-0001be10: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-0001be20: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-0001be30: 3a20 7374 722c 0a20 2020 2020 2020 2065  : str,.        e
-0001be40: 6e64 706f 696e 745f 6964 3a20 7374 722c  ndpoint_id: str,
-0001be50: 0a20 2020 2020 2020 2073 7461 7274 3a20  .        start: 
-0001be60: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-0001be70: 4e6f 6e65 2c0a 2020 2020 2020 2020 656e  None,.        en
-0001be80: 643a 204f 7074 696f 6e61 6c5b 7374 725d  d: Optional[str]
-0001be90: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001bea0: 206d 6574 7269 6373 3a20 4f70 7469 6f6e   metrics: Option
-0001beb0: 616c 5b4c 6973 745b 7374 725d 5d20 3d20  al[List[str]] = 
-0001bec0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6665  None,.        fe
-0001bed0: 6174 7572 655f 616e 616c 7973 6973 3a20  ature_analysis: 
-0001bee0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0001bef0: 2020 2920 2d3e 206d 6c72 756e 2e6d 6f64    ) -> mlrun.mod
-0001bf00: 656c 5f6d 6f6e 6974 6f72 696e 672e 6d6f  el_monitoring.mo
-0001bf10: 6465 6c5f 656e 6470 6f69 6e74 2e4d 6f64  del_endpoint.Mod
-0001bf20: 656c 456e 6470 6f69 6e74 3a0a 2020 2020  elEndpoint:.    
-0001bf30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001bf40: 5265 7475 726e 7320 6120 7369 6e67 6c65  Returns a single
-0001bf50: 2060 4d6f 6465 6c45 6e64 706f 696e 7460   `ModelEndpoint`
-0001bf60: 206f 626a 6563 7420 7769 7468 2061 6464   object with add
-0001bf70: 6974 696f 6e61 6c20 6d65 7472 6963 7320  itional metrics 
-0001bf80: 616e 6420 6665 6174 7572 6520 7265 6c61  and feature rela
-0001bf90: 7465 6420 6461 7461 2e0a 0a20 2020 2020  ted data...     
-0001bfa0: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-0001bfb0: 743a 2020 2020 2020 2020 2020 2020 2020  t:              
-0001bfc0: 2020 2020 2020 5468 6520 6e61 6d65 206f        The name o
-0001bfd0: 6620 7468 6520 7072 6f6a 6563 740a 2020  f the project.  
-0001bfe0: 2020 2020 2020 3a70 6172 616d 2065 6e64        :param end
-0001bff0: 706f 696e 745f 6964 3a20 2020 2020 2020  point_id:       
-0001c000: 2020 2020 2020 2020 2054 6865 2075 6e69           The uni
-0001c010: 7175 6520 6964 206f 6620 7468 6520 6d6f  que id of the mo
-0001c020: 6465 6c20 656e 6470 6f69 6e74 2e0a 2020  del endpoint..  
-0001c030: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
-0001c040: 7274 3a20 2020 2020 2020 2020 2020 2020  rt:             
-0001c050: 2020 2020 2020 2020 2054 6865 2073 7461           The sta
-0001c060: 7274 2074 696d 6520 6f66 2074 6865 206d  rt time of the m
-0001c070: 6574 7269 6373 2e20 4361 6e20 6265 2072  etrics. Can be r
-0001c080: 6570 7265 7365 6e74 6564 2062 7920 6120  epresented by a 
-0001c090: 7374 7269 6e67 2063 6f6e 7461 696e 696e  string containin
-0001c0a0: 6720 616e 0a20 2020 2020 2020 2020 2020  g an.           
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0d0: 5246 4320 3333 3339 2074 696d 652c 2061  RFC 3339 time, a
-0001c0e0: 2055 6e69 7820 7469 6d65 7374 616d 7020   Unix timestamp 
-0001c0f0: 696e 206d 696c 6c69 7365 636f 6e64 732c  in milliseconds,
-0001c100: 2061 2072 656c 6174 6976 6520 7469 6d65   a relative time
-0001c110: 2028 6027 6e6f 7727 6020 6f72 0a20 2020   (`'now'` or.   
-0001c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c140: 2020 2020 2020 2020 6027 6e6f 772d 5b30          `'now-[0
-0001c150: 2d39 5d2b 5b6d 6864 5d27 602c 2077 6865  -9]+[mhd]'`, whe
-0001c160: 7265 2060 6d60 203d 206d 696e 7574 6573  re `m` = minutes
-0001c170: 2c20 6068 6020 3d20 686f 7572 732c 2061  , `h` = hours, a
-0001c180: 6e64 2060 2764 2760 203d 2064 6179 7329  nd `'d'` = days)
-0001c190: 2c20 6f72 0a20 2020 2020 2020 2020 2020  , or.           
-0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1c0: 3020 666f 7220 7468 6520 6561 726c 6965  0 for the earlie
-0001c1d0: 7374 2074 696d 652e 0a20 2020 2020 2020  st time..       
-0001c1e0: 203a 7061 7261 6d20 656e 643a 2020 2020   :param end:    
-0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c200: 2020 2020 5468 6520 656e 6420 7469 6d65      The end time
-0001c210: 206f 6620 7468 6520 6d65 7472 6963 732e   of the metrics.
-0001c220: 2043 616e 2062 6520 7265 7072 6573 656e   Can be represen
-0001c230: 7465 6420 6279 2061 2073 7472 696e 6720  ted by a string 
-0001c240: 636f 6e74 6169 6e69 6e67 2061 6e0a 2020  containing an.  
-0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c270: 2020 2020 2020 2020 2052 4643 2033 3333           RFC 333
-0001c280: 3920 7469 6d65 2c20 6120 556e 6978 2074  9 time, a Unix t
-0001c290: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
-0001c2a0: 6973 6563 6f6e 6473 2c20 6120 7265 6c61  iseconds, a rela
-0001c2b0: 7469 7665 2074 696d 6520 2860 276e 6f77  tive time (`'now
-0001c2c0: 2760 206f 720a 2020 2020 2020 2020 2020  '` or.          
-0001c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2f0: 2060 276e 6f77 2d5b 302d 395d 2b5b 6d68   `'now-[0-9]+[mh
-0001c300: 645d 2760 2c20 7768 6572 6520 606d 6020  d]'`, where `m` 
-0001c310: 3d20 6d69 6e75 7465 732c 2060 6860 203d  = minutes, `h` =
-0001c320: 2068 6f75 7273 2c20 616e 6420 6027 6427   hours, and `'d'
-0001c330: 6020 3d20 6461 7973 292c 206f 720a 2020  ` = days), or.  
-0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c360: 2020 2020 2020 2020 2030 2066 6f72 2074           0 for t
-0001c370: 6865 2065 6172 6c69 6573 7420 7469 6d65  he earliest time
-0001c380: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001c390: 206d 6574 7269 6373 3a20 2020 2020 2020   metrics:       
-0001c3a0: 2020 2020 2020 2020 2020 2020 2041 206c               A l
-0001c3b0: 6973 7420 6f66 206d 6574 7269 6373 2074  ist of metrics t
-0001c3c0: 6f20 7265 7475 726e 2066 6f72 2074 6865  o return for the
-0001c3d0: 206d 6f64 656c 2065 6e64 706f 696e 742e   model endpoint.
-0001c3e0: 2054 6865 7265 2061 7265 2070 7265 2d64   There are pre-d
-0001c3f0: 6566 696e 6564 0a20 2020 2020 2020 2020  efined.         
-0001c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c420: 2020 6d65 7472 6963 7320 666f 7220 6d6f    metrics for mo
-0001c430: 6465 6c20 656e 6470 6f69 6e74 7320 7375  del endpoints su
-0001c440: 6368 2061 7320 7072 6564 6963 7469 6f6e  ch as prediction
-0001c450: 735f 7065 725f 7365 636f 6e64 2061 6e64  s_per_second and
-0001c460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017630: 4661 696c 6564 2073 746f 7269 6e67 2070  Failed storing p
+00017640: 726f 6a65 6374 207b 6e61 6d65 7d22 0a20  roject {name}". 
+00017650: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00017660: 616e 6365 2870 726f 6a65 6374 2c20 6d6c  ance(project, ml
+00017670: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00017680: 6173 2e50 726f 6a65 6374 293a 0a20 2020  as.Project):.   
+00017690: 2020 2020 2020 2020 2070 726f 6a65 6374           project
+000176a0: 203d 2070 726f 6a65 6374 2e64 6963 7428   = project.dict(
+000176b0: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+000176c0: 7369 6e73 7461 6e63 6528 7072 6f6a 6563  sinstance(projec
+000176d0: 742c 206d 6c72 756e 2e70 726f 6a65 6374  t, mlrun.project
+000176e0: 732e 4d6c 7275 6e50 726f 6a65 6374 293a  s.MlrunProject):
+000176f0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00017700: 6a65 6374 203d 2070 726f 6a65 6374 2e74  ject = project.t
+00017710: 6f5f 6469 6374 2829 0a20 2020 2020 2020  o_dict().       
+00017720: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
+00017730: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+00017740: 2020 2020 2020 2022 5055 5422 2c0a 2020         "PUT",.  
+00017750: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
+00017760: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00017770: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
+00017780: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
+00017790: 5f74 6f5f 6a73 6f6e 2870 726f 6a65 6374  _to_json(project
+000177a0: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
+000177b0: 2020 2020 2069 6620 7265 7370 6f6e 7365       if response
+000177c0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+000177d0: 6874 7470 2e48 5454 5053 7461 7475 732e  http.HTTPStatus.
+000177e0: 4143 4345 5054 4544 3a0a 2020 2020 2020  ACCEPTED:.      
+000177f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00017800: 662e 5f77 6169 745f 666f 725f 7072 6f6a  f._wait_for_proj
+00017810: 6563 745f 746f 5f72 6561 6368 5f74 6572  ect_to_reach_ter
+00017820: 6d69 6e61 6c5f 7374 6174 6528 6e61 6d65  minal_state(name
+00017830: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00017840: 206d 6c72 756e 2e70 726f 6a65 6374 732e   mlrun.projects.
+00017850: 4d6c 7275 6e50 726f 6a65 6374 2e66 726f  MlrunProject.fro
+00017860: 6d5f 6469 6374 2872 6573 706f 6e73 652e  m_dict(response.
+00017870: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
+00017880: 2070 6174 6368 5f70 726f 6a65 6374 280a   patch_project(.
+00017890: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000178a0: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
+000178b0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+000178c0: 3a20 6469 6374 2c0a 2020 2020 2020 2020  : dict,.        
+000178d0: 7061 7463 685f 6d6f 6465 3a20 556e 696f  patch_mode: Unio
+000178e0: 6e5b 0a20 2020 2020 2020 2020 2020 2073  n[.            s
+000178f0: 7472 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  tr, mlrun.common
+00017900: 2e73 6368 656d 6173 2e50 6174 6368 4d6f  .schemas.PatchMo
+00017910: 6465 0a20 2020 2020 2020 205d 203d 206d  de.        ] = m
+00017920: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00017930: 6d61 732e 5061 7463 684d 6f64 652e 7265  mas.PatchMode.re
+00017940: 706c 6163 652c 0a20 2020 2029 202d 3e20  place,.    ) -> 
+00017950: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
+00017960: 6c72 756e 5072 6f6a 6563 743a 0a20 2020  lrunProject:.   
+00017970: 2020 2020 2022 2222 5061 7463 6820 616e       """Patch an
+00017980: 2065 7869 7374 696e 6720 7072 6f6a 6563   existing projec
+00017990: 7420 6f62 6a65 6374 2e0a 0a20 2020 2020  t object...     
+000179a0: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+000179b0: 4e61 6d65 206f 6620 7072 6f6a 6563 7420  Name of project 
+000179c0: 746f 2070 6174 6368 2e0a 2020 2020 2020  to patch..      
+000179d0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+000179e0: 3a20 5468 6520 6163 7475 616c 2063 6861  : The actual cha
+000179f0: 6e67 6573 2074 6f20 7468 6520 7072 6f6a  nges to the proj
+00017a00: 6563 7420 6f62 6a65 6374 2e0a 2020 2020  ect object..    
+00017a10: 2020 2020 3a70 6172 616d 2070 6174 6368      :param patch
+00017a20: 5f6d 6f64 653a 2054 6865 2073 7472 6174  _mode: The strat
+00017a30: 6567 7920 666f 7220 6d65 7267 696e 6720  egy for merging 
+00017a40: 7468 6520 6368 616e 6765 7320 7769 7468  the changes with
+00017a50: 2074 6865 2065 7869 7374 696e 6720 6f62   the existing ob
+00017a60: 6a65 6374 2e20 4361 6e20 6265 2065 6974  ject. Can be eit
+00017a70: 6865 7220 6060 7265 706c 6163 6560 600a  her ``replace``.
+00017a80: 2020 2020 2020 2020 2020 2020 6f72 2060              or `
+00017a90: 6061 6464 6974 6976 6560 602e 0a20 2020  `additive``..   
+00017aa0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00017ab0: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+00017ac0: 6374 732f 7b6e 616d 657d 220a 2020 2020  cts/{name}".    
+00017ad0: 2020 2020 6865 6164 6572 7320 3d20 7b6d      headers = {m
+00017ae0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00017af0: 6d61 732e 4865 6164 6572 4e61 6d65 732e  mas.HeaderNames.
+00017b00: 7061 7463 685f 6d6f 6465 3a20 7061 7463  patch_mode: patc
+00017b10: 685f 6d6f 6465 7d0a 2020 2020 2020 2020  h_mode}.        
+00017b20: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00017b30: 6622 4661 696c 6564 2070 6174 6368 696e  f"Failed patchin
+00017b40: 6720 7072 6f6a 6563 7420 7b6e 616d 657d  g project {name}
+00017b50: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
+00017b60: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
+00017b70: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
+00017b80: 2250 4154 4348 222c 2070 6174 682c 2065  "PATCH", path, e
+00017b90: 7272 6f72 5f6d 6573 7361 6765 2c20 626f  rror_message, bo
+00017ba0: 6479 3d64 6963 745f 746f 5f6a 736f 6e28  dy=dict_to_json(
+00017bb0: 7072 6f6a 6563 7429 2c20 6865 6164 6572  project), header
+00017bc0: 733d 6865 6164 6572 730a 2020 2020 2020  s=headers.      
+00017bd0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+00017be0: 726e 206d 6c72 756e 2e70 726f 6a65 6374  rn mlrun.project
+00017bf0: 732e 4d6c 7275 6e50 726f 6a65 6374 2e66  s.MlrunProject.f
+00017c00: 726f 6d5f 6469 6374 2872 6573 706f 6e73  rom_dict(respons
+00017c10: 652e 6a73 6f6e 2829 290a 0a20 2020 2064  e.json())..    d
+00017c20: 6566 2063 7265 6174 655f 7072 6f6a 6563  ef create_projec
+00017c30: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
+00017c40: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00017c50: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
+00017c60: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
+00017c70: 756e 5072 6f6a 6563 742c 206d 6c72 756e  unProject, mlrun
+00017c80: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00017c90: 5072 6f6a 6563 745d 2c0a 2020 2020 2920  Project],.    ) 
+00017ca0: 2d3e 206d 6c72 756e 2e70 726f 6a65 6374  -> mlrun.project
+00017cb0: 732e 4d6c 7275 6e50 726f 6a65 6374 3a0a  s.MlrunProject:.
+00017cc0: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
+00017cd0: 6520 6120 6e65 7720 7072 6f6a 6563 742e  e a new project.
+00017ce0: 2041 2070 726f 6a65 6374 2077 6974 6820   A project with 
+00017cf0: 7468 6520 7361 6d65 206e 616d 6520 6d75  the same name mu
+00017d00: 7374 206e 6f74 2065 7869 7374 2070 7269  st not exist pri
+00017d10: 6f72 2074 6f20 6372 6561 7469 6f6e 2e22  or to creation."
+00017d20: 2222 0a0a 2020 2020 2020 2020 6966 2069  ""..        if i
+00017d30: 7369 6e73 7461 6e63 6528 7072 6f6a 6563  sinstance(projec
+00017d40: 742c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  t, mlrun.common.
+00017d50: 7363 6865 6d61 732e 5072 6f6a 6563 7429  schemas.Project)
+00017d60: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00017d70: 6f6a 6563 7420 3d20 7072 6f6a 6563 742e  oject = project.
+00017d80: 6469 6374 2829 0a20 2020 2020 2020 2065  dict().        e
+00017d90: 6c69 6620 6973 696e 7374 616e 6365 2870  lif isinstance(p
+00017da0: 726f 6a65 6374 2c20 6d6c 7275 6e2e 7072  roject, mlrun.pr
+00017db0: 6f6a 6563 7473 2e4d 6c72 756e 5072 6f6a  ojects.MlrunProj
+00017dc0: 6563 7429 3a0a 2020 2020 2020 2020 2020  ect):.          
+00017dd0: 2020 7072 6f6a 6563 7420 3d20 7072 6f6a    project = proj
+00017de0: 6563 742e 746f 5f64 6963 7428 290a 2020  ect.to_dict().  
+00017df0: 2020 2020 2020 7072 6f6a 6563 745f 6e61        project_na
+00017e00: 6d65 203d 2070 726f 6a65 6374 5b22 6d65  me = project["me
+00017e10: 7461 6461 7461 225d 5b22 6e61 6d65 225d  tadata"]["name"]
+00017e20: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+00017e30: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+00017e40: 6420 6372 6561 7469 6e67 2070 726f 6a65  d creating proje
+00017e50: 6374 207b 7072 6f6a 6563 745f 6e61 6d65  ct {project_name
+00017e60: 7d22 0a20 2020 2020 2020 2072 6573 706f  }".        respo
+00017e70: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+00017e80: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+00017e90: 2022 504f 5354 222c 0a20 2020 2020 2020   "POST",.       
+00017ea0: 2020 2020 2022 7072 6f6a 6563 7473 222c       "projects",
+00017eb0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+00017ec0: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
+00017ed0: 2020 2020 2020 2020 626f 6479 3d64 6963          body=dic
+00017ee0: 745f 746f 5f6a 736f 6e28 7072 6f6a 6563  t_to_json(projec
+00017ef0: 7429 2c0a 2020 2020 2020 2020 290a 2020  t),.        ).  
+00017f00: 2020 2020 2020 6966 2072 6573 706f 6e73        if respons
+00017f10: 652e 7374 6174 7573 5f63 6f64 6520 3d3d  e.status_code ==
+00017f20: 2068 7474 702e 4854 5450 5374 6174 7573   http.HTTPStatus
+00017f30: 2e41 4343 4550 5445 443a 0a20 2020 2020  .ACCEPTED:.     
+00017f40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00017f50: 6c66 2e5f 7761 6974 5f66 6f72 5f70 726f  lf._wait_for_pro
+00017f60: 6a65 6374 5f74 6f5f 7265 6163 685f 7465  ject_to_reach_te
+00017f70: 726d 696e 616c 5f73 7461 7465 2870 726f  rminal_state(pro
+00017f80: 6a65 6374 5f6e 616d 6529 0a20 2020 2020  ject_name).     
+00017f90: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+00017fa0: 7072 6f6a 6563 7473 2e4d 6c72 756e 5072  projects.MlrunPr
+00017fb0: 6f6a 6563 742e 6672 6f6d 5f64 6963 7428  oject.from_dict(
+00017fc0: 7265 7370 6f6e 7365 2e6a 736f 6e28 2929  response.json())
+00017fd0: 0a0a 2020 2020 6465 6620 5f77 6169 745f  ..    def _wait_
+00017fe0: 666f 725f 7072 6f6a 6563 745f 746f 5f72  for_project_to_r
+00017ff0: 6561 6368 5f74 6572 6d69 6e61 6c5f 7374  each_terminal_st
+00018000: 6174 6528 0a20 2020 2020 2020 2073 656c  ate(.        sel
+00018010: 662c 2070 726f 6a65 6374 5f6e 616d 653a  f, project_name:
+00018020: 2073 7472 0a20 2020 2029 202d 3e20 6d6c   str.    ) -> ml
+00018030: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
+00018040: 756e 5072 6f6a 6563 743a 0a20 2020 2020  unProject:.     
+00018050: 2020 2064 6566 205f 7665 7269 6679 5f70     def _verify_p
+00018060: 726f 6a65 6374 5f69 6e5f 7465 726d 696e  roject_in_termin
+00018070: 616c 5f73 7461 7465 2829 3a0a 2020 2020  al_state():.    
+00018080: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
+00018090: 3d20 7365 6c66 2e67 6574 5f70 726f 6a65  = self.get_proje
+000180a0: 6374 2870 726f 6a65 6374 5f6e 616d 6529  ct(project_name)
+000180b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000180c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000180d0: 2020 7072 6f6a 6563 742e 7374 6174 7573    project.status
+000180e0: 2e73 7461 7465 0a20 2020 2020 2020 2020  .state.         
+000180f0: 2020 2020 2020 206e 6f74 2069 6e20 6d6c         not in ml
+00018100: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00018110: 6173 2e50 726f 6a65 6374 5374 6174 652e  as.ProjectState.
+00018120: 7465 726d 696e 616c 5f73 7461 7465 7328  terminal_states(
+00018130: 290a 2020 2020 2020 2020 2020 2020 293a  ).            ):
+00018140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018150: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00018160: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00018170: 2020 2020 2020 6622 5072 6f6a 6563 7420        f"Project 
+00018180: 6e6f 7420 696e 2074 6572 6d69 6e61 6c20  not in terminal 
+00018190: 7374 6174 652e 2053 7461 7465 3a20 7b70  state. State: {p
+000181a0: 726f 6a65 6374 2e73 7461 7475 732e 7374  roject.status.st
+000181b0: 6174 657d 220a 2020 2020 2020 2020 2020  ate}".          
+000181c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000181d0: 2020 2020 7265 7475 726e 2070 726f 6a65      return proje
+000181e0: 6374 0a0a 2020 2020 2020 2020 7265 7475  ct..        retu
+000181f0: 726e 206d 6c72 756e 2e75 7469 6c73 2e68  rn mlrun.utils.h
+00018200: 656c 7065 7273 2e72 6574 7279 5f75 6e74  elpers.retry_unt
+00018210: 696c 5f73 7563 6365 7373 6675 6c28 0a20  il_successful(. 
+00018220: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018230: 5f77 6169 745f 666f 725f 7072 6f6a 6563  _wait_for_projec
+00018240: 745f 7465 726d 696e 616c 5f73 7461 7465  t_terminal_state
+00018250: 5f72 6574 7279 5f69 6e74 6572 7661 6c2c  _retry_interval,
+00018260: 0a20 2020 2020 2020 2020 2020 2031 3230  .            120
+00018270: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00018280: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
+00018290: 2020 4661 6c73 652c 0a20 2020 2020 2020    False,.       
+000182a0: 2020 2020 205f 7665 7269 6679 5f70 726f       _verify_pro
+000182b0: 6a65 6374 5f69 6e5f 7465 726d 696e 616c  ject_in_terminal
+000182c0: 5f73 7461 7465 2c0a 2020 2020 2020 2020  _state,.        
+000182d0: 290a 0a20 2020 2064 6566 205f 7761 6974  )..    def _wait
+000182e0: 5f66 6f72 5f62 6163 6b67 726f 756e 645f  _for_background_
+000182f0: 7461 736b 5f74 6f5f 7265 6163 685f 7465  task_to_reach_te
+00018300: 726d 696e 616c 5f73 7461 7465 280a 2020  rminal_state(.  
+00018310: 2020 2020 2020 7365 6c66 2c20 6e61 6d65        self, name
+00018320: 3a20 7374 720a 2020 2020 2920 2d3e 206d  : str.    ) -> m
+00018330: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00018340: 6d61 732e 4261 636b 6772 6f75 6e64 5461  mas.BackgroundTa
+00018350: 736b 3a0a 2020 2020 2020 2020 6465 6620  sk:.        def 
+00018360: 5f76 6572 6966 795f 6261 636b 6772 6f75  _verify_backgrou
+00018370: 6e64 5f74 6173 6b5f 696e 5f74 6572 6d69  nd_task_in_termi
+00018380: 6e61 6c5f 7374 6174 6528 293a 0a20 2020  nal_state():.   
+00018390: 2020 2020 2020 2020 2062 6163 6b67 726f           backgro
+000183a0: 756e 645f 7461 736b 203d 2073 656c 662e  und_task = self.
+000183b0: 6765 745f 6261 636b 6772 6f75 6e64 5f74  get_background_t
+000183c0: 6173 6b28 6e61 6d65 290a 2020 2020 2020  ask(name).      
+000183d0: 2020 2020 2020 7374 6174 6520 3d20 6261        state = ba
+000183e0: 636b 6772 6f75 6e64 5f74 6173 6b2e 7374  ckground_task.st
+000183f0: 6174 7573 2e73 7461 7465 0a20 2020 2020  atus.state.     
+00018400: 2020 2020 2020 2069 6620 7374 6174 6520         if state 
+00018410: 6e6f 7420 696e 206d 6c72 756e 2e63 6f6d  not in mlrun.com
+00018420: 6d6f 6e2e 7363 6865 6d61 732e 4261 636b  mon.schemas.Back
+00018430: 6772 6f75 6e64 5461 736b 5374 6174 652e  groundTaskState.
+00018440: 7465 726d 696e 616c 5f73 7461 7465 7328  terminal_states(
+00018450: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00018460: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00018470: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00018480: 2020 2020 2020 2020 6622 4261 636b 6772          f"Backgr
+00018490: 6f75 6e64 2074 6173 6b20 6e6f 7420 696e  ound task not in
+000184a0: 2074 6572 6d69 6e61 6c20 7374 6174 652e   terminal state.
+000184b0: 206e 616d 653d 7b6e 616d 657d 2c20 7374   name={name}, st
+000184c0: 6174 653d 7b73 7461 7465 7d22 0a20 2020  ate={state}".   
+000184d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000184e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000184f0: 6e20 6261 636b 6772 6f75 6e64 5f74 6173  n background_tas
+00018500: 6b0a 0a20 2020 2020 2020 2072 6574 7572  k..        retur
+00018510: 6e20 6d6c 7275 6e2e 7574 696c 732e 6865  n mlrun.utils.he
+00018520: 6c70 6572 732e 7265 7472 795f 756e 7469  lpers.retry_unti
+00018530: 6c5f 7375 6363 6573 7366 756c 280a 2020  l_successful(.  
+00018540: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00018550: 7761 6974 5f66 6f72 5f62 6163 6b67 726f  wait_for_backgro
+00018560: 756e 645f 7461 736b 5f74 6572 6d69 6e61  und_task_termina
+00018570: 6c5f 7374 6174 655f 7265 7472 795f 696e  l_state_retry_in
+00018580: 7465 7276 616c 2c0a 2020 2020 2020 2020  terval,.        
+00018590: 2020 2020 3630 202a 2036 302c 0a20 2020      60 * 60,.   
+000185a0: 2020 2020 2020 2020 206c 6f67 6765 722c           logger,
+000185b0: 0a20 2020 2020 2020 2020 2020 2046 616c  .            Fal
+000185c0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+000185d0: 5f76 6572 6966 795f 6261 636b 6772 6f75  _verify_backgrou
+000185e0: 6e64 5f74 6173 6b5f 696e 5f74 6572 6d69  nd_task_in_termi
+000185f0: 6e61 6c5f 7374 6174 652c 0a20 2020 2020  nal_state,.     
+00018600: 2020 2029 0a0a 2020 2020 6465 6620 5f77     )..    def _w
+00018610: 6169 745f 666f 725f 7072 6f6a 6563 745f  ait_for_project_
+00018620: 746f 5f62 655f 6465 6c65 7465 6428 7365  to_be_deleted(se
+00018630: 6c66 2c20 7072 6f6a 6563 745f 6e61 6d65  lf, project_name
+00018640: 3a20 7374 7229 3a0a 2020 2020 2020 2020  : str):.        
+00018650: 6465 6620 5f76 6572 6966 795f 7072 6f6a  def _verify_proj
+00018660: 6563 745f 6465 6c65 7465 6428 293a 0a20  ect_deleted():. 
+00018670: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+00018680: 6374 7320 3d20 7365 6c66 2e6c 6973 745f  cts = self.list_
+00018690: 7072 6f6a 6563 7473 280a 2020 2020 2020  projects(.      
+000186a0: 2020 2020 2020 2020 2020 666f 726d 6174            format
+000186b0: 5f3d 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  _=mlrun.common.s
+000186c0: 6368 656d 6173 2e50 726f 6a65 6374 7346  chemas.ProjectsF
+000186d0: 6f72 6d61 742e 6e61 6d65 5f6f 6e6c 790a  ormat.name_only.
+000186e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000186f0: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
+00018700: 6a65 6374 5f6e 616d 6520 696e 2070 726f  ject_name in pro
+00018710: 6a65 6374 733a 0a20 2020 2020 2020 2020  jects:.         
+00018720: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+00018730: 6570 7469 6f6e 2822 5072 6f6a 6563 7420  eption("Project 
+00018740: 7374 696c 6c20 6578 6973 7473 2229 0a0a  still exists")..
+00018750: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00018760: 6c72 756e 2e75 7469 6c73 2e68 656c 7065  lrun.utils.helpe
+00018770: 7273 2e72 6574 7279 5f75 6e74 696c 5f73  rs.retry_until_s
+00018780: 7563 6365 7373 6675 6c28 0a20 2020 2020  uccessful(.     
+00018790: 2020 2020 2020 2073 656c 662e 5f77 6169         self._wai
+000187a0: 745f 666f 725f 7072 6f6a 6563 745f 6465  t_for_project_de
+000187b0: 6c65 7469 6f6e 5f69 6e74 6572 7661 6c2c  letion_interval,
+000187c0: 0a20 2020 2020 2020 2020 2020 2031 3230  .            120
+000187d0: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+000187e0: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
+000187f0: 2020 4661 6c73 652c 0a20 2020 2020 2020    False,.       
+00018800: 2020 2020 205f 7665 7269 6679 5f70 726f       _verify_pro
+00018810: 6a65 6374 5f64 656c 6574 6564 2c0a 2020  ject_deleted,.  
+00018820: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00018830: 2063 7265 6174 655f 7072 6f6a 6563 745f   create_project_
+00018840: 7365 6372 6574 7328 0a20 2020 2020 2020  secrets(.       
+00018850: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+00018860: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
+00018870: 2020 2020 2070 726f 7669 6465 723a 2055       provider: U
+00018880: 6e69 6f6e 5b0a 2020 2020 2020 2020 2020  nion[.          
+00018890: 2020 7374 722c 206d 6c72 756e 2e63 6f6d    str, mlrun.com
+000188a0: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
+000188b0: 6574 5072 6f76 6964 6572 4e61 6d65 0a20  etProviderName. 
+000188c0: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
+000188d0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+000188e0: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
+000188f0: 6d65 2e6b 7562 6572 6e65 7465 732c 0a20  me.kubernetes,. 
+00018900: 2020 2020 2020 2073 6563 7265 7473 3a20         secrets: 
+00018910: 6469 6374 203d 204e 6f6e 652c 0a20 2020  dict = None,.   
+00018920: 2029 3a0a 2020 2020 2020 2020 2222 2243   ):.        """C
+00018930: 7265 6174 6520 7072 6f6a 6563 742d 636f  reate project-co
+00018940: 6e74 6578 7420 7365 6372 6574 7320 7573  ntext secrets us
+00018950: 696e 6720 6569 7468 6572 2060 6076 6175  ing either ``vau
+00018960: 6c74 6060 206f 7220 6060 6b75 6265 726e  lt`` or ``kubern
+00018970: 6574 6573 6060 2070 726f 7669 6465 722e  etes`` provider.
+00018980: 0a20 2020 2020 2020 2057 6865 6e20 7573  .        When us
+00018990: 696e 6720 7769 7468 2056 6175 6c74 2c20  ing with Vault, 
+000189a0: 7468 6973 2077 696c 6c20 6372 6561 7465  this will create
+000189b0: 206e 6565 6465 6420 5661 756c 7420 7374   needed Vault st
+000189c0: 7275 6374 7572 6573 2066 6f72 2073 746f  ructures for sto
+000189d0: 7269 6e67 2073 6563 7265 7473 2069 6e20  ring secrets in 
+000189e0: 7072 6f6a 6563 742d 636f 6e74 6578 742c  project-context,
+000189f0: 2061 6e64 0a20 2020 2020 2020 2073 746f   and.        sto
+00018a00: 7265 2061 2073 6574 206f 6620 7365 6372  re a set of secr
+00018a10: 6574 2076 616c 7565 732e 2054 6865 206d  et values. The m
+00018a20: 6574 686f 6420 6765 6e65 7261 7465 7320  ethod generates 
+00018a30: 4b75 6265 726e 6574 6573 2073 6572 7669  Kubernetes servi
+00018a40: 6365 2d61 6363 6f75 6e74 2061 6e64 2074  ce-account and t
+00018a50: 6865 2056 6175 6c74 2061 7574 6865 6e74  he Vault authent
+00018a60: 6963 6174 696f 6e0a 2020 2020 2020 2020  ication.        
+00018a70: 7374 7275 6374 7572 6573 2074 6861 7420  structures that 
+00018a80: 6172 6520 7265 7175 6972 6564 2066 6f72  are required for
+00018a90: 2066 756e 6374 696f 6e20 506f 6473 2074   function Pods t
+00018aa0: 6f20 6175 7468 656e 7469 6361 7465 2077  o authenticate w
+00018ab0: 6974 6820 5661 756c 7420 616e 6420 6265  ith Vault and be
+00018ac0: 2061 626c 6520 746f 2065 7874 7261 6374   able to extract
+00018ad0: 2073 6563 7265 7420 7661 6c75 6573 0a20   secret values. 
+00018ae0: 2020 2020 2020 2070 6173 7365 6420 6173         passed as
+00018af0: 2070 6172 7420 6f66 2074 6865 6972 2063   part of their c
+00018b00: 6f6e 7465 7874 2e0a 0a20 2020 2020 2020  ontext...       
+00018b10: 204e 6f74 653a 0a20 2020 2020 2020 2020   Note:.         
+00018b20: 2020 2020 2020 2054 6869 7320 6d65 7468         This meth
+00018b30: 6f64 2075 7365 6420 7769 7468 2056 6175  od used with Vau
+00018b40: 6c74 2069 7320 6375 7272 656e 746c 7920  lt is currently 
+00018b50: 696e 2074 6563 686e 6963 616c 2070 7265  in technical pre
+00018b60: 7669 6577 2c20 616e 6420 7265 7175 6972  view, and requir
+00018b70: 6573 2061 2048 6173 6869 436f 7270 2056  es a HashiCorp V
+00018b80: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
+00018b90: 2020 2020 2069 6e66 7261 7374 7275 6374       infrastruct
+00018ba0: 7572 6520 7072 6f70 6572 6c79 2073 6574  ure properly set
+00018bb0: 2075 7020 616e 6420 636f 6e6e 6563 7465   up and connecte
+00018bc0: 6420 746f 2074 6865 204d 4c52 756e 2041  d to the MLRun A
+00018bd0: 5049 2073 6572 7665 722e 0a0a 2020 2020  PI server...    
+00018be0: 2020 2020 5768 656e 2075 7365 6420 7769      When used wi
+00018bf0: 7468 204b 7562 6572 6e65 7465 732c 2074  th Kubernetes, t
+00018c00: 6869 7320 7769 6c6c 206d 616b 6520 7375  his will make su
+00018c10: 7265 2074 6861 7420 7468 6520 7072 6f6a  re that the proj
+00018c20: 6563 742d 7370 6563 6966 6963 206b 3873  ect-specific k8s
+00018c30: 2073 6563 7265 7420 6973 2063 7265 6174   secret is creat
+00018c40: 6564 2c20 616e 6420 7769 6c6c 0a20 2020  ed, and will.   
+00018c50: 2020 2020 2070 6f70 756c 6174 6520 6974       populate it
+00018c60: 2077 6974 6820 7468 6520 7365 6372 6574   with the secret
+00018c70: 7320 7072 6f76 6964 6564 2c20 7265 706c  s provided, repl
+00018c80: 6163 696e 6720 7468 6569 7220 7661 6c75  acing their valu
+00018c90: 6573 2069 6620 7468 6579 2065 7869 7374  es if they exist
+00018ca0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00018cb0: 6d20 7072 6f6a 6563 743a 2054 6865 2070  m project: The p
+00018cc0: 726f 6a65 6374 2063 6f6e 7465 7874 2066  roject context f
+00018cd0: 6f72 2077 6869 6368 2074 6f20 6765 6e65  or which to gene
+00018ce0: 7261 7465 2074 6865 2069 6e66 7261 2061  rate the infra a
+00018cf0: 6e64 2073 746f 7265 2073 6563 7265 7473  nd store secrets
+00018d00: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00018d10: 2070 726f 7669 6465 723a 2054 6865 206e   provider: The n
+00018d20: 616d 6520 6f66 2074 6865 2073 6563 7265  ame of the secre
+00018d30: 7473 2d70 726f 7669 6465 7220 746f 2077  ts-provider to w
+00018d40: 6f72 6b20 7769 7468 2e20 4163 6365 7074  ork with. Accept
+00018d50: 7320 610a 2020 2020 2020 2020 2020 2020  s a.            
+00018d60: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
+00018d70: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00018d80: 2e73 6563 7265 742e 5365 6372 6574 5072  .secret.SecretPr
+00018d90: 6f76 6964 6572 4e61 6d65 6020 656e 756d  oviderName` enum
+00018da0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00018db0: 2073 6563 7265 7473 3a20 4120 7365 7420   secrets: A set 
+00018dc0: 6f66 2073 6563 7265 7420 7661 6c75 6573  of secret values
+00018dd0: 2074 6f20 7374 6f72 652e 0a20 2020 2020   to store..     
+00018de0: 2020 2020 2020 2045 7861 6d70 6c65 3a3a         Example::
+00018df0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018e00: 2020 7365 6372 6574 7320 3d20 7b27 7061    secrets = {'pa
+00018e10: 7373 776f 7264 273a 2027 6d79 5061 7373  ssword': 'myPass
+00018e20: 7730 7264 272c 2027 6177 735f 6b65 7927  w0rd', 'aws_key'
+00018e30: 3a20 2731 3131 3232 3233 3333 277d 0a20  : '111222333'}. 
+00018e40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00018e50: 622e 6372 6561 7465 5f70 726f 6a65 6374  b.create_project
+00018e60: 5f73 6563 7265 7473 280a 2020 2020 2020  _secrets(.      
+00018e70: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+00018e80: 726f 6a65 6374 3122 2c0a 2020 2020 2020  roject1",.      
+00018e90: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00018ea0: 6f76 6964 6572 3d6d 6c72 756e 2e63 6f6d  ovider=mlrun.com
+00018eb0: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
+00018ec0: 6574 5072 6f76 6964 6572 4e61 6d65 2e6b  etProviderName.k
+00018ed0: 7562 6572 6e65 7465 732c 0a20 2020 2020  ubernetes,.     
+00018ee0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018ef0: 6563 7265 7473 3d73 6563 7265 7473 0a20  ecrets=secrets. 
+00018f00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00018f10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018f20: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
+00018f30: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+00018f40: 2f73 6563 7265 7473 220a 2020 2020 2020  /secrets".      
+00018f50: 2020 7365 6372 6574 735f 696e 7075 7420    secrets_input 
+00018f60: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+00018f70: 6368 656d 6173 2e53 6563 7265 7473 4461  chemas.SecretsDa
+00018f80: 7461 280a 2020 2020 2020 2020 2020 2020  ta(.            
+00018f90: 7365 6372 6574 733d 7365 6372 6574 732c  secrets=secrets,
+00018fa0: 2070 726f 7669 6465 723d 7072 6f76 6964   provider=provid
+00018fb0: 6572 0a20 2020 2020 2020 2029 0a20 2020  er.        ).   
+00018fc0: 2020 2020 2062 6f64 7920 3d20 7365 6372       body = secr
+00018fd0: 6574 735f 696e 7075 742e 6469 6374 2829  ets_input.dict()
+00018fe0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+00018ff0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+00019000: 6420 6372 6561 7469 6e67 2073 6563 7265  d creating secre
+00019010: 7420 7072 6f76 6964 6572 207b 7072 6f6a  t provider {proj
+00019020: 6563 747d 2f7b 7072 6f76 6964 6572 7d22  ect}/{provider}"
+00019030: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
+00019040: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+00019050: 2020 2020 2250 4f53 5422 2c0a 2020 2020      "POST",.    
+00019060: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
+00019070: 2020 2020 2020 2020 2020 6572 726f 725f            error_
+00019080: 6d65 7373 6167 652c 0a20 2020 2020 2020  message,.       
+00019090: 2020 2020 2062 6f64 793d 6469 6374 5f74       body=dict_t
+000190a0: 6f5f 6a73 6f6e 2862 6f64 7929 2c0a 2020  o_json(body),.  
+000190b0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000190c0: 206c 6973 745f 7072 6f6a 6563 745f 7365   list_project_se
+000190d0: 6372 6574 7328 0a20 2020 2020 2020 2073  crets(.        s
+000190e0: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
+000190f0: 6a65 6374 3a20 7374 722c 0a20 2020 2020  ject: str,.     
+00019100: 2020 2074 6f6b 656e 3a20 7374 7220 3d20     token: str = 
+00019110: 4e6f 6e65 2c0a 2020 2020 2020 2020 7072  None,.        pr
+00019120: 6f76 6964 6572 3a20 556e 696f 6e5b 0a20  ovider: Union[. 
+00019130: 2020 2020 2020 2020 2020 2073 7472 2c20             str, 
+00019140: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00019150: 656d 6173 2e53 6563 7265 7450 726f 7669  emas.SecretProvi
+00019160: 6465 724e 616d 650a 2020 2020 2020 2020  derName.        
+00019170: 5d20 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e  ] = mlrun.common
+00019180: 2e73 6368 656d 6173 2e53 6563 7265 7450  .schemas.SecretP
+00019190: 726f 7669 6465 724e 616d 652e 6b75 6265  roviderName.kube
+000191a0: 726e 6574 6573 2c0a 2020 2020 2020 2020  rnetes,.        
+000191b0: 7365 6372 6574 733a 204c 6973 745b 7374  secrets: List[st
+000191c0: 725d 203d 204e 6f6e 652c 0a20 2020 2029  r] = None,.    )
+000191d0: 202d 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e   -> mlrun.common
+000191e0: 2e73 6368 656d 6173 2e53 6563 7265 7473  .schemas.Secrets
+000191f0: 4461 7461 3a0a 2020 2020 2020 2020 2222  Data:.        ""
+00019200: 2252 6574 7269 6576 6520 7072 6f6a 6563  "Retrieve projec
+00019210: 742d 636f 6e74 6578 7420 7365 6372 6574  t-context secret
+00019220: 7320 6672 6f6d 2056 6175 6c74 2e0a 0a20  s from Vault... 
+00019230: 2020 2020 2020 204e 6f74 653a 0a20 2020         Note:.   
+00019240: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
+00019250: 7320 6d65 7468 6f64 2066 6f72 2056 6175  s method for Vau
+00019260: 6c74 2066 756e 6374 696f 6e61 6c69 7479  lt functionality
+00019270: 2069 7320 6375 7272 656e 746c 7920 696e   is currently in
+00019280: 2074 6563 686e 6963 616c 2070 7265 7669   technical previ
+00019290: 6577 2c20 616e 6420 7265 7175 6972 6573  ew, and requires
+000192a0: 2061 2048 6173 6869 436f 7270 2056 6175   a HashiCorp Vau
+000192b0: 6c74 0a20 2020 2020 2020 2020 2020 2020  lt.             
+000192c0: 2020 2069 6e66 7261 7374 7275 6374 7572     infrastructur
+000192d0: 6520 7072 6f70 6572 6c79 2073 6574 2075  e properly set u
+000192e0: 7020 616e 6420 636f 6e6e 6563 7465 6420  p and connected 
+000192f0: 746f 2074 6865 204d 4c52 756e 2041 5049  to the MLRun API
+00019300: 2073 6572 7665 722e 0a0a 2020 2020 2020   server...      
+00019310: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+00019320: 3a20 5468 6520 7072 6f6a 6563 7420 6e61  : The project na
+00019330: 6d65 2e0a 2020 2020 2020 2020 3a70 6172  me..        :par
+00019340: 616d 2074 6f6b 656e 3a20 5661 756c 7420  am token: Vault 
+00019350: 746f 6b65 6e20 746f 2075 7365 2066 6f72  token to use for
+00019360: 2072 6574 7269 6576 696e 6720 7365 6372   retrieving secr
+00019370: 6574 732e 0a20 2020 2020 2020 2020 2020  ets..           
+00019380: 204d 7573 7420 6265 2061 2076 616c 6964   Must be a valid
+00019390: 2056 6175 6c74 2074 6f6b 656e 2c20 7769   Vault token, wi
+000193a0: 7468 2070 6572 6d69 7373 696f 6e73 2074  th permissions t
+000193b0: 6f20 7265 7472 6965 7665 2073 6563 7265  o retrieve secre
+000193c0: 7473 206f 6620 7468 6520 7072 6f6a 6563  ts of the projec
+000193d0: 7420 696e 2071 7565 7374 696f 6e2e 0a20  t in question.. 
+000193e0: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+000193f0: 6f76 6964 6572 3a20 5468 6520 6e61 6d65  ovider: The name
+00019400: 206f 6620 7468 6520 7365 6372 6574 732d   of the secrets-
+00019410: 7072 6f76 6964 6572 2074 6f20 776f 726b  provider to work
+00019420: 2077 6974 682e 2043 7572 7265 6e74 6c79   with. Currently
+00019430: 206f 6e6c 7920 6060 7661 756c 7460 6020   only ``vault`` 
+00019440: 6973 2061 6363 6570 7465 642e 0a20 2020  is accepted..   
+00019450: 2020 2020 203a 7061 7261 6d20 7365 6372       :param secr
+00019460: 6574 733a 2041 206c 6973 7420 6f66 2073  ets: A list of s
+00019470: 6563 7265 7420 6e61 6d65 7320 746f 2072  ecret names to r
+00019480: 6574 7269 6576 652e 2041 6e20 656d 7074  etrieve. An empt
+00019490: 7920 6c69 7374 2060 605b 5d60 6020 7769  y list ``[]`` wi
+000194a0: 6c6c 2072 6574 7269 6576 6520 616c 6c20  ll retrieve all 
+000194b0: 7365 6372 6574 7320 6173 7369 676e 6564  secrets assigned
+000194c0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+000194d0: 7468 6973 2073 7065 6369 6669 6320 7072  this specific pr
+000194e0: 6f6a 6563 742e 2060 606b 7562 6572 6e65  oject. ``kuberne
+000194f0: 7465 7360 6020 7072 6f76 6964 6572 206f  tes`` provider o
+00019500: 6e6c 7920 7375 7070 6f72 7473 2061 6e20  nly supports an 
+00019510: 656d 7074 7920 6c69 7374 2e0a 2020 2020  empty list..    
+00019520: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00019530: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00019540: 2020 7072 6f76 6964 6572 203d 3d20 6d6c    provider == ml
+00019550: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00019560: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
+00019570: 724e 616d 652e 7661 756c 742e 7661 6c75  rName.vault.valu
+00019580: 650a 2020 2020 2020 2020 2020 2020 616e  e.            an
+00019590: 6420 6e6f 7420 746f 6b65 6e0a 2020 2020  d not token.    
+000195a0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+000195b0: 2020 2072 6169 7365 204d 4c52 756e 496e     raise MLRunIn
+000195c0: 7661 6c69 6441 7267 756d 656e 7445 7272  validArgumentErr
+000195d0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+000195e0: 2020 2020 2241 2076 6175 6c74 2074 6f6b      "A vault tok
+000195f0: 656e 206d 7573 7420 6265 2070 726f 7669  en must be provi
+00019600: 6465 6420 7768 656e 2061 6363 6573 7369  ded when accessi
+00019610: 6e67 2076 6175 6c74 2073 6563 7265 7473  ng vault secrets
+00019620: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00019630: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00019640: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+00019650: 6563 747d 2f73 6563 7265 7473 220a 2020  ect}/secrets".  
+00019660: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+00019670: 2270 726f 7669 6465 7222 3a20 7072 6f76  "provider": prov
+00019680: 6964 6572 2c20 2273 6563 7265 7422 3a20  ider, "secret": 
+00019690: 7365 6372 6574 737d 0a20 2020 2020 2020  secrets}.       
+000196a0: 2068 6561 6465 7273 203d 207b 6d6c 7275   headers = {mlru
+000196b0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+000196c0: 2e48 6561 6465 724e 616d 6573 2e73 6563  .HeaderNames.sec
+000196d0: 7265 745f 7374 6f72 655f 746f 6b65 6e3a  ret_store_token:
+000196e0: 2074 6f6b 656e 7d0a 2020 2020 2020 2020   token}.        
+000196f0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00019700: 6622 4661 696c 6564 2072 6574 7269 6576  f"Failed retriev
+00019710: 696e 6720 7365 6372 6574 7320 7b70 726f  ing secrets {pro
+00019720: 6a65 6374 7d2f 7b70 726f 7669 6465 727d  ject}/{provider}
+00019730: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
+00019740: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+00019750: 280a 2020 2020 2020 2020 2020 2020 2247  (.            "G
+00019760: 4554 222c 0a20 2020 2020 2020 2020 2020  ET",.           
+00019770: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
+00019780: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+00019790: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+000197a0: 7261 6d73 3d70 6172 616d 732c 0a20 2020  rams=params,.   
+000197b0: 2020 2020 2020 2020 2068 6561 6465 7273           headers
+000197c0: 3d68 6561 6465 7273 2c0a 2020 2020 2020  =headers,.      
+000197d0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+000197e0: 726e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rn mlrun.common.
+000197f0: 7363 6865 6d61 732e 5365 6372 6574 7344  schemas.SecretsD
+00019800: 6174 6128 2a2a 7265 7375 6c74 2e6a 736f  ata(**result.jso
+00019810: 6e28 2929 0a0a 2020 2020 6465 6620 6c69  n())..    def li
+00019820: 7374 5f70 726f 6a65 6374 5f73 6563 7265  st_project_secre
+00019830: 745f 6b65 7973 280a 2020 2020 2020 2020  t_keys(.        
+00019840: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+00019850: 6f6a 6563 743a 2073 7472 2c0a 2020 2020  oject: str,.    
+00019860: 2020 2020 7072 6f76 6964 6572 3a20 556e      provider: Un
+00019870: 696f 6e5b 0a20 2020 2020 2020 2020 2020  ion[.           
+00019880: 2073 7472 2c20 6d6c 7275 6e2e 636f 6d6d   str, mlrun.comm
+00019890: 6f6e 2e73 6368 656d 6173 2e53 6563 7265  on.schemas.Secre
+000198a0: 7450 726f 7669 6465 724e 616d 650a 2020  tProviderName.  
+000198b0: 2020 2020 2020 5d20 3d20 6d6c 7275 6e2e        ] = mlrun.
+000198c0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+000198d0: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
+000198e0: 652e 6b75 6265 726e 6574 6573 2c0a 2020  e.kubernetes,.  
+000198f0: 2020 2020 2020 746f 6b65 6e3a 2073 7472        token: str
+00019900: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00019910: 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  > mlrun.common.s
+00019920: 6368 656d 6173 2e53 6563 7265 744b 6579  chemas.SecretKey
+00019930: 7344 6174 613a 0a20 2020 2020 2020 2022  sData:.        "
+00019940: 2222 5265 7472 6965 7665 2070 726f 6a65  ""Retrieve proje
+00019950: 6374 2d63 6f6e 7465 7874 2073 6563 7265  ct-context secre
+00019960: 7420 6b65 7973 2066 726f 6d20 5661 756c  t keys from Vaul
+00019970: 7420 6f72 204b 7562 6572 6e65 7465 732e  t or Kubernetes.
+00019980: 0a0a 2020 2020 2020 2020 4e6f 7465 3a0a  ..        Note:.
+00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199a0: 5468 6973 206d 6574 686f 6420 666f 7220  This method for 
+000199b0: 5661 756c 7420 6675 6e63 7469 6f6e 616c  Vault functional
+000199c0: 6974 7920 6973 2063 7572 7265 6e74 6c79  ity is currently
+000199d0: 2069 6e20 7465 6368 6e69 6361 6c20 7072   in technical pr
+000199e0: 6576 6965 772c 2061 6e64 2072 6571 7569  eview, and requi
+000199f0: 7265 7320 6120 4861 7368 6943 6f72 7020  res a HashiCorp 
+00019a00: 5661 756c 740a 2020 2020 2020 2020 2020  Vault.          
+00019a10: 2020 2020 2020 696e 6672 6173 7472 7563        infrastruc
+00019a20: 7475 7265 2070 726f 7065 726c 7920 7365  ture properly se
+00019a30: 7420 7570 2061 6e64 2063 6f6e 6e65 6374  t up and connect
+00019a40: 6564 2074 6f20 7468 6520 4d4c 5275 6e20  ed to the MLRun 
+00019a50: 4150 4920 7365 7276 6572 2e0a 0a20 2020  API server...   
+00019a60: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+00019a70: 6563 743a 2054 6865 2070 726f 6a65 6374  ect: The project
+00019a80: 206e 616d 652e 0a20 2020 2020 2020 203a   name..        :
+00019a90: 7061 7261 6d20 7072 6f76 6964 6572 3a20  param provider: 
+00019aa0: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
+00019ab0: 7365 6372 6574 732d 7072 6f76 6964 6572  secrets-provider
+00019ac0: 2074 6f20 776f 726b 2077 6974 682e 2041   to work with. A
+00019ad0: 6363 6570 7473 2061 0a20 2020 2020 2020  ccepts a.       
+00019ae0: 2020 2020 203a 7079 3a63 6c61 7373 3a60       :py:class:`
+00019af0: 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  ~mlrun.common.sc
+00019b00: 6865 6d61 732e 7365 6372 6574 2e53 6563  hemas.secret.Sec
+00019b10: 7265 7450 726f 7669 6465 724e 616d 6560  retProviderName`
+00019b20: 2065 6e75 6d2e 0a20 2020 2020 2020 203a   enum..        :
+00019b30: 7061 7261 6d20 746f 6b65 6e3a 2056 6175  param token: Vau
+00019b40: 6c74 2074 6f6b 656e 2074 6f20 7573 6520  lt token to use 
+00019b50: 666f 7220 7265 7472 6965 7669 6e67 2073  for retrieving s
+00019b60: 6563 7265 7473 2e20 4f6e 6c79 2069 6e20  ecrets. Only in 
+00019b70: 7573 6520 6966 2060 6070 726f 7669 6465  use if ``provide
+00019b80: 7260 6020 6973 2060 6076 6175 6c74 6060  r`` is ``vault``
+00019b90: 2e0a 2020 2020 2020 2020 2020 2020 4d75  ..            Mu
+00019ba0: 7374 2062 6520 6120 7661 6c69 6420 5661  st be a valid Va
+00019bb0: 756c 7420 746f 6b65 6e2c 2077 6974 6820  ult token, with 
+00019bc0: 7065 726d 6973 7369 6f6e 7320 746f 2072  permissions to r
+00019bd0: 6574 7269 6576 6520 7365 6372 6574 7320  etrieve secrets 
+00019be0: 6f66 2074 6865 2070 726f 6a65 6374 2069  of the project i
+00019bf0: 6e20 7175 6573 7469 6f6e 2e0a 2020 2020  n question..    
+00019c00: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00019c10: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00019c20: 2020 7072 6f76 6964 6572 203d 3d20 6d6c    provider == ml
+00019c30: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00019c40: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
+00019c50: 724e 616d 652e 7661 756c 742e 7661 6c75  rName.vault.valu
+00019c60: 650a 2020 2020 2020 2020 2020 2020 616e  e.            an
+00019c70: 6420 6e6f 7420 746f 6b65 6e0a 2020 2020  d not token.    
+00019c80: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00019c90: 2020 2072 6169 7365 204d 4c52 756e 496e     raise MLRunIn
+00019ca0: 7661 6c69 6441 7267 756d 656e 7445 7272  validArgumentErr
+00019cb0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00019cc0: 2020 2020 2241 2076 6175 6c74 2074 6f6b      "A vault tok
+00019cd0: 656e 206d 7573 7420 6265 2070 726f 7669  en must be provi
+00019ce0: 6465 6420 7768 656e 2061 6363 6573 7369  ded when accessi
+00019cf0: 6e67 2076 6175 6c74 2073 6563 7265 7473  ng vault secrets
+00019d00: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00019d10: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00019d20: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+00019d30: 6563 747d 2f73 6563 7265 742d 6b65 7973  ect}/secret-keys
+00019d40: 220a 2020 2020 2020 2020 7061 7261 6d73  ".        params
+00019d50: 203d 207b 2270 726f 7669 6465 7222 3a20   = {"provider": 
+00019d60: 7072 6f76 6964 6572 7d0a 2020 2020 2020  provider}.      
+00019d70: 2020 6865 6164 6572 7320 3d20 280a 2020    headers = (.  
+00019d80: 2020 2020 2020 2020 2020 7b6d 6c72 756e            {mlrun
+00019d90: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00019da0: 4865 6164 6572 4e61 6d65 732e 7365 6372  HeaderNames.secr
+00019db0: 6574 5f73 746f 7265 5f74 6f6b 656e 3a20  et_store_token: 
+00019dc0: 746f 6b65 6e7d 0a20 2020 2020 2020 2020  token}.         
+00019dd0: 2020 2069 6620 7072 6f76 6964 6572 203d     if provider =
+00019de0: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+00019df0: 6368 656d 6173 2e53 6563 7265 7450 726f  chemas.SecretPro
+00019e00: 7669 6465 724e 616d 652e 7661 756c 742e  viderName.vault.
+00019e10: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
+00019e20: 2020 656c 7365 204e 6f6e 650a 2020 2020    else None.    
+00019e30: 2020 2020 290a 2020 2020 2020 2020 6572      ).        er
+00019e40: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+00019e50: 4661 696c 6564 2072 6574 7269 6576 696e  Failed retrievin
+00019e60: 6720 7365 6372 6574 206b 6579 7320 7b70  g secret keys {p
+00019e70: 726f 6a65 6374 7d2f 7b70 726f 7669 6465  roject}/{provide
+00019e80: 727d 220a 2020 2020 2020 2020 7265 7375  r}".        resu
+00019e90: 6c74 203d 2073 656c 662e 6170 695f 6361  lt = self.api_ca
+00019ea0: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
+00019eb0: 2247 4554 222c 0a20 2020 2020 2020 2020  "GET",.         
+00019ec0: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
+00019ed0: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00019ee0: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
+00019ef0: 7061 7261 6d73 3d70 6172 616d 732c 0a20  params=params,. 
+00019f00: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00019f10: 7273 3d68 6561 6465 7273 2c0a 2020 2020  rs=headers,.    
+00019f20: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00019f30: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
+00019f40: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
+00019f50: 4b65 7973 4461 7461 282a 2a72 6573 756c  KeysData(**resul
+00019f60: 742e 6a73 6f6e 2829 290a 0a20 2020 2064  t.json())..    d
+00019f70: 6566 2064 656c 6574 655f 7072 6f6a 6563  ef delete_projec
+00019f80: 745f 7365 6372 6574 7328 0a20 2020 2020  t_secrets(.     
+00019f90: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00019fa0: 2070 726f 6a65 6374 3a20 7374 722c 0a20   project: str,. 
+00019fb0: 2020 2020 2020 2070 726f 7669 6465 723a         provider:
+00019fc0: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
+00019fd0: 2020 2020 7374 722c 206d 6c72 756e 2e63      str, mlrun.c
+00019fe0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5365  ommon.schemas.Se
+00019ff0: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
+0001a000: 0a20 2020 2020 2020 205d 203d 206d 6c72  .        ] = mlr
+0001a010: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001a020: 732e 5365 6372 6574 5072 6f76 6964 6572  s.SecretProvider
+0001a030: 4e61 6d65 2e6b 7562 6572 6e65 7465 732c  Name.kubernetes,
+0001a040: 0a20 2020 2020 2020 2073 6563 7265 7473  .        secrets
+0001a050: 3a20 4c69 7374 5b73 7472 5d20 3d20 4e6f  : List[str] = No
+0001a060: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
+0001a070: 2020 2022 2222 4465 6c65 7465 2070 726f     """Delete pro
+0001a080: 6a65 6374 2d63 6f6e 7465 7874 2073 6563  ject-context sec
+0001a090: 7265 7473 2066 726f 6d20 4b75 6265 726e  rets from Kubern
+0001a0a0: 6574 6573 2e0a 0a20 2020 2020 2020 203a  etes...        :
+0001a0b0: 7061 7261 6d20 7072 6f6a 6563 743a 2054  param project: T
+0001a0c0: 6865 2070 726f 6a65 6374 206e 616d 652e  he project name.
+0001a0d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001a0e0: 7072 6f76 6964 6572 3a20 5468 6520 6e61  provider: The na
+0001a0f0: 6d65 206f 6620 7468 6520 7365 6372 6574  me of the secret
+0001a100: 732d 7072 6f76 6964 6572 2074 6f20 776f  s-provider to wo
+0001a110: 726b 2077 6974 682e 2043 7572 7265 6e74  rk with. Current
+0001a120: 6c79 206f 6e6c 7920 6060 6b75 6265 726e  ly only ``kubern
+0001a130: 6574 6573 6060 2069 7320 7375 7070 6f72  etes`` is suppor
+0001a140: 7465 642e 0a20 2020 2020 2020 203a 7061  ted..        :pa
+0001a150: 7261 6d20 7365 6372 6574 733a 2041 206c  ram secrets: A l
+0001a160: 6973 7420 6f66 2073 6563 7265 7420 6e61  ist of secret na
+0001a170: 6d65 7320 746f 2064 656c 6574 652e 2041  mes to delete. A
+0001a180: 6e20 656d 7074 7920 6c69 7374 2077 696c  n empty list wil
+0001a190: 6c20 6465 6c65 7465 2061 6c6c 2073 6563  l delete all sec
+0001a1a0: 7265 7473 2061 7373 6967 6e65 640a 2020  rets assigned.  
+0001a1b0: 2020 2020 2020 2020 2020 746f 2074 6869            to thi
+0001a1c0: 7320 7370 6563 6966 6963 2070 726f 6a65  s specific proje
+0001a1d0: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+0001a1e0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0001a1f0: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+0001a200: 6563 747d 2f73 6563 7265 7473 220a 2020  ect}/secrets".  
+0001a210: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+0001a220: 2270 726f 7669 6465 7222 3a20 7072 6f76  "provider": prov
+0001a230: 6964 6572 2c20 2273 6563 7265 7422 3a20  ider, "secret": 
+0001a240: 7365 6372 6574 737d 0a20 2020 2020 2020  secrets}.       
+0001a250: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+0001a260: 2066 2246 6169 6c65 6420 6465 6c65 7469   f"Failed deleti
+0001a270: 6e67 2073 6563 7265 7473 207b 7072 6f6a  ng secrets {proj
+0001a280: 6563 747d 2f7b 7072 6f76 6964 6572 7d22  ect}/{provider}"
+0001a290: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
+0001a2a0: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+0001a2b0: 2020 2020 2244 454c 4554 4522 2c0a 2020      "DELETE",.  
+0001a2c0: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
+0001a2d0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0001a2e0: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
+0001a2f0: 2020 2020 2020 2070 6172 616d 733d 7061         params=pa
+0001a300: 7261 6d73 2c0a 2020 2020 2020 2020 290a  rams,.        ).
+0001a310: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+0001a320: 7573 6572 5f73 6563 7265 7473 280a 2020  user_secrets(.  
+0001a330: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001a340: 2020 2020 7573 6572 3a20 7374 722c 0a20      user: str,. 
+0001a350: 2020 2020 2020 2070 726f 7669 6465 723a         provider:
+0001a360: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
+0001a370: 2020 2020 7374 722c 206d 6c72 756e 2e63      str, mlrun.c
+0001a380: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5365  ommon.schemas.Se
+0001a390: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
+0001a3a0: 0a20 2020 2020 2020 205d 203d 206d 6c72  .        ] = mlr
+0001a3b0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001a3c0: 732e 5365 6372 6574 5072 6f76 6964 6572  s.SecretProvider
+0001a3d0: 4e61 6d65 2e76 6175 6c74 2c0a 2020 2020  Name.vault,.    
+0001a3e0: 2020 2020 7365 6372 6574 733a 2064 6963      secrets: dic
+0001a3f0: 7420 3d20 4e6f 6e65 2c0a 2020 2020 293a  t = None,.    ):
+0001a400: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+0001a410: 7465 2075 7365 722d 636f 6e74 6578 7420  te user-context 
+0001a420: 7365 6372 6574 2069 6e20 5661 756c 742e  secret in Vault.
+0001a430: 2050 6c65 6173 6520 7265 6665 7220 746f   Please refer to
+0001a440: 203a 7079 3a66 756e 633a 6063 7265 6174   :py:func:`creat
+0001a450: 655f 7072 6f6a 6563 745f 7365 6372 6574  e_project_secret
+0001a460: 7360 2066 6f72 206d 6f72 6520 6465 7461  s` for more deta
+0001a470: 696c 730a 2020 2020 2020 2020 616e 6420  ils.        and 
+0001a480: 7374 6174 7573 206f 6620 7468 6973 2066  status of this f
+0001a490: 756e 6374 696f 6e61 6c69 7479 2e0a 0a20  unctionality... 
+0001a4a0: 2020 2020 2020 204e 6f74 653a 0a20 2020         Note:.   
+0001a4b0: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
+0001a4c0: 7320 6d65 7468 6f64 2069 7320 6375 7272  s method is curr
+0001a4d0: 656e 746c 7920 696e 2074 6563 686e 6963  ently in technic
+0001a4e0: 616c 2070 7265 7669 6577 2c20 616e 6420  al preview, and 
+0001a4f0: 7265 7175 6972 6573 2061 2048 6173 6869  requires a Hashi
+0001a500: 436f 7270 2056 6175 6c74 2069 6e66 7261  Corp Vault infra
+0001a510: 7374 7275 6374 7572 650a 2020 2020 2020  structure.      
+0001a520: 2020 2020 2020 2020 2020 7072 6f70 6572            proper
+0001a530: 6c79 2073 6574 2075 7020 616e 6420 636f  ly set up and co
+0001a540: 6e6e 6563 7465 6420 746f 2074 6865 204d  nnected to the M
+0001a550: 4c52 756e 2041 5049 2073 6572 7665 722e  LRun API server.
+0001a560: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001a570: 2075 7365 723a 2054 6865 2075 7365 7220   user: The user 
+0001a580: 636f 6e74 6578 7420 666f 7220 7768 6963  context for whic
+0001a590: 6820 746f 2067 656e 6572 6174 6520 7468  h to generate th
+0001a5a0: 6520 696e 6672 6120 616e 6420 7374 6f72  e infra and stor
+0001a5b0: 6520 7365 6372 6574 732e 0a20 2020 2020  e secrets..     
+0001a5c0: 2020 203a 7061 7261 6d20 7072 6f76 6964     :param provid
+0001a5d0: 6572 3a20 5468 6520 6e61 6d65 206f 6620  er: The name of 
+0001a5e0: 7468 6520 7365 6372 6574 732d 7072 6f76  the secrets-prov
+0001a5f0: 6964 6572 2074 6f20 776f 726b 2077 6974  ider to work wit
+0001a600: 682e 2043 7572 7265 6e74 6c79 206f 6e6c  h. Currently onl
+0001a610: 7920 6060 7661 756c 7460 6020 6973 2073  y ``vault`` is s
+0001a620: 7570 706f 7274 6564 2e0a 2020 2020 2020  upported..      
+0001a630: 2020 3a70 6172 616d 2073 6563 7265 7473    :param secrets
+0001a640: 3a20 4120 7365 7420 6f66 2073 6563 7265  : A set of secre
+0001a650: 7420 7661 6c75 6573 2074 6f20 7374 6f72  t values to stor
+0001a660: 6520 7769 7468 696e 2074 6865 2056 6175  e within the Vau
+0001a670: 6c74 2e0a 2020 2020 2020 2020 2222 220a  lt..        """.
+0001a680: 2020 2020 2020 2020 7061 7468 203d 2022          path = "
+0001a690: 7573 6572 2d73 6563 7265 7473 220a 2020  user-secrets".  
+0001a6a0: 2020 2020 2020 7365 6372 6574 735f 6372        secrets_cr
+0001a6b0: 6561 7469 6f6e 5f72 6571 7565 7374 203d  eation_request =
+0001a6c0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+0001a6d0: 6865 6d61 732e 5573 6572 5365 6372 6574  hemas.UserSecret
+0001a6e0: 4372 6561 7469 6f6e 5265 7175 6573 7428  CreationRequest(
+0001a6f0: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
+0001a700: 723d 7573 6572 2c0a 2020 2020 2020 2020  r=user,.        
+0001a710: 2020 2020 7072 6f76 6964 6572 3d70 726f      provider=pro
+0001a720: 7669 6465 722c 0a20 2020 2020 2020 2020  vider,.         
+0001a730: 2020 2073 6563 7265 7473 3d73 6563 7265     secrets=secre
+0001a740: 7473 2c0a 2020 2020 2020 2020 290a 2020  ts,.        ).  
+0001a750: 2020 2020 2020 626f 6479 203d 2073 6563        body = sec
+0001a760: 7265 7473 5f63 7265 6174 696f 6e5f 7265  rets_creation_re
+0001a770: 7175 6573 742e 6469 6374 2829 0a20 2020  quest.dict().   
+0001a780: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+0001a790: 6765 203d 2066 2246 6169 6c65 6420 6372  ge = f"Failed cr
+0001a7a0: 6561 7469 6e67 2075 7365 7220 7365 6372  eating user secr
+0001a7b0: 6574 7320 2d20 7b75 7365 727d 220a 2020  ets - {user}".  
+0001a7c0: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+0001a7d0: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+0001a7e0: 2022 504f 5354 222c 0a20 2020 2020 2020   "POST",.       
+0001a7f0: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
+0001a800: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
+0001a810: 7361 6765 2c0a 2020 2020 2020 2020 2020  sage,.          
+0001a820: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
+0001a830: 736f 6e28 626f 6479 292c 0a20 2020 2020  son(body),.     
+0001a840: 2020 2029 0a0a 2020 2020 4073 7461 7469     )..    @stati
+0001a850: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+0001a860: 5f76 616c 6964 6174 655f 7665 7273 696f  _validate_versio
+0001a870: 6e5f 636f 6d70 6174 6962 696c 6974 7928  n_compatibility(
+0001a880: 7365 7276 6572 5f76 6572 7369 6f6e 2c20  server_version, 
+0001a890: 636c 6965 6e74 5f76 6572 7369 6f6e 2920  client_version) 
+0001a8a0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+0001a8b0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0001a8c0: 2020 7061 7273 6564 5f73 6572 7665 725f    parsed_server_
+0001a8d0: 7665 7273 696f 6e20 3d20 7365 6d76 6572  version = semver
+0001a8e0: 2e56 6572 7369 6f6e 496e 666f 2e70 6172  .VersionInfo.par
+0001a8f0: 7365 2873 6572 7665 725f 7665 7273 696f  se(server_versio
+0001a900: 6e29 0a20 2020 2020 2020 2020 2020 2070  n).            p
+0001a910: 6172 7365 645f 636c 6965 6e74 5f76 6572  arsed_client_ver
+0001a920: 7369 6f6e 203d 2073 656d 7665 722e 5665  sion = semver.Ve
+0001a930: 7273 696f 6e49 6e66 6f2e 7061 7273 6528  rsionInfo.parse(
+0001a940: 636c 6965 6e74 5f76 6572 7369 6f6e 290a  client_version).
+0001a950: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+0001a960: 616c 7565 4572 726f 723a 0a20 2020 2020  alueError:.     
+0001a970: 2020 2020 2020 2023 2054 6869 7320 7769         # This wi
+0001a980: 6c6c 206d 6f73 746c 7920 6861 7070 656e  ll mostly happen
+0001a990: 2069 6e20 6465 7620 7363 656e 6172 696f   in dev scenario
+0001a9a0: 7320 7768 656e 2074 6865 2076 6572 7369  s when the versi
+0001a9b0: 6f6e 2069 7320 756e 7374 6162 6c65 2061  on is unstable a
+0001a9c0: 6e64 2073 7563 6820 2d20 7468 6572 6566  nd such - theref
+0001a9d0: 6f72 6520 7765 2772 6520 6967 6e6f 7269  ore we're ignori
+0001a9e0: 6e67 0a20 2020 2020 2020 2020 2020 206c  ng.            l
+0001a9f0: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
+0001aa00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001aa10: 556e 6162 6c65 2074 6f20 7061 7273 6520  Unable to parse 
+0001aa20: 7365 7276 6572 206f 7220 636c 6965 6e74  server or client
+0001aa30: 2076 6572 7369 6f6e 2e20 4173 7375 6d69   version. Assumi
+0001aa40: 6e67 2063 6f6d 7061 7469 626c 6522 2c0a  ng compatible",.
+0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa60: 7365 7276 6572 5f76 6572 7369 6f6e 3d73  server_version=s
+0001aa70: 6572 7665 725f 7665 7273 696f 6e2c 0a20  erver_version,. 
+0001aa80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001aa90: 6c69 656e 745f 7665 7273 696f 6e3d 636c  lient_version=cl
+0001aaa0: 6965 6e74 5f76 6572 7369 6f6e 2c0a 2020  ient_version,.  
+0001aab0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001aac0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001aad0: 7275 650a 2020 2020 2020 2020 6966 2028  rue.        if (
+0001aae0: 7061 7273 6564 5f73 6572 7665 725f 7665  parsed_server_ve
+0001aaf0: 7273 696f 6e2e 6d61 6a6f 7220 3d3d 2030  rsion.major == 0
+0001ab00: 2061 6e64 2070 6172 7365 645f 7365 7276   and parsed_serv
+0001ab10: 6572 5f76 6572 7369 6f6e 2e6d 696e 6f72  er_version.minor
+0001ab20: 203d 3d20 3029 206f 7220 280a 2020 2020   == 0) or (.    
+0001ab30: 2020 2020 2020 2020 7061 7273 6564 5f63          parsed_c
+0001ab40: 6c69 656e 745f 7665 7273 696f 6e2e 6d61  lient_version.ma
+0001ab50: 6a6f 7220 3d3d 2030 2061 6e64 2070 6172  jor == 0 and par
+0001ab60: 7365 645f 636c 6965 6e74 5f76 6572 7369  sed_client_versi
+0001ab70: 6f6e 2e6d 696e 6f72 203d 3d20 300a 2020  on.minor == 0.  
+0001ab80: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0001ab90: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
+0001aba0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+0001abb0: 2020 2020 2022 5365 7276 6572 206f 7220       "Server or 
+0001abc0: 636c 6965 6e74 2076 6572 7369 6f6e 2069  client version i
+0001abd0: 7320 756e 7374 6162 6c65 2e20 4173 7375  s unstable. Assu
+0001abe0: 6d69 6e67 2063 6f6d 7061 7469 626c 6522  ming compatible"
+0001abf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001ac00: 2020 7365 7276 6572 5f76 6572 7369 6f6e    server_version
+0001ac10: 3d73 6572 7665 725f 7665 7273 696f 6e2c  =server_version,
+0001ac20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ac30: 2063 6c69 656e 745f 7665 7273 696f 6e3d   client_version=
+0001ac40: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
+0001ac50: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001ac60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ac70: 2054 7275 650a 2020 2020 2020 2020 6966   True.        if
+0001ac80: 2070 6172 7365 645f 7365 7276 6572 5f76   parsed_server_v
+0001ac90: 6572 7369 6f6e 2e6d 616a 6f72 2021 3d20  ersion.major != 
+0001aca0: 7061 7273 6564 5f63 6c69 656e 745f 7665  parsed_client_ve
+0001acb0: 7273 696f 6e2e 6d61 6a6f 723a 0a20 2020  rsion.major:.   
+0001acc0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+0001acd0: 7761 726e 696e 6728 0a20 2020 2020 2020  warning(.       
+0001ace0: 2020 2020 2020 2020 2022 5365 7276 6572           "Server
+0001acf0: 2061 6e64 2063 6c69 656e 7420 7665 7273   and client vers
+0001ad00: 696f 6e73 2061 7265 2069 6e63 6f6d 7061  ions are incompa
+0001ad10: 7469 626c 6522 2c0a 2020 2020 2020 2020  tible",.        
+0001ad20: 2020 2020 2020 2020 7061 7273 6564 5f73          parsed_s
+0001ad30: 6572 7665 725f 7665 7273 696f 6e3d 7061  erver_version=pa
+0001ad40: 7273 6564 5f73 6572 7665 725f 7665 7273  rsed_server_vers
+0001ad50: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0001ad60: 2020 2020 2070 6172 7365 645f 636c 6965       parsed_clie
+0001ad70: 6e74 5f76 6572 7369 6f6e 3d70 6172 7365  nt_version=parse
+0001ad80: 645f 636c 6965 6e74 5f76 6572 7369 6f6e  d_client_version
+0001ad90: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001ada0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001adb0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0001adc0: 2069 6620 7061 7273 6564 5f73 6572 7665   if parsed_serve
+0001add0: 725f 7665 7273 696f 6e2e 6d69 6e6f 7220  r_version.minor 
+0001ade0: 3e20 7061 7273 6564 5f63 6c69 656e 745f  > parsed_client_
+0001adf0: 7665 7273 696f 6e2e 6d69 6e6f 7220 2b20  version.minor + 
+0001ae00: 323a 0a20 2020 2020 2020 2020 2020 206c  2:.            l
+0001ae10: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+0001ae20: 2020 2020 2020 2020 2020 2020 2242 6163              "Bac
+0001ae30: 6b77 6172 6473 2063 6f6d 7061 7469 6269  kwards compatibi
+0001ae40: 6c69 7479 206d 6967 6874 206e 6f74 2061  lity might not a
+0001ae50: 7070 6c79 2062 6574 7765 656e 2074 6865  pply between the
+0001ae60: 2073 6572 7665 7220 616e 6420 636c 6965   server and clie
+0001ae70: 6e74 2076 6572 7369 6f6e 222c 0a20 2020  nt version",.   
+0001ae80: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0001ae90: 7365 645f 7365 7276 6572 5f76 6572 7369  sed_server_versi
+0001aea0: 6f6e 3d70 6172 7365 645f 7365 7276 6572  on=parsed_server
+0001aeb0: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
+0001aec0: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
+0001aed0: 5f63 6c69 656e 745f 7665 7273 696f 6e3d  _client_version=
+0001aee0: 7061 7273 6564 5f63 6c69 656e 745f 7665  parsed_client_ve
+0001aef0: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
+0001af00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001af10: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001af20: 2020 2020 2020 6966 2070 6172 7365 645f        if parsed_
+0001af30: 636c 6965 6e74 5f76 6572 7369 6f6e 2e6d  client_version.m
+0001af40: 696e 6f72 203e 2070 6172 7365 645f 7365  inor > parsed_se
+0001af50: 7276 6572 5f76 6572 7369 6f6e 2e6d 696e  rver_version.min
+0001af60: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0001af70: 6c6f 6767 6572 2e77 6172 6e69 6e67 280a  logger.warning(.
+0001af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af90: 2243 6c69 656e 7420 7665 7273 696f 6e20  "Client version 
+0001afa0: 7769 7468 2068 6967 6865 7220 7665 7273  with higher vers
+0001afb0: 696f 6e20 7468 616e 2073 6572 7665 7220  ion than server 
+0001afc0: 7665 7273 696f 6e20 6973 6e27 7420 7375  version isn't su
+0001afd0: 7070 6f72 7465 642c 220a 2020 2020 2020  pported,".      
+0001afe0: 2020 2020 2020 2020 2020 2220 616c 6967            " alig
+0001aff0: 6e20 796f 7572 2063 6c69 656e 7420 746f  n your client to
+0001b000: 2074 6865 2073 6572 7665 7220 7665 7273   the server vers
+0001b010: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0001b020: 2020 2020 2020 7061 7273 6564 5f73 6572        parsed_ser
+0001b030: 7665 725f 7665 7273 696f 6e3d 7061 7273  ver_version=pars
+0001b040: 6564 5f73 6572 7665 725f 7665 7273 696f  ed_server_versio
+0001b050: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0001b060: 2020 2070 6172 7365 645f 636c 6965 6e74     parsed_client
+0001b070: 5f76 6572 7369 6f6e 3d70 6172 7365 645f  _version=parsed_
+0001b080: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
+0001b090: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001b0a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b0b0: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
+0001b0c0: 6620 7061 7273 6564 5f73 6572 7665 725f  f parsed_server_
+0001b0d0: 7665 7273 696f 6e2e 6d69 6e6f 7220 213d  version.minor !=
+0001b0e0: 2070 6172 7365 645f 636c 6965 6e74 5f76   parsed_client_v
+0001b0f0: 6572 7369 6f6e 2e6d 696e 6f72 3a0a 2020  ersion.minor:.  
+0001b100: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0001b110: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+0001b120: 2020 2020 2020 2022 5365 7276 6572 2061         "Server a
+0001b130: 6e64 2063 6c69 656e 7420 7665 7273 696f  nd client versio
+0001b140: 6e73 2061 7265 206e 6f74 2074 6865 2073  ns are not the s
+0001b150: 616d 6520 6275 7420 636f 6d70 6174 6962  ame but compatib
+0001b160: 6c65 222c 0a20 2020 2020 2020 2020 2020  le",.           
+0001b170: 2020 2020 2070 6172 7365 645f 7365 7276       parsed_serv
+0001b180: 6572 5f76 6572 7369 6f6e 3d70 6172 7365  er_version=parse
+0001b190: 645f 7365 7276 6572 5f76 6572 7369 6f6e  d_server_version
+0001b1a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b1b0: 2020 7061 7273 6564 5f63 6c69 656e 745f    parsed_client_
+0001b1c0: 7665 7273 696f 6e3d 7061 7273 6564 5f63  version=parsed_c
+0001b1d0: 6c69 656e 745f 7665 7273 696f 6e2c 0a20  lient_version,. 
+0001b1e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001b1f0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+0001b200: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0001b210: 5f6d 6f64 656c 5f65 6e64 706f 696e 7428  _model_endpoint(
+0001b220: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0001b230: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+0001b240: 7374 722c 0a20 2020 2020 2020 2065 6e64  str,.        end
+0001b250: 706f 696e 745f 6964 3a20 7374 722c 0a20  point_id: str,. 
+0001b260: 2020 2020 2020 206d 6f64 656c 5f65 6e64         model_end
+0001b270: 706f 696e 743a 2055 6e69 6f6e 5b0a 2020  point: Union[.  
+0001b280: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
+0001b290: 6d6f 6465 6c5f 6d6f 6e69 746f 7269 6e67  model_monitoring
+0001b2a0: 2e6d 6f64 656c 5f65 6e64 706f 696e 742e  .model_endpoint.
+0001b2b0: 4d6f 6465 6c45 6e64 706f 696e 742c 2064  ModelEndpoint, d
+0001b2c0: 6963 740a 2020 2020 2020 2020 5d2c 0a20  ict.        ],. 
+0001b2d0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0001b2e0: 220a 2020 2020 2020 2020 4372 6561 7465  ".        Create
+0001b2f0: 7320 6120 4442 2072 6563 6f72 6420 7769  s a DB record wi
+0001b300: 7468 2074 6865 2067 6976 656e 206d 6f64  th the given mod
+0001b310: 656c 5f65 6e64 706f 696e 7420 7265 636f  el_endpoint reco
+0001b320: 7264 2e0a 0a20 2020 2020 2020 203a 7061  rd...        :pa
+0001b330: 7261 6d20 7072 6f6a 6563 743a 2054 6865  ram project: The
+0001b340: 206e 616d 6520 6f66 2074 6865 2070 726f   name of the pro
+0001b350: 6a65 6374 2e0a 2020 2020 2020 2020 3a70  ject..        :p
+0001b360: 6172 616d 2065 6e64 706f 696e 745f 6964  aram endpoint_id
+0001b370: 3a20 5468 6520 6964 206f 6620 7468 6520  : The id of the 
+0001b380: 656e 6470 6f69 6e74 2e0a 2020 2020 2020  endpoint..      
+0001b390: 2020 3a70 6172 616d 206d 6f64 656c 5f65    :param model_e
+0001b3a0: 6e64 706f 696e 743a 2041 6e20 6f62 6a65  ndpoint: An obje
+0001b3b0: 6374 2072 6570 7265 7365 6e74 696e 6720  ct representing 
+0001b3c0: 7468 6520 6d6f 6465 6c20 656e 6470 6f69  the model endpoi
+0001b3d0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
+0001b3e0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0001b3f0: 7374 616e 6365 280a 2020 2020 2020 2020  stance(.        
+0001b400: 2020 2020 6d6f 6465 6c5f 656e 6470 6f69      model_endpoi
+0001b410: 6e74 2c20 6d6c 7275 6e2e 6d6f 6465 6c5f  nt, mlrun.model_
+0001b420: 6d6f 6e69 746f 7269 6e67 2e6d 6f64 656c  monitoring.model
+0001b430: 5f65 6e64 706f 696e 742e 4d6f 6465 6c45  _endpoint.ModelE
+0001b440: 6e64 706f 696e 740a 2020 2020 2020 2020  ndpoint.        
+0001b450: 293a 0a20 2020 2020 2020 2020 2020 206d  ):.            m
+0001b460: 6f64 656c 5f65 6e64 706f 696e 7420 3d20  odel_endpoint = 
+0001b470: 6d6f 6465 6c5f 656e 6470 6f69 6e74 2e74  model_endpoint.t
+0001b480: 6f5f 6469 6374 2829 0a0a 2020 2020 2020  o_dict()..      
+0001b490: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+0001b4a0: 6374 732f 7b70 726f 6a65 6374 7d2f 6d6f  cts/{project}/mo
+0001b4b0: 6465 6c2d 656e 6470 6f69 6e74 732f 7b65  del-endpoints/{e
+0001b4c0: 6e64 706f 696e 745f 6964 7d22 0a20 2020  ndpoint_id}".   
+0001b4d0: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
+0001b4e0: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
+0001b4f0: 6d65 7468 6f64 3d22 504f 5354 222c 0a20  method="POST",. 
+0001b500: 2020 2020 2020 2020 2020 2070 6174 683d             path=
+0001b510: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+0001b520: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
+0001b530: 736f 6e28 6d6f 6465 6c5f 656e 6470 6f69  son(model_endpoi
+0001b540: 6e74 292c 0a20 2020 2020 2020 2029 0a0a  nt),.        )..
+0001b550: 2020 2020 6465 6620 6465 6c65 7465 5f6d      def delete_m
+0001b560: 6f64 656c 5f65 6e64 706f 696e 7428 0a20  odel_endpoint(. 
+0001b570: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0001b580: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
+0001b590: 722c 0a20 2020 2020 2020 2065 6e64 706f  r,.        endpo
+0001b5a0: 696e 745f 6964 3a20 7374 722c 0a20 2020  int_id: str,.   
+0001b5b0: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
+0001b5c0: 2020 2020 2020 2020 4465 6c65 7465 7320          Deletes 
+0001b5d0: 7468 6520 4442 2072 6563 6f72 6420 6f66  the DB record of
+0001b5e0: 2061 2067 6976 656e 206d 6f64 656c 2065   a given model e
+0001b5f0: 6e64 706f 696e 742c 2070 726f 6a65 6374  ndpoint, project
+0001b600: 2061 6e64 2065 6e64 706f 696e 745f 6964   and endpoint_id
+0001b610: 2061 7265 2075 7365 6420 666f 7220 6c6f   are used for lo
+0001b620: 6f6b 7570 0a0a 2020 2020 2020 2020 3a70  okup..        :p
+0001b630: 6172 616d 2070 726f 6a65 6374 3a20 5468  aram project: Th
+0001b640: 6520 6e61 6d65 206f 6620 7468 6520 7072  e name of the pr
+0001b650: 6f6a 6563 740a 2020 2020 2020 2020 3a70  oject.        :p
+0001b660: 6172 616d 2065 6e64 706f 696e 745f 6964  aram endpoint_id
+0001b670: 3a20 5468 6520 6964 206f 6620 7468 6520  : The id of the 
+0001b680: 656e 6470 6f69 6e74 0a20 2020 2020 2020  endpoint.       
+0001b690: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
+0001b6a0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0001b6b0: 7b70 726f 6a65 6374 7d2f 6d6f 6465 6c2d  {project}/model-
+0001b6c0: 656e 6470 6f69 6e74 732f 7b65 6e64 706f  endpoints/{endpo
+0001b6d0: 696e 745f 6964 7d22 0a20 2020 2020 2020  int_id}".       
+0001b6e0: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+0001b6f0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0001b700: 6f64 3d22 4445 4c45 5445 222c 0a20 2020  od="DELETE",.   
+0001b710: 2020 2020 2020 2020 2070 6174 683d 7061           path=pa
+0001b720: 7468 2c0a 2020 2020 2020 2020 290a 0a20  th,.        ).. 
+0001b730: 2020 2064 6566 206c 6973 745f 6d6f 6465     def list_mode
+0001b740: 6c5f 656e 6470 6f69 6e74 7328 0a20 2020  l_endpoints(.   
+0001b750: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0001b760: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
+0001b770: 0a20 2020 2020 2020 206d 6f64 656c 3a20  .        model: 
+0001b780: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+0001b790: 4e6f 6e65 2c0a 2020 2020 2020 2020 6675  None,.        fu
+0001b7a0: 6e63 7469 6f6e 3a20 4f70 7469 6f6e 616c  nction: Optional
+0001b7b0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0001b7c0: 2020 2020 2020 6c61 6265 6c73 3a20 4c69        labels: Li
+0001b7d0: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  st[str] = None,.
+0001b7e0: 2020 2020 2020 2020 7374 6172 743a 2073          start: s
+0001b7f0: 7472 203d 2022 6e6f 772d 3168 222c 0a20  tr = "now-1h",. 
+0001b800: 2020 2020 2020 2065 6e64 3a20 7374 7220         end: str 
+0001b810: 3d20 226e 6f77 222c 0a20 2020 2020 2020  = "now",.       
+0001b820: 206d 6574 7269 6373 3a20 4f70 7469 6f6e   metrics: Option
+0001b830: 616c 5b4c 6973 745b 7374 725d 5d20 3d20  al[List[str]] = 
+0001b840: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
+0001b850: 705f 6c65 7665 6c3a 2062 6f6f 6c20 3d20  p_level: bool = 
+0001b860: 4661 6c73 652c 0a20 2020 2020 2020 2075  False,.        u
+0001b870: 6964 733a 204f 7074 696f 6e61 6c5b 4c69  ids: Optional[Li
+0001b880: 7374 5b73 7472 5d5d 203d 204e 6f6e 652c  st[str]] = None,
+0001b890: 0a20 2020 2029 202d 3e20 4c69 7374 5b6d  .    ) -> List[m
+0001b8a0: 6c72 756e 2e6d 6f64 656c 5f6d 6f6e 6974  lrun.model_monit
+0001b8b0: 6f72 696e 672e 6d6f 6465 6c5f 656e 6470  oring.model_endp
+0001b8c0: 6f69 6e74 2e4d 6f64 656c 456e 6470 6f69  oint.ModelEndpoi
+0001b8d0: 6e74 5d3a 0a20 2020 2020 2020 2022 2222  nt]:.        """
+0001b8e0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0001b8f0: 2061 206c 6973 7420 6f66 2060 4d6f 6465   a list of `Mode
+0001b900: 6c45 6e64 706f 696e 7460 206f 626a 6563  lEndpoint` objec
+0001b910: 7473 2e20 4561 6368 2060 4d6f 6465 6c45  ts. Each `ModelE
+0001b920: 6e64 706f 696e 7460 206f 626a 6563 7420  ndpoint` object 
+0001b930: 7265 7072 6573 656e 7473 2074 6865 2063  represents the c
+0001b940: 7572 7265 6e74 2073 7461 7465 206f 6620  urrent state of 
+0001b950: 610a 2020 2020 2020 2020 6d6f 6465 6c20  a.        model 
+0001b960: 656e 6470 6f69 6e74 2e20 5468 6973 2066  endpoint. This f
+0001b970: 756e 6374 696f 6e73 2073 7570 706f 7274  unctions support
+0001b980: 7320 6669 6c74 6572 696e 6720 6279 2074  s filtering by t
+0001b990: 6865 2066 6f6c 6c6f 7769 6e67 2070 6172  he following par
+0001b9a0: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
+0001b9b0: 2031 2920 6d6f 6465 6c0a 2020 2020 2020   1) model.      
+0001b9c0: 2020 3229 2066 756e 6374 696f 6e0a 2020    2) function.  
+0001b9d0: 2020 2020 2020 3329 206c 6162 656c 730a        3) labels.
+0001b9e0: 2020 2020 2020 2020 3429 2074 6f70 206c          4) top l
+0001b9f0: 6576 656c 0a20 2020 2020 2020 2035 2920  evel.        5) 
+0001ba00: 7569 6473 0a20 2020 2020 2020 2042 7920  uids.        By 
+0001ba10: 6465 6661 756c 742c 2077 6865 6e20 6e6f  default, when no
+0001ba20: 2066 696c 7465 7273 2061 7265 2061 7070   filters are app
+0001ba30: 6c69 6564 2c20 616c 6c20 6176 6169 6c61  lied, all availa
+0001ba40: 626c 6520 656e 6470 6f69 6e74 7320 666f  ble endpoints fo
+0001ba50: 7220 7468 6520 6769 7665 6e20 7072 6f6a  r the given proj
+0001ba60: 6563 7420 7769 6c6c 2062 6520 6c69 7374  ect will be list
+0001ba70: 6564 2e0a 0a20 2020 2020 2020 2049 6e20  ed...        In 
+0001ba80: 6164 6469 7469 6f6e 2c20 7468 6973 2066  addition, this f
+0001ba90: 756e 6374 696f 6e73 2070 726f 7669 6465  unctions provide
+0001baa0: 7320 6120 6661 6361 6465 2066 6f72 206c  s a facade for l
+0001bab0: 6973 7469 6e67 2065 6e64 706f 696e 7420  isting endpoint 
+0001bac0: 7265 6c61 7465 6420 6d65 7472 6963 732e  related metrics.
+0001bad0: 2054 6869 7320 6661 6361 6465 2069 7320   This facade is 
+0001bae0: 7469 6d65 2d62 6173 6564 0a20 2020 2020  time-based.     
+0001baf0: 2020 2061 6e64 2064 6570 656e 6473 206f     and depends o
+0001bb00: 6e20 7468 6520 2773 7461 7274 2720 616e  n the 'start' an
+0001bb10: 6420 2765 6e64 2720 7061 7261 6d65 7465  d 'end' paramete
+0001bb20: 7273 2e20 4279 2064 6566 6175 6c74 2c20  rs. By default, 
+0001bb30: 7768 656e 2074 6865 206d 6574 7269 6373  when the metrics
+0001bb40: 2070 6172 616d 6574 6572 2069 7320 4e6f   parameter is No
+0001bb50: 6e65 2c20 6e6f 206d 6574 7269 6373 2061  ne, no metrics a
+0001bb60: 7265 0a20 2020 2020 2020 2061 6464 6564  re.        added
+0001bb70: 2074 6f20 7468 6520 6f75 7470 7574 206f   to the output o
+0001bb80: 6620 7468 6973 2066 756e 6374 696f 6e2e  f this function.
+0001bb90: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001bba0: 2070 726f 6a65 6374 3a20 5468 6520 6e61   project: The na
+0001bbb0: 6d65 206f 6620 7468 6520 7072 6f6a 6563  me of the projec
+0001bbc0: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+0001bbd0: 206d 6f64 656c 3a20 5468 6520 6e61 6d65   model: The name
+0001bbe0: 206f 6620 7468 6520 6d6f 6465 6c20 746f   of the model to
+0001bbf0: 2066 696c 7465 7220 6279 0a20 2020 2020   filter by.     
+0001bc00: 2020 203a 7061 7261 6d20 6675 6e63 7469     :param functi
+0001bc10: 6f6e 3a20 5468 6520 6e61 6d65 206f 6620  on: The name of 
+0001bc20: 7468 6520 6675 6e63 7469 6f6e 2074 6f20  the function to 
+0001bc30: 6669 6c74 6572 2062 790a 2020 2020 2020  filter by.      
+0001bc40: 2020 3a70 6172 616d 206c 6162 656c 733a    :param labels:
+0001bc50: 2041 206c 6973 7420 6f66 206c 6162 656c   A list of label
+0001bc60: 7320 746f 2066 696c 7465 7220 6279 2e20  s to filter by. 
+0001bc70: 4c61 6265 6c20 6669 6c74 6572 7320 776f  Label filters wo
+0001bc80: 726b 2062 7920 6569 7468 6572 2066 696c  rk by either fil
+0001bc90: 7465 7269 6e67 2061 2073 7065 6369 6669  tering a specifi
+0001bca0: 6320 7661 6c75 6520 6f66 2061 0a20 2020  c value of a.   
+0001bcb0: 2020 2020 2020 6c61 6265 6c20 2869 2e65        label (i.e
+0001bcc0: 2e20 6c69 7374 2822 6b65 793d 7661 6c75  . list("key=valu
+0001bcd0: 6522 2929 206f 7220 6279 206c 6f6f 6b69  e")) or by looki
+0001bce0: 6e67 2066 6f72 2074 6865 2065 7869 7374  ng for the exist
+0001bcf0: 656e 6365 206f 6620 6120 6769 7665 6e20  ence of a given 
+0001bd00: 6b65 7920 2869 2e65 2e20 226b 6579 2229  key (i.e. "key")
+0001bd10: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001bd20: 6d65 7472 6963 733a 2041 206c 6973 7420  metrics: A list 
+0001bd30: 6f66 206d 6574 7269 6373 2074 6f20 7265  of metrics to re
+0001bd40: 7475 726e 2066 6f72 2065 6163 6820 656e  turn for each en
+0001bd50: 6470 6f69 6e74 2c20 7265 6164 206d 6f72  dpoint, read mor
+0001bd60: 6520 696e 2027 5469 6d65 4d65 7472 6963  e in 'TimeMetric
+0001bd70: 270a 2020 2020 2020 2020 3a70 6172 616d  '.        :param
+0001bd80: 2073 7461 7274 3a20 5468 6520 7374 6172   start: The star
+0001bd90: 7420 7469 6d65 206f 6620 7468 6520 6d65  t time of the me
+0001bda0: 7472 6963 732e 2043 616e 2062 6520 7265  trics. Can be re
+0001bdb0: 7072 6573 656e 7465 6420 6279 2061 2073  presented by a s
+0001bdc0: 7472 696e 6720 636f 6e74 6169 6e69 6e67  tring containing
+0001bdd0: 2061 6e20 5246 4320 3333 3339 0a20 2020   an RFC 3339.   
+0001bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bdf0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0001be00: 6d65 2c20 6120 556e 6978 2074 696d 6573  me, a Unix times
+0001be10: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
+0001be20: 6f6e 6473 2c20 6120 7265 6c61 7469 7665  onds, a relative
+0001be30: 2074 696d 6520 2860 276e 6f77 2760 206f   time (`'now'` o
+0001be40: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0001be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be60: 2020 2060 276e 6f77 2d5b 302d 395d 2b5b     `'now-[0-9]+[
+0001be70: 6d68 645d 2760 2c20 7768 6572 6520 606d  mhd]'`, where `m
+0001be80: 6020 3d20 6d69 6e75 7465 732c 2060 6860  ` = minutes, `h`
+0001be90: 203d 2068 6f75 7273 2c20 616e 6420 6027   = hours, and `'
+0001bea0: 6427 6020 3d0a 2020 2020 2020 2020 2020  d'` =.          
+0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bec0: 2020 2020 2020 2064 6179 7329 2c20 6f72         days), or
+0001bed0: 2030 2066 6f72 2074 6865 2065 6172 6c69   0 for the earli
+0001bee0: 6573 7420 7469 6d65 2e0a 2020 2020 2020  est time..      
+0001bef0: 2020 3a70 6172 616d 2065 6e64 3a20 5468    :param end: Th
+0001bf00: 6520 656e 6420 7469 6d65 206f 6620 7468  e end time of th
+0001bf10: 6520 6d65 7472 6963 732e 2043 616e 2062  e metrics. Can b
+0001bf20: 6520 7265 7072 6573 656e 7465 6420 6279  e represented by
+0001bf30: 2061 2073 7472 696e 6720 636f 6e74 6169   a string contai
+0001bf40: 6e69 6e67 2061 6e20 5246 4320 3333 3339  ning an RFC 3339
+0001bf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf70: 2020 7469 6d65 2c20 6120 556e 6978 2074    time, a Unix t
+0001bf80: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
+0001bf90: 6973 6563 6f6e 6473 2c20 6120 7265 6c61  iseconds, a rela
+0001bfa0: 7469 7665 2074 696d 6520 2860 276e 6f77  tive time (`'now
+0001bfb0: 2760 206f 720a 2020 2020 2020 2020 2020  '` or.          
+0001bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfd0: 2020 2020 2020 2060 276e 6f77 2d5b 302d         `'now-[0-
+0001bfe0: 395d 2b5b 6d68 645d 2760 2c20 7768 6572  9]+[mhd]'`, wher
+0001bff0: 6520 606d 6020 3d20 6d69 6e75 7465 732c  e `m` = minutes,
+0001c000: 2060 6860 203d 2068 6f75 7273 2c20 616e   `h` = hours, an
+0001c010: 6420 6027 6427 6020 3d0a 2020 2020 2020  d `'d'` =.      
+0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c030: 2020 2020 2020 2020 2020 2064 6179 7329             days)
+0001c040: 2c20 6f72 2030 2066 6f72 2074 6865 2065  , or 0 for the e
+0001c050: 6172 6c69 6573 7420 7469 6d65 2e0a 2020  arliest time..  
+0001c060: 2020 2020 2020 3a70 6172 616d 2074 6f70        :param top
+0001c070: 5f6c 6576 656c 3a20 6966 2074 7275 6520  _level: if true 
+0001c080: 7769 6c6c 2072 6574 7572 6e20 6f6e 6c79  will return only
+0001c090: 2072 6f75 7465 7273 2061 6e64 2065 6e64   routers and end
+0001c0a0: 706f 696e 7420 7468 6174 2061 7265 204e  point that are N
+0001c0b0: 4f54 2063 6869 6c64 7265 6e20 6f66 2061  OT children of a
+0001c0c0: 6e79 2072 6f75 7465 720a 2020 2020 2020  ny router.      
+0001c0d0: 2020 3a70 6172 616d 2075 6964 733a 2069    :param uids: i
+0001c0e0: 6620 7061 7373 6564 2077 696c 6c20 7265  f passed will re
+0001c0f0: 7475 726e 2061 206c 6973 7420 604d 6f64  turn a list `Mod
+0001c100: 656c 456e 6470 6f69 6e74 6020 6f62 6a65  elEndpoint` obje
+0001c110: 6374 2077 6974 6820 7569 6420 696e 2075  ct with uid in u
+0001c120: 6964 730a 2020 2020 2020 2020 2222 220a  ids.        """.
+0001c130: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0001c140: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+0001c150: 6563 747d 2f6d 6f64 656c 2d65 6e64 706f  ect}/model-endpo
+0001c160: 696e 7473 220a 0a20 2020 2020 2020 2069  ints"..        i
+0001c170: 6620 6c61 6265 6c73 2061 6e64 2069 7369  f labels and isi
+0001c180: 6e73 7461 6e63 6528 6c61 6265 6c73 2c20  nstance(labels, 
+0001c190: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+0001c1a0: 2020 206c 6162 656c 7320 3d20 5b66 227b     labels = [f"{
+0001c1b0: 6b65 797d 3d7b 7661 6c75 657d 2220 666f  key}={value}" fo
+0001c1c0: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+0001c1d0: 6c61 6265 6c73 2e69 7465 6d73 2829 5d0a  labels.items()].
+0001c1e0: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
+0001c1f0: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
+0001c200: 6c28 0a20 2020 2020 2020 2020 2020 206d  l(.            m
+0001c210: 6574 686f 643d 2247 4554 222c 0a20 2020  ethod="GET",.   
+0001c220: 2020 2020 2020 2020 2070 6174 683d 7061           path=pa
+0001c230: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0001c240: 7061 7261 6d73 3d7b 0a20 2020 2020 2020  params={.       
+0001c250: 2020 2020 2020 2020 2022 6d6f 6465 6c22           "model"
+0001c260: 3a20 6d6f 6465 6c2c 0a20 2020 2020 2020  : model,.       
+0001c270: 2020 2020 2020 2020 2022 6675 6e63 7469           "functi
+0001c280: 6f6e 223a 2066 756e 6374 696f 6e2c 0a20  on": function,. 
+0001c290: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001c2a0: 6c61 6265 6c22 3a20 6c61 6265 6c73 206f  label": labels o
+0001c2b0: 7220 5b5d 2c0a 2020 2020 2020 2020 2020  r [],.          
+0001c2c0: 2020 2020 2020 2273 7461 7274 223a 2073        "start": s
+0001c2d0: 7461 7274 2c0a 2020 2020 2020 2020 2020  tart,.          
+0001c2e0: 2020 2020 2020 2265 6e64 223a 2065 6e64        "end": end
+0001c2f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c300: 2020 226d 6574 7269 6322 3a20 6d65 7472    "metric": metr
+0001c310: 6963 7320 6f72 205b 5d2c 0a20 2020 2020  ics or [],.     
+0001c320: 2020 2020 2020 2020 2020 2022 746f 702d             "top-
+0001c330: 6c65 7665 6c22 3a20 746f 705f 6c65 7665  level": top_leve
+0001c340: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+0001c350: 2020 2022 7569 6422 3a20 7569 6473 2c0a     "uid": uids,.
+0001c360: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
+0001c370: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001c380: 2020 2320 4765 6e65 7261 7465 2061 206c    # Generate a l
+0001c390: 6973 7420 6f66 2061 206d 6f64 656c 2065  ist of a model e
+0001c3a0: 6e64 706f 696e 7420 6469 6374 696f 6e61  ndpoint dictiona
+0001c3b0: 7269 6573 0a20 2020 2020 2020 206d 6f64  ries.        mod
+0001c3c0: 656c 5f65 6e64 706f 696e 7473 203d 2072  el_endpoints = r
+0001c3d0: 6573 706f 6e73 652e 6a73 6f6e 2829 5b22  esponse.json()["
+0001c3e0: 656e 6470 6f69 6e74 7322 5d0a 2020 2020  endpoints"].    
+0001c3f0: 2020 2020 6966 206d 6f64 656c 5f65 6e64      if model_end
+0001c400: 706f 696e 7473 3a0a 2020 2020 2020 2020  points:.        
+0001c410: 2020 2020 7265 7475 726e 205b 0a20 2020      return [.   
+0001c420: 2020 2020 2020 2020 2020 2020 206d 6c72               mlr
+0001c430: 756e 2e6d 6f64 656c 5f6d 6f6e 6974 6f72  un.model_monitor
+0001c440: 696e 672e 6d6f 6465 6c5f 656e 6470 6f69  ing.model_endpoi
+0001c450: 6e74 2e4d 6f64 656c 456e 6470 6f69 6e74  nt.ModelEndpoint
+0001c460: 2e66 726f 6d5f 6469 6374 286f 626a 290a  .from_dict(obj).
 0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c480: 2020 2020 2020 2020 2020 2020 6c61 7465              late
-0001c490: 6e63 795f 6176 675f 356d 2062 7574 2061  ncy_avg_5m but a
-0001c4a0: 6c73 6f20 6375 7374 6f6d 206d 6574 7269  lso custom metri
-0001c4b0: 6373 2064 6566 696e 6564 2062 7920 7468  cs defined by th
-0001c4c0: 6520 7573 6572 2e20 506c 6561 7365 206e  e user. Please n
-0001c4d0: 6f74 6520 7468 6174 0a20 2020 2020 2020  ote that.       
-0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c500: 2020 2020 7468 6573 6520 6d65 7472 6963      these metric
-0001c510: 7320 6172 6520 7374 6f72 6564 2069 6e20  s are stored in 
-0001c520: 7468 6520 7469 6d65 2073 6572 6965 7320  the time series 
-0001c530: 4442 2061 6e64 2074 6865 2072 6573 756c  DB and the resul
-0001c540: 7473 2077 696c 6c20 6265 0a20 2020 2020  ts will be.     
-0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c570: 2020 2020 2020 6170 7065 6172 6564 2075        appeared u
-0001c580: 6e64 6572 206d 6f64 656c 5f65 6e64 706f  nder model_endpo
-0001c590: 696e 742e 7370 6563 2e6d 6574 7269 6373  int.spec.metrics
-0001c5a0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001c5b0: 2066 6561 7475 7265 5f61 6e61 6c79 7369   feature_analysi
-0001c5c0: 733a 2020 2020 2020 2020 2020 2057 6865  s:           Whe
-0001c5d0: 6e20 5472 7565 2c20 7468 6520 6261 7365  n True, the base
-0001c5e0: 2066 6561 7475 7265 2073 7461 7469 7374   feature statist
-0001c5f0: 6963 7320 616e 6420 6375 7272 656e 7420  ics and current 
-0001c600: 6665 6174 7572 6520 7374 6174 6973 7469  feature statisti
-0001c610: 6373 2077 696c 6c0a 2020 2020 2020 2020  cs will.        
-0001c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c640: 2020 2062 6520 6164 6465 6420 746f 2074     be added to t
-0001c650: 6865 206f 7574 7075 7420 6f66 2074 6865  he output of the
-0001c660: 2072 6573 756c 7469 6e67 206f 626a 6563   resulting objec
-0001c670: 742e 0a0a 2020 2020 2020 2020 3a72 6574  t...        :ret
-0001c680: 7572 6e3a 2041 2060 4d6f 6465 6c45 6e64  urn: A `ModelEnd
-0001c690: 706f 696e 7460 206f 626a 6563 742e 0a20  point` object.. 
-0001c6a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0001c6b0: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-0001c6c0: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-0001c6d0: 6d6f 6465 6c2d 656e 6470 6f69 6e74 732f  model-endpoints/
-0001c6e0: 7b65 6e64 706f 696e 745f 6964 7d22 0a20  {endpoint_id}". 
-0001c6f0: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-0001c700: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0001c710: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-0001c720: 686f 643d 2247 4554 222c 0a20 2020 2020  hod="GET",.     
-0001c730: 2020 2020 2020 2070 6174 683d 7061 7468         path=path
-0001c740: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-0001c750: 7261 6d73 3d7b 0a20 2020 2020 2020 2020  rams={.         
-0001c760: 2020 2020 2020 2022 7374 6172 7422 3a20         "start": 
-0001c770: 7374 6172 742c 0a20 2020 2020 2020 2020  start,.         
-0001c780: 2020 2020 2020 2022 656e 6422 3a20 656e         "end": en
-0001c790: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0001c7a0: 2020 2022 6d65 7472 6963 223a 206d 6574     "metric": met
-0001c7b0: 7269 6373 206f 7220 5b5d 2c0a 2020 2020  rics or [],.    
-0001c7c0: 2020 2020 2020 2020 2020 2020 2266 6561              "fea
-0001c7d0: 7475 7265 5f61 6e61 6c79 7369 7322 3a20  ture_analysis": 
-0001c7e0: 6665 6174 7572 655f 616e 616c 7973 6973  feature_analysis
-0001c7f0: 2c0a 2020 2020 2020 2020 2020 2020 7d2c  ,.            },
-0001c800: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001c810: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
-0001c820: 2e6d 6f64 656c 5f6d 6f6e 6974 6f72 696e  .model_monitorin
-0001c830: 672e 6d6f 6465 6c5f 656e 6470 6f69 6e74  g.model_endpoint
-0001c840: 2e4d 6f64 656c 456e 6470 6f69 6e74 2e66  .ModelEndpoint.f
-0001c850: 726f 6d5f 6469 6374 280a 2020 2020 2020  rom_dict(.      
-0001c860: 2020 2020 2020 7265 7370 6f6e 7365 2e6a        response.j
-0001c870: 736f 6e28 290a 2020 2020 2020 2020 290a  son().        ).
-0001c880: 0a20 2020 2064 6566 2070 6174 6368 5f6d  .    def patch_m
-0001c890: 6f64 656c 5f65 6e64 706f 696e 7428 0a20  odel_endpoint(. 
-0001c8a0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0001c8b0: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
-0001c8c0: 722c 0a20 2020 2020 2020 2065 6e64 706f  r,.        endpo
-0001c8d0: 696e 745f 6964 3a20 7374 722c 0a20 2020  int_id: str,.   
-0001c8e0: 2020 2020 2061 7474 7269 6275 7465 733a       attributes:
-0001c8f0: 2064 6963 742c 0a20 2020 2029 3a0a 2020   dict,.    ):.  
-0001c900: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001c910: 2020 5570 6461 7465 7320 6d6f 6465 6c20    Updates model 
-0001c920: 656e 6470 6f69 6e74 2077 6974 6820 7072  endpoint with pr
-0001c930: 6f76 6964 6564 2061 7474 7269 6275 7465  ovided attribute
-0001c940: 732e 0a0a 2020 2020 2020 2020 3a70 6172  s...        :par
-0001c950: 616d 2070 726f 6a65 6374 3a20 5468 6520  am project: The 
-0001c960: 6e61 6d65 206f 6620 7468 6520 7072 6f6a  name of the proj
-0001c970: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
-0001c980: 7261 6d20 656e 6470 6f69 6e74 5f69 643a  ram endpoint_id:
-0001c990: 2054 6865 2069 6420 6f66 2074 6865 2065   The id of the e
-0001c9a0: 6e64 706f 696e 742e 0a20 2020 2020 2020  ndpoint..       
-0001c9b0: 203a 7061 7261 6d20 6174 7472 6962 7574   :param attribut
-0001c9c0: 6573 3a20 4469 6374 696f 6e61 7279 206f  es: Dictionary o
-0001c9d0: 6620 6174 7472 6962 7574 6573 2074 6861  f attributes tha
-0001c9e0: 7420 7769 6c6c 2062 6520 7573 6564 2066  t will be used f
-0001c9f0: 6f72 2075 7064 6174 6520 7468 6520 6d6f  or update the mo
-0001ca00: 6465 6c20 656e 6470 6f69 6e74 2e20 5468  del endpoint. Th
-0001ca10: 6520 6b65 7973 0a20 2020 2020 2020 2020  e keys.         
-0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca30: 2020 6f66 2074 6869 7320 6469 6374 696f    of this dictio
-0001ca40: 6e61 7279 2073 686f 756c 6420 6578 6973  nary should exis
-0001ca50: 7420 696e 2074 6865 2074 6172 6765 7420  t in the target 
-0001ca60: 7461 626c 652e 204e 6f74 6520 7468 6174  table. Note that
-0001ca70: 2074 6865 2076 616c 7565 7320 7368 6f75   the values shou
-0001ca80: 6c64 2062 650a 2020 2020 2020 2020 2020  ld be.          
-0001ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001caa0: 2066 726f 6d20 7479 7065 2073 7472 696e   from type strin
-0001cab0: 6720 6f72 2066 726f 6d20 6120 7661 6c69  g or from a vali
-0001cac0: 6420 6e75 6d65 7269 6361 6c20 7479 7065  d numerical type
-0001cad0: 2073 7563 6820 6173 2069 6e74 206f 7220   such as int or 
-0001cae0: 666c 6f61 742e 0a20 2020 2020 2020 2020  float..         
-0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb00: 2020 204d 6f72 6520 6465 7461 696c 7320     More details 
-0001cb10: 6162 6f75 7420 7468 6520 6d6f 6465 6c20  about the model 
-0001cb20: 656e 6470 6f69 6e74 2061 7661 696c 6162  endpoint availab
-0001cb30: 6c65 2061 7474 7269 6275 7465 7320 6361  le attributes ca
-0001cb40: 6e20 6265 2066 6f75 6e64 2075 6e64 6572  n be found under
-0001cb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cb60: 2020 2020 2020 2020 2020 2020 3a70 793a              :py:
-0001cb70: 636c 6173 733a 607e 6d6c 7275 6e2e 6170  class:`~mlrun.ap
-0001cb80: 692e 7363 6865 6d61 732e 4d6f 6465 6c45  i.schemas.ModelE
-0001cb90: 6e64 706f 696e 7460 2e0a 0a20 2020 2020  ndpoint`...     
+0001c480: 666f 7220 6f62 6a20 696e 206d 6f64 656c  for obj in model
+0001c490: 5f65 6e64 706f 696e 7473 0a20 2020 2020  _endpoints.     
+0001c4a0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0001c4b0: 2072 6574 7572 6e20 5b5d 0a0a 2020 2020   return []..    
+0001c4c0: 6465 6620 6765 745f 6d6f 6465 6c5f 656e  def get_model_en
+0001c4d0: 6470 6f69 6e74 280a 2020 2020 2020 2020  dpoint(.        
+0001c4e0: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+0001c4f0: 6f6a 6563 743a 2073 7472 2c0a 2020 2020  oject: str,.    
+0001c500: 2020 2020 656e 6470 6f69 6e74 5f69 643a      endpoint_id:
+0001c510: 2073 7472 2c0a 2020 2020 2020 2020 7374   str,.        st
+0001c520: 6172 743a 204f 7074 696f 6e61 6c5b 7374  art: Optional[st
+0001c530: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+0001c540: 2020 2065 6e64 3a20 4f70 7469 6f6e 616c     end: Optional
+0001c550: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0001c560: 2020 2020 2020 6d65 7472 6963 733a 204f        metrics: O
+0001c570: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+0001c580: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+0001c590: 2020 2066 6561 7475 7265 5f61 6e61 6c79     feature_analy
+0001c5a0: 7369 733a 2062 6f6f 6c20 3d20 4661 6c73  sis: bool = Fals
+0001c5b0: 652c 0a20 2020 2029 202d 3e20 6d6c 7275  e,.    ) -> mlru
+0001c5c0: 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f 7269  n.model_monitori
+0001c5d0: 6e67 2e6d 6f64 656c 5f65 6e64 706f 696e  ng.model_endpoin
+0001c5e0: 742e 4d6f 6465 6c45 6e64 706f 696e 743a  t.ModelEndpoint:
+0001c5f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001c600: 2020 2020 2052 6574 7572 6e73 2061 2073       Returns a s
+0001c610: 696e 676c 6520 604d 6f64 656c 456e 6470  ingle `ModelEndp
+0001c620: 6f69 6e74 6020 6f62 6a65 6374 2077 6974  oint` object wit
+0001c630: 6820 6164 6469 7469 6f6e 616c 206d 6574  h additional met
+0001c640: 7269 6373 2061 6e64 2066 6561 7475 7265  rics and feature
+0001c650: 2072 656c 6174 6564 2064 6174 612e 0a0a   related data...
+0001c660: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+0001c670: 726f 6a65 6374 3a20 2020 2020 2020 2020  roject:         
+0001c680: 2020 2020 2020 2020 2020 2054 6865 206e             The n
+0001c690: 616d 6520 6f66 2074 6865 2070 726f 6a65  ame of the proje
+0001c6a0: 6374 0a20 2020 2020 2020 203a 7061 7261  ct.        :para
+0001c6b0: 6d20 656e 6470 6f69 6e74 5f69 643a 2020  m endpoint_id:  
+0001c6c0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+0001c6d0: 6520 756e 6971 7565 2069 6420 6f66 2074  e unique id of t
+0001c6e0: 6865 206d 6f64 656c 2065 6e64 706f 696e  he model endpoin
+0001c6f0: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
+0001c700: 6d20 7374 6172 743a 2020 2020 2020 2020  m start:        
+0001c710: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+0001c720: 6520 7374 6172 7420 7469 6d65 206f 6620  e start time of 
+0001c730: 7468 6520 6d65 7472 6963 732e 2043 616e  the metrics. Can
+0001c740: 2062 6520 7265 7072 6573 656e 7465 6420   be represented 
+0001c750: 6279 2061 2073 7472 696e 6720 636f 6e74  by a string cont
+0001c760: 6169 6e69 6e67 2061 6e0a 2020 2020 2020  aining an.      
+0001c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c790: 2020 2020 2052 4643 2033 3333 3920 7469       RFC 3339 ti
+0001c7a0: 6d65 2c20 6120 556e 6978 2074 696d 6573  me, a Unix times
+0001c7b0: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
+0001c7c0: 6f6e 6473 2c20 6120 7265 6c61 7469 7665  onds, a relative
+0001c7d0: 2074 696d 6520 2860 276e 6f77 2760 206f   time (`'now'` o
+0001c7e0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0001c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c800: 2020 2020 2020 2020 2020 2020 2060 276e               `'n
+0001c810: 6f77 2d5b 302d 395d 2b5b 6d68 645d 2760  ow-[0-9]+[mhd]'`
+0001c820: 2c20 7768 6572 6520 606d 6020 3d20 6d69  , where `m` = mi
+0001c830: 6e75 7465 732c 2060 6860 203d 2068 6f75  nutes, `h` = hou
+0001c840: 7273 2c20 616e 6420 6027 6427 6020 3d20  rs, and `'d'` = 
+0001c850: 6461 7973 292c 206f 720a 2020 2020 2020  days), or.      
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c880: 2020 2020 2030 2066 6f72 2074 6865 2065       0 for the e
+0001c890: 6172 6c69 6573 7420 7469 6d65 2e0a 2020  arliest time..  
+0001c8a0: 2020 2020 2020 3a70 6172 616d 2065 6e64        :param end
+0001c8b0: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+0001c8c0: 2020 2020 2020 2020 2054 6865 2065 6e64           The end
+0001c8d0: 2074 696d 6520 6f66 2074 6865 206d 6574   time of the met
+0001c8e0: 7269 6373 2e20 4361 6e20 6265 2072 6570  rics. Can be rep
+0001c8f0: 7265 7365 6e74 6564 2062 7920 6120 7374  resented by a st
+0001c900: 7269 6e67 2063 6f6e 7461 696e 696e 6720  ring containing 
+0001c910: 616e 0a20 2020 2020 2020 2020 2020 2020  an.             
+0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c930: 2020 2020 2020 2020 2020 2020 2020 5246                RF
+0001c940: 4320 3333 3339 2074 696d 652c 2061 2055  C 3339 time, a U
+0001c950: 6e69 7820 7469 6d65 7374 616d 7020 696e  nix timestamp in
+0001c960: 206d 696c 6c69 7365 636f 6e64 732c 2061   milliseconds, a
+0001c970: 2072 656c 6174 6976 6520 7469 6d65 2028   relative time (
+0001c980: 6027 6e6f 7727 6020 6f72 0a20 2020 2020  `'now'` or.     
+0001c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9b0: 2020 2020 2020 6027 6e6f 772d 5b30 2d39        `'now-[0-9
+0001c9c0: 5d2b 5b6d 6864 5d27 602c 2077 6865 7265  ]+[mhd]'`, where
+0001c9d0: 2060 6d60 203d 206d 696e 7574 6573 2c20   `m` = minutes, 
+0001c9e0: 6068 6020 3d20 686f 7572 732c 2061 6e64  `h` = hours, and
+0001c9f0: 2060 2764 2760 203d 2064 6179 7329 2c20   `'d'` = days), 
+0001ca00: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 2020 2020 2020 2020 2020 2020 2020 3020                0 
+0001ca30: 666f 7220 7468 6520 6561 726c 6965 7374  for the earliest
+0001ca40: 2074 696d 652e 0a20 2020 2020 2020 203a   time..        :
+0001ca50: 7061 7261 6d20 6d65 7472 6963 733a 2020  param metrics:  
+0001ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca70: 2020 4120 6c69 7374 206f 6620 6d65 7472    A list of metr
+0001ca80: 6963 7320 746f 2072 6574 7572 6e20 666f  ics to return fo
+0001ca90: 7220 7468 6520 6d6f 6465 6c20 656e 6470  r the model endp
+0001caa0: 6f69 6e74 2e20 5468 6572 6520 6172 6520  oint. There are 
+0001cab0: 7072 652d 6465 6669 6e65 640a 2020 2020  pre-defined.    
+0001cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cae0: 2020 2020 2020 206d 6574 7269 6373 2066         metrics f
+0001caf0: 6f72 206d 6f64 656c 2065 6e64 706f 696e  or model endpoin
+0001cb00: 7473 2073 7563 6820 6173 2070 7265 6469  ts such as predi
+0001cb10: 6374 696f 6e73 5f70 6572 5f73 6563 6f6e  ctions_per_secon
+0001cb20: 6420 616e 640a 2020 2020 2020 2020 2020  d and.          
+0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb50: 206c 6174 656e 6379 5f61 7667 5f35 6d20   latency_avg_5m 
+0001cb60: 6275 7420 616c 736f 2063 7573 746f 6d20  but also custom 
+0001cb70: 6d65 7472 6963 7320 6465 6669 6e65 6420  metrics defined 
+0001cb80: 6279 2074 6865 2075 7365 722e 2050 6c65  by the user. Ple
+0001cb90: 6173 6520 6e6f 7465 2074 6861 740a 2020  ase note that.  
 0001cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbb0: 2020 2020 2020 4578 616d 706c 653a 3a0a        Example::.
-0001cbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbe0: 2023 2047 656e 6572 6174 6520 6375 7272   # Generate curr
-0001cbf0: 656e 7420 7374 6174 7320 666f 7220 7477  ent stats for tw
-0001cc00: 6f20 6665 6174 7572 6573 0a20 2020 2020  o features.     
+0001cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbc0: 2020 2020 2020 2020 2074 6865 7365 206d           these m
+0001cbd0: 6574 7269 6373 2061 7265 2073 746f 7265  etrics are store
+0001cbe0: 6420 696e 2074 6865 2074 696d 6520 7365  d in the time se
+0001cbf0: 7269 6573 2044 4220 616e 6420 7468 6520  ries DB and the 
+0001cc00: 7265 7375 6c74 7320 7769 6c6c 2062 650a  results will be.
 0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc20: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0001cc30: 6e74 5f73 7461 7473 203d 207b 2774 7664  nt_stats = {'tvd
-0001cc40: 5f73 756d 273a 2032 2e32 2c0a 2020 2020  _sum': 2.2,.    
-0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc70: 2020 2020 2020 2020 2020 2020 2027 7476               'tv
-0001cc80: 645f 6d65 616e 273a 2030 2e35 2c0a 2020  d_mean': 0.5,.  
-0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001ccc0: 6865 6c6c 696e 6765 725f 7375 6d27 3a20  hellinger_sum': 
-0001ccd0: 332e 362c 0a20 2020 2020 2020 2020 2020  3.6,.           
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc30: 2020 2020 2020 2020 2020 2061 7070 6561             appea
+0001cc40: 7265 6420 756e 6465 7220 6d6f 6465 6c5f  red under model_
+0001cc50: 656e 6470 6f69 6e74 2e73 7065 632e 6d65  endpoint.spec.me
+0001cc60: 7472 6963 732e 0a20 2020 2020 2020 203a  trics..        :
+0001cc70: 7061 7261 6d20 6665 6174 7572 655f 616e  param feature_an
+0001cc80: 616c 7973 6973 3a20 2020 2020 2020 2020  alysis:         
+0001cc90: 2020 5768 656e 2054 7275 652c 2074 6865    When True, the
+0001cca0: 2062 6173 6520 6665 6174 7572 6520 7374   base feature st
+0001ccb0: 6174 6973 7469 6373 2061 6e64 2063 7572  atistics and cur
+0001ccc0: 7265 6e74 2066 6561 7475 7265 2073 7461  rent feature sta
+0001ccd0: 7469 7374 6963 7320 7769 6c6c 0a20 2020  tistics will.   
 0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd00: 2020 2020 2020 2768 656c 6c69 6e67 6572        'hellinger
-0001cd10: 5f6d 6561 6e27 3a20 302e 392c 0a20 2020  _mean': 0.9,.   
-0001cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd40: 2020 2020 2020 2020 2020 2020 2020 276b                'k
-0001cd50: 6c64 5f73 756d 273a 2032 342e 322c 0a20  ld_sum': 24.2,. 
-0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd90: 276b 6c64 5f6d 6561 6e27 3a20 362e 302c  'kld_mean': 6.0,
-0001cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdd0: 2020 2766 3127 3a20 7b27 7476 6427 3a20    'f1': {'tvd': 
-0001cde0: 302e 352c 2027 6865 6c6c 696e 6765 7227  0.5, 'hellinger'
-0001cdf0: 3a20 312e 302c 2027 6b6c 6427 3a20 362e  : 1.0, 'kld': 6.
-0001ce00: 347d 2c0a 2020 2020 2020 2020 2020 2020  4},.            
-0001ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce30: 2020 2020 2027 6632 273a 207b 2774 7664       'f2': {'tvd
-0001ce40: 273a 2030 2e35 2c20 2768 656c 6c69 6e67  ': 0.5, 'helling
-0001ce50: 6572 273a 2031 2e30 2c20 276b 6c64 273a  er': 1.0, 'kld':
-0001ce60: 2036 2e35 7d7d 0a0a 2020 2020 2020 2020   6.5}}..        
-0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce80: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-0001ce90: 2061 7474 7269 6275 7465 7320 6469 6374   attributes dict
-0001cea0: 696f 6e61 7279 2061 6363 6f72 6469 6e67  ionary according
-0001ceb0: 2074 6f20 7468 6520 7265 7175 6972 6564   to the required
-0001cec0: 2066 6f72 6d61 740a 2020 2020 2020 2020   format.        
-0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cee0: 2020 2020 2020 2020 6174 7472 6962 7574          attribut
-0001cef0: 6573 203d 207b 6063 7572 7265 6e74 5f73  es = {`current_s
-0001cf00: 7461 7473 603a 206a 736f 6e2e 6475 6d70  tats`: json.dump
-0001cf10: 7328 6375 7272 656e 745f 7374 6174 7329  s(current_stats)
-0001cf20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf50: 6064 7269 6674 5f73 7461 7475 7360 3a20  `drift_status`: 
-0001cf60: 2244 5249 4654 5f44 4554 4543 5445 4422  "DRIFT_DETECTED"
-0001cf70: 7d0a 0a20 2020 2020 2020 2022 2222 0a0a  }..        """..
-0001cf80: 2020 2020 2020 2020 6174 7472 6962 7574          attribut
-0001cf90: 6573 203d 207b 2261 7474 7269 6275 7465  es = {"attribute
-0001cfa0: 7322 3a20 5f61 735f 6a73 6f6e 2861 7474  s": _as_json(att
-0001cfb0: 7269 6275 7465 7329 7d0a 2020 2020 2020  ributes)}.      
-0001cfc0: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
-0001cfd0: 6374 732f 7b70 726f 6a65 6374 7d2f 6d6f  cts/{project}/mo
-0001cfe0: 6465 6c2d 656e 6470 6f69 6e74 732f 7b65  del-endpoints/{e
-0001cff0: 6e64 706f 696e 745f 6964 7d22 0a20 2020  ndpoint_id}".   
-0001d000: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
-0001d010: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-0001d020: 6d65 7468 6f64 3d22 5041 5443 4822 2c0a  method="PATCH",.
-0001d030: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0001d040: 3d70 6174 682c 0a20 2020 2020 2020 2020  =path,.         
-0001d050: 2020 2070 6172 616d 733d 6174 7472 6962     params=attrib
-0001d060: 7574 6573 2c0a 2020 2020 2020 2020 290a  utes,.        ).
-0001d070: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-0001d080: 6d61 726b 6574 706c 6163 655f 736f 7572  marketplace_sour
-0001d090: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
-0001d0a0: 2c20 736f 7572 6365 3a20 556e 696f 6e5b  , source: Union[
-0001d0b0: 6469 6374 2c20 7363 6865 6d61 732e 496e  dict, schemas.In
-0001d0c0: 6465 7865 644d 6172 6b65 7470 6c61 6365  dexedMarketplace
-0001d0d0: 536f 7572 6365 5d0a 2020 2020 293a 0a20  Source].    ):. 
-0001d0e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001d0f0: 2020 2041 6464 2061 206e 6577 206d 6172     Add a new mar
-0001d100: 6b65 7470 6c61 6365 2073 6f75 7263 652e  ketplace source.
-0001d110: 0a0a 2020 2020 2020 2020 4d4c 5275 6e20  ..        MLRun 
-0001d120: 6d61 696e 7461 696e 7320 616e 206f 7264  maintains an ord
-0001d130: 6572 6564 206c 6973 7420 6f66 206d 6172  ered list of mar
-0001d140: 6b65 7470 6c61 6365 2073 6f75 7263 6573  ketplace sources
-0001d150: 2028 e280 9c73 6f75 7263 6573 e280 9d29   (...sources...)
-0001d160: 2045 6163 6820 736f 7572 6365 2068 6173   Each source has
-0001d170: 0a20 2020 2020 2020 2069 7473 2064 6574  .        its det
-0001d180: 6169 6c73 2072 6567 6973 7465 7265 6420  ails registered 
-0001d190: 616e 6420 6974 7320 6f72 6465 7220 7769  and its order wi
-0001d1a0: 7468 696e 2074 6865 206c 6973 742e 2057  thin the list. W
-0001d1b0: 6865 6e20 6372 6561 7469 6e67 2061 206e  hen creating a n
-0001d1c0: 6577 2073 6f75 7263 652c 2074 6865 2073  ew source, the s
-0001d1d0: 7065 6369 616c 206f 7264 6572 2060 602d  pecial order ``-
-0001d1e0: 3160 600a 2020 2020 2020 2020 6361 6e20  1``.        can 
-0001d1f0: 6265 2075 7365 6420 746f 206d 6172 6b20  be used to mark 
-0001d200: 7468 6973 2073 6f75 7263 6520 6173 206c  this source as l
-0001d210: 6173 7420 696e 2074 6865 206c 6973 742e  ast in the list.
-0001d220: 2048 6f77 6576 6572 2c20 6f6e 6365 2074   However, once t
-0001d230: 6865 2073 6f75 7263 6520 6973 2069 6e20  he source is in 
-0001d240: 7468 6520 4d4c 5275 6e20 6c69 7374 2c0a  the MLRun list,.
-0001d250: 2020 2020 2020 2020 6974 7320 6f72 6465          its orde
-0001d260: 7220 7769 6c6c 2061 6c77 6179 7320 6265  r will always be
-0001d270: 2060 603e 3060 602e 0a0a 2020 2020 2020   ``>0``...      
-0001d280: 2020 5468 6520 676c 6f62 616c 206d 6172    The global mar
-0001d290: 6b65 7470 6c61 6365 2073 6f75 7263 6520  ketplace source 
-0001d2a0: 616c 7761 7973 2065 7869 7374 7320 696e  always exists in
-0001d2b0: 2074 6865 206c 6973 742c 2061 6e64 2069   the list, and i
-0001d2c0: 7320 616c 7761 7973 2074 6865 206c 6173  s always the las
-0001d2d0: 7420 736f 7572 6365 0a20 2020 2020 2020  t source.       
-0001d2e0: 2028 6060 6f72 6465 7220 3d20 2d31 6060   (``order = -1``
-0001d2f0: 292e 2049 7420 6361 6e6e 6f74 2062 6520  ). It cannot be 
-0001d300: 6d6f 6469 6669 6564 206e 6f72 2063 616e  modified nor can
-0001d310: 2069 7420 6265 206d 6f76 6564 2074 6f20   it be moved to 
-0001d320: 616e 6f74 6865 7220 6f72 6465 7220 696e  another order in
-0001d330: 2074 6865 206c 6973 742e 0a0a 2020 2020   the list...    
-0001d340: 2020 2020 5468 6520 736f 7572 6365 206f      The source o
-0001d350: 626a 6563 7420 6d61 7920 636f 6e74 6169  bject may contai
-0001d360: 6e20 6372 6564 656e 7469 616c 7320 7768  n credentials wh
-0001d370: 6963 6820 6172 6520 6e65 6564 6564 2074  ich are needed t
-0001d380: 6f20 6163 6365 7373 2074 6865 2064 6174  o access the dat
-0001d390: 6173 746f 7265 2077 6865 7265 2074 6865  astore where the
-0001d3a0: 2073 6f75 7263 6520 6973 2073 746f 7265   source is store
-0001d3b0: 642e 0a20 2020 2020 2020 2054 6865 7365  d..        These
-0001d3c0: 2063 7265 6465 6e74 6961 6c73 2061 7265   credentials are
-0001d3d0: 206e 6f74 206b 6570 7420 696e 2074 6865   not kept in the
-0001d3e0: 204d 4c52 756e 2044 422c 2062 7574 2061   MLRun DB, but a
-0001d3f0: 7265 2073 746f 7265 6420 696e 7369 6465  re stored inside
-0001d400: 2061 206b 7562 6572 6e65 7465 7320 7365   a kubernetes se
-0001d410: 6372 6574 206f 626a 6563 7420 6d61 696e  cret object main
-0001d420: 7461 696e 6564 2062 790a 2020 2020 2020  tained by.      
-0001d430: 2020 4d4c 5275 6e2e 2054 6865 7920 6172    MLRun. They ar
-0001d440: 6520 6e6f 7420 7265 7475 726e 6564 2074  e not returned t
-0001d450: 6872 6f75 6768 2061 6e79 2041 5049 2066  hrough any API f
-0001d460: 726f 6d20 4d4c 5275 6e2e 0a0a 2020 2020  rom MLRun...    
-0001d470: 2020 2020 4578 616d 706c 653a 3a0a 0a20      Example::.. 
-0001d480: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
-0001d490: 7420 6d6c 7275 6e2e 6170 692e 7363 6865  t mlrun.api.sche
-0001d4a0: 6d61 730a 0a20 2020 2020 2020 2020 2020  mas..           
-0001d4b0: 2023 2041 6464 2061 2070 7269 7661 7465   # Add a private
-0001d4c0: 2073 6f75 7263 6520 6173 2074 6865 206c   source as the l
-0001d4d0: 6173 7420 6f6e 6520 2877 696c 6c20 6265  ast one (will be
-0001d4e0: 2023 3120 696e 2074 6865 206c 6973 7429   #1 in the list)
-0001d4f0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001d500: 7661 7465 5f73 6f75 7263 6520 3d20 6d6c  vate_source = ml
-0001d510: 7275 6e2e 6170 692e 7363 6865 6d61 732e  run.api.schemas.
-0001d520: 496e 6465 7865 644d 6172 6b65 7470 6c61  IndexedMarketpla
-0001d530: 6365 536f 7572 6365 280a 2020 2020 2020  ceSource(.      
-0001d540: 2020 2020 2020 2020 2020 6f72 6465 723d            order=
-0001d550: 2d31 2c0a 2020 2020 2020 2020 2020 2020  -1,.            
-0001d560: 2020 2020 736f 7572 6365 3d6d 6c72 756e      source=mlrun
-0001d570: 2e61 7069 2e73 6368 656d 6173 2e4d 6172  .api.schemas.Mar
-0001d580: 6b65 7470 6c61 6365 536f 7572 6365 280a  ketplaceSource(.
+0001cd00: 2020 2020 2020 2020 6265 2061 6464 6564          be added
+0001cd10: 2074 6f20 7468 6520 6f75 7470 7574 206f   to the output o
+0001cd20: 6620 7468 6520 7265 7375 6c74 696e 6720  f the resulting 
+0001cd30: 6f62 6a65 6374 2e0a 0a20 2020 2020 2020  object...       
+0001cd40: 203a 7265 7475 726e 3a20 4120 604d 6f64   :return: A `Mod
+0001cd50: 656c 456e 6470 6f69 6e74 6020 6f62 6a65  elEndpoint` obje
+0001cd60: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+0001cd70: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0001cd80: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+0001cd90: 6563 747d 2f6d 6f64 656c 2d65 6e64 706f  ect}/model-endpo
+0001cda0: 696e 7473 2f7b 656e 6470 6f69 6e74 5f69  ints/{endpoint_i
+0001cdb0: 647d 220a 2020 2020 2020 2020 7265 7370  d}".        resp
+0001cdc0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+0001cdd0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+0001cde0: 2020 6d65 7468 6f64 3d22 4745 5422 2c0a    method="GET",.
+0001cdf0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0001ce00: 3d70 6174 682c 0a20 2020 2020 2020 2020  =path,.         
+0001ce10: 2020 2070 6172 616d 733d 7b0a 2020 2020     params={.    
+0001ce20: 2020 2020 2020 2020 2020 2020 2273 7461              "sta
+0001ce30: 7274 223a 2073 7461 7274 2c0a 2020 2020  rt": start,.    
+0001ce40: 2020 2020 2020 2020 2020 2020 2265 6e64              "end
+0001ce50: 223a 2065 6e64 2c0a 2020 2020 2020 2020  ": end,.        
+0001ce60: 2020 2020 2020 2020 226d 6574 7269 6322          "metric"
+0001ce70: 3a20 6d65 7472 6963 7320 6f72 205b 5d2c  : metrics or [],
+0001ce80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ce90: 2022 6665 6174 7572 655f 616e 616c 7973   "feature_analys
+0001cea0: 6973 223a 2066 6561 7475 7265 5f61 6e61  is": feature_ana
+0001ceb0: 6c79 7369 732c 0a20 2020 2020 2020 2020  lysis,.         
+0001cec0: 2020 207d 2c0a 2020 2020 2020 2020 290a     },.        ).
+0001ced0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001cee0: 6d6c 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69  mlrun.model_moni
+0001cef0: 746f 7269 6e67 2e6d 6f64 656c 5f65 6e64  toring.model_end
+0001cf00: 706f 696e 742e 4d6f 6465 6c45 6e64 706f  point.ModelEndpo
+0001cf10: 696e 742e 6672 6f6d 5f64 6963 7428 0a20  int.from_dict(. 
+0001cf20: 2020 2020 2020 2020 2020 2072 6573 706f             respo
+0001cf30: 6e73 652e 6a73 6f6e 2829 0a20 2020 2020  nse.json().     
+0001cf40: 2020 2029 0a0a 2020 2020 6465 6620 7061     )..    def pa
+0001cf50: 7463 685f 6d6f 6465 6c5f 656e 6470 6f69  tch_model_endpoi
+0001cf60: 6e74 280a 2020 2020 2020 2020 7365 6c66  nt(.        self
+0001cf70: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+0001cf80: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
+0001cf90: 656e 6470 6f69 6e74 5f69 643a 2073 7472  endpoint_id: str
+0001cfa0: 2c0a 2020 2020 2020 2020 6174 7472 6962  ,.        attrib
+0001cfb0: 7574 6573 3a20 6469 6374 2c0a 2020 2020  utes: dict,.    
+0001cfc0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001cfd0: 2020 2020 2020 2055 7064 6174 6573 206d         Updates m
+0001cfe0: 6f64 656c 2065 6e64 706f 696e 7420 7769  odel endpoint wi
+0001cff0: 7468 2070 726f 7669 6465 6420 6174 7472  th provided attr
+0001d000: 6962 7574 6573 2e0a 0a20 2020 2020 2020  ibutes...       
+0001d010: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
+0001d020: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
+0001d030: 2070 726f 6a65 6374 2e0a 2020 2020 2020   project..      
+0001d040: 2020 3a70 6172 616d 2065 6e64 706f 696e    :param endpoin
+0001d050: 745f 6964 3a20 5468 6520 6964 206f 6620  t_id: The id of 
+0001d060: 7468 6520 656e 6470 6f69 6e74 2e0a 2020  the endpoint..  
+0001d070: 2020 2020 2020 3a70 6172 616d 2061 7474        :param att
+0001d080: 7269 6275 7465 733a 2044 6963 7469 6f6e  ributes: Diction
+0001d090: 6172 7920 6f66 2061 7474 7269 6275 7465  ary of attribute
+0001d0a0: 7320 7468 6174 2077 696c 6c20 6265 2075  s that will be u
+0001d0b0: 7365 6420 666f 7220 7570 6461 7465 2074  sed for update t
+0001d0c0: 6865 206d 6f64 656c 2065 6e64 706f 696e  he model endpoin
+0001d0d0: 742e 2054 6865 206b 6579 730a 2020 2020  t. The keys.    
+0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0f0: 2020 2020 2020 206f 6620 7468 6973 2064         of this d
+0001d100: 6963 7469 6f6e 6172 7920 7368 6f75 6c64  ictionary should
+0001d110: 2065 7869 7374 2069 6e20 7468 6520 7461   exist in the ta
+0001d120: 7267 6574 2074 6162 6c65 2e20 4e6f 7465  rget table. Note
+0001d130: 2074 6861 7420 7468 6520 7661 6c75 6573   that the values
+0001d140: 2073 686f 756c 6420 6265 0a20 2020 2020   should be.     
+0001d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d160: 2020 2020 2020 6672 6f6d 2074 7970 6520        from type 
+0001d170: 7374 7269 6e67 206f 7220 6672 6f6d 2061  string or from a
+0001d180: 2076 616c 6964 206e 756d 6572 6963 616c   valid numerical
+0001d190: 2074 7970 6520 7375 6368 2061 7320 696e   type such as in
+0001d1a0: 7420 6f72 2066 6c6f 6174 2e0a 2020 2020  t or float..    
+0001d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1c0: 2020 2020 2020 2020 4d6f 7265 2064 6574          More det
+0001d1d0: 6169 6c73 2061 626f 7574 2074 6865 206d  ails about the m
+0001d1e0: 6f64 656c 2065 6e64 706f 696e 7420 6176  odel endpoint av
+0001d1f0: 6169 6c61 626c 6520 6174 7472 6962 7574  ailable attribut
+0001d200: 6573 2063 616e 2062 6520 666f 756e 6420  es can be found 
+0001d210: 756e 6465 720a 2020 2020 2020 2020 2020  under.          
+0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d230: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
+0001d240: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001d250: 732e 4d6f 6465 6c45 6e64 706f 696e 7460  s.ModelEndpoint`
+0001d260: 2e0a 0a20 2020 2020 2020 2020 2020 2020  ...             
+0001d270: 2020 2020 2020 2020 2020 2020 2020 4578                Ex
+0001d280: 616d 706c 653a 3a0a 0a20 2020 2020 2020  ample::..       
+0001d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2a0: 2020 2020 2020 2020 2023 2047 656e 6572           # Gener
+0001d2b0: 6174 6520 6375 7272 656e 7420 7374 6174  ate current stat
+0001d2c0: 7320 666f 7220 7477 6f20 6665 6174 7572  s for two featur
+0001d2d0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0001d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2f0: 2020 2063 7572 7265 6e74 5f73 7461 7473     current_stats
+0001d300: 203d 207b 2774 7664 5f73 756d 273a 2032   = {'tvd_sum': 2
+0001d310: 2e32 2c0a 2020 2020 2020 2020 2020 2020  .2,.            
+0001d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d340: 2020 2020 2027 7476 645f 6d65 616e 273a       'tvd_mean':
+0001d350: 2030 2e35 2c0a 2020 2020 2020 2020 2020   0.5,.          
+0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d380: 2020 2020 2020 2027 6865 6c6c 696e 6765         'hellinge
+0001d390: 725f 7375 6d27 3a20 332e 362c 0a20 2020  r_sum': 3.6,.   
+0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3c0: 2020 2020 2020 2020 2020 2020 2020 2768                'h
+0001d3d0: 656c 6c69 6e67 6572 5f6d 6561 6e27 3a20  ellinger_mean': 
+0001d3e0: 302e 392c 0a20 2020 2020 2020 2020 2020  0.9,.           
+0001d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d410: 2020 2020 2020 276b 6c64 5f73 756d 273a        'kld_sum':
+0001d420: 2032 342e 322c 0a20 2020 2020 2020 2020   24.2,.         
+0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d450: 2020 2020 2020 2020 276b 6c64 5f6d 6561          'kld_mea
+0001d460: 6e27 3a20 362e 302c 0a20 2020 2020 2020  n': 6.0,.       
+0001d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d490: 2020 2020 2020 2020 2020 2766 3127 3a20            'f1': 
+0001d4a0: 7b27 7476 6427 3a20 302e 352c 2027 6865  {'tvd': 0.5, 'he
+0001d4b0: 6c6c 696e 6765 7227 3a20 312e 302c 2027  llinger': 1.0, '
+0001d4c0: 6b6c 6427 3a20 362e 347d 2c0a 2020 2020  kld': 6.4},.    
+0001d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4f0: 2020 2020 2020 2020 2020 2020 2027 6632               'f2
+0001d500: 273a 207b 2774 7664 273a 2030 2e35 2c20  ': {'tvd': 0.5, 
+0001d510: 2768 656c 6c69 6e67 6572 273a 2031 2e30  'hellinger': 1.0
+0001d520: 2c20 276b 6c64 273a 2036 2e35 7d7d 0a0a  , 'kld': 6.5}}..
+0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d550: 2320 4372 6561 7465 2061 7474 7269 6275  # Create attribu
+0001d560: 7465 7320 6469 6374 696f 6e61 7279 2061  tes dictionary a
+0001d570: 6363 6f72 6469 6e67 2074 6f20 7468 6520  ccording to the 
+0001d580: 7265 7175 6972 6564 2066 6f72 6d61 740a  required format.
 0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5a0: 2020 2020 6d65 7461 6461 7461 3d6d 6c72      metadata=mlr
-0001d5b0: 756e 2e61 7069 2e73 6368 656d 6173 2e4d  un.api.schemas.M
-0001d5c0: 6172 6b65 7470 6c61 6365 4f62 6a65 6374  arketplaceObject
-0001d5d0: 4d65 7461 6461 7461 286e 616d 653d 2270  Metadata(name="p
-0001d5e0: 7269 7622 2c20 6465 7363 7269 7074 696f  riv", descriptio
-0001d5f0: 6e3d 2261 2070 7269 7661 7465 2073 6f75  n="a private sou
-0001d600: 7263 6522 292c 0a20 2020 2020 2020 2020  rce"),.         
-0001d610: 2020 2020 2020 2020 2020 2073 7065 633d             spec=
-0001d620: 6d6c 7275 6e2e 6170 692e 7363 6865 6d61  mlrun.api.schema
-0001d630: 732e 4d61 726b 6574 706c 6163 6553 6f75  s.MarketplaceSou
-0001d640: 7263 6553 7065 6328 7061 7468 3d22 2f6c  rceSpec(path="/l
-0001d650: 6f63 616c 2f70 6174 682f 746f 2f73 6f75  ocal/path/to/sou
-0001d660: 7263 6522 2c20 6368 616e 6e65 6c3d 2264  rce", channel="d
-0001d670: 6576 656c 6f70 6d65 6e74 2229 0a20 2020  evelopment").   
-0001d680: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0001d690: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001d6a0: 2020 2020 2020 2020 2064 622e 6372 6561           db.crea
-0001d6b0: 7465 5f6d 6172 6b65 7470 6c61 6365 5f73  te_marketplace_s
-0001d6c0: 6f75 7263 6528 7072 6976 6174 655f 736f  ource(private_so
-0001d6d0: 7572 6365 290a 0a20 2020 2020 2020 2020  urce)..         
-0001d6e0: 2020 2023 2041 6464 2061 6e6f 7468 6572     # Add another
-0001d6f0: 2073 6f75 7263 6520 6173 2031 7374 2069   source as 1st i
-0001d700: 6e20 7468 6520 6c69 7374 202d 2077 696c  n the list - wil
-0001d710: 6c20 7075 7368 2070 7265 7669 6f75 7320  l push previous 
-0001d720: 6f6e 6520 746f 2062 6520 2332 0a20 2020  one to be #2.   
-0001d730: 2020 2020 2020 2020 2061 6e6f 7468 6572           another
-0001d740: 5f73 6f75 7263 6520 3d20 6d6c 7275 6e2e  _source = mlrun.
-0001d750: 6170 692e 7363 6865 6d61 732e 496e 6465  api.schemas.Inde
-0001d760: 7865 644d 6172 6b65 7470 6c61 6365 536f  xedMarketplaceSo
-0001d770: 7572 6365 280a 2020 2020 2020 2020 2020  urce(.          
-0001d780: 2020 2020 2020 6f72 6465 723d 312c 0a20        order=1,. 
-0001d790: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d7a0: 6f75 7263 653d 6d6c 7275 6e2e 6170 692e  ource=mlrun.api.
-0001d7b0: 7363 6865 6d61 732e 4d61 726b 6574 706c  schemas.Marketpl
-0001d7c0: 6163 6553 6f75 7263 6528 0a20 2020 2020  aceSource(.     
-0001d7d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001d7e0: 6574 6164 6174 613d 6d6c 7275 6e2e 6170  etadata=mlrun.ap
-0001d7f0: 692e 7363 6865 6d61 732e 4d61 726b 6574  i.schemas.Market
-0001d800: 706c 6163 654f 626a 6563 744d 6574 6164  placeObjectMetad
-0001d810: 6174 6128 6e61 6d65 3d22 7072 6976 2d32  ata(name="priv-2
-0001d820: 222c 2064 6573 6372 6970 7469 6f6e 3d22  ", description="
-0001d830: 616e 6f74 6865 7220 736f 7572 6365 2229  another source")
-0001d840: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d850: 2020 2020 2020 7370 6563 3d6d 6c72 756e        spec=mlrun
-0001d860: 2e61 7069 2e73 6368 656d 6173 2e4d 6172  .api.schemas.Mar
-0001d870: 6b65 7470 6c61 6365 536f 7572 6365 5370  ketplaceSourceSp
-0001d880: 6563 280a 2020 2020 2020 2020 2020 2020  ec(.            
-0001d890: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0001d8a0: 3d22 2f6c 6f63 616c 2f70 6174 682f 746f  ="/local/path/to
-0001d8b0: 2f73 6f75 7263 652f 3222 2c0a 2020 2020  /source/2",.    
-0001d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8d0: 2020 2020 6368 616e 6e65 6c3d 2264 6576      channel="dev
-0001d8e0: 656c 6f70 6d65 6e74 222c 0a20 2020 2020  elopment",.     
-0001d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d900: 2020 2063 7265 6465 6e74 6961 6c73 3d7b     credentials={
-0001d910: 2e2e 2e7d 0a20 2020 2020 2020 2020 2020  ...}.           
-0001d920: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001d930: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001d940: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001d950: 2020 2020 2020 2064 622e 6372 6561 7465         db.create
-0001d960: 5f6d 6172 6b65 7470 6c61 6365 5f73 6f75  _marketplace_sou
-0001d970: 7263 6528 616e 6f74 6865 725f 736f 7572  rce(another_sour
-0001d980: 6365 290a 0a20 2020 2020 2020 203a 7061  ce)..        :pa
-0001d990: 7261 6d20 736f 7572 6365 3a20 5468 6520  ram source: The 
-0001d9a0: 736f 7572 6365 2061 6e64 2069 7473 206f  source and its o
-0001d9b0: 7264 6572 2c20 6f66 2074 7970 650a 2020  rder, of type.  
-0001d9c0: 2020 2020 2020 2020 2020 3a70 793a 636c            :py:cl
-0001d9d0: 6173 733a 607e 6d6c 7275 6e2e 6170 692e  ass:`~mlrun.api.
-0001d9e0: 7363 6865 6d61 732e 6d61 726b 6574 706c  schemas.marketpl
-0001d9f0: 6163 652e 496e 6465 7865 644d 6172 6b65  ace.IndexedMarke
-0001da00: 7470 6c61 6365 536f 7572 6365 602c 206f  tplaceSource`, o
-0001da10: 7220 696e 2064 6963 7469 6f6e 6172 7920  r in dictionary 
-0001da20: 666f 726d 2e0a 2020 2020 2020 2020 3a72  form..        :r
-0001da30: 6574 7572 6e73 3a20 5468 6520 736f 7572  eturns: The sour
-0001da40: 6365 206f 626a 6563 7420 6173 2069 6e73  ce object as ins
-0001da50: 6572 7465 6420 696e 746f 2074 6865 2064  erted into the d
-0001da60: 6174 6162 6173 652c 2077 6974 6820 6372  atabase, with cr
-0001da70: 6564 656e 7469 616c 7320 7374 7269 7070  edentials stripp
-0001da80: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-0001da90: 2020 2020 2020 2020 7061 7468 203d 2022          path = "
-0001daa0: 6d61 726b 6574 706c 6163 652f 736f 7572  marketplace/sour
-0001dab0: 6365 7322 0a20 2020 2020 2020 2069 6620  ces".        if 
-0001dac0: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
-0001dad0: 652c 2073 6368 656d 6173 2e49 6e64 6578  e, schemas.Index
-0001dae0: 6564 4d61 726b 6574 706c 6163 6553 6f75  edMarketplaceSou
-0001daf0: 7263 6529 3a0a 2020 2020 2020 2020 2020  rce):.          
-0001db00: 2020 736f 7572 6365 203d 2073 6f75 7263    source = sourc
-0001db10: 652e 6469 6374 2829 0a20 2020 2020 2020  e.dict().       
-0001db20: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
-0001db30: 2e61 7069 5f63 616c 6c28 6d65 7468 6f64  .api_call(method
-0001db40: 3d22 504f 5354 222c 2070 6174 683d 7061  ="POST", path=pa
-0001db50: 7468 2c20 6a73 6f6e 3d73 6f75 7263 6529  th, json=source)
-0001db60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001db70: 7363 6865 6d61 732e 496e 6465 7865 644d  schemas.IndexedM
-0001db80: 6172 6b65 7470 6c61 6365 536f 7572 6365  arketplaceSource
-0001db90: 282a 2a72 6573 706f 6e73 652e 6a73 6f6e  (**response.json
-0001dba0: 2829 290a 0a20 2020 2064 6566 2073 746f  ())..    def sto
-0001dbb0: 7265 5f6d 6172 6b65 7470 6c61 6365 5f73  re_marketplace_s
-0001dbc0: 6f75 7263 6528 0a20 2020 2020 2020 2073  ource(.        s
-0001dbd0: 656c 662c 2073 6f75 7263 655f 6e61 6d65  elf, source_name
-0001dbe0: 3a20 7374 722c 2073 6f75 7263 653a 2055  : str, source: U
-0001dbf0: 6e69 6f6e 5b64 6963 742c 2073 6368 656d  nion[dict, schem
-0001dc00: 6173 2e49 6e64 6578 6564 4d61 726b 6574  as.IndexedMarket
-0001dc10: 706c 6163 6553 6f75 7263 655d 0a20 2020  placeSource].   
-0001dc20: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-0001dc30: 2020 2020 2020 2020 4372 6561 7465 206f          Create o
-0001dc40: 7220 7265 706c 6163 6520 6120 6d61 726b  r replace a mark
-0001dc50: 6574 706c 6163 6520 736f 7572 6365 2e0a  etplace source..
-0001dc60: 2020 2020 2020 2020 466f 7220 616e 2065          For an e
-0001dc70: 7861 6d70 6c65 206f 6620 7468 6520 736f  xample of the so
-0001dc80: 7572 6365 2066 6f72 6d61 7420 616e 6420  urce format and 
-0001dc90: 6578 706c 616e 6174 696f 6e20 6f66 2074  explanation of t
-0001dca0: 6865 2073 6f75 7263 6520 6f72 6465 7220  he source order 
-0001dcb0: 6c6f 6769 632c 0a20 2020 2020 2020 2070  logic,.        p
-0001dcc0: 6c65 6173 6520 7365 6520 3a70 793a 6675  lease see :py:fu
-0001dcd0: 6e63 3a60 7e63 7265 6174 655f 6d61 726b  nc:`~create_mark
-0001dce0: 6574 706c 6163 655f 736f 7572 6365 602e  etplace_source`.
-0001dcf0: 2054 6869 7320 6d65 7468 6f64 2063 616e   This method can
-0001dd00: 2062 6520 7573 6564 2074 6f20 6d6f 6469   be used to modi
-0001dd10: 6679 2074 6865 2073 6f75 7263 6520 6974  fy the source it
-0001dd20: 7365 6c66 206f 7220 6974 730a 2020 2020  self or its.    
-0001dd30: 2020 2020 6f72 6465 7220 696e 2074 6865      order in the
-0001dd40: 206c 6973 7420 6f66 2073 6f75 7263 6573   list of sources
-0001dd50: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0001dd60: 6d20 736f 7572 6365 5f6e 616d 653a 204e  m source_name: N
-0001dd70: 616d 6520 6f66 2074 6865 2073 6f75 7263  ame of the sourc
-0001dd80: 6520 6f62 6a65 6374 2074 6f20 6d6f 6469  e object to modi
-0001dd90: 6679 2f63 7265 6174 652e 2049 7420 6d75  fy/create. It mu
-0001dda0: 7374 206d 6174 6368 2074 6865 2060 6073  st match the ``s
-0001ddb0: 6f75 7263 652e 6d65 7461 6461 7461 2e6e  ource.metadata.n
-0001ddc0: 616d 6560 600a 2020 2020 2020 2020 2020  ame``.          
-0001ddd0: 2020 7061 7261 6d65 7465 7220 696e 2074    parameter in t
-0001dde0: 6865 2073 6f75 7263 6520 6974 7365 6c66  he source itself
-0001ddf0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001de00: 2073 6f75 7263 653a 2053 6f75 7263 6520   source: Source 
-0001de10: 6f62 6a65 6374 2074 6f20 7374 6f72 6520  object to store 
-0001de20: 696e 2074 6865 2064 6174 6162 6173 652e  in the database.
-0001de30: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0001de40: 733a 2054 6865 2073 6f75 7263 6520 6f62  s: The source ob
-0001de50: 6a65 6374 2061 7320 7374 6f72 6564 2069  ject as stored i
-0001de60: 6e20 7468 6520 4442 2e0a 2020 2020 2020  n the DB..      
-0001de70: 2020 2222 220a 2020 2020 2020 2020 7061    """.        pa
-0001de80: 7468 203d 2066 226d 6172 6b65 7470 6c61  th = f"marketpla
-0001de90: 6365 2f73 6f75 7263 6573 2f7b 736f 7572  ce/sources/{sour
-0001dea0: 6365 5f6e 616d 657d 220a 2020 2020 2020  ce_name}".      
-0001deb0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0001dec0: 736f 7572 6365 2c20 7363 6865 6d61 732e  source, schemas.
-0001ded0: 496e 6465 7865 644d 6172 6b65 7470 6c61  IndexedMarketpla
-0001dee0: 6365 536f 7572 6365 293a 0a20 2020 2020  ceSource):.     
-0001def0: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
-0001df00: 736f 7572 6365 2e64 6963 7428 290a 0a20  source.dict().. 
-0001df10: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-0001df20: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0001df30: 6d65 7468 6f64 3d22 5055 5422 2c20 7061  method="PUT", pa
-0001df40: 7468 3d70 6174 682c 206a 736f 6e3d 736f  th=path, json=so
-0001df50: 7572 6365 290a 2020 2020 2020 2020 7265  urce).        re
-0001df60: 7475 726e 2073 6368 656d 6173 2e49 6e64  turn schemas.Ind
-0001df70: 6578 6564 4d61 726b 6574 706c 6163 6553  exedMarketplaceS
-0001df80: 6f75 7263 6528 2a2a 7265 7370 6f6e 7365  ource(**response
-0001df90: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
-0001dfa0: 6620 6c69 7374 5f6d 6172 6b65 7470 6c61  f list_marketpla
-0001dfb0: 6365 5f73 6f75 7263 6573 2873 656c 6629  ce_sources(self)
-0001dfc0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001dfd0: 2020 2020 2020 4c69 7374 206d 6172 6b65        List marke
-0001dfe0: 7470 6c61 6365 2073 6f75 7263 6573 2069  tplace sources i
-0001dff0: 6e20 7468 6520 4d4c 5275 6e20 4442 2e0a  n the MLRun DB..
-0001e000: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001e010: 2020 2020 7061 7468 203d 2022 6d61 726b      path = "mark
-0001e020: 6574 706c 6163 652f 736f 7572 6365 7322  etplace/sources"
-0001e030: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
-0001e040: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
-0001e050: 6c28 6d65 7468 6f64 3d22 4745 5422 2c20  l(method="GET", 
-0001e060: 7061 7468 3d70 6174 6829 2e6a 736f 6e28  path=path).json(
-0001e070: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0001e080: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-0001e090: 6f72 2069 7465 6d20 696e 2072 6573 706f  or item in respo
-0001e0a0: 6e73 653a 0a20 2020 2020 2020 2020 2020  nse:.           
-0001e0b0: 2072 6573 756c 7473 2e61 7070 656e 6428   results.append(
-0001e0c0: 7363 6865 6d61 732e 496e 6465 7865 644d  schemas.IndexedM
-0001e0d0: 6172 6b65 7470 6c61 6365 536f 7572 6365  arketplaceSource
-0001e0e0: 282a 2a69 7465 6d29 290a 2020 2020 2020  (**item)).      
-0001e0f0: 2020 7265 7475 726e 2072 6573 756c 7473    return results
-0001e100: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
-0001e110: 726b 6574 706c 6163 655f 736f 7572 6365  rketplace_source
-0001e120: 2873 656c 662c 2073 6f75 7263 655f 6e61  (self, source_na
-0001e130: 6d65 3a20 7374 7229 3a0a 2020 2020 2020  me: str):.      
-0001e140: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0001e150: 7472 6965 7665 2061 206d 6172 6b65 7470  trieve a marketp
-0001e160: 6c61 6365 2073 6f75 7263 6520 6672 6f6d  lace source from
-0001e170: 2074 6865 2044 422e 0a0a 2020 2020 2020   the DB...      
-0001e180: 2020 3a70 6172 616d 2073 6f75 7263 655f    :param source_
-0001e190: 6e61 6d65 3a20 4e61 6d65 206f 6620 7468  name: Name of th
-0001e1a0: 6520 6d61 726b 6574 706c 6163 6520 736f  e marketplace so
-0001e1b0: 7572 6365 2074 6f20 7265 7472 6965 7665  urce to retrieve
-0001e1c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001e1d0: 2020 2020 2020 7061 7468 203d 2066 226d        path = f"m
-0001e1e0: 6172 6b65 7470 6c61 6365 2f73 6f75 7263  arketplace/sourc
-0001e1f0: 6573 2f7b 736f 7572 6365 5f6e 616d 657d  es/{source_name}
-0001e200: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
-0001e210: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
-0001e220: 6c6c 286d 6574 686f 643d 2247 4554 222c  ll(method="GET",
-0001e230: 2070 6174 683d 7061 7468 290a 2020 2020   path=path).    
-0001e240: 2020 2020 7265 7475 726e 2073 6368 656d      return schem
-0001e250: 6173 2e49 6e64 6578 6564 4d61 726b 6574  as.IndexedMarket
-0001e260: 706c 6163 6553 6f75 7263 6528 2a2a 7265  placeSource(**re
-0001e270: 7370 6f6e 7365 2e6a 736f 6e28 2929 0a0a  sponse.json())..
-0001e280: 2020 2020 6465 6620 6465 6c65 7465 5f6d      def delete_m
-0001e290: 6172 6b65 7470 6c61 6365 5f73 6f75 7263  arketplace_sourc
-0001e2a0: 6528 7365 6c66 2c20 736f 7572 6365 5f6e  e(self, source_n
-0001e2b0: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
-0001e2c0: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
-0001e2d0: 656c 6574 6520 6120 6d61 726b 6574 706c  elete a marketpl
-0001e2e0: 6163 6520 736f 7572 6365 2066 726f 6d20  ace source from 
-0001e2f0: 7468 6520 4442 2e0a 2020 2020 2020 2020  the DB..        
-0001e300: 5468 6520 736f 7572 6365 2077 696c 6c20  The source will 
-0001e310: 6265 2064 656c 6574 6564 2066 726f 6d20  be deleted from 
-0001e320: 7468 6520 6c69 7374 2c20 616e 6420 616e  the list, and an
-0001e330: 7920 666f 6c6c 6f77 696e 6720 736f 7572  y following sour
-0001e340: 6365 7320 7769 6c6c 2062 6520 7072 6f6d  ces will be prom
-0001e350: 6f74 6564 202d 2066 6f72 2065 7861 6d70  oted - for examp
-0001e360: 6c65 2c20 6966 2074 6865 0a20 2020 2020  le, if the.     
-0001e370: 2020 2031 7374 2073 6f75 7263 6520 6973     1st source is
-0001e380: 2064 656c 6574 6564 2c20 7468 6520 326e   deleted, the 2n
-0001e390: 6420 736f 7572 6365 2077 696c 6c20 6265  d source will be
-0001e3a0: 636f 6d65 2023 3120 696e 2074 6865 206c  come #1 in the l
-0001e3b0: 6973 742e 0a20 2020 2020 2020 2054 6865  ist..        The
-0001e3c0: 2067 6c6f 6261 6c20 6d61 726b 6574 706c   global marketpl
-0001e3d0: 6163 6520 736f 7572 6365 2063 616e 6e6f  ace source canno
-0001e3e0: 7420 6265 2064 656c 6574 6564 2e0a 0a20  t be deleted... 
-0001e3f0: 2020 2020 2020 203a 7061 7261 6d20 736f         :param so
-0001e400: 7572 6365 5f6e 616d 653a 204e 616d 6520  urce_name: Name 
-0001e410: 6f66 2074 6865 206d 6172 6b65 7470 6c61  of the marketpla
-0001e420: 6365 2073 6f75 7263 6520 746f 2064 656c  ce source to del
-0001e430: 6574 652e 0a20 2020 2020 2020 2022 2222  ete..        """
-0001e440: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0001e450: 6622 6d61 726b 6574 706c 6163 652f 736f  f"marketplace/so
-0001e460: 7572 6365 732f 7b73 6f75 7263 655f 6e61  urces/{source_na
-0001e470: 6d65 7d22 0a20 2020 2020 2020 2073 656c  me}".        sel
-0001e480: 662e 6170 695f 6361 6c6c 286d 6574 686f  f.api_call(metho
-0001e490: 643d 2244 454c 4554 4522 2c20 7061 7468  d="DELETE", path
-0001e4a0: 3d70 6174 6829 0a0a 2020 2020 6465 6620  =path)..    def 
-0001e4b0: 6765 745f 6d61 726b 6574 706c 6163 655f  get_marketplace_
-0001e4c0: 6361 7461 6c6f 6728 0a20 2020 2020 2020  catalog(.       
-0001e4d0: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-0001e4e0: 6f75 7263 655f 6e61 6d65 3a20 7374 722c  ource_name: str,
-0001e4f0: 0a20 2020 2020 2020 2076 6572 7369 6f6e  .        version
-0001e500: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
-0001e510: 2020 2020 2020 7461 673a 2073 7472 203d        tag: str =
-0001e520: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
-0001e530: 6f72 6365 5f72 6566 7265 7368 3a20 626f  orce_refresh: bo
-0001e540: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0001e550: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001e560: 2020 2020 2020 2052 6574 7269 6576 6520         Retrieve 
-0001e570: 7468 6520 6974 656d 2063 6174 616c 6f67  the item catalog
-0001e580: 2066 6f72 2061 2073 7065 6369 6669 6564   for a specified
-0001e590: 206d 6172 6b65 7470 6c61 6365 2073 6f75   marketplace sou
-0001e5a0: 7263 652e 0a20 2020 2020 2020 2054 6865  rce..        The
-0001e5b0: 206c 6973 7420 6f66 2069 7465 6d73 2063   list of items c
-0001e5c0: 616e 2062 6520 6669 6c74 6572 6564 2061  an be filtered a
-0001e5d0: 6363 6f72 6469 6e67 2074 6f20 7661 7269  ccording to vari
-0001e5e0: 6f75 7320 6669 6c74 6572 732c 2075 7369  ous filters, usi
-0001e5f0: 6e67 2069 7465 6d27 7320 6d65 7461 6461  ng item's metada
-0001e600: 7461 2074 6f20 6669 6c74 6572 2e0a 0a20  ta to filter... 
-0001e610: 2020 2020 2020 203a 7061 7261 6d20 736f         :param so
-0001e620: 7572 6365 5f6e 616d 653a 204e 616d 6520  urce_name: Name 
-0001e630: 6f66 2074 6865 2073 6f75 7263 652e 0a20  of the source.. 
-0001e640: 2020 2020 2020 203a 7061 7261 6d20 7665         :param ve
-0001e650: 7273 696f 6e3a 2046 696c 7465 7220 6974  rsion: Filter it
-0001e660: 656d 7320 6163 636f 7264 696e 6720 746f  ems according to
-0001e670: 2074 6865 6972 2076 6572 7369 6f6e 2e0a   their version..
-0001e680: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-0001e690: 6167 3a20 4669 6c74 6572 2069 7465 6d73  ag: Filter items
-0001e6a0: 2062 6173 6564 206f 6e20 7461 672e 0a20   based on tag.. 
-0001e6b0: 2020 2020 2020 203a 7061 7261 6d20 666f         :param fo
-0001e6c0: 7263 655f 7265 6672 6573 683a 204d 616b  rce_refresh: Mak
-0001e6d0: 6520 7468 6520 7365 7276 6572 2066 6574  e the server fet
-0001e6e0: 6368 2074 6865 2063 6174 616c 6f67 2066  ch the catalog f
-0001e6f0: 726f 6d20 7468 6520 6163 7475 616c 206d  rom the actual m
-0001e700: 6172 6b65 7470 6c61 6365 2073 6f75 7263  arketplace sourc
-0001e710: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
-0001e720: 6174 6865 7220 7468 616e 2072 656c 7920  ather than rely 
-0001e730: 6f6e 2063 6163 6865 6420 696e 666f 726d  on cached inform
-0001e740: 6174 696f 6e20 7768 6963 6820 6d61 7920  ation which may 
-0001e750: 6578 6973 7420 6672 6f6d 2070 7265 7669  exist from previ
-0001e760: 6f75 7320 6765 7420 7265 7175 6573 7473  ous get requests
-0001e770: 2e20 466f 7220 6578 616d 706c 652c 0a20  . For example,. 
-0001e780: 2020 2020 2020 2020 2020 2069 6620 7468             if th
-0001e790: 6520 736f 7572 6365 2077 6173 2072 652d  e source was re-
-0001e7a0: 6275 696c 742c 0a20 2020 2020 2020 2020  built,.         
-0001e7b0: 2020 2074 6869 7320 7769 6c6c 206d 616b     this will mak
-0001e7c0: 6520 7468 6520 7365 7276 6572 2067 6574  e the server get
-0001e7d0: 2074 6865 2075 7064 6174 6564 2069 6e66   the updated inf
-0001e7e0: 6f72 6d61 7469 6f6e 2e20 4465 6661 756c  ormation. Defaul
-0001e7f0: 7420 6973 2060 6046 616c 7365 6060 2e0a  t is ``False``..
-0001e800: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
-0001e810: 3a20 3a70 793a 636c 6173 733a 607e 6d6c  : :py:class:`~ml
-0001e820: 7275 6e2e 6170 692e 7363 6865 6d61 732e  run.api.schemas.
-0001e830: 6d61 726b 6574 706c 6163 652e 4d61 726b  marketplace.Mark
-0001e840: 6574 706c 6163 6543 6174 616c 6f67 6020  etplaceCatalog` 
-0001e850: 6f62 6a65 6374 2c20 7768 6963 6820 6973  object, which is
-0001e860: 2065 7373 656e 7469 616c 6c79 2061 206c   essentially a l
-0001e870: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-0001e880: 6f66 203a 7079 3a63 6c61 7373 3a60 7e6d  of :py:class:`~m
-0001e890: 6c72 756e 2e61 7069 2e73 6368 656d 6173  lrun.api.schemas
-0001e8a0: 2e6d 6172 6b65 7470 6c61 6365 2e4d 6172  .marketplace.Mar
-0001e8b0: 6b65 7470 6c61 6365 4974 656d 6020 656e  ketplaceItem` en
-0001e8c0: 7472 6965 732e 0a20 2020 2020 2020 2022  tries..        "
-0001e8d0: 2222 0a20 2020 2020 2020 2070 6174 6820  "".        path 
-0001e8e0: 3d20 2866 226d 6172 6b65 7470 6c61 6365  = (f"marketplace
-0001e8f0: 2f73 6f75 7263 6573 2f7b 736f 7572 6365  /sources/{source
-0001e900: 5f6e 616d 657d 2f69 7465 6d73 222c 290a  _name}/items",).
-0001e910: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0001e920: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-0001e930: 7665 7273 696f 6e22 3a20 7665 7273 696f  version": versio
-0001e940: 6e2c 0a20 2020 2020 2020 2020 2020 2022  n,.            "
-0001e950: 7461 6722 3a20 7461 672c 0a20 2020 2020  tag": tag,.     
-0001e960: 2020 2020 2020 2022 666f 7263 652d 7265         "force-re
-0001e970: 6672 6573 6822 3a20 666f 7263 655f 7265  fresh": force_re
-0001e980: 6672 6573 682c 0a20 2020 2020 2020 207d  fresh,.        }
-0001e990: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
-0001e9a0: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
-0001e9b0: 6c28 6d65 7468 6f64 3d22 4745 5422 2c20  l(method="GET", 
-0001e9c0: 7061 7468 3d70 6174 682c 2070 6172 616d  path=path, param
-0001e9d0: 733d 7061 7261 6d73 290a 2020 2020 2020  s=params).      
-0001e9e0: 2020 7265 7475 726e 2073 6368 656d 6173    return schemas
-0001e9f0: 2e4d 6172 6b65 7470 6c61 6365 4361 7461  .MarketplaceCata
-0001ea00: 6c6f 6728 2a2a 7265 7370 6f6e 7365 2e6a  log(**response.j
-0001ea10: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
-0001ea20: 6765 745f 6d61 726b 6574 706c 6163 655f  get_marketplace_
-0001ea30: 6974 656d 280a 2020 2020 2020 2020 7365  item(.        se
-0001ea40: 6c66 2c0a 2020 2020 2020 2020 736f 7572  lf,.        sour
-0001ea50: 6365 5f6e 616d 653a 2073 7472 2c0a 2020  ce_name: str,.  
-0001ea60: 2020 2020 2020 6974 656d 5f6e 616d 653a        item_name:
-0001ea70: 2073 7472 2c0a 2020 2020 2020 2020 7665   str,.        ve
-0001ea80: 7273 696f 6e3a 2073 7472 203d 204e 6f6e  rsion: str = Non
-0001ea90: 652c 0a20 2020 2020 2020 2074 6167 3a20  e,.        tag: 
-0001eaa0: 7374 7220 3d20 226c 6174 6573 7422 2c0a  str = "latest",.
-0001eab0: 2020 2020 2020 2020 666f 7263 655f 7265          force_re
-0001eac0: 6672 6573 683a 2062 6f6f 6c20 3d20 4661  fresh: bool = Fa
-0001ead0: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
-0001eae0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001eaf0: 5265 7472 6965 7665 2061 2073 7065 6369  Retrieve a speci
-0001eb00: 6669 6320 6d61 726b 6574 706c 6163 6520  fic marketplace 
-0001eb10: 6974 656d 2e0a 0a20 2020 2020 2020 203a  item...        :
-0001eb20: 7061 7261 6d20 736f 7572 6365 5f6e 616d  param source_nam
-0001eb30: 653a 204e 616d 6520 6f66 2073 6f75 7263  e: Name of sourc
-0001eb40: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0001eb50: 6d20 6974 656d 5f6e 616d 653a 204e 616d  m item_name: Nam
-0001eb60: 6520 6f66 2074 6865 2069 7465 6d20 746f  e of the item to
-0001eb70: 2072 6574 7269 6576 652c 2061 7320 6974   retrieve, as it
-0001eb80: 2061 7070 6561 7273 2069 6e20 7468 6520   appears in the 
-0001eb90: 6361 7461 6c6f 672e 0a20 2020 2020 2020  catalog..       
-0001eba0: 203a 7061 7261 6d20 7665 7273 696f 6e3a   :param version:
-0001ebb0: 2047 6574 2061 2073 7065 6369 6669 6320   Get a specific 
-0001ebc0: 7665 7273 696f 6e20 6f66 2074 6865 2069  version of the i
-0001ebd0: 7465 6d2e 2044 6566 6175 6c74 2069 7320  tem. Default is 
-0001ebe0: 6060 4e6f 6e65 6060 2e0a 2020 2020 2020  ``None``..      
-0001ebf0: 2020 3a70 6172 616d 2074 6167 3a20 4765    :param tag: Ge
-0001ec00: 7420 6120 7370 6563 6966 6963 2076 6572  t a specific ver
-0001ec10: 7369 6f6e 206f 6620 7468 6520 6974 656d  sion of the item
-0001ec20: 2069 6465 6e74 6966 6965 6420 6279 2074   identified by t
-0001ec30: 6167 2e20 4465 6661 756c 7420 6973 2060  ag. Default is `
-0001ec40: 606c 6174 6573 7460 602e 0a20 2020 2020  `latest``..     
-0001ec50: 2020 203a 7061 7261 6d20 666f 7263 655f     :param force_
-0001ec60: 7265 6672 6573 683a 204d 616b 6520 7468  refresh: Make th
-0001ec70: 6520 7365 7276 6572 2066 6574 6368 2074  e server fetch t
-0001ec80: 6865 2069 6e66 6f72 6d61 7469 6f6e 2066  he information f
-0001ec90: 726f 6d20 7468 6520 6163 7475 616c 206d  rom the actual m
-0001eca0: 6172 6b65 7470 6c61 6365 0a20 2020 2020  arketplace.     
-0001ecb0: 2020 2020 2020 2073 6f75 7263 652c 2072         source, r
-0001ecc0: 6174 6865 7220 7468 616e 0a20 2020 2020  ather than.     
-0001ecd0: 2020 2020 2020 2072 656c 7920 6f6e 2063         rely on c
-0001ece0: 6163 6865 6420 696e 666f 726d 6174 696f  ached informatio
-0001ecf0: 6e2e 2044 6566 6175 6c74 2069 7320 6060  n. Default is ``
-0001ed00: 4661 6c73 6560 602e 0a20 2020 2020 2020  False``..       
-0001ed10: 203a 7265 7475 726e 733a 203a 7079 3a63   :returns: :py:c
-0001ed20: 6c61 7373 3a60 7e6d 6c72 756e 2e61 7069  lass:`~mlrun.api
-0001ed30: 2e73 6368 656d 6173 2e6d 6172 6b65 7470  .schemas.marketp
-0001ed40: 6c61 6365 2e4d 6172 6b65 7470 6c61 6365  lace.Marketplace
-0001ed50: 4974 656d 602e 0a20 2020 2020 2020 2022  Item`..        "
-0001ed60: 2222 0a20 2020 2020 2020 2070 6174 6820  "".        path 
-0001ed70: 3d20 2866 226d 6172 6b65 7470 6c61 6365  = (f"marketplace
-0001ed80: 2f73 6f75 7263 6573 2f7b 736f 7572 6365  /sources/{source
-0001ed90: 5f6e 616d 657d 2f69 7465 6d73 2f7b 6974  _name}/items/{it
-0001eda0: 656d 5f6e 616d 657d 222c 290a 2020 2020  em_name}",).    
-0001edb0: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
-0001edc0: 2020 2020 2020 2020 2020 2022 7665 7273             "vers
-0001edd0: 696f 6e22 3a20 7665 7273 696f 6e2c 0a20  ion": version,. 
-0001ede0: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
-0001edf0: 3a20 7461 672c 0a20 2020 2020 2020 2020  : tag,.         
-0001ee00: 2020 2022 666f 7263 652d 7265 6672 6573     "force-refres
-0001ee10: 6822 3a20 666f 7263 655f 7265 6672 6573  h": force_refres
-0001ee20: 682c 0a20 2020 2020 2020 207d 0a20 2020  h,.        }.   
-0001ee30: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-0001ee40: 7365 6c66 2e61 7069 5f63 616c 6c28 6d65  self.api_call(me
-0001ee50: 7468 6f64 3d22 4745 5422 2c20 7061 7468  thod="GET", path
-0001ee60: 3d70 6174 682c 2070 6172 616d 733d 7061  =path, params=pa
-0001ee70: 7261 6d73 290a 2020 2020 2020 2020 7265  rams).        re
-0001ee80: 7475 726e 2073 6368 656d 6173 2e4d 6172  turn schemas.Mar
-0001ee90: 6b65 7470 6c61 6365 4974 656d 282a 2a72  ketplaceItem(**r
-0001eea0: 6573 706f 6e73 652e 6a73 6f6e 2829 290a  esponse.json()).
-0001eeb0: 0a20 2020 2064 6566 2067 6574 5f6d 6172  .    def get_mar
-0001eec0: 6b65 7470 6c61 6365 5f61 7373 6574 280a  ketplace_asset(.
-0001eed0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001eee0: 2020 2020 2020 736f 7572 6365 5f6e 616d        source_nam
-0001eef0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-0001ef00: 6974 656d 5f6e 616d 653a 2073 7472 2c0a  item_name: str,.
-0001ef10: 2020 2020 2020 2020 6173 7365 745f 6e61          asset_na
-0001ef20: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-0001ef30: 2076 6572 7369 6f6e 3a20 7374 7220 3d20   version: str = 
-0001ef40: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
-0001ef50: 673a 2073 7472 203d 2022 6c61 7465 7374  g: str = "latest
-0001ef60: 222c 0a20 2020 2029 3a0a 2020 2020 2020  ",.    ):.      
-0001ef70: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-0001ef80: 7420 6d61 726b 6574 706c 6163 6520 6173  t marketplace as
-0001ef90: 7365 7420 6672 6f6d 2069 7465 6d2e 0a0a  set from item...
-0001efa0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0001efb0: 6f75 7263 655f 6e61 6d65 3a20 4e61 6d65  ource_name: Name
-0001efc0: 206f 6620 736f 7572 6365 2e0a 2020 2020   of source..    
-0001efd0: 2020 2020 3a70 6172 616d 2069 7465 6d5f      :param item_
-0001efe0: 6e61 6d65 3a20 2020 4e61 6d65 206f 6620  name:   Name of 
-0001eff0: 7468 6520 6974 656d 2077 6869 6368 2068  the item which h
-0001f000: 6f6c 6473 2074 6865 2061 7373 6574 2e0a  olds the asset..
-0001f010: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0001f020: 7373 6574 5f6e 616d 653a 2020 4e61 6d65  sset_name:  Name
-0001f030: 206f 6620 7468 6520 6173 7365 7420 746f   of the asset to
-0001f040: 2072 6574 7269 6576 652e 0a20 2020 2020   retrieve..     
-0001f050: 2020 203a 7061 7261 6d20 7665 7273 696f     :param versio
-0001f060: 6e3a 2047 6574 2061 2073 7065 6369 6669  n: Get a specifi
-0001f070: 6320 7665 7273 696f 6e20 6f66 2074 6865  c version of the
-0001f080: 2069 7465 6d2e 2044 6566 6175 6c74 2069   item. Default i
-0001f090: 7320 6060 4e6f 6e65 6060 2e0a 2020 2020  s ``None``..    
-0001f0a0: 2020 2020 3a70 6172 616d 2074 6167 3a20      :param tag: 
-0001f0b0: 4765 7420 6120 7370 6563 6966 6963 2076  Get a specific v
-0001f0c0: 6572 7369 6f6e 206f 6620 7468 6520 6974  ersion of the it
-0001f0d0: 656d 2069 6465 6e74 6966 6965 6420 6279  em identified by
-0001f0e0: 2074 6167 2e20 4465 6661 756c 7420 6973   tag. Default is
-0001f0f0: 2060 606c 6174 6573 7460 602e 0a0a 2020   ``latest``...  
-0001f100: 2020 2020 2020 3a72 6574 7572 6e3a 2068        :return: h
-0001f110: 7474 7020 7265 7370 6f6e 7365 2077 6974  ttp response wit
-0001f120: 6820 7468 6520 6173 7365 7420 696e 2074  h the asset in t
-0001f130: 6865 2063 6f6e 7465 6e74 2061 7474 7269  he content attri
-0001f140: 6275 7465 0a20 2020 2020 2020 2022 2222  bute.        """
-0001f150: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0001f160: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
-0001f170: 6d61 726b 6574 706c 6163 652f 736f 7572  marketplace/sour
-0001f180: 6365 732f 7b73 6f75 7263 655f 6e61 6d65  ces/{source_name
-0001f190: 7d2f 6974 656d 732f 7b69 7465 6d5f 6e61  }/items/{item_na
-0001f1a0: 6d65 7d2f 6173 7365 7473 2f7b 6173 7365  me}/assets/{asse
-0001f1b0: 745f 6e61 6d65 7d22 2c0a 2020 2020 2020  t_name}",.      
-0001f1c0: 2020 290a 2020 2020 2020 2020 7061 7261    ).        para
-0001f1d0: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
-0001f1e0: 2020 2022 7665 7273 696f 6e22 3a20 7665     "version": ve
-0001f1f0: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
-0001f200: 2020 2022 7461 6722 3a20 7461 672c 0a20     "tag": tag,. 
-0001f210: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0001f220: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
-0001f230: 2e61 7069 5f63 616c 6c28 6d65 7468 6f64  .api_call(method
-0001f240: 3d22 4745 5422 2c20 7061 7468 3d70 6174  ="GET", path=pat
-0001f250: 682c 2070 6172 616d 733d 7061 7261 6d73  h, params=params
-0001f260: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001f270: 2072 6573 706f 6e73 650a 0a20 2020 2064   response..    d
-0001f280: 6566 2076 6572 6966 795f 6175 7468 6f72  ef verify_author
-0001f290: 697a 6174 696f 6e28 0a20 2020 2020 2020  ization(.       
-0001f2a0: 2073 656c 662c 2061 7574 686f 7269 7a61   self, authoriza
-0001f2b0: 7469 6f6e 5f76 6572 6966 6963 6174 696f  tion_verificatio
-0001f2c0: 6e5f 696e 7075 743a 2073 6368 656d 6173  n_input: schemas
-0001f2d0: 2e41 7574 686f 7269 7a61 7469 6f6e 5665  .AuthorizationVe
-0001f2e0: 7269 6669 6361 7469 6f6e 496e 7075 740a  rificationInput.
-0001f2f0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0001f300: 2222 5665 7269 6669 6573 2061 7574 686f  ""Verifies autho
-0001f310: 7269 7a61 7469 6f6e 2066 6f72 2074 6865  rization for the
-0001f320: 2070 726f 7669 6465 6420 6163 7469 6f6e   provided action
-0001f330: 206f 6e20 7468 6520 7072 6f76 6964 6564   on the provided
-0001f340: 2072 6573 6f75 7263 652e 0a0a 2020 2020   resource...    
-0001f350: 2020 2020 3a70 6172 616d 2061 7574 686f      :param autho
-0001f360: 7269 7a61 7469 6f6e 5f76 6572 6966 6963  rization_verific
-0001f370: 6174 696f 6e5f 696e 7075 743a 2049 6e73  ation_input: Ins
-0001f380: 7461 6e63 6520 6f66 0a20 2020 2020 2020  tance of.       
-0001f390: 2020 2020 203a 7079 3a63 6c61 7373 3a60       :py:class:`
-0001f3a0: 7e6d 6c72 756e 2e61 7069 2e73 6368 656d  ~mlrun.api.schem
-0001f3b0: 6173 2e41 7574 686f 7269 7a61 7469 6f6e  as.Authorization
-0001f3c0: 5665 7269 6669 6361 7469 6f6e 496e 7075  VerificationInpu
-0001f3d0: 7460 2074 6861 7420 696e 636c 7564 6573  t` that includes
-0001f3e0: 2061 6c6c 2074 6865 206e 6565 6465 6420   all the needed 
-0001f3f0: 7061 7261 6d65 7465 7273 2066 6f72 0a20  parameters for. 
-0001f400: 2020 2020 2020 2020 2020 2074 6865 2061             the a
-0001f410: 7574 6820 7665 7269 6669 6361 7469 6f6e  uth verification
-0001f420: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001f430: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-0001f440: 6765 203d 2022 4175 7468 6f72 697a 6174  ge = "Authorizat
-0001f450: 696f 6e20 6368 6563 6b20 6661 696c 6564  ion check failed
-0001f460: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-0001f470: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-0001f480: 2020 2020 2022 504f 5354 222c 0a20 2020       "POST",.   
-0001f490: 2020 2020 2020 2020 2022 6175 7468 6f72           "author
-0001f4a0: 697a 6174 696f 6e2f 7665 7269 6669 6361  ization/verifica
-0001f4b0: 7469 6f6e 7322 2c0a 2020 2020 2020 2020  tions",.        
-0001f4c0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
-0001f4d0: 652c 0a20 2020 2020 2020 2020 2020 2062  e,.            b
-0001f4e0: 6f64 793d 6469 6374 5f74 6f5f 6a73 6f6e  ody=dict_to_json
-0001f4f0: 2861 7574 686f 7269 7a61 7469 6f6e 5f76  (authorization_v
-0001f500: 6572 6966 6963 6174 696f 6e5f 696e 7075  erification_inpu
-0001f510: 742e 6469 6374 2829 292c 0a20 2020 2020  t.dict()),.     
-0001f520: 2020 2029 0a0a 2020 2020 6465 6620 7472     )..    def tr
-0001f530: 6967 6765 725f 6d69 6772 6174 696f 6e73  igger_migrations
-0001f540: 2873 656c 6629 202d 3e20 4f70 7469 6f6e  (self) -> Option
-0001f550: 616c 5b73 6368 656d 6173 2e42 6163 6b67  al[schemas.Backg
-0001f560: 726f 756e 6454 6173 6b5d 3a0a 2020 2020  roundTask]:.    
-0001f570: 2020 2020 2222 2254 7269 6767 6572 206d      """Trigger m
-0001f580: 6967 7261 7469 6f6e 7320 2877 696c 6c20  igrations (will 
-0001f590: 646f 206e 6f74 6869 6e67 2069 6620 6e6f  do nothing if no
-0001f5a0: 206d 6967 7261 7469 6f6e 7320 6172 6520   migrations are 
-0001f5b0: 6e65 6564 6564 2920 616e 6420 7761 6974  needed) and wait
-0001f5c0: 2066 6f72 2074 6865 6d20 746f 2066 696e   for them to fin
-0001f5d0: 6973 6820 6966 2061 6374 7561 6c6c 790a  ish if actually.
-0001f5e0: 2020 2020 2020 2020 7472 6967 6765 7265          triggere
-0001f5f0: 640a 2020 2020 2020 2020 3a72 6574 7572  d.        :retur
-0001f600: 6e73 3a20 3a70 793a 636c 6173 733a 607e  ns: :py:class:`~
-0001f610: 6d6c 7275 6e2e 6170 692e 7363 6865 6d61  mlrun.api.schema
-0001f620: 732e 4261 636b 6772 6f75 6e64 5461 736b  s.BackgroundTask
-0001f630: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
-0001f640: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-0001f650: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0001f660: 0a20 2020 2020 2020 2020 2020 2022 504f  .            "PO
-0001f670: 5354 222c 0a20 2020 2020 2020 2020 2020  ST",.           
-0001f680: 2022 6f70 6572 6174 696f 6e73 2f6d 6967   "operations/mig
-0001f690: 7261 7469 6f6e 7322 2c0a 2020 2020 2020  rations",.      
-0001f6a0: 2020 2020 2020 2246 6169 6c65 6420 7472        "Failed tr
-0001f6b0: 6967 6765 7269 6e67 206d 6967 7261 7469  iggering migrati
-0001f6c0: 6f6e 7322 2c0a 2020 2020 2020 2020 290a  ons",.        ).
-0001f6d0: 2020 2020 2020 2020 6966 2072 6573 706f          if respo
-0001f6e0: 6e73 652e 7374 6174 7573 5f63 6f64 6520  nse.status_code 
-0001f6f0: 3d3d 2068 7474 702e 4854 5450 5374 6174  == http.HTTPStat
-0001f700: 7573 2e41 4343 4550 5445 443a 0a20 2020  us.ACCEPTED:.   
-0001f710: 2020 2020 2020 2020 2062 6163 6b67 726f           backgro
-0001f720: 756e 645f 7461 736b 203d 2073 6368 656d  und_task = schem
-0001f730: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
-0001f740: 6b28 2a2a 7265 7370 6f6e 7365 2e6a 736f  k(**response.jso
-0001f750: 6e28 2929 0a20 2020 2020 2020 2020 2020  n()).           
-0001f760: 2072 6574 7572 6e20 7365 6c66 2e5f 7761   return self._wa
-0001f770: 6974 5f66 6f72 5f62 6163 6b67 726f 756e  it_for_backgroun
-0001f780: 645f 7461 736b 5f74 6f5f 7265 6163 685f  d_task_to_reach_
-0001f790: 7465 726d 696e 616c 5f73 7461 7465 280a  terminal_state(.
-0001f7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7b0: 6261 636b 6772 6f75 6e64 5f74 6173 6b2e  background_task.
-0001f7c0: 6d65 7461 6461 7461 2e6e 616d 650a 2020  metadata.name.  
-0001f7d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001f7e0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0001f7f0: 0a0a 6465 6620 5f61 735f 6a73 6f6e 286f  ..def _as_json(o
-0001f800: 626a 293a 0a20 2020 2066 6e20 3d20 6765  bj):.    fn = ge
-0001f810: 7461 7474 7228 6f62 6a2c 2022 746f 5f6a  tattr(obj, "to_j
-0001f820: 736f 6e22 2c20 4e6f 6e65 290a 2020 2020  son", None).    
-0001f830: 6966 2066 6e3a 0a20 2020 2020 2020 2072  if fn:.        r
-0001f840: 6574 7572 6e20 666e 2829 0a20 2020 2072  eturn fn().    r
-0001f850: 6574 7572 6e20 6469 6374 5f74 6f5f 6a73  eturn dict_to_js
-0001f860: 6f6e 286f 626a 290a                      on(obj).
+0001d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5b0: 6174 7472 6962 7574 6573 203d 207b 6063  attributes = {`c
+0001d5c0: 7572 7265 6e74 5f73 7461 7473 603a 206a  urrent_stats`: j
+0001d5d0: 736f 6e2e 6475 6d70 7328 6375 7272 656e  son.dumps(curren
+0001d5e0: 745f 7374 6174 7329 2c0a 2020 2020 2020  t_stats),.      
+0001d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d610: 2020 2020 2020 2020 6064 7269 6674 5f73          `drift_s
+0001d620: 7461 7475 7360 3a20 2244 5249 4654 5f44  tatus`: "DRIFT_D
+0001d630: 4554 4543 5445 4422 7d0a 0a20 2020 2020  ETECTED"}..     
+0001d640: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0001d650: 6174 7472 6962 7574 6573 203d 207b 2261  attributes = {"a
+0001d660: 7474 7269 6275 7465 7322 3a20 5f61 735f  ttributes": _as_
+0001d670: 6a73 6f6e 2861 7474 7269 6275 7465 7329  json(attributes)
+0001d680: 7d0a 2020 2020 2020 2020 7061 7468 203d  }.        path =
+0001d690: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0001d6a0: 6a65 6374 7d2f 6d6f 6465 6c2d 656e 6470  ject}/model-endp
+0001d6b0: 6f69 6e74 732f 7b65 6e64 706f 696e 745f  oints/{endpoint_
+0001d6c0: 6964 7d22 0a20 2020 2020 2020 2073 656c  id}".        sel
+0001d6d0: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+0001d6e0: 2020 2020 2020 2020 6d65 7468 6f64 3d22          method="
+0001d6f0: 5041 5443 4822 2c0a 2020 2020 2020 2020  PATCH",.        
+0001d700: 2020 2020 7061 7468 3d70 6174 682c 0a20      path=path,. 
+0001d710: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0001d720: 733d 6174 7472 6962 7574 6573 2c0a 2020  s=attributes,.  
+0001d730: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0001d740: 2063 7265 6174 655f 6875 625f 736f 7572   create_hub_sour
+0001d750: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
+0001d760: 2c20 736f 7572 6365 3a20 556e 696f 6e5b  , source: Union[
+0001d770: 6469 6374 2c20 6d6c 7275 6e2e 636f 6d6d  dict, mlrun.comm
+0001d780: 6f6e 2e73 6368 656d 6173 2e49 6e64 6578  on.schemas.Index
+0001d790: 6564 4875 6253 6f75 7263 655d 0a20 2020  edHubSource].   
+0001d7a0: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
+0001d7b0: 2020 2020 2020 2020 4164 6420 6120 6e65          Add a ne
+0001d7c0: 7720 6875 6220 736f 7572 6365 2e0a 0a20  w hub source... 
+0001d7d0: 2020 2020 2020 204d 4c52 756e 206d 6169         MLRun mai
+0001d7e0: 6e74 6169 6e73 2061 6e20 6f72 6465 7265  ntains an ordere
+0001d7f0: 6420 6c69 7374 206f 6620 6875 6220 736f  d list of hub so
+0001d800: 7572 6365 7320 28e2 809c 736f 7572 6365  urces (...source
+0001d810: 73e2 809d 2920 4561 6368 2073 6f75 7263  s...) Each sourc
+0001d820: 6520 6861 730a 2020 2020 2020 2020 6974  e has.        it
+0001d830: 7320 6465 7461 696c 7320 7265 6769 7374  s details regist
+0001d840: 6572 6564 2061 6e64 2069 7473 206f 7264  ered and its ord
+0001d850: 6572 2077 6974 6869 6e20 7468 6520 6c69  er within the li
+0001d860: 7374 2e20 5768 656e 2063 7265 6174 696e  st. When creatin
+0001d870: 6720 6120 6e65 7720 736f 7572 6365 2c20  g a new source, 
+0001d880: 7468 6520 7370 6563 6961 6c20 6f72 6465  the special orde
+0001d890: 7220 6060 2d31 6060 0a20 2020 2020 2020  r ``-1``.       
+0001d8a0: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
+0001d8b0: 6d61 726b 2074 6869 7320 736f 7572 6365  mark this source
+0001d8c0: 2061 7320 6c61 7374 2069 6e20 7468 6520   as last in the 
+0001d8d0: 6c69 7374 2e20 486f 7765 7665 722c 206f  list. However, o
+0001d8e0: 6e63 6520 7468 6520 736f 7572 6365 2069  nce the source i
+0001d8f0: 7320 696e 2074 6865 204d 4c52 756e 206c  s in the MLRun l
+0001d900: 6973 742c 0a20 2020 2020 2020 2069 7473  ist,.        its
+0001d910: 206f 7264 6572 2077 696c 6c20 616c 7761   order will alwa
+0001d920: 7973 2062 6520 6060 3e30 6060 2e0a 0a20  ys be ``>0``... 
+0001d930: 2020 2020 2020 2054 6865 2067 6c6f 6261         The globa
+0001d940: 6c20 6875 6220 736f 7572 6365 2061 6c77  l hub source alw
+0001d950: 6179 7320 6578 6973 7473 2069 6e20 7468  ays exists in th
+0001d960: 6520 6c69 7374 2c20 616e 6420 6973 2061  e list, and is a
+0001d970: 6c77 6179 7320 7468 6520 6c61 7374 2073  lways the last s
+0001d980: 6f75 7263 650a 2020 2020 2020 2020 2860  ource.        (`
+0001d990: 606f 7264 6572 203d 202d 3160 6029 2e20  `order = -1``). 
+0001d9a0: 4974 2063 616e 6e6f 7420 6265 206d 6f64  It cannot be mod
+0001d9b0: 6966 6965 6420 6e6f 7220 6361 6e20 6974  ified nor can it
+0001d9c0: 2062 6520 6d6f 7665 6420 746f 2061 6e6f   be moved to ano
+0001d9d0: 7468 6572 206f 7264 6572 2069 6e20 7468  ther order in th
+0001d9e0: 6520 6c69 7374 2e0a 0a20 2020 2020 2020  e list...       
+0001d9f0: 2054 6865 2073 6f75 7263 6520 6f62 6a65   The source obje
+0001da00: 6374 206d 6179 2063 6f6e 7461 696e 2063  ct may contain c
+0001da10: 7265 6465 6e74 6961 6c73 2077 6869 6368  redentials which
+0001da20: 2061 7265 206e 6565 6465 6420 746f 2061   are needed to a
+0001da30: 6363 6573 7320 7468 6520 6461 7461 7374  ccess the datast
+0001da40: 6f72 6520 7768 6572 6520 7468 6520 736f  ore where the so
+0001da50: 7572 6365 2069 7320 7374 6f72 6564 2e0a  urce is stored..
+0001da60: 2020 2020 2020 2020 5468 6573 6520 6372          These cr
+0001da70: 6564 656e 7469 616c 7320 6172 6520 6e6f  edentials are no
+0001da80: 7420 6b65 7074 2069 6e20 7468 6520 4d4c  t kept in the ML
+0001da90: 5275 6e20 4442 2c20 6275 7420 6172 6520  Run DB, but are 
+0001daa0: 7374 6f72 6564 2069 6e73 6964 6520 6120  stored inside a 
+0001dab0: 6b75 6265 726e 6574 6573 2073 6563 7265  kubernetes secre
+0001dac0: 7420 6f62 6a65 6374 206d 6169 6e74 6169  t object maintai
+0001dad0: 6e65 6420 6279 0a20 2020 2020 2020 204d  ned by.        M
+0001dae0: 4c52 756e 2e20 5468 6579 2061 7265 206e  LRun. They are n
+0001daf0: 6f74 2072 6574 7572 6e65 6420 7468 726f  ot returned thro
+0001db00: 7567 6820 616e 7920 4150 4920 6672 6f6d  ugh any API from
+0001db10: 204d 4c52 756e 2e0a 0a20 2020 2020 2020   MLRun...       
+0001db20: 2045 7861 6d70 6c65 3a3a 0a0a 2020 2020   Example::..    
+0001db30: 2020 2020 2020 2020 696d 706f 7274 206d          import m
+0001db40: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001db50: 6d61 730a 0a20 2020 2020 2020 2020 2020  mas..           
+0001db60: 2023 2041 6464 2061 2070 7269 7661 7465   # Add a private
+0001db70: 2073 6f75 7263 6520 6173 2074 6865 206c   source as the l
+0001db80: 6173 7420 6f6e 6520 2877 696c 6c20 6265  ast one (will be
+0001db90: 2023 3120 696e 2074 6865 206c 6973 7429   #1 in the list)
+0001dba0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001dbb0: 7661 7465 5f73 6f75 7263 6520 3d20 6d6c  vate_source = ml
+0001dbc0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001dbd0: 6173 2e49 6e64 6578 6564 4875 6265 536f  as.IndexedHubeSo
+0001dbe0: 7572 6365 280a 2020 2020 2020 2020 2020  urce(.          
+0001dbf0: 2020 2020 2020 6f72 6465 723d 2d31 2c0a        order=-1,.
+0001dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc10: 736f 7572 6365 3d6d 6c72 756e 2e63 6f6d  source=mlrun.com
+0001dc20: 6d6f 6e2e 7363 6865 6d61 732e 4875 6253  mon.schemas.HubS
+0001dc30: 6f75 7263 6528 0a20 2020 2020 2020 2020  ource(.         
+0001dc40: 2020 2020 2020 2020 2020 206d 6574 6164             metad
+0001dc50: 6174 613d 6d6c 7275 6e2e 636f 6d6d 6f6e  ata=mlrun.common
+0001dc60: 2e73 6368 656d 6173 2e48 7562 4f62 6a65  .schemas.HubObje
+0001dc70: 6374 4d65 7461 6461 7461 280a 2020 2020  ctMetadata(.    
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc90: 2020 2020 6e61 6d65 3d22 7072 6976 222c      name="priv",
+0001dca0: 2064 6573 6372 6970 7469 6f6e 3d22 6120   description="a 
+0001dcb0: 7072 6976 6174 6520 736f 7572 6365 220a  private source".
+0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcd0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0001dce0: 2020 2020 2020 2020 2020 2073 7065 633d             spec=
+0001dcf0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0001dd00: 656d 6173 2e48 7562 536f 7572 6365 5370  emas.HubSourceSp
+0001dd10: 6563 2870 6174 683d 222f 6c6f 6361 6c2f  ec(path="/local/
+0001dd20: 7061 7468 2f74 6f2f 736f 7572 6365 222c  path/to/source",
+0001dd30: 2063 6861 6e6e 656c 3d22 6465 7665 6c6f   channel="develo
+0001dd40: 706d 656e 7422 290a 2020 2020 2020 2020  pment").        
+0001dd50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001dd60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001dd70: 2020 2020 6462 2e63 7265 6174 655f 6875      db.create_hu
+0001dd80: 625f 736f 7572 6365 2870 7269 7661 7465  b_source(private
+0001dd90: 5f73 6f75 7263 6529 0a0a 2020 2020 2020  _source)..      
+0001dda0: 2020 2020 2020 2320 4164 6420 616e 6f74        # Add anot
+0001ddb0: 6865 7220 736f 7572 6365 2061 7320 3173  her source as 1s
+0001ddc0: 7420 696e 2074 6865 206c 6973 7420 2d20  t in the list - 
+0001ddd0: 7769 6c6c 2070 7573 6820 7072 6576 696f  will push previo
+0001dde0: 7573 206f 6e65 2074 6f20 6265 2023 320a  us one to be #2.
+0001ddf0: 2020 2020 2020 2020 2020 2020 616e 6f74              anot
+0001de00: 6865 725f 736f 7572 6365 203d 206d 6c72  her_source = mlr
+0001de10: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001de20: 732e 496e 6465 7865 6448 7562 536f 7572  s.IndexedHubSour
+0001de30: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0001de40: 2020 2020 6f72 6465 723d 312c 0a20 2020      order=1,.   
+0001de50: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
+0001de60: 7263 653d 6d6c 7275 6e2e 636f 6d6d 6f6e  rce=mlrun.common
+0001de70: 2e73 6368 656d 6173 2e48 7562 536f 7572  .schemas.HubSour
+0001de80: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0001de90: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+0001dea0: 3d6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  =mlrun.common.sc
+0001deb0: 6865 6d61 732e 4875 624f 626a 6563 744d  hemas.HubObjectM
+0001dec0: 6574 6164 6174 6128 0a20 2020 2020 2020  etadata(.       
+0001ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dee0: 206e 616d 653d 2270 7269 762d 3222 2c20   name="priv-2", 
+0001def0: 6465 7363 7269 7074 696f 6e3d 2261 6e6f  description="ano
+0001df00: 7468 6572 2073 6f75 7263 6522 0a20 2020  ther source".   
+0001df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df20: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0001df30: 2020 2020 2020 2020 7370 6563 3d6d 6c72          spec=mlr
+0001df40: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001df50: 732e 4875 6253 6f75 7263 6553 7065 6328  s.HubSourceSpec(
+0001df60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001df70: 2020 2020 2020 2020 2070 6174 683d 222f           path="/
+0001df80: 6c6f 6361 6c2f 7061 7468 2f74 6f2f 736f  local/path/to/so
+0001df90: 7572 6365 2f32 222c 0a20 2020 2020 2020  urce/2",.       
+0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfb0: 2063 6861 6e6e 656c 3d22 6465 7665 6c6f   channel="develo
+0001dfc0: 706d 656e 7422 2c0a 2020 2020 2020 2020  pment",.        
+0001dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfe0: 6372 6564 656e 7469 616c 733d 7b2e 2e2e  credentials={...
+0001dff0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0001e000: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001e010: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001e020: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001e030: 2020 2020 6462 2e63 7265 6174 655f 6875      db.create_hu
+0001e040: 625f 736f 7572 6365 2861 6e6f 7468 6572  b_source(another
+0001e050: 5f73 6f75 7263 6529 0a0a 2020 2020 2020  _source)..      
+0001e060: 2020 3a70 6172 616d 2073 6f75 7263 653a    :param source:
+0001e070: 2054 6865 2073 6f75 7263 6520 616e 6420   The source and 
+0001e080: 6974 7320 6f72 6465 722c 206f 6620 7479  its order, of ty
+0001e090: 7065 0a20 2020 2020 2020 2020 2020 203a  pe.            :
+0001e0a0: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
+0001e0b0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0001e0c0: 6875 622e 496e 6465 7865 6448 7562 536f  hub.IndexedHubSo
+0001e0d0: 7572 6365 602c 206f 7220 696e 2064 6963  urce`, or in dic
+0001e0e0: 7469 6f6e 6172 7920 666f 726d 2e0a 2020  tionary form..  
+0001e0f0: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+0001e100: 5468 6520 736f 7572 6365 206f 626a 6563  The source objec
+0001e110: 7420 6173 2069 6e73 6572 7465 6420 696e  t as inserted in
+0001e120: 746f 2074 6865 2064 6174 6162 6173 652c  to the database,
+0001e130: 2077 6974 6820 6372 6564 656e 7469 616c   with credential
+0001e140: 7320 7374 7269 7070 6564 2e0a 2020 2020  s stripped..    
+0001e150: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001e160: 7061 7468 203d 2022 6875 622f 736f 7572  path = "hub/sour
+0001e170: 6365 7322 0a20 2020 2020 2020 2069 6620  ces".        if 
+0001e180: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
+0001e190: 652c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  e, mlrun.common.
+0001e1a0: 7363 6865 6d61 732e 496e 6465 7865 6448  schemas.IndexedH
+0001e1b0: 7562 536f 7572 6365 293a 0a20 2020 2020  ubSource):.     
+0001e1c0: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
+0001e1d0: 736f 7572 6365 2e64 6963 7428 290a 2020  source.dict().  
+0001e1e0: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
+0001e1f0: 2073 656c 662e 6170 695f 6361 6c6c 286d   self.api_call(m
+0001e200: 6574 686f 643d 2250 4f53 5422 2c20 7061  ethod="POST", pa
+0001e210: 7468 3d70 6174 682c 206a 736f 6e3d 736f  th=path, json=so
+0001e220: 7572 6365 290a 2020 2020 2020 2020 7265  urce).        re
+0001e230: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
+0001e240: 6e2e 7363 6865 6d61 732e 496e 6465 7865  n.schemas.Indexe
+0001e250: 6448 7562 536f 7572 6365 282a 2a72 6573  dHubSource(**res
+0001e260: 706f 6e73 652e 6a73 6f6e 2829 290a 0a20  ponse.json()).. 
+0001e270: 2020 2064 6566 2073 746f 7265 5f68 7562     def store_hub
+0001e280: 5f73 6f75 7263 6528 0a20 2020 2020 2020  _source(.       
+0001e290: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
+0001e2a0: 6f75 7263 655f 6e61 6d65 3a20 7374 722c  ource_name: str,
+0001e2b0: 0a20 2020 2020 2020 2073 6f75 7263 653a  .        source:
+0001e2c0: 2055 6e69 6f6e 5b64 6963 742c 206d 6c72   Union[dict, mlr
+0001e2d0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001e2e0: 732e 496e 6465 7865 6448 7562 536f 7572  s.IndexedHubSour
+0001e2f0: 6365 5d2c 0a20 2020 2029 3a0a 2020 2020  ce],.    ):.    
+0001e300: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001e310: 4372 6561 7465 206f 7220 7265 706c 6163  Create or replac
+0001e320: 6520 6120 6875 6220 736f 7572 6365 2e0a  e a hub source..
+0001e330: 2020 2020 2020 2020 466f 7220 616e 2065          For an e
+0001e340: 7861 6d70 6c65 206f 6620 7468 6520 736f  xample of the so
+0001e350: 7572 6365 2066 6f72 6d61 7420 616e 6420  urce format and 
+0001e360: 6578 706c 616e 6174 696f 6e20 6f66 2074  explanation of t
+0001e370: 6865 2073 6f75 7263 6520 6f72 6465 7220  he source order 
+0001e380: 6c6f 6769 632c 0a20 2020 2020 2020 2070  logic,.        p
+0001e390: 6c65 6173 6520 7365 6520 3a70 793a 6675  lease see :py:fu
+0001e3a0: 6e63 3a60 7e63 7265 6174 655f 6875 625f  nc:`~create_hub_
+0001e3b0: 736f 7572 6365 602e 2054 6869 7320 6d65  source`. This me
+0001e3c0: 7468 6f64 2063 616e 2062 6520 7573 6564  thod can be used
+0001e3d0: 2074 6f20 6d6f 6469 6679 2074 6865 2073   to modify the s
+0001e3e0: 6f75 7263 6520 6974 7365 6c66 206f 7220  ource itself or 
+0001e3f0: 6974 730a 2020 2020 2020 2020 6f72 6465  its.        orde
+0001e400: 7220 696e 2074 6865 206c 6973 7420 6f66  r in the list of
+0001e410: 2073 6f75 7263 6573 2e0a 0a20 2020 2020   sources...     
+0001e420: 2020 203a 7061 7261 6d20 736f 7572 6365     :param source
+0001e430: 5f6e 616d 653a 204e 616d 6520 6f66 2074  _name: Name of t
+0001e440: 6865 2073 6f75 7263 6520 6f62 6a65 6374  he source object
+0001e450: 2074 6f20 6d6f 6469 6679 2f63 7265 6174   to modify/creat
+0001e460: 652e 2049 7420 6d75 7374 206d 6174 6368  e. It must match
+0001e470: 2074 6865 2060 6073 6f75 7263 652e 6d65   the ``source.me
+0001e480: 7461 6461 7461 2e6e 616d 6560 600a 2020  tadata.name``.  
+0001e490: 2020 2020 2020 2020 2020 7061 7261 6d65            parame
+0001e4a0: 7465 7220 696e 2074 6865 2073 6f75 7263  ter in the sourc
+0001e4b0: 6520 6974 7365 6c66 2e0a 2020 2020 2020  e itself..      
+0001e4c0: 2020 3a70 6172 616d 2073 6f75 7263 653a    :param source:
+0001e4d0: 2053 6f75 7263 6520 6f62 6a65 6374 2074   Source object t
+0001e4e0: 6f20 7374 6f72 6520 696e 2074 6865 2064  o store in the d
+0001e4f0: 6174 6162 6173 652e 0a20 2020 2020 2020  atabase..       
+0001e500: 203a 7265 7475 726e 733a 2054 6865 2073   :returns: The s
+0001e510: 6f75 7263 6520 6f62 6a65 6374 2061 7320  ource object as 
+0001e520: 7374 6f72 6564 2069 6e20 7468 6520 4442  stored in the DB
+0001e530: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001e540: 2020 2020 2020 7061 7468 203d 2066 2268        path = f"h
+0001e550: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
+0001e560: 6365 5f6e 616d 657d 220a 2020 2020 2020  ce_name}".      
+0001e570: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001e580: 736f 7572 6365 2c20 6d6c 7275 6e2e 636f  source, mlrun.co
+0001e590: 6d6d 6f6e 2e73 6368 656d 6173 2e49 6e64  mmon.schemas.Ind
+0001e5a0: 6578 6564 4875 6253 6f75 7263 6529 3a0a  exedHubSource):.
+0001e5b0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0001e5c0: 6365 203d 2073 6f75 7263 652e 6469 6374  ce = source.dict
+0001e5d0: 2829 0a0a 2020 2020 2020 2020 7265 7370  ()..        resp
+0001e5e0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+0001e5f0: 6361 6c6c 286d 6574 686f 643d 2250 5554  call(method="PUT
+0001e600: 222c 2070 6174 683d 7061 7468 2c20 6a73  ", path=path, js
+0001e610: 6f6e 3d73 6f75 7263 6529 0a20 2020 2020  on=source).     
+0001e620: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
+0001e630: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e49  common.schemas.I
+0001e640: 6e64 6578 6564 4875 6253 6f75 7263 6528  ndexedHubSource(
+0001e650: 2a2a 7265 7370 6f6e 7365 2e6a 736f 6e28  **response.json(
+0001e660: 2929 0a0a 2020 2020 6465 6620 6c69 7374  ))..    def list
+0001e670: 5f68 7562 5f73 6f75 7263 6573 2873 656c  _hub_sources(sel
+0001e680: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0001e690: 2020 2020 2020 2020 4c69 7374 2068 7562          List hub
+0001e6a0: 2073 6f75 7263 6573 2069 6e20 7468 6520   sources in the 
+0001e6b0: 4d4c 5275 6e20 4442 2e0a 2020 2020 2020  MLRun DB..      
+0001e6c0: 2020 2222 220a 2020 2020 2020 2020 7061    """.        pa
+0001e6d0: 7468 203d 2022 6875 622f 736f 7572 6365  th = "hub/source
+0001e6e0: 7322 0a20 2020 2020 2020 2072 6573 706f  s".        respo
+0001e6f0: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+0001e700: 616c 6c28 6d65 7468 6f64 3d22 4745 5422  all(method="GET"
+0001e710: 2c20 7061 7468 3d70 6174 6829 2e6a 736f  , path=path).jso
+0001e720: 6e28 290a 2020 2020 2020 2020 7265 7375  n().        resu
+0001e730: 6c74 7320 3d20 5b5d 0a20 2020 2020 2020  lts = [].       
+0001e740: 2066 6f72 2069 7465 6d20 696e 2072 6573   for item in res
+0001e750: 706f 6e73 653a 0a20 2020 2020 2020 2020  ponse:.         
+0001e760: 2020 2072 6573 756c 7473 2e61 7070 656e     results.appen
+0001e770: 6428 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  d(mlrun.common.s
+0001e780: 6368 656d 6173 2e49 6e64 6578 6564 4875  chemas.IndexedHu
+0001e790: 6253 6f75 7263 6528 2a2a 6974 656d 2929  bSource(**item))
+0001e7a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001e7b0: 7265 7375 6c74 730a 0a20 2020 2064 6566  results..    def
+0001e7c0: 2067 6574 5f68 7562 5f73 6f75 7263 6528   get_hub_source(
+0001e7d0: 7365 6c66 2c20 736f 7572 6365 5f6e 616d  self, source_nam
+0001e7e0: 653a 2073 7472 293a 0a20 2020 2020 2020  e: str):.       
+0001e7f0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+0001e800: 7269 6576 6520 6120 6875 6220 736f 7572  rieve a hub sour
+0001e810: 6365 2066 726f 6d20 7468 6520 4442 2e0a  ce from the DB..
+0001e820: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001e830: 736f 7572 6365 5f6e 616d 653a 204e 616d  source_name: Nam
+0001e840: 6520 6f66 2074 6865 2068 7562 2073 6f75  e of the hub sou
+0001e850: 7263 6520 746f 2072 6574 7269 6576 652e  rce to retrieve.
+0001e860: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001e870: 2020 2020 2070 6174 6820 3d20 6622 6875       path = f"hu
+0001e880: 622f 736f 7572 6365 732f 7b73 6f75 7263  b/sources/{sourc
+0001e890: 655f 6e61 6d65 7d22 0a20 2020 2020 2020  e_name}".       
+0001e8a0: 2072 6573 706f 6e73 6520 3d20 7365 6c66   response = self
+0001e8b0: 2e61 7069 5f63 616c 6c28 6d65 7468 6f64  .api_call(method
+0001e8c0: 3d22 4745 5422 2c20 7061 7468 3d70 6174  ="GET", path=pat
+0001e8d0: 6829 0a20 2020 2020 2020 2072 6574 7572  h).        retur
+0001e8e0: 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  n mlrun.common.s
+0001e8f0: 6368 656d 6173 2e49 6e64 6578 6564 4875  chemas.IndexedHu
+0001e900: 6253 6f75 7263 6528 2a2a 7265 7370 6f6e  bSource(**respon
+0001e910: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
+0001e920: 6465 6620 6465 6c65 7465 5f68 7562 5f73  def delete_hub_s
+0001e930: 6f75 7263 6528 7365 6c66 2c20 736f 7572  ource(self, sour
+0001e940: 6365 5f6e 616d 653a 2073 7472 293a 0a20  ce_name: str):. 
+0001e950: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001e960: 2020 2044 656c 6574 6520 6120 6875 6220     Delete a hub 
+0001e970: 736f 7572 6365 2066 726f 6d20 7468 6520  source from the 
+0001e980: 4442 2e0a 2020 2020 2020 2020 5468 6520  DB..        The 
+0001e990: 736f 7572 6365 2077 696c 6c20 6265 2064  source will be d
+0001e9a0: 656c 6574 6564 2066 726f 6d20 7468 6520  eleted from the 
+0001e9b0: 6c69 7374 2c20 616e 6420 616e 7920 666f  list, and any fo
+0001e9c0: 6c6c 6f77 696e 6720 736f 7572 6365 7320  llowing sources 
+0001e9d0: 7769 6c6c 2062 6520 7072 6f6d 6f74 6564  will be promoted
+0001e9e0: 202d 2066 6f72 2065 7861 6d70 6c65 2c20   - for example, 
+0001e9f0: 6966 2074 6865 0a20 2020 2020 2020 2031  if the.        1
+0001ea00: 7374 2073 6f75 7263 6520 6973 2064 656c  st source is del
+0001ea10: 6574 6564 2c20 7468 6520 326e 6420 736f  eted, the 2nd so
+0001ea20: 7572 6365 2077 696c 6c20 6265 636f 6d65  urce will become
+0001ea30: 2023 3120 696e 2074 6865 206c 6973 742e   #1 in the list.
+0001ea40: 0a20 2020 2020 2020 2054 6865 2067 6c6f  .        The glo
+0001ea50: 6261 6c20 6875 6220 736f 7572 6365 2063  bal hub source c
+0001ea60: 616e 6e6f 7420 6265 2064 656c 6574 6564  annot be deleted
+0001ea70: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0001ea80: 6d20 736f 7572 6365 5f6e 616d 653a 204e  m source_name: N
+0001ea90: 616d 6520 6f66 2074 6865 2068 7562 2073  ame of the hub s
+0001eaa0: 6f75 7263 6520 746f 2064 656c 6574 652e  ource to delete.
+0001eab0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001eac0: 2020 2020 2070 6174 6820 3d20 6622 6875       path = f"hu
+0001ead0: 622f 736f 7572 6365 732f 7b73 6f75 7263  b/sources/{sourc
+0001eae0: 655f 6e61 6d65 7d22 0a20 2020 2020 2020  e_name}".       
+0001eaf0: 2073 656c 662e 6170 695f 6361 6c6c 286d   self.api_call(m
+0001eb00: 6574 686f 643d 2244 454c 4554 4522 2c20  ethod="DELETE", 
+0001eb10: 7061 7468 3d70 6174 6829 0a0a 2020 2020  path=path)..    
+0001eb20: 6465 6620 6765 745f 6875 625f 6361 7461  def get_hub_cata
+0001eb30: 6c6f 6728 0a20 2020 2020 2020 2073 656c  log(.        sel
+0001eb40: 662c 0a20 2020 2020 2020 2073 6f75 7263  f,.        sourc
+0001eb50: 655f 6e61 6d65 3a20 7374 722c 0a20 2020  e_name: str,.   
+0001eb60: 2020 2020 2076 6572 7369 6f6e 3a20 7374       version: st
+0001eb70: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+0001eb80: 2020 7461 673a 2073 7472 203d 204e 6f6e    tag: str = Non
+0001eb90: 652c 0a20 2020 2020 2020 2066 6f72 6365  e,.        force
+0001eba0: 5f72 6566 7265 7368 3a20 626f 6f6c 203d  _refresh: bool =
+0001ebb0: 2046 616c 7365 2c0a 2020 2020 293a 0a20   False,.    ):. 
+0001ebc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001ebd0: 2020 2052 6574 7269 6576 6520 7468 6520     Retrieve the 
+0001ebe0: 6974 656d 2063 6174 616c 6f67 2066 6f72  item catalog for
+0001ebf0: 2061 2073 7065 6369 6669 6564 2068 7562   a specified hub
+0001ec00: 2073 6f75 7263 652e 0a20 2020 2020 2020   source..       
+0001ec10: 2054 6865 206c 6973 7420 6f66 2069 7465   The list of ite
+0001ec20: 6d73 2063 616e 2062 6520 6669 6c74 6572  ms can be filter
+0001ec30: 6564 2061 6363 6f72 6469 6e67 2074 6f20  ed according to 
+0001ec40: 7661 7269 6f75 7320 6669 6c74 6572 732c  various filters,
+0001ec50: 2075 7369 6e67 2069 7465 6d27 7320 6d65   using item's me
+0001ec60: 7461 6461 7461 2074 6f20 6669 6c74 6572  tadata to filter
+0001ec70: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0001ec80: 6d20 736f 7572 6365 5f6e 616d 653a 204e  m source_name: N
+0001ec90: 616d 6520 6f66 2074 6865 2073 6f75 7263  ame of the sourc
+0001eca0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0001ecb0: 6d20 7665 7273 696f 6e3a 2046 696c 7465  m version: Filte
+0001ecc0: 7220 6974 656d 7320 6163 636f 7264 696e  r items accordin
+0001ecd0: 6720 746f 2074 6865 6972 2076 6572 7369  g to their versi
+0001ece0: 6f6e 2e0a 2020 2020 2020 2020 3a70 6172  on..        :par
+0001ecf0: 616d 2074 6167 3a20 4669 6c74 6572 2069  am tag: Filter i
+0001ed00: 7465 6d73 2062 6173 6564 206f 6e20 7461  tems based on ta
+0001ed10: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
+0001ed20: 6d20 666f 7263 655f 7265 6672 6573 683a  m force_refresh:
+0001ed30: 204d 616b 6520 7468 6520 7365 7276 6572   Make the server
+0001ed40: 2066 6574 6368 2074 6865 2063 6174 616c   fetch the catal
+0001ed50: 6f67 2066 726f 6d20 7468 6520 6163 7475  og from the actu
+0001ed60: 616c 2068 7562 2073 6f75 7263 652c 0a20  al hub source,. 
+0001ed70: 2020 2020 2020 2020 2020 2072 6174 6865             rathe
+0001ed80: 7220 7468 616e 2072 656c 7920 6f6e 2063  r than rely on c
+0001ed90: 6163 6865 6420 696e 666f 726d 6174 696f  ached informatio
+0001eda0: 6e20 7768 6963 6820 6d61 7920 6578 6973  n which may exis
+0001edb0: 7420 6672 6f6d 2070 7265 7669 6f75 7320  t from previous 
+0001edc0: 6765 7420 7265 7175 6573 7473 2e20 466f  get requests. Fo
+0001edd0: 7220 6578 616d 706c 652c 0a20 2020 2020  r example,.     
+0001ede0: 2020 2020 2020 2069 6620 7468 6520 736f         if the so
+0001edf0: 7572 6365 2077 6173 2072 652d 6275 696c  urce was re-buil
+0001ee00: 742c 0a20 2020 2020 2020 2020 2020 2074  t,.            t
+0001ee10: 6869 7320 7769 6c6c 206d 616b 6520 7468  his will make th
+0001ee20: 6520 7365 7276 6572 2067 6574 2074 6865  e server get the
+0001ee30: 2075 7064 6174 6564 2069 6e66 6f72 6d61   updated informa
+0001ee40: 7469 6f6e 2e20 4465 6661 756c 7420 6973  tion. Default is
+0001ee50: 2060 6046 616c 7365 6060 2e0a 2020 2020   ``False``..    
+0001ee60: 2020 2020 3a72 6574 7572 6e73 3a20 3a70      :returns: :p
+0001ee70: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
+0001ee80: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e68  common.schemas.h
+0001ee90: 7562 2e48 7562 4361 7461 6c6f 6760 206f  ub.HubCatalog` o
+0001eea0: 626a 6563 742c 2077 6869 6368 2069 7320  bject, which is 
+0001eeb0: 6573 7365 6e74 6961 6c6c 7920 6120 6c69  essentially a li
+0001eec0: 7374 0a20 2020 2020 2020 2020 2020 206f  st.            o
+0001eed0: 6620 3a70 793a 636c 6173 733a 607e 6d6c  f :py:class:`~ml
+0001eee0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001eef0: 6173 2e68 7562 2e48 7562 4974 656d 6020  as.hub.HubItem` 
+0001ef00: 656e 7472 6965 732e 0a20 2020 2020 2020  entries..       
+0001ef10: 2022 2222 0a20 2020 2020 2020 2070 6174   """.        pat
+0001ef20: 6820 3d20 2866 2268 7562 2f73 6f75 7263  h = (f"hub/sourc
+0001ef30: 6573 2f7b 736f 7572 6365 5f6e 616d 657d  es/{source_name}
+0001ef40: 2f69 7465 6d73 222c 290a 2020 2020 2020  /items",).      
+0001ef50: 2020 7061 7261 6d73 203d 207b 0a20 2020    params = {.   
+0001ef60: 2020 2020 2020 2020 2022 7665 7273 696f           "versio
+0001ef70: 6e22 3a20 7665 7273 696f 6e2c 0a20 2020  n": version,.   
+0001ef80: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
+0001ef90: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
+0001efa0: 2022 666f 7263 652d 7265 6672 6573 6822   "force-refresh"
+0001efb0: 3a20 666f 7263 655f 7265 6672 6573 682c  : force_refresh,
+0001efc0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0001efd0: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
+0001efe0: 6c66 2e61 7069 5f63 616c 6c28 6d65 7468  lf.api_call(meth
+0001eff0: 6f64 3d22 4745 5422 2c20 7061 7468 3d70  od="GET", path=p
+0001f000: 6174 682c 2070 6172 616d 733d 7061 7261  ath, params=para
+0001f010: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
+0001f020: 726e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rn mlrun.common.
+0001f030: 7363 6865 6d61 732e 4875 6243 6174 616c  schemas.HubCatal
+0001f040: 6f67 282a 2a72 6573 706f 6e73 652e 6a73  og(**response.js
+0001f050: 6f6e 2829 290a 0a20 2020 2064 6566 2067  on())..    def g
+0001f060: 6574 5f68 7562 5f69 7465 6d28 0a20 2020  et_hub_item(.   
+0001f070: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0001f080: 2020 2073 6f75 7263 655f 6e61 6d65 3a20     source_name: 
+0001f090: 7374 722c 0a20 2020 2020 2020 2069 7465  str,.        ite
+0001f0a0: 6d5f 6e61 6d65 3a20 7374 722c 0a20 2020  m_name: str,.   
+0001f0b0: 2020 2020 2076 6572 7369 6f6e 3a20 7374       version: st
+0001f0c0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+0001f0d0: 2020 7461 673a 2073 7472 203d 2022 6c61    tag: str = "la
+0001f0e0: 7465 7374 222c 0a20 2020 2020 2020 2066  test",.        f
+0001f0f0: 6f72 6365 5f72 6566 7265 7368 3a20 626f  orce_refresh: bo
+0001f100: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0001f110: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001f120: 2020 2020 2020 2052 6574 7269 6576 6520         Retrieve 
+0001f130: 6120 7370 6563 6966 6963 2068 7562 2069  a specific hub i
+0001f140: 7465 6d2e 0a0a 2020 2020 2020 2020 3a70  tem...        :p
+0001f150: 6172 616d 2073 6f75 7263 655f 6e61 6d65  aram source_name
+0001f160: 3a20 4e61 6d65 206f 6620 736f 7572 6365  : Name of source
+0001f170: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001f180: 2069 7465 6d5f 6e61 6d65 3a20 4e61 6d65   item_name: Name
+0001f190: 206f 6620 7468 6520 6974 656d 2074 6f20   of the item to 
+0001f1a0: 7265 7472 6965 7665 2c20 6173 2069 7420  retrieve, as it 
+0001f1b0: 6170 7065 6172 7320 696e 2074 6865 2063  appears in the c
+0001f1c0: 6174 616c 6f67 2e0a 2020 2020 2020 2020  atalog..        
+0001f1d0: 3a70 6172 616d 2076 6572 7369 6f6e 3a20  :param version: 
+0001f1e0: 4765 7420 6120 7370 6563 6966 6963 2076  Get a specific v
+0001f1f0: 6572 7369 6f6e 206f 6620 7468 6520 6974  ersion of the it
+0001f200: 656d 2e20 4465 6661 756c 7420 6973 2060  em. Default is `
+0001f210: 604e 6f6e 6560 602e 0a20 2020 2020 2020  `None``..       
+0001f220: 203a 7061 7261 6d20 7461 673a 2047 6574   :param tag: Get
+0001f230: 2061 2073 7065 6369 6669 6320 7665 7273   a specific vers
+0001f240: 696f 6e20 6f66 2074 6865 2069 7465 6d20  ion of the item 
+0001f250: 6964 656e 7469 6669 6564 2062 7920 7461  identified by ta
+0001f260: 672e 2044 6566 6175 6c74 2069 7320 6060  g. Default is ``
+0001f270: 6c61 7465 7374 6060 2e0a 2020 2020 2020  latest``..      
+0001f280: 2020 3a70 6172 616d 2066 6f72 6365 5f72    :param force_r
+0001f290: 6566 7265 7368 3a20 4d61 6b65 2074 6865  efresh: Make the
+0001f2a0: 2073 6572 7665 7220 6665 7463 6820 7468   server fetch th
+0001f2b0: 6520 696e 666f 726d 6174 696f 6e20 6672  e information fr
+0001f2c0: 6f6d 2074 6865 2061 6374 7561 6c20 6875  om the actual hu
+0001f2d0: 620a 2020 2020 2020 2020 2020 2020 736f  b.            so
+0001f2e0: 7572 6365 2c20 7261 7468 6572 2074 6861  urce, rather tha
+0001f2f0: 6e0a 2020 2020 2020 2020 2020 2020 7265  n.            re
+0001f300: 6c79 206f 6e20 6361 6368 6564 2069 6e66  ly on cached inf
+0001f310: 6f72 6d61 7469 6f6e 2e20 4465 6661 756c  ormation. Defaul
+0001f320: 7420 6973 2060 6046 616c 7365 6060 2e0a  t is ``False``..
+0001f330: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
+0001f340: 3a20 3a70 793a 636c 6173 733a 607e 6d6c  : :py:class:`~ml
+0001f350: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001f360: 6173 2e68 7562 2e48 7562 4974 656d 602e  as.hub.HubItem`.
+0001f370: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001f380: 2020 2020 2070 6174 6820 3d20 2866 2268       path = (f"h
+0001f390: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
+0001f3a0: 6365 5f6e 616d 657d 2f69 7465 6d73 2f7b  ce_name}/items/{
+0001f3b0: 6974 656d 5f6e 616d 657d 222c 290a 2020  item_name}",).  
+0001f3c0: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+0001f3d0: 0a20 2020 2020 2020 2020 2020 2022 7665  .            "ve
+0001f3e0: 7273 696f 6e22 3a20 7665 7273 696f 6e2c  rsion": version,
+0001f3f0: 0a20 2020 2020 2020 2020 2020 2022 7461  .            "ta
+0001f400: 6722 3a20 7461 672c 0a20 2020 2020 2020  g": tag,.       
+0001f410: 2020 2020 2022 666f 7263 652d 7265 6672       "force-refr
+0001f420: 6573 6822 3a20 666f 7263 655f 7265 6672  esh": force_refr
+0001f430: 6573 682c 0a20 2020 2020 2020 207d 0a20  esh,.        }. 
+0001f440: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
+0001f450: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+0001f460: 6d65 7468 6f64 3d22 4745 5422 2c20 7061  method="GET", pa
+0001f470: 7468 3d70 6174 682c 2070 6172 616d 733d  th=path, params=
+0001f480: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+0001f490: 7265 7475 726e 206d 6c72 756e 2e63 6f6d  return mlrun.com
+0001f4a0: 6d6f 6e2e 7363 6865 6d61 732e 4875 6249  mon.schemas.HubI
+0001f4b0: 7465 6d28 2a2a 7265 7370 6f6e 7365 2e6a  tem(**response.j
+0001f4c0: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
+0001f4d0: 6765 745f 6875 625f 6173 7365 7428 0a20  get_hub_asset(. 
+0001f4e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0001f4f0: 2020 2020 2073 6f75 7263 655f 6e61 6d65       source_name
+0001f500: 3a20 7374 722c 0a20 2020 2020 2020 2069  : str,.        i
+0001f510: 7465 6d5f 6e61 6d65 3a20 7374 722c 0a20  tem_name: str,. 
+0001f520: 2020 2020 2020 2061 7373 6574 5f6e 616d         asset_nam
+0001f530: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+0001f540: 7665 7273 696f 6e3a 2073 7472 203d 204e  version: str = N
+0001f550: 6f6e 652c 0a20 2020 2020 2020 2074 6167  one,.        tag
+0001f560: 3a20 7374 7220 3d20 226c 6174 6573 7422  : str = "latest"
+0001f570: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+0001f580: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+0001f590: 2068 7562 2061 7373 6574 2066 726f 6d20   hub asset from 
+0001f5a0: 6974 656d 2e0a 0a20 2020 2020 2020 203a  item...        :
+0001f5b0: 7061 7261 6d20 736f 7572 6365 5f6e 616d  param source_nam
+0001f5c0: 653a 204e 616d 6520 6f66 2073 6f75 7263  e: Name of sourc
+0001f5d0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0001f5e0: 6d20 6974 656d 5f6e 616d 653a 2020 204e  m item_name:   N
+0001f5f0: 616d 6520 6f66 2074 6865 2069 7465 6d20  ame of the item 
+0001f600: 7768 6963 6820 686f 6c64 7320 7468 6520  which holds the 
+0001f610: 6173 7365 742e 0a20 2020 2020 2020 203a  asset..        :
+0001f620: 7061 7261 6d20 6173 7365 745f 6e61 6d65  param asset_name
+0001f630: 3a20 204e 616d 6520 6f66 2074 6865 2061  :  Name of the a
+0001f640: 7373 6574 2074 6f20 7265 7472 6965 7665  sset to retrieve
+0001f650: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001f660: 2076 6572 7369 6f6e 3a20 4765 7420 6120   version: Get a 
+0001f670: 7370 6563 6966 6963 2076 6572 7369 6f6e  specific version
+0001f680: 206f 6620 7468 6520 6974 656d 2e20 4465   of the item. De
+0001f690: 6661 756c 7420 6973 2060 604e 6f6e 6560  fault is ``None`
+0001f6a0: 602e 0a20 2020 2020 2020 203a 7061 7261  `..        :para
+0001f6b0: 6d20 7461 673a 2047 6574 2061 2073 7065  m tag: Get a spe
+0001f6c0: 6369 6669 6320 7665 7273 696f 6e20 6f66  cific version of
+0001f6d0: 2074 6865 2069 7465 6d20 6964 656e 7469   the item identi
+0001f6e0: 6669 6564 2062 7920 7461 672e 2044 6566  fied by tag. Def
+0001f6f0: 6175 6c74 2069 7320 6060 6c61 7465 7374  ault is ``latest
+0001f700: 6060 2e0a 0a20 2020 2020 2020 203a 7265  ``...        :re
+0001f710: 7475 726e 3a20 6874 7470 2072 6573 706f  turn: http respo
+0001f720: 6e73 6520 7769 7468 2074 6865 2061 7373  nse with the ass
+0001f730: 6574 2069 6e20 7468 6520 636f 6e74 656e  et in the conten
+0001f740: 7420 6174 7472 6962 7574 650a 2020 2020  t attribute.    
+0001f750: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001f760: 7061 7468 203d 2028 6622 6875 622f 736f  path = (f"hub/so
+0001f770: 7572 6365 732f 7b73 6f75 7263 655f 6e61  urces/{source_na
+0001f780: 6d65 7d2f 6974 656d 732f 7b69 7465 6d5f  me}/items/{item_
+0001f790: 6e61 6d65 7d2f 6173 7365 7473 2f7b 6173  name}/assets/{as
+0001f7a0: 7365 745f 6e61 6d65 7d22 2c29 0a20 2020  set_name}",).   
+0001f7b0: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
+0001f7c0: 2020 2020 2020 2020 2020 2020 2276 6572              "ver
+0001f7d0: 7369 6f6e 223a 2076 6572 7369 6f6e 2c0a  sion": version,.
+0001f7e0: 2020 2020 2020 2020 2020 2020 2274 6167              "tag
+0001f7f0: 223a 2074 6167 2c0a 2020 2020 2020 2020  ": tag,.        
+0001f800: 7d0a 2020 2020 2020 2020 7265 7370 6f6e  }.        respon
+0001f810: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
+0001f820: 6c6c 286d 6574 686f 643d 2247 4554 222c  ll(method="GET",
+0001f830: 2070 6174 683d 7061 7468 2c20 7061 7261   path=path, para
+0001f840: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
+0001f850: 2020 2072 6574 7572 6e20 7265 7370 6f6e     return respon
+0001f860: 7365 0a0a 2020 2020 6465 6620 7665 7269  se..    def veri
+0001f870: 6679 5f61 7574 686f 7269 7a61 7469 6f6e  fy_authorization
+0001f880: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001f890: 2020 2020 2020 2020 6175 7468 6f72 697a          authoriz
+0001f8a0: 6174 696f 6e5f 7665 7269 6669 6361 7469  ation_verificati
+0001f8b0: 6f6e 5f69 6e70 7574 3a20 6d6c 7275 6e2e  on_input: mlrun.
+0001f8c0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e41  common.schemas.A
+0001f8d0: 7574 686f 7269 7a61 7469 6f6e 5665 7269  uthorizationVeri
+0001f8e0: 6669 6361 7469 6f6e 496e 7075 742c 0a20  ficationInput,. 
+0001f8f0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0001f900: 2256 6572 6966 6965 7320 6175 7468 6f72  "Verifies author
+0001f910: 697a 6174 696f 6e20 666f 7220 7468 6520  ization for the 
+0001f920: 7072 6f76 6964 6564 2061 6374 696f 6e20  provided action 
+0001f930: 6f6e 2074 6865 2070 726f 7669 6465 6420  on the provided 
+0001f940: 7265 736f 7572 6365 2e0a 0a20 2020 2020  resource...     
+0001f950: 2020 203a 7061 7261 6d20 6175 7468 6f72     :param author
+0001f960: 697a 6174 696f 6e5f 7665 7269 6669 6361  ization_verifica
+0001f970: 7469 6f6e 5f69 6e70 7574 3a20 496e 7374  tion_input: Inst
+0001f980: 616e 6365 206f 660a 2020 2020 2020 2020  ance of.        
+0001f990: 2020 2020 3a70 793a 636c 6173 733a 607e      :py:class:`~
+0001f9a0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0001f9b0: 656d 6173 2e41 7574 686f 7269 7a61 7469  emas.Authorizati
+0001f9c0: 6f6e 5665 7269 6669 6361 7469 6f6e 496e  onVerificationIn
+0001f9d0: 7075 7460 2074 6861 7420 696e 636c 7564  put` that includ
+0001f9e0: 6573 2061 6c6c 2074 6865 206e 6565 6465  es all the neede
+0001f9f0: 6420 7061 7261 6d65 7465 7273 2066 6f72  d parameters for
+0001fa00: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0001fa10: 2061 7574 6820 7665 7269 6669 6361 7469   auth verificati
+0001fa20: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
+0001fa30: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
+0001fa40: 7361 6765 203d 2022 4175 7468 6f72 697a  sage = "Authoriz
+0001fa50: 6174 696f 6e20 6368 6563 6b20 6661 696c  ation check fail
+0001fa60: 6564 220a 2020 2020 2020 2020 7365 6c66  ed".        self
+0001fa70: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+0001fa80: 2020 2020 2020 2022 504f 5354 222c 0a20         "POST",. 
+0001fa90: 2020 2020 2020 2020 2020 2022 6175 7468             "auth
+0001faa0: 6f72 697a 6174 696f 6e2f 7665 7269 6669  orization/verifi
+0001fab0: 6361 7469 6f6e 7322 2c0a 2020 2020 2020  cations",.      
+0001fac0: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+0001fad0: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
+0001fae0: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
+0001faf0: 6f6e 2861 7574 686f 7269 7a61 7469 6f6e  on(authorization
+0001fb00: 5f76 6572 6966 6963 6174 696f 6e5f 696e  _verification_in
+0001fb10: 7075 742e 6469 6374 2829 292c 0a20 2020  put.dict()),.   
+0001fb20: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0001fb30: 7472 6967 6765 725f 6d69 6772 6174 696f  trigger_migratio
+0001fb40: 6e73 2873 656c 6629 202d 3e20 4f70 7469  ns(self) -> Opti
+0001fb50: 6f6e 616c 5b6d 6c72 756e 2e63 6f6d 6d6f  onal[mlrun.commo
+0001fb60: 6e2e 7363 6865 6d61 732e 4261 636b 6772  n.schemas.Backgr
+0001fb70: 6f75 6e64 5461 736b 5d3a 0a20 2020 2020  oundTask]:.     
+0001fb80: 2020 2022 2222 5472 6967 6765 7220 6d69     """Trigger mi
+0001fb90: 6772 6174 696f 6e73 2028 7769 6c6c 2064  grations (will d
+0001fba0: 6f20 6e6f 7468 696e 6720 6966 206e 6f20  o nothing if no 
+0001fbb0: 6d69 6772 6174 696f 6e73 2061 7265 206e  migrations are n
+0001fbc0: 6565 6465 6429 2061 6e64 2077 6169 7420  eeded) and wait 
+0001fbd0: 666f 7220 7468 656d 2074 6f20 6669 6e69  for them to fini
+0001fbe0: 7368 2069 6620 6163 7475 616c 6c79 0a20  sh if actually. 
+0001fbf0: 2020 2020 2020 2074 7269 6767 6572 6564         triggered
+0001fc00: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0001fc10: 733a 203a 7079 3a63 6c61 7373 3a60 7e6d  s: :py:class:`~m
+0001fc20: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001fc30: 6d61 732e 4261 636b 6772 6f75 6e64 5461  mas.BackgroundTa
+0001fc40: 736b 602e 0a20 2020 2020 2020 2022 2222  sk`..        """
+0001fc50: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
+0001fc60: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
+0001fc70: 6c28 0a20 2020 2020 2020 2020 2020 2022  l(.            "
+0001fc80: 504f 5354 222c 0a20 2020 2020 2020 2020  POST",.         
+0001fc90: 2020 2022 6f70 6572 6174 696f 6e73 2f6d     "operations/m
+0001fca0: 6967 7261 7469 6f6e 7322 2c0a 2020 2020  igrations",.    
+0001fcb0: 2020 2020 2020 2020 2246 6169 6c65 6420          "Failed 
+0001fcc0: 7472 6967 6765 7269 6e67 206d 6967 7261  triggering migra
+0001fcd0: 7469 6f6e 7322 2c0a 2020 2020 2020 2020  tions",.        
+0001fce0: 290a 2020 2020 2020 2020 6966 2072 6573  ).        if res
+0001fcf0: 706f 6e73 652e 7374 6174 7573 5f63 6f64  ponse.status_cod
+0001fd00: 6520 3d3d 2068 7474 702e 4854 5450 5374  e == http.HTTPSt
+0001fd10: 6174 7573 2e41 4343 4550 5445 443a 0a20  atus.ACCEPTED:. 
+0001fd20: 2020 2020 2020 2020 2020 2062 6163 6b67             backg
+0001fd30: 726f 756e 645f 7461 736b 203d 206d 6c72  round_task = mlr
+0001fd40: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0001fd50: 732e 4261 636b 6772 6f75 6e64 5461 736b  s.BackgroundTask
+0001fd60: 282a 2a72 6573 706f 6e73 652e 6a73 6f6e  (**response.json
+0001fd70: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0001fd80: 7265 7475 726e 2073 656c 662e 5f77 6169  return self._wai
+0001fd90: 745f 666f 725f 6261 636b 6772 6f75 6e64  t_for_background
+0001fda0: 5f74 6173 6b5f 746f 5f72 6561 6368 5f74  _task_to_reach_t
+0001fdb0: 6572 6d69 6e61 6c5f 7374 6174 6528 0a20  erminal_state(. 
+0001fdc0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001fdd0: 6163 6b67 726f 756e 645f 7461 736b 2e6d  ackground_task.m
+0001fde0: 6574 6164 6174 612e 6e61 6d65 0a20 2020  etadata.name.   
+0001fdf0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001fe00: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+0001fe10: 0a64 6566 205f 6173 5f6a 736f 6e28 6f62  .def _as_json(ob
+0001fe20: 6a29 3a0a 2020 2020 666e 203d 2067 6574  j):.    fn = get
+0001fe30: 6174 7472 286f 626a 2c20 2274 6f5f 6a73  attr(obj, "to_js
+0001fe40: 6f6e 222c 204e 6f6e 6529 0a20 2020 2069  on", None).    i
+0001fe50: 6620 666e 3a0a 2020 2020 2020 2020 7265  f fn:.        re
+0001fe60: 7475 726e 2066 6e28 290a 2020 2020 7265  turn fn().    re
+0001fe70: 7475 726e 2064 6963 745f 746f 5f6a 736f  turn dict_to_jso
+0001fe80: 6e28 6f62 6a29 0a                        n(obj).
```

## mlrun/db/nopdb.py

```diff
@@ -12,18 +12,17 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 
 import datetime
 from typing import List, Optional, Union
 
+import mlrun.common.schemas
 import mlrun.errors
 
-from ..api import schemas
-from ..api.schemas import ModelEndpoint
 from ..config import config
 from ..utils import logger
 from .base import RunDBInterface
 
 
 class NopDB(RunDBInterface):
     def __init__(self, url=None, *args, **kwargs):
@@ -83,18 +82,20 @@
         sort=True,
         last=0,
         iter=False,
         start_time_from: datetime.datetime = None,
         start_time_to: datetime.datetime = None,
         last_update_time_from: datetime.datetime = None,
         last_update_time_to: datetime.datetime = None,
-        partition_by: Union[schemas.RunPartitionByField, str] = None,
+        partition_by: Union[mlrun.common.schemas.RunPartitionByField, str] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
     ):
         pass
 
     def del_run(self, uid, project="", iter=0):
         pass
 
@@ -114,15 +115,15 @@
         tag="",
         labels=None,
         since=None,
         until=None,
         iter: int = None,
         best_iteration: bool = False,
         kind: str = None,
-        category: Union[str, schemas.ArtifactCategories] = None,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         pass
 
     def del_artifact(self, key, tag="", project=""):
         pass
 
     def del_artifacts(self, name="", project="", tag="", labels=None):
@@ -140,72 +141,81 @@
     def list_functions(self, name=None, project="", tag="", labels=None):
         pass
 
     def tag_objects(
         self,
         project: str,
         tag_name: str,
-        tag_objects: schemas.TagObjects,
+        tag_objects: mlrun.common.schemas.TagObjects,
         replace: bool = False,
     ):
         pass
 
     def delete_objects_tag(
-        self, project: str, tag_name: str, tag_objects: schemas.TagObjects
+        self, project: str, tag_name: str, tag_objects: mlrun.common.schemas.TagObjects
     ):
         pass
 
     def tag_artifacts(
         self, artifacts, project: str, tag_name: str, replace: bool = False
     ):
         pass
 
     def delete_artifacts_tags(self, artifacts, project: str, tag_name: str):
         pass
 
     def delete_project(
         self,
         name: str,
-        deletion_strategy: schemas.DeletionStrategy = schemas.DeletionStrategy.default(),
+        deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         pass
 
-    def store_project(self, name: str, project: schemas.Project) -> schemas.Project:
+    def store_project(
+        self, name: str, project: mlrun.common.schemas.Project
+    ) -> mlrun.common.schemas.Project:
         pass
 
     def patch_project(
         self,
         name: str,
         project: dict,
-        patch_mode: schemas.PatchMode = schemas.PatchMode.replace,
-    ) -> schemas.Project:
+        patch_mode: mlrun.common.schemas.PatchMode = mlrun.common.schemas.PatchMode.replace,
+    ) -> mlrun.common.schemas.Project:
         pass
 
-    def create_project(self, project: schemas.Project) -> schemas.Project:
+    def create_project(
+        self, project: mlrun.common.schemas.Project
+    ) -> mlrun.common.schemas.Project:
         pass
 
     def list_projects(
         self,
         owner: str = None,
-        format_: schemas.ProjectsFormat = schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: List[str] = None,
-        state: schemas.ProjectState = None,
-    ) -> schemas.ProjectsOutput:
+        state: mlrun.common.schemas.ProjectState = None,
+    ) -> mlrun.common.schemas.ProjectsOutput:
         pass
 
-    def get_project(self, name: str) -> schemas.Project:
+    def get_project(self, name: str) -> mlrun.common.schemas.Project:
         pass
 
     def list_artifact_tags(
-        self, project=None, category: Union[str, schemas.ArtifactCategories] = None
+        self,
+        project=None,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         pass
 
     def create_feature_set(
-        self, feature_set: Union[dict, schemas.FeatureSet], project="", versioned=True
+        self,
+        feature_set: Union[dict, mlrun.common.schemas.FeatureSet],
+        project="",
+        versioned=True,
     ) -> dict:
         pass
 
     def get_feature_set(
         self, name: str, project: str = "", tag: str = None, uid: str = None
     ) -> dict:
         pass
@@ -213,41 +223,45 @@
     def list_features(
         self,
         project: str,
         name: str = None,
         tag: str = None,
         entities: List[str] = None,
         labels: List[str] = None,
-    ) -> schemas.FeaturesOutput:
+    ) -> mlrun.common.schemas.FeaturesOutput:
         pass
 
     def list_entities(
         self, project: str, name: str = None, tag: str = None, labels: List[str] = None
-    ) -> schemas.EntitiesOutput:
+    ) -> mlrun.common.schemas.EntitiesOutput:
         pass
 
     def list_feature_sets(
         self,
         project: str = "",
         name: str = None,
         tag: str = None,
         state: str = None,
         entities: List[str] = None,
         features: List[str] = None,
         labels: List[str] = None,
-        partition_by: Union[schemas.FeatureStorePartitionByField, str] = None,
+        partition_by: Union[
+            mlrun.common.schemas.FeatureStorePartitionByField, str
+        ] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
     ) -> List[dict]:
         pass
 
     def store_feature_set(
         self,
-        feature_set: Union[dict, schemas.FeatureSet],
+        feature_set: Union[dict, mlrun.common.schemas.FeatureSet],
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
         pass
@@ -255,24 +269,26 @@
     def patch_feature_set(
         self,
         name,
         feature_set: dict,
         project="",
         tag=None,
         uid=None,
-        patch_mode: Union[str, schemas.PatchMode] = schemas.PatchMode.replace,
+        patch_mode: Union[
+            str, mlrun.common.schemas.PatchMode
+        ] = mlrun.common.schemas.PatchMode.replace,
     ):
         pass
 
     def delete_feature_set(self, name, project="", tag=None, uid=None):
         pass
 
     def create_feature_vector(
         self,
-        feature_vector: Union[dict, schemas.FeatureVector],
+        feature_vector: Union[dict, mlrun.common.schemas.FeatureVector],
         project="",
         versioned=True,
     ) -> dict:
         pass
 
     def get_feature_vector(
         self, name: str, project: str = "", tag: str = None, uid: str = None
@@ -282,24 +298,28 @@
     def list_feature_vectors(
         self,
         project: str = "",
         name: str = None,
         tag: str = None,
         state: str = None,
         labels: List[str] = None,
-        partition_by: Union[schemas.FeatureStorePartitionByField, str] = None,
+        partition_by: Union[
+            mlrun.common.schemas.FeatureStorePartitionByField, str
+        ] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
     ) -> List[dict]:
         pass
 
     def store_feature_vector(
         self,
-        feature_vector: Union[dict, schemas.FeatureVector],
+        feature_vector: Union[dict, mlrun.common.schemas.FeatureVector],
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
         pass
@@ -307,88 +327,93 @@
     def patch_feature_vector(
         self,
         name,
         feature_vector_update: dict,
         project="",
         tag=None,
         uid=None,
-        patch_mode: Union[str, schemas.PatchMode] = schemas.PatchMode.replace,
+        patch_mode: Union[
+            str, mlrun.common.schemas.PatchMode
+        ] = mlrun.common.schemas.PatchMode.replace,
     ):
         pass
 
     def delete_feature_vector(self, name, project="", tag=None, uid=None):
         pass
 
     def list_pipelines(
         self,
         project: str,
         namespace: str = None,
         sort_by: str = "",
         page_token: str = "",
         filter_: str = "",
         format_: Union[
-            str, schemas.PipelinesFormat
-        ] = schemas.PipelinesFormat.metadata_only,
+            str, mlrun.common.schemas.PipelinesFormat
+        ] = mlrun.common.schemas.PipelinesFormat.metadata_only,
         page_size: int = None,
-    ) -> schemas.PipelinesOutput:
+    ) -> mlrun.common.schemas.PipelinesOutput:
         pass
 
     def create_project_secrets(
         self,
         project: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: dict = None,
     ):
         pass
 
     def list_project_secrets(
         self,
         project: str,
         token: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: List[str] = None,
-    ) -> schemas.SecretsData:
+    ) -> mlrun.common.schemas.SecretsData:
         pass
 
     def list_project_secret_keys(
         self,
         project: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         token: str = None,
-    ) -> schemas.SecretKeysData:
+    ) -> mlrun.common.schemas.SecretKeysData:
         pass
 
     def delete_project_secrets(
         self,
         project: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: List[str] = None,
     ):
         pass
 
     def create_user_secrets(
         self,
         user: str,
         provider: Union[
-            str, schemas.SecretProviderName
-        ] = schemas.SecretProviderName.vault,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.vault,
         secrets: dict = None,
     ):
         pass
 
     def create_model_endpoint(
-        self, project: str, endpoint_id: str, model_endpoint: ModelEndpoint
+        self,
+        project: str,
+        endpoint_id: str,
+        model_endpoint: mlrun.common.schemas.ModelEndpoint,
     ):
         pass
 
     def delete_model_endpoint(self, project: str, endpoint_id: str):
         pass
 
     def list_model_endpoints(
@@ -413,51 +438,54 @@
         features: bool = False,
     ):
         pass
 
     def patch_model_endpoint(self, project: str, endpoint_id: str, attributes: dict):
         pass
 
-    def create_marketplace_source(
-        self, source: Union[dict, schemas.IndexedMarketplaceSource]
+    def create_hub_source(
+        self, source: Union[dict, mlrun.common.schemas.IndexedHubSource]
     ):
         pass
 
-    def store_marketplace_source(
-        self, source_name: str, source: Union[dict, schemas.IndexedMarketplaceSource]
+    def store_hub_source(
+        self,
+        source_name: str,
+        source: Union[dict, mlrun.common.schemas.IndexedHubSource],
     ):
         pass
 
-    def list_marketplace_sources(self):
+    def list_hub_sources(self):
         pass
 
-    def get_marketplace_source(self, source_name: str):
+    def get_hub_source(self, source_name: str):
         pass
 
-    def delete_marketplace_source(self, source_name: str):
+    def delete_hub_source(self, source_name: str):
         pass
 
-    def get_marketplace_catalog(
+    def get_hub_catalog(
         self,
         source_name: str,
         channel: str = None,
         version: str = None,
         tag: str = None,
         force_refresh: bool = False,
     ):
         pass
 
-    def get_marketplace_item(
+    def get_hub_item(
         self,
         source_name: str,
         item_name: str,
         channel: str = "development",
         version: str = None,
         tag: str = "latest",
         force_refresh: bool = False,
     ):
         pass
 
     def verify_authorization(
-        self, authorization_verification_input: schemas.AuthorizationVerificationInput
+        self,
+        authorization_verification_input: mlrun.common.schemas.AuthorizationVerificationInput,
     ):
         pass
```

## mlrun/db/sqldb.py

```diff
@@ -11,29 +11,28 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import datetime
 from typing import List, Optional, Union
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.model_monitoring.model_endpoint
 from mlrun.api.db.base import DBError
 from mlrun.api.db.sqldb.db import SQLDB as SQLAPIDB
 from mlrun.api.db.sqldb.session import create_session
 
 # This class is a proxy for the real implementation that sits under mlrun.api.db.sqldb
 # The runtime objects (which manages the resources that do the real logic, like Nuclio functions, Dask jobs, etc...)
 # require a RunDB to manage their state, when a user run them locally this db will either be the
 # local filedb or the remote httpdb (we decided that we don't want to support SQLDB as an optional RunDB).
 # When the user submits something to run (task, function etc...) this runtime managers actually runs inside the api
 # service, in order to prevent the api from calling itself several times for each submission request (since the runDB
 # will be httpdb to that same api service) we have this class which is kind of a proxy between the RunDB interface to
 # the api service's DB interface
-from ..api import schemas
 from .base import RunDBError, RunDBInterface
 
 
 class SQLDB(RunDBInterface):
     def __init__(
         self,
         dsn,
@@ -119,18 +118,20 @@
         sort=True,
         last=0,
         iter=None,
         start_time_from: datetime.datetime = None,
         start_time_to: datetime.datetime = None,
         last_update_time_from: datetime.datetime = None,
         last_update_time_to: datetime.datetime = None,
-        partition_by: Union[schemas.RunPartitionByField, str] = None,
+        partition_by: Union[mlrun.common.schemas.RunPartitionByField, str] = None,
         rows_per_partition: int = 1,
-        partition_sort_by: Union[schemas.SortField, str] = None,
-        partition_order: Union[schemas.OrderType, str] = schemas.OrderType.desc,
+        partition_sort_by: Union[mlrun.common.schemas.SortField, str] = None,
+        partition_order: Union[
+            mlrun.common.schemas.OrderType, str
+        ] = mlrun.common.schemas.OrderType.desc,
         max_partitions: int = 0,
         with_notifications: bool = False,
     ):
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Runs().list_runs,
@@ -212,20 +213,20 @@
         tag=None,
         labels=None,
         since=None,
         until=None,
         iter: int = None,
         best_iteration: bool = False,
         kind: str = None,
-        category: Union[str, schemas.ArtifactCategories] = None,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         import mlrun.api.crud
 
         if category and isinstance(category, str):
-            category = schemas.ArtifactCategories(category)
+            category = mlrun.common.schemas.ArtifactCategories(category)
 
         return self._transform_db_error(
             mlrun.api.crud.Artifacts().list_artifacts,
             self.session,
             project,
             name,
             tag,
@@ -305,25 +306,29 @@
             project=project,
             name=name,
             tag=tag,
             labels=labels,
         )
 
     def list_artifact_tags(
-        self, project=None, category: Union[str, schemas.ArtifactCategories] = None
+        self,
+        project=None,
+        category: Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ):
         return self._transform_db_error(
             self.db.list_artifact_tags, self.session, project
         )
 
     def tag_objects(
         self,
         project: str,
         tag_name: str,
-        tag_objects: mlrun.api.schemas.TagObjects,
+        tag_objects: Union[
+            mlrun.common.schemas.TagObjects, mlrun.common.schemas.TagObjects
+        ],
         replace: bool = False,
     ):
         import mlrun.api.crud
 
         if replace:
             return self._transform_db_error(
                 mlrun.api.crud.Tags().overwrite_object_tags_with_tag,
@@ -341,15 +346,17 @@
             tag_objects,
         )
 
     def delete_objects_tag(
         self,
         project: str,
         tag_name: str,
-        tag_objects: mlrun.api.schemas.TagObjects,
+        tag_objects: Union[
+            mlrun.common.schemas.TagObjects, mlrun.common.schemas.TagObjects
+        ],
     ):
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Tags().delete_tag_from_objects,
             self.session,
             project,
@@ -390,88 +397,93 @@
 
     def list_schedules(self):
         return self._transform_db_error(self.db.list_schedules, self.session)
 
     def store_project(
         self,
         name: str,
-        project: mlrun.api.schemas.Project,
-    ) -> mlrun.api.schemas.Project:
+        project: Union[mlrun.common.schemas.Project, mlrun.common.schemas.Project],
+    ) -> mlrun.common.schemas.Project:
         import mlrun.api.crud
 
         if isinstance(project, dict):
-            project = mlrun.api.schemas.Project(**project)
+            project = mlrun.common.schemas.Project(**project)
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().store_project,
             self.session,
             name=name,
             project=project,
         )
 
     def patch_project(
         self,
         name: str,
         project: dict,
-        patch_mode: mlrun.api.schemas.PatchMode = mlrun.api.schemas.PatchMode.replace,
-    ) -> mlrun.api.schemas.Project:
+        patch_mode: Union[
+            mlrun.common.schemas.PatchMode, mlrun.common.schemas.PatchMode
+        ] = mlrun.common.schemas.PatchMode.replace,
+    ) -> mlrun.common.schemas.Project:
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().patch_project,
             self.session,
             name=name,
             project=project,
             patch_mode=patch_mode,
         )
 
     def create_project(
         self,
-        project: mlrun.api.schemas.Project,
-    ) -> mlrun.api.schemas.Project:
+        project: Union[mlrun.common.schemas.Project, mlrun.common.schemas.Project],
+    ) -> mlrun.common.schemas.Project:
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().create_project,
             self.session,
             project=project,
         )
 
     def delete_project(
         self,
         name: str,
-        deletion_strategy: mlrun.api.schemas.DeletionStrategy = mlrun.api.schemas.DeletionStrategy.default(),
+        deletion_strategy: Union[
+            mlrun.common.schemas.DeletionStrategy,
+            mlrun.common.schemas.DeletionStrategy,
+        ] = mlrun.common.schemas.DeletionStrategy.default(),
     ):
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().delete_project,
             self.session,
             name=name,
             deletion_strategy=deletion_strategy,
         )
 
     def get_project(
         self, name: str = None, project_id: int = None
-    ) -> mlrun.api.schemas.Project:
+    ) -> mlrun.common.schemas.Project:
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().get_project,
             self.session,
             name=name,
         )
 
     def list_projects(
         self,
         owner: str = None,
-        format_: mlrun.api.schemas.ProjectsFormat = mlrun.api.schemas.ProjectsFormat.full,
+        format_: mlrun.common.schemas.ProjectsFormat = mlrun.common.schemas.ProjectsFormat.full,
         labels: List[str] = None,
-        state: mlrun.api.schemas.ProjectState = None,
-    ) -> mlrun.api.schemas.ProjectsOutput:
+        state: mlrun.common.schemas.ProjectState = None,
+    ) -> mlrun.common.schemas.ProjectsOutput:
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Projects().list_projects,
             self.session,
             owner=owner,
             format_=format_,
@@ -555,18 +567,18 @@
         project: str = "",
         name: str = None,
         tag: str = None,
         state: str = None,
         entities: List[str] = None,
         features: List[str] = None,
         labels: List[str] = None,
-        partition_by: mlrun.api.schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: mlrun.api.schemas.SortField = None,
-        partition_order: mlrun.api.schemas.OrderType = mlrun.api.schemas.OrderType.desc,
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
     ):
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().list_feature_sets,
             self.session,
             project,
@@ -580,25 +592,25 @@
             rows_per_partition,
             partition_sort_by,
             partition_order,
         )
 
     def store_feature_set(
         self,
-        feature_set: Union[dict, mlrun.api.schemas.FeatureSet],
+        feature_set: Union[dict, mlrun.common.schemas.FeatureSet],
         name=None,
         project="",
         tag=None,
         uid=None,
         versioned=True,
     ):
         import mlrun.api.crud
 
         if isinstance(feature_set, dict):
-            feature_set = mlrun.api.schemas.FeatureSet(**feature_set)
+            feature_set = mlrun.common.schemas.FeatureSet(**feature_set)
 
         name = name or feature_set.metadata.name
         project = project or feature_set.metadata.project
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().store_feature_set,
             self.session,
             project,
@@ -665,18 +677,18 @@
     def list_feature_vectors(
         self,
         project: str = "",
         name: str = None,
         tag: str = None,
         state: str = None,
         labels: List[str] = None,
-        partition_by: mlrun.api.schemas.FeatureStorePartitionByField = None,
+        partition_by: mlrun.common.schemas.FeatureStorePartitionByField = None,
         rows_per_partition: int = 1,
-        partition_sort_by: mlrun.api.schemas.SortField = None,
-        partition_order: mlrun.api.schemas.OrderType = mlrun.api.schemas.OrderType.desc,
+        partition_sort_by: mlrun.common.schemas.SortField = None,
+        partition_order: mlrun.common.schemas.OrderType = mlrun.common.schemas.OrderType.desc,
     ):
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.FeatureStore().list_feature_vectors,
             self.session,
             project,
@@ -750,67 +762,67 @@
         self,
         project: str,
         namespace: str = None,
         sort_by: str = "",
         page_token: str = "",
         filter_: str = "",
         format_: Union[
-            str, mlrun.api.schemas.PipelinesFormat
-        ] = mlrun.api.schemas.PipelinesFormat.metadata_only,
+            str, mlrun.common.schemas.PipelinesFormat
+        ] = mlrun.common.schemas.PipelinesFormat.metadata_only,
         page_size: int = None,
-    ) -> mlrun.api.schemas.PipelinesOutput:
+    ) -> mlrun.common.schemas.PipelinesOutput:
         raise NotImplementedError()
 
     def create_project_secrets(
         self,
         project: str,
         provider: Union[
-            str, mlrun.api.schemas.SecretProviderName
-        ] = mlrun.api.schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: dict = None,
     ):
         raise NotImplementedError()
 
     def list_project_secrets(
         self,
         project: str,
         token: str,
         provider: Union[
-            str, mlrun.api.schemas.SecretProviderName
-        ] = mlrun.api.schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: List[str] = None,
-    ) -> mlrun.api.schemas.SecretsData:
+    ) -> mlrun.common.schemas.SecretsData:
         raise NotImplementedError()
 
     def list_project_secret_keys(
         self,
         project: str,
         provider: Union[
-            str, mlrun.api.schemas.SecretProviderName
-        ] = mlrun.api.schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         token: str = None,
-    ) -> mlrun.api.schemas.SecretKeysData:
+    ) -> mlrun.common.schemas.SecretKeysData:
         raise NotImplementedError()
 
     def delete_project_secrets(
         self,
         project: str,
         provider: Union[
-            str, mlrun.api.schemas.SecretProviderName
-        ] = mlrun.api.schemas.SecretProviderName.kubernetes,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets: List[str] = None,
     ):
         raise NotImplementedError()
 
     def create_user_secrets(
         self,
         user: str,
         provider: Union[
-            str, mlrun.api.schemas.SecretProviderName
-        ] = mlrun.api.schemas.SecretProviderName.vault,
+            str, mlrun.common.schemas.SecretProviderName
+        ] = mlrun.common.schemas.SecretProviderName.vault,
         secrets: dict = None,
     ):
         raise NotImplementedError()
 
     def create_model_endpoint(
         self,
         project: str,
@@ -855,52 +867,54 @@
         self,
         project: str,
         endpoint_id: str,
         attributes: dict,
     ):
         raise NotImplementedError()
 
-    def create_marketplace_source(
-        self, source: Union[dict, schemas.IndexedMarketplaceSource]
+    def create_hub_source(
+        self, source: Union[dict, mlrun.common.schemas.IndexedHubSource]
     ):
         raise NotImplementedError()
 
-    def store_marketplace_source(
-        self, source_name: str, source: Union[dict, schemas.IndexedMarketplaceSource]
+    def store_hub_source(
+        self,
+        source_name: str,
+        source: Union[dict, mlrun.common.schemas.IndexedHubSource],
     ):
         raise NotImplementedError()
 
-    def list_marketplace_sources(self):
+    def list_hub_sources(self):
         raise NotImplementedError()
 
-    def get_marketplace_source(self, source_name: str):
+    def get_hub_source(self, source_name: str):
         raise NotImplementedError()
 
-    def delete_marketplace_source(self, source_name: str):
+    def delete_hub_source(self, source_name: str):
         raise NotImplementedError()
 
-    def get_marketplace_catalog(
+    def get_hub_catalog(
         self,
         source_name: str,
         version: str = None,
         tag: str = None,
         force_refresh: bool = False,
     ):
         raise NotImplementedError()
 
-    def get_marketplace_item(
+    def get_hub_item(
         self,
         source_name: str,
         item_name: str,
         version: str = None,
         tag: str = "latest",
         force_refresh: bool = False,
     ):
         raise NotImplementedError()
 
     def verify_authorization(
         self,
-        authorization_verification_input: mlrun.api.schemas.AuthorizationVerificationInput,
+        authorization_verification_input: mlrun.common.schemas.AuthorizationVerificationInput,
     ):
         # on server side authorization is done in endpoint anyway, so for server side we can "pass" on check
         # done from ingest()
         pass
```

## mlrun/feature_store/api.py

```diff
@@ -75,15 +75,15 @@
     elif isinstance(features, FeatureVector):
         vector = features
         if not vector.metadata.name:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "feature vector name must be specified"
             )
         verify_feature_vector_permissions(
-            vector, mlrun.api.schemas.AuthorizationAction.update
+            vector, mlrun.common.schemas.AuthorizationAction.update
         )
 
         vector.save()
     else:
         raise mlrun.errors.MLRunInvalidArgumentError(
             f"illegal features value/type ({type(features)})"
         )
@@ -443,15 +443,15 @@
     if run_config and not run_config.local:
         if isinstance(source, pd.DataFrame):
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "DataFrame source is illegal in conjunction with run_config"
             )
         # remote job execution
         verify_feature_set_permissions(
-            featureset, mlrun.api.schemas.AuthorizationAction.update
+            featureset, mlrun.common.schemas.AuthorizationAction.update
         )
         run_config = run_config.copy() if run_config else RunConfig()
         source, run_config.parameters = set_task_params(
             featureset, source, targets, run_config.parameters, infer_options, overwrite
         )
         name = f"{featureset.metadata.name}_ingest"
         schedule = source.schedule
@@ -475,15 +475,15 @@
             targets,
             infer_options,
             overwrite,
         ) = context_to_ingestion_params(mlrun_context)
 
         featureset.validate_steps(namespace=namespace)
         verify_feature_set_permissions(
-            featureset, mlrun.api.schemas.AuthorizationAction.update
+            featureset, mlrun.common.schemas.AuthorizationAction.update
         )
         if not source:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "data source was not specified"
             )
 
         filter_time_string = ""
@@ -504,18 +504,19 @@
             time_zone = min_time.tzinfo
             source.end_time = datetime.now(tz=time_zone)
             filter_time_string = (
                 f"Source.start_time for the job is{str(source.start_time)}. "
                 f"Source.end_time is {str(source.end_time)}"
             )
 
-    if mlrun_context:
-        mlrun_context.logger.info(
-            f"starting ingestion task to {featureset.uri}.{filter_time_string}"
-        )
+        if mlrun_context:
+            mlrun_context.logger.info(
+                f"starting ingestion task to {featureset.uri}.{filter_time_string}"
+            )
+
         return_df = False
 
     if featureset.spec.passthrough:
         featureset.spec.source = source
         featureset.spec.validate_no_processing_for_passthrough()
 
     if not namespace:
@@ -689,15 +690,15 @@
                 step.class_args["time_field"] = timestamp_key
 
     if isinstance(source, str):
         # if source is a path/url convert to DataFrame
         source = mlrun.store_manager.object(url=source).as_df()
 
     verify_feature_set_permissions(
-        featureset, mlrun.api.schemas.AuthorizationAction.update
+        featureset, mlrun.common.schemas.AuthorizationAction.update
     )
 
     featureset.spec.validate_no_processing_for_passthrough()
     featureset.validate_steps(namespace=namespace)
 
     namespace = namespace or get_caller_globals()
     if featureset.spec.require_processing():
@@ -714,15 +715,17 @@
                 source,
                 featureset,
                 entity_columns,
                 InferOptions.get_common_options(options, InferOptions.Entities),
             )
         # reduce the size of the ingestion if we do not infer stats
         rows_limit = (
-            0 if InferOptions.get_common_options(options, InferOptions.Stats) else 1000
+            None
+            if InferOptions.get_common_options(options, InferOptions.Stats)
+            else 1000
         )
         source = init_featureset_graph(
             source,
             featureset,
             namespace,
             return_df=True,
             verbose=verbose,
@@ -785,15 +788,15 @@
     :param run_config:    service runtime configuration (function object/uri, resources, etc..)
     :param verbose:       verbose log
     """
     if isinstance(featureset, str):
         featureset = get_feature_set_by_uri(featureset)
 
     verify_feature_set_permissions(
-        featureset, mlrun.api.schemas.AuthorizationAction.update
+        featureset, mlrun.common.schemas.AuthorizationAction.update
     )
 
     verify_feature_set_exists(featureset)
 
     run_config = run_config.copy() if run_config else RunConfig()
     if isinstance(source, StreamSource) and not source.path:
         source.path = get_default_prefix_for_source(source.kind).format(
```

## mlrun/feature_store/common.py

```diff
@@ -12,19 +12,19 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import typing
 from copy import copy
 
 import mlrun
 import mlrun.errors
-from mlrun.api.schemas import AuthorizationVerificationInput
+from mlrun.common.schemas import AuthorizationVerificationInput
 from mlrun.runtimes import BaseRuntime
 from mlrun.runtimes.function_reference import FunctionReference
 from mlrun.runtimes.utils import enrich_function_from_dict
-from mlrun.utils import StorePrefix, logger, mlconf, parse_versioned_object_uri
+from mlrun.utils import StorePrefix, logger, parse_versioned_object_uri
 
 from ..config import config
 
 project_separator = "/"
 feature_separator = "."
 expected_message = f"in the form feature-set{feature_separator}feature[ as alias]"
 
@@ -82,21 +82,21 @@
 
 
 def get_feature_set_by_uri(uri, project=None):
     """get feature set object from db by uri"""
     db = mlrun.get_run_db()
     project, name, tag, uid = parse_feature_set_uri(uri, project)
     resource = (
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set.to_resource_string(
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set.to_resource_string(
             project, "feature-set"
         )
     )
 
     auth_input = AuthorizationVerificationInput(
-        resource=resource, action=mlrun.api.schemas.AuthorizationAction.read
+        resource=resource, action=mlrun.common.schemas.AuthorizationAction.read
     )
     db.verify_authorization(auth_input)
 
     return db.get_feature_set(name, project, tag, uid)
 
 
 def get_feature_vector_by_uri(uri, project=None, update=True):
@@ -111,41 +111,39 @@
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"provided store uri ({uri}) does not represent a feature vector (prefix={prefix})"
             )
         uri = new_uri
 
     project, name, tag, uid = parse_versioned_object_uri(uri, default_project)
 
-    resource = (
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector.to_resource_string(
-            project, "feature-vector"
-        )
+    resource = mlrun.common.schemas.AuthorizationResourceTypes.feature_vector.to_resource_string(
+        project, "feature-vector"
     )
 
     if update:
         auth_input = AuthorizationVerificationInput(
-            resource=resource, action=mlrun.api.schemas.AuthorizationAction.update
+            resource=resource, action=mlrun.common.schemas.AuthorizationAction.update
         )
     else:
         auth_input = AuthorizationVerificationInput(
-            resource=resource, action=mlrun.api.schemas.AuthorizationAction.read
+            resource=resource, action=mlrun.common.schemas.AuthorizationAction.read
         )
 
     db.verify_authorization(auth_input)
 
     return db.get_feature_vector(name, project, tag, uid)
 
 
 def verify_feature_set_permissions(
-    feature_set, action: mlrun.api.schemas.AuthorizationAction
+    feature_set, action: mlrun.common.schemas.AuthorizationAction
 ):
     project, _, _, _ = parse_feature_set_uri(feature_set.uri)
 
     resource = (
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_set.to_resource_string(
+        mlrun.common.schemas.AuthorizationResourceTypes.feature_set.to_resource_string(
             project, "feature-set"
         )
     )
     db = feature_set._get_run_db()
 
     auth_input = AuthorizationVerificationInput(resource=resource, action=action)
     db.verify_authorization(auth_input)
@@ -160,22 +158,20 @@
         if not fset.spec.features:
             raise mlrun.errors.MLRunNotFoundError(f"feature set {uri} is empty")
     except mlrun.errors.MLRunNotFoundError:
         raise mlrun.errors.MLRunNotFoundError(f"feature set {uri} does not exist")
 
 
 def verify_feature_vector_permissions(
-    feature_vector, action: mlrun.api.schemas.AuthorizationAction
+    feature_vector, action: mlrun.common.schemas.AuthorizationAction
 ):
-    project = feature_vector._metadata.project or mlconf.default_project
+    project = feature_vector._metadata.project or config.default_project
 
-    resource = (
-        mlrun.api.schemas.AuthorizationResourceTypes.feature_vector.to_resource_string(
-            project, "feature-vector"
-        )
+    resource = mlrun.common.schemas.AuthorizationResourceTypes.feature_vector.to_resource_string(
+        project, "feature-vector"
     )
 
     db = mlrun.get_run_db()
     auth_input = AuthorizationVerificationInput(resource=resource, action=action)
     db.verify_authorization(auth_input)
```

## mlrun/feature_store/feature_set.py

```diff
@@ -15,15 +15,15 @@
 from datetime import datetime
 from typing import Dict, List, Optional, Union
 
 import pandas as pd
 from storey import EmitEveryEvent, EmitPolicy
 
 import mlrun
-import mlrun.api.schemas
+import mlrun.common.schemas
 
 from ..config import config as mlconf
 from ..datastore import get_store_uri
 from ..datastore.sources import BaseSourceDriver, source_kind_to_driver
 from ..datastore.targets import (
     TargetTypes,
     get_default_targets,
@@ -313,15 +313,15 @@
         struct["maxEvents"] = getattr(policy, "max_events")
     return struct
 
 
 class FeatureSet(ModelObj):
     """Feature set object, defines a set of features and their data pipeline"""
 
-    kind = mlrun.api.schemas.ObjectKind.feature_set.value
+    kind = mlrun.common.schemas.ObjectKind.feature_set.value
     _dict_fields = ["kind", "metadata", "spec", "status"]
 
     def __init__(
         self,
         name: str = None,
         description: str = None,
         entities: List[Union[Entity, str]] = None,
@@ -525,15 +525,15 @@
 
     def purge_targets(self, target_names: List[str] = None, silent: bool = False):
         """Delete data of specific targets
         :param target_names: List of names of targets to delete (default: delete all ingested targets)
         :param silent: Fail silently if target doesn't exist in featureset status"""
 
         verify_feature_set_permissions(
-            self, mlrun.api.schemas.AuthorizationAction.delete
+            self, mlrun.common.schemas.AuthorizationAction.delete
         )
 
         purge_targets = self._reload_and_get_status_targets(
             target_names=target_names, silent=silent
         )
 
         if purge_targets:
@@ -926,15 +926,19 @@
             columns = entities + columns
 
         if self.spec.passthrough:
             if not self.spec.source:
                 raise mlrun.errors.MLRunNotFoundError(
                     "passthrough feature set {self.metadata.name} with no source"
                 )
-            return self.spec.source.to_dataframe()
+            df = self.spec.source.to_dataframe()
+            # to_dataframe() can sometimes return an iterator of dataframes instead of one dataframe
+            if not isinstance(df, pd.DataFrame):
+                df = pd.concat(df)
+            return df
 
         target = get_offline_target(self, name=target_name)
         if not target:
             raise mlrun.errors.MLRunNotFoundError(
                 "there are no offline targets for this feature set"
             )
         result = target.as_df(
```

## mlrun/feature_store/feature_vector.py

```diff
@@ -150,15 +150,15 @@
     def features(self, features: List[Feature]):
         self._features = ObjectList.from_list(Feature, features)
 
 
 class FeatureVector(ModelObj):
     """Feature vector, specify selected features, their metadata and material views"""
 
-    kind = mlrun.api.schemas.ObjectKind.feature_vector.value
+    kind = mlrun.common.schemas.ObjectKind.feature_vector.value
     _dict_fields = ["kind", "metadata", "spec", "status"]
 
     def __init__(
         self,
         name=None,
         features=None,
         label_feature=None,
```

## mlrun/feature_store/ingestion.py

```diff
@@ -85,52 +85,49 @@
     else:
         chunks = [source]
 
     entity_columns = list(featureset.spec.entities.keys())
     key_fields = entity_columns if entity_columns else None
 
     sizes = [0] * len(targets)
-    data_result = None
+    result_dfs = []
     total_rows = 0
     targets = [get_target_driver(target, featureset) for target in targets]
     if featureset.spec.passthrough:
         targets = [target for target in targets if not target.is_offline]
     for chunk in chunks:
         event = MockEvent(body=chunk)
         if len(featureset.spec.entities) and isinstance(event.body, pd.DataFrame):
             # set the entities to be the indexes of the df
             event.body = entities_to_index(featureset, event.body)
 
-        data = server.run(event, get_body=True)
-        if data is not None:
+        df = server.run(event, get_body=True)
+        if df is not None:
             for i, target in enumerate(targets):
                 size = target.write_dataframe(
-                    data,
+                    df,
                     key_column=key_fields,
                     timestamp_key=featureset.spec.timestamp_key,
                     chunk_id=chunk_id,
                 )
                 if size:
                     sizes[i] += size
         chunk_id += 1
-        if data_result is None:
-            # in case of multiple chunks only return the first chunk (last may be too small)
-            data_result = data
-        total_rows += data.shape[0]
+        result_dfs.append(df)
+        total_rows += df.shape[0]
         if rows_limit and total_rows >= rows_limit:
             break
 
-    # todo: fire termination event if iterator
-
     for i, target in enumerate(targets):
         target_status = target.update_resource_status("ready", size=sizes[i])
         if verbose:
             logger.info(f"wrote target: {target_status}")
 
-    return data_result
+    result_df = pd.concat(result_dfs)
+    return result_df.head(rows_limit)
 
 
 def featureset_initializer(server):
     """graph server hook to initialize feature set ingestion graph/DAG"""
 
     context = server.context
     cache = server.resource_cache
```

## mlrun/model_monitoring/__init__.py

```diff
@@ -13,30 +13,29 @@
 # limitations under the License.
 #
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 # for backwards compatibility
 
 __all__ = [
     "ModelEndpoint",
-    "ModelMonitoringMode",
-    "EndpointType",
-    "create_model_endpoint_uid",
     "EventFieldType",
     "EventLiveStats",
     "EventKeyMetrics",
     "TimeSeriesTarget",
     "ModelEndpointTarget",
+    "FileTargetKind",
     "ProjectSecretKeys",
     "ModelMonitoringStoreKinds",
 ]
 
-from .common import EndpointType, ModelMonitoringMode, create_model_endpoint_uid
-from .constants import (
+from mlrun.common.model_monitoring import (
     EventFieldType,
     EventKeyMetrics,
     EventLiveStats,
+    FileTargetKind,
     ModelEndpointTarget,
     ModelMonitoringStoreKinds,
     ProjectSecretKeys,
     TimeSeriesTarget,
 )
+
 from .model_endpoint import ModelEndpoint
```

## mlrun/model_monitoring/helpers.py

```diff
@@ -9,62 +9,71 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import pathlib
+import typing
 
 import sqlalchemy.orm
+from fastapi import Depends
 
 import mlrun
 import mlrun.api.api.utils
 import mlrun.api.crud.secrets
 import mlrun.api.utils.singletons.db
+import mlrun.api.utils.singletons.k8s
+import mlrun.common.model_monitoring as model_monitoring_constants
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.feature_store as fstore
-import mlrun.model_monitoring.constants as model_monitoring_constants
 import mlrun.model_monitoring.stream_processing_fs
 import mlrun.runtimes
 import mlrun.utils.helpers
+import mlrun.utils.model_monitoring
+from mlrun.api.api import deps
 
 _CURRENT_FILE_PATH = pathlib.Path(__file__)
 _STREAM_PROCESSING_FUNCTION_PATH = _CURRENT_FILE_PATH.parent / "stream_processing_fs.py"
 _MONIOTINRG_BATCH_FUNCTION_PATH = (
     _CURRENT_FILE_PATH.parent / "model_monitoring_batch.py"
 )
 
 
 def initial_model_monitoring_stream_processing_function(
     project: str,
     model_monitoring_access_key: str,
-    db_session: sqlalchemy.orm.Session,
     tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
+    auth_info: mlrun.common.schemas.AuthInfo,
+    parquet_target: str,
 ):
     """
     Initialize model monitoring stream processing function.
 
-    :param project:                     project name.
-    :param model_monitoring_access_key: access key to apply the model monitoring process.
-    :param db_session:                  A session that manages the current dialog with the database.
+    :param project:                     Project name.
+    :param model_monitoring_access_key: Access key to apply the model monitoring process. Please note that in CE
+                                        deployments this parameter will be None.
     :param tracking_policy:             Model monitoring configurations.
+    :param auth_info:                   The auth info of the request.
+    :parquet_target:                    Path to model monitoring parquet file that will be generated by the monitoring
+                                        stream nuclio function.
 
     :return:                            A function object from a mlrun runtime class
 
     """
 
     # Initialize Stream Processor object
     stream_processor = mlrun.model_monitoring.stream_processing_fs.EventStreamProcessor(
         project=project,
-        model_monitoring_access_key=model_monitoring_access_key,
         parquet_batching_max_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
+        parquet_target=parquet_target,
+        model_monitoring_access_key=model_monitoring_access_key,
     )
 
-    http_source = mlrun.datastore.sources.HttpSource()
-
     # Create a new serving function for the streaming process
     function = mlrun.code_to_function(
         name="model-monitoring-stream",
         project=project,
         filename=str(_STREAM_PROCESSING_FUNCTION_PATH),
         kind="serving",
         image=tracking_policy.stream_image,
@@ -72,54 +81,42 @@
 
     # Create monitoring serving graph
     stream_processor.apply_monitoring_serving_graph(function)
 
     # Set the project to the serving function
     function.metadata.project = project
 
-    # Add v3io stream trigger
-    stream_path = mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default.format(
-        project=project, kind="stream"
-    )
-    function.add_v3io_stream_trigger(
-        stream_path=stream_path, name="monitoring_stream_trigger"
-    )
-
-    # Set model monitoring access key for managing permissions
-    function.set_env_from_secret(
-        model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY,
-        mlrun.api.utils.singletons.k8s.get_k8s().get_project_secret_name(project),
-        mlrun.api.crud.secrets.Secrets().generate_client_project_secret_key(
-            mlrun.api.crud.secrets.SecretsClientType.model_monitoring,
-            model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY,
-        ),
+    # Add stream triggers
+    function = _apply_stream_trigger(
+        project=project,
+        function=function,
+        model_monitoring_access_key=model_monitoring_access_key,
+        auth_info=auth_info,
     )
 
+    # Apply feature store run configurations on the serving function
     run_config = fstore.RunConfig(function=function, local=False)
     function.spec.parameters = run_config.parameters
 
-    func = http_source.add_nuclio_trigger(function)
-    func.metadata.credentials.access_key = model_monitoring_access_key
-    func.apply(mlrun.v3io_cred())
-
-    return func
+    return function
 
 
 def get_model_monitoring_batch_function(
     project: str,
     model_monitoring_access_key: str,
     db_session: sqlalchemy.orm.Session,
-    auth_info: mlrun.api.schemas.AuthInfo,
+    auth_info: mlrun.common.schemas.AuthInfo,
     tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
 ):
     """
     Initialize model monitoring batch function.
 
     :param project:                     project name.
-    :param model_monitoring_access_key: access key to apply the model monitoring process.
+    :param model_monitoring_access_key: access key to apply the model monitoring process. Please note that in CE
+                                        deployments this parameter will be None.
     :param db_session:                  A session that manages the current dialog with the database.
     :param auth_info:                   The auth info of the request.
     :param tracking_policy:             Model monitoring configurations.
 
     :return:                            A function object from a mlrun runtime class
 
     """
@@ -134,26 +131,113 @@
         handler="handler",
     )
     function.set_db_connection(mlrun.api.api.utils.get_run_db_instance(db_session))
 
     # Set the project to the job function
     function.metadata.project = project
 
+    if not mlrun.mlconf.is_ce_mode():
+        function = _apply_access_key_and_mount_function(
+            project=project,
+            function=function,
+            model_monitoring_access_key=model_monitoring_access_key,
+            auth_info=auth_info,
+        )
+
+    # Enrich runtime with the required configurations
+    mlrun.api.api.utils.apply_enrichment_and_validation_on_function(function, auth_info)
+
+    return function
+
+
+def _apply_stream_trigger(
+    project: str,
+    function: mlrun.runtimes.ServingRuntime,
+    model_monitoring_access_key: str = None,
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
+) -> mlrun.runtimes.ServingRuntime:
+    """Adding stream source for the nuclio serving function. By default, the function has HTTP stream trigger along
+    with another supported stream source that can be either Kafka or V3IO, depends on the stream path schema that is
+    defined under mlrun.mlconf.model_endpoint_monitoring.store_prefixes. Note that if no valid stream path has been
+    provided then the function will have a single HTTP stream source.
+
+    :param project:                     Project name.
+    :param function:                    The serving function object that will be applied with the stream trigger.
+    :param model_monitoring_access_key: Access key to apply the model monitoring stream function when the stream is
+                                        schema is V3IO.
+    :param auth_info:                   The auth info of the request.
+
+    :return: ServingRuntime object with stream trigger.
+    """
+
+    # Get the stream path from the configuration
+    # stream_path = mlrun.mlconf.get_file_target_path(project=project, kind="stream", target="stream")
+    stream_path = mlrun.utils.model_monitoring.get_stream_path(project=project)
+
+    if stream_path.startswith("kafka://"):
+
+        topic, brokers = mlrun.datastore.utils.parse_kafka_url(url=stream_path)
+        # Generate Kafka stream source
+        stream_source = mlrun.datastore.sources.KafkaSource(
+            brokers=brokers,
+            topics=[topic],
+        )
+        function = stream_source.add_nuclio_trigger(function)
+
+    if not mlrun.mlconf.is_ce_mode():
+        function = _apply_access_key_and_mount_function(
+            project=project,
+            function=function,
+            model_monitoring_access_key=model_monitoring_access_key,
+            auth_info=auth_info,
+        )
+        if stream_path.startswith("v3io://"):
+            # Generate V3IO stream trigger
+            function.add_v3io_stream_trigger(
+                stream_path=stream_path, name="monitoring_stream_trigger"
+            )
+    # Add the default HTTP source
+    http_source = mlrun.datastore.sources.HttpSource()
+    function = http_source.add_nuclio_trigger(function)
+
+    return function
+
+
+def _apply_access_key_and_mount_function(
+    project: str,
+    function: typing.Union[
+        mlrun.runtimes.KubejobRuntime, mlrun.runtimes.ServingRuntime
+    ],
+    model_monitoring_access_key: str,
+    auth_info: mlrun.common.schemas.AuthInfo,
+) -> typing.Union[mlrun.runtimes.KubejobRuntime, mlrun.runtimes.ServingRuntime]:
+    """Applying model monitoring access key on the provided function when using V3IO path. In addition, this method
+    mount the V3IO path for the provided function to configure the access to the system files.
+
+    :param project:                     Project name.
+    :param function:                    Model monitoring function object that will be filled with the access key and
+                                        the access to the system files.
+    :param model_monitoring_access_key: Access key to apply the model monitoring stream function when the stream is
+                                        schema is V3IO.
+    :param auth_info:                   The auth info of the request.
+
+    :return: function runtime object with access key and access to system files.
+    """
+
     # Set model monitoring access key for managing permissions
     function.set_env_from_secret(
         model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY,
-        mlrun.api.utils.singletons.k8s.get_k8s().get_project_secret_name(project),
+        mlrun.api.utils.singletons.k8s.get_k8s_helper().get_project_secret_name(
+            project
+        ),
         mlrun.api.crud.secrets.Secrets().generate_client_project_secret_key(
             mlrun.api.crud.secrets.SecretsClientType.model_monitoring,
             model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY,
         ),
     )
-
-    function.apply(mlrun.mount_v3io())
-
-    # Needs to be a member of the project and have access to project data path
     function.metadata.credentials.access_key = model_monitoring_access_key
+    function.apply(mlrun.mount_v3io())
 
     # Ensure that the auth env vars are set
     mlrun.api.api.utils.ensure_function_has_auth_set(function, auth_info)
 
     return function
```

## mlrun/model_monitoring/model_endpoint.py

```diff
@@ -12,17 +12,20 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 from typing import Any, Dict, List, Optional
 
 import mlrun.model
-
-from .common import EndpointType, ModelMonitoringMode
-from .constants import EventKeyMetrics, EventLiveStats
+from mlrun.common.model_monitoring import (
+    EndpointType,
+    EventKeyMetrics,
+    EventLiveStats,
+    ModelMonitoringMode,
+)
 
 
 class ModelEndpointSpec(mlrun.model.ModelObj):
     def __init__(
         self,
         function_uri: Optional[str] = "",
         model: Optional[str] = "",
```

## mlrun/model_monitoring/model_monitoring_batch.py

```diff
@@ -24,15 +24,16 @@
 import numpy as np
 import pandas as pd
 import v3io
 import v3io.dataplane
 import v3io_frames
 
 import mlrun
-import mlrun.api.schemas
+import mlrun.common.model_monitoring
+import mlrun.common.schemas
 import mlrun.data_types.infer
 import mlrun.feature_store as fstore
 import mlrun.model_monitoring
 import mlrun.model_monitoring.stores
 import mlrun.run
 import mlrun.utils.helpers
 import mlrun.utils.model_monitoring
@@ -491,198 +492,196 @@
     Note that the BatchProcessor object requires access keys along with valid project configurations.
     """
 
     def __init__(
         self,
         context: mlrun.run.MLClientCtx,
         project: str,
-        model_monitoring_access_key: str,
-        v3io_access_key: str,
     ):
 
         """
         Initialize Batch Processor object.
 
         :param context:                     An MLRun context.
         :param project:                     Project name.
-        :param model_monitoring_access_key: Access key to apply the model monitoring process.
-        :param v3io_access_key:             Token key for v3io.
         """
         self.context = context
         self.project = project
 
-        self.v3io_access_key = v3io_access_key
-        self.model_monitoring_access_key = (
-            model_monitoring_access_key or v3io_access_key
-        )
-
         # Initialize virtual drift object
         self.virtual_drift = VirtualDrift(inf_capping=10)
 
-        # Define the required paths for the project objects.
-        # Note that the kv table, tsdb, and the input stream paths are located at the default location
-        # while the parquet path is located at the user-space location
-        template = mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default
-        kv_path = template.format(project=self.project, kind="endpoints")
-        (
-            _,
-            self.kv_container,
-            self.kv_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(kv_path)
-        tsdb_path = template.format(project=project, kind="events")
-        (
-            _,
-            self.tsdb_container,
-            self.tsdb_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(tsdb_path)
-        stream_path = template.format(project=self.project, kind="log_stream")
-        (
-            _,
-            self.stream_container,
-            self.stream_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(stream_path)
-        self.parquet_path = (
-            mlrun.mlconf.model_endpoint_monitoring.store_prefixes.user_space.format(
-                project=project, kind="parquet"
-            )
-        )
-
         logger.info(
             "Initializing BatchProcessor",
             project=project,
-            model_monitoring_access_key_initalized=bool(model_monitoring_access_key),
-            v3io_access_key_initialized=bool(v3io_access_key),
-            parquet_path=self.parquet_path,
-            kv_container=self.kv_container,
-            kv_path=self.kv_path,
-            tsdb_container=self.tsdb_container,
-            tsdb_path=self.tsdb_path,
-            stream_container=self.stream_container,
-            stream_path=self.stream_path,
         )
 
         # Get drift thresholds from the model monitoring configuration
         self.default_possible_drift_threshold = (
             mlrun.mlconf.model_endpoint_monitoring.drift_thresholds.default.possible_drift
         )
         self.default_drift_detected_threshold = (
             mlrun.mlconf.model_endpoint_monitoring.drift_thresholds.default.drift_detected
         )
 
         # Get a runtime database
-        # self.db = mlrun.get_run_db()
+
         self.db = mlrun.model_monitoring.stores.get_model_endpoint_store(
             project=project
         )
 
-        # Get the frames clients based on the v3io configuration
-        # it will be used later for writing the results into the tsdb
-        self.v3io = mlrun.utils.v3io_clients.get_v3io_client(
-            access_key=self.v3io_access_key
-        )
-        self.frames = mlrun.utils.v3io_clients.get_frames_client(
-            address=mlrun.mlconf.v3io_framesd,
-            container=self.tsdb_container,
-            token=self.v3io_access_key,
-        )
+        if not mlrun.mlconf.is_ce_mode():
+            # TODO: Once there is a time series DB alternative in a non-CE deployment, we need to update this if
+            #  statement to be applied only for V3IO TSDB
+            self._initialize_v3io_configurations()
 
         # If an error occurs, it will be raised using the following argument
         self.exception = None
 
         # Get the batch interval range
         self.batch_dict = context.parameters[
-            mlrun.model_monitoring.EventFieldType.BATCH_INTERVALS_DICT
+            mlrun.common.model_monitoring.EventFieldType.BATCH_INTERVALS_DICT
         ]
 
-        # TODO: This will be removed in 1.2.0 once the job params can be parsed with different types
+        # TODO: This will be removed in 1.5.0 once the job params can be parsed with different types
         # Convert batch dict string into a dictionary
         if isinstance(self.batch_dict, str):
             self._parse_batch_dict_str()
 
+    def _initialize_v3io_configurations(self):
+        self.v3io_access_key = os.environ.get("V3IO_ACCESS_KEY")
+        self.model_monitoring_access_key = (
+            os.environ.get("MODEL_MONITORING_ACCESS_KEY") or self.v3io_access_key
+        )
+
+        # Define the required paths for the project objects
+        tsdb_path = mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=self.project,
+            kind=mlrun.common.model_monitoring.FileTargetKind.EVENTS,
+        )
+        (
+            _,
+            self.tsdb_container,
+            self.tsdb_path,
+        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(tsdb_path)
+        # stream_path = template.format(project=self.project, kind="log_stream")
+        stream_path = mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=self.project,
+            kind=mlrun.common.model_monitoring.FileTargetKind.LOG_STREAM,
+        )
+        (
+            _,
+            self.stream_container,
+            self.stream_path,
+        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(stream_path)
+
+        # Get the frames clients based on the v3io configuration
+        # it will be used later for writing the results into the tsdb
+        self.v3io = mlrun.utils.v3io_clients.get_v3io_client(
+            access_key=self.v3io_access_key
+        )
+        self.frames = mlrun.utils.v3io_clients.get_frames_client(
+            address=mlrun.mlconf.v3io_framesd,
+            container=self.tsdb_container,
+            token=self.v3io_access_key,
+        )
+
     def post_init(self):
         """
         Preprocess of the batch processing.
         """
 
-        # create v3io stream based on the input stream
-        response = self.v3io.create_stream(
-            container=self.stream_container,
-            path=self.stream_path,
-            shard_count=1,
-            raise_for_status=v3io.dataplane.RaiseForStatus.never,
-            access_key=self.v3io_access_key,
-        )
+        if not mlrun.mlconf.is_ce_mode():
+            # Create v3io stream based on the input stream
+            response = self.v3io.create_stream(
+                container=self.stream_container,
+                path=self.stream_path,
+                shard_count=1,
+                raise_for_status=v3io.dataplane.RaiseForStatus.never,
+                access_key=self.v3io_access_key,
+            )
 
-        if not (response.status_code == 400 and "ResourceInUse" in str(response.body)):
-            response.raise_for_status([409, 204, 403])
+            if not (
+                response.status_code == 400 and "ResourceInUse" in str(response.body)
+            ):
+                response.raise_for_status([409, 204, 403])
+        pass
 
     def run(self):
         """
         Main method for manage the drift analysis and write the results into tsdb and KV table.
         """
         # Get model endpoints (each deployed project has at least 1 serving model):
         try:
             endpoints = self.db.list_model_endpoints()
         except Exception as e:
             logger.error("Failed to list endpoints", exc=e)
             return
 
         for endpoint in endpoints:
             if (
-                endpoint[mlrun.model_monitoring.EventFieldType.ACTIVE]
-                and endpoint[mlrun.model_monitoring.EventFieldType.MONITORING_MODE]
-                == mlrun.model_monitoring.ModelMonitoringMode.enabled.value
+                endpoint[mlrun.common.model_monitoring.EventFieldType.ACTIVE]
+                and endpoint[
+                    mlrun.common.model_monitoring.EventFieldType.MONITORING_MODE
+                ]
+                == mlrun.common.model_monitoring.ModelMonitoringMode.enabled.value
             ):
                 # Skip router endpoint:
                 if (
-                    int(endpoint[mlrun.model_monitoring.EventFieldType.ENDPOINT_TYPE])
-                    == mlrun.model_monitoring.EndpointType.ROUTER
+                    int(
+                        endpoint[
+                            mlrun.common.model_monitoring.EventFieldType.ENDPOINT_TYPE
+                        ]
+                    )
+                    == mlrun.common.model_monitoring.EndpointType.ROUTER
                 ):
                     # Router endpoint has no feature stats
                     logger.info(
-                        f"{endpoint[mlrun.model_monitoring.EventFieldType.UID]} is router skipping"
+                        f"{endpoint[mlrun.common.model_monitoring.EventFieldType.UID]} is router skipping"
                     )
                     continue
                 self.update_drift_metrics(endpoint=endpoint)
 
     def update_drift_metrics(self, endpoint: dict):
         try:
             # Convert feature set into dataframe and get the latest dataset
             (
                 _,
                 serving_function_name,
                 _,
                 _,
             ) = mlrun.utils.helpers.parse_versioned_object_uri(
-                endpoint[mlrun.model_monitoring.EventFieldType.FUNCTION_URI]
+                endpoint[mlrun.common.model_monitoring.EventFieldType.FUNCTION_URI]
             )
 
-            model_name = endpoint[mlrun.model_monitoring.EventFieldType.MODEL].replace(
-                ":", "-"
-            )
+            model_name = endpoint[
+                mlrun.common.model_monitoring.EventFieldType.MODEL
+            ].replace(":", "-")
 
             m_fs = fstore.get_feature_set(
                 f"store://feature-sets/{self.project}/monitoring-{serving_function_name}-{model_name}"
             )
 
             # Getting batch interval start time and end time
-            start_time, end_time = self.get_interval_range()
+            start_time, end_time = self._get_interval_range()
 
             try:
                 df = m_fs.to_dataframe(
                     start_time=start_time,
                     end_time=end_time,
-                    time_column="timestamp",
+                    time_column=mlrun.common.model_monitoring.EventFieldType.TIMESTAMP,
                 )
 
                 if len(df) == 0:
                     logger.warn(
                         "Not enough model events since the beginning of the batch interval",
                         parquet_target=m_fs.status.targets[0].path,
-                        endpoint=endpoint[mlrun.model_monitoring.EventFieldType.UID],
+                        endpoint=endpoint[
+                            mlrun.common.model_monitoring.EventFieldType.UID
+                        ],
                         min_rqeuired_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
                         start_time=str(
                             datetime.datetime.now() - datetime.timedelta(hours=1)
                         ),
                         end_time=str(datetime.datetime.now()),
                     )
                     return
@@ -691,53 +690,58 @@
             #       as expected. In that case, the existence of the file will be checked before trying to get
             #       the offline data from the feature set.
             # Continue if not enough events provided since the deployment of the model endpoint
             except FileNotFoundError:
                 logger.warn(
                     "Parquet not found, probably due to not enough model events",
                     parquet_target=m_fs.status.targets[0].path,
-                    endpoint=endpoint[mlrun.model_monitoring.EventFieldType.UID],
+                    endpoint=endpoint[mlrun.common.model_monitoring.EventFieldType.UID],
                     min_rqeuired_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
                 )
                 return
 
             # Get feature names from monitoring feature set
             feature_names = [
                 feature_name["name"] for feature_name in m_fs.spec.features.to_dict()
             ]
+
             # Create DataFrame based on the input features
             stats_columns = [
-                "timestamp",
+                mlrun.common.model_monitoring.EventFieldType.TIMESTAMP,
                 *feature_names,
             ]
+
             # Add label names if provided
-            if endpoint[mlrun.model_monitoring.EventFieldType.LABEL_NAMES]:
-                labels = endpoint[mlrun.model_monitoring.EventFieldType.LABEL_NAMES]
+            if endpoint[mlrun.common.model_monitoring.EventFieldType.LABEL_NAMES]:
+                labels = endpoint[
+                    mlrun.common.model_monitoring.EventFieldType.LABEL_NAMES
+                ]
                 if isinstance(labels, str):
                     labels = json.loads(labels)
                 stats_columns.extend(labels)
-
             named_features_df = df[stats_columns].copy()
 
             # Infer feature set stats and schema
             fstore.api._infer_from_static_df(
                 named_features_df,
                 m_fs,
                 options=mlrun.data_types.infer.InferOptions.all_stats(),
             )
 
             # Save feature set to apply changes
             m_fs.save()
 
             # Get the timestamp of the latest request:
-            timestamp = df["timestamp"].iloc[-1]
+            timestamp = df[mlrun.common.model_monitoring.EventFieldType.TIMESTAMP].iloc[
+                -1
+            ]
 
             # Get the feature stats from the model endpoint for reference data
             feature_stats = json.loads(
-                endpoint[mlrun.model_monitoring.EventFieldType.FEATURE_STATS]
+                endpoint[mlrun.common.model_monitoring.EventFieldType.FEATURE_STATS]
             )
 
             # Get the current stats:
             current_stats = calculate_inputs_statistics(
                 sample_set_statistics=feature_stats,
                 inputs=named_features_df,
             )
@@ -750,15 +754,15 @@
             )
             logger.info("Drift result", drift_result=drift_result)
 
             # Get drift thresholds from the model configuration:
             monitor_configuration = (
                 json.loads(
                     endpoint[
-                        mlrun.model_monitoring.EventFieldType.MONITOR_CONFIGURATION
+                        mlrun.common.model_monitoring.EventFieldType.MONITOR_CONFIGURATION
                     ]
                 )
                 or {}
             )
             possible_drift = monitor_configuration.get(
                 "possible_drift", self.default_possible_drift_threshold
             )
@@ -770,99 +774,60 @@
             drift_status, drift_measure = self.virtual_drift.check_for_drift(
                 metrics_results_dictionary=drift_result,
                 possible_drift_threshold=possible_drift,
                 drift_detected_threshold=drift_detected,
             )
             logger.info(
                 "Drift status",
-                endpoint_id=endpoint[mlrun.model_monitoring.EventFieldType.UID],
+                endpoint_id=endpoint[mlrun.common.model_monitoring.EventFieldType.UID],
                 drift_status=drift_status.value,
                 drift_measure=drift_measure,
             )
 
-            # If drift was detected, add the results to the input stream
-            if (
-                drift_status == DriftStatus.POSSIBLE_DRIFT
-                or drift_status == DriftStatus.DRIFT_DETECTED
-            ):
-                self.v3io.stream.put_records(
-                    container=self.stream_container,
-                    stream_path=self.stream_path,
-                    records=[
-                        {
-                            "data": json.dumps(
-                                {
-                                    "endpoint_id": endpoint[
-                                        mlrun.model_monitoring.EventFieldType.UID
-                                    ],
-                                    "drift_status": drift_status.value,
-                                    "drift_measure": drift_measure,
-                                    "drift_per_feature": {**drift_result},
-                                }
-                            )
-                        }
-                    ],
-                )
-
             attributes = {
                 "current_stats": json.dumps(current_stats),
                 "drift_measures": json.dumps(drift_result),
                 "drift_status": drift_status.value,
             }
 
             self.db.update_model_endpoint(
-                endpoint_id=endpoint[mlrun.model_monitoring.EventFieldType.UID],
+                endpoint_id=endpoint[mlrun.common.model_monitoring.EventFieldType.UID],
                 attributes=attributes,
             )
 
-            # Update the results in tsdb:
-            tsdb_drift_measures = {
-                "endpoint_id": endpoint[mlrun.model_monitoring.EventFieldType.UID],
-                "timestamp": pd.to_datetime(
-                    timestamp,
-                    format=mlrun.model_monitoring.EventFieldType.TIME_FORMAT,
-                ),
-                "record_type": "drift_measures",
-                "tvd_mean": drift_result["tvd_mean"],
-                "kld_mean": drift_result["kld_mean"],
-                "hellinger_mean": drift_result["hellinger_mean"],
-            }
-
-            try:
-                self.frames.write(
-                    backend="tsdb",
-                    table=self.tsdb_path,
-                    dfs=pd.DataFrame.from_dict([tsdb_drift_measures]),
-                    index_cols=["timestamp", "endpoint_id", "record_type"],
+            if not mlrun.mlconf.is_ce_mode():
+                # Update drift results in TSDB
+                self._update_drift_in_input_stream(
+                    endpoint_id=endpoint[
+                        mlrun.common.model_monitoring.EventFieldType.UID
+                    ],
+                    drift_status=drift_status,
+                    drift_measure=drift_measure,
+                    drift_result=drift_result,
+                    timestamp=timestamp,
                 )
-            except v3io_frames.errors.Error as err:
-                logger.warn(
-                    "Could not write drift measures to TSDB",
-                    err=err,
-                    tsdb_path=self.tsdb_path,
-                    endpoint=endpoint[mlrun.model_monitoring.EventFieldType.UID],
+                logger.info(
+                    "Done updating drift measures",
+                    endpoint_id=endpoint[
+                        mlrun.common.model_monitoring.EventFieldType.UID
+                    ],
                 )
 
-            logger.info(
-                "Done updating drift measures",
-                endpoint_id=endpoint[mlrun.model_monitoring.EventFieldType.UID],
-            )
-
         except Exception as e:
             logger.error(
-                f"Exception for endpoint {endpoint[mlrun.model_monitoring.EventFieldType.UID]}"
+                f"Exception for endpoint {endpoint[mlrun.common.model_monitoring.EventFieldType.UID]}"
             )
             self.exception = e
 
-    def get_interval_range(self) -> Tuple[datetime.datetime, datetime.datetime]:
+    def _get_interval_range(self) -> Tuple[datetime.datetime, datetime.datetime]:
         """Getting batch interval time range"""
         minutes, hours, days = (
-            self.batch_dict[mlrun.model_monitoring.EventFieldType.MINUTES],
-            self.batch_dict[mlrun.model_monitoring.EventFieldType.HOURS],
-            self.batch_dict[mlrun.model_monitoring.EventFieldType.DAYS],
+            self.batch_dict[mlrun.common.model_monitoring.EventFieldType.MINUTES],
+            self.batch_dict[mlrun.common.model_monitoring.EventFieldType.HOURS],
+            self.batch_dict[mlrun.common.model_monitoring.EventFieldType.DAYS],
         )
         start_time = datetime.datetime.now() - datetime.timedelta(
             minutes=minutes, hours=hours, days=days
         )
         end_time = datetime.datetime.now()
         return start_time, end_time
 
@@ -874,21 +839,85 @@
         batch_list = re.sub(pattern, "", self.batch_dict).split(",")
         # Initialize the dictionary of batch interval ranges
         self.batch_dict = {}
         for pair in batch_list:
             pair_list = pair.split(":")
             self.batch_dict[pair_list[0]] = float(pair_list[1])
 
+    def _update_drift_in_input_stream(
+        self,
+        endpoint_id: str,
+        drift_status: DriftStatus,
+        drift_measure: float,
+        drift_result: Dict[str, Dict[str, Any]],
+        timestamp: pd._libs.tslibs.timestamps.Timestamp,
+    ):
+        """Update drift results in input stream.
+
+        :param endpoint_id:   The unique id of the model endpoint.
+        :param drift_status:  Drift status result. Possible values can be found under DriftStatus enum class.
+        :param drift_measure: The drift result (float) based on the mean of the Total Variance Distance and the
+                              Hellinger distance.
+        :param drift_result:  A dictionary that includes the drift results for each feature.
+        :param timestamp:     Pandas Timestamp value.
+
+        """
+
+        if (
+            drift_status == DriftStatus.POSSIBLE_DRIFT
+            or drift_status == DriftStatus.DRIFT_DETECTED
+        ):
+            self.v3io.stream.put_records(
+                container=self.stream_container,
+                stream_path=self.stream_path,
+                records=[
+                    {
+                        "data": json.dumps(
+                            {
+                                "endpoint_id": endpoint_id,
+                                "drift_status": drift_status.value,
+                                "drift_measure": drift_measure,
+                                "drift_per_feature": {**drift_result},
+                            }
+                        )
+                    }
+                ],
+            )
+
+        # Update the results in tsdb:
+        tsdb_drift_measures = {
+            "endpoint_id": endpoint_id,
+            "timestamp": pd.to_datetime(
+                timestamp,
+                format=mlrun.common.model_monitoring.EventFieldType.TIME_FORMAT,
+            ),
+            "record_type": "drift_measures",
+            "tvd_mean": drift_result["tvd_mean"],
+            "kld_mean": drift_result["kld_mean"],
+            "hellinger_mean": drift_result["hellinger_mean"],
+        }
+
+        try:
+            self.frames.write(
+                backend="tsdb",
+                table=self.tsdb_path,
+                dfs=pd.DataFrame.from_dict([tsdb_drift_measures]),
+                index_cols=["timestamp", "endpoint_id", "record_type"],
+            )
+        except v3io_frames.errors.Error as err:
+            logger.warn(
+                "Could not write drift measures to TSDB",
+                err=err,
+                tsdb_path=self.tsdb_path,
+                endpoint=endpoint_id,
+            )
+
 
 def handler(context: mlrun.run.MLClientCtx):
     batch_processor = BatchProcessor(
         context=context,
         project=context.project,
-        model_monitoring_access_key=os.environ.get(
-            mlrun.model_monitoring.ProjectSecretKeys.ACCESS_KEY
-        ),
-        v3io_access_key=os.environ.get("V3IO_ACCESS_KEY"),
     )
     batch_processor.post_init()
     batch_processor.run()
     if batch_processor.exception:
         raise batch_processor.exception
```

## mlrun/model_monitoring/stream_processing_fs.py

```diff
@@ -18,115 +18,123 @@
 import os
 import typing
 
 import pandas as pd
 import storey
 
 import mlrun
+import mlrun.common.model_monitoring
 import mlrun.config
 import mlrun.datastore.targets
 import mlrun.feature_store.steps
 import mlrun.utils
 import mlrun.utils.model_monitoring
 import mlrun.utils.v3io_clients
-from mlrun.model_monitoring import (
+from mlrun.common.model_monitoring import (
     EventFieldType,
     EventKeyMetrics,
     EventLiveStats,
+    FileTargetKind,
     ModelEndpointTarget,
     ProjectSecretKeys,
 )
 from mlrun.model_monitoring.stores import get_model_endpoint_store
 from mlrun.utils import logger
 
 
 # Stream processing code
 class EventStreamProcessor:
     def __init__(
         self,
         project: str,
         parquet_batching_max_events: int,
+        parquet_target: str,
         sample_window: int = 10,
-        tsdb_batching_max_events: int = 10,
-        tsdb_batching_timeout_secs: int = 60 * 5,  # Default 5 minutes
         parquet_batching_timeout_secs: int = 30 * 60,  # Default 30 minutes
         aggregate_count_windows: typing.Optional[typing.List[str]] = None,
         aggregate_count_period: str = "30s",
         aggregate_avg_windows: typing.Optional[typing.List[str]] = None,
         aggregate_avg_period: str = "30s",
-        v3io_access_key: typing.Optional[str] = None,
-        v3io_framesd: typing.Optional[str] = None,
-        v3io_api: typing.Optional[str] = None,
         model_monitoring_access_key: str = None,
     ):
+        # General configurations, mainly used for the storey steps in the future serving graph
         self.project = project
         self.sample_window = sample_window
-        self.tsdb_batching_max_events = tsdb_batching_max_events
-        self.tsdb_batching_timeout_secs = tsdb_batching_timeout_secs
-        self.parquet_batching_max_events = parquet_batching_max_events
-        self.parquet_batching_timeout_secs = parquet_batching_timeout_secs
         self.aggregate_count_windows = aggregate_count_windows or ["5m", "1h"]
         self.aggregate_count_period = aggregate_count_period
         self.aggregate_avg_windows = aggregate_avg_windows or ["5m", "1h"]
         self.aggregate_avg_period = aggregate_avg_period
 
+        # Parquet path and configurations
+        self.parquet_path = parquet_target
+        self.parquet_batching_max_events = parquet_batching_max_events
+        self.parquet_batching_timeout_secs = parquet_batching_timeout_secs
+
+        self.model_endpoint_store_target = (
+            mlrun.mlconf.model_endpoint_monitoring.store_type
+        )
+
+        logger.info(
+            "Initializing model monitoring event stream processor",
+            parquet_path=self.parquet_path,
+            parquet_batching_max_events=self.parquet_batching_max_events,
+        )
+
+        self.storage_options = None
+        if not mlrun.mlconf.is_ce_mode():
+            self._initialize_v3io_configurations(
+                model_monitoring_access_key=model_monitoring_access_key
+            )
+
+    def _initialize_v3io_configurations(
+        self,
+        tsdb_batching_max_events: int = 10,
+        tsdb_batching_timeout_secs: int = 60 * 5,  # Default 5 minutes
+        v3io_access_key: typing.Optional[str] = None,
+        v3io_framesd: typing.Optional[str] = None,
+        v3io_api: typing.Optional[str] = None,
+        model_monitoring_access_key: str = None,
+    ):
+        # Get the V3IO configurations
         self.v3io_framesd = v3io_framesd or mlrun.mlconf.v3io_framesd
         self.v3io_api = v3io_api or mlrun.mlconf.v3io_api
 
         self.v3io_access_key = v3io_access_key or os.environ.get("V3IO_ACCESS_KEY")
         self.model_monitoring_access_key = (
             model_monitoring_access_key
             or os.environ.get(ProjectSecretKeys.ACCESS_KEY)
             or self.v3io_access_key
         )
         self.storage_options = dict(
             v3io_access_key=self.model_monitoring_access_key, v3io_api=self.v3io_api
         )
-        self.model_endpoint_store_target = (
-            mlrun.mlconf.model_endpoint_monitoring.store_type
-        )
 
-        template = mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default
-
-        kv_path = template.format(project=project, kind="endpoints")
+        # KV path
+        kv_path = mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=self.project, kind=FileTargetKind.ENDPOINTS
+        )
         (
             _,
             self.kv_container,
             self.kv_path,
         ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(kv_path)
 
-        tsdb_path = template.format(project=project, kind="events")
+        # TSDB path and configurations
+        tsdb_path = mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=self.project, kind=FileTargetKind.EVENTS
+        )
         (
             _,
             self.tsdb_container,
             self.tsdb_path,
         ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(tsdb_path)
-        self.tsdb_path = f"{self.tsdb_container}/{self.tsdb_path}"
-
-        self.parquet_path = (
-            mlrun.mlconf.model_endpoint_monitoring.store_prefixes.user_space.format(
-                project=project, kind="parquet"
-            )
-        )
 
-        logger.info(
-            "Initializing model monitoring event stream processor",
-            parquet_batching_max_events=self.parquet_batching_max_events,
-            v3io_access_key=self.v3io_access_key,
-            model_monitoring_access_key=self.model_monitoring_access_key,
-            default_store_prefix=mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default,
-            user_space_store_prefix=mlrun.mlconf.model_endpoint_monitoring.store_prefixes.user_space,
-            v3io_api=self.v3io_api,
-            v3io_framesd=self.v3io_framesd,
-            kv_container=self.kv_container,
-            kv_path=self.kv_path,
-            tsdb_container=self.tsdb_container,
-            tsdb_path=self.tsdb_path,
-            parquet_path=self.parquet_path,
-        )
+        self.tsdb_path = f"{self.tsdb_container}/{self.tsdb_path}"
+        self.tsdb_batching_max_events = tsdb_batching_max_events
+        self.tsdb_batching_timeout_secs = tsdb_batching_timeout_secs
 
     def apply_monitoring_serving_graph(self, fn):
         """
         Apply monitoring serving graph to a given serving function. The following serving graph includes about 20 steps
         of different operations that are executed on the events from the model server. Each event has
         metadata (function_uri, timestamp, class, etc.) but also inputs and predictions from the model server.
         Throughout the serving graph, the results are written to 3 different databases:
@@ -140,16 +148,17 @@
            under mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection.
         2. TSDB (steps 12-18): Stores live data of different key metric dictionaries in tsdb target. Results can be
            found under v3io:///users/pipelines/project-name/model-endpoints/events/. At the moment, this part supports
            3 different key metric dictionaries: base_metrics (average latency and predictions over time),
            endpoint_features (Prediction and feature names and values), and custom_metrics (user-defined metrics).
            This data is also being used by the monitoring dashboards in grafana.
         3. Parquet (steps 19-20): This Parquet file includes the required data for the model monitoring batch job
-           that run every hour by default. The parquet target can be found under
-           v3io:///projects/{project}/model-endpoints/.
+           that run every hour by default. If defined, the parquet target path can be found under
+           mlrun.mlconf.model_endpoint_monitoring.offline. Otherwise, the default parquet path is under
+           mlrun.mlconf.model_endpoint_monitoring.user_space.
 
         :param fn: A serving function.
         """
 
         graph = fn.set_topology("flow")
 
         # Step 1 - Process endpoint event: splitting into sub-events and validate event data
@@ -205,15 +214,14 @@
                         "period": self.aggregate_count_period,
                     }
                 ],
                 name=EventFieldType.PREDICTIONS,
                 after="MapFeatureNames",
                 step_name="Aggregates",
                 table=".",
-                v3io_access_key=self.v3io_access_key,
             )
             # Step 5.2 - Calculate average latency time for each window (5 min and 1 hour by default)
             graph.add_step(
                 class_name="storey.AggregateByKey",
                 aggregates=[
                     {
                         "name": EventFieldType.LATENCY,
@@ -222,28 +230,26 @@
                         "windows": self.aggregate_avg_windows,
                         "period": self.aggregate_avg_period,
                     }
                 ],
                 name=EventFieldType.LATENCY,
                 after=EventFieldType.PREDICTIONS,
                 table=".",
-                v3io_access_key=self.v3io_access_key,
             )
 
         apply_storey_aggregations()
 
         # Step 6 - Emits the event in window size of events based on sample_window size (10 by default)
         def apply_storey_sample_window():
             graph.add_step(
                 "storey.steps.SampleWindow",
                 name="sample",
                 after=EventFieldType.LATENCY,
                 window_size=self.sample_window,
                 key=EventFieldType.ENDPOINT_ID,
-                v3io_access_key=self.v3io_access_key,
             )
 
         apply_storey_sample_window()
 
         # Steps 7-9 - KV/SQL branch
         # Step 7 - Filter relevant keys from the event before writing the data into the database table
         def apply_process_before_endpoint_update():
@@ -271,93 +277,94 @@
         # Step 9 (only for KV target) - Apply infer_schema on the model endpoints table for generating schema file
         # which will be used by Grafana monitoring dashboards
         def apply_infer_schema():
             graph.add_step(
                 "InferSchema",
                 name="InferSchema",
                 after="UpdateEndpoint",
-                v3io_access_key=self.v3io_access_key,
                 v3io_framesd=self.v3io_framesd,
                 container=self.kv_container,
                 table=self.kv_path,
             )
 
         if self.model_endpoint_store_target == ModelEndpointTarget.V3IO_NOSQL:
             apply_infer_schema()
 
-        # Steps 11-18 - TSDB branch
-        # Step 11 - Before writing data to TSDB, create dictionary of 2-3 dictionaries that contains
-        # stats and details about the events
-        def apply_process_before_tsdb():
-            graph.add_step(
-                "ProcessBeforeTSDB", name="ProcessBeforeTSDB", after="sample"
-            )
-
-        apply_process_before_tsdb()
-
-        # Steps 12-18: - Unpacked keys from each dictionary and write to TSDB target
-        def apply_filter_and_unpacked_keys(name, keys):
-            graph.add_step(
-                "FilterAndUnpackKeys",
-                name=name,
-                after="ProcessBeforeTSDB",
-                keys=[keys],
-            )
+        # Steps 11-18 - TSDB branch (not supported in CE environment at the moment)
 
-        def apply_tsdb_target(name, after):
-            graph.add_step(
-                "storey.TSDBTarget",
-                name=name,
-                after=after,
-                path=self.tsdb_path,
-                rate="10/m",
-                time_col=EventFieldType.TIMESTAMP,
-                container=self.tsdb_container,
-                access_key=self.v3io_access_key,
-                v3io_frames=self.v3io_framesd,
-                infer_columns_from_data=True,
-                index_cols=[
-                    EventFieldType.ENDPOINT_ID,
-                    EventFieldType.RECORD_TYPE,
-                ],
-                max_events=self.tsdb_batching_max_events,
-                flush_after_seconds=self.tsdb_batching_timeout_secs,
-                key=EventFieldType.ENDPOINT_ID,
-            )
+        if not mlrun.mlconf.is_ce_mode():
+            # Step 11 - Before writing data to TSDB, create dictionary of 2-3 dictionaries that contains
+            # stats and details about the events
+            def apply_process_before_tsdb():
+                graph.add_step(
+                    "ProcessBeforeTSDB", name="ProcessBeforeTSDB", after="sample"
+                )
 
-        # Steps 12-13 - unpacked base_metrics dictionary
-        apply_filter_and_unpacked_keys(
-            name="FilterAndUnpackKeys1",
-            keys=EventKeyMetrics.BASE_METRICS,
-        )
-        apply_tsdb_target(name="tsdb1", after="FilterAndUnpackKeys1")
+            apply_process_before_tsdb()
 
-        # Steps 14-15 - unpacked endpoint_features dictionary
-        apply_filter_and_unpacked_keys(
-            name="FilterAndUnpackKeys2",
-            keys=EventKeyMetrics.ENDPOINT_FEATURES,
-        )
-        apply_tsdb_target(name="tsdb2", after="FilterAndUnpackKeys2")
+            # Steps 12-18: - Unpacked keys from each dictionary and write to TSDB target
+            def apply_filter_and_unpacked_keys(name, keys):
+                graph.add_step(
+                    "FilterAndUnpackKeys",
+                    name=name,
+                    after="ProcessBeforeTSDB",
+                    keys=[keys],
+                )
 
-        # Steps 16-18 - unpacked custom_metrics dictionary. In addition, use storey.Filter remove none values
-        apply_filter_and_unpacked_keys(
-            name="FilterAndUnpackKeys3",
-            keys=EventKeyMetrics.CUSTOM_METRICS,
-        )
+            def apply_tsdb_target(name, after):
+                graph.add_step(
+                    "storey.TSDBTarget",
+                    name=name,
+                    after=after,
+                    path=self.tsdb_path,
+                    rate="10/m",
+                    time_col=EventFieldType.TIMESTAMP,
+                    container=self.tsdb_container,
+                    access_key=self.v3io_access_key,
+                    v3io_frames=self.v3io_framesd,
+                    infer_columns_from_data=True,
+                    index_cols=[
+                        EventFieldType.ENDPOINT_ID,
+                        EventFieldType.RECORD_TYPE,
+                    ],
+                    max_events=self.tsdb_batching_max_events,
+                    flush_after_seconds=self.tsdb_batching_timeout_secs,
+                    key=EventFieldType.ENDPOINT_ID,
+                )
 
-        def apply_storey_filter():
-            graph.add_step(
-                "storey.Filter",
-                "FilterNotNone",
-                after="FilterAndUnpackKeys3",
-                _fn="(event is not None)",
-            )
+            # Steps 12-13 - unpacked base_metrics dictionary
+            apply_filter_and_unpacked_keys(
+                name="FilterAndUnpackKeys1",
+                keys=EventKeyMetrics.BASE_METRICS,
+            )
+            apply_tsdb_target(name="tsdb1", after="FilterAndUnpackKeys1")
+
+            # Steps 14-15 - unpacked endpoint_features dictionary
+            apply_filter_and_unpacked_keys(
+                name="FilterAndUnpackKeys2",
+                keys=EventKeyMetrics.ENDPOINT_FEATURES,
+            )
+            apply_tsdb_target(name="tsdb2", after="FilterAndUnpackKeys2")
+
+            # Steps 16-18 - unpacked custom_metrics dictionary. In addition, use storey.Filter remove none values
+            apply_filter_and_unpacked_keys(
+                name="FilterAndUnpackKeys3",
+                keys=EventKeyMetrics.CUSTOM_METRICS,
+            )
+
+            def apply_storey_filter():
+                graph.add_step(
+                    "storey.Filter",
+                    "FilterNotNone",
+                    after="FilterAndUnpackKeys3",
+                    _fn="(event is not None)",
+                )
 
-        apply_storey_filter()
-        apply_tsdb_target(name="tsdb3", after="FilterNotNone")
+            apply_storey_filter()
+            apply_tsdb_target(name="tsdb3", after="FilterNotNone")
 
         # Steps 19-20 - Parquet branch
         # Step 19 - Filter and validate different keys before writing the data to Parquet target
         def apply_process_before_parquet():
             graph.add_step(
                 "ProcessBeforeParquet",
                 name="ProcessBeforeParquet",
@@ -597,15 +604,15 @@
         model = event.get(EventFieldType.MODEL)
         if not is_not_none(model, [EventFieldType.MODEL]):
             return None
 
         version = event.get(EventFieldType.VERSION)
         versioned_model = f"{model}:{version}" if version else f"{model}:latest"
 
-        endpoint_id = mlrun.model_monitoring.create_model_endpoint_uid(
+        endpoint_id = mlrun.common.model_monitoring.create_model_endpoint_uid(
             function_uri=function_uri,
             versioned_model=versioned_model,
         )
 
         endpoint_id = str(endpoint_id)
 
         event[EventFieldType.VERSIONED_MODEL] = versioned_model
@@ -758,15 +765,14 @@
 
     def resume_state(self, endpoint_id):
         # Make sure process is resumable, if process fails for any reason, be able to pick things up close to where we
         # left them
         if endpoint_id not in self.endpoints:
 
             logger.info("Trying to resume state", endpoint_id=endpoint_id)
-
             endpoint_record = get_endpoint_record(
                 project=self.project,
                 endpoint_id=endpoint_id,
             )
 
             # If model endpoint found, get first_request, last_request and error_count values
             if endpoint_record:
@@ -779,15 +785,15 @@
                 if last_request:
 
                     self.last_request[endpoint_id] = last_request
 
                 error_count = endpoint_record.get(EventFieldType.ERROR_COUNT)
 
                 if error_count:
-                    self.error_count[endpoint_id] = error_count
+                    self.error_count[endpoint_id] = int(error_count)
 
             # add endpoint to endpoints set
             self.endpoints.add(endpoint_id)
 
     def is_valid(
         self,
         endpoint_id: str,
@@ -1031,15 +1037,14 @@
         )
         return event
 
 
 class InferSchema(mlrun.feature_store.steps.MapClass):
     def __init__(
         self,
-        v3io_access_key: str,
         v3io_framesd: str,
         container: str,
         table: str,
         **kwargs,
     ):
         """
         Apply infer_schema on the kv table which generates the schema file.
@@ -1051,27 +1056,25 @@
                                         endpoints it is usually 'users'.
         :param table:                   KV table path that will be used to retrieve the endpoint id. For model endpoints
                                         it is usually pipelines/project-name/model-endpoints/endpoints/.
 
         """
         super().__init__(**kwargs)
         self.container = container
-        self.v3io_access_key = v3io_access_key
         self.v3io_framesd = v3io_framesd
         self.table = table
         self.keys = set()
 
     def do(self, event: typing.Dict):
 
         key_set = set(event.keys())
         if not key_set.issubset(self.keys):
             self.keys.update(key_set)
             # Apply infer_schema on the kv table for generating the schema file
             mlrun.utils.v3io_clients.get_frames_client(
-                token=self.v3io_access_key,
                 container=self.container,
                 address=self.v3io_framesd,
             ).execute(backend="kv", table=self.table, command="infer_schema")
 
         return event
```

## mlrun/model_monitoring/stores/kv_model_endpoint_store.py

```diff
@@ -16,15 +16,15 @@
 import os
 import typing
 
 import v3io.dataplane
 import v3io_frames
 
 import mlrun
-import mlrun.model_monitoring.constants as model_monitoring_constants
+import mlrun.common.model_monitoring as model_monitoring_constants
 import mlrun.utils.model_monitoring
 import mlrun.utils.v3io_clients
 from mlrun.utils import logger
 
 from .model_endpoint_store import ModelEndpointStore
 
 
@@ -164,15 +164,14 @@
         """
 
         # # Initialize an empty model endpoints list
         endpoint_list = []
 
         # Retrieve the raw data from the KV table and get the endpoint ids
         try:
-
             cursor = self.client.kv.new_cursor(
                 container=self.container,
                 table_path=self.path,
                 filter_expression=self._build_kv_cursor_filter_expression(
                     self.project,
                     function,
                     model,
@@ -215,16 +214,25 @@
         Delete all model endpoints resources in both KV and the time series DB.
 
         :param endpoints: A list of model endpoints flattened dictionaries.
         """
 
         # Delete model endpoint record from KV table
         for endpoint_dict in endpoints:
+            if model_monitoring_constants.EventFieldType.UID not in endpoint_dict:
+                # This is kept for backwards compatibility - in old versions the key column named endpoint_id
+                endpoint_id = endpoint_dict[
+                    model_monitoring_constants.EventFieldType.ENDPOINT_ID
+                ]
+            else:
+                endpoint_id = endpoint_dict[
+                    model_monitoring_constants.EventFieldType.UID
+                ]
             self.delete_model_endpoint(
-                endpoint_dict[model_monitoring_constants.EventFieldType.UID],
+                endpoint_id,
             )
 
         # Delete remain records in the KV
         all_records = self.client.kv.new_cursor(
             container=self.container,
             table_path=self.path,
             raise_for_status=v3io.dataplane.RaiseForStatus.never,
@@ -416,26 +424,25 @@
         if function:
             filter_expression.append(f"function=='{function}'")
         if model:
             filter_expression.append(f"model=='{model}'")
 
         # Add labels filters
         if labels:
-
             for label in labels:
                 if not label.startswith("_"):
                     label = f"_{label}"
 
                 if "=" in label:
                     lbl, value = list(map(lambda x: x.strip(), label.split("=")))
                     filter_expression.append(f"{lbl}=='{value}'")
                 else:
                     filter_expression.append(f"exists({label})")
 
         # Apply top_level filter (remove endpoints that considered a child of a router)
         if top_level:
             filter_expression.append(
-                f"(endpoint_type=='{str(mlrun.model_monitoring.EndpointType.NODE_EP.value)}' "
-                f"OR  endpoint_type=='{str(mlrun.model_monitoring.EndpointType.ROUTER.value)}')"
+                f"(endpoint_type=='{str(model_monitoring_constants.EndpointType.NODE_EP.value)}' "
+                f"OR  endpoint_type=='{str(model_monitoring_constants.EndpointType.ROUTER.value)}')"
             )
 
         return " AND ".join(filter_expression)
```

## mlrun/model_monitoring/stores/sql_model_endpoint_store.py

```diff
@@ -17,15 +17,15 @@
 import typing
 from datetime import datetime, timezone
 
 import pandas as pd
 import sqlalchemy as db
 
 import mlrun
-import mlrun.model_monitoring.constants as model_monitoring_constants
+import mlrun.common.model_monitoring as model_monitoring_constants
 import mlrun.model_monitoring.model_endpoint
 import mlrun.utils.model_monitoring
 import mlrun.utils.v3io_clients
 from mlrun.api.db.sqldb.session import create_session, get_engine
 from mlrun.utils import logger
 
 from .model_endpoint_store import ModelEndpointStore
@@ -78,15 +78,14 @@
         Create a new endpoint record in the SQL table. This method also creates the model endpoints table within the
         SQL database if not exist.
 
         :param endpoint: model endpoint dictionary that will be written into the DB.
         """
 
         with self._engine.connect() as connection:
-
             # Adjust timestamps fields
             endpoint[
                 model_monitoring_constants.EventFieldType.FIRST_REQUEST
             ] = datetime.now(timezone.utc)
             endpoint[
                 model_monitoring_constants.EventFieldType.LAST_REQUEST
             ] = datetime.now(timezone.utc)
@@ -108,15 +107,14 @@
         :param attributes: Dictionary of attributes that will be used for update the model endpoint. Note that the keys
                            of the attributes dictionary should exist in the SQL table.
 
         """
 
         # Update the model endpoint record using sqlalchemy ORM
         with create_session(dsn=self.sql_connection_string) as session:
-
             # Remove endpoint id (foreign key) from the update query
             attributes.pop(model_monitoring_constants.EventFieldType.ENDPOINT_ID, None)
 
             # Generate and commit the update session query
             session.query(self.ModelEndpointsTable).filter(
                 self.ModelEndpointsTable.uid == endpoint_id
             ).update(attributes)
@@ -127,15 +125,14 @@
         Deletes the SQL record of a given model endpoint id.
 
         :param endpoint_id: The unique id of the model endpoint.
         """
 
         # Delete the model endpoint record using sqlalchemy ORM
         with create_session(dsn=self.sql_connection_string) as session:
-
             # Generate and commit the delete query
             session.query(self.ModelEndpointsTable).filter_by(uid=endpoint_id).delete()
             session.commit()
 
     def get_model_endpoint(
         self,
         endpoint_id: str,
@@ -148,15 +145,14 @@
         :return: A model endpoint record as a dictionary.
 
         :raise MLRunNotFoundError: If the model endpoints table was not found or the model endpoint id was not found.
         """
 
         # Get the model endpoint record using sqlalchemy ORM
         with create_session(dsn=self.sql_connection_string) as session:
-
             # Generate the get query
             endpoint_record = (
                 session.query(self.ModelEndpointsTable)
                 .filter_by(uid=endpoint_id)
                 .one_or_none()
             )
 
@@ -191,15 +187,14 @@
         """
 
         # Generate an empty model endpoints that will be filled afterwards with model endpoint dictionaries
         endpoint_list = []
 
         # Get the model endpoints records using sqlalchemy ORM
         with create_session(dsn=self.sql_connection_string) as session:
-
             # Generate the list query
             query = session.query(self.ModelEndpointsTable).filter_by(
                 project=self.project
             )
 
             # Apply filters
             if model:
@@ -221,16 +216,16 @@
                     query=query,
                     model_endpoints_table=self.model_endpoints_table,
                     key_filter=model_monitoring_constants.EventFieldType.UID,
                     filtered_values=uids,
                     combined=False,
                 )
             if top_level:
-                node_ep = str(mlrun.model_monitoring.EndpointType.NODE_EP.value)
-                router_ep = str(mlrun.model_monitoring.EndpointType.ROUTER.value)
+                node_ep = str(mlrun.common.model_monitoring.EndpointType.NODE_EP.value)
+                router_ep = str(mlrun.common.model_monitoring.EndpointType.ROUTER.value)
                 endpoint_types = [node_ep, router_ep]
                 query = self._filter_values(
                     query=query,
                     model_endpoints_table=self.model_endpoints_table,
                     key_filter=model_monitoring_constants.EventFieldType.ENDPOINT_TYPE,
                     filtered_values=endpoint_types,
                     combined=False,
```

## mlrun/model_monitoring/stores/models/mysql.py

```diff
@@ -13,15 +13,15 @@
 # limitations under the License.
 #
 
 
 import sqlalchemy.dialects
 from sqlalchemy import Boolean, Column, Integer, String, Text
 
-import mlrun.model_monitoring.constants as model_monitoring_constants
+import mlrun.common.model_monitoring as model_monitoring_constants
 from mlrun.utils.db import BaseModel
 
 from .base import Base
 
 
 class ModelEndpointsTable(Base, BaseModel):
     __tablename__ = model_monitoring_constants.EventFieldType.MODEL_ENDPOINTS
```

## mlrun/model_monitoring/stores/models/sqlite.py

```diff
@@ -12,15 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 
 from sqlalchemy import TIMESTAMP, Boolean, Column, Integer, String, Text
 
-import mlrun.model_monitoring.constants as model_monitoring_constants
+import mlrun.common.model_monitoring as model_monitoring_constants
 from mlrun.utils.db import BaseModel
 
 from .base import Base
 
 
 class ModelEndpointsTable(Base, BaseModel):
     __tablename__ = model_monitoring_constants.EventFieldType.MODEL_ENDPOINTS
```

## mlrun/platforms/iguazio.py

```diff
@@ -399,14 +399,45 @@
             self._mock_queue.extend(records)
         else:
             self._v3io_client.put_records(
                 container=self._container, path=self._stream_path, records=records
             )
 
 
+class HTTPOutputStream:
+    """HTTP output source that usually used for CE mode and debugging process"""
+
+    def __init__(self, stream_path: str):
+        self._stream_path = stream_path
+
+    def push(self, data):
+        def dump_record(rec):
+            if isinstance(rec, bytes):
+                return rec
+
+            if not isinstance(rec, str):
+                rec = dict_to_json(rec)
+
+            return rec.encode("UTF-8")
+
+        if not isinstance(data, list):
+            data = [data]
+
+        for record in data:
+
+            # Convert the new record to the required format
+            serialized_record = dump_record(record)
+            response = requests.post(self._stream_path, data=serialized_record)
+            if not response:
+                raise mlrun.errors.MLRunInvalidArgumentError(
+                    f"API call failed push a new record through {self._stream_path}"
+                    f"status {response.status_code}: {response.reason}"
+                )
+
+
 class KafkaOutputStream:
     def __init__(
         self,
         topic,
         brokers,
         producer_options=None,
         mock=False,
```

## mlrun/projects/operations.py

```diff
@@ -66,15 +66,15 @@
     base_task: mlrun.model.RunTemplate = None,
     watch: bool = True,
     local: bool = None,
     verbose: bool = None,
     selector: str = None,
     project_object=None,
     auto_build: bool = None,
-    schedule: Union[str, mlrun.api.schemas.ScheduleCronTrigger] = None,
+    schedule: Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
     artifact_path: str = None,
     notifications: List[mlrun.model.Notification] = None,
     returns: Optional[List[Union[str, Dict[str, str]]]] = None,
 ) -> Union[mlrun.model.RunObject, kfp.dsl.ContainerOp]:
     """Run a local or remote task as part of a local/kubeflow pipeline
 
     run_function() allow you to execute a function locally, on a remote cluster, or as part of an automated workflow
@@ -94,15 +94,15 @@
         DATA_PATH = "s3://bigdata/data.parquet"
         function = mlrun.import_function("hub://auto-trainer")
         run1 = run_function(function, params={"label_columns": LABELS, "model_class": MODEL_CLASS},
                                       inputs={"dataset": DATA_PATH})
 
     example (use with project)::
 
-        # create a project with two functions (local and from marketplace)
+        # create a project with two functions (local and from hub)
         project = mlrun.new_project(project_name, "./proj)
         project.set_function("mycode.py", "myfunc", image="mlrun/mlrun")
         project.set_function("hub://auto-trainer", "train")
 
         # run functions (refer to them by name)
         run1 = run_function("myfunc", params={"x": 7})
         run2 = run_function("train", params={"label_columns": LABELS, "model_class": MODEL_CLASS},
```

## mlrun/projects/pipelines.py

```diff
@@ -23,15 +23,15 @@
 import warnings
 
 import kfp.compiler
 from kfp import dsl
 from kfp.compiler import compiler
 
 import mlrun
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.utils.notifications
 from mlrun.errors import err_to_str
 from mlrun.utils import (
     get_ui_url,
     logger,
     new_pipe_metadata,
     parse_versioned_object_uri,
@@ -75,15 +75,15 @@
         path=None,
         args=None,
         name=None,
         handler=None,
         # TODO: deprecated, remove in 1.5.0
         ttl=None,
         args_schema: dict = None,
-        schedule: typing.Union[str, mlrun.api.schemas.ScheduleCronTrigger] = None,
+        schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         cleanup_ttl: int = None,
     ):
         if ttl:
             warnings.warn(
                 "'ttl' is deprecated, use 'cleanup_ttl' instead. "
                 "This will be removed in 1.5.0",
                 # TODO: Remove this in 1.5.0
@@ -112,15 +112,21 @@
             with tempfile.NamedTemporaryFile(
                 mode="w", suffix=".py", delete=False
             ) as workflow_fh:
                 workflow_fh.write(self.code)
                 self._tmp_path = workflow_path = workflow_fh.name
         else:
             workflow_path = self.path or ""
-            if context and not workflow_path.startswith("/"):
+            if (
+                context
+                and not workflow_path.startswith("/")
+                # since the user may provide a path the includes the context,
+                # we need to make sure we don't add it twice
+                and not workflow_path.startswith(context)
+            ):
                 workflow_path = os.path.join(context, workflow_path)
         return workflow_path
 
     def merge_args(self, extra_args):
         self.args = self.args or {}
         required = []
         if self.args_schema:
@@ -275,15 +281,15 @@
         )
 
 
 def _enrich_kfp_pod_security_context(kfp_pod_template, function):
     if (
         mlrun.runtimes.RuntimeKinds.is_local_runtime(function.kind)
         or mlrun.mlconf.function.spec.security_context.enrichment_mode
-        == mlrun.api.schemas.SecurityContextEnrichmentModes.disabled.value
+        == mlrun.common.schemas.SecurityContextEnrichmentModes.disabled.value
     ):
         return
 
     # ensure kfp pod user id is not None or 0 (root)
     if not mlrun.mlconf.function.spec.security_context.pipelines.kfp_pod_user_unix_id:
         raise mlrun.errors.MLRunInvalidArgumentError(
             f"Kubeflow pipeline pod user id is invalid: "
@@ -751,26 +757,28 @@
         project_name: str,
         save: bool,
         workflow_name: str,
         workflow_spec: WorkflowSpec,
         artifact_path: str,
         workflow_handler: str,
         namespace: str,
+        subpath: str,
     ) -> typing.Tuple[mlrun.runtimes.RemoteRuntime, "mlrun.RunObject"]:
         """
         Helper function for creating the runspec of the load and run function.
         For internal use only.
         :param source:              The source of the project.
         :param project_name:        project name
         :param save:                either to save the project in the DB
         :param workflow_name:       workflow name
         :param workflow_spec:       workflow to run
         :param artifact_path:       path to store artifacts
         :param workflow_handler:    workflow function handler (for running workflow function directly)
         :param namespace:           kubernetes namespace if other than default
+        :param subpath:             project subpath (within the archive)
         :return:
         """
         # Creating the load project and workflow running function:
         load_and_run_fn = mlrun.new_function(
             name=mlrun.mlconf.default_workflow_runner_name.format(workflow_name),
             project=project_name,
             kind="job",
@@ -788,14 +796,15 @@
                     "artifact_path": artifact_path,
                     "workflow_handler": workflow_handler or workflow_spec.handler,
                     "namespace": namespace,
                     "ttl": workflow_spec.cleanup_ttl or workflow_spec.ttl,
                     "engine": workflow_spec.engine,
                     "local": workflow_spec.run_local,
                     "schedule": workflow_spec.schedule,
+                    "subpath": subpath,
                 },
                 handler="mlrun.projects.load_and_run",
             ),
             metadata=mlrun.model.RunMetadata(name=workflow_name),
         )
 
         runspec = runspec.set_label("job-type", "workflow-runner").set_label(
@@ -836,14 +845,15 @@
             project_name=project.name,
             save=save,
             workflow_name=workflow_name,
             workflow_spec=workflow_spec,
             artifact_path=artifact_path,
             workflow_handler=workflow_handler,
             namespace=namespace,
+            subpath=project.spec.subpath,
         )
 
         # The returned engine for this runner is the engine of the workflow.
         # In this way wait_for_completion/get_run_status would be executed by the correct pipeline runner.
         inner_engine = get_workflow_engine(workflow_spec.engine)
 
         msg = "executing workflow"
@@ -964,15 +974,15 @@
     namespace: str = None,
     sync: bool = False,
     dirty: bool = False,
     # TODO: deprecated, remove in 1.5.0
     ttl: int = None,
     engine: str = None,
     local: bool = None,
-    schedule: typing.Union[str, mlrun.api.schemas.ScheduleCronTrigger] = None,
+    schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
     cleanup_ttl: int = None,
 ):
     """
     Auxiliary function that the RemoteRunner run once or run every schedule.
     This function loads a project from a given remote source and then runs the workflow.
 
     :param context:             mlrun context.
@@ -1030,15 +1040,15 @@
                 f":x: Failed to run scheduled workflow {workflow_name} in Project {project_name} !\n"
                 f"error: ```{error}```\n{link}"
             )
             # Sending Slack Notification without losing the original error:
             try:
                 notification_pusher.push(
                     message=message,
-                    severity=mlrun.api.schemas.NotificationSeverity.ERROR,
+                    severity=mlrun.common.schemas.NotificationSeverity.ERROR,
                 )
 
             except Exception as exc:
                 logger.error("Failed to send slack notification", exc=exc)
 
         raise error
```

## mlrun/projects/project.py

```diff
@@ -29,18 +29,18 @@
 import git
 import git.exc
 import inflection
 import kfp
 import nuclio
 import yaml
 
-import mlrun.api.schemas
+import mlrun.common.model_monitoring as model_monitoring_constants
+import mlrun.common.schemas
 import mlrun.db
 import mlrun.errors
-import mlrun.model_monitoring.constants as model_monitoring_constants
 import mlrun.utils.regex
 from mlrun.runtimes import RuntimeKinds
 
 from ..artifacts import Artifact, ArtifactProducer, DatasetArtifact, ModelArtifact
 from ..artifacts.manager import ArtifactManager, dict_to_artifact, extend_artifact_path
 from ..datastore import store_manager
 from ..features import Feature
@@ -110,15 +110,15 @@
     save: bool = True,
     overwrite: bool = False,
 ) -> "MlrunProject":
     """Create a new MLRun project, optionally load it from a yaml/zip/git template
 
     example::
 
-        # create a project with local and marketplace functions, a workflow, and an artifact
+        # create a project with local and hub functions, a workflow, and an artifact
         project = mlrun.new_project("myproj", "./", init_git=True, description="my new project")
         project.set_function('prep_data.py', 'prep-data', image='mlrun/mlrun', handler='prep_data')
         project.set_function('hub://auto-trainer', 'train')
         project.set_artifact('data', Artifact(target_path=data_url))
         project.set_workflow('main', "./myflow.py")
         project.save()
 
@@ -191,15 +191,15 @@
 
     _set_as_current_default_project(project)
 
     if save and mlrun.mlconf.dbpath:
         if overwrite:
             logger.info(f"Deleting project {name} from MLRun DB due to overwrite")
             _delete_project_from_db(
-                name, secrets, mlrun.api.schemas.DeletionStrategy.cascade
+                name, secrets, mlrun.common.schemas.DeletionStrategy.cascade
             )
 
         try:
             project.save(store=False)
         except mlrun.errors.MLRunConflictError as exc:
             raise mlrun.errors.MLRunConflictError(
                 f"Project with name {name} already exists. "
@@ -534,15 +534,15 @@
         conda=None,
         source=None,
         subpath=None,
         origin_url=None,
         goals=None,
         load_source_on_run=None,
         default_requirements: typing.Union[str, typing.List[str]] = None,
-        desired_state=mlrun.api.schemas.ProjectState.online.value,
+        desired_state=mlrun.common.schemas.ProjectState.online.value,
         owner=None,
         disable_auto_mount=None,
         workdir=None,
         default_image=None,
     ):
         self.repo = None
 
@@ -581,16 +581,14 @@
         """source url or git repo"""
         if not self._source:
             if self.repo:
                 url = get_repo_url(self.repo)
                 if url:
                     self._source = url
 
-        if self._source in [".", "./"]:
-            return path.abspath(self.context)
         return self._source
 
     @source.setter
     def source(self, src):
         self._source = src
 
     @property
@@ -1018,15 +1016,15 @@
         self,
         name,
         workflow_path: str,
         embed=False,
         engine=None,
         args_schema: typing.List[EntrypointParam] = None,
         handler=None,
-        schedule: typing.Union[str, mlrun.api.schemas.ScheduleCronTrigger] = None,
+        schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         ttl=None,
         **args,
     ):
         """add or update a workflow, specify a name and the code path
 
         :param name:          name of the workflow
         :param workflow_path: url/path for the workflow file
@@ -1040,16 +1038,22 @@
                               https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron
         :param ttl:           pipeline ttl in secs (after that the pods will be removed)
         :param args:          argument values (key=value, ..)
         """
         if not workflow_path:
             raise ValueError("valid workflow_path must be specified")
         if embed:
-            if self.spec.context and not workflow_path.startswith("/"):
-                workflow_path = path.join(self.spec.context, workflow_path)
+            if (
+                self.context
+                and not workflow_path.startswith("/")
+                # since the user may provide a path the includes the context,
+                # we need to make sure we don't add it twice
+                and not workflow_path.startswith(self.context)
+            ):
+                workflow_path = path.join(self.context, workflow_path)
             with open(workflow_path, "r") as fp:
                 txt = fp.read()
             workflow = {"name": name, "code": txt}
         else:
             workflow = {"name": name, "path": workflow_path}
         if args:
             workflow["args"] = args
@@ -1812,15 +1816,15 @@
             return self._secrets.get(key)
         return None
 
     def set_secrets(
         self,
         secrets: dict = None,
         file_path: str = None,
-        provider: typing.Union[str, mlrun.api.schemas.SecretProviderName] = None,
+        provider: typing.Union[str, mlrun.common.schemas.SecretProviderName] = None,
     ):
         """set project secrets from dict or secrets env file
         when using a secrets file it should have lines in the form KEY=VALUE, comment line start with "#"
         V3IO paths/credentials and MLrun service API address are dropped from the secrets
 
         example secrets file::
 
@@ -1850,15 +1854,15 @@
                 )
         # drop V3IO paths/credentials and MLrun service API address
         env_vars = {
             key: val
             for key, val in secrets.items()
             if key != "MLRUN_DBPATH" and not key.startswith("V3IO_")
         }
-        provider = provider or mlrun.api.schemas.SecretProviderName.kubernetes
+        provider = provider or mlrun.common.schemas.SecretProviderName.kubernetes
         mlrun.db.get_run_db().create_project_secrets(
             self.metadata.name, provider=provider, secrets=env_vars
         )
 
     def get_param(self, key: str, default=None):
         """get project param by key"""
         if self.spec.params:
@@ -1895,15 +1899,17 @@
         sync: bool = False,
         watch: bool = False,
         dirty: bool = False,
         # TODO: deprecated, remove in 1.5.0
         ttl: int = None,
         engine: str = None,
         local: bool = None,
-        schedule: typing.Union[str, mlrun.api.schemas.ScheduleCronTrigger, bool] = None,
+        schedule: typing.Union[
+            str, mlrun.common.schemas.ScheduleCronTrigger, bool
+        ] = None,
         timeout: int = None,
         overwrite: bool = False,
         source: str = None,
         cleanup_ttl: int = None,
     ) -> _PipelineRunStatus:
         """run a workflow using kubeflow pipelines
 
@@ -2139,37 +2145,50 @@
                 zipf.write(write_path, arcname=write_path.relative_to(project_dir))
             zipf.close()
             if tmp_path:
                 mlrun.get_dataitem(filepath).upload(tmp_path)
                 remove(tmp_path)
 
     def set_model_monitoring_credentials(
-        self, access_key: str = None, endpoint_store_connection: str = None
+        self,
+        access_key: str = None,
+        endpoint_store_connection: str = None,
+        stream_path: str = None,
     ):
         """Set the credentials that will be used by the project's model monitoring
         infrastructure functions.
 
         :param access_key:                Model Monitoring access key for managing user permissions
         :param endpoint_store_connection: Endpoint store connection string
+        :param stream_path:               Path to the model monitoring stream
         """
 
         secrets_dict = {}
         if access_key:
             secrets_dict[
                 model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY
             ] = access_key
 
         if endpoint_store_connection:
             secrets_dict[
                 model_monitoring_constants.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION
             ] = endpoint_store_connection
 
+        if stream_path:
+            if stream_path.startswith("kafka://") and "?topic" in stream_path:
+                raise mlrun.errors.MLRunInvalidArgumentError(
+                    "Custom kafka topic is not allowed"
+                )
+            secrets_dict[
+                model_monitoring_constants.ProjectSecretKeys.STREAM_PATH
+            ] = stream_path
+
         self.set_secrets(
             secrets=secrets_dict,
-            provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+            provider=mlrun.common.schemas.SecretProviderName.kubernetes,
         )
 
     def run_function(
         self,
         function: typing.Union[str, mlrun.runtimes.BaseRuntime],
         handler: str = None,
         name: str = "",
@@ -2182,24 +2201,24 @@
         labels: dict = None,
         base_task: mlrun.model.RunTemplate = None,
         watch: bool = True,
         local: bool = None,
         verbose: bool = None,
         selector: str = None,
         auto_build: bool = None,
-        schedule: typing.Union[str, mlrun.api.schemas.ScheduleCronTrigger] = None,
+        schedule: typing.Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         artifact_path: str = None,
         notifications: typing.List[mlrun.model.Notification] = None,
         returns: Optional[List[Union[str, Dict[str, str]]]] = None,
     ) -> typing.Union[mlrun.model.RunObject, kfp.dsl.ContainerOp]:
         """Run a local or remote task as part of a local/kubeflow pipeline
 
         example (use with project)::
 
-            # create a project with two functions (local and from marketplace)
+            # create a project with two functions (local and from hub)
             project = mlrun.new_project(project_name, "./proj")
             project.set_function("mycode.py", "myfunc", image="mlrun/mlrun")
             project.set_function("hub://auto-trainer", "train")
 
             # run functions (refer to them by name)
             run1 = project.run_function("myfunc", params={"x": 7})
             run2 = project.run_function("train", params={"label_columns": LABELS},
@@ -2366,15 +2385,15 @@
         tag=None,
         labels: Optional[Union[Dict[str, str], List[str]]] = None,
         since=None,
         until=None,
         iter: int = None,
         best_iteration: bool = False,
         kind: str = None,
-        category: typing.Union[str, mlrun.api.schemas.ArtifactCategories] = None,
+        category: typing.Union[str, mlrun.common.schemas.ArtifactCategories] = None,
     ) -> mlrun.lists.ArtifactList:
         """List artifacts filtered by various parameters.
 
         The returned result is an `ArtifactList` (list of dict), use `.to_objects()` to convert it to a list of
         RunObjects, `.show()` to view graphically in Jupyter, and `.to_df()` to convert to a DataFrame.
 
         Examples::
```

## mlrun/runtimes/base.py

```diff
@@ -30,29 +30,28 @@
 import requests.exceptions
 from kubernetes.client.rest import ApiException
 from nuclio.build import mlrun_footer
 from sqlalchemy.orm import Session
 
 import mlrun.api.db.sqldb.session
 import mlrun.api.utils.singletons.db
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.notifications
 import mlrun.utils.regex
-from mlrun.api import schemas
 from mlrun.api.constants import LogSources
 from mlrun.api.db.base import DBInterface
 from mlrun.utils.helpers import generate_object_uri, verify_field_regex
 
 from ..config import config, is_running_as_api
 from ..datastore import store_manager
 from ..db import RunDBError, get_or_set_dburl, get_run_db
 from ..errors import err_to_str
 from ..execution import MLClientCtx
-from ..k8s_utils import get_k8s_helper
 from ..kfpops import mlrun_op, write_kfpmeta
 from ..lists import RunList
 from ..model import (
     BaseMetadata,
     HyperParamOptions,
     ImageBuilder,
     ModelObj,
@@ -72,15 +71,15 @@
     normalize_name,
     now_date,
     update_in,
 )
 from .constants import PodPhases, RunStates
 from .funcdoc import update_function_entry_points
 from .generators import get_generator
-from .utils import RunError, calc_hash, results_to_iter
+from .utils import RunError, calc_hash, get_k8s, results_to_iter
 
 run_modes = ["pass"]
 spec_fields = [
     "command",
     "args",
     "image",
     "mode",
@@ -219,17 +218,14 @@
     def status(self) -> FunctionStatus:
         return self._status
 
     @status.setter
     def status(self, status):
         self._status = self._verify_dict(status, "status", FunctionStatus)
 
-    def _get_k8s(self):
-        return get_k8s_helper()
-
     def set_label(self, key, value):
         self.metadata.labels[key] = str(value)
         return self
 
     @property
     def uri(self):
         return self._function_uri()
@@ -334,15 +330,15 @@
         project: str = "",
         params: dict = None,
         inputs: Dict[str, str] = None,
         out_path: str = "",
         workdir: str = "",
         artifact_path: str = "",
         watch: bool = True,
-        schedule: Union[str, schemas.ScheduleCronTrigger] = None,
+        schedule: Union[str, mlrun.common.schemas.ScheduleCronTrigger] = None,
         hyperparams: Dict[str, list] = None,
         hyper_param_options: HyperParamOptions = None,
         verbose=None,
         scrape_metrics: bool = None,
         local=False,
         local_code_path=None,
         auto_build=None,
@@ -1547,27 +1543,26 @@
         return [class_mode] if class_mode else []
 
     def list_resources(
         self,
         project: str,
         object_id: typing.Optional[str] = None,
         label_selector: str = None,
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ) -> Union[
-        mlrun.api.schemas.RuntimeResources,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResources,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ]:
         # We currently don't support removing runtime resources in non k8s env
-        if not mlrun.k8s_utils.get_k8s_helper(
-            silent=True
-        ).is_running_inside_kubernetes_cluster():
+        if not get_k8s().is_running_inside_kubernetes_cluster():
             return {}
-        k8s_helper = get_k8s_helper()
-        namespace = k8s_helper.resolve_namespace()
+        namespace = get_k8s().resolve_namespace()
         label_selector = self.resolve_label_selector(project, object_id, label_selector)
         pods = self._list_pods(namespace, label_selector)
         pod_resources = self._build_pod_resources(pods)
         crd_objects = self._list_crd_objects(namespace, label_selector)
         crd_resources = self._build_crd_resources(crd_objects)
         response = self._build_list_resources_response(
             pod_resources, crd_resources, group_by
@@ -1575,16 +1570,18 @@
         response = self._enrich_list_resources_response(
             response, namespace, label_selector, group_by
         )
         return response
 
     def build_output_from_runtime_resources(
         self,
-        runtime_resources_list: List[mlrun.api.schemas.RuntimeResources],
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        runtime_resources_list: List[mlrun.common.schemas.RuntimeResources],
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ):
         pod_resources = []
         crd_resources = []
         for runtime_resources in runtime_resources_list:
             pod_resources += runtime_resources.pod_resources
             crd_resources += runtime_resources.crd_resources
         response = self._build_list_resources_response(
@@ -1602,20 +1599,17 @@
         label_selector: str = None,
         force: bool = False,
         grace_period: int = None,
     ):
         if grace_period is None:
             grace_period = config.runtime_resources_deletion_grace_period
         # We currently don't support removing runtime resources in non k8s env
-        if not mlrun.k8s_utils.get_k8s_helper(
-            silent=True
-        ).is_running_inside_kubernetes_cluster():
+        if not get_k8s().is_running_inside_kubernetes_cluster():
             return
-        k8s_helper = get_k8s_helper()
-        namespace = k8s_helper.resolve_namespace()
+        namespace = get_k8s().resolve_namespace()
         label_selector = self.resolve_label_selector("*", label_selector=label_selector)
         crd_group, crd_version, crd_plural = self._get_crd_info()
         if crd_group and crd_version and crd_plural:
             deleted_resources = self._delete_crd_resources(
                 db,
                 db_session,
                 namespace,
@@ -1655,16 +1649,15 @@
             grace_period = config.runtime_resources_deletion_grace_period
         label_selector = self._add_object_label_selector_if_needed(
             object_id, label_selector
         )
         self.delete_resources(db, db_session, label_selector, force, grace_period)
 
     def monitor_runs(self, db: DBInterface, db_session: Session):
-        k8s_helper = get_k8s_helper()
-        namespace = k8s_helper.resolve_namespace()
+        namespace = get_k8s().resolve_namespace()
         label_selector = self._get_default_label_selector()
         crd_group, crd_version, crd_plural = self._get_crd_info()
         runtime_resource_is_crd = False
         if crd_group and crd_version and crd_plural:
             runtime_resource_is_crd = True
             runtime_resources = self._list_crd_objects(namespace, label_selector)
         else:
@@ -1828,40 +1821,44 @@
         :return: the label selector
         """
         return ""
 
     def _enrich_list_resources_response(
         self,
         response: Union[
-            mlrun.api.schemas.RuntimeResources,
-            mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+            mlrun.common.schemas.RuntimeResources,
+            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
         ],
         namespace: str,
         label_selector: str = None,
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ) -> Union[
-        mlrun.api.schemas.RuntimeResources,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResources,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ]:
         """
         Override this to list resources other then pods or CRDs (which are handled by the base class)
         """
         return response
 
     def _build_output_from_runtime_resources(
         self,
         response: Union[
-            mlrun.api.schemas.RuntimeResources,
-            mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+            mlrun.common.schemas.RuntimeResources,
+            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
         ],
-        runtime_resources_list: List[mlrun.api.schemas.RuntimeResources],
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        runtime_resources_list: List[mlrun.common.schemas.RuntimeResources],
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ):
         """
         Override this to add runtime resources other than pods or CRDs (which are handled by the base class) to the
         output
         """
         return response
 
@@ -1984,28 +1981,26 @@
         return False
 
     @staticmethod
     def _expect_pods_without_uid() -> bool:
         return False
 
     def _list_pods(self, namespace: str, label_selector: str = None) -> List:
-        k8s_helper = get_k8s_helper()
-        pods = k8s_helper.list_pods(namespace, selector=label_selector)
+        pods = get_k8s().list_pods(namespace, selector=label_selector)
         # when we work with custom objects (list_namespaced_custom_object) it's always a dict, to be able to generalize
         # code working on runtime resource (either a custom object or a pod) we're transforming to dicts
         pods = [pod.to_dict() for pod in pods]
         return pods
 
     def _list_crd_objects(self, namespace: str, label_selector: str = None) -> List:
-        k8s_helper = get_k8s_helper()
         crd_group, crd_version, crd_plural = self._get_crd_info()
         crd_objects = []
         if crd_group and crd_version and crd_plural:
             try:
-                crd_objects = k8s_helper.crdapi.list_namespaced_custom_object(
+                crd_objects = get_k8s().crdapi.list_namespaced_custom_object(
                     crd_group,
                     crd_version,
                     namespace,
                     crd_plural,
                     label_selector=label_selector,
                 )
             except ApiException as exc:
@@ -2063,19 +2058,18 @@
 
     def _wait_for_pods_deletion(
         self,
         namespace: str,
         deleted_pods: List[Dict],
         label_selector: str = None,
     ):
-        k8s_helper = get_k8s_helper()
         deleted_pod_names = [pod_dict["metadata"]["name"] for pod_dict in deleted_pods]
 
         def _verify_pods_removed():
-            pods = k8s_helper.v1api.list_namespaced_pod(
+            pods = get_k8s().v1api.list_namespaced_pod(
                 namespace, label_selector=label_selector
             )
             existing_pod_names = [pod.metadata.name for pod in pods.items]
             still_in_deletion_pods = set(existing_pod_names).intersection(
                 deleted_pod_names
             )
             if still_in_deletion_pods:
@@ -2120,18 +2114,18 @@
                         crd=crd,
                     )
                     continue
                 project_uid_crd_map.setdefault(project, {})[uid] = crd["metadata"][
                     "name"
                 ]
             still_in_deletion_crds_to_pod_names = {}
-            jobs_runtime_resources: mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput = self.list_resources(
+            jobs_runtime_resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput = self.list_resources(
                 "*",
                 label_selector=label_selector,
-                group_by=mlrun.api.schemas.ListRuntimeResourcesGroupByField.job,
+                group_by=mlrun.common.schemas.ListRuntimeResourcesGroupByField.job,
             )
             for project, project_jobs in jobs_runtime_resources.items():
                 if project not in project_uid_crd_map:
                     continue
                 for job_uid, job_runtime_resources in jobs_runtime_resources[
                     project
                 ].items():
@@ -2171,16 +2165,15 @@
         namespace: str,
         label_selector: str = None,
         force: bool = False,
         grace_period: int = None,
     ) -> List[Dict]:
         if grace_period is None:
             grace_period = config.runtime_resources_deletion_grace_period
-        k8s_helper = get_k8s_helper()
-        pods = k8s_helper.v1api.list_namespaced_pod(
+        pods = get_k8s().v1api.list_namespaced_pod(
             namespace, label_selector=label_selector
         )
         deleted_pods = []
         for pod in pods.items:
             pod_dict = pod.to_dict()
 
             # best effort - don't let one failure in pod deletion to cut the whole operation
@@ -2213,15 +2206,15 @@
                         # Don't prevent the deletion for failure in the pre deletion run actions
                         logger.warning(
                             "Failure in pod run pre-deletion actions. Continuing",
                             exc=repr(exc),
                             pod_name=pod.metadata.name,
                         )
 
-                get_k8s_helper().delete_pod(pod.metadata.name, namespace)
+                get_k8s().delete_pod(pod.metadata.name, namespace)
                 deleted_pods.append(pod_dict)
             except Exception as exc:
                 logger.warning(
                     f"Cleanup failed processing pod {pod.metadata.name}: {repr(exc)}. Continuing"
                 )
         # TODO: don't wait for pods to be deleted, client should poll the deletion status
         self._wait_for_pods_deletion(namespace, deleted_pods, label_selector)
@@ -2234,19 +2227,18 @@
         namespace: str,
         label_selector: str = None,
         force: bool = False,
         grace_period: int = None,
     ) -> List[Dict]:
         if grace_period is None:
             grace_period = config.runtime_resources_deletion_grace_period
-        k8s_helper = get_k8s_helper()
         crd_group, crd_version, crd_plural = self._get_crd_info()
         deleted_crds = []
         try:
-            crd_objects = k8s_helper.crdapi.list_namespaced_custom_object(
+            crd_objects = get_k8s().crdapi.list_namespaced_custom_object(
                 crd_group,
                 crd_version,
                 namespace,
                 crd_plural,
                 label_selector=label_selector,
             )
         except ApiException as exc:
@@ -2290,15 +2282,15 @@
                             # Don't prevent the deletion for failure in the pre deletion run actions
                             logger.warning(
                                 "Failure in crd object run pre-deletion actions. Continuing",
                                 exc=err_to_str(exc),
                                 crd_object_name=crd_object["metadata"]["name"],
                             )
 
-                    get_k8s_helper().delete_crd(
+                    get_k8s().delete_crd(
                         crd_object["metadata"]["name"],
                         crd_group,
                         crd_version,
                         crd_plural,
                         namespace,
                     )
                     deleted_crds.append(crd_object)
@@ -2466,118 +2458,125 @@
             search_run=False,
         )
         if updated_run_state in RunStates.terminal_states():
             self._ensure_run_logs_collected(db, db_session, project, uid)
 
     def _build_list_resources_response(
         self,
-        pod_resources: List[mlrun.api.schemas.RuntimeResource] = None,
-        crd_resources: List[mlrun.api.schemas.RuntimeResource] = None,
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        pod_resources: List[mlrun.common.schemas.RuntimeResource] = None,
+        crd_resources: List[mlrun.common.schemas.RuntimeResource] = None,
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ) -> Union[
-        mlrun.api.schemas.RuntimeResources,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResources,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ]:
         if crd_resources is None:
             crd_resources = []
         if pod_resources is None:
             pod_resources = []
 
         if group_by is None:
-            return mlrun.api.schemas.RuntimeResources(
+            return mlrun.common.schemas.RuntimeResources(
                 crd_resources=crd_resources, pod_resources=pod_resources
             )
         else:
-            if group_by == mlrun.api.schemas.ListRuntimeResourcesGroupByField.job:
+            if group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.job:
                 return self._build_grouped_by_job_list_resources_response(
                     pod_resources, crd_resources
                 )
-            elif group_by == mlrun.api.schemas.ListRuntimeResourcesGroupByField.project:
+            elif (
+                group_by
+                == mlrun.common.schemas.ListRuntimeResourcesGroupByField.project
+            ):
                 return self._build_grouped_by_project_list_resources_response(
                     pod_resources, crd_resources
                 )
             else:
                 raise NotImplementedError(
                     f"Provided group by field is not supported. group_by={group_by}"
                 )
 
     def _build_grouped_by_project_list_resources_response(
         self,
-        pod_resources: List[mlrun.api.schemas.RuntimeResource] = None,
-        crd_resources: List[mlrun.api.schemas.RuntimeResource] = None,
-    ) -> mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput:
+        pod_resources: List[mlrun.common.schemas.RuntimeResource] = None,
+        crd_resources: List[mlrun.common.schemas.RuntimeResource] = None,
+    ) -> mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput:
         resources = {}
         for pod_resource in pod_resources:
             self._add_resource_to_grouped_by_project_resources_response(
                 resources, "pod_resources", pod_resource
             )
         for crd_resource in crd_resources:
             self._add_resource_to_grouped_by_project_resources_response(
                 resources, "crd_resources", crd_resource
             )
         return resources
 
     def _build_grouped_by_job_list_resources_response(
         self,
-        pod_resources: List[mlrun.api.schemas.RuntimeResource] = None,
-        crd_resources: List[mlrun.api.schemas.RuntimeResource] = None,
-    ) -> mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput:
+        pod_resources: List[mlrun.common.schemas.RuntimeResource] = None,
+        crd_resources: List[mlrun.common.schemas.RuntimeResource] = None,
+    ) -> mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput:
         resources = {}
         for pod_resource in pod_resources:
             self._add_resource_to_grouped_by_job_resources_response(
                 resources, "pod_resources", pod_resource
             )
         for crd_resource in crd_resources:
             self._add_resource_to_grouped_by_job_resources_response(
                 resources, "crd_resources", crd_resource
             )
         return resources
 
     def _add_resource_to_grouped_by_project_resources_response(
         self,
-        resources: mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
+        resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
         resource_field_name: str,
-        resource: mlrun.api.schemas.RuntimeResource,
+        resource: mlrun.common.schemas.RuntimeResource,
     ):
         if "mlrun/class" in resource.labels:
             project = resource.labels.get("mlrun/project", "")
             mlrun_class = resource.labels["mlrun/class"]
             kind = self._resolve_kind_from_class(mlrun_class)
             self._add_resource_to_grouped_by_field_resources_response(
                 project, kind, resources, resource_field_name, resource
             )
 
     def _add_resource_to_grouped_by_job_resources_response(
         self,
-        resources: mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
+        resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
         resource_field_name: str,
-        resource: mlrun.api.schemas.RuntimeResource,
+        resource: mlrun.common.schemas.RuntimeResource,
     ):
         if "mlrun/uid" in resource.labels:
             project = resource.labels.get("mlrun/project", config.default_project)
             uid = resource.labels["mlrun/uid"]
             self._add_resource_to_grouped_by_field_resources_response(
                 project, uid, resources, resource_field_name, resource
             )
 
     @staticmethod
     def _add_resource_to_grouped_by_field_resources_response(
         first_field_value: str,
         second_field_value: str,
-        resources: mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
+        resources: mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
         resource_field_name: str,
-        resource: mlrun.api.schemas.RuntimeResource,
+        resource: mlrun.common.schemas.RuntimeResource,
     ):
         if first_field_value not in resources:
             resources[first_field_value] = {}
         if second_field_value not in resources[first_field_value]:
             resources[first_field_value][
                 second_field_value
-            ] = mlrun.api.schemas.RuntimeResources(pod_resources=[], crd_resources=[])
+            ] = mlrun.common.schemas.RuntimeResources(
+                pod_resources=[], crd_resources=[]
+            )
         if not getattr(
             resources[first_field_value][second_field_value], resource_field_name
         ):
             setattr(
                 resources[first_field_value][second_field_value],
                 resource_field_name,
                 [],
@@ -2703,31 +2702,33 @@
             runtime_resource.get("metadata", {})
             .get("labels", {})
             .get("mlrun/name", "no-name")
         )
         return project, uid, name
 
     @staticmethod
-    def _build_pod_resources(pods) -> List[mlrun.api.schemas.RuntimeResource]:
+    def _build_pod_resources(pods) -> List[mlrun.common.schemas.RuntimeResource]:
         pod_resources = []
         for pod in pods:
             pod_resources.append(
-                mlrun.api.schemas.RuntimeResource(
+                mlrun.common.schemas.RuntimeResource(
                     name=pod["metadata"]["name"],
                     labels=pod["metadata"]["labels"],
                     status=pod["status"],
                 )
             )
         return pod_resources
 
     @staticmethod
-    def _build_crd_resources(custom_objects) -> List[mlrun.api.schemas.RuntimeResource]:
+    def _build_crd_resources(
+        custom_objects,
+    ) -> List[mlrun.common.schemas.RuntimeResource]:
         crd_resources = []
         for custom_object in custom_objects:
             crd_resources.append(
-                mlrun.api.schemas.RuntimeResource(
+                mlrun.common.schemas.RuntimeResource(
                     name=custom_object["metadata"]["name"],
                     labels=custom_object["metadata"]["labels"],
                     status=custom_object.get("status", {}),
                 )
             )
         return crd_resources
```

## mlrun/runtimes/daskjob.py

```diff
@@ -19,33 +19,33 @@
 from os import environ
 from typing import Dict, List, Optional, Union
 
 from deprecated import deprecated
 from kubernetes.client.rest import ApiException
 from sqlalchemy.orm import Session
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.errors
+import mlrun.k8s_utils
 import mlrun.utils
 import mlrun.utils.regex
 from mlrun.api.db.base import DBInterface
 from mlrun.errors import err_to_str
 from mlrun.runtimes.base import BaseRuntimeHandler
 
 from ..config import config
 from ..execution import MLClientCtx
-from ..k8s_utils import get_k8s_helper
 from ..model import RunObject
 from ..render import ipython_display
 from ..utils import logger, normalize_name, update_in
 from .base import FunctionStatus, RuntimeClassMode
 from .kubejob import KubejobRuntime
 from .local import exec_from_params, load_module
 from .pod import KubeResourceSpec, kube_resource_spec_to_pod_spec
-from .utils import RunError, get_func_selector, get_resource_labels, log_std
+from .utils import RunError, get_func_selector, get_k8s, get_resource_labels, log_std
 
 
 def get_dask_resource():
     return {
         "scope": "function",
         "start": deploy_function,
         "status": get_obj_status,
@@ -199,17 +199,15 @@
     kind = "dask"
     _is_nested = False
     _is_remote = False
 
     def __init__(self, spec=None, metadata=None):
         super().__init__(spec, metadata)
         self._cluster = None
-        self.use_remote = not get_k8s_helper(
-            silent=True
-        ).is_running_inside_kubernetes_cluster()
+        self.use_remote = not mlrun.k8s_utils.is_running_inside_kubernetes_cluster()
         self.spec.build.base_image = self.spec.build.base_image or "daskdev/dask:latest"
 
     @property
     def spec(self) -> DaskSpec:
         return self._spec
 
     @spec.setter
@@ -269,19 +267,19 @@
                 timeout = now + datetime.timedelta(minutes=10)
                 while now < timeout:
                     background_task = db.get_project_background_task(
                         background_task.metadata.project, background_task.metadata.name
                     )
                     if (
                         background_task.status.state
-                        in mlrun.api.schemas.BackgroundTaskState.terminal_states()
+                        in mlrun.common.schemas.BackgroundTaskState.terminal_states()
                     ):
                         if (
                             background_task.status.state
-                            == mlrun.api.schemas.BackgroundTaskState.failed
+                            == mlrun.common.schemas.BackgroundTaskState.failed
                         ):
                             raise mlrun.errors.MLRunRuntimeError(
                                 "Failed bringing up dask cluster"
                             )
                         else:
                             function = db.get_function(
                                 self.metadata.name,
@@ -669,15 +667,17 @@
         raise exc
 
 
 def get_obj_status(selector=None, namespace=None):
     if selector is None:
         selector = []
 
-    k8s = get_k8s_helper()
+    import mlrun.api.utils.singletons.k8s
+
+    k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper()
     namespace = namespace or config.namespace
     selector = ",".join(["dask.org/component=scheduler"] + selector)
     pods = k8s.list_pods(namespace, selector=selector)
     status = ""
     for pod in pods:
         status = pod.status.phase.lower()
         if status == "running":
@@ -728,95 +728,102 @@
             return project_and_function.split("/")[-1]
 
         return None
 
     def _enrich_list_resources_response(
         self,
         response: Union[
-            mlrun.api.schemas.RuntimeResources,
-            mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+            mlrun.common.schemas.RuntimeResources,
+            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
         ],
         namespace: str,
         label_selector: str = None,
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ) -> Union[
-        mlrun.api.schemas.RuntimeResources,
-        mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-        mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+        mlrun.common.schemas.RuntimeResources,
+        mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+        mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
     ]:
         """
         Handling listing service resources
         """
         enrich_needed = self._validate_if_enrich_is_needed_by_group_by(group_by)
         if not enrich_needed:
             return response
-        k8s_helper = get_k8s_helper()
-        services = k8s_helper.v1api.list_namespaced_service(
+        services = get_k8s().v1api.list_namespaced_service(
             namespace, label_selector=label_selector
         )
         service_resources = []
         for service in services.items:
             service_resources.append(
-                mlrun.api.schemas.RuntimeResource(
+                mlrun.common.schemas.RuntimeResource(
                     name=service.metadata.name, labels=service.metadata.labels
                 )
             )
         return self._enrich_service_resources_in_response(
             response, service_resources, group_by
         )
 
     def _build_output_from_runtime_resources(
         self,
         response: Union[
-            mlrun.api.schemas.RuntimeResources,
-            mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+            mlrun.common.schemas.RuntimeResources,
+            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
         ],
-        runtime_resources_list: List[mlrun.api.schemas.RuntimeResources],
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        runtime_resources_list: List[mlrun.common.schemas.RuntimeResources],
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ):
         enrich_needed = self._validate_if_enrich_is_needed_by_group_by(group_by)
         if not enrich_needed:
             return response
         service_resources = []
         for runtime_resources in runtime_resources_list:
             if runtime_resources.service_resources:
                 service_resources += runtime_resources.service_resources
         return self._enrich_service_resources_in_response(
             response, service_resources, group_by
         )
 
     def _validate_if_enrich_is_needed_by_group_by(
         self,
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ) -> bool:
         # Dask runtime resources are per function (and not per job) therefore, when grouping by job we're simply
         # omitting the dask runtime resources
-        if group_by == mlrun.api.schemas.ListRuntimeResourcesGroupByField.job:
+        if group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.job:
             return False
-        elif group_by == mlrun.api.schemas.ListRuntimeResourcesGroupByField.project:
+        elif group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.project:
             return True
         elif group_by is not None:
             raise NotImplementedError(
                 f"Provided group by field is not supported. group_by={group_by}"
             )
         return True
 
     def _enrich_service_resources_in_response(
         self,
         response: Union[
-            mlrun.api.schemas.RuntimeResources,
-            mlrun.api.schemas.GroupedByJobRuntimeResourcesOutput,
-            mlrun.api.schemas.GroupedByProjectRuntimeResourcesOutput,
+            mlrun.common.schemas.RuntimeResources,
+            mlrun.common.schemas.GroupedByJobRuntimeResourcesOutput,
+            mlrun.common.schemas.GroupedByProjectRuntimeResourcesOutput,
         ],
-        service_resources: List[mlrun.api.schemas.RuntimeResource],
-        group_by: Optional[mlrun.api.schemas.ListRuntimeResourcesGroupByField] = None,
+        service_resources: List[mlrun.common.schemas.RuntimeResource],
+        group_by: Optional[
+            mlrun.common.schemas.ListRuntimeResourcesGroupByField
+        ] = None,
     ):
-        if group_by == mlrun.api.schemas.ListRuntimeResourcesGroupByField.project:
+        if group_by == mlrun.common.schemas.ListRuntimeResourcesGroupByField.project:
             for service_resource in service_resources:
                 self._add_resource_to_grouped_by_project_resources_response(
                     response, "service_resources", service_resource
                 )
         else:
             response.service_resources = service_resources
         return response
@@ -843,22 +850,21 @@
             )
             cluster_name = (
                 pod_dict["metadata"].get("labels", {}).get("dask.org/cluster-name")
             )
             if dask_component == "scheduler" and cluster_name:
                 service_names.append(cluster_name)
 
-        k8s_helper = get_k8s_helper()
-        services = k8s_helper.v1api.list_namespaced_service(
+        services = get_k8s().v1api.list_namespaced_service(
             namespace, label_selector=label_selector
         )
         for service in services.items:
             try:
                 if force or service.metadata.name in service_names:
-                    k8s_helper.v1api.delete_namespaced_service(
+                    get_k8s().v1api.delete_namespaced_service(
                         service.metadata.name, namespace
                     )
                     logger.info(f"Deleted service: {service.metadata.name}")
             except ApiException as exc:
                 # ignore error if service is already removed
                 if exc.status != 404:
                     raise
```

## mlrun/runtimes/function.py

```diff
@@ -10,54 +10,48 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import asyncio
 import json
-import shlex
 import typing
 import warnings
-from base64 import b64encode
 from datetime import datetime
 from time import sleep
-from urllib.parse import urlparse
 
 import nuclio
 import nuclio.utils
 import requests
 import semver
 from aiohttp.client import ClientSession
 from kubernetes import client
 from nuclio.deploy import find_dashboard_url, get_deploy_status
 from nuclio.triggers import V3IOStreamTrigger
 
 import mlrun.errors
+import mlrun.k8s_utils
 import mlrun.utils
-from mlrun.datastore import parse_s3_bucket_and_key
+from mlrun.common.schemas import AuthInfo
 from mlrun.db import RunDBError
 
-from ..api.schemas import AuthInfo
 from ..config import config as mlconf
-from ..config import is_running_as_api
 from ..errors import err_to_str
-from ..k8s_utils import get_k8s_helper
 from ..kfpops import deploy_op
 from ..lists import RunList
 from ..model import RunObject
 from ..platforms.iguazio import (
     VolumeMount,
     mount_v3io,
     parse_path,
     split_path,
     v3io_cred,
 )
-from ..utils import as_number, enrich_image_url, get_in, logger, update_in
+from ..utils import get_in, logger, update_in
 from .base import FunctionStatus, RunError
-from .constants import NuclioIngressAddTemplatedIngressModes
 from .pod import KubeResource, KubeResourceSpec
 from .utils import get_item_name, log_std
 
 
 def validate_nuclio_version_compatibility(*min_versions):
     """
     :param min_versions: Valid minimum version(s) required, assuming no 2 versions has equal major and minor.
@@ -565,74 +559,47 @@
         if verbose:
             self.set_env("MLRUN_LOG_LEVEL", "DEBUG")
         if project:
             self.metadata.project = project
         if tag:
             self.metadata.tag = tag
 
-        save_record = False
-        if not dashboard:
-            # Attempt auto-mounting, before sending to remote build
-            self.try_auto_mount_based_on_config()
-            self._fill_credentials()
-            db = self._get_db()
-            logger.info("Starting remote function deploy")
-            data = db.remote_builder(self, False, builder_env=builder_env)
-            self.status = data["data"].get("status")
-            self._update_credentials_from_remote_build(data["data"])
-
-            # when a function is deployed, we wait for it to be ready by default
-            # this also means that the function object will be updated with the function status
-            self._wait_for_function_deployment(db, verbose=verbose)
-
-            # NOTE: on older mlrun versions & nuclio versions, function are exposed via NodePort
-            #       now, functions can be not exposed (using service type ClusterIP) and hence
-            #       for BC we first try to populate the external invocation url, and then
-            #       if not exists, take the internal invocation url
-            if self.status.external_invocation_urls:
-                self.spec.command = f"http://{self.status.external_invocation_urls[0]}"
-                save_record = True
-            elif self.status.internal_invocation_urls:
-                self.spec.command = f"http://{self.status.internal_invocation_urls[0]}"
-                save_record = True
-            elif self.status.address:
-                self.spec.command = f"http://{self.status.address}"
-                save_record = True
-
-        else:
-
+        if dashboard:
             warnings.warn(
-                "'dashboard' is deprecated in 1.3.0, and will be removed in 1.5.0, "
-                "Keep 'dashboard' value empty to allow auto-detection by MLRun API.",
-                # TODO: Remove in 1.5.0
-                FutureWarning,
+                "'dashboard' parameter is no longer supported on client side, "
+                "it is being configured through the MLRun API.",
             )
 
-            self.save(versioned=False)
-            self._ensure_run_db()
-            internal_invocation_urls, external_invocation_urls = deploy_nuclio_function(
-                self,
-                dashboard=dashboard,
-                watch=True,
-                auth_info=auth_info,
-            )
-            self.status.internal_invocation_urls = internal_invocation_urls
-            self.status.external_invocation_urls = external_invocation_urls
-
-            # save the (first) function external invocation url
-            # this is made for backwards compatability because the user, at this point, may
-            # work remotely and need the external invocation url on the spec.command
-            # TODO: when using `ClusterIP`, this block might not fulfilled
-            #       as long as function doesnt have ingresses
-            if self.status.external_invocation_urls:
-                address = self.status.external_invocation_urls[0]
-                self.spec.command = f"http://{address}"
-                self.status.state = "ready"
-                self.status.address = address
-                save_record = True
+        save_record = False
+        # Attempt auto-mounting, before sending to remote build
+        self.try_auto_mount_based_on_config()
+        self._fill_credentials()
+        db = self._get_db()
+        logger.info("Starting remote function deploy")
+        data = db.remote_builder(self, False, builder_env=builder_env)
+        self.status = data["data"].get("status")
+        self._update_credentials_from_remote_build(data["data"])
+
+        # when a function is deployed, we wait for it to be ready by default
+        # this also means that the function object will be updated with the function status
+        self._wait_for_function_deployment(db, verbose=verbose)
+
+        # NOTE: on older mlrun versions & nuclio versions, function are exposed via NodePort
+        #       now, functions can be not exposed (using service type ClusterIP) and hence
+        #       for BC we first try to populate the external invocation url, and then
+        #       if not exists, take the internal invocation url
+        if self.status.external_invocation_urls:
+            self.spec.command = f"http://{self.status.external_invocation_urls[0]}"
+            save_record = True
+        elif self.status.internal_invocation_urls:
+            self.spec.command = f"http://{self.status.internal_invocation_urls[0]}"
+            save_record = True
+        elif self.status.address:
+            self.spec.command = f"http://{self.status.address}"
+            save_record = True
 
         logger.info(
             "successfully deployed function",
             internal_invocation_urls=self.status.internal_invocation_urls,
             external_invocation_urls=self.status.external_invocation_urls,
         )
 
@@ -690,15 +657,15 @@
         * **constrain** - The function can only run on preemptible nodes
         * **prevent** - The function cannot be scheduled on preemptible nodes
         * **none** - No preemptible configuration will be applied on the function
 
         The default preemption mode is configurable in mlrun.mlconf.function_defaults.preemption_mode,
         by default it's set to **prevent**
 
-        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.api.schemas.PreemptionModes`
+        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.common.schemas.PreemptionModes`
         """
         super().with_preemption_mode(mode=mode)
 
     @min_nuclio_versions("1.6.18")
     def with_priority_class(self, name: typing.Optional[str] = None):
         """k8s priority class"""
         super().with_priority_class(name)
@@ -1079,17 +1046,15 @@
 
         # internal / external invocation urls is a nuclio >= 1.6.x feature
         # try to infer the invocation url from the internal and if not exists, use external.
         # $$$$ we do not want to use the external invocation url (e.g.: ingress, nodePort, etc.)
         if (
             not force_external_address
             and self.status.internal_invocation_urls
-            and get_k8s_helper(
-                silent=True, log=False
-            ).is_running_inside_kubernetes_cluster()
+            and mlrun.k8s_utils.is_running_inside_kubernetes_cluster()
         ):
             return f"http://{self.status.internal_invocation_urls[0]}{path}"
 
         if self.status.external_invocation_urls:
             return f"http://{self.status.external_invocation_urls[0]}{path}"
         else:
             return f"http://{self.status.address}{path}"
@@ -1200,459 +1165,14 @@
     if project:
         name = f"{project}-{name}"
     if tag and tag != "latest":
         name = f"{name}-{tag}"
     return name
 
 
-def deploy_nuclio_function(
-    function: RemoteRuntime,
-    dashboard="",
-    watch=False,
-    auth_info: AuthInfo = None,
-    client_version: str = None,
-    builder_env: dict = None,
-    client_python_version: str = None,
-):
-    """Deploys a nuclio function.
-
-    :param function:              nuclio function object
-    :param dashboard:             DEPRECATED. Keep empty to allow auto-detection by MLRun API.
-    :param watch:                 wait for function to be ready
-    :param auth_info:             service AuthInfo
-    :param client_version:        mlrun client version
-    :param builder_env:           mlrun builder environment (for config/credentials)
-    :param client_python_version: mlrun client python version
-    """
-    dashboard = dashboard or mlconf.nuclio_dashboard_url
-    function_name, project_name, function_config = compile_function_config(
-        function,
-        client_version=client_version,
-        client_python_version=client_python_version,
-        builder_env=builder_env or {},
-        auth_info=auth_info,
-    )
-
-    # if mode allows it, enrich function http trigger with an ingress
-    enrich_function_with_ingress(
-        function_config,
-        function.spec.add_templated_ingress_host_mode
-        or mlconf.httpdb.nuclio.add_templated_ingress_host_mode,
-        function.spec.service_type or mlconf.httpdb.nuclio.default_service_type,
-    )
-
-    try:
-        return nuclio.deploy.deploy_config(
-            function_config,
-            dashboard_url=dashboard,
-            name=function_name,
-            project=project_name,
-            tag=function.metadata.tag,
-            verbose=function.verbose,
-            create_new=True,
-            watch=watch,
-            return_address_mode=nuclio.deploy.ReturnAddressModes.all,
-            auth_info=auth_info.to_nuclio_auth_info() if auth_info else None,
-        )
-    except nuclio.utils.DeployError as exc:
-        if exc.err:
-            err_message = (
-                f"Failed to deploy nuclio function {project_name}/{function_name}"
-            )
-
-            try:
-
-                # the error might not be jsonable, so we'll try to parse it
-                # and extract the error message
-                json_err = exc.err.response.json()
-                if "error" in json_err:
-                    err_message += f" {json_err['error']}"
-                if "errorStackTrace" in json_err:
-                    logger.warning(
-                        "Failed to deploy nuclio function",
-                        nuclio_stacktrace=json_err["errorStackTrace"],
-                    )
-            except Exception as parse_exc:
-                logger.warning(
-                    "Failed to parse nuclio deploy error",
-                    parse_exc=err_to_str(parse_exc),
-                )
-
-            mlrun.errors.raise_for_status(
-                exc.err.response,
-                err_message,
-            )
-        raise
-
-
-def resolve_function_ingresses(function_spec):
-    http_trigger = resolve_function_http_trigger(function_spec)
-    if not http_trigger:
-        return []
-
-    ingresses = []
-    for _, ingress_config in (
-        http_trigger.get("attributes", {}).get("ingresses", {}).items()
-    ):
-        ingresses.append(ingress_config)
-    return ingresses
-
-
-def resolve_function_http_trigger(function_spec):
-    for trigger_name, trigger_config in function_spec.get("triggers", {}).items():
-        if trigger_config.get("kind") != "http":
-            continue
-        return trigger_config
-
-
-def _resolve_function_image_pull_secret(function):
-    """
-    the corresponding attribute for 'build.secret' in nuclio is imagePullSecrets, attached link for reference
-    https://github.com/nuclio/nuclio/blob/e4af2a000dc52ee17337e75181ecb2652b9bf4e5/pkg/processor/build/builder.go#L1073
-    if only one of the secrets is set, use it.
-    if both are set, use the non default one and give precedence to image_pull_secret
-    """
-    # enrich only on server side
-    if not is_running_as_api():
-        return function.spec.image_pull_secret or function.spec.build.secret
-
-    if function.spec.image_pull_secret is None:
-        function.spec.image_pull_secret = (
-            mlrun.mlconf.function.spec.image_pull_secret.default
-        )
-    elif (
-        function.spec.image_pull_secret
-        != mlrun.mlconf.function.spec.image_pull_secret.default
-    ):
-        return function.spec.image_pull_secret
-
-    if function.spec.build.secret is None:
-        function.spec.build.secret = mlrun.mlconf.httpdb.builder.docker_registry_secret
-    elif (
-        function.spec.build.secret != mlrun.mlconf.httpdb.builder.docker_registry_secret
-    ):
-        return function.spec.build.secret
-
-    return function.spec.image_pull_secret or function.spec.build.secret
-
-
-def compile_function_config(
-    function: RemoteRuntime,
-    client_version: str = None,
-    client_python_version: str = None,
-    builder_env=None,
-    auth_info=None,
-):
-    labels = function.metadata.labels or {}
-    labels.update({"mlrun/class": function.kind})
-    for key, value in labels.items():
-        # Adding escaping to the key to prevent it from being split by dots if it contains any
-        function.set_config(f"metadata.labels.\\{key}\\", value)
-
-    # Add secret configurations to function's pod spec, if secret sources were added.
-    # Needs to be here, since it adds env params, which are handled in the next lines.
-    # This only needs to run if we're running within k8s context. If running in Docker, for example, skip.
-    if get_k8s_helper(silent=True).is_running_inside_kubernetes_cluster():
-        function.add_secrets_config_to_spec()
-
-    env_dict, external_source_env_dict = function._get_nuclio_config_spec_env()
-
-    nuclio_runtime = (
-        function.spec.nuclio_runtime
-        or _resolve_nuclio_runtime_python_image(
-            mlrun_client_version=client_version, python_version=client_python_version
-        )
-    )
-
-    if is_nuclio_version_in_range("0.0.0", "1.6.0") and nuclio_runtime in [
-        "python:3.7",
-        "python:3.8",
-    ]:
-        nuclio_runtime_set_from_spec = nuclio_runtime == function.spec.nuclio_runtime
-        if nuclio_runtime_set_from_spec:
-            raise mlrun.errors.MLRunInvalidArgumentError(
-                f"Nuclio version does not support the configured runtime: {nuclio_runtime}"
-            )
-        else:
-            # our default is python:3.9, simply set it to python:3.6 to keep supporting envs with old Nuclio
-            nuclio_runtime = "python:3.6"
-
-    # In nuclio 1.6.0<=v<1.8.0, python runtimes default behavior was to not decode event strings
-    # Our code is counting on the strings to be decoded, so add the needed env var for those versions
-    if (
-        is_nuclio_version_in_range("1.6.0", "1.8.0")
-        and "NUCLIO_PYTHON_DECODE_EVENT_STRINGS" not in env_dict
-    ):
-        env_dict["NUCLIO_PYTHON_DECODE_EVENT_STRINGS"] = "true"
-
-    nuclio_spec = nuclio.ConfigSpec(
-        env=env_dict,
-        external_source_env=external_source_env_dict,
-        config=function.spec.config,
-    )
-    nuclio_spec.cmd = function.spec.build.commands or []
-
-    if function.spec.build.requirements:
-        resolved_requirements = []
-        # wrap in single quote to ensure that the requirement is treated as a single string
-        # quote the requirement to avoid issues with special characters, double quotes, etc.
-        for requirement in function.spec.build.requirements:
-            # -r / --requirement are flags and should not be escaped
-            # we allow such flags (could be passed within the requirements.txt file) and do not
-            # try to open the file and include its content since it might be a remote file
-            # given on the base image.
-            for req_flag in ["-r", "--requirement"]:
-                if requirement.startswith(req_flag):
-                    requirement = requirement[len(req_flag) :].strip()
-                    resolved_requirements.append(req_flag)
-                    break
-
-            resolved_requirements.append(shlex.quote(requirement))
-
-        encoded_requirements = " ".join(resolved_requirements)
-        nuclio_spec.cmd.append(f"python -m pip install {encoded_requirements}")
-
-    project = function.metadata.project or "default"
-    tag = function.metadata.tag
-    handler = function.spec.function_handler
-
-    if function.spec.build.source:
-        _compile_nuclio_archive_config(
-            nuclio_spec, function, builder_env, project, auth_info=auth_info
-        )
-
-    nuclio_spec.set_config("spec.runtime", nuclio_runtime)
-
-    # In Nuclio >= 1.6.x default serviceType has changed to "ClusterIP".
-    nuclio_spec.set_config(
-        "spec.serviceType",
-        function.spec.service_type or mlconf.httpdb.nuclio.default_service_type,
-    )
-    if function.spec.readiness_timeout:
-        nuclio_spec.set_config(
-            "spec.readinessTimeoutSeconds", function.spec.readiness_timeout
-        )
-    if function.spec.resources:
-        nuclio_spec.set_config("spec.resources", function.spec.resources)
-    if function.spec.no_cache:
-        nuclio_spec.set_config("spec.build.noCache", True)
-    if function.spec.build.functionSourceCode:
-        nuclio_spec.set_config(
-            "spec.build.functionSourceCode", function.spec.build.functionSourceCode
-        )
-
-    image_pull_secret = _resolve_function_image_pull_secret(function)
-    if image_pull_secret:
-        nuclio_spec.set_config("spec.imagePullSecrets", image_pull_secret)
-
-    if function.spec.base_image_pull:
-        nuclio_spec.set_config("spec.build.noBaseImagesPull", False)
-    # don't send node selections if nuclio is not compatible
-    if validate_nuclio_version_compatibility("1.5.20", "1.6.10"):
-        if function.spec.node_selector:
-            nuclio_spec.set_config("spec.nodeSelector", function.spec.node_selector)
-        if function.spec.node_name:
-            nuclio_spec.set_config("spec.nodeName", function.spec.node_name)
-        if function.spec.affinity:
-            nuclio_spec.set_config(
-                "spec.affinity",
-                mlrun.runtimes.pod.get_sanitized_attribute(function.spec, "affinity"),
-            )
-
-    # don't send tolerations if nuclio is not compatible
-    if validate_nuclio_version_compatibility("1.7.5"):
-        if function.spec.tolerations:
-            nuclio_spec.set_config(
-                "spec.tolerations",
-                mlrun.runtimes.pod.get_sanitized_attribute(
-                    function.spec, "tolerations"
-                ),
-            )
-    # don't send preemption_mode if nuclio is not compatible
-    if validate_nuclio_version_compatibility("1.8.6"):
-        if function.spec.preemption_mode:
-            nuclio_spec.set_config(
-                "spec.PreemptionMode",
-                function.spec.preemption_mode,
-            )
-
-    # don't send default or any priority class name if nuclio is not compatible
-    if (
-        function.spec.priority_class_name
-        and validate_nuclio_version_compatibility("1.6.18")
-        and len(mlconf.get_valid_function_priority_class_names())
-    ):
-        nuclio_spec.set_config(
-            "spec.priorityClassName", function.spec.priority_class_name
-        )
-
-    if function.spec.replicas:
-
-        nuclio_spec.set_config(
-            "spec.minReplicas", as_number("spec.Replicas", function.spec.replicas)
-        )
-        nuclio_spec.set_config(
-            "spec.maxReplicas", as_number("spec.Replicas", function.spec.replicas)
-        )
-
-    else:
-        nuclio_spec.set_config(
-            "spec.minReplicas",
-            as_number("spec.minReplicas", function.spec.min_replicas),
-        )
-        nuclio_spec.set_config(
-            "spec.maxReplicas",
-            as_number("spec.maxReplicas", function.spec.max_replicas),
-        )
-
-    if function.spec.service_account:
-        nuclio_spec.set_config("spec.serviceAccount", function.spec.service_account)
-
-    if function.spec.security_context:
-        nuclio_spec.set_config(
-            "spec.securityContext",
-            mlrun.runtimes.pod.get_sanitized_attribute(
-                function.spec, "security_context"
-            ),
-        )
-
-    if (
-        function.spec.base_spec
-        or function.spec.build.functionSourceCode
-        or function.spec.build.source
-        or function.kind == mlrun.runtimes.RuntimeKinds.serving  # serving can be empty
-    ):
-        config = function.spec.base_spec
-        if not config:
-            # if base_spec was not set (when not using code_to_function) and we have base64 code
-            # we create the base spec with essential attributes
-            config = nuclio.config.new_config()
-            update_in(config, "spec.handler", handler or "main:handler")
-
-        config = nuclio.config.extend_config(
-            config, nuclio_spec, tag, function.spec.build.code_origin
-        )
-
-        update_in(config, "metadata.name", function.metadata.name)
-        update_in(config, "spec.volumes", function.spec.generate_nuclio_volumes())
-        base_image = (
-            get_in(config, "spec.build.baseImage")
-            or function.spec.image
-            or function.spec.build.base_image
-        )
-        if base_image:
-            update_in(
-                config,
-                "spec.build.baseImage",
-                enrich_image_url(base_image, client_version, client_python_version),
-            )
-
-        logger.info("deploy started")
-        name = get_fullname(function.metadata.name, project, tag)
-        function.status.nuclio_name = name
-        update_in(config, "metadata.name", name)
-
-        if function.kind == mlrun.runtimes.RuntimeKinds.serving and not get_in(
-            config, "spec.build.functionSourceCode"
-        ):
-            if not function.spec.build.source:
-                # set the source to the mlrun serving wrapper
-                body = nuclio.build.mlrun_footer.format(
-                    mlrun.runtimes.serving.serving_subkind
-                )
-                update_in(
-                    config,
-                    "spec.build.functionSourceCode",
-                    b64encode(body.encode("utf-8")).decode("utf-8"),
-                )
-            elif not function.spec.function_handler:
-                # point the nuclio function handler to mlrun serving wrapper handlers
-                update_in(
-                    config,
-                    "spec.handler",
-                    "mlrun.serving.serving_wrapper:handler",
-                )
-    else:
-        # todo: should be deprecated (only work via MLRun service)
-        # this may also be called in case of using single file code_to_function(embed_code=False)
-        # this option need to be removed or be limited to using remote files (this code runs in server)
-        name, config, code = nuclio.build_file(
-            function.spec.source,
-            name=function.metadata.name,
-            project=project,
-            handler=handler,
-            tag=tag,
-            spec=nuclio_spec,
-            kind=function.spec.function_kind,
-            verbose=function.verbose,
-        )
-
-        update_in(config, "spec.volumes", function.spec.generate_nuclio_volumes())
-        base_image = function.spec.image or function.spec.build.base_image
-        if base_image:
-            update_in(
-                config,
-                "spec.build.baseImage",
-                enrich_image_url(base_image, client_version, client_python_version),
-            )
-
-        name = get_fullname(name, project, tag)
-        function.status.nuclio_name = name
-
-        update_in(config, "metadata.name", name)
-
-    return name, project, config
-
-
-def enrich_function_with_ingress(config, mode, service_type):
-    # do not enrich with an ingress
-    if mode == NuclioIngressAddTemplatedIngressModes.never:
-        return
-
-    ingresses = resolve_function_ingresses(config["spec"])
-
-    # function has ingresses already, nothing to add / enrich
-    if ingresses:
-        return
-
-    # if exists, get the http trigger the function has
-    # we would enrich it with an ingress
-    http_trigger = resolve_function_http_trigger(config["spec"])
-    if not http_trigger:
-        # function has an HTTP trigger without an ingress
-        # TODO: read from nuclio-api frontend-spec
-        http_trigger = {
-            "kind": "http",
-            "name": "http",
-            "maxWorkers": 1,
-            "workerAvailabilityTimeoutMilliseconds": 10000,  # 10 seconds
-            "attributes": {},
-        }
-
-    def enrich():
-        http_trigger.setdefault("attributes", {}).setdefault("ingresses", {})["0"] = {
-            "paths": ["/"],
-            # this would tell Nuclio to use its default ingress host template
-            # and would auto assign a host for the ingress
-            "hostTemplate": "@nuclio.fromDefault",
-        }
-        http_trigger["attributes"]["serviceType"] = service_type
-        config["spec"].setdefault("triggers", {})[http_trigger["name"]] = http_trigger
-
-    if mode == NuclioIngressAddTemplatedIngressModes.always:
-        enrich()
-    elif mode == NuclioIngressAddTemplatedIngressModes.on_cluster_ip:
-
-        # service type is not cluster ip, bail out
-        if service_type and service_type.lower() != "clusterip":
-            return
-
-        enrich()
-
-
 def get_nuclio_deploy_status(
     name,
     project,
     tag,
     dashboard="",
     last_log_timestamp=0,
     verbose=False,
@@ -1703,167 +1223,7 @@
                 exc.err.response,
                 get_err_message,
             )
         raise exc
     else:
         text = "\n".join(outputs) if outputs else ""
         return state, address, name, last_log_timestamp, text, function_status
-
-
-def _compile_nuclio_archive_config(
-    nuclio_spec,
-    function: RemoteRuntime,
-    builder_env,
-    project=None,
-    auth_info=None,
-):
-    secrets = {}
-    if project and get_k8s_helper(silent=True).is_running_inside_kubernetes_cluster():
-        secrets = get_k8s_helper().get_project_secret_data(project)
-
-    def get_secret(key):
-        return builder_env.get(key) or secrets.get(key, "")
-
-    source = function.spec.build.source
-    parsed_url = urlparse(source)
-    code_entry_type = ""
-    if source.startswith("s3://"):
-        code_entry_type = "s3"
-    if source.startswith("git://"):
-        code_entry_type = "git"
-    for archive_prefix in ["http://", "https://", "v3io://", "v3ios://"]:
-        if source.startswith(archive_prefix):
-            code_entry_type = "archive"
-
-    if code_entry_type == "":
-        raise mlrun.errors.MLRunInvalidArgumentError(
-            "Couldn't resolve code entry type from source"
-        )
-
-    code_entry_attributes = {}
-
-    # resolve work_dir and handler
-    work_dir, handler = _resolve_work_dir_and_handler(function.spec.function_handler)
-    work_dir = function.spec.workdir or work_dir
-    if work_dir != "":
-        code_entry_attributes["workDir"] = work_dir
-
-    # archive
-    if code_entry_type == "archive":
-        v3io_access_key = builder_env.get("V3IO_ACCESS_KEY", "")
-        if source.startswith("v3io"):
-            if not parsed_url.netloc:
-                source = mlrun.mlconf.v3io_api + parsed_url.path
-            else:
-                source = f"http{source[len('v3io'):]}"
-            if auth_info and not v3io_access_key:
-                v3io_access_key = auth_info.data_session or auth_info.access_key
-
-        if v3io_access_key:
-            code_entry_attributes["headers"] = {"X-V3io-Session-Key": v3io_access_key}
-
-    # s3
-    if code_entry_type == "s3":
-        bucket, item_key = parse_s3_bucket_and_key(source)
-
-        code_entry_attributes["s3Bucket"] = bucket
-        code_entry_attributes["s3ItemKey"] = item_key
-
-        code_entry_attributes["s3AccessKeyId"] = get_secret("AWS_ACCESS_KEY_ID")
-        code_entry_attributes["s3SecretAccessKey"] = get_secret("AWS_SECRET_ACCESS_KEY")
-        code_entry_attributes["s3SessionToken"] = get_secret("AWS_SESSION_TOKEN")
-
-    # git
-    if code_entry_type == "git":
-
-        # change git:// to https:// as nuclio expects it to be
-        if source.startswith("git://"):
-            source = source.replace("git://", "https://")
-
-        source, reference, branch = mlrun.utils.resolve_git_reference_from_source(
-            source
-        )
-        if not branch and not reference:
-            raise mlrun.errors.MLRunInvalidArgumentError(
-                "git branch or refs must be specified in the source e.g.: "
-                "'git://<url>/org/repo.git#<branch-name or refs/heads/..>'"
-            )
-        if reference:
-            code_entry_attributes["reference"] = reference
-        if branch:
-            code_entry_attributes["branch"] = branch
-
-        password = get_secret("GIT_PASSWORD")
-        username = get_secret("GIT_USERNAME")
-
-        token = get_secret("GIT_TOKEN")
-        if token:
-            username, password = mlrun.utils.get_git_username_password_from_token(token)
-
-        code_entry_attributes["username"] = username
-        code_entry_attributes["password"] = password
-
-    # populate spec with relevant fields
-    nuclio_spec.set_config("spec.handler", handler)
-    nuclio_spec.set_config("spec.build.path", source)
-    nuclio_spec.set_config("spec.build.codeEntryType", code_entry_type)
-    nuclio_spec.set_config("spec.build.codeEntryAttributes", code_entry_attributes)
-
-
-def _resolve_work_dir_and_handler(handler):
-    """
-    Resolves a nuclio function working dir and handler inside an archive/git repo
-    :param handler: a path describing working dir and handler of a nuclio function
-    :return: (working_dir, handler) tuple, as nuclio expects to get it
-
-    Example: ("a/b/c#main:Handler") -> ("a/b/c", "main:Handler")
-    """
-
-    def extend_handler(base_handler):
-        # return default handler and module if not specified
-        if not base_handler:
-            return "main:handler"
-        if ":" not in base_handler:
-            base_handler = f"{base_handler}:handler"
-        return base_handler
-
-    if not handler:
-        return "", "main:handler"
-
-    split_handler = handler.split("#")
-    if len(split_handler) == 1:
-        return "", extend_handler(handler)
-
-    return split_handler[0], extend_handler(split_handler[1])
-
-
-def _resolve_nuclio_runtime_python_image(
-    mlrun_client_version: str = None, python_version: str = None
-):
-    # if no python version or mlrun version is passed it means we use mlrun client older than 1.3.0 therefore need
-    # to use the previoud default runtime which is python 3.7
-    if not python_version or not mlrun_client_version:
-        return "python:3.7"
-
-    # If the mlrun version is 0.0.0-<unstable>, it is a dev version,
-    # so we can't check if it is higher than 1.3.0, but if the python version was passed,
-    # it means it is 1.3.0-rc or higher, so use the image according to the python version
-    if mlrun_client_version.startswith("0.0.0-") or "unstable" in mlrun_client_version:
-        if python_version.startswith("3.7"):
-            return "python:3.7"
-
-        return mlrun.mlconf.default_nuclio_runtime
-
-    # if mlrun version is older than 1.3.0 we need to use the previous default runtime which is python 3.7
-    if semver.VersionInfo.parse(mlrun_client_version) < semver.VersionInfo.parse(
-        "1.3.0-X"
-    ):
-        return "python:3.7"
-
-    # if mlrun version is 1.3.0 or newer and python version is 3.7 we need to use python 3.7 image
-    if semver.VersionInfo.parse(mlrun_client_version) >= semver.VersionInfo.parse(
-        "1.3.0-X"
-    ) and python_version.startswith("3.7"):
-        return "python:3.7"
-
-    # if none of the above conditions are met we use the default runtime which is python 3.9
-    return mlrun.mlconf.default_nuclio_runtime
```

## mlrun/runtimes/kubejob.py

```diff
@@ -14,27 +14,27 @@
 
 import os
 import time
 
 from kubernetes import client
 from kubernetes.client.rest import ApiException
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.errors
 from mlrun.runtimes.base import BaseRuntimeHandler
 
 from ..builder import build_runtime
 from ..db import RunDBError
 from ..errors import err_to_str
 from ..kfpops import build_op
 from ..model import RunObject
 from ..utils import get_in, logger
 from .base import RunError, RuntimeClassMode
 from .pod import KubeResource, kube_resource_spec_to_pod_spec
-from .utils import AsyncLogWriter
+from .utils import get_k8s
 
 
 class KubejobRuntime(KubeResource):
     kind = "job"
     _is_nested = True
 
     _is_remote = True
@@ -239,15 +239,15 @@
             if watch and not ready:
                 state = self._build_watch(watch, show_on_failure=show_on_failure)
                 ready = state == "ready"
                 self.status.state = state
         else:
             self.save(versioned=False)
             ready = build_runtime(
-                mlrun.api.schemas.AuthInfo(),
+                mlrun.common.schemas.AuthInfo(),
                 self,
                 with_mlrun,
                 mlrun_version_specifier,
                 skip_deployed,
                 watch,
             )
             self.save(versioned=False)
@@ -283,44 +283,14 @@
                     text, _ = db.get_builder_status(self, offset, logs=logs)
                 print_log(text)
                 offset += len(text)
 
         print()
         return self.status.state
 
-    def builder_status(self, watch=True, logs=True):
-        if self._is_remote_api():
-            return self._build_watch(watch, logs)
-
-        else:
-            pod = self.status.build_pod
-            if not self.status.state == "ready" and pod:
-                k8s = self._get_k8s()
-                status = k8s.get_pod_status(pod)
-                if logs:
-                    if watch:
-                        status = k8s.watch(pod)
-                    else:
-                        resp = k8s.logs(pod)
-                        if resp:
-                            print(resp.encode())
-
-                if status == "succeeded":
-                    self.status.build_pod = None
-                    self.status.state = "ready"
-                    logger.info("build completed successfully")
-                    return "ready"
-                if status in ["failed", "error"]:
-                    self.status.state = status
-                    logger.error(f" build {status}, watch the build pod logs: {pod}")
-                    return status
-
-                logger.info(f"builder status is: {status}, wait for it to complete")
-            return None
-
     def deploy_step(
         self,
         image=None,
         base_image=None,
         commands: list = None,
         secret_name="",
         with_mlrun=True,
@@ -344,15 +314,14 @@
 
     def _run(self, runobj: RunObject, execution):
 
         command, args, extra_env = self._get_cmd_args(runobj)
 
         if runobj.metadata.iteration:
             self.store_run(runobj)
-        k8s = self._get_k8s()
         new_meta = self._get_meta(runobj)
 
         self._add_secrets_to_spec_before_running(runobj)
         workdir = self._resolve_workdir()
 
         pod_spec = func_to_pod(
             self.full_image_path(
@@ -365,28 +334,21 @@
             extra_env,
             command,
             args,
             workdir,
         )
         pod = client.V1Pod(metadata=new_meta, spec=pod_spec)
         try:
-            pod_name, namespace = k8s.create_pod(pod)
+            pod_name, namespace = get_k8s().create_pod(pod)
         except ApiException as exc:
             raise RunError(err_to_str(exc))
 
-        if pod_name and self.kfp:
-            writer = AsyncLogWriter(self._db_conn, runobj)
-            status = k8s.watch(pod_name, namespace, writer=writer)
-
-            if status in ["failed", "error"]:
-                raise RunError(f"pod exited with {status}, check logs")
-        else:
-            txt = f"Job is running in the background, pod: {pod_name}"
-            logger.info(txt)
-            runobj.status.status_text = txt
+        txt = f"Job is running in the background, pod: {pod_name}"
+        logger.info(txt)
+        runobj.status.status_text = txt
 
         return None
 
     def _resolve_workdir(self):
         """
         The workdir is relative to the source root, if the source is not loaded on run then the workdir
         is relative to the clone target dir (where the source was copied to).
```

## mlrun/runtimes/pod.py

```diff
@@ -20,34 +20,35 @@
 import dotenv
 import kfp.dsl
 import kubernetes.client as k8s_client
 from deprecated import deprecated
 
 import mlrun.errors
 import mlrun.utils.regex
-
-from ..api.schemas import (
+from mlrun.common.schemas import (
     NodeSelectorOperator,
     PreemptionModes,
     SecurityContextEnrichmentModes,
 )
+
 from ..config import config as mlconf
 from ..k8s_utils import (
     generate_preemptible_node_selector_requirements,
     generate_preemptible_nodes_affinity_terms,
     generate_preemptible_nodes_anti_affinity_terms,
     generate_preemptible_tolerations,
 )
 from ..secrets import SecretsStore
 from ..utils import logger, normalize_name, update_in
 from .base import BaseRuntime, FunctionSpec, spec_fields
 from .utils import (
     apply_kfp,
     get_gpu_from_resource_requirement,
     get_item_name,
+    get_k8s,
     get_resource_labels,
     set_named_item,
     verify_limits,
     verify_requests,
 )
 
 # TODO: add env attribute to the sanitized types
@@ -1111,24 +1112,24 @@
         * **constrain** - The function can only run on preemptible nodes
         * **prevent** - The function cannot be scheduled on preemptible nodes
         * **none** - No preemptible configuration will be applied on the function
 
         The default preemption mode is configurable in mlrun.mlconf.function_defaults.preemption_mode,
         by default it's set to **prevent**
 
-        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.api.schemas.PreemptionModes`
+        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.common.schemas.PreemptionModes`
         """
         preemptible_mode = PreemptionModes(mode)
         self.spec.preemption_mode = preemptible_mode.value
 
     def with_security_context(self, security_context: k8s_client.V1SecurityContext):
         """
         Set security context for the pod.
         For Iguazio we handle security context internally -
-        see mlrun.api.schemas.function.SecurityContextEnrichmentModes
+        see mlrun.common.schemas.function.SecurityContextEnrichmentModes
 
         Example:
 
             from kubernetes import client as k8s_client
 
             security_context = k8s_client.V1SecurityContext(
                         run_as_user=1000,
@@ -1153,15 +1154,15 @@
     def list_valid_priority_class_names(self):
         return mlconf.get_valid_function_priority_class_names()
 
     def get_default_priority_class_name(self):
         return mlconf.default_function_priority_class_name
 
     def _get_meta(self, runobj, unique=False):
-        namespace = self._get_k8s().resolve_namespace()
+        namespace = get_k8s().resolve_namespace()
 
         labels = get_resource_labels(self, runobj, runobj.spec.scrape_metrics)
         new_meta = k8s_client.V1ObjectMeta(
             namespace=namespace,
             annotations=self.metadata.annotations or runobj.metadata.annotations,
             labels=labels,
         )
@@ -1221,15 +1222,15 @@
     ):
         # Check if we need to add the keys of a global secret. Global secrets are intentionally added before
         # project secrets, to allow project secret keys to override them
         global_secret_name = (
             mlconf.secret_stores.kubernetes.global_function_env_secret_name
         )
         if mlrun.config.is_running_as_api() and global_secret_name:
-            global_secrets = self._get_k8s().get_secret_data(global_secret_name)
+            global_secrets = get_k8s().get_secret_data(global_secret_name)
             for key, value in global_secrets.items():
                 env_var_name = (
                     SecretsStore.k8s_env_variable_name_for_secret(key)
                     if encode_key_names
                     else key
                 )
                 self.set_env_from_secret(env_var_name, global_secret_name, key)
@@ -1243,18 +1244,18 @@
             return
 
         project_name = project or runobj.metadata.project
         if project_name is None:
             logger.warning("No project provided. Cannot add k8s secrets")
             return
 
-        secret_name = self._get_k8s().get_project_secret_name(project_name)
+        secret_name = get_k8s().get_project_secret_name(project_name)
         # Not utilizing the same functionality from the Secrets crud object because this code also runs client-side
         # in the nuclio remote-dashboard flow, which causes dependency problems.
-        existing_secret_keys = self._get_k8s().get_project_secret_keys(
+        existing_secret_keys = get_k8s().get_project_secret_keys(
             project_name, filter_internal=True
         )
 
         # If no secrets were passed or auto-adding all secrets, we need all existing keys
         if not secrets:
             secrets = {
                 key: SecretsStore.k8s_env_variable_name_for_secret(key)
@@ -1280,15 +1281,15 @@
 
         service_account_name = (
             mlconf.secret_stores.vault.project_service_account_name.format(
                 project=project_name
             )
         )
 
-        project_vault_secret_name = self._get_k8s().get_project_vault_secret_name(
+        project_vault_secret_name = get_k8s().get_project_vault_secret_name(
             project_name, service_account_name
         )
         if project_vault_secret_name is None:
             logger.info(f"No vault secret associated with project {project_name}")
             return
 
         volumes = [
```

## mlrun/runtimes/serving.py

```diff
@@ -17,15 +17,15 @@
 from copy import deepcopy
 from typing import List, Union
 
 import nuclio
 from nuclio import KafkaTrigger
 
 import mlrun
-import mlrun.api.schemas
+import mlrun.common.schemas
 
 from ..datastore import parse_kafka_url
 from ..model import ObjectList
 from ..secrets import SecretsStore
 from ..serving.server import GraphServer, create_graph_server
 from ..serving.states import (
     RootFlowStep,
@@ -581,15 +581,15 @@
 
     def deploy(
         self,
         dashboard="",
         project="",
         tag="",
         verbose=False,
-        auth_info: mlrun.api.schemas.AuthInfo = None,
+        auth_info: mlrun.common.schemas.AuthInfo = None,
         builder_env: dict = None,
     ):
         """deploy model serving function to a local/remote cluster
 
         :param dashboard: DEPRECATED. Keep empty to allow auto-detection by MLRun API
         :param project:   optional, override function specified project name
         :param tag:       specify unique function tag (a different function service is created for every tag)
```

## mlrun/runtimes/utils.py

```diff
@@ -26,19 +26,19 @@
 import mlrun
 import mlrun.builder
 import mlrun.utils.regex
 from mlrun.api.utils.clients import nuclio
 from mlrun.db import get_run_db
 from mlrun.errors import err_to_str
 from mlrun.frameworks.parallel_coordinates import gen_pcp_plot
-from mlrun.k8s_utils import get_k8s_helper
 from mlrun.runtimes.constants import MPIJobCRDVersions
 
 from ..artifacts import TableArtifact
-from ..config import config
+from ..config import config, is_running_as_api
+from ..k8s_utils import is_running_inside_kubernetes_cluster
 from ..utils import get_in, helpers, logger, verify_field_regex
 from .generators import selector
 
 
 class RunError(Exception):
     pass
 
@@ -65,39 +65,40 @@
 
 
 # resolve mpijob runtime according to the mpi-operator's supported crd-version
 # if specified on mlrun config set it likewise,
 # if not specified, try resolving it according to the mpi-operator, otherwise set to default
 # since this is a heavy operation (sending requests to k8s/API), and it's unlikely that the crd version
 # will change in any context - cache it
-def resolve_mpijob_crd_version(api_context=False):
+def resolve_mpijob_crd_version():
     global cached_mpijob_crd_version
     if not cached_mpijob_crd_version:
 
         # config override everything
         mpijob_crd_version = config.mpijob_crd_version
 
         if not mpijob_crd_version:
-            in_k8s_cluster = get_k8s_helper(
-                silent=True
-            ).is_running_inside_kubernetes_cluster()
-            if in_k8s_cluster:
-                k8s_helper = get_k8s_helper()
+            in_k8s_cluster = is_running_inside_kubernetes_cluster()
+
+            if in_k8s_cluster and is_running_as_api():
+                import mlrun.api.utils.singletons.k8s
+
+                k8s_helper = mlrun.api.utils.singletons.k8s.get_k8s_helper()
                 namespace = k8s_helper.resolve_namespace()
 
                 # try resolving according to mpi-operator that's running
                 res = k8s_helper.list_pods(
                     namespace=namespace, selector="component=mpi-operator"
                 )
                 if len(res) > 0:
                     mpi_operator_pod = res[0]
                     mpijob_crd_version = mpi_operator_pod.metadata.labels.get(
                         "crd-version"
                     )
-            elif not in_k8s_cluster and not api_context:
+            elif not in_k8s_cluster:
                 # connect will populate the config from the server config
                 # TODO: something nicer
                 get_run_db()
                 mpijob_crd_version = config.mpijob_crd_version
 
             # If resolution failed simply use default
             if not mpijob_crd_version:
@@ -178,30 +179,14 @@
     if err:
         logger.error(f"exec error - {err_to_str(err)}")
         print(err, file=stderr)
         if not silent:
             raise RunError(err)
 
 
-class AsyncLogWriter:
-    def __init__(self, db, runobj):
-        self.db = db
-        self.uid = runobj.metadata.uid
-        self.project = runobj.metadata.project or ""
-        self.iter = runobj.metadata.iteration
-
-    def write(self, data):
-        if self.db:
-            self.db.store_log(self.uid, self.project, data, append=True)
-
-    def flush(self):
-        # todo: verify writes are large enough, if not cache and use flush
-        pass
-
-
 def add_code_metadata(path=""):
     if path:
         if "://" in path:
             return None
         if os.path.isfile(path):
             path = os.path.dirname(path)
     path = path or "./"
@@ -228,14 +213,27 @@
         if len(remotes) > 0:
             return f"{remotes[0]}#{repo.head.commit.hexsha}"
     except (GitCommandNotFound, InvalidGitRepositoryError, NoSuchPathError, ValueError):
         pass
     return None
 
 
+def get_k8s():
+    """
+    Get the k8s helper object
+    :return: k8s helper object or None if not running as API
+    """
+    if is_running_as_api():
+        import mlrun.api.utils.singletons.k8s
+
+        return mlrun.api.utils.singletons.k8s.get_k8s_helper()
+
+    return None
+
+
 def set_if_none(struct, key, value):
     if not struct.get(key):
         struct[key] = value
 
 
 def results_to_iter(results, runspec, execution):
     if not results:
```

## mlrun/runtimes/mpijob/abstract.py

```diff
@@ -20,15 +20,15 @@
 
 from mlrun.config import config
 from mlrun.errors import err_to_str
 from mlrun.execution import MLClientCtx
 from mlrun.model import RunObject
 from mlrun.runtimes.kubejob import KubejobRuntime
 from mlrun.runtimes.pod import KubeResourceSpec
-from mlrun.runtimes.utils import RunError
+from mlrun.runtimes.utils import RunError, get_k8s
 from mlrun.utils import get_in, logger
 
 
 class MPIResourceSpec(KubeResourceSpec):
     _dict_fields = KubeResourceSpec._dict_fields + ["mpi_args"]
 
     def __init__(
@@ -187,18 +187,17 @@
                 runobj.status.status_text = txt
 
         return None
 
     def _submit_mpijob(self, job, namespace=None):
         mpi_group, mpi_version, mpi_plural = self._get_crd_info()
 
-        k8s = self._get_k8s()
-        namespace = k8s.resolve_namespace(namespace)
+        namespace = get_k8s().resolve_namespace(namespace)
         try:
-            resp = k8s.crdapi.create_namespaced_custom_object(
+            resp = get_k8s().crdapi.create_namespaced_custom_object(
                 mpi_group,
                 mpi_version,
                 namespace=namespace,
                 plural=mpi_plural,
                 body=job,
             )
             name = get_in(resp, "metadata.name", "unknown")
@@ -206,34 +205,33 @@
             return resp
         except client.rest.ApiException as exc:
             logger.error(f"Exception when creating MPIJob: {err_to_str(exc)}")
             raise RunError("Exception when creating MPIJob") from exc
 
     def delete_job(self, name, namespace=None):
         mpi_group, mpi_version, mpi_plural = self._get_crd_info()
-        k8s = self._get_k8s()
+        k8s = get_k8s()
         namespace = k8s.resolve_namespace(namespace)
         try:
             # delete the mpi job
             body = client.V1DeleteOptions()
             resp = k8s.crdapi.delete_namespaced_custom_object(
                 mpi_group, mpi_version, namespace, mpi_plural, name, body
             )
             deletion_status = get_in(resp, "status", "unknown")
             logger.info(f"del status: {deletion_status}")
         except client.rest.ApiException as exc:
             print(f"Exception when deleting MPIJob: {err_to_str(exc)}")
 
     def list_jobs(self, namespace=None, selector="", show=True):
         mpi_group, mpi_version, mpi_plural = self._get_crd_info()
-        k8s = self._get_k8s()
-        namespace = k8s.resolve_namespace(namespace)
+        namespace = get_k8s().resolve_namespace(namespace)
         items = []
         try:
-            resp = k8s.crdapi.list_namespaced_custom_object(
+            resp = get_k8s().crdapi.list_namespaced_custom_object(
                 mpi_group,
                 mpi_version,
                 namespace,
                 mpi_plural,
                 watch=False,
                 label_selector=selector,
             )
@@ -245,32 +243,30 @@
             items = resp.get("items", [])
             if show and items:
                 self._pretty_print_jobs(items)
         return items
 
     def get_job(self, name, namespace=None):
         mpi_group, mpi_version, mpi_plural = self._get_crd_info()
-        k8s = self._get_k8s()
-        namespace = k8s.resolve_namespace(namespace)
+        namespace = get_k8s().resolve_namespace(namespace)
         try:
-            resp = k8s.crdapi.get_namespaced_custom_object(
+            resp = get_k8s().crdapi.get_namespaced_custom_object(
                 mpi_group, mpi_version, namespace, mpi_plural, name
             )
         except client.exceptions.ApiException as exc:
             print(f"Exception when reading MPIJob: {err_to_str(exc)}")
             return None
         return resp
 
     def get_pods(self, name=None, namespace=None, launcher=False):
-        k8s = self._get_k8s()
-        namespace = k8s.resolve_namespace(namespace)
+        namespace = get_k8s().resolve_namespace(namespace)
 
         selector = self._generate_pods_selector(name, launcher)
 
-        pods = k8s.list_pods(selector=selector, namespace=namespace)
+        pods = get_k8s().list_pods(selector=selector, namespace=namespace)
         if pods:
             return {p.metadata.name: p.status.phase for p in pods}
 
     def _get_launcher(self, name, namespace=None):
         pods = self.get_pods(name, namespace, launcher=True)
         if not pods:
             logger.error("no pod matches that job name")
```

## mlrun/runtimes/package/context_handler.py

```diff
@@ -26,15 +26,15 @@
 
 from mlrun.datastore import DataItem
 from mlrun.errors import MLRunInvalidArgumentError, MLRunRuntimeError
 from mlrun.execution import MLClientCtx
 from mlrun.utils import logger
 
 
-# TODO: Move the `ArtifactType` to constants.py
+# TODO: Move the `ArtifactType` to common/constants/model_monitoring.py
 class ArtifactType(Enum):
     """
     Possible artifact types to log using the MLRun `context` decorator.
     """
 
     # Types:
     DATASET = "dataset"
```

## mlrun/runtimes/sparkjob/abstract.py

```diff
@@ -27,29 +27,28 @@
 from mlrun.config import config
 from mlrun.db import get_run_db
 from mlrun.errors import err_to_str
 from mlrun.runtimes.base import BaseRuntimeHandler
 from mlrun.runtimes.constants import RunStates, SparkApplicationStates
 
 from ...execution import MLClientCtx
-from ...k8s_utils import get_k8s_helper
 from ...model import RunObject
 from ...platforms.iguazio import mount_v3io, mount_v3iod
 from ...utils import (
     get_in,
     logger,
     update_in,
     verify_and_update_in,
     verify_field_regex,
     verify_list_and_update_in,
 )
 from ..base import RunError, RuntimeClassMode
 from ..kubejob import KubejobRuntime
 from ..pod import KubeResourceSpec
-from ..utils import get_item_name
+from ..utils import get_item_name, get_k8s
 
 _service_account = "sparkapp"
 _sparkjob_template = {
     "apiVersion": "sparkoperator.k8s.io/v1beta2",
     "kind": "SparkApplication",
     "metadata": {"name": "", "namespace": "default-tenant"},
     "spec": {
@@ -588,15 +587,15 @@
     def _submit_spark_job(
         self,
         job,
         meta,
         code=None,
     ):
         namespace = meta.namespace
-        k8s = self._get_k8s()
+        k8s = get_k8s()
         namespace = k8s.resolve_namespace(namespace)
         if code:
             k8s_config_map = client.V1ConfigMap()
             k8s_config_map.metadata = meta
             k8s_config_map.metadata.name += "-script"
             k8s_config_map.data = {self.code_script: code}
             config_map = k8s.v1api.create_namespaced_config_map(
@@ -632,15 +631,15 @@
             return resp
         except ApiException as exc:
             crd = f"{AbstractSparkRuntime.group}/{AbstractSparkRuntime.version}/{AbstractSparkRuntime.plural}"
             logger.error(f"Exception when creating SparkJob ({crd}): {err_to_str(exc)}")
             raise RunError("Exception when creating SparkJob") from exc
 
     def get_job(self, name, namespace=None):
-        k8s = self._get_k8s()
+        k8s = get_k8s()
         namespace = k8s.resolve_namespace(namespace)
         try:
             resp = k8s.crdapi.get_namespaced_custom_object(
                 AbstractSparkRuntime.group,
                 AbstractSparkRuntime.version,
                 namespace,
                 AbstractSparkRuntime.plural,
@@ -822,34 +821,14 @@
                 "pull_at_runtime is not supported for spark runtime, use pull_at_runtime=False"
             )
 
         super().with_source_archive(
             source, workdir, handler, pull_at_runtime, target_dir
         )
 
-    def get_pods(self, name=None, namespace=None, driver=False):
-        k8s = self._get_k8s()
-        namespace = k8s.resolve_namespace(namespace)
-        selector = "mlrun/class=spark"
-        if name:
-            selector += f",sparkoperator.k8s.io/app-name={name}"
-        if driver:
-            selector += ",spark-role=driver"
-        pods = k8s.list_pods(selector=selector, namespace=namespace)
-        if pods:
-            return {p.metadata.name: p.status.phase for p in pods}
-
-    def _get_driver(self, name, namespace=None):
-        pods = self.get_pods(name, namespace, driver=True)
-        if not pods:
-            logger.error("no pod matches that job name")
-            return
-        _ = self._get_k8s()
-        return list(pods.items())[0]
-
     def is_deployed(self):
         if (
             not self.spec.build.source
             and not self.spec.build.commands
             and not self.spec.build.extra
         ):
             return True
@@ -964,23 +943,22 @@
         Handling config maps deletion
         """
         uids = []
         for crd_dict in deleted_resources:
             uid = crd_dict["metadata"].get("labels", {}).get("mlrun/uid", None)
             uids.append(uid)
 
-        k8s_helper = get_k8s_helper()
-        config_maps = k8s_helper.v1api.list_namespaced_config_map(
+        config_maps = get_k8s().v1api.list_namespaced_config_map(
             namespace, label_selector=label_selector
         )
         for config_map in config_maps.items:
             try:
                 uid = config_map.metadata.labels.get("mlrun/uid", None)
                 if force or uid in uids:
-                    k8s_helper.v1api.delete_namespaced_config_map(
+                    get_k8s().v1api.delete_namespaced_config_map(
                         config_map.metadata.name, namespace
                     )
                     logger.info(f"Deleted config map: {config_map.metadata.name}")
             except ApiException as exc:
                 # ignore error if config map is already removed
                 if exc.status != 404:
                     raise
```

## mlrun/runtimes/sparkjob/spark3job.py

```diff
@@ -12,15 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import typing
 
 import kubernetes.client
 
-import mlrun.api.schemas.function
+import mlrun.common.schemas.function
 import mlrun.errors
 import mlrun.runtimes.pod
 
 from ...utils import update_in, verify_and_update_in
 from .abstract import AbstractSparkJobSpec, AbstractSparkRuntime
 
 
@@ -516,26 +516,26 @@
             self.spec.executor_affinity = affinity
         if node_selector:
             self.spec.executor_node_selector = node_selector
         if tolerations:
             self.spec.executor_tolerations = tolerations
 
     def with_preemption_mode(
-        self, mode: typing.Union[mlrun.api.schemas.function.PreemptionModes, str]
+        self, mode: typing.Union[mlrun.common.schemas.function.PreemptionModes, str]
     ):
         """
         Use with_driver_preemption_mode / with_executor_preemption_mode to setup preemption_mode for spark operator
         """
         raise mlrun.errors.MLRunInvalidArgumentTypeError(
             "with_preemption_mode is not supported use with_driver_preemption_mode / with_executor_preemption_mode"
             " to set preemption mode for spark operator"
         )
 
     def with_driver_preemption_mode(
-        self, mode: typing.Union[mlrun.api.schemas.function.PreemptionModes, str]
+        self, mode: typing.Union[mlrun.common.schemas.function.PreemptionModes, str]
     ):
         """
         Preemption mode controls whether the spark driver can be scheduled on preemptible nodes.
         Tolerations, node selector, and affinity are populated on preemptible nodes corresponding to the function spec.
 
         The supported modes are:
 
@@ -543,21 +543,21 @@
         * **constrain** - The function can only run on preemptible nodes
         * **prevent** - The function cannot be scheduled on preemptible nodes
         * **none** - No preemptible configuration will be applied on the function
 
         The default preemption mode is configurable in mlrun.mlconf.function_defaults.preemption_mode,
         by default it's set to **prevent**
 
-        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.api.schemas.PreemptionModes`
+        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.common.schemas.PreemptionModes`
         """
-        preemption_mode = mlrun.api.schemas.function.PreemptionModes(mode)
+        preemption_mode = mlrun.common.schemas.function.PreemptionModes(mode)
         self.spec.driver_preemption_mode = preemption_mode.value
 
     def with_executor_preemption_mode(
-        self, mode: typing.Union[mlrun.api.schemas.function.PreemptionModes, str]
+        self, mode: typing.Union[mlrun.common.schemas.function.PreemptionModes, str]
     ):
         """
         Preemption mode controls whether the spark executor can be scheduled on preemptible nodes.
         Tolerations, node selector, and affinity are populated on preemptible nodes corresponding to the function spec.
 
         The supported modes are:
 
@@ -565,17 +565,17 @@
         * **constrain** - The function can only run on preemptible nodes
         * **prevent** - The function cannot be scheduled on preemptible nodes
         * **none** - No preemptible configuration will be applied on the function
 
         The default preemption mode is configurable in mlrun.mlconf.function_defaults.preemption_mode,
         by default it's set to **prevent**
 
-        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.api.schemas.PreemptionModes`
+        :param mode: allow | constrain | prevent | none defined in :py:class:`~mlrun.common.schemas.PreemptionModes`
         """
-        preemption_mode = mlrun.api.schemas.function.PreemptionModes(mode)
+        preemption_mode = mlrun.common.schemas.function.PreemptionModes(mode)
         self.spec.executor_preemption_mode = preemption_mode.value
 
     def with_security_context(
         self, security_context: kubernetes.client.V1SecurityContext
     ):
         """
         With security context is not supported for spark runtime.
```

## mlrun/serving/routers.py

```diff
@@ -20,24 +20,19 @@
 from io import BytesIO
 from typing import Dict, List, Union
 
 import numpy
 import numpy as np
 
 import mlrun
-import mlrun.model_monitoring
+import mlrun.common.model_monitoring
+import mlrun.common.schemas
 import mlrun.utils.model_monitoring
 from mlrun.utils import logger, now_date, parse_versioned_object_uri
 
-from ..api.schemas import (
-    ModelEndpoint,
-    ModelEndpointMetadata,
-    ModelEndpointSpec,
-    ModelEndpointStatus,
-)
 from ..config import config
 from .server import GraphServer
 from .utils import RouterToDict, _extract_input_data, _update_result_body
 from .v2_serving import _ModelLogPusher
 
 # Used by `ParallelRun` in process mode, so it can be accessed from different processes.
 local_routes = {}
@@ -1037,15 +1032,15 @@
     # Generating version model value based on the model name and model version
     if voting_ensemble.version:
         versioned_model_name = f"{voting_ensemble.name}:{voting_ensemble.version}"
     else:
         versioned_model_name = f"{voting_ensemble.name}:latest"
 
     # Generating model endpoint ID based on function uri and model version
-    endpoint_uid = mlrun.model_monitoring.create_model_endpoint_uid(
+    endpoint_uid = mlrun.common.model_monitoring.create_model_endpoint_uid(
         function_uri=graph_server.function_uri, versioned_model=versioned_model_name
     ).uid
 
     # If model endpoint object was found in DB, skip the creation process.
     try:
         mlrun.get_run_db().get_model_endpoint(project=project, endpoint_id=endpoint_uid)
 
@@ -1055,31 +1050,33 @@
         try:
             # Get the children model endpoints ids
             children_uids = []
             for _, c in voting_ensemble.routes.items():
                 if hasattr(c, "endpoint_uid"):
                     children_uids.append(c.endpoint_uid)
 
-            model_endpoint = ModelEndpoint(
-                metadata=ModelEndpointMetadata(project=project, uid=endpoint_uid),
-                spec=ModelEndpointSpec(
+            model_endpoint = mlrun.common.schemas.ModelEndpoint(
+                metadata=mlrun.common.schemas.ModelEndpointMetadata(
+                    project=project, uid=endpoint_uid
+                ),
+                spec=mlrun.common.schemas.ModelEndpointSpec(
                     function_uri=graph_server.function_uri,
                     model=versioned_model_name,
                     model_class=voting_ensemble.__class__.__name__,
                     stream_path=config.model_endpoint_monitoring.store_prefixes.default.format(
                         project=project, kind="stream"
                     ),
                     active=True,
-                    monitoring_mode=mlrun.model_monitoring.ModelMonitoringMode.enabled
+                    monitoring_mode=mlrun.common.model_monitoring.ModelMonitoringMode.enabled
                     if voting_ensemble.context.server.track_models
-                    else mlrun.model_monitoring.ModelMonitoringMode.disabled,
+                    else mlrun.common.model_monitoring.ModelMonitoringMode.disabled,
                 ),
-                status=ModelEndpointStatus(
+                status=mlrun.common.schemas.ModelEndpointStatus(
                     children=list(voting_ensemble.routes.keys()),
-                    endpoint_type=mlrun.model_monitoring.EndpointType.ROUTER,
+                    endpoint_type=mlrun.common.model_monitoring.EndpointType.ROUTER,
                     children_uids=children_uids,
                 ),
             )
 
             db = mlrun.get_run_db()
 
             db.create_model_endpoint(
@@ -1090,15 +1087,15 @@
 
             # Update model endpoint children type
             for model_endpoint in children_uids:
                 current_endpoint = db.get_model_endpoint(
                     project=project, endpoint_id=model_endpoint
                 )
                 current_endpoint.status.endpoint_type = (
-                    mlrun.model_monitoring.EndpointType.LEAF_EP
+                    mlrun.common.model_monitoring.EndpointType.LEAF_EP
                 )
                 db.create_model_endpoint(
                     project=project,
                     endpoint_id=model_endpoint,
                     model_endpoint=current_endpoint,
                 )
```

## mlrun/serving/server.py

```diff
@@ -19,54 +19,70 @@
 import os
 import socket
 import traceback
 import uuid
 from typing import Optional, Union
 
 import mlrun
+import mlrun.utils.model_monitoring
+from mlrun.common.model_monitoring import FileTargetKind
 from mlrun.config import config
 from mlrun.errors import err_to_str
 from mlrun.secrets import SecretsStore
 
 from ..datastore import get_stream_pusher
 from ..datastore.store_resources import ResourceCache
 from ..errors import MLRunInvalidArgumentError
 from ..model import ModelObj
 from ..utils import get_caller_globals, parse_versioned_object_uri
 from .states import RootFlowStep, RouterStep, get_function, graph_root_setter
-from .utils import event_id_key, event_path_key
+from .utils import (
+    event_id_key,
+    event_path_key,
+    legacy_event_id_key,
+    legacy_event_path_key,
+)
 
 
 class _StreamContext:
-    def __init__(self, enabled, parameters, function_uri):
+    """Handles the stream context for the events stream process. Includes the configuration for the output stream
+    that will be used for pushing the events from the nuclio model serving function"""
+
+    def __init__(self, enabled: bool, parameters: dict, function_uri: str):
+
+        """
+        Initialize _StreamContext object.
+        :param enabled:      A boolean indication for applying the stream context
+        :param parameters:   Dictionary of optional parameters, such as `log_stream` and `stream_args`. Note that these
+                             parameters might be relevant to the output source such as `kafka_bootstrap_servers` if
+                             the output source is from type Kafka.
+        :param function_uri: Full value of the function uri, usually it's <project-name>/<function-name>
+        """
+
         self.enabled = False
         self.hostname = socket.gethostname()
         self.function_uri = function_uri
         self.output_stream = None
         self.stream_uri = None
+        log_stream = parameters.get(FileTargetKind.LOG_STREAM, "")
 
-        log_stream = parameters.get("log_stream", "")
-        stream_uri = config.model_endpoint_monitoring.store_prefixes.default
-
-        if ((enabled and stream_uri) or log_stream) and function_uri:
+        if (enabled or log_stream) and function_uri:
             self.enabled = True
-
             project, _, _, _ = parse_versioned_object_uri(
                 function_uri, config.default_project
             )
 
-            stream_uri = stream_uri.format(project=project, kind="stream")
+            stream_uri = mlrun.utils.model_monitoring.get_stream_path(project=project)
 
             if log_stream:
+                # Update the stream path to the log stream value
                 stream_uri = log_stream.format(project=project)
 
             stream_args = parameters.get("stream_args", {})
 
-            self.stream_uri = stream_uri
-
             self.output_stream = get_stream_pusher(stream_uri, **stream_args)
 
 
 class GraphServer(ModelObj):
     kind = "server"
 
     def __init__(
@@ -236,18 +252,26 @@
         return resp
 
     def run(self, event, context=None, get_body=False, extra_args=None):
         server_context = self.context
         context = context or server_context
         event.content_type = event.content_type or self.default_content_type or ""
         if event.headers:
-            if event_id_key in event.headers:
-                event.id = event.headers.get(event_id_key)
-            if event_path_key in event.headers:
-                event.path = event.headers.get(event_path_key)
+            # TODO: remove old event id and path keys in 1.6.0
+            if event_id_key in event.headers or legacy_event_id_key in event.headers:
+                event.id = event.headers.get(event_id_key) or event.headers.get(
+                    legacy_event_id_key
+                )
+            if (
+                event_path_key in event.headers
+                or legacy_event_path_key in event.headers
+            ):
+                event.path = event.headers.get(event_path_key) or event.headers.get(
+                    legacy_event_path_key
+                )
 
         if isinstance(event.body, (str, bytes)) and (
             not event.content_type or event.content_type in ["json", "application/json"]
         ):
             # assume it is json and try to load
             try:
                 body = json.loads(event.body)
```

## mlrun/serving/utils.py

```diff
@@ -12,16 +12,22 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import inspect
 
 from mlrun.utils import get_in, update_in
 
-event_id_key = "MLRUN_EVENT_ID"
-event_path_key = "MLRUN_EVENT_PATH"
+# headers keys with underscore are getting ignored by werkzeug https://github.com/pallets/werkzeug/pull/2622
+# to avoid conflicts with WGSI which converts all header keys to uppercase with underscores.
+# more info https://github.com/benoitc/gunicorn/issues/2799, this comment can be removed once old keys are removed
+event_id_key = "MLRUN-EVENT-ID"
+event_path_key = "MLRUN-EVENT-PATH"
+# TODO: remove these keys in 1.6.0
+legacy_event_id_key = "MLRUN_EVENT_ID"
+legacy_event_path_key = "MLRUN_EVENT_PATH"
 
 
 def _extract_input_data(input_path, body):
     if input_path:
         if not hasattr(body, "__getitem__"):
             raise TypeError("input_path parameter supports only dict-like event bodies")
         return get_in(body, input_path)
```

## mlrun/serving/v2_serving.py

```diff
@@ -13,21 +13,16 @@
 # limitations under the License.
 import threading
 import time
 import traceback
 from typing import Dict, Union
 
 import mlrun
-import mlrun.model_monitoring
-from mlrun.api.schemas import (
-    ModelEndpoint,
-    ModelEndpointMetadata,
-    ModelEndpointSpec,
-    ModelEndpointStatus,
-)
+import mlrun.common.model_monitoring
+import mlrun.common.schemas
 from mlrun.artifacts import ModelArtifact  # noqa: F401
 from mlrun.config import config
 from mlrun.utils import logger, now_date, parse_versioned_object_uri
 
 from .server import GraphServer
 from .utils import StepToDict, _extract_input_data, _update_result_body
 
@@ -482,45 +477,45 @@
     # Generating version model value based on the model name and model version
     if model.version:
         versioned_model_name = f"{model.name}:{model.version}"
     else:
         versioned_model_name = f"{model.name}:latest"
 
     # Generating model endpoint ID based on function uri and model version
-    uid = mlrun.model_monitoring.create_model_endpoint_uid(
+    uid = mlrun.common.model_monitoring.create_model_endpoint_uid(
         function_uri=graph_server.function_uri, versioned_model=versioned_model_name
     ).uid
 
     # If model endpoint object was found in DB, skip the creation process.
     try:
         mlrun.get_run_db().get_model_endpoint(project=project, endpoint_id=uid)
 
     except mlrun.errors.MLRunNotFoundError:
         logger.info("Creating a new model endpoint record", endpoint_id=uid)
 
         try:
-            model_endpoint = ModelEndpoint(
-                metadata=ModelEndpointMetadata(
+            model_endpoint = mlrun.common.schemas.ModelEndpoint(
+                metadata=mlrun.common.schemas.ModelEndpointMetadata(
                     project=project, labels=model.labels, uid=uid
                 ),
-                spec=ModelEndpointSpec(
+                spec=mlrun.common.schemas.ModelEndpointSpec(
                     function_uri=graph_server.function_uri,
                     model=versioned_model_name,
                     model_class=model.__class__.__name__,
                     model_uri=model.model_path,
                     stream_path=config.model_endpoint_monitoring.store_prefixes.default.format(
                         project=project, kind="stream"
                     ),
                     active=True,
-                    monitoring_mode=mlrun.model_monitoring.ModelMonitoringMode.enabled
+                    monitoring_mode=mlrun.common.model_monitoring.ModelMonitoringMode.enabled
                     if model.context.server.track_models
-                    else mlrun.model_monitoring.ModelMonitoringMode.disabled,
+                    else mlrun.common.model_monitoring.ModelMonitoringMode.disabled,
                 ),
-                status=ModelEndpointStatus(
-                    endpoint_type=mlrun.model_monitoring.EndpointType.NODE_EP
+                status=mlrun.common.schemas.ModelEndpointStatus(
+                    endpoint_type=mlrun.common.model_monitoring.EndpointType.NODE_EP
                 ),
             )
 
             db = mlrun.get_run_db()
 
             db.create_model_endpoint(
                 project=project,
```

## mlrun/utils/__init__.py

```diff
@@ -14,8 +14,7 @@
 
 from .async_http import AsyncClientWithRetry  # noqa
 from .azure_vault import AzureVaultStore  # noqa
 from .clones import get_git_username_password_from_token  # noqa
 from .helpers import *  # noqa
 from .http import *  # noqa
 from .logger import *  # noqa
-from .vault import *  # noqa
```

## mlrun/utils/helpers.py

```diff
@@ -950,15 +950,15 @@
         )
 
     raise Exception(
         f"failed to execute command by the given deadline."
         f" last_exception: {last_exception},"
         f" function_name: {_function.__name__},"
         f" timeout: {timeout}"
-    )
+    ) from last_exception
 
 
 def get_ui_url(project, uid=None):
     url = ""
     if mlrun.mlconf.resolve_ui_url():
         url = "{}/{}/{}/jobs".format(
             mlrun.mlconf.resolve_ui_url(), mlrun.mlconf.ui.projects_prefix, project
@@ -1291,7 +1291,30 @@
     :return:     Git source url with full valid path to the relevant branch
 
     """
     source, reference, branch = resolve_git_reference_from_source(url)
     if not branch and not reference:
         url = f"{url}#refs/heads/{repo.active_branch}"
     return url
+
+
+class DeprecationHelper(object):
+    """A helper class to deprecate old schemas"""
+
+    def __init__(self, new_target, version="1.4.0"):
+        self._new_target = new_target
+        self._version = version
+
+    def _warn(self):
+        warnings.warn(
+            f"mlrun.api.schemas.{self._new_target.__name__} is deprecated in version {self._version}, "
+            f"Please use mlrun.common.schemas.{self._new_target.__name__} instead.",
+            FutureWarning,
+        )
+
+    def __call__(self, *args, **kwargs):
+        self._warn()
+        return self._new_target(*args, **kwargs)
+
+    def __getattr__(self, attr):
+        self._warn()
+        return getattr(self._new_target, attr)
```

## mlrun/utils/model_monitoring.py

```diff
@@ -14,18 +14,18 @@
 #
 
 import json
 import warnings
 from typing import Union
 
 import mlrun
+import mlrun.common.model_monitoring as model_monitoring_constants
 import mlrun.model
-import mlrun.model_monitoring.constants as model_monitoring_constants
 import mlrun.platforms.iguazio
-from mlrun.api.schemas.schedule import ScheduleCronTrigger
+from mlrun.common.schemas.schedule import ScheduleCronTrigger
 from mlrun.config import is_running_as_api
 
 
 def parse_model_endpoint_project_prefix(path: str, project_name: str):
     return path.split(project_name, 1)[0] + project_name
 
 
@@ -40,15 +40,15 @@
     infrastructure functions.
     The supplied credentials must have data access
     :param access_key: Model Monitoring access key for managing user permissions.
     :param project: The name of the model monitoring project.
     """
     mlrun.get_run_db().create_project_secrets(
         project=project or mlrun.mlconf.default_project,
-        provider=mlrun.api.schemas.SecretProviderName.kubernetes,
+        provider=mlrun.common.schemas.SecretProviderName.kubernetes,
         secrets={model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY: access_key},
     )
 
 
 class TrackingPolicy(mlrun.model.ModelObj):
     """
     Modified model monitoring configurations. By using TrackingPolicy, the user can apply his model monitoring
@@ -129,20 +129,20 @@
 
 def get_connection_string(project: str = None):
     """Get endpoint store connection string from the project secret.
     If wasn't set, take it from the system configurations"""
     if is_running_as_api():
         # Running on API server side
         import mlrun.api.crud.secrets
-        import mlrun.api.schemas
+        import mlrun.common.schemas
 
         return (
             mlrun.api.crud.secrets.Secrets().get_project_secret(
                 project=project,
-                provider=mlrun.api.schemas.secret.SecretProviderName.kubernetes,
+                provider=mlrun.common.schemas.secret.SecretProviderName.kubernetes,
                 allow_secrets_from_k8s=True,
                 secret_key=model_monitoring_constants.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION,
             )
             or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
         )
     else:
         # Running on stream server side
@@ -152,14 +152,63 @@
             mlrun.get_secret_or_env(
                 model_monitoring_constants.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION
             )
             or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
         )
 
 
+def get_stream_path(project: str = None):
+    # TODO: This function (as well as other methods in this file) includes both client and server side code. We will
+    #  need to refactor and adjust this file in the future.
+    """Get stream path from the project secret. If wasn't set, take it from the system configurations"""
+
+    if is_running_as_api():
+
+        # Running on API server side
+        import mlrun.api.crud.secrets
+        import mlrun.common.schemas
+
+        stream_uri = mlrun.api.crud.secrets.Secrets().get_project_secret(
+            project=project,
+            provider=mlrun.common.schemas.secret.SecretProviderName.kubernetes,
+            allow_secrets_from_k8s=True,
+            secret_key=model_monitoring_constants.ProjectSecretKeys.STREAM_PATH,
+        ) or mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=project,
+            kind=model_monitoring_constants.FileTargetKind.STREAM,
+            target="online",
+        )
+
+    else:
+
+        import mlrun
+
+        stream_uri = mlrun.get_secret_or_env(
+            model_monitoring_constants.ProjectSecretKeys.STREAM_PATH
+        ) or mlrun.mlconf.get_model_monitoring_file_target_path(
+            project=project,
+            kind=model_monitoring_constants.FileTargetKind.STREAM,
+            target="online",
+        )
+
+    if stream_uri.startswith("kafka://"):
+        if "?topic" in stream_uri:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "Custom kafka topic is not allowed"
+            )
+        # Add topic to stream kafka uri
+        stream_uri += f"?topic=monitoring_stream_{project}"
+
+    elif stream_uri.startswith("v3io://") and mlrun.mlconf.is_ce_mode():
+        # V3IO is not supported in CE mode, generating a default http stream path
+        stream_uri = mlrun.mlconf.model_endpoint_monitoring.default_http_sink
+
+    return stream_uri
+
+
 def validate_errors_and_metrics(endpoint: dict):
     """
     Replace default null values for `error_count` and `metrics` for users that logged a model endpoint before 1.3.0
 
     Leaving here for backwards compatibility which related to the model endpoint schema
 
     :param endpoint: An endpoint flattened dictionary.
@@ -167,15 +216,19 @@
     warnings.warn(
         "This will be deprecated in 1.3.0, and will be removed in 1.5.0",
         # TODO: In 1.3.0 do changes in examples & demos In 1.5.0 remove
         FutureWarning,
     )
 
     # Validate default value for `error_count`
-    if endpoint[model_monitoring_constants.EventFieldType.ERROR_COUNT] == "null":
+    # For backwards compatibility reasons, we validate that the model endpoint includes the `error_count` key
+    if (
+        model_monitoring_constants.EventFieldType.ERROR_COUNT in endpoint
+        and endpoint[model_monitoring_constants.EventFieldType.ERROR_COUNT] == "null"
+    ):
         endpoint[model_monitoring_constants.EventFieldType.ERROR_COUNT] = "0"
 
     # Validate default value for `metrics`
     # For backwards compatibility reasons, we validate that the model endpoint includes the `metrics` key
     if (
         model_monitoring_constants.EventFieldType.METRICS in endpoint
         and endpoint[model_monitoring_constants.EventFieldType.METRICS] == "null"
```

## mlrun/utils/vault.py

```diff
@@ -7,275 +7,276 @@
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-
-import json
-import os
-from os.path import expanduser
-
-import requests
-
-from mlrun.errors import MLRunInvalidArgumentError
-
-from ..config import config as mlconf
-from ..k8s_utils import get_k8s_helper
-from .helpers import logger
-
-vault_default_prefix = "v1/secret/data"
-
-
-class VaultStore:
-    def __init__(self, token=None):
-        self._token = token
-        self.url = mlconf.secret_stores.vault.url
-
-    @property
-    def token(self):
-        if not self._token:
-            self._login()
-
-        return self._token
-
-    def _login(self):
-        if self._token:
-            return
-
-        if mlconf.secret_stores.vault.user_token != "":
-            logger.warning(
-                "Using a user-token from configuration. This should only be done in test/debug!"
-            )
-            self._token = mlconf.secret_stores.vault.user_token
-            return
-
-        config_role = mlconf.secret_stores.vault.role
-        if config_role != "":
-            role_type, role_val = config_role.split(":", 1)
-            vault_role = f"mlrun-role-{role_type}-{role_val}"
-            self._safe_login_with_jwt_token(vault_role)
-
-        if self._token is None:
-            logger.warning(
-                "Vault login: no vault token is available. No secrets will be accessible"
-            )
-
-    @staticmethod
-    def _generate_path(
-        prefix=vault_default_prefix,
-        user=None,
-        project=None,
-        user_prefix="users",
-        project_prefix="projects",
-    ):
-        if user and project:
-            raise MLRunInvalidArgumentError(
-                "Both user and project were provided for Vault operations"
-            )
-
-        if user:
-            return prefix + f"/mlrun/{user_prefix}/{user}"
-        elif project:
-            return prefix + f"/mlrun/{project_prefix}/{project}"
-        else:
-            raise MLRunInvalidArgumentError(
-                "To generate a vault secret path, either user or project must be specified"
-            )
-
-    @staticmethod
-    def _read_jwt_token():
-        # if for some reason the path to the token is not in conf, then attempt to get the SA token (works on k8s pods)
-        token_path = "/var/run/secrets/kubernetes.io/serviceaccount/token"
-        if mlconf.secret_stores.vault.token_path:
-            # Override the default SA token in case a specific token is installed in the mlconf-specified path
-            secret_token_path = expanduser(
-                mlconf.secret_stores.vault.token_path + "/token"
-            )
-            if os.path.isfile(secret_token_path):
-                token_path = secret_token_path
-
-        with open(token_path, "r") as token_file:
-            jwt_token = token_file.read()
-
-        return jwt_token
-
-    def _api_call(self, method, url, data=None):
-        self._login()
-
-        headers = {"X-Vault-Token": self._token}
-        full_url = self.url + "/" + url
-
-        response = requests.request(method, full_url, headers=headers, json=data)
-
-        if not response:
-            logger.error(
-                "Vault failed the API call",
-                status_code=response.status_code,
-                reason=response.reason,
-                url=url,
-            )
-        return response
-
-    # This method logins to the vault, assuming the container has a JWT token mounted as part of its assigned service
-    # account.
-    def _safe_login_with_jwt_token(self, role):
-
-        if role is None:
-            logger.warning(
-                "login_with_token: Role passed is None. Will not attempt login"
-            )
-            return
-
-        jwt_token = self._read_jwt_token()
-
-        login_url = f"{self.url}/v1/auth/kubernetes/login"
-        data = {"jwt": jwt_token, "role": role}
-
-        response = requests.post(login_url, data=json.dumps(data))
-        if not response:
-            logger.error(
-                "login_with_token: Vault failed the login request",
-                role=role,
-                status_code=response.status_code,
-                reason=response.reason,
-            )
-            return
-        self._token = response.json()["auth"]["client_token"]
-
-    def get_secrets(self, keys, user=None, project=None):
-        secret_path = VaultStore._generate_path(user=user, project=project)
-        secrets = {}
-
-        # Since this method is called both on the client side (when constructing VaultStore before persisting to
-        # pod configuration) and on server side and in execution pods, we let this method fail gracefully in this case.
-        # Should replace with something that will explode on server-side, once we have a way to do that.
-        if not self.url:
-            return secrets
-
-        response = self._api_call("GET", secret_path)
-
-        if not response:
-            return secrets
-
-        values = response.json()["data"]["data"]
-
-        # if no specific keys were asked for, return all the values available
-        if not keys:
-            return values
-
-        for key in keys:
-            if key in values:
-                secrets[key] = values[key]
-        return secrets
-
-    def add_vault_secrets(self, items, project=None, user=None):
-        data_object = {"data": items}
-        url = VaultStore._generate_path(project=project, user=user)
-
-        response = self._api_call("POST", url, data_object)
-        if not response:
-            raise MLRunInvalidArgumentError(
-                f"Vault failed the API call to create secrets. project={project}/user={user}"
-            )
-
-    def delete_vault_secrets(self, project=None, user=None):
-        self._login()
-        # Using the API to delete all versions + metadata of the given secret.
-        url = "v1/secret/metadata" + VaultStore._generate_path(
-            prefix="", project=project, user=user
-        )
-
-        response = self._api_call("DELETE", url)
-        if not response:
-            raise MLRunInvalidArgumentError(
-                f"Vault failed the API call to delete secrets. project={project}/user={user}"
-            )
-
-    def create_project_policy(self, project):
-        policy_name = f"mlrun-project-{project}"
-        # TODO - need to make sure name is escaped properly and invalid chars are stripped
-        url = "v1/sys/policies/acl/" + policy_name
-
-        policy_str = (
-            f'path "secret/data/mlrun/projects/{project}" {{\n'
-            + '  capabilities = ["read", "list", "create", "delete", "update"]\n'
-            + "}\n"
-            + f'path "secret/data/mlrun/projects/{project}/*" {{\n'
-            + '  capabilities = ["read", "list", "create", "delete", "update"]\n'
-            + "}"
-        )
-
-        data_object = {"policy": policy_str}
-
-        response = self._api_call("PUT", url, data_object)
-        if not response:
-            raise MLRunInvalidArgumentError(
-                f"Vault failed the API call to create a policy. "
-                f"Response code: ({response.status_code}) - {response.reason}"
-            )
-        return policy_name
-
-    def create_project_role(self, project, sa, policy, namespace="default-tenant"):
-        role_name = f"mlrun-role-project-{project}"
-        # TODO - need to make sure name is escaped properly and invalid chars are stripped
-        url = "v1/auth/kubernetes/role/" + role_name
-
-        role_object = {
-            "bound_service_account_names": sa,
-            "bound_service_account_namespaces": namespace,
-            "policies": [policy],
-            "token_ttl": mlconf.secret_stores.vault.token_ttl,
-        }
-
-        response = self._api_call("POST", url, role_object)
-        if not response:
-            raise MLRunInvalidArgumentError(
-                f"Vault failed the API call to create a secret. "
-                f"Response code: ({response.status_code}) - {response.reason}"
-            )
-        return role_name
-
-
-def store_vault_project_secrets(project, items):
-    return VaultStore().add_vault_secrets(items, project=project)
-
-
-def add_vault_user_secrets(user, items):
-    return VaultStore().add_vault_secrets(items, user=user)
-
-
-def init_project_vault_configuration(project):
-    """Create needed configurations for this new project:
-    - Create a k8s service account with the name sa_vault_{proj name}
-    - Create a Vault policy with the name proj_{proj name}
-    - Create a Vault k8s auth role with the name role_proj_{proj name}
-    These constructs will enable any pod created as part of this project to access the project's secrets
-    in Vault, assuming that the secret which is part of the SA created is mounted to the pod.
-
-    :param project: Project name
-    """
-    logger.info("Initializing project vault configuration", project=project)
-
-    namespace = mlconf.namespace
-    k8s = get_k8s_helper(silent=True)
-    service_account_name = (
-        mlconf.secret_stores.vault.project_service_account_name.format(project=project)
-    )
-
-    secret_name = k8s.get_project_vault_secret_name(
-        project, service_account_name, namespace=namespace
-    )
-
-    if not secret_name:
-        k8s.create_project_service_account(
-            project, service_account_name, namespace=namespace
-        )
-
-    vault = VaultStore()
-    policy_name = vault.create_project_policy(project)
-    role_name = vault.create_project_role(
-        project, namespace=namespace, sa=service_account_name, policy=policy_name
-    )
-
-    logger.info("Created Vault policy. ", policy=policy_name, role=role_name)
+#
+# import json
+# import os
+# from os.path import expanduser
+#
+# import requests
+#
+# from mlrun.errors import MLRunInvalidArgumentError
+#
+# from ..config import config as mlconf
+# from ..k8s_utils import get_k8s_helper
+# from .helpers import logger
+#
+# vault_default_prefix = "v1/secret/data"
+#
+#
+# class VaultStore:
+#     def __init__(self, token=None):
+#         self._token = token
+#         self.url = mlconf.secret_stores.vault.url
+#
+#     @property
+#     def token(self):
+#         if not self._token:
+#             self._login()
+#
+#         return self._token
+#
+#     def _login(self):
+#         if self._token:
+#             return
+#
+#         if mlconf.secret_stores.vault.user_token != "":
+#             logger.warning(
+#                 "Using a user-token from configuration. This should only be done in test/debug!"
+#             )
+#             self._token = mlconf.secret_stores.vault.user_token
+#             return
+#
+#         config_role = mlconf.secret_stores.vault.role
+#         if config_role != "":
+#             role_type, role_val = config_role.split(":", 1)
+#             vault_role = f"mlrun-role-{role_type}-{role_val}"
+#             self._safe_login_with_jwt_token(vault_role)
+#
+#         if self._token is None:
+#             logger.warning(
+#                 "Vault login: no vault token is available. No secrets will be accessible"
+#             )
+#
+#     @staticmethod
+#     def _generate_path(
+#         prefix=vault_default_prefix,
+#         user=None,
+#         project=None,
+#         user_prefix="users",
+#         project_prefix="projects",
+#     ):
+#         if user and project:
+#             raise MLRunInvalidArgumentError(
+#                 "Both user and project were provided for Vault operations"
+#             )
+#
+#         if user:
+#             return prefix + f"/mlrun/{user_prefix}/{user}"
+#         elif project:
+#             return prefix + f"/mlrun/{project_prefix}/{project}"
+#         else:
+#             raise MLRunInvalidArgumentError(
+#                 "To generate a vault secret path, either user or project must be specified"
+#             )
+#
+#     @staticmethod
+#     def _read_jwt_token():
+#         # if for some reason the path to the token is not in conf, then attempt to get the SA token
+#         # (works on k8s pods)
+#         token_path = "/var/run/secrets/kubernetes.io/serviceaccount/token"
+#         if mlconf.secret_stores.vault.token_path:
+#             # Override the default SA token in case a specific token is installed in the mlconf-specified path
+#             secret_token_path = expanduser(
+#                 mlconf.secret_stores.vault.token_path + "/token"
+#             )
+#             if os.path.isfile(secret_token_path):
+#                 token_path = secret_token_path
+#
+#         with open(token_path, "r") as token_file:
+#             jwt_token = token_file.read()
+#
+#         return jwt_token
+#
+#     def _api_call(self, method, url, data=None):
+#         self._login()
+#
+#         headers = {"X-Vault-Token": self._token}
+#         full_url = self.url + "/" + url
+#
+#         response = requests.request(method, full_url, headers=headers, json=data)
+#
+#         if not response:
+#             logger.error(
+#                 "Vault failed the API call",
+#                 status_code=response.status_code,
+#                 reason=response.reason,
+#                 url=url,
+#             )
+#         return response
+#
+#     # This method logins to the vault, assuming the container has a JWT token mounted as part of its assigned service
+#     # account.
+#     def _safe_login_with_jwt_token(self, role):
+#
+#         if role is None:
+#             logger.warning(
+#                 "login_with_token: Role passed is None. Will not attempt login"
+#             )
+#             return
+#
+#         jwt_token = self._read_jwt_token()
+#
+#         login_url = f"{self.url}/v1/auth/kubernetes/login"
+#         data = {"jwt": jwt_token, "role": role}
+#
+#         response = requests.post(login_url, data=json.dumps(data))
+#         if not response:
+#             logger.error(
+#                 "login_with_token: Vault failed the login request",
+#                 role=role,
+#                 status_code=response.status_code,
+#                 reason=response.reason,
+#             )
+#             return
+#         self._token = response.json()["auth"]["client_token"]
+#
+#     def get_secrets(self, keys, user=None, project=None):
+#         secret_path = VaultStore._generate_path(user=user, project=project)
+#         secrets = {}
+#
+#         # Since this method is called both on the client side (when constructing VaultStore before persisting to
+#         # pod configuration) and on server side and in execution pods, we let this method fail gracefully in this case
+#         # Should replace with something that will explode on server-side, once we have a way to do that.
+#         if not self.url:
+#             return secrets
+#
+#         response = self._api_call("GET", secret_path)
+#
+#         if not response:
+#             return secrets
+#
+#         values = response.json()["data"]["data"]
+#
+#         # if no specific keys were asked for, return all the values available
+#         if not keys:
+#             return values
+#
+#         for key in keys:
+#             if key in values:
+#                 secrets[key] = values[key]
+#         return secrets
+#
+#     def add_vault_secrets(self, items, project=None, user=None):
+#         data_object = {"data": items}
+#         url = VaultStore._generate_path(project=project, user=user)
+#
+#         response = self._api_call("POST", url, data_object)
+#         if not response:
+#             raise MLRunInvalidArgumentError(
+#                 f"Vault failed the API call to create secrets. project={project}/user={user}"
+#             )
+#
+#     def delete_vault_secrets(self, project=None, user=None):
+#         self._login()
+#         # Using the API to delete all versions + metadata of the given secret.
+#         url = "v1/secret/metadata" + VaultStore._generate_path(
+#             prefix="", project=project, user=user
+#         )
+#
+#         response = self._api_call("DELETE", url)
+#         if not response:
+#             raise MLRunInvalidArgumentError(
+#                 f"Vault failed the API call to delete secrets. project={project}/user={user}"
+#             )
+#
+#     def create_project_policy(self, project):
+#         policy_name = f"mlrun-project-{project}"
+#         # TODO - need to make sure name is escaped properly and invalid chars are stripped
+#         url = "v1/sys/policies/acl/" + policy_name
+#
+#         policy_str = (
+#             f'path "secret/data/mlrun/projects/{project}" {{\n'
+#             + '  capabilities = ["read", "list", "create", "delete", "update"]\n'
+#             + "}\n"
+#             + f'path "secret/data/mlrun/projects/{project}/*" {{\n'
+#             + '  capabilities = ["read", "list", "create", "delete", "update"]\n'
+#             + "}"
+#         )
+#
+#         data_object = {"policy": policy_str}
+#
+#         response = self._api_call("PUT", url, data_object)
+#         if not response:
+#             raise MLRunInvalidArgumentError(
+#                 f"Vault failed the API call to create a policy. "
+#                 f"Response code: ({response.status_code}) - {response.reason}"
+#             )
+#         return policy_name
+#
+#     def create_project_role(self, project, sa, policy, namespace="default-tenant"):
+#         role_name = f"mlrun-role-project-{project}"
+#         # TODO - need to make sure name is escaped properly and invalid chars are stripped
+#         url = "v1/auth/kubernetes/role/" + role_name
+#
+#         role_object = {
+#             "bound_service_account_names": sa,
+#             "bound_service_account_namespaces": namespace,
+#             "policies": [policy],
+#             "token_ttl": mlconf.secret_stores.vault.token_ttl,
+#         }
+#
+#         response = self._api_call("POST", url, role_object)
+#         if not response:
+#             raise MLRunInvalidArgumentError(
+#                 f"Vault failed the API call to create a secret. "
+#                 f"Response code: ({response.status_code}) - {response.reason}"
+#             )
+#         return role_name
+#
+#
+# def store_vault_project_secrets(project, items):
+#     return VaultStore().add_vault_secrets(items, project=project)
+#
+#
+# def add_vault_user_secrets(user, items):
+#     return VaultStore().add_vault_secrets(items, user=user)
+#
+#
+# def init_project_vault_configuration(project):
+#     """Create needed configurations for this new project:
+#     - Create a k8s service account with the name sa_vault_{proj name}
+#     - Create a Vault policy with the name proj_{proj name}
+#     - Create a Vault k8s auth role with the name role_proj_{proj name}
+#     These constructs will enable any pod created as part of this project to access the project's secrets
+#     in Vault, assuming that the secret which is part of the SA created is mounted to the pod.
+#
+#     :param project: Project name
+#     """
+#     logger.info("Initializing project vault configuration", project=project)
+#
+#     namespace = mlconf.namespace
+#     k8s = get_k8s_helper(silent=True)
+#     service_account_name = (
+#         mlconf.secret_stores.vault.project_service_account_name.format(project=project)
+#     )
+#
+#     secret_name = k8s.get_project_vault_secret_name(
+#         project, service_account_name, namespace=namespace
+#     )
+#
+#     if not secret_name:
+#         k8s.create_project_service_account(
+#             project, service_account_name, namespace=namespace
+#         )
+#
+#     vault = VaultStore()
+#     policy_name = vault.create_project_policy(project)
+#     role_name = vault.create_project_role(
+#         project, namespace=namespace, sa=service_account_name, policy=policy_name
+#     )
+#
+#     logger.info("Created Vault policy. ", policy=policy_name, role=role_name)
```

## mlrun/utils/notifications/notification_pusher.py

```diff
@@ -18,16 +18,16 @@
 import os
 import typing
 
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.db.base
 import mlrun.api.db.session
-import mlrun.api.schemas
 import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
 import mlrun.config
 import mlrun.lists
 import mlrun.model
 import mlrun.utils.helpers
 from mlrun.utils import logger
 
 from .notification import NotificationBase, NotificationTypes
@@ -102,15 +102,15 @@
         when_states = notification.when
         condition = notification.condition
         run_state = run.state()
 
         # if the notification isn't pending, don't push it
         if (
             notification.status
-            and notification.status != mlrun.api.schemas.NotificationStatus.PENDING
+            and notification.status != mlrun.common.schemas.NotificationStatus.PENDING
         ):
             return False
 
         # if at least one condition is met, notify
         for when_state in when_states:
             if (
                 when_state == run_state == "completed"
@@ -145,15 +145,16 @@
         notification: NotificationBase,
         run: mlrun.model.RunObject,
         notification_object: mlrun.model.Notification,
         db: mlrun.api.db.base.DBInterface,
     ):
         message = self.messages.get(run.state(), "")
         severity = (
-            notification_object.severity or mlrun.api.schemas.NotificationSeverity.INFO
+            notification_object.severity
+            or mlrun.common.schemas.NotificationSeverity.INFO
         )
         logger.debug(
             "Pushing notification",
             notification=notification_object.to_dict(),
             run_uid=run.metadata.uid,
         )
         try:
@@ -164,25 +165,25 @@
 
             if mlrun.config.is_running_as_api():
                 await self._update_notification_status(
                     db,
                     run.metadata.uid,
                     run.metadata.project,
                     notification_object,
-                    status=mlrun.api.schemas.NotificationStatus.SENT,
+                    status=mlrun.common.schemas.NotificationStatus.SENT,
                     sent_time=datetime.datetime.now(tz=datetime.timezone.utc),
                 )
         except Exception as exc:
             if mlrun.config.is_running_as_api():
                 await self._update_notification_status(
                     db,
                     run.metadata.uid,
                     run.metadata.project,
                     notification_object,
-                    status=mlrun.api.schemas.NotificationStatus.ERROR,
+                    status=mlrun.common.schemas.NotificationStatus.ERROR,
                 )
             raise exc
 
     @staticmethod
     async def _update_notification_status(
         db: mlrun.api.db.base.DBInterface,
         run_uid: str,
@@ -212,16 +213,16 @@
             for notification_type in notification_types
         }
 
     def push(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         async def _push():
             tasks = []
             for notification_type, notification in self._notifications.items():
                 if self.should_push_notification(notification_type):
@@ -239,16 +240,16 @@
             main_event_loop.run_until_complete(_push())
 
     @staticmethod
     async def _push_notification(
         notification: NotificationBase,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         if asyncio.iscoroutinefunction(notification.push):
             await notification.push(message, severity, runs, custom_html)
         else:
             notification.push(message, severity, runs, custom_html)
```

## mlrun/utils/notifications/notification/base.py

```diff
@@ -10,15 +10,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import typing
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.lists
 
 
 class NotificationBase:
     def __init__(
         self,
         name: str = None,
@@ -31,16 +31,16 @@
     def active(self) -> bool:
         return True
 
     def push(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         raise NotImplementedError()
 
     def load_notification(
         self,
@@ -48,16 +48,16 @@
     ) -> None:
         self.params = params or {}
 
     def _get_html(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ) -> str:
         if custom_html:
             return custom_html
 
         if self.name:
```

## mlrun/utils/notifications/notification/console.py

```diff
@@ -12,15 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import typing
 
 import tabulate
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.lists
 import mlrun.utils.helpers
 
 from .base import NotificationBase
 
 
 class ConsoleNotification(NotificationBase):
@@ -28,16 +28,16 @@
     Client only notification for printing run status notifications in console
     """
 
     def push(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         print(f"[{severity}] {message}")
 
         if not runs:
             return
```

## mlrun/utils/notifications/notification/git.py

```diff
@@ -14,15 +14,15 @@
 
 import json
 import os
 import typing
 
 import aiohttp
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.lists
 
 from .base import NotificationBase
 
 
 class GitNotification(NotificationBase):
@@ -30,16 +30,16 @@
     API/Client notification for setting a rich run statuses git issue comment (github/gitlab)
     """
 
     async def push(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         git_repo = self.params.get("repo", None)
         git_issue = self.params.get("issue", None)
         token = (
             self.params.get("token", None)
```

## mlrun/utils/notifications/notification/ipython.py

```diff
@@ -10,15 +10,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import typing
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.lists
 import mlrun.utils.helpers
 
 from .base import NotificationBase
 
 
 class IPythonNotification(NotificationBase):
@@ -46,16 +46,16 @@
     def active(self) -> bool:
         return self._ipython is not None
 
     def push(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         if not self._ipython:
             mlrun.utils.helpers.logger.debug(
                 "Not in IPython environment, skipping notification"
             )
```

## mlrun/utils/notifications/notification/slack.py

```diff
@@ -12,15 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import typing
 
 import aiohttp
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.lists
 import mlrun.utils.helpers
 
 from .base import NotificationBase
 
 
 class SlackNotification(NotificationBase):
@@ -34,16 +34,16 @@
         "error": ":x:",
     }
 
     async def push(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         webhook = self.params.get("webhook", None) or mlrun.get_secret_or_env(
             "SLACK_WEBHOOK"
         )
 
@@ -59,16 +59,16 @@
             async with session.post(webhook, json=data) as response:
                 response.raise_for_status()
 
     def _generate_slack_data(
         self,
         message: str,
         severity: typing.Union[
-            mlrun.api.schemas.NotificationSeverity, str
-        ] = mlrun.api.schemas.NotificationSeverity.INFO,
+            mlrun.common.schemas.NotificationSeverity, str
+        ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
     ) -> dict:
         data = {
             "blocks": [
                 {
                     "type": "section",
                     "text": self._get_slack_row(f"[{severity}] {message}"),
```

## mlrun/utils/version/version.json

### Pretty-printed

 * *Similarity: 0.5%*

 * *Differences: {"'git_commit'": "'207f6987e318c06f539ba3526acb03cc3323d2c1'", "'version'": "'1.4.0-rc3'"}*

```diff
@@ -1,4 +1,4 @@
 {
-    "git_commit": "11fee9f04e66041b9883f73dbdc61be0b4c6498b",
-    "version": "1.4.0-rc2"
+    "git_commit": "207f6987e318c06f539ba3526acb03cc3323d2c1",
+    "version": "1.4.0-rc3"
 }
```

## Comparing `mlrun/api/api/endpoints/marketplace.py` & `mlrun/api/api/endpoints/hub.py`

 * *Files 16% similar despite different names*

```diff
@@ -21,288 +21,298 @@
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun
 import mlrun.api.api.deps
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
-from mlrun.api.schemas import AuthorizationAction
-from mlrun.api.schemas.marketplace import (
-    IndexedMarketplaceSource,
-    MarketplaceCatalog,
-    MarketplaceItem,
-)
-from mlrun.api.utils.singletons.db import get_db
+import mlrun.api.utils.singletons.db
+import mlrun.common.schemas
+import mlrun.common.schemas.hub
 
 router = APIRouter()
 
 
 @router.post(
-    path="/marketplace/sources",
+    path="/hub/sources",
     status_code=HTTPStatus.CREATED.value,
-    response_model=IndexedMarketplaceSource,
+    response_model=mlrun.common.schemas.hub.IndexedHubSource,
 )
 async def create_source(
-    source: IndexedMarketplaceSource,
+    source: mlrun.common.schemas.hub.IndexedHubSource,
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.create,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.create,
         auth_info,
     )
 
-    await run_in_threadpool(get_db().create_marketplace_source, db_session, source)
+    await run_in_threadpool(
+        mlrun.api.utils.singletons.db.get_db().create_hub_source, db_session, source
+    )
     # Handle credentials if they exist
-    await run_in_threadpool(mlrun.api.crud.Marketplace().add_source, source.source)
+    await run_in_threadpool(mlrun.api.crud.Hub().add_source, source.source)
     return await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source.source.metadata.name
+        mlrun.api.utils.singletons.db.get_db().get_hub_source,
+        db_session,
+        source.source.metadata.name,
     )
 
 
 @router.get(
-    path="/marketplace/sources",
-    response_model=List[IndexedMarketplaceSource],
+    path="/hub/sources",
+    response_model=List[mlrun.common.schemas.hub.IndexedHubSource],
 )
 async def list_sources(
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
-    return await run_in_threadpool(get_db().list_marketplace_sources, db_session)
+    return await run_in_threadpool(
+        mlrun.api.utils.singletons.db.get_db().list_hub_sources, db_session
+    )
 
 
 @router.delete(
-    path="/marketplace/sources/{source_name}",
+    path="/hub/sources/{source_name}",
     status_code=HTTPStatus.NO_CONTENT.value,
 )
 async def delete_source(
     source_name: str,
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.delete,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
 
-    await run_in_threadpool(get_db().delete_marketplace_source, db_session, source_name)
-    await run_in_threadpool(mlrun.api.crud.Marketplace().remove_source, source_name)
+    await run_in_threadpool(
+        mlrun.api.utils.singletons.db.get_db().delete_hub_source,
+        db_session,
+        source_name,
+    )
+    await run_in_threadpool(mlrun.api.crud.Hub().remove_source, source_name)
 
 
 @router.get(
-    path="/marketplace/sources/{source_name}",
-    response_model=IndexedMarketplaceSource,
+    path="/hub/sources/{source_name}",
+    response_model=mlrun.common.schemas.hub.IndexedHubSource,
 )
 async def get_source(
     source_name: str,
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
-    marketplace_source = await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source_name
+    hub_source = await run_in_threadpool(
+        mlrun.api.utils.singletons.db.get_db().get_hub_source, db_session, source_name
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
-    return marketplace_source
+    return hub_source
 
 
 @router.put(
-    path="/marketplace/sources/{source_name}", response_model=IndexedMarketplaceSource
+    path="/hub/sources/{source_name}",
+    response_model=mlrun.common.schemas.hub.IndexedHubSource,
 )
 async def store_source(
     source_name: str,
-    source: IndexedMarketplaceSource,
+    source: mlrun.common.schemas.hub.IndexedHubSource,
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.store,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
 
     await run_in_threadpool(
-        get_db().store_marketplace_source, db_session, source_name, source
+        mlrun.api.utils.singletons.db.get_db().store_hub_source,
+        db_session,
+        source_name,
+        source,
     )
     # Handle credentials if they exist
-    await run_in_threadpool(mlrun.api.crud.Marketplace().add_source, source.source)
+    await run_in_threadpool(mlrun.api.crud.Hub().add_source, source.source)
 
     return await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source_name
+        mlrun.api.utils.singletons.db.get_db().get_hub_source, db_session, source_name
     )
 
 
 @router.get(
-    path="/marketplace/sources/{source_name}/items",
-    response_model=MarketplaceCatalog,
+    path="/hub/sources/{source_name}/items",
+    response_model=mlrun.common.schemas.hub.HubCatalog,
 )
 async def get_catalog(
     source_name: str,
     version: Optional[str] = Query(None),
     tag: Optional[str] = Query(None),
     force_refresh: Optional[bool] = Query(False, alias="force-refresh"),
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     ordered_source = await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source_name
+        mlrun.api.utils.singletons.db.get_db().get_hub_source, db_session, source_name
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     return await run_in_threadpool(
-        mlrun.api.crud.Marketplace().get_source_catalog,
+        mlrun.api.crud.Hub().get_source_catalog,
         ordered_source.source,
         version,
         tag,
         force_refresh,
     )
 
 
 @router.get(
-    "/marketplace/sources/{source_name}/items/{item_name}",
-    response_model=MarketplaceItem,
+    "/hub/sources/{source_name}/items/{item_name}",
+    response_model=mlrun.common.schemas.hub.HubItem,
 )
 async def get_item(
     source_name: str,
     item_name: str,
     version: Optional[str] = Query(None),
     tag: Optional[str] = Query("latest"),
     force_refresh: Optional[bool] = Query(False, alias="force-refresh"),
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     ordered_source = await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source_name
+        mlrun.api.utils.singletons.db.get_db().get_hub_source, db_session, source_name
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     return await run_in_threadpool(
-        mlrun.api.crud.Marketplace().get_item,
+        mlrun.api.crud.Hub().get_item,
         ordered_source.source,
         item_name,
         version,
         tag,
         force_refresh,
     )
 
 
 @router.get(
-    "/marketplace/sources/{source_name}/item-object",
+    "/hub/sources/{source_name}/item-object",
 )
 async def get_object(
     source_name: str,
     url: str,
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     ordered_source = await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source_name
+        mlrun.api.utils.singletons.db.get_db().get_hub_source, db_session, source_name
     )
     object_data = await run_in_threadpool(
-        mlrun.api.crud.Marketplace().get_item_object_using_source_credentials,
+        mlrun.api.crud.Hub().get_item_object_using_source_credentials,
         ordered_source.source,
         url,
     )
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
 
     if url.endswith("/"):
         return object_data
 
     ctype, _ = mimetypes.guess_type(url)
     if not ctype:
         ctype = "application/octet-stream"
     return Response(content=object_data, media_type=ctype)
 
 
-@router.get("/marketplace/sources/{source_name}/items/{item_name}/assets/{asset_name}")
+@router.get("/hub/sources/{source_name}/items/{item_name}/assets/{asset_name}")
 async def get_asset(
     source_name: str,
     item_name: str,
     asset_name: str,
     tag: Optional[str] = Query("latest"),
     version: Optional[str] = Query(None),
     db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
-    auth_info: mlrun.api.schemas.AuthInfo = Depends(
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
         mlrun.api.api.deps.authenticate_request
     ),
 ):
     """
-    Retrieve asset from a specific item in specific marketplace source.
+    Retrieve asset from a specific item in specific hub source.
 
-    :param source_name: marketplace source name
+    :param source_name: hub source name
     :param item_name:   the name of the item
     :param asset_name:  the name of the asset to retrieve
     :param tag:         tag of item - latest or version number
     :param version:     item version
     :param db_session:  a session that manages the current dialog with the database
     :param auth_info:   the auth info of the request
 
     :return: fastapi response with the asset in content
     """
     source = await run_in_threadpool(
-        get_db().get_marketplace_source, db_session, source_name
+        mlrun.api.utils.singletons.db.get_db().get_hub_source, db_session, source_name
     )
 
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_global_resource_permissions(
-        mlrun.api.schemas.AuthorizationResourceTypes.marketplace_source,
-        AuthorizationAction.read,
+        mlrun.common.schemas.AuthorizationResourceTypes.hub_source,
+        mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
     # Getting the relevant item which hold the asset information
     item = await run_in_threadpool(
-        mlrun.api.crud.Marketplace().get_item,
+        mlrun.api.crud.Hub().get_item,
         source.source,
         item_name,
         version,
         tag,
     )
 
     # Getting the asset from the item
     asset, url = await run_in_threadpool(
-        mlrun.api.crud.Marketplace().get_asset,
+        mlrun.api.crud.Hub().get_asset,
         source.source,
         item,
         asset_name,
     )
 
     ctype, _ = mimetypes.guess_type(url)
     if not ctype:
```

## Comparing `mlrun/api/crud/marketplace.py` & `mlrun/api/crud/hub.py`

 * *Files 13% similar despite different names*

```diff
@@ -11,55 +11,48 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import json
 from typing import Any, Dict, List, Optional, Tuple
 
+import mlrun.api.utils.singletons.k8s
+import mlrun.common.schemas
+import mlrun.common.schemas.hub
 import mlrun.errors
 import mlrun.utils.singleton
-from mlrun.api.schemas.marketplace import (
-    MarketplaceCatalog,
-    MarketplaceItem,
-    MarketplaceItemMetadata,
-    MarketplaceItemSpec,
-    MarketplaceSource,
-    ObjectStatus,
-)
-from mlrun.api.utils.singletons.k8s import get_k8s
 from mlrun.config import config
 from mlrun.datastore import store_manager
 
-from ..schemas import SecretProviderName
 from .secrets import Secrets, SecretsClientType
 
 # Using a complex separator, as it's less likely someone will use it in a real secret name
 secret_name_separator = "-__-"
 
 
-class Marketplace(metaclass=mlrun.utils.singleton.Singleton):
+class Hub(metaclass=mlrun.utils.singleton.Singleton):
     def __init__(self):
-        self._internal_project_name = config.marketplace.k8s_secrets_project_name
+        self._internal_project_name = config.hub.k8s_secrets_project_name
         self._catalogs = {}
 
     @staticmethod
     def _in_k8s():
-        k8s_helper = get_k8s()
+        k8s_helper = mlrun.api.utils.singletons.k8s.get_k8s_helper()
         return (
             k8s_helper is not None and k8s_helper.is_running_inside_kubernetes_cluster()
         )
 
     @staticmethod
     def _generate_credentials_secret_key(source, key=""):
         full_key = source + secret_name_separator + key
         return Secrets().generate_client_project_secret_key(
-            SecretsClientType.marketplace, full_key
+            SecretsClientType.hub, full_key
         )
 
-    def add_source(self, source: MarketplaceSource):
+    def add_source(self, source: mlrun.common.schemas.hub.HubSource):
         source_name = source.metadata.name
         credentials = source.spec.credentials
         if credentials:
             self._store_source_credentials(source_name, credentials)
 
     def remove_source(self, source_name):
         self._catalogs.pop(source_name, None)
@@ -71,47 +64,48 @@
             return
         secrets_to_delete = [
             self._generate_credentials_secret_key(source_name, key)
             for key in source_credentials
         ]
         Secrets().delete_project_secrets(
             self._internal_project_name,
-            SecretProviderName.kubernetes,
+            mlrun.common.schemas.SecretProviderName.kubernetes,
             secrets_to_delete,
             allow_internal_secrets=True,
         )
 
     def _store_source_credentials(self, source_name, credentials: dict):
         if not self._in_k8s():
             raise mlrun.errors.MLRunInvalidArgumentError(
-                "MLRun is not configured with k8s, marketplace source credentials cannot be stored securely"
+                "MLRun is not configured with k8s, hub source credentials cannot be stored securely"
             )
 
         adjusted_credentials = {
             self._generate_credentials_secret_key(source_name, key): value
             for key, value in credentials.items()
         }
         Secrets().store_project_secrets(
             self._internal_project_name,
-            mlrun.api.schemas.SecretsData(
-                provider=SecretProviderName.kubernetes, secrets=adjusted_credentials
+            mlrun.common.schemas.SecretsData(
+                provider=mlrun.common.schemas.SecretProviderName.kubernetes,
+                secrets=adjusted_credentials,
             ),
             allow_internal_secrets=True,
         )
 
     def _get_source_credentials(self, source_name):
         if not self._in_k8s():
             return {}
 
         secret_prefix = self._generate_credentials_secret_key(source_name)
         secrets = (
             Secrets()
             .list_project_secrets(
                 self._internal_project_name,
-                SecretProviderName.kubernetes,
+                mlrun.common.schemas.SecretProviderName.kubernetes,
                 allow_secrets_from_k8s=True,
                 allow_internal_secrets=True,
             )
             .secrets
         )
 
         source_secrets = {}
@@ -119,20 +113,22 @@
             if key.startswith(secret_prefix):
                 source_secrets[key[len(secret_prefix) :]] = value
 
         return source_secrets
 
     @staticmethod
     def _get_asset_full_path(
-        source: MarketplaceSource, item: MarketplaceItem, asset: str
+        source: mlrun.common.schemas.hub.HubSource,
+        item: mlrun.common.schemas.hub.HubItem,
+        asset: str,
     ):
         """
         Combining the item path with the asset path.
 
-        :param source:  Marketplace source object.
+        :param source:  Hub source object.
         :param item:    The relevant item to get the asset from.
         :param asset:   The asset name
         :return:    Full path to the asset, relative to the item directory.
         """
         asset_path = item.spec.assets.get(asset, None)
         if not asset_path:
             raise mlrun.errors.MLRunNotFoundError(
@@ -140,59 +136,61 @@
                 f"item={item.metadata.name}, version={item.metadata.version}, tag={item.metadata.tag}"
             )
         item_path = item.metadata.get_relative_path()
         return source.get_full_uri(item_path + asset_path)
 
     @staticmethod
     def _transform_catalog_dict_to_schema(
-        source: MarketplaceSource, catalog_dict: Dict[str, Any]
-    ) -> MarketplaceCatalog:
+        source: mlrun.common.schemas.hub.HubSource, catalog_dict: Dict[str, Any]
+    ) -> mlrun.common.schemas.hub.HubCatalog:
         """
-        Transforms catalog dictionary to MarketplaceCatalog schema
-        :param source:          Marketplace source object.
+        Transforms catalog dictionary to HubCatalog schema
+        :param source:          Hub source object.
         :param catalog_dict:    raw catalog dict, top level keys are item names,
                                 second level keys are version tags ("latest, "1.1.0", ...) and
                                 bottom level keys include spec as a dict and all the rest is considered as metadata.
         :return: catalog object
         """
-        catalog = MarketplaceCatalog(catalog=[], channel=source.spec.channel)
+        catalog = mlrun.common.schemas.hub.HubCatalog(
+            catalog=[], channel=source.spec.channel
+        )
         # Loop over objects, then over object versions.
         for object_name, object_dict in catalog_dict.items():
             for version_tag, version_dict in object_dict.items():
                 object_details_dict = version_dict.copy()
                 spec_dict = object_details_dict.pop("spec", {})
                 assets = object_details_dict.pop("assets", {})
-                metadata = MarketplaceItemMetadata(
+                metadata = mlrun.common.schemas.hub.HubItemMetadata(
                     tag=version_tag, **object_details_dict
                 )
                 item_uri = source.get_full_uri(metadata.get_relative_path())
-                spec = MarketplaceItemSpec(
+                spec = mlrun.common.schemas.hub.HubItemSpec(
                     item_uri=item_uri, assets=assets, **spec_dict
                 )
-                item = MarketplaceItem(
+                item = mlrun.common.schemas.hub.HubItem(
                     metadata=metadata,
                     spec=spec,
-                    status=ObjectStatus(),
+                    status=mlrun.common.schemas.ObjectStatus(),
                 )
                 catalog.catalog.append(item)
 
         return catalog
 
     def get_source_catalog(
         self,
-        source: MarketplaceSource,
+        source: mlrun.common.schemas.hub.HubSource,
         version: Optional[str] = None,
         tag: Optional[str] = None,
         force_refresh: bool = False,
-    ) -> MarketplaceCatalog:
+    ) -> mlrun.common.schemas.hub.HubCatalog:
         """
         Getting the catalog object by source.
         If version and/or tag are given, the catalog will be filtered accordingly.
 
-        :param source:          Marketplace source object.
+        :param source:          Hub source object.
         :param version:         version of items to filter by
         :param tag:             tag of items to filter by
         :param force_refresh:   if True, the catalog will be loaded from source always,
                                 otherwise will be pulled from db (if loaded before)
         :return: catalog object
         """
         source_name = source.metadata.name
@@ -202,44 +200,46 @@
             catalog_data = mlrun.run.get_object(url=url, secrets=credentials)
             catalog_dict = json.loads(catalog_data)
             catalog = self._transform_catalog_dict_to_schema(source, catalog_dict)
             self._catalogs[source_name] = catalog
         else:
             catalog = self._catalogs[source_name]
 
-        result_catalog = MarketplaceCatalog(catalog=[], channel=source.spec.channel)
+        result_catalog = mlrun.common.schemas.hub.HubCatalog(
+            catalog=[], channel=source.spec.channel
+        )
         for item in catalog.catalog:
             # Because tag and version are optionals,
             # we filter the catalog by one of them with priority to tag
             if (tag is None or item.metadata.tag == tag) and (
                 version is None or item.metadata.version == version
             ):
                 result_catalog.catalog.append(item)
 
         return result_catalog
 
     def get_item(
         self,
-        source: MarketplaceSource,
+        source: mlrun.common.schemas.hub.HubSource,
         item_name: str,
         version: Optional[str] = None,
         tag: Optional[str] = None,
         force_refresh: bool = False,
-    ) -> MarketplaceItem:
+    ) -> mlrun.common.schemas.hub.HubItem:
         """
         Retrieve item from source. The item is filtered by tag and version.
 
-        :param source:          Marketplace source object
+        :param source:          Hub source object
         :param item_name:       name of the item to retrieve
         :param version:         version of the item
         :param tag:             tag of the item
         :param force_refresh:   if True, the catalog will be loaded from source always,
                                 otherwise will be pulled from db (if loaded before)
 
-        :return: marketplace item object
+        :return: hub item object
 
         :raise if the number of collected items from catalog is not exactly one.
         """
         catalog = self.get_source_catalog(source, version, tag, force_refresh)
         items = self._get_catalog_items_filtered_by_name(catalog.catalog, item_name)
         num_items = len(items)
 
@@ -252,28 +252,30 @@
                 "Query resulted in more than 1 catalog items. "
                 + f"source={item_name}, version={version}, tag={tag}"
             )
         return items[0]
 
     @staticmethod
     def _get_catalog_items_filtered_by_name(
-        catalog: List[MarketplaceItem],
+        catalog: List[mlrun.common.schemas.hub.HubItem],
         item_name: str,
-    ) -> List[MarketplaceItem]:
+    ) -> List[mlrun.common.schemas.hub.HubItem]:
         """
         Retrieve items from catalog filtered by name
 
         :param catalog:     list of items
         :param item_name:   item name to filter by
 
         :return:   list of item objects from catalog
         """
         return [item for item in catalog if item.metadata.name == item_name]
 
-    def get_item_object_using_source_credentials(self, source: MarketplaceSource, url):
+    def get_item_object_using_source_credentials(
+        self, source: mlrun.common.schemas.hub.HubSource, url
+    ):
         credentials = self._get_source_credentials(source.metadata.name)
 
         if not url.startswith(source.spec.path):
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "URL to retrieve must be located in the source filesystem tree"
             )
 
@@ -285,23 +287,23 @@
             }
         else:
             catalog_data = mlrun.run.get_object(url=url, secrets=credentials)
         return catalog_data
 
     def get_asset(
         self,
-        source: MarketplaceSource,
-        item: MarketplaceItem,
+        source: mlrun.common.schemas.hub.HubSource,
+        item: mlrun.common.schemas.hub.HubItem,
         asset_name: str,
     ) -> Tuple[bytes, str]:
         """
-        Retrieve asset object from marketplace source.
+        Retrieve asset object from hub source.
 
-        :param source:      marketplace source
-        :param item:        marketplace item which contains the assets
+        :param source:      hub source
+        :param item:        hub item which contains the assets
         :param asset_name:  asset name, like source, example, etc.
 
         :return: tuple of asset as bytes and url of asset
         """
         credentials = self._get_source_credentials(source.metadata.name)
         asset_path = self._get_asset_full_path(source, item, asset_name)
         return (
```

## Comparing `mlrun/api/schemas/auth.py` & `mlrun/common/schemas/auth.py`

 * *Files 3% similar despite different names*

```diff
@@ -14,36 +14,36 @@
 #
 import typing
 
 import pydantic
 from nuclio.auth import AuthInfo as NuclioAuthInfo
 from nuclio.auth import AuthKinds as NuclioAuthKinds
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-class ProjectsRole(mlrun.api.utils.helpers.StrEnum):
+class ProjectsRole(mlrun.common.types.StrEnum):
     iguazio = "iguazio"
     mlrun = "mlrun"
     nuclio = "nuclio"
     nop = "nop"
 
 
-class AuthorizationAction(mlrun.api.utils.helpers.StrEnum):
+class AuthorizationAction(mlrun.common.types.StrEnum):
     read = "read"
     create = "create"
     update = "update"
     delete = "delete"
 
     # note that in the OPA manifest only the above actions exist, store is "an MLRun verb" an we internally map it to 2
     # query permissions requests - create and update
     store = "store"
 
 
-class AuthorizationResourceTypes(mlrun.api.utils.helpers.StrEnum):
+class AuthorizationResourceTypes(mlrun.common.types.StrEnum):
     project = "project"
     log = "log"
     runtime_resource = "runtime-resource"
     function = "function"
     artifact = "artifact"
     feature_set = "feature-set"
     feature_vector = "feature-vector"
@@ -52,15 +52,15 @@
     project_background_task = "project-background-task"
     background_task = "background-task"
     schedule = "schedule"
     secret = "secret"
     run = "run"
     model_endpoint = "model-endpoint"
     pipeline = "pipeline"
-    marketplace_source = "marketplace-source"
+    hub_source = "hub-source"
 
     def to_resource_string(
         self,
         project_name: str,
         resource_name: str,
     ):
         return {
@@ -81,16 +81,16 @@
             AuthorizationResourceTypes.schedule: "/projects/{project_name}/schedules/{resource_name}",
             AuthorizationResourceTypes.secret: "/projects/{project_name}/secrets/{resource_name}",
             AuthorizationResourceTypes.run: "/projects/{project_name}/runs/{resource_name}",
             # runtime resource doesn't have an identifier, we don't need any auth granularity behind project level
             AuthorizationResourceTypes.runtime_resource: "/projects/{project_name}/runtime-resources",
             AuthorizationResourceTypes.model_endpoint: "/projects/{project_name}/model-endpoints/{resource_name}",
             AuthorizationResourceTypes.pipeline: "/projects/{project_name}/pipelines/{resource_name}",
-            # Marketplace sources are not project-scoped, and auth is globally on the sources endpoint.
-            AuthorizationResourceTypes.marketplace_source: "/marketplace/sources",
+            # Hub sources are not project-scoped, and auth is globally on the sources endpoint.
+            AuthorizationResourceTypes.hub_source: "/hub/sources",
         }[self].format(project_name=project_name, resource_name=resource_name)
 
 
 class AuthorizationVerificationInput(pydantic.BaseModel):
     resource: str
     action: AuthorizationAction
```

## Comparing `mlrun/api/schemas/background_task.py` & `mlrun/common/schemas/background_task.py`

 * *Files 4% similar despite different names*

```diff
@@ -13,20 +13,20 @@
 # limitations under the License.
 #
 import datetime
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 from .object import ObjectKind
 
 
-class BackgroundTaskState(mlrun.api.utils.helpers.StrEnum):
+class BackgroundTaskState(mlrun.common.types.StrEnum):
     succeeded = "succeeded"
     failed = "failed"
     running = "running"
 
     @staticmethod
     def terminal_states():
         return [
```

## Comparing `mlrun/api/schemas/client_spec.py` & `mlrun/common/schemas/client_spec.py`

 * *Files identical despite different names*

## Comparing `mlrun/api/schemas/clusterization_spec.py` & `mlrun/common/schemas/clusterization_spec.py`

 * *Files 18% similar despite different names*

```diff
@@ -12,18 +12,18 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
 class ClusterizationSpec(pydantic.BaseModel):
     chief_api_state: typing.Optional[str]
     chief_version: typing.Optional[str]
 
 
-class WaitForChiefToReachOnlineStateFeatureFlag(mlrun.api.utils.helpers.StrEnum):
+class WaitForChiefToReachOnlineStateFeatureFlag(mlrun.common.types.StrEnum):
     enabled = "enabled"
     disabled = "disabled"
```

## Comparing `mlrun/api/schemas/constants.py` & `mlrun/common/schemas/constants.py`

 * *Files 10% similar despite different names*

```diff
@@ -10,34 +10,34 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import mergedeep
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 import mlrun.errors
 
 
-class PatchMode(mlrun.api.utils.helpers.StrEnum):
+class PatchMode(mlrun.common.types.StrEnum):
     replace = "replace"
     additive = "additive"
 
     def to_mergedeep_strategy(self) -> mergedeep.Strategy:
         if self.value == PatchMode.replace:
             return mergedeep.Strategy.REPLACE
         elif self.value == PatchMode.additive:
             return mergedeep.Strategy.ADDITIVE
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Unknown patch mode: {self.value}"
             )
 
 
-class DeletionStrategy(mlrun.api.utils.helpers.StrEnum):
+class DeletionStrategy(mlrun.common.types.StrEnum):
     restrict = "restrict"
     restricted = "restricted"
     cascade = "cascade"
     cascading = "cascading"
     check = "check"
 
     @staticmethod
@@ -93,39 +93,39 @@
     client_version = f"{headers_prefix}client-version"
     python_version = f"{headers_prefix}client-python-version"
     backend_version = f"{headers_prefix}be-version"
     ui_version = f"{headers_prefix}ui-version"
     ui_clear_cache = f"{headers_prefix}ui-clear-cache"
 
 
-class FeatureStorePartitionByField(mlrun.api.utils.helpers.StrEnum):
+class FeatureStorePartitionByField(mlrun.common.types.StrEnum):
     name = "name"  # Supported for feature-store objects
 
     def to_partition_by_db_field(self, db_cls):
         if self.value == FeatureStorePartitionByField.name:
             return db_cls.name
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Unknown group by field: {self.value}"
             )
 
 
-class RunPartitionByField(mlrun.api.utils.helpers.StrEnum):
+class RunPartitionByField(mlrun.common.types.StrEnum):
     name = "name"  # Supported for runs objects
 
     def to_partition_by_db_field(self, db_cls):
         if self.value == RunPartitionByField.name:
             return db_cls.name
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Unknown group by field: {self.value}"
             )
 
 
-class SortField(mlrun.api.utils.helpers.StrEnum):
+class SortField(mlrun.common.types.StrEnum):
     created = "created"
     updated = "updated"
 
     def to_db_field(self, db_cls):
         if self.value == SortField.created:
             # not doing type check to prevent import that will cause a cycle
             if db_cls.__name__ == "Run":
@@ -135,15 +135,15 @@
             return db_cls.updated
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Unknown sort by field: {self.value}"
             )
 
 
-class OrderType(mlrun.api.utils.helpers.StrEnum):
+class OrderType(mlrun.common.types.StrEnum):
     asc = "asc"
     desc = "desc"
 
     def to_order_by_predicate(self, db_field):
         if self.value == OrderType.asc:
             return db_field.asc()
         else:
```

## Comparing `mlrun/api/schemas/feature_store.py` & `mlrun/common/schemas/feature_store.py`

 * *Files identical despite different names*

## Comparing `mlrun/api/schemas/frontend_spec.py` & `mlrun/common/schemas/frontend_spec.py`

 * *Files 7% similar despite different names*

```diff
@@ -12,37 +12,37 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 from .k8s import Resources
 
 
-class ProjectMembershipFeatureFlag(mlrun.api.utils.helpers.StrEnum):
+class ProjectMembershipFeatureFlag(mlrun.common.types.StrEnum):
     enabled = "enabled"
     disabled = "disabled"
 
 
-class PreemptionNodesFeatureFlag(mlrun.api.utils.helpers.StrEnum):
+class PreemptionNodesFeatureFlag(mlrun.common.types.StrEnum):
     enabled = "enabled"
     disabled = "disabled"
 
 
-class AuthenticationFeatureFlag(mlrun.api.utils.helpers.StrEnum):
+class AuthenticationFeatureFlag(mlrun.common.types.StrEnum):
     none = "none"
     basic = "basic"
     bearer = "bearer"
     iguazio = "iguazio"
 
 
-class NuclioStreamsFeatureFlag(mlrun.api.utils.helpers.StrEnum):
+class NuclioStreamsFeatureFlag(mlrun.common.types.StrEnum):
     enabled = "enabled"
     disabled = "disabled"
 
 
 class FeatureFlags(pydantic.BaseModel):
     project_membership: ProjectMembershipFeatureFlag
     authentication: AuthenticationFeatureFlag
```

## Comparing `mlrun/api/schemas/function.py` & `mlrun/common/schemas/function.py`

 * *Files 6% similar despite different names*

```diff
@@ -12,18 +12,18 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-# Ideally we would want this to be class FunctionState(mlrun.api.utils.helpers.StrEnum) which is the
+# Ideally we would want this to be class FunctionState(mlrun.common.types.StrEnum) which is the
 # "FastAPI-compatible" way of creating schemas
 # But, when we save a function to the DB, we pickle the body, which saves the state as an instance of this class (and
 # not just a string), then if for some reason we downgrade to 0.6.4, before we had this class, we fail reading (pickle
 # load) the function from the DB.
 # Note that the problems are happening only if the state is assigned in the API side. When it's in the client side it
 # anyways passes through JSON in the HTTP request body and come up as a string in the API side.
 # For now I'm simply making the class a simple string consts class
@@ -42,28 +42,28 @@
     # map to deploying but for backwards compatibility reasons we have to keep them
     running = "running"
     pending = "pending"
     # same goes for the build which is not coming from the pod, but is used and we can't just omit it for BC reasons
     build = "build"
 
 
-class PreemptionModes(mlrun.api.utils.helpers.StrEnum):
+class PreemptionModes(mlrun.common.types.StrEnum):
     # makes function pods be able to run on preemptible nodes
     allow = "allow"
     # makes the function pods run on preemptible nodes only
     constrain = "constrain"
     # prevents the function pods from running on preemptible nodes
     prevent = "prevent"
     # doesn't apply any preemptible node selection on the function
     none = "none"
 
 
 # used when running in Iguazio (otherwise use disabled mode)
 # populates mlrun.mlconf.function.spec.security_context.enrichment_mode
-class SecurityContextEnrichmentModes(mlrun.api.utils.helpers.StrEnum):
+class SecurityContextEnrichmentModes(mlrun.common.types.StrEnum):
     # always use the user id of the user that triggered the 1st run / created the function
     # NOTE: this mode is incomplete and not fully supported yet
     retain = "retain"
     # use the user id of the user that triggered the current run
     override = "override"
     # security context is not auto applied
     disabled = "disabled"
```

## Comparing `mlrun/api/schemas/http.py` & `mlrun/common/schemas/http.py`

 * *Files 9% similar despite different names*

```diff
@@ -8,13 +8,13 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-class HTTPSessionRetryMode(mlrun.api.utils.helpers.StrEnum):
+class HTTPSessionRetryMode(mlrun.common.types.StrEnum):
     enabled = "enabled"
     disabled = "disabled"
```

## Comparing `mlrun/api/schemas/k8s.py` & `mlrun/common/schemas/k8s.py`

 * *Files 11% similar despite different names*

```diff
@@ -12,29 +12,29 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
 class ResourceSpec(pydantic.BaseModel):
     cpu: typing.Optional[str]
     memory: typing.Optional[str]
     gpu: typing.Optional[str]
 
 
 class Resources(pydantic.BaseModel):
     requests: ResourceSpec = ResourceSpec()
     limits: ResourceSpec = ResourceSpec()
 
 
-class NodeSelectorOperator(mlrun.api.utils.helpers.StrEnum):
+class NodeSelectorOperator(mlrun.common.types.StrEnum):
     """
     A node selector operator is the set of operators that can be used in a node selector requirement
     https://github.com/kubernetes/api/blob/b754a94214be15ffc8d648f9fe6481857f1fc2fe/core/v1/types.go#L2765
     """
 
     node_selector_op_in = "In"
     node_selector_op_not_in = "NotIn"
```

## Comparing `mlrun/api/schemas/memory_reports.py` & `mlrun/common/schemas/memory_reports.py`

 * *Files identical despite different names*

## Comparing `mlrun/api/schemas/model_endpoints.py` & `mlrun/common/schemas/model_endpoints.py`

 * *Files 6% similar despite different names*

```diff
@@ -16,16 +16,16 @@
 import json
 import typing
 from typing import Any, Dict, List, Optional, Tuple, Union
 
 from pydantic import BaseModel, Field
 from pydantic.main import Extra
 
-import mlrun.model_monitoring
-from mlrun.api.schemas.object import ObjectKind, ObjectSpec, ObjectStatus
+import mlrun.common.model_monitoring
+from mlrun.common.schemas.object import ObjectKind, ObjectSpec, ObjectStatus
 
 
 class ModelMonitoringStoreKinds:
     # TODO: do changes in examples & demos In 1.5.0 remove
     ENDPOINTS = "endpoints"
     EVENTS = "events"
 
@@ -44,15 +44,15 @@
 
         :param endpoint_dict:     Model endpoint dictionary.
         :param json_parse_values: List of dictionary keys with a JSON string value that will be parsed into a
                                   dictionary using json.loads().
         """
         new_object = cls()
         if json_parse_values is None:
-            json_parse_values = [mlrun.model_monitoring.EventFieldType.LABELS]
+            json_parse_values = [mlrun.common.model_monitoring.EventFieldType.LABELS]
 
         return _mapping_attributes(
             base_model=new_object,
             flattened_dictionary=endpoint_dict,
             json_parse_values=json_parse_values,
         )
 
@@ -65,31 +65,31 @@
     feature_names: Optional[List[str]] = []
     label_names: Optional[List[str]] = []
     stream_path: Optional[str] = ""
     algorithm: Optional[str] = ""
     monitor_configuration: Optional[dict] = {}
     active: Optional[bool] = True
     monitoring_mode: Optional[
-        mlrun.model_monitoring.ModelMonitoringMode
-    ] = mlrun.model_monitoring.ModelMonitoringMode.disabled.value
+        mlrun.common.model_monitoring.ModelMonitoringMode
+    ] = mlrun.common.model_monitoring.ModelMonitoringMode.disabled.value
 
     @classmethod
     def from_flat_dict(cls, endpoint_dict: dict, json_parse_values: typing.List = None):
         """Create a `ModelEndpointSpec` object from an endpoint dictionary
 
         :param endpoint_dict:     Model endpoint dictionary.
         :param json_parse_values: List of dictionary keys with a JSON string value that will be parsed into a
                                   dictionary using json.loads().
         """
         new_object = cls()
         if json_parse_values is None:
             json_parse_values = [
-                mlrun.model_monitoring.EventFieldType.FEATURE_NAMES,
-                mlrun.model_monitoring.EventFieldType.LABEL_NAMES,
-                mlrun.model_monitoring.EventFieldType.MONITOR_CONFIGURATION,
+                mlrun.common.model_monitoring.EventFieldType.FEATURE_NAMES,
+                mlrun.common.model_monitoring.EventFieldType.LABEL_NAMES,
+                mlrun.common.model_monitoring.EventFieldType.MONITOR_CONFIGURATION,
             ]
         return _mapping_attributes(
             base_model=new_object,
             flattened_dictionary=endpoint_dict,
             json_parse_values=json_parse_values,
         )
 
@@ -144,25 +144,25 @@
     current_stats: Optional[dict] = {}
     first_request: Optional[str] = ""
     last_request: Optional[str] = ""
     error_count: Optional[int] = 0
     drift_status: Optional[str] = ""
     drift_measures: Optional[dict] = {}
     metrics: Optional[Dict[str, Dict[str, Any]]] = {
-        mlrun.model_monitoring.EventKeyMetrics.GENERIC: {
-            mlrun.model_monitoring.EventLiveStats.LATENCY_AVG_1H: 0,
-            mlrun.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND: 0,
+        mlrun.common.model_monitoring.EventKeyMetrics.GENERIC: {
+            mlrun.common.model_monitoring.EventLiveStats.LATENCY_AVG_1H: 0,
+            mlrun.common.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND: 0,
         }
     }
     features: Optional[List[Features]] = []
     children: Optional[List[str]] = []
     children_uids: Optional[List[str]] = []
     endpoint_type: Optional[
-        mlrun.model_monitoring.EndpointType
-    ] = mlrun.model_monitoring.EndpointType.NODE_EP.value
+        mlrun.common.model_monitoring.EndpointType
+    ] = mlrun.common.model_monitoring.EndpointType.NODE_EP.value
     monitoring_feature_set_uri: Optional[str] = ""
     state: Optional[str] = ""
 
     class Config:
         extra = Extra.allow
 
     @classmethod
@@ -172,21 +172,21 @@
         :param endpoint_dict:     Model endpoint dictionary.
         :param json_parse_values: List of dictionary keys with a JSON string value that will be parsed into a
                                   dictionary using json.loads().
         """
         new_object = cls()
         if json_parse_values is None:
             json_parse_values = [
-                mlrun.model_monitoring.EventFieldType.FEATURE_STATS,
-                mlrun.model_monitoring.EventFieldType.CURRENT_STATS,
-                mlrun.model_monitoring.EventFieldType.DRIFT_MEASURES,
-                mlrun.model_monitoring.EventFieldType.METRICS,
-                mlrun.model_monitoring.EventFieldType.CHILDREN,
-                mlrun.model_monitoring.EventFieldType.CHILDREN_UIDS,
-                mlrun.model_monitoring.EventFieldType.ENDPOINT_TYPE,
+                mlrun.common.model_monitoring.EventFieldType.FEATURE_STATS,
+                mlrun.common.model_monitoring.EventFieldType.CURRENT_STATS,
+                mlrun.common.model_monitoring.EventFieldType.DRIFT_MEASURES,
+                mlrun.common.model_monitoring.EventFieldType.METRICS,
+                mlrun.common.model_monitoring.EventFieldType.CHILDREN,
+                mlrun.common.model_monitoring.EventFieldType.CHILDREN_UIDS,
+                mlrun.common.model_monitoring.EventFieldType.ENDPOINT_TYPE,
             ]
         return _mapping_attributes(
             base_model=new_object,
             flattened_dictionary=endpoint_dict,
             json_parse_values=json_parse_values,
         )
 
@@ -199,15 +199,15 @@
 
     class Config:
         extra = Extra.allow
 
     def __init__(self, **data: Any):
         super().__init__(**data)
         if self.metadata.uid is None:
-            uid = mlrun.model_monitoring.create_model_endpoint_uid(
+            uid = mlrun.common.model_monitoring.create_model_endpoint_uid(
                 function_uri=self.spec.function_uri,
                 versioned_model=self.spec.model,
             )
             self.metadata.uid = str(uid)
 
     def flat_dict(self):
         """Generate a flattened `ModelEndpoint` dictionary. The flattened dictionary result is important for storing
@@ -230,24 +230,24 @@
                 ):
                     flatten_dict[key] = json.dumps(
                         model_endpoint_dictionary[k_object][key]
                     )
                 else:
                     flatten_dict[key] = model_endpoint_dictionary[k_object][key]
 
-        if mlrun.model_monitoring.EventFieldType.METRICS not in flatten_dict:
+        if mlrun.common.model_monitoring.EventFieldType.METRICS not in flatten_dict:
             # Initialize metrics dictionary
-            flatten_dict[mlrun.model_monitoring.EventFieldType.METRICS] = {
-                mlrun.model_monitoring.EventKeyMetrics.GENERIC: {
-                    mlrun.model_monitoring.EventLiveStats.LATENCY_AVG_1H: 0,
-                    mlrun.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND: 0,
+            flatten_dict[mlrun.common.model_monitoring.EventFieldType.METRICS] = {
+                mlrun.common.model_monitoring.EventKeyMetrics.GENERIC: {
+                    mlrun.common.model_monitoring.EventLiveStats.LATENCY_AVG_1H: 0,
+                    mlrun.common.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND: 0,
                 }
             }
         # Remove the features from the dictionary as this field will be filled only within the feature analysis process
-        flatten_dict.pop(mlrun.model_monitoring.EventFieldType.FEATURES, None)
+        flatten_dict.pop(mlrun.common.model_monitoring.EventFieldType.FEATURES, None)
         return flatten_dict
 
     @classmethod
     def from_flat_dict(cls, endpoint_dict: dict):
         """Create a `ModelEndpoint` object from an endpoint flattened dictionary. Because the provided dictionary
         is flattened, we pass it as is to the subclasses without splitting the keys into spec, metadata, and status.
```

## Comparing `mlrun/api/schemas/notification.py` & `mlrun/common/schemas/notification.py`

 * *Files 21% similar despite different names*

```diff
@@ -9,22 +9,22 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-class NotificationSeverity(mlrun.api.utils.helpers.StrEnum):
+class NotificationSeverity(mlrun.common.types.StrEnum):
     INFO = "info"
     DEBUG = "debug"
     VERBOSE = "verbose"
     WARNING = "warning"
     ERROR = "error"
 
 
-class NotificationStatus(mlrun.api.utils.helpers.StrEnum):
+class NotificationStatus(mlrun.common.types.StrEnum):
     PENDING = "pending"
     SENT = "sent"
     ERROR = "error"
```

## Comparing `mlrun/api/schemas/object.py` & `mlrun/common/schemas/object.py`

 * *Files 17% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 # limitations under the License.
 #
 from datetime import datetime
 from typing import List, Optional
 
 from pydantic import BaseModel, Extra
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
 class ObjectMetadata(BaseModel):
     name: str
     project: Optional[str]
     tag: Optional[str]
     labels: Optional[dict] = {}
@@ -65,16 +65,16 @@
     state: Optional[str] = None
     full_object: Optional[dict] = None
 
     class Config:
         orm_mode = True
 
 
-class ObjectKind(mlrun.api.utils.helpers.StrEnum):
+class ObjectKind(mlrun.common.types.StrEnum):
     project = "project"
     feature_set = "FeatureSet"
     background_task = "BackgroundTask"
     feature_vector = "FeatureVector"
     model_endpoint = "model-endpoint"
-    marketplace_source = "MarketplaceSource"
-    marketplace_item = "MarketplaceItem"
-    marketplace_catalog = "MarketplaceCatalog"
+    hub_source = "HubSource"
+    hub_item = "HubItem"
+    hub_catalog = "HubCatalog"
```

## Comparing `mlrun/api/schemas/pipeline.py` & `mlrun/common/schemas/pipeline.py`

 * *Files 14% similar despite different names*

```diff
@@ -12,18 +12,18 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-class PipelinesFormat(mlrun.api.utils.helpers.StrEnum):
+class PipelinesFormat(mlrun.common.types.StrEnum):
     full = "full"
     metadata_only = "metadata_only"
     summary = "summary"
     name_only = "name_only"
 
 
 class PipelinesPagination(str):
```

## Comparing `mlrun/api/schemas/project.py` & `mlrun/common/schemas/project.py`

 * *Files 16% similar despite different names*

```diff
@@ -13,43 +13,46 @@
 # limitations under the License.
 #
 import datetime
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 from .object import ObjectKind, ObjectStatus
 
 
-class ProjectsFormat(mlrun.api.utils.helpers.StrEnum):
+class ProjectsFormat(mlrun.common.types.StrEnum):
     full = "full"
     name_only = "name_only"
+    # minimal format removes large fields from the response (e.g. functions, workflows, artifacts)
+    # and is used for faster response times (in the UI)
+    minimal = "minimal"
     # internal - allowed only in follower mode, only for the leader for upgrade purposes
     leader = "leader"
 
 
 class ProjectMetadata(pydantic.BaseModel):
     name: str
     created: typing.Optional[datetime.datetime] = None
     labels: typing.Optional[dict] = {}
     annotations: typing.Optional[dict] = {}
 
     class Config:
         extra = pydantic.Extra.allow
 
 
-class ProjectDesiredState(mlrun.api.utils.helpers.StrEnum):
+class ProjectDesiredState(mlrun.common.types.StrEnum):
     online = "online"
     offline = "offline"
     archived = "archived"
 
 
-class ProjectState(mlrun.api.utils.helpers.StrEnum):
+class ProjectState(mlrun.common.types.StrEnum):
     unknown = "unknown"
     creating = "creating"
     deleting = "deleting"
     online = "online"
     offline = "offline"
     archived = "archived"
```

## Comparing `mlrun/api/schemas/runtime_resource.py` & `mlrun/common/schemas/runtime_resource.py`

 * *Files 7% similar despite different names*

```diff
@@ -12,18 +12,18 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import typing
 
 import pydantic
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-class ListRuntimeResourcesGroupByField(mlrun.api.utils.helpers.StrEnum):
+class ListRuntimeResourcesGroupByField(mlrun.common.types.StrEnum):
     job = "job"
     project = "project"
 
 
 class RuntimeResource(pydantic.BaseModel):
     name: str
     labels: typing.Dict[str, str] = {}
```

## Comparing `mlrun/api/schemas/schedule.py` & `mlrun/common/schemas/schedule.py`

 * *Files 5% similar despite different names*

```diff
@@ -13,17 +13,17 @@
 # limitations under the License.
 #
 from datetime import datetime
 from typing import Any, List, Optional, Union
 
 from pydantic import BaseModel
 
-import mlrun.api.utils.helpers
-from mlrun.api.schemas.auth import Credentials
-from mlrun.api.schemas.object import LabelRecord
+import mlrun.common.types
+from mlrun.common.schemas.auth import Credentials
+from mlrun.common.schemas.object import LabelRecord
 
 
 class ScheduleCronTrigger(BaseModel):
     """
     See this link for help
     https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron
     """
@@ -74,15 +74,15 @@
     def to_crontab(self) -> str:
         """
         Convert the trigger to a crontab expression.
         """
         return f"{self.minute} {self.hour} {self.day} {self.month} {self.day_of_week}"
 
 
-class ScheduleKinds(mlrun.api.utils.helpers.StrEnum):
+class ScheduleKinds(mlrun.common.types.StrEnum):
     job = "job"
     pipeline = "pipeline"
 
     # this is mainly for testing purposes
     local_function = "local_function"
 
     @staticmethod
```

## Comparing `mlrun/api/schemas/secret.py` & `mlrun/common/schemas/secret.py`

 * *Files 5% similar despite different names*

```diff
@@ -12,18 +12,18 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from typing import Optional
 
 from pydantic import BaseModel, Field
 
-import mlrun.api.utils.helpers
+import mlrun.common.types
 
 
-class SecretProviderName(mlrun.api.utils.helpers.StrEnum):
+class SecretProviderName(mlrun.common.types.StrEnum):
     """Enum containing names of valid providers for secrets."""
 
     vault = "vault"
     kubernetes = "kubernetes"
 
 
 class SecretsData(BaseModel):
```

## Comparing `mlrun/api/schemas/tag.py` & `mlrun/common/schemas/tag.py`

 * *Files identical despite different names*

## Comparing `mlrun-1.4.0rc2.dist-info/LICENSE` & `mlrun-1.4.0rc3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mlrun-1.4.0rc2.dist-info/METADATA` & `mlrun-1.4.0rc3.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mlrun
-Version: 1.4.0rc2
+Version: 1.4.0rc3
 Summary: Tracking and config of machine learning runs
 Home-page: https://github.com/mlrun/mlrun
 Author: Yaron Haviv
 Author-email: yaronh@iguazio.com
 License: MIT
 Platform: UNKNOWN
 Classifier: Development Status :: 4 - Beta
@@ -37,27 +37,27 @@
 Requires-Dist: pyarrow (<12,>=10.0)
 Requires-Dist: pyyaml (~=5.1)
 Requires-Dist: requests (~=2.22)
 Requires-Dist: sqlalchemy (~=1.4)
 Requires-Dist: tabulate (~=0.8.6)
 Requires-Dist: v3io (~=0.5.20)
 Requires-Dist: pydantic (~=1.5)
-Requires-Dist: orjson (~=3.3)
+Requires-Dist: orjson (<3.8.12,~=3.3)
 Requires-Dist: alembic (~=1.9)
 Requires-Dist: mergedeep (~=1.3)
 Requires-Dist: v3io-frames (~=0.10.4)
 Requires-Dist: semver (~=2.13)
 Requires-Dist: dask (~=2021.11.2)
 Requires-Dist: distributed (~=2021.11.2)
 Requires-Dist: kubernetes (~=12.0)
 Requires-Dist: humanfriendly (~=8.2)
 Requires-Dist: fastapi (~=0.92.0)
 Requires-Dist: fsspec (~=2021.8.1)
 Requires-Dist: v3iofs (~=0.1.15)
-Requires-Dist: storey (~=1.3.18)
+Requires-Dist: storey (~=1.3.19)
 Requires-Dist: deepdiff (~=5.0)
 Requires-Dist: pymysql (~=1.0)
 Requires-Dist: inflection (~=0.5.0)
 Requires-Dist: python-dotenv (~=0.17.0)
 Requires-Dist: setuptools (~=65.5)
 Requires-Dist: deprecated (~=1.2)
 Provides-Extra: all
```

## Comparing `mlrun-1.4.0rc2.dist-info/RECORD` & `mlrun-1.4.0rc3.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,101 +1,107 @@
 mlrun/__init__.py,sha256=cCTbgyTFsXvEdaq1Cvwz8s8FE75YGIJKX58um-fnfFs,8727
-mlrun/__main__.py,sha256=7AXWZ6AYLQ1xGIHgrSnPORYU8ZERr3pHGsRdJpCxpHA,49967
-mlrun/builder.py,sha256=5YKq67e3nHlVtxW0Z9f6j86qnrhclHEvy8OxmlDVyJ4,24965
-mlrun/config.py,sha256=83S9K8pNvlIknMtpTNaVW0LGbFJ37qLtrF4CJHi6dtg,50570
+mlrun/__main__.py,sha256=ldnSoPg_S6Rt_P8z2yPalqHLE9Xn97eQ7ErtekjZpKA,49356
+mlrun/builder.py,sha256=C8-nJbfPQLAf1mkTpDhKkh1GH5_qZTya7ByQyDJZ1ZQ,25103
+mlrun/config.py,sha256=d61-Kq6OpTsNZoalbN_KHh1R9cXOGCtkRCEWWXeH90A,54803
 mlrun/errors.py,sha256=XEb1pxwy5Lzr9q0VT4z_SjP74jy37HFSmdd2hddWgvY,6780
 mlrun/execution.py,sha256=RMuw1D78GOWxDk3aQfFtFRZZ5maM4T7BiXaApoQA_6E,39096
 mlrun/features.py,sha256=pDUvV6HlkxZnUwW3lg7oq3vBwdcJQBprvdyGPNv57X8,15624
-mlrun/k8s_utils.py,sha256=fGObRopN5-7iS1TzIUzMVggN5-yb5wieLTDdesbhm-8,31688
+mlrun/k8s_utils.py,sha256=n-RgP564I5R08WAruGirDEssXCcVTlibOlWRV5TjmfI,4880
 mlrun/kfpops.py,sha256=fCq9kqsIO5six8AmHkiRLngyDclRymd7V6U5YXnX_ek,29645
 mlrun/lists.py,sha256=yOKwpS71Fua08sV825Anth8aaR9H5bHZyV544YbnXj4,8360
-mlrun/model.py,sha256=kxctSqX1Uqpy_YFd0kzMPppo5PamiM5o0sSd1JnADgk,53402
+mlrun/model.py,sha256=vZyeD1adOohG4E68wfQ1aDkerC7L-vvWY94kJ6CQNXQ,53415
 mlrun/render.py,sha256=983QAYawKTFlwXLpUwGC1gWEjUQUFxl1lo8bPQuXIA0,11828
-mlrun/run.py,sha256=ccokIwQ1yodQxVBieNl3x9GxDx-Ztsi3O6m0Lh9KCYs,64451
-mlrun/secrets.py,sha256=yboWaNO33RCXmopLL2bGCkDUbHuwJ7IgJaFv1lkoN_I,7731
+mlrun/run.py,sha256=pBnu7Ca4Ct4cUmGPvGvG_EeybJGwsM-XGBqSYFEfQzY,64472
+mlrun/secrets.py,sha256=xr-Omz0j5qjLGPCG_Gn2vsCP0CbqJldAAKpy5N1KAiM,7783
 mlrun/api/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
 mlrun/api/alembic.ini,sha256=oeSJRHwBbF3c3-N_RJilcZD-diq3F-oPv21gDIkrZGs,2105
 mlrun/api/constants.py,sha256=fyTQXJe4sx4GK8vZxklivgJgaSyOftk_NezGKA1J-mo,685
-mlrun/api/initial_data.py,sha256=Zj9Oan9Qeg45AOv8Dfg3Gvsymuz5cFR7zgLskuxUTFs,23530
-mlrun/api/main.py,sha256=1VtkWdILYXSY32i8DjO1Ost7_DrQN1tLO0CLTP9NWbo,26180
-mlrun/api/middlewares.py,sha256=VTW5VV7AGOigXf-ru2V3XSZzw_bMBr8j0uH2aMIGGfk,5235
+mlrun/api/initial_data.py,sha256=ehDC44xzihNSbjbn9daGAfPmo-S4vNbr7D3tOoTZKV8,23464
+mlrun/api/main.py,sha256=4u9h_vaYWnAK3Mps2f-7xBs_AptPxWWPy7XoTtZBXPg,26288
+mlrun/api/middlewares.py,sha256=D9d-3XudnhyK_J1EGdWexCCswiS4QuSWvhDvCH1LEEU,5247
 mlrun/api/api/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/api/api.py,sha256=suDQI8HL_zjtqaY7fBdm49SP73zJN2imdBiOh1hA4fQ,4267
-mlrun/api/api/deps.py,sha256=KTllUn0OHT-gGfnWPcz47QQwiHtxeHZBLEWMMbYWPBc,3143
-mlrun/api/api/utils.py,sha256=ia6xAEdGHwL2Z6t8jhI0_qFX4BeHz-qFxlnoe6vqR5s,36224
+mlrun/api/api/api.py,sha256=N5QgIWwnm-wgeW_8bUqVTtnRqgOUJGKDUGpScHHs78Y,4243
+mlrun/api/api/deps.py,sha256=OZt6UxT9Yg0O6egcB7a_YbZkKYkk5Vh9tTMKQKxW8nI,3197
+mlrun/api/api/utils.py,sha256=1E0wpW9SzDcU3KZK4Xzbv7BcTGxTTBZ8bH8OVBNg1yA,36432
 mlrun/api/api/endpoints/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/api/endpoints/artifacts.py,sha256=oGy-key8BmAUNWvCiOqAcatjV0pVd_0atcn8ZGftgjM,9458
-mlrun/api/api/endpoints/auth.py,sha256=8-vv61tPX_RFabJPPyXAWbSb8i3apcpbqJSs0GXINYM,1190
-mlrun/api/api/endpoints/background_tasks.py,sha256=qVLyyRLpW4TXLsDOGghLXFt1ugWvygcPhfcXMi1SRrg,3588
-mlrun/api/api/endpoints/client_spec.py,sha256=0NzHkmV9O4izIu2bu-NhgaXi_UfJxkfsbOV7XZhzMUM,1202
-mlrun/api/api/endpoints/clusterization_spec.py,sha256=ImsNfHpCmXI83WZqDdBGfw2Qkra00-Q7PcWbSgEiQXA,1160
-mlrun/api/api/endpoints/feature_store.py,sha256=NCstDeosECMVE_JVjFJoL_XWY14ffDOCuZG6XQXwXTo,28813
-mlrun/api/api/endpoints/files.py,sha256=w412iL7Al7VHi_jJUvThyraO5hyWLrXG85iw10PVJx4,6065
-mlrun/api/api/endpoints/frontend_spec.py,sha256=nr4EC25MbXCIDCWQaLD93saVB8cZg3R2UOUePx8xQ7U,5690
-mlrun/api/api/endpoints/functions.py,sha256=dOTy57CyTSqFI7mOB7utl8JUG7pR9idQn18h7P2NUkM,33894
-mlrun/api/api/endpoints/grafana_proxy.py,sha256=NFgIpoxIXAmI_3bKXTNvC0Z0wEu7WcqsBH3zqfhbyZo,5798
-mlrun/api/api/endpoints/healthz.py,sha256=3UHtyOFBgUooSmpWGiErav3_yJh1ZrgGrtPEmBZGWrM,1335
-mlrun/api/api/endpoints/logs.py,sha256=1a73ZwNNMDZaaYRqFbL3XZ6OrK3dKCpQI7HC-QJxI78,2429
-mlrun/api/api/endpoints/marketplace.py,sha256=FdgtlvewBVGJ6F5IFlffU6Q8eoVIgcxe82rjbnVRX34,10035
-mlrun/api/api/endpoints/model_endpoints.py,sha256=vlKqhQUJZISBWujGT3BQLWQD0aVyihrMcl8Fb-W8PXo,15724
-mlrun/api/api/endpoints/operations.py,sha256=Fxtp2jY3dlgzYG-2vm1AqNnpxQ-7WaJuibyKX569stg,3700
-mlrun/api/api/endpoints/pipelines.py,sha256=wV3ZvX7LPgb6bBsryXHXkwiiX_oxpK-Cwskj88W3KyE,9099
-mlrun/api/api/endpoints/projects.py,sha256=lFHvfDeeKdNIZ-DhmGKRSqQOuQuOWLu8a0uNay2tyDA,11392
-mlrun/api/api/endpoints/runs.py,sha256=WyMFtZKU79BhkYwcOyejXyK9D_YX7U7bc7fZwRBUxm0,9076
-mlrun/api/api/endpoints/runtime_resources.py,sha256=Eer8nrP8Hh0y-pXkYr0dOXL7wjw4leE9Q-cxOMdIw08,8988
-mlrun/api/api/endpoints/schedules.py,sha256=Yw3tZNnjfZBgwS-Rsx-i8i8dzi-UNsbfNNvja8eN41I,10579
-mlrun/api/api/endpoints/secrets.py,sha256=l6IzLPMEJr_e7wrTNxLQIn-x8LGBlxeV7diYSAD55t4,6057
-mlrun/api/api/endpoints/submit.py,sha256=mBizUlqKn0lc8YkrB0qVKAhLxF5Mg2Nz_0R_CGsehYA,5265
-mlrun/api/api/endpoints/tags.py,sha256=bnsWCKoOUnVHL42qqUzbXvs8gdmfT-8kcGwiT1svJcY,4843
+mlrun/api/api/endpoints/artifacts.py,sha256=FQOa8trbO53b4w864VFU5kyd4AlaRdU5LdUMUrchJhA,9545
+mlrun/api/api/endpoints/auth.py,sha256=YmcYs5pl8Il4jKDVjUGH_S5VXzam06kweO_xXpdSyeg,1199
+mlrun/api/api/endpoints/background_tasks.py,sha256=EQ5zvps1mXaVoNeoyOwMmRTAp0_nwpXtFAItvTA6uo4,3618
+mlrun/api/api/endpoints/client_spec.py,sha256=2hzm_Sq9JyPTfWgaKIjN_vGQX3xLnCScUpuoQjm3NU4,1214
+mlrun/api/api/endpoints/clusterization_spec.py,sha256=eBQya6jeYYBEe7WoCMNmXbkDxgmeDP5DCISGCZ4eAio,1175
+mlrun/api/api/endpoints/feature_store.py,sha256=_tq5xFLvhc0xolrtrrVS95p-m0j13QrmbOTqocWRg5w,29675
+mlrun/api/api/endpoints/files.py,sha256=v_FwFb-29mqDlx2tI8D9VUHthyjnmUpGsWTnfVZR7cE,6104
+mlrun/api/api/endpoints/frontend_spec.py,sha256=Axr4a9LS51mv6dNHe6P5-OfczGa_mcI3Xg5AY_a27hk,5729
+mlrun/api/api/endpoints/functions.py,sha256=zEyPB7mqAmDBlIS9qjnw1ctl4KVXnKD3XDd9NgL1eMI,34608
+mlrun/api/api/endpoints/grafana_proxy.py,sha256=3tqafsudGF9Ru3VjZCRsXZuoLIEmIWnYJEQaIYWrqjg,5986
+mlrun/api/api/endpoints/healthz.py,sha256=rp_esZLesf92tiaFM_E50LR0m_EbsdZxuudYNMG9VVU,1344
+mlrun/api/api/endpoints/hub.py,sha256=D3hiBs4hYAjtqt6CTigM8kcQLT_Wkf0Gh_dAxTO8DEk,10399
+mlrun/api/api/endpoints/logs.py,sha256=CXKdbcQtEth2tqr8I6dEWVpb3kZjL7BNdlDHwNsDQ_s,2450
+mlrun/api/api/endpoints/model_endpoints.py,sha256=qeKxuocrubBARRu_EvHCIHly7WVgLrjMcHCjCpEmbi4,15817
+mlrun/api/api/endpoints/operations.py,sha256=lnfvQmZIcj1z6TgxCy5Tx5x7PiNls3DgE3Yzddvo-9Q,3756
+mlrun/api/api/endpoints/pipelines.py,sha256=eU0D_RFw6KYyL6hYuPjHfaIkXQ4_5u_ZTBxC3lSfJ1g,9220
+mlrun/api/api/endpoints/projects.py,sha256=sI1dYHBnBWjxqJqOVgRjs2bXML2SKfu8k6yE-2sHBPs,11494
+mlrun/api/api/endpoints/runs.py,sha256=3S6RdIsnMVfMMyT1cDyliWqNcd0xnKjbMsDrT3UBTFM,9151
+mlrun/api/api/endpoints/runtime_resources.py,sha256=YovL4c29KJOyln5xAdfJwv_XQEbzH3AmUVoAwkNW0T0,9063
+mlrun/api/api/endpoints/schedules.py,sha256=Ozke4eWnAAFMOmI9qsSNNKZHY9Rz0YvvkwzShzIQ42k,10731
+mlrun/api/api/endpoints/secrets.py,sha256=GHxl-w4TUq28kHp8HR9jHbgjnp4LtDpiKwfQufTJ800,6061
+mlrun/api/api/endpoints/submit.py,sha256=loLzF5p5L7Wu5R2TnuPNNtwxTN1WIg_ei0ZdoCoMRDI,5298
+mlrun/api/api/endpoints/tags.py,sha256=kWEIdg9QvmX4pQOyYUQsBlzMVqGsluioDkKBNwWDgX4,4894
 mlrun/api/api/endpoints/internal/__init__.py,sha256=Lq7QbwU5hFGCq6hzU28fA5t1soMesi7DVo99T21blU8,1203
 mlrun/api/api/endpoints/internal/config.py,sha256=kXnraXbXv029QZMMEjwvhsUWof69wTvFBLcRyB32JFc,1043
-mlrun/api/api/endpoints/internal/memory_reports.py,sha256=k9cA6NhvAPfA-CYRubpjSrhsHJ7Ig_wTFMIMTEZxS4E,1709
-mlrun/api/crud/__init__.py,sha256=2ea5kCz3AGmRX2uRHCv2oRRIWX4LL0j7RPn8BVKjcTA,1225
-mlrun/api/crud/artifacts.py,sha256=p-CJZKokYwy2ej0K2vEp5EEy5xM-FD7ytSWMHBd7J9Y,5433
-mlrun/api/crud/client_spec.py,sha256=VapHAcFSKCmBq7AarJkpwoHns6fXLJ-VCEQcBuBczmU,7341
-mlrun/api/crud/clusterization_spec.py,sha256=wf9uiLb3DRwegDGlRu-dgfahoyp51bxtAuB8TEnklfc,1049
-mlrun/api/crud/feature_store.py,sha256=SAWhliY9UJAQbaJYKb7CmXTuVbovq3fDl-_5-RMxfxI,18449
-mlrun/api/crud/functions.py,sha256=pqCTL7rsHawfynV6DfqRrWKhnWxw1MNHJhLY_og6cJo,3550
-mlrun/api/crud/logs.py,sha256=r5JWMAtmxA9kIQ0RCi-DZG7njyh9GbmHL-2w_hu-r9M,9578
-mlrun/api/crud/marketplace.py,sha256=zS0rQexzKNA2Lhjfao2H_-O4fpzLqSD827x46E8qh8o,11769
+mlrun/api/api/endpoints/internal/memory_reports.py,sha256=plNcfWD6LgZTAA_3T-vXDPKvoojXFN7L9g6uDVylBLA,1724
+mlrun/api/crud/__init__.py,sha256=uIwvg_fG3qljOheF5QeY2yLt3601YWaabhb0-eb_hQw,1209
+mlrun/api/crud/artifacts.py,sha256=aoOmrXCGqNCA9b39cQbPojmRXK6qKAaX9WlZjdduaaA,5610
+mlrun/api/crud/client_spec.py,sha256=3Xif0Od3-zqb3Ptd3BInjg6rKhNLlJyIU38CF3efZ58,7331
+mlrun/api/crud/clusterization_spec.py,sha256=GBvK-rCVTJFBfstvFp2wJAOQWKc370ysuPFGm1rqwJg,1055
+mlrun/api/crud/feature_store.py,sha256=0XGBGuPiG8IStGmQroIOC18KtrpRXnnOyo3MqrHuLGY,18628
+mlrun/api/crud/functions.py,sha256=HHCpT9Rbn-kl5o2m12JOSEXovq23Vx_gBjjpbim7g8c,3556
+mlrun/api/crud/hub.py,sha256=rcTgrmV5-iqRLvBzjjNEolEiw7anoWizhx6neEL5eco,12025
+mlrun/api/crud/logs.py,sha256=_iKAt9deN5cNVJ8FqSb7Je0392p0YAccQUKMpnwZqRA,9729
 mlrun/api/crud/notifications.py,sha256=aEIx2ByVQzHxdmjePiYXxzUpZA1yZ8YXhR-nvIbet3o,2751
-mlrun/api/crud/pipelines.py,sha256=aW0RDWAyzK0vnCzyuVLEHDsW-MY-Cy5RvvuqbUhh6ow,13982
-mlrun/api/crud/projects.py,sha256=uLLSMZD0Z8BLkm2naHdNyZK1XyF51IAGVqWN6ydI_9Y,13326
-mlrun/api/crud/runs.py,sha256=Vi6RshVl9RWYef8xPdPcpnx-Vw8SzSXanqlERrtXUpQ,6005
-mlrun/api/crud/runtime_resources.py,sha256=XJRxzrh0NKKBqQq-wXAXFTxWkEMqAX_t3buJsVYOfT8,5539
-mlrun/api/crud/secrets.py,sha256=SvaOsSFfnk4OKGr-hXTv34XRoR7SOpdLbCxElgW9dVo,19921
-mlrun/api/crud/tags.py,sha256=TKi6u--McIdmcFEXNrbwgsX5wAaENil7FVwi8mnKqok,3265
+mlrun/api/crud/pipelines.py,sha256=wDGPUmEq7slXkW2aOyNiq_x1aSaz0kl9xC71NUnmF20,14030
+mlrun/api/crud/projects.py,sha256=h9695fNAmZ9MnhDdbOhS0ljG1cgm8XiGMiq1K-Cl7tg,14269
+mlrun/api/crud/runs.py,sha256=Eteb7eN0pk7ep1L9JUFCg5KOCtZyu0mBSElZDzD1UNY,6020
+mlrun/api/crud/runtime_resources.py,sha256=aJoWA1aInheitsLw02Fi7ohYPKTrk4pWXck7NwZF1yA,5575
+mlrun/api/crud/secrets.py,sha256=5eTyi3b8p398Y1yzX7NbbFJbXScEEDagA0tmbRGX9fY,20145
+mlrun/api/crud/tags.py,sha256=FEu6E0Srp7886ICAQfccf4h0ssHyvYP7-kSpB_oa9yE,3277
 mlrun/api/crud/model_monitoring/__init__.py,sha256=CAW_Xhm94IVid0yos0tLQUd_UdCRYz-_2s_rAloZEZw,722
-mlrun/api/crud/model_monitoring/grafana.py,sha256=uyZOa7KsqCkDWdfcWnV8xg2vlrzmPOQX_rbQq2X9bZ0,14943
-mlrun/api/crud/model_monitoring/model_endpoints.py,sha256=VOpm83yvmgycy-pKzin3CcixgDVOFpitqJHE80RLICQ,40998
+mlrun/api/crud/model_monitoring/grafana.py,sha256=peEPjIsu0xvGPEdRis4c16n5m3-jxa8lbqgwCiGNu2s,15692
+mlrun/api/crud/model_monitoring/model_endpoints.py,sha256=8W77_N0h-Uq130W7tlLtTkh4fMH9-ofOBcQiZTFXTpM,43000
+mlrun/api/crud/runtimes/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
+mlrun/api/crud/runtimes/nuclio/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
+mlrun/api/crud/runtimes/nuclio/function.py,sha256=fEqGrM0yyyq8urUxzFcG43-m3txF-Oyxdhm6e4DCB4w,17168
+mlrun/api/crud/runtimes/nuclio/helpers.py,sha256=E3ThgKBZyPa-VVWv3rTRtQAdR9lIVLkYz8_hfyntocA,11398
 mlrun/api/db/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/db/base.py,sha256=Cxseet80T_PPFxKA29vNGsMP7x1L3Y3FPU1LP38vTCw,14365
+mlrun/api/db/base.py,sha256=ETSlJ24N0s63dLpDS5yVo7vFg3ap-ySwhaKyCOcqUZo,15056
 mlrun/api/db/init_db.py,sha256=5WSrojwOh79O3guN_7IEi9wjqzKj3H74DU2xbGtrElk,870
 mlrun/api/db/session.py,sha256=_5DVL4YyGGFG9sbtHx_Bq2C1aHrZC5V8MS7TJfNeWIk,993
 mlrun/api/db/sqldb/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/db/sqldb/db.py,sha256=C4NUyVn5e1VR_N4sgfe8WPSD16P62zAsUY7t9jB9Lpg,142645
+mlrun/api/db/sqldb/db.py,sha256=SKS7gmnbFl1_8ssu_Q9AvzNWzBi_VCrnQvGVay-24Lw,144042
 mlrun/api/db/sqldb/helpers.py,sha256=j8VK-l_qZ5vLUjGkFK3D3fBgDgPmi-U8hU1MkMIAhC0,2340
 mlrun/api/db/sqldb/session.py,sha256=97QcZc7EOhypk3ZMl0F5k1ogsgK834S3SxCj3UNry-s,2542
 mlrun/api/db/sqldb/models/__init__.py,sha256=0cHZKMpzqkC6u3WGPEYE8zPcahY6KxBrK2pwkzTCCME,1063
-mlrun/api/db/sqldb/models/models_mysql.py,sha256=ZRerU-oWljKFkzXZ7nTb22y-qWpX_RXxvDH_gFhcbK4,20624
-mlrun/api/db/sqldb/models/models_sqlite.py,sha256=uMUkomR_YOa7d14g2XZcaIGtq1OlQ_fqkbOG9MbcVfE,18286
+mlrun/api/db/sqldb/models/models_mysql.py,sha256=zyFuS_tj6legl1QvJ5QBrLIgilAnDcZHSvHC-bXMqdQ,20642
+mlrun/api/db/sqldb/models/models_sqlite.py,sha256=10IzVBZ79Yj1vqFbWCocZ5QNrz1H91HzlzUFe6iu31k,18304
 mlrun/api/migrations_mysql/env.py,sha256=U5Fu1WLV5vggRYy4sa7d1ItJr1H3-T71BnkOw4ZjWIs,2906
+mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py,sha256=kcdNEMQHbTRGpzh4CfLlUJtClG_eHo-X0QNPOQEFBuI,1203
 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py,sha256=MF0DwcRcbyRXdWNeWieEWIu5zMpxZ5IQPmF__werbkU,4614
 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py,sha256=BthqApYJLuzuHZEJfrOaERD8M-2FRGsZ3e5tRFvMk78,1936
 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py,sha256=AuFHglUWD_ibU301xio--zcodAJ9yeGqbc8XFQ3zGGw,1909
 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py,sha256=jlQ40Yqcasyqu4qaetGxoY-DCn-GfWpU-K_Tb9zJVxo,1415
 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py,sha256=1U5dpO6k_SLNZ0MAd5AukDddcxp8eCUTEx-2o3b_U9k,1504
 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py,sha256=lppZKpOBbGoyzP855Q8Y5hWfcqCzCjOlz-FefAqenUQ,1649
 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py,sha256=CGh1ihmMJ4GNpDXNoiB9ksSe1P7PyrV3NqWTiq6GTIg,24057
 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py,sha256=IU4QdjJrnqJK-fzf5SL3mtpXduTxieoog_HH9aahq3M,2457
 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py,sha256=18_SGHfgvNE6TcjsP2_bmqAjL3YI70B0J5-NojmxRr4,1351
 mlrun/api/migrations_sqlite/env.py,sha256=U5Fu1WLV5vggRYy4sa7d1ItJr1H3-T71BnkOw4ZjWIs,2906
 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py,sha256=Kp1VTDMqS72UMODn1GboBo-IwUEZ8IWuflxrBTbATj0,11473
 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py,sha256=w_l46X5Sl53fkku0t4lqmHtEkU_t9A8-lniMM9USknI,1348
 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py,sha256=7PxARbyyFR1SlNHwTT5D41GpDGjd8b0zSSkYI4TtYmg,5180
+mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py,sha256=Qrbj5JA3pTfEDHgIoyCjMX5yMlXVkuWUcvQ9FIMrc8U,2595
 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py,sha256=r0svJ5DsE633B2ss1yWwv50lPMjtSIMsKYOPvfCPBfo,1388
 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py,sha256=pJqfbcEjG7I8yacspyFnbBZvVVpJ4mPLXc4VcJ8X1oQ,1767
 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py,sha256=3Q_PnbBjaD-04YfjH2MW4IUocOWVUfa-a1_Y-snzBHA,1360
 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py,sha256=cNFtnxsL4tTnfZiEo3uhATcqmgU6aqh2jEf521G0jH8,1259
 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py,sha256=Lth-_bXTG-8l-vUi_YxwfWdMVC6aJAKVHQnQ609GmsQ,2147
 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py,sha256=Q7KfNsbnnPWhXUnLMmbGFZIaItOS_Hvr2bY_td-K3vw,1482
 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py,sha256=1indyv5TlsDK4haAC9xxNznRjXgqjNIjgfFOakgBpNo,1892
@@ -103,116 +109,120 @@
 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py,sha256=A5aBWsOuCzs5cZrPiWO9ha26-N3JvzwsaI6wgOarHjY,1420
 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py,sha256=icsKlQUC9lJkpdu0RbDpl3L1MMk3Bwb8pzCXZKO9xcw,2034
 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py,sha256=po2-IqIvS4pSY8Bw02q6ZEucjEnkXdH5UDudGVC-5S8,1828
 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py,sha256=9oGlxz4o7BlZbykO3zzedHqzOEoPnvPPeWMLxyRCBnY,1380
 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py,sha256=lQ0lPq6xZD59iupkbAo0wCV-otE0G9lmjEpqIBZEguA,1831
 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py,sha256=AWkrtG6jWOMJHyLqR8jrmbp95Fk9qB6qhjjYLb1mezo,3936
 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py,sha256=KrIm5pHwHlJr5e3DdtMcBiEjgbopOniWzDi9T1XTSHQ,2588
-mlrun/api/schemas/__init__.py,sha256=XwgaWHdXLIASbqnw7YPEfW43AO6PmHxJbzXaBZY7VzA,4029
-mlrun/api/schemas/artifact.py,sha256=gpAdViV_3TQ-W2KPPNvdOArEfQZdd427YUW9bml9vE4,2070
-mlrun/api/schemas/auth.py,sha256=9MnT6Ckuy8_kAI7edsAqwN9-wp3noh5xZlL40utYXqA,5311
-mlrun/api/schemas/background_task.py,sha256=RayGDZ3_KYCYVx-n7CgMNDQJQp78ajrb5unQW6wFzhU,1563
-mlrun/api/schemas/client_spec.py,sha256=bQhGYtkcJg27yo82y3FNiiNZbYuwWce8SQxcXtVKJpg,2751
-mlrun/api/schemas/clusterization_spec.py,sha256=QmQ95NFgRuKCZZYCQFCpQGa-rutxY7wAjJI7tVS8Oc4,898
-mlrun/api/schemas/constants.py,sha256=JmIZGD2R1qjJIRk5fHNEFTVLw-6eh4cJ0FCP8i1r6xI,6278
-mlrun/api/schemas/feature_store.py,sha256=kX3Wd107ZfyGrDOcNmLEcgdVrFgtHTswzVhmH6VVWX4,3671
-mlrun/api/schemas/frontend_spec.py,sha256=-kYKekdyrUAx-dOhhyvhh54y-KWV3bGfFAxqJQ3jmiw,2571
-mlrun/api/schemas/function.py,sha256=5Iy0aZYwXw9_vLSPBUwhuD_YMuQn95_11oX7DSTFIeo,3991
-mlrun/api/schemas/http.py,sha256=q9l7LBK1pIWlax2gHK9rPQfeugHjBMUrLDWAxdGxUII,715
-mlrun/api/schemas/k8s.py,sha256=R6Ufggp8MqA0lQ68AMsh_qiRcbsovaWKJg1a40XzcZg,1405
-mlrun/api/schemas/marketplace.py,sha256=fpvHrAkmtpJEu4-6UNtnvSQz_Rrb87en5VBMvLZFPok,4592
-mlrun/api/schemas/memory_reports.py,sha256=SlNJ-uya5RywEysm_IZMwF1t4j-zYsjOj8oPYwLRO08,920
-mlrun/api/schemas/model_endpoints.py,sha256=j1U0bqYSv_ytjsQ7ZM0qEk4ebUdk-1Yks3h9dNEJijo,12343
-mlrun/api/schemas/notification.py,sha256=sCVgEsQUWANr4zxXtvTjS2lve8eaTKv3me7dy5zLoDI,894
-mlrun/api/schemas/object.py,sha256=bLMt30Kgch6_4Q_KML68NerU_HuTqW8K-4LUc8KfyVc,1965
-mlrun/api/schemas/pipeline.py,sha256=qT-4NW2vOXmLGxwbGhSPbmDRoeoOhCA2I-j52pop4dU,1194
-mlrun/api/schemas/project.py,sha256=EhGRhSa_Pzzy8cxl_vtu93v2bydX9VHo12rM5rCSeOY,3935
-mlrun/api/schemas/runtime_resource.py,sha256=r4Inv2-ujfgpuYsp0e82A8MM-jdt0pJjD-oKWDNwlz0,1646
-mlrun/api/schemas/schedule.py,sha256=RlHpjOaoiKn15DZkwCLZIBW9g8ArBKUhoTaCBlpx768,4192
-mlrun/api/schemas/secret.py,sha256=xdzAG8JCJVGy4f-qzcLH23uq4eNIuGePLdZPPFhunXs,1494
-mlrun/api/schemas/tag.py,sha256=x7l-nxJyjxqupu6-3CQLh_r6mD5-EST3KM-WyuTH-DM,919
+mlrun/api/schemas/__init__.py,sha256=JEimO9A93JbrxJQkJRDUNw4kAKyShmaD5McKulw3ykY,13338
 mlrun/api/utils/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
 mlrun/api/utils/asyncio.py,sha256=E80efqnDt-rRLVqbdjlzHjfe5SNwB4Krn1Y9D0C0JMg,1092
-mlrun/api/utils/background_tasks.py,sha256=esLg3Abfozpbc1wBa4RY5_jSLLD6TLvhIMixTixsNRQ,7302
-mlrun/api/utils/helpers.py,sha256=MHtJ6HICTIsTX6jH5D5FCz3P-uYBQ-nmCNft6gbT73s,2413
+mlrun/api/utils/background_tasks.py,sha256=4FIdUB2rDJDb7bndMZIr1kQeWPDi9_loHHsjaVMq5Ys,7371
+mlrun/api/utils/helpers.py,sha256=kQglUe_oaTFll4LhHNg1pwkAkiynzFWowiQlWXc4_7U,2431
 mlrun/api/utils/memory_reports.py,sha256=Diraa4EbJJ28NGrfSuOuGroVsE2sNeRkjUp7Dl4qDlI,3728
 mlrun/api/utils/periodic.py,sha256=Vc8jz2WIsItkb7rcmdtxUfD4-Pohlg_XVbLEUw0S394,2599
-mlrun/api/utils/scheduler.py,sha256=gSPQqOECd2XSpyiDCu2ru4Vy6zxcKUOagVvqlFcEfi4,38822
+mlrun/api/utils/scheduler.py,sha256=5reTxTtKdQE4wJymnTemQmM8AJ3lvL8fEMeVWtcg0FY,39305
 mlrun/api/utils/auth/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/auth/verifier.py,sha256=lq2BC0enehWv4mOgNP9nQMjnIw8HAvlgKFogE88O4Hg,12249
+mlrun/api/utils/auth/verifier.py,sha256=-JjXEX0tqqBymuR7P-f5mgsJF9FvwZGmb5k2SnTiekE,12383
 mlrun/api/utils/auth/providers/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/auth/providers/base.py,sha256=lTbV35QVryy7nwY9iMvJk0ubS_jDwJ7mptNjqWnbdiU,1363
-mlrun/api/utils/auth/providers/nop.py,sha256=5hZ880PMHagbUHVAQcC6FSQUCQyxk8UimKYlBHuj8eI,1470
-mlrun/api/utils/auth/providers/opa.py,sha256=Tg9MWaka2iBhh26S313LFr5v-46_kG9D3F2-DVXXumU,10835
+mlrun/api/utils/auth/providers/base.py,sha256=VUvHxeh7HvyJRzo-xRj7ESjlwJ10ilt_-e9U53rui44,1381
+mlrun/api/utils/auth/providers/nop.py,sha256=Y1vv1aH7NDCXY3vnt3HHzZeDappHZx79Jp-C9or8t94,1460
+mlrun/api/utils/auth/providers/opa.py,sha256=xPjubPC29yIglhgBhKB5zVp7JqJC-x71xKwo2YKv9Jo,10883
 mlrun/api/utils/clients/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/clients/chief.py,sha256=DVYvWEWm-GmMZBscrcY6ZbjpWwaO-ZYu3X2BTrfZ4DM,13232
-mlrun/api/utils/clients/iguazio.py,sha256=64m0AUqykYHtwMoWQ2t7VmyuVWM2IQBC1lRIcNbBhSQ,30488
-mlrun/api/utils/clients/log_collector.py,sha256=LTDpmk4MQuTNyMIcOXQ4tZLX2TvXXbTuU4tUN1qDW_s,10775
-mlrun/api/utils/clients/nuclio.py,sha256=D-yzYXX6rOHiZ0jO96EuQCGs_Z7fadThLavVYKJaM2Y,9841
+mlrun/api/utils/clients/chief.py,sha256=gI6-LgsZyPVIi8VnjmX1ILgGG-jLYvtYSZVC1QLP3Bg,13271
+mlrun/api/utils/clients/iguazio.py,sha256=G3S0Z6NFRtSkinRXhqUpVEAngO57xBxuk3x-OSLMDz0,31266
+mlrun/api/utils/clients/log_collector.py,sha256=d1Tj680X0QSC83re1vhX62z_0tt5WvNjHqKv1wMVNF4,12109
+mlrun/api/utils/clients/nuclio.py,sha256=yT8atthDWpvlDU4rQiyHXo1tCFDrx3-s1iLJadhJ3nk,9916
 mlrun/api/utils/clients/protocols/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/utils/clients/protocols/grpc.py,sha256=WLwnKSEf2X9_PzaaWBuqGKHlD7H39vf8Cch5UerXEoQ,2564
+mlrun/api/utils/clients/protocols/grpc.py,sha256=P_He0oRyRvsCpTz7Pl2bZkqwA1W04Wl3BJMusM30pkY,2567
 mlrun/api/utils/db/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
 mlrun/api/utils/db/alembic.py,sha256=sUVnWHXRzA_Yhn2GWiSqeQ8dcfpC4IPQpTFBjTta_iU,3305
 mlrun/api/utils/db/backup.py,sha256=LL4qL3YaLAbehS-KHn-Ieys333ZReEnmFIOoYV7BKzc,8214
 mlrun/api/utils/db/mysql.py,sha256=KWvD37V2_1hztu_g4-Jpe4aLmcc5Gl6x7-HzYWqkBOM,3795
 mlrun/api/utils/db/sql_collation.py,sha256=t1pYJNPDwSP0PZwtlTqMAUgYhGZLRv0awbnEYy3Geis,992
 mlrun/api/utils/db/sqlite_migration.py,sha256=oPv2Knboe4vQGn9MDUfqbFrcIhvSuDoFji1Emj59MIA,3855
 mlrun/api/utils/projects/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/projects/follower.py,sha256=DW7nRVNZZa6Bry4wybGssp32TxXBgsROJsz2wGmXaFI,17315
-mlrun/api/utils/projects/leader.py,sha256=d9ugV_tLhHlzJdqArWiuByG6bKrvW5wHAqJ4Pr8uxko,19424
-mlrun/api/utils/projects/member.py,sha256=bOQq5wNRGYR8uI0BwQJjdvtb3CbepEuiQZ00dDWgD8s,7040
+mlrun/api/utils/projects/follower.py,sha256=htcIXP2BRtm3MUEfw5IFC-WHUwidCfHZArS-pfSfFyM,17423
+mlrun/api/utils/projects/leader.py,sha256=-AzryNjAfEdHRj9BkilIlyfJE3lSGiuHNUa0NxyGzBc,19549
+mlrun/api/utils/projects/member.py,sha256=hokfxVFnvWtQHeVQYSZTlv1GyOoRHUUoVRVG4MFxfhE,7133
 mlrun/api/utils/projects/remotes/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/projects/remotes/follower.py,sha256=UrtXlvliQ6Uyi7qn_y1HZTm1WuXNl_1mJhYqHrFT4Vc,2614
-mlrun/api/utils/projects/remotes/leader.py,sha256=D0V41b5rcr-w4AgEOCp0THG7ve2v4BePQG41ms1HJKs,2064
-mlrun/api/utils/projects/remotes/nop_follower.py,sha256=lMnq7uZcNbNc4A3ghhTdYzJjSo6V3sYnyqnFTbzpbP0,4601
-mlrun/api/utils/projects/remotes/nop_leader.py,sha256=0sLDBZcGtacQwygS1p7GD--EGFLFWohOGFyXmIiy5x0,3801
+mlrun/api/utils/projects/remotes/follower.py,sha256=4bjZRHWrY8CKB_y7Juj-aQZn0YnbLCqVsJ93Aj_MniQ,2659
+mlrun/api/utils/projects/remotes/leader.py,sha256=uRC_WbKe1UfghVfCXD0ZomsJztk2HydBdz9Y_XjTfkY,2094
+mlrun/api/utils/projects/remotes/nop_follower.py,sha256=sP8BDve6471PEHomEJYAYEUsAlHwpy1frEfKbU9nAlc,5000
+mlrun/api/utils/projects/remotes/nop_leader.py,sha256=hslYEvKbQ4TdMzYnvqvU_oGfCvfQ2lxAglQqEn12AQ0,3861
 mlrun/api/utils/singletons/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
 mlrun/api/utils/singletons/db.py,sha256=y-v3JdLIHb_GtPvdzKH137jsflTav5TY9CafsSXfkN8,1202
-mlrun/api/utils/singletons/k8s.py,sha256=fxQuohr-iIGKQEAR6V5iZ3dka0438Tfm0xq_j2D5OGo,694
+mlrun/api/utils/singletons/k8s.py,sha256=R62wVYe-kf9SOKOQJxo2qnIzWS8rOskA68QSK49BBGc,22630
 mlrun/api/utils/singletons/logs_dir.py,sha256=zCALZ1N8IylkfvATfsbWfBtEPvWKl2AEQ2-QF-J0VWs,840
 mlrun/api/utils/singletons/project_member.py,sha256=1xlvJjbY-HvQuUV5rsQg9rMt-Y9MKU77Az5f98v-D28,1279
 mlrun/api/utils/singletons/scheduler.py,sha256=LmauJTsB69P_gkx4xTMzQrW1kaaN050txZzrrl08i_k,1063
 mlrun/artifacts/__init__.py,sha256=b86JkwaOMjN9gPzeL-RlkAtiITaVmGS9viNlvGG1lrs,1091
 mlrun/artifacts/base.py,sha256=l-dRIaK89NOIiBqiSbo1vbPks8CeRv83wSKndybJt0U,30849
-mlrun/artifacts/dataset.py,sha256=30N8bYHiX6vW-w6yKAcTGHqxDQ8yGDvxYSVrR2g2VNM,20366
+mlrun/artifacts/dataset.py,sha256=d4ZrxECaJ-CJSbFvcWYrAK34IAOD0UPxLY0xrPc-04w,20432
 mlrun/artifacts/manager.py,sha256=O3V_T7Tw6Q425N6SwbWs5M4pAngRa6wc2DQdrdpZfDM,12110
 mlrun/artifacts/model.py,sha256=SmzieOo7d78CPhVyyHMmI6WltkCSVn-d72jAxhHKd7E,23673
 mlrun/artifacts/plots.py,sha256=0Jq5OgDB1srtUlcISF696E_q3S_D-mqeMe6Wyn1S6ZQ,15383
+mlrun/common/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
+mlrun/common/model_monitoring.py,sha256=6woOZSKb308qfBc5Io4z8coOBwqMB0H6vRUxhkUHeCc,5670
+mlrun/common/types.py,sha256=pUKq8f0L4sjKoik5bCAl2ir3_dmmCZ6eKyurSV10u6I,790
+mlrun/common/schemas/__init__.py,sha256=sxDYvhoYVmLuc4sB1rDf7x_8T0sErGkZV2h4i-hohak,3973
+mlrun/common/schemas/artifact.py,sha256=5ZiL-PSjkjkYrcD6uDrvS-Tjrguyqh-XQ55GBcWm4Ho,1923
+mlrun/common/schemas/auth.py,sha256=s5YeIELOxITr25_hhUfyMRpoRv6aURk4kDJBtw4L180,5251
+mlrun/common/schemas/background_task.py,sha256=tQNOhYXfCr72iCwOjuWulIPy0NcZFQ6x-vI59FVmffM,1553
+mlrun/common/schemas/client_spec.py,sha256=bQhGYtkcJg27yo82y3FNiiNZbYuwWce8SQxcXtVKJpg,2751
+mlrun/common/schemas/clusterization_spec.py,sha256=apyd1SinU_uwmuQlRiM9qD6SEgiy8WN_br3vqEekdKo,888
+mlrun/common/schemas/constants.py,sha256=z1_XckQGLfEH-WIKTcWixvRk76iBJbf88_BILB_zAGc,6243
+mlrun/common/schemas/feature_store.py,sha256=kX3Wd107ZfyGrDOcNmLEcgdVrFgtHTswzVhmH6VVWX4,3671
+mlrun/common/schemas/frontend_spec.py,sha256=EI5WjRlhvE1sFPECk-GICmFnYHsko1lM6sfLQyRR48E,2546
+mlrun/common/schemas/function.py,sha256=tuaD2M4RhiIJmL3p78FrbE6gG5nXRj_J-k6POUWzYx8,3971
+mlrun/common/schemas/http.py,sha256=2hKkmPqhZai5w_YgpjRMp8ZqlRjnUULwaUx5QF4SUmI,705
+mlrun/common/schemas/hub.py,sha256=bufhIim-G8NryGA26orpEvKfUEeTJ7601pCtVDz6bCU,4245
+mlrun/common/schemas/k8s.py,sha256=4ZHOZv2IrDquG5rRi41eWkJmHGdmjn-pV4gH6AF-tcI,1395
+mlrun/common/schemas/memory_reports.py,sha256=SlNJ-uya5RywEysm_IZMwF1t4j-zYsjOj8oPYwLRO08,920
+mlrun/common/schemas/model_endpoints.py,sha256=_UqgwnkBc25sD1PZV-NkDgI-uj7q_gbw2AJOGUeJ0J8,12528
+mlrun/common/schemas/notification.py,sha256=Bov6DqX2nmkn7daFnuFgTWHExuPwIbsGoz-pmsb6ohA,879
+mlrun/common/schemas/object.py,sha256=G4jqG8oO_r4T5gtvz_m39VNpdvCBTZ6didnccCWI0D0,1907
+mlrun/common/schemas/pipeline.py,sha256=u-WQjN3JQxDs1kG_r_tQ-mklj_pfPWXaMEXKHFSerO0,1184
+mlrun/common/schemas/project.py,sha256=EDlhuxRCBgwcUD6XLu2uFe7LBF8nzwB9oSFzbB7krHo,4094
+mlrun/common/schemas/runtime_resource.py,sha256=TqivuenSskqcXxBXJuFwung50oqFg-IdL_PBHg3YBpY,1636
+mlrun/common/schemas/schedule.py,sha256=bmCUXDa26dN8mncIE9GgPU4PlfXAyn84JRsD_ztA384,4188
+mlrun/common/schemas/secret.py,sha256=6Uk85-icEW6MWK1Euj-EhzJSyaQpkTMjmD0DBa0jIfw,1484
+mlrun/common/schemas/tag.py,sha256=x7l-nxJyjxqupu6-3CQLh_r6mD5-EST3KM-WyuTH-DM,919
 mlrun/data_types/__init__.py,sha256=hBd2-QsTqesw3HUDoIUaUtCR1mWEcRc4V7Z1V8lNP0s,1087
 mlrun/data_types/data_types.py,sha256=xjsnUw144Lbkg4JqYLYym8qQpucYQUjphxay_BIc7VA,4647
 mlrun/data_types/infer.py,sha256=ErGpXigp8bG6hkPJfbJt8cJZxsZvj-bK0dLSiTlUYzk,5813
 mlrun/data_types/spark.py,sha256=BVM_FeWh1mKYLu6QILYfZRCOGefQzRJ2t0LeHo-pqwA,9426
-mlrun/datastore/__init__.py,sha256=lEcQKc3_Q2dfK6CTg2hwlTH3IoKQg-xE0WeMOanmxfo,3300
+mlrun/datastore/__init__.py,sha256=ScHRywI8M5BDdLfEFDZ57Gk1_Bnj22bj8TLK7Ea1juU,3443
 mlrun/datastore/azure_blob.py,sha256=XFBpXZfwMKvv0rrYVP2J6RDqziNPHW6KqCbsY-VLzto,6946
-mlrun/datastore/base.py,sha256=5jODaKrJHSeCFQFHVBeREj3k9LaDLgyh5kW20-0ePGw,17575
+mlrun/datastore/base.py,sha256=wnad4Fie0zeq_CLxKGN02bKHIDBmrYYxIHVMuHEsGFo,18274
 mlrun/datastore/datastore.py,sha256=l6CfmIYn7rdPQyRZ8kZu45cfyDZcDXDH5CwLKvsFlI8,7995
 mlrun/datastore/filestore.py,sha256=v9-BTJMgamGN_neoXNkIbNNr56UpgOewMEX70P8MTbc,3791
 mlrun/datastore/google_cloud_storage.py,sha256=9dtZt7Opytrra45urj6ObYa1fxf7UIOHXSoog4G9l7I,5114
 mlrun/datastore/inmem.py,sha256=o6Svv12k5PxJNT24nMgV9FBYEPCzD3OQzuuvU6OeCYY,2627
 mlrun/datastore/redis.py,sha256=pywWgjGJ51pmvKuwX1MI3ILWqh6WtgDs9igOQAhmIhc,4873
 mlrun/datastore/s3.py,sha256=fn1Yg5Rs33ugHlwTKvBfu_jMKqkSZWgHNw0ocQ5nO7A,7035
-mlrun/datastore/sources.py,sha256=HqcD7cmI5tL5vsIA31g6lQ9qKv-P_QFN9V5NiNUowxc,34023
-mlrun/datastore/spark_udf.py,sha256=LFICcRzj7Yx03ttgQZImodEXjOZVvkcQd0OKwHuMLCg,1402
-mlrun/datastore/store_resources.py,sha256=u60_0LGXbagkG2UIm2o2pntWioF4kPu7FLMd0tlrR-8,6889
-mlrun/datastore/targets.py,sha256=3pA6jyHPzEHwfoMEDK3SObDAnLakpZU2AcJ30URO0KQ,62054
-mlrun/datastore/utils.py,sha256=WNKBhgG2w9xAviyieGCB6hTnESEYzCwzgjcjz6uaWC4,1660
+mlrun/datastore/sources.py,sha256=SJyVr_X5hdVv4m4RfIzN_F255qWz5k8bXVNXxY5valY,34385
+mlrun/datastore/spark_udf.py,sha256=xYw2EYO-jd7hKOlXXfJYH8dvRll4GktFM581K9m6ToE,1410
+mlrun/datastore/store_resources.py,sha256=Elvo33AVoDfOIFbTF_5NSf1VMzlgJTv5uzMgPkGTShw,6895
+mlrun/datastore/targets.py,sha256=IurALojY74ZaxiI3B3xMHEWeVM_blys6Dq1EGS9JOyc,62060
+mlrun/datastore/utils.py,sha256=OEBUAux1KD2dNCH2VS_eY3HN1MVk8BWrBHVrzDTvlo8,2409
 mlrun/datastore/v3io.py,sha256=ArEYq78irv5bwlRwcLeVfFJvcwtXEamGsZ2I0sVt7Qg,8097
 mlrun/datastore/wasbfs/__init__.py,sha256=4CK7vZeJmC4Ak9cJjG07cGnk7jlkBlpCxw-ANfbBmzk,1343
 mlrun/datastore/wasbfs/fs.py,sha256=DEZgwrmQSPeR93MNlC9OCwuU9wvTSmIM534p5ccQzAE,6152
 mlrun/db/__init__.py,sha256=HA6ahbEFrRd5I81eJQ1xrHmUch6JOy3JeEKMf7KrOTM,2816
-mlrun/db/base.py,sha256=eOWjqPEVq6UnffIw4s9XM_ESakcaVxLJHZzMUI2bOGU,14771
-mlrun/db/httpdb.py,sha256=OOgn0D6lPM1vHuzOM2oVpVTIGwHXD4HIoLCYNOHH1G4,129128
-mlrun/db/nopdb.py,sha256=J_7mlHfF9rSwGK1WL12_f4ciUcrRD3ZZ48AYisaNBmQ,12257
-mlrun/db/sqldb.py,sha256=sk2sJZpAAootYnTCDsUPo5JvPgqVSC6PanSODFelnh8,25370
+mlrun/db/base.py,sha256=K0Hg-AVWxbRwFaKBxUDTPTStXtGlhesBLZYJzNJfI2E,15737
+mlrun/db/httpdb.py,sha256=2E65WCdxudz_kyUHCsQ09PWbwF9KAtzv2_gyfdlsSxQ,130695
+mlrun/db/nopdb.py,sha256=mAEmOlxhnlk3DU8xTf2uWt_5QbDvo8YA9Jj-BKR_VtA,13197
+mlrun/db/sqldb.py,sha256=rgWLh2354qmc14AVGqzICcuphtM1_CKxI6PpVTmUzdw,25917
 mlrun/feature_store/__init__.py,sha256=guoak0hQTMoE4YsWwyoyso0CYE9NSPoP0eUal4crfVA,1501
-mlrun/feature_store/api.py,sha256=N2Vr1Z_hoQudXbYZ4_WmjjwdYbllfrAP5n1vodqs3_U,43761
-mlrun/feature_store/common.py,sha256=vgBs-jQKffjwOLNnOzrNnaU3yhzQTu-eh3X4yCy2ExQ,12807
-mlrun/feature_store/feature_set.py,sha256=SE6qCVpNCn2aImrVXRWLaE3SmD17iF49SOHj9uzltt4,47059
-mlrun/feature_store/feature_vector.py,sha256=hLOyejUK-itqZRzbqOQEQcijJHsJlypuHD7ZWQ6B5aE,21937
-mlrun/feature_store/ingestion.py,sha256=7qcBfNkDZsD4IXRdRN4OCSPIlpQDVo3WaO8pnAAYY6Q,11813
+mlrun/feature_store/api.py,sha256=oL6x8ehykb-FGhwJAFkTTPn2EyvDx6vRKV3g8Astz3I,43820
+mlrun/feature_store/common.py,sha256=WR01cTgrJ88qRLKRz0U4VDOTg2vNzhYdch-jylkyoJ8,12781
+mlrun/feature_store/feature_set.py,sha256=_k-FBI8a97aKCL3IS9fXehD7cXUCsbMSEAXm4sq47K0,47273
+mlrun/feature_store/feature_vector.py,sha256=31kHErOGU_OhVauMK5svW50TKIDwKgdcDzst87JyB2c,21940
+mlrun/feature_store/ingestion.py,sha256=YQafLdoQmoWsEHLE8lMBBhhPe974TNJ6Tnq_Q0Xhpus,11681
 mlrun/feature_store/steps.py,sha256=khDqxTusXDtBNfS7ESZh-QEsWu3_8FTR5ep_AY_Nvdo,28635
 mlrun/feature_store/retrieval/__init__.py,sha256=2b2WoPmH4TqcSSJ2OQYSjsDIcUe1KA5DnG7-wkrIayM,1232
 mlrun/feature_store/retrieval/base.py,sha256=38n5qY60V-wvn5vAVSd4qQlfkMMTMchX0c2TdZ8XqqE,25911
 mlrun/feature_store/retrieval/dask_merger.py,sha256=-xRgRPWUblu3KtVhEoL0YXEAcgkZrSUykDe31xnEzRI,4261
 mlrun/feature_store/retrieval/job.py,sha256=NwVrTKlR_w4KpMgQwTkreddYUbWI-6pYuksXowZQY9c,7106
 mlrun/feature_store/retrieval/local_merger.py,sha256=h6FE11EZxxqVe2EhVnQtwl5cxOBsOCXQCbTLOJk3op8,4765
 mlrun/feature_store/retrieval/online.py,sha256=tnpHqcbaA16lKTuvlU6WoXwnb_SLmbWBLzyJSvhss28,3352
@@ -301,94 +311,92 @@
 mlrun/frameworks/xgboost/mlrun_interface.py,sha256=JwbFkYz97gmkjLN1V_zu8nTG9zSey1RtUmUO6XfaZ54,878
 mlrun/frameworks/xgboost/model_handler.py,sha256=3KSLoL_uBBhRPkGEgRxJz1MPxQbcbvuIxJawQConfrQ,11617
 mlrun/frameworks/xgboost/utils.py,sha256=Yz7vIfnFMqa2A0k2GweXL912-tt7JnQdYsNX-pFs45I,1069
 mlrun/mlutils/__init__.py,sha256=enRhuXMjuev4xr-0l1zLxtoDp79FHc-HXbUoagYomvk,760
 mlrun/mlutils/data.py,sha256=uQ45eaKYx3Jy93l2TqosFW68Kj_ZtVI06ilxGxydaUY,5325
 mlrun/mlutils/models.py,sha256=_CijiNJkLnWdz0HU3DAU6P8TbobY7R2QVpuCOHTJD-4,2598
 mlrun/mlutils/plots.py,sha256=0-Rih6th9WkgzZRPIPZwz08lv4bVSX7YbyGNgA02xdA,30120
-mlrun/model_monitoring/__init__.py,sha256=5TTKiOBEZcUCDqPYqmPhCf_qukmha10vbLo6H2mC4jw,1307
-mlrun/model_monitoring/common.py,sha256=jPh_HQlFHTZipEUlU4BGXgBGf3bxRu0JHkV5MdmoiKI,2962
-mlrun/model_monitoring/constants.py,sha256=dGdQMDFudz4ZB-YYp2V5T2K0KbwIeq1ZjrOeqWOfohA,3117
+mlrun/model_monitoring/__init__.py,sha256=YIUIQs1hwX-PWBu23dH-IY9gQYXW8HA0oFX3izaG9d0,1208
 mlrun/model_monitoring/features_drift_table.py,sha256=DlMkc-GwRhIALXB0OdCQkvOZQUVNI69RpJ1PAwLqK9Y,23948
-mlrun/model_monitoring/helpers.py,sha256=KSQhT5orKZH6EN-Aow1OCeEZVtRatRuDWz7Xh-MFW8g,5935
-mlrun/model_monitoring/model_endpoint.py,sha256=Km7slqz_2O4mv9TZkBF9-gwrr7LYIAEKnmGd0OB9IA0,5176
-mlrun/model_monitoring/model_monitoring_batch.py,sha256=3EUb1KBA0b3SyP6aWa-Lxd0OWqbbMDrA8e_-ouGnjUY,36191
-mlrun/model_monitoring/stream_processing_fs.py,sha256=JDFigL-_UJ-s-JUPp3FMZWKMMtC7edN8poPM3Yo3lm0,43025
+mlrun/model_monitoring/helpers.py,sha256=6e7yA4a3tErirdSCuC-BIH8OqISzkFcx-h9-5K38STU,9756
+mlrun/model_monitoring/model_endpoint.py,sha256=enXHLZ72Sd-lQ7lMeBQNnQaf4xX-TLZbTgEMuNw9UYQ,5196
+mlrun/model_monitoring/model_monitoring_batch.py,sha256=kmlD3q6rBT7X2fwugBeV9tKcLmrAFsX3uxa59VS8Yxs,36885
+mlrun/model_monitoring/stream_processing_fs.py,sha256=vVt34BY0p83a1MFfgWn3zzSOfvabm1Ioy-69f5e-qGU,43172
 mlrun/model_monitoring/stores/__init__.py,sha256=0FlHSjq2etDBnlzzj930LEF0p6bO7G5i_INTUtT-lLE,4240
-mlrun/model_monitoring/stores/kv_model_endpoint_store.py,sha256=krVYkYN8_G3TeXSAGS5ZXJQTM5LhymibK4vrP9ISvy8,16926
+mlrun/model_monitoring/stores/kv_model_endpoint_store.py,sha256=EmA0so7YnliUWWwzekmRkHKAmAy4wJ3Cao5G5wAaMM8,17357
 mlrun/model_monitoring/stores/model_endpoint_store.py,sha256=-Brbv-jMx47rIFUPP0Ykb92o1KPyic9FgGBy4TA3ejs,5695
-mlrun/model_monitoring/stores/sql_model_endpoint_store.py,sha256=UEU2iOCchjXbdvcRpwqrQx0ES43gcMYIWU1jS-K8wdk,15700
+mlrun/model_monitoring/stores/sql_model_endpoint_store.py,sha256=wlu4OL0uydJVEeuZz1_C_flIRrrBGEjWzGjzjfoF_9Q,15706
 mlrun/model_monitoring/stores/models/__init__.py,sha256=ea5Sca62LlYpjsTDMlaxRyIjRCpwOPxRwFJ5sABur-k,884
 mlrun/model_monitoring/stores/models/base.py,sha256=Az7Q2JZKCTqZJ2hqYaOLr2owVMagClFp2KwuriKMx24,655
-mlrun/model_monitoring/stores/models/mysql.py,sha256=o8vaYdE1Cu2Rsd7AM6-xMHIr-qFEQ_LOvqoZlgFbnFM,3744
-mlrun/model_monitoring/stores/models/sqlite.py,sha256=kkQvEVzJcSZcf2PkA9-3tLpkJU5KZ-J-aht4uA2qU2c,3661
+mlrun/model_monitoring/stores/models/mysql.py,sha256=vVVSIssH_ZHMG-BbqwbFlaiPcN8DQtU3mM2vTySAPdY,3741
+mlrun/model_monitoring/stores/models/sqlite.py,sha256=jLWkY8srgal7_aCL2eDPZIoceNGsi4Dec1T2rHNd0BI,3658
 mlrun/platforms/__init__.py,sha256=NNh9MSxgjdi7QftO3DHp4axQnBeO5IjxD8oR13_jp3A,2400
-mlrun/platforms/iguazio.py,sha256=gPOXoIRGcUCNmyMOddeHQT9DXW3835kB9AduZm_S0E0,23113
+mlrun/platforms/iguazio.py,sha256=qKglLKYVOJqlDG9JEZ9b1kOvrVmk5exey-2eh6ejfdw,24102
 mlrun/platforms/other.py,sha256=DwqbdbMNlkC2nEl1yJ0jF9WZJzjVu2IVPTC3bQ_W9Y0,11852
 mlrun/projects/__init__.py,sha256=dsXSDyqBhLi8OOfpdjLJpYOwC2fy_Q_Ki95Bk6gVSwc,1153
-mlrun/projects/operations.py,sha256=rxxpSemZIp4_V6IC2gm2MnUH84aB4Q_7n_Y_BcbjK_c,17485
-mlrun/projects/pipelines.py,sha256=845_9berjVxxGB2OHkuGO2m5xRI-69_cp7Y2aqb5t9U,37899
-mlrun/projects/project.py,sha256=BP0hZ0DoflSkUNwJpp2eRVZvZwYen0DZkgSyw7AvCF0,104532
+mlrun/projects/operations.py,sha256=ifZGJidODXsnbJt7wG94upzkNOU24NQNhbivGWYTHRs,17480
+mlrun/projects/pipelines.py,sha256=MVYNxdubl0RiuILSY9z2v0fszngMYEtV81YJ_uQD8oE,38336
+mlrun/projects/project.py,sha256=wE5gDyWxJ5V6f5vPregix9qitvoMnKbidfHTnk-jWMQ,105214
 mlrun/runtimes/__init__.py,sha256=NpPeD7XxDNxmeOqLSEmb7tUN59cYZlvw-DnJxla_peE,8773
-mlrun/runtimes/base.py,sha256=qYMiFbf3mAifyCnNzrlRAWhCNuds8Eh2SMEly0vJHf8,109502
+mlrun/runtimes/base.py,sha256=MnAg7FHhIPgrPcD9uQCkr3me85xxQb9XBJ1tRKMtLT0,109329
 mlrun/runtimes/constants.py,sha256=Os_6YpWE8WMhigm1h3RKvn9Uo4LXNaEbA2xNSEDDEao,6689
-mlrun/runtimes/daskjob.py,sha256=Hol5_kzTfJBP4WN6orPlGSlSRDPec1HcBD8id_jSdPA,30403
+mlrun/runtimes/daskjob.py,sha256=4D0BCCRAb-JsLijZ_2LHzwGcZnxhyZ4gnst3HKENqQg,30520
 mlrun/runtimes/funcdoc.py,sha256=U5Hrkeo7i7CUnZFQ5g7-CyWMvXiQXPGrfsNdgsDAraQ,9190
-mlrun/runtimes/function.py,sha256=Px4WakU2rYBDrgl8_GtoeABZIoCjn7HIKNYiv-YEDf4,70153
+mlrun/runtimes/function.py,sha256=GH6XUVOAvnhARg_oV3BUyLEG5xaYZHtiwrBbZ2FwniE,45205
 mlrun/runtimes/function_reference.py,sha256=ikxeXeFPAn7PpfYR1DPBRFc9MSXXFM34uH5z6iRTz9M,4911
 mlrun/runtimes/generators.py,sha256=WvXzsfZZWqxLV1ncZ-lzFHZH2ITK6ICROgDv2vfQUs4,6530
-mlrun/runtimes/kubejob.py,sha256=1ct6ox1cyWYSDk73VQctAEssArOPWpgr5-7Wnvm2R5o,16895
+mlrun/runtimes/kubejob.py,sha256=I5GCsLM_e_Kv_T38s5WP8i0Ea-oHmrgI7k73XwqxTiA,15406
 mlrun/runtimes/local.py,sha256=gsLkfQSbvt1DjDuO6_9tjZC4AxOGBAypR3qJQomPqIY,18005
 mlrun/runtimes/nuclio.py,sha256=ih2iwrJieeEom3iW0yU99QG4_u_Bdv7VWgs1CK4Q1P8,2885
-mlrun/runtimes/pod.py,sha256=sWtw5wkme43VrQVEYDiU67uSC4zBbSyzqXZFYwWYewM,60648
+mlrun/runtimes/pod.py,sha256=QjOffy6atS5x7R96n8HP5pI6Rm24qyAYdJ4DdCb7Jvo,60644
 mlrun/runtimes/remotesparkjob.py,sha256=Lp2EN32GQ1rY_34MEepdUzRTg-AP-OKyUM7xcy0Npb8,7695
-mlrun/runtimes/serving.py,sha256=bgqd97gJmfeLqtKKyPphWg6XeptIJACEZRnPpRx2Bt4,29852
-mlrun/runtimes/utils.py,sha256=r1FGNRETsZykdsy_DNpbyvqxsVcTetYRdHg-aelFt1k,21249
+mlrun/runtimes/serving.py,sha256=jruUAxwi9PVHY-mlZkljMD7P5WGyfbSS8pJmzDqQI9E,29858
+mlrun/runtimes/utils.py,sha256=3le7YiK4pJh_BhVf0p6yi1QVMz8BBEjz6pcLUh3bco8,21131
 mlrun/runtimes/mpijob/__init__.py,sha256=E0oiOsSYsRBBR0HV6e_EGaL_j2_dYEJwAcICnF8mOYU,790
-mlrun/runtimes/mpijob/abstract.py,sha256=_6CCDl4FXNpDzg1qTiEQGaqXyblx4gXYquAdKIG0fk0,14782
+mlrun/runtimes/mpijob/abstract.py,sha256=0BbIziHG5ITg3gNClLuBwL6-J4IXXPxjifppQciQwNU,14713
 mlrun/runtimes/mpijob/v1.py,sha256=o-ZDw3O0HOzTMZ3lI3gMjGG0NYY0Ux3RqL0Kz9K3eV4,13845
 mlrun/runtimes/mpijob/v1alpha1.py,sha256=4rMpJk1C_gL6QtOmEFcgcmaCkHcor9mdKvIL46fEKFw,8460
 mlrun/runtimes/package/__init__.py,sha256=EHFvxDWnRkXqjmdv9Mj3O-nCYAFLbRsNgX5zR0ElwAk,673
-mlrun/runtimes/package/context_handler.py,sha256=5br30fRHHhWQJgSWF2zqf0M8XOxVr27ZkOFWVDgf4f0,27044
+mlrun/runtimes/package/context_handler.py,sha256=Z33-nbg4h545n1gGgCSrb-0LiFbRsisST6w44oba22I,27068
 mlrun/runtimes/sparkjob/__init__.py,sha256=7damn-nBbM0unppemEuVwZxCAGwXq7EzXECMJ9AaRPY,751
-mlrun/runtimes/sparkjob/abstract.py,sha256=NyHcddXo97s2S3hjHmDUoEDaGd8AjmKltd5PJTVd3BA,35869
-mlrun/runtimes/sparkjob/spark3job.py,sha256=JzwinNIiPXBapSC-gAsbhf81oouxhx41U5oQwoNeYhM,28722
+mlrun/runtimes/sparkjob/abstract.py,sha256=FFT4FGxUH67NQQlRApZtfWJSW9A3OCGjqlGTgmAaLnU,35028
+mlrun/runtimes/sparkjob/spark3job.py,sha256=mxHWVtT7hZeQsFklaFE5PeI9sSeGb3Pvr7mGfaPYgos,28746
 mlrun/serving/__init__.py,sha256=FOIyvEwEOH6QuJovcDrrP5VSdLeKoqummSlfhNMvFXg,1078
 mlrun/serving/merger.py,sha256=oRX6gJ3LUVeCJcTpJ1nwh4d1tk5FrSZshkXcH-y-dd4,6116
 mlrun/serving/remote.py,sha256=HJS9bz5_mUuaKGsNbqRKpo-eVHKbc1fIEOEsECPmnko,18038
-mlrun/serving/routers.py,sha256=avhQ5cgogYA_TP_6kgzC_U2VQW24-yWWUXJGP449-Qg,55209
-mlrun/serving/server.py,sha256=ePfYiefH3HkNag5qHDzDyoowaNNMbjJ9YKpPS9wX9Xw,19005
+mlrun/serving/routers.py,sha256=Erod_gU6qnUk5ipNUsSZLrcPN_VHESN3W2dH5wwjQVY,55277
+mlrun/serving/server.py,sha256=5sR-XBEealOcFehQKZtIK4Gr7HJ63mPU7BtjcoUA3qw,20247
 mlrun/serving/serving_wrapper.py,sha256=ivoSlFNuC92plPHRfMzHr-hdN-jGqxneGiufJdgoxVc,836
 mlrun/serving/states.py,sha256=7ykG0Q66OQvRF32nQDQGwkmVYEyHczCvNrQxneVdUdM,53940
-mlrun/serving/utils.py,sha256=1fLfn07R4-RlUcdUgYYwUTFF47NozQmV9BnZVbu4-lU,3468
+mlrun/serving/utils.py,sha256=HVePCgBKiQrIoBE8qcG0Qb57FRpZ_3CrUSBv2pPFlVk,3902
 mlrun/serving/v1_serving.py,sha256=UF6Ydgyo-DuHZ4DkrEdNMQl5oopVaZqm4EfBMBSvhDY,11814
-mlrun/serving/v2_serving.py,sha256=uIKQnTITJozqk6WrmJhO0hKfjCl8FLYc_IpCEYt5elA,21441
-mlrun/utils/__init__.py,sha256=jT8jJCOKKOA8PnL4KC5eVd7yKmYJuN9_qrzGmvHcGns,855
+mlrun/serving/v2_serving.py,sha256=7g-FBPqyc8zgCY6Xi8SoS23VldDnOoL2G81m8qGbDOU,21460
+mlrun/utils/__init__.py,sha256=YnW6IErGUxc1mdd7a3eNvoYO_fy-mv4Uvu5Go8uT-kM,826
 mlrun/utils/async_http.py,sha256=AvI4a9D0frI6XxHvqnQ4AzEXopezo90zZHvsOAJJt6g,10397
 mlrun/utils/azure_vault.py,sha256=atz9fIu1vfgWAND1g6flRQDhrX-xBxZ_6MOWm34Onh0,3456
 mlrun/utils/clones.py,sha256=lKgQeibQ3xQ9LH5bZTZCoYCXoOx_2mYNGD5A-OOxwAQ,6245
 mlrun/utils/db.py,sha256=SqDrvIpGX_qHs0MNx_PWQNRcUhHaKLngoHFKLW3m5j0,1662
-mlrun/utils/helpers.py,sha256=r128kqmGIHpDaPnSlnryLUmlqN81x0sPyjFvJs_SJ9o,41425
+mlrun/utils/helpers.py,sha256=ZqKUv-PKxN-rvApnPDNwhayEk0NjVpBDoOXD87x6DE8,42139
 mlrun/utils/http.py,sha256=FVgdYV8Np3TKbqszEtXrlgwqNyjScTMLAjJhlsWLifo,7093
 mlrun/utils/logger.py,sha256=O4pH45kdz0cO-e4eKeRxbZUIRLGn2X0BJcjSY9cWB04,5637
-mlrun/utils/model_monitoring.py,sha256=wS6T9KgG-XCB21MNc6edNODEqFBBqzi5bUgSvPpKt-c,7875
+mlrun/utils/model_monitoring.py,sha256=1y-E4AlR-yZ1qW2yfxcHvm3rHZoytDz4IbIju8cPOOU,9969
 mlrun/utils/regex.py,sha256=3hSOVEU5128xio_3BLBEmvvRGLipmGP2Sh7XgVAYs8w,3954
 mlrun/utils/singleton.py,sha256=kV9HhbzdmXo8gGKBPdbHWspRDutlkKX1ZEn96xs_LRs,883
 mlrun/utils/v3io_clients.py,sha256=ekxhjfcUnjV8cejQYTQUHnhYOKHA4KekIdSaywydTdM,1319
-mlrun/utils/vault.py,sha256=1zr_3gkXoerYID_4Z5vYkBO9FeCKd43Qm-XlmGBk_Ok,9957
+mlrun/utils/vault.py,sha256=EgxGAfn-mxRCj8cKEzSrrZQ9SV7BFP8mIuSnbhJpNUQ,10447
 mlrun/utils/notifications/__init__.py,sha256=CgWLxslSqhTH-tExi_UR4AT-ipjkGUF4gwf9mKcNua8,990
-mlrun/utils/notifications/notification_pusher.py,sha256=WdkBRLg_upmcInkwYcjRJkuRexKMaZ_a_47d0yMfhSs,12297
+mlrun/utils/notifications/notification_pusher.py,sha256=ZnbnyjCaJi1tEXcz7uEnU-6Xr85j18o6y_-wl3qKeK4,12336
 mlrun/utils/notifications/notification/__init__.py,sha256=iNF31hiEkenkp1VmJ4keyjixS17-gZ0oGuWNO7tlnm4,1803
-mlrun/utils/notifications/notification/base.py,sha256=0q419xnXHH6raEcpR8j1uvBUn1jHcJmIAfjFNt2XkKQ,2162
-mlrun/utils/notifications/notification/console.py,sha256=nzucPPOj3jFceJKZSV4UJLT0mu8V1yVqGUl3MbnlwZc,1962
-mlrun/utils/notifications/notification/git.py,sha256=iXjjBbJMWA741Z6aRNpGGg8FjZC78jzS2uR9UYM0yHY,4733
-mlrun/utils/notifications/notification/ipython.py,sha256=zP1jAE39Dn6rrbQIxi4R4iDhMLFBQ_GJrEtMMj8G80E,2012
-mlrun/utils/notifications/notification/slack.py,sha256=QnXQvAMOe3GUUKnlrNy_fEtUEjdG8n80FDl4hYdqXyc,3736
+mlrun/utils/notifications/notification/base.py,sha256=ddlf70Cd59bMvvWi2EFqzJQTXSRHw19E4r-oX2Tk8rk,2177
+mlrun/utils/notifications/notification/console.py,sha256=JggUV_Ql8lluvlONtkmQWk6SeSPY7gEhICAbkg0jYas,1971
+mlrun/utils/notifications/notification/git.py,sha256=gKBBb0_EZpv7PJFDi62hmxih9a8JoaU37i1IXUM46e0,4742
+mlrun/utils/notifications/notification/ipython.py,sha256=bYIUpzb2QnLPhacL8l20NU4suRjE0-lxeYYXpHuqiTw,2021
+mlrun/utils/notifications/notification/slack.py,sha256=hONSD43eLSxQ5n3x8HHqI-zhHc4ZxThR8lLcfkKoHfw,3751
 mlrun/utils/version/__init__.py,sha256=hwfJgGWYGWFpepVGI1GbuCPqqEFGRbgguJg5sC0v4TU,614
-mlrun/utils/version/version.json,sha256=hsn9H7rpi0XmRAbCXb0oM4t1uXJfVkQpYIiKVM_uoSA,88
+mlrun/utils/version/version.json,sha256=g1cF_51H-rzgFAMgKwCcNdylz5Bu3P8A6rbN0ywgslY,88
 mlrun/utils/version/version.py,sha256=O4Q4kwtKlI73oK7oBPuz4SVkUI8BC11E9DJIKHT91kU,1970
-mlrun-1.4.0rc2.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-mlrun-1.4.0rc2.dist-info/METADATA,sha256=_at3cBifvsdJaad6mIL46mrg00ix_KEsCKQ8gb4b6ag,17177
-mlrun-1.4.0rc2.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-mlrun-1.4.0rc2.dist-info/entry_points.txt,sha256=ZbXmb36B9JmK7EaleP8MIAbZSOQXQV0iwKR6si0HUWk,47
-mlrun-1.4.0rc2.dist-info/top_level.txt,sha256=NObLzw3maSF9wVrgSeYBv-fgnHkAJ1kEkh12DLdd5KM,6
-mlrun-1.4.0rc2.dist-info/RECORD,,
+mlrun-1.4.0rc3.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+mlrun-1.4.0rc3.dist-info/METADATA,sha256=HHvrb-7kQP1Dtsyz7qDRpp-DLzYC-6DrJ_z9ZdRoZ4E,17185
+mlrun-1.4.0rc3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+mlrun-1.4.0rc3.dist-info/entry_points.txt,sha256=ZbXmb36B9JmK7EaleP8MIAbZSOQXQV0iwKR6si0HUWk,47
+mlrun-1.4.0rc3.dist-info/top_level.txt,sha256=NObLzw3maSF9wVrgSeYBv-fgnHkAJ1kEkh12DLdd5KM,6
+mlrun-1.4.0rc3.dist-info/RECORD,,
```

