# Comparing `tmp/malariagen_data-7.5.0.tar.gz` & `tmp/malariagen_data-7.6.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "malariagen_data-7.5.0.tar", max compression
+gzip compressed data, was "malariagen_data-7.6.0.tar", max compression
```

## Comparing `malariagen_data-7.5.0.tar` & `malariagen_data-7.6.0.tar`

### file list

```diff
@@ -1,21 +1,22 @@
--rw-r--r--   0        0        0     1067 2023-04-17 20:27:20.621067 malariagen_data-7.5.0/LICENSE
--rw-r--r--   0        0        0      987 2023-04-17 20:27:20.621067 malariagen_data-7.5.0/malariagen_data/__init__.py
--rw-r--r--   0        0        0    10329 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/af1.py
--rw-r--r--   0        0        0    99722 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/ag3.py
--rw-r--r--   0        0        0     9560 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/amin1.py
--rw-r--r--   0        0        0        0 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/anoph/__init__.py
--rw-r--r--   0        0        0    15599 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/anoph/base.py
--rw-r--r--   0        0        0    15136 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/anoph/genome_features.py
--rw-r--r--   0        0        0     3115 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/anoph/genome_sequence.py
--rw-r--r--   0        0        0   277587 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/anopheles.py
--rw-r--r--   0        0        0    10514 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/mjn.py
--rw-r--r--   0        0        0     1253 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/pf7.py
--rw-r--r--   0        0        0     4442 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/pf7_config.json
--rw-r--r--   0        0        0    11756 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/plasmodium.py
--rw-r--r--   0        0        0    14253 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/plotly_dendrogram.py
--rw-r--r--   0        0        0     1253 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/pv4.py
--rw-r--r--   0        0        0     2060 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/pv4_config.json
--rw-r--r--   0        0        0    20198 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/util.py
--rw-r--r--   0        0        0    17981 2023-04-17 20:27:20.625067 malariagen_data-7.5.0/malariagen_data/veff.py
--rw-r--r--   0        0        0     1901 2023-04-17 20:33:14.934377 malariagen_data-7.5.0/pyproject.toml
--rw-r--r--   0        0        0     1195 1970-01-01 00:00:00.000000 malariagen_data-7.5.0/PKG-INFO
+-rw-r--r--   0        0        0     1067 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/LICENSE
+-rw-r--r--   0        0        0      987 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/__init__.py
+-rw-r--r--   0        0        0    10071 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/af1.py
+-rw-r--r--   0        0        0    92041 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/ag3.py
+-rw-r--r--   0        0        0     9451 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/amin1.py
+-rw-r--r--   0        0        0        0 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/anoph/__init__.py
+-rw-r--r--   0        0        0    17813 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/anoph/base.py
+-rw-r--r--   0        0        0    15136 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/anoph/genome_features.py
+-rw-r--r--   0        0        0     3115 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/anoph/genome_sequence.py
+-rw-r--r--   0        0        0    26109 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/anoph/sample_metadata.py
+-rw-r--r--   0        0        0   259684 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/anopheles.py
+-rw-r--r--   0        0        0    10514 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/mjn.py
+-rw-r--r--   0        0        0     1253 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/pf7.py
+-rw-r--r--   0        0        0     4442 2023-05-11 19:52:02.027939 malariagen_data-7.6.0/malariagen_data/pf7_config.json
+-rw-r--r--   0        0        0    11756 2023-05-11 19:52:02.031939 malariagen_data-7.6.0/malariagen_data/plasmodium.py
+-rw-r--r--   0        0        0    14253 2023-05-11 19:52:02.031939 malariagen_data-7.6.0/malariagen_data/plotly_dendrogram.py
+-rw-r--r--   0        0        0     1253 2023-05-11 19:52:02.031939 malariagen_data-7.6.0/malariagen_data/pv4.py
+-rw-r--r--   0        0        0     2060 2023-05-11 19:52:02.031939 malariagen_data-7.6.0/malariagen_data/pv4_config.json
+-rw-r--r--   0        0        0    22819 2023-05-11 19:52:02.031939 malariagen_data-7.6.0/malariagen_data/util.py
+-rw-r--r--   0        0        0    17981 2023-05-11 19:52:02.031939 malariagen_data-7.6.0/malariagen_data/veff.py
+-rw-r--r--   0        0        0     1901 2023-05-11 19:57:48.500294 malariagen_data-7.6.0/pyproject.toml
+-rw-r--r--   0        0        0     1195 1970-01-01 00:00:00.000000 malariagen_data-7.6.0/PKG-INFO
```

### Comparing `malariagen_data-7.5.0/LICENSE` & `malariagen_data-7.6.0/LICENSE`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/__init__.py` & `malariagen_data-7.6.0/malariagen_data/__init__.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/af1.py` & `malariagen_data-7.6.0/malariagen_data/af1.py`

 * *Files 4% similar despite different names*

```diff
@@ -81,16 +81,14 @@
     _h12_gwss_cache_name = H12_GWSS_CACHE_NAME
     _g123_gwss_cache_name = G123_GWSS_CACHE_NAME
     _g123_calibration_cache_name = G123_CALIBRATION_CACHE_NAME
     _h1x_gwss_cache_name = H1X_GWSS_CACHE_NAME
     _ihs_gwss_cache_name = IHS_GWSS_CACHE_NAME
     site_mask_ids = ("funestus",)
     _default_site_mask = DEFAULT_SITE_MASK
-    _cohorts_analysis = None
-    _site_filters_analysis = None
     phasing_analysis_ids = ("funestus",)
     _default_phasing_analysis = "funestus"
 
     def __init__(
         self,
         url=GCS_URL,
         bokeh_output_notebook=True,
@@ -104,14 +102,16 @@
         pre=False,
         **storage_options,  # used by fsspec via init_filesystem()
     ):
         super().__init__(
             url=url,
             config_path=CONFIG_PATH,
             cohorts_analysis=cohorts_analysis,
+            aim_analysis=None,
+            aim_metadata_dtype=None,
             site_filters_analysis=site_filters_analysis,
             bokeh_output_notebook=bokeh_output_notebook,
             results_cache=results_cache,
             log=log,
             debug=debug,
             show_progress=show_progress,
             check_location=check_location,
@@ -216,20 +216,14 @@
                         <td>{self.client_location}</td>
                     </tr>
                 </tbody>
             </table>
         """
         return html
 
-    def _sample_metadata(self, *, sample_set):
-        df = self._read_general_metadata(sample_set=sample_set)
-        df_cohorts = self._read_cohort_metadata(sample_set=sample_set)
-        df = df.merge(df_cohorts, on="sample_id", sort=False)
-        return df
-
     def _transcript_to_gene_name(self, transcript):
         df_genome_features = self.genome_features().set_index("ID")
         rec_transcript = df_genome_features.loc[transcript]
         parent = rec_transcript["Parent"]
 
         # E.g. manual overrides (used in Ag3)
         # if parent == "AGAP004707":
```

### Comparing `malariagen_data-7.5.0/malariagen_data/ag3.py` & `malariagen_data-7.6.0/malariagen_data/ag3.py`

 * *Files 8% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 from .anopheles import AnophelesDataResource, gplt_params
 from .util import (
     DIM_SAMPLE,
     DIM_VARIANT,
     Region,
     da_from_zarr,
     init_zarr_store,
-    xarray_concat,
+    simple_xarray_concat,
 )
 
 # silence dask performance warnings
 dask.config.set(**{"array.slicing.split_large_chunks": False})  # type: ignore
 
 MAJOR_VERSION_NUMBER = 3
 MAJOR_VERSION_PATH = "v3"
@@ -124,23 +124,32 @@
         bokeh_output_notebook=True,
         results_cache=None,
         log=sys.stdout,
         debug=False,
         show_progress=True,
         check_location=True,
         cohorts_analysis=None,
-        species_analysis=None,
+        aim_analysis=None,
         site_filters_analysis=None,
         pre=False,
         **storage_options,  # used by fsspec via init_filesystem()
     ):
         super().__init__(
             url=url,
             config_path=CONFIG_PATH,
             cohorts_analysis=cohorts_analysis,
+            aim_analysis=aim_analysis,
+            aim_metadata_dtype={
+                "aim_species_fraction_arab": "float64",
+                "aim_species_fraction_colu": "float64",
+                "aim_species_fraction_colu_no2l": "float64",
+                "aim_species_gambcolu_arabiensis": object,
+                "aim_species_gambiae_coluzzii": object,
+                "aim_species": object,
+            },
             site_filters_analysis=site_filters_analysis,
             bokeh_output_notebook=bokeh_output_notebook,
             results_cache=results_cache,
             log=log,
             debug=debug,
             show_progress=show_progress,
             check_location=check_location,
@@ -149,23 +158,15 @@
             major_version_number=MAJOR_VERSION_NUMBER,
             major_version_path=MAJOR_VERSION_PATH,
             gff_gene_type="gene",
             gff_default_attributes=("ID", "Parent", "Name", "description"),
             storage_options=storage_options,  # used by fsspec via init_filesystem()
         )
 
-        # set species analysis version - this is Ag specific currently, hence
-        # not in parent class
-        if species_analysis is None:
-            self._species_analysis = self._config["DEFAULT_SPECIES_ANALYSIS"]
-        else:
-            self._species_analysis = species_analysis
-
         # set up caches
-        self._cache_species_calls = dict()
         self._cache_cross_metadata = None
         self._cache_cnv_hmm = dict()
         self._cache_cnv_coverage_calls = dict()
         self._cache_cnv_discordant_read_calls = dict()
         self._cache_aim_variants = dict()
 
     @property
@@ -204,15 +205,15 @@
     def __repr__(self):
         text = (
             f"<MalariaGEN Ag3 API client>\n"
             f"Storage URL             : {self._url}\n"
             f"Data releases available : {', '.join(self.releases)}\n"
             f"Results cache           : {self._results_cache}\n"
             f"Cohorts analysis        : {self._cohorts_analysis}\n"
-            f"Species analysis        : {self._species_analysis}\n"
+            f"AIM analysis            : {self._aim_analysis}\n"
             f"Site filters analysis   : {self._site_filters_analysis}\n"
             f"Software version        : malariagen_data {malariagen_data.__version__}\n"
             f"Client location         : {self.client_location}\n"
             f"---\n"
             f"Please note that data are subject to terms of use,\n"
             f"for more information see https://www.malariagen.net/data\n"
             f"or contact data@malariagen.net. For API documentation see \n"
@@ -257,17 +258,17 @@
                         <th style="text-align: left">
                             Cohorts analysis
                         </th>
                         <td>{self._cohorts_analysis}</td>
                     </tr>
                     <tr>
                         <th style="text-align: left">
-                            Species analysis
+                            AIM analysis
                         </th>
-                        <td>{self._species_analysis}</td>
+                        <td>{self._aim_analysis}</td>
                     </tr>
                     <tr>
                         <th style="text-align: left">
                             Site filters analysis
                         </th>
                         <td>{self._site_filters_analysis}</td>
                     </tr>
@@ -284,185 +285,14 @@
                         <td>{self.client_location}</td>
                     </tr>
                 </tbody>
             </table>
         """
         return html
 
-    def _read_species_calls(self, *, sample_set):
-        """Read species calls for a single sample set."""
-        key = sample_set
-        try:
-            df = self._cache_species_calls[key]
-
-        except KeyError:
-            release = self.lookup_release(sample_set=sample_set)
-            release_path = self._release_to_path(release)
-            path_prefix = f"{self._base_path}/{release_path}/metadata"
-            if self._species_analysis == "aim_20220528":
-                path = f"{path_prefix}/species_calls_aim_20220528/{sample_set}/samples.species_aim.csv"
-                dtype = {
-                    "aim_species_gambcolu_arabiensis": object,
-                    "aim_species_gambiae_coluzzii": object,
-                    "aim_species": object,
-                }
-                # Specify species_cols in case the file is missing
-                species_cols = (
-                    "aim_species_fraction_arab",
-                    "aim_species_fraction_colu",
-                    "aim_species_fraction_colu_no2L",
-                    "aim_species_gambcolu_arabiensis",
-                    "aim_species_gambiae_coluzzii",
-                    "aim_species",
-                )
-            elif self._species_analysis == "aim_20200422":
-                # TODO this is legacy, deprecate at some point
-                path = f"{path_prefix}/species_calls_20200422/{sample_set}/samples.species_aim.csv"
-                dtype = {
-                    "species_gambcolu_arabiensis": object,
-                    "species_gambiae_coluzzii": object,
-                }
-                # Specify species_cols in case the file is missing
-                # N.B., these legacy column prefixes will be normalised downstream
-                species_cols = (
-                    "aim_fraction_colu",
-                    "aim_fraction_arab",
-                    "species_gambcolu_arabiensis",
-                    "species_gambiae_coluzzii",
-                )
-            elif self._species_analysis == "pca_20200422":
-                # TODO this is legacy, deprecate at some point
-                path = f"{path_prefix}/species_calls_20200422/{sample_set}/samples.species_pca.csv"
-                dtype = {
-                    "species_gambcolu_arabiensis": object,
-                    "species_gambiae_coluzzii": object,
-                }
-                # Specify species_cols in case the file is missing
-                # N.B., these legacy column prefixes will be normalised downstream
-                species_cols = (
-                    "PC1",
-                    "PC2",
-                    "species_gambcolu_arabiensis",
-                    "species_gambiae_coluzzii",
-                )
-            else:
-                raise ValueError(
-                    f"Unknown species calling analysis: {self._species_analysis!r}"
-                )
-
-            # N.B., species calls do not always exist, need to handle FileNotFoundError
-            try:
-                with self._fs.open(path) as f:
-                    df = pd.read_csv(
-                        f,
-                        na_values=["", "NA"],
-                        # ensure correct dtype even where all values are missing
-                        dtype=dtype,
-                    )
-            except FileNotFoundError:
-                # Get sample ids as an index via general metadata (has caching)
-                df_general = self._read_general_metadata(sample_set=sample_set)
-                df_general.set_index("sample_id", inplace=True)
-
-                # Create a blank DataFrame with species_cols and sample_id index
-                df = pd.DataFrame(columns=species_cols, index=df_general.index.copy())
-
-                # Revert sample_id index to column
-                df.reset_index(inplace=True)
-
-            # add a single species call column, for convenience
-            def consolidate_species(s):
-                species_gambcolu_arabiensis = s["species_gambcolu_arabiensis"]
-                species_gambiae_coluzzii = s["species_gambiae_coluzzii"]
-                if species_gambcolu_arabiensis == "arabiensis":
-                    return "arabiensis"
-                elif species_gambcolu_arabiensis == "intermediate":
-                    return "intermediate_arabiensis_gambiae"
-                elif species_gambcolu_arabiensis == "gamb_colu":
-                    # look at gambiae_vs_coluzzii
-                    if species_gambiae_coluzzii == "gambiae":
-                        return "gambiae"
-                    elif species_gambiae_coluzzii == "coluzzii":
-                        return "coluzzii"
-                    elif species_gambiae_coluzzii == "intermediate":
-                        return "intermediate_gambiae_coluzzii"
-                else:
-                    # some individuals, e.g., crosses, have a missing species call
-                    return np.nan
-
-            if self._species_analysis == "aim_20200422":
-                # TODO this is legacy, deprecate at some point
-                df["species"] = df.apply(consolidate_species, axis=1)
-                # normalise column prefixes
-                df = df.rename(
-                    columns={
-                        "aim_fraction_arab": "aim_species_fraction_arab",
-                        "aim_fraction_colu": "aim_species_fraction_colu",
-                        "species_gambcolu_arabiensis": "aim_species_gambcolu_arabiensis",
-                        "species_gambiae_coluzzii": "aim_species_gambiae_coluzzii",
-                        "species": "aim_species",
-                    }
-                )
-            elif self._species_analysis == "pca_20200422":
-                # TODO this is legacy, deprecate at some point
-                df["species"] = df.apply(consolidate_species, axis=1)
-                # normalise column prefixes
-                df = df.rename(
-                    # normalise column prefixes
-                    columns={
-                        "PC1": "pca_species_PC1",
-                        "PC2": "pca_species_PC2",
-                        "species_gambcolu_arabiensis": "pca_species_gambcolu_arabiensis",
-                        "species_gambiae_coluzzii": "pca_species_gambiae_coluzzii",
-                        "species": "pca_species",
-                    }
-                )
-
-            # ensure all column names are lower case
-            df.columns = [c.lower() for c in df.columns]
-
-            self._cache_species_calls[key] = df
-
-        return df.copy()
-
-    def species_calls(self, sample_sets=None):
-        """Access species calls for one or more sample sets.
-
-        Parameters
-        ----------
-        sample_sets : str or list of str, optional
-            Can be a sample set identifier (e.g., "AG1000G-AO") or a list of
-            sample set identifiers (e.g., ["AG1000G-BF-A", "AG1000G-BF-B"] or a
-            release identifier (e.g., "3.0") or a list of release identifiers.
-
-        Returns
-        -------
-        df : pandas.DataFrame
-            A dataframe of species calls for one or more sample sets, one row
-            per sample.
-
-        """
-
-        sample_sets = self._prep_sample_sets_param(sample_sets=sample_sets)
-
-        # concatenate multiple sample sets
-        dfs = [self._read_species_calls(sample_set=s) for s in sample_sets]
-        df = pd.concat(dfs, axis=0, ignore_index=True)
-
-        return df
-
-    # TODO: generalise (species, cohorts) so we can abstract to parent class
-    def _sample_metadata(self, *, sample_set):
-        df = self._read_general_metadata(sample_set=sample_set)
-        df_species = self._read_species_calls(sample_set=sample_set)
-        df = df.merge(df_species, on="sample_id", sort=False)
-        df_cohorts = self._read_cohort_metadata(sample_set=sample_set)
-        df = df.merge(df_cohorts, on="sample_id", sort=False)
-        return df
-
     def _transcript_to_gene_name(self, transcript):
         df_genome_features = self.genome_features().set_index("ID")
         rec_transcript = df_genome_features.loc[transcript]
         parent = rec_transcript["Parent"]
         rec_parent = df_genome_features.loc[parent]
 
         # manual overrides
@@ -629,15 +459,15 @@
             ds_l = super()._snp_calls_for_contig(
                 contig=contig_l,
                 sample_set=sample_set,
                 inline_array=inline_array,
                 chunks=chunks,
             )
 
-            ds = xr.concat([ds_r, ds_l], dim=DIM_VARIANT)
+            ds = simple_xarray_concat([ds_r, ds_l], dim=DIM_VARIANT)
 
             return ds
 
         return super()._snp_calls_for_contig(
             contig=contig,
             sample_set=sample_set,
             inline_array=inline_array,
@@ -659,15 +489,15 @@
                 contig=contig_l,
                 inline_array=inline_array,
                 chunks=chunks,
             )
             max_r = super().genome_sequence(region=contig_r).shape[0]
             ds_l["variant_position"] = ds_l["variant_position"] + max_r
 
-            ds = xr.concat([ds_r, ds_l], dim=DIM_VARIANT)
+            ds = simple_xarray_concat([ds_r, ds_l], dim=DIM_VARIANT)
 
             return ds
 
         return super()._snp_variants_for_contig(
             contig=contig,
             inline_array=inline_array,
             chunks=chunks,
@@ -732,15 +562,15 @@
             )
 
             # handle case where no haplotypes available for given sample set
             # then convert genome coordinates
             if ds_l is not None:
                 max_r = super().genome_sequence(region=contig_r).shape[0]
                 ds_l["variant_position"] = ds_l["variant_position"] + max_r
-                ds = xr.concat([ds_r, ds_l], dim=DIM_VARIANT)
+                ds = simple_xarray_concat([ds_r, ds_l], dim=DIM_VARIANT)
                 return ds
 
             return None
 
         return super()._haplotypes_for_contig(
             contig=contig,
             sample_set=sample_set,
@@ -901,30 +731,30 @@
                     sample_set=s,
                     inline_array=inline_array,
                     chunks=chunks,
                 )
                 ly.append(y)
 
             debug("concatenate data from multiple sample sets")
-            x = xarray_concat(ly, dim=DIM_SAMPLE)
+            x = simple_xarray_concat(ly, dim=DIM_SAMPLE)
 
             debug("handle region, do this only once - optimisation")
             if r.start is not None or r.end is not None:
                 start = x["variant_position"].values
                 end = x["variant_end"].values
                 index = pd.IntervalIndex.from_arrays(start, end, closed="both")
                 # noinspection PyArgumentList
                 other = pd.Interval(r.start, r.end, closed="both")
                 loc_region = index.overlaps(other)
                 x = x.isel(variants=loc_region)
 
             lx.append(x)
 
         debug("concatenate data from multiple regions")
-        ds = xarray_concat(lx, dim=DIM_VARIANT)
+        ds = simple_xarray_concat(lx, dim=DIM_VARIANT)
 
         debug("handle sample query")
         if sample_query is not None:
             debug("load sample metadata")
             df_samples = self.sample_metadata(sample_sets=sample_sets)
 
             debug("align sample metadata with CNV data")
@@ -1130,15 +960,15 @@
                 index = pd.IntervalIndex.from_arrays(start, end, closed="both")
                 # noinspection PyArgumentList
                 other = pd.Interval(r.start, r.end, closed="both")
                 loc_region = index.overlaps(other)
                 x = x.isel(variants=loc_region)
 
             lx.append(x)
-        ds = xarray_concat(lx, dim=DIM_VARIANT)
+        ds = simple_xarray_concat(lx, dim=DIM_VARIANT)
 
         return ds
 
     def open_cnv_discordant_read_calls(self, sample_set):
         """Open CNV discordant read calls zarr.
 
         Parameters
@@ -1288,18 +1118,18 @@
                     contig=c,
                     sample_set=s,
                     inline_array=inline_array,
                     chunks=chunks,
                 )
                 ly.append(y)
 
-            x = xarray_concat(ly, dim=DIM_SAMPLE)
+            x = simple_xarray_concat(ly, dim=DIM_SAMPLE)
             lx.append(x)
 
-        ds = xarray_concat(lx, dim=DIM_VARIANT)
+        ds = simple_xarray_concat(lx, dim=DIM_VARIANT)
 
         return ds
 
     def gene_cnv(
         self,
         region,
         sample_sets=None,
@@ -1333,15 +1163,15 @@
 
         """
 
         region = self.resolve_region(region)
         if isinstance(region, Region):
             region = [region]
 
-        ds = xarray_concat(
+        ds = simple_xarray_concat(
             [
                 self._gene_cnv(
                     region=r,
                     sample_sets=sample_sets,
                     sample_query=sample_query,
                     max_coverage_variance=max_coverage_variance,
                 )
@@ -1723,15 +1553,15 @@
 
         self._check_param_min_cohort_size(min_cohort_size)
 
         region = self.resolve_region(region)
         if isinstance(region, Region):
             region = [region]
 
-        ds = xarray_concat(
+        ds = simple_xarray_concat(
             [
                 self._gene_cnv_frequencies_advanced(
                     region=r,
                     area_by=area_by,
                     period_by=period_by,
                     sample_sets=sample_sets,
                     sample_query=sample_query,
@@ -2415,16 +2245,16 @@
                     "*": "#ef553b",
                 },
             }
             tracks.append(track_config)
 
     def _results_cache_add_analysis_params(self, params):
         super()._results_cache_add_analysis_params(params)
-        # override parent class to add species analysis
-        params["species_analysis"] = self._species_analysis
+        # override parent class to add AIM analysis
+        params["aim_analysis"] = self._aim_analysis
 
     def aim_variants(self, aims):
         """Open ancestry informative marker variants.
 
         Parameters
         ----------
         aims : {'gamb_vs_colu', 'gambcolu_vs_arab'}
@@ -2493,15 +2323,15 @@
             y = self._aim_calls_dataset(
                 aims=aims,
                 sample_set=s,
             )
             ly.append(y)
 
         debug("concatenate data from multiple sample sets")
-        ds = xarray_concat(ly, dim=DIM_SAMPLE)
+        ds = simple_xarray_concat(ly, dim=DIM_SAMPLE)
 
         debug("handle sample query")
         if sample_query is not None:
             df_samples = self.sample_metadata(sample_sets=sample_sets)
             loc_samples = df_samples.eval(sample_query).values
             if np.count_nonzero(loc_samples) == 0:
                 raise ValueError(f"No samples found for query {sample_query!r}")
```

### Comparing `malariagen_data-7.5.0/malariagen_data/amin1.py` & `malariagen_data-7.6.0/malariagen_data/amin1.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,16 +12,16 @@
     da_from_zarr,
     dask_compress_dataset,
     init_filesystem,
     init_zarr_store,
     locate_region,
     read_gff3,
     resolve_region,
+    simple_xarray_concat,
     unpack_gff3_attributes,
-    xarray_concat,
 )
 
 GENOME_FEATURES_GFF3_PATH = (
     "reference/genome/aminm1/Anopheles-minimus-MINIMUS1_BASEFEATURES_AminM1.8.gff3.gz"
 )
 genome_zarr_path = "reference/genome/aminm1/VectorBase-48_AminimusMINIMUS1_Genome.zarr"
 
@@ -261,21 +261,17 @@
             self._snp_calls_dataset(
                 region=r,
                 inline_array=inline_array,
                 chunks=chunks,
             )
             for r in region
         ]
-        ds = xarray_concat(
+        ds = simple_xarray_concat(
             datasets,
             dim=DIM_VARIANT,
-            data_vars="minimal",
-            coords="minimal",
-            compat="override",
-            join="override",
         )
 
         # apply site filters
         if site_mask:
             ds = dask_compress_dataset(
                 ds, indexer="variant_filter_pass", dim=DIM_VARIANT
             )
```

### Comparing `malariagen_data-7.5.0/malariagen_data/anoph/base.py` & `malariagen_data-7.6.0/malariagen_data/anoph/base.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,9 +1,21 @@
 import json
-from typing import IO, Dict, Final, List, Mapping, Optional, Sequence, Tuple, Union
+from typing import (
+    IO,
+    Dict,
+    Final,
+    Iterable,
+    List,
+    Literal,
+    Mapping,
+    Optional,
+    Sequence,
+    Tuple,
+    Union,
+)
 
 import bokeh.io
 import pandas as pd
 from numpydoc_decorator import doc
 from typing_extensions import Annotated, TypeAlias
 
 from ..util import LoggingHelper, Region, check_colab_location, init_filesystem
@@ -193,15 +205,19 @@
         self._major_version_path = major_version_path
         self._debug = debug
         self._show_progress = show_progress
 
         # Set up logging.
         self._log = LoggingHelper(name=__name__, out=log, debug=debug)
 
-        # Set up fsspec filesystem.
+        # Set up fsspec filesystem. N.B., we use fsspec here to allow for
+        # accessing different types of storage - fsspec will automatically
+        # detect which type of storage to use based on the URL provided.
+        # E.g., if the URL begins with "gs://" then a GCSFileSystem will
+        # be used to read from Google Cloud Storage.
         if storage_options is None:
             storage_options = dict()
         self._fs, self._base_path = init_filesystem(url, **storage_options)
 
         # Lazily load config.
         self._config: Optional[Dict] = None
 
@@ -218,19 +234,61 @@
         else:
             self._client_details = None
 
         # Set up cache attributes.
         self._cache_releases: Optional[Tuple[str, ...]] = None
         self._cache_sample_sets: Dict[str, pd.DataFrame] = dict()
         self._cache_sample_set_to_release: Optional[Dict[str, str]] = None
+        self._cache_files: Dict[str, bytes] = dict()
 
-    def open_file(self, path):
+    def open_file(self, path: str) -> IO:
         full_path = f"{self._base_path}/{path}"
         return self._fs.open(full_path)
 
+    def read_files(
+        self,
+        paths: Iterable[str],
+        on_error: Literal["raise", "omit", "return"] = "return",
+    ) -> Mapping[str, bytes]:
+        # Check for any cached files.
+        files = {
+            path: data for path, data in self._cache_files.items() if path in paths
+        }
+        paths_not_cached = [p for p in paths if p not in self._cache_files]
+
+        if paths_not_cached:
+            # Prepend the base path.
+            prefix = self._base_path + "/"
+            full_paths = [prefix + path for path in paths_not_cached]
+
+            # Retrieve all files. N.B., depending on what type of storage is
+            # being used, the cat() function may be able to read multiple files
+            # concurrently. E.g., this is true if the file system is a
+            # GCSFileSystem, which achieves concurrency by using async I/O under the
+            # hood. This is a useful performance optimisation, because reading a
+            # file from GCS incurs some latency, and so reading many small files
+            # from GCS can be slow if files are not read concurrently. Hence we
+            # want to make use of cat() here and provide paths for all files to
+            # read concurrently. For more information see:
+            # https://filesystem-spec.readthedocs.io/en/latest/async.html
+            full_path_files = self._fs.cat(full_paths, on_error=on_error)
+
+            # Strip off the prefix.
+            retrieved_files = {
+                k.split(prefix, 1)[1]: v for k, v in full_path_files.items()
+            }
+
+            # Update the cache.
+            self._cache_files.update(retrieved_files)
+
+            # Add retrieved files to the result.
+            files.update(retrieved_files)
+
+        return files
+
     @property
     def config(self) -> Dict:
         if self._config is None:
             with self.open_file(self._config_path) as f:
                 self._config = json.load(f)
         return self._config.copy()
```

### Comparing `malariagen_data-7.5.0/malariagen_data/anoph/genome_features.py` & `malariagen_data-7.6.0/malariagen_data/anoph/genome_features.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/anoph/genome_sequence.py` & `malariagen_data-7.6.0/malariagen_data/anoph/genome_sequence.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/anopheles.py` & `malariagen_data-7.6.0/malariagen_data/anopheles.py`

 * *Files 2% similar despite different names*

```diff
@@ -16,17335 +16,16216 @@
 000000f0: 6f75 7473 0a69 6d70 6f72 7420 626f 6b65  outs.import boke
 00000100: 682e 6d6f 6465 6c73 0a69 6d70 6f72 7420  h.models.import 
 00000110: 626f 6b65 682e 7061 6c65 7474 6573 0a69  bokeh.palettes.i
 00000120: 6d70 6f72 7420 626f 6b65 682e 706c 6f74  mport bokeh.plot
 00000130: 7469 6e67 0a69 6d70 6f72 7420 6461 736b  ting.import dask
 00000140: 2e61 7272 6179 2061 7320 6461 0a69 6d70  .array as da.imp
 00000150: 6f72 7420 6967 765f 6e6f 7465 626f 6f6b  ort igv_notebook
-00000160: 0a69 6d70 6f72 7420 6970 796c 6561 666c  .import ipyleafl
-00000170: 6574 0a69 6d70 6f72 7420 6e75 6d62 610a  et.import numba.
-00000180: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00000190: 6e70 0a69 6d70 6f72 7420 7061 6e64 6173  np.import pandas
-000001a0: 2061 7320 7064 0a69 6d70 6f72 7420 706c   as pd.import pl
-000001b0: 6f74 6c79 2e65 7870 7265 7373 2061 7320  otly.express as 
-000001c0: 7078 0a69 6d70 6f72 7420 706c 6f74 6c79  px.import plotly
-000001d0: 2e67 7261 7068 5f6f 626a 6563 7473 2061  .graph_objects a
-000001e0: 7320 676f 0a69 6d70 6f72 7420 7861 7272  s go.import xarr
-000001f0: 6179 2061 7320 7872 0a69 6d70 6f72 7420  ay as xr.import 
-00000200: 7879 7a73 6572 7669 6365 730a 696d 706f  xyzservices.impo
-00000210: 7274 207a 6172 720a 6672 6f6d 206e 756d  rt zarr.from num
-00000220: 7079 646f 635f 6465 636f 7261 746f 7220  pydoc_decorator 
-00000230: 696d 706f 7274 2064 6f63 0a66 726f 6d20  import doc.from 
-00000240: 7471 646d 2e61 7574 6f20 696d 706f 7274  tqdm.auto import
-00000250: 2074 7164 6d0a 6672 6f6d 2074 7164 6d2e   tqdm.from tqdm.
-00000260: 6461 736b 2069 6d70 6f72 7420 5471 646d  dask import Tqdm
-00000270: 4361 6c6c 6261 636b 0a66 726f 6d20 7479  Callback.from ty
-00000280: 7069 6e67 5f65 7874 656e 7369 6f6e 7320  ping_extensions 
-00000290: 696d 706f 7274 2041 6e6e 6f74 6174 6564  import Annotated
-000002a0: 2c20 4c69 7465 7261 6c2c 2054 7970 6541  , Literal, TypeA
-000002b0: 6c69 6173 0a0a 6672 6f6d 202e 2069 6d70  lias..from . imp
-000002c0: 6f72 7420 7665 6666 0a66 726f 6d20 2e61  ort veff.from .a
-000002d0: 6e6f 7068 2e62 6173 6520 696d 706f 7274  noph.base import
-000002e0: 2044 4546 4155 4c54 2c20 416e 6f70 6865   DEFAULT, Anophe
-000002f0: 6c65 7342 6173 652c 2062 6173 655f 7061  lesBase, base_pa
-00000300: 7261 6d73 0a66 726f 6d20 2e61 6e6f 7068  rams.from .anoph
-00000310: 2e67 656e 6f6d 655f 6665 6174 7572 6573  .genome_features
-00000320: 2069 6d70 6f72 7420 416e 6f70 6865 6c65   import Anophele
-00000330: 7347 656e 6f6d 6546 6561 7475 7265 7344  sGenomeFeaturesD
-00000340: 6174 612c 2067 706c 745f 7061 7261 6d73  ata, gplt_params
-00000350: 0a66 726f 6d20 2e61 6e6f 7068 2e67 656e  .from .anoph.gen
-00000360: 6f6d 655f 7365 7175 656e 6365 2069 6d70  ome_sequence imp
-00000370: 6f72 7420 416e 6f70 6865 6c65 7347 656e  ort AnophelesGen
-00000380: 6f6d 6553 6571 7565 6e63 6544 6174 610a  omeSequenceData.
-00000390: 6672 6f6d 202e 6d6a 6e20 696d 706f 7274  from .mjn import
-000003a0: 206d 6564 6961 6e5f 6a6f 696e 696e 675f   median_joining_
-000003b0: 6e65 7477 6f72 6b2c 206d 6a6e 5f67 7261  network, mjn_gra
-000003c0: 7068 0a66 726f 6d20 2e75 7469 6c20 696d  ph.from .util im
-000003d0: 706f 7274 2028 0a20 2020 2044 494d 5f41  port (.    DIM_A
-000003e0: 4c4c 454c 452c 0a20 2020 2044 494d 5f50  LLELE,.    DIM_P
-000003f0: 4c4f 4944 592c 0a20 2020 2044 494d 5f53  LOIDY,.    DIM_S
-00000400: 414d 504c 452c 0a20 2020 2044 494d 5f56  AMPLE,.    DIM_V
-00000410: 4152 4941 4e54 2c0a 2020 2020 4361 6368  ARIANT,.    Cach
-00000420: 654d 6973 732c 0a20 2020 2052 6567 696f  eMiss,.    Regio
-00000430: 6e2c 0a20 2020 2064 615f 636f 6d70 7265  n,.    da_compre
-00000440: 7373 2c0a 2020 2020 6461 5f66 726f 6d5f  ss,.    da_from_
-00000450: 7a61 7272 2c0a 2020 2020 6461 736b 5f63  zarr,.    dask_c
-00000460: 6f6d 7072 6573 735f 6461 7461 7365 742c  ompress_dataset,
-00000470: 0a20 2020 2068 6173 685f 7061 7261 6d73  .    hash_params
-00000480: 2c0a 2020 2020 696e 6974 5f7a 6172 725f  ,.    init_zarr_
-00000490: 7374 6f72 652c 0a20 2020 206a 6163 6b6b  store,.    jackk
-000004a0: 6e69 6665 5f63 692c 0a20 2020 206a 6974  nife_ci,.    jit
-000004b0: 7465 722c 0a20 2020 206c 6f63 6174 655f  ter,.    locate_
-000004c0: 7265 6769 6f6e 2c0a 2020 2020 706c 6f74  region,.    plot
-000004d0: 6c79 5f64 6973 6372 6574 655f 6c65 6765  ly_discrete_lege
-000004e0: 6e64 2c0a 2020 2020 7265 736f 6c76 655f  nd,.    resolve_
-000004f0: 7265 6769 6f6e 2c0a 2020 2020 7479 7065  region,.    type
-00000500: 5f65 7272 6f72 2c0a 2020 2020 7861 7272  _error,.    xarr
-00000510: 6179 5f63 6f6e 6361 742c 0a29 0a0a 4141  ay_concat,.)..AA
-00000520: 5f43 4841 4e47 455f 5155 4552 5920 3d20  _CHANGE_QUERY = 
-00000530: 280a 2020 2020 2265 6666 6563 7420 696e  (.    "effect in
-00000540: 205b 274e 4f4e 5f53 594e 4f4e 594d 4f55   ['NON_SYNONYMOU
-00000550: 535f 434f 4449 4e47 272c 2027 5354 4152  S_CODING', 'STAR
-00000560: 545f 4c4f 5354 272c 2027 5354 4f50 5f4c  T_LOST', 'STOP_L
-00000570: 4f53 5427 2c20 2753 544f 505f 4741 494e  OST', 'STOP_GAIN
-00000580: 4544 275d 220a 290a 0a0a 636c 6173 7320  ED']".)...class 
-00000590: 6861 705f 7061 7261 6d73 3a0a 2020 2020  hap_params:.    
-000005a0: 2222 2250 6172 616d 6574 6572 2064 6566  """Parameter def
-000005b0: 696e 6974 696f 6e73 2066 6f72 2068 6170  initions for hap
-000005c0: 6c6f 7479 7065 2066 756e 6374 696f 6e73  lotype functions
-000005d0: 2e22 2222 0a0a 2020 2020 616e 616c 7973  ."""..    analys
-000005e0: 6973 3a20 5479 7065 416c 6961 7320 3d20  is: TypeAlias = 
-000005f0: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
-00000600: 2020 2073 7472 2c0a 2020 2020 2020 2020     str,.        
-00000610: 2222 220a 2020 2020 2020 2020 5768 6963  """.        Whic
-00000620: 6820 6861 706c 6f74 7970 6520 7068 6173  h haplotype phas
-00000630: 696e 6720 616e 616c 7973 6973 2074 6f20  ing analysis to 
-00000640: 7573 652e 2053 6565 2074 6865 0a20 2020  use. See the.   
-00000650: 2020 2020 2060 7068 6173 696e 675f 616e       `phasing_an
-00000660: 616c 7973 6973 5f69 6473 6020 7072 6f70  alysis_ids` prop
-00000670: 6572 7479 2066 6f72 2061 7661 696c 6162  erty for availab
-00000680: 6c65 2076 616c 7565 732e 0a20 2020 2020  le values..     
-00000690: 2020 2022 2222 2c0a 2020 2020 5d0a 0a0a     """,.    ]...
-000006a0: 636c 6173 7320 6831 325f 7061 7261 6d73  class h12_params
-000006b0: 3a0a 2020 2020 2222 2250 6172 616d 6574  :.    """Paramet
-000006c0: 6572 2064 6566 696e 6974 696f 6e73 2066  er definitions f
-000006d0: 6f72 2048 3132 2061 6e61 6c79 7369 7320  or H12 analysis 
-000006e0: 6675 6e63 7469 6f6e 732e 2222 220a 0a20  functions.""".. 
-000006f0: 2020 2077 696e 646f 775f 7369 7a65 733a     window_sizes:
-00000700: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
-00000710: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
-00000720: 5475 706c 655b 696e 742c 202e 2e2e 5d2c  Tuple[int, ...],
-00000730: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00000740: 2020 2020 2054 6865 2073 697a 6573 206f       The sizes o
-00000750: 6620 7769 6e64 6f77 7320 286e 756d 6265  f windows (numbe
-00000760: 7220 6f66 2053 4e50 7329 2075 7365 6420  r of SNPs) used 
-00000770: 746f 2063 616c 6375 6c61 7465 2073 7461  to calculate sta
-00000780: 7469 7374 6963 7320 7769 7468 696e 2e0a  tistics within..
-00000790: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-000007a0: 205d 0a20 2020 2077 696e 646f 775f 7369   ].    window_si
-000007b0: 7a65 735f 6465 6661 756c 743a 2077 696e  zes_default: win
-000007c0: 646f 775f 7369 7a65 7320 3d20 2831 3030  dow_sizes = (100
-000007d0: 2c20 3230 302c 2035 3030 2c20 3130 3030  , 200, 500, 1000
-000007e0: 2c20 3230 3030 2c20 3530 3030 2c20 3130  , 2000, 5000, 10
-000007f0: 3030 302c 2032 3030 3030 290a 2020 2020  000, 20000).    
-00000800: 7769 6e64 6f77 5f73 697a 653a 2054 7970  window_size: Typ
-00000810: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-00000820: 6564 5b0a 2020 2020 2020 2020 696e 742c  ed[.        int,
-00000830: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00000840: 2020 2020 2054 6865 2073 697a 6520 6f66       The size of
-00000850: 2077 696e 646f 7773 2028 6e75 6d62 6572   windows (number
-00000860: 206f 6620 534e 5073 2920 7573 6564 2074   of SNPs) used t
-00000870: 6f20 6361 6c63 756c 6174 6520 7374 6174  o calculate stat
-00000880: 6973 7469 6373 2077 6974 6869 6e2e 0a20  istics within.. 
-00000890: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-000008a0: 5d0a 2020 2020 636f 686f 7274 5f73 697a  ].    cohort_siz
-000008b0: 655f 6465 6661 756c 743a 204f 7074 696f  e_default: Optio
-000008c0: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-000008d0: 636f 686f 7274 5f73 697a 655d 203d 204e  cohort_size] = N
-000008e0: 6f6e 650a 2020 2020 6d69 6e5f 636f 686f  one.    min_coho
-000008f0: 7274 5f73 697a 655f 6465 6661 756c 743a  rt_size_default:
-00000900: 2062 6173 655f 7061 7261 6d73 2e6d 696e   base_params.min
-00000910: 5f63 6f68 6f72 745f 7369 7a65 203d 2031  _cohort_size = 1
-00000920: 350a 2020 2020 6d61 785f 636f 686f 7274  5.    max_cohort
-00000930: 5f73 697a 655f 6465 6661 756c 743a 2062  _size_default: b
-00000940: 6173 655f 7061 7261 6d73 2e6d 6178 5f63  ase_params.max_c
-00000950: 6f68 6f72 745f 7369 7a65 203d 2035 300a  ohort_size = 50.
-00000960: 0a0a 636c 6173 7320 6731 3233 5f70 6172  ..class g123_par
-00000970: 616d 733a 0a20 2020 2022 2222 5061 7261  ams:.    """Para
-00000980: 6d65 7465 7220 6465 6669 6e69 7469 6f6e  meter definition
-00000990: 7320 666f 7220 4731 3233 2061 6e61 6c79  s for G123 analy
-000009a0: 7369 7320 6675 6e63 7469 6f6e 732e 2222  sis functions.""
-000009b0: 220a 0a20 2020 2073 6974 6573 3a20 5479  "..    sites: Ty
-000009c0: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-000009d0: 7465 645b 0a20 2020 2020 2020 2073 7472  ted[.        str
-000009e0: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
-000009f0: 2020 2020 2020 5768 6963 6820 7369 7465        Which site
-00000a00: 7320 746f 2075 7365 3a20 2761 6c6c 2720  s to use: 'all' 
-00000a10: 696e 636c 7564 6573 2061 6c6c 2073 6974  includes all sit
-00000a20: 6573 2074 6861 7420 7061 7373 0a20 2020  es that pass.   
-00000a30: 2020 2020 2073 6974 6520 6669 6c74 6572       site filter
-00000a40: 733b 2027 7365 6772 6567 6174 696e 6727  s; 'segregating'
-00000a50: 2069 6e63 6c75 6465 7320 6f6e 6c79 2073   includes only s
-00000a60: 6567 7265 6761 7469 6e67 2073 6974 6573  egregating sites
-00000a70: 2066 6f72 0a20 2020 2020 2020 2074 6865   for.        the
-00000a80: 2067 6976 656e 2063 6f68 6f72 743b 206f   given cohort; o
-00000a90: 7220 6120 7068 6173 696e 6720 616e 616c  r a phasing anal
-00000aa0: 7973 6973 2069 6465 6e74 6966 6965 7220  ysis identifier 
-00000ab0: 6361 6e20 6265 0a20 2020 2020 2020 2070  can be.        p
-00000ac0: 726f 7669 6465 6420 746f 2075 7365 2073  rovided to use s
-00000ad0: 6974 6573 2066 726f 6d20 7468 6520 6861  ites from the ha
-00000ae0: 706c 6f74 7970 6520 6461 7461 2c20 7768  plotype data, wh
-00000af0: 6963 6820 6973 2061 6e0a 2020 2020 2020  ich is an.      
-00000b00: 2020 6170 7072 6f78 696d 6174 696f 6e20    approximation 
-00000b10: 746f 2066 696e 6469 6e67 2073 6567 7265  to finding segre
-00000b20: 6761 7469 6e67 2073 6974 6573 2069 6e20  gating sites in 
-00000b30: 7468 6520 656e 7469 7265 2041 6733 2e30  the entire Ag3.0
-00000b40: 0a20 2020 2020 2020 2028 6761 6d62 6961  .        (gambia
-00000b50: 6520 636f 6d70 6c65 7829 206f 7220 4166  e complex) or Af
-00000b60: 312e 3020 2866 756e 6573 7475 7329 2063  1.0 (funestus) c
-00000b70: 6f68 6f72 742e 0a20 2020 2020 2020 2022  ohort..        "
-00000b80: 2222 2c0a 2020 2020 5d0a 2020 2020 7769  "",.    ].    wi
-00000b90: 6e64 6f77 5f73 697a 6573 3a20 5479 7065  ndow_sizes: Type
-00000ba0: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
-00000bb0: 645b 0a20 2020 2020 2020 2054 7570 6c65  d[.        Tuple
-00000bc0: 5b69 6e74 2c20 2e2e 2e5d 2c0a 2020 2020  [int, ...],.    
-00000bd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00000be0: 5468 6520 7369 7a65 7320 6f66 2077 696e  The sizes of win
-00000bf0: 646f 7773 2028 6e75 6d62 6572 206f 6620  dows (number of 
-00000c00: 7369 7465 7329 2075 7365 6420 746f 2063  sites) used to c
-00000c10: 616c 6375 6c61 7465 2073 7461 7469 7374  alculate statist
-00000c20: 6963 7320 7769 7468 696e 2e0a 2020 2020  ics within..    
-00000c30: 2020 2020 2222 222c 0a20 2020 205d 0a20      """,.    ]. 
-00000c40: 2020 2077 696e 646f 775f 7369 7a65 735f     window_sizes_
-00000c50: 6465 6661 756c 743a 2077 696e 646f 775f  default: window_
-00000c60: 7369 7a65 7320 3d20 2831 3030 2c20 3230  sizes = (100, 20
-00000c70: 302c 2035 3030 2c20 3130 3030 2c20 3230  0, 500, 1000, 20
-00000c80: 3030 2c20 3530 3030 2c20 3130 3030 302c  00, 5000, 10000,
-00000c90: 2032 3030 3030 290a 2020 2020 7769 6e64   20000).    wind
-00000ca0: 6f77 5f73 697a 653a 2054 7970 6541 6c69  ow_size: TypeAli
-00000cb0: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
-00000cc0: 2020 2020 2020 2020 696e 742c 0a20 2020          int,.   
-00000cd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00000ce0: 2054 6865 2073 697a 6520 6f66 2077 696e   The size of win
-00000cf0: 646f 7773 2028 6e75 6d62 6572 206f 6620  dows (number of 
-00000d00: 7369 7465 7329 2075 7365 6420 746f 2063  sites) used to c
-00000d10: 616c 6375 6c61 7465 2073 7461 7469 7374  alculate statist
-00000d20: 6963 7320 7769 7468 696e 2e0a 2020 2020  ics within..    
-00000d30: 2020 2020 2222 222c 0a20 2020 205d 0a20      """,.    ]. 
-00000d40: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-00000d50: 7a65 5f64 6566 6175 6c74 3a20 6261 7365  ze_default: base
-00000d60: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
-00000d70: 7274 5f73 697a 6520 3d20 3230 0a20 2020  rt_size = 20.   
-00000d80: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
-00000d90: 5f64 6566 6175 6c74 3a20 6261 7365 5f70  _default: base_p
-00000da0: 6172 616d 732e 6d61 785f 636f 686f 7274  arams.max_cohort
-00000db0: 5f73 697a 6520 3d20 3530 0a0a 0a63 6c61  _size = 50...cla
-00000dc0: 7373 2066 7374 5f70 6172 616d 733a 0a20  ss fst_params:. 
-00000dd0: 2020 2022 2222 5061 7261 6d65 7465 7220     """Parameter 
-00000de0: 6465 6669 6e69 7469 6f6e 7320 666f 7220  definitions for 
-00000df0: 4673 7420 6675 6e63 7469 6f6e 732e 2222  Fst functions.""
-00000e00: 220a 0a20 2020 2023 204e 2e42 2e2c 2077  "..    # N.B., w
-00000e10: 696e 646f 7720 7369 7a65 2063 616e 206d  indow size can m
-00000e20: 6561 6e20 6469 6666 6572 656e 7420 7468  ean different th
-00000e30: 696e 6773 2066 6f72 2064 6966 6665 7265  ings for differe
-00000e40: 6e74 2066 756e 6374 696f 6e73 0a20 2020  nt functions.   
-00000e50: 2077 696e 646f 775f 7369 7a65 3a20 5479   window_size: Ty
-00000e60: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00000e70: 7465 645b 0a20 2020 2020 2020 2069 6e74  ted[.        int
-00000e80: 2c0a 2020 2020 2020 2020 2254 6865 2073  ,.        "The s
-00000e90: 697a 6520 6f66 2077 696e 646f 7773 2028  ize of windows (
-00000ea0: 6e75 6d62 6572 206f 6620 7369 7465 7329  number of sites)
-00000eb0: 2075 7365 6420 746f 2063 616c 6375 6c61   used to calcula
-00000ec0: 7465 2073 7461 7469 7374 6963 7320 7769  te statistics wi
-00000ed0: 7468 696e 2e22 2c0a 2020 2020 5d0a 2020  thin.",.    ].  
-00000ee0: 2020 636f 686f 7274 5f73 697a 655f 6465    cohort_size_de
-00000ef0: 6661 756c 743a 204f 7074 696f 6e61 6c5b  fault: Optional[
-00000f00: 6261 7365 5f70 6172 616d 732e 636f 686f  base_params.coho
-00000f10: 7274 5f73 697a 655d 203d 204e 6f6e 650a  rt_size] = None.
-00000f20: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
-00000f30: 697a 655f 6465 6661 756c 743a 2062 6173  ize_default: bas
-00000f40: 655f 7061 7261 6d73 2e6d 696e 5f63 6f68  e_params.min_coh
-00000f50: 6f72 745f 7369 7a65 203d 2031 350a 2020  ort_size = 15.  
-00000f60: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
-00000f70: 655f 6465 6661 756c 743a 2062 6173 655f  e_default: base_
-00000f80: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
-00000f90: 745f 7369 7a65 203d 2035 300a 0a0a 636c  t_size = 50...cl
-00000fa0: 6173 7320 6672 715f 7061 7261 6d73 3a0a  ass frq_params:.
-00000fb0: 2020 2020 2222 2250 6172 616d 6574 6572      """Parameter
-00000fc0: 2064 6566 696e 6974 696f 6e73 2066 6f72   definitions for
-00000fd0: 2066 756e 6374 696f 6e73 2063 6f6d 7075   functions compu
-00000fe0: 7469 6e67 2061 6e64 2070 6c6f 7474 696e  ting and plottin
-00000ff0: 6720 616c 6c65 6c65 2066 7265 7175 656e  g allele frequen
-00001000: 6369 6573 2e22 2222 0a0a 2020 2020 6472  cies."""..    dr
-00001010: 6f70 5f69 6e76 6172 6961 6e74 3a20 5479  op_invariant: Ty
-00001020: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00001030: 7465 645b 0a20 2020 2020 2020 2062 6f6f  ted[.        boo
-00001040: 6c2c 0a20 2020 2020 2020 2022 2222 0a20  l,.        """. 
-00001050: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00001060: 6472 6f70 2076 6172 6961 6e74 7320 6e6f  drop variants no
-00001070: 7420 6f62 7365 7276 6564 2069 6e20 7468  t observed in th
-00001080: 6520 7365 6c65 6374 6564 2073 616d 706c  e selected sampl
-00001090: 6573 2e0a 2020 2020 2020 2020 2222 222c  es..        """,
-000010a0: 0a20 2020 205d 0a20 2020 2065 6666 6563  .    ].    effec
-000010b0: 7473 3a20 5479 7065 416c 6961 7320 3d20  ts: TypeAlias = 
-000010c0: 416e 6e6f 7461 7465 645b 626f 6f6c 2c20  Annotated[bool, 
-000010d0: 2249 6620 5472 7565 2c20 6164 6420 534e  "If True, add SN
-000010e0: 5020 6566 6665 6374 2061 6e6e 6f74 6174  P effect annotat
-000010f0: 696f 6e73 2e22 5d0a 2020 2020 6172 6561  ions."].    area
-00001100: 5f62 793a 2054 7970 6541 6c69 6173 203d  _by: TypeAlias =
-00001110: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-00001120: 2020 2020 7374 722c 0a20 2020 2020 2020      str,.       
-00001130: 2022 2222 0a20 2020 2020 2020 2043 6f6c   """.        Col
-00001140: 756d 6e20 6e61 6d65 2069 6e20 7468 6520  umn name in the 
-00001150: 7361 6d70 6c65 206d 6574 6164 6174 6120  sample metadata 
-00001160: 746f 2075 7365 2074 6f20 6772 6f75 7020  to use to group 
-00001170: 7361 6d70 6c65 7320 7370 6174 6961 6c6c  samples spatiall
-00001180: 792e 2045 2e67 2e2c 0a20 2020 2020 2020  y. E.g.,.       
-00001190: 2075 7365 2022 6164 6d69 6e31 5f69 736f   use "admin1_iso
-000011a0: 2220 6f72 2022 6164 6d69 6e31 5f6e 616d  " or "admin1_nam
-000011b0: 6522 2074 6f20 6772 6f75 7020 6279 206c  e" to group by l
-000011c0: 6576 656c 2031 2061 646d 696e 6973 7472  evel 1 administr
-000011d0: 6174 6976 650a 2020 2020 2020 2020 6469  ative.        di
-000011e0: 7669 7369 6f6e 732c 206f 7220 7573 6520  visions, or use 
-000011f0: 2261 646d 696e 325f 6e61 6d65 2220 746f  "admin2_name" to
-00001200: 2067 726f 7570 2062 7920 6c65 7665 6c20   group by level 
-00001210: 3220 6164 6d69 6e69 7374 7261 7469 7665  2 administrative
-00001220: 0a20 2020 2020 2020 2064 6976 6973 696f  .        divisio
-00001230: 6e73 2e0a 2020 2020 2020 2020 2222 222c  ns..        """,
-00001240: 0a20 2020 205d 0a20 2020 2070 6572 696f  .    ].    perio
-00001250: 645f 6279 3a20 5479 7065 416c 6961 7320  d_by: TypeAlias 
-00001260: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-00001270: 2020 2020 204c 6974 6572 616c 5b22 7965       Literal["ye
-00001280: 6172 222c 2022 7175 6172 7465 7222 2c20  ar", "quarter", 
-00001290: 226d 6f6e 7468 225d 2c0a 2020 2020 2020  "month"],.      
-000012a0: 2020 224c 656e 6774 6820 6f66 2074 696d    "Length of tim
-000012b0: 6520 746f 2067 726f 7570 2073 616d 706c  e to group sampl
-000012c0: 6573 2074 656d 706f 7261 6c6c 792e 222c  es temporally.",
-000012d0: 0a20 2020 205d 0a20 2020 2076 6172 6961  .    ].    varia
-000012e0: 6e74 5f71 7565 7279 3a20 5479 7065 416c  nt_query: TypeAl
-000012f0: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
-00001300: 0a20 2020 2020 2020 2073 7472 2c0a 2020  .        str,.  
-00001310: 2020 2020 2020 2241 2070 616e 6461 7320        "A pandas 
-00001320: 7175 6572 7920 746f 2062 6520 6576 616c  query to be eval
-00001330: 7561 7465 6420 6167 6169 6e73 7420 7661  uated against va
-00001340: 7269 616e 7473 2e22 2c0a 2020 2020 5d0a  riants.",.    ].
-00001350: 2020 2020 6e6f 6273 5f6d 6f64 653a 2054      nobs_mode: T
-00001360: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
-00001370: 6174 6564 5b0a 2020 2020 2020 2020 4c69  ated[.        Li
-00001380: 7465 7261 6c5b 2263 616c 6c65 6422 2c20  teral["called", 
-00001390: 2266 6978 6564 225d 2c0a 2020 2020 2020  "fixed"],.      
-000013a0: 2020 2222 220a 2020 2020 2020 2020 4d65    """.        Me
-000013b0: 7468 6f64 2066 6f72 2063 616c 6375 6c61  thod for calcula
-000013c0: 7469 6e67 2074 6865 2064 656e 6f6d 696e  ting the denomin
-000013d0: 6174 6f72 2077 6865 6e20 636f 6d70 7574  ator when comput
-000013e0: 696e 6720 6672 6571 7565 6e63 6965 732e  ing frequencies.
-000013f0: 2049 660a 2020 2020 2020 2020 2263 616c   If.        "cal
-00001400: 6c65 6422 2074 6865 6e20 7573 6520 7468  led" then use th
-00001410: 6520 6e75 6d62 6572 206f 6620 6361 6c6c  e number of call
-00001420: 6564 2061 6c6c 656c 6573 2c20 692e 652e  ed alleles, i.e.
-00001430: 2c20 6e75 6d62 6572 206f 6620 7361 6d70  , number of samp
-00001440: 6c65 730a 2020 2020 2020 2020 7769 7468  les.        with
-00001450: 206e 6f6e 2d6d 6973 7369 6e67 2067 656e   non-missing gen
-00001460: 6f74 7970 6520 6361 6c6c 7320 6d75 6c74  otype calls mult
-00001470: 6970 6c69 6564 2062 7920 322e 2049 6620  iplied by 2. If 
-00001480: 2266 6978 6564 2220 7468 656e 2075 7365  "fixed" then use
-00001490: 2074 6865 0a20 2020 2020 2020 206e 756d   the.        num
-000014a0: 6265 7220 6f66 2073 616d 706c 6573 206d  ber of samples m
-000014b0: 756c 7469 706c 6965 6420 6279 2032 2e0a  ultiplied by 2..
-000014c0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-000014d0: 205d 0a20 2020 206e 6f62 735f 6d6f 6465   ].    nobs_mode
-000014e0: 5f64 6566 6175 6c74 3a20 6e6f 6273 5f6d  _default: nobs_m
-000014f0: 6f64 6520 3d20 2263 616c 6c65 6422 0a20  ode = "called". 
-00001500: 2020 2063 695f 6d65 7468 6f64 3a20 5479     ci_method: Ty
-00001510: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00001520: 7465 645b 0a20 2020 2020 2020 204c 6974  ted[.        Lit
-00001530: 6572 616c 5b22 6e6f 726d 616c 222c 2022  eral["normal", "
-00001540: 6167 7265 7374 695f 636f 756c 6c22 2c20  agresti_coull", 
-00001550: 2262 6574 6122 2c20 2277 696c 736f 6e22  "beta", "wilson"
-00001560: 2c20 2262 696e 6f6d 5f74 6573 7422 5d2c  , "binom_test"],
-00001570: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00001580: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-00001590: 7365 2066 6f72 2063 6f6d 7075 7469 6e67  se for computing
-000015a0: 2063 6f6e 6669 6465 6e63 6520 696e 7465   confidence inte
-000015b0: 7276 616c 732c 2070 6173 7365 6420 7468  rvals, passed th
-000015c0: 726f 7567 6820 746f 0a20 2020 2020 2020  rough to.       
-000015d0: 2060 7374 6174 736d 6f64 656c 732e 7374   `statsmodels.st
-000015e0: 6174 732e 7072 6f70 6f72 7469 6f6e 2e70  ats.proportion.p
-000015f0: 726f 706f 7274 696f 6e5f 636f 6e66 696e  roportion_confin
-00001600: 7460 2e0a 2020 2020 2020 2020 2222 222c  t`..        """,
-00001610: 0a20 2020 205d 0a20 2020 2063 695f 6d65  .    ].    ci_me
-00001620: 7468 6f64 5f64 6566 6175 6c74 3a20 6369  thod_default: ci
-00001630: 5f6d 6574 686f 6420 3d20 2277 696c 736f  _method = "wilso
-00001640: 6e22 0a20 2020 2064 735f 6672 6571 7565  n".    ds_freque
-00001650: 6e63 6965 735f 6164 7661 6e63 6564 3a20  ncies_advanced: 
-00001660: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
-00001670: 7461 7465 645b 0a20 2020 2020 2020 2078  tated[.        x
-00001680: 722e 4461 7461 7365 742c 0a20 2020 2020  r.Dataset,.     
-00001690: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-000016a0: 2064 6174 6173 6574 206f 6620 7661 7269   dataset of vari
-000016b0: 616e 7420 6672 6571 7565 6e63 6965 732c  ant frequencies,
-000016c0: 2073 7563 6820 6173 2072 6574 7572 6e65   such as returne
-000016d0: 6420 6279 0a20 2020 2020 2020 2060 736e  d by.        `sn
-000016e0: 705f 616c 6c65 6c65 5f66 7265 7175 656e  p_allele_frequen
-000016f0: 6369 6573 5f61 6476 616e 6365 6428 2960  cies_advanced()`
-00001700: 2c0a 2020 2020 2020 2020 6061 615f 616c  ,.        `aa_al
-00001710: 6c65 6c65 5f66 7265 7175 656e 6369 6573  lele_frequencies
-00001720: 5f61 6476 616e 6365 6428 2960 206f 720a  _advanced()` or.
-00001730: 2020 2020 2020 2020 6067 656e 655f 636e          `gene_cn
-00001740: 765f 6672 6571 7565 6e63 6965 735f 6164  v_frequencies_ad
-00001750: 7661 6e63 6564 2829 602e 0a20 2020 2020  vanced()`..     
-00001760: 2020 2022 2222 2c0a 2020 2020 5d0a 0a0a     """,.    ]...
-00001770: 636c 6173 7320 6d61 705f 7061 7261 6d73  class map_params
-00001780: 3a0a 2020 2020 6365 6e74 6572 3a20 5479  :.    center: Ty
-00001790: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-000017a0: 7465 645b 0a20 2020 2020 2020 2054 7570  ted[.        Tup
-000017b0: 6c65 5b69 6e74 2c20 696e 745d 2c0a 2020  le[int, int],.  
-000017c0: 2020 2020 2020 224c 6f63 6174 696f 6e20        "Location 
-000017d0: 746f 2063 656e 7465 7220 7468 6520 6d61  to center the ma
-000017e0: 702e 222c 0a20 2020 205d 0a20 2020 2063  p.",.    ].    c
-000017f0: 656e 7465 725f 6465 6661 756c 743a 2063  enter_default: c
-00001800: 656e 7465 7220 3d20 282d 322c 2032 3029  enter = (-2, 20)
-00001810: 0a20 2020 207a 6f6f 6d3a 2054 7970 6541  .    zoom: TypeA
-00001820: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
-00001830: 5b69 6e74 2c20 2249 6e69 7469 616c 207a  [int, "Initial z
-00001840: 6f6f 6d20 6c65 7665 6c2e 225d 0a20 2020  oom level."].   
-00001850: 207a 6f6f 6d5f 6465 6661 756c 743a 207a   zoom_default: z
-00001860: 6f6f 6d20 3d20 330a 2020 2020 6261 7365  oom = 3.    base
-00001870: 6d61 703a 2054 7970 6541 6c69 6173 203d  map: TypeAlias =
-00001880: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-00001890: 2020 2020 556e 696f 6e5b 7374 722c 2044      Union[str, D
-000018a0: 6963 742c 2069 7079 6c65 6166 6c65 742e  ict, ipyleaflet.
-000018b0: 5469 6c65 4c61 7965 722c 2078 797a 7365  TileLayer, xyzse
-000018c0: 7276 6963 6573 2e6c 6962 2e54 696c 6550  rvices.lib.TileP
-000018d0: 726f 7669 6465 725d 2c0a 2020 2020 2020  rovider],.      
-000018e0: 2020 2222 220a 2020 2020 2020 2020 4261    """.        Ba
-000018f0: 7365 6d61 7020 6672 6f6d 2069 7079 6c65  semap from ipyle
-00001900: 6166 6c65 7420 6f72 206f 7468 6572 2054  aflet or other T
-00001910: 696c 654c 6179 6572 2070 726f 7669 6465  ileLayer provide
-00001920: 722e 2053 7472 696e 6773 2061 7265 2061  r. Strings are a
-00001930: 6262 7265 7669 6174 696f 6e73 206d 6170  bbreviations map
-00001940: 7065 6420 746f 2063 6f72 7265 7370 6f6e  ped to correspon
-00001950: 6469 6e67 0a20 2020 2020 2020 2062 6173  ding.        bas
-00001960: 656d 6170 732c 2065 2e67 2e20 226d 6170  emaps, e.g. "map
-00001970: 6e69 6b22 2028 6361 7365 2d69 6e73 656e  nik" (case-insen
-00001980: 7369 7469 7665 2920 6d61 7073 2074 6f20  sitive) maps to 
-00001990: 5469 6c65 5072 6f76 6964 6572 2069 7079  TileProvider ipy
-000019a0: 6c65 6166 6c65 742e 6261 7365 6d61 7073  leaflet.basemaps
-000019b0: 2e4f 7065 6e53 7472 6565 744d 6170 2e4d  .OpenStreetMap.M
-000019c0: 6170 6e69 6b2e 0a20 2020 2020 2020 2022  apnik..        "
-000019d0: 2222 2c0a 2020 2020 5d0a 2020 2020 6261  "",.    ].    ba
-000019e0: 7365 6d61 705f 6465 6661 756c 743a 2062  semap_default: b
-000019f0: 6173 656d 6170 203d 2022 6d61 706e 696b  asemap = "mapnik
-00001a00: 220a 2020 2020 6865 6967 6874 3a20 5479  ".    height: Ty
-00001a10: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00001a20: 7465 645b 0a20 2020 2020 2020 2055 6e69  ted[.        Uni
-00001a30: 6f6e 5b69 6e74 2c20 7374 725d 2c20 2248  on[int, str], "H
-00001a40: 6569 6768 7420 6f66 2074 6865 206d 6170  eight of the map
-00001a50: 2069 6e20 7069 7865 6c73 2028 7078 2920   in pixels (px) 
-00001a60: 6f72 206f 7468 6572 2075 6e69 7473 2e22  or other units."
-00001a70: 0a20 2020 205d 0a20 2020 2068 6569 6768  .    ].    heigh
-00001a80: 745f 6465 6661 756c 743a 2068 6569 6768  t_default: heigh
-00001a90: 7420 3d20 3530 300a 2020 2020 7769 6474  t = 500.    widt
-00001aa0: 683a 2054 7970 6541 6c69 6173 203d 2041  h: TypeAlias = A
-00001ab0: 6e6e 6f74 6174 6564 5b0a 2020 2020 2020  nnotated[.      
-00001ac0: 2020 556e 696f 6e5b 696e 742c 2073 7472    Union[int, str
-00001ad0: 5d2c 2022 5769 6474 6820 6f66 2074 6865  ], "Width of the
-00001ae0: 206d 6170 2069 6e20 7069 7865 6c73 2028   map in pixels (
-00001af0: 7078 2920 6f72 206f 7468 6572 2075 6e69  px) or other uni
-00001b00: 7473 2e22 0a20 2020 205d 0a20 2020 2077  ts.".    ].    w
-00001b10: 6964 7468 5f64 6566 6175 6c74 3a20 7769  idth_default: wi
-00001b20: 6474 6820 3d20 2231 3030 2522 0a0a 0a63  dth = "100%"...c
-00001b30: 6c61 7373 2068 6574 5f70 6172 616d 733a  lass het_params:
-00001b40: 0a20 2020 2022 2222 5061 7261 6d65 7465  .    """Paramete
-00001b50: 7273 2066 6f72 2066 756e 6374 696f 6e73  rs for functions
-00001b60: 2072 656c 6174 6564 2074 6f20 6865 7465   related to hete
-00001b70: 726f 7a79 676f 7369 7479 2061 6e64 2072  rozygosity and r
-00001b80: 756e 7320 6f66 2068 6f6d 6f7a 7967 6f73  uns of homozygos
-00001b90: 6974 792e 2222 220a 0a20 2020 2073 616d  ity."""..    sam
-00001ba0: 706c 653a 2054 7970 6541 6c69 6173 203d  ple: TypeAlias =
-00001bb0: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-00001bc0: 2020 2020 556e 696f 6e5b 7374 722c 2069      Union[str, i
-00001bd0: 6e74 5d2c 0a20 2020 2020 2020 2022 5361  nt],.        "Sa
-00001be0: 6d70 6c65 2069 6465 6e74 6966 6965 7220  mple identifier 
-00001bf0: 6f72 2069 6e64 6578 2077 6974 6869 6e20  or index within 
-00001c00: 7361 6d70 6c65 2073 6574 2e22 2c0a 2020  sample set.",.  
-00001c10: 2020 5d0a 2020 2020 7769 6e64 6f77 5f73    ].    window_s
-00001c20: 697a 653a 2054 7970 6541 6c69 6173 203d  ize: TypeAlias =
-00001c30: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-00001c40: 2020 2020 696e 742c 0a20 2020 2020 2020      int,.       
-00001c50: 2022 4e75 6d62 6572 206f 6620 7369 7465   "Number of site
-00001c60: 7320 7065 7220 7769 6e64 6f77 2e22 2c0a  s per window.",.
-00001c70: 2020 2020 5d0a 2020 2020 7769 6e64 6f77      ].    window
-00001c80: 5f73 697a 655f 6465 6661 756c 743a 2077  _size_default: w
-00001c90: 696e 646f 775f 7369 7a65 203d 2032 305f  indow_size = 20_
-00001ca0: 3030 300a 2020 2020 7068 6574 5f72 6f68  000.    phet_roh
-00001cb0: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
-00001cc0: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
-00001cd0: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
-00001ce0: 2250 726f 6261 6269 6c69 7479 206f 6620  "Probability of 
-00001cf0: 6f62 7365 7276 696e 6720 6120 6865 7465  observing a hete
-00001d00: 726f 7a79 676f 7465 2069 6e20 6120 524f  rozygote in a RO
-00001d10: 482e 222c 0a20 2020 205d 0a20 2020 2070  H.",.    ].    p
-00001d20: 6865 745f 726f 685f 6465 6661 756c 743a  het_roh_default:
-00001d30: 2070 6865 745f 726f 6820 3d20 302e 3030   phet_roh = 0.00
-00001d40: 310a 2020 2020 7068 6574 5f6e 6f6e 726f  1.    phet_nonro
-00001d50: 683a 2054 7970 6541 6c69 6173 203d 2041  h: TypeAlias = A
-00001d60: 6e6e 6f74 6174 6564 5b0a 2020 2020 2020  nnotated[.      
-00001d70: 2020 5475 706c 655b 666c 6f61 742c 202e    Tuple[float, .
-00001d80: 2e2e 5d2c 0a20 2020 2020 2020 2022 4f6e  ..],.        "On
-00001d90: 6520 6f72 206d 6f72 6520 7072 6f62 6162  e or more probab
-00001da0: 696c 6974 6965 7320 6f66 206f 6273 6572  ilities of obser
-00001db0: 7669 6e67 2061 2068 6574 6572 6f7a 7967  ving a heterozyg
-00001dc0: 6f74 6520 6f75 7473 6964 6520 6120 524f  ote outside a RO
-00001dd0: 482e 222c 0a20 2020 205d 0a20 2020 2070  H.",.    ].    p
-00001de0: 6865 745f 6e6f 6e72 6f68 5f64 6566 6175  het_nonroh_defau
-00001df0: 6c74 3a20 7068 6574 5f6e 6f6e 726f 6820  lt: phet_nonroh 
-00001e00: 3d20 2830 2e30 3033 2c20 302e 3031 290a  = (0.003, 0.01).
-00001e10: 2020 2020 7472 616e 7369 7469 6f6e 3a20      transition: 
-00001e20: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
-00001e30: 7461 7465 645b 0a20 2020 2020 2020 2066  tated[.        f
-00001e40: 6c6f 6174 2c0a 2020 2020 2020 2020 2222  loat,.        ""
-00001e50: 220a 2020 2020 2020 2020 5072 6f62 6162  ".        Probab
-00001e60: 696c 6974 7920 6f66 206d 6f76 696e 6720  ility of moving 
-00001e70: 6265 7477 6565 6e20 7374 6174 6573 2e20  between states. 
-00001e80: 4120 6c61 7267 6572 2077 696e 646f 7720  A larger window 
-00001e90: 7369 7a65 206d 6179 2063 616c 6c0a 2020  size may call.  
-00001ea0: 2020 2020 2020 666f 7220 6120 6c61 7267        for a larg
-00001eb0: 6572 2074 7261 6e73 6974 696f 6e61 6c20  er transitional 
-00001ec0: 7072 6f62 6162 696c 6974 792e 0a20 2020  probability..   
-00001ed0: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
-00001ee0: 2020 2020 7472 616e 7369 7469 6f6e 5f64      transition_d
-00001ef0: 6566 6175 6c74 3a20 7472 616e 7369 7469  efault: transiti
-00001f00: 6f6e 203d 2030 2e30 3031 0a20 2020 2079  on = 0.001.    y
-00001f10: 5f6d 6178 3a20 5479 7065 416c 6961 7320  _max: TypeAlias 
-00001f20: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-00001f30: 2020 2020 2066 6c6f 6174 2c0a 2020 2020       float,.    
-00001f40: 2020 2020 2259 2061 7869 7320 6c69 6d69      "Y axis limi
-00001f50: 742e 222c 0a20 2020 205d 0a20 2020 2079  t.",.    ].    y
-00001f60: 5f6d 6178 5f64 6566 6175 6c74 3a20 795f  _max_default: y_
-00001f70: 6d61 7820 3d20 302e 3033 0a20 2020 2063  max = 0.03.    c
-00001f80: 6972 636c 655f 6b77 6172 6773 3a20 5479  ircle_kwargs: Ty
-00001f90: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00001fa0: 7465 645b 0a20 2020 2020 2020 204d 6170  ted[.        Map
-00001fb0: 7069 6e67 2c0a 2020 2020 2020 2020 2250  ping,.        "P
-00001fc0: 6173 7365 6420 7468 726f 7567 6820 746f  assed through to
-00001fd0: 2062 6f6b 6568 2063 6972 636c 6528 2920   bokeh circle() 
-00001fe0: 6675 6e63 7469 6f6e 2e22 2c0a 2020 2020  function.",.    
-00001ff0: 5d0a 2020 2020 6466 5f72 6f68 3a20 5479  ].    df_roh: Ty
-00002000: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00002010: 7465 645b 0a20 2020 2020 2020 2070 642e  ted[.        pd.
-00002020: 4461 7461 4672 616d 652c 0a20 2020 2020  DataFrame,.     
-00002030: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-00002040: 2044 6174 6146 7261 6d65 2077 6865 7265   DataFrame where
-00002050: 2065 6163 6820 726f 7720 7072 6f76 6964   each row provid
-00002060: 6573 2064 6174 6120 6162 6f75 7420 6120  es data about a 
-00002070: 7369 6e67 6c65 2072 756e 206f 660a 2020  single run of.  
-00002080: 2020 2020 2020 686f 6d6f 7a79 676f 7369        homozygosi
-00002090: 7479 2e0a 2020 2020 2020 2020 2222 222c  ty..        """,
-000020a0: 0a20 2020 205d 0a20 2020 2068 6574 6572  .    ].    heter
-000020b0: 6f7a 7967 6f73 6974 795f 6865 6967 6874  ozygosity_height
-000020c0: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
-000020d0: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
-000020e0: 2069 6e74 2c0a 2020 2020 2020 2020 2248   int,.        "H
-000020f0: 6569 6768 7420 696e 2070 6978 656c 7320  eight in pixels 
-00002100: 2870 7829 206f 6620 6865 7465 726f 7a79  (px) of heterozy
-00002110: 676f 7369 7479 2074 7261 636b 2e22 2c0a  gosity track.",.
-00002120: 2020 2020 5d0a 2020 2020 726f 685f 6865      ].    roh_he
-00002130: 6967 6874 3a20 5479 7065 416c 6961 7320  ight: TypeAlias 
-00002140: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-00002150: 2020 2020 2069 6e74 2c0a 2020 2020 2020       int,.      
-00002160: 2020 2248 6569 6768 7420 696e 2070 6978    "Height in pix
-00002170: 656c 7320 2870 7829 206f 6620 7275 6e73  els (px) of runs
-00002180: 206f 6620 686f 6d6f 7a79 676f 7369 7479   of homozygosity
-00002190: 2074 7261 636b 2e22 2c0a 2020 2020 5d0a   track.",.    ].
-000021a0: 0a0a 636c 6173 7320 7063 615f 7061 7261  ..class pca_para
-000021b0: 6d73 3a0a 2020 2020 2222 2250 6172 616d  ms:.    """Param
-000021c0: 6574 6572 7320 666f 7220 5043 4120 6675  eters for PCA fu
-000021d0: 6e63 7469 6f6e 732e 2222 220a 0a20 2020  nctions."""..   
-000021e0: 206e 5f73 6e70 733a 2054 7970 6541 6c69   n_snps: TypeAli
-000021f0: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
-00002200: 2020 2020 2020 2020 696e 742c 0a20 2020          int,.   
-00002210: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00002220: 2054 6865 2064 6573 6972 6564 206e 756d   The desired num
-00002230: 6265 7220 6f66 2053 4e50 7320 746f 2075  ber of SNPs to u
-00002240: 7365 2077 6865 6e20 7275 6e6e 696e 6720  se when running 
-00002250: 7468 6520 616e 616c 7973 6973 2e0a 2020  the analysis..  
-00002260: 2020 2020 2020 534e 5073 2077 696c 6c20        SNPs will 
-00002270: 6265 2065 7665 6e6c 7920 7468 696e 6e65  be evenly thinne
-00002280: 6420 746f 2061 7070 726f 7869 6d61 7465  d to approximate
-00002290: 6c79 2074 6869 7320 6e75 6d62 6572 2e0a  ly this number..
-000022a0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-000022b0: 205d 0a20 2020 2074 6869 6e5f 6f66 6673   ].    thin_offs
-000022c0: 6574 3a20 5479 7065 416c 6961 7320 3d20  et: TypeAlias = 
-000022d0: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
-000022e0: 2020 2069 6e74 2c0a 2020 2020 2020 2020     int,.        
-000022f0: 2222 220a 2020 2020 2020 2020 5374 6172  """.        Star
-00002300: 7469 6e67 2069 6e64 6578 2066 6f72 2053  ting index for S
-00002310: 4e50 2074 6869 6e6e 696e 672e 2043 6861  NP thinning. Cha
-00002320: 6e67 6520 7468 6973 2074 6f20 7265 7065  nge this to repe
-00002330: 6174 2074 6865 2061 6e61 6c79 7369 730a  at the analysis.
-00002340: 2020 2020 2020 2020 7573 696e 6720 6120          using a 
-00002350: 6469 6666 6572 656e 7420 7365 7420 6f66  different set of
-00002360: 2053 4e50 732e 0a20 2020 2020 2020 2022   SNPs..        "
-00002370: 2222 2c0a 2020 2020 5d0a 2020 2020 7468  "",.    ].    th
-00002380: 696e 5f6f 6666 7365 745f 6465 6661 756c  in_offset_defaul
-00002390: 743a 2074 6869 6e5f 6f66 6673 6574 203d  t: thin_offset =
-000023a0: 2030 0a20 2020 206d 696e 5f6d 696e 6f72   0.    min_minor
-000023b0: 5f61 633a 2054 7970 6541 6c69 6173 203d  _ac: TypeAlias =
-000023c0: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-000023d0: 2020 2020 696e 742c 0a20 2020 2020 2020      int,.       
-000023e0: 2022 2222 0a20 2020 2020 2020 2054 6865   """.        The
-000023f0: 206d 696e 696d 756d 206d 696e 6f72 2061   minimum minor a
-00002400: 6c6c 656c 6520 636f 756e 742e 2053 4e50  llele count. SNP
-00002410: 7320 7769 7468 2061 206d 696e 6f72 2061  s with a minor a
-00002420: 6c6c 656c 6520 636f 756e 740a 2020 2020  llele count.    
-00002430: 2020 2020 6265 6c6f 7720 7468 6973 2076      below this v
-00002440: 616c 7565 2077 696c 6c20 6265 2065 7863  alue will be exc
-00002450: 6c75 6465 6420 7072 696f 7220 746f 2074  luded prior to t
-00002460: 6869 6e6e 696e 672e 0a20 2020 2020 2020  hinning..       
-00002470: 2022 2222 2c0a 2020 2020 5d0a 2020 2020   """,.    ].    
-00002480: 6d69 6e5f 6d69 6e6f 725f 6163 5f64 6566  min_minor_ac_def
-00002490: 6175 6c74 3a20 6d69 6e5f 6d69 6e6f 725f  ault: min_minor_
-000024a0: 6163 203d 2032 0a20 2020 206d 6178 5f6d  ac = 2.    max_m
-000024b0: 6973 7369 6e67 5f61 6e3a 2054 7970 6541  issing_an: TypeA
-000024c0: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
-000024d0: 5b0a 2020 2020 2020 2020 696e 742c 0a20  [.        int,. 
-000024e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000024f0: 2020 2054 6865 206d 6178 696d 756d 206e     The maximum n
-00002500: 756d 6265 7220 6f66 206d 6973 7369 6e67  umber of missing
-00002510: 2061 6c6c 656c 6520 6361 6c6c 7320 746f   allele calls to
-00002520: 2061 6363 6570 742e 2053 4e50 7320 7769   accept. SNPs wi
-00002530: 7468 0a20 2020 2020 2020 206d 6f72 6520  th.        more 
-00002540: 7468 616e 2074 6869 7320 7661 6c75 6520  than this value 
-00002550: 7769 6c6c 2062 6520 6578 636c 7564 6564  will be excluded
-00002560: 2070 7269 6f72 2074 6f20 7468 696e 6e69   prior to thinni
-00002570: 6e67 2e20 5365 7420 746f 2030 0a20 2020  ng. Set to 0.   
-00002580: 2020 2020 2028 6465 6661 756c 7429 2074       (default) t
-00002590: 6f20 7265 7175 6972 6520 6e6f 206d 6973  o require no mis
-000025a0: 7369 6e67 2063 616c 6c73 2e0a 2020 2020  sing calls..    
-000025b0: 2020 2020 2222 222c 0a20 2020 205d 0a20      """,.    ]. 
-000025c0: 2020 206d 6178 5f6d 6973 7369 6e67 5f61     max_missing_a
-000025d0: 6e5f 6465 6661 756c 7420 3d20 300a 2020  n_default = 0.  
-000025e0: 2020 6e5f 636f 6d70 6f6e 656e 7473 3a20    n_components: 
-000025f0: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
-00002600: 7461 7465 645b 0a20 2020 2020 2020 2069  tated[.        i
-00002610: 6e74 2c0a 2020 2020 2020 2020 224e 756d  nt,.        "Num
-00002620: 6265 7220 6f66 2063 6f6d 706f 6e65 6e74  ber of component
-00002630: 7320 746f 2072 6574 7572 6e2e 222c 0a20  s to return.",. 
-00002640: 2020 205d 0a20 2020 206e 5f63 6f6d 706f     ].    n_compo
-00002650: 6e65 6e74 735f 6465 6661 756c 743a 206e  nents_default: n
-00002660: 5f63 6f6d 706f 6e65 6e74 7320 3d20 3230  _components = 20
-00002670: 0a20 2020 2064 665f 7063 613a 2054 7970  .    df_pca: Typ
-00002680: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-00002690: 6564 5b0a 2020 2020 2020 2020 7064 2e44  ed[.        pd.D
-000026a0: 6174 6146 7261 6d65 2c0a 2020 2020 2020  ataFrame,.      
-000026b0: 2020 2222 220a 2020 2020 2020 2020 4120    """.        A 
-000026c0: 6461 7461 6672 616d 6520 6f66 2073 616d  dataframe of sam
-000026d0: 706c 6520 6d65 7461 6461 7461 2c20 7769  ple metadata, wi
-000026e0: 7468 2063 6f6c 756d 6e73 2022 5043 3122  th columns "PC1"
-000026f0: 2c20 2250 4332 222c 2022 5043 3322 2c0a  , "PC2", "PC3",.
-00002700: 2020 2020 2020 2020 6574 632e 2c20 6164          etc., ad
-00002710: 6465 642e 0a20 2020 2020 2020 2022 2222  ded..        """
-00002720: 2c0a 2020 2020 5d0a 2020 2020 6576 723a  ,.    ].    evr:
-00002730: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
-00002740: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
-00002750: 6e70 2e6e 6461 7272 6179 2c0a 2020 2020  np.ndarray,.    
-00002760: 2020 2020 2241 6e20 6172 7261 7920 6f66      "An array of
-00002770: 2065 7870 6c61 696e 6564 2076 6172 6961   explained varia
-00002780: 6e63 6520 7261 7469 6f73 2c20 6f6e 6520  nce ratios, one 
-00002790: 7065 7220 636f 6d70 6f6e 656e 742e 222c  per component.",
-000027a0: 0a20 2020 205d 0a0a 0a63 6c61 7373 2070  .    ]...class p
-000027b0: 6c6f 746c 795f 7061 7261 6d73 3a0a 2020  lotly_params:.  
-000027c0: 2020 2222 2250 6172 616d 6574 6572 7320    """Parameters 
-000027d0: 666f 7220 616e 7920 706c 6f74 7469 6e67  for any plotting
-000027e0: 2066 756e 6374 696f 6e73 2075 7369 6e67   functions using
-000027f0: 2070 6c6f 746c 792e 2222 220a 0a20 2020   plotly."""..   
-00002800: 2023 204e 2e42 2e2c 206d 6f73 7420 6f66   # N.B., most of
-00002810: 2074 6865 7365 2070 6172 616d 6574 6572   these parameter
-00002820: 7320 6172 6520 616c 7761 7973 2061 626c  s are always abl
-00002830: 6520 746f 2074 616b 6520 4e6f 6e65 0a20  e to take None. 
-00002840: 2020 2023 2061 6e64 2073 6f20 7765 2073     # and so we s
-00002850: 6574 2061 7320 4f70 7469 6f6e 616c 2068  et as Optional h
-00002860: 6572 652c 2072 6174 6865 7220 7468 616e  ere, rather than
-00002870: 2068 6176 696e 6720 746f 2072 6570 6561   having to repea
-00002880: 740a 2020 2020 2320 7468 6174 2066 6f72  t.    # that for
-00002890: 2065 6163 6820 6675 6e63 7469 6f6e 2064   each function d
-000028a0: 6f63 2e0a 0a20 2020 2078 5f6c 6162 656c  oc...    x_label
-000028b0: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
-000028c0: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
-000028d0: 204f 7074 696f 6e61 6c5b 7374 725d 2c0a   Optional[str],.
-000028e0: 2020 2020 2020 2020 2258 2061 7869 7320          "X axis 
-000028f0: 6c61 6265 6c2e 222c 0a20 2020 205d 0a20  label.",.    ]. 
-00002900: 2020 2079 5f6c 6162 656c 3a20 5479 7065     y_label: Type
-00002910: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
-00002920: 645b 0a20 2020 2020 2020 204f 7074 696f  d[.        Optio
-00002930: 6e61 6c5b 7374 725d 2c0a 2020 2020 2020  nal[str],.      
-00002940: 2020 2259 2061 7869 7320 6c61 6265 6c2e    "Y axis label.
-00002950: 222c 0a20 2020 205d 0a20 2020 2077 6964  ",.    ].    wid
-00002960: 7468 3a20 5479 7065 416c 6961 7320 3d20  th: TypeAlias = 
-00002970: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
-00002980: 2020 204f 7074 696f 6e61 6c5b 696e 745d     Optional[int]
-00002990: 2c0a 2020 2020 2020 2020 2250 6c6f 7420  ,.        "Plot 
-000029a0: 7769 6474 6820 696e 2070 6978 656c 7320  width in pixels 
-000029b0: 2870 7829 2e22 2c0a 2020 2020 5d0a 2020  (px).",.    ].  
-000029c0: 2020 6865 6967 6874 3a20 5479 7065 416c    height: TypeAl
-000029d0: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
-000029e0: 0a20 2020 2020 2020 204f 7074 696f 6e61  .        Optiona
-000029f0: 6c5b 696e 745d 2c0a 2020 2020 2020 2020  l[int],.        
-00002a00: 2250 6c6f 7420 6865 6967 6874 2069 6e20  "Plot height in 
-00002a10: 7069 7865 6c73 2028 7078 292e 222c 0a20  pixels (px).",. 
-00002a20: 2020 205d 0a20 2020 2061 7370 6563 743a     ].    aspect:
-00002a30: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
-00002a40: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
-00002a50: 4f70 7469 6f6e 616c 5b4c 6974 6572 616c  Optional[Literal
-00002a60: 5b22 6571 7561 6c22 2c20 2261 7574 6f22  ["equal", "auto"
-00002a70: 5d5d 2c0a 2020 2020 2020 2020 2241 7370  ]],.        "Asp
-00002a80: 6563 7420 7261 7469 6f2c 2073 6565 2061  ect ratio, see a
-00002a90: 6c73 6f20 6874 7470 733a 2f2f 706c 6f74  lso https://plot
-00002aa0: 6c79 2e63 6f6d 2f70 7974 686f 6e2d 6170  ly.com/python-ap
-00002ab0: 692d 7265 6665 7265 6e63 652f 6765 6e65  i-reference/gene
-00002ac0: 7261 7465 642f 706c 6f74 6c79 2e65 7870  rated/plotly.exp
-00002ad0: 7265 7373 2e69 6d73 686f 7722 2c0a 2020  ress.imshow",.  
-00002ae0: 2020 5d0a 2020 2020 7469 746c 653a 2054    ].    title: T
-00002af0: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
-00002b00: 6174 6564 5b0a 2020 2020 2020 2020 4f70  ated[.        Op
-00002b10: 7469 6f6e 616c 5b55 6e69 6f6e 5b73 7472  tional[Union[str
-00002b20: 2c20 626f 6f6c 5d5d 2c0a 2020 2020 2020  , bool]],.      
-00002b30: 2020 2222 220a 2020 2020 2020 2020 4966    """.        If
-00002b40: 2054 7275 652c 2061 7474 656d 7074 2074   True, attempt t
-00002b50: 6f20 7573 6520 6d65 7461 6461 7461 2066  o use metadata f
-00002b60: 726f 6d20 696e 7075 7420 6461 7461 7365  rom input datase
-00002b70: 7420 6173 2061 2070 6c6f 7420 7469 746c  t as a plot titl
-00002b80: 652e 0a20 2020 2020 2020 204f 7468 6572  e..        Other
-00002b90: 7769 7365 2c20 7573 6520 7375 7070 6c69  wise, use suppli
-00002ba0: 6564 2076 616c 7565 2061 7320 6120 7469  ed value as a ti
-00002bb0: 746c 652e 0a20 2020 2020 2020 2022 2222  tle..        """
-00002bc0: 2c0a 2020 2020 5d0a 2020 2020 7465 7874  ,.    ].    text
-00002bd0: 5f61 7574 6f3a 2054 7970 6541 6c69 6173  _auto: TypeAlias
-00002be0: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
-00002bf0: 2020 2020 2020 556e 696f 6e5b 626f 6f6c        Union[bool
-00002c00: 2c20 7374 725d 2c0a 2020 2020 2020 2020  , str],.        
-00002c10: 2222 220a 2020 2020 2020 2020 4966 2054  """.        If T
-00002c20: 7275 6520 6f72 2061 2073 7472 696e 672c  rue or a string,
-00002c30: 2073 696e 676c 652d 6368 616e 6e65 6c20   single-channel 
-00002c40: 696d 6720 7661 6c75 6573 2077 696c 6c20  img values will 
-00002c50: 6265 2064 6973 706c 6179 6564 2061 7320  be displayed as 
-00002c60: 7465 7874 2e20 410a 2020 2020 2020 2020  text. A.        
-00002c70: 7374 7269 6e67 206c 696b 6520 272e 3266  string like '.2f
-00002c80: 2720 7769 6c6c 2062 6520 696e 7465 7270  ' will be interp
-00002c90: 7265 7465 6420 6173 2061 2074 6578 7474  reted as a textt
-00002ca0: 656d 706c 6174 6520 6e75 6d65 7269 6320  emplate numeric 
-00002cb0: 666f 726d 6174 7469 6e67 0a20 2020 2020  formatting.     
-00002cc0: 2020 2064 6972 6563 7469 7665 2e0a 2020     directive..  
-00002cd0: 2020 2020 2020 2222 222c 0a20 2020 205d        """,.    ]
-00002ce0: 0a20 2020 2063 6f6c 6f72 5f63 6f6e 7469  .    color_conti
-00002cf0: 6e75 6f75 735f 7363 616c 653a 2054 7970  nuous_scale: Typ
-00002d00: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-00002d10: 6564 5b0a 2020 2020 2020 2020 4f70 7469  ed[.        Opti
-00002d20: 6f6e 616c 5b55 6e69 6f6e 5b73 7472 2c20  onal[Union[str, 
-00002d30: 4c69 7374 5b73 7472 5d5d 5d2c 0a20 2020  List[str]]],.   
-00002d40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00002d50: 2043 6f6c 6f72 6d61 7020 7573 6564 2074   Colormap used t
-00002d60: 6f20 6d61 7020 7363 616c 6172 2064 6174  o map scalar dat
-00002d70: 6120 746f 2063 6f6c 6f72 7320 2866 6f72  a to colors (for
-00002d80: 2061 2032 4420 696d 6167 6529 2e20 5468   a 2D image). Th
-00002d90: 6973 0a20 2020 2020 2020 2070 6172 616d  is.        param
-00002da0: 6574 6572 2069 7320 6e6f 7420 7573 6564  eter is not used
-00002db0: 2066 6f72 2052 4742 206f 7220 5247 4241   for RGB or RGBA
-00002dc0: 2069 6d61 6765 732e 2049 6620 6120 7374   images. If a st
-00002dd0: 7269 6e67 2069 7320 7072 6f76 6964 6564  ring is provided
-00002de0: 2c0a 2020 2020 2020 2020 6974 2073 686f  ,.        it sho
-00002df0: 756c 6420 6265 2074 6865 206e 616d 6520  uld be the name 
-00002e00: 6f66 2061 206b 6e6f 776e 2063 6f6c 6f72  of a known color
-00002e10: 2073 6361 6c65 2c20 616e 6420 6966 2061   scale, and if a
-00002e20: 206c 6973 7420 6973 2070 726f 7669 6465   list is provide
-00002e30: 642c 0a20 2020 2020 2020 2069 7420 7368  d,.        it sh
-00002e40: 6f75 6c64 2062 6520 6120 6c69 7374 206f  ould be a list o
-00002e50: 6620 4353 532d 636f 6d70 6174 6962 6c65  f CSS-compatible
-00002e60: 2063 6f6c 6f72 732e 0a20 2020 2020 2020   colors..       
-00002e70: 2022 2222 2c0a 2020 2020 5d0a 2020 2020   """,.    ].    
-00002e80: 636f 6c6f 7262 6172 3a20 5479 7065 416c  colorbar: TypeAl
-00002e90: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
-00002ea0: 0a20 2020 2020 2020 2062 6f6f 6c2c 0a20  .        bool,. 
-00002eb0: 2020 2020 2020 2022 4966 2046 616c 7365         "If False
-00002ec0: 2c20 646f 206e 6f74 2064 6973 706c 6179  , do not display
-00002ed0: 2061 2063 6f6c 6f72 2062 6172 2e22 2c0a   a color bar.",.
-00002ee0: 2020 2020 5d0a 2020 2020 783a 2054 7970      ].    x: Typ
-00002ef0: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-00002f00: 6564 5b0a 2020 2020 2020 2020 7374 722c  ed[.        str,
-00002f10: 0a20 2020 2020 2020 2022 4e61 6d65 206f  .        "Name o
-00002f20: 6620 7661 7269 6162 6c65 2074 6f20 706c  f variable to pl
-00002f30: 6f74 206f 6e20 7468 6520 5820 6178 6973  ot on the X axis
-00002f40: 2e22 2c0a 2020 2020 5d0a 2020 2020 793a  .",.    ].    y:
-00002f50: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
-00002f60: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
-00002f70: 7374 722c 0a20 2020 2020 2020 2022 4e61  str,.        "Na
-00002f80: 6d65 206f 6620 7661 7269 6162 6c65 2074  me of variable t
-00002f90: 6f20 706c 6f74 206f 6e20 7468 6520 5920  o plot on the Y 
-00002fa0: 6178 6973 2e22 2c0a 2020 2020 5d0a 2020  axis.",.    ].  
-00002fb0: 2020 7a3a 2054 7970 6541 6c69 6173 203d    z: TypeAlias =
-00002fc0: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-00002fd0: 2020 2020 7374 722c 0a20 2020 2020 2020      str,.       
-00002fe0: 2022 4e61 6d65 206f 6620 7661 7269 6162   "Name of variab
-00002ff0: 6c65 2074 6f20 706c 6f74 206f 6e20 7468  le to plot on th
-00003000: 6520 5a20 6178 6973 2e22 2c0a 2020 2020  e Z axis.",.    
-00003010: 5d0a 2020 2020 636f 6c6f 723a 2054 7970  ].    color: Typ
-00003020: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-00003030: 6564 5b0a 2020 2020 2020 2020 4f70 7469  ed[.        Opti
-00003040: 6f6e 616c 5b73 7472 5d2c 0a20 2020 2020  onal[str],.     
-00003050: 2020 2022 4e61 6d65 206f 6620 7661 7269     "Name of vari
-00003060: 6162 6c65 2074 6f20 7573 6520 746f 2063  able to use to c
-00003070: 6f6c 6f72 2074 6865 206d 6172 6b65 7273  olor the markers
-00003080: 2e22 2c0a 2020 2020 5d0a 2020 2020 7379  .",.    ].    sy
-00003090: 6d62 6f6c 3a20 5479 7065 416c 6961 7320  mbol: TypeAlias 
-000030a0: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-000030b0: 2020 2020 204f 7074 696f 6e61 6c5b 7374       Optional[st
-000030c0: 725d 2c0a 2020 2020 2020 2020 224e 616d  r],.        "Nam
-000030d0: 6520 6f66 2074 6865 2076 6172 6961 626c  e of the variabl
-000030e0: 6520 746f 2075 7365 2074 6f20 6368 6f6f  e to use to choo
-000030f0: 7365 206d 6172 6b65 7220 7379 6d62 6f6c  se marker symbol
-00003100: 732e 222c 0a20 2020 205d 0a20 2020 206a  s.",.    ].    j
-00003110: 6974 7465 725f 6672 6163 3a20 5479 7065  itter_frac: Type
-00003120: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
-00003130: 645b 0a20 2020 2020 2020 204f 7074 696f  d[.        Optio
-00003140: 6e61 6c5b 666c 6f61 745d 2c0a 2020 2020  nal[float],.    
-00003150: 2020 2020 2252 616e 646f 6d6c 7920 6a69      "Randomly ji
-00003160: 7474 6572 2070 6f69 6e74 7320 6279 2074  tter points by t
-00003170: 6869 7320 6672 6163 7469 6f6e 206f 6620  his fraction of 
-00003180: 7468 6569 7220 7261 6e67 652e 222c 0a20  their range.",. 
-00003190: 2020 205d 0a20 2020 206d 6172 6b65 725f     ].    marker_
-000031a0: 7369 7a65 3a20 5479 7065 416c 6961 7320  size: TypeAlias 
-000031b0: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-000031c0: 2020 2020 2069 6e74 2c0a 2020 2020 2020       int,.      
-000031d0: 2020 224d 6172 6b65 7220 7369 7a65 2e22    "Marker size."
-000031e0: 2c0a 2020 2020 5d0a 2020 2020 7465 6d70  ,.    ].    temp
-000031f0: 6c61 7465 3a20 5479 7065 416c 6961 7320  late: TypeAlias 
-00003200: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-00003210: 2020 2020 204f 7074 696f 6e61 6c5b 0a20       Optional[. 
-00003220: 2020 2020 2020 2020 2020 204c 6974 6572             Liter
-00003230: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
-00003240: 2020 2020 2267 6770 6c6f 7432 222c 0a20      "ggplot2",. 
-00003250: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00003260: 7365 6162 6f72 6e22 2c0a 2020 2020 2020  seaborn",.      
-00003270: 2020 2020 2020 2020 2020 2273 696d 706c            "simpl
-00003280: 655f 7768 6974 6522 2c0a 2020 2020 2020  e_white",.      
-00003290: 2020 2020 2020 2020 2020 2270 6c6f 746c            "plotl
-000032a0: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-000032b0: 2020 2020 2270 6c6f 746c 795f 7768 6974      "plotly_whit
-000032c0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-000032d0: 2020 2020 2270 6c6f 746c 795f 6461 726b      "plotly_dark
-000032e0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000032f0: 2020 2022 7072 6573 656e 7461 7469 6f6e     "presentation
-00003300: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00003310: 2020 2022 7867 7269 646f 6666 222c 0a20     "xgridoff",. 
-00003320: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00003330: 7967 7269 646f 6666 222c 0a20 2020 2020  ygridoff",.     
-00003340: 2020 2020 2020 2020 2020 2022 6772 6964             "grid
-00003350: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
-00003360: 2020 2020 2022 6e6f 6e65 222c 0a20 2020       "none",.   
-00003370: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-00003380: 2020 205d 2c0a 2020 2020 2020 2020 2254     ],.        "T
-00003390: 6865 2066 6967 7572 6520 7465 6d70 6c61  he figure templa
-000033a0: 7465 206e 616d 6520 286d 7573 7420 6265  te name (must be
-000033b0: 2061 206b 6579 2069 6e20 706c 6f74 6c79   a key in plotly
-000033c0: 2e69 6f2e 7465 6d70 6c61 7465 7329 2e22  .io.templates)."
-000033d0: 2c0a 2020 2020 5d0a 2020 2020 6669 6775  ,.    ].    figu
-000033e0: 7265 3a20 5479 7065 416c 6961 7320 3d20  re: TypeAlias = 
-000033f0: 416e 6e6f 7461 7465 645b 676f 2e46 6967  Annotated[go.Fig
-00003400: 7572 652c 2022 4120 706c 6f74 6c79 2066  ure, "A plotly f
-00003410: 6967 7572 652e 225d 0a0a 0a63 6c61 7373  igure."]...class
-00003420: 2069 6873 5f70 6172 616d 733a 0a20 2020   ihs_params:.   
-00003430: 2077 696e 646f 775f 7369 7a65 3a20 5479   window_size: Ty
-00003440: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00003450: 7465 645b 0a20 2020 2020 2020 2069 6e74  ted[.        int
-00003460: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
-00003470: 2020 2020 2020 5468 6520 7369 7a65 206f        The size o
-00003480: 6620 7769 6e64 6f77 2069 6e20 6e75 6d62  f window in numb
-00003490: 6572 206f 6620 534e 5073 2075 7365 6420  er of SNPs used 
-000034a0: 746f 2073 756d 6d61 7269 7365 2069 4853  to summarise iHS
-000034b0: 206f 7665 722e 0a20 2020 2020 2020 2049   over..        I
-000034c0: 6620 4e6f 6e65 2c20 7065 722d 7661 7269  f None, per-vari
-000034d0: 616e 7420 6948 5320 7661 6c75 6573 2061  ant iHS values a
-000034e0: 7265 2072 6574 7572 6e65 642e 0a20 2020  re returned..   
-000034f0: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
-00003500: 2020 2020 7769 6e64 6f77 5f73 697a 655f      window_size_
-00003510: 6465 6661 756c 743a 2077 696e 646f 775f  default: window_
-00003520: 7369 7a65 203d 2032 3030 0a20 2020 206d  size = 200.    m
-00003530: 696e 5f63 6f68 6f72 745f 7369 7a65 5f64  in_cohort_size_d
-00003540: 6566 6175 6c74 3a20 6261 7365 5f70 6172  efault: base_par
-00003550: 616d 732e 6d69 6e5f 636f 686f 7274 5f73  ams.min_cohort_s
-00003560: 697a 6520 3d20 3135 0a20 2020 206d 6178  ize = 15.    max
-00003570: 5f63 6f68 6f72 745f 7369 7a65 5f64 6566  _cohort_size_def
-00003580: 6175 6c74 3a20 6261 7365 5f70 6172 616d  ault: base_param
-00003590: 732e 6d61 785f 636f 686f 7274 5f73 697a  s.max_cohort_siz
-000035a0: 6520 3d20 3530 0a20 2020 2070 6572 6365  e = 50.    perce
-000035b0: 6e74 696c 6573 3a20 5479 7065 416c 6961  ntiles: TypeAlia
-000035c0: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
-000035d0: 2020 2020 2020 2055 6e69 6f6e 5b69 6e74         Union[int
-000035e0: 2c20 5475 706c 655b 696e 742c 202e 2e2e  , Tuple[int, ...
-000035f0: 5d5d 2c0a 2020 2020 2020 2020 2222 220a  ]],.        """.
-00003600: 2020 2020 2020 2020 4966 2077 696e 646f          If windo
-00003610: 7720 7369 7a65 2069 7320 7370 6563 6966  w size is specif
-00003620: 6965 642c 2074 6869 7320 7265 7475 726e  ied, this return
-00003630: 7320 7468 6520 6948 5320 7065 7263 656e  s the iHS percen
-00003640: 7469 6c65 730a 2020 2020 2020 2020 666f  tiles.        fo
-00003650: 7220 6561 6368 2077 696e 646f 772e 0a20  r each window.. 
-00003660: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-00003670: 5d0a 2020 2020 7065 7263 656e 7469 6c65  ].    percentile
-00003680: 735f 6465 6661 756c 743a 2070 6572 6365  s_default: perce
-00003690: 6e74 696c 6573 203d 2028 3530 2c20 3735  ntiles = (50, 75
-000036a0: 2c20 3130 3029 0a20 2020 2073 7461 6e64  , 100).    stand
-000036b0: 6172 6469 7a65 3a20 5479 7065 416c 6961  ardize: TypeAlia
-000036c0: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
-000036d0: 2020 2020 2020 2062 6f6f 6c2c 2022 4966         bool, "If
-000036e0: 2054 7275 652c 2073 7461 6e64 6172 6469   True, standardi
-000036f0: 7a65 2069 4853 2076 616c 7565 7320 6279  ze iHS values by
-00003700: 2061 6c74 6572 6e61 7465 2061 6c6c 656c   alternate allel
-00003710: 6520 636f 756e 7473 2e22 0a20 2020 205d  e counts.".    ]
-00003720: 0a20 2020 2073 7461 6e64 6172 6469 7a61  .    standardiza
-00003730: 7469 6f6e 5f62 696e 733a 2054 7970 6541  tion_bins: TypeA
-00003740: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
-00003750: 5b0a 2020 2020 2020 2020 5475 706c 655b  [.        Tuple[
-00003760: 666c 6f61 742c 202e 2e2e 5d2c 0a20 2020  float, ...],.   
-00003770: 2020 2020 2022 4966 2070 726f 7669 6465       "If provide
-00003780: 642c 2075 7365 2074 6865 7365 2061 6c6c  d, use these all
-00003790: 656c 6520 636f 756e 7420 6269 6e73 2074  ele count bins t
-000037a0: 6f20 7374 616e 6461 7264 697a 6520 6948  o standardize iH
-000037b0: 5320 7661 6c75 6573 2e22 2c0a 2020 2020  S values.",.    
-000037c0: 5d0a 2020 2020 7374 616e 6461 7264 697a  ].    standardiz
-000037d0: 6174 696f 6e5f 6e5f 6269 6e73 3a20 5479  ation_n_bins: Ty
-000037e0: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-000037f0: 7465 645b 0a20 2020 2020 2020 2069 6e74  ted[.        int
-00003800: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
-00003810: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-00003820: 616c 6c65 6c65 2063 6f75 6e74 2062 696e  allele count bin
-00003830: 7320 746f 2075 7365 2066 6f72 2073 7461  s to use for sta
-00003840: 6e64 6172 6469 7a61 7469 6f6e 2e0a 2020  ndardization..  
-00003850: 2020 2020 2020 4f76 6572 7269 6465 7320        Overrides 
-00003860: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
-00003870: 6269 6e73 2e0a 2020 2020 2020 2020 2222  bins..        ""
-00003880: 222c 0a20 2020 205d 0a20 2020 2073 7461  ",.    ].    sta
-00003890: 6e64 6172 6469 7a61 7469 6f6e 5f6e 5f62  ndardization_n_b
-000038a0: 696e 735f 6465 6661 756c 743a 2073 7461  ins_default: sta
-000038b0: 6e64 6172 6469 7a61 7469 6f6e 5f6e 5f62  ndardization_n_b
-000038c0: 696e 7320 3d20 3230 0a20 2020 2073 7461  ins = 20.    sta
-000038d0: 6e64 6172 6469 7a61 7469 6f6e 5f64 6961  ndardization_dia
-000038e0: 676e 6f73 7469 6373 3a20 5479 7065 416c  gnostics: TypeAl
-000038f0: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
-00003900: 0a20 2020 2020 2020 2062 6f6f 6c2c 2022  .        bool, "
-00003910: 4966 2054 7275 652c 2070 6c6f 7420 736f  If True, plot so
-00003920: 6d65 2064 6961 676e 6f73 7469 6373 2061  me diagnostics a
-00003930: 626f 7574 2074 6865 2073 7461 6e64 6172  bout the standar
-00003940: 6469 7a61 7469 6f6e 2e22 0a20 2020 205d  dization.".    ]
-00003950: 0a20 2020 2066 696c 7465 725f 6d69 6e5f  .    filter_min_
-00003960: 6d61 663a 2054 7970 6541 6c69 6173 203d  maf: TypeAlias =
-00003970: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
-00003980: 2020 2020 666c 6f61 742c 0a20 2020 2020      float,.     
-00003990: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
-000039a0: 696e 696d 756d 206d 696e 6f72 2061 6c6c  inimum minor all
-000039b0: 656c 6520 6672 6571 7565 6e63 7920 746f  ele frequency to
-000039c0: 2075 7365 2066 6f72 2066 696c 7465 7269   use for filteri
-000039d0: 6e67 2070 7269 6f72 2074 6f20 7061 7373  ng prior to pass
-000039e0: 696e 670a 2020 2020 2020 2020 6861 706c  ing.        hapl
-000039f0: 6f74 7970 6573 2074 6f20 616c 6c65 6c2e  otypes to allel.
-00003a00: 6968 7320 6675 6e63 7469 6f6e 0a20 2020  ihs function.   
-00003a10: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
-00003a20: 2020 2020 6669 6c74 6572 5f6d 696e 5f6d      filter_min_m
-00003a30: 6166 5f64 6566 6175 6c74 3a20 6669 6c74  af_default: filt
-00003a40: 6572 5f6d 696e 5f6d 6166 203d 2030 2e30  er_min_maf = 0.0
-00003a50: 350a 2020 2020 636f 6d70 7574 655f 6d69  5.    compute_mi
-00003a60: 6e5f 6d61 663a 2054 7970 6541 6c69 6173  n_maf: TypeAlias
-00003a70: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
-00003a80: 2020 2020 2020 666c 6f61 742c 0a20 2020        float,.   
-00003a90: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003aa0: 2044 6f20 6e6f 7420 636f 6d70 7574 6520   Do not compute 
-00003ab0: 696e 7465 6772 6174 6564 2068 6170 6c6f  integrated haplo
-00003ac0: 7479 7065 2068 6f6d 6f7a 7967 6f73 6974  type homozygosit
-00003ad0: 7920 666f 7220 7661 7269 616e 7473 2077  y for variants w
-00003ae0: 6974 680a 2020 2020 2020 2020 6d69 6e6f  ith.        mino
-00003af0: 7220 616c 6c65 6c65 2066 7265 7175 656e  r allele frequen
-00003b00: 6379 2062 656c 6f77 2074 6869 7320 7468  cy below this th
-00003b10: 7265 7368 6f6c 642e 0a20 2020 2020 2020  reshold..       
-00003b20: 2022 2222 2c0a 2020 2020 5d0a 2020 2020   """,.    ].    
-00003b30: 636f 6d70 7574 655f 6d69 6e5f 6d61 665f  compute_min_maf_
-00003b40: 6465 6661 756c 743a 2063 6f6d 7075 7465  default: compute
-00003b50: 5f6d 696e 5f6d 6166 203d 2030 2e30 350a  _min_maf = 0.05.
-00003b60: 2020 2020 6d69 6e5f 6568 683a 2054 7970      min_ehh: Typ
-00003b70: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-00003b80: 6564 5b0a 2020 2020 2020 2020 666c 6f61  ed[.        floa
-00003b90: 742c 0a20 2020 2020 2020 2022 2222 0a20  t,.        """. 
-00003ba0: 2020 2020 2020 204d 696e 696d 756d 2045         Minimum E
-00003bb0: 4848 2062 6579 6f6e 6420 7768 6963 6820  HH beyond which 
-00003bc0: 746f 2074 7275 6e63 6174 6520 696e 7465  to truncate inte
-00003bd0: 6772 6174 6564 2068 6170 6c6f 7479 7065  grated haplotype
-00003be0: 2068 6f6d 6f7a 7967 6f73 6974 790a 2020   homozygosity.  
-00003bf0: 2020 2020 2020 6361 6c63 756c 6174 696f        calculatio
-00003c00: 6e2e 0a20 2020 2020 2020 2022 2222 2c0a  n..        """,.
-00003c10: 2020 2020 5d0a 2020 2020 6d69 6e5f 6568      ].    min_eh
-00003c20: 685f 6465 6661 756c 743a 206d 696e 5f65  h_default: min_e
-00003c30: 6868 203d 2030 2e30 350a 2020 2020 6d61  hh = 0.05.    ma
-00003c40: 785f 6761 703a 2054 7970 6541 6c69 6173  x_gap: TypeAlias
-00003c50: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
-00003c60: 2020 2020 2020 696e 742c 0a20 2020 2020        int,.     
-00003c70: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
-00003c80: 6f20 6e6f 7420 7265 706f 7274 2073 636f  o not report sco
-00003c90: 7265 7320 6966 2045 4848 2073 7061 6e73  res if EHH spans
-00003ca0: 2061 2067 6170 206c 6172 6765 7220 7468   a gap larger th
-00003cb0: 616e 2074 6869 7320 6e75 6d62 6572 206f  an this number o
-00003cc0: 660a 2020 2020 2020 2020 6261 7365 2070  f.        base p
-00003cd0: 6169 7273 2e0a 2020 2020 2020 2020 2222  airs..        ""
-00003ce0: 222c 0a20 2020 205d 0a20 2020 206d 6178  ",.    ].    max
-00003cf0: 5f67 6170 5f64 6566 6175 6c74 3a20 6d61  _gap_default: ma
-00003d00: 785f 6761 7020 3d20 3230 305f 3030 300a  x_gap = 200_000.
-00003d10: 2020 2020 6761 705f 7363 616c 653a 2054      gap_scale: T
-00003d20: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
-00003d30: 6174 6564 5b0a 2020 2020 2020 2020 696e  ated[.        in
-00003d40: 742c 2022 5265 7363 616c 6520 6469 7374  t, "Rescale dist
-00003d50: 616e 6365 2062 6574 7765 656e 2076 6172  ance between var
-00003d60: 6961 6e74 7320 6966 2067 6170 2069 7320  iants if gap is 
-00003d70: 6c61 7267 6572 2074 6861 6e20 7468 6973  larger than this
-00003d80: 2076 616c 7565 2e22 0a20 2020 205d 0a20   value.".    ]. 
-00003d90: 2020 2067 6170 5f73 6361 6c65 5f64 6566     gap_scale_def
-00003da0: 6175 6c74 3a20 6761 705f 7363 616c 6520  ault: gap_scale 
-00003db0: 3d20 3230 5f30 3030 0a20 2020 2069 6e63  = 20_000.    inc
-00003dc0: 6c75 6465 5f65 6467 6573 3a20 5479 7065  lude_edges: Type
-00003dd0: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
-00003de0: 645b 0a20 2020 2020 2020 2062 6f6f 6c2c  d[.        bool,
-00003df0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00003e00: 2020 2020 2049 6620 5472 7565 2c20 7265       If True, re
-00003e10: 706f 7274 2073 636f 7265 7320 6576 656e  port scores even
-00003e20: 2069 6620 4548 4820 646f 6573 206e 6f74   if EHH does not
-00003e30: 2064 6563 6179 2062 656c 6f77 206d 696e   decay below min
-00003e40: 5f65 6868 2061 7420 7468 650a 2020 2020  _ehh at the.    
-00003e50: 2020 2020 656e 6420 6f66 2074 6865 2063      end of the c
-00003e60: 6872 6f6d 6f73 6f6d 652e 0a20 2020 2020  hromosome..     
-00003e70: 2020 2022 2222 2c0a 2020 2020 5d0a 2020     """,.    ].  
-00003e80: 2020 7573 655f 7468 7265 6164 733a 2054    use_threads: T
-00003e90: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
-00003ea0: 6174 6564 5b0a 2020 2020 2020 2020 626f  ated[.        bo
-00003eb0: 6f6c 2c20 2249 6620 5472 7565 2c20 7573  ol, "If True, us
-00003ec0: 6520 6d75 6c74 6970 6c65 2074 6872 6561  e multiple threa
-00003ed0: 6473 2074 6f20 636f 6d70 7574 6520 6948  ds to compute iH
-00003ee0: 532e 220a 2020 2020 5d0a 2020 2020 7061  S.".    ].    pa
-00003ef0: 6c65 7474 653a 2054 7970 6541 6c69 6173  lette: TypeAlias
-00003f00: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
-00003f10: 2020 2020 2020 7374 722c 2022 4e61 6d65        str, "Name
-00003f20: 206f 6620 626f 6b65 6820 7061 6c65 7474   of bokeh palett
-00003f30: 6520 746f 2075 7365 2066 6f72 2070 6c6f  e to use for plo
-00003f40: 7474 696e 6720 6d75 6c74 6970 6c65 2070  tting multiple p
-00003f50: 6572 6365 6e74 696c 6573 2e22 0a20 2020  ercentiles.".   
-00003f60: 205d 0a20 2020 2070 616c 6574 7465 5f64   ].    palette_d
-00003f70: 6566 6175 6c74 3a20 7061 6c65 7474 6520  efault: palette 
-00003f80: 3d20 2242 6c75 6573 220a 0a0a 636c 6173  = "Blues"...clas
-00003f90: 7320 6861 7063 6c75 7374 5f70 6172 616d  s hapclust_param
-00003fa0: 733a 0a20 2020 206c 696e 6b61 6765 5f6d  s:.    linkage_m
-00003fb0: 6574 686f 643a 2054 7970 6541 6c69 6173  ethod: TypeAlias
-00003fc0: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
-00003fd0: 2020 2020 2020 4c69 7465 7261 6c5b 0a20        Literal[. 
-00003fe0: 2020 2020 2020 2020 2020 2022 7369 6e67             "sing
-00003ff0: 6c65 222c 2022 636f 6d70 6c65 7465 222c  le", "complete",
-00004000: 2022 6176 6572 6167 6522 2c20 2277 6569   "average", "wei
-00004010: 6768 7465 6422 2c20 2263 656e 7472 6f69  ghted", "centroi
-00004020: 6422 2c20 226d 6564 6961 6e22 2c20 2277  d", "median", "w
-00004030: 6172 6422 0a20 2020 2020 2020 205d 2c0a  ard".        ],.
-00004040: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00004050: 2020 2020 5468 6520 6c69 6e6b 6167 6520      The linkage 
-00004060: 616c 676f 7269 7468 6d20 746f 2075 7365  algorithm to use
-00004070: 2e20 5365 6520 7468 6520 4c69 6e6b 6167  . See the Linkag
-00004080: 6520 4d65 7468 6f64 7320 7365 6374 696f  e Methods sectio
-00004090: 6e20 6f66 2074 6865 0a20 2020 2020 2020  n of the.       
-000040a0: 2073 6369 7079 2e63 6c75 7374 6572 2e68   scipy.cluster.h
-000040b0: 6965 7261 7263 6879 2e6c 696e 6b61 6765  ierarchy.linkage
-000040c0: 2064 6f63 7320 666f 7220 6675 6c6c 2064   docs for full d
-000040d0: 6573 6372 6970 7469 6f6e 732e 0a20 2020  escriptions..   
-000040e0: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
-000040f0: 2020 2020 6c69 6e6b 6167 655f 6d65 7468      linkage_meth
-00004100: 6f64 5f64 6566 6175 6c74 3a20 6c69 6e6b  od_default: link
-00004110: 6167 655f 6d65 7468 6f64 203d 2022 7369  age_method = "si
-00004120: 6e67 6c65 220a 2020 2020 636f 756e 745f  ngle".    count_
-00004130: 736f 7274 3a20 5479 7065 416c 6961 7320  sort: TypeAlias 
-00004140: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
-00004150: 2020 2020 2062 6f6f 6c2c 0a20 2020 2020       bool,.     
-00004160: 2020 2022 2222 0a20 2020 2020 2020 2046     """.        F
-00004170: 6f72 2065 6163 6820 6e6f 6465 206e 2c20  or each node n, 
-00004180: 7468 6520 6f72 6465 7220 2876 6973 7561  the order (visua
-00004190: 6c6c 792c 2066 726f 6d20 6c65 6674 2d74  lly, from left-t
-000041a0: 6f2d 7269 6768 7429 206e 2773 2074 776f  o-right) n's two
-000041b0: 2064 6573 6365 6e64 616e 740a 2020 2020   descendant.    
-000041c0: 2020 2020 6c69 6e6b 7320 6172 6520 706c      links are pl
-000041d0: 6f74 7465 6420 6973 2064 6574 6572 6d69  otted is determi
-000041e0: 6e65 6420 6279 2074 6869 7320 7061 7261  ned by this para
-000041f0: 6d65 7465 722e 2049 6620 5472 7565 2c20  meter. If True, 
-00004200: 7468 6520 6368 696c 6420 7769 7468 0a20  the child with. 
-00004210: 2020 2020 2020 2074 6865 206d 696e 696d         the minim
-00004220: 756d 206e 756d 6265 7220 6f66 206f 7269  um number of ori
-00004230: 6769 6e61 6c20 6f62 6a65 6374 7320 696e  ginal objects in
-00004240: 2069 7473 2063 6c75 7374 6572 2069 7320   its cluster is 
-00004250: 706c 6f74 7465 6420 6669 7273 742e 204e  plotted first. N
-00004260: 6f74 650a 2020 2020 2020 2020 6469 7374  ote.        dist
-00004270: 616e 6365 5f73 6f72 7420 616e 6420 636f  ance_sort and co
-00004280: 756e 745f 736f 7274 2063 616e 6e6f 7420  unt_sort cannot 
-00004290: 626f 7468 2062 6520 5472 7565 2e0a 2020  both be True..  
-000042a0: 2020 2020 2020 2222 222c 0a20 2020 205d        """,.    ]
-000042b0: 0a20 2020 2064 6973 7461 6e63 655f 736f  .    distance_so
-000042c0: 7274 3a20 5479 7065 416c 6961 7320 3d20  rt: TypeAlias = 
-000042d0: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
-000042e0: 2020 2062 6f6f 6c2c 0a20 2020 2020 2020     bool,.       
-000042f0: 2022 2222 0a20 2020 2020 2020 2046 6f72   """.        For
-00004300: 2065 6163 6820 6e6f 6465 206e 2c20 7468   each node n, th
-00004310: 6520 6f72 6465 7220 2876 6973 7561 6c6c  e order (visuall
-00004320: 792c 2066 726f 6d20 6c65 6674 2d74 6f2d  y, from left-to-
-00004330: 7269 6768 7429 206e 2773 2074 776f 2064  right) n's two d
-00004340: 6573 6365 6e64 616e 740a 2020 2020 2020  escendant.      
-00004350: 2020 6c69 6e6b 7320 6172 6520 706c 6f74    links are plot
-00004360: 7465 6420 6973 2064 6574 6572 6d69 6e65  ted is determine
-00004370: 6420 6279 2074 6869 7320 7061 7261 6d65  d by this parame
-00004380: 7465 722e 2049 6620 5472 7565 2c20 5468  ter. If True, Th
-00004390: 6520 6368 696c 6420 7769 7468 2074 6865  e child with the
-000043a0: 0a20 2020 2020 2020 206d 696e 696d 756d  .        minimum
-000043b0: 2064 6973 7461 6e63 6520 6265 7477 6565   distance betwee
-000043c0: 6e20 6974 7320 6469 7265 6374 2064 6573  n its direct des
-000043d0: 6365 6e64 616e 7473 2069 7320 706c 6f74  cendants is plot
-000043e0: 7465 6420 6669 7273 742e 0a20 2020 2020  ted first..     
-000043f0: 2020 2022 2222 2c0a 2020 2020 5d0a 0a0a     """,.    ]...
-00004400: 636c 6173 7320 6861 706e 6574 5f70 6172  class hapnet_par
-00004410: 616d 733a 0a20 2020 206d 6178 5f64 6973  ams:.    max_dis
-00004420: 743a 2054 7970 6541 6c69 6173 203d 2041  t: TypeAlias = A
-00004430: 6e6e 6f74 6174 6564 5b0a 2020 2020 2020  nnotated[.      
-00004440: 2020 696e 742c 0a20 2020 2020 2020 2022    int,.        "
-00004450: 4a6f 696e 206e 6574 776f 726b 2063 6f6d  Join network com
-00004460: 706f 6e65 6e74 7320 7570 2074 6f20 6120  ponents up to a 
-00004470: 6d61 7869 6d75 6d20 6469 7374 616e 6365  maximum distance
-00004480: 206f 6620 3220 534e 5020 6469 6666 6572   of 2 SNP differ
-00004490: 656e 6365 732e 222c 0a20 2020 205d 0a20  ences.",.    ]. 
-000044a0: 2020 206d 6178 5f64 6973 745f 6465 6661     max_dist_defa
-000044b0: 756c 743a 206d 6178 5f64 6973 7420 3d20  ult: max_dist = 
-000044c0: 320a 2020 2020 636f 6c6f 723a 2054 7970  2.    color: Typ
-000044d0: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-000044e0: 6564 5b0a 2020 2020 2020 2020 7374 722c  ed[.        str,
-000044f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004500: 2020 2020 2049 6465 6e74 6966 6965 7320       Identifies 
-00004510: 6120 636f 6c75 6d6e 2069 6e20 7468 6520  a column in the 
-00004520: 7361 6d70 6c65 206d 6574 6164 6174 6120  sample metadata 
-00004530: 7768 6963 6820 6465 7465 726d 696e 6573  which determines
-00004540: 2074 6865 2063 6f6c 6f75 720a 2020 2020   the colour.    
-00004550: 2020 2020 6f66 2070 6965 2063 6861 7274      of pie chart
-00004560: 2073 6567 6d65 6e74 7320 7769 7468 696e   segments within
-00004570: 206e 6f64 6573 2e0a 2020 2020 2020 2020   nodes..        
-00004580: 2222 222c 0a20 2020 205d 0a20 2020 2063  """,.    ].    c
-00004590: 6f6c 6f72 5f64 6973 6372 6574 655f 7365  olor_discrete_se
-000045a0: 7175 656e 6365 3a20 5479 7065 416c 6961  quence: TypeAlia
-000045b0: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
-000045c0: 2020 2020 2020 204c 6973 742c 2022 5072         List, "Pr
-000045d0: 6f76 6964 6520 6120 6c69 7374 206f 6620  ovide a list of 
-000045e0: 636f 6c6f 7572 7320 746f 2075 7365 2e22  colours to use."
-000045f0: 0a20 2020 205d 0a20 2020 2063 6f6c 6f72  .    ].    color
-00004600: 5f64 6973 6372 6574 655f 6d61 703a 2054  _discrete_map: T
-00004610: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
-00004620: 6174 6564 5b0a 2020 2020 2020 2020 4d61  ated[.        Ma
-00004630: 7070 696e 672c 2022 5072 6f76 6964 6520  pping, "Provide 
-00004640: 616e 2065 7870 6c69 6369 7420 6d61 7070  an explicit mapp
-00004650: 696e 6720 6672 6f6d 2076 616c 7565 7320  ing from values 
-00004660: 746f 2063 6f6c 6f75 7273 2e22 0a20 2020  to colours.".   
-00004670: 205d 0a20 2020 2063 6174 6567 6f72 795f   ].    category_
-00004680: 6f72 6465 723a 2054 7970 6541 6c69 6173  order: TypeAlias
-00004690: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
-000046a0: 2020 2020 2020 4c69 7374 2c0a 2020 2020        List,.    
-000046b0: 2020 2020 2243 6f6e 7472 6f6c 2074 6865      "Control the
-000046c0: 206f 7264 6572 2069 6e20 7768 6963 6820   order in which 
-000046d0: 7661 6c75 6573 2061 7070 6561 7220 696e  values appear in
-000046e0: 2074 6865 206c 6567 656e 642e 222c 0a20   the legend.",. 
-000046f0: 2020 205d 0a20 2020 206e 6f64 655f 7369     ].    node_si
-00004700: 7a65 5f66 6163 746f 723a 2054 7970 6541  ze_factor: TypeA
-00004710: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
-00004720: 5b0a 2020 2020 2020 2020 696e 742c 0a20  [.        int,. 
-00004730: 2020 2020 2020 2022 436f 6e74 726f 6c20         "Control 
-00004740: 7468 6520 7369 7a69 6e67 206f 6620 6e6f  the sizing of no
-00004750: 6465 732e 222c 0a20 2020 205d 0a20 2020  des.",.    ].   
-00004760: 206e 6f64 655f 7369 7a65 5f66 6163 746f   node_size_facto
-00004770: 725f 6465 6661 756c 743a 206e 6f64 655f  r_default: node_
-00004780: 7369 7a65 5f66 6163 746f 7220 3d20 3530  size_factor = 50
-00004790: 0a20 2020 206c 6179 6f75 743a 2054 7970  .    layout: Typ
-000047a0: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
-000047b0: 6564 5b0a 2020 2020 2020 2020 7374 722c  ed[.        str,
-000047c0: 0a20 2020 2020 2020 2022 4e61 6d65 206f  .        "Name o
-000047d0: 6620 7468 6520 6e65 7477 6f72 6b20 6c61  f the network la
-000047e0: 796f 7574 2074 6f20 7573 6520 746f 2070  yout to use to p
-000047f0: 6f73 6974 696f 6e20 6e6f 6465 732e 222c  osition nodes.",
-00004800: 0a20 2020 205d 0a20 2020 206c 6179 6f75  .    ].    layou
-00004810: 745f 6465 6661 756c 743a 206c 6179 6f75  t_default: layou
-00004820: 7420 3d20 2263 6f73 6522 0a20 2020 206c  t = "cose".    l
-00004830: 6179 6f75 745f 7061 7261 6d73 3a20 5479  ayout_params: Ty
-00004840: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
-00004850: 7465 645b 0a20 2020 2020 2020 204d 6170  ted[.        Map
-00004860: 7069 6e67 2c0a 2020 2020 2020 2020 2241  ping,.        "A
-00004870: 6464 6974 696f 6e61 6c20 7061 7261 6d65  dditional parame
-00004880: 7465 7273 2074 6f20 7468 6520 6c61 796f  ters to the layo
-00004890: 7574 2061 6c67 6f72 6974 686d 2e22 2c0a  ut algorithm.",.
-000048a0: 2020 2020 5d0a 0a0a 636c 6173 7320 6461      ]...class da
-000048b0: 7368 5f70 6172 616d 733a 0a20 2020 2068  sh_params:.    h
-000048c0: 6569 6768 743a 2054 7970 6541 6c69 6173  eight: TypeAlias
-000048d0: 203d 2041 6e6e 6f74 6174 6564 5b69 6e74   = Annotated[int
-000048e0: 2c20 2248 6569 6768 7420 6f66 2074 6865  , "Height of the
-000048f0: 2044 6173 6820 6170 7020 696e 2070 6978   Dash app in pix
-00004900: 656c 7320 2870 7829 2e22 5d0a 2020 2020  els (px)."].    
-00004910: 7769 6474 683a 2054 7970 6541 6c69 6173  width: TypeAlias
-00004920: 203d 2041 6e6e 6f74 6174 6564 5b55 6e69   = Annotated[Uni
-00004930: 6f6e 5b69 6e74 2c20 7374 725d 2c20 2257  on[int, str], "W
-00004940: 6964 7468 206f 6620 7468 6520 4461 7368  idth of the Dash
-00004950: 2061 7070 2e22 5d0a 2020 2020 7365 7276   app."].    serv
-00004960: 6572 5f6d 6f64 653a 2054 7970 6541 6c69  er_mode: TypeAli
-00004970: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
-00004980: 2020 2020 2020 2020 4c69 7465 7261 6c5b          Literal[
-00004990: 2269 6e6c 696e 6522 2c20 2265 7874 6572  "inline", "exter
-000049a0: 6e61 6c22 2c20 226a 7570 7974 6572 6c61  nal", "jupyterla
-000049b0: 6222 5d2c 0a20 2020 2020 2020 2022 2222  b"],.        """
-000049c0: 0a20 2020 2020 2020 2043 6f6e 7472 6f6c  .        Control
-000049d0: 7320 686f 7720 7468 6520 4a75 7079 7465  s how the Jupyte
-000049e0: 7220 4461 7368 2061 7070 2077 696c 6c20  r Dash app will 
-000049f0: 6265 206c 6175 6e63 6865 642e 2053 6565  be launched. See
-00004a00: 0a20 2020 2020 2020 2068 7474 7073 3a2f  .        https:/
-00004a10: 2f6d 6564 6975 6d2e 636f 6d2f 706c 6f74  /medium.com/plot
-00004a20: 6c79 2f69 6e74 726f 6475 6369 6e67 2d6a  ly/introducing-j
-00004a30: 7570 7974 6572 6461 7368 2d38 3131 6631  upyterdash-811f1
-00004a40: 6635 3763 3032 6520 666f 720a 2020 2020  f57c02e for.    
-00004a50: 2020 2020 6d6f 7265 2069 6e66 6f72 6d61      more informa
-00004a60: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
-00004a70: 222c 0a20 2020 205d 0a20 2020 2073 6572  ",.    ].    ser
-00004a80: 7665 725f 6d6f 6465 5f64 6566 6175 6c74  ver_mode_default
-00004a90: 3a20 7365 7276 6572 5f6d 6f64 6520 3d20  : server_mode = 
-00004aa0: 2269 6e6c 696e 6522 0a20 2020 2073 6572  "inline".    ser
-00004ab0: 7665 725f 706f 7274 3a20 5479 7065 416c  ver_port: TypeAl
-00004ac0: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
-00004ad0: 0a20 2020 2020 2020 2069 6e74 2c0a 2020  .        int,.  
-00004ae0: 2020 2020 2020 224d 616e 7561 6c6c 7920        "Manually 
-00004af0: 6f76 6572 7269 6465 2074 6865 2070 6f72  override the por
-00004b00: 7420 6f6e 2077 6869 6368 2074 6865 2044  t on which the D
-00004b10: 6173 6820 6170 7020 7769 6c6c 2072 756e  ash app will run
-00004b20: 2e22 2c0a 2020 2020 5d0a 0a0a 2320 4e2e  .",.    ]...# N.
-00004b30: 422e 2c20 7765 2061 7265 2069 6e20 7468  B., we are in th
-00004b40: 6520 7072 6f63 6573 7320 6f66 2062 7265  e process of bre
-00004b50: 616b 696e 6720 7570 2074 6865 2041 6e6f  aking up the Ano
-00004b60: 7068 656c 6573 4461 7461 5265 736f 7572  phelesDataResour
-00004b70: 6365 0a23 2063 6c61 7373 2069 6e74 6f20  ce.# class into 
-00004b80: 6d75 6c74 6970 6c65 2070 6172 656e 7420  multiple parent 
-00004b90: 636c 6173 7365 7320 6c69 6b65 2041 6e6f  classes like Ano
-00004ba0: 7068 656c 6573 4765 6e6f 6d65 5365 7175  phelesGenomeSequ
-00004bb0: 656e 6365 4461 7461 0a23 2061 6e64 2041  enceData.# and A
-00004bc0: 6e6f 7068 656c 6573 4261 7365 2e20 5468  nophelesBase. Th
-00004bd0: 6973 2069 7320 776f 726b 2069 6e20 7072  is is work in pr
-00004be0: 6f67 7265 7373 2c20 616e 6420 6675 7274  ogress, and furt
-00004bf0: 6865 7220 5052 7320 6172 650a 2320 6578  her PRs are.# ex
-00004c00: 7065 6374 6564 2074 6f20 6661 6374 6f72  pected to factor
-00004c10: 206f 7574 2066 756e 6374 696f 6e73 2064   out functions d
-00004c20: 6566 696e 6564 2068 6572 6520 696e 2074  efined here in t
-00004c30: 6f20 7365 7061 7261 7465 2063 6c61 7373  o separate class
-00004c40: 6573 2e0a 2320 466f 7220 6d6f 7265 2069  es..# For more i
-00004c50: 6e66 6f72 6d61 7469 6f6e 2c20 7365 653a  nformation, see:
-00004c60: 0a23 0a23 2068 7474 7073 3a2f 2f67 6974  .#.# https://git
-00004c70: 6875 622e 636f 6d2f 6d61 6c61 7269 6167  hub.com/malariag
-00004c80: 656e 2f6d 616c 6172 6961 6765 6e2d 6461  en/malariagen-da
-00004c90: 7461 2d70 7974 686f 6e2f 6973 7375 6573  ta-python/issues
-00004ca0: 2f33 3636 0a23 0a23 204e 2e42 2e2c 2077  /366.#.# N.B., w
-00004cb0: 6520 6172 6520 6d61 6b69 6e67 2075 7365  e are making use
-00004cc0: 206f 6620 6d75 6c74 6970 6c65 2069 6e68   of multiple inh
-00004cd0: 6572 6974 616e 6365 2068 6572 652c 2075  eritance here, u
-00004ce0: 7369 6e67 2063 6f2d 6f70 6572 6174 6976  sing co-operativ
-00004cf0: 650a 2320 636c 6173 7365 732e 2042 6563  e.# classes. Bec
-00004d00: 6175 7365 206f 6620 7468 6520 7761 7920  ause of the way 
-00004d10: 7468 6174 206d 756c 7469 706c 6520 696e  that multiple in
-00004d20: 6865 7269 7461 6e63 6520 776f 726b 7320  heritance works 
-00004d30: 696e 2050 7974 686f 6e2c 0a23 2069 7420  in Python,.# it 
-00004d40: 6973 2069 6d70 6f72 7461 6e74 2074 6861  is important tha
-00004d50: 7420 7468 6573 6520 7061 7265 6e74 2063  t these parent c
-00004d60: 6c61 7373 6573 2061 7265 2070 726f 7669  lasses are provi
-00004d70: 6465 6420 696e 2061 2070 6172 7469 6375  ded in a particu
-00004d80: 6c61 720a 2320 6f72 6465 722e 204f 7468  lar.# order. Oth
-00004d90: 6572 7769 7365 2074 6865 206c 696e 6561  erwise the linea
-00004da0: 7269 7a61 7469 6f6e 206f 6620 7061 7265  rization of pare
-00004db0: 6e74 2063 6c61 7373 6573 2077 696c 6c20  nt classes will 
-00004dc0: 6661 696c 2e20 466f 720a 2320 6d6f 7265  fail. For.# more
-00004dd0: 2069 6e66 6f72 6d61 7469 6f6e 2061 626f   information abo
-00004de0: 7574 2073 7570 6572 636c 6173 7320 6c69  ut superclass li
-00004df0: 6e65 6172 697a 6174 696f 6e20 616e 6420  nearization and 
-00004e00: 6d65 7468 6f64 2072 6573 6f6c 7574 696f  method resolutio
-00004e10: 6e0a 2320 6f72 6465 7220 696e 2050 7974  n.# order in Pyt
-00004e20: 686f 6e2c 2074 6865 2066 6f6c 6c6f 7769  hon, the followi
-00004e30: 6e67 206c 696e 6b73 206d 6179 2062 6520  ng links may be 
-00004e40: 7573 6566 756c 2e0a 230a 2320 6874 7470  useful..#.# http
-00004e50: 733a 2f2f 656e 2e77 696b 6970 6564 6961  s://en.wikipedia
-00004e60: 2e6f 7267 2f77 696b 692f 4333 5f6c 696e  .org/wiki/C3_lin
-00004e70: 6561 7269 7a61 7469 6f6e 0a23 2068 7474  earization.# htt
-00004e80: 7073 3a2f 2f72 6865 7474 696e 6765 722e  ps://rhettinger.
-00004e90: 776f 7264 7072 6573 732e 636f 6d2f 3230  wordpress.com/20
-00004ea0: 3131 2f30 352f 3236 2f73 7570 6572 2d63  11/05/26/super-c
-00004eb0: 6f6e 7369 6465 7265 642d 7375 7065 722f  onsidered-super/
-00004ec0: 0a0a 0a23 2077 6f72 6b20 6172 6f75 6e64  ...# work around
-00004ed0: 2070 7963 6861 726d 2066 6169 6c69 6e67   pycharm failing
-00004ee0: 2074 6f20 7265 636f 676e 6973 6520 7468   to recognise th
-00004ef0: 6174 2064 6f63 2829 2069 7320 6361 6c6c  at doc() is call
-00004f00: 6162 6c65 0a23 206e 6f69 6e73 7065 6374  able.# noinspect
-00004f10: 696f 6e20 5079 4361 6c6c 696e 674e 6f6e  ion PyCallingNon
-00004f20: 4361 6c6c 6162 6c65 0a63 6c61 7373 2041  Callable.class A
-00004f30: 6e6f 7068 656c 6573 4461 7461 5265 736f  nophelesDataReso
-00004f40: 7572 6365 280a 2020 2020 416e 6f70 6865  urce(.    Anophe
-00004f50: 6c65 7347 656e 6f6d 6546 6561 7475 7265  lesGenomeFeature
-00004f60: 7344 6174 612c 0a20 2020 2041 6e6f 7068  sData,.    Anoph
-00004f70: 656c 6573 4765 6e6f 6d65 5365 7175 656e  elesGenomeSequen
-00004f80: 6365 4461 7461 2c0a 2020 2020 416e 6f70  ceData,.    Anop
-00004f90: 6865 6c65 7342 6173 652c 0a29 3a0a 2020  helesBase,.):.  
-00004fa0: 2020 2222 2241 6e6f 7068 656c 6573 2064    """Anopheles d
-00004fb0: 6174 6120 7265 736f 7572 6365 732e 2222  ata resources.""
-00004fc0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00004fd0: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
-00004fe0: 662c 0a20 2020 2020 2020 2075 726c 2c0a  f,.        url,.
-00004ff0: 2020 2020 2020 2020 636f 6e66 6967 5f70          config_p
-00005000: 6174 682c 0a20 2020 2020 2020 2063 6f68  ath,.        coh
-00005010: 6f72 7473 5f61 6e61 6c79 7369 732c 0a20  orts_analysis,. 
-00005020: 2020 2020 2020 2073 6974 655f 6669 6c74         site_filt
-00005030: 6572 735f 616e 616c 7973 6973 2c0a 2020  ers_analysis,.  
-00005040: 2020 2020 2020 626f 6b65 685f 6f75 7470        bokeh_outp
-00005050: 7574 5f6e 6f74 6562 6f6f 6b2c 0a20 2020  ut_notebook,.   
-00005060: 2020 2020 2072 6573 756c 7473 5f63 6163       results_cac
-00005070: 6865 2c0a 2020 2020 2020 2020 6c6f 672c  he,.        log,
-00005080: 0a20 2020 2020 2020 2064 6562 7567 2c0a  .        debug,.
-00005090: 2020 2020 2020 2020 7368 6f77 5f70 726f          show_pro
-000050a0: 6772 6573 732c 0a20 2020 2020 2020 2063  gress,.        c
-000050b0: 6865 636b 5f6c 6f63 6174 696f 6e2c 0a20  heck_location,. 
-000050c0: 2020 2020 2020 2070 7265 2c0a 2020 2020         pre,.    
-000050d0: 2020 2020 6763 735f 7572 6c3a 2073 7472      gcs_url: str
-000050e0: 2c0a 2020 2020 2020 2020 6d61 6a6f 725f  ,.        major_
-000050f0: 7665 7273 696f 6e5f 6e75 6d62 6572 3a20  version_number: 
-00005100: 696e 742c 0a20 2020 2020 2020 206d 616a  int,.        maj
-00005110: 6f72 5f76 6572 7369 6f6e 5f70 6174 683a  or_version_path:
-00005120: 2073 7472 2c0a 2020 2020 2020 2020 6766   str,.        gf
-00005130: 665f 6765 6e65 5f74 7970 653a 2073 7472  f_gene_type: str
-00005140: 2c0a 2020 2020 2020 2020 6766 665f 6465  ,.        gff_de
-00005150: 6661 756c 745f 6174 7472 6962 7574 6573  fault_attributes
-00005160: 3a20 5475 706c 655b 7374 725d 2c0a 2020  : Tuple[str],.  
-00005170: 2020 2020 2020 7374 6f72 6167 655f 6f70        storage_op
-00005180: 7469 6f6e 733a 204d 6170 7069 6e67 2c20  tions: Mapping, 
-00005190: 2023 2075 7365 6420 6279 2066 7373 7065   # used by fsspe
-000051a0: 6320 7669 6120 696e 6974 5f66 696c 6573  c via init_files
-000051b0: 7973 7465 6d28 7572 6c2c 202a 2a6b 7761  ystem(url, **kwa
-000051c0: 7267 7329 0a20 2020 2029 3a0a 2020 2020  rgs).    ):.    
-000051d0: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
-000051e0: 6974 5f5f 280a 2020 2020 2020 2020 2020  it__(.          
-000051f0: 2020 7572 6c3d 7572 6c2c 0a20 2020 2020    url=url,.     
-00005200: 2020 2020 2020 2063 6f6e 6669 675f 7061         config_pa
-00005210: 7468 3d63 6f6e 6669 675f 7061 7468 2c0a  th=config_path,.
-00005220: 2020 2020 2020 2020 2020 2020 626f 6b65              boke
-00005230: 685f 6f75 7470 7574 5f6e 6f74 6562 6f6f  h_output_noteboo
-00005240: 6b3d 626f 6b65 685f 6f75 7470 7574 5f6e  k=bokeh_output_n
-00005250: 6f74 6562 6f6f 6b2c 0a20 2020 2020 2020  otebook,.       
-00005260: 2020 2020 206c 6f67 3d6c 6f67 2c0a 2020       log=log,.  
-00005270: 2020 2020 2020 2020 2020 6465 6275 673d            debug=
-00005280: 6465 6275 672c 0a20 2020 2020 2020 2020  debug,.         
-00005290: 2020 2073 686f 775f 7072 6f67 7265 7373     show_progress
-000052a0: 3d73 686f 775f 7072 6f67 7265 7373 2c0a  =show_progress,.
-000052b0: 2020 2020 2020 2020 2020 2020 6368 6563              chec
-000052c0: 6b5f 6c6f 6361 7469 6f6e 3d63 6865 636b  k_location=check
-000052d0: 5f6c 6f63 6174 696f 6e2c 0a20 2020 2020  _location,.     
-000052e0: 2020 2020 2020 2070 7265 3d70 7265 2c0a         pre=pre,.
-000052f0: 2020 2020 2020 2020 2020 2020 6763 735f              gcs_
-00005300: 7572 6c3d 6763 735f 7572 6c2c 0a20 2020  url=gcs_url,.   
-00005310: 2020 2020 2020 2020 206d 616a 6f72 5f76           major_v
-00005320: 6572 7369 6f6e 5f6e 756d 6265 723d 6d61  ersion_number=ma
-00005330: 6a6f 725f 7665 7273 696f 6e5f 6e75 6d62  jor_version_numb
-00005340: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00005350: 6d61 6a6f 725f 7665 7273 696f 6e5f 7061  major_version_pa
-00005360: 7468 3d6d 616a 6f72 5f76 6572 7369 6f6e  th=major_version
-00005370: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
-00005380: 2020 2073 746f 7261 6765 5f6f 7074 696f     storage_optio
-00005390: 6e73 3d73 746f 7261 6765 5f6f 7074 696f  ns=storage_optio
-000053a0: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-000053b0: 6766 665f 6765 6e65 5f74 7970 653d 6766  gff_gene_type=gf
-000053c0: 665f 6765 6e65 5f74 7970 652c 0a20 2020  f_gene_type,.   
-000053d0: 2020 2020 2020 2020 2067 6666 5f64 6566           gff_def
-000053e0: 6175 6c74 5f61 7474 7269 6275 7465 733d  ault_attributes=
-000053f0: 6766 665f 6465 6661 756c 745f 6174 7472  gff_default_attr
-00005400: 6962 7574 6573 2c0a 2020 2020 2020 2020  ibutes,.        
-00005410: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
-00005420: 2075 7020 6174 7472 6962 7574 6573 0a20   up attributes. 
-00005430: 2020 2020 2020 2073 656c 662e 5f73 6974         self._sit
-00005440: 655f 6669 6c74 6572 735f 616e 616c 7973  e_filters_analys
-00005450: 6973 203d 2073 6974 655f 6669 6c74 6572  is = site_filter
-00005460: 735f 616e 616c 7973 6973 0a0a 2020 2020  s_analysis..    
-00005470: 2020 2020 2320 7365 7420 7570 2063 6163      # set up cac
-00005480: 6865 730a 2020 2020 2020 2020 2320 544f  hes.        # TO
-00005490: 444f 2072 6576 6965 7720 7479 7065 2061  DO review type a
-000054a0: 6e6e 6f74 6174 696f 6e73 2068 6572 652c  nnotations here,
-000054b0: 206d 6179 6265 2063 616e 2074 6967 6874   maybe can tight
-000054c0: 656e 0a20 2020 2020 2020 2073 656c 662e  en.        self.
-000054d0: 5f63 6163 6865 5f67 656e 6572 616c 5f6d  _cache_general_m
-000054e0: 6574 6164 6174 613a 2044 6963 7420 3d20  etadata: Dict = 
-000054f0: 6469 6374 2829 0a20 2020 2020 2020 2073  dict().        s
-00005500: 656c 662e 5f63 6163 6865 5f73 6974 655f  elf._cache_site_
-00005510: 6669 6c74 6572 733a 2044 6963 7420 3d20  filters: Dict = 
-00005520: 6469 6374 2829 0a20 2020 2020 2020 2073  dict().        s
-00005530: 656c 662e 5f63 6163 6865 5f73 6e70 5f73  elf._cache_snp_s
-00005540: 6974 6573 203d 204e 6f6e 650a 2020 2020  ites = None.    
-00005550: 2020 2020 7365 6c66 2e5f 6361 6368 655f      self._cache_
-00005560: 736e 705f 6765 6e6f 7479 7065 733a 2044  snp_genotypes: D
-00005570: 6963 7420 3d20 6469 6374 2829 0a20 2020  ict = dict().   
-00005580: 2020 2020 2073 656c 662e 5f63 6163 6865       self._cache
-00005590: 5f61 6e6e 6f74 6174 6f72 203d 204e 6f6e  _annotator = Non
-000055a0: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-000055b0: 6361 6368 655f 6765 6e6f 6d65 5f66 6561  cache_genome_fea
-000055c0: 7475 7265 733a 2044 6963 7420 3d20 6469  tures: Dict = di
-000055d0: 6374 2829 0a20 2020 2020 2020 2073 656c  ct().        sel
-000055e0: 662e 5f63 6163 6865 5f73 616d 706c 655f  f._cache_sample_
-000055f0: 6d65 7461 6461 7461 3a20 4469 6374 203d  metadata: Dict =
-00005600: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-00005610: 7365 6c66 2e5f 6361 6368 655f 7369 7465  self._cache_site
-00005620: 5f61 6e6e 6f74 6174 696f 6e73 203d 204e  _annotations = N
-00005630: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-00005640: 2e5f 6361 6368 655f 6c6f 6361 7465 5f73  ._cache_locate_s
-00005650: 6974 655f 636c 6173 733a 2044 6963 7420  ite_class: Dict 
-00005660: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
-00005670: 2073 656c 662e 5f63 6163 6865 5f63 6f68   self._cache_coh
-00005680: 6f72 745f 6d65 7461 6461 7461 3a20 4469  ort_metadata: Di
-00005690: 6374 203d 2064 6963 7428 290a 2020 2020  ct = dict().    
-000056a0: 2020 2020 7365 6c66 2e5f 6361 6368 655f      self._cache_
-000056b0: 6861 706c 6f74 7970 6573 3a20 4469 6374  haplotypes: Dict
-000056c0: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-000056d0: 2020 7365 6c66 2e5f 6361 6368 655f 6861    self._cache_ha
-000056e0: 706c 6f74 7970 655f 7369 7465 733a 2044  plotype_sites: D
-000056f0: 6963 7420 3d20 6469 6374 2829 0a0a 2020  ict = dict()..  
-00005700: 2020 2020 2020 6966 2072 6573 756c 7473        if results
-00005710: 5f63 6163 6865 2069 7320 6e6f 7420 4e6f  _cache is not No
-00005720: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00005730: 7265 7375 6c74 735f 6361 6368 6520 3d20  results_cache = 
-00005740: 5061 7468 2872 6573 756c 7473 5f63 6163  Path(results_cac
-00005750: 6865 292e 6578 7061 6e64 7573 6572 2829  he).expanduser()
-00005760: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-00005770: 2020 2073 656c 662e 5f72 6573 756c 7473     self._results
-00005780: 5f63 6163 6865 203d 2072 6573 756c 7473  _cache = results
-00005790: 5f63 6163 6865 0a0a 2020 2020 2020 2020  _cache..        
-000057a0: 2320 7365 7420 616e 616c 7973 6973 2076  # set analysis v
-000057b0: 6572 7369 6f6e 730a 0a20 2020 2020 2020  ersions..       
-000057c0: 2069 6620 636f 686f 7274 735f 616e 616c   if cohorts_anal
-000057d0: 7973 6973 2069 7320 4e6f 6e65 3a0a 2020  ysis is None:.  
-000057e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000057f0: 636f 686f 7274 735f 616e 616c 7973 6973  cohorts_analysis
-00005800: 203d 2073 656c 662e 636f 6e66 6967 2e67   = self.config.g
-00005810: 6574 2822 4445 4641 554c 545f 434f 484f  et("DEFAULT_COHO
-00005820: 5254 535f 414e 414c 5953 4953 2229 0a20  RTS_ANALYSIS"). 
-00005830: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00005840: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-00005850: 6f68 6f72 7473 5f61 6e61 6c79 7369 7320  ohorts_analysis 
-00005860: 3d20 636f 686f 7274 735f 616e 616c 7973  = cohorts_analys
-00005870: 6973 0a0a 2020 2020 2020 2020 6966 2073  is..        if s
-00005880: 6974 655f 6669 6c74 6572 735f 616e 616c  ite_filters_anal
-00005890: 7973 6973 2069 7320 4e6f 6e65 3a0a 2020  ysis is None:.  
-000058a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000058b0: 7369 7465 5f66 696c 7465 7273 5f61 6e61  site_filters_ana
-000058c0: 6c79 7369 7320 3d20 7365 6c66 2e63 6f6e  lysis = self.con
-000058d0: 6669 672e 6765 7428 0a20 2020 2020 2020  fig.get(.       
-000058e0: 2020 2020 2020 2020 2022 4445 4641 554c           "DEFAUL
-000058f0: 545f 5349 5445 5f46 494c 5445 5253 5f41  T_SITE_FILTERS_A
-00005900: 4e41 4c59 5349 5322 0a20 2020 2020 2020  NALYSIS".       
-00005910: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00005920: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00005930: 2073 656c 662e 5f73 6974 655f 6669 6c74   self._site_filt
-00005940: 6572 735f 616e 616c 7973 6973 203d 2073  ers_analysis = s
-00005950: 6974 655f 6669 6c74 6572 735f 616e 616c  ite_filters_anal
-00005960: 7973 6973 0a0a 2020 2020 2020 2020 2320  ysis..        # 
-00005970: 7365 7420 7570 2065 7874 7261 206d 6574  set up extra met
-00005980: 6164 6174 610a 2020 2020 2020 2020 7365  adata.        se
-00005990: 6c66 2e5f 6578 7472 615f 6d65 7461 6461  lf._extra_metada
-000059a0: 7461 3a20 4c69 7374 203d 205b 5d0a 0a20  ta: List = [].. 
-000059b0: 2020 2023 2053 7461 7274 206f 6620 4070     # Start of @p
-000059c0: 726f 7065 7274 790a 0a20 2020 2040 7072  roperty..    @pr
-000059d0: 6f70 6572 7479 0a20 2020 2040 6162 7374  operty.    @abst
-000059e0: 7261 6374 6d65 7468 6f64 0a20 2020 2064  ractmethod.    d
-000059f0: 6566 205f 7063 615f 7265 7375 6c74 735f  ef _pca_results_
-00005a00: 6361 6368 655f 6e61 6d65 2873 656c 6629  cache_name(self)
-00005a10: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00005a20: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-00005a30: 726f 7228 224d 7573 7420 6f76 6572 7269  ror("Must overri
-00005a40: 6465 205f 7063 615f 7265 7375 6c74 735f  de _pca_results_
-00005a50: 6361 6368 655f 6e61 6d65 2229 0a0a 2020  cache_name")..  
-00005a60: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00005a70: 4061 6273 7472 6163 746d 6574 686f 640a  @abstractmethod.
-00005a80: 2020 2020 6465 6620 5f73 6e70 5f61 6c6c      def _snp_all
-00005a90: 656c 655f 636f 756e 7473 5f72 6573 756c  ele_counts_resul
-00005aa0: 7473 5f63 6163 6865 5f6e 616d 6528 7365  ts_cache_name(se
-00005ab0: 6c66 293a 0a20 2020 2020 2020 2072 6169  lf):.        rai
-00005ac0: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-00005ad0: 6445 7272 6f72 2822 4d75 7374 206f 7665  dError("Must ove
-00005ae0: 7272 6964 6520 5f73 6e70 5f61 6c6c 656c  rride _snp_allel
-00005af0: 655f 636f 756e 7473 5f72 6573 756c 7473  e_counts_results
-00005b00: 5f63 6163 6865 5f6e 616d 6522 290a 0a20  _cache_name").. 
-00005b10: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00005b20: 2040 6162 7374 7261 6374 6d65 7468 6f64   @abstractmethod
-00005b30: 0a20 2020 2064 6566 205f 6673 745f 6777  .    def _fst_gw
-00005b40: 7373 5f72 6573 756c 7473 5f63 6163 6865  ss_results_cache
-00005b50: 5f6e 616d 6528 7365 6c66 293a 0a20 2020  _name(self):.   
-00005b60: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-00005b70: 706c 656d 656e 7465 6445 7272 6f72 2822  plementedError("
-00005b80: 4d75 7374 206f 7665 7272 6964 6520 5f66  Must override _f
-00005b90: 7374 5f67 7773 735f 7265 7375 6c74 735f  st_gwss_results_
-00005ba0: 6361 6368 655f 6e61 6d65 2229 0a0a 2020  cache_name")..  
-00005bb0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00005bc0: 4061 6273 7472 6163 746d 6574 686f 640a  @abstractmethod.
-00005bd0: 2020 2020 6465 6620 5f68 3132 5f63 616c      def _h12_cal
-00005be0: 6962 7261 7469 6f6e 5f63 6163 6865 5f6e  ibration_cache_n
-00005bf0: 616d 6528 7365 6c66 293a 0a20 2020 2020  ame(self):.     
-00005c00: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-00005c10: 656d 656e 7465 6445 7272 6f72 2822 4d75  ementedError("Mu
-00005c20: 7374 206f 7665 7272 6964 6520 5f68 3132  st override _h12
-00005c30: 5f63 616c 6962 7261 7469 6f6e 5f63 6163  _calibration_cac
-00005c40: 6865 5f6e 616d 6522 290a 0a20 2020 2040  he_name")..    @
-00005c50: 7072 6f70 6572 7479 0a20 2020 2040 6162  property.    @ab
-00005c60: 7374 7261 6374 6d65 7468 6f64 0a20 2020  stractmethod.   
-00005c70: 2064 6566 205f 6731 3233 5f63 616c 6962   def _g123_calib
-00005c80: 7261 7469 6f6e 5f63 6163 6865 5f6e 616d  ration_cache_nam
-00005c90: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00005ca0: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-00005cb0: 656e 7465 6445 7272 6f72 2822 4d75 7374  entedError("Must
-00005cc0: 206f 7665 7272 6964 6520 5f67 3132 335f   override _g123_
-00005cd0: 6361 6c69 6272 6174 696f 6e5f 6361 6368  calibration_cach
-00005ce0: 655f 6e61 6d65 2229 0a0a 2020 2020 4070  e_name")..    @p
-00005cf0: 726f 7065 7274 790a 2020 2020 4061 6273  roperty.    @abs
-00005d00: 7472 6163 746d 6574 686f 640a 2020 2020  tractmethod.    
-00005d10: 6465 6620 5f68 3132 5f67 7773 735f 6361  def _h12_gwss_ca
-00005d20: 6368 655f 6e61 6d65 2873 656c 6629 3a0a  che_name(self):.
-00005d30: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-00005d40: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-00005d50: 7228 224d 7573 7420 6f76 6572 7269 6465  r("Must override
-00005d60: 205f 6831 325f 6777 7373 5f63 6163 6865   _h12_gwss_cache
-00005d70: 5f6e 616d 6522 290a 0a20 2020 2040 7072  _name")..    @pr
-00005d80: 6f70 6572 7479 0a20 2020 2040 6162 7374  operty.    @abst
-00005d90: 7261 6374 6d65 7468 6f64 0a20 2020 2064  ractmethod.    d
-00005da0: 6566 205f 6731 3233 5f67 7773 735f 6361  ef _g123_gwss_ca
-00005db0: 6368 655f 6e61 6d65 2873 656c 6629 3a0a  che_name(self):.
-00005dc0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-00005dd0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-00005de0: 7228 224d 7573 7420 6f76 6572 7269 6465  r("Must override
-00005df0: 205f 6731 3233 5f67 7773 735f 6361 6368   _g123_gwss_cach
-00005e00: 655f 6e61 6d65 2229 0a0a 2020 2020 4070  e_name")..    @p
-00005e10: 726f 7065 7274 790a 2020 2020 4061 6273  roperty.    @abs
-00005e20: 7472 6163 746d 6574 686f 640a 2020 2020  tractmethod.    
-00005e30: 6465 6620 5f68 3178 5f67 7773 735f 6361  def _h1x_gwss_ca
-00005e40: 6368 655f 6e61 6d65 2873 656c 6629 3a0a  che_name(self):.
-00005e50: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-00005e60: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-00005e70: 7228 224d 7573 7420 6f76 6572 7269 6465  r("Must override
-00005e80: 205f 6831 785f 6777 7373 5f63 6163 6865   _h1x_gwss_cache
-00005e90: 5f6e 616d 6522 290a 0a20 2020 2040 7072  _name")..    @pr
-00005ea0: 6f70 6572 7479 0a20 2020 2040 6162 7374  operty.    @abst
-00005eb0: 7261 6374 6d65 7468 6f64 0a20 2020 2064  ractmethod.    d
-00005ec0: 6566 205f 6968 735f 6777 7373 5f63 6163  ef _ihs_gwss_cac
-00005ed0: 6865 5f6e 616d 6528 7365 6c66 293a 0a20  he_name(self):. 
-00005ee0: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00005ef0: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-00005f00: 2822 4d75 7374 206f 7665 7272 6964 6520  ("Must override 
-00005f10: 5f69 6873 5f67 7773 735f 6361 6368 655f  _ihs_gwss_cache_
-00005f20: 6e61 6d65 2229 0a0a 2020 2020 4070 726f  name")..    @pro
-00005f30: 7065 7274 790a 2020 2020 4061 6273 7472  perty.    @abstr
-00005f40: 6163 746d 6574 686f 640a 2020 2020 6465  actmethod.    de
-00005f50: 6620 5f73 6974 655f 616e 6e6f 7461 7469  f _site_annotati
-00005f60: 6f6e 735f 7a61 7272 5f70 6174 6828 7365  ons_zarr_path(se
-00005f70: 6c66 293a 0a20 2020 2020 2020 2072 6169  lf):.        rai
-00005f80: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-00005f90: 6445 7272 6f72 2822 4d75 7374 206f 7665  dError("Must ove
-00005fa0: 7272 6964 6520 5f73 6974 655f 616e 6e6f  rride _site_anno
-00005fb0: 7461 7469 6f6e 735f 7a61 7272 5f70 6174  tations_zarr_pat
-00005fc0: 6822 290a 0a20 2020 2023 2053 7461 7274  h")..    # Start
-00005fd0: 206f 6620 4061 6273 7472 6163 746d 6574   of @abstractmet
-00005fe0: 686f 640a 0a20 2020 2040 7072 6f70 6572  hod..    @proper
-00005ff0: 7479 0a20 2020 2040 6162 7374 7261 6374  ty.    @abstract
-00006000: 6d65 7468 6f64 0a20 2020 2064 6566 2073  method.    def s
-00006010: 6974 655f 6d61 736b 5f69 6473 2873 656c  ite_mask_ids(sel
-00006020: 6629 3a0a 2020 2020 2020 2020 2222 2249  f):.        """I
-00006030: 6465 6e74 6966 6965 7273 2066 6f72 2074  dentifiers for t
-00006040: 6865 2064 6966 6665 7265 6e74 2073 6974  he different sit
-00006050: 6520 6d61 736b 7320 7468 6174 2061 7265  e masks that are
-00006060: 2061 7661 696c 6162 6c65 2e0a 2020 2020   available..    
-00006070: 2020 2020 5468 6573 6520 6172 6520 7661      These are va
-00006080: 6c75 6573 2074 6861 6e20 6361 6e20 6265  lues than can be
-00006090: 2075 7365 6420 666f 7220 7468 6520 6073   used for the `s
-000060a0: 6974 655f 6d61 736b 6020 7061 7261 6d65  ite_mask` parame
-000060b0: 7465 7220 696e 2061 6e79 0a20 2020 2020  ter in any.     
-000060c0: 2020 206d 6574 686f 6420 6d61 6b69 6e67     method making
-000060d0: 2075 7369 6e67 206f 6620 534e 5020 6461   using of SNP da
-000060e0: 7461 2e0a 0a20 2020 2020 2020 2022 2222  ta...        """
-000060f0: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
-00006100: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-00006110: 6f72 2822 4d75 7374 206f 7665 7272 6964  or("Must overrid
-00006120: 6520 5f73 6974 655f 6d61 736b 5f69 6473  e _site_mask_ids
-00006130: 2229 0a0a 2020 2020 4070 726f 7065 7274  ")..    @propert
-00006140: 790a 2020 2020 4061 6273 7472 6163 746d  y.    @abstractm
-00006150: 6574 686f 640a 2020 2020 6465 6620 5f64  ethod.    def _d
-00006160: 6566 6175 6c74 5f73 6974 655f 6d61 736b  efault_site_mask
-00006170: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00006180: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
-00006190: 6e74 6564 4572 726f 7228 224d 7573 7420  ntedError("Must 
-000061a0: 6f76 6572 7269 6465 205f 6465 6661 756c  override _defaul
-000061b0: 745f 7369 7465 5f6d 6173 6b22 290a 0a20  t_site_mask").. 
-000061c0: 2020 2064 6566 205f 7072 6570 5f73 6974     def _prep_sit
-000061d0: 655f 6d61 736b 5f70 6172 616d 2873 656c  e_mask_param(sel
-000061e0: 662c 202a 2c20 7369 7465 5f6d 6173 6b29  f, *, site_mask)
-000061f0: 3a0a 2020 2020 2020 2020 6966 2073 6974  :.        if sit
-00006200: 655f 6d61 736b 2069 7320 4e6f 6e65 3a0a  e_mask is None:.
-00006210: 2020 2020 2020 2020 2020 2020 2320 616c              # al
-00006220: 6c6f 7765 640a 2020 2020 2020 2020 2020  lowed.          
-00006230: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
-00006240: 6c69 6620 7369 7465 5f6d 6173 6b20 3d3d  lif site_mask ==
-00006250: 2044 4546 4155 4c54 3a0a 2020 2020 2020   DEFAULT:.      
-00006260: 2020 2020 2020 7369 7465 5f6d 6173 6b20        site_mask 
-00006270: 3d20 7365 6c66 2e5f 6465 6661 756c 745f  = self._default_
-00006280: 7369 7465 5f6d 6173 6b0a 2020 2020 2020  site_mask.      
-00006290: 2020 656c 6966 2073 6974 655f 6d61 736b    elif site_mask
-000062a0: 206e 6f74 2069 6e20 7365 6c66 2e73 6974   not in self.sit
-000062b0: 655f 6d61 736b 5f69 6473 3a0a 2020 2020  e_mask_ids:.    
-000062c0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000062d0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-000062e0: 2020 2020 2020 2020 2020 6622 496e 7661            f"Inva
-000062f0: 6c69 6420 7369 7465 206d 6173 6b2c 206d  lid site mask, m
-00006300: 7573 7420 6265 206f 6e65 206f 6620 667b  ust be one of f{
-00006310: 7365 6c66 2e73 6974 655f 6d61 736b 5f69  self.site_mask_i
-00006320: 6473 7d2e 220a 2020 2020 2020 2020 2020  ds}.".          
-00006330: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-00006340: 726e 2073 6974 655f 6d61 736b 0a0a 2020  rn site_mask..  
-00006350: 2020 4061 6273 7472 6163 746d 6574 686f    @abstractmetho
-00006360: 640a 2020 2020 6465 6620 5f73 616d 706c  d.    def _sampl
-00006370: 655f 6d65 7461 6461 7461 2873 656c 662c  e_metadata(self,
-00006380: 2073 616d 706c 655f 7365 7429 3a0a 2020   sample_set):.  
-00006390: 2020 2020 2020 2320 4e6f 7420 616c 6c20        # Not all 
-000063a0: 6368 696c 6472 656e 2068 6176 6520 7370  children have sp
-000063b0: 6563 6965 7320 6361 6c6c 7320 6f72 2063  ecies calls or c
-000063c0: 6f68 6f72 7473 2064 6174 612e 0a20 2020  ohorts data..   
-000063d0: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-000063e0: 706c 656d 656e 7465 6445 7272 6f72 2822  plementedError("
-000063f0: 4d75 7374 206f 7665 7272 6964 6520 5f73  Must override _s
-00006400: 616d 706c 655f 6d65 7461 6461 7461 2229  ample_metadata")
-00006410: 0a0a 2020 2020 4061 6273 7472 6163 746d  ..    @abstractm
-00006420: 6574 686f 640a 2020 2020 6465 6620 5f74  ethod.    def _t
-00006430: 7261 6e73 6372 6970 745f 746f 5f67 656e  ranscript_to_gen
-00006440: 655f 6e61 6d65 2873 656c 662c 2074 7261  e_name(self, tra
-00006450: 6e73 6372 6970 7429 3a0a 2020 2020 2020  nscript):.      
-00006460: 2020 2320 6368 696c 6472 656e 206d 6179    # children may
-00006470: 2068 6176 6520 6469 6666 6572 656e 7420   have different 
-00006480: 6d61 6e75 616c 206f 7665 7272 6964 6573  manual overrides
-00006490: 2e0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
-000064a0: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-000064b0: 726f 7228 224d 7573 7420 6f76 6572 7269  ror("Must overri
-000064c0: 6465 205f 7472 616e 7363 7269 7074 5f74  de _transcript_t
-000064d0: 6f5f 6765 6e65 5f6e 616d 6522 290a 0a20  o_gene_name").. 
-000064e0: 2020 2040 6162 7374 7261 6374 6d65 7468     @abstractmeth
-000064f0: 6f64 0a20 2020 2064 6566 205f 7669 6577  od.    def _view
-00006500: 5f61 6c69 676e 6d65 6e74 735f 6164 645f  _alignments_add_
-00006510: 7369 7465 5f66 696c 7465 7273 5f74 7261  site_filters_tra
-00006520: 636b 7328 0a20 2020 2020 2020 2073 656c  cks(.        sel
-00006530: 662c 202a 2c20 636f 6e74 6967 2c20 7669  f, *, contig, vi
-00006540: 7369 6269 6c69 7479 5f77 696e 646f 772c  sibility_window,
-00006550: 2074 7261 636b 730a 2020 2020 293a 0a20   tracks.    ):. 
-00006560: 2020 2020 2020 2023 2064 6566 6175 6c74         # default
-00006570: 2069 6d70 6c65 6d65 6e74 6174 696f 6e2c   implementation,
-00006580: 2064 6f20 6e6f 7468 696e 670a 2020 2020   do nothing.    
-00006590: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-000065a0: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
-000065b0: 2020 2020 2020 2020 2020 2022 4d75 7374             "Must
-000065c0: 206f 7665 7272 6964 6520 5f76 6965 775f   override _view_
-000065d0: 616c 6967 6e6d 656e 7473 5f61 6464 5f73  alignments_add_s
-000065e0: 6974 655f 6669 6c74 6572 735f 7472 6163  ite_filters_trac
-000065f0: 6b73 220a 2020 2020 2020 2020 290a 0a20  ks".        ).. 
-00006600: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00006610: 2040 6162 7374 7261 6374 6d65 7468 6f64   @abstractmethod
-00006620: 0a20 2020 2064 6566 2070 6861 7369 6e67  .    def phasing
-00006630: 5f61 6e61 6c79 7369 735f 6964 7328 7365  _analysis_ids(se
-00006640: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00006650: 4964 656e 7469 6669 6572 7320 666f 7220  Identifiers for 
-00006660: 7468 6520 6469 6666 6572 656e 7420 7068  the different ph
-00006670: 6173 696e 6720 616e 616c 7973 6573 2074  asing analyses t
-00006680: 6861 7420 6172 6520 6176 6169 6c61 626c  hat are availabl
-00006690: 652e 0a20 2020 2020 2020 2054 6865 7365  e..        These
-000066a0: 2061 7265 2076 616c 7565 7320 7468 616e   are values than
-000066b0: 2063 616e 2062 6520 7573 6564 2066 6f72   can be used for
-000066c0: 2074 6865 2060 616e 616c 7973 6973 6020   the `analysis` 
-000066d0: 7061 7261 6d65 7465 7220 696e 2061 6e79  parameter in any
-000066e0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-000066f0: 6d61 6b69 6e67 2075 7369 6e67 206f 6620  making using of 
-00006700: 6861 706c 6f74 7970 6520 6461 7461 2e0a  haplotype data..
-00006710: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00006720: 2020 2020 2023 204e 6f74 2061 6c6c 2063       # Not all c
-00006730: 6869 6c64 7265 6e20 6861 7665 2074 6865  hildren have the
-00006740: 2073 616d 6520 7068 6173 696e 6720 616e   same phasing an
-00006750: 616c 7973 6973 2049 4473 2e0a 2020 2020  alysis IDs..    
-00006760: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-00006770: 6c65 6d65 6e74 6564 4572 726f 7228 224d  lementedError("M
-00006780: 7573 7420 6f76 6572 7269 6465 205f 7068  ust override _ph
-00006790: 6173 696e 675f 616e 616c 7973 6973 5f69  asing_analysis_i
-000067a0: 6473 2229 0a0a 2020 2020 4070 726f 7065  ds")..    @prope
-000067b0: 7274 790a 2020 2020 4061 6273 7472 6163  rty.    @abstrac
-000067c0: 746d 6574 686f 640a 2020 2020 6465 6620  tmethod.    def 
-000067d0: 5f64 6566 6175 6c74 5f70 6861 7369 6e67  _default_phasing
-000067e0: 5f61 6e61 6c79 7369 7328 7365 6c66 293a  _analysis(self):
-000067f0: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
-00006800: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-00006810: 6f72 2822 4d75 7374 206f 7665 7272 6964  or("Must overrid
-00006820: 6520 5f64 6566 6175 6c74 5f70 6861 7369  e _default_phasi
-00006830: 6e67 5f61 6e61 6c79 7369 7322 290a 0a20  ng_analysis").. 
-00006840: 2020 2064 6566 205f 7072 6570 5f70 6861     def _prep_pha
-00006850: 7369 6e67 5f61 6e61 6c79 7369 735f 7061  sing_analysis_pa
-00006860: 7261 6d28 7365 6c66 2c20 2a2c 2061 6e61  ram(self, *, ana
-00006870: 6c79 7369 7329 3a0a 2020 2020 2020 2020  lysis):.        
-00006880: 6966 2061 6e61 6c79 7369 7320 3d3d 2044  if analysis == D
-00006890: 4546 4155 4c54 3a0a 2020 2020 2020 2020  EFAULT:.        
-000068a0: 2020 2020 616e 616c 7973 6973 203d 2073      analysis = s
-000068b0: 656c 662e 5f64 6566 6175 6c74 5f70 6861  elf._default_pha
-000068c0: 7369 6e67 5f61 6e61 6c79 7369 730a 2020  sing_analysis.  
-000068d0: 2020 2020 2020 6966 2061 6e61 6c79 7369        if analysi
-000068e0: 7320 6e6f 7420 696e 2073 656c 662e 7068  s not in self.ph
-000068f0: 6173 696e 675f 616e 616c 7973 6973 5f69  asing_analysis_i
-00006900: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-00006910: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00006920: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006930: 2020 6622 496e 7661 6c69 6420 7068 6173    f"Invalid phas
-00006940: 696e 6720 616e 616c 7973 6973 2c20 6d75  ing analysis, mu
-00006950: 7374 2062 6520 6f6e 6520 6f66 2066 7b73  st be one of f{s
-00006960: 656c 662e 7068 6173 696e 675f 616e 616c  elf.phasing_anal
-00006970: 7973 6973 5f69 6473 7d2e 220a 2020 2020  ysis_ids}.".    
-00006980: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00006990: 2020 7265 7475 726e 2061 6e61 6c79 7369    return analysi
-000069a0: 730a 0a20 2020 2064 6566 205f 7265 7375  s..    def _resu
-000069b0: 6c74 735f 6361 6368 655f 6164 645f 616e  lts_cache_add_an
-000069c0: 616c 7973 6973 5f70 6172 616d 7328 7365  alysis_params(se
-000069d0: 6c66 2c20 7061 7261 6d73 293a 0a20 2020  lf, params):.   
-000069e0: 2020 2020 2023 2064 6566 6175 6c74 2069       # default i
-000069f0: 6d70 6c65 6d65 6e74 6174 696f 6e2c 2063  mplementation, c
-00006a00: 616e 2062 6520 6f76 6572 7269 6464 656e  an be overridden
-00006a10: 2069 6620 6164 6469 7469 6f6e 616c 2061   if additional a
-00006a20: 6e61 6c79 7369 730a 2020 2020 2020 2020  nalysis.        
-00006a30: 2320 7061 7261 6d73 2061 7265 2075 7365  # params are use
-00006a40: 640a 2020 2020 2020 2020 7061 7261 6d73  d.        params
-00006a50: 5b22 636f 686f 7274 735f 616e 616c 7973  ["cohorts_analys
-00006a60: 6973 225d 203d 2073 656c 662e 5f63 6f68  is"] = self._coh
-00006a70: 6f72 7473 5f61 6e61 6c79 7369 730a 2020  orts_analysis.  
-00006a80: 2020 2020 2020 7061 7261 6d73 5b22 7369        params["si
-00006a90: 7465 5f66 696c 7465 7273 5f61 6e61 6c79  te_filters_analy
-00006aa0: 7369 7322 5d20 3d20 7365 6c66 2e5f 7369  sis"] = self._si
-00006ab0: 7465 5f66 696c 7465 7273 5f61 6e61 6c79  te_filters_analy
-00006ac0: 7369 730a 0a20 2020 2064 6566 2072 6573  sis..    def res
-00006ad0: 756c 7473 5f63 6163 6865 5f67 6574 2873  ults_cache_get(s
-00006ae0: 656c 662c 202a 2c20 6e61 6d65 2c20 7061  elf, *, name, pa
-00006af0: 7261 6d73 293a 0a20 2020 2020 2020 2064  rams):.        d
-00006b00: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
-00006b10: 2e64 6562 7567 0a20 2020 2020 2020 2069  .debug.        i
-00006b20: 6620 7365 6c66 2e5f 7265 7375 6c74 735f  f self._results_
-00006b30: 6361 6368 6520 6973 204e 6f6e 653a 0a20  cache is None:. 
-00006b40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00006b50: 2043 6163 6865 4d69 7373 0a20 2020 2020   CacheMiss.     
-00006b60: 2020 2070 6172 616d 7320 3d20 7061 7261     params = para
-00006b70: 6d73 2e63 6f70 7928 290a 2020 2020 2020  ms.copy().      
-00006b80: 2020 7365 6c66 2e5f 7265 7375 6c74 735f    self._results_
-00006b90: 6361 6368 655f 6164 645f 616e 616c 7973  cache_add_analys
-00006ba0: 6973 5f70 6172 616d 7328 7061 7261 6d73  is_params(params
-00006bb0: 290a 2020 2020 2020 2020 6361 6368 655f  ).        cache_
-00006bc0: 6b65 792c 205f 203d 2068 6173 685f 7061  key, _ = hash_pa
-00006bd0: 7261 6d73 2870 6172 616d 7329 0a20 2020  rams(params).   
-00006be0: 2020 2020 2063 6163 6865 5f70 6174 6820       cache_path 
-00006bf0: 3d20 7365 6c66 2e5f 7265 7375 6c74 735f  = self._results_
-00006c00: 6361 6368 6520 2f20 6e61 6d65 202f 2063  cache / name / c
-00006c10: 6163 6865 5f6b 6579 0a20 2020 2020 2020  ache_key.       
-00006c20: 2072 6573 756c 7473 5f70 6174 6820 3d20   results_path = 
-00006c30: 6361 6368 655f 7061 7468 202f 2022 7265  cache_path / "re
-00006c40: 7375 6c74 732e 6e70 7a22 0a20 2020 2020  sults.npz".     
-00006c50: 2020 2069 6620 6e6f 7420 7265 7375 6c74     if not result
-00006c60: 735f 7061 7468 2e65 7869 7374 7328 293a  s_path.exists():
-00006c70: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00006c80: 7365 2043 6163 6865 4d69 7373 0a20 2020  se CacheMiss.   
-00006c90: 2020 2020 2072 6573 756c 7473 203d 206e       results = n
-00006ca0: 702e 6c6f 6164 2872 6573 756c 7473 5f70  p.load(results_p
-00006cb0: 6174 6829 0a20 2020 2020 2020 2064 6562  ath).        deb
-00006cc0: 7567 2866 226c 6f61 6465 6420 7b6e 616d  ug(f"loaded {nam
-00006cd0: 657d 2f7b 6361 6368 655f 6b65 797d 2229  e}/{cache_key}")
-00006ce0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006cf0: 7265 7375 6c74 730a 0a20 2020 2064 6566  results..    def
-00006d00: 2072 6573 756c 7473 5f63 6163 6865 5f73   results_cache_s
-00006d10: 6574 2873 656c 662c 202a 2c20 6e61 6d65  et(self, *, name
-00006d20: 2c20 7061 7261 6d73 2c20 7265 7375 6c74  , params, result
-00006d30: 7329 3a0a 2020 2020 2020 2020 6465 6275  s):.        debu
-00006d40: 6720 3d20 7365 6c66 2e5f 6c6f 672e 6465  g = self._log.de
-00006d50: 6275 670a 2020 2020 2020 2020 6966 2073  bug.        if s
-00006d60: 656c 662e 5f72 6573 756c 7473 5f63 6163  elf._results_cac
-00006d70: 6865 2069 7320 4e6f 6e65 3a0a 2020 2020  he is None:.    
-00006d80: 2020 2020 2020 2020 6465 6275 6728 226e          debug("n
-00006d90: 6f20 7265 7375 6c74 7320 6361 6368 6520  o results cache 
-00006da0: 6861 7320 6265 656e 2063 6f6e 6669 6775  has been configu
-00006db0: 7265 642c 2064 6f20 6e6f 7468 696e 6722  red, do nothing"
-00006dc0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006dd0: 7475 726e 0a20 2020 2020 2020 2070 6172  turn.        par
-00006de0: 616d 7320 3d20 7061 7261 6d73 2e63 6f70  ams = params.cop
-00006df0: 7928 290a 2020 2020 2020 2020 7365 6c66  y().        self
-00006e00: 2e5f 7265 7375 6c74 735f 6361 6368 655f  ._results_cache_
-00006e10: 6164 645f 616e 616c 7973 6973 5f70 6172  add_analysis_par
-00006e20: 616d 7328 7061 7261 6d73 290a 2020 2020  ams(params).    
-00006e30: 2020 2020 6361 6368 655f 6b65 792c 2070      cache_key, p
-00006e40: 6172 616d 735f 6a73 6f6e 203d 2068 6173  arams_json = has
-00006e50: 685f 7061 7261 6d73 2870 6172 616d 7329  h_params(params)
-00006e60: 0a20 2020 2020 2020 2063 6163 6865 5f70  .        cache_p
-00006e70: 6174 6820 3d20 7365 6c66 2e5f 7265 7375  ath = self._resu
-00006e80: 6c74 735f 6361 6368 6520 2f20 6e61 6d65  lts_cache / name
-00006e90: 202f 2063 6163 6865 5f6b 6579 0a20 2020   / cache_key.   
-00006ea0: 2020 2020 2063 6163 6865 5f70 6174 682e       cache_path.
-00006eb0: 6d6b 6469 7228 6578 6973 745f 6f6b 3d54  mkdir(exist_ok=T
-00006ec0: 7275 652c 2070 6172 656e 7473 3d54 7275  rue, parents=Tru
-00006ed0: 6529 0a20 2020 2020 2020 2070 6172 616d  e).        param
-00006ee0: 735f 7061 7468 203d 2063 6163 6865 5f70  s_path = cache_p
-00006ef0: 6174 6820 2f20 2270 6172 616d 732e 6a73  ath / "params.js
-00006f00: 6f6e 220a 2020 2020 2020 2020 7265 7375  on".        resu
-00006f10: 6c74 735f 7061 7468 203d 2063 6163 6865  lts_path = cache
-00006f20: 5f70 6174 6820 2f20 2272 6573 756c 7473  _path / "results
-00006f30: 2e6e 707a 220a 2020 2020 2020 2020 7769  .npz".        wi
-00006f40: 7468 2070 6172 616d 735f 7061 7468 2e6f  th params_path.o
-00006f50: 7065 6e28 6d6f 6465 3d22 7722 2920 6173  pen(mode="w") as
-00006f60: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00006f70: 662e 7772 6974 6528 7061 7261 6d73 5f6a  f.write(params_j
-00006f80: 736f 6e29 0a20 2020 2020 2020 206e 702e  son).        np.
-00006f90: 7361 7665 7a5f 636f 6d70 7265 7373 6564  savez_compressed
-00006fa0: 2872 6573 756c 7473 5f70 6174 682c 202a  (results_path, *
-00006fb0: 2a72 6573 756c 7473 290a 2020 2020 2020  *results).      
-00006fc0: 2020 6465 6275 6728 6622 7361 7665 6420    debug(f"saved 
-00006fd0: 7b6e 616d 657d 2f7b 6361 6368 655f 6b65  {name}/{cache_ke
-00006fe0: 797d 2229 0a0a 2020 2020 4064 6f63 280a  y}")..    @doc(.
-00006ff0: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-00007000: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00007010: 436f 6d70 7574 6520 534e 5020 616c 6c65  Compute SNP alle
-00007020: 6c65 2063 6f75 6e74 732e 2054 6869 7320  le counts. This 
-00007030: 7265 7475 726e 7320 7468 6520 6e75 6d62  returns the numb
-00007040: 6572 206f 6620 7469 6d65 7320 6561 6368  er of times each
-00007050: 0a20 2020 2020 2020 2020 2020 2053 4e50  .            SNP
-00007060: 2061 6c6c 656c 6520 7761 7320 6f62 7365   allele was obse
-00007070: 7276 6564 2069 6e20 7468 6520 7365 6c65  rved in the sele
-00007080: 6374 6564 2073 616d 706c 6573 2e0a 2020  cted samples..  
-00007090: 2020 2020 2020 2222 222c 0a20 2020 2020        """,.     
-000070a0: 2020 2072 6574 7572 6e73 3d22 2222 0a20     returns=""". 
-000070b0: 2020 2020 2020 2020 2020 2041 206e 756d             A num
-000070c0: 7079 2061 7272 6179 206f 6620 7368 6170  py array of shap
-000070d0: 6520 286e 5f76 6172 6961 6e74 732c 2034  e (n_variants, 4
-000070e0: 292c 2077 6865 7265 2074 6865 2066 6972  ), where the fir
-000070f0: 7374 2063 6f6c 756d 6e20 6861 730a 2020  st column has.  
-00007100: 2020 2020 2020 2020 2020 7468 6520 7265            the re
-00007110: 6665 7265 6e63 6520 616c 6c65 6c65 2028  ference allele (
-00007120: 3029 2063 6f75 6e74 732c 2074 6865 2073  0) counts, the s
-00007130: 6563 6f6e 6420 636f 6c75 6d6e 2068 6173  econd column has
-00007140: 2074 6865 2066 6972 7374 0a20 2020 2020   the first.     
-00007150: 2020 2020 2020 2061 6c74 6572 6e61 7465         alternate
-00007160: 2061 6c6c 656c 6520 2831 2920 636f 756e   allele (1) coun
-00007170: 7473 2c20 7468 6520 7468 6972 6420 636f  ts, the third co
-00007180: 6c75 6d6e 2068 6173 2074 6865 2073 6563  lumn has the sec
-00007190: 6f6e 640a 2020 2020 2020 2020 2020 2020  ond.            
-000071a0: 616c 7465 726e 6174 6520 616c 6c65 6c65  alternate allele
-000071b0: 2028 3229 2063 6f75 6e74 732c 2061 6e64   (2) counts, and
-000071c0: 2074 6865 2066 6f75 7274 6820 636f 6c75   the fourth colu
-000071d0: 6d6e 2068 6173 2074 6865 2074 6869 7264  mn has the third
-000071e0: 0a20 2020 2020 2020 2020 2020 2061 6c74  .            alt
-000071f0: 6572 6e61 7465 2061 6c6c 656c 6520 2833  ernate allele (3
-00007200: 2920 636f 756e 7473 2e0a 2020 2020 2020  ) counts..      
-00007210: 2020 2222 222c 0a20 2020 2020 2020 206e    """,.        n
-00007220: 6f74 6573 3d22 2222 0a20 2020 2020 2020  otes=""".       
-00007230: 2020 2020 2054 6869 7320 636f 6d70 7574       This comput
-00007240: 6174 696f 6e20 6d61 7920 7461 6b65 2073  ation may take s
-00007250: 6f6d 6520 7469 6d65 2074 6f20 7275 6e2c  ome time to run,
-00007260: 2064 6570 656e 6469 6e67 206f 6e20 796f   depending on yo
-00007270: 7572 0a20 2020 2020 2020 2020 2020 2063  ur.            c
-00007280: 6f6d 7075 7469 6e67 2065 6e76 6972 6f6e  omputing environ
-00007290: 6d65 6e74 2e20 5265 7375 6c74 7320 6f66  ment. Results of
-000072a0: 2074 6869 7320 636f 6d70 7574 6174 696f   this computatio
-000072b0: 6e20 7769 6c6c 2062 6520 6361 6368 6564  n will be cached
-000072c0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-000072d0: 2072 652d 7573 6564 2069 6620 7468 6520   re-used if the 
-000072e0: 6072 6573 756c 7473 5f63 6163 6865 6020  `results_cache` 
-000072f0: 7061 7261 6d65 7465 7220 7761 7320 7365  parameter was se
-00007300: 7420 7768 656e 0a20 2020 2020 2020 2020  t when.         
-00007310: 2020 2069 6e73 7461 6e74 6961 7469 6e67     instantiating
-00007320: 2074 6865 2063 6c61 7373 2e0a 2020 2020   the class..    
-00007330: 2020 2020 2222 222c 0a20 2020 2029 0a20      """,.    ). 
-00007340: 2020 2064 6566 2073 6e70 5f61 6c6c 656c     def snp_allel
-00007350: 655f 636f 756e 7473 280a 2020 2020 2020  e_counts(.      
-00007360: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00007370: 7265 6769 6f6e 3a20 6261 7365 5f70 6172  region: base_par
-00007380: 616d 732e 7265 6769 6f6e 2c0a 2020 2020  ams.region,.    
-00007390: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
-000073a0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-000073b0: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
-000073c0: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-000073d0: 2020 2073 616d 706c 655f 7175 6572 793a     sample_query:
-000073e0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-000073f0: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
-00007400: 7279 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ry] = None,.    
-00007410: 2020 2020 7369 7465 5f6d 6173 6b3a 204f      site_mask: O
-00007420: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-00007430: 616d 732e 7369 7465 5f6d 6173 6b5d 203d  ams.site_mask] =
-00007440: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-00007450: 6974 655f 636c 6173 733a 204f 7074 696f  ite_class: Optio
-00007460: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-00007470: 7369 7465 5f63 6c61 7373 5d20 3d20 4e6f  site_class] = No
-00007480: 6e65 2c0a 2020 2020 2020 2020 636f 686f  ne,.        coho
-00007490: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-000074a0: 6c5b 6261 7365 5f70 6172 616d 732e 636f  l[base_params.co
-000074b0: 686f 7274 5f73 697a 655d 203d 204e 6f6e  hort_size] = Non
-000074c0: 652c 0a20 2020 2020 2020 2072 616e 646f  e,.        rando
-000074d0: 6d5f 7365 6564 3a20 6261 7365 5f70 6172  m_seed: base_par
-000074e0: 616d 732e 7261 6e64 6f6d 5f73 6565 6420  ams.random_seed 
-000074f0: 3d20 3432 2c0a 2020 2020 2920 2d3e 206e  = 42,.    ) -> n
-00007500: 702e 6e64 6172 7261 793a 0a20 2020 2020  p.ndarray:.     
-00007510: 2020 2023 2063 6861 6e67 6520 7468 6973     # change this
-00007520: 206e 616d 6520 6966 2079 6f75 2065 7665   name if you eve
-00007530: 7220 6368 616e 6765 2074 6865 2062 6568  r change the beh
-00007540: 6176 696f 7572 206f 6620 7468 6973 2066  aviour of this f
-00007550: 756e 6374 696f 6e2c 0a20 2020 2020 2020  unction,.       
-00007560: 2023 2074 6f20 696e 7661 6c69 6461 7465   # to invalidate
-00007570: 2061 6e79 2070 7265 7669 6f75 736c 7920   any previously 
-00007580: 6361 6368 6564 2064 6174 610a 2020 2020  cached data.    
-00007590: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
-000075a0: 5f73 6e70 5f61 6c6c 656c 655f 636f 756e  _snp_allele_coun
-000075b0: 7473 5f72 6573 756c 7473 5f63 6163 6865  ts_results_cache
-000075c0: 5f6e 616d 650a 0a20 2020 2020 2020 2023  _name..        #
-000075d0: 206e 6f72 6d61 6c69 7a65 2070 6172 616d   normalize param
-000075e0: 7320 666f 7220 636f 6e73 6973 7465 6e74  s for consistent
-000075f0: 2068 6173 6820 7661 6c75 650a 2020 2020   hash value.    
-00007600: 2020 2020 7361 6d70 6c65 5f73 6574 732c      sample_sets,
-00007610: 2073 616d 706c 655f 7175 6572 7920 3d20   sample_query = 
-00007620: 7365 6c66 2e5f 7072 6570 5f73 616d 706c  self._prep_sampl
-00007630: 655f 7365 6c65 6374 696f 6e5f 6361 6368  e_selection_cach
-00007640: 655f 7061 7261 6d73 280a 2020 2020 2020  e_params(.      
-00007650: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
-00007660: 733d 7361 6d70 6c65 5f73 6574 732c 2073  s=sample_sets, s
-00007670: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
-00007680: 6c65 5f71 7565 7279 0a20 2020 2020 2020  le_query.       
-00007690: 2029 0a20 2020 2020 2020 2072 6567 696f   ).        regio
-000076a0: 6e20 3d20 7365 6c66 2e5f 7072 6570 5f72  n = self._prep_r
-000076b0: 6567 696f 6e5f 6361 6368 655f 7061 7261  egion_cache_para
-000076c0: 6d28 7265 6769 6f6e 3d72 6567 696f 6e29  m(region=region)
-000076d0: 0a20 2020 2020 2020 2073 6974 655f 6d61  .        site_ma
-000076e0: 736b 203d 2073 656c 662e 5f70 7265 705f  sk = self._prep_
-000076f0: 7369 7465 5f6d 6173 6b5f 7061 7261 6d28  site_mask_param(
-00007700: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
-00007710: 6173 6b29 0a20 2020 2020 2020 2070 6172  ask).        par
-00007720: 616d 7320 3d20 6469 6374 280a 2020 2020  ams = dict(.    
-00007730: 2020 2020 2020 2020 7265 6769 6f6e 3d72          region=r
-00007740: 6567 696f 6e2c 0a20 2020 2020 2020 2020  egion,.         
-00007750: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-00007760: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
-00007770: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
-00007780: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
-00007790: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
-000077a0: 6974 655f 6d61 736b 3d73 6974 655f 6d61  ite_mask=site_ma
-000077b0: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
-000077c0: 7369 7465 5f63 6c61 7373 3d73 6974 655f  site_class=site_
-000077d0: 636c 6173 732c 0a20 2020 2020 2020 2020  class,.         
-000077e0: 2020 2063 6f68 6f72 745f 7369 7a65 3d63     cohort_size=c
-000077f0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00007800: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-00007810: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00007820: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00007830: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00007840: 2020 2020 2072 6573 756c 7473 203d 2073       results = s
-00007850: 656c 662e 7265 7375 6c74 735f 6361 6368  elf.results_cach
-00007860: 655f 6765 7428 6e61 6d65 3d6e 616d 652c  e_get(name=name,
-00007870: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
-00007880: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00007890: 4361 6368 654d 6973 733a 0a20 2020 2020  CacheMiss:.     
-000078a0: 2020 2020 2020 2072 6573 756c 7473 203d         results =
-000078b0: 2073 656c 662e 5f73 6e70 5f61 6c6c 656c   self._snp_allel
-000078c0: 655f 636f 756e 7473 282a 2a70 6172 616d  e_counts(**param
-000078d0: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-000078e0: 656c 662e 7265 7375 6c74 735f 6361 6368  elf.results_cach
-000078f0: 655f 7365 7428 6e61 6d65 3d6e 616d 652c  e_set(name=name,
-00007900: 2070 6172 616d 733d 7061 7261 6d73 2c20   params=params, 
-00007910: 7265 7375 6c74 733d 7265 7375 6c74 7329  results=results)
-00007920: 0a0a 2020 2020 2020 2020 6163 203d 2072  ..        ac = r
-00007930: 6573 756c 7473 5b22 6163 225d 0a20 2020  esults["ac"].   
-00007940: 2020 2020 2072 6574 7572 6e20 6163 0a0a       return ac..
-00007950: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
-00007960: 2020 7375 6d6d 6172 793d 2222 220a 2020    summary=""".  
-00007970: 2020 2020 2020 2020 2020 4772 6f75 7020            Group 
-00007980: 7361 6d70 6c65 7320 6279 2074 6178 6f6e  samples by taxon
-00007990: 2c20 6172 6561 2028 7370 6163 6529 2061  , area (space) a
-000079a0: 6e64 2070 6572 696f 6420 2874 696d 6529  nd period (time)
-000079b0: 2c20 7468 656e 2063 6f6d 7075 7465 0a20  , then compute. 
-000079c0: 2020 2020 2020 2020 2020 2053 4e50 2061             SNP a
-000079d0: 6c6c 656c 6520 6672 6571 7565 6e63 6965  llele frequencie
-000079e0: 732e 0a20 2020 2020 2020 2022 2222 2c0a  s..        """,.
-000079f0: 2020 2020 2020 2020 7265 7475 726e 733d          returns=
-00007a00: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00007a10: 5468 6520 7265 7375 6c74 696e 6720 6461  The resulting da
-00007a20: 7461 7365 7420 636f 6e74 6169 6e73 2064  taset contains d
-00007a30: 6174 6120 6861 7320 6469 6d65 6e73 696f  ata has dimensio
-00007a40: 6e73 2022 636f 686f 7274 7322 2061 6e64  ns "cohorts" and
-00007a50: 0a20 2020 2020 2020 2020 2020 2022 7661  .            "va
-00007a60: 7269 616e 7473 222e 2056 6172 6961 626c  riants". Variabl
-00007a70: 6573 2070 7265 6669 7865 6420 7769 7468  es prefixed with
-00007a80: 2022 636f 686f 7274 2220 6172 6520 312d   "cohort" are 1-
-00007a90: 6469 6d65 6e73 696f 6e61 6c0a 2020 2020  dimensional.    
-00007aa0: 2020 2020 2020 2020 6172 7261 7973 2077          arrays w
-00007ab0: 6974 6820 6461 7461 2061 626f 7574 2074  ith data about t
-00007ac0: 6865 2063 6f68 6f72 7473 2c20 7375 6368  he cohorts, such
-00007ad0: 2061 7320 7468 6520 6172 6561 2c20 7065   as the area, pe
-00007ae0: 7269 6f64 2c20 7461 786f 6e0a 2020 2020  riod, taxon.    
-00007af0: 2020 2020 2020 2020 616e 6420 636f 686f          and coho
-00007b00: 7274 2073 697a 652e 2056 6172 6961 626c  rt size. Variabl
-00007b10: 6573 2070 7265 6669 7865 6420 7769 7468  es prefixed with
-00007b20: 2022 7661 7269 616e 7422 2061 7265 0a20   "variant" are. 
-00007b30: 2020 2020 2020 2020 2020 2031 2d64 696d             1-dim
-00007b40: 656e 7369 6f6e 616c 2061 7272 6179 7320  ensional arrays 
-00007b50: 7769 7468 2064 6174 6120 6162 6f75 7420  with data about 
-00007b60: 7468 6520 7661 7269 616e 7473 2c20 7375  the variants, su
-00007b70: 6368 2061 7320 7468 650a 2020 2020 2020  ch as the.      
-00007b80: 2020 2020 2020 636f 6e74 6967 2c20 706f        contig, po
-00007b90: 7369 7469 6f6e 2c20 7265 6665 7265 6e63  sition, referenc
-00007ba0: 6520 616e 6420 616c 7465 726e 6174 6520  e and alternate 
-00007bb0: 616c 6c65 6c65 732e 2056 6172 6961 626c  alleles. Variabl
-00007bc0: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
-00007bd0: 7265 6669 7865 6420 7769 7468 2022 6576  refixed with "ev
-00007be0: 656e 7422 2061 7265 2032 2d64 696d 656e  ent" are 2-dimen
-00007bf0: 7369 6f6e 616c 2061 7272 6179 7320 7769  sional arrays wi
-00007c00: 7468 2074 6865 2061 6c6c 656c 650a 2020  th the allele.  
-00007c10: 2020 2020 2020 2020 2020 636f 756e 7473            counts
-00007c20: 2061 6e64 2066 7265 7175 656e 6379 2063   and frequency c
-00007c30: 616c 6375 6c61 7469 6f6e 732e 0a20 2020  alculations..   
-00007c40: 2020 2020 2022 2222 2c0a 2020 2020 290a       """,.    ).
-00007c50: 2020 2020 6465 6620 736e 705f 616c 6c65      def snp_alle
-00007c60: 6c65 5f66 7265 7175 656e 6369 6573 5f61  le_frequencies_a
-00007c70: 6476 616e 6365 6428 0a20 2020 2020 2020  dvanced(.       
-00007c80: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
-00007c90: 7261 6e73 6372 6970 743a 2062 6173 655f  ranscript: base_
-00007ca0: 7061 7261 6d73 2e74 7261 6e73 6372 6970  params.transcrip
-00007cb0: 742c 0a20 2020 2020 2020 2061 7265 615f  t,.        area_
-00007cc0: 6279 3a20 6672 715f 7061 7261 6d73 2e61  by: frq_params.a
-00007cd0: 7265 615f 6279 2c0a 2020 2020 2020 2020  rea_by,.        
-00007ce0: 7065 7269 6f64 5f62 793a 2066 7271 5f70  period_by: frq_p
-00007cf0: 6172 616d 732e 7065 7269 6f64 5f62 792c  arams.period_by,
-00007d00: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00007d10: 7365 7473 3a20 4f70 7469 6f6e 616c 5b62  sets: Optional[b
-00007d20: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
-00007d30: 655f 7365 7473 5d20 3d20 4e6f 6e65 2c0a  e_sets] = None,.
-00007d40: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
-00007d50: 7565 7279 3a20 4f70 7469 6f6e 616c 5b62  uery: Optional[b
-00007d60: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
-00007d70: 655f 7175 6572 795d 203d 204e 6f6e 652c  e_query] = None,
-00007d80: 0a20 2020 2020 2020 206d 696e 5f63 6f68  .        min_coh
-00007d90: 6f72 745f 7369 7a65 3a20 6261 7365 5f70  ort_size: base_p
-00007da0: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
-00007db0: 5f73 697a 6520 3d20 3130 2c0a 2020 2020  _size = 10,.    
-00007dc0: 2020 2020 6472 6f70 5f69 6e76 6172 6961      drop_invaria
-00007dd0: 6e74 3a20 6672 715f 7061 7261 6d73 2e64  nt: frq_params.d
-00007de0: 726f 705f 696e 7661 7269 616e 7420 3d20  rop_invariant = 
-00007df0: 5472 7565 2c0a 2020 2020 2020 2020 7661  True,.        va
-00007e00: 7269 616e 745f 7175 6572 793a 204f 7074  riant_query: Opt
-00007e10: 696f 6e61 6c5b 6672 715f 7061 7261 6d73  ional[frq_params
-00007e20: 2e76 6172 6961 6e74 5f71 7565 7279 5d20  .variant_query] 
-00007e30: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00007e40: 7369 7465 5f6d 6173 6b3a 204f 7074 696f  site_mask: Optio
-00007e50: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-00007e60: 7369 7465 5f6d 6173 6b5d 203d 204e 6f6e  site_mask] = Non
-00007e70: 652c 0a20 2020 2020 2020 206e 6f62 735f  e,.        nobs_
-00007e80: 6d6f 6465 3a20 6672 715f 7061 7261 6d73  mode: frq_params
-00007e90: 2e6e 6f62 735f 6d6f 6465 203d 2066 7271  .nobs_mode = frq
-00007ea0: 5f70 6172 616d 732e 6e6f 6273 5f6d 6f64  _params.nobs_mod
-00007eb0: 655f 6465 6661 756c 742c 0a20 2020 2020  e_default,.     
-00007ec0: 2020 2063 695f 6d65 7468 6f64 3a20 4f70     ci_method: Op
-00007ed0: 7469 6f6e 616c 5b66 7271 5f70 6172 616d  tional[frq_param
-00007ee0: 732e 6369 5f6d 6574 686f 645d 203d 2066  s.ci_method] = f
-00007ef0: 7271 5f70 6172 616d 732e 6369 5f6d 6574  rq_params.ci_met
-00007f00: 686f 645f 6465 6661 756c 742c 0a20 2020  hod_default,.   
-00007f10: 2029 202d 3e20 7872 2e44 6174 6173 6574   ) -> xr.Dataset
-00007f20: 3a0a 2020 2020 2020 2020 6465 6275 6720  :.        debug 
-00007f30: 3d20 7365 6c66 2e5f 6c6f 672e 6465 6275  = self._log.debu
-00007f40: 670a 0a20 2020 2020 2020 2064 6562 7567  g..        debug
-00007f50: 2822 6368 6563 6b20 7061 7261 6d65 7465  ("check paramete
-00007f60: 7273 2229 0a20 2020 2020 2020 2073 656c  rs").        sel
-00007f70: 662e 5f63 6865 636b 5f70 6172 616d 5f6d  f._check_param_m
-00007f80: 696e 5f63 6f68 6f72 745f 7369 7a65 286d  in_cohort_size(m
-00007f90: 696e 5f63 6f68 6f72 745f 7369 7a65 290a  in_cohort_size).
-00007fa0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00007fb0: 6c6f 6164 2073 616d 706c 6520 6d65 7461  load sample meta
-00007fc0: 6461 7461 2229 0a20 2020 2020 2020 2064  data").        d
-00007fd0: 665f 7361 6d70 6c65 7320 3d20 7365 6c66  f_samples = self
-00007fe0: 2e73 616d 706c 655f 6d65 7461 6461 7461  .sample_metadata
-00007ff0: 280a 2020 2020 2020 2020 2020 2020 7361  (.            sa
-00008000: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
-00008010: 5f73 6574 732c 2073 616d 706c 655f 7175  _sets, sample_qu
-00008020: 6572 793d 7361 6d70 6c65 5f71 7565 7279  ery=sample_query
-00008030: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00008040: 2020 2020 6465 6275 6728 2261 6363 6573      debug("acces
-00008050: 7320 534e 5020 6361 6c6c 7322 290a 2020  s SNP calls").  
-00008060: 2020 2020 2020 6473 5f73 6e70 7320 3d20        ds_snps = 
-00008070: 7365 6c66 2e73 6e70 5f63 616c 6c73 280a  self.snp_calls(.
-00008080: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-00008090: 6f6e 3d74 7261 6e73 6372 6970 742c 0a20  on=transcript,. 
-000080a0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-000080b0: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
-000080c0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-000080d0: 7361 6d70 6c65 5f71 7565 7279 3d73 616d  sample_query=sam
-000080e0: 706c 655f 7175 6572 792c 0a20 2020 2020  ple_query,.     
-000080f0: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
-00008100: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
-00008110: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
-00008120: 6562 7567 2822 6163 6365 7373 2067 656e  ebug("access gen
-00008130: 6f74 7970 6573 2229 0a20 2020 2020 2020  otypes").       
-00008140: 2067 7420 3d20 6473 5f73 6e70 735b 2263   gt = ds_snps["c
-00008150: 616c 6c5f 6765 6e6f 7479 7065 225d 2e64  all_genotype"].d
-00008160: 6174 610a 0a20 2020 2020 2020 2064 6562  ata..        deb
-00008170: 7567 2822 7072 6570 6172 6520 7361 6d70  ug("prepare samp
-00008180: 6c65 206d 6574 6164 6174 6120 666f 7220  le metadata for 
-00008190: 636f 686f 7274 2067 726f 7570 696e 6722  cohort grouping"
-000081a0: 290a 2020 2020 2020 2020 6466 5f73 616d  ).        df_sam
-000081b0: 706c 6573 203d 2073 656c 662e 5f70 7265  ples = self._pre
-000081c0: 705f 7361 6d70 6c65 735f 666f 725f 636f  p_samples_for_co
-000081d0: 686f 7274 5f67 726f 7570 696e 6728 0a20  hort_grouping(. 
-000081e0: 2020 2020 2020 2020 2020 2064 665f 7361             df_sa
-000081f0: 6d70 6c65 733d 6466 5f73 616d 706c 6573  mples=df_samples
-00008200: 2c0a 2020 2020 2020 2020 2020 2020 6172  ,.            ar
-00008210: 6561 5f62 793d 6172 6561 5f62 792c 0a20  ea_by=area_by,. 
-00008220: 2020 2020 2020 2020 2020 2070 6572 696f             perio
-00008230: 645f 6279 3d70 6572 696f 645f 6279 2c0a  d_by=period_by,.
-00008240: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00008250: 2020 2064 6562 7567 2822 6772 6f75 7020     debug("group 
-00008260: 7361 6d70 6c65 7320 746f 206d 616b 6520  samples to make 
-00008270: 636f 686f 7274 7322 290a 2020 2020 2020  cohorts").      
-00008280: 2020 6772 6f75 705f 7361 6d70 6c65 735f    group_samples_
-00008290: 6279 5f63 6f68 6f72 7420 3d20 6466 5f73  by_cohort = df_s
-000082a0: 616d 706c 6573 2e67 726f 7570 6279 285b  amples.groupby([
-000082b0: 2274 6178 6f6e 222c 2022 6172 6561 222c  "taxon", "area",
-000082c0: 2022 7065 7269 6f64 225d 290a 0a20 2020   "period"])..   
-000082d0: 2020 2020 2064 6562 7567 2822 6275 696c       debug("buil
-000082e0: 6420 636f 686f 7274 7320 6461 7461 6672  d cohorts datafr
-000082f0: 616d 6522 290a 2020 2020 2020 2020 6466  ame").        df
-00008300: 5f63 6f68 6f72 7473 203d 2073 656c 662e  _cohorts = self.
-00008310: 5f62 7569 6c64 5f63 6f68 6f72 7473 5f66  _build_cohorts_f
-00008320: 726f 6d5f 7361 6d70 6c65 5f67 726f 7570  rom_sample_group
-00008330: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-00008340: 2067 726f 7570 5f73 616d 706c 6573 5f62   group_samples_b
-00008350: 795f 636f 686f 7274 2c20 6d69 6e5f 636f  y_cohort, min_co
-00008360: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
-00008370: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
-00008380: 7567 2822 6272 696e 6720 6765 6e6f 7479  ug("bring genoty
-00008390: 7065 7320 696e 746f 206d 656d 6f72 7922  pes into memory"
-000083a0: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-000083b0: 656c 662e 5f64 6173 6b5f 7072 6f67 7265  elf._dask_progre
-000083c0: 7373 2864 6573 633d 224c 6f61 6420 534e  ss(desc="Load SN
-000083d0: 5020 6765 6e6f 7479 7065 7322 293a 0a20  P genotypes"):. 
-000083e0: 2020 2020 2020 2020 2020 2067 7420 3d20             gt = 
-000083f0: 6774 2e63 6f6d 7075 7465 2829 0a0a 2020  gt.compute()..  
-00008400: 2020 2020 2020 6465 6275 6728 2273 6574        debug("set
-00008410: 2075 7020 7661 7269 616e 7420 7661 7269   up variant vari
-00008420: 6162 6c65 7322 290a 2020 2020 2020 2020  ables").        
-00008430: 636f 6e74 6967 7320 3d20 6473 5f73 6e70  contigs = ds_snp
-00008440: 732e 6174 7472 735b 2263 6f6e 7469 6773  s.attrs["contigs
-00008450: 225d 0a20 2020 2020 2020 2076 6172 6961  "].        varia
-00008460: 6e74 5f63 6f6e 7469 6720 3d20 6e70 2e72  nt_contig = np.r
-00008470: 6570 6561 7428 0a20 2020 2020 2020 2020  epeat(.         
-00008480: 2020 205b 636f 6e74 6967 735b 695d 2066     [contigs[i] f
-00008490: 6f72 2069 2069 6e20 6473 5f73 6e70 735b  or i in ds_snps[
-000084a0: 2276 6172 6961 6e74 5f63 6f6e 7469 6722  "variant_contig"
-000084b0: 5d2e 7661 6c75 6573 5d2c 2033 0a20 2020  ].values], 3.   
-000084c0: 2020 2020 2029 0a20 2020 2020 2020 2076       ).        v
-000084d0: 6172 6961 6e74 5f70 6f73 6974 696f 6e20  ariant_position 
-000084e0: 3d20 6e70 2e72 6570 6561 7428 6473 5f73  = np.repeat(ds_s
-000084f0: 6e70 735b 2276 6172 6961 6e74 5f70 6f73  nps["variant_pos
-00008500: 6974 696f 6e22 5d2e 7661 6c75 6573 2c20  ition"].values, 
-00008510: 3329 0a20 2020 2020 2020 2061 6c6c 656c  3).        allel
-00008520: 6573 203d 2064 735f 736e 7073 5b22 7661  es = ds_snps["va
-00008530: 7269 616e 745f 616c 6c65 6c65 225d 2e76  riant_allele"].v
-00008540: 616c 7565 730a 2020 2020 2020 2020 7661  alues.        va
-00008550: 7269 616e 745f 7265 665f 616c 6c65 6c65  riant_ref_allele
-00008560: 203d 206e 702e 7265 7065 6174 2861 6c6c   = np.repeat(all
-00008570: 656c 6573 5b3a 2c20 305d 2c20 3329 0a20  eles[:, 0], 3). 
-00008580: 2020 2020 2020 2076 6172 6961 6e74 5f61         variant_a
-00008590: 6c74 5f61 6c6c 656c 6520 3d20 616c 6c65  lt_allele = alle
-000085a0: 6c65 735b 3a2c 2031 3a5d 2e66 6c61 7474  les[:, 1:].flatt
-000085b0: 656e 2829 0a20 2020 2020 2020 2076 6172  en().        var
-000085c0: 6961 6e74 5f70 6173 7320 3d20 6469 6374  iant_pass = dict
-000085d0: 2829 0a20 2020 2020 2020 2066 6f72 2073  ().        for s
-000085e0: 6974 655f 6d61 736b 2069 6e20 7365 6c66  ite_mask in self
-000085f0: 2e73 6974 655f 6d61 736b 5f69 6473 3a0a  .site_mask_ids:.
-00008600: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00008610: 616e 745f 7061 7373 5b73 6974 655f 6d61  ant_pass[site_ma
-00008620: 736b 5d20 3d20 6e70 2e72 6570 6561 7428  sk] = np.repeat(
-00008630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008640: 2064 735f 736e 7073 5b66 2276 6172 6961   ds_snps[f"varia
-00008650: 6e74 5f66 696c 7465 725f 7061 7373 5f7b  nt_filter_pass_{
-00008660: 7369 7465 5f6d 6173 6b7d 225d 2e76 616c  site_mask}"].val
-00008670: 7565 732c 2033 0a20 2020 2020 2020 2020  ues, 3.         
-00008680: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-00008690: 6275 6728 2273 6574 7570 206d 6169 6e20  bug("setup main 
-000086a0: 6576 656e 7420 7661 7269 6162 6c65 7322  event variables"
-000086b0: 290a 2020 2020 2020 2020 6e5f 7661 7269  ).        n_vari
-000086c0: 616e 7473 2c20 6e5f 636f 686f 7274 7320  ants, n_cohorts 
-000086d0: 3d20 6c65 6e28 7661 7269 616e 745f 706f  = len(variant_po
-000086e0: 7369 7469 6f6e 292c 206c 656e 2864 665f  sition), len(df_
-000086f0: 636f 686f 7274 7329 0a20 2020 2020 2020  cohorts).       
-00008700: 2063 6f75 6e74 203d 206e 702e 7a65 726f   count = np.zero
-00008710: 7328 286e 5f76 6172 6961 6e74 732c 206e  s((n_variants, n
-00008720: 5f63 6f68 6f72 7473 292c 2064 7479 7065  _cohorts), dtype
-00008730: 3d69 6e74 290a 2020 2020 2020 2020 6e6f  =int).        no
-00008740: 6273 203d 206e 702e 7a65 726f 7328 286e  bs = np.zeros((n
-00008750: 5f76 6172 6961 6e74 732c 206e 5f63 6f68  _variants, n_coh
-00008760: 6f72 7473 292c 2064 7479 7065 3d69 6e74  orts), dtype=int
-00008770: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
-00008780: 2822 6275 696c 6420 6576 656e 7420 636f  ("build event co
-00008790: 756e 7420 616e 6420 6e6f 6273 2066 6f72  unt and nobs for
-000087a0: 2065 6163 6820 636f 686f 7274 2229 0a20   each cohort"). 
-000087b0: 2020 2020 2020 2063 6f68 6f72 7473 5f69         cohorts_i
-000087c0: 7465 7261 746f 7220 3d20 7365 6c66 2e5f  terator = self._
-000087d0: 7072 6f67 7265 7373 280a 2020 2020 2020  progress(.      
-000087e0: 2020 2020 2020 656e 756d 6572 6174 6528        enumerate(
-000087f0: 6466 5f63 6f68 6f72 7473 2e69 7465 7274  df_cohorts.itert
-00008800: 7570 6c65 7328 2929 2c0a 2020 2020 2020  uples()),.      
-00008810: 2020 2020 2020 746f 7461 6c3d 6c65 6e28        total=len(
-00008820: 6466 5f63 6f68 6f72 7473 292c 0a20 2020  df_cohorts),.   
-00008830: 2020 2020 2020 2020 2064 6573 633d 2243           desc="C
-00008840: 6f6d 7075 7465 2053 4e50 2061 6c6c 656c  ompute SNP allel
-00008850: 6520 6672 6571 7565 6e63 6965 7322 2c0a  e frequencies",.
-00008860: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00008870: 2020 666f 7220 636f 686f 7274 5f69 6e64    for cohort_ind
-00008880: 6578 2c20 636f 686f 7274 2069 6e20 636f  ex, cohort in co
-00008890: 686f 7274 735f 6974 6572 6174 6f72 3a0a  horts_iterator:.
-000088a0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
-000088b0: 7274 5f6b 6579 203d 2063 6f68 6f72 742e  rt_key = cohort.
-000088c0: 7461 786f 6e2c 2063 6f68 6f72 742e 6172  taxon, cohort.ar
-000088d0: 6561 2c20 636f 686f 7274 2e70 6572 696f  ea, cohort.perio
-000088e0: 640a 2020 2020 2020 2020 2020 2020 7361  d.            sa
-000088f0: 6d70 6c65 5f69 6e64 6963 6573 203d 2067  mple_indices = g
-00008900: 726f 7570 5f73 616d 706c 6573 5f62 795f  roup_samples_by_
-00008910: 636f 686f 7274 2e69 6e64 6963 6573 5b63  cohort.indices[c
-00008920: 6f68 6f72 745f 6b65 795d 0a0a 2020 2020  ohort_key]..    
-00008930: 2020 2020 2020 2020 636f 686f 7274 5f61          cohort_a
-00008940: 632c 2063 6f68 6f72 745f 616e 203d 2073  c, cohort_an = s
-00008950: 656c 662e 5f63 6f68 6f72 745f 616c 745f  elf._cohort_alt_
-00008960: 616c 6c65 6c65 5f63 6f75 6e74 735f 6d65  allele_counts_me
-00008970: 6c74 280a 2020 2020 2020 2020 2020 2020  lt(.            
-00008980: 2020 2020 6774 2c20 7361 6d70 6c65 5f69      gt, sample_i
-00008990: 6e64 6963 6573 2c20 6d61 785f 616c 6c65  ndices, max_alle
-000089a0: 6c65 3d33 0a20 2020 2020 2020 2020 2020  le=3.           
-000089b0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-000089c0: 6f75 6e74 5b3a 2c20 636f 686f 7274 5f69  ount[:, cohort_i
-000089d0: 6e64 6578 5d20 3d20 636f 686f 7274 5f61  ndex] = cohort_a
-000089e0: 630a 0a20 2020 2020 2020 2020 2020 2069  c..            i
-000089f0: 6620 6e6f 6273 5f6d 6f64 6520 3d3d 2022  f nobs_mode == "
-00008a00: 6361 6c6c 6564 223a 0a20 2020 2020 2020  called":.       
-00008a10: 2020 2020 2020 2020 206e 6f62 735b 3a2c           nobs[:,
-00008a20: 2063 6f68 6f72 745f 696e 6465 785d 203d   cohort_index] =
-00008a30: 2063 6f68 6f72 745f 616e 0a20 2020 2020   cohort_an.     
-00008a40: 2020 2020 2020 2065 6c69 6620 6e6f 6273         elif nobs
-00008a50: 5f6d 6f64 6520 3d3d 2022 6669 7865 6422  _mode == "fixed"
-00008a60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008a70: 2020 6e6f 6273 5b3a 2c20 636f 686f 7274    nobs[:, cohort
-00008a80: 5f69 6e64 6578 5d20 3d20 636f 686f 7274  _index] = cohort
-00008a90: 2e73 697a 6520 2a20 320a 2020 2020 2020  .size * 2.      
-00008aa0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008ab0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00008ac0: 6520 5661 6c75 6545 7272 6f72 2866 2242  e ValueError(f"B
-00008ad0: 6164 206e 6f62 735f 6d6f 6465 3a20 7b6e  ad nobs_mode: {n
-00008ae0: 6f62 735f 6d6f 6465 2172 7d22 290a 0a20  obs_mode!r}").. 
-00008af0: 2020 2020 2020 2064 6562 7567 2822 636f         debug("co
-00008b00: 6d70 7574 6520 6672 6571 7565 6e63 7922  mpute frequency"
-00008b10: 290a 2020 2020 2020 2020 7769 7468 206e  ).        with n
-00008b20: 702e 6572 7273 7461 7465 2864 6976 6964  p.errstate(divid
-00008b30: 653d 2269 676e 6f72 6522 2c20 696e 7661  e="ignore", inva
-00008b40: 6c69 643d 2269 676e 6f72 6522 293a 0a20  lid="ignore"):. 
-00008b50: 2020 2020 2020 2020 2020 2023 2069 676e             # ign
-00008b60: 6f72 6520 6469 7669 7369 6f6e 2077 6172  ore division war
-00008b70: 6e69 6e67 730a 2020 2020 2020 2020 2020  nings.          
-00008b80: 2020 6672 6571 7565 6e63 7920 3d20 636f    frequency = co
-00008b90: 756e 7420 2f20 6e6f 6273 0a0a 2020 2020  unt / nobs..    
-00008ba0: 2020 2020 6465 6275 6728 2263 6f6d 7075      debug("compu
-00008bb0: 7465 206d 6178 696d 756d 2066 7265 7175  te maximum frequ
-00008bc0: 656e 6379 206f 7665 7220 636f 686f 7274  ency over cohort
-00008bd0: 7322 290a 2020 2020 2020 2020 7769 7468  s").        with
-00008be0: 2077 6172 6e69 6e67 732e 6361 7463 685f   warnings.catch_
-00008bf0: 7761 726e 696e 6773 2829 3a0a 2020 2020  warnings():.    
-00008c00: 2020 2020 2020 2020 2320 6967 6e6f 7265          # ignore
-00008c10: 2022 416c 6c2d 4e61 4e20 736c 6963 6520   "All-NaN slice 
-00008c20: 656e 636f 756e 7465 7265 6422 2077 6172  encountered" war
-00008c30: 6e69 6e67 730a 2020 2020 2020 2020 2020  nings.          
-00008c40: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
-00008c50: 6566 696c 7465 7228 2269 676e 6f72 6522  efilter("ignore"
-00008c60: 2c20 6361 7465 676f 7279 3d52 756e 7469  , category=Runti
-00008c70: 6d65 5761 726e 696e 6729 0a20 2020 2020  meWarning).     
-00008c80: 2020 2020 2020 206d 6178 5f61 6620 3d20         max_af = 
-00008c90: 6e70 2e6e 616e 6d61 7828 6672 6571 7565  np.nanmax(freque
-00008ca0: 6e63 792c 2061 7869 733d 3129 0a0a 2020  ncy, axis=1)..  
-00008cb0: 2020 2020 2020 6465 6275 6728 226d 616b        debug("mak
-00008cc0: 6520 6461 7461 6672 616d 6520 6f66 2053  e dataframe of S
-00008cd0: 4e50 7322 290a 2020 2020 2020 2020 6466  NPs").        df
-00008ce0: 5f76 6172 6961 6e74 735f 636f 6c73 203d  _variants_cols =
-00008cf0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-00008d00: 636f 6e74 6967 223a 2076 6172 6961 6e74  contig": variant
-00008d10: 5f63 6f6e 7469 672c 0a20 2020 2020 2020  _contig,.       
-00008d20: 2020 2020 2022 706f 7369 7469 6f6e 223a       "position":
-00008d30: 2076 6172 6961 6e74 5f70 6f73 6974 696f   variant_positio
-00008d40: 6e2c 0a20 2020 2020 2020 2020 2020 2022  n,.            "
-00008d50: 7265 665f 616c 6c65 6c65 223a 2076 6172  ref_allele": var
-00008d60: 6961 6e74 5f72 6566 5f61 6c6c 656c 652e  iant_ref_allele.
-00008d70: 6173 7479 7065 2822 5531 2229 2c0a 2020  astype("U1"),.  
-00008d80: 2020 2020 2020 2020 2020 2261 6c74 5f61            "alt_a
-00008d90: 6c6c 656c 6522 3a20 7661 7269 616e 745f  llele": variant_
-00008da0: 616c 745f 616c 6c65 6c65 2e61 7374 7970  alt_allele.astyp
-00008db0: 6528 2255 3122 292c 0a20 2020 2020 2020  e("U1"),.       
-00008dc0: 2020 2020 2022 6d61 785f 6166 223a 206d       "max_af": m
-00008dd0: 6178 5f61 662c 0a20 2020 2020 2020 207d  ax_af,.        }
-00008de0: 0a20 2020 2020 2020 2066 6f72 2073 6974  .        for sit
-00008df0: 655f 6d61 736b 2069 6e20 7365 6c66 2e73  e_mask in self.s
-00008e00: 6974 655f 6d61 736b 5f69 6473 3a0a 2020  ite_mask_ids:.  
-00008e10: 2020 2020 2020 2020 2020 6466 5f76 6172            df_var
-00008e20: 6961 6e74 735f 636f 6c73 5b66 2270 6173  iants_cols[f"pas
-00008e30: 735f 7b73 6974 655f 6d61 736b 7d22 5d20  s_{site_mask}"] 
-00008e40: 3d20 7661 7269 616e 745f 7061 7373 5b73  = variant_pass[s
-00008e50: 6974 655f 6d61 736b 5d0a 2020 2020 2020  ite_mask].      
-00008e60: 2020 6466 5f76 6172 6961 6e74 7320 3d20    df_variants = 
-00008e70: 7064 2e44 6174 6146 7261 6d65 2864 665f  pd.DataFrame(df_
-00008e80: 7661 7269 616e 7473 5f63 6f6c 7329 0a0a  variants_cols)..
-00008e90: 2020 2020 2020 2020 6465 6275 6728 2264          debug("d
-00008ea0: 6561 6c20 7769 7468 2053 4e50 2061 6c6c  eal with SNP all
-00008eb0: 656c 6573 206e 6f74 206f 6273 6572 7665  eles not observe
-00008ec0: 6422 290a 2020 2020 2020 2020 6966 2064  d").        if d
-00008ed0: 726f 705f 696e 7661 7269 616e 743a 0a20  rop_invariant:. 
-00008ee0: 2020 2020 2020 2020 2020 206c 6f63 5f76             loc_v
-00008ef0: 6172 6961 6e74 203d 206d 6178 5f61 6620  ariant = max_af 
-00008f00: 3e20 300a 2020 2020 2020 2020 2020 2020  > 0.            
-00008f10: 6466 5f76 6172 6961 6e74 7320 3d20 6466  df_variants = df
-00008f20: 5f76 6172 6961 6e74 732e 6c6f 635b 6c6f  _variants.loc[lo
-00008f30: 635f 7661 7269 616e 745d 2e72 6573 6574  c_variant].reset
-00008f40: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
-00008f50: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00008f60: 756e 7420 3d20 6e70 2e63 6f6d 7072 6573  unt = np.compres
-00008f70: 7328 6c6f 635f 7661 7269 616e 742c 2063  s(loc_variant, c
-00008f80: 6f75 6e74 2c20 6178 6973 3d30 290a 2020  ount, axis=0).  
-00008f90: 2020 2020 2020 2020 2020 6e6f 6273 203d            nobs =
-00008fa0: 206e 702e 636f 6d70 7265 7373 286c 6f63   np.compress(loc
-00008fb0: 5f76 6172 6961 6e74 2c20 6e6f 6273 2c20  _variant, nobs, 
-00008fc0: 6178 6973 3d30 290a 2020 2020 2020 2020  axis=0).        
-00008fd0: 2020 2020 6672 6571 7565 6e63 7920 3d20      frequency = 
-00008fe0: 6e70 2e63 6f6d 7072 6573 7328 6c6f 635f  np.compress(loc_
-00008ff0: 7661 7269 616e 742c 2066 7265 7175 656e  variant, frequen
-00009000: 6379 2c20 6178 6973 3d30 290a 0a20 2020  cy, axis=0)..   
-00009010: 2020 2020 2064 6562 7567 2822 7365 7420       debug("set 
-00009020: 7570 2076 6172 6961 6e74 2065 6666 6563  up variant effec
-00009030: 7420 616e 6e6f 7461 746f 7222 290a 2020  t annotator").  
-00009040: 2020 2020 2020 616e 6e20 3d20 7365 6c66        ann = self
-00009050: 2e5f 616e 6e6f 7461 746f 7228 290a 0a20  ._annotator().. 
-00009060: 2020 2020 2020 2064 6562 7567 2822 6164         debug("ad
-00009070: 6420 6566 6665 6374 7320 746f 2074 6865  d effects to the
-00009080: 2064 6174 6166 7261 6d65 2229 0a20 2020   dataframe").   
-00009090: 2020 2020 2061 6e6e 2e67 6574 5f65 6666       ann.get_eff
-000090a0: 6563 7473 280a 2020 2020 2020 2020 2020  ects(.          
-000090b0: 2020 7472 616e 7363 7269 7074 3d74 7261    transcript=tra
-000090c0: 6e73 6372 6970 742c 2076 6172 6961 6e74  nscript, variant
-000090d0: 733d 6466 5f76 6172 6961 6e74 732c 2070  s=df_variants, p
-000090e0: 726f 6772 6573 733d 7365 6c66 2e5f 7072  rogress=self._pr
-000090f0: 6f67 7265 7373 0a20 2020 2020 2020 2029  ogress.        )
-00009100: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00009110: 2261 6464 2076 6172 6961 6e74 206c 6162  "add variant lab
-00009120: 656c 7322 290a 2020 2020 2020 2020 6466  els").        df
-00009130: 5f76 6172 6961 6e74 735b 226c 6162 656c  _variants["label
-00009140: 225d 203d 2073 656c 662e 5f70 616e 6461  "] = self._panda
-00009150: 735f 6170 706c 7928 0a20 2020 2020 2020  s_apply(.       
-00009160: 2020 2020 2073 656c 662e 5f6d 616b 655f       self._make_
-00009170: 736e 705f 6c61 6265 6c5f 6566 6665 6374  snp_label_effect
-00009180: 2c0a 2020 2020 2020 2020 2020 2020 6466  ,.            df
-00009190: 5f76 6172 6961 6e74 732c 0a20 2020 2020  _variants,.     
-000091a0: 2020 2020 2020 2063 6f6c 756d 6e73 3d5b         columns=[
-000091b0: 2263 6f6e 7469 6722 2c20 2270 6f73 6974  "contig", "posit
-000091c0: 696f 6e22 2c20 2272 6566 5f61 6c6c 656c  ion", "ref_allel
-000091d0: 6522 2c20 2261 6c74 5f61 6c6c 656c 6522  e", "alt_allele"
-000091e0: 2c20 2261 615f 6368 616e 6765 225d 2c0a  , "aa_change"],.
-000091f0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00009200: 2020 2064 6562 7567 2822 6275 696c 6420     debug("build 
-00009210: 7468 6520 6f75 7470 7574 2064 6174 6173  the output datas
-00009220: 6574 2229 0a20 2020 2020 2020 2064 735f  et").        ds_
-00009230: 6f75 7420 3d20 7872 2e44 6174 6173 6574  out = xr.Dataset
-00009240: 2829 0a0a 2020 2020 2020 2020 6465 6275  ()..        debu
-00009250: 6728 2263 6f68 6f72 7420 7661 7269 6162  g("cohort variab
-00009260: 6c65 7322 290a 2020 2020 2020 2020 666f  les").        fo
-00009270: 7220 636f 685f 636f 6c20 696e 2064 665f  r coh_col in df_
-00009280: 636f 686f 7274 732e 636f 6c75 6d6e 733a  cohorts.columns:
-00009290: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
-000092a0: 6f75 745b 6622 636f 686f 7274 5f7b 636f  out[f"cohort_{co
-000092b0: 685f 636f 6c7d 225d 203d 2022 636f 686f  h_col}"] = "coho
-000092c0: 7274 7322 2c20 6466 5f63 6f68 6f72 7473  rts", df_cohorts
-000092d0: 5b63 6f68 5f63 6f6c 5d0a 0a20 2020 2020  [coh_col]..     
-000092e0: 2020 2064 6562 7567 2822 7661 7269 616e     debug("varian
-000092f0: 7420 7661 7269 6162 6c65 7322 290a 2020  t variables").  
-00009300: 2020 2020 2020 666f 7220 736e 705f 636f        for snp_co
-00009310: 6c20 696e 2064 665f 7661 7269 616e 7473  l in df_variants
-00009320: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-00009330: 2020 2020 2020 6473 5f6f 7574 5b66 2276        ds_out[f"v
-00009340: 6172 6961 6e74 5f7b 736e 705f 636f 6c7d  ariant_{snp_col}
-00009350: 225d 203d 2022 7661 7269 616e 7473 222c  "] = "variants",
-00009360: 2064 665f 7661 7269 616e 7473 5b73 6e70   df_variants[snp
-00009370: 5f63 6f6c 5d0a 0a20 2020 2020 2020 2064  _col]..        d
-00009380: 6562 7567 2822 6576 656e 7420 7661 7269  ebug("event vari
-00009390: 6162 6c65 7322 290a 2020 2020 2020 2020  ables").        
-000093a0: 6473 5f6f 7574 5b22 6576 656e 745f 636f  ds_out["event_co
-000093b0: 756e 7422 5d20 3d20 2822 7661 7269 616e  unt"] = ("varian
-000093c0: 7473 222c 2022 636f 686f 7274 7322 292c  ts", "cohorts"),
-000093d0: 2063 6f75 6e74 0a20 2020 2020 2020 2064   count.        d
-000093e0: 735f 6f75 745b 2265 7665 6e74 5f6e 6f62  s_out["event_nob
-000093f0: 7322 5d20 3d20 2822 7661 7269 616e 7473  s"] = ("variants
-00009400: 222c 2022 636f 686f 7274 7322 292c 206e  ", "cohorts"), n
-00009410: 6f62 730a 2020 2020 2020 2020 6473 5f6f  obs.        ds_o
-00009420: 7574 5b22 6576 656e 745f 6672 6571 7565  ut["event_freque
-00009430: 6e63 7922 5d20 3d20 2822 7661 7269 616e  ncy"] = ("varian
-00009440: 7473 222c 2022 636f 686f 7274 7322 292c  ts", "cohorts"),
-00009450: 2066 7265 7175 656e 6379 0a0a 2020 2020   frequency..    
-00009460: 2020 2020 6465 6275 6728 2261 7070 6c79      debug("apply
-00009470: 2076 6172 6961 6e74 2071 7565 7279 2229   variant query")
-00009480: 0a20 2020 2020 2020 2069 6620 7661 7269  .        if vari
-00009490: 616e 745f 7175 6572 7920 6973 206e 6f74  ant_query is not
-000094a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000094b0: 2020 206c 6f63 5f76 6172 6961 6e74 7320     loc_variants 
-000094c0: 3d20 6466 5f76 6172 6961 6e74 732e 6576  = df_variants.ev
-000094d0: 616c 2876 6172 6961 6e74 5f71 7565 7279  al(variant_query
-000094e0: 292e 7661 6c75 6573 0a20 2020 2020 2020  ).values.       
-000094f0: 2020 2020 2064 735f 6f75 7420 3d20 6473       ds_out = ds
-00009500: 5f6f 7574 2e69 7365 6c28 7661 7269 616e  _out.isel(varian
-00009510: 7473 3d6c 6f63 5f76 6172 6961 6e74 7329  ts=loc_variants)
-00009520: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00009530: 2261 6464 2063 6f6e 6669 6465 6e63 6520  "add confidence 
-00009540: 696e 7465 7276 616c 7322 290a 2020 2020  intervals").    
-00009550: 2020 2020 7365 6c66 2e5f 6164 645f 6672      self._add_fr
-00009560: 6571 7565 6e63 795f 6369 2864 735f 6f75  equency_ci(ds_ou
-00009570: 742c 2063 695f 6d65 7468 6f64 290a 0a20  t, ci_method).. 
-00009580: 2020 2020 2020 2064 6562 7567 2822 7469         debug("ti
-00009590: 6479 2075 7020 6469 7370 6c61 7920 6279  dy up display by
-000095a0: 2073 6f72 7469 6e67 2076 6172 6961 626c   sorting variabl
-000095b0: 6573 2229 0a20 2020 2020 2020 2073 6f72  es").        sor
-000095c0: 7465 645f 7661 7273 3a20 4c69 7374 5b73  ted_vars: List[s
-000095d0: 7472 5d20 3d20 736f 7274 6564 285b 7374  tr] = sorted([st
-000095e0: 7228 6b29 2066 6f72 206b 2069 6e20 6473  r(k) for k in ds
-000095f0: 5f6f 7574 2e6b 6579 7328 295d 290a 2020  _out.keys()]).  
-00009600: 2020 2020 2020 6473 5f6f 7574 203d 2064        ds_out = d
-00009610: 735f 6f75 745b 736f 7274 6564 5f76 6172  s_out[sorted_var
-00009620: 735d 0a0a 2020 2020 2020 2020 6465 6275  s]..        debu
-00009630: 6728 2261 6464 206d 6574 6164 6174 6122  g("add metadata"
-00009640: 290a 2020 2020 2020 2020 6765 6e65 5f6e  ).        gene_n
-00009650: 616d 6520 3d20 7365 6c66 2e5f 7472 616e  ame = self._tran
-00009660: 7363 7269 7074 5f74 6f5f 6765 6e65 5f6e  script_to_gene_n
-00009670: 616d 6528 7472 616e 7363 7269 7074 290a  ame(transcript).
-00009680: 2020 2020 2020 2020 7469 746c 6520 3d20          title = 
-00009690: 7472 616e 7363 7269 7074 0a20 2020 2020  transcript.     
-000096a0: 2020 2069 6620 6765 6e65 5f6e 616d 653a     if gene_name:
-000096b0: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
-000096c0: 6c65 202b 3d20 6622 2028 7b67 656e 655f  le += f" ({gene_
-000096d0: 6e61 6d65 7d29 220a 2020 2020 2020 2020  name})".        
-000096e0: 7469 746c 6520 2b3d 2022 2053 4e50 2066  title += " SNP f
-000096f0: 7265 7175 656e 6369 6573 220a 2020 2020  requencies".    
-00009700: 2020 2020 6473 5f6f 7574 2e61 7474 7273      ds_out.attrs
-00009710: 5b22 7469 746c 6522 5d20 3d20 7469 746c  ["title"] = titl
-00009720: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00009730: 6e20 6473 5f6f 7574 0a0a 2020 2020 2320  n ds_out..    # 
-00009740: 5374 6172 7420 6f66 2040 7374 6174 6963  Start of @static
-00009750: 6d65 7468 6f64 2040 6162 7374 7261 6374  method @abstract
-00009760: 6d65 7468 6f64 0a0a 2020 2020 4073 7461  method..    @sta
-00009770: 7469 636d 6574 686f 640a 2020 2020 4061  ticmethod.    @a
-00009780: 6273 7472 6163 746d 6574 686f 640a 2020  bstractmethod.  
-00009790: 2020 6465 6620 5f73 6574 7570 5f74 6178    def _setup_tax
-000097a0: 6f6e 5f63 6f6c 6f72 7328 706c 6f74 5f6b  on_colors(plot_k
-000097b0: 7761 7267 733d 4e6f 6e65 293a 0a20 2020  wargs=None):.   
-000097c0: 2020 2020 2023 2053 7562 636c 6173 7365       # Subclasse
-000097d0: 7320 6861 7665 2064 6966 6665 7265 6e74  s have different
-000097e0: 2074 6178 6f6e 5f63 6f6c 6f72 5f6d 6170   taxon_color_map
-000097f0: 2e0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
-00009800: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-00009810: 726f 7228 224d 7573 7420 6f76 6572 7269  ror("Must overri
-00009820: 6465 205f 7365 7475 705f 7461 786f 6e5f  de _setup_taxon_
-00009830: 636f 6c6f 7273 2229 0a0a 2020 2020 2320  colors")..    # 
-00009840: 5374 6172 7420 6f66 2040 7374 6174 6963  Start of @static
-00009850: 6d65 7468 6f64 0a0a 2020 2020 4073 7461  method..    @sta
-00009860: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-00009870: 6620 5f6c 6f63 6174 655f 636f 686f 7274  f _locate_cohort
-00009880: 7328 2a2c 2063 6f68 6f72 7473 2c20 6466  s(*, cohorts, df
-00009890: 5f73 616d 706c 6573 293a 0a20 2020 2020  _samples):.     
-000098a0: 2020 2023 2062 7569 6c64 2063 6f68 6f72     # build cohor
-000098b0: 7420 6469 6374 696f 6e61 7279 2077 6865  t dictionary whe
-000098c0: 7265 206b 6579 3d63 6f68 6f72 745f 6964  re key=cohort_id
-000098d0: 2c20 7661 6c75 653d 6c6f 635f 636f 680a  , value=loc_coh.
-000098e0: 2020 2020 2020 2020 636f 685f 6469 6374          coh_dict
-000098f0: 203d 207b 7d0a 0a20 2020 2020 2020 2069   = {}..        i
-00009900: 6620 6973 696e 7374 616e 6365 2863 6f68  f isinstance(coh
-00009910: 6f72 7473 2c20 6469 6374 293a 0a20 2020  orts, dict):.   
-00009920: 2020 2020 2020 2020 2023 2075 7365 7220           # user 
-00009930: 6861 7320 7375 7070 6c69 6564 2061 2063  has supplied a c
-00009940: 7573 746f 6d20 6469 6374 696f 6e61 7279  ustom dictionary
-00009950: 206d 6170 7069 6e67 2063 6f68 6f72 7420   mapping cohort 
-00009960: 6964 656e 7469 6669 6572 730a 2020 2020  identifiers.    
-00009970: 2020 2020 2020 2020 2320 746f 2070 616e          # to pan
-00009980: 6461 7320 7175 6572 6965 730a 0a20 2020  das queries..   
-00009990: 2020 2020 2020 2020 2066 6f72 2063 6f68           for coh
-000099a0: 2c20 7175 6572 7920 696e 2063 6f68 6f72  , query in cohor
-000099b0: 7473 2e69 7465 6d73 2829 3a0a 2020 2020  ts.items():.    
-000099c0: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
-000099d0: 6361 7465 2073 616d 706c 6573 0a20 2020  cate samples.   
-000099e0: 2020 2020 2020 2020 2020 2020 206c 6f63               loc
-000099f0: 5f63 6f68 203d 2064 665f 7361 6d70 6c65  _coh = df_sample
-00009a00: 732e 6576 616c 2871 7565 7279 292e 7661  s.eval(query).va
-00009a10: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
-00009a20: 2020 2020 2063 6f68 5f64 6963 745b 636f       coh_dict[co
-00009a30: 685d 203d 206c 6f63 5f63 6f68 0a0a 2020  h] = loc_coh..  
-00009a40: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00009a50: 6e63 6528 636f 686f 7274 732c 2073 7472  nce(cohorts, str
-00009a60: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-00009a70: 2075 7365 7220 6861 7320 7375 7070 6c69   user has suppli
-00009a80: 6564 206f 6e65 206f 6620 7468 6520 7072  ed one of the pr
-00009a90: 6564 6566 696e 6564 2063 6f68 6f72 7420  edefined cohort 
-00009aa0: 7365 7473 0a0a 2020 2020 2020 2020 2020  sets..          
-00009ab0: 2020 2320 6669 7820 7468 6520 7374 7269    # fix the stri
-00009ac0: 6e67 2074 6f20 6d61 7463 6820 636f 6c75  ng to match colu
-00009ad0: 6d6e 730a 2020 2020 2020 2020 2020 2020  mns.            
-00009ae0: 6966 206e 6f74 2063 6f68 6f72 7473 2e73  if not cohorts.s
-00009af0: 7461 7274 7377 6974 6828 2263 6f68 6f72  tartswith("cohor
-00009b00: 745f 2229 3a0a 2020 2020 2020 2020 2020  t_"):.          
-00009b10: 2020 2020 2020 636f 686f 7274 7320 3d20        cohorts = 
-00009b20: 2263 6f68 6f72 745f 2220 2b20 636f 686f  "cohort_" + coho
-00009b30: 7274 730a 0a20 2020 2020 2020 2020 2020  rts..           
-00009b40: 2023 2063 6865 636b 2074 6865 2067 6976   # check the giv
-00009b50: 656e 2063 6f68 6f72 7420 7365 7420 6578  en cohort set ex
-00009b60: 6973 7473 0a20 2020 2020 2020 2020 2020  ists.           
-00009b70: 2069 6620 636f 686f 7274 7320 6e6f 7420   if cohorts not 
-00009b80: 696e 2064 665f 7361 6d70 6c65 732e 636f  in df_samples.co
-00009b90: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
-00009ba0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00009bb0: 7565 4572 726f 7228 6622 7b63 6f68 6f72  ueError(f"{cohor
-00009bc0: 7473 2172 7d20 6973 206e 6f74 2061 206b  ts!r} is not a k
-00009bd0: 6e6f 776e 2063 6f68 6f72 7420 7365 7422  nown cohort set"
-00009be0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00009bf0: 686f 7274 5f6c 6162 656c 7320 3d20 6466  hort_labels = df
-00009c00: 5f73 616d 706c 6573 5b63 6f68 6f72 7473  _samples[cohorts
-00009c10: 5d2e 756e 6971 7565 2829 0a0a 2020 2020  ].unique()..    
-00009c20: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
-00009c30: 2074 6865 206e 616e 7320 616e 6420 736f   the nans and so
-00009c40: 7274 0a20 2020 2020 2020 2020 2020 2063  rt.            c
-00009c50: 6f68 6f72 745f 6c61 6265 6c73 203d 2073  ohort_labels = s
-00009c60: 6f72 7465 6428 5b63 2066 6f72 2063 2069  orted([c for c i
-00009c70: 6e20 636f 686f 7274 5f6c 6162 656c 7320  n cohort_labels 
-00009c80: 6966 2069 7369 6e73 7461 6e63 6528 632c  if isinstance(c,
-00009c90: 2073 7472 295d 290a 2020 2020 2020 2020   str)]).        
-00009ca0: 2020 2020 666f 7220 636f 6820 696e 2063      for coh in c
-00009cb0: 6f68 6f72 745f 6c61 6265 6c73 3a0a 2020  ohort_labels:.  
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00009cd0: 635f 636f 6820 3d20 6466 5f73 616d 706c  c_coh = df_sampl
-00009ce0: 6573 5b63 6f68 6f72 7473 5d20 3d3d 2063  es[cohorts] == c
-00009cf0: 6f68 0a20 2020 2020 2020 2020 2020 2020  oh.             
-00009d00: 2020 2063 6f68 5f64 6963 745b 636f 685d     coh_dict[coh]
-00009d10: 203d 206c 6f63 5f63 6f68 2e76 616c 7565   = loc_coh.value
-00009d20: 730a 0a20 2020 2020 2020 2072 6574 7572  s..        retur
-00009d30: 6e20 636f 685f 6469 6374 0a0a 2020 2020  n coh_dict..    
-00009d40: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00009d50: 2020 6465 6620 5f6d 616b 655f 7361 6d70    def _make_samp
-00009d60: 6c65 5f70 6572 696f 645f 6d6f 6e74 6828  le_period_month(
-00009d70: 726f 7729 3a0a 2020 2020 2020 2020 7965  row):.        ye
-00009d80: 6172 203d 2072 6f77 2e79 6561 720a 2020  ar = row.year.  
-00009d90: 2020 2020 2020 6d6f 6e74 6820 3d20 726f        month = ro
-00009da0: 772e 6d6f 6e74 680a 2020 2020 2020 2020  w.month.        
-00009db0: 6966 2079 6561 7220 3e20 3020 616e 6420  if year > 0 and 
-00009dc0: 6d6f 6e74 6820 3e20 303a 0a20 2020 2020  month > 0:.     
-00009dd0: 2020 2020 2020 2072 6574 7572 6e20 7064         return pd
-00009de0: 2e50 6572 696f 6428 6672 6571 3d22 4d22  .Period(freq="M"
-00009df0: 2c20 7965 6172 3d79 6561 722c 206d 6f6e  , year=year, mon
-00009e00: 7468 3d6d 6f6e 7468 290a 2020 2020 2020  th=month).      
-00009e10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009e20: 2020 2020 7265 7475 726e 2070 642e 4e61      return pd.Na
-00009e30: 540a 0a20 2020 2040 7374 6174 6963 6d65  T..    @staticme
-00009e40: 7468 6f64 0a20 2020 2064 6566 205f 6d61  thod.    def _ma
-00009e50: 6b65 5f73 616d 706c 655f 7065 7269 6f64  ke_sample_period
-00009e60: 5f71 7561 7274 6572 2872 6f77 293a 0a20  _quarter(row):. 
-00009e70: 2020 2020 2020 2079 6561 7220 3d20 726f         year = ro
-00009e80: 772e 7965 6172 0a20 2020 2020 2020 206d  w.year.        m
-00009e90: 6f6e 7468 203d 2072 6f77 2e6d 6f6e 7468  onth = row.month
-00009ea0: 0a20 2020 2020 2020 2069 6620 7965 6172  .        if year
-00009eb0: 203e 2030 2061 6e64 206d 6f6e 7468 203e   > 0 and month >
-00009ec0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00009ed0: 7265 7475 726e 2070 642e 5065 7269 6f64  return pd.Period
-00009ee0: 2866 7265 713d 2251 222c 2079 6561 723d  (freq="Q", year=
-00009ef0: 7965 6172 2c20 6d6f 6e74 683d 6d6f 6e74  year, month=mont
-00009f00: 6829 0a20 2020 2020 2020 2065 6c73 653a  h).        else:
-00009f10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00009f20: 7572 6e20 7064 2e4e 6154 0a0a 2020 2020  urn pd.NaT..    
-00009f30: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00009f40: 2020 6465 6620 5f6d 616b 655f 7361 6d70    def _make_samp
-00009f50: 6c65 5f70 6572 696f 645f 7965 6172 2872  le_period_year(r
-00009f60: 6f77 293a 0a20 2020 2020 2020 2079 6561  ow):.        yea
-00009f70: 7220 3d20 726f 772e 7965 6172 0a20 2020  r = row.year.   
-00009f80: 2020 2020 2069 6620 7965 6172 203e 2030       if year > 0
-00009f90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00009fa0: 7475 726e 2070 642e 5065 7269 6f64 2866  turn pd.Period(f
-00009fb0: 7265 713d 2241 222c 2079 6561 723d 7965  req="A", year=ye
-00009fc0: 6172 290a 2020 2020 2020 2020 656c 7365  ar).        else
-00009fd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00009fe0: 7475 726e 2070 642e 4e61 540a 0a20 2020  turn pd.NaT..   
-00009ff0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-0000a000: 2020 2040 6e75 6d62 612e 6e6a 6974 0a20     @numba.njit. 
-0000a010: 2020 2064 6566 205f 636f 686f 7274 5f61     def _cohort_a
-0000a020: 6c74 5f61 6c6c 656c 655f 636f 756e 7473  lt_allele_counts
-0000a030: 5f6d 656c 745f 6b65 726e 656c 2867 742c  _melt_kernel(gt,
-0000a040: 2069 6e64 6963 6573 2c20 6d61 785f 616c   indices, max_al
-0000a050: 6c65 6c65 293a 0a20 2020 2020 2020 206e  lele):.        n
-0000a060: 5f76 6172 6961 6e74 7320 3d20 6774 2e73  _variants = gt.s
-0000a070: 6861 7065 5b30 5d0a 2020 2020 2020 2020  hape[0].        
-0000a080: 6e5f 696e 6469 6365 7320 3d20 696e 6469  n_indices = indi
-0000a090: 6365 732e 7368 6170 655b 305d 0a20 2020  ces.shape[0].   
-0000a0a0: 2020 2020 2070 6c6f 6964 7920 3d20 6774       ploidy = gt
-0000a0b0: 2e73 6861 7065 5b32 5d0a 0a20 2020 2020  .shape[2]..     
-0000a0c0: 2020 2061 635f 616c 745f 6d65 6c74 203d     ac_alt_melt =
-0000a0d0: 206e 702e 7a65 726f 7328 6e5f 7661 7269   np.zeros(n_vari
-0000a0e0: 616e 7473 202a 206d 6178 5f61 6c6c 656c  ants * max_allel
-0000a0f0: 652c 2064 7479 7065 3d6e 702e 696e 7436  e, dtype=np.int6
-0000a100: 3429 0a20 2020 2020 2020 2061 6e20 3d20  4).        an = 
-0000a110: 6e70 2e7a 6572 6f73 286e 5f76 6172 6961  np.zeros(n_varia
-0000a120: 6e74 732c 2064 7479 7065 3d6e 702e 696e  nts, dtype=np.in
-0000a130: 7436 3429 0a0a 2020 2020 2020 2020 666f  t64)..        fo
-0000a140: 7220 6920 696e 2072 616e 6765 286e 5f76  r i in range(n_v
-0000a150: 6172 6961 6e74 7329 3a0a 2020 2020 2020  ariants):.      
-0000a160: 2020 2020 2020 6f75 745f 695f 6f66 6673        out_i_offs
-0000a170: 6574 203d 2028 6920 2a20 6d61 785f 616c  et = (i * max_al
-0000a180: 6c65 6c65 2920 2d20 310a 2020 2020 2020  lele) - 1.      
-0000a190: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-0000a1a0: 616e 6765 286e 5f69 6e64 6963 6573 293a  ange(n_indices):
-0000a1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a1c0: 2069 7820 3d20 696e 6469 6365 735b 6a5d   ix = indices[j]
-0000a1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a1e0: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-0000a1f0: 706c 6f69 6479 293a 0a20 2020 2020 2020  ploidy):.       
-0000a200: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
-0000a210: 656c 6520 3d20 6774 5b69 2c20 6978 2c20  ele = gt[i, ix, 
-0000a220: 6b5d 0a20 2020 2020 2020 2020 2020 2020  k].             
-0000a230: 2020 2020 2020 2069 6620 616c 6c65 6c65         if allele
-0000a240: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0000a250: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-0000a260: 745f 6920 3d20 6f75 745f 695f 6f66 6673  t_i = out_i_offs
-0000a270: 6574 202b 2061 6c6c 656c 650a 2020 2020  et + allele.    
-0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a290: 2020 2020 6163 5f61 6c74 5f6d 656c 745b      ac_alt_melt[
-0000a2a0: 6f75 745f 695d 202b 3d20 310a 2020 2020  out_i] += 1.    
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 2020 2020 616e 5b69 5d20 2b3d 2031 0a20      an[i] += 1. 
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2020 2065 6c69 6620 616c 6c65 6c65 203d     elif allele =
-0000a2f0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000a300: 2020 2020 2020 2020 2020 2020 2061 6e5b               an[
-0000a310: 695d 202b 3d20 310a 0a20 2020 2020 2020  i] += 1..       
-0000a320: 2072 6574 7572 6e20 6163 5f61 6c74 5f6d   return ac_alt_m
-0000a330: 656c 742c 2061 6e0a 0a20 2020 2040 7374  elt, an..    @st
-0000a340: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-0000a350: 6566 205f 6d61 6b65 5f73 6e70 5f6c 6162  ef _make_snp_lab
-0000a360: 656c 2863 6f6e 7469 672c 2070 6f73 6974  el(contig, posit
-0000a370: 696f 6e2c 2072 6566 5f61 6c6c 656c 652c  ion, ref_allele,
-0000a380: 2061 6c74 5f61 6c6c 656c 6529 3a0a 2020   alt_allele):.  
-0000a390: 2020 2020 2020 7265 7475 726e 2066 227b        return f"{
-0000a3a0: 636f 6e74 6967 7d3a 7b70 6f73 6974 696f  contig}:{positio
-0000a3b0: 6e3a 2c7d 207b 7265 665f 616c 6c65 6c65  n:,} {ref_allele
-0000a3c0: 7d3e 7b61 6c74 5f61 6c6c 656c 657d 220a  }>{alt_allele}".
-0000a3d0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-0000a3e0: 6f64 0a20 2020 2064 6566 205f 6d61 6b65  od.    def _make
-0000a3f0: 5f73 6e70 5f6c 6162 656c 5f65 6666 6563  _snp_label_effec
-0000a400: 7428 636f 6e74 6967 2c20 706f 7369 7469  t(contig, positi
-0000a410: 6f6e 2c20 7265 665f 616c 6c65 6c65 2c20  on, ref_allele, 
-0000a420: 616c 745f 616c 6c65 6c65 2c20 6161 5f63  alt_allele, aa_c
-0000a430: 6861 6e67 6529 3a0a 2020 2020 2020 2020  hange):.        
-0000a440: 6c61 6265 6c20 3d20 6622 7b63 6f6e 7469  label = f"{conti
-0000a450: 677d 3a7b 706f 7369 7469 6f6e 3a2c 7d20  g}:{position:,} 
-0000a460: 7b72 6566 5f61 6c6c 656c 657d 3e7b 616c  {ref_allele}>{al
-0000a470: 745f 616c 6c65 6c65 7d22 0a20 2020 2020  t_allele}".     
-0000a480: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000a490: 2861 615f 6368 616e 6765 2c20 7374 7229  (aa_change, str)
-0000a4a0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-0000a4b0: 6265 6c20 2b3d 2066 2220 287b 6161 5f63  bel += f" ({aa_c
-0000a4c0: 6861 6e67 657d 2922 0a20 2020 2020 2020  hange})".       
-0000a4d0: 2072 6574 7572 6e20 6c61 6265 6c0a 0a20   return label.. 
-0000a4e0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-0000a4f0: 0a20 2020 2064 6566 205f 6d61 6b65 5f73  .    def _make_s
-0000a500: 6e70 5f6c 6162 656c 5f61 6128 6161 5f63  np_label_aa(aa_c
-0000a510: 6861 6e67 652c 2063 6f6e 7469 672c 2070  hange, contig, p
-0000a520: 6f73 6974 696f 6e2c 2072 6566 5f61 6c6c  osition, ref_all
-0000a530: 656c 652c 2061 6c74 5f61 6c6c 656c 6529  ele, alt_allele)
-0000a540: 3a0a 2020 2020 2020 2020 6c61 6265 6c20  :.        label 
-0000a550: 3d20 6622 7b61 615f 6368 616e 6765 7d20  = f"{aa_change} 
-0000a560: 287b 636f 6e74 6967 7d3a 7b70 6f73 6974  ({contig}:{posit
-0000a570: 696f 6e3a 2c7d 207b 7265 665f 616c 6c65  ion:,} {ref_alle
-0000a580: 6c65 7d3e 7b61 6c74 5f61 6c6c 656c 657d  le}>{alt_allele}
-0000a590: 2922 0a20 2020 2020 2020 2072 6574 7572  )".        retur
-0000a5a0: 6e20 6c61 6265 6c0a 0a20 2020 2040 7374  n label..    @st
-0000a5b0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-0000a5c0: 6566 205f 6d61 6b65 5f67 656e 655f 636e  ef _make_gene_cn
-0000a5d0: 765f 6c61 6265 6c28 6765 6e65 5f69 642c  v_label(gene_id,
-0000a5e0: 2067 656e 655f 6e61 6d65 2c20 636e 765f   gene_name, cnv_
-0000a5f0: 7479 7065 293a 0a20 2020 2020 2020 206c  type):.        l
-0000a600: 6162 656c 203d 2067 656e 655f 6964 0a20  abel = gene_id. 
-0000a610: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000a620: 616e 6365 2867 656e 655f 6e61 6d65 2c20  ance(gene_name, 
-0000a630: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-0000a640: 2020 6c61 6265 6c20 2b3d 2066 2220 287b    label += f" ({
-0000a650: 6765 6e65 5f6e 616d 657d 2922 0a20 2020  gene_name})".   
-0000a660: 2020 2020 206c 6162 656c 202b 3d20 6622       label += f"
-0000a670: 207b 636e 765f 7479 7065 7d22 0a20 2020   {cnv_type}".   
-0000a680: 2020 2020 2072 6574 7572 6e20 6c61 6265       return labe
-0000a690: 6c0a 0a20 2020 2040 7374 6174 6963 6d65  l..    @staticme
-0000a6a0: 7468 6f64 0a20 2020 2064 6566 205f 6d61  thod.    def _ma
-0000a6b0: 705f 736e 705f 746f 5f61 615f 6368 616e  p_snp_to_aa_chan
-0000a6c0: 6765 5f66 7271 5f64 7328 6473 293a 0a20  ge_frq_ds(ds):. 
-0000a6d0: 2020 2020 2020 2023 206b 6565 7020 6f6e         # keep on
-0000a6e0: 6c79 2076 6172 6961 626c 6573 2074 6861  ly variables tha
-0000a6f0: 7420 6d61 6b65 2073 656e 7365 2066 6f72  t make sense for
-0000a700: 2061 6d69 6e6f 2061 6369 6420 7375 6273   amino acid subs
-0000a710: 7469 7475 7469 6f6e 730a 2020 2020 2020  titutions.      
-0000a720: 2020 6b65 6570 5f76 6172 7320 3d20 5b0a    keep_vars = [.
-0000a730: 2020 2020 2020 2020 2020 2020 2276 6172              "var
-0000a740: 6961 6e74 5f63 6f6e 7469 6722 2c0a 2020  iant_contig",.  
-0000a750: 2020 2020 2020 2020 2020 2276 6172 6961            "varia
-0000a760: 6e74 5f70 6f73 6974 696f 6e22 2c0a 2020  nt_position",.  
-0000a770: 2020 2020 2020 2020 2020 2276 6172 6961            "varia
-0000a780: 6e74 5f74 7261 6e73 6372 6970 7422 2c0a  nt_transcript",.
-0000a790: 2020 2020 2020 2020 2020 2020 2276 6172              "var
-0000a7a0: 6961 6e74 5f65 6666 6563 7422 2c0a 2020  iant_effect",.  
-0000a7b0: 2020 2020 2020 2020 2020 2276 6172 6961            "varia
-0000a7c0: 6e74 5f69 6d70 6163 7422 2c0a 2020 2020  nt_impact",.    
-0000a7d0: 2020 2020 2020 2020 2276 6172 6961 6e74          "variant
-0000a7e0: 5f61 615f 706f 7322 2c0a 2020 2020 2020  _aa_pos",.      
-0000a7f0: 2020 2020 2020 2276 6172 6961 6e74 5f61        "variant_a
-0000a800: 615f 6368 616e 6765 222c 0a20 2020 2020  a_change",.     
-0000a810: 2020 2020 2020 2022 7661 7269 616e 745f         "variant_
-0000a820: 7265 665f 616c 6c65 6c65 222c 0a20 2020  ref_allele",.   
-0000a830: 2020 2020 2020 2020 2022 7661 7269 616e           "varian
-0000a840: 745f 7265 665f 6161 222c 0a20 2020 2020  t_ref_aa",.     
-0000a850: 2020 2020 2020 2022 7661 7269 616e 745f         "variant_
-0000a860: 616c 745f 6161 222c 0a20 2020 2020 2020  alt_aa",.       
-0000a870: 2020 2020 2022 6576 656e 745f 6e6f 6273       "event_nobs
-0000a880: 222c 0a20 2020 2020 2020 205d 0a0a 2020  ",.        ]..  
-0000a890: 2020 2020 2020 6966 2064 732e 6469 6d73        if ds.dims
-0000a8a0: 5b22 7661 7269 616e 7473 225d 203d 3d20  ["variants"] == 
-0000a8b0: 313a 0a20 2020 2020 2020 2020 2020 2023  1:.            #
-0000a8c0: 206b 6565 7020 6576 6572 7974 6869 6e67   keep everything
-0000a8d0: 2061 732d 6973 2c20 6e6f 206e 6565 6420   as-is, no need 
-0000a8e0: 666f 7220 6167 6772 6567 6174 696f 6e0a  for aggregation.
-0000a8f0: 2020 2020 2020 2020 2020 2020 6473 5f6f              ds_o
-0000a900: 7574 203d 2064 735b 6b65 6570 5f76 6172  ut = ds[keep_var
-0000a910: 7320 2b20 5b22 7661 7269 616e 745f 616c  s + ["variant_al
-0000a920: 745f 616c 6c65 6c65 222c 2022 6576 656e  t_allele", "even
-0000a930: 745f 636f 756e 7422 5d5d 0a0a 2020 2020  t_count"]]..    
-0000a940: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a950: 2020 2020 2020 2320 7461 6b65 2074 6865        # take the
-0000a960: 2066 6972 7374 2076 616c 7565 2066 726f   first value fro
-0000a970: 6d20 616c 6c20 7661 7269 616e 7473 2076  m all variants v
-0000a980: 6172 6961 626c 6573 0a20 2020 2020 2020  ariables.       
-0000a990: 2020 2020 2064 735f 6f75 7420 3d20 6473       ds_out = ds
-0000a9a0: 5b6b 6565 705f 7661 7273 5d2e 6973 656c  [keep_vars].isel
-0000a9b0: 2876 6172 6961 6e74 733d 5b30 5d29 0a0a  (variants=[0])..
-0000a9c0: 2020 2020 2020 2020 2020 2020 2320 7375              # su
-0000a9d0: 6d20 6576 656e 7420 636f 756e 7420 6f76  m event count ov
-0000a9e0: 6572 2076 6172 6961 6e74 730a 2020 2020  er variants.    
-0000a9f0: 2020 2020 2020 2020 636f 756e 7420 3d20          count = 
-0000aa00: 6473 5b22 6576 656e 745f 636f 756e 7422  ds["event_count"
-0000aa10: 5d2e 7661 6c75 6573 2e73 756d 2861 7869  ].values.sum(axi
-0000aa20: 733d 302c 206b 6565 7064 696d 733d 5472  s=0, keepdims=Tr
-0000aa30: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0000aa40: 6473 5f6f 7574 5b22 6576 656e 745f 636f  ds_out["event_co
-0000aa50: 756e 7422 5d20 3d20 2822 7661 7269 616e  unt"] = ("varian
-0000aa60: 7473 222c 2022 636f 686f 7274 7322 292c  ts", "cohorts"),
-0000aa70: 2063 6f75 6e74 0a0a 2020 2020 2020 2020   count..        
-0000aa80: 2020 2020 2320 636f 6c6c 6170 7365 2061      # collapse a
-0000aa90: 6c74 2061 6c6c 656c 650a 2020 2020 2020  lt allele.      
-0000aaa0: 2020 2020 2020 616c 745f 616c 6c65 6c65        alt_allele
-0000aab0: 203d 2022 7b22 202b 2022 2c22 2e6a 6f69   = "{" + ",".joi
-0000aac0: 6e28 6473 5b22 7661 7269 616e 745f 616c  n(ds["variant_al
-0000aad0: 745f 616c 6c65 6c65 225d 2e76 616c 7565  t_allele"].value
-0000aae0: 7329 202b 2022 7d22 0a20 2020 2020 2020  s) + "}".       
-0000aaf0: 2020 2020 2064 735f 6f75 745b 2276 6172       ds_out["var
-0000ab00: 6961 6e74 5f61 6c74 5f61 6c6c 656c 6522  iant_alt_allele"
-0000ab10: 5d20 3d20 2276 6172 6961 6e74 7322 2c20  ] = "variants", 
-0000ab20: 6e70 2e61 7272 6179 280a 2020 2020 2020  np.array(.      
-0000ab30: 2020 2020 2020 2020 2020 5b61 6c74 5f61            [alt_a
-0000ab40: 6c6c 656c 655d 2c20 6474 7970 653d 6f62  llele], dtype=ob
-0000ab50: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
-0000ab60: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-0000ab70: 726e 2064 735f 6f75 740a 0a20 2020 2040  rn ds_out..    @
-0000ab80: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-0000ab90: 2064 6566 205f 6164 645f 6672 6571 7565   def _add_freque
-0000aba0: 6e63 795f 6369 2864 732c 2063 695f 6d65  ncy_ci(ds, ci_me
-0000abb0: 7468 6f64 293a 0a20 2020 2020 2020 2066  thod):.        f
-0000abc0: 726f 6d20 7374 6174 736d 6f64 656c 732e  rom statsmodels.
-0000abd0: 7374 6174 732e 7072 6f70 6f72 7469 6f6e  stats.proportion
-0000abe0: 2069 6d70 6f72 7420 7072 6f70 6f72 7469   import proporti
-0000abf0: 6f6e 5f63 6f6e 6669 6e74 0a0a 2020 2020  on_confint..    
-0000ac00: 2020 2020 6966 2063 695f 6d65 7468 6f64      if ci_method
-0000ac10: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000ac20: 2020 2020 2020 2020 2020 636f 756e 7420            count 
-0000ac30: 3d20 6473 5b22 6576 656e 745f 636f 756e  = ds["event_coun
-0000ac40: 7422 5d2e 7661 6c75 6573 0a20 2020 2020  t"].values.     
-0000ac50: 2020 2020 2020 206e 6f62 7320 3d20 6473         nobs = ds
-0000ac60: 5b22 6576 656e 745f 6e6f 6273 225d 2e76  ["event_nobs"].v
-0000ac70: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
-0000ac80: 2020 7769 7468 206e 702e 6572 7273 7461    with np.errsta
-0000ac90: 7465 2864 6976 6964 653d 2269 676e 6f72  te(divide="ignor
-0000aca0: 6522 2c20 696e 7661 6c69 643d 2269 676e  e", invalid="ign
-0000acb0: 6f72 6522 293a 0a20 2020 2020 2020 2020  ore"):.         
-0000acc0: 2020 2020 2020 2066 7271 5f63 695f 6c6f         frq_ci_lo
-0000acd0: 772c 2066 7271 5f63 695f 7570 7020 3d20  w, frq_ci_upp = 
-0000ace0: 7072 6f70 6f72 7469 6f6e 5f63 6f6e 6669  proportion_confi
-0000acf0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0000ad00: 2020 2020 2020 2020 636f 756e 743d 636f          count=co
-0000ad10: 756e 742c 206e 6f62 733d 6e6f 6273 2c20  unt, nobs=nobs, 
-0000ad20: 6d65 7468 6f64 3d63 695f 6d65 7468 6f64  method=ci_method
-0000ad30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad40: 2029 0a20 2020 2020 2020 2020 2020 2064   ).            d
-0000ad50: 735b 2265 7665 6e74 5f66 7265 7175 656e  s["event_frequen
-0000ad60: 6379 5f63 695f 6c6f 7722 5d20 3d20 2822  cy_ci_low"] = ("
-0000ad70: 7661 7269 616e 7473 222c 2022 636f 686f  variants", "coho
-0000ad80: 7274 7322 292c 2066 7271 5f63 695f 6c6f  rts"), frq_ci_lo
-0000ad90: 770a 2020 2020 2020 2020 2020 2020 6473  w.            ds
-0000ada0: 5b22 6576 656e 745f 6672 6571 7565 6e63  ["event_frequenc
-0000adb0: 795f 6369 5f75 7070 225d 203d 2028 2276  y_ci_upp"] = ("v
-0000adc0: 6172 6961 6e74 7322 2c20 2263 6f68 6f72  ariants", "cohor
-0000add0: 7473 2229 2c20 6672 715f 6369 5f75 7070  ts"), frq_ci_upp
-0000ade0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-0000adf0: 686f 640a 2020 2020 6465 6620 5f62 7569  hod.    def _bui
-0000ae00: 6c64 5f63 6f68 6f72 7473 5f66 726f 6d5f  ld_cohorts_from_
-0000ae10: 7361 6d70 6c65 5f67 726f 7570 696e 6728  sample_grouping(
-0000ae20: 6772 6f75 705f 7361 6d70 6c65 735f 6279  group_samples_by
-0000ae30: 5f63 6f68 6f72 742c 206d 696e 5f63 6f68  _cohort, min_coh
-0000ae40: 6f72 745f 7369 7a65 293a 0a20 2020 2020  ort_size):.     
-0000ae50: 2020 2023 2062 7569 6c64 2063 6f68 6f72     # build cohor
-0000ae60: 7473 2064 6174 6166 7261 6d65 0a20 2020  ts dataframe.   
-0000ae70: 2020 2020 2064 665f 636f 686f 7274 7320       df_cohorts 
-0000ae80: 3d20 6772 6f75 705f 7361 6d70 6c65 735f  = group_samples_
-0000ae90: 6279 5f63 6f68 6f72 742e 6167 6728 0a20  by_cohort.agg(. 
-0000aea0: 2020 2020 2020 2020 2020 2073 697a 653d             size=
-0000aeb0: 2822 7361 6d70 6c65 5f69 6422 2c20 6c65  ("sample_id", le
-0000aec0: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
-0000aed0: 6c61 745f 6d65 616e 3d28 226c 6174 6974  lat_mean=("latit
-0000aee0: 7564 6522 2c20 226d 6561 6e22 292c 0a20  ude", "mean"),. 
-0000aef0: 2020 2020 2020 2020 2020 206c 6174 5f6d             lat_m
-0000af00: 6178 3d28 226c 6174 6974 7564 6522 2c20  ax=("latitude", 
-0000af10: 226d 6561 6e22 292c 0a20 2020 2020 2020  "mean"),.       
-0000af20: 2020 2020 206c 6174 5f6d 696e 3d28 226c       lat_min=("l
-0000af30: 6174 6974 7564 6522 2c20 226d 6561 6e22  atitude", "mean"
-0000af40: 292c 0a20 2020 2020 2020 2020 2020 206c  ),.            l
-0000af50: 6f6e 5f6d 6561 6e3d 2822 6c6f 6e67 6974  on_mean=("longit
-0000af60: 7564 6522 2c20 226d 6561 6e22 292c 0a20  ude", "mean"),. 
-0000af70: 2020 2020 2020 2020 2020 206c 6f6e 5f6d             lon_m
-0000af80: 6178 3d28 226c 6f6e 6769 7475 6465 222c  ax=("longitude",
-0000af90: 2022 6d65 616e 2229 2c0a 2020 2020 2020   "mean"),.      
-0000afa0: 2020 2020 2020 6c6f 6e5f 6d69 6e3d 2822        lon_min=("
-0000afb0: 6c6f 6e67 6974 7564 6522 2c20 226d 6561  longitude", "mea
-0000afc0: 6e22 292c 0a20 2020 2020 2020 2029 0a20  n"),.        ). 
-0000afd0: 2020 2020 2020 2023 2072 6573 6574 2069         # reset i
-0000afe0: 6e64 6578 2073 6f20 7468 6174 2074 6865  ndex so that the
-0000aff0: 2069 6e64 6578 2066 6965 6c64 7320 6172   index fields ar
-0000b000: 6520 696e 636c 7564 6564 2061 7320 636f  e included as co
-0000b010: 6c75 6d6e 730a 2020 2020 2020 2020 6466  lumns.        df
-0000b020: 5f63 6f68 6f72 7473 203d 2064 665f 636f  _cohorts = df_co
-0000b030: 686f 7274 732e 7265 7365 745f 696e 6465  horts.reset_inde
-0000b040: 7828 290a 0a20 2020 2020 2020 2023 2061  x()..        # a
-0000b050: 6464 2063 6f68 6f72 7420 6865 6c70 6572  dd cohort helper
-0000b060: 2076 6172 6961 626c 6573 0a20 2020 2020   variables.     
-0000b070: 2020 2063 6f68 6f72 745f 7065 7269 6f64     cohort_period
-0000b080: 5f73 7461 7274 203d 2064 665f 636f 686f  _start = df_coho
-0000b090: 7274 735b 2270 6572 696f 6422 5d2e 6170  rts["period"].ap
-0000b0a0: 706c 7928 6c61 6d62 6461 2076 3a20 762e  ply(lambda v: v.
-0000b0b0: 7374 6172 745f 7469 6d65 290a 2020 2020  start_time).    
-0000b0c0: 2020 2020 636f 686f 7274 5f70 6572 696f      cohort_perio
-0000b0d0: 645f 656e 6420 3d20 6466 5f63 6f68 6f72  d_end = df_cohor
-0000b0e0: 7473 5b22 7065 7269 6f64 225d 2e61 7070  ts["period"].app
-0000b0f0: 6c79 286c 616d 6264 6120 763a 2076 2e65  ly(lambda v: v.e
-0000b100: 6e64 5f74 696d 6529 0a20 2020 2020 2020  nd_time).       
-0000b110: 2064 665f 636f 686f 7274 735b 2270 6572   df_cohorts["per
-0000b120: 696f 645f 7374 6172 7422 5d20 3d20 636f  iod_start"] = co
-0000b130: 686f 7274 5f70 6572 696f 645f 7374 6172  hort_period_star
-0000b140: 740a 2020 2020 2020 2020 6466 5f63 6f68  t.        df_coh
-0000b150: 6f72 7473 5b22 7065 7269 6f64 5f65 6e64  orts["period_end
-0000b160: 225d 203d 2063 6f68 6f72 745f 7065 7269  "] = cohort_peri
-0000b170: 6f64 5f65 6e64 0a20 2020 2020 2020 2023  od_end.        #
-0000b180: 2063 7265 6174 6520 6120 6c61 6265 6c20   create a label 
-0000b190: 7468 6174 2069 7320 7369 6d69 6c61 7220  that is similar 
-0000b1a0: 746f 2074 6865 2063 6f68 6f72 7420 6d65  to the cohort me
-0000b1b0: 7461 6461 7461 2c0a 2020 2020 2020 2020  tadata,.        
-0000b1c0: 2320 616c 7468 6f75 6768 2074 6869 7320  # although this 
-0000b1d0: 776f 6e27 7420 6265 2070 6572 6665 6374  won't be perfect
-0000b1e0: 0a20 2020 2020 2020 2064 665f 636f 686f  .        df_coho
-0000b1f0: 7274 735b 226c 6162 656c 225d 203d 2064  rts["label"] = d
-0000b200: 665f 636f 686f 7274 732e 6170 706c 7928  f_cohorts.apply(
-0000b210: 0a20 2020 2020 2020 2020 2020 206c 616d  .            lam
-0000b220: 6264 6120 763a 2066 227b 762e 6172 6561  bda v: f"{v.area
-0000b230: 7d5f 7b76 2e74 6178 6f6e 5b3a 345d 7d5f  }_{v.taxon[:4]}_
-0000b240: 7b76 2e70 6572 696f 647d 222c 2061 7869  {v.period}", axi
-0000b250: 733d 2263 6f6c 756d 6e73 220a 2020 2020  s="columns".    
-0000b260: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0000b270: 2061 7070 6c79 206d 696e 696d 756d 2063   apply minimum c
-0000b280: 6f68 6f72 7420 7369 7a65 0a20 2020 2020  ohort size.     
-0000b290: 2020 2064 665f 636f 686f 7274 7320 3d20     df_cohorts = 
-0000b2a0: 6466 5f63 6f68 6f72 7473 2e71 7565 7279  df_cohorts.query
-0000b2b0: 2866 2273 697a 6520 3e3d 207b 6d69 6e5f  (f"size >= {min_
-0000b2c0: 636f 686f 7274 5f73 697a 657d 2229 2e72  cohort_size}").r
-0000b2d0: 6573 6574 5f69 6e64 6578 280a 2020 2020  eset_index(.    
-0000b2e0: 2020 2020 2020 2020 6472 6f70 3d54 7275          drop=Tru
-0000b2f0: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-0000b300: 2020 2020 2072 6574 7572 6e20 6466 5f63       return df_c
-0000b310: 6f68 6f72 7473 0a0a 2020 2020 4073 7461  ohorts..    @sta
-0000b320: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-0000b330: 6620 5f63 6865 636b 5f70 6172 616d 5f6d  f _check_param_m
-0000b340: 696e 5f63 6f68 6f72 745f 7369 7a65 286d  in_cohort_size(m
-0000b350: 696e 5f63 6f68 6f72 745f 7369 7a65 293a  in_cohort_size):
-0000b360: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000b370: 6973 696e 7374 616e 6365 286d 696e 5f63  isinstance(min_c
-0000b380: 6f68 6f72 745f 7369 7a65 2c20 696e 7429  ohort_size, int)
-0000b390: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000b3a0: 6973 6520 5479 7065 4572 726f 7228 0a20  ise TypeError(. 
-0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b3c0: 2254 7970 6520 6f66 2070 6172 616d 6574  "Type of paramet
-0000b3d0: 6572 206d 696e 5f63 6f68 6f72 745f 7369  er min_cohort_si
-0000b3e0: 7a65 206d 7573 7420 6265 2069 6e74 3b20  ze must be int; 
-0000b3f0: 666f 756e 6420 7b74 7970 6528 6d69 6e5f  found {type(min_
-0000b400: 636f 686f 7274 5f73 697a 6529 7d2e 220a  cohort_size)}.".
-0000b410: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000b420: 2020 2020 2020 6966 206d 696e 5f63 6f68        if min_coh
-0000b430: 6f72 745f 7369 7a65 203c 2031 3a0a 2020  ort_size < 1:.  
-0000b440: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000b450: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0000b460: 2020 2020 2020 2020 2020 2020 6622 5661              f"Va
-0000b470: 6c75 6520 6f66 2070 6172 616d 6574 6572  lue of parameter
-0000b480: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
-0000b490: 206d 7573 7420 6265 2061 7420 6c65 6173   must be at leas
-0000b4a0: 7420 313b 2066 6f75 6e64 207b 6d69 6e5f  t 1; found {min_
-0000b4b0: 636f 686f 7274 5f73 697a 657d 2e22 0a20  cohort_size}.". 
-0000b4c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000b4d0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0000b4e0: 2020 2020 6465 6620 5f70 616e 6461 735f      def _pandas_
-0000b4f0: 6170 706c 7928 662c 2064 662c 2063 6f6c  apply(f, df, col
-0000b500: 756d 6e73 293a 0a20 2020 2020 2020 2022  umns):.        "
-0000b510: 2222 4f70 7469 6d69 7365 6420 616c 7465  ""Optimised alte
-0000b520: 726e 6174 6976 6520 746f 2070 616e 6461  rnative to panda
-0000b530: 7320 6170 706c 792e 2222 220a 2020 2020  s apply.""".    
-0000b540: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
-0000b550: 745f 696e 6465 7828 6472 6f70 3d54 7275  t_index(drop=Tru
-0000b560: 6529 0a20 2020 2020 2020 2069 7465 7261  e).        itera
-0000b570: 746f 7220 3d20 7a69 7028 2a5b 6466 5b63  tor = zip(*[df[c
-0000b580: 5d2e 7661 6c75 6573 2066 6f72 2063 2069  ].values for c i
-0000b590: 6e20 636f 6c75 6d6e 735d 290a 2020 2020  n columns]).    
-0000b5a0: 2020 2020 7265 7420 3d20 7064 2e53 6572      ret = pd.Ser
-0000b5b0: 6965 7328 2866 282a 7661 6c73 2920 666f  ies((f(*vals) fo
-0000b5c0: 7220 7661 6c73 2069 6e20 6974 6572 6174  r vals in iterat
-0000b5d0: 6f72 2929 0a20 2020 2020 2020 2072 6574  or)).        ret
-0000b5e0: 7572 6e20 7265 740a 0a20 2020 2040 7374  urn ret..    @st
-0000b5f0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-0000b600: 6566 205f 726f 685f 686d 6d5f 7072 6564  ef _roh_hmm_pred
-0000b610: 6963 7428 0a20 2020 2020 2020 202a 2c0a  ict(.        *,.
-0000b620: 2020 2020 2020 2020 7769 6e64 6f77 732c          windows,
-0000b630: 0a20 2020 2020 2020 2063 6f75 6e74 732c  .        counts,
-0000b640: 0a20 2020 2020 2020 2070 6865 745f 726f  .        phet_ro
-0000b650: 682c 0a20 2020 2020 2020 2070 6865 745f  h,.        phet_
-0000b660: 6e6f 6e72 6f68 2c0a 2020 2020 2020 2020  nonroh,.        
-0000b670: 7472 616e 7369 7469 6f6e 2c0a 2020 2020  transition,.    
-0000b680: 2020 2020 7769 6e64 6f77 5f73 697a 652c      window_size,
-0000b690: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-0000b6a0: 6964 2c0a 2020 2020 2020 2020 636f 6e74  id,.        cont
-0000b6b0: 6967 2c0a 2020 2020 293a 0a20 2020 2020  ig,.    ):.     
-0000b6c0: 2020 2023 2063 6f6e 6469 7469 6f6e 616c     # conditional
-0000b6d0: 2069 6d70 6f72 742c 2070 6f6d 6567 7261   import, pomegra
-0000b6e0: 6e61 7465 2074 616b 6573 2061 206c 6f6e  nate takes a lon
-0000b6f0: 6720 7469 6d65 2074 6f20 696e 7374 616c  g time to instal
-0000b700: 6c20 6f6e 0a20 2020 2020 2020 2023 206c  l on.        # l
-0000b710: 696e 7578 2064 7565 2074 6f20 6c61 636b  inux due to lack
-0000b720: 206f 6620 7072 6562 7569 6c74 2077 6865   of prebuilt whe
-0000b730: 656c 7320 6f6e 2050 7950 490a 2020 2020  els on PyPI.    
-0000b740: 2020 2020 6672 6f6d 2061 6c6c 656c 2e73      from allel.s
-0000b750: 7461 7473 2e6d 6973 6320 696d 706f 7274  tats.misc import
-0000b760: 2074 6162 756c 6174 655f 7374 6174 655f   tabulate_state_
-0000b770: 626c 6f63 6b73 0a0a 2020 2020 2020 2020  blocks..        
-0000b780: 2320 7468 6973 2069 6d70 6c65 6d65 6e74  # this implement
-0000b790: 6174 696f 6e20 6973 2062 6173 6564 206f  ation is based o
-0000b7a0: 6e20 7363 696b 6974 2d61 6c6c 656c 2c20  n scikit-allel, 
-0000b7b0: 6275 7420 6d6f 6469 6669 6564 2074 6f20  but modified to 
-0000b7c0: 7573 650a 2020 2020 2020 2020 2320 6d6f  use.        # mo
-0000b7d0: 7669 6e67 2077 696e 646f 7720 636f 6d70  ving window comp
-0000b7e0: 7574 6174 696f 6e20 6f66 2068 6574 2063  utation of het c
-0000b7f0: 6f75 6e74 730a 2020 2020 2020 2020 6672  ounts.        fr
-0000b800: 6f6d 2061 6c6c 656c 2e73 7461 7473 2e72  om allel.stats.r
-0000b810: 6f68 2069 6d70 6f72 7420 5f68 6d6d 5f64  oh import _hmm_d
-0000b820: 6572 6976 655f 7472 616e 7369 7469 6f6e  erive_transition
-0000b830: 5f6d 6174 7269 780a 0a20 2020 2020 2020  _matrix..       
-0000b840: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
-0000b850: 5079 556e 7265 736f 6c76 6564 5265 6665  PyUnresolvedRefe
-0000b860: 7265 6e63 6573 0a20 2020 2020 2020 2066  rences.        f
-0000b870: 726f 6d20 706f 6d65 6772 616e 6174 6520  rom pomegranate 
-0000b880: 696d 706f 7274 2028 2020 2320 7079 7269  import (  # pyri
-0000b890: 6768 743a 2069 676e 6f72 650a 2020 2020  ght: ignore.    
-0000b8a0: 2020 2020 2020 2020 4869 6464 656e 4d61          HiddenMa
-0000b8b0: 726b 6f76 4d6f 6465 6c2c 0a20 2020 2020  rkovModel,.     
-0000b8c0: 2020 2020 2020 2050 6f69 7373 6f6e 4469         PoissonDi
-0000b8d0: 7374 7269 6275 7469 6f6e 2c0a 2020 2020  stribution,.    
-0000b8e0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0000b8f0: 2068 6574 2070 726f 6261 6269 6c69 7469   het probabiliti
-0000b900: 6573 0a20 2020 2020 2020 2068 6574 5f70  es.        het_p
-0000b910: 7820 3d20 6e70 2e63 6f6e 6361 7465 6e61  x = np.concatena
-0000b920: 7465 285b 2870 6865 745f 726f 682c 292c  te([(phet_roh,),
-0000b930: 2070 6865 745f 6e6f 6e72 6f68 5d29 0a0a   phet_nonroh])..
-0000b940: 2020 2020 2020 2020 2320 7374 6172 7420          # start 
-0000b950: 7072 6f62 6162 696c 6974 6965 7320 2861  probabilities (a
-0000b960: 6c6c 2065 7175 616c 290a 2020 2020 2020  ll equal).      
-0000b970: 2020 7374 6172 745f 7072 6f62 203d 206e    start_prob = n
-0000b980: 702e 7265 7065 6174 2831 202f 2068 6574  p.repeat(1 / het
-0000b990: 5f70 782e 7369 7a65 2c20 6865 745f 7078  _px.size, het_px
-0000b9a0: 2e73 697a 6529 0a0a 2020 2020 2020 2020  .size)..        
-0000b9b0: 2320 7472 616e 7369 7469 6f6e 2062 6574  # transition bet
-0000b9c0: 7765 656e 2075 6e64 6572 6c79 696e 6720  ween underlying 
-0000b9d0: 7374 6174 6573 0a20 2020 2020 2020 2074  states.        t
-0000b9e0: 7261 6e73 6974 696f 6e5f 6d78 203d 205f  ransition_mx = _
-0000b9f0: 686d 6d5f 6465 7269 7665 5f74 7261 6e73  hmm_derive_trans
-0000ba00: 6974 696f 6e5f 6d61 7472 6978 2874 7261  ition_matrix(tra
-0000ba10: 6e73 6974 696f 6e2c 2068 6574 5f70 782e  nsition, het_px.
-0000ba20: 7369 7a65 290a 0a20 2020 2020 2020 2023  size)..        #
-0000ba30: 2065 6d69 7373 696f 6e20 7072 6f62 6162   emission probab
-0000ba40: 696c 6974 7920 6469 7374 7269 6275 7469  ility distributi
-0000ba50: 6f6e 0a20 2020 2020 2020 2064 6973 7473  on.        dists
-0000ba60: 203d 205b 506f 6973 736f 6e44 6973 7472   = [PoissonDistr
-0000ba70: 6962 7574 696f 6e28 7820 2a20 7769 6e64  ibution(x * wind
-0000ba80: 6f77 5f73 697a 6529 2066 6f72 2078 2069  ow_size) for x i
-0000ba90: 6e20 6865 745f 7078 5d0a 0a20 2020 2020  n het_px]..     
-0000baa0: 2020 2023 2073 6574 2075 7020 6d6f 6465     # set up mode
-0000bab0: 6c0a 2020 2020 2020 2020 2320 6e6f 696e  l.        # noin
-0000bac0: 7370 6563 7469 6f6e 2050 7941 7267 756d  spection PyArgum
-0000bad0: 656e 744c 6973 740a 2020 2020 2020 2020  entList.        
-0000bae0: 6d6f 6465 6c20 3d20 4869 6464 656e 4d61  model = HiddenMa
-0000baf0: 726b 6f76 4d6f 6465 6c2e 6672 6f6d 5f6d  rkovModel.from_m
-0000bb00: 6174 7269 7828 0a20 2020 2020 2020 2020  atrix(.         
-0000bb10: 2020 2074 7261 6e73 6974 696f 6e5f 7072     transition_pr
-0000bb20: 6f62 6162 696c 6974 6965 733d 7472 616e  obabilities=tran
-0000bb30: 7369 7469 6f6e 5f6d 782c 0a20 2020 2020  sition_mx,.     
-0000bb40: 2020 2020 2020 2064 6973 7472 6962 7574         distribut
-0000bb50: 696f 6e73 3d64 6973 7473 2c0a 2020 2020  ions=dists,.    
-0000bb60: 2020 2020 2020 2020 7374 6172 7473 3d73          starts=s
-0000bb70: 7461 7274 5f70 726f 622c 0a20 2020 2020  tart_prob,.     
-0000bb80: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-0000bb90: 7072 6564 6963 7420 6869 6464 656e 2073  predict hidden s
-0000bba0: 7461 7465 730a 2020 2020 2020 2020 7072  tates.        pr
-0000bbb0: 6564 6963 7469 6f6e 203d 206e 702e 6172  ediction = np.ar
-0000bbc0: 7261 7928 6d6f 6465 6c2e 7072 6564 6963  ray(model.predic
-0000bbd0: 7428 636f 756e 7473 5b3a 2c20 4e6f 6e65  t(counts[:, None
-0000bbe0: 5d29 290a 0a20 2020 2020 2020 2023 2074  ]))..        # t
-0000bbf0: 6162 756c 6174 6520 7275 6e73 206f 6620  abulate runs of 
-0000bc00: 686f 6d6f 7a79 676f 7369 7479 2028 7374  homozygosity (st
-0000bc10: 6174 6520 3029 0a20 2020 2020 2020 2023  ate 0).        #
-0000bc20: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
-0000bc30: 5479 7065 4368 6563 6b65 720a 2020 2020  TypeChecker.    
-0000bc40: 2020 2020 6466 5f62 6c6f 636b 7320 3d20      df_blocks = 
-0000bc50: 7461 6275 6c61 7465 5f73 7461 7465 5f62  tabulate_state_b
-0000bc60: 6c6f 636b 7328 7072 6564 6963 7469 6f6e  locks(prediction
-0000bc70: 2c20 7374 6174 6573 3d6c 6973 7428 7261  , states=list(ra
-0000bc80: 6e67 6528 6c65 6e28 6865 745f 7078 2929  nge(len(het_px))
-0000bc90: 2929 0a20 2020 2020 2020 2064 665f 726f  )).        df_ro
-0000bca0: 6820 3d20 6466 5f62 6c6f 636b 735b 2864  h = df_blocks[(d
-0000bcb0: 665f 626c 6f63 6b73 5b22 7374 6174 6522  f_blocks["state"
-0000bcc0: 5d20 3d3d 2030 295d 2e72 6573 6574 5f69  ] == 0)].reset_i
-0000bcd0: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
-0000bce0: 0a20 2020 2020 2020 2023 2061 6461 7074  .        # adapt
-0000bcf0: 2074 6865 2064 6174 6166 7261 6d65 2066   the dataframe f
-0000bd00: 6f72 2052 4f48 0a20 2020 2020 2020 2064  or ROH.        d
-0000bd10: 665f 726f 685b 2273 616d 706c 655f 6964  f_roh["sample_id
-0000bd20: 225d 203d 2073 616d 706c 655f 6964 0a20  "] = sample_id. 
-0000bd30: 2020 2020 2020 2064 665f 726f 685b 2263         df_roh["c
-0000bd40: 6f6e 7469 6722 5d20 3d20 636f 6e74 6967  ontig"] = contig
-0000bd50: 0a20 2020 2020 2020 2064 665f 726f 685b  .        df_roh[
-0000bd60: 2272 6f68 5f73 7461 7274 225d 203d 2064  "roh_start"] = d
-0000bd70: 665f 726f 685b 2273 7461 7274 5f72 6964  f_roh["start_rid
-0000bd80: 7822 5d2e 6170 706c 7928 6c61 6d62 6461  x"].apply(lambda
-0000bd90: 2079 3a20 7769 6e64 6f77 735b 792c 2030   y: windows[y, 0
-0000bda0: 5d29 0a20 2020 2020 2020 2064 665f 726f  ]).        df_ro
-0000bdb0: 685b 2272 6f68 5f73 746f 7022 5d20 3d20  h["roh_stop"] = 
-0000bdc0: 6466 5f72 6f68 5b22 7374 6f70 5f6c 6964  df_roh["stop_lid
-0000bdd0: 7822 5d2e 6170 706c 7928 6c61 6d62 6461  x"].apply(lambda
-0000bde0: 2079 3a20 7769 6e64 6f77 735b 792c 2031   y: windows[y, 1
-0000bdf0: 5d29 0a20 2020 2020 2020 2064 665f 726f  ]).        df_ro
-0000be00: 685b 2272 6f68 5f6c 656e 6774 6822 5d20  h["roh_length"] 
-0000be10: 3d20 6466 5f72 6f68 5b22 726f 685f 7374  = df_roh["roh_st
-0000be20: 6f70 225d 202d 2064 665f 726f 685b 2272  op"] - df_roh["r
-0000be30: 6f68 5f73 7461 7274 225d 0a20 2020 2020  oh_start"].     
-0000be40: 2020 2064 665f 726f 682e 7265 6e61 6d65     df_roh.rename
-0000be50: 2863 6f6c 756d 6e73 3d7b 2269 735f 6d61  (columns={"is_ma
-0000be60: 7267 696e 616c 223a 2022 726f 685f 6973  rginal": "roh_is
-0000be70: 5f6d 6172 6769 6e61 6c22 7d2c 2069 6e70  _marginal"}, inp
-0000be80: 6c61 6365 3d54 7275 6529 0a0a 2020 2020  lace=True)..    
-0000be90: 2020 2020 7265 7475 726e 2064 665f 726f      return df_ro
-0000bea0: 685b 0a20 2020 2020 2020 2020 2020 205b  h[.            [
-0000beb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bec0: 2022 7361 6d70 6c65 5f69 6422 2c0a 2020   "sample_id",.  
-0000bed0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-0000bee0: 6f6e 7469 6722 2c0a 2020 2020 2020 2020  ontig",.        
-0000bef0: 2020 2020 2020 2020 2272 6f68 5f73 7461          "roh_sta
-0000bf00: 7274 222c 0a20 2020 2020 2020 2020 2020  rt",.           
-0000bf10: 2020 2020 2022 726f 685f 7374 6f70 222c       "roh_stop",
-0000bf20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf30: 2022 726f 685f 6c65 6e67 7468 222c 0a20   "roh_length",. 
-0000bf40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000bf50: 726f 685f 6973 5f6d 6172 6769 6e61 6c22  roh_is_marginal"
-0000bf60: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
-0000bf70: 2020 2020 2020 2020 5d0a 0a20 2020 2023          ]..    #
-0000bf80: 2053 7461 7274 206f 6620 756e 6465 636f   Start of undeco
-0000bf90: 7261 7465 6420 6675 6e63 7469 6f6e 730a  rated functions.
-0000bfa0: 0a20 2020 2040 646f 6328 0a20 2020 2020  .    @doc(.     
-0000bfb0: 2020 2073 756d 6d61 7279 3d22 4f70 656e     summary="Open
-0000bfc0: 2073 6974 6520 6669 6c74 6572 7320 7a61   site filters za
-0000bfd0: 7272 2e22 2c0a 2020 2020 2020 2020 7265  rr.",.        re
-0000bfe0: 7475 726e 733d 225a 6172 7220 6869 6572  turns="Zarr hier
-0000bff0: 6172 6368 792e 222c 0a20 2020 2029 0a20  archy.",.    ). 
-0000c000: 2020 2064 6566 206f 7065 6e5f 7369 7465     def open_site
-0000c010: 5f66 696c 7465 7273 2873 656c 662c 206d  _filters(self, m
-0000c020: 6173 6b3a 2062 6173 655f 7061 7261 6d73  ask: base_params
-0000c030: 2e73 6974 655f 6d61 736b 2920 2d3e 207a  .site_mask) -> z
-0000c040: 6172 722e 6869 6572 6172 6368 792e 4772  arr.hierarchy.Gr
-0000c050: 6f75 703a 0a20 2020 2020 2020 2074 7279  oup:.        try
-0000c060: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000c070: 7475 726e 2073 656c 662e 5f63 6163 6865  turn self._cache
-0000c080: 5f73 6974 655f 6669 6c74 6572 735b 6d61  _site_filters[ma
-0000c090: 736b 5d0a 2020 2020 2020 2020 6578 6365  sk].        exce
-0000c0a0: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
-0000c0b0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-0000c0c0: 6622 7b73 656c 662e 5f62 6173 655f 7061  f"{self._base_pa
-0000c0d0: 7468 7d2f 7b73 656c 662e 5f6d 616a 6f72  th}/{self._major
-0000c0e0: 5f76 6572 7369 6f6e 5f70 6174 687d 2f73  _version_path}/s
-0000c0f0: 6974 655f 6669 6c74 6572 732f 7b73 656c  ite_filters/{sel
-0000c100: 662e 5f73 6974 655f 6669 6c74 6572 735f  f._site_filters_
-0000c110: 616e 616c 7973 6973 7d2f 7b6d 6173 6b7d  analysis}/{mask}
-0000c120: 2f22 0a20 2020 2020 2020 2020 2020 2073  /".            s
-0000c130: 746f 7265 203d 2069 6e69 745f 7a61 7272  tore = init_zarr
-0000c140: 5f73 746f 7265 2866 733d 7365 6c66 2e5f  _store(fs=self._
-0000c150: 6673 2c20 7061 7468 3d70 6174 6829 0a20  fs, path=path). 
-0000c160: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
-0000c170: 3d20 7a61 7272 2e6f 7065 6e5f 636f 6e73  = zarr.open_cons
-0000c180: 6f6c 6964 6174 6564 2873 746f 7265 3d73  olidated(store=s
-0000c190: 746f 7265 290a 2020 2020 2020 2020 2020  tore).          
-0000c1a0: 2020 7365 6c66 2e5f 6361 6368 655f 7369    self._cache_si
-0000c1b0: 7465 5f66 696c 7465 7273 5b6d 6173 6b5d  te_filters[mask]
-0000c1c0: 203d 2072 6f6f 740a 2020 2020 2020 2020   = root.        
-0000c1d0: 2020 2020 7265 7475 726e 2072 6f6f 740a      return root.
-0000c1e0: 0a20 2020 2040 646f 6328 0a20 2020 2020  .    @doc(.     
-0000c1f0: 2020 2073 756d 6d61 7279 3d22 4f70 656e     summary="Open
-0000c200: 2053 4e50 2073 6974 6573 207a 6172 7222   SNP sites zarr"
-0000c210: 2c0a 2020 2020 2020 2020 7265 7475 726e  ,.        return
-0000c220: 733d 225a 6172 7220 6869 6572 6172 6368  s="Zarr hierarch
-0000c230: 792e 222c 0a20 2020 2029 0a20 2020 2064  y.",.    ).    d
-0000c240: 6566 206f 7065 6e5f 736e 705f 7369 7465  ef open_snp_site
-0000c250: 7328 7365 6c66 2920 2d3e 207a 6172 722e  s(self) -> zarr.
-0000c260: 6869 6572 6172 6368 792e 4772 6f75 703a  hierarchy.Group:
-0000c270: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000c280: 2e5f 6361 6368 655f 736e 705f 7369 7465  ._cache_snp_site
-0000c290: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0000c2a0: 2020 2020 2020 2070 6174 6820 3d20 280a         path = (.
-0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2c0: 6622 7b73 656c 662e 5f62 6173 655f 7061  f"{self._base_pa
-0000c2d0: 7468 7d2f 7b73 656c 662e 5f6d 616a 6f72  th}/{self._major
-0000c2e0: 5f76 6572 7369 6f6e 5f70 6174 687d 2f73  _version_path}/s
-0000c2f0: 6e70 5f67 656e 6f74 7970 6573 2f61 6c6c  np_genotypes/all
-0000c300: 2f73 6974 6573 2f22 0a20 2020 2020 2020  /sites/".       
-0000c310: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000c320: 2020 2073 746f 7265 203d 2069 6e69 745f     store = init_
-0000c330: 7a61 7272 5f73 746f 7265 2866 733d 7365  zarr_store(fs=se
-0000c340: 6c66 2e5f 6673 2c20 7061 7468 3d70 6174  lf._fs, path=pat
-0000c350: 6829 0a20 2020 2020 2020 2020 2020 2072  h).            r
-0000c360: 6f6f 7420 3d20 7a61 7272 2e6f 7065 6e5f  oot = zarr.open_
-0000c370: 636f 6e73 6f6c 6964 6174 6564 2873 746f  consolidated(sto
-0000c380: 7265 3d73 746f 7265 290a 2020 2020 2020  re=store).      
-0000c390: 2020 2020 2020 7365 6c66 2e5f 6361 6368        self._cach
-0000c3a0: 655f 736e 705f 7369 7465 7320 3d20 726f  e_snp_sites = ro
-0000c3b0: 6f74 0a20 2020 2020 2020 2072 6574 7572  ot.        retur
-0000c3c0: 6e20 7365 6c66 2e5f 6361 6368 655f 736e  n self._cache_sn
-0000c3d0: 705f 7369 7465 730a 0a20 2020 2064 6566  p_sites..    def
-0000c3e0: 205f 7072 6f67 7265 7373 2873 656c 662c   _progress(self,
-0000c3f0: 2069 7465 7261 626c 652c 202a 2a6b 7761   iterable, **kwa
-0000c400: 7267 7329 3a0a 2020 2020 2020 2020 2320  rgs):.        # 
-0000c410: 7072 6f67 7265 7373 2064 6f65 736e 2774  progress doesn't
-0000c420: 206d 6978 2077 656c 6c20 7769 7468 2064   mix well with d
-0000c430: 6562 7567 206c 6f67 6769 6e67 0a20 2020  ebug logging.   
-0000c440: 2020 2020 2064 6973 6162 6c65 203d 2073       disable = s
-0000c450: 656c 662e 5f64 6562 7567 206f 7220 6e6f  elf._debug or no
-0000c460: 7420 7365 6c66 2e5f 7368 6f77 5f70 726f  t self._show_pro
-0000c470: 6772 6573 730a 2020 2020 2020 2020 7265  gress.        re
-0000c480: 7475 726e 2074 7164 6d28 6974 6572 6162  turn tqdm(iterab
-0000c490: 6c65 2c20 6469 7361 626c 653d 6469 7361  le, disable=disa
-0000c4a0: 626c 652c 202a 2a6b 7761 7267 7329 0a0a  ble, **kwargs)..
-0000c4b0: 2020 2020 6465 6620 5f72 6561 645f 6765      def _read_ge
-0000c4c0: 6e65 7261 6c5f 6d65 7461 6461 7461 2873  neral_metadata(s
-0000c4d0: 656c 662c 202a 2c20 7361 6d70 6c65 5f73  elf, *, sample_s
-0000c4e0: 6574 293a 0a20 2020 2020 2020 2022 2222  et):.        """
-0000c4f0: 5265 6164 206d 6574 6164 6174 6120 666f  Read metadata fo
-0000c500: 7220 6120 7369 6e67 6c65 2073 616d 706c  r a single sampl
-0000c510: 6520 7365 742e 2222 220a 2020 2020 2020  e set.""".      
-0000c520: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000c530: 2020 2064 6620 3d20 7365 6c66 2e5f 6361     df = self._ca
-0000c540: 6368 655f 6765 6e65 7261 6c5f 6d65 7461  che_general_meta
-0000c550: 6461 7461 5b73 616d 706c 655f 7365 745d  data[sample_set]
-0000c560: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000c570: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
-0000c580: 2020 2020 2020 7265 6c65 6173 6520 3d20        release = 
-0000c590: 7365 6c66 2e6c 6f6f 6b75 705f 7265 6c65  self.lookup_rele
-0000c5a0: 6173 6528 7361 6d70 6c65 5f73 6574 3d73  ase(sample_set=s
-0000c5b0: 616d 706c 655f 7365 7429 0a20 2020 2020  ample_set).     
-0000c5c0: 2020 2020 2020 2072 656c 6561 7365 5f70         release_p
-0000c5d0: 6174 6820 3d20 7365 6c66 2e5f 7265 6c65  ath = self._rele
-0000c5e0: 6173 655f 746f 5f70 6174 6828 7265 6c65  ase_to_path(rele
-0000c5f0: 6173 6529 0a20 2020 2020 2020 2020 2020  ase).           
-0000c600: 2070 6174 6820 3d20 6622 7b73 656c 662e   path = f"{self.
-0000c610: 5f62 6173 655f 7061 7468 7d2f 7b72 656c  _base_path}/{rel
-0000c620: 6561 7365 5f70 6174 687d 2f6d 6574 6164  ease_path}/metad
-0000c630: 6174 612f 6765 6e65 7261 6c2f 7b73 616d  ata/general/{sam
-0000c640: 706c 655f 7365 747d 2f73 616d 706c 6573  ple_set}/samples
-0000c650: 2e6d 6574 612e 6373 7622 0a20 2020 2020  .meta.csv".     
-0000c660: 2020 2020 2020 2064 7479 7065 203d 207b         dtype = {
-0000c670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c680: 2022 7361 6d70 6c65 5f69 6422 3a20 6f62   "sample_id": ob
-0000c690: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
-0000c6a0: 2020 2020 2020 2270 6172 746e 6572 5f73        "partner_s
-0000c6b0: 616d 706c 655f 6964 223a 206f 626a 6563  ample_id": objec
-0000c6c0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0000c6d0: 2020 2022 636f 6e74 7269 6275 746f 7222     "contributor"
-0000c6e0: 3a20 6f62 6a65 6374 2c0a 2020 2020 2020  : object,.      
-0000c6f0: 2020 2020 2020 2020 2020 2263 6f75 6e74            "count
-0000c700: 7279 223a 206f 626a 6563 742c 0a20 2020  ry": object,.   
-0000c710: 2020 2020 2020 2020 2020 2020 2022 6c6f               "lo
-0000c720: 6361 7469 6f6e 223a 206f 626a 6563 742c  cation": object,
-0000c730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c740: 2022 7965 6172 223a 2022 696e 7436 3422   "year": "int64"
-0000c750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c760: 2020 226d 6f6e 7468 223a 2022 696e 7436    "month": "int6
-0000c770: 3422 2c0a 2020 2020 2020 2020 2020 2020  4",.            
-0000c780: 2020 2020 226c 6174 6974 7564 6522 3a20      "latitude": 
-0000c790: 2266 6c6f 6174 3634 222c 0a20 2020 2020  "float64",.     
-0000c7a0: 2020 2020 2020 2020 2020 2022 6c6f 6e67             "long
-0000c7b0: 6974 7564 6522 3a20 2266 6c6f 6174 3634  itude": "float64
-0000c7c0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000c7d0: 2020 2022 7365 785f 6361 6c6c 223a 206f     "sex_call": o
-0000c7e0: 626a 6563 742c 0a20 2020 2020 2020 2020  bject,.         
-0000c7f0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0000c800: 2077 6974 6820 7365 6c66 2e5f 6673 2e6f   with self._fs.o
-0000c810: 7065 6e28 7061 7468 2920 6173 2066 3a0a  pen(path) as f:.
-0000c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c830: 6466 203d 2070 642e 7265 6164 5f63 7376  df = pd.read_csv
-0000c840: 2866 2c20 6e61 5f76 616c 7565 733d 2222  (f, na_values=""
-0000c850: 2c20 6474 7970 653d 6474 7970 6529 0a0a  , dtype=dtype)..
-0000c860: 2020 2020 2020 2020 2020 2020 2320 656e              # en
-0000c870: 7375 7265 2061 6c6c 2063 6f6c 756d 6e20  sure all column 
-0000c880: 6e61 6d65 7320 6172 6520 6c6f 7765 7220  names are lower 
-0000c890: 6361 7365 0a20 2020 2020 2020 2020 2020  case.           
-0000c8a0: 2064 662e 636f 6c75 6d6e 7320 3d20 5b63   df.columns = [c
-0000c8b0: 2e6c 6f77 6572 2829 2066 6f72 2063 2069  .lower() for c i
-0000c8c0: 6e20 6466 2e63 6f6c 756d 6e73 5d0a 0a20  n df.columns].. 
-0000c8d0: 2020 2020 2020 2020 2020 2023 2061 6464             # add
-0000c8e0: 2061 2063 6f75 706c 6520 6f66 2063 6f6c   a couple of col
-0000c8f0: 756d 6e73 2066 6f72 2063 6f6e 7665 6e69  umns for conveni
-0000c900: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
-0000c910: 2064 665b 2273 616d 706c 655f 7365 7422   df["sample_set"
-0000c920: 5d20 3d20 7361 6d70 6c65 5f73 6574 0a20  ] = sample_set. 
-0000c930: 2020 2020 2020 2020 2020 2064 665b 2272             df["r
-0000c940: 656c 6561 7365 225d 203d 2072 656c 6561  elease"] = relea
-0000c950: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-0000c960: 2320 6465 7269 7665 2071 7561 7274 6572  # derive quarter
-0000c970: 2066 726f 6d20 6d6f 6e74 680a 2020 2020   from month.    
-0000c980: 2020 2020 2020 2020 6466 5b22 7175 6172          df["quar
-0000c990: 7465 7222 5d20 3d20 6466 2e61 7070 6c79  ter"] = df.apply
-0000c9a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c9b0: 2020 6c61 6d62 6461 2072 6f77 3a20 2828    lambda row: ((
-0000c9c0: 726f 772e 6d6f 6e74 6820 2d20 3129 202f  row.month - 1) /
-0000c9d0: 2f20 3329 202b 2031 2069 6620 726f 772e  / 3) + 1 if row.
-0000c9e0: 6d6f 6e74 6820 3e20 3020 656c 7365 202d  month > 0 else -
-0000c9f0: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0000ca00: 2020 2061 7869 733d 2263 6f6c 756d 6e73     axis="columns
-0000ca10: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
-0000ca20: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000ca30: 6c66 2e5f 6361 6368 655f 6765 6e65 7261  lf._cache_genera
-0000ca40: 6c5f 6d65 7461 6461 7461 5b73 616d 706c  l_metadata[sampl
-0000ca50: 655f 7365 745d 203d 2064 660a 2020 2020  e_set] = df.    
-0000ca60: 2020 2020 7265 7475 726e 2064 662e 636f      return df.co
-0000ca70: 7079 2829 0a0a 2020 2020 4064 6f63 280a  py()..    @doc(.
-0000ca80: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-0000ca90: 2241 6363 6573 7320 7361 6d70 6c65 206d  "Access sample m
-0000caa0: 6574 6164 6174 6120 666f 7220 6f6e 6520  etadata for one 
-0000cab0: 6f72 206d 6f72 6520 7361 6d70 6c65 2073  or more sample s
-0000cac0: 6574 732e 222c 0a20 2020 2020 2020 2072  ets.",.        r
-0000cad0: 6574 7572 6e73 3d22 4120 6461 7461 6672  eturns="A datafr
-0000cae0: 616d 6520 6f66 2073 616d 706c 6520 6d65  ame of sample me
-0000caf0: 7461 6461 7461 2c20 6f6e 6520 726f 7720  tadata, one row 
-0000cb00: 7065 7220 7361 6d70 6c65 2e22 2c0a 2020  per sample.",.  
-0000cb10: 2020 290a 2020 2020 6465 6620 7361 6d70    ).    def samp
-0000cb20: 6c65 5f6d 6574 6164 6174 6128 0a20 2020  le_metadata(.   
-0000cb30: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000cb40: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
-0000cb50: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-0000cb60: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
-0000cb70: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000cb80: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
-0000cb90: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-0000cba0: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
-0000cbb0: 795d 203d 204e 6f6e 652c 0a20 2020 2029  y] = None,.    )
-0000cbc0: 202d 3e20 7064 2e44 6174 6146 7261 6d65   -> pd.DataFrame
-0000cbd0: 3a0a 2020 2020 2020 2020 7361 6d70 6c65  :.        sample
-0000cbe0: 5f73 6574 7320 3d20 7365 6c66 2e5f 7072  _sets = self._pr
-0000cbf0: 6570 5f73 616d 706c 655f 7365 7473 5f70  ep_sample_sets_p
-0000cc00: 6172 616d 2873 616d 706c 655f 7365 7473  aram(sample_sets
-0000cc10: 3d73 616d 706c 655f 7365 7473 290a 2020  =sample_sets).  
-0000cc20: 2020 2020 2020 6361 6368 655f 6b65 7920        cache_key 
-0000cc30: 3d20 7475 706c 6528 7361 6d70 6c65 5f73  = tuple(sample_s
-0000cc40: 6574 7329 0a0a 2020 2020 2020 2020 7472  ets)..        tr
-0000cc50: 793a 0a20 2020 2020 2020 2020 2020 2064  y:.            d
-0000cc60: 665f 7361 6d70 6c65 7320 3d20 7365 6c66  f_samples = self
-0000cc70: 2e5f 6361 6368 655f 7361 6d70 6c65 5f6d  ._cache_sample_m
-0000cc80: 6574 6164 6174 615b 6361 6368 655f 6b65  etadata[cache_ke
-0000cc90: 795d 0a0a 2020 2020 2020 2020 6578 6365  y]..        exce
-0000cca0: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
-0000ccb0: 2020 2020 2020 2020 2023 2063 6f6e 6361           # conca
-0000ccc0: 7465 6e61 7465 206d 756c 7469 706c 6520  tenate multiple 
-0000ccd0: 7361 6d70 6c65 2073 6574 730a 2020 2020  sample sets.    
-0000cce0: 2020 2020 2020 2020 6466 7320 3d20 5b5d          dfs = []
-0000ccf0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-0000cd00: 6865 7265 2063 616e 2062 6520 736f 6d65  here can be some
-0000cd10: 2064 656c 6179 2068 6572 6520 6475 6520   delay here due 
-0000cd20: 746f 206e 6574 776f 726b 206c 6174 656e  to network laten
-0000cd30: 6379 2c20 736f 2073 686f 7720 7072 6f67  cy, so show prog
-0000cd40: 7265 7373 0a20 2020 2020 2020 2020 2020  ress.           
-0000cd50: 2073 616d 706c 655f 7365 7473 5f69 7465   sample_sets_ite
-0000cd60: 7261 746f 7220 3d20 7365 6c66 2e5f 7072  rator = self._pr
-0000cd70: 6f67 7265 7373 280a 2020 2020 2020 2020  ogress(.        
-0000cd80: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-0000cd90: 6574 732c 2064 6573 633d 224c 6f61 6420  ets, desc="Load 
-0000cda0: 7361 6d70 6c65 206d 6574 6164 6174 6122  sample metadata"
-0000cdb0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000cdc0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0000cdd0: 2069 6e20 7361 6d70 6c65 5f73 6574 735f   in sample_sets_
-0000cde0: 6974 6572 6174 6f72 3a0a 2020 2020 2020  iterator:.      
-0000cdf0: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-0000ce00: 656c 662e 5f73 616d 706c 655f 6d65 7461  elf._sample_meta
-0000ce10: 6461 7461 2873 616d 706c 655f 7365 743d  data(sample_set=
-0000ce20: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0000ce30: 2020 2064 6673 2e61 7070 656e 6428 6466     dfs.append(df
-0000ce40: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0000ce50: 5f73 616d 706c 6573 203d 2070 642e 636f  _samples = pd.co
-0000ce60: 6e63 6174 2864 6673 2c20 6178 6973 3d30  ncat(dfs, axis=0
-0000ce70: 2c20 6967 6e6f 7265 5f69 6e64 6578 3d54  , ignore_index=T
-0000ce80: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0000ce90: 2073 656c 662e 5f63 6163 6865 5f73 616d   self._cache_sam
-0000cea0: 706c 655f 6d65 7461 6461 7461 5b63 6163  ple_metadata[cac
-0000ceb0: 6865 5f6b 6579 5d20 3d20 6466 5f73 616d  he_key] = df_sam
-0000cec0: 706c 6573 0a0a 2020 2020 2020 2020 2320  ples..        # 
-0000ced0: 6164 6420 6578 7472 6120 6d65 7461 6461  add extra metada
-0000cee0: 7461 0a20 2020 2020 2020 2066 6f72 206f  ta.        for o
-0000cef0: 6e2c 2064 6174 6120 696e 2073 656c 662e  n, data in self.
-0000cf00: 5f65 7874 7261 5f6d 6574 6164 6174 613a  _extra_metadata:
-0000cf10: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-0000cf20: 7361 6d70 6c65 7320 3d20 6466 5f73 616d  samples = df_sam
-0000cf30: 706c 6573 2e6d 6572 6765 2864 6174 612c  ples.merge(data,
-0000cf40: 2068 6f77 3d22 6c65 6674 222c 206f 6e3d   how="left", on=
-0000cf50: 6f6e 290a 0a20 2020 2020 2020 2023 2066  on)..        # f
-0000cf60: 6f72 2063 6f6e 7665 6e69 656e 6365 2c20  or convenience, 
-0000cf70: 6170 706c 7920 6120 7175 6572 790a 2020  apply a query.  
-0000cf80: 2020 2020 2020 6966 2073 616d 706c 655f        if sample_
-0000cf90: 7175 6572 7920 6973 206e 6f74 204e 6f6e  query is not Non
-0000cfa0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0000cfb0: 6620 6973 696e 7374 616e 6365 2873 616d  f isinstance(sam
-0000cfc0: 706c 655f 7175 6572 792c 2073 7472 293a  ple_query, str):
-0000cfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cfe0: 2023 2061 7373 756d 6520 6120 7061 6e64   # assume a pand
-0000cff0: 6173 2071 7565 7279 2073 7472 696e 670a  as query string.
-0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d010: 6466 5f73 616d 706c 6573 203d 2064 665f  df_samples = df_
-0000d020: 7361 6d70 6c65 732e 7175 6572 7928 7361  samples.query(sa
-0000d030: 6d70 6c65 5f71 7565 7279 290a 2020 2020  mple_query).    
-0000d040: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000d050: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000d060: 6173 7375 6d65 2069 7420 6973 2061 6e20  assume it is an 
-0000d070: 696e 6465 7865 720a 2020 2020 2020 2020  indexer.        
-0000d080: 2020 2020 2020 2020 6466 5f73 616d 706c          df_sampl
-0000d090: 6573 203d 2064 665f 7361 6d70 6c65 732e  es = df_samples.
-0000d0a0: 696c 6f63 5b73 616d 706c 655f 7175 6572  iloc[sample_quer
-0000d0b0: 795d 0a20 2020 2020 2020 2020 2020 2064  y].            d
-0000d0c0: 665f 7361 6d70 6c65 7320 3d20 6466 5f73  f_samples = df_s
-0000d0d0: 616d 706c 6573 2e72 6573 6574 5f69 6e64  amples.reset_ind
-0000d0e0: 6578 2864 726f 703d 5472 7565 290a 0a20  ex(drop=True).. 
-0000d0f0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-0000d100: 5f73 616d 706c 6573 2e63 6f70 7928 290a  _samples.copy().
-0000d110: 0a20 2020 2040 646f 6328 0a20 2020 2020  .    @doc(.     
-0000d120: 2020 2073 756d 6d61 7279 3d22 2222 0a20     summary=""". 
-0000d130: 2020 2020 2020 2020 2020 2041 6464 2065             Add e
-0000d140: 7874 7261 2073 616d 706c 6520 6d65 7461  xtra sample meta
-0000d150: 6461 7461 2c20 652e 672e 2c20 696e 636c  data, e.g., incl
-0000d160: 7564 696e 6720 6164 6469 7469 6f6e 616c  uding additional
-0000d170: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
-0000d180: 2020 2020 2077 6869 6368 2079 6f75 2077       which you w
-0000d190: 6f75 6c64 206c 696b 6520 746f 2075 7365  ould like to use
-0000d1a0: 2074 6f20 7175 6572 7920 616e 6420 6772   to query and gr
-0000d1b0: 6f75 7020 7361 6d70 6c65 732e 0a20 2020  oup samples..   
-0000d1c0: 2020 2020 2022 2222 2c0a 2020 2020 2020       """,.      
-0000d1d0: 2020 7061 7261 6d65 7465 7273 3d64 6963    parameters=dic
-0000d1e0: 7428 0a20 2020 2020 2020 2020 2020 2064  t(.            d
-0000d1f0: 6174 613d 2222 220a 2020 2020 2020 2020  ata=""".        
-0000d200: 2020 2020 2020 2020 4120 6461 7461 2066          A data f
-0000d210: 7261 6d65 2077 6974 6820 6f6e 6520 726f  rame with one ro
-0000d220: 7720 7065 7220 7361 6d70 6c65 2e20 4d75  w per sample. Mu
-0000d230: 7374 2069 6e63 6c75 6465 2065 6974 6865  st include eithe
-0000d240: 7220 610a 2020 2020 2020 2020 2020 2020  r a.            
-0000d250: 2020 2020 2273 616d 706c 655f 6964 2220      "sample_id" 
-0000d260: 6f72 2022 7061 7274 6e65 725f 7361 6d70  or "partner_samp
-0000d270: 6c65 5f69 6422 2063 6f6c 756d 6e2e 0a20  le_id" column.. 
-0000d280: 2020 2020 2020 2020 2020 2022 2222 2c0a             """,.
-0000d290: 2020 2020 2020 2020 2020 2020 6f6e 3d22              on="
-0000d2a0: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
-0000d2b0: 2020 204e 616d 6520 6f66 2063 6f6c 756d     Name of colum
-0000d2c0: 6e20 746f 2075 7365 2077 6865 6e20 6d65  n to use when me
-0000d2d0: 7267 696e 6720 7769 7468 2073 616d 706c  rging with sampl
-0000d2e0: 6520 6d65 7461 6461 7461 2e0a 2020 2020  e metadata..    
-0000d2f0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-0000d300: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0000d310: 6e6f 7465 733d 2222 220a 2020 2020 2020  notes=""".      
-0000d320: 2020 2020 2020 5468 6520 7661 6c75 6573        The values
-0000d330: 2069 6e20 7468 6520 636f 6c75 6d6e 2063   in the column c
-0000d340: 6f6e 7461 696e 696e 6720 7361 6d70 6c65  ontaining sample
-0000d350: 2069 6465 6e74 6966 6965 7273 206d 7573   identifiers mus
-0000d360: 7420 6265 0a20 2020 2020 2020 2020 2020  t be.           
-0000d370: 2075 6e69 7175 652e 0a20 2020 2020 2020   unique..       
-0000d380: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
-0000d390: 6465 6620 6164 645f 6578 7472 615f 6d65  def add_extra_me
-0000d3a0: 7461 6461 7461 2873 656c 662c 2064 6174  tadata(self, dat
-0000d3b0: 613a 2070 642e 4461 7461 4672 616d 652c  a: pd.DataFrame,
-0000d3c0: 206f 6e3a 2073 7472 203d 2022 7361 6d70   on: str = "samp
-0000d3d0: 6c65 5f69 6422 293a 0a20 2020 2020 2020  le_id"):.       
-0000d3e0: 2023 2063 6865 636b 2070 6172 616d 6574   # check paramet
-0000d3f0: 6572 730a 2020 2020 2020 2020 6966 206e  ers.        if n
-0000d400: 6f74 2069 7369 6e73 7461 6e63 6528 6461  ot isinstance(da
-0000d410: 7461 2c20 7064 2e44 6174 6146 7261 6d65  ta, pd.DataFrame
-0000d420: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000d430: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-0000d440: 6064 6174 6160 2070 6172 616d 6574 6572  `data` parameter
-0000d450: 206d 7573 7420 6265 2061 2070 616e 6461   must be a panda
-0000d460: 7320 4461 7461 4672 616d 6522 290a 2020  s DataFrame").  
-0000d470: 2020 2020 2020 6966 206f 6e20 6e6f 7420        if on not 
-0000d480: 696e 2064 6174 612e 636f 6c75 6d6e 733a  in data.columns:
-0000d490: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d4a0: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0000d4b0: 6461 7461 6672 616d 6520 646f 6573 206e  dataframe does n
-0000d4c0: 6f74 2063 6f6e 7461 696e 2063 6f6c 756d  ot contain colum
-0000d4d0: 6e20 7b6f 6e21 727d 2229 0a20 2020 2020  n {on!r}").     
-0000d4e0: 2020 2069 6620 6f6e 206e 6f74 2069 6e20     if on not in 
-0000d4f0: 7b22 7361 6d70 6c65 5f69 6422 2c20 2270  {"sample_id", "p
-0000d500: 6172 746e 6572 5f73 616d 706c 655f 6964  artner_sample_id
-0000d510: 227d 3a0a 2020 2020 2020 2020 2020 2020  "}:.            
-0000d520: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000d530: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d540: 2020 2260 6f6e 6020 7061 7261 6d65 7465    "`on` paramete
-0000d550: 7220 6d75 7374 2062 6520 6569 7468 6572  r must be either
-0000d560: 2027 7361 6d70 6c65 5f69 6427 206f 7220   'sample_id' or 
-0000d570: 2770 6172 746e 6572 5f73 616d 706c 655f  'partner_sample_
-0000d580: 6964 2722 0a20 2020 2020 2020 2020 2020  id'".           
-0000d590: 2029 0a0a 2020 2020 2020 2020 2320 6368   )..        # ch
-0000d5a0: 6563 6b20 666f 7220 756e 6971 7565 6e65  eck for uniquene
-0000d5b0: 7373 0a20 2020 2020 2020 2069 6620 6e6f  ss.        if no
-0000d5c0: 7420 6461 7461 5b6f 6e5d 2e69 735f 756e  t data[on].is_un
-0000d5d0: 6971 7565 3a0a 2020 2020 2020 2020 2020  ique:.          
-0000d5e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000d5f0: 6f72 2866 2263 6f6c 756d 6e20 7b6f 6e21  or(f"column {on!
-0000d600: 727d 2064 6f65 7320 6e6f 7420 6861 7665  r} does not have
-0000d610: 2075 6e69 7175 6520 7661 6c75 6573 2229   unique values")
-0000d620: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
-0000d630: 6b20 7468 6572 6520 6172 6520 6d61 7463  k there are matc
-0000d640: 6869 6e67 2073 616d 706c 6573 0a20 2020  hing samples.   
-0000d650: 2020 2020 2064 665f 7361 6d70 6c65 7320       df_samples 
-0000d660: 3d20 7365 6c66 2e73 616d 706c 655f 6d65  = self.sample_me
-0000d670: 7461 6461 7461 2829 0a20 2020 2020 2020  tadata().       
-0000d680: 206c 6f63 5f69 7365 6320 3d20 6461 7461   loc_isec = data
-0000d690: 5b6f 6e5d 2e69 7369 6e28 6466 5f73 616d  [on].isin(df_sam
-0000d6a0: 706c 6573 5b6f 6e5d 290a 2020 2020 2020  ples[on]).      
-0000d6b0: 2020 6966 206e 6f74 206c 6f63 5f69 7365    if not loc_ise
-0000d6c0: 632e 616e 7928 293a 0a20 2020 2020 2020  c.any():.       
-0000d6d0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000d6e0: 4572 726f 7228 226e 6f20 6d61 7463 6869  Error("no matchi
-0000d6f0: 6e67 2073 616d 706c 6573 2066 6f75 6e64  ng samples found
-0000d700: 2229 0a0a 2020 2020 2020 2020 2320 7374  ")..        # st
-0000d710: 6f72 6520 6578 7472 6120 6d65 7461 6461  ore extra metada
-0000d720: 7461 0a20 2020 2020 2020 2073 656c 662e  ta.        self.
-0000d730: 5f65 7874 7261 5f6d 6574 6164 6174 612e  _extra_metadata.
-0000d740: 6170 7065 6e64 2828 6f6e 2c20 6461 7461  append((on, data
-0000d750: 2e63 6f70 7928 2929 290a 0a20 2020 2040  .copy()))..    @
-0000d760: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-0000d770: 6d61 7279 3d22 436c 6561 7220 616e 7920  mary="Clear any 
-0000d780: 6578 7472 6120 6d65 7461 6461 7461 2070  extra metadata p
-0000d790: 7265 7669 6f75 736c 7920 6164 6465 6422  reviously added"
-0000d7a0: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
-0000d7b0: 636c 6561 725f 6578 7472 615f 6d65 7461  clear_extra_meta
-0000d7c0: 6461 7461 2873 656c 6629 3a0a 2020 2020  data(self):.    
-0000d7d0: 2020 2020 7365 6c66 2e5f 6578 7472 615f      self._extra_
-0000d7e0: 6d65 7461 6461 7461 203d 205b 5d0a 0a20  metadata = [].. 
-0000d7f0: 2020 2064 6566 205f 7369 7465 5f66 696c     def _site_fil
-0000d800: 7465 7273 280a 2020 2020 2020 2020 7365  ters(.        se
-0000d810: 6c66 2c0a 2020 2020 2020 2020 2a2c 0a20  lf,.        *,. 
-0000d820: 2020 2020 2020 2072 6567 696f 6e2c 0a20         region,. 
-0000d830: 2020 2020 2020 206d 6173 6b2c 0a20 2020         mask,.   
-0000d840: 2020 2020 2066 6965 6c64 2c0a 2020 2020       field,.    
-0000d850: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
-0000d860: 2c0a 2020 2020 2020 2020 6368 756e 6b73  ,.        chunks
-0000d870: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-0000d880: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-0000d890: 6365 2872 6567 696f 6e2c 2052 6567 696f  ce(region, Regio
-0000d8a0: 6e29 0a20 2020 2020 2020 2072 6f6f 7420  n).        root 
-0000d8b0: 3d20 7365 6c66 2e6f 7065 6e5f 7369 7465  = self.open_site
-0000d8c0: 5f66 696c 7465 7273 286d 6173 6b3d 6d61  _filters(mask=ma
-0000d8d0: 736b 290a 2020 2020 2020 2020 7a20 3d20  sk).        z = 
-0000d8e0: 726f 6f74 5b66 227b 7265 6769 6f6e 2e63  root[f"{region.c
-0000d8f0: 6f6e 7469 677d 2f76 6172 6961 6e74 732f  ontig}/variants/
-0000d900: 7b66 6965 6c64 7d22 5d0a 2020 2020 2020  {field}"].      
-0000d910: 2020 6420 3d20 6461 5f66 726f 6d5f 7a61    d = da_from_za
-0000d920: 7272 287a 2c20 696e 6c69 6e65 5f61 7272  rr(z, inline_arr
-0000d930: 6179 3d69 6e6c 696e 655f 6172 7261 792c  ay=inline_array,
-0000d940: 2063 6875 6e6b 733d 6368 756e 6b73 290a   chunks=chunks).
-0000d950: 2020 2020 2020 2020 6966 2072 6567 696f          if regio
-0000d960: 6e2e 7374 6172 7420 6f72 2072 6567 696f  n.start or regio
-0000d970: 6e2e 656e 643a 0a20 2020 2020 2020 2020  n.end:.         
-0000d980: 2020 2072 6f6f 7420 3d20 7365 6c66 2e6f     root = self.o
-0000d990: 7065 6e5f 736e 705f 7369 7465 7328 290a  pen_snp_sites().
-0000d9a0: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-0000d9b0: 3d20 726f 6f74 5b66 227b 7265 6769 6f6e  = root[f"{region
-0000d9c0: 2e63 6f6e 7469 677d 2f76 6172 6961 6e74  .contig}/variant
-0000d9d0: 732f 504f 5322 5d5b 3a5d 0a20 2020 2020  s/POS"][:].     
-0000d9e0: 2020 2020 2020 206c 6f63 5f72 6567 696f         loc_regio
-0000d9f0: 6e20 3d20 6c6f 6361 7465 5f72 6567 696f  n = locate_regio
-0000da00: 6e28 7265 6769 6f6e 2c20 706f 7329 0a20  n(region, pos). 
-0000da10: 2020 2020 2020 2020 2020 2064 203d 2064             d = d
-0000da20: 5b6c 6f63 5f72 6567 696f 6e5d 0a20 2020  [loc_region].   
-0000da30: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
-0000da40: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
-0000da50: 2073 756d 6d61 7279 3d22 4163 6365 7373   summary="Access
-0000da60: 2053 4e50 2073 6974 6520 6669 6c74 6572   SNP site filter
-0000da70: 732e 222c 0a20 2020 2020 2020 2072 6574  s.",.        ret
-0000da80: 7572 6e73 3d22 2222 0a20 2020 2020 2020  urns=""".       
-0000da90: 2020 2020 2041 6e20 6172 7261 7920 6f66       An array of
-0000daa0: 2062 6f6f 6c65 616e 2076 616c 7565 7320   boolean values 
-0000dab0: 6964 656e 7469 6679 696e 6720 7369 7465  identifying site
-0000dac0: 7320 7468 6174 2070 6173 7320 7468 6520  s that pass the 
-0000dad0: 6669 6c74 6572 732e 0a20 2020 2020 2020  filters..       
-0000dae0: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
-0000daf0: 6465 6620 7369 7465 5f66 696c 7465 7273  def site_filters
-0000db00: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000db10: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
-0000db20: 6261 7365 5f70 6172 616d 732e 7265 6769  base_params.regi
-0000db30: 6f6e 2c0a 2020 2020 2020 2020 6d61 736b  on,.        mask
-0000db40: 3a20 6261 7365 5f70 6172 616d 732e 7369  : base_params.si
-0000db50: 7465 5f6d 6173 6b2c 0a20 2020 2020 2020  te_mask,.       
-0000db60: 2066 6965 6c64 3a20 6261 7365 5f70 6172   field: base_par
-0000db70: 616d 732e 6669 656c 6420 3d20 2266 696c  ams.field = "fil
-0000db80: 7465 725f 7061 7373 222c 0a20 2020 2020  ter_pass",.     
-0000db90: 2020 2069 6e6c 696e 655f 6172 7261 793a     inline_array:
-0000dba0: 2062 6173 655f 7061 7261 6d73 2e69 6e6c   base_params.inl
-0000dbb0: 696e 655f 6172 7261 7920 3d20 6261 7365  ine_array = base
-0000dbc0: 5f70 6172 616d 732e 696e 6c69 6e65 5f61  _params.inline_a
-0000dbd0: 7272 6179 5f64 6566 6175 6c74 2c0a 2020  rray_default,.  
-0000dbe0: 2020 2020 2020 6368 756e 6b73 3a20 6261        chunks: ba
-0000dbf0: 7365 5f70 6172 616d 732e 6368 756e 6b73  se_params.chunks
-0000dc00: 203d 2062 6173 655f 7061 7261 6d73 2e63   = base_params.c
-0000dc10: 6875 6e6b 735f 6465 6661 756c 742c 0a20  hunks_default,. 
-0000dc20: 2020 2029 202d 3e20 6461 2e41 7272 6179     ) -> da.Array
-0000dc30: 3a0a 2020 2020 2020 2020 2320 7265 736f  :.        # reso
-0000dc40: 6c76 6520 7468 6520 7265 6769 6f6e 2070  lve the region p
-0000dc50: 6172 616d 6574 6572 2074 6f20 6120 7374  arameter to a st
-0000dc60: 616e 6461 7264 2074 7970 650a 2020 2020  andard type.    
-0000dc70: 2020 2020 7265 736f 6c76 6564 5f72 6567      resolved_reg
-0000dc80: 696f 6e20 3d20 7365 6c66 2e72 6573 6f6c  ion = self.resol
-0000dc90: 7665 5f72 6567 696f 6e28 7265 6769 6f6e  ve_region(region
-0000dca0: 290a 2020 2020 2020 2020 6465 6c20 7265  ).        del re
-0000dcb0: 6769 6f6e 0a20 2020 2020 2020 2069 6620  gion.        if 
-0000dcc0: 6973 696e 7374 616e 6365 2872 6573 6f6c  isinstance(resol
-0000dcd0: 7665 645f 7265 6769 6f6e 2c20 5265 6769  ved_region, Regi
-0000dce0: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
-0000dcf0: 2072 6573 6f6c 7665 645f 7265 6769 6f6e   resolved_region
-0000dd00: 203d 205b 7265 736f 6c76 6564 5f72 6567   = [resolved_reg
-0000dd10: 696f 6e5d 0a0a 2020 2020 2020 2020 6420  ion]..        d 
-0000dd20: 3d20 6461 2e63 6f6e 6361 7465 6e61 7465  = da.concatenate
-0000dd30: 280a 2020 2020 2020 2020 2020 2020 5b0a  (.            [.
-0000dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd50: 7365 6c66 2e5f 7369 7465 5f66 696c 7465  self._site_filte
-0000dd60: 7273 280a 2020 2020 2020 2020 2020 2020  rs(.            
-0000dd70: 2020 2020 2020 2020 7265 6769 6f6e 3d72          region=r
-0000dd80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dd90: 2020 2020 2020 6d61 736b 3d6d 6173 6b2c        mask=mask,
-0000dda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ddb0: 2020 2020 2066 6965 6c64 3d66 6965 6c64       field=field
-0000ddc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ddd0: 2020 2020 2020 696e 6c69 6e65 5f61 7272        inline_arr
-0000dde0: 6179 3d69 6e6c 696e 655f 6172 7261 792c  ay=inline_array,
-0000ddf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000de00: 2020 2020 2063 6875 6e6b 733d 6368 756e       chunks=chun
-0000de10: 6b73 2c0a 2020 2020 2020 2020 2020 2020  ks,.            
-0000de20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000de30: 2020 2020 2020 666f 7220 7220 696e 2072        for r in r
-0000de40: 6573 6f6c 7665 645f 7265 6769 6f6e 0a20  esolved_region. 
-0000de50: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0000de60: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000de70: 7265 7475 726e 2064 0a0a 2020 2020 6465  return d..    de
-0000de80: 6620 5f73 6e70 5f73 6974 6573 5f66 6f72  f _snp_sites_for
-0000de90: 5f63 6f6e 7469 6728 7365 6c66 2c20 636f  _contig(self, co
-0000dea0: 6e74 6967 2c20 2a2c 2066 6965 6c64 2c20  ntig, *, field, 
-0000deb0: 696e 6c69 6e65 5f61 7272 6179 2c20 6368  inline_array, ch
-0000dec0: 756e 6b73 293a 0a20 2020 2020 2020 2022  unks):.        "
-0000ded0: 2222 4163 6365 7373 2053 4e50 2073 6974  ""Access SNP sit
-0000dee0: 6573 2064 6174 6120 666f 7220 6120 7369  es data for a si
-0000def0: 6e67 6c65 2063 6f6e 7469 672e 2222 220a  ngle contig.""".
-0000df00: 2020 2020 2020 2020 726f 6f74 203d 2073          root = s
-0000df10: 656c 662e 6f70 656e 5f73 6e70 5f73 6974  elf.open_snp_sit
-0000df20: 6573 2829 0a20 2020 2020 2020 207a 203d  es().        z =
-0000df30: 2072 6f6f 745b 6622 7b63 6f6e 7469 677d   root[f"{contig}
-0000df40: 2f76 6172 6961 6e74 732f 7b66 6965 6c64  /variants/{field
-0000df50: 7d22 5d0a 2020 2020 2020 2020 7265 7420  }"].        ret 
-0000df60: 3d20 6461 5f66 726f 6d5f 7a61 7272 287a  = da_from_zarr(z
-0000df70: 2c20 696e 6c69 6e65 5f61 7272 6179 3d69  , inline_array=i
-0000df80: 6e6c 696e 655f 6172 7261 792c 2063 6875  nline_array, chu
-0000df90: 6e6b 733d 6368 756e 6b73 290a 2020 2020  nks=chunks).    
-0000dfa0: 2020 2020 7265 7475 726e 2072 6574 0a0a      return ret..
-0000dfb0: 2020 2020 6465 6620 5f73 6e70 5f73 6974      def _snp_sit
-0000dfc0: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
-0000dfd0: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
-0000dfe0: 2020 2020 2072 6567 696f 6e2c 0a20 2020       region,.   
-0000dff0: 2020 2020 2066 6965 6c64 2c0a 2020 2020       field,.    
-0000e000: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
-0000e010: 2c0a 2020 2020 2020 2020 6368 756e 6b73  ,.        chunks
-0000e020: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-0000e030: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-0000e040: 6365 2872 6567 696f 6e2c 2052 6567 696f  ce(region, Regio
-0000e050: 6e29 2c20 7479 7065 2872 6567 696f 6e29  n), type(region)
-0000e060: 0a0a 2020 2020 2020 2020 7265 7420 3d20  ..        ret = 
-0000e070: 7365 6c66 2e5f 736e 705f 7369 7465 735f  self._snp_sites_
-0000e080: 666f 725f 636f 6e74 6967 280a 2020 2020  for_contig(.    
-0000e090: 2020 2020 2020 2020 636f 6e74 6967 3d72          contig=r
-0000e0a0: 6567 696f 6e2e 636f 6e74 6967 2c20 6669  egion.contig, fi
-0000e0b0: 656c 643d 6669 656c 642c 2069 6e6c 696e  eld=field, inlin
-0000e0c0: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
-0000e0d0: 7272 6179 2c20 6368 756e 6b73 3d63 6875  rray, chunks=chu
-0000e0e0: 6e6b 730a 2020 2020 2020 2020 290a 0a20  nks.        ).. 
-0000e0f0: 2020 2020 2020 2069 6620 7265 6769 6f6e         if region
-0000e100: 2e73 7461 7274 206f 7220 7265 6769 6f6e  .start or region
-0000e110: 2e65 6e64 3a0a 2020 2020 2020 2020 2020  .end:.          
-0000e120: 2020 6966 2066 6965 6c64 203d 3d20 2250    if field == "P
-0000e130: 4f53 223a 0a20 2020 2020 2020 2020 2020  OS":.           
-0000e140: 2020 2020 2070 6f73 203d 2072 6574 0a20       pos = ret. 
-0000e150: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e170: 2070 6f73 203d 2073 656c 662e 5f73 6e70   pos = self._snp
-0000e180: 5f73 6974 6573 5f66 6f72 5f63 6f6e 7469  _sites_for_conti
-0000e190: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
-0000e1a0: 2020 2020 2020 2063 6f6e 7469 673d 7265         contig=re
-0000e1b0: 6769 6f6e 2e63 6f6e 7469 672c 0a20 2020  gion.contig,.   
-0000e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1d0: 2066 6965 6c64 3d22 504f 5322 2c0a 2020   field="POS",.  
-0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1f0: 2020 696e 6c69 6e65 5f61 7272 6179 3d69    inline_array=i
-0000e200: 6e6c 696e 655f 6172 7261 792c 0a20 2020  nline_array,.   
-0000e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e220: 2063 6875 6e6b 733d 6368 756e 6b73 2c0a   chunks=chunks,.
-0000e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e240: 290a 2020 2020 2020 2020 2020 2020 6c6f  ).            lo
-0000e250: 635f 7265 6769 6f6e 203d 206c 6f63 6174  c_region = locat
-0000e260: 655f 7265 6769 6f6e 2872 6567 696f 6e2c  e_region(region,
-0000e270: 2070 6f73 290a 2020 2020 2020 2020 2020   pos).          
-0000e280: 2020 7265 7420 3d20 7265 745b 6c6f 635f    ret = ret[loc_
-0000e290: 7265 6769 6f6e 5d0a 2020 2020 2020 2020  region].        
-0000e2a0: 7265 7475 726e 2072 6574 0a0a 2020 2020  return ret..    
-0000e2b0: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
-0000e2c0: 6d6d 6172 793d 2241 6363 6573 7320 534e  mmary="Access SN
-0000e2d0: 5020 7369 7465 2064 6174 6120 2870 6f73  P site data (pos
-0000e2e0: 6974 696f 6e73 2061 6e64 2061 6c6c 656c  itions and allel
-0000e2f0: 6573 292e 222c 0a20 2020 2020 2020 2072  es).",.        r
-0000e300: 6574 7572 6e73 3d22 2222 0a20 2020 2020  eturns=""".     
-0000e310: 2020 2020 2020 2041 6e20 6172 7261 7920         An array 
-0000e320: 6f66 2065 6974 6865 7220 534e 5020 706f  of either SNP po
-0000e330: 7369 7469 6f6e 7320 2822 504f 5322 292c  sitions ("POS"),
-0000e340: 2072 6566 6572 656e 6365 2061 6c6c 656c   reference allel
-0000e350: 6573 2028 2252 4546 2229 206f 720a 2020  es ("REF") or.  
-0000e360: 2020 2020 2020 2020 2020 616c 7465 726e            altern
-0000e370: 6174 6520 616c 6c65 6c65 7320 2822 414c  ate alleles ("AL
-0000e380: 5422 292e 0a20 2020 2020 2020 2022 2222  T")..        """
-0000e390: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
-0000e3a0: 736e 705f 7369 7465 7328 0a20 2020 2020  snp_sites(.     
-0000e3b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000e3c0: 2072 6567 696f 6e3a 2062 6173 655f 7061   region: base_pa
-0000e3d0: 7261 6d73 2e72 6567 696f 6e2c 0a20 2020  rams.region,.   
-0000e3e0: 2020 2020 2066 6965 6c64 3a20 6261 7365       field: base
-0000e3f0: 5f70 6172 616d 732e 6669 656c 642c 0a20  _params.field,. 
-0000e400: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
-0000e410: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-0000e420: 7061 7261 6d73 2e73 6974 655f 6d61 736b  params.site_mask
-0000e430: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000e440: 2020 696e 6c69 6e65 5f61 7272 6179 3a20    inline_array: 
-0000e450: 6261 7365 5f70 6172 616d 732e 696e 6c69  base_params.inli
-0000e460: 6e65 5f61 7272 6179 203d 2062 6173 655f  ne_array = base_
-0000e470: 7061 7261 6d73 2e69 6e6c 696e 655f 6172  params.inline_ar
-0000e480: 7261 795f 6465 6661 756c 742c 0a20 2020  ray_default,.   
-0000e490: 2020 2020 2063 6875 6e6b 733a 2062 6173       chunks: bas
-0000e4a0: 655f 7061 7261 6d73 2e63 6875 6e6b 7320  e_params.chunks 
-0000e4b0: 3d20 6261 7365 5f70 6172 616d 732e 6368  = base_params.ch
-0000e4c0: 756e 6b73 5f64 6566 6175 6c74 2c0a 2020  unks_default,.  
-0000e4d0: 2020 2920 2d3e 2064 612e 4172 7261 793a    ) -> da.Array:
-0000e4e0: 0a20 2020 2020 2020 2064 6562 7567 203d  .        debug =
-0000e4f0: 2073 656c 662e 5f6c 6f67 2e64 6562 7567   self._log.debug
-0000e500: 0a0a 2020 2020 2020 2020 2320 7265 736f  ..        # reso
-0000e510: 6c76 6520 7468 6520 7265 6769 6f6e 2070  lve the region p
-0000e520: 6172 616d 6574 6572 2074 6f20 6120 7374  arameter to a st
-0000e530: 616e 6461 7264 2074 7970 650a 2020 2020  andard type.    
-0000e540: 2020 2020 7265 736f 6c76 6564 5f72 6567      resolved_reg
-0000e550: 696f 6e20 3d20 7365 6c66 2e72 6573 6f6c  ion = self.resol
-0000e560: 7665 5f72 6567 696f 6e28 7265 6769 6f6e  ve_region(region
-0000e570: 290a 2020 2020 2020 2020 6465 6c20 7265  ).        del re
-0000e580: 6769 6f6e 0a20 2020 2020 2020 2069 6620  gion.        if 
-0000e590: 6973 696e 7374 616e 6365 2872 6573 6f6c  isinstance(resol
-0000e5a0: 7665 645f 7265 6769 6f6e 2c20 5265 6769  ved_region, Regi
-0000e5b0: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
-0000e5c0: 2072 6573 6f6c 7665 645f 7265 6769 6f6e   resolved_region
-0000e5d0: 203d 205b 7265 736f 6c76 6564 5f72 6567   = [resolved_reg
-0000e5e0: 696f 6e5d 0a0a 2020 2020 2020 2020 6465  ion]..        de
-0000e5f0: 6275 6728 2261 6363 6573 7320 534e 5020  bug("access SNP 
-0000e600: 7369 7465 7320 616e 6420 636f 6e63 6174  sites and concat
-0000e610: 656e 6174 6520 6f76 6572 2072 6567 696f  enate over regio
-0000e620: 6e73 2229 0a20 2020 2020 2020 2072 6574  ns").        ret
-0000e630: 203d 2064 612e 636f 6e63 6174 656e 6174   = da.concatenat
-0000e640: 6528 0a20 2020 2020 2020 2020 2020 205b  e(.            [
-0000e650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e660: 2073 656c 662e 5f73 6e70 5f73 6974 6573   self._snp_sites
-0000e670: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000e680: 2020 2020 2020 7265 6769 6f6e 3d72 2c0a        region=r,.
-0000e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6a0: 2020 2020 6669 656c 643d 6669 656c 642c      field=field,
-0000e6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e6c0: 2020 2020 2063 6875 6e6b 733d 6368 756e       chunks=chun
-0000e6d0: 6b73 2c0a 2020 2020 2020 2020 2020 2020  ks,.            
-0000e6e0: 2020 2020 2020 2020 696e 6c69 6e65 5f61          inline_a
-0000e6f0: 7272 6179 3d69 6e6c 696e 655f 6172 7261  rray=inline_arra
-0000e700: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0000e710: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000e720: 2020 2020 2066 6f72 2072 2069 6e20 7265       for r in re
-0000e730: 736f 6c76 6564 5f72 6567 696f 6e0a 2020  solved_region.  
-0000e740: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
-0000e750: 2020 2020 2020 2020 2061 7869 733d 302c           axis=0,
-0000e760: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000e770: 2020 2020 6465 6275 6728 2261 7070 6c79      debug("apply
-0000e780: 2073 6974 6520 6d61 736b 2069 6620 7265   site mask if re
-0000e790: 7175 6573 7465 6422 290a 2020 2020 2020  quested").      
-0000e7a0: 2020 6966 2073 6974 655f 6d61 736b 2069    if site_mask i
-0000e7b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000e7c0: 2020 2020 2020 2020 6c6f 635f 7369 7465          loc_site
-0000e7d0: 7320 3d20 7365 6c66 2e73 6974 655f 6669  s = self.site_fi
-0000e7e0: 6c74 6572 7328 0a20 2020 2020 2020 2020  lters(.         
-0000e7f0: 2020 2020 2020 2072 6567 696f 6e3d 7265         region=re
-0000e800: 736f 6c76 6564 5f72 6567 696f 6e2c 0a20  solved_region,. 
-0000e810: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000e820: 6173 6b3d 7369 7465 5f6d 6173 6b2c 0a20  ask=site_mask,. 
-0000e830: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000e840: 6875 6e6b 733d 6368 756e 6b73 2c0a 2020  hunks=chunks,.  
-0000e850: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0000e860: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
-0000e870: 655f 6172 7261 792c 0a20 2020 2020 2020  e_array,.       
-0000e880: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000e890: 2020 2072 6574 203d 2064 615f 636f 6d70     ret = da_comp
-0000e8a0: 7265 7373 286c 6f63 5f73 6974 6573 2c20  ress(loc_sites, 
-0000e8b0: 7265 742c 2061 7869 733d 3029 0a0a 2020  ret, axis=0)..  
-0000e8c0: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
-0000e8d0: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
-0000e8e0: 2020 2020 7375 6d6d 6172 793d 2243 6f6e      summary="Con
-0000e8f0: 7665 7274 2061 2067 656e 6f6d 6520 7265  vert a genome re
-0000e900: 6769 6f6e 2069 6e74 6f20 6120 7374 616e  gion into a stan
-0000e910: 6461 7264 2064 6174 6120 7374 7275 6374  dard data struct
-0000e920: 7572 652e 222c 0a20 2020 2020 2020 2072  ure.",.        r
-0000e930: 6574 7572 6e73 3d22 416e 2069 6e73 7461  eturns="An insta
-0000e940: 6e63 6520 6f66 2074 6865 2060 5265 6769  nce of the `Regi
-0000e950: 6f6e 6020 636c 6173 732e 222c 0a20 2020  on` class.",.   
-0000e960: 2029 0a20 2020 2064 6566 2072 6573 6f6c   ).    def resol
-0000e970: 7665 5f72 6567 696f 6e28 7365 6c66 2c20  ve_region(self, 
-0000e980: 7265 6769 6f6e 3a20 6261 7365 5f70 6172  region: base_par
-0000e990: 616d 732e 7265 6769 6f6e 2920 2d3e 2052  ams.region) -> R
-0000e9a0: 6567 696f 6e3a 0a20 2020 2020 2020 2072  egion:.        r
-0000e9b0: 6574 7572 6e20 7265 736f 6c76 655f 7265  eturn resolve_re
-0000e9c0: 6769 6f6e 2873 656c 662c 2072 6567 696f  gion(self, regio
-0000e9d0: 6e29 0a0a 2020 2020 6465 6620 5f70 7265  n)..    def _pre
-0000e9e0: 705f 7265 6769 6f6e 5f63 6163 6865 5f70  p_region_cache_p
-0000e9f0: 6172 616d 2873 656c 662c 202a 2c20 7265  aram(self, *, re
-0000ea00: 6769 6f6e 293a 0a20 2020 2020 2020 2022  gion):.        "
-0000ea10: 2222 4f62 7461 696e 2061 206e 6f72 6d61  ""Obtain a norma
-0000ea20: 6c69 7365 6420 7265 7072 6573 656e 7461  lised representa
-0000ea30: 7469 6f6e 206f 6620 6120 7265 6769 6f6e  tion of a region
-0000ea40: 2070 6172 616d 6574 6572 2077 6869 6368   parameter which
-0000ea50: 2063 616e 0a20 2020 2020 2020 2062 6520   can.        be 
-0000ea60: 7573 6564 2077 6974 6820 7468 6520 7265  used with the re
-0000ea70: 7375 6c74 7320 6361 6368 652e 2222 220a  sults cache.""".
-0000ea80: 0a20 2020 2020 2020 2023 204e 2e42 2e2c  .        # N.B.,
-0000ea90: 2077 6520 6e65 6564 2074 6f20 636f 6e76   we need to conv
-0000eaa0: 6572 7420 746f 2061 2064 6963 742c 2062  ert to a dict, b
-0000eab0: 6563 6175 7365 2063 6163 6865 2073 6176  ecause cache sav
-0000eac0: 6573 2070 6172 616d 7320 6173 0a20 2020  es params as.   
-0000ead0: 2020 2020 2023 204a 534f 4e0a 0a20 2020       # JSON..   
-0000eae0: 2020 2020 2072 6567 696f 6e20 3d20 7365       region = se
-0000eaf0: 6c66 2e72 6573 6f6c 7665 5f72 6567 696f  lf.resolve_regio
-0000eb00: 6e28 7265 6769 6f6e 290a 2020 2020 2020  n(region).      
-0000eb10: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000eb20: 7265 6769 6f6e 2c20 6c69 7374 293a 0a20  region, list):. 
-0000eb30: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-0000eb40: 6e20 3d20 5b72 2e74 6f5f 6469 6374 2829  n = [r.to_dict()
-0000eb50: 2066 6f72 2072 2069 6e20 7265 6769 6f6e   for r in region
-0000eb60: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-0000eb70: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-0000eb80: 6f6e 203d 2072 6567 696f 6e2e 746f 5f64  on = region.to_d
-0000eb90: 6963 7428 290a 2020 2020 2020 2020 7265  ict().        re
-0000eba0: 7475 726e 2072 6567 696f 6e0a 0a20 2020  turn region..   
-0000ebb0: 2064 6566 205f 7072 6570 5f73 616d 706c   def _prep_sampl
-0000ebc0: 655f 7365 6c65 6374 696f 6e5f 6361 6368  e_selection_cach
-0000ebd0: 655f 7061 7261 6d73 2873 656c 662c 202a  e_params(self, *
-0000ebe0: 2c20 7361 6d70 6c65 5f73 6574 732c 2073  , sample_sets, s
-0000ebf0: 616d 706c 655f 7175 6572 7929 3a0a 2020  ample_query):.  
-0000ec00: 2020 2020 2020 2320 6e6f 726d 616c 6973        # normalis
-0000ec10: 6520 7361 6d70 6c65 2073 6574 730a 2020  e sample sets.  
-0000ec20: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
-0000ec30: 7320 3d20 7365 6c66 2e5f 7072 6570 5f73  s = self._prep_s
-0000ec40: 616d 706c 655f 7365 7473 5f70 6172 616d  ample_sets_param
-0000ec50: 2873 616d 706c 655f 7365 7473 3d73 616d  (sample_sets=sam
-0000ec60: 706c 655f 7365 7473 290a 0a20 2020 2020  ple_sets)..     
-0000ec70: 2020 2023 206e 6f72 6d61 6c69 7a65 2073     # normalize s
-0000ec80: 616d 706c 655f 7175 6572 790a 2020 2020  ample_query.    
-0000ec90: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000eca0: 6528 7361 6d70 6c65 5f71 7565 7279 2c20  e(sample_query, 
-0000ecb0: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-0000ecc0: 2020 2320 7265 736f 6c76 6520 7175 6572    # resolve quer
-0000ecd0: 7920 746f 2061 206c 6973 7420 6f66 2069  y to a list of i
-0000ece0: 6e74 6567 6572 7320 666f 7220 6d6f 7265  ntegers for more
-0000ecf0: 2063 6163 6865 2068 6974 7320 2d20 7765   cache hits - we
-0000ed00: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
-0000ed10: 6f20 7468 6973 2062 6563 6175 7365 2074  o this because t
-0000ed20: 6865 7265 2061 7265 2064 6966 6665 7265  here are differe
-0000ed30: 6e74 2077 6179 7320 746f 2077 7269 7465  nt ways to write
-0000ed40: 2074 6865 2073 616d 6520 7061 6e64 6173   the same pandas
-0000ed50: 0a20 2020 2020 2020 2020 2020 2023 2071  .            # q
-0000ed60: 7565 7279 2c20 616e 6420 736f 2069 7427  uery, and so it'
-0000ed70: 7320 6265 7474 6572 2074 6f20 6576 616c  s better to eval
-0000ed80: 7561 7465 2074 6865 2071 7565 7279 2061  uate the query a
-0000ed90: 6e64 2075 7365 2061 206c 6973 7420 6f66  nd use a list of
-0000eda0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-0000edb0: 6e74 6567 6572 2069 6e64 6963 6573 2069  nteger indices i
-0000edc0: 6e73 7465 6164 0a20 2020 2020 2020 2020  nstead.         
-0000edd0: 2020 2064 665f 7361 6d70 6c65 7320 3d20     df_samples = 
-0000ede0: 7365 6c66 2e73 616d 706c 655f 6d65 7461  self.sample_meta
-0000edf0: 6461 7461 2873 616d 706c 655f 7365 7473  data(sample_sets
-0000ee00: 3d73 616d 706c 655f 7365 7473 290a 2020  =sample_sets).  
-0000ee10: 2020 2020 2020 2020 2020 6c6f 635f 7361            loc_sa
-0000ee20: 6d70 6c65 7320 3d20 6466 5f73 616d 706c  mples = df_sampl
-0000ee30: 6573 2e65 7661 6c28 7361 6d70 6c65 5f71  es.eval(sample_q
-0000ee40: 7565 7279 292e 7661 6c75 6573 0a20 2020  uery).values.   
-0000ee50: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
-0000ee60: 7175 6572 7920 3d20 6e70 2e6e 6f6e 7a65  query = np.nonze
-0000ee70: 726f 286c 6f63 5f73 616d 706c 6573 295b  ro(loc_samples)[
-0000ee80: 305d 2e74 6f6c 6973 7428 290a 0a20 2020  0].tolist()..   
-0000ee90: 2020 2020 2072 6574 7572 6e20 7361 6d70       return samp
-0000eea0: 6c65 5f73 6574 732c 2073 616d 706c 655f  le_sets, sample_
-0000eeb0: 7175 6572 790a 0a20 2020 2040 646f 6328  query..    @doc(
-0000eec0: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-0000eed0: 3d22 4f70 656e 2053 4e50 2067 656e 6f74  ="Open SNP genot
-0000eee0: 7970 6573 207a 6172 7220 666f 7220 6120  ypes zarr for a 
-0000eef0: 6769 7665 6e20 7361 6d70 6c65 2073 6574  given sample set
-0000ef00: 2e22 2c0a 2020 2020 2020 2020 7265 7475  .",.        retu
-0000ef10: 726e 733d 225a 6172 7220 6869 6572 6172  rns="Zarr hierar
-0000ef20: 6368 792e 222c 0a20 2020 2029 0a20 2020  chy.",.    ).   
-0000ef30: 2064 6566 206f 7065 6e5f 736e 705f 6765   def open_snp_ge
-0000ef40: 6e6f 7479 7065 7328 0a20 2020 2020 2020  notypes(.       
-0000ef50: 2073 656c 662c 2073 616d 706c 655f 7365   self, sample_se
-0000ef60: 743a 2062 6173 655f 7061 7261 6d73 2e73  t: base_params.s
-0000ef70: 616d 706c 655f 7365 740a 2020 2020 2920  ample_set.    ) 
-0000ef80: 2d3e 207a 6172 722e 6869 6572 6172 6368  -> zarr.hierarch
-0000ef90: 792e 4772 6f75 703a 0a20 2020 2020 2020  y.Group:.       
-0000efa0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000efb0: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-0000efc0: 6163 6865 5f73 6e70 5f67 656e 6f74 7970  ache_snp_genotyp
-0000efd0: 6573 5b73 616d 706c 655f 7365 745d 0a20  es[sample_set]. 
-0000efe0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-0000eff0: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
-0000f000: 2020 2020 7265 6c65 6173 6520 3d20 7365      release = se
-0000f010: 6c66 2e6c 6f6f 6b75 705f 7265 6c65 6173  lf.lookup_releas
-0000f020: 6528 7361 6d70 6c65 5f73 6574 3d73 616d  e(sample_set=sam
-0000f030: 706c 655f 7365 7429 0a20 2020 2020 2020  ple_set).       
-0000f040: 2020 2020 2072 656c 6561 7365 5f70 6174       release_pat
-0000f050: 6820 3d20 7365 6c66 2e5f 7265 6c65 6173  h = self._releas
-0000f060: 655f 746f 5f70 6174 6828 7265 6c65 6173  e_to_path(releas
-0000f070: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-0000f080: 6174 6820 3d20 6622 7b73 656c 662e 5f62  ath = f"{self._b
-0000f090: 6173 655f 7061 7468 7d2f 7b72 656c 6561  ase_path}/{relea
-0000f0a0: 7365 5f70 6174 687d 2f73 6e70 5f67 656e  se_path}/snp_gen
-0000f0b0: 6f74 7970 6573 2f61 6c6c 2f7b 7361 6d70  otypes/all/{samp
-0000f0c0: 6c65 5f73 6574 7d2f 220a 2020 2020 2020  le_set}/".      
-0000f0d0: 2020 2020 2020 7374 6f72 6520 3d20 696e        store = in
-0000f0e0: 6974 5f7a 6172 725f 7374 6f72 6528 6673  it_zarr_store(fs
-0000f0f0: 3d73 656c 662e 5f66 732c 2070 6174 683d  =self._fs, path=
-0000f100: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
-0000f110: 2020 726f 6f74 203d 207a 6172 722e 6f70    root = zarr.op
-0000f120: 656e 5f63 6f6e 736f 6c69 6461 7465 6428  en_consolidated(
-0000f130: 7374 6f72 653d 7374 6f72 6529 0a20 2020  store=store).   
-0000f140: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000f150: 6163 6865 5f73 6e70 5f67 656e 6f74 7970  ache_snp_genotyp
-0000f160: 6573 5b73 616d 706c 655f 7365 745d 203d  es[sample_set] =
-0000f170: 2072 6f6f 740a 2020 2020 2020 2020 2020   root.          
-0000f180: 2020 7265 7475 726e 2072 6f6f 740a 0a20    return root.. 
-0000f190: 2020 2064 6566 205f 736e 705f 6765 6e6f     def _snp_geno
-0000f1a0: 7479 7065 735f 666f 725f 636f 6e74 6967  types_for_contig
-0000f1b0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000f1c0: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
-0000f1d0: 2020 2063 6f6e 7469 673a 2073 7472 2c0a     contig: str,.
-0000f1e0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-0000f1f0: 6574 3a20 7374 722c 0a20 2020 2020 2020  et: str,.       
-0000f200: 2066 6965 6c64 3a20 7374 722c 0a20 2020   field: str,.   
-0000f210: 2020 2020 2069 6e6c 696e 655f 6172 7261       inline_arra
-0000f220: 793a 2062 6f6f 6c2c 0a20 2020 2020 2020  y: bool,.       
-0000f230: 2063 6875 6e6b 733a 2073 7472 2c0a 2020   chunks: str,.  
-0000f240: 2020 2920 2d3e 2064 612e 4172 7261 793a    ) -> da.Array:
-0000f250: 0a20 2020 2020 2020 2022 2222 4163 6365  .        """Acce
-0000f260: 7373 2053 4e50 2067 656e 6f74 7970 6573  ss SNP genotypes
-0000f270: 2066 6f72 2061 2073 696e 676c 6520 636f   for a single co
-0000f280: 6e74 6967 2061 6e64 2061 2073 696e 676c  ntig and a singl
-0000f290: 6520 7361 6d70 6c65 2073 6574 2e22 2222  e sample set."""
-0000f2a0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0000f2b0: 6973 696e 7374 616e 6365 2863 6f6e 7469  isinstance(conti
-0000f2c0: 672c 2073 7472 290a 2020 2020 2020 2020  g, str).        
-0000f2d0: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-0000f2e0: 6528 7361 6d70 6c65 5f73 6574 2c20 7374  e(sample_set, st
-0000f2f0: 7229 0a20 2020 2020 2020 2072 6f6f 7420  r).        root 
-0000f300: 3d20 7365 6c66 2e6f 7065 6e5f 736e 705f  = self.open_snp_
-0000f310: 6765 6e6f 7479 7065 7328 7361 6d70 6c65  genotypes(sample
-0000f320: 5f73 6574 3d73 616d 706c 655f 7365 7429  _set=sample_set)
-0000f330: 0a20 2020 2020 2020 207a 203d 2072 6f6f  .        z = roo
-0000f340: 745b 6622 7b63 6f6e 7469 677d 2f63 616c  t[f"{contig}/cal
-0000f350: 6c64 6174 612f 7b66 6965 6c64 7d22 5d0a  ldata/{field}"].
-0000f360: 2020 2020 2020 2020 6420 3d20 6461 5f66          d = da_f
-0000f370: 726f 6d5f 7a61 7272 287a 2c20 696e 6c69  rom_zarr(z, inli
-0000f380: 6e65 5f61 7272 6179 3d69 6e6c 696e 655f  ne_array=inline_
-0000f390: 6172 7261 792c 2063 6875 6e6b 733d 6368  array, chunks=ch
-0000f3a0: 756e 6b73 290a 0a20 2020 2020 2020 2072  unks)..        r
-0000f3b0: 6574 7572 6e20 640a 0a20 2020 2040 646f  eturn d..    @do
-0000f3c0: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
-0000f3d0: 7279 3d22 4163 6365 7373 2053 4e50 2067  ry="Access SNP g
-0000f3e0: 656e 6f74 7970 6573 2061 6e64 2061 7373  enotypes and ass
-0000f3f0: 6f63 6961 7465 6420 6461 7461 2e22 2c0a  ociated data.",.
-0000f400: 2020 2020 2020 2020 7265 7475 726e 733d          returns=
-0000f410: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0000f420: 416e 2061 7272 6179 206f 6620 6569 7468  An array of eith
-0000f430: 6572 2067 656e 6f74 7970 6573 2028 4754  er genotypes (GT
-0000f440: 292c 2067 656e 6f74 7970 6520 7175 616c  ), genotype qual
-0000f450: 6974 7920 2847 5129 2c20 616c 6c65 6c65  ity (GQ), allele
-0000f460: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-0000f470: 7468 7320 2841 4429 206f 7220 6d61 7070  ths (AD) or mapp
-0000f480: 696e 6720 7175 616c 6974 7920 284d 5129  ing quality (MQ)
-0000f490: 2076 616c 7565 732e 0a20 2020 2020 2020   values..       
-0000f4a0: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
-0000f4b0: 6465 6620 736e 705f 6765 6e6f 7479 7065  def snp_genotype
-0000f4c0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0000f4d0: 0a20 2020 2020 2020 2072 6567 696f 6e3a  .        region:
-0000f4e0: 2062 6173 655f 7061 7261 6d73 2e72 6567   base_params.reg
-0000f4f0: 696f 6e2c 0a20 2020 2020 2020 2073 616d  ion,.        sam
-0000f500: 706c 655f 7365 7473 3a20 4f70 7469 6f6e  ple_sets: Option
-0000f510: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-0000f520: 616d 706c 655f 7365 7473 5d20 3d20 4e6f  ample_sets] = No
-0000f530: 6e65 2c0a 2020 2020 2020 2020 7361 6d70  ne,.        samp
-0000f540: 6c65 5f71 7565 7279 3a20 4f70 7469 6f6e  le_query: Option
-0000f550: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-0000f560: 616d 706c 655f 7175 6572 795d 203d 204e  ample_query] = N
-0000f570: 6f6e 652c 0a20 2020 2020 2020 2066 6965  one,.        fie
-0000f580: 6c64 3a20 6261 7365 5f70 6172 616d 732e  ld: base_params.
-0000f590: 6669 656c 6420 3d20 2247 5422 2c0a 2020  field = "GT",.  
-0000f5a0: 2020 2020 2020 7369 7465 5f6d 6173 6b3a        site_mask:
-0000f5b0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-0000f5c0: 6172 616d 732e 7369 7465 5f6d 6173 6b5d  arams.site_mask]
-0000f5d0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000f5e0: 2069 6e6c 696e 655f 6172 7261 793a 2062   inline_array: b
-0000f5f0: 6173 655f 7061 7261 6d73 2e69 6e6c 696e  ase_params.inlin
-0000f600: 655f 6172 7261 7920 3d20 6261 7365 5f70  e_array = base_p
-0000f610: 6172 616d 732e 696e 6c69 6e65 5f61 7272  arams.inline_arr
-0000f620: 6179 5f64 6566 6175 6c74 2c0a 2020 2020  ay_default,.    
-0000f630: 2020 2020 6368 756e 6b73 3a20 6261 7365      chunks: base
-0000f640: 5f70 6172 616d 732e 6368 756e 6b73 203d  _params.chunks =
-0000f650: 2062 6173 655f 7061 7261 6d73 2e63 6875   base_params.chu
-0000f660: 6e6b 735f 6465 6661 756c 742c 0a20 2020  nks_default,.   
-0000f670: 2029 202d 3e20 6461 2e41 7272 6179 3a0a   ) -> da.Array:.
-0000f680: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-0000f690: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-0000f6a0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-0000f6b0: 6e6f 726d 616c 6973 6520 7061 7261 6d65  normalise parame
-0000f6c0: 7465 7273 2229 0a20 2020 2020 2020 2073  ters").        s
-0000f6d0: 616d 706c 655f 7365 7473 203d 2073 656c  ample_sets = sel
-0000f6e0: 662e 5f70 7265 705f 7361 6d70 6c65 5f73  f._prep_sample_s
-0000f6f0: 6574 735f 7061 7261 6d28 7361 6d70 6c65  ets_param(sample
-0000f700: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
-0000f710: 7329 0a20 2020 2020 2020 2072 6573 6f6c  s).        resol
-0000f720: 7665 645f 7265 6769 6f6e 203d 2073 656c  ved_region = sel
-0000f730: 662e 7265 736f 6c76 655f 7265 6769 6f6e  f.resolve_region
-0000f740: 2872 6567 696f 6e29 0a20 2020 2020 2020  (region).       
-0000f750: 2064 656c 2072 6567 696f 6e0a 0a20 2020   del region..   
-0000f760: 2020 2020 2064 6562 7567 2822 6e6f 726d       debug("norm
-0000f770: 616c 6973 6520 7265 6769 6f6e 2074 6f20  alise region to 
-0000f780: 6c69 7374 2074 6f20 7369 6d70 6c69 6679  list to simplify
-0000f790: 2063 6f6e 6361 7465 6e61 7469 6f6e 206c   concatenation l
-0000f7a0: 6f67 6963 2229 0a20 2020 2020 2020 2069  ogic").        i
-0000f7b0: 6620 6973 696e 7374 616e 6365 2872 6573  f isinstance(res
-0000f7c0: 6f6c 7665 645f 7265 6769 6f6e 2c20 5265  olved_region, Re
-0000f7d0: 6769 6f6e 293a 0a20 2020 2020 2020 2020  gion):.         
-0000f7e0: 2020 2072 6573 6f6c 7665 645f 7265 6769     resolved_regi
-0000f7f0: 6f6e 203d 205b 7265 736f 6c76 6564 5f72  on = [resolved_r
-0000f800: 6567 696f 6e5d 0a0a 2020 2020 2020 2020  egion]..        
-0000f810: 6465 6275 6728 2263 6f6e 6361 7465 6e61  debug("concatena
-0000f820: 7465 206d 756c 7469 706c 6520 7361 6d70  te multiple samp
-0000f830: 6c65 2073 6574 7320 616e 642f 6f72 2063  le sets and/or c
-0000f840: 6f6e 7469 6773 2229 0a20 2020 2020 2020  ontigs").       
-0000f850: 206c 7820 3d20 5b5d 0a20 2020 2020 2020   lx = [].       
-0000f860: 2066 6f72 2072 2069 6e20 7265 736f 6c76   for r in resolv
-0000f870: 6564 5f72 6567 696f 6e3a 0a20 2020 2020  ed_region:.     
-0000f880: 2020 2020 2020 206c 7920 3d20 5b5d 0a0a         ly = []..
-0000f890: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000f8a0: 7320 696e 2073 616d 706c 655f 7365 7473  s in sample_sets
-0000f8b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f8c0: 2020 7920 3d20 7365 6c66 2e5f 736e 705f    y = self._snp_
-0000f8d0: 6765 6e6f 7479 7065 735f 666f 725f 636f  genotypes_for_co
-0000f8e0: 6e74 6967 280a 2020 2020 2020 2020 2020  ntig(.          
-0000f8f0: 2020 2020 2020 2020 2020 636f 6e74 6967            contig
-0000f900: 3d72 2e63 6f6e 7469 672c 0a20 2020 2020  =r.contig,.     
-0000f910: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f920: 616d 706c 655f 7365 743d 732c 0a20 2020  ample_set=s,.   
-0000f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f940: 2066 6965 6c64 3d66 6965 6c64 2c0a 2020   field=field,.  
-0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f960: 2020 696e 6c69 6e65 5f61 7272 6179 3d69    inline_array=i
-0000f970: 6e6c 696e 655f 6172 7261 792c 0a20 2020  nline_array,.   
-0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f990: 2063 6875 6e6b 733d 6368 756e 6b73 2c0a   chunks=chunks,.
-0000f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000f9c0: 2020 6c79 2e61 7070 656e 6428 7929 0a0a    ly.append(y)..
-0000f9d0: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-0000f9e0: 6728 2263 6f6e 6361 7465 6e61 7465 2064  g("concatenate d
-0000f9f0: 6174 6120 6672 6f6d 206d 756c 7469 706c  ata from multipl
-0000fa00: 6520 7361 6d70 6c65 2073 6574 7322 290a  e sample sets").
-0000fa10: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-0000fa20: 6461 2e63 6f6e 6361 7465 6e61 7465 286c  da.concatenate(l
-0000fa30: 792c 2061 7869 733d 3129 0a0a 2020 2020  y, axis=1)..    
-0000fa40: 2020 2020 2020 2020 6465 6275 6728 226c          debug("l
-0000fa50: 6f63 6174 6520 7265 6769 6f6e 202d 2064  ocate region - d
-0000fa60: 6f20 7468 6973 206f 6e6c 7920 6f6e 6365  o this only once
-0000fa70: 2c20 6f70 7469 6d69 7361 7469 6f6e 2229  , optimisation")
-0000fa80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000fa90: 722e 7374 6172 7420 6f72 2072 2e65 6e64  r.start or r.end
-0000faa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fab0: 2020 706f 7320 3d20 7365 6c66 2e73 6e70    pos = self.snp
-0000fac0: 5f73 6974 6573 2872 6567 696f 6e3d 722e  _sites(region=r.
-0000fad0: 636f 6e74 6967 2c20 6669 656c 643d 2250  contig, field="P
-0000fae0: 4f53 2229 0a20 2020 2020 2020 2020 2020  OS").           
-0000faf0: 2020 2020 206c 6f63 5f72 6567 696f 6e20       loc_region 
-0000fb00: 3d20 6c6f 6361 7465 5f72 6567 696f 6e28  = locate_region(
-0000fb10: 722c 2070 6f73 290a 2020 2020 2020 2020  r, pos).        
-0000fb20: 2020 2020 2020 2020 7820 3d20 785b 6c6f          x = x[lo
-0000fb30: 635f 7265 6769 6f6e 5d0a 0a20 2020 2020  c_region]..     
-0000fb40: 2020 2020 2020 206c 782e 6170 7065 6e64         lx.append
-0000fb50: 2878 290a 0a20 2020 2020 2020 2064 6562  (x)..        deb
-0000fb60: 7567 2822 636f 6e63 6174 656e 6174 6520  ug("concatenate 
-0000fb70: 6461 7461 2066 726f 6d20 6d75 6c74 6970  data from multip
-0000fb80: 6c65 2072 6567 696f 6e73 2229 0a20 2020  le regions").   
-0000fb90: 2020 2020 2064 203d 2064 612e 636f 6e63       d = da.conc
-0000fba0: 6174 656e 6174 6528 6c78 2c20 6178 6973  atenate(lx, axis
-0000fbb0: 3d30 290a 0a20 2020 2020 2020 2064 6562  =0)..        deb
-0000fbc0: 7567 2822 6170 706c 7920 7369 7465 2066  ug("apply site f
-0000fbd0: 696c 7465 7273 2069 6620 7265 7175 6573  ilters if reques
-0000fbe0: 7465 6422 290a 2020 2020 2020 2020 6966  ted").        if
-0000fbf0: 2073 6974 655f 6d61 736b 2069 7320 6e6f   site_mask is no
-0000fc00: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000fc10: 2020 2020 6c6f 635f 7369 7465 7320 3d20      loc_sites = 
-0000fc20: 7365 6c66 2e73 6974 655f 6669 6c74 6572  self.site_filter
-0000fc30: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-0000fc40: 2020 2072 6567 696f 6e3d 7265 736f 6c76     region=resolv
-0000fc50: 6564 5f72 6567 696f 6e2c 0a20 2020 2020  ed_region,.     
-0000fc60: 2020 2020 2020 2020 2020 206d 6173 6b3d             mask=
-0000fc70: 7369 7465 5f6d 6173 6b2c 0a20 2020 2020  site_mask,.     
-0000fc80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000fc90: 2020 2020 2064 203d 2064 615f 636f 6d70       d = da_comp
-0000fca0: 7265 7373 286c 6f63 5f73 6974 6573 2c20  ress(loc_sites, 
-0000fcb0: 642c 2061 7869 733d 3029 0a0a 2020 2020  d, axis=0)..    
-0000fcc0: 2020 2020 6465 6275 6728 2261 7070 6c79      debug("apply
-0000fcd0: 2073 616d 706c 6520 7175 6572 7920 6966   sample query if
-0000fce0: 2072 6571 7565 7374 6564 2229 0a20 2020   requested").   
-0000fcf0: 2020 2020 2069 6620 7361 6d70 6c65 5f71       if sample_q
-0000fd00: 7565 7279 2069 7320 6e6f 7420 4e6f 6e65  uery is not None
-0000fd10: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-0000fd20: 5f73 616d 706c 6573 203d 2073 656c 662e  _samples = self.
-0000fd30: 7361 6d70 6c65 5f6d 6574 6164 6174 6128  sample_metadata(
-0000fd40: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
-0000fd50: 6c65 5f73 6574 7329 0a20 2020 2020 2020  le_sets).       
-0000fd60: 2020 2020 206c 6f63 5f73 616d 706c 6573       loc_samples
-0000fd70: 203d 2064 665f 7361 6d70 6c65 732e 6576   = df_samples.ev
-0000fd80: 616c 2873 616d 706c 655f 7175 6572 7929  al(sample_query)
-0000fd90: 2e76 616c 7565 730a 2020 2020 2020 2020  .values.        
-0000fda0: 2020 2020 6420 3d20 6461 2e63 6f6d 7072      d = da.compr
-0000fdb0: 6573 7328 6c6f 635f 7361 6d70 6c65 732c  ess(loc_samples,
-0000fdc0: 2064 2c20 6178 6973 3d31 290a 0a20 2020   d, axis=1)..   
-0000fdd0: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
-0000fde0: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
-0000fdf0: 2073 756d 6d61 7279 3d22 436f 6d70 7574   summary="Comput
-0000fe00: 6520 6765 6e6f 6d65 2061 6363 6573 7369  e genome accessi
-0000fe10: 6269 6c69 7479 2061 7272 6179 2e22 2c0a  bility array.",.
-0000fe20: 2020 2020 2020 2020 7265 7475 726e 733d          returns=
-0000fe30: 2241 6e20 6172 7261 7920 6f66 2062 6f6f  "An array of boo
-0000fe40: 6c65 616e 2076 616c 7565 7320 6964 656e  lean values iden
-0000fe50: 7469 6679 696e 6720 6163 6365 7373 6962  tifying accessib
-0000fe60: 6c65 2067 656e 6f6d 6520 7369 7465 732e  le genome sites.
-0000fe70: 222c 0a20 2020 2029 0a20 2020 2064 6566  ",.    ).    def
-0000fe80: 2069 735f 6163 6365 7373 6962 6c65 280a   is_accessible(.
-0000fe90: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000fea0: 2020 2020 2020 7265 6769 6f6e 3a20 6261        region: ba
-0000feb0: 7365 5f70 6172 616d 732e 7265 6769 6f6e  se_params.region
-0000fec0: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
-0000fed0: 6173 6b3a 2062 6173 655f 7061 7261 6d73  ask: base_params
-0000fee0: 2e73 6974 655f 6d61 736b 203d 2044 4546  .site_mask = DEF
-0000fef0: 4155 4c54 2c0a 2020 2020 2920 2d3e 206e  AULT,.    ) -> n
-0000ff00: 702e 6e64 6172 7261 793a 0a20 2020 2020  p.ndarray:.     
-0000ff10: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-0000ff20: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-0000ff30: 2020 2020 6465 6275 6728 2272 6573 6f6c      debug("resol
-0000ff40: 7665 2072 6567 696f 6e22 290a 2020 2020  ve region").    
-0000ff50: 2020 2020 7265 736f 6c76 6564 5f72 6567      resolved_reg
-0000ff60: 696f 6e20 3d20 7365 6c66 2e72 6573 6f6c  ion = self.resol
-0000ff70: 7665 5f72 6567 696f 6e28 7265 6769 6f6e  ve_region(region
-0000ff80: 290a 2020 2020 2020 2020 6465 6c20 7265  ).        del re
-0000ff90: 6769 6f6e 0a0a 2020 2020 2020 2020 6465  gion..        de
-0000ffa0: 6275 6728 2264 6574 6572 6d69 6e65 2063  bug("determine c
-0000ffb0: 6f6e 7469 6720 7365 7175 656e 6365 206c  ontig sequence l
-0000ffc0: 656e 6774 6822 290a 2020 2020 2020 2020  ength").        
-0000ffd0: 7365 715f 6c65 6e67 7468 203d 2073 656c  seq_length = sel
-0000ffe0: 662e 6765 6e6f 6d65 5f73 6571 7565 6e63  f.genome_sequenc
-0000fff0: 6528 7265 736f 6c76 6564 5f72 6567 696f  e(resolved_regio
-00010000: 6e29 2e73 6861 7065 5b30 5d0a 0a20 2020  n).shape[0]..   
-00010010: 2020 2020 2064 6562 7567 2822 7365 7420       debug("set 
-00010020: 7570 206f 7574 7075 7422 290a 2020 2020  up output").    
-00010030: 2020 2020 6973 5f61 6363 6573 7369 626c      is_accessibl
-00010040: 6520 3d20 6e70 2e7a 6572 6f73 2873 6571  e = np.zeros(seq
-00010050: 5f6c 656e 6774 682c 2064 7479 7065 3d62  _length, dtype=b
-00010060: 6f6f 6c29 0a0a 2020 2020 2020 2020 706f  ool)..        po
-00010070: 7320 3d20 7365 6c66 2e73 6e70 5f73 6974  s = self.snp_sit
-00010080: 6573 2872 6567 696f 6e3d 7265 736f 6c76  es(region=resolv
-00010090: 6564 5f72 6567 696f 6e2c 2066 6965 6c64  ed_region, field
-000100a0: 3d22 504f 5322 292e 636f 6d70 7574 6528  ="POS").compute(
-000100b0: 290a 2020 2020 2020 2020 6966 2072 6573  ).        if res
-000100c0: 6f6c 7665 645f 7265 6769 6f6e 2e73 7461  olved_region.sta
-000100d0: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-000100e0: 6f66 6673 6574 203d 2072 6573 6f6c 7665  offset = resolve
-000100f0: 645f 7265 6769 6f6e 2e73 7461 7274 0a20  d_region.start. 
-00010100: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00010110: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
-00010120: 3d20 310a 0a20 2020 2020 2020 2064 6562  = 1..        deb
-00010130: 7567 2822 6163 6365 7373 2073 6974 6520  ug("access site 
-00010140: 6669 6c74 6572 7322 290a 2020 2020 2020  filters").      
-00010150: 2020 6669 6c74 6572 5f70 6173 7320 3d20    filter_pass = 
-00010160: 7365 6c66 2e73 6974 655f 6669 6c74 6572  self.site_filter
-00010170: 7328 0a20 2020 2020 2020 2020 2020 2072  s(.            r
-00010180: 6567 696f 6e3d 7265 736f 6c76 6564 5f72  egion=resolved_r
-00010190: 6567 696f 6e2c 0a20 2020 2020 2020 2020  egion,.         
-000101a0: 2020 206d 6173 6b3d 7369 7465 5f6d 6173     mask=site_mas
-000101b0: 6b2c 0a20 2020 2020 2020 2029 2e63 6f6d  k,.        ).com
-000101c0: 7075 7465 2829 0a0a 2020 2020 2020 2020  pute()..        
-000101d0: 6465 6275 6728 2261 7373 6967 6e20 7661  debug("assign va
-000101e0: 6c75 6573 2066 726f 6d20 7369 7465 2066  lues from site f
-000101f0: 696c 7465 7273 2229 0a20 2020 2020 2020  ilters").       
-00010200: 2069 735f 6163 6365 7373 6962 6c65 5b70   is_accessible[p
-00010210: 6f73 202d 206f 6666 7365 745d 203d 2066  os - offset] = f
-00010220: 696c 7465 725f 7061 7373 0a0a 2020 2020  ilter_pass..    
-00010230: 2020 2020 7265 7475 726e 2069 735f 6163      return is_ac
-00010240: 6365 7373 6962 6c65 0a0a 2020 2020 6465  cessible..    de
-00010250: 6620 5f73 6e70 5f64 6628 7365 6c66 2c20  f _snp_df(self, 
-00010260: 2a2c 2074 7261 6e73 6372 6970 743a 2073  *, transcript: s
-00010270: 7472 2920 2d3e 2054 7570 6c65 5b52 6567  tr) -> Tuple[Reg
-00010280: 696f 6e2c 2070 642e 4461 7461 4672 616d  ion, pd.DataFram
-00010290: 655d 3a0a 2020 2020 2020 2020 2222 2253  e]:.        """S
-000102a0: 6574 2075 7020 6120 6461 7461 6672 616d  et up a datafram
-000102b0: 6520 7769 7468 2053 4e50 2073 6974 6520  e with SNP site 
-000102c0: 616e 6420 6669 6c74 6572 2063 6f6c 756d  and filter colum
-000102d0: 6e73 2e22 2222 0a20 2020 2020 2020 2064  ns.""".        d
-000102e0: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
-000102f0: 2e64 6562 7567 0a0a 2020 2020 2020 2020  .debug..        
-00010300: 6465 6275 6728 2267 6574 2066 6561 7475  debug("get featu
-00010310: 7265 2064 6972 6563 7420 6672 6f6d 2067  re direct from g
-00010320: 656e 6f6d 655f 6665 6174 7572 6573 2229  enome_features")
-00010330: 0a20 2020 2020 2020 2067 7320 3d20 7365  .        gs = se
-00010340: 6c66 2e67 656e 6f6d 655f 6665 6174 7572  lf.genome_featur
-00010350: 6573 2829 0a20 2020 2020 2020 2066 6561  es().        fea
-00010360: 7475 7265 203d 2067 735b 6773 5b22 4944  ture = gs[gs["ID
-00010370: 225d 203d 3d20 7472 616e 7363 7269 7074  "] == transcript
-00010380: 5d2e 7371 7565 657a 6528 290a 2020 2020  ].squeeze().    
-00010390: 2020 2020 6966 2066 6561 7475 7265 2e65      if feature.e
-000103a0: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
-000103b0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000103c0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-000103d0: 2020 2020 6622 4e6f 2067 656e 6f6d 6520      f"No genome 
-000103e0: 6665 6174 7572 6520 4944 2066 6f75 6e64  feature ID found
-000103f0: 206d 6174 6368 696e 6720 7472 616e 7363   matching transc
-00010400: 7269 7074 207b 7472 616e 7363 7269 7074  ript {transcript
-00010410: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
-00010420: 0a20 2020 2020 2020 2063 6f6e 7469 6720  .        contig 
-00010430: 3d20 6665 6174 7572 652e 636f 6e74 6967  = feature.contig
-00010440: 0a20 2020 2020 2020 2072 6567 696f 6e20  .        region 
-00010450: 3d20 5265 6769 6f6e 2863 6f6e 7469 672c  = Region(contig,
-00010460: 2066 6561 7475 7265 2e73 7461 7274 2c20   feature.start, 
-00010470: 6665 6174 7572 652e 656e 6429 0a0a 2020  feature.end)..  
-00010480: 2020 2020 2020 6465 6275 6728 2267 7261        debug("gra
-00010490: 6220 706f 732c 2072 6566 2061 6e64 2061  b pos, ref and a
-000104a0: 6c74 2066 6f72 2063 6872 6f6d 2061 726d  lt for chrom arm
-000104b0: 2066 726f 6d20 736e 705f 7369 7465 7322   from snp_sites"
-000104c0: 290a 2020 2020 2020 2020 706f 7320 3d20  ).        pos = 
-000104d0: 7365 6c66 2e73 6e70 5f73 6974 6573 2872  self.snp_sites(r
-000104e0: 6567 696f 6e3d 636f 6e74 6967 2c20 6669  egion=contig, fi
-000104f0: 656c 643d 2250 4f53 2229 0a20 2020 2020  eld="POS").     
-00010500: 2020 2072 6566 203d 2073 656c 662e 736e     ref = self.sn
-00010510: 705f 7369 7465 7328 7265 6769 6f6e 3d63  p_sites(region=c
-00010520: 6f6e 7469 672c 2066 6965 6c64 3d22 5245  ontig, field="RE
-00010530: 4622 290a 2020 2020 2020 2020 616c 7420  F").        alt 
-00010540: 3d20 7365 6c66 2e73 6e70 5f73 6974 6573  = self.snp_sites
-00010550: 2872 6567 696f 6e3d 636f 6e74 6967 2c20  (region=contig, 
-00010560: 6669 656c 643d 2241 4c54 2229 0a20 2020  field="ALT").   
-00010570: 2020 2020 206c 6f63 5f66 6561 7475 7265       loc_feature
-00010580: 203d 206c 6f63 6174 655f 7265 6769 6f6e   = locate_region
-00010590: 2872 6567 696f 6e2c 2070 6f73 290a 2020  (region, pos).  
-000105a0: 2020 2020 2020 706f 7320 3d20 706f 735b        pos = pos[
-000105b0: 6c6f 635f 6665 6174 7572 655d 2e63 6f6d  loc_feature].com
-000105c0: 7075 7465 2829 0a20 2020 2020 2020 2072  pute().        r
-000105d0: 6566 203d 2072 6566 5b6c 6f63 5f66 6561  ef = ref[loc_fea
-000105e0: 7475 7265 5d2e 636f 6d70 7574 6528 290a  ture].compute().
-000105f0: 2020 2020 2020 2020 616c 7420 3d20 616c          alt = al
-00010600: 745b 6c6f 635f 6665 6174 7572 655d 2e63  t[loc_feature].c
-00010610: 6f6d 7075 7465 2829 0a0a 2020 2020 2020  ompute()..      
-00010620: 2020 6465 6275 6728 2261 6363 6573 7320    debug("access 
-00010630: 7369 7465 2066 696c 7465 7273 2229 0a20  site filters"). 
-00010640: 2020 2020 2020 2066 696c 7465 725f 7061         filter_pa
-00010650: 7373 203d 2064 6963 7428 290a 2020 2020  ss = dict().    
-00010660: 2020 2020 6d61 736b 7320 3d20 7365 6c66      masks = self
-00010670: 2e73 6974 655f 6d61 736b 5f69 6473 0a20  .site_mask_ids. 
-00010680: 2020 2020 2020 2066 6f72 206d 2069 6e20         for m in 
-00010690: 6d61 736b 733a 0a20 2020 2020 2020 2020  masks:.         
-000106a0: 2020 2078 203d 2073 656c 662e 7369 7465     x = self.site
-000106b0: 5f66 696c 7465 7273 2872 6567 696f 6e3d  _filters(region=
-000106c0: 636f 6e74 6967 2c20 6d61 736b 3d6d 290a  contig, mask=m).
-000106d0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-000106e0: 785b 6c6f 635f 6665 6174 7572 655d 2e63  x[loc_feature].c
-000106f0: 6f6d 7075 7465 2829 0a20 2020 2020 2020  ompute().       
-00010700: 2020 2020 2066 696c 7465 725f 7061 7373       filter_pass
-00010710: 5b6d 5d20 3d20 780a 0a20 2020 2020 2020  [m] = x..       
-00010720: 2064 6562 7567 2822 7365 7420 7570 2063   debug("set up c
-00010730: 6f6c 756d 6e73 2077 6974 6820 636f 6e74  olumns with cont
-00010740: 6967 2c20 706f 732c 2072 6566 2c20 616c  ig, pos, ref, al
-00010750: 7420 636f 6c75 6d6e 7322 290a 2020 2020  t columns").    
-00010760: 2020 2020 636f 6c73 203d 207b 0a20 2020      cols = {.   
-00010770: 2020 2020 2020 2020 2022 636f 6e74 6967           "contig
-00010780: 223a 2063 6f6e 7469 672c 0a20 2020 2020  ": contig,.     
-00010790: 2020 2020 2020 2022 706f 7369 7469 6f6e         "position
-000107a0: 223a 206e 702e 7265 7065 6174 2870 6f73  ": np.repeat(pos
-000107b0: 2c20 3329 2c0a 2020 2020 2020 2020 2020  , 3),.          
-000107c0: 2020 2272 6566 5f61 6c6c 656c 6522 3a20    "ref_allele": 
-000107d0: 6e70 2e72 6570 6561 7428 7265 662e 6173  np.repeat(ref.as
-000107e0: 7479 7065 2822 5531 2229 2c20 3329 2c0a  type("U1"), 3),.
-000107f0: 2020 2020 2020 2020 2020 2020 2261 6c74              "alt
-00010800: 5f61 6c6c 656c 6522 3a20 616c 742e 6173  _allele": alt.as
-00010810: 7479 7065 2822 5531 2229 2e66 6c61 7474  type("U1").flatt
-00010820: 656e 2829 2c0a 2020 2020 2020 2020 7d0a  en(),.        }.
-00010830: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00010840: 6164 6420 6d61 736b 2063 6f6c 756d 6e73  add mask columns
-00010850: 2229 0a20 2020 2020 2020 2066 6f72 206d  ").        for m
-00010860: 2069 6e20 6d61 736b 733a 0a20 2020 2020   in masks:.     
-00010870: 2020 2020 2020 2078 203d 2066 696c 7465         x = filte
-00010880: 725f 7061 7373 5b6d 5d0a 2020 2020 2020  r_pass[m].      
-00010890: 2020 2020 2020 636f 6c73 5b66 2270 6173        cols[f"pas
-000108a0: 735f 7b6d 7d22 5d20 3d20 6e70 2e72 6570  s_{m}"] = np.rep
-000108b0: 6561 7428 782c 2033 290a 0a20 2020 2020  eat(x, 3)..     
-000108c0: 2020 2064 6562 7567 2822 636f 6e73 7472     debug("constr
-000108d0: 7563 7420 6461 7461 6672 616d 6522 290a  uct dataframe").
-000108e0: 2020 2020 2020 2020 6466 5f73 6e70 7320          df_snps 
-000108f0: 3d20 7064 2e44 6174 6146 7261 6d65 2863  = pd.DataFrame(c
-00010900: 6f6c 7329 0a0a 2020 2020 2020 2020 7265  ols)..        re
-00010910: 7475 726e 2072 6567 696f 6e2c 2064 665f  turn region, df_
-00010920: 736e 7073 0a0a 2020 2020 6465 6620 5f61  snps..    def _a
-00010930: 6e6e 6f74 6174 6f72 2873 656c 6629 3a0a  nnotator(self):.
-00010940: 2020 2020 2020 2020 2222 2253 6574 2075          """Set u
-00010950: 7020 7661 7269 616e 7420 6566 6665 6374  p variant effect
-00010960: 2061 6e6e 6f74 6174 6f72 2e22 2222 0a20   annotator.""". 
-00010970: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00010980: 6361 6368 655f 616e 6e6f 7461 746f 7220  cache_annotator 
-00010990: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000109a0: 2020 2020 2073 656c 662e 5f63 6163 6865       self._cache
-000109b0: 5f61 6e6e 6f74 6174 6f72 203d 2076 6566  _annotator = vef
-000109c0: 662e 416e 6e6f 7461 746f 7228 0a20 2020  f.Annotator(.   
-000109d0: 2020 2020 2020 2020 2020 2020 2067 656e               gen
-000109e0: 6f6d 653d 7365 6c66 2e6f 7065 6e5f 6765  ome=self.open_ge
-000109f0: 6e6f 6d65 2829 2c20 6765 6e6f 6d65 5f66  nome(), genome_f
-00010a00: 6561 7475 7265 733d 7365 6c66 2e67 656e  eatures=self.gen
-00010a10: 6f6d 655f 6665 6174 7572 6573 2829 0a20  ome_features(). 
-00010a20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00010a30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00010a40: 2e5f 6361 6368 655f 616e 6e6f 7461 746f  ._cache_annotato
-00010a50: 720a 0a20 2020 2040 646f 6328 0a20 2020  r..    @doc(.   
-00010a60: 2020 2020 2073 756d 6d61 7279 3d22 436f       summary="Co
-00010a70: 6d70 7574 6520 7661 7269 616e 7420 6566  mpute variant ef
-00010a80: 6665 6374 7320 666f 7220 6120 6765 6e65  fects for a gene
-00010a90: 2074 7261 6e73 6372 6970 742e 222c 0a20   transcript.",. 
-00010aa0: 2020 2020 2020 2072 6574 7572 6e73 3d22         returns="
-00010ab0: 2222 0a20 2020 2020 2020 2020 2020 2041  "".            A
-00010ac0: 2064 6174 6166 7261 6d65 206f 6620 616c   dataframe of al
-00010ad0: 6c20 706f 7373 6962 6c65 2053 4e50 2076  l possible SNP v
-00010ae0: 6172 6961 6e74 7320 616e 6420 7468 6569  ariants and thei
-00010af0: 7220 6566 6665 6374 732c 206f 6e65 2072  r effects, one r
-00010b00: 6f77 0a20 2020 2020 2020 2020 2020 2070  ow.            p
-00010b10: 6572 2076 6172 6961 6e74 2e0a 2020 2020  er variant..    
-00010b20: 2020 2020 2222 222c 0a20 2020 2029 0a20      """,.    ). 
-00010b30: 2020 2064 6566 2073 6e70 5f65 6666 6563     def snp_effec
-00010b40: 7473 280a 2020 2020 2020 2020 7365 6c66  ts(.        self
-00010b50: 2c0a 2020 2020 2020 2020 7472 616e 7363  ,.        transc
-00010b60: 7269 7074 3a20 6261 7365 5f70 6172 616d  ript: base_param
-00010b70: 732e 7472 616e 7363 7269 7074 2c0a 2020  s.transcript,.  
-00010b80: 2020 2020 2020 7369 7465 5f6d 6173 6b3a        site_mask:
-00010b90: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00010ba0: 6172 616d 732e 7369 7465 5f6d 6173 6b5d  arams.site_mask]
-00010bb0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00010bc0: 3e20 7064 2e44 6174 6146 7261 6d65 3a0a  > pd.DataFrame:.
-00010bd0: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-00010be0: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-00010bf0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00010c00: 7365 7475 7020 696e 6974 6961 6c20 6461  setup initial da
-00010c10: 7461 6672 616d 6520 6f66 2053 4e50 7322  taframe of SNPs"
-00010c20: 290a 2020 2020 2020 2020 5f2c 2064 665f  ).        _, df_
-00010c30: 736e 7073 203d 2073 656c 662e 5f73 6e70  snps = self._snp
-00010c40: 5f64 6628 7472 616e 7363 7269 7074 3d74  _df(transcript=t
-00010c50: 7261 6e73 6372 6970 7429 0a0a 2020 2020  ranscript)..    
-00010c60: 2020 2020 6465 6275 6728 2273 6574 7570      debug("setup
-00010c70: 2076 6172 6961 6e74 2065 6666 6563 7420   variant effect 
-00010c80: 616e 6e6f 7461 746f 7222 290a 2020 2020  annotator").    
-00010c90: 2020 2020 616e 6e20 3d20 7365 6c66 2e5f      ann = self._
-00010ca0: 616e 6e6f 7461 746f 7228 290a 0a20 2020  annotator()..   
-00010cb0: 2020 2020 2064 6562 7567 2822 6170 706c       debug("appl
-00010cc0: 7920 6d61 736b 2069 6620 7265 7175 6573  y mask if reques
-00010cd0: 7465 6422 290a 2020 2020 2020 2020 6966  ted").        if
-00010ce0: 2073 6974 655f 6d61 736b 2069 7320 6e6f   site_mask is no
-00010cf0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00010d00: 2020 2020 6c6f 635f 7369 7465 7320 3d20      loc_sites = 
-00010d10: 6466 5f73 6e70 735b 6622 7061 7373 5f7b  df_snps[f"pass_{
-00010d20: 7369 7465 5f6d 6173 6b7d 225d 0a20 2020  site_mask}"].   
-00010d30: 2020 2020 2020 2020 2064 665f 736e 7073           df_snps
-00010d40: 203d 2064 665f 736e 7073 2e6c 6f63 5b6c   = df_snps.loc[l
-00010d50: 6f63 5f73 6974 6573 5d0a 0a20 2020 2020  oc_sites]..     
-00010d60: 2020 2064 6562 7567 2822 7265 7365 7420     debug("reset 
-00010d70: 696e 6465 7820 6166 7465 7220 6669 6c74  index after filt
-00010d80: 6572 696e 6722 290a 2020 2020 2020 2020  ering").        
-00010d90: 6466 5f73 6e70 732e 7265 7365 745f 696e  df_snps.reset_in
-00010da0: 6465 7828 696e 706c 6163 653d 5472 7565  dex(inplace=True
-00010db0: 2c20 6472 6f70 3d54 7275 6529 0a0a 2020  , drop=True)..  
-00010dc0: 2020 2020 2020 6465 6275 6728 2261 6464        debug("add
-00010dd0: 2065 6666 6563 7473 2074 6f20 7468 6520   effects to the 
-00010de0: 6461 7461 6672 616d 6522 290a 2020 2020  dataframe").    
-00010df0: 2020 2020 616e 6e2e 6765 745f 6566 6665      ann.get_effe
-00010e00: 6374 7328 7472 616e 7363 7269 7074 3d74  cts(transcript=t
-00010e10: 7261 6e73 6372 6970 742c 2076 6172 6961  ranscript, varia
-00010e20: 6e74 733d 6466 5f73 6e70 7329 0a0a 2020  nts=df_snps)..  
-00010e30: 2020 2020 2020 7265 7475 726e 2064 665f        return df_
-00010e40: 736e 7073 0a0a 2020 2020 6465 6620 5f73  snps..    def _s
-00010e50: 6e70 5f76 6172 6961 6e74 735f 666f 725f  np_variants_for_
-00010e60: 636f 6e74 6967 2873 656c 662c 202a 2c20  contig(self, *, 
-00010e70: 636f 6e74 6967 2c20 696e 6c69 6e65 5f61  contig, inline_a
-00010e80: 7272 6179 2c20 6368 756e 6b73 293a 0a20  rray, chunks):. 
-00010e90: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
-00010ea0: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
-00010eb0: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
-00010ec0: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-00010ed0: 6461 7461 5f76 6172 7320 3d20 6469 6374  data_vars = dict
-00010ee0: 2829 0a0a 2020 2020 2020 2020 6465 6275  ()..        debu
-00010ef0: 6728 2276 6172 6961 6e74 2061 7272 6179  g("variant array
-00010f00: 7322 290a 2020 2020 2020 2020 7369 7465  s").        site
-00010f10: 735f 726f 6f74 203d 2073 656c 662e 6f70  s_root = self.op
-00010f20: 656e 5f73 6e70 5f73 6974 6573 2829 0a0a  en_snp_sites()..
-00010f30: 2020 2020 2020 2020 6465 6275 6728 2276          debug("v
-00010f40: 6172 6961 6e74 5f70 6f73 6974 696f 6e22  ariant_position"
-00010f50: 290a 2020 2020 2020 2020 706f 735f 7a20  ).        pos_z 
-00010f60: 3d20 7369 7465 735f 726f 6f74 5b66 227b  = sites_root[f"{
-00010f70: 636f 6e74 6967 7d2f 7661 7269 616e 7473  contig}/variants
-00010f80: 2f50 4f53 225d 0a20 2020 2020 2020 2076  /POS"].        v
-00010f90: 6172 6961 6e74 5f70 6f73 6974 696f 6e20  ariant_position 
-00010fa0: 3d20 6461 5f66 726f 6d5f 7a61 7272 2870  = da_from_zarr(p
-00010fb0: 6f73 5f7a 2c20 696e 6c69 6e65 5f61 7272  os_z, inline_arr
-00010fc0: 6179 3d69 6e6c 696e 655f 6172 7261 792c  ay=inline_array,
-00010fd0: 2063 6875 6e6b 733d 6368 756e 6b73 290a   chunks=chunks).
-00010fe0: 2020 2020 2020 2020 636f 6f72 6473 5b22          coords["
-00010ff0: 7661 7269 616e 745f 706f 7369 7469 6f6e  variant_position
-00011000: 225d 203d 205b 4449 4d5f 5641 5249 414e  "] = [DIM_VARIAN
-00011010: 545d 2c20 7661 7269 616e 745f 706f 7369  T], variant_posi
-00011020: 7469 6f6e 0a0a 2020 2020 2020 2020 6465  tion..        de
-00011030: 6275 6728 2276 6172 6961 6e74 5f61 6c6c  bug("variant_all
-00011040: 656c 6522 290a 2020 2020 2020 2020 7265  ele").        re
-00011050: 665f 7a20 3d20 7369 7465 735f 726f 6f74  f_z = sites_root
-00011060: 5b66 227b 636f 6e74 6967 7d2f 7661 7269  [f"{contig}/vari
-00011070: 616e 7473 2f52 4546 225d 0a20 2020 2020  ants/REF"].     
-00011080: 2020 2061 6c74 5f7a 203d 2073 6974 6573     alt_z = sites
-00011090: 5f72 6f6f 745b 6622 7b63 6f6e 7469 677d  _root[f"{contig}
-000110a0: 2f76 6172 6961 6e74 732f 414c 5422 5d0a  /variants/ALT"].
-000110b0: 2020 2020 2020 2020 7265 6620 3d20 6461          ref = da
-000110c0: 5f66 726f 6d5f 7a61 7272 2872 6566 5f7a  _from_zarr(ref_z
-000110d0: 2c20 696e 6c69 6e65 5f61 7272 6179 3d69  , inline_array=i
-000110e0: 6e6c 696e 655f 6172 7261 792c 2063 6875  nline_array, chu
-000110f0: 6e6b 733d 6368 756e 6b73 290a 2020 2020  nks=chunks).    
-00011100: 2020 2020 616c 7420 3d20 6461 5f66 726f      alt = da_fro
-00011110: 6d5f 7a61 7272 2861 6c74 5f7a 2c20 696e  m_zarr(alt_z, in
-00011120: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
-00011130: 655f 6172 7261 792c 2063 6875 6e6b 733d  e_array, chunks=
-00011140: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
-00011150: 7661 7269 616e 745f 616c 6c65 6c65 203d  variant_allele =
-00011160: 2064 612e 636f 6e63 6174 656e 6174 6528   da.concatenate(
-00011170: 5b72 6566 5b3a 2c20 4e6f 6e65 5d2c 2061  [ref[:, None], a
-00011180: 6c74 5d2c 2061 7869 733d 3129 0a20 2020  lt], axis=1).   
-00011190: 2020 2020 2064 6174 615f 7661 7273 5b22       data_vars["
-000111a0: 7661 7269 616e 745f 616c 6c65 6c65 225d  variant_allele"]
-000111b0: 203d 205b 4449 4d5f 5641 5249 414e 542c   = [DIM_VARIANT,
-000111c0: 2044 494d 5f41 4c4c 454c 455d 2c20 7661   DIM_ALLELE], va
-000111d0: 7269 616e 745f 616c 6c65 6c65 0a0a 2020  riant_allele..  
-000111e0: 2020 2020 2020 6465 6275 6728 2276 6172        debug("var
-000111f0: 6961 6e74 5f63 6f6e 7469 6722 290a 2020  iant_contig").  
-00011200: 2020 2020 2020 636f 6e74 6967 5f69 6e64        contig_ind
-00011210: 6578 203d 2073 656c 662e 636f 6e74 6967  ex = self.contig
-00011220: 732e 696e 6465 7828 636f 6e74 6967 290a  s.index(contig).
-00011230: 2020 2020 2020 2020 7661 7269 616e 745f          variant_
-00011240: 636f 6e74 6967 203d 2064 612e 6675 6c6c  contig = da.full
-00011250: 5f6c 696b 6528 0a20 2020 2020 2020 2020  _like(.         
-00011260: 2020 2076 6172 6961 6e74 5f70 6f73 6974     variant_posit
-00011270: 696f 6e2c 2066 696c 6c5f 7661 6c75 653d  ion, fill_value=
-00011280: 636f 6e74 6967 5f69 6e64 6578 2c20 6474  contig_index, dt
-00011290: 7970 653d 2275 3122 0a20 2020 2020 2020  ype="u1".       
-000112a0: 2029 0a20 2020 2020 2020 2063 6f6f 7264   ).        coord
-000112b0: 735b 2276 6172 6961 6e74 5f63 6f6e 7469  s["variant_conti
-000112c0: 6722 5d20 3d20 5b44 494d 5f56 4152 4941  g"] = [DIM_VARIA
-000112d0: 4e54 5d2c 2076 6172 6961 6e74 5f63 6f6e  NT], variant_con
-000112e0: 7469 670a 0a20 2020 2020 2020 2064 6562  tig..        deb
-000112f0: 7567 2822 7369 7465 2066 696c 7465 7273  ug("site filters
-00011300: 2061 7272 6179 7322 290a 2020 2020 2020   arrays").      
-00011310: 2020 666f 7220 6d61 736b 2069 6e20 7365    for mask in se
-00011320: 6c66 2e73 6974 655f 6d61 736b 5f69 6473  lf.site_mask_ids
-00011330: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
-00011340: 6c74 6572 735f 726f 6f74 203d 2073 656c  lters_root = sel
-00011350: 662e 6f70 656e 5f73 6974 655f 6669 6c74  f.open_site_filt
-00011360: 6572 7328 6d61 736b 3d6d 6173 6b29 0a20  ers(mask=mask). 
-00011370: 2020 2020 2020 2020 2020 207a 203d 2066             z = f
-00011380: 696c 7465 7273 5f72 6f6f 745b 6622 7b63  ilters_root[f"{c
-00011390: 6f6e 7469 677d 2f76 6172 6961 6e74 732f  ontig}/variants/
-000113a0: 6669 6c74 6572 5f70 6173 7322 5d0a 2020  filter_pass"].  
-000113b0: 2020 2020 2020 2020 2020 6420 3d20 6461            d = da
-000113c0: 5f66 726f 6d5f 7a61 7272 287a 2c20 696e  _from_zarr(z, in
-000113d0: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
-000113e0: 655f 6172 7261 792c 2063 6875 6e6b 733d  e_array, chunks=
-000113f0: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
-00011400: 2020 2020 6461 7461 5f76 6172 735b 6622      data_vars[f"
-00011410: 7661 7269 616e 745f 6669 6c74 6572 5f70  variant_filter_p
-00011420: 6173 735f 7b6d 6173 6b7d 225d 203d 205b  ass_{mask}"] = [
-00011430: 4449 4d5f 5641 5249 414e 545d 2c20 640a  DIM_VARIANT], d.
-00011440: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00011450: 7365 7420 7570 2061 7474 7269 6275 7465  set up attribute
-00011460: 7322 290a 2020 2020 2020 2020 6174 7472  s").        attr
-00011470: 7320 3d20 7b22 636f 6e74 6967 7322 3a20  s = {"contigs": 
-00011480: 7365 6c66 2e63 6f6e 7469 6773 7d0a 0a20  self.contigs}.. 
-00011490: 2020 2020 2020 2064 6562 7567 2822 6372         debug("cr
-000114a0: 6561 7465 2061 2064 6174 6173 6574 2229  eate a dataset")
-000114b0: 0a20 2020 2020 2020 2064 7320 3d20 7872  .        ds = xr
-000114c0: 2e44 6174 6173 6574 2864 6174 615f 7661  .Dataset(data_va
-000114d0: 7273 3d64 6174 615f 7661 7273 2c20 636f  rs=data_vars, co
-000114e0: 6f72 6473 3d63 6f6f 7264 732c 2061 7474  ords=coords, att
-000114f0: 7273 3d61 7474 7273 290a 0a20 2020 2020  rs=attrs)..     
-00011500: 2020 2072 6574 7572 6e20 6473 0a0a 2020     return ds..  
-00011510: 2020 6465 6620 5f73 6e70 5f63 616c 6c73    def _snp_calls
-00011520: 5f66 6f72 5f63 6f6e 7469 6728 7365 6c66  _for_contig(self
-00011530: 2c20 2a2c 2063 6f6e 7469 672c 2073 616d  , *, contig, sam
-00011540: 706c 655f 7365 742c 2069 6e6c 696e 655f  ple_set, inline_
-00011550: 6172 7261 792c 2063 6875 6e6b 7329 3a0a  array, chunks):.
-00011560: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-00011570: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-00011580: 0a20 2020 2020 2020 2063 6f6f 7264 7320  .        coords 
-00011590: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
-000115a0: 2064 6174 615f 7661 7273 203d 2064 6963   data_vars = dic
-000115b0: 7428 290a 0a20 2020 2020 2020 2064 6562  t()..        deb
-000115c0: 7567 2822 6361 6c6c 2061 7272 6179 7322  ug("call arrays"
-000115d0: 290a 2020 2020 2020 2020 6361 6c6c 735f  ).        calls_
-000115e0: 726f 6f74 203d 2073 656c 662e 6f70 656e  root = self.open
-000115f0: 5f73 6e70 5f67 656e 6f74 7970 6573 2873  _snp_genotypes(s
-00011600: 616d 706c 655f 7365 743d 7361 6d70 6c65  ample_set=sample
-00011610: 5f73 6574 290a 2020 2020 2020 2020 6774  _set).        gt
-00011620: 5f7a 203d 2063 616c 6c73 5f72 6f6f 745b  _z = calls_root[
-00011630: 6622 7b63 6f6e 7469 677d 2f63 616c 6c64  f"{contig}/calld
-00011640: 6174 612f 4754 225d 0a20 2020 2020 2020  ata/GT"].       
-00011650: 2063 616c 6c5f 6765 6e6f 7479 7065 203d   call_genotype =
-00011660: 2064 615f 6672 6f6d 5f7a 6172 7228 6774   da_from_zarr(gt
-00011670: 5f7a 2c20 696e 6c69 6e65 5f61 7272 6179  _z, inline_array
-00011680: 3d69 6e6c 696e 655f 6172 7261 792c 2063  =inline_array, c
-00011690: 6875 6e6b 733d 6368 756e 6b73 290a 2020  hunks=chunks).  
-000116a0: 2020 2020 2020 6771 5f7a 203d 2063 616c        gq_z = cal
-000116b0: 6c73 5f72 6f6f 745b 6622 7b63 6f6e 7469  ls_root[f"{conti
-000116c0: 677d 2f63 616c 6c64 6174 612f 4751 225d  g}/calldata/GQ"]
-000116d0: 0a20 2020 2020 2020 2063 616c 6c5f 6771  .        call_gq
-000116e0: 203d 2064 615f 6672 6f6d 5f7a 6172 7228   = da_from_zarr(
-000116f0: 6771 5f7a 2c20 696e 6c69 6e65 5f61 7272  gq_z, inline_arr
-00011700: 6179 3d69 6e6c 696e 655f 6172 7261 792c  ay=inline_array,
-00011710: 2063 6875 6e6b 733d 6368 756e 6b73 290a   chunks=chunks).
-00011720: 2020 2020 2020 2020 6164 5f7a 203d 2063          ad_z = c
-00011730: 616c 6c73 5f72 6f6f 745b 6622 7b63 6f6e  alls_root[f"{con
-00011740: 7469 677d 2f63 616c 6c64 6174 612f 4144  tig}/calldata/AD
-00011750: 225d 0a20 2020 2020 2020 2063 616c 6c5f  "].        call_
-00011760: 6164 203d 2064 615f 6672 6f6d 5f7a 6172  ad = da_from_zar
-00011770: 7228 6164 5f7a 2c20 696e 6c69 6e65 5f61  r(ad_z, inline_a
-00011780: 7272 6179 3d69 6e6c 696e 655f 6172 7261  rray=inline_arra
-00011790: 792c 2063 6875 6e6b 733d 6368 756e 6b73  y, chunks=chunks
-000117a0: 290a 2020 2020 2020 2020 6d71 5f7a 203d  ).        mq_z =
-000117b0: 2063 616c 6c73 5f72 6f6f 745b 6622 7b63   calls_root[f"{c
-000117c0: 6f6e 7469 677d 2f63 616c 6c64 6174 612f  ontig}/calldata/
-000117d0: 4d51 225d 0a20 2020 2020 2020 2063 616c  MQ"].        cal
-000117e0: 6c5f 6d71 203d 2064 615f 6672 6f6d 5f7a  l_mq = da_from_z
-000117f0: 6172 7228 6d71 5f7a 2c20 696e 6c69 6e65  arr(mq_z, inline
-00011800: 5f61 7272 6179 3d69 6e6c 696e 655f 6172  _array=inline_ar
-00011810: 7261 792c 2063 6875 6e6b 733d 6368 756e  ray, chunks=chun
-00011820: 6b73 290a 2020 2020 2020 2020 6461 7461  ks).        data
-00011830: 5f76 6172 735b 2263 616c 6c5f 6765 6e6f  _vars["call_geno
-00011840: 7479 7065 225d 203d 2028 0a20 2020 2020  type"] = (.     
-00011850: 2020 2020 2020 205b 4449 4d5f 5641 5249         [DIM_VARI
-00011860: 414e 542c 2044 494d 5f53 414d 504c 452c  ANT, DIM_SAMPLE,
-00011870: 2044 494d 5f50 4c4f 4944 595d 2c0a 2020   DIM_PLOIDY],.  
-00011880: 2020 2020 2020 2020 2020 6361 6c6c 5f67            call_g
-00011890: 656e 6f74 7970 652c 0a20 2020 2020 2020  enotype,.       
-000118a0: 2029 0a20 2020 2020 2020 2064 6174 615f   ).        data_
-000118b0: 7661 7273 5b22 6361 6c6c 5f47 5122 5d20  vars["call_GQ"] 
-000118c0: 3d20 285b 4449 4d5f 5641 5249 414e 542c  = ([DIM_VARIANT,
-000118d0: 2044 494d 5f53 414d 504c 455d 2c20 6361   DIM_SAMPLE], ca
-000118e0: 6c6c 5f67 7129 0a20 2020 2020 2020 2064  ll_gq).        d
-000118f0: 6174 615f 7661 7273 5b22 6361 6c6c 5f4d  ata_vars["call_M
-00011900: 5122 5d20 3d20 285b 4449 4d5f 5641 5249  Q"] = ([DIM_VARI
-00011910: 414e 542c 2044 494d 5f53 414d 504c 455d  ANT, DIM_SAMPLE]
-00011920: 2c20 6361 6c6c 5f6d 7129 0a20 2020 2020  , call_mq).     
-00011930: 2020 2064 6174 615f 7661 7273 5b22 6361     data_vars["ca
-00011940: 6c6c 5f41 4422 5d20 3d20 280a 2020 2020  ll_AD"] = (.    
-00011950: 2020 2020 2020 2020 5b44 494d 5f56 4152          [DIM_VAR
-00011960: 4941 4e54 2c20 4449 4d5f 5341 4d50 4c45  IANT, DIM_SAMPLE
-00011970: 2c20 4449 4d5f 414c 4c45 4c45 5d2c 0a20  , DIM_ALLELE],. 
-00011980: 2020 2020 2020 2020 2020 2063 616c 6c5f             call_
-00011990: 6164 2c0a 2020 2020 2020 2020 290a 0a20  ad,.        ).. 
-000119a0: 2020 2020 2020 2064 6562 7567 2822 7361         debug("sa
-000119b0: 6d70 6c65 2061 7272 6179 7322 290a 2020  mple arrays").  
-000119c0: 2020 2020 2020 7a20 3d20 6361 6c6c 735f        z = calls_
-000119d0: 726f 6f74 5b22 7361 6d70 6c65 7322 5d0a  root["samples"].
-000119e0: 2020 2020 2020 2020 7361 6d70 6c65 5f69          sample_i
-000119f0: 6420 3d20 6461 5f66 726f 6d5f 7a61 7272  d = da_from_zarr
-00011a00: 287a 2c20 696e 6c69 6e65 5f61 7272 6179  (z, inline_array
-00011a10: 3d69 6e6c 696e 655f 6172 7261 792c 2063  =inline_array, c
-00011a20: 6875 6e6b 733d 6368 756e 6b73 290a 2020  hunks=chunks).  
-00011a30: 2020 2020 2020 2320 6465 636f 6465 2074        # decode t
-00011a40: 6f20 7374 722c 2061 7320 6974 2069 7320  o str, as it is 
-00011a50: 7374 6f72 6564 2061 7320 6279 7465 7320  stored as bytes 
-00011a60: 6f62 6a65 6374 730a 2020 2020 2020 2020  objects.        
-00011a70: 7361 6d70 6c65 5f69 6420 3d20 7361 6d70  sample_id = samp
-00011a80: 6c65 5f69 642e 6173 7479 7065 2822 5522  le_id.astype("U"
-00011a90: 290a 2020 2020 2020 2020 636f 6f72 6473  ).        coords
-00011aa0: 5b22 7361 6d70 6c65 5f69 6422 5d20 3d20  ["sample_id"] = 
-00011ab0: 5b44 494d 5f53 414d 504c 455d 2c20 7361  [DIM_SAMPLE], sa
-00011ac0: 6d70 6c65 5f69 640a 0a20 2020 2020 2020  mple_id..       
-00011ad0: 2064 6562 7567 2822 6372 6561 7465 2061   debug("create a
-00011ae0: 2064 6174 6173 6574 2229 0a20 2020 2020   dataset").     
-00011af0: 2020 2064 7320 3d20 7872 2e44 6174 6173     ds = xr.Datas
-00011b00: 6574 2864 6174 615f 7661 7273 3d64 6174  et(data_vars=dat
-00011b10: 615f 7661 7273 2c20 636f 6f72 6473 3d63  a_vars, coords=c
-00011b20: 6f6f 7264 7329 0a0a 2020 2020 2020 2020  oords)..        
-00011b30: 7265 7475 726e 2064 730a 0a20 2020 2040  return ds..    @
-00011b40: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-00011b50: 6d61 7279 3d22 4163 6365 7373 2053 4e50  mary="Access SNP
-00011b60: 2073 6974 6573 2c20 7369 7465 2066 696c   sites, site fil
-00011b70: 7465 7273 2061 6e64 2067 656e 6f74 7970  ters and genotyp
-00011b80: 6520 6361 6c6c 732e 222c 0a20 2020 2020  e calls.",.     
-00011b90: 2020 2072 6574 7572 6e73 3d22 4120 6461     returns="A da
-00011ba0: 7461 7365 7420 636f 6e74 6169 6e69 6e67  taset containing
-00011bb0: 2053 4e50 2073 6974 6573 2c20 7369 7465   SNP sites, site
-00011bc0: 2066 696c 7465 7273 2061 6e64 2067 656e   filters and gen
-00011bd0: 6f74 7970 6520 6361 6c6c 732e 222c 0a20  otype calls.",. 
-00011be0: 2020 2029 0a20 2020 2064 6566 2073 6e70     ).    def snp
-00011bf0: 5f63 616c 6c73 280a 2020 2020 2020 2020  _calls(.        
-00011c00: 7365 6c66 2c0a 2020 2020 2020 2020 7265  self,.        re
-00011c10: 6769 6f6e 3a20 6261 7365 5f70 6172 616d  gion: base_param
-00011c20: 732e 7265 6769 6f6e 2c0a 2020 2020 2020  s.region,.      
-00011c30: 2020 7361 6d70 6c65 5f73 6574 733a 204f    sample_sets: O
-00011c40: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-00011c50: 616d 732e 7361 6d70 6c65 5f73 6574 735d  ams.sample_sets]
-00011c60: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00011c70: 2073 616d 706c 655f 7175 6572 793a 204f   sample_query: O
-00011c80: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-00011c90: 616d 732e 7361 6d70 6c65 5f71 7565 7279  ams.sample_query
-00011ca0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00011cb0: 2020 7369 7465 5f6d 6173 6b3a 204f 7074    site_mask: Opt
-00011cc0: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
-00011cd0: 732e 7369 7465 5f6d 6173 6b5d 203d 204e  s.site_mask] = N
-00011ce0: 6f6e 652c 0a20 2020 2020 2020 2073 6974  one,.        sit
-00011cf0: 655f 636c 6173 733a 204f 7074 696f 6e61  e_class: Optiona
-00011d00: 6c5b 6261 7365 5f70 6172 616d 732e 7369  l[base_params.si
-00011d10: 7465 5f63 6c61 7373 5d20 3d20 4e6f 6e65  te_class] = None
-00011d20: 2c0a 2020 2020 2020 2020 696e 6c69 6e65  ,.        inline
-00011d30: 5f61 7272 6179 3a20 6261 7365 5f70 6172  _array: base_par
-00011d40: 616d 732e 696e 6c69 6e65 5f61 7272 6179  ams.inline_array
-00011d50: 203d 2062 6173 655f 7061 7261 6d73 2e69   = base_params.i
-00011d60: 6e6c 696e 655f 6172 7261 795f 6465 6661  nline_array_defa
-00011d70: 756c 742c 0a20 2020 2020 2020 2063 6875  ult,.        chu
-00011d80: 6e6b 733a 2062 6173 655f 7061 7261 6d73  nks: base_params
-00011d90: 2e63 6875 6e6b 7320 3d20 6261 7365 5f70  .chunks = base_p
-00011da0: 6172 616d 732e 6368 756e 6b73 5f64 6566  arams.chunks_def
-00011db0: 6175 6c74 2c0a 2020 2020 2020 2020 636f  ault,.        co
-00011dc0: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
-00011dd0: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-00011de0: 636f 686f 7274 5f73 697a 655d 203d 204e  cohort_size] = N
-00011df0: 6f6e 652c 0a20 2020 2020 2020 206d 696e  one,.        min
-00011e00: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
-00011e10: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-00011e20: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
-00011e30: 7a65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ze] = None,.    
-00011e40: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
-00011e50: 697a 653a 204f 7074 696f 6e61 6c5b 6261  ize: Optional[ba
-00011e60: 7365 5f70 6172 616d 732e 6d61 785f 636f  se_params.max_co
-00011e70: 686f 7274 5f73 697a 655d 203d 204e 6f6e  hort_size] = Non
-00011e80: 652c 0a20 2020 2020 2020 2072 616e 646f  e,.        rando
-00011e90: 6d5f 7365 6564 3a20 6261 7365 5f70 6172  m_seed: base_par
-00011ea0: 616d 732e 7261 6e64 6f6d 5f73 6565 6420  ams.random_seed 
-00011eb0: 3d20 3432 2c0a 2020 2020 2920 2d3e 2078  = 42,.    ) -> x
-00011ec0: 722e 4461 7461 7365 743a 0a20 2020 2020  r.Dataset:.     
-00011ed0: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-00011ee0: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-00011ef0: 2020 2020 6465 6275 6728 226e 6f72 6d61      debug("norma
-00011f00: 6c69 7365 2070 6172 616d 6574 6572 7322  lise parameters"
-00011f10: 290a 2020 2020 2020 2020 7361 6d70 6c65  ).        sample
-00011f20: 5f73 6574 7320 3d20 7365 6c66 2e5f 7072  _sets = self._pr
-00011f30: 6570 5f73 616d 706c 655f 7365 7473 5f70  ep_sample_sets_p
-00011f40: 6172 616d 2873 616d 706c 655f 7365 7473  aram(sample_sets
-00011f50: 3d73 616d 706c 655f 7365 7473 290a 2020  =sample_sets).  
-00011f60: 2020 2020 2020 7265 736f 6c76 6564 5f72        resolved_r
-00011f70: 6567 696f 6e20 3d20 7365 6c66 2e72 6573  egion = self.res
-00011f80: 6f6c 7665 5f72 6567 696f 6e28 7265 6769  olve_region(regi
-00011f90: 6f6e 290a 2020 2020 2020 2020 6465 6c20  on).        del 
-00011fa0: 7265 6769 6f6e 0a20 2020 2020 2020 2069  region.        i
-00011fb0: 6620 6973 696e 7374 616e 6365 2872 6573  f isinstance(res
-00011fc0: 6f6c 7665 645f 7265 6769 6f6e 2c20 5265  olved_region, Re
-00011fd0: 6769 6f6e 293a 0a20 2020 2020 2020 2020  gion):.         
-00011fe0: 2020 2072 6573 6f6c 7665 645f 7265 6769     resolved_regi
-00011ff0: 6f6e 203d 205b 7265 736f 6c76 6564 5f72  on = [resolved_r
-00012000: 6567 696f 6e5d 0a0a 2020 2020 2020 2020  egion]..        
-00012010: 6465 6275 6728 2261 6363 6573 7320 534e  debug("access SN
-00012020: 5020 6361 6c6c 7320 616e 6420 636f 6e63  P calls and conc
-00012030: 6174 656e 6174 6520 6d75 6c74 6970 6c65  atenate multiple
-00012040: 2073 616d 706c 6520 7365 7473 2061 6e64   sample sets and
-00012050: 2f6f 7220 7265 6769 6f6e 7322 290a 2020  /or regions").  
-00012060: 2020 2020 2020 6c78 203d 205b 5d0a 2020        lx = [].  
-00012070: 2020 2020 2020 666f 7220 7220 696e 2072        for r in r
-00012080: 6573 6f6c 7665 645f 7265 6769 6f6e 3a0a  esolved_region:.
-00012090: 2020 2020 2020 2020 2020 2020 6c79 203d              ly =
-000120a0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-000120b0: 666f 7220 7320 696e 2073 616d 706c 655f  for s in sample_
-000120c0: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-000120d0: 2020 2020 2020 7920 3d20 7365 6c66 2e5f        y = self._
-000120e0: 736e 705f 6361 6c6c 735f 666f 725f 636f  snp_calls_for_co
-000120f0: 6e74 6967 280a 2020 2020 2020 2020 2020  ntig(.          
-00012100: 2020 2020 2020 2020 2020 636f 6e74 6967            contig
-00012110: 3d72 2e63 6f6e 7469 672c 0a20 2020 2020  =r.contig,.     
-00012120: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012130: 616d 706c 655f 7365 743d 732c 0a20 2020  ample_set=s,.   
-00012140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012150: 2069 6e6c 696e 655f 6172 7261 793d 696e   inline_array=in
-00012160: 6c69 6e65 5f61 7272 6179 2c0a 2020 2020  line_array,.    
-00012170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012180: 6368 756e 6b73 3d63 6875 6e6b 732c 0a20  chunks=chunks,. 
-00012190: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000121a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000121b0: 206c 792e 6170 7065 6e64 2879 290a 0a20   ly.append(y).. 
-000121c0: 2020 2020 2020 2020 2020 2064 6562 7567             debug
-000121d0: 2822 636f 6e63 6174 656e 6174 6520 6461  ("concatenate da
-000121e0: 7461 2066 726f 6d20 6d75 6c74 6970 6c65  ta from multiple
-000121f0: 2073 616d 706c 6520 7365 7473 2229 0a20   sample sets"). 
-00012200: 2020 2020 2020 2020 2020 2078 203d 2078             x = x
-00012210: 6172 7261 795f 636f 6e63 6174 286c 792c  array_concat(ly,
-00012220: 2064 696d 3d44 494d 5f53 414d 504c 4529   dim=DIM_SAMPLE)
-00012230: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00012240: 6275 6728 2261 6464 2076 6172 6961 6e74  bug("add variant
-00012250: 7320 7661 7269 6162 6c65 7322 290a 2020  s variables").  
-00012260: 2020 2020 2020 2020 2020 7620 3d20 7365            v = se
-00012270: 6c66 2e5f 736e 705f 7661 7269 616e 7473  lf._snp_variants
-00012280: 5f66 6f72 5f63 6f6e 7469 6728 0a20 2020  _for_contig(.   
-00012290: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000122a0: 7469 673d 722e 636f 6e74 6967 2c20 696e  tig=r.contig, in
-000122b0: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
-000122c0: 655f 6172 7261 792c 2063 6875 6e6b 733d  e_array, chunks=
-000122d0: 6368 756e 6b73 0a20 2020 2020 2020 2020  chunks.         
-000122e0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000122f0: 2078 203d 2078 722e 6d65 7267 6528 5b76   x = xr.merge([v
-00012300: 2c20 785d 2c20 636f 6d70 6174 3d22 6f76  , x], compat="ov
-00012310: 6572 7269 6465 222c 206a 6f69 6e3d 226f  erride", join="o
-00012320: 7665 7272 6964 6522 290a 0a20 2020 2020  verride")..     
-00012330: 2020 2020 2020 2064 6562 7567 2822 6861         debug("ha
-00012340: 6e64 6c65 2073 6974 6520 636c 6173 7322  ndle site class"
-00012350: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00012360: 2073 6974 655f 636c 6173 7320 6973 206e   site_class is n
-00012370: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00012380: 2020 2020 2020 2020 206c 6f63 5f61 6e6e           loc_ann
-00012390: 203d 2073 656c 662e 5f6c 6f63 6174 655f   = self._locate_
-000123a0: 7369 7465 5f63 6c61 7373 280a 2020 2020  site_class(.    
-000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123c0: 7265 6769 6f6e 3d72 2e63 6f6e 7469 672c  region=r.contig,
-000123d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000123e0: 2020 2020 2073 6974 655f 636c 6173 733d       site_class=
-000123f0: 7369 7465 5f63 6c61 7373 2c0a 2020 2020  site_class,.    
-00012400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012410: 7369 7465 5f6d 6173 6b3d 4e6f 6e65 2c0a  site_mask=None,.
-00012420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012430: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012440: 2020 7820 3d20 782e 6973 656c 2876 6172    x = x.isel(var
-00012450: 6961 6e74 733d 6c6f 635f 616e 6e29 0a0a  iants=loc_ann)..
-00012460: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-00012470: 6728 2268 616e 646c 6520 7265 6769 6f6e  g("handle region
-00012480: 2c20 646f 2074 6869 7320 6f6e 6c79 206f  , do this only o
-00012490: 6e63 6520 2d20 6f70 7469 6d69 7361 7469  nce - optimisati
-000124a0: 6f6e 2229 0a20 2020 2020 2020 2020 2020  on").           
-000124b0: 2069 6620 722e 7374 6172 7420 6f72 2072   if r.start or r
-000124c0: 2e65 6e64 3a0a 2020 2020 2020 2020 2020  .end:.          
-000124d0: 2020 2020 2020 706f 7320 3d20 785b 2276        pos = x["v
-000124e0: 6172 6961 6e74 5f70 6f73 6974 696f 6e22  ariant_position"
-000124f0: 5d2e 7661 6c75 6573 0a20 2020 2020 2020  ].values.       
-00012500: 2020 2020 2020 2020 206c 6f63 5f72 6567           loc_reg
-00012510: 696f 6e20 3d20 6c6f 6361 7465 5f72 6567  ion = locate_reg
-00012520: 696f 6e28 722c 2070 6f73 290a 2020 2020  ion(r, pos).    
-00012530: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-00012540: 782e 6973 656c 2876 6172 6961 6e74 733d  x.isel(variants=
-00012550: 6c6f 635f 7265 6769 6f6e 290a 0a20 2020  loc_region)..   
-00012560: 2020 2020 2020 2020 206c 782e 6170 7065           lx.appe
-00012570: 6e64 2878 290a 0a20 2020 2020 2020 2064  nd(x)..        d
-00012580: 6562 7567 2822 636f 6e63 6174 656e 6174  ebug("concatenat
-00012590: 6520 6461 7461 2066 726f 6d20 6d75 6c74  e data from mult
-000125a0: 6970 6c65 2072 6567 696f 6e73 2229 0a20  iple regions"). 
-000125b0: 2020 2020 2020 2064 7320 3d20 7861 7272         ds = xarr
-000125c0: 6179 5f63 6f6e 6361 7428 6c78 2c20 6469  ay_concat(lx, di
-000125d0: 6d3d 4449 4d5f 5641 5249 414e 5429 0a0a  m=DIM_VARIANT)..
-000125e0: 2020 2020 2020 2020 6966 2073 6974 655f          if site_
-000125f0: 6d61 736b 2069 7320 6e6f 7420 4e6f 6e65  mask is not None
-00012600: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00012610: 6275 6728 2261 7070 6c79 2073 6974 6520  bug("apply site 
-00012620: 6669 6c74 6572 7322 290a 2020 2020 2020  filters").      
-00012630: 2020 2020 2020 6473 203d 2064 6173 6b5f        ds = dask_
-00012640: 636f 6d70 7265 7373 5f64 6174 6173 6574  compress_dataset
-00012650: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00012660: 2020 6473 2c20 696e 6465 7865 723d 6622    ds, indexer=f"
-00012670: 7661 7269 616e 745f 6669 6c74 6572 5f70  variant_filter_p
-00012680: 6173 735f 7b73 6974 655f 6d61 736b 7d22  ass_{site_mask}"
-00012690: 2c20 6469 6d3d 4449 4d5f 5641 5249 414e  , dim=DIM_VARIAN
-000126a0: 540a 2020 2020 2020 2020 2020 2020 290a  T.            ).
-000126b0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-000126c0: 6164 6420 6361 6c6c 5f67 656e 6f74 7970  add call_genotyp
-000126d0: 655f 6d61 736b 2229 0a20 2020 2020 2020  e_mask").       
-000126e0: 2064 735b 2263 616c 6c5f 6765 6e6f 7479   ds["call_genoty
-000126f0: 7065 5f6d 6173 6b22 5d20 3d20 6473 5b22  pe_mask"] = ds["
-00012700: 6361 6c6c 5f67 656e 6f74 7970 6522 5d20  call_genotype"] 
-00012710: 3c20 300a 0a20 2020 2020 2020 2069 6620  < 0..        if 
-00012720: 7361 6d70 6c65 5f71 7565 7279 2069 7320  sample_query is 
-00012730: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00012740: 2020 2020 2020 6465 6275 6728 2268 616e        debug("han
-00012750: 646c 6520 7361 6d70 6c65 2071 7565 7279  dle sample query
-00012760: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00012770: 6620 6973 696e 7374 616e 6365 2873 616d  f isinstance(sam
-00012780: 706c 655f 7175 6572 792c 2073 7472 293a  ple_query, str):
-00012790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000127a0: 2064 665f 7361 6d70 6c65 7320 3d20 7365   df_samples = se
-000127b0: 6c66 2e73 616d 706c 655f 6d65 7461 6461  lf.sample_metada
-000127c0: 7461 2873 616d 706c 655f 7365 7473 3d73  ta(sample_sets=s
-000127d0: 616d 706c 655f 7365 7473 290a 2020 2020  ample_sets).    
-000127e0: 2020 2020 2020 2020 2020 2020 6c6f 635f              loc_
-000127f0: 7361 6d70 6c65 7320 3d20 6466 5f73 616d  samples = df_sam
-00012800: 706c 6573 2e65 7661 6c28 7361 6d70 6c65  ples.eval(sample
-00012810: 5f71 7565 7279 292e 7661 6c75 6573 0a20  _query).values. 
-00012820: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012830: 6620 6e70 2e63 6f75 6e74 5f6e 6f6e 7a65  f np.count_nonze
-00012840: 726f 286c 6f63 5f73 616d 706c 6573 2920  ro(loc_samples) 
-00012850: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00012860: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00012870: 5661 6c75 6545 7272 6f72 2866 224e 6f20  ValueError(f"No 
-00012880: 7361 6d70 6c65 7320 666f 756e 6420 666f  samples found fo
-00012890: 7220 7175 6572 7920 7b73 616d 706c 655f  r query {sample_
-000128a0: 7175 6572 7921 727d 2229 0a20 2020 2020  query!r}").     
-000128b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000128c0: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-000128d0: 7373 756d 6520 7361 6d70 6c65 2071 7565  ssume sample que
-000128e0: 7279 2069 7320 616e 2069 6e64 6578 6572  ry is an indexer
-000128f0: 2c20 652e 672e 2c20 6120 6c69 7374 206f  , e.g., a list o
-00012900: 6620 696e 7465 6765 7273 0a20 2020 2020  f integers.     
-00012910: 2020 2020 2020 2020 2020 206c 6f63 5f73             loc_s
-00012920: 616d 706c 6573 203d 2073 616d 706c 655f  amples = sample_
-00012930: 7175 6572 790a 2020 2020 2020 2020 2020  query.          
-00012940: 2020 6473 203d 2064 732e 6973 656c 2873    ds = ds.isel(s
-00012950: 616d 706c 6573 3d6c 6f63 5f73 616d 706c  amples=loc_sampl
-00012960: 6573 290a 0a20 2020 2020 2020 2069 6620  es)..        if 
-00012970: 636f 686f 7274 5f73 697a 6520 6973 206e  cohort_size is n
-00012980: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00012990: 2020 2020 2064 6562 7567 2822 6861 6e64       debug("hand
-000129a0: 6c65 2063 6f68 6f72 7420 7369 7a65 2229  le cohort size")
-000129b0: 0a20 2020 2020 2020 2020 2020 2023 206f  .            # o
-000129c0: 7665 7272 6964 6573 206d 696e 2061 6e64  verrides min and
-000129d0: 206d 6178 0a20 2020 2020 2020 2020 2020   max.           
-000129e0: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
-000129f0: 203d 2063 6f68 6f72 745f 7369 7a65 0a20   = cohort_size. 
-00012a00: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-00012a10: 6f68 6f72 745f 7369 7a65 203d 2063 6f68  ohort_size = coh
-00012a20: 6f72 745f 7369 7a65 0a0a 2020 2020 2020  ort_size..      
-00012a30: 2020 6966 206d 696e 5f63 6f68 6f72 745f    if min_cohort_
-00012a40: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-00012a50: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00012a60: 6275 6728 2268 616e 646c 6520 6d69 6e20  bug("handle min 
-00012a70: 636f 686f 7274 2073 697a 6522 290a 2020  cohort size").  
-00012a80: 2020 2020 2020 2020 2020 6e5f 7361 6d70            n_samp
-00012a90: 6c65 7320 3d20 6473 2e64 696d 735b 2273  les = ds.dims["s
-00012aa0: 616d 706c 6573 225d 0a20 2020 2020 2020  amples"].       
-00012ab0: 2020 2020 2069 6620 6e5f 7361 6d70 6c65       if n_sample
-00012ac0: 7320 3c20 6d69 6e5f 636f 686f 7274 5f73  s < min_cohort_s
-00012ad0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00012ae0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00012af0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00012b00: 2020 2020 2020 2020 2020 2066 226e 6f74             f"not
-00012b10: 2065 6e6f 7567 6820 7361 6d70 6c65 7320   enough samples 
-00012b20: 287b 6e5f 7361 6d70 6c65 737d 2920 666f  ({n_samples}) fo
-00012b30: 7220 6d69 6e69 6d75 6d20 636f 686f 7274  r minimum cohort
-00012b40: 2073 697a 6520 287b 6d69 6e5f 636f 686f   size ({min_coho
-00012b50: 7274 5f73 697a 657d 2922 0a20 2020 2020  rt_size})".     
-00012b60: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00012b70: 2020 2020 2020 6966 206d 6178 5f63 6f68        if max_coh
-00012b80: 6f72 745f 7369 7a65 2069 7320 6e6f 7420  ort_size is not 
-00012b90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00012ba0: 2020 6465 6275 6728 2268 616e 646c 6520    debug("handle 
-00012bb0: 6d61 7820 636f 686f 7274 2073 697a 6522  max cohort size"
-00012bc0: 290a 2020 2020 2020 2020 2020 2020 6e5f  ).            n_
-00012bd0: 7361 6d70 6c65 7320 3d20 6473 2e64 696d  samples = ds.dim
-00012be0: 735b 2273 616d 706c 6573 225d 0a20 2020  s["samples"].   
-00012bf0: 2020 2020 2020 2020 2069 6620 6e5f 7361           if n_sa
-00012c00: 6d70 6c65 7320 3e20 6d61 785f 636f 686f  mples > max_coho
-00012c10: 7274 5f73 697a 653a 0a20 2020 2020 2020  rt_size:.       
-00012c20: 2020 2020 2020 2020 2072 6e67 203d 206e           rng = n
-00012c30: 702e 7261 6e64 6f6d 2e64 6566 6175 6c74  p.random.default
-00012c40: 5f72 6e67 2873 6565 643d 7261 6e64 6f6d  _rng(seed=random
-00012c50: 5f73 6565 6429 0a20 2020 2020 2020 2020  _seed).         
-00012c60: 2020 2020 2020 206c 6f63 5f64 6f77 6e73         loc_downs
-00012c70: 616d 706c 6520 3d20 726e 672e 6368 6f69  ample = rng.choi
-00012c80: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-00012c90: 2020 2020 2020 2020 6e5f 7361 6d70 6c65          n_sample
-00012ca0: 732c 2073 697a 653d 6d61 785f 636f 686f  s, size=max_coho
-00012cb0: 7274 5f73 697a 652c 2072 6570 6c61 6365  rt_size, replace
-00012cc0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00012cd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00012ce0: 2020 2020 2020 2020 206c 6f63 5f64 6f77           loc_dow
-00012cf0: 6e73 616d 706c 652e 736f 7274 2829 0a20  nsample.sort(). 
-00012d00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00012d10: 7320 3d20 6473 2e69 7365 6c28 7361 6d70  s = ds.isel(samp
-00012d20: 6c65 733d 6c6f 635f 646f 776e 7361 6d70  les=loc_downsamp
-00012d30: 6c65 290a 0a20 2020 2020 2020 2072 6574  le)..        ret
-00012d40: 7572 6e20 6473 0a0a 2020 2020 6465 6620  urn ds..    def 
-00012d50: 736e 705f 6461 7461 7365 7428 7365 6c66  snp_dataset(self
-00012d60: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-00012d70: 7329 3a0a 2020 2020 2020 2020 2222 2244  s):.        """D
-00012d80: 6570 7265 6361 7465 642c 2074 6869 7320  eprecated, this 
-00012d90: 6d65 7468 6f64 2068 6173 2062 6565 6e20  method has been 
-00012da0: 7265 6e61 6d65 6420 746f 2073 6e70 5f63  renamed to snp_c
-00012db0: 616c 6c73 2829 2e22 2222 0a20 2020 2020  alls().""".     
-00012dc0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
-00012dd0: 6e70 5f63 616c 6c73 282a 6172 6773 2c20  np_calls(*args, 
-00012de0: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00012df0: 6566 205f 736e 705f 616c 6c65 6c65 5f63  ef _snp_allele_c
-00012e00: 6f75 6e74 7328 0a20 2020 2020 2020 2073  ounts(.        s
-00012e10: 656c 662c 0a20 2020 2020 2020 202a 2c0a  elf,.        *,.
-00012e20: 2020 2020 2020 2020 7265 6769 6f6e 2c0a          region,.
-00012e30: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-00012e40: 6574 732c 0a20 2020 2020 2020 2073 616d  ets,.        sam
-00012e50: 706c 655f 7175 6572 792c 0a20 2020 2020  ple_query,.     
-00012e60: 2020 2073 6974 655f 6d61 736b 2c0a 2020     site_mask,.  
-00012e70: 2020 2020 2020 7369 7465 5f63 6c61 7373        site_class
-00012e80: 2c0a 2020 2020 2020 2020 636f 686f 7274  ,.        cohort
-00012e90: 5f73 697a 652c 0a20 2020 2020 2020 2072  _size,.        r
-00012ea0: 616e 646f 6d5f 7365 6564 2c0a 2020 2020  andom_seed,.    
-00012eb0: 293a 0a20 2020 2020 2020 2064 6562 7567  ):.        debug
-00012ec0: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
-00012ed0: 7567 0a0a 2020 2020 2020 2020 6465 6275  ug..        debu
-00012ee0: 6728 2261 6363 6573 7320 534e 5020 6361  g("access SNP ca
-00012ef0: 6c6c 7322 290a 2020 2020 2020 2020 6473  lls").        ds
-00012f00: 5f73 6e70 7320 3d20 7365 6c66 2e73 6e70  _snps = self.snp
-00012f10: 5f63 616c 6c73 280a 2020 2020 2020 2020  _calls(.        
-00012f20: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
-00012f30: 6e2c 0a20 2020 2020 2020 2020 2020 2073  n,.            s
-00012f40: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
-00012f50: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
-00012f60: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-00012f70: 3d73 616d 706c 655f 7175 6572 792c 0a20  =sample_query,. 
-00012f80: 2020 2020 2020 2020 2020 2073 6974 655f             site_
-00012f90: 6d61 736b 3d73 6974 655f 6d61 736b 2c0a  mask=site_mask,.
-00012fa0: 2020 2020 2020 2020 2020 2020 7369 7465              site
-00012fb0: 5f63 6c61 7373 3d73 6974 655f 636c 6173  _class=site_clas
-00012fc0: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
-00012fd0: 6f68 6f72 745f 7369 7a65 3d63 6f68 6f72  ohort_size=cohor
-00012fe0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-00012ff0: 2020 2020 7261 6e64 6f6d 5f73 6565 643d      random_seed=
-00013000: 7261 6e64 6f6d 5f73 6565 642c 0a20 2020  random_seed,.   
-00013010: 2020 2020 2029 0a20 2020 2020 2020 2067       ).        g
-00013020: 7420 3d20 6473 5f73 6e70 735b 2263 616c  t = ds_snps["cal
-00013030: 6c5f 6765 6e6f 7479 7065 225d 0a0a 2020  l_genotype"]..  
-00013040: 2020 2020 2020 6465 6275 6728 2273 6574        debug("set
-00013050: 2075 7020 616e 6420 7275 6e20 616c 6c65   up and run alle
-00013060: 6c65 2063 6f75 6e74 7320 636f 6d70 7574  le counts comput
-00013070: 6174 696f 6e22 290a 2020 2020 2020 2020  ation").        
-00013080: 6774 203d 2061 6c6c 656c 2e47 656e 6f74  gt = allel.Genot
-00013090: 7970 6544 6173 6b41 7272 6179 2867 742e  ypeDaskArray(gt.
-000130a0: 6461 7461 290a 2020 2020 2020 2020 6163  data).        ac
-000130b0: 203d 2067 742e 636f 756e 745f 616c 6c65   = gt.count_alle
-000130c0: 6c65 7328 6d61 785f 616c 6c65 6c65 3d33  les(max_allele=3
-000130d0: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-000130e0: 656c 662e 5f64 6173 6b5f 7072 6f67 7265  elf._dask_progre
-000130f0: 7373 2864 6573 633d 2243 6f6d 7075 7465  ss(desc="Compute
-00013100: 2053 4e50 2061 6c6c 656c 6520 636f 756e   SNP allele coun
-00013110: 7473 2229 3a0a 2020 2020 2020 2020 2020  ts"):.          
-00013120: 2020 6163 203d 2061 632e 636f 6d70 7574    ac = ac.comput
-00013130: 6528 290a 0a20 2020 2020 2020 2064 6562  e()..        deb
-00013140: 7567 2822 7265 7475 726e 2070 6c61 696e  ug("return plain
-00013150: 206e 756d 7079 2061 7272 6179 2229 0a20   numpy array"). 
-00013160: 2020 2020 2020 2072 6573 756c 7473 203d         results =
-00013170: 2064 6963 7428 6163 3d61 632e 7661 6c75   dict(ac=ac.valu
-00013180: 6573 290a 0a20 2020 2020 2020 2072 6574  es)..        ret
-00013190: 7572 6e20 7265 7375 6c74 730a 0a20 2020  urn results..   
-000131a0: 2064 6566 205f 6461 736b 5f70 726f 6772   def _dask_progr
-000131b0: 6573 7328 7365 6c66 2c20 2a2a 6b77 6172  ess(self, **kwar
-000131c0: 6773 293a 0a20 2020 2020 2020 2064 6973  gs):.        dis
-000131d0: 6162 6c65 203d 206e 6f74 2073 656c 662e  able = not self.
-000131e0: 5f73 686f 775f 7072 6f67 7265 7373 0a20  _show_progress. 
-000131f0: 2020 2020 2020 2072 6574 7572 6e20 5471         return Tq
-00013200: 646d 4361 6c6c 6261 636b 2864 6973 6162  dmCallback(disab
-00013210: 6c65 3d64 6973 6162 6c65 2c20 2a2a 6b77  le=disable, **kw
-00013220: 6172 6773 290a 0a20 2020 2040 646f 6328  args)..    @doc(
-00013230: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-00013240: 3d22 4163 6365 7373 2053 4e50 2073 6974  ="Access SNP sit
-00013250: 6573 2061 6e64 2073 6974 6520 6669 6c74  es and site filt
-00013260: 6572 732e 222c 0a20 2020 2020 2020 2072  ers.",.        r
-00013270: 6574 7572 6e73 3d22 4120 6461 7461 7365  eturns="A datase
-00013280: 7420 636f 6e74 6169 6e69 6e67 2053 4e50  t containing SNP
-00013290: 2073 6974 6573 2061 6e64 2073 6974 6520   sites and site 
-000132a0: 6669 6c74 6572 732e 222c 0a20 2020 2029  filters.",.    )
-000132b0: 0a20 2020 2064 6566 2073 6e70 5f76 6172  .    def snp_var
-000132c0: 6961 6e74 7328 0a20 2020 2020 2020 2073  iants(.        s
-000132d0: 656c 662c 0a20 2020 2020 2020 2072 6567  elf,.        reg
-000132e0: 696f 6e3a 2062 6173 655f 7061 7261 6d73  ion: base_params
-000132f0: 2e72 6567 696f 6e2c 0a20 2020 2020 2020  .region,.       
-00013300: 2073 6974 655f 6d61 736b 3a20 4f70 7469   site_mask: Opti
-00013310: 6f6e 616c 5b62 6173 655f 7061 7261 6d73  onal[base_params
-00013320: 2e73 6974 655f 6d61 736b 5d20 3d20 4e6f  .site_mask] = No
-00013330: 6e65 2c0a 2020 2020 2020 2020 696e 6c69  ne,.        inli
-00013340: 6e65 5f61 7272 6179 3a20 6261 7365 5f70  ne_array: base_p
-00013350: 6172 616d 732e 696e 6c69 6e65 5f61 7272  arams.inline_arr
-00013360: 6179 203d 2062 6173 655f 7061 7261 6d73  ay = base_params
-00013370: 2e69 6e6c 696e 655f 6172 7261 795f 6465  .inline_array_de
-00013380: 6661 756c 742c 0a20 2020 2020 2020 2063  fault,.        c
-00013390: 6875 6e6b 733a 2062 6173 655f 7061 7261  hunks: base_para
-000133a0: 6d73 2e63 6875 6e6b 7320 3d20 6261 7365  ms.chunks = base
-000133b0: 5f70 6172 616d 732e 6368 756e 6b73 5f64  _params.chunks_d
-000133c0: 6566 6175 6c74 2c0a 2020 2020 293a 0a20  efault,.    ):. 
-000133d0: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
-000133e0: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
-000133f0: 2020 2020 2020 2020 6465 6275 6728 226e          debug("n
-00013400: 6f72 6d61 6c69 7365 2070 6172 616d 6574  ormalise paramet
-00013410: 6572 7322 290a 2020 2020 2020 2020 7265  ers").        re
-00013420: 736f 6c76 6564 5f72 6567 696f 6e20 3d20  solved_region = 
-00013430: 7365 6c66 2e72 6573 6f6c 7665 5f72 6567  self.resolve_reg
-00013440: 696f 6e28 7265 6769 6f6e 290a 2020 2020  ion(region).    
-00013450: 2020 2020 6465 6c20 7265 6769 6f6e 0a20      del region. 
-00013460: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00013470: 616e 6365 2872 6573 6f6c 7665 645f 7265  ance(resolved_re
-00013480: 6769 6f6e 2c20 5265 6769 6f6e 293a 0a20  gion, Region):. 
-00013490: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
-000134a0: 7665 645f 7265 6769 6f6e 203d 205b 7265  ved_region = [re
-000134b0: 736f 6c76 6564 5f72 6567 696f 6e5d 0a0a  solved_region]..
-000134c0: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-000134d0: 6363 6573 7320 534e 5020 6461 7461 2061  ccess SNP data a
-000134e0: 6e64 2063 6f6e 6361 7465 6e61 7465 206d  nd concatenate m
-000134f0: 756c 7469 706c 6520 7265 6769 6f6e 7322  ultiple regions"
-00013500: 290a 2020 2020 2020 2020 6c78 203d 205b  ).        lx = [
-00013510: 5d0a 2020 2020 2020 2020 666f 7220 7220  ].        for r 
-00013520: 696e 2072 6573 6f6c 7665 645f 7265 6769  in resolved_regi
-00013530: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00013540: 6465 6275 6728 2261 6363 6573 7320 7661  debug("access va
-00013550: 7269 616e 7473 2229 0a20 2020 2020 2020  riants").       
-00013560: 2020 2020 2078 203d 2073 656c 662e 5f73       x = self._s
-00013570: 6e70 5f76 6172 6961 6e74 735f 666f 725f  np_variants_for_
-00013580: 636f 6e74 6967 280a 2020 2020 2020 2020  contig(.        
-00013590: 2020 2020 2020 2020 636f 6e74 6967 3d72          contig=r
-000135a0: 2e63 6f6e 7469 672c 0a20 2020 2020 2020  .contig,.       
-000135b0: 2020 2020 2020 2020 2069 6e6c 696e 655f           inline_
-000135c0: 6172 7261 793d 696e 6c69 6e65 5f61 7272  array=inline_arr
-000135d0: 6179 2c0a 2020 2020 2020 2020 2020 2020  ay,.            
-000135e0: 2020 2020 6368 756e 6b73 3d63 6875 6e6b      chunks=chunk
-000135f0: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
-00013600: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00013610: 6275 6728 2268 616e 646c 6520 7265 6769  bug("handle regi
-00013620: 6f6e 2229 0a20 2020 2020 2020 2020 2020  on").           
-00013630: 2069 6620 722e 7374 6172 7420 6f72 2072   if r.start or r
-00013640: 2e65 6e64 3a0a 2020 2020 2020 2020 2020  .end:.          
-00013650: 2020 2020 2020 706f 7320 3d20 785b 2276        pos = x["v
-00013660: 6172 6961 6e74 5f70 6f73 6974 696f 6e22  ariant_position"
-00013670: 5d2e 7661 6c75 6573 0a20 2020 2020 2020  ].values.       
-00013680: 2020 2020 2020 2020 206c 6f63 5f72 6567           loc_reg
-00013690: 696f 6e20 3d20 6c6f 6361 7465 5f72 6567  ion = locate_reg
-000136a0: 696f 6e28 722c 2070 6f73 290a 2020 2020  ion(r, pos).    
-000136b0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-000136c0: 782e 6973 656c 2876 6172 6961 6e74 733d  x.isel(variants=
-000136d0: 6c6f 635f 7265 6769 6f6e 290a 0a20 2020  loc_region)..   
-000136e0: 2020 2020 2020 2020 206c 782e 6170 7065           lx.appe
-000136f0: 6e64 2878 290a 0a20 2020 2020 2020 2064  nd(x)..        d
-00013700: 6562 7567 2822 636f 6e63 6174 656e 6174  ebug("concatenat
-00013710: 6520 6461 7461 2066 726f 6d20 6d75 6c74  e data from mult
-00013720: 6970 6c65 2072 6567 696f 6e73 2229 0a20  iple regions"). 
-00013730: 2020 2020 2020 2064 7320 3d20 7861 7272         ds = xarr
-00013740: 6179 5f63 6f6e 6361 7428 6c78 2c20 6469  ay_concat(lx, di
-00013750: 6d3d 4449 4d5f 5641 5249 414e 5429 0a0a  m=DIM_VARIANT)..
-00013760: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-00013770: 7070 6c79 2073 6974 6520 6669 6c74 6572  pply site filter
-00013780: 7322 290a 2020 2020 2020 2020 6966 2073  s").        if s
-00013790: 6974 655f 6d61 736b 2069 7320 6e6f 7420  ite_mask is not 
-000137a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000137b0: 2020 6473 203d 2064 6173 6b5f 636f 6d70    ds = dask_comp
-000137c0: 7265 7373 5f64 6174 6173 6574 280a 2020  ress_dataset(.  
-000137d0: 2020 2020 2020 2020 2020 2020 2020 6473                ds
-000137e0: 2c20 696e 6465 7865 723d 6622 7661 7269  , indexer=f"vari
-000137f0: 616e 745f 6669 6c74 6572 5f70 6173 735f  ant_filter_pass_
-00013800: 7b73 6974 655f 6d61 736b 7d22 2c20 6469  {site_mask}", di
-00013810: 6d3d 4449 4d5f 5641 5249 414e 540a 2020  m=DIM_VARIANT.  
-00013820: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00013830: 2020 2020 2072 6574 7572 6e20 6473 0a0a       return ds..
-00013840: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
-00013850: 2020 7375 6d6d 6172 793d 2222 2c0a 2020    summary="",.  
-00013860: 2020 2020 2020 7061 7261 6d65 7465 7273        parameters
-00013870: 3d64 6963 7428 0a20 2020 2020 2020 2020  =dict(.         
-00013880: 2020 2074 7261 636b 733d 2243 6f6e 6669     tracks="Confi
-00013890: 6775 7261 7469 6f6e 2066 6f72 2061 6e79  guration for any
-000138a0: 2061 6464 6974 696f 6e61 6c20 7472 6163   additional trac
-000138b0: 6b73 2e22 2c0a 2020 2020 2020 2020 292c  ks.",.        ),
-000138c0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
-000138d0: 3d22 4947 5620 6272 6f77 7365 722e 222c  ="IGV browser.",
-000138e0: 0a20 2020 2029 0a20 2020 2064 6566 2069  .    ).    def i
-000138f0: 6776 280a 2020 2020 2020 2020 7365 6c66  gv(.        self
-00013900: 2c20 7265 6769 6f6e 3a20 6261 7365 5f70  , region: base_p
-00013910: 6172 616d 732e 7265 6769 6f6e 2c20 7472  arams.region, tr
-00013920: 6163 6b73 3a20 4f70 7469 6f6e 616c 5b4c  acks: Optional[L
-00013930: 6973 745d 203d 204e 6f6e 650a 2020 2020  ist] = None.    
-00013940: 2920 2d3e 2069 6776 5f6e 6f74 6562 6f6f  ) -> igv_noteboo
-00013950: 6b2e 4272 6f77 7365 723a 0a20 2020 2020  k.Browser:.     
-00013960: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-00013970: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-00013980: 2020 2020 6465 6275 6728 2272 6573 6f6c      debug("resol
-00013990: 7665 2072 6567 696f 6e22 290a 2020 2020  ve region").    
-000139a0: 2020 2020 7265 6769 6f6e 203d 2073 656c      region = sel
-000139b0: 662e 7265 736f 6c76 655f 7265 6769 6f6e  f.resolve_region
-000139c0: 2872 6567 696f 6e29 0a0a 2020 2020 2020  (region)..      
-000139d0: 2020 636f 6e66 6967 203d 207b 0a20 2020    config = {.   
-000139e0: 2020 2020 2020 2020 2022 7265 6665 7265           "refere
-000139f0: 6e63 6522 3a20 7b0a 2020 2020 2020 2020  nce": {.        
-00013a00: 2020 2020 2020 2020 2269 6422 3a20 7365          "id": se
-00013a10: 6c66 2e5f 6765 6e6f 6d65 5f72 6566 5f69  lf._genome_ref_i
-00013a20: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00013a30: 2020 2022 6e61 6d65 223a 2073 656c 662e     "name": self.
-00013a40: 5f67 656e 6f6d 655f 7265 665f 6e61 6d65  _genome_ref_name
-00013a50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013a60: 2020 2266 6173 7461 5552 4c22 3a20 6622    "fastaURL": f"
-00013a70: 7b73 656c 662e 5f67 6373 5f75 726c 7d7b  {self._gcs_url}{
-00013a80: 7365 6c66 2e5f 6765 6e6f 6d65 5f66 6173  self._genome_fas
-00013a90: 7461 5f70 6174 687d 222c 0a20 2020 2020  ta_path}",.     
-00013aa0: 2020 2020 2020 2020 2020 2022 696e 6465             "inde
-00013ab0: 7855 524c 223a 2066 227b 7365 6c66 2e5f  xURL": f"{self._
-00013ac0: 6763 735f 7572 6c7d 7b73 656c 662e 5f67  gcs_url}{self._g
-00013ad0: 656e 6f6d 655f 6661 695f 7061 7468 7d22  enome_fai_path}"
-00013ae0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013af0: 2020 2274 7261 636b 7322 3a20 5b0a 2020    "tracks": [.  
-00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b10: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-00013b20: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00013b30: 6522 3a20 2247 656e 6573 222c 0a20 2020  e": "Genes",.   
-00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b50: 2020 2020 2022 7479 7065 223a 2022 616e       "type": "an
-00013b60: 6e6f 7461 7469 6f6e 222c 0a20 2020 2020  notation",.     
-00013b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b80: 2020 2022 666f 726d 6174 223a 2022 6766     "format": "gf
-00013b90: 6633 222c 0a20 2020 2020 2020 2020 2020  f3",.           
-00013ba0: 2020 2020 2020 2020 2020 2020 2022 7572               "ur
-00013bb0: 6c22 3a20 6622 7b73 656c 662e 5f67 6373  l": f"{self._gcs
-00013bc0: 5f75 726c 7d7b 7365 6c66 2e5f 6765 6e65  _url}{self._gene
-00013bd0: 7365 745f 6766 6633 5f70 6174 687d 222c  set_gff3_path}",
-00013be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013bf0: 2020 2020 2020 2020 2022 696e 6465 7865           "indexe
-00013c00: 6422 3a20 4661 6c73 652c 0a20 2020 2020  d": False,.     
-00013c10: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00013c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013c30: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
-00013c40: 7d2c 0a20 2020 2020 2020 2020 2020 2022  },.            "
-00013c50: 6c6f 6375 7322 3a20 7374 7228 7265 6769  locus": str(regi
-00013c60: 6f6e 292c 0a20 2020 2020 2020 207d 0a20  on),.        }. 
-00013c70: 2020 2020 2020 2069 6620 7472 6163 6b73         if tracks
-00013c80: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00013c90: 6e66 6967 5b22 7472 6163 6b73 225d 203d  nfig["tracks"] =
-00013ca0: 2074 7261 636b 730a 0a20 2020 2020 2020   tracks..       
-00013cb0: 2064 6562 7567 2863 6f6e 6669 6729 0a0a   debug(config)..
-00013cc0: 2020 2020 2020 2020 6967 765f 6e6f 7465          igv_note
-00013cd0: 626f 6f6b 2e69 6e69 7428 290a 2020 2020  book.init().    
-00013ce0: 2020 2020 6272 6f77 7365 7220 3d20 6967      browser = ig
-00013cf0: 765f 6e6f 7465 626f 6f6b 2e42 726f 7773  v_notebook.Brows
-00013d00: 6572 2863 6f6e 6669 6729 0a0a 2020 2020  er(config)..    
-00013d10: 2020 2020 7265 7475 726e 2062 726f 7773      return brows
-00013d20: 6572 0a0a 2020 2020 4064 6f63 280a 2020  er..    @doc(.  
-00013d30: 2020 2020 2020 7375 6d6d 6172 793d 2222        summary=""
-00013d40: 220a 2020 2020 2020 2020 2020 2020 4c61  ".            La
-00013d50: 756e 6368 2049 4756 2061 6e64 2076 6965  unch IGV and vie
-00013d60: 7720 7365 7175 656e 6365 2072 6561 6420  w sequence read 
-00013d70: 616c 6967 6e6d 656e 7473 2061 6e64 2053  alignments and S
-00013d80: 4e50 2067 656e 6f74 7970 6573 2066 726f  NP genotypes fro
-00013d90: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
-00013da0: 6520 6769 7665 6e20 7361 6d70 6c65 2e0a  e given sample..
-00013db0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-00013dc0: 2020 2020 2070 6172 616d 6574 6572 733d       parameters=
-00013dd0: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
-00013de0: 2020 7361 6d70 6c65 3d22 5361 6d70 6c65    sample="Sample
-00013df0: 2069 6465 6e74 6966 6965 722e 222c 0a20   identifier.",. 
-00013e00: 2020 2020 2020 2020 2020 2076 6973 6962             visib
-00013e10: 696c 6974 795f 7769 6e64 6f77 3d22 2222  ility_window="""
-00013e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e30: 205a 6f6f 6d20 6c65 7665 6c20 696e 2062   Zoom level in b
-00013e40: 6173 6520 7061 6972 7320 6174 2077 6869  ase pairs at whi
-00013e50: 6368 2061 6c69 676e 6d65 6e74 2061 6e64  ch alignment and
-00013e60: 2053 4e50 2064 6174 6120 7769 6c6c 2062   SNP data will b
-00013e70: 6563 6f6d 650a 2020 2020 2020 2020 2020  ecome.          
-00013e80: 2020 2020 2020 7669 7369 626c 652e 0a20        visible.. 
-00013e90: 2020 2020 2020 2020 2020 2022 2222 2c0a             """,.
-00013ea0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
-00013eb0: 0a20 2020 2064 6566 2076 6965 775f 616c  .    def view_al
-00013ec0: 6967 6e6d 656e 7473 280a 2020 2020 2020  ignments(.      
-00013ed0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00013ee0: 7265 6769 6f6e 3a20 6261 7365 5f70 6172  region: base_par
-00013ef0: 616d 732e 7265 6769 6f6e 2c0a 2020 2020  ams.region,.    
-00013f00: 2020 2020 7361 6d70 6c65 3a20 7374 722c      sample: str,
-00013f10: 0a20 2020 2020 2020 2076 6973 6962 696c  .        visibil
-00013f20: 6974 795f 7769 6e64 6f77 3a20 696e 7420  ity_window: int 
-00013f30: 3d20 3230 5f30 3030 2c0a 2020 2020 293a  = 20_000,.    ):
-00013f40: 0a20 2020 2020 2020 2064 6562 7567 203d  .        debug =
-00013f50: 2073 656c 662e 5f6c 6f67 2e64 6562 7567   self._log.debug
-00013f60: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00013f70: 226c 6f6f 6b20 7570 2073 616d 706c 6520  "look up sample 
-00013f80: 7365 7420 666f 7220 7361 6d70 6c65 2229  set for sample")
-00013f90: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00013fa0: 7265 6320 3d20 7365 6c66 2e73 616d 706c  rec = self.sampl
-00013fb0: 655f 6d65 7461 6461 7461 2829 2e73 6574  e_metadata().set
-00013fc0: 5f69 6e64 6578 2822 7361 6d70 6c65 5f69  _index("sample_i
-00013fd0: 6422 292e 6c6f 635b 7361 6d70 6c65 5d0a  d").loc[sample].
-00013fe0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-00013ff0: 6574 203d 2073 616d 706c 655f 7265 635b  et = sample_rec[
-00014000: 2273 616d 706c 655f 7365 7422 5d0a 0a20  "sample_set"].. 
-00014010: 2020 2020 2020 2064 6562 7567 2822 6c6f         debug("lo
-00014020: 6164 2064 6174 6120 6361 7461 6c6f 6722  ad data catalog"
-00014030: 290a 2020 2020 2020 2020 6466 5f63 6174  ).        df_cat
-00014040: 203d 2073 656c 662e 7767 735f 6461 7461   = self.wgs_data
-00014050: 5f63 6174 616c 6f67 2873 616d 706c 655f  _catalog(sample_
-00014060: 7365 743d 7361 6d70 6c65 5f73 6574 290a  set=sample_set).
-00014070: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00014080: 6c6f 6361 7465 2072 6563 6f72 6420 666f  locate record fo
-00014090: 7220 7361 6d70 6c65 2229 0a20 2020 2020  r sample").     
-000140a0: 2020 2063 6174 5f72 6563 203d 2064 665f     cat_rec = df_
-000140b0: 6361 742e 7365 745f 696e 6465 7828 2273  cat.set_index("s
-000140c0: 616d 706c 655f 6964 2229 2e6c 6f63 5b73  ample_id").loc[s
-000140d0: 616d 706c 655d 0a20 2020 2020 2020 2062  ample].        b
-000140e0: 616d 5f75 726c 203d 2063 6174 5f72 6563  am_url = cat_rec
-000140f0: 5b22 616c 6967 6e6d 656e 7473 5f62 616d  ["alignments_bam
-00014100: 225d 0a20 2020 2020 2020 2076 6366 5f75  "].        vcf_u
-00014110: 726c 203d 2063 6174 5f72 6563 5b22 736e  rl = cat_rec["sn
-00014120: 705f 6765 6e6f 7479 7065 735f 7663 6622  p_genotypes_vcf"
-00014130: 5d0a 2020 2020 2020 2020 6465 6275 6728  ].        debug(
-00014140: 6261 6d5f 7572 6c29 0a20 2020 2020 2020  bam_url).       
-00014150: 2064 6562 7567 2876 6366 5f75 726c 290a   debug(vcf_url).
-00014160: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00014170: 7061 7273 6520 7265 6769 6f6e 2229 0a20  parse region"). 
-00014180: 2020 2020 2020 2072 6573 6f6c 7665 645f         resolved_
-00014190: 7265 6769 6f6e 203d 2073 656c 662e 7265  region = self.re
-000141a0: 736f 6c76 655f 7265 6769 6f6e 2872 6567  solve_region(reg
-000141b0: 696f 6e29 0a20 2020 2020 2020 2064 656c  ion).        del
-000141c0: 2072 6567 696f 6e0a 2020 2020 2020 2020   region.        
-000141d0: 636f 6e74 6967 203d 2072 6573 6f6c 7665  contig = resolve
-000141e0: 645f 7265 6769 6f6e 2e63 6f6e 7469 670a  d_region.contig.
-000141f0: 0a20 2020 2020 2020 2023 2062 6567 696e  .        # begin
-00014200: 2063 7265 6174 696e 6720 7472 6163 6b73   creating tracks
-00014210: 0a20 2020 2020 2020 2074 7261 636b 733a  .        tracks:
-00014220: 204c 6973 745b 4469 6374 5d20 3d20 5b5d   List[Dict] = []
-00014230: 0a0a 2020 2020 2020 2020 2320 6874 7470  ..        # http
-00014240: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f69  s://github.com/i
-00014250: 6776 7465 616d 2f69 6776 2d6e 6f74 6562  gvteam/igv-noteb
-00014260: 6f6f 6b2f 6973 7375 6573 2f33 202d 2d20  ook/issues/3 -- 
-00014270: 7265 736f 6c76 6564 206e 6f77 0a20 2020  resolved now.   
-00014280: 2020 2020 2064 6562 7567 2822 7365 7420       debug("set 
-00014290: 7570 2073 6974 6520 6669 6c74 6572 7320  up site filters 
-000142a0: 7472 6163 6b73 2229 0a20 2020 2020 2020  tracks").       
-000142b0: 2073 656c 662e 5f76 6965 775f 616c 6967   self._view_alig
-000142c0: 6e6d 656e 7473 5f61 6464 5f73 6974 655f  nments_add_site_
-000142d0: 6669 6c74 6572 735f 7472 6163 6b73 280a  filters_tracks(.
-000142e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-000142f0: 6967 3d63 6f6e 7469 672c 2076 6973 6962  ig=contig, visib
-00014300: 696c 6974 795f 7769 6e64 6f77 3d76 6973  ility_window=vis
-00014310: 6962 696c 6974 795f 7769 6e64 6f77 2c20  ibility_window, 
-00014320: 7472 6163 6b73 3d74 7261 636b 730a 2020  tracks=tracks.  
-00014330: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00014340: 2064 6562 7567 2822 6164 6420 534e 5073   debug("add SNPs
-00014350: 2074 7261 636b 2229 0a20 2020 2020 2020   track").       
-00014360: 2074 7261 636b 732e 6170 7065 6e64 280a   tracks.append(.
-00014370: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-00014380: 2020 2020 2020 2020 2020 2020 2020 226e                "n
-00014390: 616d 6522 3a20 2253 4e50 7322 2c0a 2020  ame": "SNPs",.  
-000143a0: 2020 2020 2020 2020 2020 2020 2020 2275                "u
-000143b0: 726c 223a 2076 6366 5f75 726c 2c0a 2020  rl": vcf_url,.  
-000143c0: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-000143d0: 6e64 6578 5552 4c22 3a20 6622 7b76 6366  ndexURL": f"{vcf
-000143e0: 5f75 726c 7d2e 7462 6922 2c0a 2020 2020  _url}.tbi",.    
-000143f0: 2020 2020 2020 2020 2020 2020 2266 6f72              "for
-00014400: 6d61 7422 3a20 2276 6366 222c 0a20 2020  mat": "vcf",.   
-00014410: 2020 2020 2020 2020 2020 2020 2022 7479               "ty
-00014420: 7065 223a 2022 7661 7269 616e 7422 2c0a  pe": "variant",.
-00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014440: 2276 6973 6962 696c 6974 7957 696e 646f  "visibilityWindo
-00014450: 7722 3a20 7669 7369 6269 6c69 7479 5f77  w": visibility_w
-00014460: 696e 646f 772c 2020 2320 6270 0a20 2020  indow,  # bp.   
-00014470: 2020 2020 2020 2020 2020 2020 2022 6865               "he
-00014480: 6967 6874 223a 2035 302c 0a20 2020 2020  ight": 50,.     
-00014490: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000144a0: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
-000144b0: 6728 2261 6464 2061 6c69 676e 6d65 6e74  g("add alignment
-000144c0: 7320 7472 6163 6b22 290a 2020 2020 2020  s track").      
-000144d0: 2020 7472 6163 6b73 2e61 7070 656e 6428    tracks.append(
-000144e0: 0a20 2020 2020 2020 2020 2020 207b 0a20  .            {. 
-000144f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014500: 6e61 6d65 223a 2022 416c 6967 6e6d 656e  name": "Alignmen
-00014510: 7473 222c 0a20 2020 2020 2020 2020 2020  ts",.           
-00014520: 2020 2020 2022 7572 6c22 3a20 6261 6d5f       "url": bam_
-00014530: 7572 6c2c 0a20 2020 2020 2020 2020 2020  url,.           
-00014540: 2020 2020 2022 696e 6465 7855 524c 223a       "indexURL":
-00014550: 2066 227b 6261 6d5f 7572 6c7d 2e62 6169   f"{bam_url}.bai
-00014560: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00014570: 2020 2022 666f 726d 6174 223a 2022 6261     "format": "ba
-00014580: 6d22 2c0a 2020 2020 2020 2020 2020 2020  m",.            
-00014590: 2020 2020 2274 7970 6522 3a20 2261 6c69      "type": "ali
-000145a0: 676e 6d65 6e74 222c 0a20 2020 2020 2020  gnment",.       
-000145b0: 2020 2020 2020 2020 2022 7669 7369 6269           "visibi
-000145c0: 6c69 7479 5769 6e64 6f77 223a 2076 6973  lityWindow": vis
-000145d0: 6962 696c 6974 795f 7769 6e64 6f77 2c20  ibility_window, 
-000145e0: 2023 2062 700a 2020 2020 2020 2020 2020   # bp.          
-000145f0: 2020 2020 2020 2268 6569 6768 7422 3a20        "height": 
-00014600: 3530 302c 0a20 2020 2020 2020 2020 2020  500,.           
-00014610: 207d 0a20 2020 2020 2020 2029 0a0a 2020   }.        )..  
-00014620: 2020 2020 2020 6465 6275 6728 2263 7265        debug("cre
-00014630: 6174 6520 4947 5620 6272 6f77 7365 7222  ate IGV browser"
-00014640: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-00014650: 6776 2872 6567 696f 6e3d 7265 736f 6c76  gv(region=resolv
-00014660: 6564 5f72 6567 696f 6e2c 2074 7261 636b  ed_region, track
-00014670: 733d 7472 6163 6b73 290a 0a20 2020 2064  s=tracks)..    d
-00014680: 6566 205f 7063 6128 0a20 2020 2020 2020  ef _pca(.       
-00014690: 2073 656c 662c 0a20 2020 2020 2020 202a   self,.        *
-000146a0: 2c0a 2020 2020 2020 2020 7265 6769 6f6e  ,.        region
-000146b0: 2c0a 2020 2020 2020 2020 6e5f 736e 7073  ,.        n_snps
-000146c0: 2c0a 2020 2020 2020 2020 7468 696e 5f6f  ,.        thin_o
-000146d0: 6666 7365 742c 0a20 2020 2020 2020 2073  ffset,.        s
-000146e0: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
-000146f0: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-00014700: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
-00014710: 6173 6b2c 0a20 2020 2020 2020 206d 696e  ask,.        min
-00014720: 5f6d 696e 6f72 5f61 632c 0a20 2020 2020  _minor_ac,.     
-00014730: 2020 206d 6178 5f6d 6973 7369 6e67 5f61     max_missing_a
-00014740: 6e2c 0a20 2020 2020 2020 206e 5f63 6f6d  n,.        n_com
-00014750: 706f 6e65 6e74 732c 0a20 2020 2029 3a0a  ponents,.    ):.
-00014760: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-00014770: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-00014780: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00014790: 6163 6365 7373 2053 4e50 2063 616c 6c73  access SNP calls
-000147a0: 2229 0a20 2020 2020 2020 2064 735f 736e  ").        ds_sn
-000147b0: 7073 203d 2073 656c 662e 736e 705f 6361  ps = self.snp_ca
-000147c0: 6c6c 7328 0a20 2020 2020 2020 2020 2020  lls(.           
-000147d0: 2072 6567 696f 6e3d 7265 6769 6f6e 2c0a   region=region,.
-000147e0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-000147f0: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-00014800: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
-00014810: 2073 616d 706c 655f 7175 6572 793d 7361   sample_query=sa
-00014820: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
-00014830: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-00014840: 6b3d 7369 7465 5f6d 6173 6b2c 0a20 2020  k=site_mask,.   
-00014850: 2020 2020 2029 0a20 2020 2020 2020 2064       ).        d
-00014860: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
-00014870: 2020 6622 7b64 735f 736e 7073 2e64 696d    f"{ds_snps.dim
-00014880: 735b 2776 6172 6961 6e74 7327 5d3a 2c7d  s['variants']:,}
-00014890: 2076 6172 6961 6e74 732c 207b 6473 5f73   variants, {ds_s
-000148a0: 6e70 732e 6469 6d73 5b27 7361 6d70 6c65  nps.dims['sample
-000148b0: 7327 5d3a 2c7d 2073 616d 706c 6573 220a  s']:,} samples".
-000148c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000148d0: 2020 2064 6562 7567 2822 7065 7266 6f72     debug("perfor
-000148e0: 6d20 616c 6c65 6c65 2063 6f75 6e74 2229  m allele count")
-000148f0: 0a20 2020 2020 2020 2061 6320 3d20 7365  .        ac = se
-00014900: 6c66 2e73 6e70 5f61 6c6c 656c 655f 636f  lf.snp_allele_co
-00014910: 756e 7473 280a 2020 2020 2020 2020 2020  unts(.          
-00014920: 2020 7265 6769 6f6e 3d72 6567 696f 6e2c    region=region,
-00014930: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00014940: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-00014950: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
-00014960: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
-00014970: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
-00014980: 2020 2020 2020 2020 2073 6974 655f 6d61           site_ma
-00014990: 736b 3d73 6974 655f 6d61 736b 2c0a 2020  sk=site_mask,.  
-000149a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000149b0: 6e5f 6368 726f 6d73 203d 2064 735f 736e  n_chroms = ds_sn
-000149c0: 7073 2e64 696d 735b 2273 616d 706c 6573  ps.dims["samples
-000149d0: 225d 202a 2032 0a20 2020 2020 2020 2061  "] * 2.        a
-000149e0: 6e5f 6361 6c6c 6564 203d 2061 632e 7375  n_called = ac.su
-000149f0: 6d28 6178 6973 3d31 290a 2020 2020 2020  m(axis=1).      
-00014a00: 2020 616e 5f6d 6973 7369 6e67 203d 206e    an_missing = n
-00014a10: 5f63 6872 6f6d 7320 2d20 616e 5f63 616c  _chroms - an_cal
-00014a20: 6c65 640a 0a20 2020 2020 2020 2064 6562  led..        deb
-00014a30: 7567 2822 6173 6365 7274 6169 6e20 7369  ug("ascertain si
-00014a40: 7465 7322 290a 2020 2020 2020 2020 6163  tes").        ac
-00014a50: 203d 2061 6c6c 656c 2e41 6c6c 656c 6543   = allel.AlleleC
-00014a60: 6f75 6e74 7341 7272 6179 2861 6329 0a20  ountsArray(ac). 
-00014a70: 2020 2020 2020 206d 696e 5f72 6566 5f61         min_ref_a
-00014a80: 6320 3d20 6d69 6e5f 6d69 6e6f 725f 6163  c = min_minor_ac
-00014a90: 0a20 2020 2020 2020 206d 6178 5f72 6566  .        max_ref
-00014aa0: 5f61 6320 3d20 6e5f 6368 726f 6d73 202d  _ac = n_chroms -
-00014ab0: 206d 696e 5f6d 696e 6f72 5f61 630a 2020   min_minor_ac.  
-00014ac0: 2020 2020 2020 2320 6865 7265 2077 6520        # here we 
-00014ad0: 6368 6f6f 7365 2062 6961 6c6c 656c 6963  choose biallelic
-00014ae0: 2073 6974 6573 2069 6e76 6f6c 7669 6e67   sites involving
-00014af0: 2074 6865 2072 6566 6572 656e 6365 2061   the reference a
-00014b00: 6c6c 656c 650a 2020 2020 2020 2020 6c6f  llele.        lo
-00014b10: 635f 7369 7465 7320 3d20 280a 2020 2020  c_sites = (.    
-00014b20: 2020 2020 2020 2020 6163 2e69 735f 6269          ac.is_bi
-00014b30: 616c 6c65 6c69 6328 290a 2020 2020 2020  allelic().      
-00014b40: 2020 2020 2020 2620 2861 635b 3a2c 2030        & (ac[:, 0
-00014b50: 5d20 3e3d 206d 696e 5f72 6566 5f61 6329  ] >= min_ref_ac)
-00014b60: 0a20 2020 2020 2020 2020 2020 2026 2028  .            & (
-00014b70: 6163 5b3a 2c20 305d 203c 3d20 6d61 785f  ac[:, 0] <= max_
-00014b80: 7265 665f 6163 290a 2020 2020 2020 2020  ref_ac).        
-00014b90: 2020 2020 2620 2861 6e5f 6d69 7373 696e      & (an_missin
-00014ba0: 6720 3c3d 206d 6178 5f6d 6973 7369 6e67  g <= max_missing
-00014bb0: 5f61 6e29 0a20 2020 2020 2020 2029 0a20  _an).        ). 
-00014bc0: 2020 2020 2020 2064 6562 7567 2866 2261         debug(f"a
-00014bd0: 7363 6572 7461 696e 6564 207b 6e70 2e63  scertained {np.c
-00014be0: 6f75 6e74 5f6e 6f6e 7a65 726f 286c 6f63  ount_nonzero(loc
-00014bf0: 5f73 6974 6573 293a 2c7d 2073 6974 6573  _sites):,} sites
-00014c00: 2229 0a0a 2020 2020 2020 2020 6465 6275  ")..        debu
-00014c10: 6728 2274 6869 6e20 7369 7465 7320 746f  g("thin sites to
-00014c20: 2061 7070 726f 7869 6d61 7465 6c79 2064   approximately d
-00014c30: 6573 6972 6564 206e 756d 6265 7222 290a  esired number").
-00014c40: 2020 2020 2020 2020 6c6f 635f 7369 7465          loc_site
-00014c50: 7320 3d20 6e70 2e6e 6f6e 7a65 726f 286c  s = np.nonzero(l
-00014c60: 6f63 5f73 6974 6573 295b 305d 0a20 2020  oc_sites)[0].   
-00014c70: 2020 2020 2074 6869 6e5f 7374 6570 203d       thin_step =
-00014c80: 206d 6178 286c 6f63 5f73 6974 6573 2e73   max(loc_sites.s
-00014c90: 6861 7065 5b30 5d20 2f2f 206e 5f73 6e70  hape[0] // n_snp
-00014ca0: 732c 2031 290a 2020 2020 2020 2020 6c6f  s, 1).        lo
-00014cb0: 635f 7369 7465 735f 7468 696e 6e65 6420  c_sites_thinned 
-00014cc0: 3d20 6c6f 635f 7369 7465 735b 7468 696e  = loc_sites[thin
-00014cd0: 5f6f 6666 7365 743a 3a74 6869 6e5f 7374  _offset::thin_st
-00014ce0: 6570 5d0a 2020 2020 2020 2020 6465 6275  ep].        debu
-00014cf0: 6728 6622 7468 696e 6e65 6420 746f 207b  g(f"thinned to {
-00014d00: 6e70 2e63 6f75 6e74 5f6e 6f6e 7a65 726f  np.count_nonzero
-00014d10: 286c 6f63 5f73 6974 6573 5f74 6869 6e6e  (loc_sites_thinn
-00014d20: 6564 293a 2c7d 2073 6974 6573 2229 0a0a  ed):,} sites")..
-00014d30: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-00014d40: 6363 6573 7320 6765 6e6f 7479 7065 7322  ccess genotypes"
-00014d50: 290a 2020 2020 2020 2020 6774 203d 2064  ).        gt = d
-00014d60: 735f 736e 7073 5b22 6361 6c6c 5f67 656e  s_snps["call_gen
-00014d70: 6f74 7970 6522 5d2e 6461 7461 0a20 2020  otype"].data.   
-00014d80: 2020 2020 2067 745f 6173 6320 3d20 6461       gt_asc = da
-00014d90: 2e74 616b 6528 6774 2c20 6c6f 635f 7369  .take(gt, loc_si
-00014da0: 7465 735f 7468 696e 6e65 642c 2061 7869  tes_thinned, axi
-00014db0: 733d 3029 0a20 2020 2020 2020 2067 6e5f  s=0).        gn_
-00014dc0: 6173 6320 3d20 616c 6c65 6c2e 4765 6e6f  asc = allel.Geno
-00014dd0: 7479 7065 4461 736b 4172 7261 7928 6774  typeDaskArray(gt
-00014de0: 5f61 7363 292e 746f 5f6e 5f61 6c74 2829  _asc).to_n_alt()
-00014df0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00014e00: 6c66 2e5f 6461 736b 5f70 726f 6772 6573  lf._dask_progres
-00014e10: 7328 6465 7363 3d22 4c6f 6164 2053 4e50  s(desc="Load SNP
-00014e20: 2067 656e 6f74 7970 6573 2229 3a0a 2020   genotypes"):.  
-00014e30: 2020 2020 2020 2020 2020 676e 5f61 7363            gn_asc
-00014e40: 203d 2067 6e5f 6173 632e 636f 6d70 7574   = gn_asc.comput
-00014e50: 6528 290a 0a20 2020 2020 2020 2064 6562  e()..        deb
-00014e60: 7567 2822 7265 6d6f 7665 2061 6e79 2073  ug("remove any s
-00014e70: 6974 6573 2077 6865 7265 2061 6c6c 2067  ites where all g
-00014e80: 656e 6f74 7970 6573 2061 7265 2069 6465  enotypes are ide
-00014e90: 6e74 6963 616c 2229 0a20 2020 2020 2020  ntical").       
-00014ea0: 206c 6f63 5f76 6172 203d 206e 702e 616e   loc_var = np.an
-00014eb0: 7928 676e 5f61 7363 2021 3d20 676e 5f61  y(gn_asc != gn_a
-00014ec0: 7363 5b3a 2c20 302c 206e 702e 6e65 7761  sc[:, 0, np.newa
-00014ed0: 7869 735d 2c20 6178 6973 3d31 290a 2020  xis], axis=1).  
-00014ee0: 2020 2020 2020 676e 5f76 6172 203d 206e        gn_var = n
-00014ef0: 702e 636f 6d70 7265 7373 286c 6f63 5f76  p.compress(loc_v
-00014f00: 6172 2c20 676e 5f61 7363 2c20 6178 6973  ar, gn_asc, axis
-00014f10: 3d30 290a 2020 2020 2020 2020 6465 6275  =0).        debu
-00014f20: 6728 6622 6669 6e61 6c20 7368 6170 6520  g(f"final shape 
-00014f30: 7b67 6e5f 7661 722e 7368 6170 657d 2229  {gn_var.shape}")
-00014f40: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00014f50: 2272 756e 2074 6865 2050 4341 2229 0a20  "run the PCA"). 
-00014f60: 2020 2020 2020 2063 6f6f 7264 732c 206d         coords, m
-00014f70: 6f64 656c 203d 2061 6c6c 656c 2e70 6361  odel = allel.pca
-00014f80: 2867 6e5f 7661 722c 206e 5f63 6f6d 706f  (gn_var, n_compo
-00014f90: 6e65 6e74 733d 6e5f 636f 6d70 6f6e 656e  nents=n_componen
-00014fa0: 7473 290a 0a20 2020 2020 2020 2064 6562  ts)..        deb
-00014fb0: 7567 2822 776f 726b 2061 726f 756e 6420  ug("work around 
-00014fc0: 7369 676e 2069 6e64 6574 6572 6d69 6e61  sign indetermina
-00014fd0: 6379 2229 0a20 2020 2020 2020 2066 6f72  cy").        for
-00014fe0: 2069 2069 6e20 7261 6e67 6528 6e5f 636f   i in range(n_co
-00014ff0: 6d70 6f6e 656e 7473 293a 0a20 2020 2020  mponents):.     
-00015000: 2020 2020 2020 2063 203d 2063 6f6f 7264         c = coord
-00015010: 735b 3a2c 2069 5d0a 2020 2020 2020 2020  s[:, i].        
-00015020: 2020 2020 6966 206e 702e 6162 7328 632e      if np.abs(c.
-00015030: 6d69 6e28 2929 203e 206e 702e 6162 7328  min()) > np.abs(
-00015040: 632e 6d61 7828 2929 3a0a 2020 2020 2020  c.max()):.      
-00015050: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
-00015060: 5b3a 2c20 695d 203d 2063 202a 202d 310a  [:, i] = c * -1.
-00015070: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-00015080: 203d 2064 6963 7428 636f 6f72 6473 3d63   = dict(coords=c
-00015090: 6f6f 7264 732c 2065 7672 3d6d 6f64 656c  oords, evr=model
-000150a0: 2e65 7870 6c61 696e 6564 5f76 6172 6961  .explained_varia
-000150b0: 6e63 655f 7261 7469 6f5f 290a 2020 2020  nce_ratio_).    
-000150c0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000150d0: 7473 0a0a 2020 2020 4064 6f63 280a 2020  ts..    @doc(.  
-000150e0: 2020 2020 2020 7375 6d6d 6172 793d 2222        summary=""
-000150f0: 220a 2020 2020 2020 2020 2020 2020 506c  ".            Pl
-00015100: 6f74 2065 7870 6c61 696e 6564 2076 6172  ot explained var
-00015110: 6961 6e63 6520 7261 7469 6f73 2066 726f  iance ratios fro
-00015120: 6d20 6120 7072 696e 6369 7061 6c20 636f  m a principal co
-00015130: 6d70 6f6e 656e 7473 2061 6e61 6c79 7369  mponents analysi
-00015140: 730a 2020 2020 2020 2020 2020 2020 2850  s.            (P
-00015150: 4341 2920 7573 696e 6720 6120 706c 6f74  CA) using a plot
-00015160: 6c79 2062 6172 2070 6c6f 742e 0a20 2020  ly bar plot..   
-00015170: 2020 2020 2022 2222 2c0a 2020 2020 2020       """,.      
-00015180: 2020 7061 7261 6d65 7465 7273 3d64 6963    parameters=dic
-00015190: 7428 0a20 2020 2020 2020 2020 2020 206b  t(.            k
-000151a0: 7761 7267 733d 2250 6173 7365 6420 7468  wargs="Passed th
-000151b0: 726f 7567 6820 746f 2070 782e 6261 7228  rough to px.bar(
-000151c0: 292e 222c 0a20 2020 2020 2020 2029 2c0a  ).",.        ),.
-000151d0: 2020 2020 2020 2020 7265 7475 726e 733d          returns=
-000151e0: 2241 2070 6c6f 746c 7920 6669 6775 7265  "A plotly figure
-000151f0: 2e22 2c0a 2020 2020 290a 2020 2020 6465  .",.    ).    de
-00015200: 6620 706c 6f74 5f70 6361 5f76 6172 6961  f plot_pca_varia
-00015210: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
-00015220: 662c 0a20 2020 2020 2020 2065 7672 3a20  f,.        evr: 
-00015230: 7063 615f 7061 7261 6d73 2e65 7672 2c0a  pca_params.evr,.
-00015240: 2020 2020 2020 2020 7769 6474 683a 2070          width: p
-00015250: 6c6f 746c 795f 7061 7261 6d73 2e77 6964  lotly_params.wid
-00015260: 7468 203d 2039 3030 2c0a 2020 2020 2020  th = 900,.      
-00015270: 2020 6865 6967 6874 3a20 706c 6f74 6c79    height: plotly
-00015280: 5f70 6172 616d 732e 6865 6967 6874 203d  _params.height =
-00015290: 2034 3030 2c0a 2020 2020 2020 2020 2a2a   400,.        **
-000152a0: 6b77 6172 6773 2c0a 2020 2020 2920 2d3e  kwargs,.    ) ->
-000152b0: 2067 6f2e 4669 6775 7265 3a0a 2020 2020   go.Figure:.    
-000152c0: 2020 2020 6465 6275 6720 3d20 7365 6c66      debug = self
-000152d0: 2e5f 6c6f 672e 6465 6275 670a 0a20 2020  ._log.debug..   
-000152e0: 2020 2020 2064 6562 7567 2822 7072 6570       debug("prep
-000152f0: 6172 6520 706c 6f74 7469 6e67 2076 6172  are plotting var
-00015300: 6961 626c 6573 2229 0a20 2020 2020 2020  iables").       
-00015310: 2079 203d 2065 7672 202a 2031 3030 2020   y = evr * 100  
-00015320: 2320 636f 6e76 6572 7420 746f 2070 6572  # convert to per
-00015330: 6365 6e74 0a20 2020 2020 2020 2078 203d  cent.        x =
-00015340: 205b 7374 7228 6920 2b20 3129 2066 6f72   [str(i + 1) for
-00015350: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-00015360: 7929 295d 0a0a 2020 2020 2020 2020 6465  y))]..        de
-00015370: 6275 6728 2273 6574 2075 7020 706c 6f74  bug("set up plot
-00015380: 7469 6e67 206f 7074 696f 6e73 2229 0a20  ting options"). 
-00015390: 2020 2020 2020 2070 6c6f 745f 6b77 6172         plot_kwar
-000153a0: 6773 203d 2064 6963 7428 0a20 2020 2020  gs = dict(.     
-000153b0: 2020 2020 2020 206c 6162 656c 733d 7b0a         labels={.
-000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153d0: 2278 223a 2022 5072 696e 6369 7061 6c20  "x": "Principal 
-000153e0: 636f 6d70 6f6e 656e 7422 2c0a 2020 2020  component",.    
-000153f0: 2020 2020 2020 2020 2020 2020 2279 223a              "y":
-00015400: 2022 4578 706c 6169 6e65 6420 7661 7269   "Explained vari
-00015410: 616e 6365 2028 2529 222c 0a20 2020 2020  ance (%)",.     
-00015420: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-00015430: 2020 2020 2020 7465 6d70 6c61 7465 3d22        template="
-00015440: 7369 6d70 6c65 5f77 6869 7465 222c 0a20  simple_white",. 
-00015450: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00015460: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
-00015470: 2020 2020 6865 6967 6874 3d68 6569 6768      height=heigh
-00015480: 742c 0a20 2020 2020 2020 2029 0a20 2020  t,.        ).   
-00015490: 2020 2020 2064 6562 7567 2822 6170 706c       debug("appl
-000154a0: 7920 616e 7920 7573 6572 206f 7665 7272  y any user overr
-000154b0: 6964 6573 2229 0a20 2020 2020 2020 2070  ides").        p
-000154c0: 6c6f 745f 6b77 6172 6773 2e75 7064 6174  lot_kwargs.updat
-000154d0: 6528 6b77 6172 6773 290a 0a20 2020 2020  e(kwargs)..     
-000154e0: 2020 2064 6562 7567 2822 6d61 6b65 2061     debug("make a
-000154f0: 2062 6172 2070 6c6f 7422 290a 2020 2020   bar plot").    
-00015500: 2020 2020 6669 6720 3d20 7078 2e62 6172      fig = px.bar
-00015510: 2878 3d78 2c20 793d 792c 202a 2a70 6c6f  (x=x, y=y, **plo
-00015520: 745f 6b77 6172 6773 290a 0a20 2020 2020  t_kwargs)..     
-00015530: 2020 2072 6574 7572 6e20 6669 670a 0a20     return fig.. 
-00015540: 2020 2064 6566 205f 636f 686f 7274 5f61     def _cohort_a
-00015550: 6c74 5f61 6c6c 656c 655f 636f 756e 7473  lt_allele_counts
-00015560: 5f6d 656c 7428 7365 6c66 2c20 6774 2c20  _melt(self, gt, 
-00015570: 696e 6469 6365 732c 206d 6178 5f61 6c6c  indices, max_all
-00015580: 656c 6529 3a0a 2020 2020 2020 2020 6163  ele):.        ac
-00015590: 5f61 6c74 5f6d 656c 742c 2061 6e20 3d20  _alt_melt, an = 
-000155a0: 7365 6c66 2e5f 636f 686f 7274 5f61 6c74  self._cohort_alt
-000155b0: 5f61 6c6c 656c 655f 636f 756e 7473 5f6d  _allele_counts_m
-000155c0: 656c 745f 6b65 726e 656c 280a 2020 2020  elt_kernel(.    
-000155d0: 2020 2020 2020 2020 6774 2c20 696e 6469          gt, indi
-000155e0: 6365 732c 206d 6178 5f61 6c6c 656c 650a  ces, max_allele.
-000155f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00015600: 2020 616e 5f6d 656c 7420 3d20 6e70 2e72    an_melt = np.r
-00015610: 6570 6561 7428 616e 2c20 6d61 785f 616c  epeat(an, max_al
-00015620: 6c65 6c65 2c20 6178 6973 3d30 290a 2020  lele, axis=0).  
-00015630: 2020 2020 2020 7265 7475 726e 2061 635f        return ac_
-00015640: 616c 745f 6d65 6c74 2c20 616e 5f6d 656c  alt_melt, an_mel
-00015650: 740a 0a20 2020 2064 6566 205f 7072 6570  t..    def _prep
-00015660: 5f73 616d 706c 6573 5f66 6f72 5f63 6f68  _samples_for_coh
-00015670: 6f72 745f 6772 6f75 7069 6e67 2873 656c  ort_grouping(sel
-00015680: 662c 202a 2c20 6466 5f73 616d 706c 6573  f, *, df_samples
-00015690: 2c20 6172 6561 5f62 792c 2070 6572 696f  , area_by, perio
-000156a0: 645f 6279 293a 0a20 2020 2020 2020 2023  d_by):.        #
-000156b0: 2074 616b 6520 6120 636f 7079 2c20 6173   take a copy, as
-000156c0: 2077 6520 7769 6c6c 206d 6f64 6966 7920   we will modify 
-000156d0: 7468 6520 6461 7461 6672 616d 650a 2020  the dataframe.  
-000156e0: 2020 2020 2020 6466 5f73 616d 706c 6573        df_samples
-000156f0: 203d 2064 665f 7361 6d70 6c65 732e 636f   = df_samples.co
-00015700: 7079 2829 0a0a 2020 2020 2020 2020 2320  py()..        # 
-00015710: 6669 7820 696e 7465 726d 6564 6961 7465  fix intermediate
-00015720: 2074 6178 6f6e 2076 616c 7565 7320 2d20   taxon values - 
-00015730: 7765 206f 6e6c 7920 7761 6e74 2074 6f20  we only want to 
-00015740: 6275 696c 6420 636f 686f 7274 7320 7769  build cohorts wi
-00015750: 7468 2063 6c65 616e 0a20 2020 2020 2020  th clean.       
-00015760: 2023 2074 6178 6f6e 2063 616c 6c73 2c20   # taxon calls, 
-00015770: 736f 2077 6520 7365 7420 696e 7465 726d  so we set interm
-00015780: 6564 6961 7465 2076 616c 7565 7320 746f  ediate values to
-00015790: 204e 6f6e 650a 2020 2020 2020 2020 6c6f   None.        lo
-000157a0: 635f 696e 7465 726d 6564 6961 7465 5f74  c_intermediate_t
-000157b0: 6178 6f6e 203d 2028 0a20 2020 2020 2020  axon = (.       
-000157c0: 2020 2020 2064 665f 7361 6d70 6c65 735b       df_samples[
-000157d0: 2274 6178 6f6e 225d 2e73 7472 2e73 7461  "taxon"].str.sta
-000157e0: 7274 7377 6974 6828 2269 6e74 6572 6d65  rtswith("interme
-000157f0: 6469 6174 6522 292e 6669 6c6c 6e61 2846  diate").fillna(F
-00015800: 616c 7365 290a 2020 2020 2020 2020 290a  alse).        ).
-00015810: 2020 2020 2020 2020 6466 5f73 616d 706c          df_sampl
-00015820: 6573 2e6c 6f63 5b6c 6f63 5f69 6e74 6572  es.loc[loc_inter
-00015830: 6d65 6469 6174 655f 7461 786f 6e2c 2022  mediate_taxon, "
-00015840: 7461 786f 6e22 5d20 3d20 4e6f 6e65 0a0a  taxon"] = None..
-00015850: 2020 2020 2020 2020 2320 6164 6420 7065          # add pe
-00015860: 7269 6f64 2063 6f6c 756d 6e0a 2020 2020  riod column.    
-00015870: 2020 2020 6966 2070 6572 696f 645f 6279      if period_by
-00015880: 203d 3d20 2279 6561 7222 3a0a 2020 2020   == "year":.    
-00015890: 2020 2020 2020 2020 6d61 6b65 5f70 6572          make_per
-000158a0: 696f 6420 3d20 7365 6c66 2e5f 6d61 6b65  iod = self._make
-000158b0: 5f73 616d 706c 655f 7065 7269 6f64 5f79  _sample_period_y
-000158c0: 6561 720a 2020 2020 2020 2020 656c 6966  ear.        elif
-000158d0: 2070 6572 696f 645f 6279 203d 3d20 2271   period_by == "q
-000158e0: 7561 7274 6572 223a 0a20 2020 2020 2020  uarter":.       
-000158f0: 2020 2020 206d 616b 655f 7065 7269 6f64       make_period
-00015900: 203d 2073 656c 662e 5f6d 616b 655f 7361   = self._make_sa
-00015910: 6d70 6c65 5f70 6572 696f 645f 7175 6172  mple_period_quar
-00015920: 7465 720a 2020 2020 2020 2020 656c 6966  ter.        elif
-00015930: 2070 6572 696f 645f 6279 203d 3d20 226d   period_by == "m
-00015940: 6f6e 7468 223a 0a20 2020 2020 2020 2020  onth":.         
-00015950: 2020 206d 616b 655f 7065 7269 6f64 203d     make_period =
-00015960: 2073 656c 662e 5f6d 616b 655f 7361 6d70   self._make_samp
-00015970: 6c65 5f70 6572 696f 645f 6d6f 6e74 680a  le_period_month.
-00015980: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00015990: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000159a0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000159b0: 2020 2020 2020 2020 2020 2020 6622 5661              f"Va
-000159c0: 6c75 6520 666f 7220 7065 7269 6f64 5f62  lue for period_b
-000159d0: 7920 7061 7261 6d65 7465 7220 6d75 7374  y parameter must
-000159e0: 2062 6520 6f6e 6520 6f66 2027 7965 6172   be one of 'year
-000159f0: 272c 2027 7175 6172 7465 7227 2c20 276d  ', 'quarter', 'm
-00015a00: 6f6e 7468 273b 2066 6f75 6e64 207b 7065  onth'; found {pe
-00015a10: 7269 6f64 5f62 7921 727d 2e22 0a20 2020  riod_by!r}.".   
-00015a20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00015a30: 2020 2073 616d 706c 655f 7065 7269 6f64     sample_period
-00015a40: 203d 2064 665f 7361 6d70 6c65 732e 6170   = df_samples.ap
-00015a50: 706c 7928 6d61 6b65 5f70 6572 696f 642c  ply(make_period,
-00015a60: 2061 7869 733d 2263 6f6c 756d 6e73 2229   axis="columns")
-00015a70: 0a20 2020 2020 2020 2064 665f 7361 6d70  .        df_samp
-00015a80: 6c65 735b 2270 6572 696f 6422 5d20 3d20  les["period"] = 
-00015a90: 7361 6d70 6c65 5f70 6572 696f 640a 0a20  sample_period.. 
-00015aa0: 2020 2020 2020 2023 2061 6464 2061 7265         # add are
-00015ab0: 6120 636f 6c75 6d6e 2066 6f72 2063 6f6e  a column for con
-00015ac0: 7369 7374 656e 7420 6f75 7470 7574 0a20  sistent output. 
-00015ad0: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
-00015ae0: 735b 2261 7265 6122 5d20 3d20 6466 5f73  s["area"] = df_s
-00015af0: 616d 706c 6573 5b61 7265 615f 6279 5d0a  amples[area_by].
-00015b00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015b10: 6466 5f73 616d 706c 6573 0a0a 2020 2020  df_samples..    
-00015b20: 6465 6620 5f72 6567 696f 6e5f 7374 7228  def _region_str(
-00015b30: 7365 6c66 2c20 7265 6769 6f6e 293a 0a20  self, region):. 
-00015b40: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
-00015b50: 7420 6120 7265 6769 6f6e 2074 6f20 6120  t a region to a 
-00015b60: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
-00015b70: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00015b80: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00015b90: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00015ba0: 2020 2020 2020 7265 6769 6f6e 203a 2052        region : R
-00015bb0: 6567 696f 6e20 6f72 206c 6973 7420 6f66  egion or list of
-00015bc0: 2052 6567 696f 6e0a 2020 2020 2020 2020   Region.        
-00015bd0: 2020 2020 5468 6520 7265 6769 6f6e 2074      The region t
-00015be0: 6f20 6469 7370 6c61 792e 0a0a 2020 2020  o display...    
-00015bf0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00015c00: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00015c10: 2020 2020 6f75 7420 3a20 7374 720a 0a20      out : str.. 
-00015c20: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015c30: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00015c40: 2872 6567 696f 6e2c 206c 6973 7429 3a0a  (region, list):.
-00015c50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00015c60: 656e 2872 6567 696f 6e29 203e 2031 3a0a  en(region) > 1:.
-00015c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c80: 7265 7475 726e 2022 3b20 222e 6a6f 696e  return "; ".join
-00015c90: 285b 7365 6c66 2e5f 7265 6769 6f6e 5f73  ([self._region_s
-00015ca0: 7472 2872 2920 666f 7220 7220 696e 2072  tr(r) for r in r
-00015cb0: 6567 696f 6e5d 290a 2020 2020 2020 2020  egion]).        
-00015cc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00015cd0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-00015ce0: 203d 2072 6567 696f 6e5b 305d 0a0a 2020   = region[0]..  
-00015cf0: 2020 2020 2020 2320 7361 6e69 7479 2063        # sanity c
-00015d00: 6865 636b 0a20 2020 2020 2020 2061 7373  heck.        ass
-00015d10: 6572 7420 6973 696e 7374 616e 6365 2872  ert isinstance(r
-00015d20: 6567 696f 6e2c 2052 6567 696f 6e29 0a0a  egion, Region)..
-00015d30: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00015d40: 7472 2872 6567 696f 6e29 0a0a 2020 2020  tr(region)..    
-00015d50: 6465 6620 5f6c 6f6f 6b75 705f 7361 6d70  def _lookup_samp
-00015d60: 6c65 2873 656c 662c 2073 616d 706c 652c  le(self, sample,
-00015d70: 2073 616d 706c 655f 7365 743d 4e6f 6e65   sample_set=None
-00015d80: 293a 0a20 2020 2020 2020 2064 665f 7361  ):.        df_sa
-00015d90: 6d70 6c65 7320 3d20 7365 6c66 2e73 616d  mples = self.sam
-00015da0: 706c 655f 6d65 7461 6461 7461 2873 616d  ple_metadata(sam
-00015db0: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-00015dc0: 7365 7429 2e73 6574 5f69 6e64 6578 2822  set).set_index("
-00015dd0: 7361 6d70 6c65 5f69 6422 290a 2020 2020  sample_id").    
-00015de0: 2020 2020 7361 6d70 6c65 5f72 6563 203d      sample_rec =
-00015df0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-00015e00: 2069 7369 6e73 7461 6e63 6528 7361 6d70   isinstance(samp
-00015e10: 6c65 2c20 7374 7229 3a0a 2020 2020 2020  le, str):.      
-00015e20: 2020 2020 2020 7361 6d70 6c65 5f72 6563        sample_rec
-00015e30: 203d 2064 665f 7361 6d70 6c65 732e 6c6f   = df_samples.lo
-00015e40: 635b 7361 6d70 6c65 5d0a 2020 2020 2020  c[sample].      
-00015e50: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00015e60: 6528 7361 6d70 6c65 2c20 696e 7429 3a0a  e(sample, int):.
-00015e70: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00015e80: 6c65 5f72 6563 203d 2064 665f 7361 6d70  le_rec = df_samp
-00015e90: 6c65 732e 696c 6f63 5b73 616d 706c 655d  les.iloc[sample]
-00015ea0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015eb0: 2020 2020 2020 2020 2020 2074 7970 655f             type_
-00015ec0: 6572 726f 7228 6e61 6d65 3d22 7361 6d70  error(name="samp
-00015ed0: 6c65 222c 2076 616c 7565 3d73 616d 706c  le", value=sampl
-00015ee0: 652c 2065 7870 6563 7461 7469 6f6e 3d28  e, expectation=(
-00015ef0: 7374 722c 2069 6e74 2929 0a20 2020 2020  str, int)).     
-00015f00: 2020 2072 6574 7572 6e20 7361 6d70 6c65     return sample
-00015f10: 5f72 6563 0a0a 2020 2020 6465 6620 5f70  _rec..    def _p
-00015f20: 6c6f 745f 6865 7465 726f 7a79 676f 7369  lot_heterozygosi
-00015f30: 7479 5f74 7261 636b 280a 2020 2020 2020  ty_track(.      
-00015f40: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00015f50: 2a2c 0a20 2020 2020 2020 2073 616d 706c  *,.        sampl
-00015f60: 655f 6964 2c0a 2020 2020 2020 2020 7361  e_id,.        sa
-00015f70: 6d70 6c65 5f73 6574 2c0a 2020 2020 2020  mple_set,.      
-00015f80: 2020 7769 6e64 6f77 732c 0a20 2020 2020    windows,.     
-00015f90: 2020 2063 6f75 6e74 732c 0a20 2020 2020     counts,.     
-00015fa0: 2020 2072 6567 696f 6e2c 0a20 2020 2020     region,.     
-00015fb0: 2020 2077 696e 646f 775f 7369 7a65 2c0a     window_size,.
-00015fc0: 2020 2020 2020 2020 795f 6d61 782c 0a20          y_max,. 
-00015fd0: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
-00015fe0: 6465 2c0a 2020 2020 2020 2020 7769 6474  de,.        widt
-00015ff0: 682c 0a20 2020 2020 2020 2068 6569 6768  h,.        heigh
-00016000: 742c 0a20 2020 2020 2020 2063 6972 636c  t,.        circl
-00016010: 655f 6b77 6172 6773 2c0a 2020 2020 2020  e_kwargs,.      
-00016020: 2020 7368 6f77 2c0a 2020 2020 2020 2020    show,.        
-00016030: 785f 7261 6e67 652c 0a20 2020 2029 3a0a  x_range,.    ):.
-00016040: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-00016050: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-00016060: 0a20 2020 2020 2020 2072 6567 696f 6e20  .        region 
-00016070: 3d20 7365 6c66 2e72 6573 6f6c 7665 5f72  = self.resolve_r
-00016080: 6567 696f 6e28 7265 6769 6f6e 290a 0a20  egion(region).. 
-00016090: 2020 2020 2020 2023 2070 6f73 2061 7869         # pos axi
-000160a0: 730a 2020 2020 2020 2020 7769 6e64 6f77  s.        window
-000160b0: 5f70 6f73 203d 2077 696e 646f 7773 2e6d  _pos = windows.m
-000160c0: 6561 6e28 6178 6973 3d31 290a 0a20 2020  ean(axis=1)..   
-000160d0: 2020 2020 2023 2068 6574 2061 7869 730a       # het axis.
-000160e0: 2020 2020 2020 2020 7769 6e64 6f77 5f68          window_h
-000160f0: 6574 203d 2063 6f75 6e74 7320 2f20 7769  et = counts / wi
-00016100: 6e64 6f77 5f73 697a 650a 0a20 2020 2020  ndow_size..     
-00016110: 2020 2023 2064 6574 6572 6d69 6e65 2070     # determine p
-00016120: 6c6f 7474 696e 6720 6c69 6d69 7473 0a20  lotting limits. 
-00016130: 2020 2020 2020 2069 6620 785f 7261 6e67         if x_rang
-00016140: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00016150: 2020 2020 2020 2069 6620 7265 6769 6f6e         if region
-00016160: 2e73 7461 7274 2069 7320 6e6f 7420 4e6f  .start is not No
-00016170: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00016180: 2020 2020 785f 6d69 6e20 3d20 7265 6769      x_min = regi
-00016190: 6f6e 2e73 7461 7274 0a20 2020 2020 2020  on.start.       
-000161a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000161b0: 2020 2020 2020 2020 2020 2078 5f6d 696e             x_min
-000161c0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-000161d0: 2069 6620 7265 6769 6f6e 2e65 6e64 2069   if region.end i
-000161e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000161f0: 2020 2020 2020 2020 2020 2020 785f 6d61              x_ma
-00016200: 7820 3d20 7265 6769 6f6e 2e65 6e64 0a20  x = region.end. 
-00016210: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00016220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016230: 2078 5f6d 6178 203d 206c 656e 2873 656c   x_max = len(sel
-00016240: 662e 6765 6e6f 6d65 5f73 6571 7565 6e63  f.genome_sequenc
-00016250: 6528 7265 6769 6f6e 2e63 6f6e 7469 6729  e(region.contig)
-00016260: 290a 2020 2020 2020 2020 2020 2020 785f  ).            x_
-00016270: 7261 6e67 6520 3d20 626f 6b65 682e 6d6f  range = bokeh.mo
-00016280: 6465 6c73 2e52 616e 6765 3164 2878 5f6d  dels.Range1d(x_m
-00016290: 696e 2c20 785f 6d61 782c 2062 6f75 6e64  in, x_max, bound
-000162a0: 733d 2261 7574 6f22 290a 0a20 2020 2020  s="auto")..     
-000162b0: 2020 2064 6562 7567 2822 6372 6561 7465     debug("create
-000162c0: 2061 2066 6967 7572 6520 666f 7220 706c   a figure for pl
-000162d0: 6f74 7469 6e67 2229 0a20 2020 2020 2020  otting").       
-000162e0: 2078 7768 6565 6c5f 7a6f 6f6d 203d 2062   xwheel_zoom = b
-000162f0: 6f6b 6568 2e6d 6f64 656c 732e 5768 6565  okeh.models.Whee
-00016300: 6c5a 6f6f 6d54 6f6f 6c28 0a20 2020 2020  lZoomTool(.     
-00016310: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-00016320: 733d 2277 6964 7468 222c 206d 6169 6e74  s="width", maint
-00016330: 6169 6e5f 666f 6375 733d 4661 6c73 650a  ain_focus=False.
-00016340: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00016350: 2020 6669 6720 3d20 626f 6b65 682e 706c    fig = bokeh.pl
-00016360: 6f74 7469 6e67 2e66 6967 7572 6528 0a20  otting.figure(. 
-00016370: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-00016380: 3d66 227b 7361 6d70 6c65 5f69 647d 2028  =f"{sample_id} (
-00016390: 7b73 616d 706c 655f 7365 747d 2922 2c0a  {sample_set})",.
-000163a0: 2020 2020 2020 2020 2020 2020 746f 6f6c              tool
-000163b0: 733d 5b22 7870 616e 222c 2022 787a 6f6f  s=["xpan", "xzoo
-000163c0: 6d5f 696e 222c 2022 787a 6f6f 6d5f 6f75  m_in", "xzoom_ou
-000163d0: 7422 2c20 7877 6865 656c 5f7a 6f6f 6d2c  t", xwheel_zoom,
-000163e0: 2022 7265 7365 7422 5d2c 0a20 2020 2020   "reset"],.     
-000163f0: 2020 2020 2020 2061 6374 6976 655f 7363         active_sc
-00016400: 726f 6c6c 3d78 7768 6565 6c5f 7a6f 6f6d  roll=xwheel_zoom
-00016410: 2c0a 2020 2020 2020 2020 2020 2020 6163  ,.            ac
-00016420: 7469 7665 5f64 7261 673d 2278 7061 6e22  tive_drag="xpan"
-00016430: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00016440: 7a69 6e67 5f6d 6f64 653d 7369 7a69 6e67  zing_mode=sizing
-00016450: 5f6d 6f64 652c 0a20 2020 2020 2020 2020  _mode,.         
-00016460: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
-00016470: 2020 2020 2020 2020 2020 2020 6865 6967              heig
-00016480: 6874 3d68 6569 6768 742c 0a20 2020 2020  ht=height,.     
-00016490: 2020 2020 2020 2074 6f6f 6c62 6172 5f6c         toolbar_l
-000164a0: 6f63 6174 696f 6e3d 2261 626f 7665 222c  ocation="above",
-000164b0: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
-000164c0: 616e 6765 3d78 5f72 616e 6765 2c0a 2020  ange=x_range,.  
-000164d0: 2020 2020 2020 2020 2020 795f 7261 6e67            y_rang
-000164e0: 653d 2830 2c20 795f 6d61 7829 2c0a 2020  e=(0, y_max),.  
-000164f0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00016500: 2064 6562 7567 2822 706c 6f74 2068 6574   debug("plot het
-00016510: 6572 6f7a 7967 6f73 6974 7922 290a 2020  erozygosity").  
-00016520: 2020 2020 2020 6461 7461 203d 2070 642e        data = pd.
-00016530: 4461 7461 4672 616d 6528 0a20 2020 2020  DataFrame(.     
-00016540: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00016550: 2020 2020 2020 2020 2022 706f 7369 7469           "positi
-00016560: 6f6e 223a 2077 696e 646f 775f 706f 732c  on": window_pos,
-00016570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016580: 2022 6865 7465 726f 7a79 676f 7369 7479   "heterozygosity
-00016590: 223a 2077 696e 646f 775f 6865 742c 0a20  ": window_het,. 
-000165a0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-000165b0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-000165c0: 6620 6369 7263 6c65 5f6b 7761 7267 7320  f circle_kwargs 
-000165d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000165e0: 2020 2020 2063 6972 636c 655f 6b77 6172       circle_kwar
-000165f0: 6773 203d 2064 6963 7428 290a 2020 2020  gs = dict().    
-00016600: 2020 2020 6369 7263 6c65 5f6b 7761 7267      circle_kwarg
-00016610: 732e 7365 7464 6566 6175 6c74 2822 7369  s.setdefault("si
-00016620: 7a65 222c 2033 290a 2020 2020 2020 2020  ze", 3).        
-00016630: 6669 672e 6369 7263 6c65 2878 3d22 706f  fig.circle(x="po
-00016640: 7369 7469 6f6e 222c 2079 3d22 6865 7465  sition", y="hete
-00016650: 726f 7a79 676f 7369 7479 222c 2073 6f75  rozygosity", sou
-00016660: 7263 653d 6461 7461 2c20 2a2a 6369 7263  rce=data, **circ
-00016670: 6c65 5f6b 7761 7267 7329 0a0a 2020 2020  le_kwargs)..    
-00016680: 2020 2020 6465 6275 6728 2274 6964 7920      debug("tidy 
-00016690: 7570 2074 6865 2070 6c6f 7422 290a 2020  up the plot").  
-000166a0: 2020 2020 2020 6669 672e 7961 7869 732e        fig.yaxis.
-000166b0: 6178 6973 5f6c 6162 656c 203d 2022 4865  axis_label = "He
-000166c0: 7465 726f 7a79 676f 7369 7479 2028 6270  terozygosity (bp
-000166d0: e281 bbc2 b929 220a 2020 2020 2020 2020  .....)".        
-000166e0: 7365 6c66 2e5f 626f 6b65 685f 7374 796c  self._bokeh_styl
-000166f0: 655f 6765 6e6f 6d65 5f78 6178 6973 2866  e_genome_xaxis(f
-00016700: 6967 2c20 7265 6769 6f6e 2e63 6f6e 7469  ig, region.conti
-00016710: 6729 0a0a 2020 2020 2020 2020 6966 2073  g)..        if s
-00016720: 686f 773a 0a20 2020 2020 2020 2020 2020  how:.           
-00016730: 2062 6f6b 6568 2e70 6c6f 7474 696e 672e   bokeh.plotting.
-00016740: 7368 6f77 2866 6967 290a 0a20 2020 2020  show(fig)..     
-00016750: 2020 2072 6574 7572 6e20 6669 670a 0a20     return fig.. 
-00016760: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
-00016770: 2073 756d 6d61 7279 3d22 506c 6f74 2077   summary="Plot w
-00016780: 696e 646f 7765 6420 6865 7465 726f 7a79  indowed heterozy
-00016790: 676f 7369 7479 2066 6f72 2061 2073 696e  gosity for a sin
-000167a0: 676c 6520 7361 6d70 6c65 206f 7665 7220  gle sample over 
-000167b0: 6120 6765 6e6f 6d65 2072 6567 696f 6e2e  a genome region.
-000167c0: 222c 0a20 2020 2029 0a20 2020 2064 6566  ",.    ).    def
-000167d0: 2070 6c6f 745f 6865 7465 726f 7a79 676f   plot_heterozygo
-000167e0: 7369 7479 5f74 7261 636b 280a 2020 2020  sity_track(.    
-000167f0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00016800: 2020 7361 6d70 6c65 3a20 6865 745f 7061    sample: het_pa
-00016810: 7261 6d73 2e73 616d 706c 652c 0a20 2020  rams.sample,.   
-00016820: 2020 2020 2072 6567 696f 6e3a 2062 6173       region: bas
-00016830: 655f 7061 7261 6d73 2e72 6567 696f 6e2c  e_params.region,
-00016840: 0a20 2020 2020 2020 2077 696e 646f 775f  .        window_
-00016850: 7369 7a65 3a20 6865 745f 7061 7261 6d73  size: het_params
-00016860: 2e77 696e 646f 775f 7369 7a65 203d 2068  .window_size = h
-00016870: 6574 5f70 6172 616d 732e 7769 6e64 6f77  et_params.window
-00016880: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
-00016890: 2020 2020 2020 2079 5f6d 6178 3a20 6865         y_max: he
-000168a0: 745f 7061 7261 6d73 2e79 5f6d 6178 203d  t_params.y_max =
-000168b0: 2068 6574 5f70 6172 616d 732e 795f 6d61   het_params.y_ma
-000168c0: 785f 6465 6661 756c 742c 0a20 2020 2020  x_default,.     
-000168d0: 2020 2063 6972 636c 655f 6b77 6172 6773     circle_kwargs
-000168e0: 3a20 4f70 7469 6f6e 616c 5b68 6574 5f70  : Optional[het_p
-000168f0: 6172 616d 732e 6369 7263 6c65 5f6b 7761  arams.circle_kwa
-00016900: 7267 735d 203d 204e 6f6e 652c 0a20 2020  rgs] = None,.   
-00016910: 2020 2020 2073 6974 655f 6d61 736b 3a20       site_mask: 
-00016920: 6261 7365 5f70 6172 616d 732e 7369 7465  base_params.site
-00016930: 5f6d 6173 6b20 3d20 4445 4641 554c 542c  _mask = DEFAULT,
-00016940: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00016950: 7365 743a 204f 7074 696f 6e61 6c5b 6261  set: Optional[ba
-00016960: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
-00016970: 5f73 6574 5d20 3d20 4e6f 6e65 2c0a 2020  _set] = None,.  
-00016980: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-00016990: 653a 2067 706c 745f 7061 7261 6d73 2e73  e: gplt_params.s
-000169a0: 697a 696e 675f 6d6f 6465 203d 2067 706c  izing_mode = gpl
-000169b0: 745f 7061 7261 6d73 2e73 697a 696e 675f  t_params.sizing_
-000169c0: 6d6f 6465 5f64 6566 6175 6c74 2c0a 2020  mode_default,.  
-000169d0: 2020 2020 2020 7769 6474 683a 2067 706c        width: gpl
-000169e0: 745f 7061 7261 6d73 2e77 6964 7468 203d  t_params.width =
-000169f0: 2067 706c 745f 7061 7261 6d73 2e77 6964   gplt_params.wid
-00016a00: 7468 5f64 6566 6175 6c74 2c0a 2020 2020  th_default,.    
-00016a10: 2020 2020 6865 6967 6874 3a20 6770 6c74      height: gplt
-00016a20: 5f70 6172 616d 732e 6865 6967 6874 203d  _params.height =
-00016a30: 2032 3030 2c0a 2020 2020 2020 2020 7368   200,.        sh
-00016a40: 6f77 3a20 6770 6c74 5f70 6172 616d 732e  ow: gplt_params.
-00016a50: 7368 6f77 203d 2054 7275 652c 0a20 2020  show = True,.   
-00016a60: 2020 2020 2078 5f72 616e 6765 3a20 4f70       x_range: Op
-00016a70: 7469 6f6e 616c 5b67 706c 745f 7061 7261  tional[gplt_para
-00016a80: 6d73 2e78 5f72 616e 6765 5d20 3d20 4e6f  ms.x_range] = No
-00016a90: 6e65 2c0a 2020 2020 2920 2d3e 2067 706c  ne,.    ) -> gpl
-00016aa0: 745f 7061 7261 6d73 2e66 6967 7572 653a  t_params.figure:
-00016ab0: 0a20 2020 2020 2020 2064 6562 7567 203d  .        debug =
-00016ac0: 2073 656c 662e 5f6c 6f67 2e64 6562 7567   self._log.debug
-00016ad0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00016ae0: 2263 6f6d 7075 7465 2077 696e 646f 7765  "compute windowe
-00016af0: 6420 6865 7465 726f 7a79 676f 7369 7479  d heterozygosity
-00016b00: 2229 0a20 2020 2020 2020 2073 616d 706c  ").        sampl
-00016b10: 655f 6964 2c20 7361 6d70 6c65 5f73 6574  e_id, sample_set
-00016b20: 2c20 7769 6e64 6f77 732c 2063 6f75 6e74  , windows, count
-00016b30: 7320 3d20 7365 6c66 2e5f 7361 6d70 6c65  s = self._sample
-00016b40: 5f63 6f75 6e74 5f68 6574 280a 2020 2020  _count_het(.    
-00016b50: 2020 2020 2020 2020 7361 6d70 6c65 3d73          sample=s
-00016b60: 616d 706c 652c 0a20 2020 2020 2020 2020  ample,.         
-00016b70: 2020 2072 6567 696f 6e3d 7265 6769 6f6e     region=region
-00016b80: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00016b90: 7465 5f6d 6173 6b3d 7369 7465 5f6d 6173  te_mask=site_mas
-00016ba0: 6b2c 0a20 2020 2020 2020 2020 2020 2077  k,.            w
-00016bb0: 696e 646f 775f 7369 7a65 3d77 696e 646f  indow_size=windo
-00016bc0: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
-00016bd0: 2020 2020 7361 6d70 6c65 5f73 6574 3d73      sample_set=s
-00016be0: 616d 706c 655f 7365 742c 0a20 2020 2020  ample_set,.     
-00016bf0: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-00016c00: 6275 6728 2270 6c6f 7420 6865 7465 726f  bug("plot hetero
-00016c10: 7a79 676f 7369 7479 2229 0a20 2020 2020  zygosity").     
-00016c20: 2020 2066 6967 203d 2073 656c 662e 5f70     fig = self._p
-00016c30: 6c6f 745f 6865 7465 726f 7a79 676f 7369  lot_heterozygosi
-00016c40: 7479 5f74 7261 636b 280a 2020 2020 2020  ty_track(.      
-00016c50: 2020 2020 2020 7361 6d70 6c65 5f69 643d        sample_id=
-00016c60: 7361 6d70 6c65 5f69 642c 0a20 2020 2020  sample_id,.     
-00016c70: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-00016c80: 743d 7361 6d70 6c65 5f73 6574 2c0a 2020  t=sample_set,.  
-00016c90: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
-00016ca0: 733d 7769 6e64 6f77 732c 0a20 2020 2020  s=windows,.     
-00016cb0: 2020 2020 2020 2063 6f75 6e74 733d 636f         counts=co
-00016cc0: 756e 7473 2c0a 2020 2020 2020 2020 2020  unts,.          
-00016cd0: 2020 7265 6769 6f6e 3d72 6567 696f 6e2c    region=region,
-00016ce0: 0a20 2020 2020 2020 2020 2020 2077 696e  .            win
-00016cf0: 646f 775f 7369 7a65 3d77 696e 646f 775f  dow_size=window_
-00016d00: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-00016d10: 2020 795f 6d61 783d 795f 6d61 782c 0a20    y_max=y_max,. 
-00016d20: 2020 2020 2020 2020 2020 2073 697a 696e             sizin
-00016d30: 675f 6d6f 6465 3d73 697a 696e 675f 6d6f  g_mode=sizing_mo
-00016d40: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-00016d50: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
-00016d60: 2020 2020 2020 2020 2068 6569 6768 743d           height=
-00016d70: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
-00016d80: 2020 2020 6369 7263 6c65 5f6b 7761 7267      circle_kwarg
-00016d90: 733d 6369 7263 6c65 5f6b 7761 7267 732c  s=circle_kwargs,
-00016da0: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-00016db0: 773d 7368 6f77 2c0a 2020 2020 2020 2020  w=show,.        
-00016dc0: 2020 2020 785f 7261 6e67 653d 785f 7261      x_range=x_ra
-00016dd0: 6e67 652c 0a20 2020 2020 2020 2029 0a0a  nge,.        )..
-00016de0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00016df0: 6967 0a0a 2020 2020 4064 6f63 280a 2020  ig..    @doc(.  
-00016e00: 2020 2020 2020 7375 6d6d 6172 793d 2250        summary="P
-00016e10: 6c6f 7420 7769 6e64 6f77 6564 2068 6574  lot windowed het
-00016e20: 6572 6f7a 7967 6f73 6974 7920 666f 7220  erozygosity for 
-00016e30: 6120 7369 6e67 6c65 2073 616d 706c 6520  a single sample 
-00016e40: 6f76 6572 2061 2067 656e 6f6d 6520 7265  over a genome re
-00016e50: 6769 6f6e 2e22 2c0a 2020 2020 2020 2020  gion.",.        
-00016e60: 7265 7475 726e 733d 2242 6f6b 6568 2066  returns="Bokeh f
-00016e70: 6967 7572 652e 222c 0a20 2020 2029 0a20  igure.",.    ). 
-00016e80: 2020 2064 6566 2070 6c6f 745f 6865 7465     def plot_hete
-00016e90: 726f 7a79 676f 7369 7479 280a 2020 2020  rozygosity(.    
-00016ea0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00016eb0: 2020 7361 6d70 6c65 3a20 6865 745f 7061    sample: het_pa
-00016ec0: 7261 6d73 2e73 616d 706c 652c 0a20 2020  rams.sample,.   
-00016ed0: 2020 2020 2072 6567 696f 6e3a 2062 6173       region: bas
-00016ee0: 655f 7061 7261 6d73 2e72 6567 696f 6e2c  e_params.region,
-00016ef0: 0a20 2020 2020 2020 2077 696e 646f 775f  .        window_
-00016f00: 7369 7a65 3a20 6865 745f 7061 7261 6d73  size: het_params
-00016f10: 2e77 696e 646f 775f 7369 7a65 203d 2068  .window_size = h
-00016f20: 6574 5f70 6172 616d 732e 7769 6e64 6f77  et_params.window
-00016f30: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
-00016f40: 2020 2020 2020 2079 5f6d 6178 3a20 6865         y_max: he
-00016f50: 745f 7061 7261 6d73 2e79 5f6d 6178 203d  t_params.y_max =
-00016f60: 2068 6574 5f70 6172 616d 732e 795f 6d61   het_params.y_ma
-00016f70: 785f 6465 6661 756c 742c 0a20 2020 2020  x_default,.     
-00016f80: 2020 2063 6972 636c 655f 6b77 6172 6773     circle_kwargs
-00016f90: 3a20 4f70 7469 6f6e 616c 5b68 6574 5f70  : Optional[het_p
-00016fa0: 6172 616d 732e 6369 7263 6c65 5f6b 7761  arams.circle_kwa
-00016fb0: 7267 735d 203d 204e 6f6e 652c 0a20 2020  rgs] = None,.   
-00016fc0: 2020 2020 2073 6974 655f 6d61 736b 3a20       site_mask: 
-00016fd0: 6261 7365 5f70 6172 616d 732e 7369 7465  base_params.site
-00016fe0: 5f6d 6173 6b20 3d20 4445 4641 554c 542c  _mask = DEFAULT,
-00016ff0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00017000: 7365 743a 204f 7074 696f 6e61 6c5b 6261  set: Optional[ba
-00017010: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
-00017020: 5f73 6574 5d20 3d20 4e6f 6e65 2c0a 2020  _set] = None,.  
-00017030: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-00017040: 653a 2067 706c 745f 7061 7261 6d73 2e73  e: gplt_params.s
-00017050: 697a 696e 675f 6d6f 6465 203d 2067 706c  izing_mode = gpl
-00017060: 745f 7061 7261 6d73 2e73 697a 696e 675f  t_params.sizing_
-00017070: 6d6f 6465 5f64 6566 6175 6c74 2c0a 2020  mode_default,.  
-00017080: 2020 2020 2020 7769 6474 683a 2067 706c        width: gpl
-00017090: 745f 7061 7261 6d73 2e77 6964 7468 203d  t_params.width =
-000170a0: 2067 706c 745f 7061 7261 6d73 2e77 6964   gplt_params.wid
-000170b0: 7468 5f64 6566 6175 6c74 2c0a 2020 2020  th_default,.    
-000170c0: 2020 2020 7472 6163 6b5f 6865 6967 6874      track_height
-000170d0: 3a20 6770 6c74 5f70 6172 616d 732e 7472  : gplt_params.tr
-000170e0: 6163 6b5f 6865 6967 6874 203d 2031 3730  ack_height = 170
-000170f0: 2c0a 2020 2020 2020 2020 6765 6e65 735f  ,.        genes_
-00017100: 6865 6967 6874 3a20 6770 6c74 5f70 6172  height: gplt_par
-00017110: 616d 732e 6765 6e65 735f 6865 6967 6874  ams.genes_height
-00017120: 203d 2067 706c 745f 7061 7261 6d73 2e67   = gplt_params.g
-00017130: 656e 6573 5f68 6569 6768 745f 6465 6661  enes_height_defa
-00017140: 756c 742c 0a20 2020 2020 2020 2073 686f  ult,.        sho
-00017150: 773a 2067 706c 745f 7061 7261 6d73 2e73  w: gplt_params.s
-00017160: 686f 7720 3d20 5472 7565 2c0a 2020 2020  how = True,.    
-00017170: 293a 0a20 2020 2020 2020 2064 6562 7567  ):.        debug
-00017180: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
-00017190: 7567 0a0a 2020 2020 2020 2020 2320 6e6f  ug..        # no
-000171a0: 726d 616c 6973 6520 746f 2073 7570 706f  rmalise to suppo
-000171b0: 7274 206d 756c 7469 706c 6520 7361 6d70  rt multiple samp
-000171c0: 6c65 730a 2020 2020 2020 2020 6966 2069  les.        if i
-000171d0: 7369 6e73 7461 6e63 6528 7361 6d70 6c65  sinstance(sample
-000171e0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-000171f0: 3a0a 2020 2020 2020 2020 2020 2020 7361  :.            sa
-00017200: 6d70 6c65 7320 3d20 7361 6d70 6c65 0a20  mples = sample. 
-00017210: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00017220: 2020 2020 2020 2020 2073 616d 706c 6573           samples
-00017230: 203d 205b 7361 6d70 6c65 5d0a 0a20 2020   = [sample]..   
-00017240: 2020 2020 2064 6562 7567 2822 706c 6f74       debug("plot
-00017250: 2066 6972 7374 2073 616d 706c 6520 7472   first sample tr
-00017260: 6163 6b22 290a 2020 2020 2020 2020 6669  ack").        fi
-00017270: 6731 203d 2073 656c 662e 706c 6f74 5f68  g1 = self.plot_h
-00017280: 6574 6572 6f7a 7967 6f73 6974 795f 7472  eterozygosity_tr
-00017290: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
-000172a0: 2073 616d 706c 653d 7361 6d70 6c65 735b   sample=samples[
-000172b0: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
-000172c0: 7361 6d70 6c65 5f73 6574 3d73 616d 706c  sample_set=sampl
-000172d0: 655f 7365 742c 0a20 2020 2020 2020 2020  e_set,.         
-000172e0: 2020 2072 6567 696f 6e3d 7265 6769 6f6e     region=region
-000172f0: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00017300: 7465 5f6d 6173 6b3d 7369 7465 5f6d 6173  te_mask=site_mas
-00017310: 6b2c 0a20 2020 2020 2020 2020 2020 2077  k,.            w
-00017320: 696e 646f 775f 7369 7a65 3d77 696e 646f  indow_size=windo
-00017330: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
-00017340: 2020 2020 795f 6d61 783d 795f 6d61 782c      y_max=y_max,
-00017350: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
-00017360: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
-00017370: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
-00017380: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
-00017390: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-000173a0: 743d 7472 6163 6b5f 6865 6967 6874 2c0a  t=track_height,.
-000173b0: 2020 2020 2020 2020 2020 2020 6369 7263              circ
-000173c0: 6c65 5f6b 7761 7267 733d 6369 7263 6c65  le_kwargs=circle
-000173d0: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
-000173e0: 2020 2020 2073 686f 773d 4661 6c73 652c       show=False,
-000173f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00017400: 2020 2066 6967 312e 7861 7869 732e 7669     fig1.xaxis.vi
-00017410: 7369 626c 6520 3d20 4661 6c73 650a 2020  sible = False.  
-00017420: 2020 2020 2020 6669 6773 203d 205b 6669        figs = [fi
-00017430: 6731 5d0a 0a20 2020 2020 2020 2064 6562  g1]..        deb
-00017440: 7567 2822 706c 6f74 2072 656d 6169 6e69  ug("plot remaini
-00017450: 6e67 2073 616d 706c 6520 7472 6163 6b73  ng sample tracks
-00017460: 2229 0a20 2020 2020 2020 2066 6f72 2073  ").        for s
-00017470: 616d 706c 6520 696e 2073 616d 706c 6573  ample in samples
-00017480: 5b31 3a5d 3a0a 2020 2020 2020 2020 2020  [1:]:.          
-00017490: 2020 6669 675f 6865 7420 3d20 7365 6c66    fig_het = self
-000174a0: 2e70 6c6f 745f 6865 7465 726f 7a79 676f  .plot_heterozygo
-000174b0: 7369 7479 5f74 7261 636b 280a 2020 2020  sity_track(.    
-000174c0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-000174d0: 6c65 3d73 616d 706c 652c 0a20 2020 2020  le=sample,.     
-000174e0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-000174f0: 655f 7365 743d 7361 6d70 6c65 5f73 6574  e_set=sample_set
-00017500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017510: 2020 7265 6769 6f6e 3d72 6567 696f 6e2c    region=region,
-00017520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017530: 2073 6974 655f 6d61 736b 3d73 6974 655f   site_mask=site_
-00017540: 6d61 736b 2c0a 2020 2020 2020 2020 2020  mask,.          
-00017550: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
-00017560: 653d 7769 6e64 6f77 5f73 697a 652c 0a20  e=window_size,. 
-00017570: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00017580: 5f6d 6178 3d79 5f6d 6178 2c0a 2020 2020  _max=y_max,.    
-00017590: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
-000175a0: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
-000175b0: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
-000175c0: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-000175d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000175e0: 2020 6865 6967 6874 3d74 7261 636b 5f68    height=track_h
-000175f0: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
-00017600: 2020 2020 2020 2063 6972 636c 655f 6b77         circle_kw
-00017610: 6172 6773 3d63 6972 636c 655f 6b77 6172  args=circle_kwar
-00017620: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
-00017630: 2020 2020 7368 6f77 3d46 616c 7365 2c0a      show=False,.
-00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017650: 785f 7261 6e67 653d 6669 6731 2e78 5f72  x_range=fig1.x_r
-00017660: 616e 6765 2c0a 2020 2020 2020 2020 2020  ange,.          
-00017670: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00017680: 6669 675f 6865 742e 7861 7869 732e 7669  fig_het.xaxis.vi
-00017690: 7369 626c 6520 3d20 4661 6c73 650a 2020  sible = False.  
-000176a0: 2020 2020 2020 2020 2020 6669 6773 2e61            figs.a
-000176b0: 7070 656e 6428 6669 675f 6865 7429 0a0a  ppend(fig_het)..
-000176c0: 2020 2020 2020 2020 6465 6275 6728 2270          debug("p
-000176d0: 6c6f 7420 6765 6e65 7320 7472 6163 6b22  lot genes track"
-000176e0: 290a 2020 2020 2020 2020 6669 675f 6765  ).        fig_ge
-000176f0: 6e65 7320 3d20 7365 6c66 2e70 6c6f 745f  nes = self.plot_
-00017700: 6765 6e65 7328 0a20 2020 2020 2020 2020  genes(.         
-00017710: 2020 2072 6567 696f 6e3d 7265 6769 6f6e     region=region
-00017720: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00017730: 7a69 6e67 5f6d 6f64 653d 7369 7a69 6e67  zing_mode=sizing
-00017740: 5f6d 6f64 652c 0a20 2020 2020 2020 2020  _mode,.         
-00017750: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
-00017760: 2020 2020 2020 2020 2020 2020 6865 6967              heig
-00017770: 6874 3d67 656e 6573 5f68 6569 6768 742c  ht=genes_height,
-00017780: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
-00017790: 616e 6765 3d66 6967 312e 785f 7261 6e67  ange=fig1.x_rang
-000177a0: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-000177b0: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
-000177c0: 2020 2029 0a20 2020 2020 2020 2066 6967     ).        fig
-000177d0: 732e 6170 7065 6e64 2866 6967 5f67 656e  s.append(fig_gen
-000177e0: 6573 290a 0a20 2020 2020 2020 2064 6562  es)..        deb
-000177f0: 7567 2822 636f 6d62 696e 6520 706c 6f74  ug("combine plot
-00017800: 7320 696e 746f 2061 2073 696e 676c 6520  s into a single 
-00017810: 6669 6775 7265 2229 0a20 2020 2020 2020  figure").       
-00017820: 2066 6967 5f61 6c6c 203d 2062 6f6b 6568   fig_all = bokeh
-00017830: 2e6c 6179 6f75 7473 2e67 7269 6470 6c6f  .layouts.gridplo
-00017840: 7428 0a20 2020 2020 2020 2020 2020 2066  t(.            f
-00017850: 6967 732c 0a20 2020 2020 2020 2020 2020  igs,.           
-00017860: 206e 636f 6c73 3d31 2c0a 2020 2020 2020   ncols=1,.      
-00017870: 2020 2020 2020 746f 6f6c 6261 725f 6c6f        toolbar_lo
-00017880: 6361 7469 6f6e 3d22 6162 6f76 6522 2c0a  cation="above",.
-00017890: 2020 2020 2020 2020 2020 2020 6d65 7267              merg
-000178a0: 655f 746f 6f6c 733d 5472 7565 2c0a 2020  e_tools=True,.  
-000178b0: 2020 2020 2020 2020 2020 7369 7a69 6e67            sizing
-000178c0: 5f6d 6f64 653d 7369 7a69 6e67 5f6d 6f64  _mode=sizing_mod
-000178d0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-000178e0: 2020 2020 2020 6966 2073 686f 773a 0a20        if show:. 
-000178f0: 2020 2020 2020 2020 2020 2062 6f6b 6568             bokeh
-00017900: 2e70 6c6f 7474 696e 672e 7368 6f77 2866  .plotting.show(f
-00017910: 6967 5f61 6c6c 290a 0a20 2020 2020 2020  ig_all)..       
-00017920: 2072 6574 7572 6e20 6669 675f 616c 6c0a   return fig_all.
-00017930: 0a20 2020 2064 6566 205f 7361 6d70 6c65  .    def _sample
-00017940: 5f63 6f75 6e74 5f68 6574 280a 2020 2020  _count_het(.    
-00017950: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00017960: 2020 7361 6d70 6c65 2c0a 2020 2020 2020    sample,.      
-00017970: 2020 7265 6769 6f6e 2c0a 2020 2020 2020    region,.      
-00017980: 2020 7369 7465 5f6d 6173 6b2c 0a20 2020    site_mask,.   
-00017990: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
-000179a0: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
-000179b0: 5f73 6574 3d4e 6f6e 652c 0a20 2020 2029  _set=None,.    )
-000179c0: 3a0a 2020 2020 2020 2020 6465 6275 6720  :.        debug 
-000179d0: 3d20 7365 6c66 2e5f 6c6f 672e 6465 6275  = self._log.debu
-000179e0: 670a 0a20 2020 2020 2020 2072 6567 696f  g..        regio
-000179f0: 6e20 3d20 7365 6c66 2e72 6573 6f6c 7665  n = self.resolve
-00017a00: 5f72 6567 696f 6e28 7265 6769 6f6e 290a  _region(region).
-00017a10: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-00017a20: 6b20 3d20 7365 6c66 2e5f 7072 6570 5f73  k = self._prep_s
-00017a30: 6974 655f 6d61 736b 5f70 6172 616d 2873  ite_mask_param(s
-00017a40: 6974 655f 6d61 736b 3d73 6974 655f 6d61  ite_mask=site_ma
-00017a50: 736b 290a 0a20 2020 2020 2020 2064 6562  sk)..        deb
-00017a60: 7567 2822 6163 6365 7373 2073 616d 706c  ug("access sampl
-00017a70: 6520 6d65 7461 6461 7461 2c20 6c6f 6f6b  e metadata, look
-00017a80: 2075 7020 7361 6d70 6c65 2229 0a20 2020   up sample").   
-00017a90: 2020 2020 2073 616d 706c 655f 7265 6320       sample_rec 
-00017aa0: 3d20 7365 6c66 2e5f 6c6f 6f6b 7570 5f73  = self._lookup_s
-00017ab0: 616d 706c 6528 7361 6d70 6c65 3d73 616d  ample(sample=sam
-00017ac0: 706c 652c 2073 616d 706c 655f 7365 743d  ple, sample_set=
-00017ad0: 7361 6d70 6c65 5f73 6574 290a 2020 2020  sample_set).    
-00017ae0: 2020 2020 7361 6d70 6c65 5f69 6420 3d20      sample_id = 
-00017af0: 7361 6d70 6c65 5f72 6563 2e6e 616d 6520  sample_rec.name 
-00017b00: 2023 2073 616d 706c 655f 6964 0a20 2020   # sample_id.   
-00017b10: 2020 2020 2073 616d 706c 655f 7365 7420       sample_set 
-00017b20: 3d20 7361 6d70 6c65 5f72 6563 5b22 7361  = sample_rec["sa
-00017b30: 6d70 6c65 5f73 6574 225d 0a0a 2020 2020  mple_set"]..    
-00017b40: 2020 2020 6465 6275 6728 2261 6363 6573      debug("acces
-00017b50: 7320 534e 5073 2c20 7365 6c65 6374 2064  s SNPs, select d
-00017b60: 6174 6120 666f 7220 7361 6d70 6c65 2229  ata for sample")
-00017b70: 0a20 2020 2020 2020 2064 735f 736e 7073  .        ds_snps
-00017b80: 203d 2073 656c 662e 736e 705f 6361 6c6c   = self.snp_call
-00017b90: 7328 0a20 2020 2020 2020 2020 2020 2072  s(.            r
-00017ba0: 6567 696f 6e3d 7265 6769 6f6e 2c20 7361  egion=region, sa
-00017bb0: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
-00017bc0: 5f73 6574 2c20 7369 7465 5f6d 6173 6b3d  _set, site_mask=
-00017bd0: 7369 7465 5f6d 6173 6b0a 2020 2020 2020  site_mask.      
-00017be0: 2020 290a 2020 2020 2020 2020 6473 5f73    ).        ds_s
-00017bf0: 6e70 735f 7361 6d70 6c65 203d 2064 735f  nps_sample = ds_
-00017c00: 736e 7073 2e73 6574 5f69 6e64 6578 2873  snps.set_index(s
-00017c10: 616d 706c 6573 3d22 7361 6d70 6c65 5f69  amples="sample_i
-00017c20: 6422 292e 7365 6c28 7361 6d70 6c65 733d  d").sel(samples=
-00017c30: 7361 6d70 6c65 5f69 6429 0a0a 2020 2020  sample_id)..    
-00017c40: 2020 2020 2320 736e 7020 706f 7369 7469      # snp positi
-00017c50: 6f6e 730a 2020 2020 2020 2020 706f 7320  ons.        pos 
-00017c60: 3d20 6473 5f73 6e70 735f 7361 6d70 6c65  = ds_snps_sample
-00017c70: 5b22 7661 7269 616e 745f 706f 7369 7469  ["variant_positi
-00017c80: 6f6e 225d 2e76 616c 7565 730a 0a20 2020  on"].values..   
-00017c90: 2020 2020 2023 2061 6363 6573 7320 6765       # access ge
-00017ca0: 6e6f 7479 7065 730a 2020 2020 2020 2020  notypes.        
-00017cb0: 6774 203d 2061 6c6c 656c 2e47 656e 6f74  gt = allel.Genot
-00017cc0: 7970 6544 6173 6b56 6563 746f 7228 6473  ypeDaskVector(ds
-00017cd0: 5f73 6e70 735f 7361 6d70 6c65 5b22 6361  _snps_sample["ca
-00017ce0: 6c6c 5f67 656e 6f74 7970 6522 5d2e 6461  ll_genotype"].da
-00017cf0: 7461 290a 0a20 2020 2020 2020 2023 2063  ta)..        # c
-00017d00: 6f6d 7075 7465 2068 6574 0a20 2020 2020  ompute het.     
-00017d10: 2020 2077 6974 6820 7365 6c66 2e5f 6461     with self._da
-00017d20: 736b 5f70 726f 6772 6573 7328 6465 7363  sk_progress(desc
-00017d30: 3d22 436f 6d70 7574 6520 6865 7465 726f  ="Compute hetero
-00017d40: 7a79 676f 7573 2067 656e 6f74 7970 6573  zygous genotypes
-00017d50: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00017d60: 6973 5f68 6574 203d 2067 742e 6973 5f68  is_het = gt.is_h
-00017d70: 6574 2829 2e63 6f6d 7075 7465 2829 0a0a  et().compute()..
-00017d80: 2020 2020 2020 2020 2320 636f 6d70 7574          # comput
-00017d90: 6520 7769 6e64 6f77 2063 6f6f 7264 696e  e window coordin
-00017da0: 6174 6573 0a20 2020 2020 2020 2077 696e  ates.        win
-00017db0: 646f 7773 203d 2061 6c6c 656c 2e6d 6f76  dows = allel.mov
-00017dc0: 696e 675f 7374 6174 6973 7469 6328 0a20  ing_statistic(. 
-00017dd0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00017de0: 733d 706f 732c 0a20 2020 2020 2020 2020  s=pos,.         
-00017df0: 2020 2073 7461 7469 7374 6963 3d6c 616d     statistic=lam
-00017e00: 6264 6120 783a 205b 785b 305d 2c20 785b  bda x: [x[0], x[
-00017e10: 2d31 5d5d 2c0a 2020 2020 2020 2020 2020  -1]],.          
-00017e20: 2020 7369 7a65 3d77 696e 646f 775f 7369    size=window_si
-00017e30: 7a65 2c0a 2020 2020 2020 2020 290a 0a20  ze,.        ).. 
-00017e40: 2020 2020 2020 2023 2063 6f6d 7075 7465         # compute
-00017e50: 2077 696e 646f 7765 6420 6865 7465 726f   windowed hetero
-00017e60: 7a79 676f 7369 7479 0a20 2020 2020 2020  zygosity.       
-00017e70: 2063 6f75 6e74 7320 3d20 616c 6c65 6c2e   counts = allel.
-00017e80: 6d6f 7669 6e67 5f73 7461 7469 7374 6963  moving_statistic
-00017e90: 280a 2020 2020 2020 2020 2020 2020 7661  (.            va
-00017ea0: 6c75 6573 3d69 735f 6865 742c 0a20 2020  lues=is_het,.   
-00017eb0: 2020 2020 2020 2020 2073 7461 7469 7374           statist
-00017ec0: 6963 3d6e 702e 7375 6d2c 0a20 2020 2020  ic=np.sum,.     
-00017ed0: 2020 2020 2020 2073 697a 653d 7769 6e64         size=wind
-00017ee0: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
-00017ef0: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-00017f00: 726e 2073 616d 706c 655f 6964 2c20 7361  rn sample_id, sa
-00017f10: 6d70 6c65 5f73 6574 2c20 7769 6e64 6f77  mple_set, window
-00017f20: 732c 2063 6f75 6e74 730a 0a20 2020 2040  s, counts..    @
-00017f30: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-00017f40: 6d61 7279 3d22 496e 6665 7220 7275 6e73  mary="Infer runs
-00017f50: 206f 6620 686f 6d6f 7a79 676f 7369 7479   of homozygosity
-00017f60: 2066 6f72 2061 2073 696e 676c 6520 7361   for a single sa
-00017f70: 6d70 6c65 206f 7665 7220 6120 6765 6e6f  mple over a geno
-00017f80: 6d65 2072 6567 696f 6e2e 222c 0a20 2020  me region.",.   
-00017f90: 2029 0a20 2020 2064 6566 2072 6f68 5f68   ).    def roh_h
-00017fa0: 6d6d 280a 2020 2020 2020 2020 7365 6c66  mm(.        self
-00017fb0: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
-00017fc0: 3a20 6865 745f 7061 7261 6d73 2e73 616d  : het_params.sam
-00017fd0: 706c 652c 0a20 2020 2020 2020 2072 6567  ple,.        reg
-00017fe0: 696f 6e3a 2062 6173 655f 7061 7261 6d73  ion: base_params
-00017ff0: 2e72 6567 696f 6e2c 0a20 2020 2020 2020  .region,.       
-00018000: 2077 696e 646f 775f 7369 7a65 3a20 6865   window_size: he
-00018010: 745f 7061 7261 6d73 2e77 696e 646f 775f  t_params.window_
-00018020: 7369 7a65 203d 2068 6574 5f70 6172 616d  size = het_param
-00018030: 732e 7769 6e64 6f77 5f73 697a 655f 6465  s.window_size_de
-00018040: 6661 756c 742c 0a20 2020 2020 2020 2073  fault,.        s
-00018050: 6974 655f 6d61 736b 3a20 6261 7365 5f70  ite_mask: base_p
-00018060: 6172 616d 732e 7369 7465 5f6d 6173 6b20  arams.site_mask 
-00018070: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
-00018080: 2020 2073 616d 706c 655f 7365 743a 204f     sample_set: O
-00018090: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-000180a0: 616d 732e 7361 6d70 6c65 5f73 6574 5d20  ams.sample_set] 
-000180b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000180c0: 7068 6574 5f72 6f68 3a20 6865 745f 7061  phet_roh: het_pa
-000180d0: 7261 6d73 2e70 6865 745f 726f 6820 3d20  rams.phet_roh = 
-000180e0: 6865 745f 7061 7261 6d73 2e70 6865 745f  het_params.phet_
-000180f0: 726f 685f 6465 6661 756c 742c 0a20 2020  roh_default,.   
-00018100: 2020 2020 2070 6865 745f 6e6f 6e72 6f68       phet_nonroh
-00018110: 3a20 6865 745f 7061 7261 6d73 2e70 6865  : het_params.phe
-00018120: 745f 6e6f 6e72 6f68 203d 2068 6574 5f70  t_nonroh = het_p
-00018130: 6172 616d 732e 7068 6574 5f6e 6f6e 726f  arams.phet_nonro
-00018140: 685f 6465 6661 756c 742c 0a20 2020 2020  h_default,.     
-00018150: 2020 2074 7261 6e73 6974 696f 6e3a 2068     transition: h
-00018160: 6574 5f70 6172 616d 732e 7472 616e 7369  et_params.transi
-00018170: 7469 6f6e 203d 2068 6574 5f70 6172 616d  tion = het_param
-00018180: 732e 7472 616e 7369 7469 6f6e 5f64 6566  s.transition_def
-00018190: 6175 6c74 2c0a 2020 2020 2920 2d3e 2068  ault,.    ) -> h
-000181a0: 6574 5f70 6172 616d 732e 6466 5f72 6f68  et_params.df_roh
-000181b0: 3a0a 2020 2020 2020 2020 6465 6275 6720  :.        debug 
-000181c0: 3d20 7365 6c66 2e5f 6c6f 672e 6465 6275  = self._log.debu
-000181d0: 670a 0a20 2020 2020 2020 2072 6573 6f6c  g..        resol
-000181e0: 7665 645f 7265 6769 6f6e 203d 2073 656c  ved_region = sel
-000181f0: 662e 7265 736f 6c76 655f 7265 6769 6f6e  f.resolve_region
-00018200: 2872 6567 696f 6e29 0a20 2020 2020 2020  (region).       
-00018210: 2064 656c 2072 6567 696f 6e0a 0a20 2020   del region..   
-00018220: 2020 2020 2064 6562 7567 2822 636f 6d70       debug("comp
-00018230: 7574 6520 7769 6e64 6f77 6564 2068 6574  ute windowed het
-00018240: 6572 6f7a 7967 6f73 6974 7922 290a 2020  erozygosity").  
-00018250: 2020 2020 2020 7361 6d70 6c65 5f69 642c        sample_id,
-00018260: 2073 616d 706c 655f 7365 742c 2077 696e   sample_set, win
-00018270: 646f 7773 2c20 636f 756e 7473 203d 2073  dows, counts = s
-00018280: 656c 662e 5f73 616d 706c 655f 636f 756e  elf._sample_coun
-00018290: 745f 6865 7428 0a20 2020 2020 2020 2020  t_het(.         
-000182a0: 2020 2073 616d 706c 653d 7361 6d70 6c65     sample=sample
-000182b0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-000182c0: 6769 6f6e 3d72 6573 6f6c 7665 645f 7265  gion=resolved_re
-000182d0: 6769 6f6e 2c0a 2020 2020 2020 2020 2020  gion,.          
-000182e0: 2020 7369 7465 5f6d 6173 6b3d 7369 7465    site_mask=site
-000182f0: 5f6d 6173 6b2c 0a20 2020 2020 2020 2020  _mask,.         
-00018300: 2020 2077 696e 646f 775f 7369 7a65 3d77     window_size=w
-00018310: 696e 646f 775f 7369 7a65 2c0a 2020 2020  indow_size,.    
-00018320: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-00018330: 6574 3d73 616d 706c 655f 7365 742c 0a20  et=sample_set,. 
-00018340: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00018350: 2020 6465 6275 6728 2263 6f6d 7075 7465    debug("compute
-00018360: 2072 756e 7320 6f66 2068 6f6d 6f7a 7967   runs of homozyg
-00018370: 6f73 6974 7922 290a 2020 2020 2020 2020  osity").        
-00018380: 6466 5f72 6f68 203d 2073 656c 662e 5f72  df_roh = self._r
-00018390: 6f68 5f68 6d6d 5f70 7265 6469 6374 280a  oh_hmm_predict(.
-000183a0: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-000183b0: 6f77 733d 7769 6e64 6f77 732c 0a20 2020  ows=windows,.   
-000183c0: 2020 2020 2020 2020 2063 6f75 6e74 733d           counts=
-000183d0: 636f 756e 7473 2c0a 2020 2020 2020 2020  counts,.        
-000183e0: 2020 2020 7068 6574 5f72 6f68 3d70 6865      phet_roh=phe
-000183f0: 745f 726f 682c 0a20 2020 2020 2020 2020  t_roh,.         
-00018400: 2020 2070 6865 745f 6e6f 6e72 6f68 3d70     phet_nonroh=p
-00018410: 6865 745f 6e6f 6e72 6f68 2c0a 2020 2020  het_nonroh,.    
-00018420: 2020 2020 2020 2020 7472 616e 7369 7469          transiti
-00018430: 6f6e 3d74 7261 6e73 6974 696f 6e2c 0a20  on=transition,. 
-00018440: 2020 2020 2020 2020 2020 2077 696e 646f             windo
-00018450: 775f 7369 7a65 3d77 696e 646f 775f 7369  w_size=window_si
-00018460: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-00018470: 7361 6d70 6c65 5f69 643d 7361 6d70 6c65  sample_id=sample
-00018480: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-00018490: 2063 6f6e 7469 673d 7265 736f 6c76 6564   contig=resolved
-000184a0: 5f72 6567 696f 6e2e 636f 6e74 6967 2c0a  _region.contig,.
-000184b0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000184c0: 2020 2072 6574 7572 6e20 6466 5f72 6f68     return df_roh
-000184d0: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
-000184e0: 2020 2020 7375 6d6d 6172 793d 2250 6c6f      summary="Plo
-000184f0: 7420 6120 7275 6e73 206f 6620 686f 6d6f  t a runs of homo
-00018500: 7a79 676f 7369 7479 2074 7261 636b 2e22  zygosity track."
-00018510: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
-00018520: 706c 6f74 5f72 6f68 5f74 7261 636b 280a  plot_roh_track(.
-00018530: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00018540: 2020 2020 2020 6466 5f72 6f68 3a20 6865        df_roh: he
-00018550: 745f 7061 7261 6d73 2e64 665f 726f 682c  t_params.df_roh,
-00018560: 0a20 2020 2020 2020 2072 6567 696f 6e3a  .        region:
-00018570: 2062 6173 655f 7061 7261 6d73 2e72 6567   base_params.reg
-00018580: 696f 6e2c 0a20 2020 2020 2020 2073 697a  ion,.        siz
-00018590: 696e 675f 6d6f 6465 3a20 6770 6c74 5f70  ing_mode: gplt_p
-000185a0: 6172 616d 732e 7369 7a69 6e67 5f6d 6f64  arams.sizing_mod
-000185b0: 6520 3d20 6770 6c74 5f70 6172 616d 732e  e = gplt_params.
-000185c0: 7369 7a69 6e67 5f6d 6f64 655f 6465 6661  sizing_mode_defa
-000185d0: 756c 742c 0a20 2020 2020 2020 2077 6964  ult,.        wid
-000185e0: 7468 3a20 6770 6c74 5f70 6172 616d 732e  th: gplt_params.
-000185f0: 7769 6474 6820 3d20 6770 6c74 5f70 6172  width = gplt_par
-00018600: 616d 732e 7769 6474 685f 6465 6661 756c  ams.width_defaul
-00018610: 742c 0a20 2020 2020 2020 2068 6569 6768  t,.        heigh
-00018620: 743a 2067 706c 745f 7061 7261 6d73 2e68  t: gplt_params.h
-00018630: 6569 6768 7420 3d20 3130 302c 0a20 2020  eight = 100,.   
-00018640: 2020 2020 2073 686f 773a 2067 706c 745f       show: gplt_
-00018650: 7061 7261 6d73 2e73 686f 7720 3d20 5472  params.show = Tr
-00018660: 7565 2c0a 2020 2020 2020 2020 785f 7261  ue,.        x_ra
-00018670: 6e67 653a 204f 7074 696f 6e61 6c5b 6770  nge: Optional[gp
-00018680: 6c74 5f70 6172 616d 732e 785f 7261 6e67  lt_params.x_rang
-00018690: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
-000186a0: 2020 2074 6974 6c65 3a20 6770 6c74 5f70     title: gplt_p
-000186b0: 6172 616d 732e 7469 746c 6520 3d20 2252  arams.title = "R
-000186c0: 756e 7320 6f66 2068 6f6d 6f7a 7967 6f73  uns of homozygos
-000186d0: 6974 7922 2c0a 2020 2020 2920 2d3e 2067  ity",.    ) -> g
-000186e0: 706c 745f 7061 7261 6d73 2e66 6967 7572  plt_params.figur
-000186f0: 653a 0a20 2020 2020 2020 2064 6562 7567  e:.        debug
-00018700: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
-00018710: 7567 0a0a 2020 2020 2020 2020 6465 6275  ug..        debu
-00018720: 6728 2268 616e 646c 6520 7265 6769 6f6e  g("handle region
-00018730: 2070 6172 616d 6574 6572 202d 2074 6869   parameter - thi
-00018740: 7320 6465 7465 726d 696e 6573 2074 6865  s determines the
-00018750: 2067 656e 6f6d 6520 7265 6769 6f6e 2074   genome region t
-00018760: 6f20 706c 6f74 2229 0a20 2020 2020 2020  o plot").       
-00018770: 2072 6573 6f6c 7665 645f 7265 6769 6f6e   resolved_region
-00018780: 203d 2073 656c 662e 7265 736f 6c76 655f   = self.resolve_
-00018790: 7265 6769 6f6e 2872 6567 696f 6e29 0a20  region(region). 
-000187a0: 2020 2020 2020 2064 656c 2072 6567 696f         del regio
-000187b0: 6e0a 2020 2020 2020 2020 636f 6e74 6967  n.        contig
-000187c0: 203d 2072 6573 6f6c 7665 645f 7265 6769   = resolved_regi
-000187d0: 6f6e 2e63 6f6e 7469 670a 2020 2020 2020  on.contig.      
-000187e0: 2020 7374 6172 7420 3d20 7265 736f 6c76    start = resolv
-000187f0: 6564 5f72 6567 696f 6e2e 7374 6172 740a  ed_region.start.
-00018800: 2020 2020 2020 2020 656e 6420 3d20 7265          end = re
-00018810: 736f 6c76 6564 5f72 6567 696f 6e2e 656e  solved_region.en
-00018820: 640a 2020 2020 2020 2020 6966 2073 7461  d.        if sta
-00018830: 7274 2069 7320 4e6f 6e65 3a0a 2020 2020  rt is None:.    
-00018840: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-00018850: 300a 2020 2020 2020 2020 6966 2065 6e64  0.        if end
-00018860: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00018870: 2020 2020 2020 656e 6420 3d20 6c65 6e28        end = len(
-00018880: 7365 6c66 2e67 656e 6f6d 655f 7365 7175  self.genome_sequ
-00018890: 656e 6365 2863 6f6e 7469 6729 290a 0a20  ence(contig)).. 
-000188a0: 2020 2020 2020 2064 6562 7567 2822 6465         debug("de
-000188b0: 6669 6e65 2078 2061 7869 7320 7261 6e67  fine x axis rang
-000188c0: 6522 290a 2020 2020 2020 2020 6966 2078  e").        if x
-000188d0: 5f72 616e 6765 2069 7320 4e6f 6e65 3a0a  _range is None:.
-000188e0: 2020 2020 2020 2020 2020 2020 785f 7261              x_ra
-000188f0: 6e67 6520 3d20 626f 6b65 682e 6d6f 6465  nge = bokeh.mode
-00018900: 6c73 2e52 616e 6765 3164 2873 7461 7274  ls.Range1d(start
-00018910: 2c20 656e 642c 2062 6f75 6e64 733d 2261  , end, bounds="a
-00018920: 7574 6f22 290a 0a20 2020 2020 2020 2064  uto")..        d
-00018930: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
-00018940: 2020 2277 6527 7265 2067 6f69 6e67 2074    "we're going t
-00018950: 6f20 706c 6f74 2065 6163 6820 6765 6e65  o plot each gene
-00018960: 2061 7320 6120 7265 6374 616e 676c 652c   as a rectangle,
-00018970: 2073 6f20 6164 6420 736f 6d65 2061 6464   so add some add
-00018980: 6974 696f 6e61 6c20 636f 6c75 6d6e 7322  itional columns"
-00018990: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000189a0: 2020 2064 6174 6120 3d20 6466 5f72 6f68     data = df_roh
-000189b0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-000189c0: 6461 7461 5b22 626f 7474 6f6d 225d 203d  data["bottom"] =
-000189d0: 2030 2e32 0a20 2020 2020 2020 2064 6174   0.2.        dat
-000189e0: 615b 2274 6f70 225d 203d 2030 2e38 0a0a  a["top"] = 0.8..
-000189f0: 2020 2020 2020 2020 6465 6275 6728 226d          debug("m
-00018a00: 616b 6520 6120 6669 6775 7265 2229 0a20  ake a figure"). 
-00018a10: 2020 2020 2020 2078 7768 6565 6c5f 7a6f         xwheel_zo
-00018a20: 6f6d 203d 2062 6f6b 6568 2e6d 6f64 656c  om = bokeh.model
-00018a30: 732e 5768 6565 6c5a 6f6f 6d54 6f6f 6c28  s.WheelZoomTool(
-00018a40: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00018a50: 656e 7369 6f6e 733d 2277 6964 7468 222c  ensions="width",
-00018a60: 206d 6169 6e74 6169 6e5f 666f 6375 733d   maintain_focus=
-00018a70: 4661 6c73 650a 2020 2020 2020 2020 290a  False.        ).
-00018a80: 2020 2020 2020 2020 6669 6720 3d20 626f          fig = bo
-00018a90: 6b65 682e 706c 6f74 7469 6e67 2e66 6967  keh.plotting.fig
-00018aa0: 7572 6528 0a20 2020 2020 2020 2020 2020  ure(.           
-00018ab0: 2074 6974 6c65 3d74 6974 6c65 2c0a 2020   title=title,.  
-00018ac0: 2020 2020 2020 2020 2020 7369 7a69 6e67            sizing
-00018ad0: 5f6d 6f64 653d 7369 7a69 6e67 5f6d 6f64  _mode=sizing_mod
-00018ae0: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
-00018af0: 6964 7468 3d77 6964 7468 2c0a 2020 2020  idth=width,.    
-00018b00: 2020 2020 2020 2020 6865 6967 6874 3d68          height=h
-00018b10: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
-00018b20: 2020 2074 6f6f 6c73 3d5b 0a20 2020 2020     tools=[.     
-00018b30: 2020 2020 2020 2020 2020 2022 7870 616e             "xpan
-00018b40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00018b50: 2020 2022 787a 6f6f 6d5f 696e 222c 0a20     "xzoom_in",. 
-00018b60: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00018b70: 787a 6f6f 6d5f 6f75 7422 2c0a 2020 2020  xzoom_out",.    
-00018b80: 2020 2020 2020 2020 2020 2020 7877 6865              xwhe
-00018b90: 656c 5f7a 6f6f 6d2c 0a20 2020 2020 2020  el_zoom,.       
-00018ba0: 2020 2020 2020 2020 2022 7265 7365 7422           "reset"
-00018bb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018bc0: 2020 2274 6170 222c 0a20 2020 2020 2020    "tap",.       
-00018bd0: 2020 2020 2020 2020 2022 686f 7665 7222           "hover"
-00018be0: 2c0a 2020 2020 2020 2020 2020 2020 5d2c  ,.            ],
-00018bf0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-00018c00: 6976 655f 7363 726f 6c6c 3d78 7768 6565  ive_scroll=xwhee
-00018c10: 6c5f 7a6f 6f6d 2c0a 2020 2020 2020 2020  l_zoom,.        
-00018c20: 2020 2020 6163 7469 7665 5f64 7261 673d      active_drag=
-00018c30: 2278 7061 6e22 2c0a 2020 2020 2020 2020  "xpan",.        
-00018c40: 2020 2020 785f 7261 6e67 653d 785f 7261      x_range=x_ra
-00018c50: 6e67 652c 0a20 2020 2020 2020 2029 0a0a  nge,.        )..
-00018c60: 2020 2020 2020 2020 6465 6275 6728 226e          debug("n
-00018c70: 6f77 2070 6c6f 7420 7468 6520 524f 4820  ow plot the ROH 
-00018c80: 6173 2072 6563 7461 6e67 6c65 7322 290a  as rectangles").
-00018c90: 2020 2020 2020 2020 6669 672e 7175 6164          fig.quad
-00018ca0: 280a 2020 2020 2020 2020 2020 2020 626f  (.            bo
-00018cb0: 7474 6f6d 3d22 626f 7474 6f6d 222c 0a20  ttom="bottom",. 
-00018cc0: 2020 2020 2020 2020 2020 2074 6f70 3d22             top="
-00018cd0: 746f 7022 2c0a 2020 2020 2020 2020 2020  top",.          
-00018ce0: 2020 6c65 6674 3d22 726f 685f 7374 6172    left="roh_star
-00018cf0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-00018d00: 7269 6768 743d 2272 6f68 5f73 746f 7022  right="roh_stop"
-00018d10: 2c0a 2020 2020 2020 2020 2020 2020 736f  ,.            so
-00018d20: 7572 6365 3d64 6174 612c 0a20 2020 2020  urce=data,.     
-00018d30: 2020 2020 2020 206c 696e 655f 7769 6474         line_widt
-00018d40: 683d 302e 352c 0a20 2020 2020 2020 2020  h=0.5,.         
-00018d50: 2020 2066 696c 6c5f 616c 7068 613d 302e     fill_alpha=0.
-00018d60: 352c 0a20 2020 2020 2020 2029 0a0a 2020  5,.        )..  
-00018d70: 2020 2020 2020 6465 6275 6728 2274 6964        debug("tid
-00018d80: 7920 7570 2074 6865 2070 6c6f 7422 290a  y up the plot").
-00018d90: 2020 2020 2020 2020 6669 672e 795f 7261          fig.y_ra
-00018da0: 6e67 6520 3d20 626f 6b65 682e 6d6f 6465  nge = bokeh.mode
-00018db0: 6c73 2e52 616e 6765 3164 2830 2c20 3129  ls.Range1d(0, 1)
-00018dc0: 0a20 2020 2020 2020 2066 6967 2e79 6772  .        fig.ygr
-00018dd0: 6964 2e76 6973 6962 6c65 203d 2046 616c  id.visible = Fal
-00018de0: 7365 0a20 2020 2020 2020 2066 6967 2e79  se.        fig.y
-00018df0: 6178 6973 2e74 6963 6b65 7220 3d20 5b5d  axis.ticker = []
-00018e00: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
-00018e10: 6f6b 6568 5f73 7479 6c65 5f67 656e 6f6d  okeh_style_genom
-00018e20: 655f 7861 7869 7328 6669 672c 2072 6573  e_xaxis(fig, res
-00018e30: 6f6c 7665 645f 7265 6769 6f6e 2e63 6f6e  olved_region.con
-00018e40: 7469 6729 0a0a 2020 2020 2020 2020 6966  tig)..        if
-00018e50: 2073 686f 773a 0a20 2020 2020 2020 2020   show:.         
-00018e60: 2020 2062 6f6b 6568 2e70 6c6f 7474 696e     bokeh.plottin
-00018e70: 672e 7368 6f77 2866 6967 290a 0a20 2020  g.show(fig)..   
-00018e80: 2020 2020 2072 6574 7572 6e20 6669 670a       return fig.
-00018e90: 0a20 2020 2040 646f 6328 0a20 2020 2020  .    @doc(.     
-00018ea0: 2020 2073 756d 6d61 7279 3d22 2222 0a20     summary=""". 
-00018eb0: 2020 2020 2020 2020 2020 2050 6c6f 7420             Plot 
-00018ec0: 7769 6e64 6f77 6564 2068 6574 6572 6f7a  windowed heteroz
-00018ed0: 7967 6f73 6974 7920 616e 6420 696e 6665  ygosity and infe
-00018ee0: 7272 6564 2072 756e 7320 6f66 2068 6f6d  rred runs of hom
-00018ef0: 6f7a 7967 6f73 6974 7920 666f 7220 610a  ozygosity for a.
-00018f00: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-00018f10: 6c65 2073 616d 706c 6520 6f76 6572 2061  le sample over a
-00018f20: 2067 656e 6f6d 6520 7265 6769 6f6e 2e0a   genome region..
-00018f30: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-00018f40: 2029 0a20 2020 2064 6566 2070 6c6f 745f   ).    def plot_
-00018f50: 726f 6828 0a20 2020 2020 2020 2073 656c  roh(.        sel
-00018f60: 662c 0a20 2020 2020 2020 2073 616d 706c  f,.        sampl
-00018f70: 653a 2068 6574 5f70 6172 616d 732e 7361  e: het_params.sa
-00018f80: 6d70 6c65 2c0a 2020 2020 2020 2020 7265  mple,.        re
-00018f90: 6769 6f6e 3a20 6261 7365 5f70 6172 616d  gion: base_param
-00018fa0: 732e 7265 6769 6f6e 2c0a 2020 2020 2020  s.region,.      
-00018fb0: 2020 7769 6e64 6f77 5f73 697a 653a 2068    window_size: h
-00018fc0: 6574 5f70 6172 616d 732e 7769 6e64 6f77  et_params.window
-00018fd0: 5f73 697a 6520 3d20 6865 745f 7061 7261  _size = het_para
-00018fe0: 6d73 2e77 696e 646f 775f 7369 7a65 5f64  ms.window_size_d
-00018ff0: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-00019000: 7369 7465 5f6d 6173 6b3a 2062 6173 655f  site_mask: base_
-00019010: 7061 7261 6d73 2e73 6974 655f 6d61 736b  params.site_mask
-00019020: 203d 2044 4546 4155 4c54 2c0a 2020 2020   = DEFAULT,.    
-00019030: 2020 2020 7361 6d70 6c65 5f73 6574 3a20      sample_set: 
-00019040: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-00019050: 7261 6d73 2e73 616d 706c 655f 7365 745d  rams.sample_set]
-00019060: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00019070: 2070 6865 745f 726f 683a 2068 6574 5f70   phet_roh: het_p
-00019080: 6172 616d 732e 7068 6574 5f72 6f68 203d  arams.phet_roh =
-00019090: 2068 6574 5f70 6172 616d 732e 7068 6574   het_params.phet
-000190a0: 5f72 6f68 5f64 6566 6175 6c74 2c0a 2020  _roh_default,.  
-000190b0: 2020 2020 2020 7068 6574 5f6e 6f6e 726f        phet_nonro
-000190c0: 683a 2068 6574 5f70 6172 616d 732e 7068  h: het_params.ph
-000190d0: 6574 5f6e 6f6e 726f 6820 3d20 6865 745f  et_nonroh = het_
-000190e0: 7061 7261 6d73 2e70 6865 745f 6e6f 6e72  params.phet_nonr
-000190f0: 6f68 5f64 6566 6175 6c74 2c0a 2020 2020  oh_default,.    
-00019100: 2020 2020 7472 616e 7369 7469 6f6e 3a20      transition: 
-00019110: 6865 745f 7061 7261 6d73 2e74 7261 6e73  het_params.trans
-00019120: 6974 696f 6e20 3d20 6865 745f 7061 7261  ition = het_para
-00019130: 6d73 2e74 7261 6e73 6974 696f 6e5f 6465  ms.transition_de
-00019140: 6661 756c 742c 0a20 2020 2020 2020 2079  fault,.        y
-00019150: 5f6d 6178 3a20 6865 745f 7061 7261 6d73  _max: het_params
-00019160: 2e79 5f6d 6178 203d 2068 6574 5f70 6172  .y_max = het_par
-00019170: 616d 732e 795f 6d61 785f 6465 6661 756c  ams.y_max_defaul
-00019180: 742c 0a20 2020 2020 2020 2073 697a 696e  t,.        sizin
-00019190: 675f 6d6f 6465 3a20 6770 6c74 5f70 6172  g_mode: gplt_par
-000191a0: 616d 732e 7369 7a69 6e67 5f6d 6f64 6520  ams.sizing_mode 
-000191b0: 3d20 6770 6c74 5f70 6172 616d 732e 7369  = gplt_params.si
-000191c0: 7a69 6e67 5f6d 6f64 655f 6465 6661 756c  zing_mode_defaul
-000191d0: 742c 0a20 2020 2020 2020 2077 6964 7468  t,.        width
-000191e0: 3a20 6770 6c74 5f70 6172 616d 732e 7769  : gplt_params.wi
-000191f0: 6474 6820 3d20 6770 6c74 5f70 6172 616d  dth = gplt_param
-00019200: 732e 7769 6474 685f 6465 6661 756c 742c  s.width_default,
-00019210: 0a20 2020 2020 2020 2068 6574 6572 6f7a  .        heteroz
-00019220: 7967 6f73 6974 795f 6865 6967 6874 3a20  ygosity_height: 
-00019230: 6770 6c74 5f70 6172 616d 732e 6865 6967  gplt_params.heig
-00019240: 6874 203d 2031 3730 2c0a 2020 2020 2020  ht = 170,.      
-00019250: 2020 726f 685f 6865 6967 6874 3a20 6770    roh_height: gp
-00019260: 6c74 5f70 6172 616d 732e 6865 6967 6874  lt_params.height
-00019270: 203d 2035 302c 0a20 2020 2020 2020 2067   = 50,.        g
-00019280: 656e 6573 5f68 6569 6768 743a 2067 706c  enes_height: gpl
-00019290: 745f 7061 7261 6d73 2e67 656e 6573 5f68  t_params.genes_h
-000192a0: 6569 6768 7420 3d20 6770 6c74 5f70 6172  eight = gplt_par
-000192b0: 616d 732e 6765 6e65 735f 6865 6967 6874  ams.genes_height
-000192c0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-000192d0: 2020 6369 7263 6c65 5f6b 7761 7267 733a    circle_kwargs:
-000192e0: 204f 7074 696f 6e61 6c5b 6865 745f 7061   Optional[het_pa
-000192f0: 7261 6d73 2e63 6972 636c 655f 6b77 6172  rams.circle_kwar
-00019300: 6773 5d20 3d20 4e6f 6e65 2c0a 2020 2020  gs] = None,.    
-00019310: 2020 2020 7368 6f77 3a20 6770 6c74 5f70      show: gplt_p
-00019320: 6172 616d 732e 7368 6f77 203d 2054 7275  arams.show = Tru
-00019330: 652c 0a20 2020 2029 202d 3e20 6770 6c74  e,.    ) -> gplt
-00019340: 5f70 6172 616d 732e 6669 6775 7265 3a0a  _params.figure:.
-00019350: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-00019360: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-00019370: 0a20 2020 2020 2020 2072 6573 6f6c 7665  .        resolve
-00019380: 645f 7265 6769 6f6e 203d 2073 656c 662e  d_region = self.
-00019390: 7265 736f 6c76 655f 7265 6769 6f6e 2872  resolve_region(r
-000193a0: 6567 696f 6e29 0a20 2020 2020 2020 2064  egion).        d
-000193b0: 656c 2072 6567 696f 6e0a 0a20 2020 2020  el region..     
-000193c0: 2020 2064 6562 7567 2822 636f 6d70 7574     debug("comput
-000193d0: 6520 7769 6e64 6f77 6564 2068 6574 6572  e windowed heter
-000193e0: 6f7a 7967 6f73 6974 7922 290a 2020 2020  ozygosity").    
-000193f0: 2020 2020 7361 6d70 6c65 5f69 642c 2073      sample_id, s
-00019400: 616d 706c 655f 7365 742c 2077 696e 646f  ample_set, windo
-00019410: 7773 2c20 636f 756e 7473 203d 2073 656c  ws, counts = sel
-00019420: 662e 5f73 616d 706c 655f 636f 756e 745f  f._sample_count_
-00019430: 6865 7428 0a20 2020 2020 2020 2020 2020  het(.           
-00019440: 2073 616d 706c 653d 7361 6d70 6c65 2c0a   sample=sample,.
-00019450: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-00019460: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
-00019470: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00019480: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
-00019490: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
-000194a0: 2077 696e 646f 775f 7369 7a65 3d77 696e   window_size=win
-000194b0: 646f 775f 7369 7a65 2c0a 2020 2020 2020  dow_size,.      
-000194c0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
-000194d0: 3d73 616d 706c 655f 7365 742c 0a20 2020  =sample_set,.   
-000194e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000194f0: 6465 6275 6728 2270 6c6f 745f 6865 7465  debug("plot_hete
-00019500: 726f 7a79 676f 7369 7479 2074 7261 636b  rozygosity track
-00019510: 2229 0a20 2020 2020 2020 2066 6967 5f68  ").        fig_h
-00019520: 6574 203d 2073 656c 662e 5f70 6c6f 745f  et = self._plot_
-00019530: 6865 7465 726f 7a79 676f 7369 7479 5f74  heterozygosity_t
-00019540: 7261 636b 280a 2020 2020 2020 2020 2020  rack(.          
-00019550: 2020 7361 6d70 6c65 5f69 643d 7361 6d70    sample_id=samp
-00019560: 6c65 5f69 642c 0a20 2020 2020 2020 2020  le_id,.         
-00019570: 2020 2073 616d 706c 655f 7365 743d 7361     sample_set=sa
-00019580: 6d70 6c65 5f73 6574 2c0a 2020 2020 2020  mple_set,.      
-00019590: 2020 2020 2020 7769 6e64 6f77 733d 7769        windows=wi
-000195a0: 6e64 6f77 732c 0a20 2020 2020 2020 2020  ndows,.         
-000195b0: 2020 2063 6f75 6e74 733d 636f 756e 7473     counts=counts
-000195c0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-000195d0: 6769 6f6e 3d72 6573 6f6c 7665 645f 7265  gion=resolved_re
-000195e0: 6769 6f6e 2c0a 2020 2020 2020 2020 2020  gion,.          
-000195f0: 2020 7769 6e64 6f77 5f73 697a 653d 7769    window_size=wi
-00019600: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
-00019610: 2020 2020 2020 2079 5f6d 6178 3d79 5f6d         y_max=y_m
-00019620: 6178 2c0a 2020 2020 2020 2020 2020 2020  ax,.            
-00019630: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-00019640: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-00019650: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-00019660: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-00019670: 6967 6874 3d68 6574 6572 6f7a 7967 6f73  ight=heterozygos
-00019680: 6974 795f 6865 6967 6874 2c0a 2020 2020  ity_height,.    
-00019690: 2020 2020 2020 2020 6369 7263 6c65 5f6b          circle_k
-000196a0: 7761 7267 733d 6369 7263 6c65 5f6b 7761  wargs=circle_kwa
-000196b0: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-000196c0: 2073 686f 773d 4661 6c73 652c 0a20 2020   show=False,.   
-000196d0: 2020 2020 2020 2020 2078 5f72 616e 6765           x_range
-000196e0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2029  =None,.        )
-000196f0: 0a20 2020 2020 2020 2066 6967 5f68 6574  .        fig_het
-00019700: 2e78 6178 6973 2e76 6973 6962 6c65 203d  .xaxis.visible =
-00019710: 2046 616c 7365 0a20 2020 2020 2020 2066   False.        f
-00019720: 6967 7320 3d20 5b66 6967 5f68 6574 5d0a  igs = [fig_het].
-00019730: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00019740: 636f 6d70 7574 6520 7275 6e73 206f 6620  compute runs of 
-00019750: 686f 6d6f 7a79 676f 7369 7479 2229 0a20  homozygosity"). 
-00019760: 2020 2020 2020 2064 665f 726f 6820 3d20         df_roh = 
-00019770: 7365 6c66 2e5f 726f 685f 686d 6d5f 7072  self._roh_hmm_pr
-00019780: 6564 6963 7428 0a20 2020 2020 2020 2020  edict(.         
-00019790: 2020 2077 696e 646f 7773 3d77 696e 646f     windows=windo
-000197a0: 7773 2c0a 2020 2020 2020 2020 2020 2020  ws,.            
-000197b0: 636f 756e 7473 3d63 6f75 6e74 732c 0a20  counts=counts,. 
-000197c0: 2020 2020 2020 2020 2020 2070 6865 745f             phet_
-000197d0: 726f 683d 7068 6574 5f72 6f68 2c0a 2020  roh=phet_roh,.  
-000197e0: 2020 2020 2020 2020 2020 7068 6574 5f6e            phet_n
-000197f0: 6f6e 726f 683d 7068 6574 5f6e 6f6e 726f  onroh=phet_nonro
-00019800: 682c 0a20 2020 2020 2020 2020 2020 2074  h,.            t
-00019810: 7261 6e73 6974 696f 6e3d 7472 616e 7369  ransition=transi
-00019820: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00019830: 2020 7769 6e64 6f77 5f73 697a 653d 7769    window_size=wi
-00019840: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
-00019850: 2020 2020 2020 2073 616d 706c 655f 6964         sample_id
-00019860: 3d73 616d 706c 655f 6964 2c0a 2020 2020  =sample_id,.    
-00019870: 2020 2020 2020 2020 636f 6e74 6967 3d72          contig=r
-00019880: 6573 6f6c 7665 645f 7265 6769 6f6e 2e63  esolved_region.c
-00019890: 6f6e 7469 672c 0a20 2020 2020 2020 2029  ontig,.        )
-000198a0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-000198b0: 2270 6c6f 7420 726f 6820 7472 6163 6b22  "plot roh track"
-000198c0: 290a 2020 2020 2020 2020 6669 675f 726f  ).        fig_ro
-000198d0: 6820 3d20 7365 6c66 2e70 6c6f 745f 726f  h = self.plot_ro
-000198e0: 685f 7472 6163 6b28 0a20 2020 2020 2020  h_track(.       
-000198f0: 2020 2020 2064 665f 726f 682c 0a20 2020       df_roh,.   
-00019900: 2020 2020 2020 2020 2072 6567 696f 6e3d           region=
-00019910: 7265 736f 6c76 6564 5f72 6567 696f 6e2c  resolved_region,
-00019920: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
-00019930: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
-00019940: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
-00019950: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
-00019960: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00019970: 743d 726f 685f 6865 6967 6874 2c0a 2020  t=roh_height,.  
-00019980: 2020 2020 2020 2020 2020 7368 6f77 3d46            show=F
-00019990: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-000199a0: 2020 785f 7261 6e67 653d 6669 675f 6865    x_range=fig_he
-000199b0: 742e 785f 7261 6e67 652c 0a20 2020 2020  t.x_range,.     
-000199c0: 2020 2029 0a20 2020 2020 2020 2066 6967     ).        fig
-000199d0: 5f72 6f68 2e78 6178 6973 2e76 6973 6962  _roh.xaxis.visib
-000199e0: 6c65 203d 2046 616c 7365 0a20 2020 2020  le = False.     
-000199f0: 2020 2066 6967 732e 6170 7065 6e64 2866     figs.append(f
-00019a00: 6967 5f72 6f68 290a 0a20 2020 2020 2020  ig_roh)..       
-00019a10: 2064 6562 7567 2822 706c 6f74 2067 656e   debug("plot gen
-00019a20: 6573 2074 7261 636b 2229 0a20 2020 2020  es track").     
-00019a30: 2020 2066 6967 5f67 656e 6573 203d 2073     fig_genes = s
-00019a40: 656c 662e 706c 6f74 5f67 656e 6573 280a  elf.plot_genes(.
-00019a50: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-00019a60: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
-00019a70: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00019a80: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-00019a90: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-00019aa0: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-00019ab0: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-00019ac0: 6967 6874 3d67 656e 6573 5f68 6569 6768  ight=genes_heigh
-00019ad0: 742c 0a20 2020 2020 2020 2020 2020 2078  t,.            x
-00019ae0: 5f72 616e 6765 3d66 6967 5f68 6574 2e78  _range=fig_het.x
-00019af0: 5f72 616e 6765 2c0a 2020 2020 2020 2020  _range,.        
-00019b00: 2020 2020 7368 6f77 3d46 616c 7365 2c0a      show=False,.
-00019b10: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00019b20: 2020 6669 6773 2e61 7070 656e 6428 6669    figs.append(fi
-00019b30: 675f 6765 6e65 7329 0a0a 2020 2020 2020  g_genes)..      
-00019b40: 2020 6465 6275 6728 2263 6f6d 6269 6e65    debug("combine
-00019b50: 2070 6c6f 7473 2069 6e74 6f20 6120 7369   plots into a si
-00019b60: 6e67 6c65 2066 6967 7572 6522 290a 2020  ngle figure").  
-00019b70: 2020 2020 2020 6669 675f 616c 6c20 3d20        fig_all = 
-00019b80: 626f 6b65 682e 6c61 796f 7574 732e 6772  bokeh.layouts.gr
-00019b90: 6964 706c 6f74 280a 2020 2020 2020 2020  idplot(.        
-00019ba0: 2020 2020 6669 6773 2c0a 2020 2020 2020      figs,.      
-00019bb0: 2020 2020 2020 6e63 6f6c 733d 312c 0a20        ncols=1,. 
-00019bc0: 2020 2020 2020 2020 2020 2074 6f6f 6c62             toolb
-00019bd0: 6172 5f6c 6f63 6174 696f 6e3d 2261 626f  ar_location="abo
-00019be0: 7665 222c 0a20 2020 2020 2020 2020 2020  ve",.           
-00019bf0: 206d 6572 6765 5f74 6f6f 6c73 3d54 7275   merge_tools=Tru
-00019c00: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00019c10: 697a 696e 675f 6d6f 6465 3d73 697a 696e  izing_mode=sizin
-00019c20: 675f 6d6f 6465 2c0a 2020 2020 2020 2020  g_mode,.        
-00019c30: 290a 0a20 2020 2020 2020 2069 6620 7368  )..        if sh
-00019c40: 6f77 3a0a 2020 2020 2020 2020 2020 2020  ow:.            
-00019c50: 626f 6b65 682e 706c 6f74 7469 6e67 2e73  bokeh.plotting.s
-00019c60: 686f 7728 6669 675f 616c 6c29 0a0a 2020  how(fig_all)..  
-00019c70: 2020 2020 2020 7265 7475 726e 2066 6967        return fig
-00019c80: 5f61 6c6c 0a0a 2020 2020 6465 6620 5f6c  _all..    def _l
-00019c90: 6f63 6174 655f 7369 7465 5f63 6c61 7373  ocate_site_class
-00019ca0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00019cb0: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
-00019cc0: 2020 2072 6567 696f 6e2c 0a20 2020 2020     region,.     
-00019cd0: 2020 2073 6974 655f 6d61 736b 2c0a 2020     site_mask,.  
-00019ce0: 2020 2020 2020 7369 7465 5f63 6c61 7373        site_class
-00019cf0: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00019d00: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
-00019d10: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
-00019d20: 2020 2320 6361 6368 6520 7468 6573 6520    # cache these 
-00019d30: 6461 7461 2069 6e20 6d65 6d6f 7279 2074  data in memory t
-00019d40: 6f20 6176 6f69 6420 7265 7065 6174 6564  o avoid repeated
-00019d50: 2063 6f6d 7075 7461 7469 6f6e 0a20 2020   computation.   
-00019d60: 2020 2020 2063 6163 6865 5f6b 6579 203d       cache_key =
-00019d70: 2028 7265 6769 6f6e 2c20 7369 7465 5f6d   (region, site_m
-00019d80: 6173 6b2c 2073 6974 655f 636c 6173 7329  ask, site_class)
-00019d90: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-00019da0: 2020 2020 2020 2020 2020 206c 6f63 5f61             loc_a
-00019db0: 6e6e 203d 2073 656c 662e 5f63 6163 6865  nn = self._cache
-00019dc0: 5f6c 6f63 6174 655f 7369 7465 5f63 6c61  _locate_site_cla
-00019dd0: 7373 5b63 6163 6865 5f6b 6579 5d0a 0a20  ss[cache_key].. 
-00019de0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00019df0: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
-00019e00: 2020 2020 6465 6275 6728 2261 6363 6573      debug("acces
-00019e10: 7320 7369 7465 2061 6e6e 6f74 6174 696f  s site annotatio
-00019e20: 6e73 2064 6174 6122 290a 2020 2020 2020  ns data").      
-00019e30: 2020 2020 2020 6473 5f61 6e6e 203d 2073        ds_ann = s
-00019e40: 656c 662e 7369 7465 5f61 6e6e 6f74 6174  elf.site_annotat
-00019e50: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
-00019e60: 2020 2020 2020 7265 6769 6f6e 3d72 6567        region=reg
-00019e70: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-00019e80: 2020 2020 2073 6974 655f 6d61 736b 3d73       site_mask=s
-00019e90: 6974 655f 6d61 736b 2c0a 2020 2020 2020  ite_mask,.      
-00019ea0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00019eb0: 2020 2020 636f 646f 6e5f 706f 7320 3d20      codon_pos = 
-00019ec0: 6473 5f61 6e6e 5b22 636f 646f 6e5f 706f  ds_ann["codon_po
-00019ed0: 7369 7469 6f6e 225d 2e64 6174 610a 2020  sition"].data.  
-00019ee0: 2020 2020 2020 2020 2020 636f 646f 6e5f            codon_
-00019ef0: 6465 6720 3d20 6473 5f61 6e6e 5b22 636f  deg = ds_ann["co
-00019f00: 646f 6e5f 6465 6765 6e65 7261 6379 225d  don_degeneracy"]
-00019f10: 2e64 6174 610a 2020 2020 2020 2020 2020  .data.          
-00019f20: 2020 7365 715f 636c 7320 3d20 6473 5f61    seq_cls = ds_a
-00019f30: 6e6e 5b22 7365 715f 636c 7322 5d2e 6461  nn["seq_cls"].da
-00019f40: 7461 0a20 2020 2020 2020 2020 2020 2073  ta.            s
-00019f50: 6571 5f66 6c65 6e20 3d20 6473 5f61 6e6e  eq_flen = ds_ann
-00019f60: 5b22 7365 715f 666c 656e 225d 2e64 6174  ["seq_flen"].dat
-00019f70: 610a 2020 2020 2020 2020 2020 2020 7365  a.            se
-00019f80: 715f 7265 6c70 6f73 5f73 7461 7274 203d  q_relpos_start =
-00019f90: 2064 735f 616e 6e5b 2273 6571 5f72 656c   ds_ann["seq_rel
-00019fa0: 706f 735f 7374 6172 7422 5d2e 6461 7461  pos_start"].data
-00019fb0: 0a20 2020 2020 2020 2020 2020 2073 6571  .            seq
-00019fc0: 5f72 656c 706f 735f 7374 6f70 203d 2064  _relpos_stop = d
-00019fd0: 735f 616e 6e5b 2273 6571 5f72 656c 706f  s_ann["seq_relpo
-00019fe0: 735f 7374 6f70 225d 2e64 6174 610a 2020  s_stop"].data.  
-00019ff0: 2020 2020 2020 2020 2020 7369 7465 5f63            site_c
-0001a000: 6c61 7373 203d 2073 6974 655f 636c 6173  lass = site_clas
-0001a010: 732e 7570 7065 7228 290a 0a20 2020 2020  s.upper()..     
-0001a020: 2020 2020 2020 2064 6562 7567 2822 6465         debug("de
-0001a030: 6669 6e65 2063 6f6e 7374 616e 7473 2075  fine constants u
-0001a040: 7365 6420 696e 2073 6974 6520 616e 6e6f  sed in site anno
-0001a050: 7461 7469 6f6e 7320 6461 7461 2229 0a20  tations data"). 
-0001a060: 2020 2020 2020 2020 2020 2023 2046 4958             # FIX
-0001a070: 4d45 3a20 7661 7269 6162 6c65 2069 6e20  ME: variable in 
-0001a080: 6675 6e63 7469 6f6e 2073 686f 756c 6420  function should 
-0001a090: 6265 206c 6f77 6572 6361 7365 0a20 2020  be lowercase.   
-0001a0a0: 2020 2020 2020 2020 2053 4551 5f43 4c53           SEQ_CLS
-0001a0b0: 5f55 4e4b 4e4f 574e 203d 2030 2020 2320  _UNKNOWN = 0  # 
-0001a0c0: 6e6f 7161 0a20 2020 2020 2020 2020 2020  noqa.           
-0001a0d0: 2053 4551 5f43 4c53 5f55 5053 5452 4541   SEQ_CLS_UPSTREA
-0001a0e0: 4d20 3d20 310a 2020 2020 2020 2020 2020  M = 1.          
-0001a0f0: 2020 5345 515f 434c 535f 444f 574e 5354    SEQ_CLS_DOWNST
-0001a100: 5245 414d 203d 2032 0a20 2020 2020 2020  REAM = 2.       
-0001a110: 2020 2020 2053 4551 5f43 4c53 5f35 5554       SEQ_CLS_5UT
-0001a120: 5220 3d20 330a 2020 2020 2020 2020 2020  R = 3.          
-0001a130: 2020 5345 515f 434c 535f 3355 5452 203d    SEQ_CLS_3UTR =
-0001a140: 2034 0a20 2020 2020 2020 2020 2020 2053   4.            S
-0001a150: 4551 5f43 4c53 5f43 4453 5f46 4952 5354  EQ_CLS_CDS_FIRST
-0001a160: 203d 2035 0a20 2020 2020 2020 2020 2020   = 5.           
-0001a170: 2053 4551 5f43 4c53 5f43 4453 5f4d 4944   SEQ_CLS_CDS_MID
-0001a180: 203d 2036 0a20 2020 2020 2020 2020 2020   = 6.           
-0001a190: 2053 4551 5f43 4c53 5f43 4453 5f4c 4153   SEQ_CLS_CDS_LAS
-0001a1a0: 5420 3d20 370a 2020 2020 2020 2020 2020  T = 7.          
-0001a1b0: 2020 5345 515f 434c 535f 494e 5452 4f4e    SEQ_CLS_INTRON
-0001a1c0: 5f46 4952 5354 203d 2038 0a20 2020 2020  _FIRST = 8.     
-0001a1d0: 2020 2020 2020 2053 4551 5f43 4c53 5f49         SEQ_CLS_I
-0001a1e0: 4e54 524f 4e5f 4d49 4420 3d20 390a 2020  NTRON_MID = 9.  
-0001a1f0: 2020 2020 2020 2020 2020 5345 515f 434c            SEQ_CL
-0001a200: 535f 494e 5452 4f4e 5f4c 4153 5420 3d20  S_INTRON_LAST = 
-0001a210: 3130 0a20 2020 2020 2020 2020 2020 2043  10.            C
-0001a220: 4f44 4f4e 5f44 4547 5f55 4e4b 4e4f 574e  ODON_DEG_UNKNOWN
-0001a230: 203d 2030 2020 2320 6e6f 7161 0a20 2020   = 0  # noqa.   
-0001a240: 2020 2020 2020 2020 2043 4f44 4f4e 5f44           CODON_D
-0001a250: 4547 5f30 203d 2031 0a20 2020 2020 2020  EG_0 = 1.       
-0001a260: 2020 2020 2043 4f44 4f4e 5f44 4547 5f32       CODON_DEG_2
-0001a270: 5f53 494d 504c 4520 3d20 320a 2020 2020  _SIMPLE = 2.    
-0001a280: 2020 2020 2020 2020 434f 444f 4e5f 4445          CODON_DE
-0001a290: 475f 325f 434f 4d50 4c45 5820 3d20 3320  G_2_COMPLEX = 3 
-0001a2a0: 2023 206e 6f71 610a 2020 2020 2020 2020   # noqa.        
-0001a2b0: 2020 2020 434f 444f 4e5f 4445 475f 3420      CODON_DEG_4 
-0001a2c0: 3d20 340a 0a20 2020 2020 2020 2020 2020  = 4..           
-0001a2d0: 2064 6562 7567 2822 7365 7420 7570 2073   debug("set up s
-0001a2e0: 6974 6520 7365 6c65 6374 696f 6e22 290a  ite selection").
-0001a2f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001a300: 7369 7465 5f63 6c61 7373 203d 3d20 2243  site_class == "C
-0001a310: 4453 5f44 4547 5f34 223a 0a20 2020 2020  DS_DEG_4":.     
-0001a320: 2020 2020 2020 2020 2020 2023 2034 2d66             # 4-f
-0001a330: 6f6c 6420 6465 6765 6e65 7261 7465 2063  old degenerate c
-0001a340: 6f64 696e 6720 7369 7465 730a 2020 2020  oding sites.    
-0001a350: 2020 2020 2020 2020 2020 2020 6c6f 635f              loc_
-0001a360: 616e 6e20 3d20 280a 2020 2020 2020 2020  ann = (.        
-0001a370: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-0001a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a390: 2020 2020 2020 2873 6571 5f63 6c73 203d        (seq_cls =
-0001a3a0: 3d20 5345 515f 434c 535f 4344 535f 4649  = SEQ_CLS_CDS_FI
-0001a3b0: 5253 5429 0a20 2020 2020 2020 2020 2020  RST).           
-0001a3c0: 2020 2020 2020 2020 2020 2020 207c 2028               | (
-0001a3d0: 7365 715f 636c 7320 3d3d 2053 4551 5f43  seq_cls == SEQ_C
-0001a3e0: 4c53 5f43 4453 5f4d 4944 290a 2020 2020  LS_CDS_MID).    
-0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a400: 2020 2020 7c20 2873 6571 5f63 6c73 203d      | (seq_cls =
-0001a410: 3d20 5345 515f 434c 535f 4344 535f 4c41  = SEQ_CLS_CDS_LA
-0001a420: 5354 290a 2020 2020 2020 2020 2020 2020  ST).            
-0001a430: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001a440: 2020 2020 2020 2020 2020 2020 2020 2620                & 
-0001a450: 2863 6f64 6f6e 5f70 6f73 203d 3d20 3229  (codon_pos == 2)
-0001a460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a470: 2020 2020 2026 2028 636f 646f 6e5f 6465       & (codon_de
-0001a480: 6720 3d3d 2043 4f44 4f4e 5f44 4547 5f34  g == CODON_DEG_4
-0001a490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a4a0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-0001a4b0: 2065 6c69 6620 7369 7465 5f63 6c61 7373   elif site_class
-0001a4c0: 203d 3d20 2243 4453 5f44 4547 5f32 5f53   == "CDS_DEG_2_S
-0001a4d0: 494d 504c 4522 3a0a 2020 2020 2020 2020  IMPLE":.        
-0001a4e0: 2020 2020 2020 2020 2320 322d 666f 6c64          # 2-fold
-0001a4f0: 2064 6567 656e 6572 6174 6520 636f 6469   degenerate codi
-0001a500: 6e67 2073 6974 6573 0a20 2020 2020 2020  ng sites.       
-0001a510: 2020 2020 2020 2020 206c 6f63 5f61 6e6e           loc_ann
-0001a520: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0001a530: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
-0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a550: 2020 2028 7365 715f 636c 7320 3d3d 2053     (seq_cls == S
-0001a560: 4551 5f43 4c53 5f43 4453 5f46 4952 5354  EQ_CLS_CDS_FIRST
-0001a570: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a580: 2020 2020 2020 2020 2020 7c20 2873 6571            | (seq
-0001a590: 5f63 6c73 203d 3d20 5345 515f 434c 535f  _cls == SEQ_CLS_
-0001a5a0: 4344 535f 4d49 4429 0a20 2020 2020 2020  CDS_MID).       
-0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5c0: 207c 2028 7365 715f 636c 7320 3d3d 2053   | (seq_cls == S
-0001a5d0: 4551 5f43 4c53 5f43 4453 5f4c 4153 5429  EQ_CLS_CDS_LAST)
-0001a5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a5f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001a600: 2020 2020 2020 2020 2020 2026 2028 636f             & (co
-0001a610: 646f 6e5f 706f 7320 3d3d 2032 290a 2020  don_pos == 2).  
-0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 2020 2620 2863 6f64 6f6e 5f64 6567 203d    & (codon_deg =
-0001a640: 3d20 434f 444f 4e5f 4445 475f 325f 5349  = CODON_DEG_2_SI
-0001a650: 4d50 4c45 290a 2020 2020 2020 2020 2020  MPLE).          
-0001a660: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0001a670: 2020 2020 2065 6c69 6620 7369 7465 5f63       elif site_c
-0001a680: 6c61 7373 203d 3d20 2243 4453 5f44 4547  lass == "CDS_DEG
-0001a690: 5f30 223a 0a20 2020 2020 2020 2020 2020  _0":.           
-0001a6a0: 2020 2020 2023 206e 6f6e 2d64 6567 656e       # non-degen
-0001a6b0: 6572 6174 6520 636f 6469 6e67 2073 6974  erate coding sit
-0001a6c0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0001a6d0: 2020 206c 6f63 5f61 6e6e 203d 2028 0a20     loc_ann = (. 
-0001a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6f0: 2020 2028 7365 715f 636c 7320 3d3d 2053     (seq_cls == S
-0001a700: 4551 5f43 4c53 5f43 4453 5f46 4952 5354  EQ_CLS_CDS_FIRST
-0001a710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a720: 2020 2020 2020 7c20 2873 6571 5f63 6c73        | (seq_cls
-0001a730: 203d 3d20 5345 515f 434c 535f 4344 535f   == SEQ_CLS_CDS_
-0001a740: 4d49 4429 0a20 2020 2020 2020 2020 2020  MID).           
-0001a750: 2020 2020 2020 2020 207c 2028 7365 715f           | (seq_
-0001a760: 636c 7320 3d3d 2053 4551 5f43 4c53 5f43  cls == SEQ_CLS_C
-0001a770: 4453 5f4c 4153 5429 0a20 2020 2020 2020  DS_LAST).       
-0001a780: 2020 2020 2020 2020 2029 2026 2028 636f           ) & (co
-0001a790: 646f 6e5f 6465 6720 3d3d 2043 4f44 4f4e  don_deg == CODON
-0001a7a0: 5f44 4547 5f30 290a 0a20 2020 2020 2020  _DEG_0)..       
-0001a7b0: 2020 2020 2065 6c69 6620 7369 7465 5f63       elif site_c
-0001a7c0: 6c61 7373 203d 3d20 2249 4e54 524f 4e5f  lass == "INTRON_
-0001a7d0: 5348 4f52 5422 3a0a 2020 2020 2020 2020  SHORT":.        
-0001a7e0: 2020 2020 2020 2020 2320 7368 6f72 7420          # short 
-0001a7f0: 696e 7472 6f6e 732c 2065 7863 6c75 6469  introns, excludi
-0001a800: 6e67 2073 706c 6963 6520 7265 6769 6f6e  ng splice region
-0001a810: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0001a820: 2020 6c6f 635f 616e 6e20 3d20 280a 2020    loc_ann = (.  
-0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a840: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-0001a850: 2020 2020 2020 2020 2020 2020 2873 6571              (seq
-0001a860: 5f63 6c73 203d 3d20 5345 515f 434c 535f  _cls == SEQ_CLS_
-0001a870: 494e 5452 4f4e 5f46 4952 5354 290a 2020  INTRON_FIRST).  
-0001a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a890: 2020 2020 2020 7c20 2873 6571 5f63 6c73        | (seq_cls
-0001a8a0: 203d 3d20 5345 515f 434c 535f 494e 5452   == SEQ_CLS_INTR
-0001a8b0: 4f4e 5f4d 4944 290a 2020 2020 2020 2020  ON_MID).        
-0001a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8d0: 7c20 2873 6571 5f63 6c73 203d 3d20 5345  | (seq_cls == SE
-0001a8e0: 515f 434c 535f 494e 5452 4f4e 5f4c 4153  Q_CLS_INTRON_LAS
-0001a8f0: 5429 0a20 2020 2020 2020 2020 2020 2020  T).             
-0001a900: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001a910: 2020 2020 2020 2020 2020 2020 2026 2028               & (
-0001a920: 7365 715f 666c 656e 203c 2031 3030 290a  seq_flen < 100).
-0001a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a940: 2020 2020 2620 2873 6571 5f72 656c 706f      & (seq_relpo
-0001a950: 735f 7374 6172 7420 3e20 3130 290a 2020  s_start > 10).  
-0001a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a970: 2020 2620 2873 6571 5f72 656c 706f 735f    & (seq_relpos_
-0001a980: 7374 6f70 203e 2031 3029 0a20 2020 2020  stop > 10).     
-0001a990: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001a9a0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0001a9b0: 6974 655f 636c 6173 7320 3d3d 2022 494e  ite_class == "IN
-0001a9c0: 5452 4f4e 5f4c 4f4e 4722 3a0a 2020 2020  TRON_LONG":.    
-0001a9d0: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
-0001a9e0: 6e67 2069 6e74 726f 6e73 2c20 6578 636c  ng introns, excl
-0001a9f0: 7564 696e 6720 7370 6c69 6365 2072 6567  uding splice reg
-0001aa00: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0001aa10: 2020 2020 206c 6f63 5f61 6e6e 203d 2028       loc_ann = (
-0001aa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa30: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-0001aa40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001aa50: 7365 715f 636c 7320 3d3d 2053 4551 5f43  seq_cls == SEQ_C
-0001aa60: 4c53 5f49 4e54 524f 4e5f 4649 5253 5429  LS_INTRON_FIRST)
-0001aa70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa80: 2020 2020 2020 2020 207c 2028 7365 715f           | (seq_
-0001aa90: 636c 7320 3d3d 2053 4551 5f43 4c53 5f49  cls == SEQ_CLS_I
-0001aaa0: 4e54 524f 4e5f 4d49 4429 0a20 2020 2020  NTRON_MID).     
-0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aac0: 2020 207c 2028 7365 715f 636c 7320 3d3d     | (seq_cls ==
-0001aad0: 2053 4551 5f43 4c53 5f49 4e54 524f 4e5f   SEQ_CLS_INTRON_
-0001aae0: 4c41 5354 290a 2020 2020 2020 2020 2020  LAST).          
-0001aaf0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab10: 2620 2873 6571 5f66 6c65 6e20 3e20 3230  & (seq_flen > 20
-0001ab20: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001ab30: 2020 2020 2020 2026 2028 7365 715f 7265         & (seq_re
-0001ab40: 6c70 6f73 5f73 7461 7274 203e 2031 3029  lpos_start > 10)
-0001ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ab60: 2020 2020 2026 2028 7365 715f 7265 6c70       & (seq_relp
-0001ab70: 6f73 5f73 746f 7020 3e20 3130 290a 2020  os_stop > 10).  
-0001ab80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001ab90: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0001aba0: 6620 7369 7465 5f63 6c61 7373 203d 3d20  f site_class == 
-0001abb0: 2249 4e54 524f 4e5f 5350 4c49 4345 5f35  "INTRON_SPLICE_5
-0001abc0: 5052 494d 4522 3a0a 2020 2020 2020 2020  PRIME":.        
-0001abd0: 2020 2020 2020 2020 2320 3527 2069 6e74          # 5' int
-0001abe0: 726f 6e20 7370 6c69 6365 2072 6567 696f  ron splice regio
-0001abf0: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
-0001ac00: 2020 206c 6f63 5f61 6e6e 203d 2028 0a20     loc_ann = (. 
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac20: 2020 2028 7365 715f 636c 7320 3d3d 2053     (seq_cls == S
-0001ac30: 4551 5f43 4c53 5f49 4e54 524f 4e5f 4649  EQ_CLS_INTRON_FI
-0001ac40: 5253 5429 0a20 2020 2020 2020 2020 2020  RST).           
-0001ac50: 2020 2020 2020 2020 207c 2028 7365 715f           | (seq_
-0001ac60: 636c 7320 3d3d 2053 4551 5f43 4c53 5f49  cls == SEQ_CLS_I
-0001ac70: 4e54 524f 4e5f 4d49 4429 0a20 2020 2020  NTRON_MID).     
-0001ac80: 2020 2020 2020 2020 2020 2020 2020 207c                 |
-0001ac90: 2028 7365 715f 636c 7320 3d3d 2053 4551   (seq_cls == SEQ
-0001aca0: 5f43 4c53 5f49 4e54 524f 4e5f 4c41 5354  _CLS_INTRON_LAST
-0001acb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001acc0: 2020 2920 2620 2873 6571 5f72 656c 706f    ) & (seq_relpo
-0001acd0: 735f 7374 6172 7420 3c20 3229 0a0a 2020  s_start < 2)..  
-0001ace0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0001acf0: 6974 655f 636c 6173 7320 3d3d 2022 494e  ite_class == "IN
-0001ad00: 5452 4f4e 5f53 504c 4943 455f 3350 5249  TRON_SPLICE_3PRI
-0001ad10: 4d45 223a 0a20 2020 2020 2020 2020 2020  ME":.           
-0001ad20: 2020 2020 2023 2033 2720 696e 7472 6f6e       # 3' intron
-0001ad30: 2073 706c 6963 6520 7265 6769 6f6e 730a   splice regions.
-0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad50: 6c6f 635f 616e 6e20 3d20 280a 2020 2020  loc_ann = (.    
-0001ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad70: 2873 6571 5f63 6c73 203d 3d20 5345 515f  (seq_cls == SEQ_
-0001ad80: 434c 535f 494e 5452 4f4e 5f46 4952 5354  CLS_INTRON_FIRST
-0001ad90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ada0: 2020 2020 2020 7c20 2873 6571 5f63 6c73        | (seq_cls
-0001adb0: 203d 3d20 5345 515f 434c 535f 494e 5452   == SEQ_CLS_INTR
-0001adc0: 4f4e 5f4d 4944 290a 2020 2020 2020 2020  ON_MID).        
-0001add0: 2020 2020 2020 2020 2020 2020 7c20 2873              | (s
-0001ade0: 6571 5f63 6c73 203d 3d20 5345 515f 434c  eq_cls == SEQ_CL
-0001adf0: 535f 494e 5452 4f4e 5f4c 4153 5429 0a20  S_INTRON_LAST). 
-0001ae00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001ae10: 2026 2028 7365 715f 7265 6c70 6f73 5f73   & (seq_relpos_s
-0001ae20: 746f 7020 3c20 3229 0a0a 2020 2020 2020  top < 2)..      
-0001ae30: 2020 2020 2020 656c 6966 2073 6974 655f        elif site_
-0001ae40: 636c 6173 7320 3d3d 2022 5554 525f 3550  class == "UTR_5P
-0001ae50: 5249 4d45 223a 0a20 2020 2020 2020 2020  RIME":.         
-0001ae60: 2020 2020 2020 2023 2035 2720 5554 520a         # 5' UTR.
-0001ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae80: 6c6f 635f 616e 6e20 3d20 7365 715f 636c  loc_ann = seq_cl
-0001ae90: 7320 3d3d 2053 4551 5f43 4c53 5f35 5554  s == SEQ_CLS_5UT
-0001aea0: 520a 0a20 2020 2020 2020 2020 2020 2065  R..            e
-0001aeb0: 6c69 6620 7369 7465 5f63 6c61 7373 203d  lif site_class =
-0001aec0: 3d20 2255 5452 5f33 5052 494d 4522 3a0a  = "UTR_3PRIME":.
-0001aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aee0: 2320 3327 2055 5452 0a20 2020 2020 2020  # 3' UTR.       
-0001aef0: 2020 2020 2020 2020 206c 6f63 5f61 6e6e           loc_ann
-0001af00: 203d 2073 6571 5f63 6c73 203d 3d20 5345   = seq_cls == SE
-0001af10: 515f 434c 535f 3355 5452 0a0a 2020 2020  Q_CLS_3UTR..    
-0001af20: 2020 2020 2020 2020 656c 6966 2073 6974          elif sit
-0001af30: 655f 636c 6173 7320 3d3d 2022 494e 5445  e_class == "INTE
-0001af40: 5247 454e 4943 223a 0a20 2020 2020 2020  RGENIC":.       
-0001af50: 2020 2020 2020 2020 2023 2069 6e74 6572           # inter
-0001af60: 6765 6e69 6320 7265 6769 6f6e 732c 2064  genic regions, d
-0001af70: 6973 7461 6e74 2066 726f 6d20 6120 6765  istant from a ge
-0001af80: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-0001af90: 2020 206c 6f63 5f61 6e6e 203d 2028 0a20     loc_ann = (. 
-0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afb0: 2020 2028 7365 715f 636c 7320 3d3d 2053     (seq_cls == S
-0001afc0: 4551 5f43 4c53 5f55 5053 5452 4541 4d29  EQ_CLS_UPSTREAM)
-0001afd0: 2026 2028 7365 715f 7265 6c70 6f73 5f73   & (seq_relpos_s
-0001afe0: 746f 7020 3e20 3130 5f30 3030 290a 2020  top > 10_000).  
-0001aff0: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
-0001b000: 7c20 2828 7365 715f 636c 7320 3d3d 2053  | ((seq_cls == S
-0001b010: 4551 5f43 4c53 5f44 4f57 4e53 5452 4541  EQ_CLS_DOWNSTREA
-0001b020: 4d29 2026 2028 7365 715f 7265 6c70 6f73  M) & (seq_relpos
-0001b030: 5f73 7461 7274 203e 2031 305f 3030 3029  _start > 10_000)
-0001b040: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0001b050: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001b060: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-0001b070: 706c 656d 656e 7465 6445 7272 6f72 2873  plementedError(s
-0001b080: 6974 655f 636c 6173 7329 0a0a 2020 2020  ite_class)..    
-0001b090: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
-0001b0a0: 6f6d 7075 7465 2073 6974 6520 7365 6c65  ompute site sele
-0001b0b0: 6374 696f 6e22 290a 2020 2020 2020 2020  ction").        
-0001b0c0: 2020 2020 7769 7468 2073 656c 662e 5f64      with self._d
-0001b0d0: 6173 6b5f 7072 6f67 7265 7373 2864 6573  ask_progress(des
-0001b0e0: 633d 6622 4c6f 6361 7465 207b 7369 7465  c=f"Locate {site
-0001b0f0: 5f63 6c61 7373 7d20 7369 7465 7322 293a  _class} sites"):
-0001b100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b110: 206c 6f63 5f61 6e6e 203d 206c 6f63 5f61   loc_ann = loc_a
-0001b120: 6e6e 2e63 6f6d 7075 7465 2829 0a0a 2020  nn.compute()..  
-0001b130: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0001b140: 6361 6368 655f 6c6f 6361 7465 5f73 6974  cache_locate_sit
-0001b150: 655f 636c 6173 735b 6361 6368 655f 6b65  e_class[cache_ke
-0001b160: 795d 203d 206c 6f63 5f61 6e6e 0a0a 2020  y] = loc_ann..  
-0001b170: 2020 2020 2020 7265 7475 726e 206c 6f63        return loc
-0001b180: 5f61 6e6e 0a0a 2020 2020 4064 6f63 280a  _ann..    @doc(.
-0001b190: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-0001b1a0: 224c 6f61 6420 7369 7465 2061 6e6e 6f74  "Load site annot
-0001b1b0: 6174 696f 6e73 2e22 2c0a 2020 2020 2020  ations.",.      
-0001b1c0: 2020 7265 7475 726e 733d 2241 2064 6174    returns="A dat
-0001b1d0: 6173 6574 206f 6620 7369 7465 2061 6e6e  aset of site ann
-0001b1e0: 6f74 6174 696f 6e73 2e22 2c0a 2020 2020  otations.",.    
-0001b1f0: 290a 2020 2020 6465 6620 7369 7465 5f61  ).    def site_a
-0001b200: 6e6e 6f74 6174 696f 6e73 280a 2020 2020  nnotations(.    
-0001b210: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0001b220: 2020 7265 6769 6f6e 3a20 6261 7365 5f70    region: base_p
-0001b230: 6172 616d 732e 7265 6769 6f6e 2c0a 2020  arams.region,.  
-0001b240: 2020 2020 2020 7369 7465 5f6d 6173 6b3a        site_mask:
-0001b250: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-0001b260: 6172 616d 732e 7369 7465 5f6d 6173 6b5d  arams.site_mask]
-0001b270: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001b280: 2069 6e6c 696e 655f 6172 7261 793a 2062   inline_array: b
-0001b290: 6173 655f 7061 7261 6d73 2e69 6e6c 696e  ase_params.inlin
-0001b2a0: 655f 6172 7261 7920 3d20 6261 7365 5f70  e_array = base_p
-0001b2b0: 6172 616d 732e 696e 6c69 6e65 5f61 7272  arams.inline_arr
-0001b2c0: 6179 5f64 6566 6175 6c74 2c0a 2020 2020  ay_default,.    
-0001b2d0: 2020 2020 6368 756e 6b73 3a20 6261 7365      chunks: base
-0001b2e0: 5f70 6172 616d 732e 6368 756e 6b73 203d  _params.chunks =
-0001b2f0: 2062 6173 655f 7061 7261 6d73 2e63 6875   base_params.chu
-0001b300: 6e6b 735f 6465 6661 756c 742c 0a20 2020  nks_default,.   
-0001b310: 2029 202d 3e20 7872 2e44 6174 6173 6574   ) -> xr.Dataset
-0001b320: 3a0a 2020 2020 2020 2020 2320 4e2e 422e  :.        # N.B.
-0001b330: 2c20 7765 2064 6566 6175 6c74 2074 6f20  , we default to 
-0001b340: 6368 756e 6b73 3d22 6175 746f 2220 6865  chunks="auto" he
-0001b350: 7265 2066 6f72 2070 6572 666f 726d 616e  re for performan
-0001b360: 6365 2072 6561 736f 6e73 0a0a 2020 2020  ce reasons..    
-0001b370: 2020 2020 6465 6275 6720 3d20 7365 6c66      debug = self
-0001b380: 2e5f 6c6f 672e 6465 6275 670a 0a20 2020  ._log.debug..   
-0001b390: 2020 2020 2064 6562 7567 2822 7265 736f       debug("reso
-0001b3a0: 6c76 6520 7265 6769 6f6e 2229 0a20 2020  lve region").   
-0001b3b0: 2020 2020 2072 6573 6f6c 7665 645f 7265       resolved_re
-0001b3c0: 6769 6f6e 203d 2073 656c 662e 7265 736f  gion = self.reso
-0001b3d0: 6c76 655f 7265 6769 6f6e 2872 6567 696f  lve_region(regio
-0001b3e0: 6e29 0a20 2020 2020 2020 2064 656c 2072  n).        del r
-0001b3f0: 6567 696f 6e0a 2020 2020 2020 2020 6966  egion.        if
-0001b400: 2069 7369 6e73 7461 6e63 6528 7265 736f   isinstance(reso
-0001b410: 6c76 6564 5f72 6567 696f 6e2c 206c 6973  lved_region, lis
-0001b420: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001b430: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0001b440: 224d 756c 7469 706c 6520 7265 6769 6f6e  "Multiple region
-0001b450: 7320 6e6f 7420 7375 7070 6f72 7465 642e  s not supported.
-0001b460: 2229 0a20 2020 2020 2020 2063 6f6e 7469  ").        conti
-0001b470: 6720 3d20 7265 736f 6c76 6564 5f72 6567  g = resolved_reg
-0001b480: 696f 6e2e 636f 6e74 6967 0a0a 2020 2020  ion.contig..    
-0001b490: 2020 2020 6465 6275 6728 226f 7065 6e20      debug("open 
-0001b4a0: 7369 7465 2061 6e6e 6f74 6174 696f 6e73  site annotations
-0001b4b0: 207a 6172 7222 290a 2020 2020 2020 2020   zarr").        
-0001b4c0: 726f 6f74 203d 2073 656c 662e 6f70 656e  root = self.open
-0001b4d0: 5f73 6974 655f 616e 6e6f 7461 7469 6f6e  _site_annotation
-0001b4e0: 7328 290a 0a20 2020 2020 2020 2064 6562  s()..        deb
-0001b4f0: 7567 2822 6275 696c 6420 6120 6461 7461  ug("build a data
-0001b500: 7365 7422 290a 2020 2020 2020 2020 6473  set").        ds
-0001b510: 203d 2078 722e 4461 7461 7365 7428 290a   = xr.Dataset().
-0001b520: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
-0001b530: 6420 696e 2028 0a20 2020 2020 2020 2020  d in (.         
-0001b540: 2020 2022 636f 646f 6e5f 6465 6765 6e65     "codon_degene
-0001b550: 7261 6379 222c 0a20 2020 2020 2020 2020  racy",.         
-0001b560: 2020 2022 636f 646f 6e5f 6e6f 6e73 796e     "codon_nonsyn
-0001b570: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-0001b580: 636f 646f 6e5f 706f 7369 7469 6f6e 222c  codon_position",
-0001b590: 0a20 2020 2020 2020 2020 2020 2022 7365  .            "se
-0001b5a0: 715f 636c 7322 2c0a 2020 2020 2020 2020  q_cls",.        
-0001b5b0: 2020 2020 2273 6571 5f66 6c65 6e22 2c0a      "seq_flen",.
-0001b5c0: 2020 2020 2020 2020 2020 2020 2273 6571              "seq
-0001b5d0: 5f72 656c 706f 735f 7374 6172 7422 2c0a  _relpos_start",.
-0001b5e0: 2020 2020 2020 2020 2020 2020 2273 6571              "seq
-0001b5f0: 5f72 656c 706f 735f 7374 6f70 222c 0a20  _relpos_stop",. 
-0001b600: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001b610: 2020 2020 2020 6461 7461 203d 2064 615f        data = da_
-0001b620: 6672 6f6d 5f7a 6172 7228 0a20 2020 2020  from_zarr(.     
-0001b630: 2020 2020 2020 2020 2020 2072 6f6f 745b             root[
-0001b640: 6669 656c 645d 5b63 6f6e 7469 675d 2c0a  field][contig],.
-0001b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b660: 696e 6c69 6e65 5f61 7272 6179 3d69 6e6c  inline_array=inl
-0001b670: 696e 655f 6172 7261 792c 0a20 2020 2020  ine_array,.     
-0001b680: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-0001b690: 733d 6368 756e 6b73 2c0a 2020 2020 2020  s=chunks,.      
-0001b6a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001b6b0: 2020 2020 6473 5b66 6965 6c64 5d20 3d20      ds[field] = 
-0001b6c0: 2276 6172 6961 6e74 7322 2c20 6461 7461  "variants", data
-0001b6d0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-0001b6e0: 2273 7562 7365 7420 746f 2053 4e50 2070  "subset to SNP p
-0001b6f0: 6f73 6974 696f 6e73 2229 0a20 2020 2020  ositions").     
-0001b700: 2020 2070 6f73 203d 2073 656c 662e 736e     pos = self.sn
-0001b710: 705f 7369 7465 7328 0a20 2020 2020 2020  p_sites(.       
-0001b720: 2020 2020 2072 6567 696f 6e3d 636f 6e74       region=cont
-0001b730: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-0001b740: 6669 656c 643d 2250 4f53 222c 0a20 2020  field="POS",.   
-0001b750: 2020 2020 2020 2020 2073 6974 655f 6d61           site_ma
-0001b760: 736b 3d73 6974 655f 6d61 736b 2c0a 2020  sk=site_mask,.  
-0001b770: 2020 2020 2020 2020 2020 696e 6c69 6e65            inline
-0001b780: 5f61 7272 6179 3d69 6e6c 696e 655f 6172  _array=inline_ar
-0001b790: 7261 792c 0a20 2020 2020 2020 2020 2020  ray,.           
-0001b7a0: 2063 6875 6e6b 733d 6368 756e 6b73 2c0a   chunks=chunks,.
-0001b7b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001b7c0: 2020 706f 7320 3d20 706f 732e 636f 6d70    pos = pos.comp
-0001b7d0: 7574 6528 290a 2020 2020 2020 2020 6966  ute().        if
-0001b7e0: 2072 6573 6f6c 7665 645f 7265 6769 6f6e   resolved_region
-0001b7f0: 2e73 7461 7274 206f 7220 7265 736f 6c76  .start or resolv
-0001b800: 6564 5f72 6567 696f 6e2e 656e 643a 0a20  ed_region.end:. 
-0001b810: 2020 2020 2020 2020 2020 206c 6f63 5f72             loc_r
-0001b820: 6567 696f 6e20 3d20 6c6f 6361 7465 5f72  egion = locate_r
-0001b830: 6567 696f 6e28 7265 736f 6c76 6564 5f72  egion(resolved_r
-0001b840: 6567 696f 6e2c 2070 6f73 290a 2020 2020  egion, pos).    
-0001b850: 2020 2020 2020 2020 706f 7320 3d20 706f          pos = po
-0001b860: 735b 6c6f 635f 7265 6769 6f6e 5d0a 2020  s[loc_region].  
-0001b870: 2020 2020 2020 6964 7820 3d20 706f 7320        idx = pos 
-0001b880: 2d20 310a 2020 2020 2020 2020 6473 203d  - 1.        ds =
-0001b890: 2064 732e 6973 656c 2876 6172 6961 6e74   ds.isel(variant
-0001b8a0: 733d 6964 7829 0a0a 2020 2020 2020 2020  s=idx)..        
-0001b8b0: 7265 7475 726e 2064 730a 0a20 2020 2040  return ds..    @
-0001b8c0: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-0001b8d0: 6d61 7279 3d22 2222 0a20 2020 2020 2020  mary=""".       
-0001b8e0: 2020 2020 204c 6f61 6420 6120 6461 7461       Load a data
-0001b8f0: 2063 6174 616c 6f67 2070 726f 7669 6469   catalog providi
-0001b900: 6e67 2055 524c 7320 666f 7220 646f 776e  ng URLs for down
-0001b910: 6c6f 6164 696e 6720 4241 4d2c 2056 4346  loading BAM, VCF
-0001b920: 2061 6e64 205a 6172 720a 2020 2020 2020   and Zarr.      
-0001b930: 2020 2020 2020 6669 6c65 7320 666f 7220        files for 
-0001b940: 7361 6d70 6c65 7320 696e 2061 2067 6976  samples in a giv
-0001b950: 656e 2073 616d 706c 6520 7365 742e 0a20  en sample set.. 
-0001b960: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-0001b970: 2020 2020 7265 7475 726e 733d 224f 6e65      returns="One
-0001b980: 2072 6f77 2070 6572 2073 616d 706c 652c   row per sample,
-0001b990: 2063 6f6c 756d 6e73 2070 726f 7669 6465   columns provide
-0001b9a0: 2055 524c 732e 222c 0a20 2020 2029 0a20   URLs.",.    ). 
-0001b9b0: 2020 2064 6566 2077 6773 5f64 6174 615f     def wgs_data_
-0001b9c0: 6361 7461 6c6f 6728 7365 6c66 2c20 7361  catalog(self, sa
-0001b9d0: 6d70 6c65 5f73 6574 3a20 6261 7365 5f70  mple_set: base_p
-0001b9e0: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
-0001b9f0: 293a 0a20 2020 2020 2020 2064 6562 7567  ):.        debug
-0001ba00: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
-0001ba10: 7567 0a0a 2020 2020 2020 2020 6465 6275  ug..        debu
-0001ba20: 6728 226c 6f6f 6b20 7570 2072 656c 6561  g("look up relea
-0001ba30: 7365 2066 6f72 2073 616d 706c 6520 7365  se for sample se
-0001ba40: 7422 290a 2020 2020 2020 2020 7265 6c65  t").        rele
-0001ba50: 6173 6520 3d20 7365 6c66 2e6c 6f6f 6b75  ase = self.looku
-0001ba60: 705f 7265 6c65 6173 6528 7361 6d70 6c65  p_release(sample
-0001ba70: 5f73 6574 3d73 616d 706c 655f 7365 7429  _set=sample_set)
-0001ba80: 0a20 2020 2020 2020 2072 656c 6561 7365  .        release
-0001ba90: 5f70 6174 6820 3d20 7365 6c66 2e5f 7265  _path = self._re
-0001baa0: 6c65 6173 655f 746f 5f70 6174 6828 7265  lease_to_path(re
-0001bab0: 6c65 6173 653d 7265 6c65 6173 6529 0a0a  lease=release)..
-0001bac0: 2020 2020 2020 2020 6465 6275 6728 226c          debug("l
-0001bad0: 6f61 6420 6461 7461 2063 6174 616c 6f67  oad data catalog
-0001bae0: 2229 0a20 2020 2020 2020 2070 6174 6820  ").        path 
-0001baf0: 3d20 6622 7b73 656c 662e 5f62 6173 655f  = f"{self._base_
-0001bb00: 7061 7468 7d2f 7b72 656c 6561 7365 5f70  path}/{release_p
-0001bb10: 6174 687d 2f6d 6574 6164 6174 612f 6765  ath}/metadata/ge
-0001bb20: 6e65 7261 6c2f 7b73 616d 706c 655f 7365  neral/{sample_se
-0001bb30: 747d 2f77 6773 5f73 6e70 5f64 6174 612e  t}/wgs_snp_data.
-0001bb40: 6373 7622 0a20 2020 2020 2020 2077 6974  csv".        wit
-0001bb50: 6820 7365 6c66 2e5f 6673 2e6f 7065 6e28  h self._fs.open(
-0001bb60: 7061 7468 2920 6173 2066 3a0a 2020 2020  path) as f:.    
-0001bb70: 2020 2020 2020 2020 6466 203d 2070 642e          df = pd.
-0001bb80: 7265 6164 5f63 7376 2866 2c20 6e61 5f76  read_csv(f, na_v
-0001bb90: 616c 7565 733d 2222 290a 0a20 2020 2020  alues="")..     
-0001bba0: 2020 2064 6562 7567 2822 6e6f 726d 616c     debug("normal
-0001bbb0: 6973 6520 636f 6c75 6d6e 7322 290a 2020  ise columns").  
-0001bbc0: 2020 2020 2020 6466 203d 2064 665b 0a20        df = df[. 
-0001bbd0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-0001bbe0: 2020 2020 2020 2020 2020 2020 2022 7361               "sa
-0001bbf0: 6d70 6c65 5f69 6422 2c0a 2020 2020 2020  mple_id",.      
-0001bc00: 2020 2020 2020 2020 2020 2261 6c69 676e            "align
-0001bc10: 6d65 6e74 735f 6261 6d22 2c0a 2020 2020  ments_bam",.    
-0001bc20: 2020 2020 2020 2020 2020 2020 2273 6e70              "snp
-0001bc30: 5f67 656e 6f74 7970 6573 5f76 6366 222c  _genotypes_vcf",
-0001bc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bc50: 2022 736e 705f 6765 6e6f 7479 7065 735f   "snp_genotypes_
-0001bc60: 7a61 7272 222c 0a20 2020 2020 2020 2020  zarr",.         
-0001bc70: 2020 205d 0a20 2020 2020 2020 205d 0a0a     ].        ]..
-0001bc80: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-0001bc90: 660a 0a20 2020 2040 646f 6328 0a20 2020  f..    @doc(.   
-0001bca0: 2020 2020 2073 756d 6d61 7279 3d22 2222       summary="""
-0001bcb0: 0a20 2020 2020 2020 2020 2020 2052 756e  .            Run
-0001bcc0: 2061 2070 7269 6e63 6970 616c 2063 6f6d   a principal com
-0001bcd0: 706f 6e65 6e74 7320 616e 616c 7973 6973  ponents analysis
-0001bce0: 2028 5043 4129 2075 7369 6e67 2062 6961   (PCA) using bia
-0001bcf0: 6c6c 656c 6963 2053 4e50 7320 6672 6f6d  llelic SNPs from
-0001bd00: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0001bd10: 2073 656c 6563 7465 6420 6765 6e6f 6d65   selected genome
-0001bd20: 2072 6567 696f 6e20 616e 6420 7361 6d70   region and samp
-0001bd30: 6c65 732e 0a20 2020 2020 2020 2022 2222  les..        """
-0001bd40: 2c0a 2020 2020 2020 2020 7265 7475 726e  ,.        return
-0001bd50: 733d 2822 6466 5f70 6361 222c 2022 6576  s=("df_pca", "ev
-0001bd60: 7222 292c 0a20 2020 2020 2020 206e 6f74  r"),.        not
-0001bd70: 6573 3d22 2222 0a20 2020 2020 2020 2020  es=""".         
-0001bd80: 2020 2054 6869 7320 636f 6d70 7574 6174     This computat
-0001bd90: 696f 6e20 6d61 7920 7461 6b65 2073 6f6d  ion may take som
-0001bda0: 6520 7469 6d65 2074 6f20 7275 6e2c 2064  e time to run, d
-0001bdb0: 6570 656e 6469 6e67 206f 6e20 796f 7572  epending on your
-0001bdc0: 2063 6f6d 7075 7469 6e67 0a20 2020 2020   computing.     
-0001bdd0: 2020 2020 2020 2065 6e76 6972 6f6e 6d65         environme
-0001bde0: 6e74 2e20 5265 7375 6c74 7320 6f66 2074  nt. Results of t
-0001bdf0: 6869 7320 636f 6d70 7574 6174 696f 6e20  his computation 
-0001be00: 7769 6c6c 2062 6520 6361 6368 6564 2061  will be cached a
-0001be10: 6e64 2072 652d 7573 6564 2069 660a 2020  nd re-used if.  
-0001be20: 2020 2020 2020 2020 2020 7468 6520 6072            the `r
-0001be30: 6573 756c 7473 5f63 6163 6865 6020 7061  esults_cache` pa
-0001be40: 7261 6d65 7465 7220 7761 7320 7365 7420  rameter was set 
-0001be50: 7768 656e 2069 6e73 7461 6e74 6961 7469  when instantiati
-0001be60: 6e67 2074 6865 2041 6733 2063 6c61 7373  ng the Ag3 class
-0001be70: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
-0001be80: 2020 2029 0a20 2020 2064 6566 2070 6361     ).    def pca
-0001be90: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0001bea0: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
-0001beb0: 6261 7365 5f70 6172 616d 732e 7265 6769  base_params.regi
-0001bec0: 6f6e 2c0a 2020 2020 2020 2020 6e5f 736e  on,.        n_sn
-0001bed0: 7073 3a20 7063 615f 7061 7261 6d73 2e6e  ps: pca_params.n
-0001bee0: 5f73 6e70 732c 0a20 2020 2020 2020 2074  _snps,.        t
-0001bef0: 6869 6e5f 6f66 6673 6574 3a20 7063 615f  hin_offset: pca_
-0001bf00: 7061 7261 6d73 2e74 6869 6e5f 6f66 6673  params.thin_offs
-0001bf10: 6574 203d 2070 6361 5f70 6172 616d 732e  et = pca_params.
-0001bf20: 7468 696e 5f6f 6666 7365 745f 6465 6661  thin_offset_defa
-0001bf30: 756c 742c 0a20 2020 2020 2020 2073 616d  ult,.        sam
-0001bf40: 706c 655f 7365 7473 3a20 4f70 7469 6f6e  ple_sets: Option
-0001bf50: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-0001bf60: 616d 706c 655f 7365 7473 5d20 3d20 4e6f  ample_sets] = No
-0001bf70: 6e65 2c0a 2020 2020 2020 2020 7361 6d70  ne,.        samp
-0001bf80: 6c65 5f71 7565 7279 3a20 4f70 7469 6f6e  le_query: Option
-0001bf90: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-0001bfa0: 616d 706c 655f 7175 6572 795d 203d 204e  ample_query] = N
-0001bfb0: 6f6e 652c 0a20 2020 2020 2020 2073 6974  one,.        sit
-0001bfc0: 655f 6d61 736b 3a20 6261 7365 5f70 6172  e_mask: base_par
-0001bfd0: 616d 732e 7369 7465 5f6d 6173 6b20 3d20  ams.site_mask = 
-0001bfe0: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
-0001bff0: 206d 696e 5f6d 696e 6f72 5f61 633a 2070   min_minor_ac: p
-0001c000: 6361 5f70 6172 616d 732e 6d69 6e5f 6d69  ca_params.min_mi
-0001c010: 6e6f 725f 6163 203d 2070 6361 5f70 6172  nor_ac = pca_par
-0001c020: 616d 732e 6d69 6e5f 6d69 6e6f 725f 6163  ams.min_minor_ac
-0001c030: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-0001c040: 2020 6d61 785f 6d69 7373 696e 675f 616e    max_missing_an
-0001c050: 3a20 7063 615f 7061 7261 6d73 2e6d 6178  : pca_params.max
-0001c060: 5f6d 6973 7369 6e67 5f61 6e20 3d20 7063  _missing_an = pc
-0001c070: 615f 7061 7261 6d73 2e6d 6178 5f6d 6973  a_params.max_mis
-0001c080: 7369 6e67 5f61 6e5f 6465 6661 756c 742c  sing_an_default,
-0001c090: 0a20 2020 2020 2020 206e 5f63 6f6d 706f  .        n_compo
-0001c0a0: 6e65 6e74 733a 2070 6361 5f70 6172 616d  nents: pca_param
-0001c0b0: 732e 6e5f 636f 6d70 6f6e 656e 7473 203d  s.n_components =
-0001c0c0: 2070 6361 5f70 6172 616d 732e 6e5f 636f   pca_params.n_co
-0001c0d0: 6d70 6f6e 656e 7473 5f64 6566 6175 6c74  mponents_default
-0001c0e0: 2c0a 2020 2020 2920 2d3e 2054 7570 6c65  ,.    ) -> Tuple
-0001c0f0: 5b70 6361 5f70 6172 616d 732e 6466 5f70  [pca_params.df_p
-0001c100: 6361 2c20 7063 615f 7061 7261 6d73 2e65  ca, pca_params.e
-0001c110: 7672 5d3a 0a20 2020 2020 2020 2064 6562  vr]:.        deb
-0001c120: 7567 203d 2073 656c 662e 5f6c 6f67 2e64  ug = self._log.d
-0001c130: 6562 7567 0a0a 2020 2020 2020 2020 2320  ebug..        # 
-0001c140: 6368 616e 6765 2074 6869 7320 6e61 6d65  change this name
-0001c150: 2069 6620 796f 7520 6576 6572 2063 6861   if you ever cha
-0001c160: 6e67 6520 7468 6520 6265 6861 7669 6f75  nge the behaviou
-0001c170: 7220 6f66 2074 6869 7320 6675 6e63 7469  r of this functi
-0001c180: 6f6e 2c20 746f 0a20 2020 2020 2020 2023  on, to.        #
-0001c190: 2069 6e76 616c 6964 6174 6520 616e 7920   invalidate any 
-0001c1a0: 7072 6576 696f 7573 6c79 2063 6163 6865  previously cache
-0001c1b0: 6420 6461 7461 0a20 2020 2020 2020 206e  d data.        n
-0001c1c0: 616d 6520 3d20 7365 6c66 2e5f 7063 615f  ame = self._pca_
-0001c1d0: 7265 7375 6c74 735f 6361 6368 655f 6e61  results_cache_na
-0001c1e0: 6d65 0a0a 2020 2020 2020 2020 6465 6275  me..        debu
-0001c1f0: 6728 226e 6f72 6d61 6c69 7a65 2070 6172  g("normalize par
-0001c200: 616d 7320 666f 7220 636f 6e73 6973 7465  ams for consiste
-0001c210: 6e74 2068 6173 6820 7661 6c75 6522 290a  nt hash value").
-0001c220: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-0001c230: 6574 732c 2073 616d 706c 655f 7175 6572  ets, sample_quer
-0001c240: 7920 3d20 7365 6c66 2e5f 7072 6570 5f73  y = self._prep_s
-0001c250: 616d 706c 655f 7365 6c65 6374 696f 6e5f  ample_selection_
-0001c260: 6361 6368 655f 7061 7261 6d73 280a 2020  cache_params(.  
-0001c270: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
-0001c280: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
-0001c290: 732c 2073 616d 706c 655f 7175 6572 793d  s, sample_query=
-0001c2a0: 7361 6d70 6c65 5f71 7565 7279 0a20 2020  sample_query.   
-0001c2b0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0001c2c0: 6567 696f 6e20 3d20 7365 6c66 2e5f 7072  egion = self._pr
-0001c2d0: 6570 5f72 6567 696f 6e5f 6361 6368 655f  ep_region_cache_
-0001c2e0: 7061 7261 6d28 7265 6769 6f6e 3d72 6567  param(region=reg
-0001c2f0: 696f 6e29 0a20 2020 2020 2020 2073 6974  ion).        sit
-0001c300: 655f 6d61 736b 203d 2073 656c 662e 5f70  e_mask = self._p
-0001c310: 7265 705f 7369 7465 5f6d 6173 6b5f 7061  rep_site_mask_pa
-0001c320: 7261 6d28 7369 7465 5f6d 6173 6b3d 7369  ram(site_mask=si
-0001c330: 7465 5f6d 6173 6b29 0a20 2020 2020 2020  te_mask).       
-0001c340: 2070 6172 616d 7320 3d20 6469 6374 280a   params = dict(.
-0001c350: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-0001c360: 6f6e 3d72 6567 696f 6e2c 0a20 2020 2020  on=region,.     
-0001c370: 2020 2020 2020 206e 5f73 6e70 733d 6e5f         n_snps=n_
-0001c380: 736e 7073 2c0a 2020 2020 2020 2020 2020  snps,.          
-0001c390: 2020 7468 696e 5f6f 6666 7365 743d 7468    thin_offset=th
-0001c3a0: 696e 5f6f 6666 7365 742c 0a20 2020 2020  in_offset,.     
-0001c3b0: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-0001c3c0: 7473 3d73 616d 706c 655f 7365 7473 2c0a  ts=sample_sets,.
-0001c3d0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-0001c3e0: 6c65 5f71 7565 7279 3d73 616d 706c 655f  le_query=sample_
-0001c3f0: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
-0001c400: 2020 2073 6974 655f 6d61 736b 3d73 6974     site_mask=sit
-0001c410: 655f 6d61 736b 2c0a 2020 2020 2020 2020  e_mask,.        
-0001c420: 2020 2020 6d69 6e5f 6d69 6e6f 725f 6163      min_minor_ac
-0001c430: 3d6d 696e 5f6d 696e 6f72 5f61 632c 0a20  =min_minor_ac,. 
-0001c440: 2020 2020 2020 2020 2020 206d 6178 5f6d             max_m
-0001c450: 6973 7369 6e67 5f61 6e3d 6d61 785f 6d69  issing_an=max_mi
-0001c460: 7373 696e 675f 616e 2c0a 2020 2020 2020  ssing_an,.      
-0001c470: 2020 2020 2020 6e5f 636f 6d70 6f6e 656e        n_componen
-0001c480: 7473 3d6e 5f63 6f6d 706f 6e65 6e74 732c  ts=n_components,
-0001c490: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001c4a0: 2020 2020 6465 6275 6728 2274 7279 2074      debug("try t
-0001c4b0: 6f20 7265 7472 6965 7665 2072 6573 756c  o retrieve resul
-0001c4c0: 7473 2066 726f 6d20 7468 6520 6361 6368  ts from the cach
-0001c4d0: 6522 290a 2020 2020 2020 2020 7472 793a  e").        try:
-0001c4e0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0001c4f0: 756c 7473 203d 2073 656c 662e 7265 7375  ults = self.resu
-0001c500: 6c74 735f 6361 6368 655f 6765 7428 6e61  lts_cache_get(na
-0001c510: 6d65 3d6e 616d 652c 2070 6172 616d 733d  me=name, params=
-0001c520: 7061 7261 6d73 290a 0a20 2020 2020 2020  params)..       
-0001c530: 2065 7863 6570 7420 4361 6368 654d 6973   except CacheMis
-0001c540: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0001c550: 6573 756c 7473 203d 2073 656c 662e 5f70  esults = self._p
-0001c560: 6361 282a 2a70 6172 616d 7329 0a20 2020  ca(**params).   
-0001c570: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-0001c580: 7375 6c74 735f 6361 6368 655f 7365 7428  sults_cache_set(
-0001c590: 6e61 6d65 3d6e 616d 652c 2070 6172 616d  name=name, param
-0001c5a0: 733d 7061 7261 6d73 2c20 7265 7375 6c74  s=params, result
-0001c5b0: 733d 7265 7375 6c74 7329 0a0a 2020 2020  s=results)..    
-0001c5c0: 2020 2020 6465 6275 6728 2275 6e70 6163      debug("unpac
-0001c5d0: 6b20 7265 7375 6c74 7322 290a 2020 2020  k results").    
-0001c5e0: 2020 2020 636f 6f72 6473 203d 2072 6573      coords = res
-0001c5f0: 756c 7473 5b22 636f 6f72 6473 225d 0a20  ults["coords"]. 
-0001c600: 2020 2020 2020 2065 7672 203d 2072 6573         evr = res
-0001c610: 756c 7473 5b22 6576 7222 5d0a 0a20 2020  ults["evr"]..   
-0001c620: 2020 2020 2064 6562 7567 2822 6164 6420       debug("add 
-0001c630: 636f 6f72 6473 2074 6f20 7361 6d70 6c65  coords to sample
-0001c640: 206d 6574 6164 6174 6120 6461 7461 6672   metadata datafr
-0001c650: 616d 6522 290a 2020 2020 2020 2020 6466  ame").        df
-0001c660: 5f73 616d 706c 6573 203d 2073 656c 662e  _samples = self.
-0001c670: 7361 6d70 6c65 5f6d 6574 6164 6174 6128  sample_metadata(
-0001c680: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-0001c690: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-0001c6a0: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
-0001c6b0: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
-0001c6c0: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
-0001c6d0: 2020 2020 2029 0a20 2020 2020 2020 2064       ).        d
-0001c6e0: 665f 636f 6f72 6473 203d 2070 642e 4461  f_coords = pd.Da
-0001c6f0: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
-0001c700: 2020 2020 207b 6622 5043 7b69 202b 2031       {f"PC{i + 1
-0001c710: 7d22 3a20 636f 6f72 6473 5b3a 2c20 695d  }": coords[:, i]
-0001c720: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0001c730: 6e5f 636f 6d70 6f6e 656e 7473 297d 0a20  n_components)}. 
-0001c740: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001c750: 2064 665f 7063 6120 3d20 7064 2e63 6f6e   df_pca = pd.con
-0001c760: 6361 7428 5b64 665f 7361 6d70 6c65 732c  cat([df_samples,
-0001c770: 2064 665f 636f 6f72 6473 5d2c 2061 7869   df_coords], axi
-0001c780: 733d 2263 6f6c 756d 6e73 2229 0a0a 2020  s="columns")..  
-0001c790: 2020 2020 2020 7265 7475 726e 2064 665f        return df_
-0001c7a0: 7063 612c 2065 7672 0a0a 2020 2020 4064  pca, evr..    @d
-0001c7b0: 6f63 280a 2020 2020 2020 2020 7375 6d6d  oc(.        summ
-0001c7c0: 6172 793d 2222 220a 2020 2020 2020 2020  ary=""".        
-0001c7d0: 2020 2020 506c 6f74 2053 4e50 7320 696e      Plot SNPs in
-0001c7e0: 2061 2067 6976 656e 2067 656e 6f6d 6520   a given genome 
-0001c7f0: 7265 6769 6f6e 2e20 534e 5073 2061 7265  region. SNPs are
-0001c800: 2073 686f 776e 2061 7320 7265 6374 616e   shown as rectan
-0001c810: 676c 6573 2c0a 2020 2020 2020 2020 2020  gles,.          
-0001c820: 2020 7769 7468 2073 6567 7265 6761 7469    with segregati
-0001c830: 6e67 2061 6e64 206e 6f6e 2d73 6567 7265  ng and non-segre
-0001c840: 6761 7469 6e67 2053 4e50 7320 706f 7369  gating SNPs posi
-0001c850: 7469 6f6e 6564 206f 6e20 6469 6666 6572  tioned on differ
-0001c860: 656e 7420 6c65 7665 6c73 2c0a 2020 2020  ent levels,.    
-0001c870: 2020 2020 2020 2020 616e 6420 636f 6c6f          and colo
-0001c880: 7572 6564 2062 7920 7369 7465 2066 696c  ured by site fil
-0001c890: 7465 722e 0a20 2020 2020 2020 2022 2222  ter..        """
-0001c8a0: 2c0a 2020 2020 2020 2020 7061 7261 6d65  ,.        parame
-0001c8b0: 7465 7273 3d64 6963 7428 0a20 2020 2020  ters=dict(.     
-0001c8c0: 2020 2020 2020 206d 6178 5f73 6e70 733d         max_snps=
-0001c8d0: 224d 6178 696d 756d 206e 756d 6265 7220  "Maximum number 
-0001c8e0: 6f66 2053 4e50 7320 746f 2073 686f 772e  of SNPs to show.
-0001c8f0: 222c 0a20 2020 2020 2020 2029 2c0a 2020  ",.        ),.  
-0001c900: 2020 290a 2020 2020 6465 6620 706c 6f74    ).    def plot
-0001c910: 5f73 6e70 7328 0a20 2020 2020 2020 2073  _snps(.        s
-0001c920: 656c 662c 0a20 2020 2020 2020 2072 6567  elf,.        reg
-0001c930: 696f 6e3a 2062 6173 655f 7061 7261 6d73  ion: base_params
-0001c940: 2e72 6567 696f 6e2c 0a20 2020 2020 2020  .region,.       
-0001c950: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
-0001c960: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-0001c970: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
-0001c980: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0001c990: 7361 6d70 6c65 5f71 7565 7279 3a20 4f70  sample_query: Op
-0001c9a0: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-0001c9b0: 6d73 2e73 616d 706c 655f 7175 6572 795d  ms.sample_query]
-0001c9c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001c9d0: 2073 6974 655f 6d61 736b 3a20 6261 7365   site_mask: base
-0001c9e0: 5f70 6172 616d 732e 7369 7465 5f6d 6173  _params.site_mas
-0001c9f0: 6b20 3d20 4445 4641 554c 542c 0a20 2020  k = DEFAULT,.   
-0001ca00: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
-0001ca10: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-0001ca20: 7061 7261 6d73 2e63 6f68 6f72 745f 7369  params.cohort_si
-0001ca30: 7a65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ze] = None,.    
-0001ca40: 2020 2020 7369 7a69 6e67 5f6d 6f64 653a      sizing_mode:
-0001ca50: 2067 706c 745f 7061 7261 6d73 2e73 697a   gplt_params.siz
-0001ca60: 696e 675f 6d6f 6465 203d 2067 706c 745f  ing_mode = gplt_
-0001ca70: 7061 7261 6d73 2e73 697a 696e 675f 6d6f  params.sizing_mo
-0001ca80: 6465 5f64 6566 6175 6c74 2c0a 2020 2020  de_default,.    
-0001ca90: 2020 2020 7769 6474 683a 2067 706c 745f      width: gplt_
-0001caa0: 7061 7261 6d73 2e77 6964 7468 203d 2067  params.width = g
-0001cab0: 706c 745f 7061 7261 6d73 2e77 6964 7468  plt_params.width
-0001cac0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-0001cad0: 2020 7472 6163 6b5f 6865 6967 6874 3a20    track_height: 
-0001cae0: 6770 6c74 5f70 6172 616d 732e 6865 6967  gplt_params.heig
-0001caf0: 6874 203d 2038 302c 0a20 2020 2020 2020  ht = 80,.       
-0001cb00: 2067 656e 6573 5f68 6569 6768 743a 2067   genes_height: g
-0001cb10: 706c 745f 7061 7261 6d73 2e67 656e 6573  plt_params.genes
-0001cb20: 5f68 6569 6768 7420 3d20 6770 6c74 5f70  _height = gplt_p
-0001cb30: 6172 616d 732e 6765 6e65 735f 6865 6967  arams.genes_heig
-0001cb40: 6874 5f64 6566 6175 6c74 2c0a 2020 2020  ht_default,.    
-0001cb50: 2020 2020 6d61 785f 736e 7073 3a20 696e      max_snps: in
-0001cb60: 7420 3d20 3230 305f 3030 302c 0a20 2020  t = 200_000,.   
-0001cb70: 2020 2020 2073 686f 773a 2067 706c 745f       show: gplt_
-0001cb80: 7061 7261 6d73 2e73 686f 7720 3d20 5472  params.show = Tr
-0001cb90: 7565 2c0a 2020 2020 2920 2d3e 2067 706c  ue,.    ) -> gpl
-0001cba0: 745f 7061 7261 6d73 2e66 6967 7572 653a  t_params.figure:
-0001cbb0: 0a20 2020 2020 2020 2064 6562 7567 203d  .        debug =
-0001cbc0: 2073 656c 662e 5f6c 6f67 2e64 6562 7567   self._log.debug
-0001cbd0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-0001cbe0: 2270 6c6f 7420 534e 5073 2074 7261 636b  "plot SNPs track
-0001cbf0: 2229 0a20 2020 2020 2020 2066 6967 3120  ").        fig1 
-0001cc00: 3d20 7365 6c66 2e70 6c6f 745f 736e 7073  = self.plot_snps
-0001cc10: 5f74 7261 636b 280a 2020 2020 2020 2020  _track(.        
-0001cc20: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
-0001cc30: 6e2c 0a20 2020 2020 2020 2020 2020 2073  n,.            s
-0001cc40: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
-0001cc50: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
-0001cc60: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-0001cc70: 3d73 616d 706c 655f 7175 6572 792c 0a20  =sample_query,. 
-0001cc80: 2020 2020 2020 2020 2020 2073 6974 655f             site_
-0001cc90: 6d61 736b 3d73 6974 655f 6d61 736b 2c0a  mask=site_mask,.
-0001cca0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
-0001ccb0: 7274 5f73 697a 653d 636f 686f 7274 5f73  rt_size=cohort_s
-0001ccc0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-0001ccd0: 2073 697a 696e 675f 6d6f 6465 3d73 697a   sizing_mode=siz
-0001cce0: 696e 675f 6d6f 6465 2c0a 2020 2020 2020  ing_mode,.      
-0001ccf0: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
-0001cd00: 682c 0a20 2020 2020 2020 2020 2020 2068  h,.            h
-0001cd10: 6569 6768 743d 7472 6163 6b5f 6865 6967  eight=track_heig
-0001cd20: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
-0001cd30: 6d61 785f 736e 7073 3d6d 6178 5f73 6e70  max_snps=max_snp
-0001cd40: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
-0001cd50: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
-0001cd60: 2020 2029 0a20 2020 2020 2020 2066 6967     ).        fig
-0001cd70: 312e 7861 7869 732e 7669 7369 626c 6520  1.xaxis.visible 
-0001cd80: 3d20 4661 6c73 650a 0a20 2020 2020 2020  = False..       
-0001cd90: 2064 6562 7567 2822 706c 6f74 2067 656e   debug("plot gen
-0001cda0: 6573 2074 7261 636b 2229 0a20 2020 2020  es track").     
-0001cdb0: 2020 2066 6967 3220 3d20 7365 6c66 2e70     fig2 = self.p
-0001cdc0: 6c6f 745f 6765 6e65 7328 0a20 2020 2020  lot_genes(.     
-0001cdd0: 2020 2020 2020 2072 6567 696f 6e3d 7265         region=re
-0001cde0: 6769 6f6e 2c0a 2020 2020 2020 2020 2020  gion,.          
-0001cdf0: 2020 7369 7a69 6e67 5f6d 6f64 653d 7369    sizing_mode=si
-0001ce00: 7a69 6e67 5f6d 6f64 652c 0a20 2020 2020  zing_mode,.     
-0001ce10: 2020 2020 2020 2077 6964 7468 3d77 6964         width=wid
-0001ce20: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-0001ce30: 6865 6967 6874 3d67 656e 6573 5f68 6569  height=genes_hei
-0001ce40: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
-0001ce50: 2078 5f72 616e 6765 3d66 6967 312e 785f   x_range=fig1.x_
-0001ce60: 7261 6e67 652c 0a20 2020 2020 2020 2020  range,.         
-0001ce70: 2020 2073 686f 773d 4661 6c73 652c 0a20     show=False,. 
-0001ce80: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0001ce90: 2020 6669 6720 3d20 626f 6b65 682e 6c61    fig = bokeh.la
-0001cea0: 796f 7574 732e 6772 6964 706c 6f74 280a  youts.gridplot(.
-0001ceb0: 2020 2020 2020 2020 2020 2020 5b66 6967              [fig
-0001cec0: 312c 2066 6967 325d 2c0a 2020 2020 2020  1, fig2],.      
-0001ced0: 2020 2020 2020 6e63 6f6c 733d 312c 0a20        ncols=1,. 
-0001cee0: 2020 2020 2020 2020 2020 2074 6f6f 6c62             toolb
-0001cef0: 6172 5f6c 6f63 6174 696f 6e3d 2261 626f  ar_location="abo
-0001cf00: 7665 222c 0a20 2020 2020 2020 2020 2020  ve",.           
-0001cf10: 206d 6572 6765 5f74 6f6f 6c73 3d54 7275   merge_tools=Tru
-0001cf20: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-0001cf30: 697a 696e 675f 6d6f 6465 3d73 697a 696e  izing_mode=sizin
-0001cf40: 675f 6d6f 6465 2c0a 2020 2020 2020 2020  g_mode,.        
-0001cf50: 290a 0a20 2020 2020 2020 2069 6620 7368  )..        if sh
-0001cf60: 6f77 3a0a 2020 2020 2020 2020 2020 2020  ow:.            
-0001cf70: 626f 6b65 682e 706c 6f74 7469 6e67 2e73  bokeh.plotting.s
-0001cf80: 686f 7728 6669 6729 0a0a 2020 2020 2020  how(fig)..      
-0001cf90: 2020 7265 7475 726e 2066 6967 0a0a 2020    return fig..  
-0001cfa0: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
-0001cfb0: 7375 6d6d 6172 793d 224f 7065 6e20 7369  summary="Open si
-0001cfc0: 7465 2061 6e6e 6f74 6174 696f 6e73 207a  te annotations z
-0001cfd0: 6172 722e 222c 0a20 2020 2020 2020 2072  arr.",.        r
-0001cfe0: 6574 7572 6e73 3d22 5a61 7272 2068 6965  eturns="Zarr hie
-0001cff0: 7261 7263 6879 2e22 2c0a 2020 2020 290a  rarchy.",.    ).
-0001d000: 2020 2020 6465 6620 6f70 656e 5f73 6974      def open_sit
-0001d010: 655f 616e 6e6f 7461 7469 6f6e 7328 7365  e_annotations(se
-0001d020: 6c66 2920 2d3e 207a 6172 722e 6869 6572  lf) -> zarr.hier
-0001d030: 6172 6368 792e 4772 6f75 703a 0a20 2020  archy.Group:.   
-0001d040: 2020 2020 2069 6620 7365 6c66 2e5f 6361       if self._ca
-0001d050: 6368 655f 7369 7465 5f61 6e6e 6f74 6174  che_site_annotat
-0001d060: 696f 6e73 2069 7320 4e6f 6e65 3a0a 2020  ions is None:.  
-0001d070: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-0001d080: 2066 227b 7365 6c66 2e5f 6261 7365 5f70   f"{self._base_p
-0001d090: 6174 687d 2f7b 7365 6c66 2e5f 7369 7465  ath}/{self._site
-0001d0a0: 5f61 6e6e 6f74 6174 696f 6e73 5f7a 6172  _annotations_zar
-0001d0b0: 725f 7061 7468 7d22 0a20 2020 2020 2020  r_path}".       
-0001d0c0: 2020 2020 2073 746f 7265 203d 2069 6e69       store = ini
-0001d0d0: 745f 7a61 7272 5f73 746f 7265 2866 733d  t_zarr_store(fs=
-0001d0e0: 7365 6c66 2e5f 6673 2c20 7061 7468 3d70  self._fs, path=p
-0001d0f0: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-0001d100: 2073 656c 662e 5f63 6163 6865 5f73 6974   self._cache_sit
-0001d110: 655f 616e 6e6f 7461 7469 6f6e 7320 3d20  e_annotations = 
-0001d120: 7a61 7272 2e6f 7065 6e5f 636f 6e73 6f6c  zarr.open_consol
-0001d130: 6964 6174 6564 2873 746f 7265 3d73 746f  idated(store=sto
-0001d140: 7265 290a 2020 2020 2020 2020 7265 7475  re).        retu
-0001d150: 726e 2073 656c 662e 5f63 6163 6865 5f73  rn self._cache_s
-0001d160: 6974 655f 616e 6e6f 7461 7469 6f6e 730a  ite_annotations.
-0001d170: 0a20 2020 2040 646f 6328 0a20 2020 2020  .    @doc(.     
-0001d180: 2020 2073 756d 6d61 7279 3d22 2222 0a20     summary=""". 
-0001d190: 2020 2020 2020 2020 2020 2050 6c6f 7420             Plot 
-0001d1a0: 534e 5073 2069 6e20 6120 6769 7665 6e20  SNPs in a given 
-0001d1b0: 6765 6e6f 6d65 2072 6567 696f 6e2e 2053  genome region. S
-0001d1c0: 4e50 7320 6172 6520 7368 6f77 6e20 6173  NPs are shown as
-0001d1d0: 2072 6563 7461 6e67 6c65 732c 0a20 2020   rectangles,.   
-0001d1e0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-0001d1f0: 6772 6567 6174 696e 6720 616e 6420 6e6f  gregating and no
-0001d200: 6e2d 7365 6772 6567 6174 696e 6720 534e  n-segregating SN
-0001d210: 5073 2070 6f73 6974 696f 6e65 6420 6f6e  Ps positioned on
-0001d220: 2064 6966 6665 7265 6e74 206c 6576 656c   different level
-0001d230: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
-0001d240: 6e64 2063 6f6c 6f75 7265 6420 6279 2073  nd coloured by s
-0001d250: 6974 6520 6669 6c74 6572 2e0a 2020 2020  ite filter..    
-0001d260: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
-0001d270: 2070 6172 616d 6574 6572 733d 6469 6374   parameters=dict
-0001d280: 280a 2020 2020 2020 2020 2020 2020 6d61  (.            ma
-0001d290: 785f 736e 7073 3d22 4d61 7869 6d75 6d20  x_snps="Maximum 
-0001d2a0: 6e75 6d62 6572 206f 6620 534e 5073 2074  number of SNPs t
-0001d2b0: 6f20 7368 6f77 2e22 2c0a 2020 2020 2020  o show.",.      
-0001d2c0: 2020 292c 0a20 2020 2029 0a20 2020 2064    ),.    ).    d
-0001d2d0: 6566 2070 6c6f 745f 736e 7073 5f74 7261  ef plot_snps_tra
-0001d2e0: 636b 280a 2020 2020 2020 2020 7365 6c66  ck(.        self
-0001d2f0: 2c0a 2020 2020 2020 2020 7265 6769 6f6e  ,.        region
-0001d300: 3a20 6261 7365 5f70 6172 616d 732e 7265  : base_params.re
-0001d310: 6769 6f6e 2c0a 2020 2020 2020 2020 7361  gion,.        sa
-0001d320: 6d70 6c65 5f73 6574 733a 204f 7074 696f  mple_sets: Optio
-0001d330: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-0001d340: 7361 6d70 6c65 5f73 6574 735d 203d 204e  sample_sets] = N
-0001d350: 6f6e 652c 0a20 2020 2020 2020 2073 616d  one,.        sam
-0001d360: 706c 655f 7175 6572 793a 204f 7074 696f  ple_query: Optio
-0001d370: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-0001d380: 7361 6d70 6c65 5f71 7565 7279 5d20 3d20  sample_query] = 
-0001d390: 4e6f 6e65 2c0a 2020 2020 2020 2020 7369  None,.        si
-0001d3a0: 7465 5f6d 6173 6b3a 2062 6173 655f 7061  te_mask: base_pa
-0001d3b0: 7261 6d73 2e73 6974 655f 6d61 736b 203d  rams.site_mask =
-0001d3c0: 2044 4546 4155 4c54 2c0a 2020 2020 2020   DEFAULT,.      
-0001d3d0: 2020 636f 686f 7274 5f73 697a 653a 204f    cohort_size: O
-0001d3e0: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-0001d3f0: 616d 732e 636f 686f 7274 5f73 697a 655d  ams.cohort_size]
-0001d400: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001d410: 2073 697a 696e 675f 6d6f 6465 3a20 6770   sizing_mode: gp
-0001d420: 6c74 5f70 6172 616d 732e 7369 7a69 6e67  lt_params.sizing
-0001d430: 5f6d 6f64 6520 3d20 6770 6c74 5f70 6172  _mode = gplt_par
-0001d440: 616d 732e 7369 7a69 6e67 5f6d 6f64 655f  ams.sizing_mode_
-0001d450: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-0001d460: 2077 6964 7468 3a20 6770 6c74 5f70 6172   width: gplt_par
-0001d470: 616d 732e 7769 6474 6820 3d20 6770 6c74  ams.width = gplt
-0001d480: 5f70 6172 616d 732e 7769 6474 685f 6465  _params.width_de
-0001d490: 6661 756c 742c 0a20 2020 2020 2020 2068  fault,.        h
-0001d4a0: 6569 6768 743a 2067 706c 745f 7061 7261  eight: gplt_para
-0001d4b0: 6d73 2e68 6569 6768 7420 3d20 3132 302c  ms.height = 120,
-0001d4c0: 0a20 2020 2020 2020 206d 6178 5f73 6e70  .        max_snp
-0001d4d0: 733a 2069 6e74 203d 2032 3030 5f30 3030  s: int = 200_000
-0001d4e0: 2c0a 2020 2020 2020 2020 785f 7261 6e67  ,.        x_rang
-0001d4f0: 653a 204f 7074 696f 6e61 6c5b 6770 6c74  e: Optional[gplt
-0001d500: 5f70 6172 616d 732e 785f 7261 6e67 655d  _params.x_range]
-0001d510: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001d520: 2073 686f 773a 2067 706c 745f 7061 7261   show: gplt_para
-0001d530: 6d73 2e73 686f 7720 3d20 5472 7565 2c0a  ms.show = True,.
-0001d540: 2020 2020 2920 2d3e 2067 706c 745f 7061      ) -> gplt_pa
-0001d550: 7261 6d73 2e66 6967 7572 653a 0a20 2020  rams.figure:.   
-0001d560: 2020 2020 2064 6562 7567 203d 2073 656c       debug = sel
-0001d570: 662e 5f6c 6f67 2e64 6562 7567 0a0a 2020  f._log.debug..  
-0001d580: 2020 2020 2020 7369 7465 5f6d 6173 6b20        site_mask 
-0001d590: 3d20 7365 6c66 2e5f 7072 6570 5f73 6974  = self._prep_sit
-0001d5a0: 655f 6d61 736b 5f70 6172 616d 2873 6974  e_mask_param(sit
-0001d5b0: 655f 6d61 736b 3d73 6974 655f 6d61 736b  e_mask=site_mask
-0001d5c0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
-0001d5d0: 2822 7265 736f 6c76 6520 616e 6420 6368  ("resolve and ch
-0001d5e0: 6563 6b20 7265 6769 6f6e 2229 0a20 2020  eck region").   
-0001d5f0: 2020 2020 2072 6573 6f6c 7665 645f 7265       resolved_re
-0001d600: 6769 6f6e 203d 2073 656c 662e 7265 736f  gion = self.reso
-0001d610: 6c76 655f 7265 6769 6f6e 2872 6567 696f  lve_region(regio
-0001d620: 6e29 0a20 2020 2020 2020 2064 656c 2072  n).        del r
-0001d630: 6567 696f 6e0a 0a20 2020 2020 2020 2069  egion..        i
-0001d640: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-0001d650: 2872 6573 6f6c 7665 645f 7265 6769 6f6e  (resolved_region
-0001d660: 2e73 7461 7274 2069 7320 4e6f 6e65 290a  .start is None).
-0001d670: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-0001d680: 7265 736f 6c76 6564 5f72 6567 696f 6e2e  resolved_region.
-0001d690: 656e 6420 6973 204e 6f6e 6529 0a20 2020  end is None).   
-0001d6a0: 2020 2020 2020 2020 206f 7220 2828 7265           or ((re
-0001d6b0: 736f 6c76 6564 5f72 6567 696f 6e2e 656e  solved_region.en
-0001d6c0: 6420 2d20 7265 736f 6c76 6564 5f72 6567  d - resolved_reg
-0001d6d0: 696f 6e2e 7374 6172 7429 203e 206d 6178  ion.start) > max
-0001d6e0: 5f73 6e70 7329 0a20 2020 2020 2020 2029  _snps).        )
-0001d6f0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001d700: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-0001d710: 5265 6769 6f6e 2069 7320 746f 6f20 6c61  Region is too la
-0001d720: 7267 652c 2070 6c65 6173 6520 7072 6f76  rge, please prov
-0001d730: 6964 6520 6120 736d 616c 6c65 7220 7265  ide a smaller re
-0001d740: 6769 6f6e 2e22 290a 0a20 2020 2020 2020  gion.")..       
-0001d750: 2064 6562 7567 2822 636f 6d70 7574 6520   debug("compute 
-0001d760: 616c 6c65 6c65 2063 6f75 6e74 7322 290a  allele counts").
-0001d770: 2020 2020 2020 2020 6163 203d 2061 6c6c          ac = all
-0001d780: 656c 2e41 6c6c 656c 6543 6f75 6e74 7341  el.AlleleCountsA
-0001d790: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
-0001d7a0: 2020 7365 6c66 2e73 6e70 5f61 6c6c 656c    self.snp_allel
-0001d7b0: 655f 636f 756e 7473 280a 2020 2020 2020  e_counts(.      
-0001d7c0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-0001d7d0: 3d72 6573 6f6c 7665 645f 7265 6769 6f6e  =resolved_region
-0001d7e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d7f0: 2020 7361 6d70 6c65 5f73 6574 733d 7361    sample_sets=sa
-0001d800: 6d70 6c65 5f73 6574 732c 0a20 2020 2020  mple_sets,.     
-0001d810: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-0001d820: 655f 7175 6572 793d 7361 6d70 6c65 5f71  e_query=sample_q
-0001d830: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
-0001d840: 2020 2020 2020 7369 7465 5f6d 6173 6b3d        site_mask=
-0001d850: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-0001d860: 2020 2020 2020 636f 686f 7274 5f73 697a        cohort_siz
-0001d870: 653d 636f 686f 7274 5f73 697a 652c 0a20  e=cohort_size,. 
-0001d880: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001d890: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-0001d8a0: 6e20 3d20 6163 2e73 756d 2861 7869 733d  n = ac.sum(axis=
-0001d8b0: 3129 0a20 2020 2020 2020 2069 735f 7365  1).        is_se
-0001d8c0: 6720 3d20 6163 2e69 735f 7365 6772 6567  g = ac.is_segreg
-0001d8d0: 6174 696e 6728 290a 2020 2020 2020 2020  ating().        
-0001d8e0: 6973 5f76 6172 203d 2061 632e 6973 5f76  is_var = ac.is_v
-0001d8f0: 6172 6961 6e74 2829 0a20 2020 2020 2020  ariant().       
-0001d900: 2061 6c6c 656c 6973 6d20 3d20 6163 2e61   allelism = ac.a
-0001d910: 6c6c 656c 6973 6d28 290a 0a20 2020 2020  llelism()..     
-0001d920: 2020 2064 6562 7567 2822 6f62 7461 696e     debug("obtain
-0001d930: 2053 4e50 2076 6172 6961 6e74 7320 6461   SNP variants da
-0001d940: 7461 2229 0a20 2020 2020 2020 2064 735f  ta").        ds_
-0001d950: 7369 7465 7320 3d20 7365 6c66 2e73 6e70  sites = self.snp
-0001d960: 5f76 6172 6961 6e74 7328 0a20 2020 2020  _variants(.     
-0001d970: 2020 2020 2020 2072 6567 696f 6e3d 7265         region=re
-0001d980: 736f 6c76 6564 5f72 6567 696f 6e2c 0a20  solved_region,. 
-0001d990: 2020 2020 2020 2029 2e63 6f6d 7075 7465         ).compute
-0001d9a0: 2829 0a0a 2020 2020 2020 2020 6465 6275  ()..        debu
-0001d9b0: 6728 2262 7569 6c64 2061 2064 6174 6166  g("build a dataf
-0001d9c0: 7261 6d65 2229 0a20 2020 2020 2020 2070  rame").        p
-0001d9d0: 6f73 203d 2064 735f 7369 7465 735b 2276  os = ds_sites["v
-0001d9e0: 6172 6961 6e74 5f70 6f73 6974 696f 6e22  ariant_position"
-0001d9f0: 5d2e 7661 6c75 6573 0a20 2020 2020 2020  ].values.       
-0001da00: 2061 6c6c 656c 6573 203d 2064 735f 7369   alleles = ds_si
-0001da10: 7465 735b 2276 6172 6961 6e74 5f61 6c6c  tes["variant_all
-0001da20: 656c 6522 5d2e 7661 6c75 6573 2e61 7374  ele"].values.ast
-0001da30: 7970 6528 2255 2229 0a20 2020 2020 2020  ype("U").       
-0001da40: 2063 6f6c 7320 3d20 7b0a 2020 2020 2020   cols = {.      
-0001da50: 2020 2020 2020 2270 6f73 223a 2070 6f73        "pos": pos
-0001da60: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
-0001da70: 6c6c 656c 655f 3022 3a20 616c 6c65 6c65  llele_0": allele
-0001da80: 735b 3a2c 2030 5d2c 0a20 2020 2020 2020  s[:, 0],.       
-0001da90: 2020 2020 2022 616c 6c65 6c65 5f31 223a       "allele_1":
-0001daa0: 2061 6c6c 656c 6573 5b3a 2c20 315d 2c0a   alleles[:, 1],.
-0001dab0: 2020 2020 2020 2020 2020 2020 2261 6c6c              "all
-0001dac0: 656c 655f 3222 3a20 616c 6c65 6c65 735b  ele_2": alleles[
-0001dad0: 3a2c 2032 5d2c 0a20 2020 2020 2020 2020  :, 2],.         
-0001dae0: 2020 2022 616c 6c65 6c65 5f33 223a 2061     "allele_3": a
-0001daf0: 6c6c 656c 6573 5b3a 2c20 335d 2c0a 2020  lleles[:, 3],.  
-0001db00: 2020 2020 2020 2020 2020 2261 635f 3022            "ac_0"
-0001db10: 3a20 6163 5b3a 2c20 305d 2c0a 2020 2020  : ac[:, 0],.    
-0001db20: 2020 2020 2020 2020 2261 635f 3122 3a20          "ac_1": 
-0001db30: 6163 5b3a 2c20 315d 2c0a 2020 2020 2020  ac[:, 1],.      
-0001db40: 2020 2020 2020 2261 635f 3222 3a20 6163        "ac_2": ac
-0001db50: 5b3a 2c20 325d 2c0a 2020 2020 2020 2020  [:, 2],.        
-0001db60: 2020 2020 2261 635f 3322 3a20 6163 5b3a      "ac_3": ac[:
-0001db70: 2c20 335d 2c0a 2020 2020 2020 2020 2020  , 3],.          
-0001db80: 2020 2261 6e22 3a20 616e 2c0a 2020 2020    "an": an,.    
-0001db90: 2020 2020 2020 2020 2269 735f 7365 6722          "is_seg"
-0001dba0: 3a20 6973 5f73 6567 2c0a 2020 2020 2020  : is_seg,.      
-0001dbb0: 2020 2020 2020 2269 735f 7661 7222 3a20        "is_var": 
-0001dbc0: 6973 5f76 6172 2c0a 2020 2020 2020 2020  is_var,.        
-0001dbd0: 2020 2020 2261 6c6c 656c 6973 6d22 3a20      "allelism": 
-0001dbe0: 616c 6c65 6c69 736d 2c0a 2020 2020 2020  allelism,.      
-0001dbf0: 2020 7d0a 0a20 2020 2020 2020 2066 6f72    }..        for
-0001dc00: 2073 6974 655f 6d61 736b 5f69 6420 696e   site_mask_id in
-0001dc10: 2073 656c 662e 7369 7465 5f6d 6173 6b5f   self.site_mask_
-0001dc20: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
-0001dc30: 2063 6f6c 735b 6622 7061 7373 5f7b 7369   cols[f"pass_{si
-0001dc40: 7465 5f6d 6173 6b5f 6964 7d22 5d20 3d20  te_mask_id}"] = 
-0001dc50: 6473 5f73 6974 6573 5b0a 2020 2020 2020  ds_sites[.      
-0001dc60: 2020 2020 2020 2020 2020 6622 7661 7269            f"vari
-0001dc70: 616e 745f 6669 6c74 6572 5f70 6173 735f  ant_filter_pass_
-0001dc80: 7b73 6974 655f 6d61 736b 5f69 647d 220a  {site_mask_id}".
-0001dc90: 2020 2020 2020 2020 2020 2020 5d2e 7661              ].va
-0001dca0: 6c75 6573 0a0a 2020 2020 2020 2020 6461  lues..        da
-0001dcb0: 7461 203d 2070 642e 4461 7461 4672 616d  ta = pd.DataFram
-0001dcc0: 6528 636f 6c73 290a 0a20 2020 2020 2020  e(cols)..       
-0001dcd0: 2064 6562 7567 2822 6372 6561 7465 2066   debug("create f
-0001dce0: 6967 7572 6522 290a 2020 2020 2020 2020  igure").        
-0001dcf0: 7877 6865 656c 5f7a 6f6f 6d20 3d20 626f  xwheel_zoom = bo
-0001dd00: 6b65 682e 6d6f 6465 6c73 2e57 6865 656c  keh.models.Wheel
-0001dd10: 5a6f 6f6d 546f 6f6c 280a 2020 2020 2020  ZoomTool(.      
-0001dd20: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-0001dd30: 3d22 7769 6474 6822 2c20 6d61 696e 7461  ="width", mainta
-0001dd40: 696e 5f66 6f63 7573 3d46 616c 7365 0a20  in_focus=False. 
-0001dd50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001dd60: 2070 6f73 203d 2064 6174 615b 2270 6f73   pos = data["pos
-0001dd70: 225d 2e76 616c 7565 730a 2020 2020 2020  "].values.      
-0001dd80: 2020 785f 6d69 6e20 3d20 706f 735b 305d    x_min = pos[0]
-0001dd90: 0a20 2020 2020 2020 2078 5f6d 6178 203d  .        x_max =
-0001dda0: 2070 6f73 5b2d 315d 0a20 2020 2020 2020   pos[-1].       
-0001ddb0: 2069 6620 785f 7261 6e67 6520 6973 204e   if x_range is N
-0001ddc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001ddd0: 2078 5f72 616e 6765 203d 2062 6f6b 6568   x_range = bokeh
-0001dde0: 2e6d 6f64 656c 732e 5261 6e67 6531 6428  .models.Range1d(
-0001ddf0: 785f 6d69 6e2c 2078 5f6d 6178 2c20 626f  x_min, x_max, bo
-0001de00: 756e 6473 3d22 6175 746f 2229 0a0a 2020  unds="auto")..  
-0001de10: 2020 2020 2020 746f 6f6c 7469 7073 203d        tooltips =
-0001de20: 205b 0a20 2020 2020 2020 2020 2020 2028   [.            (
-0001de30: 2250 6f73 6974 696f 6e22 2c20 2224 787b  "Position", "$x{
-0001de40: 302c 307d 2229 2c0a 2020 2020 2020 2020  0,0}"),.        
-0001de50: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-0001de60: 2020 2020 2020 2241 6c6c 656c 6573 222c        "Alleles",
-0001de70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001de80: 2022 4061 6c6c 656c 655f 3020 2840 6163   "@allele_0 (@ac
-0001de90: 5f30 292c 2040 616c 6c65 6c65 5f31 2028  _0), @allele_1 (
-0001dea0: 4061 635f 3129 2c20 4061 6c6c 656c 655f  @ac_1), @allele_
-0001deb0: 3220 2840 6163 5f32 292c 2040 616c 6c65  2 (@ac_2), @alle
-0001dec0: 6c65 5f33 2028 4061 635f 3329 222c 0a20  le_3 (@ac_3)",. 
-0001ded0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-0001dee0: 2020 2020 2020 2020 2020 2822 4e6f 2e20            ("No. 
-0001def0: 616c 6c65 6c65 7322 2c20 2240 616c 6c65  alleles", "@alle
-0001df00: 6c69 736d 2229 2c0a 2020 2020 2020 2020  lism"),.        
-0001df10: 2020 2020 2822 416c 6c65 6c65 2063 616c      ("Allele cal
-0001df20: 6c73 222c 2022 4061 6e22 292c 0a20 2020  ls", "@an"),.   
-0001df30: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-0001df40: 666f 7220 7369 7465 5f6d 6173 6b5f 6964  for site_mask_id
-0001df50: 2069 6e20 7365 6c66 2e73 6974 655f 6d61   in self.site_ma
-0001df60: 736b 5f69 6473 3a0a 2020 2020 2020 2020  sk_ids:.        
-0001df70: 2020 2020 746f 6f6c 7469 7073 2e61 7070      tooltips.app
-0001df80: 656e 6428 2866 2250 6173 7320 7b73 6974  end((f"Pass {sit
-0001df90: 655f 6d61 736b 5f69 647d 222c 2066 2240  e_mask_id}", f"@
-0001dfa0: 7061 7373 5f7b 7369 7465 5f6d 6173 6b5f  pass_{site_mask_
-0001dfb0: 6964 7d22 2929 0a0a 2020 2020 2020 2020  id}"))..        
-0001dfc0: 6669 6720 3d20 626f 6b65 682e 706c 6f74  fig = bokeh.plot
-0001dfd0: 7469 6e67 2e66 6967 7572 6528 0a20 2020  ting.figure(.   
-0001dfe0: 2020 2020 2020 2020 2074 6974 6c65 3d22           title="
-0001dff0: 534e 5073 222c 0a20 2020 2020 2020 2020  SNPs",.         
-0001e000: 2020 2074 6f6f 6c73 3d5b 2278 7061 6e22     tools=["xpan"
-0001e010: 2c20 2278 7a6f 6f6d 5f69 6e22 2c20 2278  , "xzoom_in", "x
-0001e020: 7a6f 6f6d 5f6f 7574 222c 2078 7768 6565  zoom_out", xwhee
-0001e030: 6c5f 7a6f 6f6d 2c20 2272 6573 6574 225d  l_zoom, "reset"]
-0001e040: 2c0a 2020 2020 2020 2020 2020 2020 6163  ,.            ac
-0001e050: 7469 7665 5f73 6372 6f6c 6c3d 7877 6865  tive_scroll=xwhe
-0001e060: 656c 5f7a 6f6f 6d2c 0a20 2020 2020 2020  el_zoom,.       
-0001e070: 2020 2020 2061 6374 6976 655f 6472 6167       active_drag
-0001e080: 3d22 7870 616e 222c 0a20 2020 2020 2020  ="xpan",.       
-0001e090: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
-0001e0a0: 3d73 697a 696e 675f 6d6f 6465 2c0a 2020  =sizing_mode,.  
-0001e0b0: 2020 2020 2020 2020 2020 7769 6474 683d            width=
-0001e0c0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0001e0d0: 2020 2068 6569 6768 743d 6865 6967 6874     height=height
-0001e0e0: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
-0001e0f0: 6f6c 6261 725f 6c6f 6361 7469 6f6e 3d22  olbar_location="
-0001e100: 6162 6f76 6522 2c0a 2020 2020 2020 2020  above",.        
-0001e110: 2020 2020 785f 7261 6e67 653d 785f 7261      x_range=x_ra
-0001e120: 6e67 652c 0a20 2020 2020 2020 2020 2020  nge,.           
-0001e130: 2079 5f72 616e 6765 3d28 302e 352c 2032   y_range=(0.5, 2
-0001e140: 2e35 292c 0a20 2020 2020 2020 2020 2020  .5),.           
-0001e150: 2074 6f6f 6c74 6970 733d 746f 6f6c 7469   tooltips=toolti
-0001e160: 7073 2c0a 2020 2020 2020 2020 290a 2020  ps,.        ).  
-0001e170: 2020 2020 2020 686f 7665 725f 746f 6f6c        hover_tool
-0001e180: 203d 2066 6967 2e73 656c 6563 7428 7479   = fig.select(ty
-0001e190: 7065 3d62 6f6b 6568 2e6d 6f64 656c 732e  pe=bokeh.models.
-0001e1a0: 486f 7665 7254 6f6f 6c29 0a20 2020 2020  HoverTool).     
-0001e1b0: 2020 2068 6f76 6572 5f74 6f6f 6c2e 6e61     hover_tool.na
-0001e1c0: 6d65 7320 3d20 5b22 736e 7073 225d 0a0a  mes = ["snps"]..
-0001e1d0: 2020 2020 2020 2020 6465 6275 6728 2270          debug("p
-0001e1e0: 6c6f 7420 6761 7073 2069 6e20 7468 6520  lot gaps in the 
-0001e1f0: 7265 6665 7265 6e63 6520 6765 6e6f 6d65  reference genome
-0001e200: 2229 0a20 2020 2020 2020 2073 6571 203d  ").        seq =
-0001e210: 2073 656c 662e 6765 6e6f 6d65 5f73 6571   self.genome_seq
-0001e220: 7565 6e63 6528 7265 6769 6f6e 3d72 6573  uence(region=res
-0001e230: 6f6c 7665 645f 7265 6769 6f6e 2e63 6f6e  olved_region.con
-0001e240: 7469 6729 2e63 6f6d 7075 7465 2829 0a20  tig).compute(). 
-0001e250: 2020 2020 2020 2069 735f 6e20 3d20 2873         is_n = (s
-0001e260: 6571 203d 3d20 6222 4e22 2920 7c20 2873  eq == b"N") | (s
-0001e270: 6571 203d 3d20 6222 6e22 290a 2020 2020  eq == b"n").    
-0001e280: 2020 2020 6c6f 635f 6e5f 7374 6172 7420      loc_n_start 
-0001e290: 3d20 7e69 735f 6e5b 3a2d 315d 2026 2069  = ~is_n[:-1] & i
-0001e2a0: 735f 6e5b 313a 5d0a 2020 2020 2020 2020  s_n[1:].        
-0001e2b0: 6c6f 635f 6e5f 7374 6f70 203d 2069 735f  loc_n_stop = is_
-0001e2c0: 6e5b 3a2d 315d 2026 207e 6973 5f6e 5b31  n[:-1] & ~is_n[1
-0001e2d0: 3a5d 0a20 2020 2020 2020 206e 5f73 7461  :].        n_sta
-0001e2e0: 7274 7320 3d20 6e70 2e6e 6f6e 7a65 726f  rts = np.nonzero
-0001e2f0: 286c 6f63 5f6e 5f73 7461 7274 295b 305d  (loc_n_start)[0]
-0001e300: 0a20 2020 2020 2020 206e 5f73 746f 7073  .        n_stops
-0001e310: 203d 206e 702e 6e6f 6e7a 6572 6f28 6c6f   = np.nonzero(lo
-0001e320: 635f 6e5f 7374 6f70 295b 305d 0a20 2020  c_n_stop)[0].   
-0001e330: 2020 2020 2064 665f 6e5f 7275 6e73 203d       df_n_runs =
-0001e340: 2070 642e 4461 7461 4672 616d 6528 0a20   pd.DataFrame(. 
-0001e350: 2020 2020 2020 2020 2020 207b 226c 6566             {"lef
-0001e360: 7422 3a20 6e5f 7374 6172 7473 202b 2031  t": n_starts + 1
-0001e370: 2e36 2c20 2272 6967 6874 223a 206e 5f73  .6, "right": n_s
-0001e380: 746f 7073 202b 2031 2e34 2c20 2274 6f70  tops + 1.4, "top
-0001e390: 223a 2032 2e35 2c20 2262 6f74 746f 6d22  ": 2.5, "bottom"
-0001e3a0: 3a20 302e 357d 0a20 2020 2020 2020 2029  : 0.5}.        )
-0001e3b0: 0a20 2020 2020 2020 2066 6967 2e71 7561  .        fig.qua
-0001e3c0: 6428 0a20 2020 2020 2020 2020 2020 2074  d(.            t
-0001e3d0: 6f70 3d22 746f 7022 2c0a 2020 2020 2020  op="top",.      
-0001e3e0: 2020 2020 2020 626f 7474 6f6d 3d22 626f        bottom="bo
-0001e3f0: 7474 6f6d 222c 0a20 2020 2020 2020 2020  ttom",.         
-0001e400: 2020 206c 6566 743d 226c 6566 7422 2c0a     left="left",.
-0001e410: 2020 2020 2020 2020 2020 2020 7269 6768              righ
-0001e420: 743d 2272 6967 6874 222c 0a20 2020 2020  t="right",.     
-0001e430: 2020 2020 2020 2063 6f6c 6f72 3d22 2363         color="#c
-0001e440: 6363 6363 6322 2c0a 2020 2020 2020 2020  ccccc",.        
-0001e450: 2020 2020 736f 7572 6365 3d64 665f 6e5f      source=df_n_
-0001e460: 7275 6e73 2c0a 2020 2020 2020 2020 2020  runs,.          
-0001e470: 2020 6e61 6d65 3d22 6761 7073 222c 0a20    name="gaps",. 
-0001e480: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0001e490: 2020 6465 6275 6728 2270 6c6f 7420 534e    debug("plot SN
-0001e4a0: 5073 2229 0a20 2020 2020 2020 2063 6f6c  Ps").        col
-0001e4b0: 6f72 5f70 6173 7320 3d20 626f 6b65 682e  or_pass = bokeh.
-0001e4c0: 7061 6c65 7474 6573 2e43 6f6c 6f72 626c  palettes.Colorbl
-0001e4d0: 696e 6436 5b33 5d0a 2020 2020 2020 2020  ind6[3].        
-0001e4e0: 636f 6c6f 725f 6661 696c 203d 2062 6f6b  color_fail = bok
-0001e4f0: 6568 2e70 616c 6574 7465 732e 436f 6c6f  eh.palettes.Colo
-0001e500: 7262 6c69 6e64 365b 355d 0a20 2020 2020  rblind6[5].     
-0001e510: 2020 2064 6174 615b 226c 6566 7422 5d20     data["left"] 
-0001e520: 3d20 6461 7461 5b22 706f 7322 5d20 2d20  = data["pos"] - 
-0001e530: 302e 340a 2020 2020 2020 2020 6461 7461  0.4.        data
-0001e540: 5b22 7269 6768 7422 5d20 3d20 6461 7461  ["right"] = data
-0001e550: 5b22 706f 7322 5d20 2b20 302e 340a 2020  ["pos"] + 0.4.  
-0001e560: 2020 2020 2020 6461 7461 5b22 626f 7474        data["bott
-0001e570: 6f6d 225d 203d 206e 702e 7768 6572 6528  om"] = np.where(
-0001e580: 6461 7461 5b22 6973 5f73 6567 225d 2c20  data["is_seg"], 
-0001e590: 312e 362c 2030 2e36 290a 2020 2020 2020  1.6, 0.6).      
-0001e5a0: 2020 6461 7461 5b22 746f 7022 5d20 3d20    data["top"] = 
-0001e5b0: 6461 7461 5b22 626f 7474 6f6d 225d 202b  data["bottom"] +
-0001e5c0: 2030 2e38 0a20 2020 2020 2020 2064 6174   0.8.        dat
-0001e5d0: 615b 2263 6f6c 6f72 225d 203d 206e 702e  a["color"] = np.
-0001e5e0: 7768 6572 6528 6461 7461 5b66 2270 6173  where(data[f"pas
-0001e5f0: 735f 7b73 6974 655f 6d61 736b 7d22 5d2c  s_{site_mask}"],
-0001e600: 2063 6f6c 6f72 5f70 6173 732c 2063 6f6c   color_pass, col
-0001e610: 6f72 5f66 6169 6c29 0a20 2020 2020 2020  or_fail).       
-0001e620: 2066 6967 2e71 7561 6428 0a20 2020 2020   fig.quad(.     
-0001e630: 2020 2020 2020 2074 6f70 3d22 746f 7022         top="top"
-0001e640: 2c0a 2020 2020 2020 2020 2020 2020 626f  ,.            bo
-0001e650: 7474 6f6d 3d22 626f 7474 6f6d 222c 0a20  ttom="bottom",. 
-0001e660: 2020 2020 2020 2020 2020 206c 6566 743d             left=
-0001e670: 226c 6566 7422 2c0a 2020 2020 2020 2020  "left",.        
-0001e680: 2020 2020 7269 6768 743d 2272 6967 6874      right="right
-0001e690: 222c 0a20 2020 2020 2020 2020 2020 2063  ",.            c
-0001e6a0: 6f6c 6f72 3d22 636f 6c6f 7222 2c0a 2020  olor="color",.  
-0001e6b0: 2020 2020 2020 2020 2020 736f 7572 6365            source
-0001e6c0: 3d64 6174 612c 0a20 2020 2020 2020 2020  =data,.         
-0001e6d0: 2020 206e 616d 653d 2273 6e70 7322 2c0a     name="snps",.
-0001e6e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001e6f0: 2020 2064 6562 7567 2822 7469 6479 2070     debug("tidy p
-0001e700: 6c6f 7422 290a 2020 2020 2020 2020 6669  lot").        fi
-0001e710: 672e 7961 7869 732e 7469 636b 6572 203d  g.yaxis.ticker =
-0001e720: 2062 6f6b 6568 2e6d 6f64 656c 732e 4669   bokeh.models.Fi
-0001e730: 7865 6454 6963 6b65 7228 0a20 2020 2020  xedTicker(.     
-0001e740: 2020 2020 2020 2074 6963 6b73 3d5b 312c         ticks=[1,
-0001e750: 2032 5d2c 0a20 2020 2020 2020 2029 0a20   2],.        ). 
-0001e760: 2020 2020 2020 2066 6967 2e79 6178 6973         fig.yaxis
-0001e770: 2e6d 616a 6f72 5f6c 6162 656c 5f6f 7665  .major_label_ove
-0001e780: 7272 6964 6573 203d 207b 0a20 2020 2020  rrides = {.     
-0001e790: 2020 2020 2020 2031 3a20 224e 6f6e 2d73         1: "Non-s
-0001e7a0: 6567 7265 6761 7469 6e67 222c 0a20 2020  egregating",.   
-0001e7b0: 2020 2020 2020 2020 2032 3a20 2253 6567           2: "Seg
-0001e7c0: 7265 6761 7469 6e67 222c 0a20 2020 2020  regating",.     
-0001e7d0: 2020 207d 0a20 2020 2020 2020 2066 6967     }.        fig
-0001e7e0: 2e78 6178 6973 2e61 7869 735f 6c61 6265  .xaxis.axis_labe
-0001e7f0: 6c20 3d20 6622 436f 6e74 6967 207b 7265  l = f"Contig {re
-0001e800: 736f 6c76 6564 5f72 6567 696f 6e2e 636f  solved_region.co
-0001e810: 6e74 6967 7d20 706f 7369 7469 6f6e 2028  ntig} position (
-0001e820: 6270 2922 0a20 2020 2020 2020 2066 6967  bp)".        fig
-0001e830: 2e78 6178 6973 2e74 6963 6b65 7220 3d20  .xaxis.ticker = 
-0001e840: 626f 6b65 682e 6d6f 6465 6c73 2e41 6461  bokeh.models.Ada
-0001e850: 7074 6976 6554 6963 6b65 7228 6d69 6e5f  ptiveTicker(min_
-0001e860: 696e 7465 7276 616c 3d31 290a 2020 2020  interval=1).    
-0001e870: 2020 2020 6669 672e 7861 7869 732e 6d69      fig.xaxis.mi
-0001e880: 6e6f 725f 7469 636b 5f6c 696e 655f 636f  nor_tick_line_co
-0001e890: 6c6f 7220 3d20 4e6f 6e65 0a20 2020 2020  lor = None.     
-0001e8a0: 2020 2066 6967 2e78 6178 6973 5b30 5d2e     fig.xaxis[0].
-0001e8b0: 666f 726d 6174 7465 7220 3d20 626f 6b65  formatter = boke
-0001e8c0: 682e 6d6f 6465 6c73 2e4e 756d 6572 616c  h.models.Numeral
-0001e8d0: 5469 636b 466f 726d 6174 7465 7228 666f  TickFormatter(fo
-0001e8e0: 726d 6174 3d22 302c 3022 290a 0a20 2020  rmat="0,0")..   
-0001e8f0: 2020 2020 2069 6620 7368 6f77 3a0a 2020       if show:.  
-0001e900: 2020 2020 2020 2020 2020 626f 6b65 682e            bokeh.
-0001e910: 706c 6f74 7469 6e67 2e73 686f 7728 6669  plotting.show(fi
-0001e920: 6729 0a0a 2020 2020 2020 2020 7265 7475  g)..        retu
-0001e930: 726e 2066 6967 0a0a 2020 2020 4064 6f63  rn fig..    @doc
-0001e940: 280a 2020 2020 2020 2020 7375 6d6d 6172  (.        summar
-0001e950: 793d 2222 220a 2020 2020 2020 2020 2020  y=""".          
-0001e960: 2020 436f 6d70 7574 6520 534e 5020 616c    Compute SNP al
-0001e970: 6c65 6c65 2066 7265 7175 656e 6369 6573  lele frequencies
-0001e980: 2066 6f72 2061 2067 656e 6520 7472 616e   for a gene tran
-0001e990: 7363 7269 7074 2e0a 2020 2020 2020 2020  script..        
-0001e9a0: 2222 222c 0a20 2020 2020 2020 2072 6574  """,.        ret
-0001e9b0: 7572 6e73 3d22 2222 0a20 2020 2020 2020  urns=""".       
-0001e9c0: 2020 2020 2041 2064 6174 6166 7261 6d65       A dataframe
-0001e9d0: 206f 6620 534e 5020 616c 6c65 6c65 2066   of SNP allele f
-0001e9e0: 7265 7175 656e 6369 6573 2c20 6f6e 6520  requencies, one 
-0001e9f0: 726f 7720 7065 7220 7661 7269 616e 7420  row per variant 
-0001ea00: 616c 6c65 6c65 2e0a 2020 2020 2020 2020  allele..        
-0001ea10: 2222 222c 0a20 2020 2020 2020 206e 6f74  """,.        not
-0001ea20: 6573 3d22 2222 0a20 2020 2020 2020 2020  es=""".         
-0001ea30: 2020 2043 6f68 6f72 7473 2077 6974 6820     Cohorts with 
-0001ea40: 6665 7765 7220 7361 6d70 6c65 7320 7468  fewer samples th
-0001ea50: 616e 2060 6d69 6e5f 636f 686f 7274 5f73  an `min_cohort_s
-0001ea60: 697a 6560 2077 696c 6c20 6265 2065 7863  ize` will be exc
-0001ea70: 6c75 6465 6420 6672 6f6d 0a20 2020 2020  luded from.     
-0001ea80: 2020 2020 2020 206f 7574 7075 7420 6461         output da
-0001ea90: 7461 2066 7261 6d65 2e0a 2020 2020 2020  ta frame..      
-0001eaa0: 2020 2222 222c 0a20 2020 2029 0a20 2020    """,.    ).   
-0001eab0: 2064 6566 2073 6e70 5f61 6c6c 656c 655f   def snp_allele_
-0001eac0: 6672 6571 7565 6e63 6965 7328 0a20 2020  frequencies(.   
-0001ead0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0001eae0: 2020 2074 7261 6e73 6372 6970 743a 2062     transcript: b
-0001eaf0: 6173 655f 7061 7261 6d73 2e74 7261 6e73  ase_params.trans
-0001eb00: 6372 6970 742c 0a20 2020 2020 2020 2063  cript,.        c
-0001eb10: 6f68 6f72 7473 3a20 6261 7365 5f70 6172  ohorts: base_par
-0001eb20: 616d 732e 636f 686f 7274 732c 0a20 2020  ams.cohorts,.   
-0001eb30: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
-0001eb40: 793a 204f 7074 696f 6e61 6c5b 6261 7365  y: Optional[base
-0001eb50: 5f70 6172 616d 732e 7361 6d70 6c65 5f71  _params.sample_q
-0001eb60: 7565 7279 5d20 3d20 4e6f 6e65 2c0a 2020  uery] = None,.  
-0001eb70: 2020 2020 2020 6d69 6e5f 636f 686f 7274        min_cohort
-0001eb80: 5f73 697a 653a 2062 6173 655f 7061 7261  _size: base_para
-0001eb90: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
-0001eba0: 7a65 203d 2031 302c 0a20 2020 2020 2020  ze = 10,.       
-0001ebb0: 2073 6974 655f 6d61 736b 3a20 4f70 7469   site_mask: Opti
-0001ebc0: 6f6e 616c 5b62 6173 655f 7061 7261 6d73  onal[base_params
-0001ebd0: 2e73 6974 655f 6d61 736b 5d20 3d20 4e6f  .site_mask] = No
-0001ebe0: 6e65 2c0a 2020 2020 2020 2020 7361 6d70  ne,.        samp
-0001ebf0: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
-0001ec00: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-0001ec10: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
-0001ec20: 652c 0a20 2020 2020 2020 2064 726f 705f  e,.        drop_
-0001ec30: 696e 7661 7269 616e 743a 2066 7271 5f70  invariant: frq_p
-0001ec40: 6172 616d 732e 6472 6f70 5f69 6e76 6172  arams.drop_invar
-0001ec50: 6961 6e74 203d 2054 7275 652c 0a20 2020  iant = True,.   
-0001ec60: 2020 2020 2065 6666 6563 7473 3a20 6672       effects: fr
-0001ec70: 715f 7061 7261 6d73 2e65 6666 6563 7473  q_params.effects
-0001ec80: 203d 2054 7275 652c 0a20 2020 2029 202d   = True,.    ) -
-0001ec90: 3e20 7064 2e44 6174 6146 7261 6d65 3a0a  > pd.DataFrame:.
-0001eca0: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-0001ecb0: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-0001ecc0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-0001ecd0: 6368 6563 6b20 7061 7261 6d65 7465 7273  check parameters
-0001ece0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-0001ecf0: 5f63 6865 636b 5f70 6172 616d 5f6d 696e  _check_param_min
-0001ed00: 5f63 6f68 6f72 745f 7369 7a65 286d 696e  _cohort_size(min
-0001ed10: 5f63 6f68 6f72 745f 7369 7a65 290a 0a20  _cohort_size).. 
-0001ed20: 2020 2020 2020 2064 6562 7567 2822 6163         debug("ac
-0001ed30: 6365 7373 2073 616d 706c 6520 6d65 7461  cess sample meta
-0001ed40: 6461 7461 2229 0a20 2020 2020 2020 2064  data").        d
-0001ed50: 665f 7361 6d70 6c65 7320 3d20 7365 6c66  f_samples = self
-0001ed60: 2e73 616d 706c 655f 6d65 7461 6461 7461  .sample_metadata
-0001ed70: 280a 2020 2020 2020 2020 2020 2020 7361  (.            sa
-0001ed80: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
-0001ed90: 5f73 6574 732c 2073 616d 706c 655f 7175  _sets, sample_qu
-0001eda0: 6572 793d 7361 6d70 6c65 5f71 7565 7279  ery=sample_query
-0001edb0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001edc0: 2020 2020 6465 6275 6728 2273 6574 7570      debug("setup
-0001edd0: 2069 6e69 7469 616c 2064 6174 6166 7261   initial datafra
-0001ede0: 6d65 206f 6620 534e 5073 2229 0a20 2020  me of SNPs").   
-0001edf0: 2020 2020 2072 6567 696f 6e2c 2064 665f       region, df_
-0001ee00: 736e 7073 203d 2073 656c 662e 5f73 6e70  snps = self._snp
-0001ee10: 5f64 6628 7472 616e 7363 7269 7074 3d74  _df(transcript=t
-0001ee20: 7261 6e73 6372 6970 7429 0a0a 2020 2020  ranscript)..    
-0001ee30: 2020 2020 6465 6275 6728 2267 6574 2067      debug("get g
-0001ee40: 656e 6f74 7970 6573 2229 0a20 2020 2020  enotypes").     
-0001ee50: 2020 2067 7420 3d20 7365 6c66 2e73 6e70     gt = self.snp
-0001ee60: 5f67 656e 6f74 7970 6573 280a 2020 2020  _genotypes(.    
-0001ee70: 2020 2020 2020 2020 7265 6769 6f6e 3d72          region=r
-0001ee80: 6567 696f 6e2c 0a20 2020 2020 2020 2020  egion,.         
-0001ee90: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-0001eea0: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
-0001eeb0: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
-0001eec0: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
-0001eed0: 792c 0a20 2020 2020 2020 2020 2020 2066  y,.            f
-0001eee0: 6965 6c64 3d22 4754 222c 0a20 2020 2020  ield="GT",.     
-0001eef0: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-0001ef00: 6275 6728 2273 6c69 6365 2074 6f20 6665  bug("slice to fe
-0001ef10: 6174 7572 6520 6c6f 6361 7469 6f6e 2229  ature location")
-0001ef20: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-0001ef30: 6c66 2e5f 6461 736b 5f70 726f 6772 6573  lf._dask_progres
-0001ef40: 7328 6465 7363 3d22 4c6f 6164 2053 4e50  s(desc="Load SNP
-0001ef50: 2067 656e 6f74 7970 6573 2229 3a0a 2020   genotypes"):.  
-0001ef60: 2020 2020 2020 2020 2020 6774 203d 2067            gt = g
-0001ef70: 742e 636f 6d70 7574 6528 290a 0a20 2020  t.compute()..   
-0001ef80: 2020 2020 2064 6562 7567 2822 6275 696c       debug("buil
-0001ef90: 6420 636f 6820 6469 6374 2229 0a20 2020  d coh dict").   
-0001efa0: 2020 2020 2063 6f68 5f64 6963 7420 3d20       coh_dict = 
-0001efb0: 7365 6c66 2e5f 6c6f 6361 7465 5f63 6f68  self._locate_coh
-0001efc0: 6f72 7473 2863 6f68 6f72 7473 3d63 6f68  orts(cohorts=coh
-0001efd0: 6f72 7473 2c20 6466 5f73 616d 706c 6573  orts, df_samples
-0001efe0: 3d64 665f 7361 6d70 6c65 7329 0a0a 2020  =df_samples)..  
-0001eff0: 2020 2020 2020 6465 6275 6728 2263 6f75        debug("cou
-0001f000: 6e74 2061 6c6c 656c 6573 2229 0a20 2020  nt alleles").   
-0001f010: 2020 2020 2066 7265 715f 636f 6c73 203d       freq_cols =
-0001f020: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-0001f030: 636f 686f 7274 735f 6974 6572 6174 6f72  cohorts_iterator
-0001f040: 203d 2073 656c 662e 5f70 726f 6772 6573   = self._progres
-0001f050: 7328 0a20 2020 2020 2020 2020 2020 2063  s(.            c
-0001f060: 6f68 5f64 6963 742e 6974 656d 7328 292c  oh_dict.items(),
-0001f070: 2064 6573 633d 2243 6f6d 7075 7465 2061   desc="Compute a
-0001f080: 6c6c 656c 6520 6672 6571 7565 6e63 6965  llele frequencie
-0001f090: 7322 0a20 2020 2020 2020 2029 0a20 2020  s".        ).   
-0001f0a0: 2020 2020 2066 6f72 2063 6f68 2c20 6c6f       for coh, lo
-0001f0b0: 635f 636f 6820 696e 2063 6f68 6f72 7473  c_coh in cohorts
-0001f0c0: 5f69 7465 7261 746f 723a 0a20 2020 2020  _iterator:.     
-0001f0d0: 2020 2020 2020 206e 5f73 616d 706c 6573         n_samples
-0001f0e0: 203d 206e 702e 636f 756e 745f 6e6f 6e7a   = np.count_nonz
-0001f0f0: 6572 6f28 6c6f 635f 636f 6829 0a20 2020  ero(loc_coh).   
-0001f100: 2020 2020 2020 2020 2064 6562 7567 2866           debug(f
-0001f110: 227b 636f 687d 2c20 7b6e 5f73 616d 706c  "{coh}, {n_sampl
-0001f120: 6573 7d20 7361 6d70 6c65 7322 290a 2020  es} samples").  
-0001f130: 2020 2020 2020 2020 2020 6966 206e 5f73            if n_s
-0001f140: 616d 706c 6573 203e 3d20 6d69 6e5f 636f  amples >= min_co
-0001f150: 686f 7274 5f73 697a 653a 0a20 2020 2020  hort_size:.     
-0001f160: 2020 2020 2020 2020 2020 2067 745f 636f             gt_co
-0001f170: 6820 3d20 6e70 2e63 6f6d 7072 6573 7328  h = np.compress(
-0001f180: 6c6f 635f 636f 682c 2067 742c 2061 7869  loc_coh, gt, axi
-0001f190: 733d 3129 0a20 2020 2020 2020 2020 2020  s=1).           
-0001f1a0: 2020 2020 2061 635f 636f 6820 3d20 616c       ac_coh = al
-0001f1b0: 6c65 6c2e 4765 6e6f 7479 7065 4172 7261  lel.GenotypeArra
-0001f1c0: 7928 6774 5f63 6f68 292e 636f 756e 745f  y(gt_coh).count_
-0001f1d0: 616c 6c65 6c65 7328 6d61 785f 616c 6c65  alleles(max_alle
-0001f1e0: 6c65 3d33 290a 2020 2020 2020 2020 2020  le=3).          
-0001f1f0: 2020 2020 2020 6166 5f63 6f68 203d 2061        af_coh = a
-0001f200: 635f 636f 682e 746f 5f66 7265 7175 656e  c_coh.to_frequen
-0001f210: 6369 6573 2829 0a20 2020 2020 2020 2020  cies().         
-0001f220: 2020 2020 2020 2066 7265 715f 636f 6c73         freq_cols
-0001f230: 5b22 6672 715f 2220 2b20 636f 685d 203d  ["frq_" + coh] =
-0001f240: 2061 665f 636f 685b 3a2c 2031 3a5d 2e66   af_coh[:, 1:].f
-0001f250: 6c61 7474 656e 2829 0a0a 2020 2020 2020  latten()..      
-0001f260: 2020 6465 6275 6728 2262 7569 6c64 2061    debug("build a
-0001f270: 2064 6174 6166 7261 6d65 2077 6974 6820   dataframe with 
-0001f280: 7468 6520 6672 6571 7565 6e63 7920 636f  the frequency co
-0001f290: 6c75 6d6e 7322 290a 2020 2020 2020 2020  lumns").        
-0001f2a0: 6466 5f66 7265 7173 203d 2070 642e 4461  df_freqs = pd.Da
-0001f2b0: 7461 4672 616d 6528 6672 6571 5f63 6f6c  taFrame(freq_col
-0001f2c0: 7329 0a0a 2020 2020 2020 2020 6465 6275  s)..        debu
-0001f2d0: 6728 2263 6f6d 7075 7465 206d 6178 5f61  g("compute max_a
-0001f2e0: 6622 290a 2020 2020 2020 2020 6466 5f6d  f").        df_m
-0001f2f0: 6178 5f61 6620 3d20 7064 2e44 6174 6146  ax_af = pd.DataF
-0001f300: 7261 6d65 287b 226d 6178 5f61 6622 3a20  rame({"max_af": 
-0001f310: 6466 5f66 7265 7173 2e6d 6178 2861 7869  df_freqs.max(axi
-0001f320: 733d 3129 7d29 0a0a 2020 2020 2020 2020  s=1)})..        
-0001f330: 6465 6275 6728 2262 7569 6c64 2074 6865  debug("build the
-0001f340: 2066 696e 616c 2064 6174 6166 7261 6d65   final dataframe
-0001f350: 2229 0a20 2020 2020 2020 2064 665f 736e  ").        df_sn
-0001f360: 7073 2e72 6573 6574 5f69 6e64 6578 2864  ps.reset_index(d
-0001f370: 726f 703d 5472 7565 2c20 696e 706c 6163  rop=True, inplac
-0001f380: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-0001f390: 6466 5f73 6e70 7320 3d20 7064 2e63 6f6e  df_snps = pd.con
-0001f3a0: 6361 7428 5b64 665f 736e 7073 2c20 6466  cat([df_snps, df
-0001f3b0: 5f66 7265 7173 2c20 6466 5f6d 6178 5f61  _freqs, df_max_a
-0001f3c0: 665d 2c20 6178 6973 3d31 290a 0a20 2020  f], axis=1)..   
-0001f3d0: 2020 2020 2064 6562 7567 2822 6170 706c       debug("appl
-0001f3e0: 7920 7369 7465 206d 6173 6b20 6966 2072  y site mask if r
-0001f3f0: 6571 7565 7374 6564 2229 0a20 2020 2020  equested").     
-0001f400: 2020 2069 6620 7369 7465 5f6d 6173 6b20     if site_mask 
-0001f410: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0001f420: 2020 2020 2020 2020 206c 6f63 5f73 6974           loc_sit
-0001f430: 6573 203d 2064 665f 736e 7073 5b66 2270  es = df_snps[f"p
-0001f440: 6173 735f 7b73 6974 655f 6d61 736b 7d22  ass_{site_mask}"
-0001f450: 5d0a 2020 2020 2020 2020 2020 2020 6466  ].            df
-0001f460: 5f73 6e70 7320 3d20 6466 5f73 6e70 732e  _snps = df_snps.
-0001f470: 6c6f 635b 6c6f 635f 7369 7465 735d 0a0a  loc[loc_sites]..
-0001f480: 2020 2020 2020 2020 6465 6275 6728 2264          debug("d
-0001f490: 726f 7020 696e 7661 7269 616e 7473 2229  rop invariants")
-0001f4a0: 0a20 2020 2020 2020 2069 6620 6472 6f70  .        if drop
-0001f4b0: 5f69 6e76 6172 6961 6e74 3a0a 2020 2020  _invariant:.    
-0001f4c0: 2020 2020 2020 2020 6c6f 635f 7661 7269          loc_vari
-0001f4d0: 616e 7420 3d20 6466 5f73 6e70 735b 226d  ant = df_snps["m
-0001f4e0: 6178 5f61 6622 5d20 3e20 300a 2020 2020  ax_af"] > 0.    
-0001f4f0: 2020 2020 2020 2020 6466 5f73 6e70 7320          df_snps 
-0001f500: 3d20 6466 5f73 6e70 732e 6c6f 635b 6c6f  = df_snps.loc[lo
-0001f510: 635f 7661 7269 616e 745d 0a0a 2020 2020  c_variant]..    
-0001f520: 2020 2020 6465 6275 6728 2272 6573 6574      debug("reset
-0001f530: 2069 6e64 6578 2061 6674 6572 2066 696c   index after fil
-0001f540: 7465 7269 6e67 2229 0a20 2020 2020 2020  tering").       
-0001f550: 2064 665f 736e 7073 2e72 6573 6574 5f69   df_snps.reset_i
-0001f560: 6e64 6578 2869 6e70 6c61 6365 3d54 7275  ndex(inplace=Tru
-0001f570: 652c 2064 726f 703d 5472 7565 290a 0a20  e, drop=True).. 
-0001f580: 2020 2020 2020 2069 6620 6566 6665 6374         if effect
-0001f590: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
-0001f5a0: 6562 7567 2822 6164 6420 6566 6665 6374  ebug("add effect
-0001f5b0: 2061 6e6e 6f74 6174 696f 6e73 2229 0a20   annotations"). 
-0001f5c0: 2020 2020 2020 2020 2020 2061 6e6e 203d             ann =
-0001f5d0: 2073 656c 662e 5f61 6e6e 6f74 6174 6f72   self._annotator
-0001f5e0: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
-0001f5f0: 6e6e 2e67 6574 5f65 6666 6563 7473 280a  nn.get_effects(.
-0001f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f610: 7472 616e 7363 7269 7074 3d74 7261 6e73  transcript=trans
-0001f620: 6372 6970 742c 2076 6172 6961 6e74 733d  cript, variants=
-0001f630: 6466 5f73 6e70 732c 2070 726f 6772 6573  df_snps, progres
-0001f640: 733d 7365 6c66 2e5f 7072 6f67 7265 7373  s=self._progress
-0001f650: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0001f660: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-0001f670: 6728 2261 6464 206c 6162 656c 2229 0a20  g("add label"). 
-0001f680: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
-0001f690: 7073 5b22 6c61 6265 6c22 5d20 3d20 7365  ps["label"] = se
-0001f6a0: 6c66 2e5f 7061 6e64 6173 5f61 7070 6c79  lf._pandas_apply
-0001f6b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f6c0: 2020 7365 6c66 2e5f 6d61 6b65 5f73 6e70    self._make_snp
-0001f6d0: 5f6c 6162 656c 5f65 6666 6563 742c 0a20  _label_effect,. 
-0001f6e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001f6f0: 665f 736e 7073 2c0a 2020 2020 2020 2020  f_snps,.        
-0001f700: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-0001f710: 5b22 636f 6e74 6967 222c 2022 706f 7369  ["contig", "posi
-0001f720: 7469 6f6e 222c 2022 7265 665f 616c 6c65  tion", "ref_alle
-0001f730: 6c65 222c 2022 616c 745f 616c 6c65 6c65  le", "alt_allele
-0001f740: 222c 2022 6161 5f63 6861 6e67 6522 5d2c  ", "aa_change"],
-0001f750: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0001f760: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-0001f770: 6728 2273 6574 2069 6e64 6578 2229 0a20  g("set index"). 
-0001f780: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
-0001f790: 7073 2e73 6574 5f69 6e64 6578 280a 2020  ps.set_index(.  
-0001f7a0: 2020 2020 2020 2020 2020 2020 2020 5b22                ["
-0001f7b0: 636f 6e74 6967 222c 2022 706f 7369 7469  contig", "positi
-0001f7c0: 6f6e 222c 2022 7265 665f 616c 6c65 6c65  on", "ref_allele
-0001f7d0: 222c 2022 616c 745f 616c 6c65 6c65 222c  ", "alt_allele",
-0001f7e0: 2022 6161 5f63 6861 6e67 6522 5d2c 0a20   "aa_change"],. 
-0001f7f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001f800: 6e70 6c61 6365 3d54 7275 652c 0a20 2020  nplace=True,.   
-0001f810: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001f820: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001f830: 2020 2020 2020 6465 6275 6728 2261 6464        debug("add
-0001f840: 206c 6162 656c 2229 0a20 2020 2020 2020   label").       
-0001f850: 2020 2020 2064 665f 736e 7073 5b22 6c61       df_snps["la
-0001f860: 6265 6c22 5d20 3d20 7365 6c66 2e5f 7061  bel"] = self._pa
-0001f870: 6e64 6173 5f61 7070 6c79 280a 2020 2020  ndas_apply(.    
-0001f880: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001f890: 2e5f 6d61 6b65 5f73 6e70 5f6c 6162 656c  ._make_snp_label
-0001f8a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f8b0: 2020 6466 5f73 6e70 732c 0a20 2020 2020    df_snps,.     
-0001f8c0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-0001f8d0: 6e73 3d5b 2263 6f6e 7469 6722 2c20 2270  ns=["contig", "p
-0001f8e0: 6f73 6974 696f 6e22 2c20 2272 6566 5f61  osition", "ref_a
-0001f8f0: 6c6c 656c 6522 2c20 2261 6c74 5f61 6c6c  llele", "alt_all
-0001f900: 656c 6522 5d2c 0a20 2020 2020 2020 2020  ele"],.         
-0001f910: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0001f920: 2020 6465 6275 6728 2273 6574 2069 6e64    debug("set ind
-0001f930: 6578 2229 0a20 2020 2020 2020 2020 2020  ex").           
-0001f940: 2064 665f 736e 7073 2e73 6574 5f69 6e64   df_snps.set_ind
-0001f950: 6578 280a 2020 2020 2020 2020 2020 2020  ex(.            
-0001f960: 2020 2020 5b22 636f 6e74 6967 222c 2022      ["contig", "
-0001f970: 706f 7369 7469 6f6e 222c 2022 7265 665f  position", "ref_
-0001f980: 616c 6c65 6c65 222c 2022 616c 745f 616c  allele", "alt_al
-0001f990: 6c65 6c65 225d 2c0a 2020 2020 2020 2020  lele"],.        
-0001f9a0: 2020 2020 2020 2020 696e 706c 6163 653d          inplace=
-0001f9b0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0001f9c0: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
-0001f9d0: 7567 2822 6164 6420 6461 7461 6672 616d  ug("add datafram
-0001f9e0: 6520 6d65 7461 6461 7461 2229 0a20 2020  e metadata").   
-0001f9f0: 2020 2020 2067 656e 655f 6e61 6d65 203d       gene_name =
-0001fa00: 2073 656c 662e 5f74 7261 6e73 6372 6970   self._transcrip
-0001fa10: 745f 746f 5f67 656e 655f 6e61 6d65 2874  t_to_gene_name(t
-0001fa20: 7261 6e73 6372 6970 7429 0a20 2020 2020  ranscript).     
-0001fa30: 2020 2074 6974 6c65 203d 2074 7261 6e73     title = trans
-0001fa40: 6372 6970 740a 2020 2020 2020 2020 6966  cript.        if
-0001fa50: 2067 656e 655f 6e61 6d65 3a0a 2020 2020   gene_name:.    
-0001fa60: 2020 2020 2020 2020 7469 746c 6520 2b3d          title +=
-0001fa70: 2066 2220 287b 6765 6e65 5f6e 616d 657d   f" ({gene_name}
-0001fa80: 2922 0a20 2020 2020 2020 2074 6974 6c65  )".        title
-0001fa90: 202b 3d20 2220 534e 5020 6672 6571 7565   += " SNP freque
-0001faa0: 6e63 6965 7322 0a20 2020 2020 2020 2064  ncies".        d
-0001fab0: 665f 736e 7073 2e61 7474 7273 5b22 7469  f_snps.attrs["ti
-0001fac0: 746c 6522 5d20 3d20 7469 746c 650a 0a20  tle"] = title.. 
-0001fad0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-0001fae0: 5f73 6e70 730a 0a20 2020 2064 6566 205f  _snps..    def _
-0001faf0: 7265 6164 5f63 6f68 6f72 745f 6d65 7461  read_cohort_meta
-0001fb00: 6461 7461 2873 656c 662c 202a 2c20 7361  data(self, *, sa
-0001fb10: 6d70 6c65 5f73 6574 293a 0a20 2020 2020  mple_set):.     
-0001fb20: 2020 2022 2222 5265 6164 2063 6f68 6f72     """Read cohor
-0001fb30: 7420 6d65 7461 6461 7461 2066 6f72 2061  t metadata for a
-0001fb40: 2073 696e 676c 6520 7361 6d70 6c65 2073   single sample s
-0001fb50: 6574 2e22 2222 0a20 2020 2020 2020 2074  et.""".        t
-0001fb60: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001fb70: 6466 203d 2073 656c 662e 5f63 6163 6865  df = self._cache
-0001fb80: 5f63 6f68 6f72 745f 6d65 7461 6461 7461  _cohort_metadata
-0001fb90: 5b73 616d 706c 655f 7365 745d 0a20 2020  [sample_set].   
-0001fba0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-0001fbb0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0001fbc0: 2020 7265 6c65 6173 6520 3d20 7365 6c66    release = self
-0001fbd0: 2e6c 6f6f 6b75 705f 7265 6c65 6173 6528  .lookup_release(
-0001fbe0: 7361 6d70 6c65 5f73 6574 3d73 616d 706c  sample_set=sampl
-0001fbf0: 655f 7365 7429 0a20 2020 2020 2020 2020  e_set).         
-0001fc00: 2020 2072 656c 6561 7365 5f70 6174 6820     release_path 
-0001fc10: 3d20 7365 6c66 2e5f 7265 6c65 6173 655f  = self._release_
-0001fc20: 746f 5f70 6174 6828 7265 6c65 6173 6529  to_path(release)
-0001fc30: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0001fc40: 685f 7072 6566 6978 203d 2066 227b 7365  h_prefix = f"{se
-0001fc50: 6c66 2e5f 6261 7365 5f70 6174 687d 2f7b  lf._base_path}/{
-0001fc60: 7265 6c65 6173 655f 7061 7468 7d2f 6d65  release_path}/me
-0001fc70: 7461 6461 7461 220a 2020 2020 2020 2020  tadata".        
-0001fc80: 2020 2020 7061 7468 203d 2066 227b 7061      path = f"{pa
-0001fc90: 7468 5f70 7265 6669 787d 2f63 6f68 6f72  th_prefix}/cohor
-0001fca0: 7473 5f7b 7365 6c66 2e5f 636f 686f 7274  ts_{self._cohort
-0001fcb0: 735f 616e 616c 7973 6973 7d2f 7b73 616d  s_analysis}/{sam
-0001fcc0: 706c 655f 7365 747d 2f73 616d 706c 6573  ple_set}/samples
-0001fcd0: 2e63 6f68 6f72 7473 2e63 7376 220a 2020  .cohorts.csv".  
-0001fce0: 2020 2020 2020 2020 2020 2320 4e2e 422e            # N.B.
-0001fcf0: 2c20 6e6f 7420 616c 6c20 636f 686f 7274  , not all cohort
-0001fd00: 206d 6574 6164 6174 6120 6669 6c65 7320   metadata files 
-0001fd10: 6578 6973 742c 206e 6565 6420 746f 2068  exist, need to h
-0001fd20: 616e 646c 6520 6572 726f 7273 0a20 2020  andle errors.   
-0001fd30: 2020 2020 2020 2020 2023 204e 2e42 2e2c           # N.B.,
-0001fd40: 2061 6c6c 6f77 2061 2062 726f 6164 2065   allow a broad e
-0001fd50: 7863 6570 7469 6f6e 2068 6572 652c 2062  xception here, b
-0001fd60: 6563 6175 7365 2069 7420 7365 656d 7320  ecause it seems 
-0001fd70: 6120 7661 7269 6574 790a 2020 2020 2020  a variety.      
-0001fd80: 2020 2020 2020 2320 6f66 2064 6966 6665        # of diffe
-0001fd90: 7265 6e74 2065 7863 6570 7469 6f6e 7320  rent exceptions 
-0001fda0: 6d61 7920 6265 2074 6872 6f77 6e0a 2020  may be thrown.  
-0001fdb0: 2020 2020 2020 2020 2020 2320 6e6f 696e            # noin
-0001fdc0: 7370 6563 7469 6f6e 2050 7942 726f 6164  spection PyBroad
-0001fdd0: 4578 6365 7074 696f 6e0a 2020 2020 2020  Exception.      
-0001fde0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001fdf0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0001fe00: 7365 6c66 2e5f 6673 2e6f 7065 6e28 7061  self._fs.open(pa
-0001fe10: 7468 2920 6173 2066 3a0a 2020 2020 2020  th) as f:.      
-0001fe20: 2020 2020 2020 2020 2020 2020 2020 6466                df
-0001fe30: 203d 2070 642e 7265 6164 5f63 7376 2866   = pd.read_csv(f
-0001fe40: 2c20 6e61 5f76 616c 7565 733d 2222 290a  , na_values="").
-0001fe50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fe60: 2023 2065 6e73 7572 6520 616c 6c20 636f   # ensure all co
-0001fe70: 6c75 6d6e 206e 616d 6573 2061 7265 206c  lumn names are l
-0001fe80: 6f77 6572 2063 6173 650a 2020 2020 2020  ower case.      
-0001fe90: 2020 2020 2020 2020 2020 6466 2e63 6f6c            df.col
-0001fea0: 756d 6e73 203d 205b 632e 6c6f 7765 7228  umns = [c.lower(
-0001feb0: 2920 666f 7220 6320 696e 2064 662e 636f  ) for c in df.co
-0001fec0: 6c75 6d6e 735d 0a0a 2020 2020 2020 2020  lumns]..        
-0001fed0: 2020 2020 2020 2020 2320 7265 6e61 6d65          # rename
-0001fee0: 2073 6f6d 6520 636f 6c75 6d6e 7320 666f   some columns fo
-0001fef0: 7220 636f 6e73 6973 7465 6e74 206e 616d  r consistent nam
-0001ff00: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0001ff10: 2020 2020 6466 2e72 656e 616d 6528 0a20      df.rename(. 
-0001ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff30: 2020 2063 6f6c 756d 6e73 3d7b 0a20 2020     columns={.   
-0001ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff50: 2020 2020 2022 6164 6d31 5f69 736f 223a       "adm1_iso":
-0001ff60: 2022 6164 6d69 6e31 5f69 736f 222c 0a20   "admin1_iso",. 
-0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff80: 2020 2020 2020 2022 6164 6d31 5f6e 616d         "adm1_nam
-0001ff90: 6522 3a20 2261 646d 696e 315f 6e61 6d65  e": "admin1_name
-0001ffa0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0001ffb0: 2020 2020 2020 2020 2020 2022 6164 6d32             "adm2
-0001ffc0: 5f6e 616d 6522 3a20 2261 646d 696e 325f  _name": "admin2_
-0001ffd0: 6e61 6d65 222c 0a20 2020 2020 2020 2020  name",.         
-0001ffe0: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
-0001fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020000: 2020 696e 706c 6163 653d 5472 7565 2c0a    inplace=True,.
-00020010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020020: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00020030: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00020040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020050: 2320 5370 6563 6966 7920 636f 686f 7274  # Specify cohort
-00020060: 5f63 6f6c 730a 2020 2020 2020 2020 2020  _cols.          
-00020070: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
-00020080: 6f68 6f72 7473 5f61 6e61 6c79 7369 7320  ohorts_analysis 
-00020090: 3c20 2232 3032 3330 3232 3322 3a0a 2020  < "20230223":.  
-000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200b0: 2020 636f 686f 7274 5f63 6f6c 7320 3d20    cohort_cols = 
-000200c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000200d0: 2020 2020 2020 2020 2020 2263 6f75 6e74            "count
-000200e0: 7279 5f69 736f 222c 0a20 2020 2020 2020  ry_iso",.       
-000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020100: 2022 6164 6d69 6e31 5f6e 616d 6522 2c0a   "admin1_name",.
-00020110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020120: 2020 2020 2020 2020 2261 646d 696e 315f          "admin1_
-00020130: 6973 6f22 2c0a 2020 2020 2020 2020 2020  iso",.          
-00020140: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-00020150: 646d 696e 325f 6e61 6d65 222c 0a20 2020  dmin2_name",.   
-00020160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020170: 2020 2020 2022 7461 786f 6e22 2c0a 2020       "taxon",.  
-00020180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020190: 2020 2020 2020 2263 6f68 6f72 745f 6164        "cohort_ad
-000201a0: 6d69 6e31 5f79 6561 7222 2c0a 2020 2020  min1_year",.    
-000201b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201c0: 2020 2020 2263 6f68 6f72 745f 6164 6d69      "cohort_admi
-000201d0: 6e31 5f6d 6f6e 7468 222c 0a20 2020 2020  n1_month",.     
-000201e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201f0: 2020 2022 636f 686f 7274 5f61 646d 696e     "cohort_admin
-00020200: 325f 7965 6172 222c 0a20 2020 2020 2020  2_year",.       
-00020210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020220: 2022 636f 686f 7274 5f61 646d 696e 325f   "cohort_admin2_
-00020230: 6d6f 6e74 6822 2c0a 2020 2020 2020 2020  month",.        
-00020240: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00020250: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00020260: 636f 686f 7274 7320 616e 616c 7973 6573  cohorts analyses
-00020270: 2066 726f 6d20 2232 3032 3330 3232 3322   from "20230223"
-00020280: 2028 7769 6c6c 2920 696e 636c 7564 6520   (will) include 
-00020290: 7175 6172 7465 7220 636f 6c75 6d6e 730a  quarter columns.
-000202a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000202c0: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
-000202d0: 5f63 6f6c 7320 3d20 280a 2020 2020 2020  _cols = (.      
-000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202f0: 2020 2263 6f75 6e74 7279 5f69 736f 222c    "country_iso",
-00020300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020310: 2020 2020 2020 2020 2022 6164 6d69 6e31           "admin1
-00020320: 5f6e 616d 6522 2c0a 2020 2020 2020 2020  _name",.        
-00020330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020340: 2261 646d 696e 315f 6973 6f22 2c0a 2020  "admin1_iso",.  
-00020350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020360: 2020 2020 2020 2261 646d 696e 325f 6e61        "admin2_na
-00020370: 6d65 222c 0a20 2020 2020 2020 2020 2020  me",.           
-00020380: 2020 2020 2020 2020 2020 2020 2022 7461               "ta
-00020390: 786f 6e22 2c0a 2020 2020 2020 2020 2020  xon",.          
-000203a0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-000203b0: 6f68 6f72 745f 6164 6d69 6e31 5f79 6561  ohort_admin1_yea
-000203c0: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
-000203d0: 2020 2020 2020 2020 2020 2020 2263 6f68              "coh
-000203e0: 6f72 745f 6164 6d69 6e31 5f6d 6f6e 7468  ort_admin1_month
-000203f0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00020400: 2020 2020 2020 2020 2020 2022 636f 686f             "coho
-00020410: 7274 5f61 646d 696e 315f 7175 6172 7465  rt_admin1_quarte
-00020420: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
-00020430: 2020 2020 2020 2020 2020 2020 2263 6f68              "coh
-00020440: 6f72 745f 6164 6d69 6e32 5f79 6561 7222  ort_admin2_year"
-00020450: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020460: 2020 2020 2020 2020 2020 2263 6f68 6f72            "cohor
-00020470: 745f 6164 6d69 6e32 5f6d 6f6e 7468 222c  t_admin2_month",
-00020480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020490: 2020 2020 2020 2020 2022 636f 686f 7274           "cohort
-000204a0: 5f61 646d 696e 325f 7175 6172 7465 7222  _admin2_quarter"
-000204b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000204c0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000204d0: 2020 2020 2020 2020 2023 2047 6574 2073           # Get s
-000204e0: 616d 706c 6520 6964 7320 6173 2061 6e20  ample ids as an 
-000204f0: 696e 6465 7820 7669 6120 6765 6e65 7261  index via genera
-00020500: 6c20 6d65 7461 6461 7461 2028 6861 7320  l metadata (has 
-00020510: 6361 6368 696e 6729 0a20 2020 2020 2020  caching).       
-00020520: 2020 2020 2020 2020 2064 665f 6765 6e65           df_gene
-00020530: 7261 6c20 3d20 7365 6c66 2e5f 7265 6164  ral = self._read
-00020540: 5f67 656e 6572 616c 5f6d 6574 6164 6174  _general_metadat
-00020550: 6128 7361 6d70 6c65 5f73 6574 3d73 616d  a(sample_set=sam
-00020560: 706c 655f 7365 7429 0a20 2020 2020 2020  ple_set).       
-00020570: 2020 2020 2020 2020 2064 665f 6765 6e65           df_gene
-00020580: 7261 6c2e 7365 745f 696e 6465 7828 2273  ral.set_index("s
-00020590: 616d 706c 655f 6964 222c 2069 6e70 6c61  ample_id", inpla
-000205a0: 6365 3d54 7275 6529 0a0a 2020 2020 2020  ce=True)..      
-000205b0: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
-000205c0: 7465 2061 2062 6c61 6e6b 2044 6174 6146  te a blank DataF
-000205d0: 7261 6d65 2077 6974 6820 636f 686f 7274  rame with cohort
-000205e0: 5f63 6f6c 7320 616e 6420 7361 6d70 6c65  _cols and sample
-000205f0: 5f69 6420 696e 6465 780a 2020 2020 2020  _id index.      
-00020600: 2020 2020 2020 2020 2020 6466 203d 2070            df = p
-00020610: 642e 4461 7461 4672 616d 6528 636f 6c75  d.DataFrame(colu
-00020620: 6d6e 733d 636f 686f 7274 5f63 6f6c 732c  mns=cohort_cols,
-00020630: 2069 6e64 6578 3d64 665f 6765 6e65 7261   index=df_genera
-00020640: 6c2e 696e 6465 782e 636f 7079 2829 290a  l.index.copy()).
-00020650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020660: 2023 2052 6576 6572 7420 7361 6d70 6c65   # Revert sample
-00020670: 5f69 6420 696e 6465 7820 746f 2063 6f6c  _id index to col
-00020680: 756d 6e0a 2020 2020 2020 2020 2020 2020  umn.            
-00020690: 2020 2020 6466 2e72 6573 6574 5f69 6e64      df.reset_ind
-000206a0: 6578 2869 6e70 6c61 6365 3d54 7275 6529  ex(inplace=True)
-000206b0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000206c0: 6c66 2e5f 6361 6368 655f 636f 686f 7274  lf._cache_cohort
-000206d0: 5f6d 6574 6164 6174 615b 7361 6d70 6c65  _metadata[sample
-000206e0: 5f73 6574 5d20 3d20 6466 0a20 2020 2020  _set] = df.     
-000206f0: 2020 2072 6574 7572 6e20 6466 2e63 6f70     return df.cop
-00020700: 7928 290a 0a20 2020 2040 646f 6328 0a20  y()..    @doc(. 
-00020710: 2020 2020 2020 2073 756d 6d61 7279 3d22         summary="
-00020720: 4163 6365 7373 2063 6f68 6f72 7473 206d  Access cohorts m
-00020730: 6574 6164 6174 6120 666f 7220 6f6e 6520  etadata for one 
-00020740: 6f72 206d 6f72 6520 7361 6d70 6c65 2073  or more sample s
-00020750: 6574 732e 222c 0a20 2020 2020 2020 2072  ets.",.        r
-00020760: 6574 7572 6e73 3d22 4120 6461 7461 6672  eturns="A datafr
-00020770: 616d 6520 6f66 2063 6f68 6f72 7420 6d65  ame of cohort me
-00020780: 7461 6461 7461 2c20 6f6e 6520 726f 7720  tadata, one row 
-00020790: 7065 7220 7361 6d70 6c65 2e22 2c0a 2020  per sample.",.  
-000207a0: 2020 290a 2020 2020 6465 6620 7361 6d70    ).    def samp
-000207b0: 6c65 5f63 6f68 6f72 7473 280a 2020 2020  le_cohorts(.    
-000207c0: 2020 2020 7365 6c66 2c20 7361 6d70 6c65      self, sample
-000207d0: 5f73 6574 733a 204f 7074 696f 6e61 6c5b  _sets: Optional[
-000207e0: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-000207f0: 6c65 5f73 6574 735d 203d 204e 6f6e 650a  le_sets] = None.
-00020800: 2020 2020 2920 2d3e 2070 642e 4461 7461      ) -> pd.Data
-00020810: 4672 616d 653a 0a20 2020 2020 2020 2073  Frame:.        s
-00020820: 616d 706c 655f 7365 7473 203d 2073 656c  ample_sets = sel
-00020830: 662e 5f70 7265 705f 7361 6d70 6c65 5f73  f._prep_sample_s
-00020840: 6574 735f 7061 7261 6d28 7361 6d70 6c65  ets_param(sample
-00020850: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
-00020860: 7329 0a0a 2020 2020 2020 2020 2320 636f  s)..        # co
-00020870: 6e63 6174 656e 6174 6520 6d75 6c74 6970  ncatenate multip
-00020880: 6c65 2073 616d 706c 6520 7365 7473 0a20  le sample sets. 
-00020890: 2020 2020 2020 2064 6673 203d 205b 7365         dfs = [se
-000208a0: 6c66 2e5f 7265 6164 5f63 6f68 6f72 745f  lf._read_cohort_
-000208b0: 6d65 7461 6461 7461 2873 616d 706c 655f  metadata(sample_
-000208c0: 7365 743d 7329 2066 6f72 2073 2069 6e20  set=s) for s in 
-000208d0: 7361 6d70 6c65 5f73 6574 735d 0a20 2020  sample_sets].   
-000208e0: 2020 2020 2064 6620 3d20 7064 2e63 6f6e       df = pd.con
-000208f0: 6361 7428 6466 732c 2061 7869 733d 302c  cat(dfs, axis=0,
-00020900: 2069 676e 6f72 655f 696e 6465 783d 5472   ignore_index=Tr
-00020910: 7565 290a 0a20 2020 2020 2020 2072 6574  ue)..        ret
-00020920: 7572 6e20 6466 0a0a 2020 2020 4064 6f63  urn df..    @doc
-00020930: 280a 2020 2020 2020 2020 7375 6d6d 6172  (.        summar
-00020940: 793d 2222 220a 2020 2020 2020 2020 2020  y=""".          
-00020950: 2020 436f 6d70 7574 6520 616d 696e 6f20    Compute amino 
-00020960: 6163 6964 2073 7562 7374 6974 7574 696f  acid substitutio
-00020970: 6e20 6672 6571 7565 6e63 6965 7320 666f  n frequencies fo
-00020980: 7220 6120 6765 6e65 2074 7261 6e73 6372  r a gene transcr
-00020990: 6970 742e 0a20 2020 2020 2020 2022 2222  ipt..        """
-000209a0: 2c0a 2020 2020 2020 2020 7265 7475 726e  ,.        return
-000209b0: 733d 2222 220a 2020 2020 2020 2020 2020  s=""".          
-000209c0: 2020 4120 6461 7461 6672 616d 6520 6f66    A dataframe of
-000209d0: 2061 6d69 6e6f 2061 6369 6420 616c 6c65   amino acid alle
-000209e0: 6c65 2066 7265 7175 656e 6369 6573 2c20  le frequencies, 
-000209f0: 6f6e 6520 726f 7720 7065 720a 2020 2020  one row per.    
-00020a00: 2020 2020 2020 2020 7375 6273 7469 7475          substitu
-00020a10: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
-00020a20: 222c 0a20 2020 2020 2020 206e 6f74 6573  ",.        notes
-00020a30: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-00020a40: 2043 6f68 6f72 7473 2077 6974 6820 6665   Cohorts with fe
-00020a50: 7765 7220 7361 6d70 6c65 7320 7468 616e  wer samples than
-00020a60: 2060 6d69 6e5f 636f 686f 7274 5f73 697a   `min_cohort_siz
-00020a70: 6560 2077 696c 6c20 6265 2065 7863 6c75  e` will be exclu
-00020a80: 6465 6420 6672 6f6d 0a20 2020 2020 2020  ded from.       
-00020a90: 2020 2020 206f 7574 7075 7420 6461 7461       output data
-00020aa0: 2066 7261 6d65 2e0a 2020 2020 2020 2020   frame..        
-00020ab0: 2222 222c 0a20 2020 2029 0a20 2020 2064  """,.    ).    d
-00020ac0: 6566 2061 615f 616c 6c65 6c65 5f66 7265  ef aa_allele_fre
-00020ad0: 7175 656e 6369 6573 280a 2020 2020 2020  quencies(.      
-00020ae0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00020af0: 7472 616e 7363 7269 7074 3a20 6261 7365  transcript: base
-00020b00: 5f70 6172 616d 732e 7472 616e 7363 7269  _params.transcri
-00020b10: 7074 2c0a 2020 2020 2020 2020 636f 686f  pt,.        coho
-00020b20: 7274 733a 2062 6173 655f 7061 7261 6d73  rts: base_params
-00020b30: 2e63 6f68 6f72 7473 2c0a 2020 2020 2020  .cohorts,.      
-00020b40: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
-00020b50: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-00020b60: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
-00020b70: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
-00020b80: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-00020b90: 7a65 3a20 4f70 7469 6f6e 616c 5b62 6173  ze: Optional[bas
-00020ba0: 655f 7061 7261 6d73 2e6d 696e 5f63 6f68  e_params.min_coh
-00020bb0: 6f72 745f 7369 7a65 5d20 3d20 3130 2c0a  ort_size] = 10,.
-00020bc0: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-00020bd0: 6b3a 204f 7074 696f 6e61 6c5b 6261 7365  k: Optional[base
-00020be0: 5f70 6172 616d 732e 7369 7465 5f6d 6173  _params.site_mas
-00020bf0: 6b5d 203d 204e 6f6e 652c 0a20 2020 2020  k] = None,.     
-00020c00: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
-00020c10: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-00020c20: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
-00020c30: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00020c40: 2020 6472 6f70 5f69 6e76 6172 6961 6e74    drop_invariant
-00020c50: 3a20 6672 715f 7061 7261 6d73 2e64 726f  : frq_params.dro
-00020c60: 705f 696e 7661 7269 616e 7420 3d20 5472  p_invariant = Tr
-00020c70: 7565 2c0a 2020 2020 2920 2d3e 2070 642e  ue,.    ) -> pd.
-00020c80: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
-00020c90: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-00020ca0: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-00020cb0: 2020 2020 6466 5f73 6e70 7320 3d20 7365      df_snps = se
-00020cc0: 6c66 2e73 6e70 5f61 6c6c 656c 655f 6672  lf.snp_allele_fr
-00020cd0: 6571 7565 6e63 6965 7328 0a20 2020 2020  equencies(.     
-00020ce0: 2020 2020 2020 2074 7261 6e73 6372 6970         transcrip
-00020cf0: 743d 7472 616e 7363 7269 7074 2c0a 2020  t=transcript,.  
-00020d00: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
-00020d10: 733d 636f 686f 7274 732c 0a20 2020 2020  s=cohorts,.     
-00020d20: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
-00020d30: 6572 793d 7361 6d70 6c65 5f71 7565 7279  ery=sample_query
-00020d40: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-00020d50: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
-00020d60: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-00020d70: 2020 2020 2020 2020 2020 2073 6974 655f             site_
-00020d80: 6d61 736b 3d73 6974 655f 6d61 736b 2c0a  mask=site_mask,.
-00020d90: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00020da0: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-00020db0: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
-00020dc0: 2064 726f 705f 696e 7661 7269 616e 743d   drop_invariant=
-00020dd0: 6472 6f70 5f69 6e76 6172 6961 6e74 2c0a  drop_invariant,.
-00020de0: 2020 2020 2020 2020 2020 2020 6566 6665              effe
-00020df0: 6374 733d 5472 7565 2c0a 2020 2020 2020  cts=True,.      
-00020e00: 2020 290a 2020 2020 2020 2020 6466 5f73    ).        df_s
-00020e10: 6e70 732e 7265 7365 745f 696e 6465 7828  nps.reset_index(
-00020e20: 696e 706c 6163 653d 5472 7565 290a 0a20  inplace=True).. 
-00020e30: 2020 2020 2020 2023 2077 6520 6a75 7374         # we just
-00020e40: 2077 616e 7420 6161 2063 6861 6e67 650a   want aa change.
-00020e50: 2020 2020 2020 2020 6466 5f6e 735f 736e          df_ns_sn
-00020e60: 7073 203d 2064 665f 736e 7073 2e71 7565  ps = df_snps.que
-00020e70: 7279 2841 415f 4348 414e 4745 5f51 5545  ry(AA_CHANGE_QUE
-00020e80: 5259 292e 636f 7079 2829 0a0a 2020 2020  RY).copy()..    
-00020e90: 2020 2020 2320 4e2e 422e 2c20 7765 206e      # N.B., we n
-00020ea0: 6565 6420 746f 2077 6f72 7279 2061 626f  eed to worry abo
-00020eb0: 7574 2074 6865 2070 6f73 7369 6269 6c69  ut the possibili
-00020ec0: 7479 206f 6620 7468 650a 2020 2020 2020  ty of the.      
-00020ed0: 2020 2320 7361 6d65 2061 6120 6368 616e    # same aa chan
-00020ee0: 6765 2064 7565 2074 6f20 534e 5073 2061  ge due to SNPs a
-00020ef0: 7420 6469 6666 6572 656e 7420 706f 7369  t different posi
-00020f00: 7469 6f6e 732e 2057 6520 6361 6e6e 6f74  tions. We cannot
-00020f10: 0a20 2020 2020 2020 2023 2073 756d 2066  .        # sum f
-00020f20: 7265 7175 656e 6369 6573 206f 6620 534e  requencies of SN
-00020f30: 5073 2061 7420 6469 6666 6572 656e 7420  Ps at different 
-00020f40: 6765 6e6f 6d69 6320 706f 7369 7469 6f6e  genomic position
-00020f50: 732e 2054 6869 730a 2020 2020 2020 2020  s. This.        
-00020f60: 2320 6973 2077 6879 2077 6520 6772 6f75  # is why we grou
-00020f70: 7020 6279 2070 6f73 6974 696f 6e20 616e  p by position an
-00020f80: 6420 6161 5f63 6861 6e67 652c 206e 6f74  d aa_change, not
-00020f90: 206a 7573 7420 6161 5f63 6861 6e67 652e   just aa_change.
-00020fa0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00020fb0: 2267 726f 7570 2061 6e64 2073 756d 2074  "group and sum t
-00020fc0: 6f20 636f 6c6c 6170 7365 206d 756c 7469  o collapse multi
-00020fd0: 2076 6172 6961 6e74 2061 6c6c 656c 6520   variant allele 
-00020fe0: 6368 616e 6765 7322 290a 2020 2020 2020  changes").      
-00020ff0: 2020 6672 6571 5f63 6f6c 7320 3d20 5b63    freq_cols = [c
-00021000: 6f6c 2066 6f72 2063 6f6c 2069 6e20 6466  ol for col in df
-00021010: 5f6e 735f 736e 7073 2069 6620 636f 6c2e  _ns_snps if col.
-00021020: 7374 6172 7473 7769 7468 2822 6672 7122  startswith("frq"
-00021030: 295d 0a20 2020 2020 2020 2061 6767 3a20  )].        agg: 
-00021040: 4469 6374 5b73 7472 2c20 556e 696f 6e5b  Dict[str, Union[
-00021050: 4361 6c6c 6162 6c65 2c20 7374 725d 5d20  Callable, str]] 
-00021060: 3d20 7b63 3a20 6e70 2e6e 616e 7375 6d20  = {c: np.nansum 
-00021070: 666f 7220 6320 696e 2066 7265 715f 636f  for c in freq_co
-00021080: 6c73 7d0a 2020 2020 2020 2020 6b65 6570  ls}.        keep
-00021090: 5f63 6f6c 7320 3d20 280a 2020 2020 2020  _cols = (.      
-000210a0: 2020 2020 2020 2263 6f6e 7469 6722 2c0a        "contig",.
-000210b0: 2020 2020 2020 2020 2020 2020 2274 7261              "tra
-000210c0: 6e73 6372 6970 7422 2c0a 2020 2020 2020  nscript",.      
-000210d0: 2020 2020 2020 2261 615f 706f 7322 2c0a        "aa_pos",.
-000210e0: 2020 2020 2020 2020 2020 2020 2272 6566              "ref
-000210f0: 5f61 6c6c 656c 6522 2c0a 2020 2020 2020  _allele",.      
-00021100: 2020 2020 2020 2272 6566 5f61 6122 2c0a        "ref_aa",.
-00021110: 2020 2020 2020 2020 2020 2020 2261 6c74              "alt
-00021120: 5f61 6122 2c0a 2020 2020 2020 2020 2020  _aa",.          
-00021130: 2020 2265 6666 6563 7422 2c0a 2020 2020    "effect",.    
-00021140: 2020 2020 2020 2020 2269 6d70 6163 7422          "impact"
-00021150: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00021160: 2020 2020 666f 7220 6320 696e 206b 6565      for c in kee
-00021170: 705f 636f 6c73 3a0a 2020 2020 2020 2020  p_cols:.        
-00021180: 2020 2020 6167 675b 635d 203d 2022 6669      agg[c] = "fi
-00021190: 7273 7422 0a20 2020 2020 2020 2061 6767  rst".        agg
-000211a0: 5b22 616c 745f 616c 6c65 6c65 225d 203d  ["alt_allele"] =
-000211b0: 206c 616d 6264 6120 763a 2022 7b22 202b   lambda v: "{" +
-000211c0: 2022 2c22 2e6a 6f69 6e28 7629 202b 2022   ",".join(v) + "
-000211d0: 7d22 2069 6620 6c65 6e28 7629 203e 2031  }" if len(v) > 1
-000211e0: 2065 6c73 6520 760a 2020 2020 2020 2020   else v.        
-000211f0: 6466 5f61 6166 203d 2064 665f 6e73 5f73  df_aaf = df_ns_s
-00021200: 6e70 732e 6772 6f75 7062 7928 5b22 706f  nps.groupby(["po
-00021210: 7369 7469 6f6e 222c 2022 6161 5f63 6861  sition", "aa_cha
-00021220: 6e67 6522 5d29 2e61 6767 2861 6767 292e  nge"]).agg(agg).
-00021230: 7265 7365 745f 696e 6465 7828 290a 0a20  reset_index().. 
-00021240: 2020 2020 2020 2064 6562 7567 2822 636f         debug("co
-00021250: 6d70 7574 6520 6e65 7720 6d61 785f 6166  mpute new max_af
-00021260: 2229 0a20 2020 2020 2020 2064 665f 6161  ").        df_aa
-00021270: 665b 226d 6178 5f61 6622 5d20 3d20 6466  f["max_af"] = df
-00021280: 5f61 6166 5b66 7265 715f 636f 6c73 5d2e  _aaf[freq_cols].
-00021290: 6d61 7828 6178 6973 3d31 290a 0a20 2020  max(axis=1)..   
-000212a0: 2020 2020 2064 6562 7567 2822 6164 6420       debug("add 
-000212b0: 6c61 6265 6c22 290a 2020 2020 2020 2020  label").        
-000212c0: 6466 5f61 6166 5b22 6c61 6265 6c22 5d20  df_aaf["label"] 
-000212d0: 3d20 7365 6c66 2e5f 7061 6e64 6173 5f61  = self._pandas_a
-000212e0: 7070 6c79 280a 2020 2020 2020 2020 2020  pply(.          
-000212f0: 2020 7365 6c66 2e5f 6d61 6b65 5f73 6e70    self._make_snp
-00021300: 5f6c 6162 656c 5f61 612c 0a20 2020 2020  _label_aa,.     
-00021310: 2020 2020 2020 2064 665f 6161 662c 0a20         df_aaf,. 
-00021320: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00021330: 6e73 3d5b 2261 615f 6368 616e 6765 222c  ns=["aa_change",
-00021340: 2022 636f 6e74 6967 222c 2022 706f 7369   "contig", "posi
-00021350: 7469 6f6e 222c 2022 7265 665f 616c 6c65  tion", "ref_alle
-00021360: 6c65 222c 2022 616c 745f 616c 6c65 6c65  le", "alt_allele
-00021370: 225d 2c0a 2020 2020 2020 2020 290a 0a20  "],.        ).. 
-00021380: 2020 2020 2020 2064 6562 7567 2822 736f         debug("so
-00021390: 7274 2062 7920 6765 6e6f 6d69 6320 706f  rt by genomic po
-000213a0: 7369 7469 6f6e 2229 0a20 2020 2020 2020  sition").       
-000213b0: 2064 665f 6161 6620 3d20 6466 5f61 6166   df_aaf = df_aaf
-000213c0: 2e73 6f72 745f 7661 6c75 6573 285b 2270  .sort_values(["p
-000213d0: 6f73 6974 696f 6e22 2c20 2261 615f 6368  osition", "aa_ch
-000213e0: 616e 6765 225d 290a 0a20 2020 2020 2020  ange"])..       
-000213f0: 2064 6562 7567 2822 7365 7420 696e 6465   debug("set inde
-00021400: 7822 290a 2020 2020 2020 2020 6466 5f61  x").        df_a
-00021410: 6166 2e73 6574 5f69 6e64 6578 285b 2261  af.set_index(["a
-00021420: 615f 6368 616e 6765 222c 2022 636f 6e74  a_change", "cont
-00021430: 6967 222c 2022 706f 7369 7469 6f6e 225d  ig", "position"]
-00021440: 2c20 696e 706c 6163 653d 5472 7565 290a  , inplace=True).
-00021450: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00021460: 6164 6420 6d65 7461 6461 7461 2229 0a20  add metadata"). 
-00021470: 2020 2020 2020 2067 656e 655f 6e61 6d65         gene_name
-00021480: 203d 2073 656c 662e 5f74 7261 6e73 6372   = self._transcr
-00021490: 6970 745f 746f 5f67 656e 655f 6e61 6d65  ipt_to_gene_name
-000214a0: 2874 7261 6e73 6372 6970 7429 0a20 2020  (transcript).   
-000214b0: 2020 2020 2074 6974 6c65 203d 2074 7261       title = tra
-000214c0: 6e73 6372 6970 740a 2020 2020 2020 2020  nscript.        
-000214d0: 6966 2067 656e 655f 6e61 6d65 3a0a 2020  if gene_name:.  
-000214e0: 2020 2020 2020 2020 2020 7469 746c 6520            title 
-000214f0: 2b3d 2066 2220 287b 6765 6e65 5f6e 616d  += f" ({gene_nam
-00021500: 657d 2922 0a20 2020 2020 2020 2074 6974  e})".        tit
-00021510: 6c65 202b 3d20 2220 534e 5020 6672 6571  le += " SNP freq
-00021520: 7565 6e63 6965 7322 0a20 2020 2020 2020  uencies".       
-00021530: 2064 665f 6161 662e 6174 7472 735b 2274   df_aaf.attrs["t
-00021540: 6974 6c65 225d 203d 2074 6974 6c65 0a0a  itle"] = title..
-00021550: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00021560: 665f 6161 660a 0a20 2020 2040 646f 6328  f_aaf..    @doc(
-00021570: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-00021580: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-00021590: 2047 726f 7570 2073 616d 706c 6573 2062   Group samples b
-000215a0: 7920 7461 786f 6e2c 2061 7265 6120 2873  y taxon, area (s
-000215b0: 7061 6365 2920 616e 6420 7065 7269 6f64  pace) and period
-000215c0: 2028 7469 6d65 292c 2074 6865 6e20 636f   (time), then co
-000215d0: 6d70 7574 650a 2020 2020 2020 2020 2020  mpute.          
-000215e0: 2020 616d 696e 6f20 6163 6964 2063 6861    amino acid cha
-000215f0: 6e67 6520 616c 6c65 6c65 2066 7265 7175  nge allele frequ
-00021600: 656e 6369 6573 2e0a 2020 2020 2020 2020  encies..        
-00021610: 2222 222c 0a20 2020 2020 2020 2072 6574  """,.        ret
-00021620: 7572 6e73 3d22 2222 0a20 2020 2020 2020  urns=""".       
-00021630: 2020 2020 2054 6865 2072 6573 756c 7469       The resulti
-00021640: 6e67 2064 6174 6173 6574 2063 6f6e 7461  ng dataset conta
-00021650: 696e 7320 6461 7461 2068 6173 2064 696d  ins data has dim
-00021660: 656e 7369 6f6e 7320 2263 6f68 6f72 7473  ensions "cohorts
-00021670: 2220 616e 640a 2020 2020 2020 2020 2020  " and.          
-00021680: 2020 2276 6172 6961 6e74 7322 2e20 5661    "variants". Va
-00021690: 7269 6162 6c65 7320 7072 6566 6978 6564  riables prefixed
-000216a0: 2077 6974 6820 2263 6f68 6f72 7422 2061   with "cohort" a
-000216b0: 7265 2031 2d64 696d 656e 7369 6f6e 616c  re 1-dimensional
-000216c0: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
-000216d0: 6179 7320 7769 7468 2064 6174 6120 6162  ays with data ab
-000216e0: 6f75 7420 7468 6520 636f 686f 7274 732c  out the cohorts,
-000216f0: 2073 7563 6820 6173 2074 6865 2061 7265   such as the are
-00021700: 612c 2070 6572 696f 642c 2074 6178 6f6e  a, period, taxon
-00021710: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-00021720: 2063 6f68 6f72 7420 7369 7a65 2e20 5661   cohort size. Va
-00021730: 7269 6162 6c65 7320 7072 6566 6978 6564  riables prefixed
-00021740: 2077 6974 6820 2276 6172 6961 6e74 2220   with "variant" 
-00021750: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-00021760: 312d 6469 6d65 6e73 696f 6e61 6c20 6172  1-dimensional ar
-00021770: 7261 7973 2077 6974 6820 6461 7461 2061  rays with data a
-00021780: 626f 7574 2074 6865 2076 6172 6961 6e74  bout the variant
-00021790: 732c 2073 7563 6820 6173 2074 6865 0a20  s, such as the. 
-000217a0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-000217b0: 672c 2070 6f73 6974 696f 6e2c 2072 6566  g, position, ref
-000217c0: 6572 656e 6365 2061 6e64 2061 6c74 6572  erence and alter
-000217d0: 6e61 7465 2061 6c6c 656c 6573 2e20 5661  nate alleles. Va
-000217e0: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
-000217f0: 2020 2020 7072 6566 6978 6564 2077 6974      prefixed wit
-00021800: 6820 2265 7665 6e74 2220 6172 6520 322d  h "event" are 2-
-00021810: 6469 6d65 6e73 696f 6e61 6c20 6172 7261  dimensional arra
-00021820: 7973 2077 6974 6820 7468 6520 616c 6c65  ys with the alle
-00021830: 6c65 0a20 2020 2020 2020 2020 2020 2063  le.            c
-00021840: 6f75 6e74 7320 616e 6420 6672 6571 7565  ounts and freque
-00021850: 6e63 7920 6361 6c63 756c 6174 696f 6e73  ncy calculations
-00021860: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
-00021870: 2020 2029 0a20 2020 2064 6566 2061 615f     ).    def aa_
-00021880: 616c 6c65 6c65 5f66 7265 7175 656e 6369  allele_frequenci
-00021890: 6573 5f61 6476 616e 6365 6428 0a20 2020  es_advanced(.   
-000218a0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000218b0: 2020 2074 7261 6e73 6372 6970 743a 2062     transcript: b
-000218c0: 6173 655f 7061 7261 6d73 2e74 7261 6e73  ase_params.trans
-000218d0: 6372 6970 742c 0a20 2020 2020 2020 2061  cript,.        a
-000218e0: 7265 615f 6279 3a20 6672 715f 7061 7261  rea_by: frq_para
-000218f0: 6d73 2e61 7265 615f 6279 2c0a 2020 2020  ms.area_by,.    
-00021900: 2020 2020 7065 7269 6f64 5f62 793a 2066      period_by: f
-00021910: 7271 5f70 6172 616d 732e 7065 7269 6f64  rq_params.period
-00021920: 5f62 792c 0a20 2020 2020 2020 2073 616d  _by,.        sam
-00021930: 706c 655f 7365 7473 3a20 4f70 7469 6f6e  ple_sets: Option
-00021940: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-00021950: 616d 706c 655f 7365 7473 5d20 3d20 4e6f  ample_sets] = No
-00021960: 6e65 2c0a 2020 2020 2020 2020 7361 6d70  ne,.        samp
-00021970: 6c65 5f71 7565 7279 3a20 4f70 7469 6f6e  le_query: Option
-00021980: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-00021990: 616d 706c 655f 7175 6572 795d 203d 204e  ample_query] = N
-000219a0: 6f6e 652c 0a20 2020 2020 2020 206d 696e  one,.        min
-000219b0: 5f63 6f68 6f72 745f 7369 7a65 3a20 6261  _cohort_size: ba
-000219c0: 7365 5f70 6172 616d 732e 6d69 6e5f 636f  se_params.min_co
-000219d0: 686f 7274 5f73 697a 6520 3d20 3130 2c0a  hort_size = 10,.
-000219e0: 2020 2020 2020 2020 7661 7269 616e 745f          variant_
-000219f0: 7175 6572 793a 204f 7074 696f 6e61 6c5b  query: Optional[
-00021a00: 6672 715f 7061 7261 6d73 2e76 6172 6961  frq_params.varia
-00021a10: 6e74 5f71 7565 7279 5d20 3d20 4e6f 6e65  nt_query] = None
-00021a20: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
-00021a30: 6173 6b3a 204f 7074 696f 6e61 6c5b 6261  ask: Optional[ba
-00021a40: 7365 5f70 6172 616d 732e 7369 7465 5f6d  se_params.site_m
-00021a50: 6173 6b5d 203d 204e 6f6e 652c 0a20 2020  ask] = None,.   
-00021a60: 2020 2020 206e 6f62 735f 6d6f 6465 3a20       nobs_mode: 
-00021a70: 6672 715f 7061 7261 6d73 2e6e 6f62 735f  frq_params.nobs_
-00021a80: 6d6f 6465 203d 2022 6361 6c6c 6564 222c  mode = "called",
-00021a90: 0a20 2020 2020 2020 2063 695f 6d65 7468  .        ci_meth
-00021aa0: 6f64 3a20 4f70 7469 6f6e 616c 5b66 7271  od: Optional[frq
-00021ab0: 5f70 6172 616d 732e 6369 5f6d 6574 686f  _params.ci_metho
-00021ac0: 645d 203d 2022 7769 6c73 6f6e 222c 0a20  d] = "wilson",. 
-00021ad0: 2020 2029 202d 3e20 7872 2e44 6174 6173     ) -> xr.Datas
-00021ae0: 6574 3a0a 2020 2020 2020 2020 6465 6275  et:.        debu
-00021af0: 6720 3d20 7365 6c66 2e5f 6c6f 672e 6465  g = self._log.de
-00021b00: 6275 670a 0a20 2020 2020 2020 2064 6562  bug..        deb
-00021b10: 7567 2822 6265 6769 6e20 6279 2063 6f6d  ug("begin by com
-00021b20: 7075 7469 6e67 2053 4e50 2061 6c6c 656c  puting SNP allel
-00021b30: 6520 6672 6571 7565 6e63 6965 7322 290a  e frequencies").
-00021b40: 2020 2020 2020 2020 6473 5f73 6e70 5f66          ds_snp_f
-00021b50: 7271 203d 2073 656c 662e 736e 705f 616c  rq = self.snp_al
-00021b60: 6c65 6c65 5f66 7265 7175 656e 6369 6573  lele_frequencies
-00021b70: 5f61 6476 616e 6365 6428 0a20 2020 2020  _advanced(.     
-00021b80: 2020 2020 2020 2074 7261 6e73 6372 6970         transcrip
-00021b90: 743d 7472 616e 7363 7269 7074 2c0a 2020  t=transcript,.  
-00021ba0: 2020 2020 2020 2020 2020 6172 6561 5f62            area_b
-00021bb0: 793d 6172 6561 5f62 792c 0a20 2020 2020  y=area_by,.     
-00021bc0: 2020 2020 2020 2070 6572 696f 645f 6279         period_by
-00021bd0: 3d70 6572 696f 645f 6279 2c0a 2020 2020  =period_by,.    
-00021be0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-00021bf0: 6574 733d 7361 6d70 6c65 5f73 6574 732c  ets=sample_sets,
-00021c00: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00021c10: 706c 655f 7175 6572 793d 7361 6d70 6c65  ple_query=sample
-00021c20: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-00021c30: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
-00021c40: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
-00021c50: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-00021c60: 2064 726f 705f 696e 7661 7269 616e 743d   drop_invariant=
-00021c70: 5472 7565 2c20 2023 2061 6c77 6179 7320  True,  # always 
-00021c80: 6472 6f70 2069 6e76 6172 6961 6e74 2066  drop invariant f
-00021c90: 6f72 2061 6120 6672 6571 7565 6e63 6965  or aa frequencie
-00021ca0: 730a 2020 2020 2020 2020 2020 2020 7661  s.            va
-00021cb0: 7269 616e 745f 7175 6572 793d 4141 5f43  riant_query=AA_C
-00021cc0: 4841 4e47 455f 5155 4552 592c 2020 2320  HANGE_QUERY,  # 
-00021cd0: 7765 276c 6c20 616c 736f 2061 7070 6c79  we'll also apply
-00021ce0: 2061 2076 6172 6961 6e74 2071 7565 7279   a variant query
-00021cf0: 206c 6174 6572 0a20 2020 2020 2020 2020   later.         
-00021d00: 2020 2073 6974 655f 6d61 736b 3d73 6974     site_mask=sit
-00021d10: 655f 6d61 736b 2c0a 2020 2020 2020 2020  e_mask,.        
-00021d20: 2020 2020 6e6f 6273 5f6d 6f64 653d 6e6f      nobs_mode=no
-00021d30: 6273 5f6d 6f64 652c 0a20 2020 2020 2020  bs_mode,.       
-00021d40: 2020 2020 2063 695f 6d65 7468 6f64 3d4e       ci_method=N
-00021d50: 6f6e 652c 2020 2320 7765 2077 696c 6c20  one,  # we will 
-00021d60: 7265 636f 6d70 7574 6520 636f 6e66 6964  recompute confid
-00021d70: 656e 6365 2069 6e74 6572 7661 6c73 206c  ence intervals l
-00021d80: 6174 6572 0a20 2020 2020 2020 2029 0a0a  ater.        )..
-00021d90: 2020 2020 2020 2020 2320 4e2e 422e 2c20          # N.B., 
-00021da0: 7765 206e 6565 6420 746f 2077 6f72 7279  we need to worry
-00021db0: 2061 626f 7574 2074 6865 2070 6f73 7369   about the possi
-00021dc0: 6269 6c69 7479 206f 6620 7468 650a 2020  bility of the.  
-00021dd0: 2020 2020 2020 2320 7361 6d65 2061 6120        # same aa 
-00021de0: 6368 616e 6765 2064 7565 2074 6f20 534e  change due to SN
-00021df0: 5073 2061 7420 6469 6666 6572 656e 7420  Ps at different 
-00021e00: 706f 7369 7469 6f6e 732e 2057 6520 6361  positions. We ca
-00021e10: 6e6e 6f74 0a20 2020 2020 2020 2023 2073  nnot.        # s
-00021e20: 756d 2066 7265 7175 656e 6369 6573 206f  um frequencies o
-00021e30: 6620 534e 5073 2061 7420 6469 6666 6572  f SNPs at differ
-00021e40: 656e 7420 6765 6e6f 6d69 6320 706f 7369  ent genomic posi
-00021e50: 7469 6f6e 732e 2054 6869 730a 2020 2020  tions. This.    
-00021e60: 2020 2020 2320 6973 2077 6879 2077 6520      # is why we 
-00021e70: 6772 6f75 7020 6279 2070 6f73 6974 696f  group by positio
-00021e80: 6e20 616e 6420 6161 5f63 6861 6e67 652c  n and aa_change,
-00021e90: 206e 6f74 206a 7573 7420 6161 5f63 6861   not just aa_cha
-00021ea0: 6e67 652e 0a0a 2020 2020 2020 2020 2320  nge...        # 
-00021eb0: 6164 6420 696e 2061 2073 7065 6369 616c  add in a special
-00021ec0: 2067 726f 7570 696e 6720 636f 6c75 6d6e   grouping column
-00021ed0: 2074 6f20 776f 726b 2061 726f 756e 6420   to work around 
-00021ee0: 7468 6520 6661 6374 2074 6861 7420 7861  the fact that xa
-00021ef0: 7272 6179 2063 7572 7265 6e74 6c79 0a20  rray currently. 
-00021f00: 2020 2020 2020 2023 2064 6f65 736e 2774         # doesn't
-00021f10: 2073 7570 706f 7274 2067 726f 7570 696e   support groupin
-00021f20: 6720 6279 206d 756c 7469 706c 6520 7661  g by multiple va
-00021f30: 7269 6162 6c65 7320 696e 2074 6865 2073  riables in the s
-00021f40: 616d 6520 6469 6d65 6e73 696f 6e0a 2020  ame dimension.  
-00021f50: 2020 2020 2020 6466 5f67 726f 7570 6572        df_grouper
-00021f60: 203d 2064 735f 736e 705f 6672 715b 0a20   = ds_snp_frq[. 
-00021f70: 2020 2020 2020 2020 2020 205b 2276 6172             ["var
-00021f80: 6961 6e74 5f70 6f73 6974 696f 6e22 2c20  iant_position", 
-00021f90: 2276 6172 6961 6e74 5f61 615f 6368 616e  "variant_aa_chan
-00021fa0: 6765 225d 0a20 2020 2020 2020 205d 2e74  ge"].        ].t
-00021fb0: 6f5f 6461 7461 6672 616d 6528 290a 2020  o_dataframe().  
-00021fc0: 2020 2020 2020 6772 6f75 7065 725f 7661        grouper_va
-00021fd0: 7220 3d20 6466 5f67 726f 7570 6572 2e61  r = df_grouper.a
-00021fe0: 7070 6c79 280a 2020 2020 2020 2020 2020  pply(.          
-00021ff0: 2020 6c61 6d62 6461 2072 6f77 3a20 225f    lambda row: "_
-00022000: 222e 6a6f 696e 285b 7374 7228 7629 2066  ".join([str(v) f
-00022010: 6f72 2076 2069 6e20 726f 775d 292c 2061  or v in row]), a
-00022020: 7869 733d 2263 6f6c 756d 6e73 220a 2020  xis="columns".  
-00022030: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00022040: 6473 5f73 6e70 5f66 7271 5b22 7661 7269  ds_snp_frq["vari
-00022050: 616e 745f 706f 7369 7469 6f6e 5f61 615f  ant_position_aa_
-00022060: 6368 616e 6765 225d 203d 2022 7661 7269  change"] = "vari
-00022070: 616e 7473 222c 2067 726f 7570 6572 5f76  ants", grouper_v
-00022080: 6172 0a0a 2020 2020 2020 2020 6465 6275  ar..        debu
-00022090: 6728 2267 726f 7570 2062 7920 706f 7369  g("group by posi
-000220a0: 7469 6f6e 2061 6e64 2061 6d69 6e6f 2061  tion and amino a
-000220b0: 6369 6420 6368 616e 6765 2229 0a20 2020  cid change").   
-000220c0: 2020 2020 2067 726f 7570 5f62 795f 6161       group_by_aa
-000220d0: 5f63 6861 6e67 6520 3d20 6473 5f73 6e70  _change = ds_snp
-000220e0: 5f66 7271 2e67 726f 7570 6279 2822 7661  _frq.groupby("va
-000220f0: 7269 616e 745f 706f 7369 7469 6f6e 5f61  riant_position_a
-00022100: 615f 6368 616e 6765 2229 0a0a 2020 2020  a_change")..    
-00022110: 2020 2020 6465 6275 6728 2261 7070 6c79      debug("apply
-00022120: 2061 6767 7265 6761 7469 6f6e 2229 0a20   aggregation"). 
-00022130: 2020 2020 2020 2064 735f 6161 5f66 7271         ds_aa_frq
-00022140: 203d 2067 726f 7570 5f62 795f 6161 5f63   = group_by_aa_c
-00022150: 6861 6e67 652e 6d61 7028 7365 6c66 2e5f  hange.map(self._
-00022160: 6d61 705f 736e 705f 746f 5f61 615f 6368  map_snp_to_aa_ch
-00022170: 616e 6765 5f66 7271 5f64 7329 0a0a 2020  ange_frq_ds)..  
-00022180: 2020 2020 2020 6465 6275 6728 2261 6464        debug("add
-00022190: 2062 6163 6b20 696e 2063 6f68 6f72 7420   back in cohort 
-000221a0: 7661 7269 6162 6c65 732c 2075 6e61 6666  variables, unaff
-000221b0: 6563 7465 6420 6279 2061 6767 7265 6761  ected by aggrega
-000221c0: 7469 6f6e 2229 0a20 2020 2020 2020 2063  tion").        c
-000221d0: 6f68 6f72 745f 7661 7273 203d 205b 7620  ohort_vars = [v 
-000221e0: 666f 7220 7620 696e 2064 735f 736e 705f  for v in ds_snp_
-000221f0: 6672 7120 6966 2076 2e73 7461 7274 7377  frq if v.startsw
-00022200: 6974 6828 2263 6f68 6f72 745f 2229 5d0a  ith("cohort_")].
-00022210: 2020 2020 2020 2020 666f 7220 7620 696e          for v in
-00022220: 2063 6f68 6f72 745f 7661 7273 3a0a 2020   cohort_vars:.  
-00022230: 2020 2020 2020 2020 2020 6473 5f61 615f            ds_aa_
-00022240: 6672 715b 765d 203d 2064 735f 736e 705f  frq[v] = ds_snp_
-00022250: 6672 715b 765d 0a0a 2020 2020 2020 2020  frq[v]..        
-00022260: 6465 6275 6728 2273 6f72 7420 6279 2067  debug("sort by g
-00022270: 656e 6f6d 6963 2070 6f73 6974 696f 6e22  enomic position"
-00022280: 290a 2020 2020 2020 2020 6473 5f61 615f  ).        ds_aa_
-00022290: 6672 7120 3d20 6473 5f61 615f 6672 712e  frq = ds_aa_frq.
-000222a0: 736f 7274 6279 285b 2276 6172 6961 6e74  sortby(["variant
-000222b0: 5f70 6f73 6974 696f 6e22 2c20 2276 6172  _position", "var
-000222c0: 6961 6e74 5f61 615f 6368 616e 6765 225d  iant_aa_change"]
-000222d0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
-000222e0: 2822 7265 636f 6d70 7574 6520 6672 6571  ("recompute freq
-000222f0: 7565 6e63 7922 290a 2020 2020 2020 2020  uency").        
-00022300: 636f 756e 7420 3d20 6473 5f61 615f 6672  count = ds_aa_fr
-00022310: 715b 2265 7665 6e74 5f63 6f75 6e74 225d  q["event_count"]
-00022320: 2e76 616c 7565 730a 2020 2020 2020 2020  .values.        
-00022330: 6e6f 6273 203d 2064 735f 6161 5f66 7271  nobs = ds_aa_frq
-00022340: 5b22 6576 656e 745f 6e6f 6273 225d 2e76  ["event_nobs"].v
-00022350: 616c 7565 730a 2020 2020 2020 2020 7769  alues.        wi
-00022360: 7468 206e 702e 6572 7273 7461 7465 2864  th np.errstate(d
-00022370: 6976 6964 653d 2269 676e 6f72 6522 2c20  ivide="ignore", 
-00022380: 696e 7661 6c69 643d 2269 676e 6f72 6522  invalid="ignore"
-00022390: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-000223a0: 7265 7175 656e 6379 203d 2063 6f75 6e74  requency = count
-000223b0: 202f 206e 6f62 7320 2023 2069 676e 6f72   / nobs  # ignor
-000223c0: 6520 6469 7669 7369 6f6e 2077 6172 6e69  e division warni
-000223d0: 6e67 730a 2020 2020 2020 2020 6473 5f61  ngs.        ds_a
-000223e0: 615f 6672 715b 2265 7665 6e74 5f66 7265  a_frq["event_fre
-000223f0: 7175 656e 6379 225d 203d 2028 2276 6172  quency"] = ("var
-00022400: 6961 6e74 7322 2c20 2263 6f68 6f72 7473  iants", "cohorts
-00022410: 2229 2c20 6672 6571 7565 6e63 790a 0a20  "), frequency.. 
-00022420: 2020 2020 2020 2064 6562 7567 2822 7265         debug("re
-00022430: 636f 6d70 7574 6520 6d61 7820 6672 6571  compute max freq
-00022440: 7565 6e63 7920 6f76 6572 2063 6f68 6f72  uency over cohor
-00022450: 7473 2229 0a20 2020 2020 2020 2077 6974  ts").        wit
-00022460: 6820 7761 726e 696e 6773 2e63 6174 6368  h warnings.catch
-00022470: 5f77 6172 6e69 6e67 7328 293a 0a20 2020  _warnings():.   
-00022480: 2020 2020 2020 2020 2023 2069 676e 6f72           # ignor
-00022490: 6520 2241 6c6c 2d4e 614e 2073 6c69 6365  e "All-NaN slice
-000224a0: 2065 6e63 6f75 6e74 6572 6564 2220 7761   encountered" wa
-000224b0: 726e 696e 6773 0a20 2020 2020 2020 2020  rnings.         
-000224c0: 2020 2077 6172 6e69 6e67 732e 7369 6d70     warnings.simp
-000224d0: 6c65 6669 6c74 6572 2822 6967 6e6f 7265  lefilter("ignore
-000224e0: 222c 2063 6174 6567 6f72 793d 5275 6e74  ", category=Runt
-000224f0: 696d 6557 6172 6e69 6e67 290a 2020 2020  imeWarning).    
-00022500: 2020 2020 2020 2020 6d61 785f 6166 203d          max_af =
-00022510: 206e 702e 6e61 6e6d 6178 2864 735f 6161   np.nanmax(ds_aa
-00022520: 5f66 7271 5b22 6576 656e 745f 6672 6571  _frq["event_freq
-00022530: 7565 6e63 7922 5d2e 7661 6c75 6573 2c20  uency"].values, 
-00022540: 6178 6973 3d31 290a 2020 2020 2020 2020  axis=1).        
-00022550: 6473 5f61 615f 6672 715b 2276 6172 6961  ds_aa_frq["varia
-00022560: 6e74 5f6d 6178 5f61 6622 5d20 3d20 2276  nt_max_af"] = "v
-00022570: 6172 6961 6e74 7322 2c20 6d61 785f 6166  ariants", max_af
-00022580: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00022590: 2273 6574 2075 7020 7661 7269 616e 7420  "set up variant 
-000225a0: 6461 7461 6672 616d 652c 2075 7365 6675  dataframe, usefu
-000225b0: 6c20 696e 7465 726d 6564 6961 7465 2229  l intermediate")
-000225c0: 0a20 2020 2020 2020 2076 6172 6961 6e74  .        variant
-000225d0: 5f63 6f6c 7320 3d20 5b76 2066 6f72 2076  _cols = [v for v
-000225e0: 2069 6e20 6473 5f61 615f 6672 7120 6966   in ds_aa_frq if
-000225f0: 2076 2e73 7461 7274 7377 6974 6828 2276   v.startswith("v
-00022600: 6172 6961 6e74 5f22 295d 0a20 2020 2020  ariant_")].     
-00022610: 2020 2064 665f 7661 7269 616e 7473 203d     df_variants =
-00022620: 2064 735f 6161 5f66 7271 5b76 6172 6961   ds_aa_frq[varia
-00022630: 6e74 5f63 6f6c 735d 2e74 6f5f 6461 7461  nt_cols].to_data
-00022640: 6672 616d 6528 290a 2020 2020 2020 2020  frame().        
-00022650: 6466 5f76 6172 6961 6e74 732e 636f 6c75  df_variants.colu
-00022660: 6d6e 7320 3d20 5b63 2e73 706c 6974 2822  mns = [c.split("
-00022670: 7661 7269 616e 745f 2229 5b31 5d20 666f  variant_")[1] fo
-00022680: 7220 6320 696e 2064 665f 7661 7269 616e  r c in df_varian
-00022690: 7473 2e63 6f6c 756d 6e73 5d0a 0a20 2020  ts.columns]..   
-000226a0: 2020 2020 2064 6562 7567 2822 6173 7369       debug("assi
-000226b0: 676e 206e 6577 2076 6172 6961 6e74 206c  gn new variant l
-000226c0: 6162 656c 2229 0a20 2020 2020 2020 206c  abel").        l
-000226d0: 6162 656c 203d 2073 656c 662e 5f70 616e  abel = self._pan
-000226e0: 6461 735f 6170 706c 7928 0a20 2020 2020  das_apply(.     
-000226f0: 2020 2020 2020 2073 656c 662e 5f6d 616b         self._mak
-00022700: 655f 736e 705f 6c61 6265 6c5f 6161 2c0a  e_snp_label_aa,.
-00022710: 2020 2020 2020 2020 2020 2020 6466 5f76              df_v
-00022720: 6172 6961 6e74 732c 0a20 2020 2020 2020  ariants,.       
-00022730: 2020 2020 2063 6f6c 756d 6e73 3d5b 2261       columns=["a
-00022740: 615f 6368 616e 6765 222c 2022 636f 6e74  a_change", "cont
-00022750: 6967 222c 2022 706f 7369 7469 6f6e 222c  ig", "position",
-00022760: 2022 7265 665f 616c 6c65 6c65 222c 2022   "ref_allele", "
-00022770: 616c 745f 616c 6c65 6c65 225d 2c0a 2020  alt_allele"],.  
-00022780: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00022790: 6473 5f61 615f 6672 715b 2276 6172 6961  ds_aa_frq["varia
-000227a0: 6e74 5f6c 6162 656c 225d 203d 2022 7661  nt_label"] = "va
-000227b0: 7269 616e 7473 222c 206c 6162 656c 0a0a  riants", label..
-000227c0: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-000227d0: 7070 6c79 2076 6172 6961 6e74 2071 7565  pply variant que
-000227e0: 7279 2069 6620 6769 7665 6e22 290a 2020  ry if given").  
-000227f0: 2020 2020 2020 6966 2076 6172 6961 6e74        if variant
-00022800: 5f71 7565 7279 2069 7320 6e6f 7420 4e6f  _query is not No
-00022810: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00022820: 6c6f 635f 7661 7269 616e 7473 203d 2064  loc_variants = d
-00022830: 665f 7661 7269 616e 7473 2e65 7661 6c28  f_variants.eval(
-00022840: 7661 7269 616e 745f 7175 6572 7929 2e76  variant_query).v
-00022850: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
-00022860: 2020 6473 5f61 615f 6672 7120 3d20 6473    ds_aa_frq = ds
-00022870: 5f61 615f 6672 712e 6973 656c 2876 6172  _aa_frq.isel(var
-00022880: 6961 6e74 733d 6c6f 635f 7661 7269 616e  iants=loc_varian
-00022890: 7473 290a 0a20 2020 2020 2020 2064 6562  ts)..        deb
-000228a0: 7567 2822 636f 6d70 7574 6520 6e65 7720  ug("compute new 
-000228b0: 636f 6e66 6964 656e 6365 2069 6e74 6572  confidence inter
-000228c0: 7661 6c73 2229 0a20 2020 2020 2020 2073  vals").        s
-000228d0: 656c 662e 5f61 6464 5f66 7265 7175 656e  elf._add_frequen
-000228e0: 6379 5f63 6928 6473 5f61 615f 6672 712c  cy_ci(ds_aa_frq,
-000228f0: 2063 695f 6d65 7468 6f64 290a 0a20 2020   ci_method)..   
-00022900: 2020 2020 2064 6562 7567 2822 7469 6479       debug("tidy
-00022910: 2075 7020 6469 7370 6c61 7920 6279 2073   up display by s
-00022920: 6f72 7469 6e67 2076 6172 6961 626c 6573  orting variables
-00022930: 2229 0a20 2020 2020 2020 2064 735f 6161  ").        ds_aa
-00022940: 5f66 7271 203d 2064 735f 6161 5f66 7271  _frq = ds_aa_frq
-00022950: 5b73 6f72 7465 6428 6473 5f61 615f 6672  [sorted(ds_aa_fr
-00022960: 7129 5d0a 0a20 2020 2020 2020 2067 656e  q)]..        gen
-00022970: 655f 6e61 6d65 203d 2073 656c 662e 5f74  e_name = self._t
-00022980: 7261 6e73 6372 6970 745f 746f 5f67 656e  ranscript_to_gen
-00022990: 655f 6e61 6d65 2874 7261 6e73 6372 6970  e_name(transcrip
-000229a0: 7429 0a20 2020 2020 2020 2074 6974 6c65  t).        title
-000229b0: 203d 2074 7261 6e73 6372 6970 740a 2020   = transcript.  
-000229c0: 2020 2020 2020 6966 2067 656e 655f 6e61        if gene_na
-000229d0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-000229e0: 7469 746c 6520 2b3d 2066 2220 287b 6765  title += f" ({ge
-000229f0: 6e65 5f6e 616d 657d 2922 0a20 2020 2020  ne_name})".     
-00022a00: 2020 2074 6974 6c65 202b 3d20 2220 534e     title += " SN
-00022a10: 5020 6672 6571 7565 6e63 6965 7322 0a20  P frequencies". 
-00022a20: 2020 2020 2020 2064 735f 6161 5f66 7271         ds_aa_frq
-00022a30: 2e61 7474 7273 5b22 7469 746c 6522 5d20  .attrs["title"] 
-00022a40: 3d20 7469 746c 650a 0a20 2020 2020 2020  = title..       
-00022a50: 2072 6574 7572 6e20 6473 5f61 615f 6672   return ds_aa_fr
-00022a60: 710a 0a20 2020 2064 6566 205f 626c 6f63  q..    def _bloc
-00022a70: 6b5f 6a61 636b 6b6e 6966 655f 636f 686f  k_jackknife_coho
-00022a80: 7274 5f64 6976 6572 7369 7479 5f73 7461  rt_diversity_sta
-00022a90: 7473 280a 2020 2020 2020 2020 7365 6c66  ts(.        self
-00022aa0: 2c20 2a2c 2063 6f68 6f72 745f 6c61 6265  , *, cohort_labe
-00022ab0: 6c2c 2061 632c 206e 5f6a 6163 6b2c 2063  l, ac, n_jack, c
-00022ac0: 6f6e 6669 6465 6e63 655f 6c65 7665 6c0a  onfidence_level.
-00022ad0: 2020 2020 293a 0a20 2020 2020 2020 2064      ):.        d
-00022ae0: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
-00022af0: 2e64 6562 7567 0a0a 2020 2020 2020 2020  .debug..        
-00022b00: 6465 6275 6728 2273 6574 2075 7020 666f  debug("set up fo
-00022b10: 7220 6469 7665 7273 6974 7920 6361 6c63  r diversity calc
-00022b20: 756c 6174 696f 6e73 2229 0a20 2020 2020  ulations").     
-00022b30: 2020 206e 5f73 6974 6573 203d 2061 632e     n_sites = ac.
-00022b40: 7368 6170 655b 305d 0a20 2020 2020 2020  shape[0].       
-00022b50: 2061 6320 3d20 616c 6c65 6c2e 416c 6c65   ac = allel.Alle
-00022b60: 6c65 436f 756e 7473 4172 7261 7928 6163  leCountsArray(ac
-00022b70: 290a 2020 2020 2020 2020 6e20 3d20 6163  ).        n = ac
-00022b80: 2e73 756d 2861 7869 733d 3129 2e6d 6178  .sum(axis=1).max
-00022b90: 2829 2020 2320 6e75 6d62 6572 206f 6620  ()  # number of 
-00022ba0: 6368 726f 6d6f 736f 6d65 7320 7361 6d70  chromosomes samp
-00022bb0: 6c65 640a 2020 2020 2020 2020 6e5f 7369  led.        n_si
-00022bc0: 7465 7320 3d20 6d69 6e28 6e5f 7369 7465  tes = min(n_site
-00022bd0: 732c 2061 632e 7368 6170 655b 305d 2920  s, ac.shape[0]) 
-00022be0: 2023 206e 756d 6265 7220 6f66 2073 6974   # number of sit
-00022bf0: 6573 0a20 2020 2020 2020 2062 6c6f 636b  es.        block
-00022c00: 5f6c 656e 6774 6820 3d20 6e5f 7369 7465  _length = n_site
-00022c10: 7320 2f2f 206e 5f6a 6163 6b20 2023 206e  s // n_jack  # n
-00022c20: 756d 6265 7220 6f66 2073 6974 6573 2069  umber of sites i
-00022c30: 6e20 6561 6368 2062 6c6f 636b 0a20 2020  n each block.   
-00022c40: 2020 2020 206e 5f73 6974 6573 5f6a 203d       n_sites_j =
-00022c50: 206e 5f73 6974 6573 202d 2062 6c6f 636b   n_sites - block
-00022c60: 5f6c 656e 6774 6820 2023 206e 756d 6265  _length  # numbe
-00022c70: 7220 6f66 2073 6974 6573 2069 6e20 6561  r of sites in ea
-00022c80: 6368 206a 6163 6b6b 6e69 6665 2072 6573  ch jackknife res
-00022c90: 616d 706c 650a 0a20 2020 2020 2020 2064  ample..        d
-00022ca0: 6562 7567 2822 636f 6d70 7574 6520 7363  ebug("compute sc
-00022cb0: 616c 696e 6720 636f 6e73 7461 6e74 7322  aling constants"
-00022cc0: 290a 2020 2020 2020 2020 6131 203d 206e  ).        a1 = n
-00022cd0: 702e 7375 6d28 3120 2f20 6e70 2e61 7261  p.sum(1 / np.ara
-00022ce0: 6e67 6528 312c 206e 2929 0a20 2020 2020  nge(1, n)).     
-00022cf0: 2020 2061 3220 3d20 6e70 2e73 756d 2831     a2 = np.sum(1
-00022d00: 202f 2028 6e70 2e61 7261 6e67 6528 312c   / (np.arange(1,
-00022d10: 206e 2920 2a2a 2032 2929 0a20 2020 2020   n) ** 2)).     
-00022d20: 2020 2062 3120 3d20 286e 202b 2031 2920     b1 = (n + 1) 
-00022d30: 2f20 2833 202a 2028 6e20 2d20 3129 290a  / (3 * (n - 1)).
-00022d40: 2020 2020 2020 2020 6232 203d 2032 202a          b2 = 2 *
-00022d50: 2028 6e2a 2a32 202b 206e 202b 2033 2920   (n**2 + n + 3) 
-00022d60: 2f20 2839 202a 206e 202a 2028 6e20 2d20  / (9 * n * (n - 
-00022d70: 3129 290a 2020 2020 2020 2020 6331 203d  1)).        c1 =
-00022d80: 2062 3120 2d20 2831 202f 2061 3129 0a20   b1 - (1 / a1). 
-00022d90: 2020 2020 2020 2063 3220 3d20 6232 202d         c2 = b2 -
-00022da0: 2028 286e 202b 2032 2920 2f20 2861 3120   ((n + 2) / (a1 
-00022db0: 2a20 6e29 2920 2b20 2861 3220 2f20 2861  * n)) + (a2 / (a
-00022dc0: 312a 2a32 2929 0a20 2020 2020 2020 2065  1**2)).        e
-00022dd0: 3120 3d20 6331 202f 2061 310a 2020 2020  1 = c1 / a1.    
-00022de0: 2020 2020 6532 203d 2063 3220 2f20 2861      e2 = c2 / (a
-00022df0: 312a 2a32 202b 2061 3229 0a0a 2020 2020  1**2 + a2)..    
-00022e00: 2020 2020 6465 6275 6728 0a20 2020 2020      debug(.     
-00022e10: 2020 2020 2020 2022 636f 6d70 7574 6520         "compute 
-00022e20: 736f 6d65 2069 6e74 6572 6d65 6469 6174  some intermediat
-00022e30: 6573 2061 6865 6164 206f 6620 7469 6d65  es ahead of time
-00022e40: 2c20 746f 206d 696e 696d 6973 6520 636f  , to minimise co
-00022e50: 6d70 7574 6174 696f 6e20 6475 7269 6e67  mputation during
-00022e60: 206a 6163 6b6b 6e69 6665 2072 6573 616d   jackknife resam
-00022e70: 706c 696e 6722 0a20 2020 2020 2020 2029  pling".        )
-00022e80: 0a20 2020 2020 2020 206d 7064 5f64 6174  .        mpd_dat
-00022e90: 6120 3d20 616c 6c65 6c2e 6d65 616e 5f70  a = allel.mean_p
-00022ea0: 6169 7277 6973 655f 6469 6666 6572 656e  airwise_differen
-00022eb0: 6365 2861 632c 2066 696c 6c3d 3029 0a20  ce(ac, fill=0). 
-00022ec0: 2020 2020 2020 2023 204e 2e42 2e2c 2068         # N.B., h
-00022ed0: 6572 6520 7765 2063 6f6d 7075 7465 2074  ere we compute t
-00022ee0: 6865 206e 756d 6265 7220 6f66 2073 6567  he number of seg
-00022ef0: 7265 6761 7469 6e67 2073 6974 6573 2061  regating sites a
-00022f00: 7320 7468 6520 6e75 6d62 6572 0a20 2020  s the number.   
-00022f10: 2020 2020 2023 206f 6620 616c 6c65 6c65       # of allele
-00022f20: 7320 6d69 6e75 7320 312e 2054 6869 7320  s minus 1. This 
-00022f30: 666f 6c6c 6f77 7320 7468 6520 7367 6b69  follows the sgki
-00022f40: 7420 616e 6420 7473 6b69 7420 696d 706c  t and tskit impl
-00022f50: 656d 656e 7461 7469 6f6e 732c 0a20 2020  ementations,.   
-00022f60: 2020 2020 2023 2061 6e64 2069 7320 6469       # and is di
-00022f70: 6666 6572 656e 7420 6672 6f6d 2073 6369  fferent from sci
-00022f80: 6b69 742d 616c 6c65 6c2e 0a20 2020 2020  kit-allel..     
-00022f90: 2020 2073 6567 5f64 6174 6120 3d20 6163     seg_data = ac
-00022fa0: 2e61 6c6c 656c 6973 6d28 2920 2d20 310a  .allelism() - 1.
-00022fb0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00022fc0: 636f 6d70 7574 6520 6573 7469 6d61 7465  compute estimate
-00022fd0: 7320 6672 6f6d 2061 6c6c 2064 6174 6122  s from all data"
-00022fe0: 290a 2020 2020 2020 2020 7468 6574 615f  ).        theta_
-00022ff0: 7069 5f61 6273 5f64 6174 6120 3d20 6e70  pi_abs_data = np
-00023000: 2e73 756d 286d 7064 5f64 6174 6129 0a20  .sum(mpd_data). 
-00023010: 2020 2020 2020 2074 6865 7461 5f70 695f         theta_pi_
-00023020: 6461 7461 203d 2074 6865 7461 5f70 695f  data = theta_pi_
-00023030: 6162 735f 6461 7461 202f 206e 5f73 6974  abs_data / n_sit
-00023040: 6573 0a20 2020 2020 2020 2053 5f64 6174  es.        S_dat
-00023050: 6120 3d20 6e70 2e73 756d 2873 6567 5f64  a = np.sum(seg_d
-00023060: 6174 6129 0a20 2020 2020 2020 2074 6865  ata).        the
-00023070: 7461 5f77 5f61 6273 5f64 6174 6120 3d20  ta_w_abs_data = 
-00023080: 535f 6461 7461 202f 2061 310a 2020 2020  S_data / a1.    
-00023090: 2020 2020 7468 6574 615f 775f 6461 7461      theta_w_data
-000230a0: 203d 2074 6865 7461 5f77 5f61 6273 5f64   = theta_w_abs_d
-000230b0: 6174 6120 2f20 6e5f 7369 7465 730a 2020  ata / n_sites.  
-000230c0: 2020 2020 2020 645f 6461 7461 203d 2074        d_data = t
-000230d0: 6865 7461 5f70 695f 6162 735f 6461 7461  heta_pi_abs_data
-000230e0: 202d 2074 6865 7461 5f77 5f61 6273 5f64   - theta_w_abs_d
-000230f0: 6174 610a 2020 2020 2020 2020 645f 7374  ata.        d_st
-00023100: 6465 765f 6461 7461 203d 206e 702e 7371  dev_data = np.sq
-00023110: 7274 2828 6531 202a 2053 5f64 6174 6129  rt((e1 * S_data)
-00023120: 202b 2028 6532 202a 2053 5f64 6174 6120   + (e2 * S_data 
-00023130: 2a20 2853 5f64 6174 6120 2d20 3129 2929  * (S_data - 1)))
-00023140: 0a20 2020 2020 2020 2074 616a 696d 615f  .        tajima_
-00023150: 645f 6461 7461 203d 2064 5f64 6174 6120  d_data = d_data 
-00023160: 2f20 645f 7374 6465 765f 6461 7461 0a0a  / d_stdev_data..
-00023170: 2020 2020 2020 2020 6465 6275 6728 2273          debug("s
-00023180: 6574 2075 7020 666f 7220 6a61 636b 6b6e  et up for jackkn
-00023190: 6966 6520 7265 7361 6d70 6c69 6e67 2229  ife resampling")
-000231a0: 0a20 2020 2020 2020 206a 6163 6b5f 7468  .        jack_th
-000231b0: 6574 615f 7069 203d 205b 5d0a 2020 2020  eta_pi = [].    
-000231c0: 2020 2020 6a61 636b 5f74 6865 7461 5f77      jack_theta_w
-000231d0: 203d 205b 5d0a 2020 2020 2020 2020 6a61   = [].        ja
-000231e0: 636b 5f74 616a 696d 615f 6420 3d20 5b5d  ck_tajima_d = []
-000231f0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00023200: 2262 6567 696e 206a 6163 6b6b 6e69 6665  "begin jackknife
-00023210: 2072 6573 616d 706c 696e 6722 290a 2020   resampling").  
-00023220: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00023230: 616e 6765 286e 5f6a 6163 6b29 3a0a 2020  ange(n_jack):.  
-00023240: 2020 2020 2020 2020 2020 2320 6c6f 6361            # loca
-00023250: 7465 2062 6c6f 636b 2074 6f20 6465 6c65  te block to dele
-00023260: 7465 0a20 2020 2020 2020 2020 2020 2062  te.            b
-00023270: 6c6f 636b 5f73 7461 7274 203d 2069 202a  lock_start = i *
-00023280: 2062 6c6f 636b 5f6c 656e 6774 680a 2020   block_length.  
-00023290: 2020 2020 2020 2020 2020 626c 6f63 6b5f            block_
-000232a0: 7374 6f70 203d 2062 6c6f 636b 5f73 7461  stop = block_sta
-000232b0: 7274 202b 2062 6c6f 636b 5f6c 656e 6774  rt + block_lengt
-000232c0: 680a 2020 2020 2020 2020 2020 2020 6c6f  h.            lo
-000232d0: 635f 6a20 3d20 6e70 2e6f 6e65 7328 6e5f  c_j = np.ones(n_
-000232e0: 7369 7465 732c 2064 7479 7065 3d62 6f6f  sites, dtype=boo
-000232f0: 6c29 0a20 2020 2020 2020 2020 2020 206c  l).            l
-00023300: 6f63 5f6a 5b62 6c6f 636b 5f73 7461 7274  oc_j[block_start
-00023310: 3a62 6c6f 636b 5f73 746f 705d 203d 2046  :block_stop] = F
-00023320: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00023330: 2061 7373 6572 7420 6e70 2e63 6f75 6e74   assert np.count
-00023340: 5f6e 6f6e 7a65 726f 286c 6f63 5f6a 2920  _nonzero(loc_j) 
-00023350: 3d3d 206e 5f73 6974 6573 5f6a 0a0a 2020  == n_sites_j..  
-00023360: 2020 2020 2020 2020 2020 2320 7265 7361            # resa
-00023370: 6d70 6c65 2064 6174 6120 616e 6420 636f  mple data and co
-00023380: 6d70 7574 6520 7374 6174 6973 7469 6373  mpute statistics
-00023390: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000233a0: 7468 6574 615f 7069 0a20 2020 2020 2020  theta_pi.       
-000233b0: 2020 2020 206d 7064 5f6a 203d 206d 7064       mpd_j = mpd
-000233c0: 5f64 6174 615b 6c6f 635f 6a5d 0a20 2020  _data[loc_j].   
-000233d0: 2020 2020 2020 2020 2074 6865 7461 5f70           theta_p
-000233e0: 695f 6162 735f 6a20 3d20 6e70 2e73 756d  i_abs_j = np.sum
-000233f0: 286d 7064 5f6a 290a 2020 2020 2020 2020  (mpd_j).        
-00023400: 2020 2020 7468 6574 615f 7069 5f6a 203d      theta_pi_j =
-00023410: 2074 6865 7461 5f70 695f 6162 735f 6a20   theta_pi_abs_j 
-00023420: 2f20 6e5f 7369 7465 735f 6a0a 2020 2020  / n_sites_j.    
-00023430: 2020 2020 2020 2020 6a61 636b 5f74 6865          jack_the
-00023440: 7461 5f70 692e 6170 7065 6e64 2874 6865  ta_pi.append(the
-00023450: 7461 5f70 695f 6a29 0a0a 2020 2020 2020  ta_pi_j)..      
-00023460: 2020 2020 2020 2320 7468 6574 615f 770a        # theta_w.
-00023470: 2020 2020 2020 2020 2020 2020 7365 675f              seg_
-00023480: 6a20 3d20 7365 675f 6461 7461 5b6c 6f63  j = seg_data[loc
-00023490: 5f6a 5d0a 2020 2020 2020 2020 2020 2020  _j].            
-000234a0: 535f 6a20 3d20 6e70 2e73 756d 2873 6567  S_j = np.sum(seg
-000234b0: 5f6a 290a 2020 2020 2020 2020 2020 2020  _j).            
-000234c0: 7468 6574 615f 775f 6162 735f 6a20 3d20  theta_w_abs_j = 
-000234d0: 535f 6a20 2f20 6131 0a20 2020 2020 2020  S_j / a1.       
-000234e0: 2020 2020 2074 6865 7461 5f77 5f6a 203d       theta_w_j =
-000234f0: 2074 6865 7461 5f77 5f61 6273 5f6a 202f   theta_w_abs_j /
-00023500: 206e 5f73 6974 6573 5f6a 0a20 2020 2020   n_sites_j.     
-00023510: 2020 2020 2020 206a 6163 6b5f 7468 6574         jack_thet
-00023520: 615f 772e 6170 7065 6e64 2874 6865 7461  a_w.append(theta
-00023530: 5f77 5f6a 290a 0a20 2020 2020 2020 2020  _w_j)..         
-00023540: 2020 2023 2074 616a 696d 615f 640a 2020     # tajima_d.  
-00023550: 2020 2020 2020 2020 2020 645f 6a20 3d20            d_j = 
-00023560: 7468 6574 615f 7069 5f61 6273 5f6a 202d  theta_pi_abs_j -
-00023570: 2074 6865 7461 5f77 5f61 6273 5f6a 0a20   theta_w_abs_j. 
-00023580: 2020 2020 2020 2020 2020 2064 5f73 7464             d_std
-00023590: 6576 5f6a 203d 206e 702e 7371 7274 2828  ev_j = np.sqrt((
-000235a0: 6531 202a 2053 5f6a 2920 2b20 2865 3220  e1 * S_j) + (e2 
-000235b0: 2a20 535f 6a20 2a20 2853 5f6a 202d 2031  * S_j * (S_j - 1
-000235c0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-000235d0: 7461 6a69 6d61 5f64 5f6a 203d 2064 5f6a  tajima_d_j = d_j
-000235e0: 202f 2064 5f73 7464 6576 5f6a 0a20 2020   / d_stdev_j.   
-000235f0: 2020 2020 2020 2020 206a 6163 6b5f 7461           jack_ta
-00023600: 6a69 6d61 5f64 2e61 7070 656e 6428 7461  jima_d.append(ta
-00023610: 6a69 6d61 5f64 5f6a 290a 0a20 2020 2020  jima_d_j)..     
-00023620: 2020 2023 2063 616c 6375 6c61 7465 206a     # calculate j
-00023630: 6163 6b6b 6e69 6665 2073 7461 7473 0a20  ackknife stats. 
-00023640: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-00023650: 2020 2020 2074 6865 7461 5f70 695f 6573       theta_pi_es
-00023660: 7469 6d61 7465 2c0a 2020 2020 2020 2020  timate,.        
-00023670: 2020 2020 7468 6574 615f 7069 5f62 6961      theta_pi_bia
-00023680: 732c 0a20 2020 2020 2020 2020 2020 2074  s,.            t
-00023690: 6865 7461 5f70 695f 7374 645f 6572 722c  heta_pi_std_err,
-000236a0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-000236b0: 7461 5f70 695f 6369 5f65 7272 2c0a 2020  ta_pi_ci_err,.  
-000236c0: 2020 2020 2020 2020 2020 7468 6574 615f            theta_
-000236d0: 7069 5f63 695f 6c6f 772c 0a20 2020 2020  pi_ci_low,.     
-000236e0: 2020 2020 2020 2074 6865 7461 5f70 695f         theta_pi_
-000236f0: 6369 5f75 7070 2c0a 2020 2020 2020 2020  ci_upp,.        
-00023700: 2920 3d20 6a61 636b 6b6e 6966 655f 6369  ) = jackknife_ci
-00023710: 280a 2020 2020 2020 2020 2020 2020 7374  (.            st
-00023720: 6174 5f64 6174 613d 7468 6574 615f 7069  at_data=theta_pi
-00023730: 5f64 6174 612c 0a20 2020 2020 2020 2020  _data,.         
-00023740: 2020 206a 6163 6b5f 7374 6174 3d6a 6163     jack_stat=jac
-00023750: 6b5f 7468 6574 615f 7069 2c0a 2020 2020  k_theta_pi,.    
-00023760: 2020 2020 2020 2020 636f 6e66 6964 656e          confiden
-00023770: 6365 5f6c 6576 656c 3d63 6f6e 6669 6465  ce_level=confide
-00023780: 6e63 655f 6c65 7665 6c2c 0a20 2020 2020  nce_level,.     
-00023790: 2020 2029 0a20 2020 2020 2020 2028 0a20     ).        (. 
-000237a0: 2020 2020 2020 2020 2020 2074 6865 7461             theta
-000237b0: 5f77 5f65 7374 696d 6174 652c 0a20 2020  _w_estimate,.   
-000237c0: 2020 2020 2020 2020 2074 6865 7461 5f77           theta_w
-000237d0: 5f62 6961 732c 0a20 2020 2020 2020 2020  _bias,.         
-000237e0: 2020 2074 6865 7461 5f77 5f73 7464 5f65     theta_w_std_e
-000237f0: 7272 2c0a 2020 2020 2020 2020 2020 2020  rr,.            
-00023800: 7468 6574 615f 775f 6369 5f65 7272 2c0a  theta_w_ci_err,.
-00023810: 2020 2020 2020 2020 2020 2020 7468 6574              thet
-00023820: 615f 775f 6369 5f6c 6f77 2c0a 2020 2020  a_w_ci_low,.    
-00023830: 2020 2020 2020 2020 7468 6574 615f 775f          theta_w_
-00023840: 6369 5f75 7070 2c0a 2020 2020 2020 2020  ci_upp,.        
-00023850: 2920 3d20 6a61 636b 6b6e 6966 655f 6369  ) = jackknife_ci
-00023860: 280a 2020 2020 2020 2020 2020 2020 7374  (.            st
-00023870: 6174 5f64 6174 613d 7468 6574 615f 775f  at_data=theta_w_
-00023880: 6461 7461 2c0a 2020 2020 2020 2020 2020  data,.          
-00023890: 2020 6a61 636b 5f73 7461 743d 6a61 636b    jack_stat=jack
-000238a0: 5f74 6865 7461 5f77 2c0a 2020 2020 2020  _theta_w,.      
-000238b0: 2020 2020 2020 636f 6e66 6964 656e 6365        confidence
-000238c0: 5f6c 6576 656c 3d63 6f6e 6669 6465 6e63  _level=confidenc
-000238d0: 655f 6c65 7665 6c2c 0a20 2020 2020 2020  e_level,.       
-000238e0: 2029 0a20 2020 2020 2020 2028 0a20 2020   ).        (.   
-000238f0: 2020 2020 2020 2020 2074 616a 696d 615f           tajima_
-00023900: 645f 6573 7469 6d61 7465 2c0a 2020 2020  d_estimate,.    
-00023910: 2020 2020 2020 2020 7461 6a69 6d61 5f64          tajima_d
-00023920: 5f62 6961 732c 0a20 2020 2020 2020 2020  _bias,.         
-00023930: 2020 2074 616a 696d 615f 645f 7374 645f     tajima_d_std_
-00023940: 6572 722c 0a20 2020 2020 2020 2020 2020  err,.           
-00023950: 2074 616a 696d 615f 645f 6369 5f65 7272   tajima_d_ci_err
-00023960: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
-00023970: 6a69 6d61 5f64 5f63 695f 6c6f 772c 0a20  jima_d_ci_low,. 
-00023980: 2020 2020 2020 2020 2020 2074 616a 696d             tajim
-00023990: 615f 645f 6369 5f75 7070 2c0a 2020 2020  a_d_ci_upp,.    
-000239a0: 2020 2020 2920 3d20 6a61 636b 6b6e 6966      ) = jackknif
-000239b0: 655f 6369 280a 2020 2020 2020 2020 2020  e_ci(.          
-000239c0: 2020 7374 6174 5f64 6174 613d 7461 6a69    stat_data=taji
-000239d0: 6d61 5f64 5f64 6174 612c 0a20 2020 2020  ma_d_data,.     
-000239e0: 2020 2020 2020 206a 6163 6b5f 7374 6174         jack_stat
-000239f0: 3d6a 6163 6b5f 7461 6a69 6d61 5f64 2c0a  =jack_tajima_d,.
-00023a00: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00023a10: 6964 656e 6365 5f6c 6576 656c 3d63 6f6e  idence_level=con
-00023a20: 6669 6465 6e63 655f 6c65 7665 6c2c 0a20  fidence_level,. 
-00023a30: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00023a40: 2020 7265 7475 726e 2064 6963 7428 0a20    return dict(. 
-00023a50: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
-00023a60: 743d 636f 686f 7274 5f6c 6162 656c 2c0a  t=cohort_label,.
-00023a70: 2020 2020 2020 2020 2020 2020 7468 6574              thet
-00023a80: 615f 7069 3d74 6865 7461 5f70 695f 6461  a_pi=theta_pi_da
-00023a90: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
-00023aa0: 7468 6574 615f 7069 5f65 7374 696d 6174  theta_pi_estimat
-00023ab0: 653d 7468 6574 615f 7069 5f65 7374 696d  e=theta_pi_estim
-00023ac0: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-00023ad0: 2074 6865 7461 5f70 695f 6269 6173 3d74   theta_pi_bias=t
-00023ae0: 6865 7461 5f70 695f 6269 6173 2c0a 2020  heta_pi_bias,.  
-00023af0: 2020 2020 2020 2020 2020 7468 6574 615f            theta_
-00023b00: 7069 5f73 7464 5f65 7272 3d74 6865 7461  pi_std_err=theta
-00023b10: 5f70 695f 7374 645f 6572 722c 0a20 2020  _pi_std_err,.   
-00023b20: 2020 2020 2020 2020 2074 6865 7461 5f70           theta_p
-00023b30: 695f 6369 5f65 7272 3d74 6865 7461 5f70  i_ci_err=theta_p
-00023b40: 695f 6369 5f65 7272 2c0a 2020 2020 2020  i_ci_err,.      
-00023b50: 2020 2020 2020 7468 6574 615f 7069 5f63        theta_pi_c
-00023b60: 695f 6c6f 773d 7468 6574 615f 7069 5f63  i_low=theta_pi_c
-00023b70: 695f 6c6f 772c 0a20 2020 2020 2020 2020  i_low,.         
-00023b80: 2020 2074 6865 7461 5f70 695f 6369 5f75     theta_pi_ci_u
-00023b90: 7070 3d74 6865 7461 5f70 695f 6369 5f75  pp=theta_pi_ci_u
-00023ba0: 7070 2c0a 2020 2020 2020 2020 2020 2020  pp,.            
-00023bb0: 7468 6574 615f 773d 7468 6574 615f 775f  theta_w=theta_w_
-00023bc0: 6461 7461 2c0a 2020 2020 2020 2020 2020  data,.          
-00023bd0: 2020 7468 6574 615f 775f 6573 7469 6d61    theta_w_estima
-00023be0: 7465 3d74 6865 7461 5f77 5f65 7374 696d  te=theta_w_estim
-00023bf0: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-00023c00: 2074 6865 7461 5f77 5f62 6961 733d 7468   theta_w_bias=th
-00023c10: 6574 615f 775f 6269 6173 2c0a 2020 2020  eta_w_bias,.    
-00023c20: 2020 2020 2020 2020 7468 6574 615f 775f          theta_w_
-00023c30: 7374 645f 6572 723d 7468 6574 615f 775f  std_err=theta_w_
-00023c40: 7374 645f 6572 722c 0a20 2020 2020 2020  std_err,.       
-00023c50: 2020 2020 2074 6865 7461 5f77 5f63 695f       theta_w_ci_
-00023c60: 6572 723d 7468 6574 615f 775f 6369 5f65  err=theta_w_ci_e
-00023c70: 7272 2c0a 2020 2020 2020 2020 2020 2020  rr,.            
-00023c80: 7468 6574 615f 775f 6369 5f6c 6f77 3d74  theta_w_ci_low=t
-00023c90: 6865 7461 5f77 5f63 695f 6c6f 772c 0a20  heta_w_ci_low,. 
-00023ca0: 2020 2020 2020 2020 2020 2074 6865 7461             theta
-00023cb0: 5f77 5f63 695f 7570 703d 7468 6574 615f  _w_ci_upp=theta_
-00023cc0: 775f 6369 5f75 7070 2c0a 2020 2020 2020  w_ci_upp,.      
-00023cd0: 2020 2020 2020 7461 6a69 6d61 5f64 3d74        tajima_d=t
-00023ce0: 616a 696d 615f 645f 6461 7461 2c0a 2020  ajima_d_data,.  
-00023cf0: 2020 2020 2020 2020 2020 7461 6a69 6d61            tajima
-00023d00: 5f64 5f65 7374 696d 6174 653d 7461 6a69  _d_estimate=taji
-00023d10: 6d61 5f64 5f65 7374 696d 6174 652c 0a20  ma_d_estimate,. 
-00023d20: 2020 2020 2020 2020 2020 2074 616a 696d             tajim
-00023d30: 615f 645f 6269 6173 3d74 616a 696d 615f  a_d_bias=tajima_
-00023d40: 645f 6269 6173 2c0a 2020 2020 2020 2020  d_bias,.        
-00023d50: 2020 2020 7461 6a69 6d61 5f64 5f73 7464      tajima_d_std
-00023d60: 5f65 7272 3d74 616a 696d 615f 645f 7374  _err=tajima_d_st
-00023d70: 645f 6572 722c 0a20 2020 2020 2020 2020  d_err,.         
-00023d80: 2020 2074 616a 696d 615f 645f 6369 5f65     tajima_d_ci_e
-00023d90: 7272 3d74 616a 696d 615f 645f 6369 5f65  rr=tajima_d_ci_e
-00023da0: 7272 2c0a 2020 2020 2020 2020 2020 2020  rr,.            
-00023db0: 7461 6a69 6d61 5f64 5f63 695f 6c6f 773d  tajima_d_ci_low=
-00023dc0: 7461 6a69 6d61 5f64 5f63 695f 6c6f 772c  tajima_d_ci_low,
-00023dd0: 0a20 2020 2020 2020 2020 2020 2074 616a  .            taj
-00023de0: 696d 615f 645f 6369 5f75 7070 3d74 616a  ima_d_ci_upp=taj
-00023df0: 696d 615f 645f 6369 5f75 7070 2c0a 2020  ima_d_ci_upp,.  
-00023e00: 2020 2020 2020 290a 0a20 2020 2040 646f        )..    @do
-00023e10: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
-00023e20: 7279 3d22 2222 0a20 2020 2020 2020 2020  ry=""".         
-00023e30: 2020 2043 6f6d 7075 7465 2067 656e 6574     Compute genet
-00023e40: 6963 2064 6976 6572 7369 7479 2073 756d  ic diversity sum
-00023e50: 6d61 7279 2073 7461 7469 7374 6963 7320  mary statistics 
-00023e60: 666f 7220 6120 636f 686f 7274 206f 660a  for a cohort of.
-00023e70: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00023e80: 7669 6475 616c 732e 0a20 2020 2020 2020  viduals..       
-00023e90: 2022 2222 2c0a 2020 2020 2020 2020 7265   """,.        re
-00023ea0: 7475 726e 733d 2222 220a 2020 2020 2020  turns=""".      
-00023eb0: 2020 2020 2020 4120 7061 6e64 6173 2073        A pandas s
-00023ec0: 6572 6965 7320 7769 7468 2073 756d 6d61  eries with summa
-00023ed0: 7279 2073 7461 7469 7374 6963 7320 616e  ry statistics an
-00023ee0: 6420 7468 6569 7220 636f 6e66 6964 656e  d their confiden
-00023ef0: 6365 0a20 2020 2020 2020 2020 2020 2069  ce.            i
-00023f00: 6e74 6572 7661 6c73 2e0a 2020 2020 2020  ntervals..      
-00023f10: 2020 2222 222c 0a20 2020 2029 0a20 2020    """,.    ).   
-00023f20: 2064 6566 2063 6f68 6f72 745f 6469 7665   def cohort_dive
-00023f30: 7273 6974 795f 7374 6174 7328 0a20 2020  rsity_stats(.   
-00023f40: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00023f50: 2020 2063 6f68 6f72 743a 2062 6173 655f     cohort: base_
-00023f60: 7061 7261 6d73 2e63 6f68 6f72 742c 0a20  params.cohort,. 
-00023f70: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
-00023f80: 7a65 3a20 6261 7365 5f70 6172 616d 732e  ze: base_params.
-00023f90: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
-00023fa0: 2020 2020 2072 6567 696f 6e3a 2062 6173       region: bas
-00023fb0: 655f 7061 7261 6d73 2e72 6567 696f 6e2c  e_params.region,
-00023fc0: 0a20 2020 2020 2020 2073 6974 655f 6d61  .        site_ma
-00023fd0: 736b 3a20 4f70 7469 6f6e 616c 5b62 6173  sk: Optional[bas
-00023fe0: 655f 7061 7261 6d73 2e73 6974 655f 6d61  e_params.site_ma
-00023ff0: 736b 5d20 3d20 4445 4641 554c 542c 0a20  sk] = DEFAULT,. 
-00024000: 2020 2020 2020 2073 6974 655f 636c 6173         site_clas
-00024010: 733a 204f 7074 696f 6e61 6c5b 6261 7365  s: Optional[base
-00024020: 5f70 6172 616d 732e 7369 7465 5f63 6c61  _params.site_cla
-00024030: 7373 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ss] = None,.    
-00024040: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
-00024050: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00024060: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
-00024070: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-00024080: 2020 2072 616e 646f 6d5f 7365 6564 3a20     random_seed: 
-00024090: 6261 7365 5f70 6172 616d 732e 7261 6e64  base_params.rand
-000240a0: 6f6d 5f73 6565 6420 3d20 3432 2c0a 2020  om_seed = 42,.  
-000240b0: 2020 2020 2020 6e5f 6a61 636b 3a20 6261        n_jack: ba
-000240c0: 7365 5f70 6172 616d 732e 6e5f 6a61 636b  se_params.n_jack
-000240d0: 203d 2032 3030 2c0a 2020 2020 2020 2020   = 200,.        
-000240e0: 636f 6e66 6964 656e 6365 5f6c 6576 656c  confidence_level
-000240f0: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
-00024100: 6e66 6964 656e 6365 5f6c 6576 656c 203d  nfidence_level =
-00024110: 2030 2e39 352c 0a20 2020 2029 202d 3e20   0.95,.    ) -> 
-00024120: 7064 2e53 6572 6965 733a 0a20 2020 2020  pd.Series:.     
-00024130: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-00024140: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-00024150: 2020 2020 6465 6275 6728 2270 726f 6365      debug("proce
-00024160: 7373 2063 6f68 6f72 7420 7061 7261 6d65  ss cohort parame
-00024170: 7465 7222 290a 2020 2020 2020 2020 636f  ter").        co
-00024180: 686f 7274 5f71 7565 7279 203d 204e 6f6e  hort_query = Non
-00024190: 650a 2020 2020 2020 2020 6966 2069 7369  e.        if isi
-000241a0: 6e73 7461 6e63 6528 636f 686f 7274 2c20  nstance(cohort, 
-000241b0: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-000241c0: 2020 2320 6173 7375 6d65 2069 7420 6973    # assume it is
-000241d0: 206f 6e65 206f 6620 7468 6520 7072 6564   one of the pred
-000241e0: 6566 696e 6564 2063 6f68 6f72 7473 0a20  efined cohorts. 
-000241f0: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
-00024200: 745f 6c61 6265 6c20 3d20 636f 686f 7274  t_label = cohort
-00024210: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-00024220: 7361 6d70 6c65 7320 3d20 7365 6c66 2e73  samples = self.s
-00024230: 616d 706c 655f 6d65 7461 6461 7461 2873  ample_metadata(s
-00024240: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
-00024250: 655f 7365 7473 290a 2020 2020 2020 2020  e_sets).        
-00024260: 2020 2020 636f 686f 7274 5f63 6f6c 7320      cohort_cols 
-00024270: 3d20 5b63 2066 6f72 2063 2069 6e20 6466  = [c for c in df
-00024280: 5f73 616d 706c 6573 2e63 6f6c 756d 6e73  _samples.columns
-00024290: 2069 6620 632e 7374 6172 7473 7769 7468   if c.startswith
-000242a0: 2822 636f 686f 7274 5f22 295d 0a20 2020  ("cohort_")].   
-000242b0: 2020 2020 2020 2020 2066 6f72 2063 2069           for c i
-000242c0: 6e20 636f 686f 7274 5f63 6f6c 733a 0a20  n cohort_cols:. 
-000242d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000242e0: 6620 636f 686f 7274 2069 6e20 7365 7428  f cohort in set(
-000242f0: 6466 5f73 616d 706c 6573 5b63 5d29 3a0a  df_samples[c]):.
-00024300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024310: 2020 2020 636f 686f 7274 5f71 7565 7279      cohort_query
-00024320: 203d 2066 227b 637d 203d 3d20 277b 636f   = f"{c} == '{co
-00024330: 686f 7274 7d27 220a 2020 2020 2020 2020  hort}'".        
-00024340: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00024350: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
-00024360: 2063 6f68 6f72 745f 7175 6572 7920 6973   cohort_query is
-00024370: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00024380: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00024390: 7565 4572 726f 7228 6622 756e 6b6e 6f77  ueError(f"unknow
-000243a0: 6e20 636f 686f 7274 3a20 7b63 6f68 6f72  n cohort: {cohor
-000243b0: 747d 2229 0a0a 2020 2020 2020 2020 656c  t}")..        el
-000243c0: 6966 2069 7369 6e73 7461 6e63 6528 636f  if isinstance(co
-000243d0: 686f 7274 2c20 286c 6973 742c 2074 7570  hort, (list, tup
-000243e0: 6c65 2929 2061 6e64 206c 656e 2863 6f68  le)) and len(coh
-000243f0: 6f72 7429 203d 3d20 323a 0a20 2020 2020  ort) == 2:.     
-00024400: 2020 2020 2020 2063 6f68 6f72 745f 6c61         cohort_la
-00024410: 6265 6c2c 2063 6f68 6f72 745f 7175 6572  bel, cohort_quer
-00024420: 7920 3d20 636f 686f 7274 0a0a 2020 2020  y = cohort..    
-00024430: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00024440: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00024450: 4572 726f 7228 7222 696e 7661 6c69 6420  Error(r"invalid 
-00024460: 636f 686f 7274 2070 6172 616d 6574 6572  cohort parameter
-00024470: 3a20 7b63 6f68 6f72 7421 727d 2229 0a0a  : {cohort!r}")..
-00024480: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-00024490: 6363 6573 7320 616c 6c65 6c65 2063 6f75  ccess allele cou
-000244a0: 6e74 7322 290a 2020 2020 2020 2020 6163  nts").        ac
-000244b0: 203d 2073 656c 662e 736e 705f 616c 6c65   = self.snp_alle
-000244c0: 6c65 5f63 6f75 6e74 7328 0a20 2020 2020  le_counts(.     
-000244d0: 2020 2020 2020 2072 6567 696f 6e3d 7265         region=re
-000244e0: 6769 6f6e 2c0a 2020 2020 2020 2020 2020  gion,.          
-000244f0: 2020 7369 7465 5f6d 6173 6b3d 7369 7465    site_mask=site
-00024500: 5f6d 6173 6b2c 0a20 2020 2020 2020 2020  _mask,.         
-00024510: 2020 2073 6974 655f 636c 6173 733d 7369     site_class=si
-00024520: 7465 5f63 6c61 7373 2c0a 2020 2020 2020  te_class,.      
-00024530: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
-00024540: 7279 3d63 6f68 6f72 745f 7175 6572 792c  ry=cohort_query,
-00024550: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00024560: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-00024570: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
-00024580: 2020 636f 686f 7274 5f73 697a 653d 636f    cohort_size=co
-00024590: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-000245a0: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-000245b0: 6564 3d72 616e 646f 6d5f 7365 6564 2c0a  ed=random_seed,.
-000245c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000245d0: 2020 2064 6562 7567 2822 636f 6d70 7574     debug("comput
-000245e0: 6520 6469 7665 7273 6974 7920 7374 6174  e diversity stat
-000245f0: 7322 290a 2020 2020 2020 2020 7374 6174  s").        stat
-00024600: 7320 3d20 7365 6c66 2e5f 626c 6f63 6b5f  s = self._block_
-00024610: 6a61 636b 6b6e 6966 655f 636f 686f 7274  jackknife_cohort
-00024620: 5f64 6976 6572 7369 7479 5f73 7461 7473  _diversity_stats
-00024630: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
-00024640: 686f 7274 5f6c 6162 656c 3d63 6f68 6f72  hort_label=cohor
-00024650: 745f 6c61 6265 6c2c 0a20 2020 2020 2020  t_label,.       
-00024660: 2020 2020 2061 633d 6163 2c0a 2020 2020       ac=ac,.    
-00024670: 2020 2020 2020 2020 6e5f 6a61 636b 3d6e          n_jack=n
-00024680: 5f6a 6163 6b2c 0a20 2020 2020 2020 2020  _jack,.         
-00024690: 2020 2063 6f6e 6669 6465 6e63 655f 6c65     confidence_le
-000246a0: 7665 6c3d 636f 6e66 6964 656e 6365 5f6c  vel=confidence_l
-000246b0: 6576 656c 2c0a 2020 2020 2020 2020 290a  evel,.        ).
-000246c0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-000246d0: 636f 6d70 7574 6520 736f 6d65 2065 7874  compute some ext
-000246e0: 7261 2063 6f68 6f72 7420 7661 7269 6162  ra cohort variab
-000246f0: 6c65 7322 290a 2020 2020 2020 2020 6466  les").        df
-00024700: 5f73 616d 706c 6573 203d 2073 656c 662e  _samples = self.
-00024710: 7361 6d70 6c65 5f6d 6574 6164 6174 6128  sample_metadata(
-00024720: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00024730: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-00024740: 7365 7473 2c20 7361 6d70 6c65 5f71 7565  sets, sample_que
-00024750: 7279 3d63 6f68 6f72 745f 7175 6572 790a  ry=cohort_query.
-00024760: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00024770: 2020 6578 7472 615f 6669 656c 6473 203d    extra_fields =
-00024780: 205b 0a20 2020 2020 2020 2020 2020 2028   [.            (
-00024790: 2274 6178 6f6e 222c 2022 756e 6971 7565  "taxon", "unique
-000247a0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-000247b0: 2822 7965 6172 222c 2022 756e 6971 7565  ("year", "unique
-000247c0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-000247d0: 2822 6d6f 6e74 6822 2c20 2275 6e69 7175  ("month", "uniqu
-000247e0: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-000247f0: 2028 2263 6f75 6e74 7279 222c 2022 756e   ("country", "un
-00024800: 6971 7565 2229 2c0a 2020 2020 2020 2020  ique"),.        
-00024810: 2020 2020 2822 6164 6d69 6e31 5f69 736f      ("admin1_iso
-00024820: 222c 2022 756e 6971 7565 2229 2c0a 2020  ", "unique"),.  
-00024830: 2020 2020 2020 2020 2020 2822 6164 6d69            ("admi
-00024840: 6e31 5f6e 616d 6522 2c20 2275 6e69 7175  n1_name", "uniqu
-00024850: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00024860: 2028 2261 646d 696e 325f 6e61 6d65 222c   ("admin2_name",
-00024870: 2022 756e 6971 7565 2229 2c0a 2020 2020   "unique"),.    
-00024880: 2020 2020 2020 2020 2822 6c6f 6e67 6974          ("longit
-00024890: 7564 6522 2c20 226d 6561 6e22 292c 0a20  ude", "mean"),. 
-000248a0: 2020 2020 2020 2020 2020 2028 226c 6174             ("lat
-000248b0: 6974 7564 6522 2c20 226d 6561 6e22 292c  itude", "mean"),
-000248c0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-000248d0: 2020 2066 6f72 2066 6965 6c64 2c20 6167     for field, ag
-000248e0: 6720 696e 2065 7874 7261 5f66 6965 6c64  g in extra_field
-000248f0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00024900: 6620 6167 6720 3d3d 2022 756e 6971 7565  f agg == "unique
-00024910: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00024920: 2020 2076 616c 7320 3d20 6466 5f73 616d     vals = df_sam
-00024930: 706c 6573 5b66 6965 6c64 5d2e 736f 7274  ples[field].sort
-00024940: 5f76 616c 7565 7328 292e 756e 6971 7565  _values().unique
-00024950: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00024960: 2020 2069 6620 6c65 6e28 7661 6c73 2920     if len(vals) 
-00024970: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00024980: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-00024990: 6e70 2e6e 616e 0a20 2020 2020 2020 2020  np.nan.         
-000249a0: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-000249b0: 7661 6c73 2920 3d3d 2031 3a0a 2020 2020  vals) == 1:.    
-000249c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000249d0: 7661 6c20 3d20 7661 6c73 5b30 5d0a 2020  val = vals[0].  
-000249e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000249f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00024a00: 2020 2020 2020 2020 7661 6c20 3d20 7661          val = va
-00024a10: 6c73 2e74 6f6c 6973 7428 290a 2020 2020  ls.tolist().    
-00024a20: 2020 2020 2020 2020 656c 6966 2061 6767          elif agg
-00024a30: 203d 3d20 226d 6561 6e22 3a0a 2020 2020   == "mean":.    
-00024a40: 2020 2020 2020 2020 2020 2020 7661 6c73              vals
-00024a50: 203d 2064 665f 7361 6d70 6c65 735b 6669   = df_samples[fi
-00024a60: 656c 645d 0a20 2020 2020 2020 2020 2020  eld].           
-00024a70: 2020 2020 2069 6620 6c65 6e28 7661 6c73       if len(vals
-00024a80: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00024a90: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00024aa0: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
-00024ab0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00024ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ad0: 2020 2076 616c 203d 206e 702e 6d65 616e     val = np.mean
-00024ae0: 2876 616c 7329 0a20 2020 2020 2020 2020  (vals).         
-00024af0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00024b00: 2020 2020 2020 2020 2076 616c 203d 206e           val = n
-00024b10: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
-00024b20: 2020 7374 6174 735b 6669 656c 645d 203d    stats[field] =
-00024b30: 2076 616c 0a0a 2020 2020 2020 2020 7265   val..        re
-00024b40: 7475 726e 2070 642e 5365 7269 6573 2873  turn pd.Series(s
-00024b50: 7461 7473 290a 0a20 2020 2040 646f 6328  tats)..    @doc(
-00024b60: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-00024b70: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-00024b80: 2043 6f6d 7075 7465 2067 656e 6574 6963   Compute genetic
-00024b90: 2064 6976 6572 7369 7479 2073 756d 6d61   diversity summa
-00024ba0: 7279 2073 7461 7469 7374 6963 7320 666f  ry statistics fo
-00024bb0: 7220 6d75 6c74 6970 6c65 2063 6f68 6f72  r multiple cohor
-00024bc0: 7473 2e0a 2020 2020 2020 2020 2222 222c  ts..        """,
-00024bd0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
-00024be0: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-00024bf0: 2041 2044 6174 6146 7261 6d65 2077 6865   A DataFrame whe
-00024c00: 7265 2065 6163 6820 726f 7720 7072 6f76  re each row prov
-00024c10: 6964 6573 2073 756d 6d61 7279 2073 7461  ides summary sta
-00024c20: 7469 7374 6963 7320 616e 6420 7468 6569  tistics and thei
-00024c30: 720a 2020 2020 2020 2020 2020 2020 636f  r.            co
-00024c40: 6e66 6964 656e 6365 2069 6e74 6572 7661  nfidence interva
-00024c50: 6c73 2066 6f72 2061 2073 696e 676c 6520  ls for a single 
-00024c60: 636f 686f 7274 2e0a 2020 2020 2020 2020  cohort..        
-00024c70: 2222 222c 0a20 2020 2029 0a20 2020 2064  """,.    ).    d
-00024c80: 6566 2064 6976 6572 7369 7479 5f73 7461  ef diversity_sta
-00024c90: 7473 280a 2020 2020 2020 2020 7365 6c66  ts(.        self
-00024ca0: 2c0a 2020 2020 2020 2020 636f 686f 7274  ,.        cohort
-00024cb0: 733a 2062 6173 655f 7061 7261 6d73 2e63  s: base_params.c
-00024cc0: 6f68 6f72 7473 2c0a 2020 2020 2020 2020  ohorts,.        
-00024cd0: 636f 686f 7274 5f73 697a 653a 2062 6173  cohort_size: bas
-00024ce0: 655f 7061 7261 6d73 2e63 6f68 6f72 745f  e_params.cohort_
-00024cf0: 7369 7a65 2c0a 2020 2020 2020 2020 7265  size,.        re
-00024d00: 6769 6f6e 3a20 6261 7365 5f70 6172 616d  gion: base_param
-00024d10: 732e 7265 6769 6f6e 2c0a 2020 2020 2020  s.region,.      
-00024d20: 2020 7369 7465 5f6d 6173 6b3a 2062 6173    site_mask: bas
-00024d30: 655f 7061 7261 6d73 2e73 6974 655f 6d61  e_params.site_ma
-00024d40: 736b 203d 2044 4546 4155 4c54 2c0a 2020  sk = DEFAULT,.  
-00024d50: 2020 2020 2020 7369 7465 5f63 6c61 7373        site_class
-00024d60: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-00024d70: 7061 7261 6d73 2e73 6974 655f 636c 6173  params.site_clas
-00024d80: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-00024d90: 2020 2073 616d 706c 655f 7175 6572 793a     sample_query:
-00024da0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00024db0: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
-00024dc0: 7279 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ry] = None,.    
-00024dd0: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
-00024de0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00024df0: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
-00024e00: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-00024e10: 2020 2072 616e 646f 6d5f 7365 6564 3a20     random_seed: 
-00024e20: 6261 7365 5f70 6172 616d 732e 7261 6e64  base_params.rand
-00024e30: 6f6d 5f73 6565 6420 3d20 3432 2c0a 2020  om_seed = 42,.  
-00024e40: 2020 2020 2020 6e5f 6a61 636b 3a20 6261        n_jack: ba
-00024e50: 7365 5f70 6172 616d 732e 6e5f 6a61 636b  se_params.n_jack
-00024e60: 203d 2032 3030 2c0a 2020 2020 2020 2020   = 200,.        
-00024e70: 636f 6e66 6964 656e 6365 5f6c 6576 656c  confidence_level
-00024e80: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
-00024e90: 6e66 6964 656e 6365 5f6c 6576 656c 203d  nfidence_level =
-00024ea0: 2030 2e39 352c 0a20 2020 2029 202d 3e20   0.95,.    ) -> 
-00024eb0: 7064 2e44 6174 6146 7261 6d65 3a0a 2020  pd.DataFrame:.  
-00024ec0: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
-00024ed0: 6c66 2e5f 6c6f 672e 6465 6275 670a 2020  lf._log.debug.  
-00024ee0: 2020 2020 2020 696e 666f 203d 2073 656c        info = sel
-00024ef0: 662e 5f6c 6f67 2e69 6e66 6f0a 0a20 2020  f._log.info..   
-00024f00: 2020 2020 2064 6562 7567 2822 7365 7420       debug("set 
-00024f10: 7570 2063 6f68 6f72 7473 2229 0a20 2020  up cohorts").   
-00024f20: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00024f30: 6365 2863 6f68 6f72 7473 2c20 6469 6374  ce(cohorts, dict
-00024f40: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-00024f50: 2075 7365 7220 6861 7320 7375 7070 6c69   user has suppli
-00024f60: 6564 2061 2063 7573 746f 6d20 6469 6374  ed a custom dict
-00024f70: 696f 6e61 7279 206d 6170 7069 6e67 2063  ionary mapping c
-00024f80: 6f68 6f72 7420 6964 656e 7469 6669 6572  ohort identifier
-00024f90: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
-00024fa0: 746f 2070 616e 6461 7320 7175 6572 6965  to pandas querie
-00024fb0: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
-00024fc0: 686f 7274 5f71 7565 7269 6573 203d 2063  hort_queries = c
-00024fd0: 6f68 6f72 7473 0a0a 2020 2020 2020 2020  ohorts..        
-00024fe0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00024ff0: 636f 686f 7274 732c 2073 7472 293a 0a20  cohorts, str):. 
-00025000: 2020 2020 2020 2020 2020 2023 2075 7365             # use
-00025010: 7220 6861 7320 7375 7070 6c69 6564 206f  r has supplied o
-00025020: 6e65 206f 6620 7468 6520 7072 6564 6566  ne of the predef
-00025030: 696e 6564 2063 6f68 6f72 7420 7365 7473  ined cohort sets
-00025040: 0a0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00025050: 5f73 616d 706c 6573 203d 2073 656c 662e  _samples = self.
-00025060: 7361 6d70 6c65 5f6d 6574 6164 6174 6128  sample_metadata(
-00025070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025080: 2073 616d 706c 655f 7365 7473 3d73 616d   sample_sets=sam
-00025090: 706c 655f 7365 7473 2c20 7361 6d70 6c65  ple_sets, sample
-000250a0: 5f71 7565 7279 3d73 616d 706c 655f 7175  _query=sample_qu
-000250b0: 6572 790a 2020 2020 2020 2020 2020 2020  ery.            
-000250c0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-000250d0: 2064 6574 6572 6d69 6e65 2063 6f6c 756d   determine colum
-000250e0: 6e20 696e 2064 6174 6166 7261 6d65 202d  n in dataframe -
-000250f0: 2061 6c6c 6f77 2061 6262 7265 7669 6174   allow abbreviat
-00025100: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00025110: 6966 2063 6f68 6f72 7473 2e73 7461 7274  if cohorts.start
-00025120: 7377 6974 6828 2263 6f68 6f72 745f 2229  swith("cohort_")
-00025130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00025140: 2020 636f 686f 7274 735f 636f 6c20 3d20    cohorts_col = 
-00025150: 636f 686f 7274 730a 2020 2020 2020 2020  cohorts.        
-00025160: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00025170: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
-00025180: 735f 636f 6c20 3d20 2263 6f68 6f72 745f  s_col = "cohort_
-00025190: 2220 2b20 636f 686f 7274 730a 2020 2020  " + cohorts.    
-000251a0: 2020 2020 2020 2020 6966 2063 6f68 6f72          if cohor
-000251b0: 7473 5f63 6f6c 206e 6f74 2069 6e20 6466  ts_col not in df
-000251c0: 5f73 616d 706c 6573 2e63 6f6c 756d 6e73  _samples.columns
-000251d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000251e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000251f0: 6f72 2866 227b 636f 686f 7274 735f 636f  or(f"{cohorts_co
-00025200: 6c21 727d 2069 7320 6e6f 7420 6120 6b6e  l!r} is not a kn
-00025210: 6f77 6e20 636f 686f 7274 2073 6574 2229  own cohort set")
-00025220: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00025230: 6669 6e64 2063 6f68 6f72 7420 6c61 6265  find cohort labe
-00025240: 6c73 2061 6e64 2062 7569 6c64 2071 7565  ls and build que
-00025250: 7269 6573 2064 6963 7469 6f6e 6172 790a  ries dictionary.
-00025260: 2020 2020 2020 2020 2020 2020 636f 686f              coho
-00025270: 7274 5f6c 6162 656c 7320 3d20 736f 7274  rt_labels = sort
-00025280: 6564 2864 665f 7361 6d70 6c65 735b 636f  ed(df_samples[co
-00025290: 686f 7274 735f 636f 6c5d 2e64 726f 706e  horts_col].dropn
-000252a0: 6128 292e 756e 6971 7565 2829 290a 2020  a().unique()).  
-000252b0: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
-000252c0: 5f71 7565 7269 6573 203d 207b 636f 683a  _queries = {coh:
-000252d0: 2066 227b 636f 686f 7274 735f 636f 6c7d   f"{cohorts_col}
-000252e0: 203d 3d20 277b 636f 687d 2722 2066 6f72   == '{coh}'" for
-000252f0: 2063 6f68 2069 6e20 636f 686f 7274 5f6c   coh in cohort_l
-00025300: 6162 656c 737d 0a0a 2020 2020 2020 2020  abels}..        
-00025310: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00025320: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00025330: 7228 2263 6f68 6f72 7473 2070 6172 616d  r("cohorts param
-00025340: 6574 6572 2073 686f 756c 6420 6265 2064  eter should be d
-00025350: 6963 7420 6f72 2073 7472 2229 0a0a 2020  ict or str")..  
-00025360: 2020 2020 2020 6465 6275 6728 2268 616e        debug("han
-00025370: 646c 6520 7361 6d70 6c65 5f71 7565 7279  dle sample_query
-00025380: 2070 6172 616d 6574 6572 2229 0a20 2020   parameter").   
-00025390: 2020 2020 2069 6620 7361 6d70 6c65 5f71       if sample_q
-000253a0: 7565 7279 2069 7320 6e6f 7420 4e6f 6e65  uery is not None
-000253b0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-000253c0: 686f 7274 5f71 7565 7269 6573 203d 207b  hort_queries = {
-000253d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000253e0: 2063 6f68 6f72 745f 6c61 6265 6c3a 2066   cohort_label: f
-000253f0: 2228 7b63 6f68 6f72 745f 7175 6572 797d  "({cohort_query}
-00025400: 2920 616e 6420 287b 7361 6d70 6c65 5f71  ) and ({sample_q
-00025410: 7565 7279 7d29 220a 2020 2020 2020 2020  uery})".        
-00025420: 2020 2020 2020 2020 666f 7220 636f 686f          for coho
-00025430: 7274 5f6c 6162 656c 2c20 636f 686f 7274  rt_label, cohort
-00025440: 5f71 7565 7279 2069 6e20 636f 686f 7274  _query in cohort
-00025450: 5f71 7565 7269 6573 2e69 7465 6d73 2829  _queries.items()
-00025460: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-00025470: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
-00025480: 6865 636b 2063 6f68 6f72 7420 7369 7a65  heck cohort size
-00025490: 732c 2064 726f 7020 616e 7920 636f 686f  s, drop any coho
-000254a0: 7274 7320 7768 6963 6820 6172 6520 746f  rts which are to
-000254b0: 6f20 736d 616c 6c22 290a 2020 2020 2020  o small").      
-000254c0: 2020 636f 686f 7274 5f71 7565 7269 6573    cohort_queries
-000254d0: 5f63 6865 636b 6564 203d 2064 6963 7428  _checked = dict(
-000254e0: 290a 2020 2020 2020 2020 666f 7220 636f  ).        for co
-000254f0: 686f 7274 5f6c 6162 656c 2c20 636f 686f  hort_label, coho
-00025500: 7274 5f71 7565 7279 2069 6e20 636f 686f  rt_query in coho
-00025510: 7274 5f71 7565 7269 6573 2e69 7465 6d73  rt_queries.items
-00025520: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00025530: 6466 5f63 6f68 6f72 745f 7361 6d70 6c65  df_cohort_sample
-00025540: 7320 3d20 7365 6c66 2e73 616d 706c 655f  s = self.sample_
-00025550: 6d65 7461 6461 7461 280a 2020 2020 2020  metadata(.      
-00025560: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
-00025570: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
-00025580: 732c 2073 616d 706c 655f 7175 6572 793d  s, sample_query=
-00025590: 636f 686f 7274 5f71 7565 7279 0a20 2020  cohort_query.   
-000255a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000255b0: 2020 2020 2020 206e 5f73 616d 706c 6573         n_samples
-000255c0: 203d 206c 656e 2864 665f 636f 686f 7274   = len(df_cohort
-000255d0: 5f73 616d 706c 6573 290a 2020 2020 2020  _samples).      
-000255e0: 2020 2020 2020 6966 206e 5f73 616d 706c        if n_sampl
-000255f0: 6573 203c 2063 6f68 6f72 745f 7369 7a65  es < cohort_size
-00025600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00025610: 2020 696e 666f 280a 2020 2020 2020 2020    info(.        
-00025620: 2020 2020 2020 2020 2020 2020 6622 636f              f"co
-00025630: 686f 7274 2028 7b63 6f68 6f72 745f 6c61  hort ({cohort_la
-00025640: 6265 6c7d 2920 6861 7320 696e 7375 6666  bel}) has insuff
-00025650: 6963 6965 6e74 2073 616d 706c 6573 2028  icient samples (
-00025660: 7b6e 5f73 616d 706c 6573 7d29 2066 6f72  {n_samples}) for
-00025670: 2072 6571 7565 7374 6564 2063 6f68 6f72   requested cohor
-00025680: 7420 7369 7a65 2028 7b63 6f68 6f72 745f  t size ({cohort_
-00025690: 7369 7a65 7d29 2c20 6472 6f70 7069 6e67  size}), dropping
-000256a0: 2220 2023 206e 6f71 610a 2020 2020 2020  "  # noqa.      
-000256b0: 2020 2020 2020 2020 2020 2920 2023 206e            )  # n
-000256c0: 6f71 610a 2020 2020 2020 2020 2020 2020  oqa.            
-000256d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000256e0: 2020 2020 2020 636f 686f 7274 5f71 7565        cohort_que
-000256f0: 7269 6573 5f63 6865 636b 6564 5b63 6f68  ries_checked[coh
-00025700: 6f72 745f 6c61 6265 6c5d 203d 2063 6f68  ort_label] = coh
-00025710: 6f72 745f 7175 6572 790a 0a20 2020 2020  ort_query..     
-00025720: 2020 2064 6562 7567 2822 636f 6d70 7574     debug("comput
-00025730: 6520 6469 7665 7273 6974 7920 7374 6174  e diversity stat
-00025740: 7320 666f 7220 636f 686f 7274 7322 290a  s for cohorts").
-00025750: 2020 2020 2020 2020 616c 6c5f 7374 6174          all_stat
-00025760: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-00025770: 6f72 2063 6f68 6f72 745f 6c61 6265 6c2c  or cohort_label,
-00025780: 2063 6f68 6f72 745f 7175 6572 7920 696e   cohort_query in
-00025790: 2063 6f68 6f72 745f 7175 6572 6965 735f   cohort_queries_
-000257a0: 6368 6563 6b65 642e 6974 656d 7328 293a  checked.items():
-000257b0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-000257c0: 7473 203d 2073 656c 662e 636f 686f 7274  ts = self.cohort
-000257d0: 5f64 6976 6572 7369 7479 5f73 7461 7473  _diversity_stats
-000257e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000257f0: 2020 636f 686f 7274 3d28 636f 686f 7274    cohort=(cohort
-00025800: 5f6c 6162 656c 2c20 636f 686f 7274 5f71  _label, cohort_q
-00025810: 7565 7279 292c 0a20 2020 2020 2020 2020  uery),.         
-00025820: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
-00025830: 7a65 3d63 6f68 6f72 745f 7369 7a65 2c0a  ze=cohort_size,.
+00000160: 0a69 6d70 6f72 7420 6e75 6d62 610a 696d  .import numba.im
+00000170: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
+00000180: 0a69 6d70 6f72 7420 7061 6e64 6173 2061  .import pandas a
+00000190: 7320 7064 0a69 6d70 6f72 7420 706c 6f74  s pd.import plot
+000001a0: 6c79 2e65 7870 7265 7373 2061 7320 7078  ly.express as px
+000001b0: 0a69 6d70 6f72 7420 706c 6f74 6c79 2e67  .import plotly.g
+000001c0: 7261 7068 5f6f 626a 6563 7473 2061 7320  raph_objects as 
+000001d0: 676f 0a69 6d70 6f72 7420 7861 7272 6179  go.import xarray
+000001e0: 2061 7320 7872 0a69 6d70 6f72 7420 7a61   as xr.import za
+000001f0: 7272 0a66 726f 6d20 6e75 6d70 7964 6f63  rr.from numpydoc
+00000200: 5f64 6563 6f72 6174 6f72 2069 6d70 6f72  _decorator impor
+00000210: 7420 646f 630a 6672 6f6d 2074 7164 6d2e  t doc.from tqdm.
+00000220: 6175 746f 2069 6d70 6f72 7420 7471 646d  auto import tqdm
+00000230: 0a66 726f 6d20 7471 646d 2e64 6173 6b20  .from tqdm.dask 
+00000240: 696d 706f 7274 2054 7164 6d43 616c 6c62  import TqdmCallb
+00000250: 6163 6b0a 6672 6f6d 2074 7970 696e 675f  ack.from typing_
+00000260: 6578 7465 6e73 696f 6e73 2069 6d70 6f72  extensions impor
+00000270: 7420 416e 6e6f 7461 7465 642c 204c 6974  t Annotated, Lit
+00000280: 6572 616c 2c20 5479 7065 416c 6961 730a  eral, TypeAlias.
+00000290: 0a66 726f 6d20 2e20 696d 706f 7274 2076  .from . import v
+000002a0: 6566 660a 6672 6f6d 202e 616e 6f70 682e  eff.from .anoph.
+000002b0: 6261 7365 2069 6d70 6f72 7420 4445 4641  base import DEFA
+000002c0: 554c 542c 2041 6e6f 7068 656c 6573 4261  ULT, AnophelesBa
+000002d0: 7365 2c20 6261 7365 5f70 6172 616d 730a  se, base_params.
+000002e0: 6672 6f6d 202e 616e 6f70 682e 6765 6e6f  from .anoph.geno
+000002f0: 6d65 5f66 6561 7475 7265 7320 696d 706f  me_features impo
+00000300: 7274 2041 6e6f 7068 656c 6573 4765 6e6f  rt AnophelesGeno
+00000310: 6d65 4665 6174 7572 6573 4461 7461 2c20  meFeaturesData, 
+00000320: 6770 6c74 5f70 6172 616d 730a 6672 6f6d  gplt_params.from
+00000330: 202e 616e 6f70 682e 6765 6e6f 6d65 5f73   .anoph.genome_s
+00000340: 6571 7565 6e63 6520 696d 706f 7274 2041  equence import A
+00000350: 6e6f 7068 656c 6573 4765 6e6f 6d65 5365  nophelesGenomeSe
+00000360: 7175 656e 6365 4461 7461 0a66 726f 6d20  quenceData.from 
+00000370: 2e61 6e6f 7068 2e73 616d 706c 655f 6d65  .anoph.sample_me
+00000380: 7461 6461 7461 2069 6d70 6f72 7420 416e  tadata import An
+00000390: 6f70 6865 6c65 7353 616d 706c 654d 6574  ophelesSampleMet
+000003a0: 6164 6174 612c 206d 6170 5f70 6172 616d  adata, map_param
+000003b0: 730a 6672 6f6d 202e 6d6a 6e20 696d 706f  s.from .mjn impo
+000003c0: 7274 206d 6564 6961 6e5f 6a6f 696e 696e  rt median_joinin
+000003d0: 675f 6e65 7477 6f72 6b2c 206d 6a6e 5f67  g_network, mjn_g
+000003e0: 7261 7068 0a66 726f 6d20 2e75 7469 6c20  raph.from .util 
+000003f0: 696d 706f 7274 2028 0a20 2020 2044 494d  import (.    DIM
+00000400: 5f41 4c4c 454c 452c 0a20 2020 2044 494d  _ALLELE,.    DIM
+00000410: 5f50 4c4f 4944 592c 0a20 2020 2044 494d  _PLOIDY,.    DIM
+00000420: 5f53 414d 504c 452c 0a20 2020 2044 494d  _SAMPLE,.    DIM
+00000430: 5f56 4152 4941 4e54 2c0a 2020 2020 4361  _VARIANT,.    Ca
+00000440: 6368 654d 6973 732c 0a20 2020 2052 6567  cheMiss,.    Reg
+00000450: 696f 6e2c 0a20 2020 2064 615f 636f 6d70  ion,.    da_comp
+00000460: 7265 7373 2c0a 2020 2020 6461 5f66 726f  ress,.    da_fro
+00000470: 6d5f 7a61 7272 2c0a 2020 2020 6461 736b  m_zarr,.    dask
+00000480: 5f63 6f6d 7072 6573 735f 6461 7461 7365  _compress_datase
+00000490: 742c 0a20 2020 2068 6173 685f 7061 7261  t,.    hash_para
+000004a0: 6d73 2c0a 2020 2020 696e 6974 5f7a 6172  ms,.    init_zar
+000004b0: 725f 7374 6f72 652c 0a20 2020 206a 6163  r_store,.    jac
+000004c0: 6b6b 6e69 6665 5f63 692c 0a20 2020 206a  kknife_ci,.    j
+000004d0: 6974 7465 722c 0a20 2020 206c 6f63 6174  itter,.    locat
+000004e0: 655f 7265 6769 6f6e 2c0a 2020 2020 706c  e_region,.    pl
+000004f0: 6f74 6c79 5f64 6973 6372 6574 655f 6c65  otly_discrete_le
+00000500: 6765 6e64 2c0a 2020 2020 7265 736f 6c76  gend,.    resolv
+00000510: 655f 7265 6769 6f6e 2c0a 2020 2020 7369  e_region,.    si
+00000520: 6d70 6c65 5f78 6172 7261 795f 636f 6e63  mple_xarray_conc
+00000530: 6174 2c0a 2020 2020 7479 7065 5f65 7272  at,.    type_err
+00000540: 6f72 2c0a 290a 0a41 415f 4348 414e 4745  or,.)..AA_CHANGE
+00000550: 5f51 5545 5259 203d 2028 0a20 2020 2022  _QUERY = (.    "
+00000560: 6566 6665 6374 2069 6e20 5b27 4e4f 4e5f  effect in ['NON_
+00000570: 5359 4e4f 4e59 4d4f 5553 5f43 4f44 494e  SYNONYMOUS_CODIN
+00000580: 4727 2c20 2753 5441 5254 5f4c 4f53 5427  G', 'START_LOST'
+00000590: 2c20 2753 544f 505f 4c4f 5354 272c 2027  , 'STOP_LOST', '
+000005a0: 5354 4f50 5f47 4149 4e45 4427 5d22 0a29  STOP_GAINED']".)
+000005b0: 0a0a 0a63 6c61 7373 2068 6170 5f70 6172  ...class hap_par
+000005c0: 616d 733a 0a20 2020 2022 2222 5061 7261  ams:.    """Para
+000005d0: 6d65 7465 7220 6465 6669 6e69 7469 6f6e  meter definition
+000005e0: 7320 666f 7220 6861 706c 6f74 7970 6520  s for haplotype 
+000005f0: 6675 6e63 7469 6f6e 732e 2222 220a 0a20  functions.""".. 
+00000600: 2020 2061 6e61 6c79 7369 733a 2054 7970     analysis: Typ
+00000610: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
+00000620: 6564 5b0a 2020 2020 2020 2020 7374 722c  ed[.        str,
+00000630: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00000640: 2020 2020 2057 6869 6368 2068 6170 6c6f       Which haplo
+00000650: 7479 7065 2070 6861 7369 6e67 2061 6e61  type phasing ana
+00000660: 6c79 7369 7320 746f 2075 7365 2e20 5365  lysis to use. Se
+00000670: 6520 7468 650a 2020 2020 2020 2020 6070  e the.        `p
+00000680: 6861 7369 6e67 5f61 6e61 6c79 7369 735f  hasing_analysis_
+00000690: 6964 7360 2070 726f 7065 7274 7920 666f  ids` property fo
+000006a0: 7220 6176 6169 6c61 626c 6520 7661 6c75  r available valu
+000006b0: 6573 2e0a 2020 2020 2020 2020 2222 222c  es..        """,
+000006c0: 0a20 2020 205d 0a0a 0a63 6c61 7373 2068  .    ]...class h
+000006d0: 3132 5f70 6172 616d 733a 0a20 2020 2022  12_params:.    "
+000006e0: 2222 5061 7261 6d65 7465 7220 6465 6669  ""Parameter defi
+000006f0: 6e69 7469 6f6e 7320 666f 7220 4831 3220  nitions for H12 
+00000700: 616e 616c 7973 6973 2066 756e 6374 696f  analysis functio
+00000710: 6e73 2e22 2222 0a0a 2020 2020 7769 6e64  ns."""..    wind
+00000720: 6f77 5f73 697a 6573 3a20 5479 7065 416c  ow_sizes: TypeAl
+00000730: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
+00000740: 0a20 2020 2020 2020 2054 7570 6c65 5b69  .        Tuple[i
+00000750: 6e74 2c20 2e2e 2e5d 2c0a 2020 2020 2020  nt, ...],.      
+00000760: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+00000770: 6520 7369 7a65 7320 6f66 2077 696e 646f  e sizes of windo
+00000780: 7773 2028 6e75 6d62 6572 206f 6620 534e  ws (number of SN
+00000790: 5073 2920 7573 6564 2074 6f20 6361 6c63  Ps) used to calc
+000007a0: 756c 6174 6520 7374 6174 6973 7469 6373  ulate statistics
+000007b0: 2077 6974 6869 6e2e 0a20 2020 2020 2020   within..       
+000007c0: 2022 2222 2c0a 2020 2020 5d0a 2020 2020   """,.    ].    
+000007d0: 7769 6e64 6f77 5f73 697a 6573 5f64 6566  window_sizes_def
+000007e0: 6175 6c74 3a20 7769 6e64 6f77 5f73 697a  ault: window_siz
+000007f0: 6573 203d 2028 3130 302c 2032 3030 2c20  es = (100, 200, 
+00000800: 3530 302c 2031 3030 302c 2032 3030 302c  500, 1000, 2000,
+00000810: 2035 3030 302c 2031 3030 3030 2c20 3230   5000, 10000, 20
+00000820: 3030 3029 0a20 2020 2077 696e 646f 775f  000).    window_
+00000830: 7369 7a65 3a20 5479 7065 416c 6961 7320  size: TypeAlias 
+00000840: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
+00000850: 2020 2020 2069 6e74 2c0a 2020 2020 2020       int,.      
+00000860: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+00000870: 6520 7369 7a65 206f 6620 7769 6e64 6f77  e size of window
+00000880: 7320 286e 756d 6265 7220 6f66 2053 4e50  s (number of SNP
+00000890: 7329 2075 7365 6420 746f 2063 616c 6375  s) used to calcu
+000008a0: 6c61 7465 2073 7461 7469 7374 6963 7320  late statistics 
+000008b0: 7769 7468 696e 2e0a 2020 2020 2020 2020  within..        
+000008c0: 2222 222c 0a20 2020 205d 0a20 2020 2063  """,.    ].    c
+000008d0: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
+000008e0: 6c74 3a20 4f70 7469 6f6e 616c 5b62 6173  lt: Optional[bas
+000008f0: 655f 7061 7261 6d73 2e63 6f68 6f72 745f  e_params.cohort_
+00000900: 7369 7a65 5d20 3d20 4e6f 6e65 0a20 2020  size] = None.   
+00000910: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+00000920: 5f64 6566 6175 6c74 3a20 6261 7365 5f70  _default: base_p
+00000930: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
+00000940: 5f73 697a 6520 3d20 3135 0a20 2020 206d  _size = 15.    m
+00000950: 6178 5f63 6f68 6f72 745f 7369 7a65 5f64  ax_cohort_size_d
+00000960: 6566 6175 6c74 3a20 6261 7365 5f70 6172  efault: base_par
+00000970: 616d 732e 6d61 785f 636f 686f 7274 5f73  ams.max_cohort_s
+00000980: 697a 6520 3d20 3530 0a0a 0a63 6c61 7373  ize = 50...class
+00000990: 2067 3132 335f 7061 7261 6d73 3a0a 2020   g123_params:.  
+000009a0: 2020 2222 2250 6172 616d 6574 6572 2064    """Parameter d
+000009b0: 6566 696e 6974 696f 6e73 2066 6f72 2047  efinitions for G
+000009c0: 3132 3320 616e 616c 7973 6973 2066 756e  123 analysis fun
+000009d0: 6374 696f 6e73 2e22 2222 0a0a 2020 2020  ctions."""..    
+000009e0: 7369 7465 733a 2054 7970 6541 6c69 6173  sites: TypeAlias
+000009f0: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00000a00: 2020 2020 2020 7374 722c 0a20 2020 2020        str,.     
+00000a10: 2020 2022 2222 0a20 2020 2020 2020 2057     """.        W
+00000a20: 6869 6368 2073 6974 6573 2074 6f20 7573  hich sites to us
+00000a30: 653a 2027 616c 6c27 2069 6e63 6c75 6465  e: 'all' include
+00000a40: 7320 616c 6c20 7369 7465 7320 7468 6174  s all sites that
+00000a50: 2070 6173 730a 2020 2020 2020 2020 7369   pass.        si
+00000a60: 7465 2066 696c 7465 7273 3b20 2773 6567  te filters; 'seg
+00000a70: 7265 6761 7469 6e67 2720 696e 636c 7564  regating' includ
+00000a80: 6573 206f 6e6c 7920 7365 6772 6567 6174  es only segregat
+00000a90: 696e 6720 7369 7465 7320 666f 720a 2020  ing sites for.  
+00000aa0: 2020 2020 2020 7468 6520 6769 7665 6e20        the given 
+00000ab0: 636f 686f 7274 3b20 6f72 2061 2070 6861  cohort; or a pha
+00000ac0: 7369 6e67 2061 6e61 6c79 7369 7320 6964  sing analysis id
+00000ad0: 656e 7469 6669 6572 2063 616e 2062 650a  entifier can be.
+00000ae0: 2020 2020 2020 2020 7072 6f76 6964 6564          provided
+00000af0: 2074 6f20 7573 6520 7369 7465 7320 6672   to use sites fr
+00000b00: 6f6d 2074 6865 2068 6170 6c6f 7479 7065  om the haplotype
+00000b10: 2064 6174 612c 2077 6869 6368 2069 7320   data, which is 
+00000b20: 616e 0a20 2020 2020 2020 2061 7070 726f  an.        appro
+00000b30: 7869 6d61 7469 6f6e 2074 6f20 6669 6e64  ximation to find
+00000b40: 696e 6720 7365 6772 6567 6174 696e 6720  ing segregating 
+00000b50: 7369 7465 7320 696e 2074 6865 2065 6e74  sites in the ent
+00000b60: 6972 6520 4167 332e 300a 2020 2020 2020  ire Ag3.0.      
+00000b70: 2020 2867 616d 6269 6165 2063 6f6d 706c    (gambiae compl
+00000b80: 6578 2920 6f72 2041 6631 2e30 2028 6675  ex) or Af1.0 (fu
+00000b90: 6e65 7374 7573 2920 636f 686f 7274 2e0a  nestus) cohort..
+00000ba0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
+00000bb0: 205d 0a20 2020 2077 696e 646f 775f 7369   ].    window_si
+00000bc0: 7a65 733a 2054 7970 6541 6c69 6173 203d  zes: TypeAlias =
+00000bd0: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
+00000be0: 2020 2020 5475 706c 655b 696e 742c 202e      Tuple[int, .
+00000bf0: 2e2e 5d2c 0a20 2020 2020 2020 2022 2222  ..],.        """
+00000c00: 0a20 2020 2020 2020 2054 6865 2073 697a  .        The siz
+00000c10: 6573 206f 6620 7769 6e64 6f77 7320 286e  es of windows (n
+00000c20: 756d 6265 7220 6f66 2073 6974 6573 2920  umber of sites) 
+00000c30: 7573 6564 2074 6f20 6361 6c63 756c 6174  used to calculat
+00000c40: 6520 7374 6174 6973 7469 6373 2077 6974  e statistics wit
+00000c50: 6869 6e2e 0a20 2020 2020 2020 2022 2222  hin..        """
+00000c60: 2c0a 2020 2020 5d0a 2020 2020 7769 6e64  ,.    ].    wind
+00000c70: 6f77 5f73 697a 6573 5f64 6566 6175 6c74  ow_sizes_default
+00000c80: 3a20 7769 6e64 6f77 5f73 697a 6573 203d  : window_sizes =
+00000c90: 2028 3130 302c 2032 3030 2c20 3530 302c   (100, 200, 500,
+00000ca0: 2031 3030 302c 2032 3030 302c 2035 3030   1000, 2000, 500
+00000cb0: 302c 2031 3030 3030 2c20 3230 3030 3029  0, 10000, 20000)
+00000cc0: 0a20 2020 2077 696e 646f 775f 7369 7a65  .    window_size
+00000cd0: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
+00000ce0: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
+00000cf0: 2069 6e74 2c0a 2020 2020 2020 2020 2222   int,.        ""
+00000d00: 220a 2020 2020 2020 2020 5468 6520 7369  ".        The si
+00000d10: 7a65 206f 6620 7769 6e64 6f77 7320 286e  ze of windows (n
+00000d20: 756d 6265 7220 6f66 2073 6974 6573 2920  umber of sites) 
+00000d30: 7573 6564 2074 6f20 6361 6c63 756c 6174  used to calculat
+00000d40: 6520 7374 6174 6973 7469 6373 2077 6974  e statistics wit
+00000d50: 6869 6e2e 0a20 2020 2020 2020 2022 2222  hin..        """
+00000d60: 2c0a 2020 2020 5d0a 2020 2020 6d69 6e5f  ,.    ].    min_
+00000d70: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
+00000d80: 756c 743a 2062 6173 655f 7061 7261 6d73  ult: base_params
+00000d90: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
+00000da0: 203d 2032 300a 2020 2020 6d61 785f 636f   = 20.    max_co
+00000db0: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
+00000dc0: 743a 2062 6173 655f 7061 7261 6d73 2e6d  t: base_params.m
+00000dd0: 6178 5f63 6f68 6f72 745f 7369 7a65 203d  ax_cohort_size =
+00000de0: 2035 300a 0a0a 636c 6173 7320 6673 745f   50...class fst_
+00000df0: 7061 7261 6d73 3a0a 2020 2020 2222 2250  params:.    """P
+00000e00: 6172 616d 6574 6572 2064 6566 696e 6974  arameter definit
+00000e10: 696f 6e73 2066 6f72 2046 7374 2066 756e  ions for Fst fun
+00000e20: 6374 696f 6e73 2e22 2222 0a0a 2020 2020  ctions."""..    
+00000e30: 2320 4e2e 422e 2c20 7769 6e64 6f77 2073  # N.B., window s
+00000e40: 697a 6520 6361 6e20 6d65 616e 2064 6966  ize can mean dif
+00000e50: 6665 7265 6e74 2074 6869 6e67 7320 666f  ferent things fo
+00000e60: 7220 6469 6666 6572 656e 7420 6675 6e63  r different func
+00000e70: 7469 6f6e 730a 2020 2020 7769 6e64 6f77  tions.    window
+00000e80: 5f73 697a 653a 2054 7970 6541 6c69 6173  _size: TypeAlias
+00000e90: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00000ea0: 2020 2020 2020 696e 742c 0a20 2020 2020        int,.     
+00000eb0: 2020 2022 5468 6520 7369 7a65 206f 6620     "The size of 
+00000ec0: 7769 6e64 6f77 7320 286e 756d 6265 7220  windows (number 
+00000ed0: 6f66 2073 6974 6573 2920 7573 6564 2074  of sites) used t
+00000ee0: 6f20 6361 6c63 756c 6174 6520 7374 6174  o calculate stat
+00000ef0: 6973 7469 6373 2077 6974 6869 6e2e 222c  istics within.",
+00000f00: 0a20 2020 205d 0a20 2020 2063 6f68 6f72  .    ].    cohor
+00000f10: 745f 7369 7a65 5f64 6566 6175 6c74 3a20  t_size_default: 
+00000f20: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+00000f30: 7261 6d73 2e63 6f68 6f72 745f 7369 7a65  rams.cohort_size
+00000f40: 5d20 3d20 4e6f 6e65 0a20 2020 206d 696e  ] = None.    min
+00000f50: 5f63 6f68 6f72 745f 7369 7a65 5f64 6566  _cohort_size_def
+00000f60: 6175 6c74 3a20 6261 7365 5f70 6172 616d  ault: base_param
+00000f70: 732e 6d69 6e5f 636f 686f 7274 5f73 697a  s.min_cohort_siz
+00000f80: 6520 3d20 3135 0a20 2020 206d 6178 5f63  e = 15.    max_c
+00000f90: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
+00000fa0: 6c74 3a20 6261 7365 5f70 6172 616d 732e  lt: base_params.
+00000fb0: 6d61 785f 636f 686f 7274 5f73 697a 6520  max_cohort_size 
+00000fc0: 3d20 3530 0a0a 0a63 6c61 7373 2066 7271  = 50...class frq
+00000fd0: 5f70 6172 616d 733a 0a20 2020 2022 2222  _params:.    """
+00000fe0: 5061 7261 6d65 7465 7220 6465 6669 6e69  Parameter defini
+00000ff0: 7469 6f6e 7320 666f 7220 6675 6e63 7469  tions for functi
+00001000: 6f6e 7320 636f 6d70 7574 696e 6720 616e  ons computing an
+00001010: 6420 706c 6f74 7469 6e67 2061 6c6c 656c  d plotting allel
+00001020: 6520 6672 6571 7565 6e63 6965 732e 2222  e frequencies.""
+00001030: 220a 0a20 2020 2064 726f 705f 696e 7661  "..    drop_inva
+00001040: 7269 616e 743a 2054 7970 6541 6c69 6173  riant: TypeAlias
+00001050: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00001060: 2020 2020 2020 626f 6f6c 2c0a 2020 2020        bool,.    
+00001070: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001080: 4966 2054 7275 652c 2064 726f 7020 7661  If True, drop va
+00001090: 7269 616e 7473 206e 6f74 206f 6273 6572  riants not obser
+000010a0: 7665 6420 696e 2074 6865 2073 656c 6563  ved in the selec
+000010b0: 7465 6420 7361 6d70 6c65 732e 0a20 2020  ted samples..   
+000010c0: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
+000010d0: 2020 2020 6566 6665 6374 733a 2054 7970      effects: Typ
+000010e0: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
+000010f0: 6564 5b62 6f6f 6c2c 2022 4966 2054 7275  ed[bool, "If Tru
+00001100: 652c 2061 6464 2053 4e50 2065 6666 6563  e, add SNP effec
+00001110: 7420 616e 6e6f 7461 7469 6f6e 732e 225d  t annotations."]
+00001120: 0a20 2020 2061 7265 615f 6279 3a20 5479  .    area_by: Ty
+00001130: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
+00001140: 7465 645b 0a20 2020 2020 2020 2073 7472  ted[.        str
+00001150: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
+00001160: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
+00001170: 6520 696e 2074 6865 2073 616d 706c 6520  e in the sample 
+00001180: 6d65 7461 6461 7461 2074 6f20 7573 6520  metadata to use 
+00001190: 746f 2067 726f 7570 2073 616d 706c 6573  to group samples
+000011a0: 2073 7061 7469 616c 6c79 2e20 452e 672e   spatially. E.g.
+000011b0: 2c0a 2020 2020 2020 2020 7573 6520 2261  ,.        use "a
+000011c0: 646d 696e 315f 6973 6f22 206f 7220 2261  dmin1_iso" or "a
+000011d0: 646d 696e 315f 6e61 6d65 2220 746f 2067  dmin1_name" to g
+000011e0: 726f 7570 2062 7920 6c65 7665 6c20 3120  roup by level 1 
+000011f0: 6164 6d69 6e69 7374 7261 7469 7665 0a20  administrative. 
+00001200: 2020 2020 2020 2064 6976 6973 696f 6e73         divisions
+00001210: 2c20 6f72 2075 7365 2022 6164 6d69 6e32  , or use "admin2
+00001220: 5f6e 616d 6522 2074 6f20 6772 6f75 7020  _name" to group 
+00001230: 6279 206c 6576 656c 2032 2061 646d 696e  by level 2 admin
+00001240: 6973 7472 6174 6976 650a 2020 2020 2020  istrative.      
+00001250: 2020 6469 7669 7369 6f6e 732e 0a20 2020    divisions..   
+00001260: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
+00001270: 2020 2020 7065 7269 6f64 5f62 793a 2054      period_by: T
+00001280: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
+00001290: 6174 6564 5b0a 2020 2020 2020 2020 4c69  ated[.        Li
+000012a0: 7465 7261 6c5b 2279 6561 7222 2c20 2271  teral["year", "q
+000012b0: 7561 7274 6572 222c 2022 6d6f 6e74 6822  uarter", "month"
+000012c0: 5d2c 0a20 2020 2020 2020 2022 4c65 6e67  ],.        "Leng
+000012d0: 7468 206f 6620 7469 6d65 2074 6f20 6772  th of time to gr
+000012e0: 6f75 7020 7361 6d70 6c65 7320 7465 6d70  oup samples temp
+000012f0: 6f72 616c 6c79 2e22 2c0a 2020 2020 5d0a  orally.",.    ].
+00001300: 2020 2020 7661 7269 616e 745f 7175 6572      variant_quer
+00001310: 793a 2054 7970 6541 6c69 6173 203d 2041  y: TypeAlias = A
+00001320: 6e6e 6f74 6174 6564 5b0a 2020 2020 2020  nnotated[.      
+00001330: 2020 7374 722c 0a20 2020 2020 2020 2022    str,.        "
+00001340: 4120 7061 6e64 6173 2071 7565 7279 2074  A pandas query t
+00001350: 6f20 6265 2065 7661 6c75 6174 6564 2061  o be evaluated a
+00001360: 6761 696e 7374 2076 6172 6961 6e74 732e  gainst variants.
+00001370: 222c 0a20 2020 205d 0a20 2020 206e 6f62  ",.    ].    nob
+00001380: 735f 6d6f 6465 3a20 5479 7065 416c 6961  s_mode: TypeAlia
+00001390: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
+000013a0: 2020 2020 2020 204c 6974 6572 616c 5b22         Literal["
+000013b0: 6361 6c6c 6564 222c 2022 6669 7865 6422  called", "fixed"
+000013c0: 5d2c 0a20 2020 2020 2020 2022 2222 0a20  ],.        """. 
+000013d0: 2020 2020 2020 204d 6574 686f 6420 666f         Method fo
+000013e0: 7220 6361 6c63 756c 6174 696e 6720 7468  r calculating th
+000013f0: 6520 6465 6e6f 6d69 6e61 746f 7220 7768  e denominator wh
+00001400: 656e 2063 6f6d 7075 7469 6e67 2066 7265  en computing fre
+00001410: 7175 656e 6369 6573 2e20 4966 0a20 2020  quencies. If.   
+00001420: 2020 2020 2022 6361 6c6c 6564 2220 7468       "called" th
+00001430: 656e 2075 7365 2074 6865 206e 756d 6265  en use the numbe
+00001440: 7220 6f66 2063 616c 6c65 6420 616c 6c65  r of called alle
+00001450: 6c65 732c 2069 2e65 2e2c 206e 756d 6265  les, i.e., numbe
+00001460: 7220 6f66 2073 616d 706c 6573 0a20 2020  r of samples.   
+00001470: 2020 2020 2077 6974 6820 6e6f 6e2d 6d69       with non-mi
+00001480: 7373 696e 6720 6765 6e6f 7479 7065 2063  ssing genotype c
+00001490: 616c 6c73 206d 756c 7469 706c 6965 6420  alls multiplied 
+000014a0: 6279 2032 2e20 4966 2022 6669 7865 6422  by 2. If "fixed"
+000014b0: 2074 6865 6e20 7573 6520 7468 650a 2020   then use the.  
+000014c0: 2020 2020 2020 6e75 6d62 6572 206f 6620        number of 
+000014d0: 7361 6d70 6c65 7320 6d75 6c74 6970 6c69  samples multipli
+000014e0: 6564 2062 7920 322e 0a20 2020 2020 2020  ed by 2..       
+000014f0: 2022 2222 2c0a 2020 2020 5d0a 2020 2020   """,.    ].    
+00001500: 6e6f 6273 5f6d 6f64 655f 6465 6661 756c  nobs_mode_defaul
+00001510: 743a 206e 6f62 735f 6d6f 6465 203d 2022  t: nobs_mode = "
+00001520: 6361 6c6c 6564 220a 2020 2020 6369 5f6d  called".    ci_m
+00001530: 6574 686f 643a 2054 7970 6541 6c69 6173  ethod: TypeAlias
+00001540: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00001550: 2020 2020 2020 4c69 7465 7261 6c5b 226e        Literal["n
+00001560: 6f72 6d61 6c22 2c20 2261 6772 6573 7469  ormal", "agresti
+00001570: 5f63 6f75 6c6c 222c 2022 6265 7461 222c  _coull", "beta",
+00001580: 2022 7769 6c73 6f6e 222c 2022 6269 6e6f   "wilson", "bino
+00001590: 6d5f 7465 7374 225d 2c0a 2020 2020 2020  m_test"],.      
+000015a0: 2020 2222 220a 2020 2020 2020 2020 4d65    """.        Me
+000015b0: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
+000015c0: 636f 6d70 7574 696e 6720 636f 6e66 6964  computing confid
+000015d0: 656e 6365 2069 6e74 6572 7661 6c73 2c20  ence intervals, 
+000015e0: 7061 7373 6564 2074 6872 6f75 6768 2074  passed through t
+000015f0: 6f0a 2020 2020 2020 2020 6073 7461 7473  o.        `stats
+00001600: 6d6f 6465 6c73 2e73 7461 7473 2e70 726f  models.stats.pro
+00001610: 706f 7274 696f 6e2e 7072 6f70 6f72 7469  portion.proporti
+00001620: 6f6e 5f63 6f6e 6669 6e74 602e 0a20 2020  on_confint`..   
+00001630: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
+00001640: 2020 2020 6369 5f6d 6574 686f 645f 6465      ci_method_de
+00001650: 6661 756c 743a 2063 695f 6d65 7468 6f64  fault: ci_method
+00001660: 203d 2022 7769 6c73 6f6e 220a 2020 2020   = "wilson".    
+00001670: 6473 5f66 7265 7175 656e 6369 6573 5f61  ds_frequencies_a
+00001680: 6476 616e 6365 643a 2054 7970 6541 6c69  dvanced: TypeAli
+00001690: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
+000016a0: 2020 2020 2020 2020 7872 2e44 6174 6173          xr.Datas
+000016b0: 6574 2c0a 2020 2020 2020 2020 2222 220a  et,.        """.
+000016c0: 2020 2020 2020 2020 4120 6461 7461 7365          A datase
+000016d0: 7420 6f66 2076 6172 6961 6e74 2066 7265  t of variant fre
+000016e0: 7175 656e 6369 6573 2c20 7375 6368 2061  quencies, such a
+000016f0: 7320 7265 7475 726e 6564 2062 790a 2020  s returned by.  
+00001700: 2020 2020 2020 6073 6e70 5f61 6c6c 656c        `snp_allel
+00001710: 655f 6672 6571 7565 6e63 6965 735f 6164  e_frequencies_ad
+00001720: 7661 6e63 6564 2829 602c 0a20 2020 2020  vanced()`,.     
+00001730: 2020 2060 6161 5f61 6c6c 656c 655f 6672     `aa_allele_fr
+00001740: 6571 7565 6e63 6965 735f 6164 7661 6e63  equencies_advanc
+00001750: 6564 2829 6020 6f72 0a20 2020 2020 2020  ed()` or.       
+00001760: 2060 6765 6e65 5f63 6e76 5f66 7265 7175   `gene_cnv_frequ
+00001770: 656e 6369 6573 5f61 6476 616e 6365 6428  encies_advanced(
+00001780: 2960 2e0a 2020 2020 2020 2020 2222 222c  )`..        """,
+00001790: 0a20 2020 205d 0a0a 0a63 6c61 7373 2068  .    ]...class h
+000017a0: 6574 5f70 6172 616d 733a 0a20 2020 2022  et_params:.    "
+000017b0: 2222 5061 7261 6d65 7465 7273 2066 6f72  ""Parameters for
+000017c0: 2066 756e 6374 696f 6e73 2072 656c 6174   functions relat
+000017d0: 6564 2074 6f20 6865 7465 726f 7a79 676f  ed to heterozygo
+000017e0: 7369 7479 2061 6e64 2072 756e 7320 6f66  sity and runs of
+000017f0: 2068 6f6d 6f7a 7967 6f73 6974 792e 2222   homozygosity.""
+00001800: 220a 0a20 2020 2073 616d 706c 653a 2054  "..    sample: T
+00001810: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
+00001820: 6174 6564 5b0a 2020 2020 2020 2020 556e  ated[.        Un
+00001830: 696f 6e5b 7374 722c 2069 6e74 5d2c 0a20  ion[str, int],. 
+00001840: 2020 2020 2020 2022 5361 6d70 6c65 2069         "Sample i
+00001850: 6465 6e74 6966 6965 7220 6f72 2069 6e64  dentifier or ind
+00001860: 6578 2077 6974 6869 6e20 7361 6d70 6c65  ex within sample
+00001870: 2073 6574 2e22 2c0a 2020 2020 5d0a 2020   set.",.    ].  
+00001880: 2020 7769 6e64 6f77 5f73 697a 653a 2054    window_size: T
+00001890: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
+000018a0: 6174 6564 5b0a 2020 2020 2020 2020 696e  ated[.        in
+000018b0: 742c 0a20 2020 2020 2020 2022 4e75 6d62  t,.        "Numb
+000018c0: 6572 206f 6620 7369 7465 7320 7065 7220  er of sites per 
+000018d0: 7769 6e64 6f77 2e22 2c0a 2020 2020 5d0a  window.",.    ].
+000018e0: 2020 2020 7769 6e64 6f77 5f73 697a 655f      window_size_
+000018f0: 6465 6661 756c 743a 2077 696e 646f 775f  default: window_
+00001900: 7369 7a65 203d 2032 305f 3030 300a 2020  size = 20_000.  
+00001910: 2020 7068 6574 5f72 6f68 3a20 5479 7065    phet_roh: Type
+00001920: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
+00001930: 645b 0a20 2020 2020 2020 2066 6c6f 6174  d[.        float
+00001940: 2c0a 2020 2020 2020 2020 2250 726f 6261  ,.        "Proba
+00001950: 6269 6c69 7479 206f 6620 6f62 7365 7276  bility of observ
+00001960: 696e 6720 6120 6865 7465 726f 7a79 676f  ing a heterozygo
+00001970: 7465 2069 6e20 6120 524f 482e 222c 0a20  te in a ROH.",. 
+00001980: 2020 205d 0a20 2020 2070 6865 745f 726f     ].    phet_ro
+00001990: 685f 6465 6661 756c 743a 2070 6865 745f  h_default: phet_
+000019a0: 726f 6820 3d20 302e 3030 310a 2020 2020  roh = 0.001.    
+000019b0: 7068 6574 5f6e 6f6e 726f 683a 2054 7970  phet_nonroh: Typ
+000019c0: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
+000019d0: 6564 5b0a 2020 2020 2020 2020 5475 706c  ed[.        Tupl
+000019e0: 655b 666c 6f61 742c 202e 2e2e 5d2c 0a20  e[float, ...],. 
+000019f0: 2020 2020 2020 2022 4f6e 6520 6f72 206d         "One or m
+00001a00: 6f72 6520 7072 6f62 6162 696c 6974 6965  ore probabilitie
+00001a10: 7320 6f66 206f 6273 6572 7669 6e67 2061  s of observing a
+00001a20: 2068 6574 6572 6f7a 7967 6f74 6520 6f75   heterozygote ou
+00001a30: 7473 6964 6520 6120 524f 482e 222c 0a20  tside a ROH.",. 
+00001a40: 2020 205d 0a20 2020 2070 6865 745f 6e6f     ].    phet_no
+00001a50: 6e72 6f68 5f64 6566 6175 6c74 3a20 7068  nroh_default: ph
+00001a60: 6574 5f6e 6f6e 726f 6820 3d20 2830 2e30  et_nonroh = (0.0
+00001a70: 3033 2c20 302e 3031 290a 2020 2020 7472  03, 0.01).    tr
+00001a80: 616e 7369 7469 6f6e 3a20 5479 7065 416c  ansition: TypeAl
+00001a90: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
+00001aa0: 0a20 2020 2020 2020 2066 6c6f 6174 2c0a  .        float,.
+00001ab0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001ac0: 2020 2020 5072 6f62 6162 696c 6974 7920      Probability 
+00001ad0: 6f66 206d 6f76 696e 6720 6265 7477 6565  of moving betwee
+00001ae0: 6e20 7374 6174 6573 2e20 4120 6c61 7267  n states. A larg
+00001af0: 6572 2077 696e 646f 7720 7369 7a65 206d  er window size m
+00001b00: 6179 2063 616c 6c0a 2020 2020 2020 2020  ay call.        
+00001b10: 666f 7220 6120 6c61 7267 6572 2074 7261  for a larger tra
+00001b20: 6e73 6974 696f 6e61 6c20 7072 6f62 6162  nsitional probab
+00001b30: 696c 6974 792e 0a20 2020 2020 2020 2022  ility..        "
+00001b40: 2222 2c0a 2020 2020 5d0a 2020 2020 7472  "",.    ].    tr
+00001b50: 616e 7369 7469 6f6e 5f64 6566 6175 6c74  ansition_default
+00001b60: 3a20 7472 616e 7369 7469 6f6e 203d 2030  : transition = 0
+00001b70: 2e30 3031 0a20 2020 2079 5f6d 6178 3a20  .001.    y_max: 
+00001b80: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
+00001b90: 7461 7465 645b 0a20 2020 2020 2020 2066  tated[.        f
+00001ba0: 6c6f 6174 2c0a 2020 2020 2020 2020 2259  loat,.        "Y
+00001bb0: 2061 7869 7320 6c69 6d69 742e 222c 0a20   axis limit.",. 
+00001bc0: 2020 205d 0a20 2020 2079 5f6d 6178 5f64     ].    y_max_d
+00001bd0: 6566 6175 6c74 3a20 795f 6d61 7820 3d20  efault: y_max = 
+00001be0: 302e 3033 0a20 2020 2063 6972 636c 655f  0.03.    circle_
+00001bf0: 6b77 6172 6773 3a20 5479 7065 416c 6961  kwargs: TypeAlia
+00001c00: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
+00001c10: 2020 2020 2020 204d 6170 7069 6e67 2c0a         Mapping,.
+00001c20: 2020 2020 2020 2020 2250 6173 7365 6420          "Passed 
+00001c30: 7468 726f 7567 6820 746f 2062 6f6b 6568  through to bokeh
+00001c40: 2063 6972 636c 6528 2920 6675 6e63 7469   circle() functi
+00001c50: 6f6e 2e22 2c0a 2020 2020 5d0a 2020 2020  on.",.    ].    
+00001c60: 6466 5f72 6f68 3a20 5479 7065 416c 6961  df_roh: TypeAlia
+00001c70: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
+00001c80: 2020 2020 2020 2070 642e 4461 7461 4672         pd.DataFr
+00001c90: 616d 652c 0a20 2020 2020 2020 2022 2222  ame,.        """
+00001ca0: 0a20 2020 2020 2020 2041 2044 6174 6146  .        A DataF
+00001cb0: 7261 6d65 2077 6865 7265 2065 6163 6820  rame where each 
+00001cc0: 726f 7720 7072 6f76 6964 6573 2064 6174  row provides dat
+00001cd0: 6120 6162 6f75 7420 6120 7369 6e67 6c65  a about a single
+00001ce0: 2072 756e 206f 660a 2020 2020 2020 2020   run of.        
+00001cf0: 686f 6d6f 7a79 676f 7369 7479 2e0a 2020  homozygosity..  
+00001d00: 2020 2020 2020 2222 222c 0a20 2020 205d        """,.    ]
+00001d10: 0a20 2020 2068 6574 6572 6f7a 7967 6f73  .    heterozygos
+00001d20: 6974 795f 6865 6967 6874 3a20 5479 7065  ity_height: Type
+00001d30: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
+00001d40: 645b 0a20 2020 2020 2020 2069 6e74 2c0a  d[.        int,.
+00001d50: 2020 2020 2020 2020 2248 6569 6768 7420          "Height 
+00001d60: 696e 2070 6978 656c 7320 2870 7829 206f  in pixels (px) o
+00001d70: 6620 6865 7465 726f 7a79 676f 7369 7479  f heterozygosity
+00001d80: 2074 7261 636b 2e22 2c0a 2020 2020 5d0a   track.",.    ].
+00001d90: 2020 2020 726f 685f 6865 6967 6874 3a20      roh_height: 
+00001da0: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
+00001db0: 7461 7465 645b 0a20 2020 2020 2020 2069  tated[.        i
+00001dc0: 6e74 2c0a 2020 2020 2020 2020 2248 6569  nt,.        "Hei
+00001dd0: 6768 7420 696e 2070 6978 656c 7320 2870  ght in pixels (p
+00001de0: 7829 206f 6620 7275 6e73 206f 6620 686f  x) of runs of ho
+00001df0: 6d6f 7a79 676f 7369 7479 2074 7261 636b  mozygosity track
+00001e00: 2e22 2c0a 2020 2020 5d0a 0a0a 636c 6173  .",.    ]...clas
+00001e10: 7320 7063 615f 7061 7261 6d73 3a0a 2020  s pca_params:.  
+00001e20: 2020 2222 2250 6172 616d 6574 6572 7320    """Parameters 
+00001e30: 666f 7220 5043 4120 6675 6e63 7469 6f6e  for PCA function
+00001e40: 732e 2222 220a 0a20 2020 206e 5f73 6e70  s."""..    n_snp
+00001e50: 733a 2054 7970 6541 6c69 6173 203d 2041  s: TypeAlias = A
+00001e60: 6e6e 6f74 6174 6564 5b0a 2020 2020 2020  nnotated[.      
+00001e70: 2020 696e 742c 0a20 2020 2020 2020 2022    int,.        "
+00001e80: 2222 0a20 2020 2020 2020 2054 6865 2064  "".        The d
+00001e90: 6573 6972 6564 206e 756d 6265 7220 6f66  esired number of
+00001ea0: 2053 4e50 7320 746f 2075 7365 2077 6865   SNPs to use whe
+00001eb0: 6e20 7275 6e6e 696e 6720 7468 6520 616e  n running the an
+00001ec0: 616c 7973 6973 2e0a 2020 2020 2020 2020  alysis..        
+00001ed0: 534e 5073 2077 696c 6c20 6265 2065 7665  SNPs will be eve
+00001ee0: 6e6c 7920 7468 696e 6e65 6420 746f 2061  nly thinned to a
+00001ef0: 7070 726f 7869 6d61 7465 6c79 2074 6869  pproximately thi
+00001f00: 7320 6e75 6d62 6572 2e0a 2020 2020 2020  s number..      
+00001f10: 2020 2222 222c 0a20 2020 205d 0a20 2020    """,.    ].   
+00001f20: 2074 6869 6e5f 6f66 6673 6574 3a20 5479   thin_offset: Ty
+00001f30: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
+00001f40: 7465 645b 0a20 2020 2020 2020 2069 6e74  ted[.        int
+00001f50: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
+00001f60: 2020 2020 2020 5374 6172 7469 6e67 2069        Starting i
+00001f70: 6e64 6578 2066 6f72 2053 4e50 2074 6869  ndex for SNP thi
+00001f80: 6e6e 696e 672e 2043 6861 6e67 6520 7468  nning. Change th
+00001f90: 6973 2074 6f20 7265 7065 6174 2074 6865  is to repeat the
+00001fa0: 2061 6e61 6c79 7369 730a 2020 2020 2020   analysis.      
+00001fb0: 2020 7573 696e 6720 6120 6469 6666 6572    using a differ
+00001fc0: 656e 7420 7365 7420 6f66 2053 4e50 732e  ent set of SNPs.
+00001fd0: 0a20 2020 2020 2020 2022 2222 2c0a 2020  .        """,.  
+00001fe0: 2020 5d0a 2020 2020 7468 696e 5f6f 6666    ].    thin_off
+00001ff0: 7365 745f 6465 6661 756c 743a 2074 6869  set_default: thi
+00002000: 6e5f 6f66 6673 6574 203d 2030 0a20 2020  n_offset = 0.   
+00002010: 206d 696e 5f6d 696e 6f72 5f61 633a 2054   min_minor_ac: T
+00002020: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
+00002030: 6174 6564 5b0a 2020 2020 2020 2020 696e  ated[.        in
+00002040: 742c 0a20 2020 2020 2020 2022 2222 0a20  t,.        """. 
+00002050: 2020 2020 2020 2054 6865 206d 696e 696d         The minim
+00002060: 756d 206d 696e 6f72 2061 6c6c 656c 6520  um minor allele 
+00002070: 636f 756e 742e 2053 4e50 7320 7769 7468  count. SNPs with
+00002080: 2061 206d 696e 6f72 2061 6c6c 656c 6520   a minor allele 
+00002090: 636f 756e 740a 2020 2020 2020 2020 6265  count.        be
+000020a0: 6c6f 7720 7468 6973 2076 616c 7565 2077  low this value w
+000020b0: 696c 6c20 6265 2065 7863 6c75 6465 6420  ill be excluded 
+000020c0: 7072 696f 7220 746f 2074 6869 6e6e 696e  prior to thinnin
+000020d0: 672e 0a20 2020 2020 2020 2022 2222 2c0a  g..        """,.
+000020e0: 2020 2020 5d0a 2020 2020 6d69 6e5f 6d69      ].    min_mi
+000020f0: 6e6f 725f 6163 5f64 6566 6175 6c74 3a20  nor_ac_default: 
+00002100: 6d69 6e5f 6d69 6e6f 725f 6163 203d 2032  min_minor_ac = 2
+00002110: 0a20 2020 206d 6178 5f6d 6973 7369 6e67  .    max_missing
+00002120: 5f61 6e3a 2054 7970 6541 6c69 6173 203d  _an: TypeAlias =
+00002130: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
+00002140: 2020 2020 696e 742c 0a20 2020 2020 2020      int,.       
+00002150: 2022 2222 0a20 2020 2020 2020 2054 6865   """.        The
+00002160: 206d 6178 696d 756d 206e 756d 6265 7220   maximum number 
+00002170: 6f66 206d 6973 7369 6e67 2061 6c6c 656c  of missing allel
+00002180: 6520 6361 6c6c 7320 746f 2061 6363 6570  e calls to accep
+00002190: 742e 2053 4e50 7320 7769 7468 0a20 2020  t. SNPs with.   
+000021a0: 2020 2020 206d 6f72 6520 7468 616e 2074       more than t
+000021b0: 6869 7320 7661 6c75 6520 7769 6c6c 2062  his value will b
+000021c0: 6520 6578 636c 7564 6564 2070 7269 6f72  e excluded prior
+000021d0: 2074 6f20 7468 696e 6e69 6e67 2e20 5365   to thinning. Se
+000021e0: 7420 746f 2030 0a20 2020 2020 2020 2028  t to 0.        (
+000021f0: 6465 6661 756c 7429 2074 6f20 7265 7175  default) to requ
+00002200: 6972 6520 6e6f 206d 6973 7369 6e67 2063  ire no missing c
+00002210: 616c 6c73 2e0a 2020 2020 2020 2020 2222  alls..        ""
+00002220: 222c 0a20 2020 205d 0a20 2020 206d 6178  ",.    ].    max
+00002230: 5f6d 6973 7369 6e67 5f61 6e5f 6465 6661  _missing_an_defa
+00002240: 756c 7420 3d20 300a 2020 2020 6e5f 636f  ult = 0.    n_co
+00002250: 6d70 6f6e 656e 7473 3a20 5479 7065 416c  mponents: TypeAl
+00002260: 6961 7320 3d20 416e 6e6f 7461 7465 645b  ias = Annotated[
+00002270: 0a20 2020 2020 2020 2069 6e74 2c0a 2020  .        int,.  
+00002280: 2020 2020 2020 224e 756d 6265 7220 6f66        "Number of
+00002290: 2063 6f6d 706f 6e65 6e74 7320 746f 2072   components to r
+000022a0: 6574 7572 6e2e 222c 0a20 2020 205d 0a20  eturn.",.    ]. 
+000022b0: 2020 206e 5f63 6f6d 706f 6e65 6e74 735f     n_components_
+000022c0: 6465 6661 756c 743a 206e 5f63 6f6d 706f  default: n_compo
+000022d0: 6e65 6e74 7320 3d20 3230 0a20 2020 2064  nents = 20.    d
+000022e0: 665f 7063 613a 2054 7970 6541 6c69 6173  f_pca: TypeAlias
+000022f0: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00002300: 2020 2020 2020 7064 2e44 6174 6146 7261        pd.DataFra
+00002310: 6d65 2c0a 2020 2020 2020 2020 2222 220a  me,.        """.
+00002320: 2020 2020 2020 2020 4120 6461 7461 6672          A datafr
+00002330: 616d 6520 6f66 2073 616d 706c 6520 6d65  ame of sample me
+00002340: 7461 6461 7461 2c20 7769 7468 2063 6f6c  tadata, with col
+00002350: 756d 6e73 2022 5043 3122 2c20 2250 4332  umns "PC1", "PC2
+00002360: 222c 2022 5043 3322 2c0a 2020 2020 2020  ", "PC3",.      
+00002370: 2020 6574 632e 2c20 6164 6465 642e 0a20    etc., added.. 
+00002380: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
+00002390: 5d0a 2020 2020 6576 723a 2054 7970 6541  ].    evr: TypeA
+000023a0: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
+000023b0: 5b0a 2020 2020 2020 2020 6e70 2e6e 6461  [.        np.nda
+000023c0: 7272 6179 2c0a 2020 2020 2020 2020 2241  rray,.        "A
+000023d0: 6e20 6172 7261 7920 6f66 2065 7870 6c61  n array of expla
+000023e0: 696e 6564 2076 6172 6961 6e63 6520 7261  ined variance ra
+000023f0: 7469 6f73 2c20 6f6e 6520 7065 7220 636f  tios, one per co
+00002400: 6d70 6f6e 656e 742e 222c 0a20 2020 205d  mponent.",.    ]
+00002410: 0a0a 0a63 6c61 7373 2070 6c6f 746c 795f  ...class plotly_
+00002420: 7061 7261 6d73 3a0a 2020 2020 2222 2250  params:.    """P
+00002430: 6172 616d 6574 6572 7320 666f 7220 616e  arameters for an
+00002440: 7920 706c 6f74 7469 6e67 2066 756e 6374  y plotting funct
+00002450: 696f 6e73 2075 7369 6e67 2070 6c6f 746c  ions using plotl
+00002460: 792e 2222 220a 0a20 2020 2023 204e 2e42  y."""..    # N.B
+00002470: 2e2c 206d 6f73 7420 6f66 2074 6865 7365  ., most of these
+00002480: 2070 6172 616d 6574 6572 7320 6172 6520   parameters are 
+00002490: 616c 7761 7973 2061 626c 6520 746f 2074  always able to t
+000024a0: 616b 6520 4e6f 6e65 0a20 2020 2023 2061  ake None.    # a
+000024b0: 6e64 2073 6f20 7765 2073 6574 2061 7320  nd so we set as 
+000024c0: 4f70 7469 6f6e 616c 2068 6572 652c 2072  Optional here, r
+000024d0: 6174 6865 7220 7468 616e 2068 6176 696e  ather than havin
+000024e0: 6720 746f 2072 6570 6561 740a 2020 2020  g to repeat.    
+000024f0: 2320 7468 6174 2066 6f72 2065 6163 6820  # that for each 
+00002500: 6675 6e63 7469 6f6e 2064 6f63 2e0a 0a20  function doc... 
+00002510: 2020 2078 5f6c 6162 656c 3a20 5479 7065     x_label: Type
+00002520: 416c 6961 7320 3d20 416e 6e6f 7461 7465  Alias = Annotate
+00002530: 645b 0a20 2020 2020 2020 204f 7074 696f  d[.        Optio
+00002540: 6e61 6c5b 7374 725d 2c0a 2020 2020 2020  nal[str],.      
+00002550: 2020 2258 2061 7869 7320 6c61 6265 6c2e    "X axis label.
+00002560: 222c 0a20 2020 205d 0a20 2020 2079 5f6c  ",.    ].    y_l
+00002570: 6162 656c 3a20 5479 7065 416c 6961 7320  abel: TypeAlias 
+00002580: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
+00002590: 2020 2020 204f 7074 696f 6e61 6c5b 7374       Optional[st
+000025a0: 725d 2c0a 2020 2020 2020 2020 2259 2061  r],.        "Y a
+000025b0: 7869 7320 6c61 6265 6c2e 222c 0a20 2020  xis label.",.   
+000025c0: 205d 0a20 2020 2077 6964 7468 3a20 5479   ].    width: Ty
+000025d0: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
+000025e0: 7465 645b 0a20 2020 2020 2020 204f 7074  ted[.        Opt
+000025f0: 696f 6e61 6c5b 696e 745d 2c0a 2020 2020  ional[int],.    
+00002600: 2020 2020 2250 6c6f 7420 7769 6474 6820      "Plot width 
+00002610: 696e 2070 6978 656c 7320 2870 7829 2e22  in pixels (px)."
+00002620: 2c0a 2020 2020 5d0a 2020 2020 6865 6967  ,.    ].    heig
+00002630: 6874 3a20 5479 7065 416c 6961 7320 3d20  ht: TypeAlias = 
+00002640: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
+00002650: 2020 204f 7074 696f 6e61 6c5b 696e 745d     Optional[int]
+00002660: 2c0a 2020 2020 2020 2020 2250 6c6f 7420  ,.        "Plot 
+00002670: 6865 6967 6874 2069 6e20 7069 7865 6c73  height in pixels
+00002680: 2028 7078 292e 222c 0a20 2020 205d 0a20   (px).",.    ]. 
+00002690: 2020 2061 7370 6563 743a 2054 7970 6541     aspect: TypeA
+000026a0: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
+000026b0: 5b0a 2020 2020 2020 2020 4f70 7469 6f6e  [.        Option
+000026c0: 616c 5b4c 6974 6572 616c 5b22 6571 7561  al[Literal["equa
+000026d0: 6c22 2c20 2261 7574 6f22 5d5d 2c0a 2020  l", "auto"]],.  
+000026e0: 2020 2020 2020 2241 7370 6563 7420 7261        "Aspect ra
+000026f0: 7469 6f2c 2073 6565 2061 6c73 6f20 6874  tio, see also ht
+00002700: 7470 733a 2f2f 706c 6f74 6c79 2e63 6f6d  tps://plotly.com
+00002710: 2f70 7974 686f 6e2d 6170 692d 7265 6665  /python-api-refe
+00002720: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
+00002730: 706c 6f74 6c79 2e65 7870 7265 7373 2e69  plotly.express.i
+00002740: 6d73 686f 7722 2c0a 2020 2020 5d0a 2020  mshow",.    ].  
+00002750: 2020 7469 746c 653a 2054 7970 6541 6c69    title: TypeAli
+00002760: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
+00002770: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
+00002780: 5b55 6e69 6f6e 5b73 7472 2c20 626f 6f6c  [Union[str, bool
+00002790: 5d5d 2c0a 2020 2020 2020 2020 2222 220a  ]],.        """.
+000027a0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+000027b0: 2061 7474 656d 7074 2074 6f20 7573 6520   attempt to use 
+000027c0: 6d65 7461 6461 7461 2066 726f 6d20 696e  metadata from in
+000027d0: 7075 7420 6461 7461 7365 7420 6173 2061  put dataset as a
+000027e0: 2070 6c6f 7420 7469 746c 652e 0a20 2020   plot title..   
+000027f0: 2020 2020 204f 7468 6572 7769 7365 2c20       Otherwise, 
+00002800: 7573 6520 7375 7070 6c69 6564 2076 616c  use supplied val
+00002810: 7565 2061 7320 6120 7469 746c 652e 0a20  ue as a title.. 
+00002820: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
+00002830: 5d0a 2020 2020 7465 7874 5f61 7574 6f3a  ].    text_auto:
+00002840: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+00002850: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
+00002860: 556e 696f 6e5b 626f 6f6c 2c20 7374 725d  Union[bool, str]
+00002870: 2c0a 2020 2020 2020 2020 2222 220a 2020  ,.        """.  
+00002880: 2020 2020 2020 4966 2054 7275 6520 6f72        If True or
+00002890: 2061 2073 7472 696e 672c 2073 696e 676c   a string, singl
+000028a0: 652d 6368 616e 6e65 6c20 696d 6720 7661  e-channel img va
+000028b0: 6c75 6573 2077 696c 6c20 6265 2064 6973  lues will be dis
+000028c0: 706c 6179 6564 2061 7320 7465 7874 2e20  played as text. 
+000028d0: 410a 2020 2020 2020 2020 7374 7269 6e67  A.        string
+000028e0: 206c 696b 6520 272e 3266 2720 7769 6c6c   like '.2f' will
+000028f0: 2062 6520 696e 7465 7270 7265 7465 6420   be interpreted 
+00002900: 6173 2061 2074 6578 7474 656d 706c 6174  as a texttemplat
+00002910: 6520 6e75 6d65 7269 6320 666f 726d 6174  e numeric format
+00002920: 7469 6e67 0a20 2020 2020 2020 2064 6972  ting.        dir
+00002930: 6563 7469 7665 2e0a 2020 2020 2020 2020  ective..        
+00002940: 2222 222c 0a20 2020 205d 0a20 2020 2063  """,.    ].    c
+00002950: 6f6c 6f72 5f63 6f6e 7469 6e75 6f75 735f  olor_continuous_
+00002960: 7363 616c 653a 2054 7970 6541 6c69 6173  scale: TypeAlias
+00002970: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00002980: 2020 2020 2020 4f70 7469 6f6e 616c 5b55        Optional[U
+00002990: 6e69 6f6e 5b73 7472 2c20 4c69 7374 5b73  nion[str, List[s
+000029a0: 7472 5d5d 5d2c 0a20 2020 2020 2020 2022  tr]]],.        "
+000029b0: 2222 0a20 2020 2020 2020 2043 6f6c 6f72  "".        Color
+000029c0: 6d61 7020 7573 6564 2074 6f20 6d61 7020  map used to map 
+000029d0: 7363 616c 6172 2064 6174 6120 746f 2063  scalar data to c
+000029e0: 6f6c 6f72 7320 2866 6f72 2061 2032 4420  olors (for a 2D 
+000029f0: 696d 6167 6529 2e20 5468 6973 0a20 2020  image). This.   
+00002a00: 2020 2020 2070 6172 616d 6574 6572 2069       parameter i
+00002a10: 7320 6e6f 7420 7573 6564 2066 6f72 2052  s not used for R
+00002a20: 4742 206f 7220 5247 4241 2069 6d61 6765  GB or RGBA image
+00002a30: 732e 2049 6620 6120 7374 7269 6e67 2069  s. If a string i
+00002a40: 7320 7072 6f76 6964 6564 2c0a 2020 2020  s provided,.    
+00002a50: 2020 2020 6974 2073 686f 756c 6420 6265      it should be
+00002a60: 2074 6865 206e 616d 6520 6f66 2061 206b   the name of a k
+00002a70: 6e6f 776e 2063 6f6c 6f72 2073 6361 6c65  nown color scale
+00002a80: 2c20 616e 6420 6966 2061 206c 6973 7420  , and if a list 
+00002a90: 6973 2070 726f 7669 6465 642c 0a20 2020  is provided,.   
+00002aa0: 2020 2020 2069 7420 7368 6f75 6c64 2062       it should b
+00002ab0: 6520 6120 6c69 7374 206f 6620 4353 532d  e a list of CSS-
+00002ac0: 636f 6d70 6174 6962 6c65 2063 6f6c 6f72  compatible color
+00002ad0: 732e 0a20 2020 2020 2020 2022 2222 2c0a  s..        """,.
+00002ae0: 2020 2020 5d0a 2020 2020 636f 6c6f 7262      ].    colorb
+00002af0: 6172 3a20 5479 7065 416c 6961 7320 3d20  ar: TypeAlias = 
+00002b00: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
+00002b10: 2020 2062 6f6f 6c2c 0a20 2020 2020 2020     bool,.       
+00002b20: 2022 4966 2046 616c 7365 2c20 646f 206e   "If False, do n
+00002b30: 6f74 2064 6973 706c 6179 2061 2063 6f6c  ot display a col
+00002b40: 6f72 2062 6172 2e22 2c0a 2020 2020 5d0a  or bar.",.    ].
+00002b50: 2020 2020 783a 2054 7970 6541 6c69 6173      x: TypeAlias
+00002b60: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00002b70: 2020 2020 2020 7374 722c 0a20 2020 2020        str,.     
+00002b80: 2020 2022 4e61 6d65 206f 6620 7661 7269     "Name of vari
+00002b90: 6162 6c65 2074 6f20 706c 6f74 206f 6e20  able to plot on 
+00002ba0: 7468 6520 5820 6178 6973 2e22 2c0a 2020  the X axis.",.  
+00002bb0: 2020 5d0a 2020 2020 793a 2054 7970 6541    ].    y: TypeA
+00002bc0: 6c69 6173 203d 2041 6e6e 6f74 6174 6564  lias = Annotated
+00002bd0: 5b0a 2020 2020 2020 2020 7374 722c 0a20  [.        str,. 
+00002be0: 2020 2020 2020 2022 4e61 6d65 206f 6620         "Name of 
+00002bf0: 7661 7269 6162 6c65 2074 6f20 706c 6f74  variable to plot
+00002c00: 206f 6e20 7468 6520 5920 6178 6973 2e22   on the Y axis."
+00002c10: 2c0a 2020 2020 5d0a 2020 2020 7a3a 2054  ,.    ].    z: T
+00002c20: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
+00002c30: 6174 6564 5b0a 2020 2020 2020 2020 7374  ated[.        st
+00002c40: 722c 0a20 2020 2020 2020 2022 4e61 6d65  r,.        "Name
+00002c50: 206f 6620 7661 7269 6162 6c65 2074 6f20   of variable to 
+00002c60: 706c 6f74 206f 6e20 7468 6520 5a20 6178  plot on the Z ax
+00002c70: 6973 2e22 2c0a 2020 2020 5d0a 2020 2020  is.",.    ].    
+00002c80: 636f 6c6f 723a 2054 7970 6541 6c69 6173  color: TypeAlias
+00002c90: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00002ca0: 2020 2020 2020 4f70 7469 6f6e 616c 5b73        Optional[s
+00002cb0: 7472 5d2c 0a20 2020 2020 2020 2022 4e61  tr],.        "Na
+00002cc0: 6d65 206f 6620 7661 7269 6162 6c65 2074  me of variable t
+00002cd0: 6f20 7573 6520 746f 2063 6f6c 6f72 2074  o use to color t
+00002ce0: 6865 206d 6172 6b65 7273 2e22 2c0a 2020  he markers.",.  
+00002cf0: 2020 5d0a 2020 2020 7379 6d62 6f6c 3a20    ].    symbol: 
+00002d00: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
+00002d10: 7461 7465 645b 0a20 2020 2020 2020 204f  tated[.        O
+00002d20: 7074 696f 6e61 6c5b 7374 725d 2c0a 2020  ptional[str],.  
+00002d30: 2020 2020 2020 224e 616d 6520 6f66 2074        "Name of t
+00002d40: 6865 2076 6172 6961 626c 6520 746f 2075  he variable to u
+00002d50: 7365 2074 6f20 6368 6f6f 7365 206d 6172  se to choose mar
+00002d60: 6b65 7220 7379 6d62 6f6c 732e 222c 0a20  ker symbols.",. 
+00002d70: 2020 205d 0a20 2020 206a 6974 7465 725f     ].    jitter_
+00002d80: 6672 6163 3a20 5479 7065 416c 6961 7320  frac: TypeAlias 
+00002d90: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
+00002da0: 2020 2020 204f 7074 696f 6e61 6c5b 666c       Optional[fl
+00002db0: 6f61 745d 2c0a 2020 2020 2020 2020 2252  oat],.        "R
+00002dc0: 616e 646f 6d6c 7920 6a69 7474 6572 2070  andomly jitter p
+00002dd0: 6f69 6e74 7320 6279 2074 6869 7320 6672  oints by this fr
+00002de0: 6163 7469 6f6e 206f 6620 7468 6569 7220  action of their 
+00002df0: 7261 6e67 652e 222c 0a20 2020 205d 0a20  range.",.    ]. 
+00002e00: 2020 206d 6172 6b65 725f 7369 7a65 3a20     marker_size: 
+00002e10: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
+00002e20: 7461 7465 645b 0a20 2020 2020 2020 2069  tated[.        i
+00002e30: 6e74 2c0a 2020 2020 2020 2020 224d 6172  nt,.        "Mar
+00002e40: 6b65 7220 7369 7a65 2e22 2c0a 2020 2020  ker size.",.    
+00002e50: 5d0a 2020 2020 7465 6d70 6c61 7465 3a20  ].    template: 
+00002e60: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
+00002e70: 7461 7465 645b 0a20 2020 2020 2020 204f  tated[.        O
+00002e80: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+00002e90: 2020 2020 204c 6974 6572 616c 5b0a 2020       Literal[.  
+00002ea0: 2020 2020 2020 2020 2020 2020 2020 2267                "g
+00002eb0: 6770 6c6f 7432 222c 0a20 2020 2020 2020  gplot2",.       
+00002ec0: 2020 2020 2020 2020 2022 7365 6162 6f72           "seabor
+00002ed0: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
+00002ee0: 2020 2020 2273 696d 706c 655f 7768 6974      "simple_whit
+00002ef0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+00002f00: 2020 2020 2270 6c6f 746c 7922 2c0a 2020      "plotly",.  
+00002f10: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+00002f20: 6c6f 746c 795f 7768 6974 6522 2c0a 2020  lotly_white",.  
+00002f30: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+00002f40: 6c6f 746c 795f 6461 726b 222c 0a20 2020  lotly_dark",.   
+00002f50: 2020 2020 2020 2020 2020 2020 2022 7072               "pr
+00002f60: 6573 656e 7461 7469 6f6e 222c 0a20 2020  esentation",.   
+00002f70: 2020 2020 2020 2020 2020 2020 2022 7867               "xg
+00002f80: 7269 646f 6666 222c 0a20 2020 2020 2020  ridoff",.       
+00002f90: 2020 2020 2020 2020 2022 7967 7269 646f           "ygrido
+00002fa0: 6666 222c 0a20 2020 2020 2020 2020 2020  ff",.           
+00002fb0: 2020 2020 2022 6772 6964 6f6e 222c 0a20       "gridon",. 
+00002fc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00002fd0: 6e6f 6e65 222c 0a20 2020 2020 2020 2020  none",.         
+00002fe0: 2020 205d 0a20 2020 2020 2020 205d 2c0a     ].        ],.
+00002ff0: 2020 2020 2020 2020 2254 6865 2066 6967          "The fig
+00003000: 7572 6520 7465 6d70 6c61 7465 206e 616d  ure template nam
+00003010: 6520 286d 7573 7420 6265 2061 206b 6579  e (must be a key
+00003020: 2069 6e20 706c 6f74 6c79 2e69 6f2e 7465   in plotly.io.te
+00003030: 6d70 6c61 7465 7329 2e22 2c0a 2020 2020  mplates).",.    
+00003040: 5d0a 2020 2020 6669 6775 7265 3a20 5479  ].    figure: Ty
+00003050: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
+00003060: 7465 645b 676f 2e46 6967 7572 652c 2022  ted[go.Figure, "
+00003070: 4120 706c 6f74 6c79 2066 6967 7572 652e  A plotly figure.
+00003080: 225d 0a0a 0a63 6c61 7373 2069 6873 5f70  "]...class ihs_p
+00003090: 6172 616d 733a 0a20 2020 2077 696e 646f  arams:.    windo
+000030a0: 775f 7369 7a65 3a20 5479 7065 416c 6961  w_size: TypeAlia
+000030b0: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
+000030c0: 2020 2020 2020 2069 6e74 2c0a 2020 2020         int,.    
+000030d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000030e0: 5468 6520 7369 7a65 206f 6620 7769 6e64  The size of wind
+000030f0: 6f77 2069 6e20 6e75 6d62 6572 206f 6620  ow in number of 
+00003100: 534e 5073 2075 7365 6420 746f 2073 756d  SNPs used to sum
+00003110: 6d61 7269 7365 2069 4853 206f 7665 722e  marise iHS over.
+00003120: 0a20 2020 2020 2020 2049 6620 4e6f 6e65  .        If None
+00003130: 2c20 7065 722d 7661 7269 616e 7420 6948  , per-variant iH
+00003140: 5320 7661 6c75 6573 2061 7265 2072 6574  S values are ret
+00003150: 7572 6e65 642e 0a20 2020 2020 2020 2022  urned..        "
+00003160: 2222 2c0a 2020 2020 5d0a 2020 2020 7769  "",.    ].    wi
+00003170: 6e64 6f77 5f73 697a 655f 6465 6661 756c  ndow_size_defaul
+00003180: 743a 2077 696e 646f 775f 7369 7a65 203d  t: window_size =
+00003190: 2032 3030 0a20 2020 206d 696e 5f63 6f68   200.    min_coh
+000031a0: 6f72 745f 7369 7a65 5f64 6566 6175 6c74  ort_size_default
+000031b0: 3a20 6261 7365 5f70 6172 616d 732e 6d69  : base_params.mi
+000031c0: 6e5f 636f 686f 7274 5f73 697a 6520 3d20  n_cohort_size = 
+000031d0: 3135 0a20 2020 206d 6178 5f63 6f68 6f72  15.    max_cohor
+000031e0: 745f 7369 7a65 5f64 6566 6175 6c74 3a20  t_size_default: 
+000031f0: 6261 7365 5f70 6172 616d 732e 6d61 785f  base_params.max_
+00003200: 636f 686f 7274 5f73 697a 6520 3d20 3530  cohort_size = 50
+00003210: 0a20 2020 2070 6572 6365 6e74 696c 6573  .    percentiles
+00003220: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
+00003230: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
+00003240: 2055 6e69 6f6e 5b69 6e74 2c20 5475 706c   Union[int, Tupl
+00003250: 655b 696e 742c 202e 2e2e 5d5d 2c0a 2020  e[int, ...]],.  
+00003260: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003270: 2020 4966 2077 696e 646f 7720 7369 7a65    If window size
+00003280: 2069 7320 7370 6563 6966 6965 642c 2074   is specified, t
+00003290: 6869 7320 7265 7475 726e 7320 7468 6520  his returns the 
+000032a0: 6948 5320 7065 7263 656e 7469 6c65 730a  iHS percentiles.
+000032b0: 2020 2020 2020 2020 666f 7220 6561 6368          for each
+000032c0: 2077 696e 646f 772e 0a20 2020 2020 2020   window..       
+000032d0: 2022 2222 2c0a 2020 2020 5d0a 2020 2020   """,.    ].    
+000032e0: 7065 7263 656e 7469 6c65 735f 6465 6661  percentiles_defa
+000032f0: 756c 743a 2070 6572 6365 6e74 696c 6573  ult: percentiles
+00003300: 203d 2028 3530 2c20 3735 2c20 3130 3029   = (50, 75, 100)
+00003310: 0a20 2020 2073 7461 6e64 6172 6469 7a65  .    standardize
+00003320: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
+00003330: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
+00003340: 2062 6f6f 6c2c 2022 4966 2054 7275 652c   bool, "If True,
+00003350: 2073 7461 6e64 6172 6469 7a65 2069 4853   standardize iHS
+00003360: 2076 616c 7565 7320 6279 2061 6c74 6572   values by alter
+00003370: 6e61 7465 2061 6c6c 656c 6520 636f 756e  nate allele coun
+00003380: 7473 2e22 0a20 2020 205d 0a20 2020 2073  ts.".    ].    s
+00003390: 7461 6e64 6172 6469 7a61 7469 6f6e 5f62  tandardization_b
+000033a0: 696e 733a 2054 7970 6541 6c69 6173 203d  ins: TypeAlias =
+000033b0: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
+000033c0: 2020 2020 5475 706c 655b 666c 6f61 742c      Tuple[float,
+000033d0: 202e 2e2e 5d2c 0a20 2020 2020 2020 2022   ...],.        "
+000033e0: 4966 2070 726f 7669 6465 642c 2075 7365  If provided, use
+000033f0: 2074 6865 7365 2061 6c6c 656c 6520 636f   these allele co
+00003400: 756e 7420 6269 6e73 2074 6f20 7374 616e  unt bins to stan
+00003410: 6461 7264 697a 6520 6948 5320 7661 6c75  dardize iHS valu
+00003420: 6573 2e22 2c0a 2020 2020 5d0a 2020 2020  es.",.    ].    
+00003430: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
+00003440: 6e5f 6269 6e73 3a20 5479 7065 416c 6961  n_bins: TypeAlia
+00003450: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
+00003460: 2020 2020 2020 2069 6e74 2c0a 2020 2020         int,.    
+00003470: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003480: 4e75 6d62 6572 206f 6620 616c 6c65 6c65  Number of allele
+00003490: 2063 6f75 6e74 2062 696e 7320 746f 2075   count bins to u
+000034a0: 7365 2066 6f72 2073 7461 6e64 6172 6469  se for standardi
+000034b0: 7a61 7469 6f6e 2e0a 2020 2020 2020 2020  zation..        
+000034c0: 4f76 6572 7269 6465 7320 7374 616e 6461  Overrides standa
+000034d0: 7264 697a 6174 696f 6e5f 6269 6e73 2e0a  rdization_bins..
+000034e0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
+000034f0: 205d 0a20 2020 2073 7461 6e64 6172 6469   ].    standardi
+00003500: 7a61 7469 6f6e 5f6e 5f62 696e 735f 6465  zation_n_bins_de
+00003510: 6661 756c 743a 2073 7461 6e64 6172 6469  fault: standardi
+00003520: 7a61 7469 6f6e 5f6e 5f62 696e 7320 3d20  zation_n_bins = 
+00003530: 3230 0a20 2020 2073 7461 6e64 6172 6469  20.    standardi
+00003540: 7a61 7469 6f6e 5f64 6961 676e 6f73 7469  zation_diagnosti
+00003550: 6373 3a20 5479 7065 416c 6961 7320 3d20  cs: TypeAlias = 
+00003560: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
+00003570: 2020 2062 6f6f 6c2c 2022 4966 2054 7275     bool, "If Tru
+00003580: 652c 2070 6c6f 7420 736f 6d65 2064 6961  e, plot some dia
+00003590: 676e 6f73 7469 6373 2061 626f 7574 2074  gnostics about t
+000035a0: 6865 2073 7461 6e64 6172 6469 7a61 7469  he standardizati
+000035b0: 6f6e 2e22 0a20 2020 205d 0a20 2020 2066  on.".    ].    f
+000035c0: 696c 7465 725f 6d69 6e5f 6d61 663a 2054  ilter_min_maf: T
+000035d0: 7970 6541 6c69 6173 203d 2041 6e6e 6f74  ypeAlias = Annot
+000035e0: 6174 6564 5b0a 2020 2020 2020 2020 666c  ated[.        fl
+000035f0: 6f61 742c 0a20 2020 2020 2020 2022 2222  oat,.        """
+00003600: 0a20 2020 2020 2020 204d 696e 696d 756d  .        Minimum
+00003610: 206d 696e 6f72 2061 6c6c 656c 6520 6672   minor allele fr
+00003620: 6571 7565 6e63 7920 746f 2075 7365 2066  equency to use f
+00003630: 6f72 2066 696c 7465 7269 6e67 2070 7269  or filtering pri
+00003640: 6f72 2074 6f20 7061 7373 696e 670a 2020  or to passing.  
+00003650: 2020 2020 2020 6861 706c 6f74 7970 6573        haplotypes
+00003660: 2074 6f20 616c 6c65 6c2e 6968 7320 6675   to allel.ihs fu
+00003670: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
+00003680: 2222 2c0a 2020 2020 5d0a 2020 2020 6669  "",.    ].    fi
+00003690: 6c74 6572 5f6d 696e 5f6d 6166 5f64 6566  lter_min_maf_def
+000036a0: 6175 6c74 3a20 6669 6c74 6572 5f6d 696e  ault: filter_min
+000036b0: 5f6d 6166 203d 2030 2e30 350a 2020 2020  _maf = 0.05.    
+000036c0: 636f 6d70 7574 655f 6d69 6e5f 6d61 663a  compute_min_maf:
+000036d0: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+000036e0: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
+000036f0: 666c 6f61 742c 0a20 2020 2020 2020 2022  float,.        "
+00003700: 2222 0a20 2020 2020 2020 2044 6f20 6e6f  "".        Do no
+00003710: 7420 636f 6d70 7574 6520 696e 7465 6772  t compute integr
+00003720: 6174 6564 2068 6170 6c6f 7479 7065 2068  ated haplotype h
+00003730: 6f6d 6f7a 7967 6f73 6974 7920 666f 7220  omozygosity for 
+00003740: 7661 7269 616e 7473 2077 6974 680a 2020  variants with.  
+00003750: 2020 2020 2020 6d69 6e6f 7220 616c 6c65        minor alle
+00003760: 6c65 2066 7265 7175 656e 6379 2062 656c  le frequency bel
+00003770: 6f77 2074 6869 7320 7468 7265 7368 6f6c  ow this threshol
+00003780: 642e 0a20 2020 2020 2020 2022 2222 2c0a  d..        """,.
+00003790: 2020 2020 5d0a 2020 2020 636f 6d70 7574      ].    comput
+000037a0: 655f 6d69 6e5f 6d61 665f 6465 6661 756c  e_min_maf_defaul
+000037b0: 743a 2063 6f6d 7075 7465 5f6d 696e 5f6d  t: compute_min_m
+000037c0: 6166 203d 2030 2e30 350a 2020 2020 6d69  af = 0.05.    mi
+000037d0: 6e5f 6568 683a 2054 7970 6541 6c69 6173  n_ehh: TypeAlias
+000037e0: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+000037f0: 2020 2020 2020 666c 6f61 742c 0a20 2020        float,.   
+00003800: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003810: 204d 696e 696d 756d 2045 4848 2062 6579   Minimum EHH bey
+00003820: 6f6e 6420 7768 6963 6820 746f 2074 7275  ond which to tru
+00003830: 6e63 6174 6520 696e 7465 6772 6174 6564  ncate integrated
+00003840: 2068 6170 6c6f 7479 7065 2068 6f6d 6f7a   haplotype homoz
+00003850: 7967 6f73 6974 790a 2020 2020 2020 2020  ygosity.        
+00003860: 6361 6c63 756c 6174 696f 6e2e 0a20 2020  calculation..   
+00003870: 2020 2020 2022 2222 2c0a 2020 2020 5d0a       """,.    ].
+00003880: 2020 2020 6d69 6e5f 6568 685f 6465 6661      min_ehh_defa
+00003890: 756c 743a 206d 696e 5f65 6868 203d 2030  ult: min_ehh = 0
+000038a0: 2e30 350a 2020 2020 6d61 785f 6761 703a  .05.    max_gap:
+000038b0: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+000038c0: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
+000038d0: 696e 742c 0a20 2020 2020 2020 2022 2222  int,.        """
+000038e0: 0a20 2020 2020 2020 2044 6f20 6e6f 7420  .        Do not 
+000038f0: 7265 706f 7274 2073 636f 7265 7320 6966  report scores if
+00003900: 2045 4848 2073 7061 6e73 2061 2067 6170   EHH spans a gap
+00003910: 206c 6172 6765 7220 7468 616e 2074 6869   larger than thi
+00003920: 7320 6e75 6d62 6572 206f 660a 2020 2020  s number of.    
+00003930: 2020 2020 6261 7365 2070 6169 7273 2e0a      base pairs..
+00003940: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
+00003950: 205d 0a20 2020 206d 6178 5f67 6170 5f64   ].    max_gap_d
+00003960: 6566 6175 6c74 3a20 6d61 785f 6761 7020  efault: max_gap 
+00003970: 3d20 3230 305f 3030 300a 2020 2020 6761  = 200_000.    ga
+00003980: 705f 7363 616c 653a 2054 7970 6541 6c69  p_scale: TypeAli
+00003990: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
+000039a0: 2020 2020 2020 2020 696e 742c 2022 5265          int, "Re
+000039b0: 7363 616c 6520 6469 7374 616e 6365 2062  scale distance b
+000039c0: 6574 7765 656e 2076 6172 6961 6e74 7320  etween variants 
+000039d0: 6966 2067 6170 2069 7320 6c61 7267 6572  if gap is larger
+000039e0: 2074 6861 6e20 7468 6973 2076 616c 7565   than this value
+000039f0: 2e22 0a20 2020 205d 0a20 2020 2067 6170  .".    ].    gap
+00003a00: 5f73 6361 6c65 5f64 6566 6175 6c74 3a20  _scale_default: 
+00003a10: 6761 705f 7363 616c 6520 3d20 3230 5f30  gap_scale = 20_0
+00003a20: 3030 0a20 2020 2069 6e63 6c75 6465 5f65  00.    include_e
+00003a30: 6467 6573 3a20 5479 7065 416c 6961 7320  dges: TypeAlias 
+00003a40: 3d20 416e 6e6f 7461 7465 645b 0a20 2020  = Annotated[.   
+00003a50: 2020 2020 2062 6f6f 6c2c 0a20 2020 2020       bool,.     
+00003a60: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
+00003a70: 6620 5472 7565 2c20 7265 706f 7274 2073  f True, report s
+00003a80: 636f 7265 7320 6576 656e 2069 6620 4548  cores even if EH
+00003a90: 4820 646f 6573 206e 6f74 2064 6563 6179  H does not decay
+00003aa0: 2062 656c 6f77 206d 696e 5f65 6868 2061   below min_ehh a
+00003ab0: 7420 7468 650a 2020 2020 2020 2020 656e  t the.        en
+00003ac0: 6420 6f66 2074 6865 2063 6872 6f6d 6f73  d of the chromos
+00003ad0: 6f6d 652e 0a20 2020 2020 2020 2022 2222  ome..        """
+00003ae0: 2c0a 2020 2020 5d0a 2020 2020 7573 655f  ,.    ].    use_
+00003af0: 7468 7265 6164 733a 2054 7970 6541 6c69  threads: TypeAli
+00003b00: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
+00003b10: 2020 2020 2020 2020 626f 6f6c 2c20 2249          bool, "I
+00003b20: 6620 5472 7565 2c20 7573 6520 6d75 6c74  f True, use mult
+00003b30: 6970 6c65 2074 6872 6561 6473 2074 6f20  iple threads to 
+00003b40: 636f 6d70 7574 6520 6948 532e 220a 2020  compute iHS.".  
+00003b50: 2020 5d0a 2020 2020 7061 6c65 7474 653a    ].    palette:
+00003b60: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+00003b70: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
+00003b80: 7374 722c 2022 4e61 6d65 206f 6620 626f  str, "Name of bo
+00003b90: 6b65 6820 7061 6c65 7474 6520 746f 2075  keh palette to u
+00003ba0: 7365 2066 6f72 2070 6c6f 7474 696e 6720  se for plotting 
+00003bb0: 6d75 6c74 6970 6c65 2070 6572 6365 6e74  multiple percent
+00003bc0: 696c 6573 2e22 0a20 2020 205d 0a20 2020  iles.".    ].   
+00003bd0: 2070 616c 6574 7465 5f64 6566 6175 6c74   palette_default
+00003be0: 3a20 7061 6c65 7474 6520 3d20 2242 6c75  : palette = "Blu
+00003bf0: 6573 220a 0a0a 636c 6173 7320 6861 7063  es"...class hapc
+00003c00: 6c75 7374 5f70 6172 616d 733a 0a20 2020  lust_params:.   
+00003c10: 206c 696e 6b61 6765 5f6d 6574 686f 643a   linkage_method:
+00003c20: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+00003c30: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
+00003c40: 4c69 7465 7261 6c5b 0a20 2020 2020 2020  Literal[.       
+00003c50: 2020 2020 2022 7369 6e67 6c65 222c 2022       "single", "
+00003c60: 636f 6d70 6c65 7465 222c 2022 6176 6572  complete", "aver
+00003c70: 6167 6522 2c20 2277 6569 6768 7465 6422  age", "weighted"
+00003c80: 2c20 2263 656e 7472 6f69 6422 2c20 226d  , "centroid", "m
+00003c90: 6564 6961 6e22 2c20 2277 6172 6422 0a20  edian", "ward". 
+00003ca0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+00003cb0: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+00003cc0: 6520 6c69 6e6b 6167 6520 616c 676f 7269  e linkage algori
+00003cd0: 7468 6d20 746f 2075 7365 2e20 5365 6520  thm to use. See 
+00003ce0: 7468 6520 4c69 6e6b 6167 6520 4d65 7468  the Linkage Meth
+00003cf0: 6f64 7320 7365 6374 696f 6e20 6f66 2074  ods section of t
+00003d00: 6865 0a20 2020 2020 2020 2073 6369 7079  he.        scipy
+00003d10: 2e63 6c75 7374 6572 2e68 6965 7261 7263  .cluster.hierarc
+00003d20: 6879 2e6c 696e 6b61 6765 2064 6f63 7320  hy.linkage docs 
+00003d30: 666f 7220 6675 6c6c 2064 6573 6372 6970  for full descrip
+00003d40: 7469 6f6e 732e 0a20 2020 2020 2020 2022  tions..        "
+00003d50: 2222 2c0a 2020 2020 5d0a 2020 2020 6c69  "",.    ].    li
+00003d60: 6e6b 6167 655f 6d65 7468 6f64 5f64 6566  nkage_method_def
+00003d70: 6175 6c74 3a20 6c69 6e6b 6167 655f 6d65  ault: linkage_me
+00003d80: 7468 6f64 203d 2022 7369 6e67 6c65 220a  thod = "single".
+00003d90: 2020 2020 636f 756e 745f 736f 7274 3a20      count_sort: 
+00003da0: 5479 7065 416c 6961 7320 3d20 416e 6e6f  TypeAlias = Anno
+00003db0: 7461 7465 645b 0a20 2020 2020 2020 2062  tated[.        b
+00003dc0: 6f6f 6c2c 0a20 2020 2020 2020 2022 2222  ool,.        """
+00003dd0: 0a20 2020 2020 2020 2046 6f72 2065 6163  .        For eac
+00003de0: 6820 6e6f 6465 206e 2c20 7468 6520 6f72  h node n, the or
+00003df0: 6465 7220 2876 6973 7561 6c6c 792c 2066  der (visually, f
+00003e00: 726f 6d20 6c65 6674 2d74 6f2d 7269 6768  rom left-to-righ
+00003e10: 7429 206e 2773 2074 776f 2064 6573 6365  t) n's two desce
+00003e20: 6e64 616e 740a 2020 2020 2020 2020 6c69  ndant.        li
+00003e30: 6e6b 7320 6172 6520 706c 6f74 7465 6420  nks are plotted 
+00003e40: 6973 2064 6574 6572 6d69 6e65 6420 6279  is determined by
+00003e50: 2074 6869 7320 7061 7261 6d65 7465 722e   this parameter.
+00003e60: 2049 6620 5472 7565 2c20 7468 6520 6368   If True, the ch
+00003e70: 696c 6420 7769 7468 0a20 2020 2020 2020  ild with.       
+00003e80: 2074 6865 206d 696e 696d 756d 206e 756d   the minimum num
+00003e90: 6265 7220 6f66 206f 7269 6769 6e61 6c20  ber of original 
+00003ea0: 6f62 6a65 6374 7320 696e 2069 7473 2063  objects in its c
+00003eb0: 6c75 7374 6572 2069 7320 706c 6f74 7465  luster is plotte
+00003ec0: 6420 6669 7273 742e 204e 6f74 650a 2020  d first. Note.  
+00003ed0: 2020 2020 2020 6469 7374 616e 6365 5f73        distance_s
+00003ee0: 6f72 7420 616e 6420 636f 756e 745f 736f  ort and count_so
+00003ef0: 7274 2063 616e 6e6f 7420 626f 7468 2062  rt cannot both b
+00003f00: 6520 5472 7565 2e0a 2020 2020 2020 2020  e True..        
+00003f10: 2222 222c 0a20 2020 205d 0a20 2020 2064  """,.    ].    d
+00003f20: 6973 7461 6e63 655f 736f 7274 3a20 5479  istance_sort: Ty
+00003f30: 7065 416c 6961 7320 3d20 416e 6e6f 7461  peAlias = Annota
+00003f40: 7465 645b 0a20 2020 2020 2020 2062 6f6f  ted[.        boo
+00003f50: 6c2c 0a20 2020 2020 2020 2022 2222 0a20  l,.        """. 
+00003f60: 2020 2020 2020 2046 6f72 2065 6163 6820         For each 
+00003f70: 6e6f 6465 206e 2c20 7468 6520 6f72 6465  node n, the orde
+00003f80: 7220 2876 6973 7561 6c6c 792c 2066 726f  r (visually, fro
+00003f90: 6d20 6c65 6674 2d74 6f2d 7269 6768 7429  m left-to-right)
+00003fa0: 206e 2773 2074 776f 2064 6573 6365 6e64   n's two descend
+00003fb0: 616e 740a 2020 2020 2020 2020 6c69 6e6b  ant.        link
+00003fc0: 7320 6172 6520 706c 6f74 7465 6420 6973  s are plotted is
+00003fd0: 2064 6574 6572 6d69 6e65 6420 6279 2074   determined by t
+00003fe0: 6869 7320 7061 7261 6d65 7465 722e 2049  his parameter. I
+00003ff0: 6620 5472 7565 2c20 5468 6520 6368 696c  f True, The chil
+00004000: 6420 7769 7468 2074 6865 0a20 2020 2020  d with the.     
+00004010: 2020 206d 696e 696d 756d 2064 6973 7461     minimum dista
+00004020: 6e63 6520 6265 7477 6565 6e20 6974 7320  nce between its 
+00004030: 6469 7265 6374 2064 6573 6365 6e64 616e  direct descendan
+00004040: 7473 2069 7320 706c 6f74 7465 6420 6669  ts is plotted fi
+00004050: 7273 742e 0a20 2020 2020 2020 2022 2222  rst..        """
+00004060: 2c0a 2020 2020 5d0a 0a0a 636c 6173 7320  ,.    ]...class 
+00004070: 6861 706e 6574 5f70 6172 616d 733a 0a20  hapnet_params:. 
+00004080: 2020 206d 6178 5f64 6973 743a 2054 7970     max_dist: Typ
+00004090: 6541 6c69 6173 203d 2041 6e6e 6f74 6174  eAlias = Annotat
+000040a0: 6564 5b0a 2020 2020 2020 2020 696e 742c  ed[.        int,
+000040b0: 0a20 2020 2020 2020 2022 4a6f 696e 206e  .        "Join n
+000040c0: 6574 776f 726b 2063 6f6d 706f 6e65 6e74  etwork component
+000040d0: 7320 7570 2074 6f20 6120 6d61 7869 6d75  s up to a maximu
+000040e0: 6d20 6469 7374 616e 6365 206f 6620 3220  m distance of 2 
+000040f0: 534e 5020 6469 6666 6572 656e 6365 732e  SNP differences.
+00004100: 222c 0a20 2020 205d 0a20 2020 206d 6178  ",.    ].    max
+00004110: 5f64 6973 745f 6465 6661 756c 743a 206d  _dist_default: m
+00004120: 6178 5f64 6973 7420 3d20 320a 2020 2020  ax_dist = 2.    
+00004130: 636f 6c6f 723a 2054 7970 6541 6c69 6173  color: TypeAlias
+00004140: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00004150: 2020 2020 2020 7374 722c 0a20 2020 2020        str,.     
+00004160: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
+00004170: 6465 6e74 6966 6965 7320 6120 636f 6c75  dentifies a colu
+00004180: 6d6e 2069 6e20 7468 6520 7361 6d70 6c65  mn in the sample
+00004190: 206d 6574 6164 6174 6120 7768 6963 6820   metadata which 
+000041a0: 6465 7465 726d 696e 6573 2074 6865 2063  determines the c
+000041b0: 6f6c 6f75 720a 2020 2020 2020 2020 6f66  olour.        of
+000041c0: 2070 6965 2063 6861 7274 2073 6567 6d65   pie chart segme
+000041d0: 6e74 7320 7769 7468 696e 206e 6f64 6573  nts within nodes
+000041e0: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
+000041f0: 2020 205d 0a20 2020 2063 6f6c 6f72 5f64     ].    color_d
+00004200: 6973 6372 6574 655f 7365 7175 656e 6365  iscrete_sequence
+00004210: 3a20 5479 7065 416c 6961 7320 3d20 416e  : TypeAlias = An
+00004220: 6e6f 7461 7465 645b 0a20 2020 2020 2020  notated[.       
+00004230: 204c 6973 742c 2022 5072 6f76 6964 6520   List, "Provide 
+00004240: 6120 6c69 7374 206f 6620 636f 6c6f 7572  a list of colour
+00004250: 7320 746f 2075 7365 2e22 0a20 2020 205d  s to use.".    ]
+00004260: 0a20 2020 2063 6f6c 6f72 5f64 6973 6372  .    color_discr
+00004270: 6574 655f 6d61 703a 2054 7970 6541 6c69  ete_map: TypeAli
+00004280: 6173 203d 2041 6e6e 6f74 6174 6564 5b0a  as = Annotated[.
+00004290: 2020 2020 2020 2020 4d61 7070 696e 672c          Mapping,
+000042a0: 2022 5072 6f76 6964 6520 616e 2065 7870   "Provide an exp
+000042b0: 6c69 6369 7420 6d61 7070 696e 6720 6672  licit mapping fr
+000042c0: 6f6d 2076 616c 7565 7320 746f 2063 6f6c  om values to col
+000042d0: 6f75 7273 2e22 0a20 2020 205d 0a20 2020  ours.".    ].   
+000042e0: 2063 6174 6567 6f72 795f 6f72 6465 723a   category_order:
+000042f0: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+00004300: 6f74 6174 6564 5b0a 2020 2020 2020 2020  otated[.        
+00004310: 4c69 7374 2c0a 2020 2020 2020 2020 2243  List,.        "C
+00004320: 6f6e 7472 6f6c 2074 6865 206f 7264 6572  ontrol the order
+00004330: 2069 6e20 7768 6963 6820 7661 6c75 6573   in which values
+00004340: 2061 7070 6561 7220 696e 2074 6865 206c   appear in the l
+00004350: 6567 656e 642e 222c 0a20 2020 205d 0a20  egend.",.    ]. 
+00004360: 2020 206e 6f64 655f 7369 7a65 5f66 6163     node_size_fac
+00004370: 746f 723a 2054 7970 6541 6c69 6173 203d  tor: TypeAlias =
+00004380: 2041 6e6e 6f74 6174 6564 5b0a 2020 2020   Annotated[.    
+00004390: 2020 2020 696e 742c 0a20 2020 2020 2020      int,.       
+000043a0: 2022 436f 6e74 726f 6c20 7468 6520 7369   "Control the si
+000043b0: 7a69 6e67 206f 6620 6e6f 6465 732e 222c  zing of nodes.",
+000043c0: 0a20 2020 205d 0a20 2020 206e 6f64 655f  .    ].    node_
+000043d0: 7369 7a65 5f66 6163 746f 725f 6465 6661  size_factor_defa
+000043e0: 756c 743a 206e 6f64 655f 7369 7a65 5f66  ult: node_size_f
+000043f0: 6163 746f 7220 3d20 3530 0a20 2020 206c  actor = 50.    l
+00004400: 6179 6f75 743a 2054 7970 6541 6c69 6173  ayout: TypeAlias
+00004410: 203d 2041 6e6e 6f74 6174 6564 5b0a 2020   = Annotated[.  
+00004420: 2020 2020 2020 7374 722c 0a20 2020 2020        str,.     
+00004430: 2020 2022 4e61 6d65 206f 6620 7468 6520     "Name of the 
+00004440: 6e65 7477 6f72 6b20 6c61 796f 7574 2074  network layout t
+00004450: 6f20 7573 6520 746f 2070 6f73 6974 696f  o use to positio
+00004460: 6e20 6e6f 6465 732e 222c 0a20 2020 205d  n nodes.",.    ]
+00004470: 0a20 2020 206c 6179 6f75 745f 6465 6661  .    layout_defa
+00004480: 756c 743a 206c 6179 6f75 7420 3d20 2263  ult: layout = "c
+00004490: 6f73 6522 0a20 2020 206c 6179 6f75 745f  ose".    layout_
+000044a0: 7061 7261 6d73 3a20 5479 7065 416c 6961  params: TypeAlia
+000044b0: 7320 3d20 416e 6e6f 7461 7465 645b 0a20  s = Annotated[. 
+000044c0: 2020 2020 2020 204d 6170 7069 6e67 2c0a         Mapping,.
+000044d0: 2020 2020 2020 2020 2241 6464 6974 696f          "Additio
+000044e0: 6e61 6c20 7061 7261 6d65 7465 7273 2074  nal parameters t
+000044f0: 6f20 7468 6520 6c61 796f 7574 2061 6c67  o the layout alg
+00004500: 6f72 6974 686d 2e22 2c0a 2020 2020 5d0a  orithm.",.    ].
+00004510: 0a0a 636c 6173 7320 6461 7368 5f70 6172  ..class dash_par
+00004520: 616d 733a 0a20 2020 2068 6569 6768 743a  ams:.    height:
+00004530: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+00004540: 6f74 6174 6564 5b69 6e74 2c20 2248 6569  otated[int, "Hei
+00004550: 6768 7420 6f66 2074 6865 2044 6173 6820  ght of the Dash 
+00004560: 6170 7020 696e 2070 6978 656c 7320 2870  app in pixels (p
+00004570: 7829 2e22 5d0a 2020 2020 7769 6474 683a  x)."].    width:
+00004580: 2054 7970 6541 6c69 6173 203d 2041 6e6e   TypeAlias = Ann
+00004590: 6f74 6174 6564 5b55 6e69 6f6e 5b69 6e74  otated[Union[int
+000045a0: 2c20 7374 725d 2c20 2257 6964 7468 206f  , str], "Width o
+000045b0: 6620 7468 6520 4461 7368 2061 7070 2e22  f the Dash app."
+000045c0: 5d0a 2020 2020 7365 7276 6572 5f6d 6f64  ].    server_mod
+000045d0: 653a 2054 7970 6541 6c69 6173 203d 2041  e: TypeAlias = A
+000045e0: 6e6e 6f74 6174 6564 5b0a 2020 2020 2020  nnotated[.      
+000045f0: 2020 4c69 7465 7261 6c5b 2269 6e6c 696e    Literal["inlin
+00004600: 6522 2c20 2265 7874 6572 6e61 6c22 2c20  e", "external", 
+00004610: 226a 7570 7974 6572 6c61 6222 5d2c 0a20  "jupyterlab"],. 
+00004620: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00004630: 2020 2043 6f6e 7472 6f6c 7320 686f 7720     Controls how 
+00004640: 7468 6520 4a75 7079 7465 7220 4461 7368  the Jupyter Dash
+00004650: 2061 7070 2077 696c 6c20 6265 206c 6175   app will be lau
+00004660: 6e63 6865 642e 2053 6565 0a20 2020 2020  nched. See.     
+00004670: 2020 2068 7474 7073 3a2f 2f6d 6564 6975     https://mediu
+00004680: 6d2e 636f 6d2f 706c 6f74 6c79 2f69 6e74  m.com/plotly/int
+00004690: 726f 6475 6369 6e67 2d6a 7570 7974 6572  roducing-jupyter
+000046a0: 6461 7368 2d38 3131 6631 6635 3763 3032  dash-811f1f57c02
+000046b0: 6520 666f 720a 2020 2020 2020 2020 6d6f  e for.        mo
+000046c0: 7265 2069 6e66 6f72 6d61 7469 6f6e 2e0a  re information..
+000046d0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
+000046e0: 205d 0a20 2020 2073 6572 7665 725f 6d6f   ].    server_mo
+000046f0: 6465 5f64 6566 6175 6c74 3a20 7365 7276  de_default: serv
+00004700: 6572 5f6d 6f64 6520 3d20 2269 6e6c 696e  er_mode = "inlin
+00004710: 6522 0a20 2020 2073 6572 7665 725f 706f  e".    server_po
+00004720: 7274 3a20 5479 7065 416c 6961 7320 3d20  rt: TypeAlias = 
+00004730: 416e 6e6f 7461 7465 645b 0a20 2020 2020  Annotated[.     
+00004740: 2020 2069 6e74 2c0a 2020 2020 2020 2020     int,.        
+00004750: 224d 616e 7561 6c6c 7920 6f76 6572 7269  "Manually overri
+00004760: 6465 2074 6865 2070 6f72 7420 6f6e 2077  de the port on w
+00004770: 6869 6368 2074 6865 2044 6173 6820 6170  hich the Dash ap
+00004780: 7020 7769 6c6c 2072 756e 2e22 2c0a 2020  p will run.",.  
+00004790: 2020 5d0a 0a0a 2320 4e2e 422e 2c20 7765    ]...# N.B., we
+000047a0: 2061 7265 2069 6e20 7468 6520 7072 6f63   are in the proc
+000047b0: 6573 7320 6f66 2062 7265 616b 696e 6720  ess of breaking 
+000047c0: 7570 2074 6865 2041 6e6f 7068 656c 6573  up the Anopheles
+000047d0: 4461 7461 5265 736f 7572 6365 0a23 2063  DataResource.# c
+000047e0: 6c61 7373 2069 6e74 6f20 6d75 6c74 6970  lass into multip
+000047f0: 6c65 2070 6172 656e 7420 636c 6173 7365  le parent classe
+00004800: 7320 6c69 6b65 2041 6e6f 7068 656c 6573  s like Anopheles
+00004810: 4765 6e6f 6d65 5365 7175 656e 6365 4461  GenomeSequenceDa
+00004820: 7461 0a23 2061 6e64 2041 6e6f 7068 656c  ta.# and Anophel
+00004830: 6573 4261 7365 2e20 5468 6973 2069 7320  esBase. This is 
+00004840: 776f 726b 2069 6e20 7072 6f67 7265 7373  work in progress
+00004850: 2c20 616e 6420 6675 7274 6865 7220 5052  , and further PR
+00004860: 7320 6172 650a 2320 6578 7065 6374 6564  s are.# expected
+00004870: 2074 6f20 6661 6374 6f72 206f 7574 2066   to factor out f
+00004880: 756e 6374 696f 6e73 2064 6566 696e 6564  unctions defined
+00004890: 2068 6572 6520 696e 2074 6f20 7365 7061   here in to sepa
+000048a0: 7261 7465 2063 6c61 7373 6573 2e0a 2320  rate classes..# 
+000048b0: 466f 7220 6d6f 7265 2069 6e66 6f72 6d61  For more informa
+000048c0: 7469 6f6e 2c20 7365 653a 0a23 0a23 2068  tion, see:.#.# h
+000048d0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000048e0: 6d2f 6d61 6c61 7269 6167 656e 2f6d 616c  m/malariagen/mal
+000048f0: 6172 6961 6765 6e2d 6461 7461 2d70 7974  ariagen-data-pyt
+00004900: 686f 6e2f 6973 7375 6573 2f33 3636 0a23  hon/issues/366.#
+00004910: 0a23 204e 2e42 2e2c 2077 6520 6172 6520  .# N.B., we are 
+00004920: 6d61 6b69 6e67 2075 7365 206f 6620 6d75  making use of mu
+00004930: 6c74 6970 6c65 2069 6e68 6572 6974 616e  ltiple inheritan
+00004940: 6365 2068 6572 652c 2075 7369 6e67 2063  ce here, using c
+00004950: 6f2d 6f70 6572 6174 6976 650a 2320 636c  o-operative.# cl
+00004960: 6173 7365 732e 2042 6563 6175 7365 206f  asses. Because o
+00004970: 6620 7468 6520 7761 7920 7468 6174 206d  f the way that m
+00004980: 756c 7469 706c 6520 696e 6865 7269 7461  ultiple inherita
+00004990: 6e63 6520 776f 726b 7320 696e 2050 7974  nce works in Pyt
+000049a0: 686f 6e2c 0a23 2069 7420 6973 2069 6d70  hon,.# it is imp
+000049b0: 6f72 7461 6e74 2074 6861 7420 7468 6573  ortant that thes
+000049c0: 6520 7061 7265 6e74 2063 6c61 7373 6573  e parent classes
+000049d0: 2061 7265 2070 726f 7669 6465 6420 696e   are provided in
+000049e0: 2061 2070 6172 7469 6375 6c61 720a 2320   a particular.# 
+000049f0: 6f72 6465 722e 204f 7468 6572 7769 7365  order. Otherwise
+00004a00: 2074 6865 206c 696e 6561 7269 7a61 7469   the linearizati
+00004a10: 6f6e 206f 6620 7061 7265 6e74 2063 6c61  on of parent cla
+00004a20: 7373 6573 2077 696c 6c20 6661 696c 2e20  sses will fail. 
+00004a30: 466f 720a 2320 6d6f 7265 2069 6e66 6f72  For.# more infor
+00004a40: 6d61 7469 6f6e 2061 626f 7574 2073 7570  mation about sup
+00004a50: 6572 636c 6173 7320 6c69 6e65 6172 697a  erclass lineariz
+00004a60: 6174 696f 6e20 616e 6420 6d65 7468 6f64  ation and method
+00004a70: 2072 6573 6f6c 7574 696f 6e0a 2320 6f72   resolution.# or
+00004a80: 6465 7220 696e 2050 7974 686f 6e2c 2074  der in Python, t
+00004a90: 6865 2066 6f6c 6c6f 7769 6e67 206c 696e  he following lin
+00004aa0: 6b73 206d 6179 2062 6520 7573 6566 756c  ks may be useful
+00004ab0: 2e0a 230a 2320 6874 7470 733a 2f2f 656e  ..#.# https://en
+00004ac0: 2e77 696b 6970 6564 6961 2e6f 7267 2f77  .wikipedia.org/w
+00004ad0: 696b 692f 4333 5f6c 696e 6561 7269 7a61  iki/C3_lineariza
+00004ae0: 7469 6f6e 0a23 2068 7474 7073 3a2f 2f72  tion.# https://r
+00004af0: 6865 7474 696e 6765 722e 776f 7264 7072  hettinger.wordpr
+00004b00: 6573 732e 636f 6d2f 3230 3131 2f30 352f  ess.com/2011/05/
+00004b10: 3236 2f73 7570 6572 2d63 6f6e 7369 6465  26/super-conside
+00004b20: 7265 642d 7375 7065 722f 0a0a 0a23 2077  red-super/...# w
+00004b30: 6f72 6b20 6172 6f75 6e64 2070 7963 6861  ork around pycha
+00004b40: 726d 2066 6169 6c69 6e67 2074 6f20 7265  rm failing to re
+00004b50: 636f 676e 6973 6520 7468 6174 2064 6f63  cognise that doc
+00004b60: 2829 2069 7320 6361 6c6c 6162 6c65 0a23  () is callable.#
+00004b70: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00004b80: 4361 6c6c 696e 674e 6f6e 4361 6c6c 6162  CallingNonCallab
+00004b90: 6c65 0a63 6c61 7373 2041 6e6f 7068 656c  le.class Anophel
+00004ba0: 6573 4461 7461 5265 736f 7572 6365 280a  esDataResource(.
+00004bb0: 2020 2020 416e 6f70 6865 6c65 7353 616d      AnophelesSam
+00004bc0: 706c 654d 6574 6164 6174 612c 0a20 2020  pleMetadata,.   
+00004bd0: 2041 6e6f 7068 656c 6573 4765 6e6f 6d65   AnophelesGenome
+00004be0: 4665 6174 7572 6573 4461 7461 2c0a 2020  FeaturesData,.  
+00004bf0: 2020 416e 6f70 6865 6c65 7347 656e 6f6d    AnophelesGenom
+00004c00: 6553 6571 7565 6e63 6544 6174 612c 0a20  eSequenceData,. 
+00004c10: 2020 2041 6e6f 7068 656c 6573 4261 7365     AnophelesBase
+00004c20: 2c0a 293a 0a20 2020 2022 2222 416e 6f70  ,.):.    """Anop
+00004c30: 6865 6c65 7320 6461 7461 2072 6573 6f75  heles data resou
+00004c40: 7263 6573 2e22 2222 0a0a 2020 2020 6465  rces."""..    de
+00004c50: 6620 5f5f 696e 6974 5f5f 280a 2020 2020  f __init__(.    
+00004c60: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00004c70: 2020 7572 6c2c 0a20 2020 2020 2020 2063    url,.        c
+00004c80: 6f6e 6669 675f 7061 7468 2c0a 2020 2020  onfig_path,.    
+00004c90: 2020 2020 636f 686f 7274 735f 616e 616c      cohorts_anal
+00004ca0: 7973 6973 3a20 4f70 7469 6f6e 616c 5b73  ysis: Optional[s
+00004cb0: 7472 5d2c 0a20 2020 2020 2020 2061 696d  tr],.        aim
+00004cc0: 5f61 6e61 6c79 7369 733a 204f 7074 696f  _analysis: Optio
+00004cd0: 6e61 6c5b 7374 725d 2c0a 2020 2020 2020  nal[str],.      
+00004ce0: 2020 6169 6d5f 6d65 7461 6461 7461 5f64    aim_metadata_d
+00004cf0: 7479 7065 3a20 4f70 7469 6f6e 616c 5b4d  type: Optional[M
+00004d00: 6170 7069 6e67 5b73 7472 2c20 416e 795d  apping[str, Any]
+00004d10: 5d2c 0a20 2020 2020 2020 2073 6974 655f  ],.        site_
+00004d20: 6669 6c74 6572 735f 616e 616c 7973 6973  filters_analysis
+00004d30: 2c0a 2020 2020 2020 2020 626f 6b65 685f  ,.        bokeh_
+00004d40: 6f75 7470 7574 5f6e 6f74 6562 6f6f 6b2c  output_notebook,
+00004d50: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00004d60: 5f63 6163 6865 2c0a 2020 2020 2020 2020  _cache,.        
+00004d70: 6c6f 672c 0a20 2020 2020 2020 2064 6562  log,.        deb
+00004d80: 7567 2c0a 2020 2020 2020 2020 7368 6f77  ug,.        show
+00004d90: 5f70 726f 6772 6573 732c 0a20 2020 2020  _progress,.     
+00004da0: 2020 2063 6865 636b 5f6c 6f63 6174 696f     check_locatio
+00004db0: 6e2c 0a20 2020 2020 2020 2070 7265 2c0a  n,.        pre,.
+00004dc0: 2020 2020 2020 2020 6763 735f 7572 6c3a          gcs_url:
+00004dd0: 2073 7472 2c0a 2020 2020 2020 2020 6d61   str,.        ma
+00004de0: 6a6f 725f 7665 7273 696f 6e5f 6e75 6d62  jor_version_numb
+00004df0: 6572 3a20 696e 742c 0a20 2020 2020 2020  er: int,.       
+00004e00: 206d 616a 6f72 5f76 6572 7369 6f6e 5f70   major_version_p
+00004e10: 6174 683a 2073 7472 2c0a 2020 2020 2020  ath: str,.      
+00004e20: 2020 6766 665f 6765 6e65 5f74 7970 653a    gff_gene_type:
+00004e30: 2073 7472 2c0a 2020 2020 2020 2020 6766   str,.        gf
+00004e40: 665f 6465 6661 756c 745f 6174 7472 6962  f_default_attrib
+00004e50: 7574 6573 3a20 5475 706c 655b 7374 725d  utes: Tuple[str]
+00004e60: 2c0a 2020 2020 2020 2020 7374 6f72 6167  ,.        storag
+00004e70: 655f 6f70 7469 6f6e 733a 204d 6170 7069  e_options: Mappi
+00004e80: 6e67 2c20 2023 2075 7365 6420 6279 2066  ng,  # used by f
+00004e90: 7373 7065 6320 7669 6120 696e 6974 5f66  sspec via init_f
+00004ea0: 696c 6573 7973 7465 6d28 7572 6c2c 202a  ilesystem(url, *
+00004eb0: 2a6b 7761 7267 7329 0a20 2020 2029 3a0a  *kwargs).    ):.
+00004ec0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00004ed0: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
+00004ee0: 2020 2020 2020 7572 6c3d 7572 6c2c 0a20        url=url,. 
+00004ef0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00004f00: 675f 7061 7468 3d63 6f6e 6669 675f 7061  g_path=config_pa
+00004f10: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00004f20: 626f 6b65 685f 6f75 7470 7574 5f6e 6f74  bokeh_output_not
+00004f30: 6562 6f6f 6b3d 626f 6b65 685f 6f75 7470  ebook=bokeh_outp
+00004f40: 7574 5f6e 6f74 6562 6f6f 6b2c 0a20 2020  ut_notebook,.   
+00004f50: 2020 2020 2020 2020 206c 6f67 3d6c 6f67           log=log
+00004f60: 2c0a 2020 2020 2020 2020 2020 2020 6465  ,.            de
+00004f70: 6275 673d 6465 6275 672c 0a20 2020 2020  bug=debug,.     
+00004f80: 2020 2020 2020 2073 686f 775f 7072 6f67         show_prog
+00004f90: 7265 7373 3d73 686f 775f 7072 6f67 7265  ress=show_progre
+00004fa0: 7373 2c0a 2020 2020 2020 2020 2020 2020  ss,.            
+00004fb0: 6368 6563 6b5f 6c6f 6361 7469 6f6e 3d63  check_location=c
+00004fc0: 6865 636b 5f6c 6f63 6174 696f 6e2c 0a20  heck_location,. 
+00004fd0: 2020 2020 2020 2020 2020 2070 7265 3d70             pre=p
+00004fe0: 7265 2c0a 2020 2020 2020 2020 2020 2020  re,.            
+00004ff0: 6763 735f 7572 6c3d 6763 735f 7572 6c2c  gcs_url=gcs_url,
+00005000: 0a20 2020 2020 2020 2020 2020 206d 616a  .            maj
+00005010: 6f72 5f76 6572 7369 6f6e 5f6e 756d 6265  or_version_numbe
+00005020: 723d 6d61 6a6f 725f 7665 7273 696f 6e5f  r=major_version_
+00005030: 6e75 6d62 6572 2c0a 2020 2020 2020 2020  number,.        
+00005040: 2020 2020 6d61 6a6f 725f 7665 7273 696f      major_versio
+00005050: 6e5f 7061 7468 3d6d 616a 6f72 5f76 6572  n_path=major_ver
+00005060: 7369 6f6e 5f70 6174 682c 0a20 2020 2020  sion_path,.     
+00005070: 2020 2020 2020 2073 746f 7261 6765 5f6f         storage_o
+00005080: 7074 696f 6e73 3d73 746f 7261 6765 5f6f  ptions=storage_o
+00005090: 7074 696f 6e73 2c0a 2020 2020 2020 2020  ptions,.        
+000050a0: 2020 2020 6766 665f 6765 6e65 5f74 7970      gff_gene_typ
+000050b0: 653d 6766 665f 6765 6e65 5f74 7970 652c  e=gff_gene_type,
+000050c0: 0a20 2020 2020 2020 2020 2020 2067 6666  .            gff
+000050d0: 5f64 6566 6175 6c74 5f61 7474 7269 6275  _default_attribu
+000050e0: 7465 733d 6766 665f 6465 6661 756c 745f  tes=gff_default_
+000050f0: 6174 7472 6962 7574 6573 2c0a 2020 2020  attributes,.    
+00005100: 2020 2020 2020 2020 636f 686f 7274 735f          cohorts_
+00005110: 616e 616c 7973 6973 3d63 6f68 6f72 7473  analysis=cohorts
+00005120: 5f61 6e61 6c79 7369 732c 0a20 2020 2020  _analysis,.     
+00005130: 2020 2020 2020 2061 696d 5f61 6e61 6c79         aim_analy
+00005140: 7369 733d 6169 6d5f 616e 616c 7973 6973  sis=aim_analysis
+00005150: 2c0a 2020 2020 2020 2020 2020 2020 6169  ,.            ai
+00005160: 6d5f 6d65 7461 6461 7461 5f64 7479 7065  m_metadata_dtype
+00005170: 3d61 696d 5f6d 6574 6164 6174 615f 6474  =aim_metadata_dt
+00005180: 7970 652c 0a20 2020 2020 2020 2029 0a0a  ype,.        )..
+00005190: 2020 2020 2020 2020 2320 7365 7420 7570          # set up
+000051a0: 2061 7474 7269 6275 7465 730a 2020 2020   attributes.    
+000051b0: 2020 2020 7365 6c66 2e5f 7369 7465 5f66      self._site_f
+000051c0: 696c 7465 7273 5f61 6e61 6c79 7369 7320  ilters_analysis 
+000051d0: 3d20 7369 7465 5f66 696c 7465 7273 5f61  = site_filters_a
+000051e0: 6e61 6c79 7369 730a 0a20 2020 2020 2020  nalysis..       
+000051f0: 2023 2073 6574 2075 7020 6361 6368 6573   # set up caches
+00005200: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+00005210: 7265 7669 6577 2074 7970 6520 616e 6e6f  review type anno
+00005220: 7461 7469 6f6e 7320 6865 7265 2c20 6d61  tations here, ma
+00005230: 7962 6520 6361 6e20 7469 6768 7465 6e0a  ybe can tighten.
+00005240: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+00005250: 6368 655f 7369 7465 5f66 696c 7465 7273  che_site_filters
+00005260: 3a20 4469 6374 203d 2064 6963 7428 290a  : Dict = dict().
+00005270: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+00005280: 6368 655f 736e 705f 7369 7465 7320 3d20  che_snp_sites = 
+00005290: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+000052a0: 662e 5f63 6163 6865 5f73 6e70 5f67 656e  f._cache_snp_gen
+000052b0: 6f74 7970 6573 3a20 4469 6374 203d 2064  otypes: Dict = d
+000052c0: 6963 7428 290a 2020 2020 2020 2020 7365  ict().        se
+000052d0: 6c66 2e5f 6361 6368 655f 616e 6e6f 7461  lf._cache_annota
+000052e0: 746f 7220 3d20 4e6f 6e65 0a20 2020 2020  tor = None.     
+000052f0: 2020 2073 656c 662e 5f63 6163 6865 5f73     self._cache_s
+00005300: 6974 655f 616e 6e6f 7461 7469 6f6e 7320  ite_annotations 
+00005310: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+00005320: 656c 662e 5f63 6163 6865 5f6c 6f63 6174  elf._cache_locat
+00005330: 655f 7369 7465 5f63 6c61 7373 3a20 4469  e_site_class: Di
+00005340: 6374 203d 2064 6963 7428 290a 2020 2020  ct = dict().    
+00005350: 2020 2020 7365 6c66 2e5f 6361 6368 655f      self._cache_
+00005360: 6861 706c 6f74 7970 6573 3a20 4469 6374  haplotypes: Dict
+00005370: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+00005380: 2020 7365 6c66 2e5f 6361 6368 655f 6861    self._cache_ha
+00005390: 706c 6f74 7970 655f 7369 7465 733a 2044  plotype_sites: D
+000053a0: 6963 7420 3d20 6469 6374 2829 0a0a 2020  ict = dict()..  
+000053b0: 2020 2020 2020 6966 2072 6573 756c 7473        if results
+000053c0: 5f63 6163 6865 2069 7320 6e6f 7420 4e6f  _cache is not No
+000053d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000053e0: 7265 7375 6c74 735f 6361 6368 6520 3d20  results_cache = 
+000053f0: 5061 7468 2872 6573 756c 7473 5f63 6163  Path(results_cac
+00005400: 6865 292e 6578 7061 6e64 7573 6572 2829  he).expanduser()
+00005410: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
+00005420: 2020 2073 656c 662e 5f72 6573 756c 7473     self._results
+00005430: 5f63 6163 6865 203d 2072 6573 756c 7473  _cache = results
+00005440: 5f63 6163 6865 0a0a 2020 2020 2020 2020  _cache..        
+00005450: 2320 7365 7420 616e 616c 7973 6973 2076  # set analysis v
+00005460: 6572 7369 6f6e 730a 0a20 2020 2020 2020  ersions..       
+00005470: 2069 6620 7369 7465 5f66 696c 7465 7273   if site_filters
+00005480: 5f61 6e61 6c79 7369 7320 6973 204e 6f6e  _analysis is Non
+00005490: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000054a0: 656c 662e 5f73 6974 655f 6669 6c74 6572  elf._site_filter
+000054b0: 735f 616e 616c 7973 6973 203d 2073 656c  s_analysis = sel
+000054c0: 662e 636f 6e66 6967 2e67 6574 280a 2020  f.config.get(.  
+000054d0: 2020 2020 2020 2020 2020 2020 2020 2244                "D
+000054e0: 4546 4155 4c54 5f53 4954 455f 4649 4c54  EFAULT_SITE_FILT
+000054f0: 4552 535f 414e 414c 5953 4953 220a 2020  ERS_ANALYSIS".  
+00005500: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005510: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005520: 2020 2020 2020 7365 6c66 2e5f 7369 7465        self._site
+00005530: 5f66 696c 7465 7273 5f61 6e61 6c79 7369  _filters_analysi
+00005540: 7320 3d20 7369 7465 5f66 696c 7465 7273  s = site_filters
+00005550: 5f61 6e61 6c79 7369 730a 0a20 2020 2023  _analysis..    #
+00005560: 2053 7461 7274 206f 6620 4070 726f 7065   Start of @prope
+00005570: 7274 790a 0a20 2020 2040 7072 6f70 6572  rty..    @proper
+00005580: 7479 0a20 2020 2040 6162 7374 7261 6374  ty.    @abstract
+00005590: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+000055a0: 7063 615f 7265 7375 6c74 735f 6361 6368  pca_results_cach
+000055b0: 655f 6e61 6d65 2873 656c 6629 3a0a 2020  e_name(self):.  
+000055c0: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+000055d0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+000055e0: 224d 7573 7420 6f76 6572 7269 6465 205f  "Must override _
+000055f0: 7063 615f 7265 7375 6c74 735f 6361 6368  pca_results_cach
+00005600: 655f 6e61 6d65 2229 0a0a 2020 2020 4070  e_name")..    @p
+00005610: 726f 7065 7274 790a 2020 2020 4061 6273  roperty.    @abs
+00005620: 7472 6163 746d 6574 686f 640a 2020 2020  tractmethod.    
+00005630: 6465 6620 5f73 6e70 5f61 6c6c 656c 655f  def _snp_allele_
+00005640: 636f 756e 7473 5f72 6573 756c 7473 5f63  counts_results_c
+00005650: 6163 6865 5f6e 616d 6528 7365 6c66 293a  ache_name(self):
+00005660: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
+00005670: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+00005680: 6f72 2822 4d75 7374 206f 7665 7272 6964  or("Must overrid
+00005690: 6520 5f73 6e70 5f61 6c6c 656c 655f 636f  e _snp_allele_co
+000056a0: 756e 7473 5f72 6573 756c 7473 5f63 6163  unts_results_cac
+000056b0: 6865 5f6e 616d 6522 290a 0a20 2020 2040  he_name")..    @
+000056c0: 7072 6f70 6572 7479 0a20 2020 2040 6162  property.    @ab
+000056d0: 7374 7261 6374 6d65 7468 6f64 0a20 2020  stractmethod.   
+000056e0: 2064 6566 205f 6673 745f 6777 7373 5f72   def _fst_gwss_r
+000056f0: 6573 756c 7473 5f63 6163 6865 5f6e 616d  esults_cache_nam
+00005700: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+00005710: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
+00005720: 656e 7465 6445 7272 6f72 2822 4d75 7374  entedError("Must
+00005730: 206f 7665 7272 6964 6520 5f66 7374 5f67   override _fst_g
+00005740: 7773 735f 7265 7375 6c74 735f 6361 6368  wss_results_cach
+00005750: 655f 6e61 6d65 2229 0a0a 2020 2020 4070  e_name")..    @p
+00005760: 726f 7065 7274 790a 2020 2020 4061 6273  roperty.    @abs
+00005770: 7472 6163 746d 6574 686f 640a 2020 2020  tractmethod.    
+00005780: 6465 6620 5f68 3132 5f63 616c 6962 7261  def _h12_calibra
+00005790: 7469 6f6e 5f63 6163 6865 5f6e 616d 6528  tion_cache_name(
+000057a0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+000057b0: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
+000057c0: 7465 6445 7272 6f72 2822 4d75 7374 206f  tedError("Must o
+000057d0: 7665 7272 6964 6520 5f68 3132 5f63 616c  verride _h12_cal
+000057e0: 6962 7261 7469 6f6e 5f63 6163 6865 5f6e  ibration_cache_n
+000057f0: 616d 6522 290a 0a20 2020 2040 7072 6f70  ame")..    @prop
+00005800: 6572 7479 0a20 2020 2040 6162 7374 7261  erty.    @abstra
+00005810: 6374 6d65 7468 6f64 0a20 2020 2064 6566  ctmethod.    def
+00005820: 205f 6731 3233 5f63 616c 6962 7261 7469   _g123_calibrati
+00005830: 6f6e 5f63 6163 6865 5f6e 616d 6528 7365  on_cache_name(se
+00005840: 6c66 293a 0a20 2020 2020 2020 2072 6169  lf):.        rai
+00005850: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+00005860: 6445 7272 6f72 2822 4d75 7374 206f 7665  dError("Must ove
+00005870: 7272 6964 6520 5f67 3132 335f 6361 6c69  rride _g123_cali
+00005880: 6272 6174 696f 6e5f 6361 6368 655f 6e61  bration_cache_na
+00005890: 6d65 2229 0a0a 2020 2020 4070 726f 7065  me")..    @prope
+000058a0: 7274 790a 2020 2020 4061 6273 7472 6163  rty.    @abstrac
+000058b0: 746d 6574 686f 640a 2020 2020 6465 6620  tmethod.    def 
+000058c0: 5f68 3132 5f67 7773 735f 6361 6368 655f  _h12_gwss_cache_
+000058d0: 6e61 6d65 2873 656c 6629 3a0a 2020 2020  name(self):.    
+000058e0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+000058f0: 6c65 6d65 6e74 6564 4572 726f 7228 224d  lementedError("M
+00005900: 7573 7420 6f76 6572 7269 6465 205f 6831  ust override _h1
+00005910: 325f 6777 7373 5f63 6163 6865 5f6e 616d  2_gwss_cache_nam
+00005920: 6522 290a 0a20 2020 2040 7072 6f70 6572  e")..    @proper
+00005930: 7479 0a20 2020 2040 6162 7374 7261 6374  ty.    @abstract
+00005940: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00005950: 6731 3233 5f67 7773 735f 6361 6368 655f  g123_gwss_cache_
+00005960: 6e61 6d65 2873 656c 6629 3a0a 2020 2020  name(self):.    
+00005970: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+00005980: 6c65 6d65 6e74 6564 4572 726f 7228 224d  lementedError("M
+00005990: 7573 7420 6f76 6572 7269 6465 205f 6731  ust override _g1
+000059a0: 3233 5f67 7773 735f 6361 6368 655f 6e61  23_gwss_cache_na
+000059b0: 6d65 2229 0a0a 2020 2020 4070 726f 7065  me")..    @prope
+000059c0: 7274 790a 2020 2020 4061 6273 7472 6163  rty.    @abstrac
+000059d0: 746d 6574 686f 640a 2020 2020 6465 6620  tmethod.    def 
+000059e0: 5f68 3178 5f67 7773 735f 6361 6368 655f  _h1x_gwss_cache_
+000059f0: 6e61 6d65 2873 656c 6629 3a0a 2020 2020  name(self):.    
+00005a00: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+00005a10: 6c65 6d65 6e74 6564 4572 726f 7228 224d  lementedError("M
+00005a20: 7573 7420 6f76 6572 7269 6465 205f 6831  ust override _h1
+00005a30: 785f 6777 7373 5f63 6163 6865 5f6e 616d  x_gwss_cache_nam
+00005a40: 6522 290a 0a20 2020 2040 7072 6f70 6572  e")..    @proper
+00005a50: 7479 0a20 2020 2040 6162 7374 7261 6374  ty.    @abstract
+00005a60: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00005a70: 6968 735f 6777 7373 5f63 6163 6865 5f6e  ihs_gwss_cache_n
+00005a80: 616d 6528 7365 6c66 293a 0a20 2020 2020  ame(self):.     
+00005a90: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
+00005aa0: 656d 656e 7465 6445 7272 6f72 2822 4d75  ementedError("Mu
+00005ab0: 7374 206f 7665 7272 6964 6520 5f69 6873  st override _ihs
+00005ac0: 5f67 7773 735f 6361 6368 655f 6e61 6d65  _gwss_cache_name
+00005ad0: 2229 0a0a 2020 2020 4070 726f 7065 7274  ")..    @propert
+00005ae0: 790a 2020 2020 4061 6273 7472 6163 746d  y.    @abstractm
+00005af0: 6574 686f 640a 2020 2020 6465 6620 5f73  ethod.    def _s
+00005b00: 6974 655f 616e 6e6f 7461 7469 6f6e 735f  ite_annotations_
+00005b10: 7a61 7272 5f70 6174 6828 7365 6c66 293a  zarr_path(self):
+00005b20: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
+00005b30: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+00005b40: 6f72 2822 4d75 7374 206f 7665 7272 6964  or("Must overrid
+00005b50: 6520 5f73 6974 655f 616e 6e6f 7461 7469  e _site_annotati
+00005b60: 6f6e 735f 7a61 7272 5f70 6174 6822 290a  ons_zarr_path").
+00005b70: 0a20 2020 2023 2053 7461 7274 206f 6620  .    # Start of 
+00005b80: 4061 6273 7472 6163 746d 6574 686f 640a  @abstractmethod.
+00005b90: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00005ba0: 2020 2040 6162 7374 7261 6374 6d65 7468     @abstractmeth
+00005bb0: 6f64 0a20 2020 2064 6566 2073 6974 655f  od.    def site_
+00005bc0: 6d61 736b 5f69 6473 2873 656c 6629 3a0a  mask_ids(self):.
+00005bd0: 2020 2020 2020 2020 2222 2249 6465 6e74          """Ident
+00005be0: 6966 6965 7273 2066 6f72 2074 6865 2064  ifiers for the d
+00005bf0: 6966 6665 7265 6e74 2073 6974 6520 6d61  ifferent site ma
+00005c00: 736b 7320 7468 6174 2061 7265 2061 7661  sks that are ava
+00005c10: 696c 6162 6c65 2e0a 2020 2020 2020 2020  ilable..        
+00005c20: 5468 6573 6520 6172 6520 7661 6c75 6573  These are values
+00005c30: 2074 6861 6e20 6361 6e20 6265 2075 7365   than can be use
+00005c40: 6420 666f 7220 7468 6520 6073 6974 655f  d for the `site_
+00005c50: 6d61 736b 6020 7061 7261 6d65 7465 7220  mask` parameter 
+00005c60: 696e 2061 6e79 0a20 2020 2020 2020 206d  in any.        m
+00005c70: 6574 686f 6420 6d61 6b69 6e67 2075 7369  ethod making usi
+00005c80: 6e67 206f 6620 534e 5020 6461 7461 2e0a  ng of SNP data..
+00005c90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00005ca0: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+00005cb0: 706c 656d 656e 7465 6445 7272 6f72 2822  plementedError("
+00005cc0: 4d75 7374 206f 7665 7272 6964 6520 5f73  Must override _s
+00005cd0: 6974 655f 6d61 736b 5f69 6473 2229 0a0a  ite_mask_ids")..
+00005ce0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00005cf0: 2020 4061 6273 7472 6163 746d 6574 686f    @abstractmetho
+00005d00: 640a 2020 2020 6465 6620 5f64 6566 6175  d.    def _defau
+00005d10: 6c74 5f73 6974 655f 6d61 736b 2873 656c  lt_site_mask(sel
+00005d20: 6629 3a0a 2020 2020 2020 2020 7261 6973  f):.        rais
+00005d30: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+00005d40: 4572 726f 7228 224d 7573 7420 6f76 6572  Error("Must over
+00005d50: 7269 6465 205f 6465 6661 756c 745f 7369  ride _default_si
+00005d60: 7465 5f6d 6173 6b22 290a 0a20 2020 2064  te_mask")..    d
+00005d70: 6566 205f 7072 6570 5f73 6974 655f 6d61  ef _prep_site_ma
+00005d80: 736b 5f70 6172 616d 2873 656c 662c 202a  sk_param(self, *
+00005d90: 2c20 7369 7465 5f6d 6173 6b29 3a0a 2020  , site_mask):.  
+00005da0: 2020 2020 2020 6966 2073 6974 655f 6d61        if site_ma
+00005db0: 736b 2069 7320 4e6f 6e65 3a0a 2020 2020  sk is None:.    
+00005dc0: 2020 2020 2020 2020 2320 616c 6c6f 7765          # allowe
+00005dd0: 640a 2020 2020 2020 2020 2020 2020 7061  d.            pa
+00005de0: 7373 0a20 2020 2020 2020 2065 6c69 6620  ss.        elif 
+00005df0: 7369 7465 5f6d 6173 6b20 3d3d 2044 4546  site_mask == DEF
+00005e00: 4155 4c54 3a0a 2020 2020 2020 2020 2020  AULT:.          
+00005e10: 2020 7369 7465 5f6d 6173 6b20 3d20 7365    site_mask = se
+00005e20: 6c66 2e5f 6465 6661 756c 745f 7369 7465  lf._default_site
+00005e30: 5f6d 6173 6b0a 2020 2020 2020 2020 656c  _mask.        el
+00005e40: 6966 2073 6974 655f 6d61 736b 206e 6f74  if site_mask not
+00005e50: 2069 6e20 7365 6c66 2e73 6974 655f 6d61   in self.site_ma
+00005e60: 736b 5f69 6473 3a0a 2020 2020 2020 2020  sk_ids:.        
+00005e70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00005e80: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00005e90: 2020 2020 2020 6622 496e 7661 6c69 6420        f"Invalid 
+00005ea0: 7369 7465 206d 6173 6b2c 206d 7573 7420  site mask, must 
+00005eb0: 6265 206f 6e65 206f 6620 667b 7365 6c66  be one of f{self
+00005ec0: 2e73 6974 655f 6d61 736b 5f69 6473 7d2e  .site_mask_ids}.
+00005ed0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00005ee0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00005ef0: 6974 655f 6d61 736b 0a0a 2020 2020 4061  ite_mask..    @a
+00005f00: 6273 7472 6163 746d 6574 686f 640a 2020  bstractmethod.  
+00005f10: 2020 6465 6620 5f74 7261 6e73 6372 6970    def _transcrip
+00005f20: 745f 746f 5f67 656e 655f 6e61 6d65 2873  t_to_gene_name(s
+00005f30: 656c 662c 2074 7261 6e73 6372 6970 7429  elf, transcript)
+00005f40: 3a0a 2020 2020 2020 2020 2320 6368 696c  :.        # chil
+00005f50: 6472 656e 206d 6179 2068 6176 6520 6469  dren may have di
+00005f60: 6666 6572 656e 7420 6d61 6e75 616c 206f  fferent manual o
+00005f70: 7665 7272 6964 6573 2e0a 2020 2020 2020  verrides..      
+00005f80: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00005f90: 6d65 6e74 6564 4572 726f 7228 224d 7573  mentedError("Mus
+00005fa0: 7420 6f76 6572 7269 6465 205f 7472 616e  t override _tran
+00005fb0: 7363 7269 7074 5f74 6f5f 6765 6e65 5f6e  script_to_gene_n
+00005fc0: 616d 6522 290a 0a20 2020 2040 6162 7374  ame")..    @abst
+00005fd0: 7261 6374 6d65 7468 6f64 0a20 2020 2064  ractmethod.    d
+00005fe0: 6566 205f 7669 6577 5f61 6c69 676e 6d65  ef _view_alignme
+00005ff0: 6e74 735f 6164 645f 7369 7465 5f66 696c  nts_add_site_fil
+00006000: 7465 7273 5f74 7261 636b 7328 0a20 2020  ters_tracks(.   
+00006010: 2020 2020 2073 656c 662c 202a 2c20 636f       self, *, co
+00006020: 6e74 6967 2c20 7669 7369 6269 6c69 7479  ntig, visibility
+00006030: 5f77 696e 646f 772c 2074 7261 636b 730a  _window, tracks.
+00006040: 2020 2020 293a 0a20 2020 2020 2020 2023      ):.        #
+00006050: 2064 6566 6175 6c74 2069 6d70 6c65 6d65   default impleme
+00006060: 6e74 6174 696f 6e2c 2064 6f20 6e6f 7468  ntation, do noth
+00006070: 696e 670a 2020 2020 2020 2020 7261 6973  ing.        rais
+00006080: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+00006090: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000060a0: 2020 2022 4d75 7374 206f 7665 7272 6964     "Must overrid
+000060b0: 6520 5f76 6965 775f 616c 6967 6e6d 656e  e _view_alignmen
+000060c0: 7473 5f61 6464 5f73 6974 655f 6669 6c74  ts_add_site_filt
+000060d0: 6572 735f 7472 6163 6b73 220a 2020 2020  ers_tracks".    
+000060e0: 2020 2020 290a 0a20 2020 2040 7072 6f70      )..    @prop
+000060f0: 6572 7479 0a20 2020 2040 6162 7374 7261  erty.    @abstra
+00006100: 6374 6d65 7468 6f64 0a20 2020 2064 6566  ctmethod.    def
+00006110: 2070 6861 7369 6e67 5f61 6e61 6c79 7369   phasing_analysi
+00006120: 735f 6964 7328 7365 6c66 293a 0a20 2020  s_ids(self):.   
+00006130: 2020 2020 2022 2222 4964 656e 7469 6669       """Identifi
+00006140: 6572 7320 666f 7220 7468 6520 6469 6666  ers for the diff
+00006150: 6572 656e 7420 7068 6173 696e 6720 616e  erent phasing an
+00006160: 616c 7973 6573 2074 6861 7420 6172 6520  alyses that are 
+00006170: 6176 6169 6c61 626c 652e 0a20 2020 2020  available..     
+00006180: 2020 2054 6865 7365 2061 7265 2076 616c     These are val
+00006190: 7565 7320 7468 616e 2063 616e 2062 6520  ues than can be 
+000061a0: 7573 6564 2066 6f72 2074 6865 2060 616e  used for the `an
+000061b0: 616c 7973 6973 6020 7061 7261 6d65 7465  alysis` paramete
+000061c0: 7220 696e 2061 6e79 0a20 2020 2020 2020  r in any.       
+000061d0: 206d 6574 686f 6420 6d61 6b69 6e67 2075   method making u
+000061e0: 7369 6e67 206f 6620 6861 706c 6f74 7970  sing of haplotyp
+000061f0: 6520 6461 7461 2e0a 0a20 2020 2020 2020  e data...       
+00006200: 2022 2222 0a20 2020 2020 2020 2023 204e   """.        # N
+00006210: 6f74 2061 6c6c 2063 6869 6c64 7265 6e20  ot all children 
+00006220: 6861 7665 2074 6865 2073 616d 6520 7068  have the same ph
+00006230: 6173 696e 6720 616e 616c 7973 6973 2049  asing analysis I
+00006240: 4473 2e0a 2020 2020 2020 2020 7261 6973  Ds..        rais
+00006250: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+00006260: 4572 726f 7228 224d 7573 7420 6f76 6572  Error("Must over
+00006270: 7269 6465 205f 7068 6173 696e 675f 616e  ride _phasing_an
+00006280: 616c 7973 6973 5f69 6473 2229 0a0a 2020  alysis_ids")..  
+00006290: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000062a0: 4061 6273 7472 6163 746d 6574 686f 640a  @abstractmethod.
+000062b0: 2020 2020 6465 6620 5f64 6566 6175 6c74      def _default
+000062c0: 5f70 6861 7369 6e67 5f61 6e61 6c79 7369  _phasing_analysi
+000062d0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+000062e0: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
+000062f0: 656e 7465 6445 7272 6f72 2822 4d75 7374  entedError("Must
+00006300: 206f 7665 7272 6964 6520 5f64 6566 6175   override _defau
+00006310: 6c74 5f70 6861 7369 6e67 5f61 6e61 6c79  lt_phasing_analy
+00006320: 7369 7322 290a 0a20 2020 2064 6566 205f  sis")..    def _
+00006330: 7072 6570 5f70 6861 7369 6e67 5f61 6e61  prep_phasing_ana
+00006340: 6c79 7369 735f 7061 7261 6d28 7365 6c66  lysis_param(self
+00006350: 2c20 2a2c 2061 6e61 6c79 7369 7329 3a0a  , *, analysis):.
+00006360: 2020 2020 2020 2020 6966 2061 6e61 6c79          if analy
+00006370: 7369 7320 3d3d 2044 4546 4155 4c54 3a0a  sis == DEFAULT:.
+00006380: 2020 2020 2020 2020 2020 2020 616e 616c              anal
+00006390: 7973 6973 203d 2073 656c 662e 5f64 6566  ysis = self._def
+000063a0: 6175 6c74 5f70 6861 7369 6e67 5f61 6e61  ault_phasing_ana
+000063b0: 6c79 7369 730a 2020 2020 2020 2020 6966  lysis.        if
+000063c0: 2061 6e61 6c79 7369 7320 6e6f 7420 696e   analysis not in
+000063d0: 2073 656c 662e 7068 6173 696e 675f 616e   self.phasing_an
+000063e0: 616c 7973 6973 5f69 6473 3a0a 2020 2020  alysis_ids:.    
+000063f0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00006400: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00006410: 2020 2020 2020 2020 2020 6622 496e 7661            f"Inva
+00006420: 6c69 6420 7068 6173 696e 6720 616e 616c  lid phasing anal
+00006430: 7973 6973 2c20 6d75 7374 2062 6520 6f6e  ysis, must be on
+00006440: 6520 6f66 2066 7b73 656c 662e 7068 6173  e of f{self.phas
+00006450: 696e 675f 616e 616c 7973 6973 5f69 6473  ing_analysis_ids
+00006460: 7d2e 220a 2020 2020 2020 2020 2020 2020  }.".            
+00006470: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00006480: 2061 6e61 6c79 7369 730a 0a20 2020 2064   analysis..    d
+00006490: 6566 205f 7265 7375 6c74 735f 6361 6368  ef _results_cach
+000064a0: 655f 6164 645f 616e 616c 7973 6973 5f70  e_add_analysis_p
+000064b0: 6172 616d 7328 7365 6c66 2c20 7061 7261  arams(self, para
+000064c0: 6d73 293a 0a20 2020 2020 2020 2023 2064  ms):.        # d
+000064d0: 6566 6175 6c74 2069 6d70 6c65 6d65 6e74  efault implement
+000064e0: 6174 696f 6e2c 2063 616e 2062 6520 6f76  ation, can be ov
+000064f0: 6572 7269 6464 656e 2069 6620 6164 6469  erridden if addi
+00006500: 7469 6f6e 616c 2061 6e61 6c79 7369 730a  tional analysis.
+00006510: 2020 2020 2020 2020 2320 7061 7261 6d73          # params
+00006520: 2061 7265 2075 7365 640a 2020 2020 2020   are used.      
+00006530: 2020 7061 7261 6d73 5b22 636f 686f 7274    params["cohort
+00006540: 735f 616e 616c 7973 6973 225d 203d 2073  s_analysis"] = s
+00006550: 656c 662e 5f63 6f68 6f72 7473 5f61 6e61  elf._cohorts_ana
+00006560: 6c79 7369 730a 2020 2020 2020 2020 7061  lysis.        pa
+00006570: 7261 6d73 5b22 7369 7465 5f66 696c 7465  rams["site_filte
+00006580: 7273 5f61 6e61 6c79 7369 7322 5d20 3d20  rs_analysis"] = 
+00006590: 7365 6c66 2e5f 7369 7465 5f66 696c 7465  self._site_filte
+000065a0: 7273 5f61 6e61 6c79 7369 730a 0a20 2020  rs_analysis..   
+000065b0: 2064 6566 2072 6573 756c 7473 5f63 6163   def results_cac
+000065c0: 6865 5f67 6574 2873 656c 662c 202a 2c20  he_get(self, *, 
+000065d0: 6e61 6d65 2c20 7061 7261 6d73 293a 0a20  name, params):. 
+000065e0: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
+000065f0: 656c 662e 5f6c 6f67 2e64 6562 7567 0a20  elf._log.debug. 
+00006600: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00006610: 7265 7375 6c74 735f 6361 6368 6520 6973  results_cache is
+00006620: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00006630: 2020 2072 6169 7365 2043 6163 6865 4d69     raise CacheMi
+00006640: 7373 0a20 2020 2020 2020 2070 6172 616d  ss.        param
+00006650: 7320 3d20 7061 7261 6d73 2e63 6f70 7928  s = params.copy(
+00006660: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00006670: 7265 7375 6c74 735f 6361 6368 655f 6164  results_cache_ad
+00006680: 645f 616e 616c 7973 6973 5f70 6172 616d  d_analysis_param
+00006690: 7328 7061 7261 6d73 290a 2020 2020 2020  s(params).      
+000066a0: 2020 6361 6368 655f 6b65 792c 205f 203d    cache_key, _ =
+000066b0: 2068 6173 685f 7061 7261 6d73 2870 6172   hash_params(par
+000066c0: 616d 7329 0a20 2020 2020 2020 2063 6163  ams).        cac
+000066d0: 6865 5f70 6174 6820 3d20 7365 6c66 2e5f  he_path = self._
+000066e0: 7265 7375 6c74 735f 6361 6368 6520 2f20  results_cache / 
+000066f0: 6e61 6d65 202f 2063 6163 6865 5f6b 6579  name / cache_key
+00006700: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00006710: 5f70 6174 6820 3d20 6361 6368 655f 7061  _path = cache_pa
+00006720: 7468 202f 2022 7265 7375 6c74 732e 6e70  th / "results.np
+00006730: 7a22 0a20 2020 2020 2020 2069 6620 6e6f  z".        if no
+00006740: 7420 7265 7375 6c74 735f 7061 7468 2e65  t results_path.e
+00006750: 7869 7374 7328 293a 0a20 2020 2020 2020  xists():.       
+00006760: 2020 2020 2072 6169 7365 2043 6163 6865       raise Cache
+00006770: 4d69 7373 0a20 2020 2020 2020 2072 6573  Miss.        res
+00006780: 756c 7473 203d 206e 702e 6c6f 6164 2872  ults = np.load(r
+00006790: 6573 756c 7473 5f70 6174 6829 0a20 2020  esults_path).   
+000067a0: 2020 2020 2064 6562 7567 2866 226c 6f61       debug(f"loa
+000067b0: 6465 6420 7b6e 616d 657d 2f7b 6361 6368  ded {name}/{cach
+000067c0: 655f 6b65 797d 2229 0a20 2020 2020 2020  e_key}").       
+000067d0: 2072 6574 7572 6e20 7265 7375 6c74 730a   return results.
+000067e0: 0a20 2020 2064 6566 2072 6573 756c 7473  .    def results
+000067f0: 5f63 6163 6865 5f73 6574 2873 656c 662c  _cache_set(self,
+00006800: 202a 2c20 6e61 6d65 2c20 7061 7261 6d73   *, name, params
+00006810: 2c20 7265 7375 6c74 7329 3a0a 2020 2020  , results):.    
+00006820: 2020 2020 6465 6275 6720 3d20 7365 6c66      debug = self
+00006830: 2e5f 6c6f 672e 6465 6275 670a 2020 2020  ._log.debug.    
+00006840: 2020 2020 6966 2073 656c 662e 5f72 6573      if self._res
+00006850: 756c 7473 5f63 6163 6865 2069 7320 4e6f  ults_cache is No
+00006860: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006870: 6465 6275 6728 226e 6f20 7265 7375 6c74  debug("no result
+00006880: 7320 6361 6368 6520 6861 7320 6265 656e  s cache has been
+00006890: 2063 6f6e 6669 6775 7265 642c 2064 6f20   configured, do 
+000068a0: 6e6f 7468 696e 6722 290a 2020 2020 2020  nothing").      
+000068b0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+000068c0: 2020 2020 2070 6172 616d 7320 3d20 7061       params = pa
+000068d0: 7261 6d73 2e63 6f70 7928 290a 2020 2020  rams.copy().    
+000068e0: 2020 2020 7365 6c66 2e5f 7265 7375 6c74      self._result
+000068f0: 735f 6361 6368 655f 6164 645f 616e 616c  s_cache_add_anal
+00006900: 7973 6973 5f70 6172 616d 7328 7061 7261  ysis_params(para
+00006910: 6d73 290a 2020 2020 2020 2020 6361 6368  ms).        cach
+00006920: 655f 6b65 792c 2070 6172 616d 735f 6a73  e_key, params_js
+00006930: 6f6e 203d 2068 6173 685f 7061 7261 6d73  on = hash_params
+00006940: 2870 6172 616d 7329 0a20 2020 2020 2020  (params).       
+00006950: 2063 6163 6865 5f70 6174 6820 3d20 7365   cache_path = se
+00006960: 6c66 2e5f 7265 7375 6c74 735f 6361 6368  lf._results_cach
+00006970: 6520 2f20 6e61 6d65 202f 2063 6163 6865  e / name / cache
+00006980: 5f6b 6579 0a20 2020 2020 2020 2063 6163  _key.        cac
+00006990: 6865 5f70 6174 682e 6d6b 6469 7228 6578  he_path.mkdir(ex
+000069a0: 6973 745f 6f6b 3d54 7275 652c 2070 6172  ist_ok=True, par
+000069b0: 656e 7473 3d54 7275 6529 0a20 2020 2020  ents=True).     
+000069c0: 2020 2070 6172 616d 735f 7061 7468 203d     params_path =
+000069d0: 2063 6163 6865 5f70 6174 6820 2f20 2270   cache_path / "p
+000069e0: 6172 616d 732e 6a73 6f6e 220a 2020 2020  arams.json".    
+000069f0: 2020 2020 7265 7375 6c74 735f 7061 7468      results_path
+00006a00: 203d 2063 6163 6865 5f70 6174 6820 2f20   = cache_path / 
+00006a10: 2272 6573 756c 7473 2e6e 707a 220a 2020  "results.npz".  
+00006a20: 2020 2020 2020 7769 7468 2070 6172 616d        with param
+00006a30: 735f 7061 7468 2e6f 7065 6e28 6d6f 6465  s_path.open(mode
+00006a40: 3d22 7722 2920 6173 2066 3a0a 2020 2020  ="w") as f:.    
+00006a50: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00006a60: 7061 7261 6d73 5f6a 736f 6e29 0a20 2020  params_json).   
+00006a70: 2020 2020 206e 702e 7361 7665 7a5f 636f       np.savez_co
+00006a80: 6d70 7265 7373 6564 2872 6573 756c 7473  mpressed(results
+00006a90: 5f70 6174 682c 202a 2a72 6573 756c 7473  _path, **results
+00006aa0: 290a 2020 2020 2020 2020 6465 6275 6728  ).        debug(
+00006ab0: 6622 7361 7665 6420 7b6e 616d 657d 2f7b  f"saved {name}/{
+00006ac0: 6361 6368 655f 6b65 797d 2229 0a0a 2020  cache_key}")..  
+00006ad0: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
+00006ae0: 7375 6d6d 6172 793d 2222 220a 2020 2020  summary=""".    
+00006af0: 2020 2020 2020 2020 436f 6d70 7574 6520          Compute 
+00006b00: 534e 5020 616c 6c65 6c65 2063 6f75 6e74  SNP allele count
+00006b10: 732e 2054 6869 7320 7265 7475 726e 7320  s. This returns 
+00006b20: 7468 6520 6e75 6d62 6572 206f 6620 7469  the number of ti
+00006b30: 6d65 7320 6561 6368 0a20 2020 2020 2020  mes each.       
+00006b40: 2020 2020 2053 4e50 2061 6c6c 656c 6520       SNP allele 
+00006b50: 7761 7320 6f62 7365 7276 6564 2069 6e20  was observed in 
+00006b60: 7468 6520 7365 6c65 6374 6564 2073 616d  the selected sam
+00006b70: 706c 6573 2e0a 2020 2020 2020 2020 2222  ples..        ""
+00006b80: 222c 0a20 2020 2020 2020 2072 6574 7572  ",.        retur
+00006b90: 6e73 3d22 2222 0a20 2020 2020 2020 2020  ns=""".         
+00006ba0: 2020 2041 206e 756d 7079 2061 7272 6179     A numpy array
+00006bb0: 206f 6620 7368 6170 6520 286e 5f76 6172   of shape (n_var
+00006bc0: 6961 6e74 732c 2034 292c 2077 6865 7265  iants, 4), where
+00006bd0: 2074 6865 2066 6972 7374 2063 6f6c 756d   the first colum
+00006be0: 6e20 6861 730a 2020 2020 2020 2020 2020  n has.          
+00006bf0: 2020 7468 6520 7265 6665 7265 6e63 6520    the reference 
+00006c00: 616c 6c65 6c65 2028 3029 2063 6f75 6e74  allele (0) count
+00006c10: 732c 2074 6865 2073 6563 6f6e 6420 636f  s, the second co
+00006c20: 6c75 6d6e 2068 6173 2074 6865 2066 6972  lumn has the fir
+00006c30: 7374 0a20 2020 2020 2020 2020 2020 2061  st.            a
+00006c40: 6c74 6572 6e61 7465 2061 6c6c 656c 6520  lternate allele 
+00006c50: 2831 2920 636f 756e 7473 2c20 7468 6520  (1) counts, the 
+00006c60: 7468 6972 6420 636f 6c75 6d6e 2068 6173  third column has
+00006c70: 2074 6865 2073 6563 6f6e 640a 2020 2020   the second.    
+00006c80: 2020 2020 2020 2020 616c 7465 726e 6174          alternat
+00006c90: 6520 616c 6c65 6c65 2028 3229 2063 6f75  e allele (2) cou
+00006ca0: 6e74 732c 2061 6e64 2074 6865 2066 6f75  nts, and the fou
+00006cb0: 7274 6820 636f 6c75 6d6e 2068 6173 2074  rth column has t
+00006cc0: 6865 2074 6869 7264 0a20 2020 2020 2020  he third.       
+00006cd0: 2020 2020 2061 6c74 6572 6e61 7465 2061       alternate a
+00006ce0: 6c6c 656c 6520 2833 2920 636f 756e 7473  llele (3) counts
+00006cf0: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
+00006d00: 2020 2020 2020 206e 6f74 6573 3d22 2222         notes="""
+00006d10: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
+00006d20: 7320 636f 6d70 7574 6174 696f 6e20 6d61  s computation ma
+00006d30: 7920 7461 6b65 2073 6f6d 6520 7469 6d65  y take some time
+00006d40: 2074 6f20 7275 6e2c 2064 6570 656e 6469   to run, dependi
+00006d50: 6e67 206f 6e20 796f 7572 0a20 2020 2020  ng on your.     
+00006d60: 2020 2020 2020 2063 6f6d 7075 7469 6e67         computing
+00006d70: 2065 6e76 6972 6f6e 6d65 6e74 2e20 5265   environment. Re
+00006d80: 7375 6c74 7320 6f66 2074 6869 7320 636f  sults of this co
+00006d90: 6d70 7574 6174 696f 6e20 7769 6c6c 2062  mputation will b
+00006da0: 6520 6361 6368 6564 0a20 2020 2020 2020  e cached.       
+00006db0: 2020 2020 2061 6e64 2072 652d 7573 6564       and re-used
+00006dc0: 2069 6620 7468 6520 6072 6573 756c 7473   if the `results
+00006dd0: 5f63 6163 6865 6020 7061 7261 6d65 7465  _cache` paramete
+00006de0: 7220 7761 7320 7365 7420 7768 656e 0a20  r was set when. 
+00006df0: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
+00006e00: 6e74 6961 7469 6e67 2074 6865 2063 6c61  ntiating the cla
+00006e10: 7373 2e0a 2020 2020 2020 2020 2222 222c  ss..        """,
+00006e20: 0a20 2020 2029 0a20 2020 2064 6566 2073  .    ).    def s
+00006e30: 6e70 5f61 6c6c 656c 655f 636f 756e 7473  np_allele_counts
+00006e40: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00006e50: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
+00006e60: 6261 7365 5f70 6172 616d 732e 7265 6769  base_params.regi
+00006e70: 6f6e 2c0a 2020 2020 2020 2020 7361 6d70  on,.        samp
+00006e80: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
+00006e90: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+00006ea0: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
+00006eb0: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
+00006ec0: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
+00006ed0: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+00006ee0: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
+00006ef0: 6e65 2c0a 2020 2020 2020 2020 7369 7465  ne,.        site
+00006f00: 5f6d 6173 6b3a 204f 7074 696f 6e61 6c5b  _mask: Optional[
+00006f10: 6261 7365 5f70 6172 616d 732e 7369 7465  base_params.site
+00006f20: 5f6d 6173 6b5d 203d 204e 6f6e 652c 0a20  _mask] = None,. 
+00006f30: 2020 2020 2020 2073 6974 655f 636c 6173         site_clas
+00006f40: 733a 204f 7074 696f 6e61 6c5b 6261 7365  s: Optional[base
+00006f50: 5f70 6172 616d 732e 7369 7465 5f63 6c61  _params.site_cla
+00006f60: 7373 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ss] = None,.    
+00006f70: 2020 2020 636f 686f 7274 5f73 697a 653a      cohort_size:
+00006f80: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
+00006f90: 6172 616d 732e 636f 686f 7274 5f73 697a  arams.cohort_siz
+00006fa0: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+00006fb0: 2020 2072 616e 646f 6d5f 7365 6564 3a20     random_seed: 
+00006fc0: 6261 7365 5f70 6172 616d 732e 7261 6e64  base_params.rand
+00006fd0: 6f6d 5f73 6565 6420 3d20 3432 2c0a 2020  om_seed = 42,.  
+00006fe0: 2020 2920 2d3e 206e 702e 6e64 6172 7261    ) -> np.ndarra
+00006ff0: 793a 0a20 2020 2020 2020 2023 2063 6861  y:.        # cha
+00007000: 6e67 6520 7468 6973 206e 616d 6520 6966  nge this name if
+00007010: 2079 6f75 2065 7665 7220 6368 616e 6765   you ever change
+00007020: 2074 6865 2062 6568 6176 696f 7572 206f   the behaviour o
+00007030: 6620 7468 6973 2066 756e 6374 696f 6e2c  f this function,
+00007040: 0a20 2020 2020 2020 2023 2074 6f20 696e  .        # to in
+00007050: 7661 6c69 6461 7465 2061 6e79 2070 7265  validate any pre
+00007060: 7669 6f75 736c 7920 6361 6368 6564 2064  viously cached d
+00007070: 6174 610a 2020 2020 2020 2020 6e61 6d65  ata.        name
+00007080: 203d 2073 656c 662e 5f73 6e70 5f61 6c6c   = self._snp_all
+00007090: 656c 655f 636f 756e 7473 5f72 6573 756c  ele_counts_resul
+000070a0: 7473 5f63 6163 6865 5f6e 616d 650a 0a20  ts_cache_name.. 
+000070b0: 2020 2020 2020 2023 206e 6f72 6d61 6c69         # normali
+000070c0: 7a65 2070 6172 616d 7320 666f 7220 636f  ze params for co
+000070d0: 6e73 6973 7465 6e74 2068 6173 6820 7661  nsistent hash va
+000070e0: 6c75 650a 2020 2020 2020 2020 7361 6d70  lue.        samp
+000070f0: 6c65 5f73 6574 732c 2073 616d 706c 655f  le_sets, sample_
+00007100: 7175 6572 7920 3d20 7365 6c66 2e5f 7072  query = self._pr
+00007110: 6570 5f73 616d 706c 655f 7365 6c65 6374  ep_sample_select
+00007120: 696f 6e5f 6361 6368 655f 7061 7261 6d73  ion_cache_params
+00007130: 280a 2020 2020 2020 2020 2020 2020 7361  (.            sa
+00007140: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
+00007150: 5f73 6574 732c 2073 616d 706c 655f 7175  _sets, sample_qu
+00007160: 6572 793d 7361 6d70 6c65 5f71 7565 7279  ery=sample_query
+00007170: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00007180: 2020 2072 6567 696f 6e20 3d20 7365 6c66     region = self
+00007190: 2e5f 7072 6570 5f72 6567 696f 6e5f 6361  ._prep_region_ca
+000071a0: 6368 655f 7061 7261 6d28 7265 6769 6f6e  che_param(region
+000071b0: 3d72 6567 696f 6e29 0a20 2020 2020 2020  =region).       
+000071c0: 2073 6974 655f 6d61 736b 203d 2073 656c   site_mask = sel
+000071d0: 662e 5f70 7265 705f 7369 7465 5f6d 6173  f._prep_site_mas
+000071e0: 6b5f 7061 7261 6d28 7369 7465 5f6d 6173  k_param(site_mas
+000071f0: 6b3d 7369 7465 5f6d 6173 6b29 0a20 2020  k=site_mask).   
+00007200: 2020 2020 2070 6172 616d 7320 3d20 6469       params = di
+00007210: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+00007220: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
+00007230: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00007240: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
+00007250: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00007260: 7361 6d70 6c65 5f71 7565 7279 3d73 616d  sample_query=sam
+00007270: 706c 655f 7175 6572 792c 0a20 2020 2020  ple_query,.     
+00007280: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+00007290: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
+000072a0: 2020 2020 2020 2020 7369 7465 5f63 6c61          site_cla
+000072b0: 7373 3d73 6974 655f 636c 6173 732c 0a20  ss=site_class,. 
+000072c0: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
+000072d0: 745f 7369 7a65 3d63 6f68 6f72 745f 7369  t_size=cohort_si
+000072e0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+000072f0: 7261 6e64 6f6d 5f73 6565 643d 7261 6e64  random_seed=rand
+00007300: 6f6d 5f73 6565 642c 0a20 2020 2020 2020  om_seed,.       
+00007310: 2029 0a0a 2020 2020 2020 2020 7472 793a   )..        try:
+00007320: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00007330: 756c 7473 203d 2073 656c 662e 7265 7375  ults = self.resu
+00007340: 6c74 735f 6361 6368 655f 6765 7428 6e61  lts_cache_get(na
+00007350: 6d65 3d6e 616d 652c 2070 6172 616d 733d  me=name, params=
+00007360: 7061 7261 6d73 290a 0a20 2020 2020 2020  params)..       
+00007370: 2065 7863 6570 7420 4361 6368 654d 6973   except CacheMis
+00007380: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00007390: 6573 756c 7473 203d 2073 656c 662e 5f73  esults = self._s
+000073a0: 6e70 5f61 6c6c 656c 655f 636f 756e 7473  np_allele_counts
+000073b0: 282a 2a70 6172 616d 7329 0a20 2020 2020  (**params).     
+000073c0: 2020 2020 2020 2073 656c 662e 7265 7375         self.resu
+000073d0: 6c74 735f 6361 6368 655f 7365 7428 6e61  lts_cache_set(na
+000073e0: 6d65 3d6e 616d 652c 2070 6172 616d 733d  me=name, params=
+000073f0: 7061 7261 6d73 2c20 7265 7375 6c74 733d  params, results=
+00007400: 7265 7375 6c74 7329 0a0a 2020 2020 2020  results)..      
+00007410: 2020 6163 203d 2072 6573 756c 7473 5b22    ac = results["
+00007420: 6163 225d 0a20 2020 2020 2020 2072 6574  ac"].        ret
+00007430: 7572 6e20 6163 0a0a 2020 2020 4064 6f63  urn ac..    @doc
+00007440: 280a 2020 2020 2020 2020 7375 6d6d 6172  (.        summar
+00007450: 793d 2222 220a 2020 2020 2020 2020 2020  y=""".          
+00007460: 2020 4772 6f75 7020 7361 6d70 6c65 7320    Group samples 
+00007470: 6279 2074 6178 6f6e 2c20 6172 6561 2028  by taxon, area (
+00007480: 7370 6163 6529 2061 6e64 2070 6572 696f  space) and perio
+00007490: 6420 2874 696d 6529 2c20 7468 656e 2063  d (time), then c
+000074a0: 6f6d 7075 7465 0a20 2020 2020 2020 2020  ompute.         
+000074b0: 2020 2053 4e50 2061 6c6c 656c 6520 6672     SNP allele fr
+000074c0: 6571 7565 6e63 6965 732e 0a20 2020 2020  equencies..     
+000074d0: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+000074e0: 7265 7475 726e 733d 2222 220a 2020 2020  returns=""".    
+000074f0: 2020 2020 2020 2020 5468 6520 7265 7375          The resu
+00007500: 6c74 696e 6720 6461 7461 7365 7420 636f  lting dataset co
+00007510: 6e74 6169 6e73 2064 6174 6120 6861 7320  ntains data has 
+00007520: 6469 6d65 6e73 696f 6e73 2022 636f 686f  dimensions "coho
+00007530: 7274 7322 2061 6e64 0a20 2020 2020 2020  rts" and.       
+00007540: 2020 2020 2022 7661 7269 616e 7473 222e       "variants".
+00007550: 2056 6172 6961 626c 6573 2070 7265 6669   Variables prefi
+00007560: 7865 6420 7769 7468 2022 636f 686f 7274  xed with "cohort
+00007570: 2220 6172 6520 312d 6469 6d65 6e73 696f  " are 1-dimensio
+00007580: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00007590: 6172 7261 7973 2077 6974 6820 6461 7461  arrays with data
+000075a0: 2061 626f 7574 2074 6865 2063 6f68 6f72   about the cohor
+000075b0: 7473 2c20 7375 6368 2061 7320 7468 6520  ts, such as the 
+000075c0: 6172 6561 2c20 7065 7269 6f64 2c20 7461  area, period, ta
+000075d0: 786f 6e0a 2020 2020 2020 2020 2020 2020  xon.            
+000075e0: 616e 6420 636f 686f 7274 2073 697a 652e  and cohort size.
+000075f0: 2056 6172 6961 626c 6573 2070 7265 6669   Variables prefi
+00007600: 7865 6420 7769 7468 2022 7661 7269 616e  xed with "varian
+00007610: 7422 2061 7265 0a20 2020 2020 2020 2020  t" are.         
+00007620: 2020 2031 2d64 696d 656e 7369 6f6e 616c     1-dimensional
+00007630: 2061 7272 6179 7320 7769 7468 2064 6174   arrays with dat
+00007640: 6120 6162 6f75 7420 7468 6520 7661 7269  a about the vari
+00007650: 616e 7473 2c20 7375 6368 2061 7320 7468  ants, such as th
+00007660: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
+00007670: 6e74 6967 2c20 706f 7369 7469 6f6e 2c20  ntig, position, 
+00007680: 7265 6665 7265 6e63 6520 616e 6420 616c  reference and al
+00007690: 7465 726e 6174 6520 616c 6c65 6c65 732e  ternate alleles.
+000076a0: 2056 6172 6961 626c 6573 0a20 2020 2020   Variables.     
+000076b0: 2020 2020 2020 2070 7265 6669 7865 6420         prefixed 
+000076c0: 7769 7468 2022 6576 656e 7422 2061 7265  with "event" are
+000076d0: 2032 2d64 696d 656e 7369 6f6e 616c 2061   2-dimensional a
+000076e0: 7272 6179 7320 7769 7468 2074 6865 2061  rrays with the a
+000076f0: 6c6c 656c 650a 2020 2020 2020 2020 2020  llele.          
+00007700: 2020 636f 756e 7473 2061 6e64 2066 7265    counts and fre
+00007710: 7175 656e 6379 2063 616c 6375 6c61 7469  quency calculati
+00007720: 6f6e 732e 0a20 2020 2020 2020 2022 2222  ons..        """
+00007730: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
+00007740: 736e 705f 616c 6c65 6c65 5f66 7265 7175  snp_allele_frequ
+00007750: 656e 6369 6573 5f61 6476 616e 6365 6428  encies_advanced(
+00007760: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00007770: 2020 2020 2020 2074 7261 6e73 6372 6970         transcrip
+00007780: 743a 2062 6173 655f 7061 7261 6d73 2e74  t: base_params.t
+00007790: 7261 6e73 6372 6970 742c 0a20 2020 2020  ranscript,.     
+000077a0: 2020 2061 7265 615f 6279 3a20 6672 715f     area_by: frq_
+000077b0: 7061 7261 6d73 2e61 7265 615f 6279 2c0a  params.area_by,.
+000077c0: 2020 2020 2020 2020 7065 7269 6f64 5f62          period_b
+000077d0: 793a 2066 7271 5f70 6172 616d 732e 7065  y: frq_params.pe
+000077e0: 7269 6f64 5f62 792c 0a20 2020 2020 2020  riod_by,.       
+000077f0: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
+00007800: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+00007810: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
+00007820: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00007830: 7361 6d70 6c65 5f71 7565 7279 3a20 4f70  sample_query: Op
+00007840: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+00007850: 6d73 2e73 616d 706c 655f 7175 6572 795d  ms.sample_query]
+00007860: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00007870: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+00007880: 3a20 6261 7365 5f70 6172 616d 732e 6d69  : base_params.mi
+00007890: 6e5f 636f 686f 7274 5f73 697a 6520 3d20  n_cohort_size = 
+000078a0: 3130 2c0a 2020 2020 2020 2020 6472 6f70  10,.        drop
+000078b0: 5f69 6e76 6172 6961 6e74 3a20 6672 715f  _invariant: frq_
+000078c0: 7061 7261 6d73 2e64 726f 705f 696e 7661  params.drop_inva
+000078d0: 7269 616e 7420 3d20 5472 7565 2c0a 2020  riant = True,.  
+000078e0: 2020 2020 2020 7661 7269 616e 745f 7175        variant_qu
+000078f0: 6572 793a 204f 7074 696f 6e61 6c5b 6672  ery: Optional[fr
+00007900: 715f 7061 7261 6d73 2e76 6172 6961 6e74  q_params.variant
+00007910: 5f71 7565 7279 5d20 3d20 4e6f 6e65 2c0a  _query] = None,.
+00007920: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
+00007930: 6b3a 204f 7074 696f 6e61 6c5b 6261 7365  k: Optional[base
+00007940: 5f70 6172 616d 732e 7369 7465 5f6d 6173  _params.site_mas
+00007950: 6b5d 203d 204e 6f6e 652c 0a20 2020 2020  k] = None,.     
+00007960: 2020 206e 6f62 735f 6d6f 6465 3a20 6672     nobs_mode: fr
+00007970: 715f 7061 7261 6d73 2e6e 6f62 735f 6d6f  q_params.nobs_mo
+00007980: 6465 203d 2066 7271 5f70 6172 616d 732e  de = frq_params.
+00007990: 6e6f 6273 5f6d 6f64 655f 6465 6661 756c  nobs_mode_defaul
+000079a0: 742c 0a20 2020 2020 2020 2063 695f 6d65  t,.        ci_me
+000079b0: 7468 6f64 3a20 4f70 7469 6f6e 616c 5b66  thod: Optional[f
+000079c0: 7271 5f70 6172 616d 732e 6369 5f6d 6574  rq_params.ci_met
+000079d0: 686f 645d 203d 2066 7271 5f70 6172 616d  hod] = frq_param
+000079e0: 732e 6369 5f6d 6574 686f 645f 6465 6661  s.ci_method_defa
+000079f0: 756c 742c 0a20 2020 2029 202d 3e20 7872  ult,.    ) -> xr
+00007a00: 2e44 6174 6173 6574 3a0a 2020 2020 2020  .Dataset:.      
+00007a10: 2020 6465 6275 6720 3d20 7365 6c66 2e5f    debug = self._
+00007a20: 6c6f 672e 6465 6275 670a 0a20 2020 2020  log.debug..     
+00007a30: 2020 2064 6562 7567 2822 6368 6563 6b20     debug("check 
+00007a40: 7061 7261 6d65 7465 7273 2229 0a20 2020  parameters").   
+00007a50: 2020 2020 2073 656c 662e 5f63 6865 636b       self._check
+00007a60: 5f70 6172 616d 5f6d 696e 5f63 6f68 6f72  _param_min_cohor
+00007a70: 745f 7369 7a65 286d 696e 5f63 6f68 6f72  t_size(min_cohor
+00007a80: 745f 7369 7a65 290a 0a20 2020 2020 2020  t_size)..       
+00007a90: 2064 6562 7567 2822 6c6f 6164 2073 616d   debug("load sam
+00007aa0: 706c 6520 6d65 7461 6461 7461 2229 0a20  ple metadata"). 
+00007ab0: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
+00007ac0: 7320 3d20 7365 6c66 2e73 616d 706c 655f  s = self.sample_
+00007ad0: 6d65 7461 6461 7461 280a 2020 2020 2020  metadata(.      
+00007ae0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+00007af0: 733d 7361 6d70 6c65 5f73 6574 732c 2073  s=sample_sets, s
+00007b00: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
+00007b10: 6c65 5f71 7565 7279 0a20 2020 2020 2020  le_query.       
+00007b20: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
+00007b30: 6728 2261 6363 6573 7320 534e 5020 6361  g("access SNP ca
+00007b40: 6c6c 7322 290a 2020 2020 2020 2020 6473  lls").        ds
+00007b50: 5f73 6e70 7320 3d20 7365 6c66 2e73 6e70  _snps = self.snp
+00007b60: 5f63 616c 6c73 280a 2020 2020 2020 2020  _calls(.        
+00007b70: 2020 2020 7265 6769 6f6e 3d74 7261 6e73      region=trans
+00007b80: 6372 6970 742c 0a20 2020 2020 2020 2020  cript,.         
+00007b90: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
+00007ba0: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
+00007bb0: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
+00007bc0: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
+00007bd0: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
+00007be0: 6974 655f 6d61 736b 3d73 6974 655f 6d61  ite_mask=site_ma
+00007bf0: 736b 2c0a 2020 2020 2020 2020 290a 0a20  sk,.        ).. 
+00007c00: 2020 2020 2020 2064 6562 7567 2822 6163         debug("ac
+00007c10: 6365 7373 2067 656e 6f74 7970 6573 2229  cess genotypes")
+00007c20: 0a20 2020 2020 2020 2067 7420 3d20 6473  .        gt = ds
+00007c30: 5f73 6e70 735b 2263 616c 6c5f 6765 6e6f  _snps["call_geno
+00007c40: 7479 7065 225d 2e64 6174 610a 0a20 2020  type"].data..   
+00007c50: 2020 2020 2064 6562 7567 2822 7072 6570       debug("prep
+00007c60: 6172 6520 7361 6d70 6c65 206d 6574 6164  are sample metad
+00007c70: 6174 6120 666f 7220 636f 686f 7274 2067  ata for cohort g
+00007c80: 726f 7570 696e 6722 290a 2020 2020 2020  rouping").      
+00007c90: 2020 6466 5f73 616d 706c 6573 203d 2073    df_samples = s
+00007ca0: 656c 662e 5f70 7265 705f 7361 6d70 6c65  elf._prep_sample
+00007cb0: 735f 666f 725f 636f 686f 7274 5f67 726f  s_for_cohort_gro
+00007cc0: 7570 696e 6728 0a20 2020 2020 2020 2020  uping(.         
+00007cd0: 2020 2064 665f 7361 6d70 6c65 733d 6466     df_samples=df
+00007ce0: 5f73 616d 706c 6573 2c0a 2020 2020 2020  _samples,.      
+00007cf0: 2020 2020 2020 6172 6561 5f62 793d 6172        area_by=ar
+00007d00: 6561 5f62 792c 0a20 2020 2020 2020 2020  ea_by,.         
+00007d10: 2020 2070 6572 696f 645f 6279 3d70 6572     period_by=per
+00007d20: 696f 645f 6279 2c0a 2020 2020 2020 2020  iod_by,.        
+00007d30: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00007d40: 2822 6772 6f75 7020 7361 6d70 6c65 7320  ("group samples 
+00007d50: 746f 206d 616b 6520 636f 686f 7274 7322  to make cohorts"
+00007d60: 290a 2020 2020 2020 2020 6772 6f75 705f  ).        group_
+00007d70: 7361 6d70 6c65 735f 6279 5f63 6f68 6f72  samples_by_cohor
+00007d80: 7420 3d20 6466 5f73 616d 706c 6573 2e67  t = df_samples.g
+00007d90: 726f 7570 6279 285b 2274 6178 6f6e 222c  roupby(["taxon",
+00007da0: 2022 6172 6561 222c 2022 7065 7269 6f64   "area", "period
+00007db0: 225d 290a 0a20 2020 2020 2020 2064 6562  "])..        deb
+00007dc0: 7567 2822 6275 696c 6420 636f 686f 7274  ug("build cohort
+00007dd0: 7320 6461 7461 6672 616d 6522 290a 2020  s dataframe").  
+00007de0: 2020 2020 2020 6466 5f63 6f68 6f72 7473        df_cohorts
+00007df0: 203d 2073 656c 662e 5f62 7569 6c64 5f63   = self._build_c
+00007e00: 6f68 6f72 7473 5f66 726f 6d5f 7361 6d70  ohorts_from_samp
+00007e10: 6c65 5f67 726f 7570 696e 6728 0a20 2020  le_grouping(.   
+00007e20: 2020 2020 2020 2020 2067 726f 7570 5f73           group_s
+00007e30: 616d 706c 6573 5f62 795f 636f 686f 7274  amples_by_cohort
+00007e40: 2c20 6d69 6e5f 636f 686f 7274 5f73 697a  , min_cohort_siz
+00007e50: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
+00007e60: 2020 2020 2064 6562 7567 2822 6272 696e       debug("brin
+00007e70: 6720 6765 6e6f 7479 7065 7320 696e 746f  g genotypes into
+00007e80: 206d 656d 6f72 7922 290a 2020 2020 2020   memory").      
+00007e90: 2020 7769 7468 2073 656c 662e 5f64 6173    with self._das
+00007ea0: 6b5f 7072 6f67 7265 7373 2864 6573 633d  k_progress(desc=
+00007eb0: 224c 6f61 6420 534e 5020 6765 6e6f 7479  "Load SNP genoty
+00007ec0: 7065 7322 293a 0a20 2020 2020 2020 2020  pes"):.         
+00007ed0: 2020 2067 7420 3d20 6774 2e63 6f6d 7075     gt = gt.compu
+00007ee0: 7465 2829 0a0a 2020 2020 2020 2020 6465  te()..        de
+00007ef0: 6275 6728 2273 6574 2075 7020 7661 7269  bug("set up vari
+00007f00: 616e 7420 7661 7269 6162 6c65 7322 290a  ant variables").
+00007f10: 2020 2020 2020 2020 636f 6e74 6967 7320          contigs 
+00007f20: 3d20 6473 5f73 6e70 732e 6174 7472 735b  = ds_snps.attrs[
+00007f30: 2263 6f6e 7469 6773 225d 0a20 2020 2020  "contigs"].     
+00007f40: 2020 2076 6172 6961 6e74 5f63 6f6e 7469     variant_conti
+00007f50: 6720 3d20 6e70 2e72 6570 6561 7428 0a20  g = np.repeat(. 
+00007f60: 2020 2020 2020 2020 2020 205b 636f 6e74             [cont
+00007f70: 6967 735b 695d 2066 6f72 2069 2069 6e20  igs[i] for i in 
+00007f80: 6473 5f73 6e70 735b 2276 6172 6961 6e74  ds_snps["variant
+00007f90: 5f63 6f6e 7469 6722 5d2e 7661 6c75 6573  _contig"].values
+00007fa0: 5d2c 2033 0a20 2020 2020 2020 2029 0a20  ], 3.        ). 
+00007fb0: 2020 2020 2020 2076 6172 6961 6e74 5f70         variant_p
+00007fc0: 6f73 6974 696f 6e20 3d20 6e70 2e72 6570  osition = np.rep
+00007fd0: 6561 7428 6473 5f73 6e70 735b 2276 6172  eat(ds_snps["var
+00007fe0: 6961 6e74 5f70 6f73 6974 696f 6e22 5d2e  iant_position"].
+00007ff0: 7661 6c75 6573 2c20 3329 0a20 2020 2020  values, 3).     
+00008000: 2020 2061 6c6c 656c 6573 203d 2064 735f     alleles = ds_
+00008010: 736e 7073 5b22 7661 7269 616e 745f 616c  snps["variant_al
+00008020: 6c65 6c65 225d 2e76 616c 7565 730a 2020  lele"].values.  
+00008030: 2020 2020 2020 7661 7269 616e 745f 7265        variant_re
+00008040: 665f 616c 6c65 6c65 203d 206e 702e 7265  f_allele = np.re
+00008050: 7065 6174 2861 6c6c 656c 6573 5b3a 2c20  peat(alleles[:, 
+00008060: 305d 2c20 3329 0a20 2020 2020 2020 2076  0], 3).        v
+00008070: 6172 6961 6e74 5f61 6c74 5f61 6c6c 656c  ariant_alt_allel
+00008080: 6520 3d20 616c 6c65 6c65 735b 3a2c 2031  e = alleles[:, 1
+00008090: 3a5d 2e66 6c61 7474 656e 2829 0a20 2020  :].flatten().   
+000080a0: 2020 2020 2076 6172 6961 6e74 5f70 6173       variant_pas
+000080b0: 7320 3d20 6469 6374 2829 0a20 2020 2020  s = dict().     
+000080c0: 2020 2066 6f72 2073 6974 655f 6d61 736b     for site_mask
+000080d0: 2069 6e20 7365 6c66 2e73 6974 655f 6d61   in self.site_ma
+000080e0: 736b 5f69 6473 3a0a 2020 2020 2020 2020  sk_ids:.        
+000080f0: 2020 2020 7661 7269 616e 745f 7061 7373      variant_pass
+00008100: 5b73 6974 655f 6d61 736b 5d20 3d20 6e70  [site_mask] = np
+00008110: 2e72 6570 6561 7428 0a20 2020 2020 2020  .repeat(.       
+00008120: 2020 2020 2020 2020 2064 735f 736e 7073           ds_snps
+00008130: 5b66 2276 6172 6961 6e74 5f66 696c 7465  [f"variant_filte
+00008140: 725f 7061 7373 5f7b 7369 7465 5f6d 6173  r_pass_{site_mas
+00008150: 6b7d 225d 2e76 616c 7565 732c 2033 0a20  k}"].values, 3. 
+00008160: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00008170: 2020 2020 2020 6465 6275 6728 2273 6574        debug("set
+00008180: 7570 206d 6169 6e20 6576 656e 7420 7661  up main event va
+00008190: 7269 6162 6c65 7322 290a 2020 2020 2020  riables").      
+000081a0: 2020 6e5f 7661 7269 616e 7473 2c20 6e5f    n_variants, n_
+000081b0: 636f 686f 7274 7320 3d20 6c65 6e28 7661  cohorts = len(va
+000081c0: 7269 616e 745f 706f 7369 7469 6f6e 292c  riant_position),
+000081d0: 206c 656e 2864 665f 636f 686f 7274 7329   len(df_cohorts)
+000081e0: 0a20 2020 2020 2020 2063 6f75 6e74 203d  .        count =
+000081f0: 206e 702e 7a65 726f 7328 286e 5f76 6172   np.zeros((n_var
+00008200: 6961 6e74 732c 206e 5f63 6f68 6f72 7473  iants, n_cohorts
+00008210: 292c 2064 7479 7065 3d69 6e74 290a 2020  ), dtype=int).  
+00008220: 2020 2020 2020 6e6f 6273 203d 206e 702e        nobs = np.
+00008230: 7a65 726f 7328 286e 5f76 6172 6961 6e74  zeros((n_variant
+00008240: 732c 206e 5f63 6f68 6f72 7473 292c 2064  s, n_cohorts), d
+00008250: 7479 7065 3d69 6e74 290a 0a20 2020 2020  type=int)..     
+00008260: 2020 2064 6562 7567 2822 6275 696c 6420     debug("build 
+00008270: 6576 656e 7420 636f 756e 7420 616e 6420  event count and 
+00008280: 6e6f 6273 2066 6f72 2065 6163 6820 636f  nobs for each co
+00008290: 686f 7274 2229 0a20 2020 2020 2020 2063  hort").        c
+000082a0: 6f68 6f72 7473 5f69 7465 7261 746f 7220  ohorts_iterator 
+000082b0: 3d20 7365 6c66 2e5f 7072 6f67 7265 7373  = self._progress
+000082c0: 280a 2020 2020 2020 2020 2020 2020 656e  (.            en
+000082d0: 756d 6572 6174 6528 6466 5f63 6f68 6f72  umerate(df_cohor
+000082e0: 7473 2e69 7465 7274 7570 6c65 7328 2929  ts.itertuples())
+000082f0: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
+00008300: 7461 6c3d 6c65 6e28 6466 5f63 6f68 6f72  tal=len(df_cohor
+00008310: 7473 292c 0a20 2020 2020 2020 2020 2020  ts),.           
+00008320: 2064 6573 633d 2243 6f6d 7075 7465 2053   desc="Compute S
+00008330: 4e50 2061 6c6c 656c 6520 6672 6571 7565  NP allele freque
+00008340: 6e63 6965 7322 2c0a 2020 2020 2020 2020  ncies",.        
+00008350: 290a 2020 2020 2020 2020 666f 7220 636f  ).        for co
+00008360: 686f 7274 5f69 6e64 6578 2c20 636f 686f  hort_index, coho
+00008370: 7274 2069 6e20 636f 686f 7274 735f 6974  rt in cohorts_it
+00008380: 6572 6174 6f72 3a0a 2020 2020 2020 2020  erator:.        
+00008390: 2020 2020 636f 686f 7274 5f6b 6579 203d      cohort_key =
+000083a0: 2063 6f68 6f72 742e 7461 786f 6e2c 2063   cohort.taxon, c
+000083b0: 6f68 6f72 742e 6172 6561 2c20 636f 686f  ohort.area, coho
+000083c0: 7274 2e70 6572 696f 640a 2020 2020 2020  rt.period.      
+000083d0: 2020 2020 2020 7361 6d70 6c65 5f69 6e64        sample_ind
+000083e0: 6963 6573 203d 2067 726f 7570 5f73 616d  ices = group_sam
+000083f0: 706c 6573 5f62 795f 636f 686f 7274 2e69  ples_by_cohort.i
+00008400: 6e64 6963 6573 5b63 6f68 6f72 745f 6b65  ndices[cohort_ke
+00008410: 795d 0a0a 2020 2020 2020 2020 2020 2020  y]..            
+00008420: 636f 686f 7274 5f61 632c 2063 6f68 6f72  cohort_ac, cohor
+00008430: 745f 616e 203d 2073 656c 662e 5f63 6f68  t_an = self._coh
+00008440: 6f72 745f 616c 745f 616c 6c65 6c65 5f63  ort_alt_allele_c
+00008450: 6f75 6e74 735f 6d65 6c74 280a 2020 2020  ounts_melt(.    
+00008460: 2020 2020 2020 2020 2020 2020 6774 2c20              gt, 
+00008470: 7361 6d70 6c65 5f69 6e64 6963 6573 2c20  sample_indices, 
+00008480: 6d61 785f 616c 6c65 6c65 3d33 0a20 2020  max_allele=3.   
+00008490: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000084a0: 2020 2020 2020 2063 6f75 6e74 5b3a 2c20         count[:, 
+000084b0: 636f 686f 7274 5f69 6e64 6578 5d20 3d20  cohort_index] = 
+000084c0: 636f 686f 7274 5f61 630a 0a20 2020 2020  cohort_ac..     
+000084d0: 2020 2020 2020 2069 6620 6e6f 6273 5f6d         if nobs_m
+000084e0: 6f64 6520 3d3d 2022 6361 6c6c 6564 223a  ode == "called":
+000084f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008500: 206e 6f62 735b 3a2c 2063 6f68 6f72 745f   nobs[:, cohort_
+00008510: 696e 6465 785d 203d 2063 6f68 6f72 745f  index] = cohort_
+00008520: 616e 0a20 2020 2020 2020 2020 2020 2065  an.            e
+00008530: 6c69 6620 6e6f 6273 5f6d 6f64 6520 3d3d  lif nobs_mode ==
+00008540: 2022 6669 7865 6422 3a0a 2020 2020 2020   "fixed":.      
+00008550: 2020 2020 2020 2020 2020 6e6f 6273 5b3a            nobs[:
+00008560: 2c20 636f 686f 7274 5f69 6e64 6578 5d20  , cohort_index] 
+00008570: 3d20 636f 686f 7274 2e73 697a 6520 2a20  = cohort.size * 
+00008580: 320a 2020 2020 2020 2020 2020 2020 656c  2.            el
+00008590: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000085a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000085b0: 7272 6f72 2866 2242 6164 206e 6f62 735f  rror(f"Bad nobs_
+000085c0: 6d6f 6465 3a20 7b6e 6f62 735f 6d6f 6465  mode: {nobs_mode
+000085d0: 2172 7d22 290a 0a20 2020 2020 2020 2064  !r}")..        d
+000085e0: 6562 7567 2822 636f 6d70 7574 6520 6672  ebug("compute fr
+000085f0: 6571 7565 6e63 7922 290a 2020 2020 2020  equency").      
+00008600: 2020 7769 7468 206e 702e 6572 7273 7461    with np.errsta
+00008610: 7465 2864 6976 6964 653d 2269 676e 6f72  te(divide="ignor
+00008620: 6522 2c20 696e 7661 6c69 643d 2269 676e  e", invalid="ign
+00008630: 6f72 6522 293a 0a20 2020 2020 2020 2020  ore"):.         
+00008640: 2020 2023 2069 676e 6f72 6520 6469 7669     # ignore divi
+00008650: 7369 6f6e 2077 6172 6e69 6e67 730a 2020  sion warnings.  
+00008660: 2020 2020 2020 2020 2020 6672 6571 7565            freque
+00008670: 6e63 7920 3d20 636f 756e 7420 2f20 6e6f  ncy = count / no
+00008680: 6273 0a0a 2020 2020 2020 2020 6465 6275  bs..        debu
+00008690: 6728 2263 6f6d 7075 7465 206d 6178 696d  g("compute maxim
+000086a0: 756d 2066 7265 7175 656e 6379 206f 7665  um frequency ove
+000086b0: 7220 636f 686f 7274 7322 290a 2020 2020  r cohorts").    
+000086c0: 2020 2020 7769 7468 2077 6172 6e69 6e67      with warning
+000086d0: 732e 6361 7463 685f 7761 726e 696e 6773  s.catch_warnings
+000086e0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000086f0: 2320 6967 6e6f 7265 2022 416c 6c2d 4e61  # ignore "All-Na
+00008700: 4e20 736c 6963 6520 656e 636f 756e 7465  N slice encounte
+00008710: 7265 6422 2077 6172 6e69 6e67 730a 2020  red" warnings.  
+00008720: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00008730: 6773 2e73 696d 706c 6566 696c 7465 7228  gs.simplefilter(
+00008740: 2269 676e 6f72 6522 2c20 6361 7465 676f  "ignore", catego
+00008750: 7279 3d52 756e 7469 6d65 5761 726e 696e  ry=RuntimeWarnin
+00008760: 6729 0a20 2020 2020 2020 2020 2020 206d  g).            m
+00008770: 6178 5f61 6620 3d20 6e70 2e6e 616e 6d61  ax_af = np.nanma
+00008780: 7828 6672 6571 7565 6e63 792c 2061 7869  x(frequency, axi
+00008790: 733d 3129 0a0a 2020 2020 2020 2020 6465  s=1)..        de
+000087a0: 6275 6728 226d 616b 6520 6461 7461 6672  bug("make datafr
+000087b0: 616d 6520 6f66 2053 4e50 7322 290a 2020  ame of SNPs").  
+000087c0: 2020 2020 2020 6466 5f76 6172 6961 6e74        df_variant
+000087d0: 735f 636f 6c73 203d 207b 0a20 2020 2020  s_cols = {.     
+000087e0: 2020 2020 2020 2022 636f 6e74 6967 223a         "contig":
+000087f0: 2076 6172 6961 6e74 5f63 6f6e 7469 672c   variant_contig,
+00008800: 0a20 2020 2020 2020 2020 2020 2022 706f  .            "po
+00008810: 7369 7469 6f6e 223a 2076 6172 6961 6e74  sition": variant
+00008820: 5f70 6f73 6974 696f 6e2c 0a20 2020 2020  _position,.     
+00008830: 2020 2020 2020 2022 7265 665f 616c 6c65         "ref_alle
+00008840: 6c65 223a 2076 6172 6961 6e74 5f72 6566  le": variant_ref
+00008850: 5f61 6c6c 656c 652e 6173 7479 7065 2822  _allele.astype("
+00008860: 5531 2229 2c0a 2020 2020 2020 2020 2020  U1"),.          
+00008870: 2020 2261 6c74 5f61 6c6c 656c 6522 3a20    "alt_allele": 
+00008880: 7661 7269 616e 745f 616c 745f 616c 6c65  variant_alt_alle
+00008890: 6c65 2e61 7374 7970 6528 2255 3122 292c  le.astype("U1"),
+000088a0: 0a20 2020 2020 2020 2020 2020 2022 6d61  .            "ma
+000088b0: 785f 6166 223a 206d 6178 5f61 662c 0a20  x_af": max_af,. 
+000088c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000088d0: 2066 6f72 2073 6974 655f 6d61 736b 2069   for site_mask i
+000088e0: 6e20 7365 6c66 2e73 6974 655f 6d61 736b  n self.site_mask
+000088f0: 5f69 6473 3a0a 2020 2020 2020 2020 2020  _ids:.          
+00008900: 2020 6466 5f76 6172 6961 6e74 735f 636f    df_variants_co
+00008910: 6c73 5b66 2270 6173 735f 7b73 6974 655f  ls[f"pass_{site_
+00008920: 6d61 736b 7d22 5d20 3d20 7661 7269 616e  mask}"] = varian
+00008930: 745f 7061 7373 5b73 6974 655f 6d61 736b  t_pass[site_mask
+00008940: 5d0a 2020 2020 2020 2020 6466 5f76 6172  ].        df_var
+00008950: 6961 6e74 7320 3d20 7064 2e44 6174 6146  iants = pd.DataF
+00008960: 7261 6d65 2864 665f 7661 7269 616e 7473  rame(df_variants
+00008970: 5f63 6f6c 7329 0a0a 2020 2020 2020 2020  _cols)..        
+00008980: 6465 6275 6728 2264 6561 6c20 7769 7468  debug("deal with
+00008990: 2053 4e50 2061 6c6c 656c 6573 206e 6f74   SNP alleles not
+000089a0: 206f 6273 6572 7665 6422 290a 2020 2020   observed").    
+000089b0: 2020 2020 6966 2064 726f 705f 696e 7661      if drop_inva
+000089c0: 7269 616e 743a 0a20 2020 2020 2020 2020  riant:.         
+000089d0: 2020 206c 6f63 5f76 6172 6961 6e74 203d     loc_variant =
+000089e0: 206d 6178 5f61 6620 3e20 300a 2020 2020   max_af > 0.    
+000089f0: 2020 2020 2020 2020 6466 5f76 6172 6961          df_varia
+00008a00: 6e74 7320 3d20 6466 5f76 6172 6961 6e74  nts = df_variant
+00008a10: 732e 6c6f 635b 6c6f 635f 7661 7269 616e  s.loc[loc_varian
+00008a20: 745d 2e72 6573 6574 5f69 6e64 6578 2864  t].reset_index(d
+00008a30: 726f 703d 5472 7565 290a 2020 2020 2020  rop=True).      
+00008a40: 2020 2020 2020 636f 756e 7420 3d20 6e70        count = np
+00008a50: 2e63 6f6d 7072 6573 7328 6c6f 635f 7661  .compress(loc_va
+00008a60: 7269 616e 742c 2063 6f75 6e74 2c20 6178  riant, count, ax
+00008a70: 6973 3d30 290a 2020 2020 2020 2020 2020  is=0).          
+00008a80: 2020 6e6f 6273 203d 206e 702e 636f 6d70    nobs = np.comp
+00008a90: 7265 7373 286c 6f63 5f76 6172 6961 6e74  ress(loc_variant
+00008aa0: 2c20 6e6f 6273 2c20 6178 6973 3d30 290a  , nobs, axis=0).
+00008ab0: 2020 2020 2020 2020 2020 2020 6672 6571              freq
+00008ac0: 7565 6e63 7920 3d20 6e70 2e63 6f6d 7072  uency = np.compr
+00008ad0: 6573 7328 6c6f 635f 7661 7269 616e 742c  ess(loc_variant,
+00008ae0: 2066 7265 7175 656e 6379 2c20 6178 6973   frequency, axis
+00008af0: 3d30 290a 0a20 2020 2020 2020 2064 6562  =0)..        deb
+00008b00: 7567 2822 7365 7420 7570 2076 6172 6961  ug("set up varia
+00008b10: 6e74 2065 6666 6563 7420 616e 6e6f 7461  nt effect annota
+00008b20: 746f 7222 290a 2020 2020 2020 2020 616e  tor").        an
+00008b30: 6e20 3d20 7365 6c66 2e5f 616e 6e6f 7461  n = self._annota
+00008b40: 746f 7228 290a 0a20 2020 2020 2020 2064  tor()..        d
+00008b50: 6562 7567 2822 6164 6420 6566 6665 6374  ebug("add effect
+00008b60: 7320 746f 2074 6865 2064 6174 6166 7261  s to the datafra
+00008b70: 6d65 2229 0a20 2020 2020 2020 2061 6e6e  me").        ann
+00008b80: 2e67 6574 5f65 6666 6563 7473 280a 2020  .get_effects(.  
+00008b90: 2020 2020 2020 2020 2020 7472 616e 7363            transc
+00008ba0: 7269 7074 3d74 7261 6e73 6372 6970 742c  ript=transcript,
+00008bb0: 2076 6172 6961 6e74 733d 6466 5f76 6172   variants=df_var
+00008bc0: 6961 6e74 732c 2070 726f 6772 6573 733d  iants, progress=
+00008bd0: 7365 6c66 2e5f 7072 6f67 7265 7373 0a20  self._progress. 
+00008be0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00008bf0: 2020 6465 6275 6728 2261 6464 2076 6172    debug("add var
+00008c00: 6961 6e74 206c 6162 656c 7322 290a 2020  iant labels").  
+00008c10: 2020 2020 2020 6466 5f76 6172 6961 6e74        df_variant
+00008c20: 735b 226c 6162 656c 225d 203d 2073 656c  s["label"] = sel
+00008c30: 662e 5f70 616e 6461 735f 6170 706c 7928  f._pandas_apply(
+00008c40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008c50: 662e 5f6d 616b 655f 736e 705f 6c61 6265  f._make_snp_labe
+00008c60: 6c5f 6566 6665 6374 2c0a 2020 2020 2020  l_effect,.      
+00008c70: 2020 2020 2020 6466 5f76 6172 6961 6e74        df_variant
+00008c80: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
+00008c90: 6f6c 756d 6e73 3d5b 2263 6f6e 7469 6722  olumns=["contig"
+00008ca0: 2c20 2270 6f73 6974 696f 6e22 2c20 2272  , "position", "r
+00008cb0: 6566 5f61 6c6c 656c 6522 2c20 2261 6c74  ef_allele", "alt
+00008cc0: 5f61 6c6c 656c 6522 2c20 2261 615f 6368  _allele", "aa_ch
+00008cd0: 616e 6765 225d 2c0a 2020 2020 2020 2020  ange"],.        
+00008ce0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00008cf0: 2822 6275 696c 6420 7468 6520 6f75 7470  ("build the outp
+00008d00: 7574 2064 6174 6173 6574 2229 0a20 2020  ut dataset").   
+00008d10: 2020 2020 2064 735f 6f75 7420 3d20 7872       ds_out = xr
+00008d20: 2e44 6174 6173 6574 2829 0a0a 2020 2020  .Dataset()..    
+00008d30: 2020 2020 6465 6275 6728 2263 6f68 6f72      debug("cohor
+00008d40: 7420 7661 7269 6162 6c65 7322 290a 2020  t variables").  
+00008d50: 2020 2020 2020 666f 7220 636f 685f 636f        for coh_co
+00008d60: 6c20 696e 2064 665f 636f 686f 7274 732e  l in df_cohorts.
+00008d70: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
+00008d80: 2020 2020 2064 735f 6f75 745b 6622 636f       ds_out[f"co
+00008d90: 686f 7274 5f7b 636f 685f 636f 6c7d 225d  hort_{coh_col}"]
+00008da0: 203d 2022 636f 686f 7274 7322 2c20 6466   = "cohorts", df
+00008db0: 5f63 6f68 6f72 7473 5b63 6f68 5f63 6f6c  _cohorts[coh_col
+00008dc0: 5d0a 0a20 2020 2020 2020 2064 6562 7567  ]..        debug
+00008dd0: 2822 7661 7269 616e 7420 7661 7269 6162  ("variant variab
+00008de0: 6c65 7322 290a 2020 2020 2020 2020 666f  les").        fo
+00008df0: 7220 736e 705f 636f 6c20 696e 2064 665f  r snp_col in df_
+00008e00: 7661 7269 616e 7473 2e63 6f6c 756d 6e73  variants.columns
+00008e10: 3a0a 2020 2020 2020 2020 2020 2020 6473  :.            ds
+00008e20: 5f6f 7574 5b66 2276 6172 6961 6e74 5f7b  _out[f"variant_{
+00008e30: 736e 705f 636f 6c7d 225d 203d 2022 7661  snp_col}"] = "va
+00008e40: 7269 616e 7473 222c 2064 665f 7661 7269  riants", df_vari
+00008e50: 616e 7473 5b73 6e70 5f63 6f6c 5d0a 0a20  ants[snp_col].. 
+00008e60: 2020 2020 2020 2064 6562 7567 2822 6576         debug("ev
+00008e70: 656e 7420 7661 7269 6162 6c65 7322 290a  ent variables").
+00008e80: 2020 2020 2020 2020 6473 5f6f 7574 5b22          ds_out["
+00008e90: 6576 656e 745f 636f 756e 7422 5d20 3d20  event_count"] = 
+00008ea0: 2822 7661 7269 616e 7473 222c 2022 636f  ("variants", "co
+00008eb0: 686f 7274 7322 292c 2063 6f75 6e74 0a20  horts"), count. 
+00008ec0: 2020 2020 2020 2064 735f 6f75 745b 2265         ds_out["e
+00008ed0: 7665 6e74 5f6e 6f62 7322 5d20 3d20 2822  vent_nobs"] = ("
+00008ee0: 7661 7269 616e 7473 222c 2022 636f 686f  variants", "coho
+00008ef0: 7274 7322 292c 206e 6f62 730a 2020 2020  rts"), nobs.    
+00008f00: 2020 2020 6473 5f6f 7574 5b22 6576 656e      ds_out["even
+00008f10: 745f 6672 6571 7565 6e63 7922 5d20 3d20  t_frequency"] = 
+00008f20: 2822 7661 7269 616e 7473 222c 2022 636f  ("variants", "co
+00008f30: 686f 7274 7322 292c 2066 7265 7175 656e  horts"), frequen
+00008f40: 6379 0a0a 2020 2020 2020 2020 6465 6275  cy..        debu
+00008f50: 6728 2261 7070 6c79 2076 6172 6961 6e74  g("apply variant
+00008f60: 2071 7565 7279 2229 0a20 2020 2020 2020   query").       
+00008f70: 2069 6620 7661 7269 616e 745f 7175 6572   if variant_quer
+00008f80: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
+00008f90: 2020 2020 2020 2020 2020 206c 6f63 5f76             loc_v
+00008fa0: 6172 6961 6e74 7320 3d20 6466 5f76 6172  ariants = df_var
+00008fb0: 6961 6e74 732e 6576 616c 2876 6172 6961  iants.eval(varia
+00008fc0: 6e74 5f71 7565 7279 292e 7661 6c75 6573  nt_query).values
+00008fd0: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+00008fe0: 6f75 7420 3d20 6473 5f6f 7574 2e69 7365  out = ds_out.ise
+00008ff0: 6c28 7661 7269 616e 7473 3d6c 6f63 5f76  l(variants=loc_v
+00009000: 6172 6961 6e74 7329 0a0a 2020 2020 2020  ariants)..      
+00009010: 2020 6465 6275 6728 2261 6464 2063 6f6e    debug("add con
+00009020: 6669 6465 6e63 6520 696e 7465 7276 616c  fidence interval
+00009030: 7322 290a 2020 2020 2020 2020 7365 6c66  s").        self
+00009040: 2e5f 6164 645f 6672 6571 7565 6e63 795f  ._add_frequency_
+00009050: 6369 2864 735f 6f75 742c 2063 695f 6d65  ci(ds_out, ci_me
+00009060: 7468 6f64 290a 0a20 2020 2020 2020 2064  thod)..        d
+00009070: 6562 7567 2822 7469 6479 2075 7020 6469  ebug("tidy up di
+00009080: 7370 6c61 7920 6279 2073 6f72 7469 6e67  splay by sorting
+00009090: 2076 6172 6961 626c 6573 2229 0a20 2020   variables").   
+000090a0: 2020 2020 2073 6f72 7465 645f 7661 7273       sorted_vars
+000090b0: 3a20 4c69 7374 5b73 7472 5d20 3d20 736f  : List[str] = so
+000090c0: 7274 6564 285b 7374 7228 6b29 2066 6f72  rted([str(k) for
+000090d0: 206b 2069 6e20 6473 5f6f 7574 2e6b 6579   k in ds_out.key
+000090e0: 7328 295d 290a 2020 2020 2020 2020 6473  s()]).        ds
+000090f0: 5f6f 7574 203d 2064 735f 6f75 745b 736f  _out = ds_out[so
+00009100: 7274 6564 5f76 6172 735d 0a0a 2020 2020  rted_vars]..    
+00009110: 2020 2020 6465 6275 6728 2261 6464 206d      debug("add m
+00009120: 6574 6164 6174 6122 290a 2020 2020 2020  etadata").      
+00009130: 2020 6765 6e65 5f6e 616d 6520 3d20 7365    gene_name = se
+00009140: 6c66 2e5f 7472 616e 7363 7269 7074 5f74  lf._transcript_t
+00009150: 6f5f 6765 6e65 5f6e 616d 6528 7472 616e  o_gene_name(tran
+00009160: 7363 7269 7074 290a 2020 2020 2020 2020  script).        
+00009170: 7469 746c 6520 3d20 7472 616e 7363 7269  title = transcri
+00009180: 7074 0a20 2020 2020 2020 2069 6620 6765  pt.        if ge
+00009190: 6e65 5f6e 616d 653a 0a20 2020 2020 2020  ne_name:.       
+000091a0: 2020 2020 2074 6974 6c65 202b 3d20 6622       title += f"
+000091b0: 2028 7b67 656e 655f 6e61 6d65 7d29 220a   ({gene_name})".
+000091c0: 2020 2020 2020 2020 7469 746c 6520 2b3d          title +=
+000091d0: 2022 2053 4e50 2066 7265 7175 656e 6369   " SNP frequenci
+000091e0: 6573 220a 2020 2020 2020 2020 6473 5f6f  es".        ds_o
+000091f0: 7574 2e61 7474 7273 5b22 7469 746c 6522  ut.attrs["title"
+00009200: 5d20 3d20 7469 746c 650a 0a20 2020 2020  ] = title..     
+00009210: 2020 2072 6574 7572 6e20 6473 5f6f 7574     return ds_out
+00009220: 0a0a 2020 2020 2320 5374 6172 7420 6f66  ..    # Start of
+00009230: 2040 7374 6174 6963 6d65 7468 6f64 2040   @staticmethod @
+00009240: 6162 7374 7261 6374 6d65 7468 6f64 0a0a  abstractmethod..
+00009250: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+00009260: 640a 2020 2020 4061 6273 7472 6163 746d  d.    @abstractm
+00009270: 6574 686f 640a 2020 2020 6465 6620 5f73  ethod.    def _s
+00009280: 6574 7570 5f74 6178 6f6e 5f63 6f6c 6f72  etup_taxon_color
+00009290: 7328 706c 6f74 5f6b 7761 7267 733d 4e6f  s(plot_kwargs=No
+000092a0: 6e65 293a 0a20 2020 2020 2020 2023 2053  ne):.        # S
+000092b0: 7562 636c 6173 7365 7320 6861 7665 2064  ubclasses have d
+000092c0: 6966 6665 7265 6e74 2074 6178 6f6e 5f63  ifferent taxon_c
+000092d0: 6f6c 6f72 5f6d 6170 2e0a 2020 2020 2020  olor_map..      
+000092e0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+000092f0: 6d65 6e74 6564 4572 726f 7228 224d 7573  mentedError("Mus
+00009300: 7420 6f76 6572 7269 6465 205f 7365 7475  t override _setu
+00009310: 705f 7461 786f 6e5f 636f 6c6f 7273 2229  p_taxon_colors")
+00009320: 0a0a 2020 2020 2320 5374 6172 7420 6f66  ..    # Start of
+00009330: 2040 7374 6174 6963 6d65 7468 6f64 0a0a   @staticmethod..
+00009340: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+00009350: 640a 2020 2020 6465 6620 5f6c 6f63 6174  d.    def _locat
+00009360: 655f 636f 686f 7274 7328 2a2c 2063 6f68  e_cohorts(*, coh
+00009370: 6f72 7473 2c20 6466 5f73 616d 706c 6573  orts, df_samples
+00009380: 293a 0a20 2020 2020 2020 2023 2062 7569  ):.        # bui
+00009390: 6c64 2063 6f68 6f72 7420 6469 6374 696f  ld cohort dictio
+000093a0: 6e61 7279 2077 6865 7265 206b 6579 3d63  nary where key=c
+000093b0: 6f68 6f72 745f 6964 2c20 7661 6c75 653d  ohort_id, value=
+000093c0: 6c6f 635f 636f 680a 2020 2020 2020 2020  loc_coh.        
+000093d0: 636f 685f 6469 6374 203d 207b 7d0a 0a20  coh_dict = {}.. 
+000093e0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000093f0: 616e 6365 2863 6f68 6f72 7473 2c20 6469  ance(cohorts, di
+00009400: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+00009410: 2023 2075 7365 7220 6861 7320 7375 7070   # user has supp
+00009420: 6c69 6564 2061 2063 7573 746f 6d20 6469  lied a custom di
+00009430: 6374 696f 6e61 7279 206d 6170 7069 6e67  ctionary mapping
+00009440: 2063 6f68 6f72 7420 6964 656e 7469 6669   cohort identifi
+00009450: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
+00009460: 2320 746f 2070 616e 6461 7320 7175 6572  # to pandas quer
+00009470: 6965 730a 0a20 2020 2020 2020 2020 2020  ies..           
+00009480: 2066 6f72 2063 6f68 2c20 7175 6572 7920   for coh, query 
+00009490: 696e 2063 6f68 6f72 7473 2e69 7465 6d73  in cohorts.items
+000094a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000094b0: 2020 2020 2320 6c6f 6361 7465 2073 616d      # locate sam
+000094c0: 706c 6573 0a20 2020 2020 2020 2020 2020  ples.           
+000094d0: 2020 2020 206c 6f63 5f63 6f68 203d 2064       loc_coh = d
+000094e0: 665f 7361 6d70 6c65 732e 6576 616c 2871  f_samples.eval(q
+000094f0: 7565 7279 292e 7661 6c75 6573 0a20 2020  uery).values.   
+00009500: 2020 2020 2020 2020 2020 2020 2063 6f68               coh
+00009510: 5f64 6963 745b 636f 685d 203d 206c 6f63  _dict[coh] = loc
+00009520: 5f63 6f68 0a0a 2020 2020 2020 2020 6966  _coh..        if
+00009530: 2069 7369 6e73 7461 6e63 6528 636f 686f   isinstance(coho
+00009540: 7274 732c 2073 7472 293a 0a20 2020 2020  rts, str):.     
+00009550: 2020 2020 2020 2023 2075 7365 7220 6861         # user ha
+00009560: 7320 7375 7070 6c69 6564 206f 6e65 206f  s supplied one o
+00009570: 6620 7468 6520 7072 6564 6566 696e 6564  f the predefined
+00009580: 2063 6f68 6f72 7420 7365 7473 0a0a 2020   cohort sets..  
+00009590: 2020 2020 2020 2020 2020 2320 6669 7820            # fix 
+000095a0: 7468 6520 7374 7269 6e67 2074 6f20 6d61  the string to ma
+000095b0: 7463 6820 636f 6c75 6d6e 730a 2020 2020  tch columns.    
+000095c0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+000095d0: 6f68 6f72 7473 2e73 7461 7274 7377 6974  ohorts.startswit
+000095e0: 6828 2263 6f68 6f72 745f 2229 3a0a 2020  h("cohort_"):.  
+000095f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00009600: 686f 7274 7320 3d20 2263 6f68 6f72 745f  horts = "cohort_
+00009610: 2220 2b20 636f 686f 7274 730a 0a20 2020  " + cohorts..   
+00009620: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+00009630: 2074 6865 2067 6976 656e 2063 6f68 6f72   the given cohor
+00009640: 7420 7365 7420 6578 6973 7473 0a20 2020  t set exists.   
+00009650: 2020 2020 2020 2020 2069 6620 636f 686f           if coho
+00009660: 7274 7320 6e6f 7420 696e 2064 665f 7361  rts not in df_sa
+00009670: 6d70 6c65 732e 636f 6c75 6d6e 733a 0a20  mples.columns:. 
+00009680: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009690: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000096a0: 6622 7b63 6f68 6f72 7473 2172 7d20 6973  f"{cohorts!r} is
+000096b0: 206e 6f74 2061 206b 6e6f 776e 2063 6f68   not a known coh
+000096c0: 6f72 7420 7365 7422 290a 2020 2020 2020  ort set").      
+000096d0: 2020 2020 2020 636f 686f 7274 5f6c 6162        cohort_lab
+000096e0: 656c 7320 3d20 6466 5f73 616d 706c 6573  els = df_samples
+000096f0: 5b63 6f68 6f72 7473 5d2e 756e 6971 7565  [cohorts].unique
+00009700: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00009710: 2320 7265 6d6f 7665 2074 6865 206e 616e  # remove the nan
+00009720: 7320 616e 6420 736f 7274 0a20 2020 2020  s and sort.     
+00009730: 2020 2020 2020 2063 6f68 6f72 745f 6c61         cohort_la
+00009740: 6265 6c73 203d 2073 6f72 7465 6428 5b63  bels = sorted([c
+00009750: 2066 6f72 2063 2069 6e20 636f 686f 7274   for c in cohort
+00009760: 5f6c 6162 656c 7320 6966 2069 7369 6e73  _labels if isins
+00009770: 7461 6e63 6528 632c 2073 7472 295d 290a  tance(c, str)]).
+00009780: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00009790: 636f 6820 696e 2063 6f68 6f72 745f 6c61  coh in cohort_la
+000097a0: 6265 6c73 3a0a 2020 2020 2020 2020 2020  bels:.          
+000097b0: 2020 2020 2020 6c6f 635f 636f 6820 3d20        loc_coh = 
+000097c0: 6466 5f73 616d 706c 6573 5b63 6f68 6f72  df_samples[cohor
+000097d0: 7473 5d20 3d3d 2063 6f68 0a20 2020 2020  ts] == coh.     
+000097e0: 2020 2020 2020 2020 2020 2063 6f68 5f64             coh_d
+000097f0: 6963 745b 636f 685d 203d 206c 6f63 5f63  ict[coh] = loc_c
+00009800: 6f68 2e76 616c 7565 730a 0a20 2020 2020  oh.values..     
+00009810: 2020 2072 6574 7572 6e20 636f 685f 6469     return coh_di
+00009820: 6374 0a0a 2020 2020 4073 7461 7469 636d  ct..    @staticm
+00009830: 6574 686f 640a 2020 2020 6465 6620 5f6d  ethod.    def _m
+00009840: 616b 655f 7361 6d70 6c65 5f70 6572 696f  ake_sample_perio
+00009850: 645f 6d6f 6e74 6828 726f 7729 3a0a 2020  d_month(row):.  
+00009860: 2020 2020 2020 7965 6172 203d 2072 6f77        year = row
+00009870: 2e79 6561 720a 2020 2020 2020 2020 6d6f  .year.        mo
+00009880: 6e74 6820 3d20 726f 772e 6d6f 6e74 680a  nth = row.month.
+00009890: 2020 2020 2020 2020 6966 2079 6561 7220          if year 
+000098a0: 3e20 3020 616e 6420 6d6f 6e74 6820 3e20  > 0 and month > 
+000098b0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+000098c0: 6574 7572 6e20 7064 2e50 6572 696f 6428  eturn pd.Period(
+000098d0: 6672 6571 3d22 4d22 2c20 7965 6172 3d79  freq="M", year=y
+000098e0: 6561 722c 206d 6f6e 7468 3d6d 6f6e 7468  ear, month=month
+000098f0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00009900: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00009910: 726e 2070 642e 4e61 540a 0a20 2020 2040  rn pd.NaT..    @
+00009920: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00009930: 2064 6566 205f 6d61 6b65 5f73 616d 706c   def _make_sampl
+00009940: 655f 7065 7269 6f64 5f71 7561 7274 6572  e_period_quarter
+00009950: 2872 6f77 293a 0a20 2020 2020 2020 2079  (row):.        y
+00009960: 6561 7220 3d20 726f 772e 7965 6172 0a20  ear = row.year. 
+00009970: 2020 2020 2020 206d 6f6e 7468 203d 2072         month = r
+00009980: 6f77 2e6d 6f6e 7468 0a20 2020 2020 2020  ow.month.       
+00009990: 2069 6620 7965 6172 203e 2030 2061 6e64   if year > 0 and
+000099a0: 206d 6f6e 7468 203e 2030 3a0a 2020 2020   month > 0:.    
+000099b0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+000099c0: 642e 5065 7269 6f64 2866 7265 713d 2251  d.Period(freq="Q
+000099d0: 222c 2079 6561 723d 7965 6172 2c20 6d6f  ", year=year, mo
+000099e0: 6e74 683d 6d6f 6e74 6829 0a20 2020 2020  nth=month).     
+000099f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00009a00: 2020 2020 2072 6574 7572 6e20 7064 2e4e       return pd.N
+00009a10: 6154 0a0a 2020 2020 4073 7461 7469 636d  aT..    @staticm
+00009a20: 6574 686f 640a 2020 2020 6465 6620 5f6d  ethod.    def _m
+00009a30: 616b 655f 7361 6d70 6c65 5f70 6572 696f  ake_sample_perio
+00009a40: 645f 7965 6172 2872 6f77 293a 0a20 2020  d_year(row):.   
+00009a50: 2020 2020 2079 6561 7220 3d20 726f 772e       year = row.
+00009a60: 7965 6172 0a20 2020 2020 2020 2069 6620  year.        if 
+00009a70: 7965 6172 203e 2030 3a0a 2020 2020 2020  year > 0:.      
+00009a80: 2020 2020 2020 7265 7475 726e 2070 642e        return pd.
+00009a90: 5065 7269 6f64 2866 7265 713d 2241 222c  Period(freq="A",
+00009aa0: 2079 6561 723d 7965 6172 290a 2020 2020   year=year).    
+00009ab0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00009ac0: 2020 2020 2020 7265 7475 726e 2070 642e        return pd.
+00009ad0: 4e61 540a 0a20 2020 2040 7374 6174 6963  NaT..    @static
+00009ae0: 6d65 7468 6f64 0a20 2020 2040 6e75 6d62  method.    @numb
+00009af0: 612e 6e6a 6974 0a20 2020 2064 6566 205f  a.njit.    def _
+00009b00: 636f 686f 7274 5f61 6c74 5f61 6c6c 656c  cohort_alt_allel
+00009b10: 655f 636f 756e 7473 5f6d 656c 745f 6b65  e_counts_melt_ke
+00009b20: 726e 656c 2867 742c 2069 6e64 6963 6573  rnel(gt, indices
+00009b30: 2c20 6d61 785f 616c 6c65 6c65 293a 0a20  , max_allele):. 
+00009b40: 2020 2020 2020 206e 5f76 6172 6961 6e74         n_variant
+00009b50: 7320 3d20 6774 2e73 6861 7065 5b30 5d0a  s = gt.shape[0].
+00009b60: 2020 2020 2020 2020 6e5f 696e 6469 6365          n_indice
+00009b70: 7320 3d20 696e 6469 6365 732e 7368 6170  s = indices.shap
+00009b80: 655b 305d 0a20 2020 2020 2020 2070 6c6f  e[0].        plo
+00009b90: 6964 7920 3d20 6774 2e73 6861 7065 5b32  idy = gt.shape[2
+00009ba0: 5d0a 0a20 2020 2020 2020 2061 635f 616c  ]..        ac_al
+00009bb0: 745f 6d65 6c74 203d 206e 702e 7a65 726f  t_melt = np.zero
+00009bc0: 7328 6e5f 7661 7269 616e 7473 202a 206d  s(n_variants * m
+00009bd0: 6178 5f61 6c6c 656c 652c 2064 7479 7065  ax_allele, dtype
+00009be0: 3d6e 702e 696e 7436 3429 0a20 2020 2020  =np.int64).     
+00009bf0: 2020 2061 6e20 3d20 6e70 2e7a 6572 6f73     an = np.zeros
+00009c00: 286e 5f76 6172 6961 6e74 732c 2064 7479  (n_variants, dty
+00009c10: 7065 3d6e 702e 696e 7436 3429 0a0a 2020  pe=np.int64)..  
+00009c20: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00009c30: 616e 6765 286e 5f76 6172 6961 6e74 7329  ange(n_variants)
+00009c40: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
+00009c50: 745f 695f 6f66 6673 6574 203d 2028 6920  t_i_offset = (i 
+00009c60: 2a20 6d61 785f 616c 6c65 6c65 2920 2d20  * max_allele) - 
+00009c70: 310a 2020 2020 2020 2020 2020 2020 666f  1.            fo
+00009c80: 7220 6a20 696e 2072 616e 6765 286e 5f69  r j in range(n_i
+00009c90: 6e64 6963 6573 293a 0a20 2020 2020 2020  ndices):.       
+00009ca0: 2020 2020 2020 2020 2069 7820 3d20 696e           ix = in
+00009cb0: 6469 6365 735b 6a5d 0a20 2020 2020 2020  dices[j].       
+00009cc0: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
+00009cd0: 6e20 7261 6e67 6528 706c 6f69 6479 293a  n range(ploidy):
+00009ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009cf0: 2020 2020 2061 6c6c 656c 6520 3d20 6774       allele = gt
+00009d00: 5b69 2c20 6978 2c20 6b5d 0a20 2020 2020  [i, ix, k].     
+00009d10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009d20: 6620 616c 6c65 6c65 203e 2030 3a0a 2020  f allele > 0:.  
+00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d40: 2020 2020 2020 6f75 745f 6920 3d20 6f75        out_i = ou
+00009d50: 745f 695f 6f66 6673 6574 202b 2061 6c6c  t_i_offset + all
+00009d60: 656c 650a 2020 2020 2020 2020 2020 2020  ele.            
+00009d70: 2020 2020 2020 2020 2020 2020 6163 5f61              ac_a
+00009d80: 6c74 5f6d 656c 745b 6f75 745f 695d 202b  lt_melt[out_i] +
+00009d90: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00009da0: 2020 2020 2020 2020 2020 2020 616e 5b69              an[i
+00009db0: 5d20 2b3d 2031 0a20 2020 2020 2020 2020  ] += 1.         
+00009dc0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00009dd0: 616c 6c65 6c65 203d 3d20 303a 0a20 2020  allele == 0:.   
+00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009df0: 2020 2020 2061 6e5b 695d 202b 3d20 310a       an[i] += 1.
+00009e00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00009e10: 6163 5f61 6c74 5f6d 656c 742c 2061 6e0a  ac_alt_melt, an.
+00009e20: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00009e30: 6f64 0a20 2020 2064 6566 205f 6d61 6b65  od.    def _make
+00009e40: 5f73 6e70 5f6c 6162 656c 2863 6f6e 7469  _snp_label(conti
+00009e50: 672c 2070 6f73 6974 696f 6e2c 2072 6566  g, position, ref
+00009e60: 5f61 6c6c 656c 652c 2061 6c74 5f61 6c6c  _allele, alt_all
+00009e70: 656c 6529 3a0a 2020 2020 2020 2020 7265  ele):.        re
+00009e80: 7475 726e 2066 227b 636f 6e74 6967 7d3a  turn f"{contig}:
+00009e90: 7b70 6f73 6974 696f 6e3a 2c7d 207b 7265  {position:,} {re
+00009ea0: 665f 616c 6c65 6c65 7d3e 7b61 6c74 5f61  f_allele}>{alt_a
+00009eb0: 6c6c 656c 657d 220a 0a20 2020 2040 7374  llele}"..    @st
+00009ec0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00009ed0: 6566 205f 6d61 6b65 5f73 6e70 5f6c 6162  ef _make_snp_lab
+00009ee0: 656c 5f65 6666 6563 7428 636f 6e74 6967  el_effect(contig
+00009ef0: 2c20 706f 7369 7469 6f6e 2c20 7265 665f  , position, ref_
+00009f00: 616c 6c65 6c65 2c20 616c 745f 616c 6c65  allele, alt_alle
+00009f10: 6c65 2c20 6161 5f63 6861 6e67 6529 3a0a  le, aa_change):.
+00009f20: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
+00009f30: 6622 7b63 6f6e 7469 677d 3a7b 706f 7369  f"{contig}:{posi
+00009f40: 7469 6f6e 3a2c 7d20 7b72 6566 5f61 6c6c  tion:,} {ref_all
+00009f50: 656c 657d 3e7b 616c 745f 616c 6c65 6c65  ele}>{alt_allele
+00009f60: 7d22 0a20 2020 2020 2020 2069 6620 6973  }".        if is
+00009f70: 696e 7374 616e 6365 2861 615f 6368 616e  instance(aa_chan
+00009f80: 6765 2c20 7374 7229 3a0a 2020 2020 2020  ge, str):.      
+00009f90: 2020 2020 2020 6c61 6265 6c20 2b3d 2066        label += f
+00009fa0: 2220 287b 6161 5f63 6861 6e67 657d 2922  " ({aa_change})"
+00009fb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00009fc0: 6c61 6265 6c0a 0a20 2020 2040 7374 6174  label..    @stat
+00009fd0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00009fe0: 205f 6d61 6b65 5f73 6e70 5f6c 6162 656c   _make_snp_label
+00009ff0: 5f61 6128 6161 5f63 6861 6e67 652c 2063  _aa(aa_change, c
+0000a000: 6f6e 7469 672c 2070 6f73 6974 696f 6e2c  ontig, position,
+0000a010: 2072 6566 5f61 6c6c 656c 652c 2061 6c74   ref_allele, alt
+0000a020: 5f61 6c6c 656c 6529 3a0a 2020 2020 2020  _allele):.      
+0000a030: 2020 6c61 6265 6c20 3d20 6622 7b61 615f    label = f"{aa_
+0000a040: 6368 616e 6765 7d20 287b 636f 6e74 6967  change} ({contig
+0000a050: 7d3a 7b70 6f73 6974 696f 6e3a 2c7d 207b  }:{position:,} {
+0000a060: 7265 665f 616c 6c65 6c65 7d3e 7b61 6c74  ref_allele}>{alt
+0000a070: 5f61 6c6c 656c 657d 2922 0a20 2020 2020  _allele})".     
+0000a080: 2020 2072 6574 7572 6e20 6c61 6265 6c0a     return label.
+0000a090: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+0000a0a0: 6f64 0a20 2020 2064 6566 205f 6d61 6b65  od.    def _make
+0000a0b0: 5f67 656e 655f 636e 765f 6c61 6265 6c28  _gene_cnv_label(
+0000a0c0: 6765 6e65 5f69 642c 2067 656e 655f 6e61  gene_id, gene_na
+0000a0d0: 6d65 2c20 636e 765f 7479 7065 293a 0a20  me, cnv_type):. 
+0000a0e0: 2020 2020 2020 206c 6162 656c 203d 2067         label = g
+0000a0f0: 656e 655f 6964 0a20 2020 2020 2020 2069  ene_id.        i
+0000a100: 6620 6973 696e 7374 616e 6365 2867 656e  f isinstance(gen
+0000a110: 655f 6e61 6d65 2c20 7374 7229 3a0a 2020  e_name, str):.  
+0000a120: 2020 2020 2020 2020 2020 6c61 6265 6c20            label 
+0000a130: 2b3d 2066 2220 287b 6765 6e65 5f6e 616d  += f" ({gene_nam
+0000a140: 657d 2922 0a20 2020 2020 2020 206c 6162  e})".        lab
+0000a150: 656c 202b 3d20 6622 207b 636e 765f 7479  el += f" {cnv_ty
+0000a160: 7065 7d22 0a20 2020 2020 2020 2072 6574  pe}".        ret
+0000a170: 7572 6e20 6c61 6265 6c0a 0a20 2020 2040  urn label..    @
+0000a180: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0000a190: 2064 6566 205f 6d61 705f 736e 705f 746f   def _map_snp_to
+0000a1a0: 5f61 615f 6368 616e 6765 5f66 7271 5f64  _aa_change_frq_d
+0000a1b0: 7328 6473 293a 0a20 2020 2020 2020 2023  s(ds):.        #
+0000a1c0: 206b 6565 7020 6f6e 6c79 2076 6172 6961   keep only varia
+0000a1d0: 626c 6573 2074 6861 7420 6d61 6b65 2073  bles that make s
+0000a1e0: 656e 7365 2066 6f72 2061 6d69 6e6f 2061  ense for amino a
+0000a1f0: 6369 6420 7375 6273 7469 7475 7469 6f6e  cid substitution
+0000a200: 730a 2020 2020 2020 2020 6b65 6570 5f76  s.        keep_v
+0000a210: 6172 7320 3d20 5b0a 2020 2020 2020 2020  ars = [.        
+0000a220: 2020 2020 2276 6172 6961 6e74 5f63 6f6e      "variant_con
+0000a230: 7469 6722 2c0a 2020 2020 2020 2020 2020  tig",.          
+0000a240: 2020 2276 6172 6961 6e74 5f70 6f73 6974    "variant_posit
+0000a250: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0000a260: 2020 2276 6172 6961 6e74 5f74 7261 6e73    "variant_trans
+0000a270: 6372 6970 7422 2c0a 2020 2020 2020 2020  cript",.        
+0000a280: 2020 2020 2276 6172 6961 6e74 5f65 6666      "variant_eff
+0000a290: 6563 7422 2c0a 2020 2020 2020 2020 2020  ect",.          
+0000a2a0: 2020 2276 6172 6961 6e74 5f69 6d70 6163    "variant_impac
+0000a2b0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+0000a2c0: 2276 6172 6961 6e74 5f61 615f 706f 7322  "variant_aa_pos"
+0000a2d0: 2c0a 2020 2020 2020 2020 2020 2020 2276  ,.            "v
+0000a2e0: 6172 6961 6e74 5f61 615f 6368 616e 6765  ariant_aa_change
+0000a2f0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+0000a300: 7661 7269 616e 745f 7265 665f 616c 6c65  variant_ref_alle
+0000a310: 6c65 222c 0a20 2020 2020 2020 2020 2020  le",.           
+0000a320: 2022 7661 7269 616e 745f 7265 665f 6161   "variant_ref_aa
+0000a330: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+0000a340: 7661 7269 616e 745f 616c 745f 6161 222c  variant_alt_aa",
+0000a350: 0a20 2020 2020 2020 2020 2020 2022 6576  .            "ev
+0000a360: 656e 745f 6e6f 6273 222c 0a20 2020 2020  ent_nobs",.     
+0000a370: 2020 205d 0a0a 2020 2020 2020 2020 6966     ]..        if
+0000a380: 2064 732e 6469 6d73 5b22 7661 7269 616e   ds.dims["varian
+0000a390: 7473 225d 203d 3d20 313a 0a20 2020 2020  ts"] == 1:.     
+0000a3a0: 2020 2020 2020 2023 206b 6565 7020 6576         # keep ev
+0000a3b0: 6572 7974 6869 6e67 2061 732d 6973 2c20  erything as-is, 
+0000a3c0: 6e6f 206e 6565 6420 666f 7220 6167 6772  no need for aggr
+0000a3d0: 6567 6174 696f 6e0a 2020 2020 2020 2020  egation.        
+0000a3e0: 2020 2020 6473 5f6f 7574 203d 2064 735b      ds_out = ds[
+0000a3f0: 6b65 6570 5f76 6172 7320 2b20 5b22 7661  keep_vars + ["va
+0000a400: 7269 616e 745f 616c 745f 616c 6c65 6c65  riant_alt_allele
+0000a410: 222c 2022 6576 656e 745f 636f 756e 7422  ", "event_count"
+0000a420: 5d5d 0a0a 2020 2020 2020 2020 656c 7365  ]]..        else
+0000a430: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000a440: 7461 6b65 2074 6865 2066 6972 7374 2076  take the first v
+0000a450: 616c 7565 2066 726f 6d20 616c 6c20 7661  alue from all va
+0000a460: 7269 616e 7473 2076 6172 6961 626c 6573  riants variables
+0000a470: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+0000a480: 6f75 7420 3d20 6473 5b6b 6565 705f 7661  out = ds[keep_va
+0000a490: 7273 5d2e 6973 656c 2876 6172 6961 6e74  rs].isel(variant
+0000a4a0: 733d 5b30 5d29 0a0a 2020 2020 2020 2020  s=[0])..        
+0000a4b0: 2020 2020 2320 7375 6d20 6576 656e 7420      # sum event 
+0000a4c0: 636f 756e 7420 6f76 6572 2076 6172 6961  count over varia
+0000a4d0: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
+0000a4e0: 636f 756e 7420 3d20 6473 5b22 6576 656e  count = ds["even
+0000a4f0: 745f 636f 756e 7422 5d2e 7661 6c75 6573  t_count"].values
+0000a500: 2e73 756d 2861 7869 733d 302c 206b 6565  .sum(axis=0, kee
+0000a510: 7064 696d 733d 5472 7565 290a 2020 2020  pdims=True).    
+0000a520: 2020 2020 2020 2020 6473 5f6f 7574 5b22          ds_out["
+0000a530: 6576 656e 745f 636f 756e 7422 5d20 3d20  event_count"] = 
+0000a540: 2822 7661 7269 616e 7473 222c 2022 636f  ("variants", "co
+0000a550: 686f 7274 7322 292c 2063 6f75 6e74 0a0a  horts"), count..
+0000a560: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+0000a570: 6c6c 6170 7365 2061 6c74 2061 6c6c 656c  llapse alt allel
+0000a580: 650a 2020 2020 2020 2020 2020 2020 616c  e.            al
+0000a590: 745f 616c 6c65 6c65 203d 2022 7b22 202b  t_allele = "{" +
+0000a5a0: 2022 2c22 2e6a 6f69 6e28 6473 5b22 7661   ",".join(ds["va
+0000a5b0: 7269 616e 745f 616c 745f 616c 6c65 6c65  riant_alt_allele
+0000a5c0: 225d 2e76 616c 7565 7329 202b 2022 7d22  "].values) + "}"
+0000a5d0: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+0000a5e0: 6f75 745b 2276 6172 6961 6e74 5f61 6c74  out["variant_alt
+0000a5f0: 5f61 6c6c 656c 6522 5d20 3d20 2276 6172  _allele"] = "var
+0000a600: 6961 6e74 7322 2c20 6e70 2e61 7272 6179  iants", np.array
+0000a610: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000a620: 2020 5b61 6c74 5f61 6c6c 656c 655d 2c20    [alt_allele], 
+0000a630: 6474 7970 653d 6f62 6a65 6374 0a20 2020  dtype=object.   
+0000a640: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000a650: 2020 2020 7265 7475 726e 2064 735f 6f75      return ds_ou
+0000a660: 740a 0a20 2020 2040 7374 6174 6963 6d65  t..    @staticme
+0000a670: 7468 6f64 0a20 2020 2064 6566 205f 6164  thod.    def _ad
+0000a680: 645f 6672 6571 7565 6e63 795f 6369 2864  d_frequency_ci(d
+0000a690: 732c 2063 695f 6d65 7468 6f64 293a 0a20  s, ci_method):. 
+0000a6a0: 2020 2020 2020 2066 726f 6d20 7374 6174         from stat
+0000a6b0: 736d 6f64 656c 732e 7374 6174 732e 7072  smodels.stats.pr
+0000a6c0: 6f70 6f72 7469 6f6e 2069 6d70 6f72 7420  oportion import 
+0000a6d0: 7072 6f70 6f72 7469 6f6e 5f63 6f6e 6669  proportion_confi
+0000a6e0: 6e74 0a0a 2020 2020 2020 2020 6966 2063  nt..        if c
+0000a6f0: 695f 6d65 7468 6f64 2069 7320 6e6f 7420  i_method is not 
+0000a700: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000a710: 2020 636f 756e 7420 3d20 6473 5b22 6576    count = ds["ev
+0000a720: 656e 745f 636f 756e 7422 5d2e 7661 6c75  ent_count"].valu
+0000a730: 6573 0a20 2020 2020 2020 2020 2020 206e  es.            n
+0000a740: 6f62 7320 3d20 6473 5b22 6576 656e 745f  obs = ds["event_
+0000a750: 6e6f 6273 225d 2e76 616c 7565 730a 2020  nobs"].values.  
+0000a760: 2020 2020 2020 2020 2020 7769 7468 206e            with n
+0000a770: 702e 6572 7273 7461 7465 2864 6976 6964  p.errstate(divid
+0000a780: 653d 2269 676e 6f72 6522 2c20 696e 7661  e="ignore", inva
+0000a790: 6c69 643d 2269 676e 6f72 6522 293a 0a20  lid="ignore"):. 
+0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a7b0: 7271 5f63 695f 6c6f 772c 2066 7271 5f63  rq_ci_low, frq_c
+0000a7c0: 695f 7570 7020 3d20 7072 6f70 6f72 7469  i_upp = proporti
+0000a7d0: 6f6e 5f63 6f6e 6669 6e74 280a 2020 2020  on_confint(.    
+0000a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7f0: 636f 756e 743d 636f 756e 742c 206e 6f62  count=count, nob
+0000a800: 733d 6e6f 6273 2c20 6d65 7468 6f64 3d63  s=nobs, method=c
+0000a810: 695f 6d65 7468 6f64 0a20 2020 2020 2020  i_method.       
+0000a820: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000a830: 2020 2020 2020 2064 735b 2265 7665 6e74         ds["event
+0000a840: 5f66 7265 7175 656e 6379 5f63 695f 6c6f  _frequency_ci_lo
+0000a850: 7722 5d20 3d20 2822 7661 7269 616e 7473  w"] = ("variants
+0000a860: 222c 2022 636f 686f 7274 7322 292c 2066  ", "cohorts"), f
+0000a870: 7271 5f63 695f 6c6f 770a 2020 2020 2020  rq_ci_low.      
+0000a880: 2020 2020 2020 6473 5b22 6576 656e 745f        ds["event_
+0000a890: 6672 6571 7565 6e63 795f 6369 5f75 7070  frequency_ci_upp
+0000a8a0: 225d 203d 2028 2276 6172 6961 6e74 7322  "] = ("variants"
+0000a8b0: 2c20 2263 6f68 6f72 7473 2229 2c20 6672  , "cohorts"), fr
+0000a8c0: 715f 6369 5f75 7070 0a0a 2020 2020 4073  q_ci_upp..    @s
+0000a8d0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+0000a8e0: 6465 6620 5f62 7569 6c64 5f63 6f68 6f72  def _build_cohor
+0000a8f0: 7473 5f66 726f 6d5f 7361 6d70 6c65 5f67  ts_from_sample_g
+0000a900: 726f 7570 696e 6728 6772 6f75 705f 7361  rouping(group_sa
+0000a910: 6d70 6c65 735f 6279 5f63 6f68 6f72 742c  mples_by_cohort,
+0000a920: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+0000a930: 293a 0a20 2020 2020 2020 2023 2062 7569  ):.        # bui
+0000a940: 6c64 2063 6f68 6f72 7473 2064 6174 6166  ld cohorts dataf
+0000a950: 7261 6d65 0a20 2020 2020 2020 2064 665f  rame.        df_
+0000a960: 636f 686f 7274 7320 3d20 6772 6f75 705f  cohorts = group_
+0000a970: 7361 6d70 6c65 735f 6279 5f63 6f68 6f72  samples_by_cohor
+0000a980: 742e 6167 6728 0a20 2020 2020 2020 2020  t.agg(.         
+0000a990: 2020 2073 697a 653d 2822 7361 6d70 6c65     size=("sample
+0000a9a0: 5f69 6422 2c20 6c65 6e29 2c0a 2020 2020  _id", len),.    
+0000a9b0: 2020 2020 2020 2020 6c61 745f 6d65 616e          lat_mean
+0000a9c0: 3d28 226c 6174 6974 7564 6522 2c20 226d  =("latitude", "m
+0000a9d0: 6561 6e22 292c 0a20 2020 2020 2020 2020  ean"),.         
+0000a9e0: 2020 206c 6174 5f6d 6178 3d28 226c 6174     lat_max=("lat
+0000a9f0: 6974 7564 6522 2c20 226d 6561 6e22 292c  itude", "mean"),
+0000aa00: 0a20 2020 2020 2020 2020 2020 206c 6174  .            lat
+0000aa10: 5f6d 696e 3d28 226c 6174 6974 7564 6522  _min=("latitude"
+0000aa20: 2c20 226d 6561 6e22 292c 0a20 2020 2020  , "mean"),.     
+0000aa30: 2020 2020 2020 206c 6f6e 5f6d 6561 6e3d         lon_mean=
+0000aa40: 2822 6c6f 6e67 6974 7564 6522 2c20 226d  ("longitude", "m
+0000aa50: 6561 6e22 292c 0a20 2020 2020 2020 2020  ean"),.         
+0000aa60: 2020 206c 6f6e 5f6d 6178 3d28 226c 6f6e     lon_max=("lon
+0000aa70: 6769 7475 6465 222c 2022 6d65 616e 2229  gitude", "mean")
+0000aa80: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+0000aa90: 6e5f 6d69 6e3d 2822 6c6f 6e67 6974 7564  n_min=("longitud
+0000aaa0: 6522 2c20 226d 6561 6e22 292c 0a20 2020  e", "mean"),.   
+0000aab0: 2020 2020 2029 0a20 2020 2020 2020 2023       ).        #
+0000aac0: 2072 6573 6574 2069 6e64 6578 2073 6f20   reset index so 
+0000aad0: 7468 6174 2074 6865 2069 6e64 6578 2066  that the index f
+0000aae0: 6965 6c64 7320 6172 6520 696e 636c 7564  ields are includ
+0000aaf0: 6564 2061 7320 636f 6c75 6d6e 730a 2020  ed as columns.  
+0000ab00: 2020 2020 2020 6466 5f63 6f68 6f72 7473        df_cohorts
+0000ab10: 203d 2064 665f 636f 686f 7274 732e 7265   = df_cohorts.re
+0000ab20: 7365 745f 696e 6465 7828 290a 0a20 2020  set_index()..   
+0000ab30: 2020 2020 2023 2061 6464 2063 6f68 6f72       # add cohor
+0000ab40: 7420 6865 6c70 6572 2076 6172 6961 626c  t helper variabl
+0000ab50: 6573 0a20 2020 2020 2020 2063 6f68 6f72  es.        cohor
+0000ab60: 745f 7065 7269 6f64 5f73 7461 7274 203d  t_period_start =
+0000ab70: 2064 665f 636f 686f 7274 735b 2270 6572   df_cohorts["per
+0000ab80: 696f 6422 5d2e 6170 706c 7928 6c61 6d62  iod"].apply(lamb
+0000ab90: 6461 2076 3a20 762e 7374 6172 745f 7469  da v: v.start_ti
+0000aba0: 6d65 290a 2020 2020 2020 2020 636f 686f  me).        coho
+0000abb0: 7274 5f70 6572 696f 645f 656e 6420 3d20  rt_period_end = 
+0000abc0: 6466 5f63 6f68 6f72 7473 5b22 7065 7269  df_cohorts["peri
+0000abd0: 6f64 225d 2e61 7070 6c79 286c 616d 6264  od"].apply(lambd
+0000abe0: 6120 763a 2076 2e65 6e64 5f74 696d 6529  a v: v.end_time)
+0000abf0: 0a20 2020 2020 2020 2064 665f 636f 686f  .        df_coho
+0000ac00: 7274 735b 2270 6572 696f 645f 7374 6172  rts["period_star
+0000ac10: 7422 5d20 3d20 636f 686f 7274 5f70 6572  t"] = cohort_per
+0000ac20: 696f 645f 7374 6172 740a 2020 2020 2020  iod_start.      
+0000ac30: 2020 6466 5f63 6f68 6f72 7473 5b22 7065    df_cohorts["pe
+0000ac40: 7269 6f64 5f65 6e64 225d 203d 2063 6f68  riod_end"] = coh
+0000ac50: 6f72 745f 7065 7269 6f64 5f65 6e64 0a20  ort_period_end. 
+0000ac60: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000ac70: 6120 6c61 6265 6c20 7468 6174 2069 7320  a label that is 
+0000ac80: 7369 6d69 6c61 7220 746f 2074 6865 2063  similar to the c
+0000ac90: 6f68 6f72 7420 6d65 7461 6461 7461 2c0a  ohort metadata,.
+0000aca0: 2020 2020 2020 2020 2320 616c 7468 6f75          # althou
+0000acb0: 6768 2074 6869 7320 776f 6e27 7420 6265  gh this won't be
+0000acc0: 2070 6572 6665 6374 0a20 2020 2020 2020   perfect.       
+0000acd0: 2064 665f 636f 686f 7274 735b 226c 6162   df_cohorts["lab
+0000ace0: 656c 225d 203d 2064 665f 636f 686f 7274  el"] = df_cohort
+0000acf0: 732e 6170 706c 7928 0a20 2020 2020 2020  s.apply(.       
+0000ad00: 2020 2020 206c 616d 6264 6120 763a 2066       lambda v: f
+0000ad10: 227b 762e 6172 6561 7d5f 7b76 2e74 6178  "{v.area}_{v.tax
+0000ad20: 6f6e 5b3a 345d 7d5f 7b76 2e70 6572 696f  on[:4]}_{v.perio
+0000ad30: 647d 222c 2061 7869 733d 2263 6f6c 756d  d}", axis="colum
+0000ad40: 6e73 220a 2020 2020 2020 2020 290a 0a20  ns".        ).. 
+0000ad50: 2020 2020 2020 2023 2061 7070 6c79 206d         # apply m
+0000ad60: 696e 696d 756d 2063 6f68 6f72 7420 7369  inimum cohort si
+0000ad70: 7a65 0a20 2020 2020 2020 2064 665f 636f  ze.        df_co
+0000ad80: 686f 7274 7320 3d20 6466 5f63 6f68 6f72  horts = df_cohor
+0000ad90: 7473 2e71 7565 7279 2866 2273 697a 6520  ts.query(f"size 
+0000ada0: 3e3d 207b 6d69 6e5f 636f 686f 7274 5f73  >= {min_cohort_s
+0000adb0: 697a 657d 2229 2e72 6573 6574 5f69 6e64  ize}").reset_ind
+0000adc0: 6578 280a 2020 2020 2020 2020 2020 2020  ex(.            
+0000add0: 6472 6f70 3d54 7275 650a 2020 2020 2020  drop=True.      
+0000ade0: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
+0000adf0: 7572 6e20 6466 5f63 6f68 6f72 7473 0a0a  urn df_cohorts..
+0000ae00: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+0000ae10: 640a 2020 2020 6465 6620 5f63 6865 636b  d.    def _check
+0000ae20: 5f70 6172 616d 5f6d 696e 5f63 6f68 6f72  _param_min_cohor
+0000ae30: 745f 7369 7a65 286d 696e 5f63 6f68 6f72  t_size(min_cohor
+0000ae40: 745f 7369 7a65 293a 0a20 2020 2020 2020  t_size):.       
+0000ae50: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0000ae60: 6365 286d 696e 5f63 6f68 6f72 745f 7369  ce(min_cohort_si
+0000ae70: 7a65 2c20 696e 7429 3a0a 2020 2020 2020  ze, int):.      
+0000ae80: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+0000ae90: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000aea0: 2020 2020 2020 2066 2254 7970 6520 6f66         f"Type of
+0000aeb0: 2070 6172 616d 6574 6572 206d 696e 5f63   parameter min_c
+0000aec0: 6f68 6f72 745f 7369 7a65 206d 7573 7420  ohort_size must 
+0000aed0: 6265 2069 6e74 3b20 666f 756e 6420 7b74  be int; found {t
+0000aee0: 7970 6528 6d69 6e5f 636f 686f 7274 5f73  ype(min_cohort_s
+0000aef0: 697a 6529 7d2e 220a 2020 2020 2020 2020  ize)}.".        
+0000af00: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+0000af10: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+0000af20: 203c 2031 3a0a 2020 2020 2020 2020 2020   < 1:.          
+0000af30: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000af40: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000af50: 2020 2020 6622 5661 6c75 6520 6f66 2070      f"Value of p
+0000af60: 6172 616d 6574 6572 206d 696e 5f63 6f68  arameter min_coh
+0000af70: 6f72 745f 7369 7a65 206d 7573 7420 6265  ort_size must be
+0000af80: 2061 7420 6c65 6173 7420 313b 2066 6f75   at least 1; fou
+0000af90: 6e64 207b 6d69 6e5f 636f 686f 7274 5f73  nd {min_cohort_s
+0000afa0: 697a 657d 2e22 0a20 2020 2020 2020 2020  ize}.".         
+0000afb0: 2020 2029 0a0a 2020 2020 4073 7461 7469     )..    @stati
+0000afc0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+0000afd0: 5f70 616e 6461 735f 6170 706c 7928 662c  _pandas_apply(f,
+0000afe0: 2064 662c 2063 6f6c 756d 6e73 293a 0a20   df, columns):. 
+0000aff0: 2020 2020 2020 2022 2222 4f70 7469 6d69         """Optimi
+0000b000: 7365 6420 616c 7465 726e 6174 6976 6520  sed alternative 
+0000b010: 746f 2070 616e 6461 7320 6170 706c 792e  to pandas apply.
+0000b020: 2222 220a 2020 2020 2020 2020 6466 203d  """.        df =
+0000b030: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
+0000b040: 6472 6f70 3d54 7275 6529 0a20 2020 2020  drop=True).     
+0000b050: 2020 2069 7465 7261 746f 7220 3d20 7a69     iterator = zi
+0000b060: 7028 2a5b 6466 5b63 5d2e 7661 6c75 6573  p(*[df[c].values
+0000b070: 2066 6f72 2063 2069 6e20 636f 6c75 6d6e   for c in column
+0000b080: 735d 290a 2020 2020 2020 2020 7265 7420  s]).        ret 
+0000b090: 3d20 7064 2e53 6572 6965 7328 2866 282a  = pd.Series((f(*
+0000b0a0: 7661 6c73 2920 666f 7220 7661 6c73 2069  vals) for vals i
+0000b0b0: 6e20 6974 6572 6174 6f72 2929 0a20 2020  n iterator)).   
+0000b0c0: 2020 2020 2072 6574 7572 6e20 7265 740a       return ret.
+0000b0d0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+0000b0e0: 6f64 0a20 2020 2064 6566 205f 726f 685f  od.    def _roh_
+0000b0f0: 686d 6d5f 7072 6564 6963 7428 0a20 2020  hmm_predict(.   
+0000b100: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
+0000b110: 7769 6e64 6f77 732c 0a20 2020 2020 2020  windows,.       
+0000b120: 2063 6f75 6e74 732c 0a20 2020 2020 2020   counts,.       
+0000b130: 2070 6865 745f 726f 682c 0a20 2020 2020   phet_roh,.     
+0000b140: 2020 2070 6865 745f 6e6f 6e72 6f68 2c0a     phet_nonroh,.
+0000b150: 2020 2020 2020 2020 7472 616e 7369 7469          transiti
+0000b160: 6f6e 2c0a 2020 2020 2020 2020 7769 6e64  on,.        wind
+0000b170: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
+0000b180: 2073 616d 706c 655f 6964 2c0a 2020 2020   sample_id,.    
+0000b190: 2020 2020 636f 6e74 6967 2c0a 2020 2020      contig,.    
+0000b1a0: 293a 0a20 2020 2020 2020 2023 2063 6f6e  ):.        # con
+0000b1b0: 6469 7469 6f6e 616c 2069 6d70 6f72 742c  ditional import,
+0000b1c0: 2070 6f6d 6567 7261 6e61 7465 2074 616b   pomegranate tak
+0000b1d0: 6573 2061 206c 6f6e 6720 7469 6d65 2074  es a long time t
+0000b1e0: 6f20 696e 7374 616c 6c20 6f6e 0a20 2020  o install on.   
+0000b1f0: 2020 2020 2023 206c 696e 7578 2064 7565       # linux due
+0000b200: 2074 6f20 6c61 636b 206f 6620 7072 6562   to lack of preb
+0000b210: 7569 6c74 2077 6865 656c 7320 6f6e 2050  uilt wheels on P
+0000b220: 7950 490a 2020 2020 2020 2020 6672 6f6d  yPI.        from
+0000b230: 2061 6c6c 656c 2e73 7461 7473 2e6d 6973   allel.stats.mis
+0000b240: 6320 696d 706f 7274 2074 6162 756c 6174  c import tabulat
+0000b250: 655f 7374 6174 655f 626c 6f63 6b73 0a0a  e_state_blocks..
+0000b260: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
+0000b270: 6d70 6c65 6d65 6e74 6174 696f 6e20 6973  mplementation is
+0000b280: 2062 6173 6564 206f 6e20 7363 696b 6974   based on scikit
+0000b290: 2d61 6c6c 656c 2c20 6275 7420 6d6f 6469  -allel, but modi
+0000b2a0: 6669 6564 2074 6f20 7573 650a 2020 2020  fied to use.    
+0000b2b0: 2020 2020 2320 6d6f 7669 6e67 2077 696e      # moving win
+0000b2c0: 646f 7720 636f 6d70 7574 6174 696f 6e20  dow computation 
+0000b2d0: 6f66 2068 6574 2063 6f75 6e74 730a 2020  of het counts.  
+0000b2e0: 2020 2020 2020 6672 6f6d 2061 6c6c 656c        from allel
+0000b2f0: 2e73 7461 7473 2e72 6f68 2069 6d70 6f72  .stats.roh impor
+0000b300: 7420 5f68 6d6d 5f64 6572 6976 655f 7472  t _hmm_derive_tr
+0000b310: 616e 7369 7469 6f6e 5f6d 6174 7269 780a  ansition_matrix.
+0000b320: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
+0000b330: 7065 6374 696f 6e20 5079 556e 7265 736f  pection PyUnreso
+0000b340: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
+0000b350: 2020 2020 2020 2066 726f 6d20 706f 6d65         from pome
+0000b360: 6772 616e 6174 6520 696d 706f 7274 2028  granate import (
+0000b370: 2020 2320 7079 7269 6768 743a 2069 676e    # pyright: ign
+0000b380: 6f72 650a 2020 2020 2020 2020 2020 2020  ore.            
+0000b390: 4869 6464 656e 4d61 726b 6f76 4d6f 6465  HiddenMarkovMode
+0000b3a0: 6c2c 0a20 2020 2020 2020 2020 2020 2050  l,.            P
+0000b3b0: 6f69 7373 6f6e 4469 7374 7269 6275 7469  oissonDistributi
+0000b3c0: 6f6e 2c0a 2020 2020 2020 2020 290a 0a20  on,.        ).. 
+0000b3d0: 2020 2020 2020 2023 2068 6574 2070 726f         # het pro
+0000b3e0: 6261 6269 6c69 7469 6573 0a20 2020 2020  babilities.     
+0000b3f0: 2020 2068 6574 5f70 7820 3d20 6e70 2e63     het_px = np.c
+0000b400: 6f6e 6361 7465 6e61 7465 285b 2870 6865  oncatenate([(phe
+0000b410: 745f 726f 682c 292c 2070 6865 745f 6e6f  t_roh,), phet_no
+0000b420: 6e72 6f68 5d29 0a0a 2020 2020 2020 2020  nroh])..        
+0000b430: 2320 7374 6172 7420 7072 6f62 6162 696c  # start probabil
+0000b440: 6974 6965 7320 2861 6c6c 2065 7175 616c  ities (all equal
+0000b450: 290a 2020 2020 2020 2020 7374 6172 745f  ).        start_
+0000b460: 7072 6f62 203d 206e 702e 7265 7065 6174  prob = np.repeat
+0000b470: 2831 202f 2068 6574 5f70 782e 7369 7a65  (1 / het_px.size
+0000b480: 2c20 6865 745f 7078 2e73 697a 6529 0a0a  , het_px.size)..
+0000b490: 2020 2020 2020 2020 2320 7472 616e 7369          # transi
+0000b4a0: 7469 6f6e 2062 6574 7765 656e 2075 6e64  tion between und
+0000b4b0: 6572 6c79 696e 6720 7374 6174 6573 0a20  erlying states. 
+0000b4c0: 2020 2020 2020 2074 7261 6e73 6974 696f         transitio
+0000b4d0: 6e5f 6d78 203d 205f 686d 6d5f 6465 7269  n_mx = _hmm_deri
+0000b4e0: 7665 5f74 7261 6e73 6974 696f 6e5f 6d61  ve_transition_ma
+0000b4f0: 7472 6978 2874 7261 6e73 6974 696f 6e2c  trix(transition,
+0000b500: 2068 6574 5f70 782e 7369 7a65 290a 0a20   het_px.size).. 
+0000b510: 2020 2020 2020 2023 2065 6d69 7373 696f         # emissio
+0000b520: 6e20 7072 6f62 6162 696c 6974 7920 6469  n probability di
+0000b530: 7374 7269 6275 7469 6f6e 0a20 2020 2020  stribution.     
+0000b540: 2020 2064 6973 7473 203d 205b 506f 6973     dists = [Pois
+0000b550: 736f 6e44 6973 7472 6962 7574 696f 6e28  sonDistribution(
+0000b560: 7820 2a20 7769 6e64 6f77 5f73 697a 6529  x * window_size)
+0000b570: 2066 6f72 2078 2069 6e20 6865 745f 7078   for x in het_px
+0000b580: 5d0a 0a20 2020 2020 2020 2023 2073 6574  ]..        # set
+0000b590: 2075 7020 6d6f 6465 6c0a 2020 2020 2020   up model.      
+0000b5a0: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
+0000b5b0: 2050 7941 7267 756d 656e 744c 6973 740a   PyArgumentList.
+0000b5c0: 2020 2020 2020 2020 6d6f 6465 6c20 3d20          model = 
+0000b5d0: 4869 6464 656e 4d61 726b 6f76 4d6f 6465  HiddenMarkovMode
+0000b5e0: 6c2e 6672 6f6d 5f6d 6174 7269 7828 0a20  l.from_matrix(. 
+0000b5f0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+0000b600: 6974 696f 6e5f 7072 6f62 6162 696c 6974  ition_probabilit
+0000b610: 6965 733d 7472 616e 7369 7469 6f6e 5f6d  ies=transition_m
+0000b620: 782c 0a20 2020 2020 2020 2020 2020 2064  x,.            d
+0000b630: 6973 7472 6962 7574 696f 6e73 3d64 6973  istributions=dis
+0000b640: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+0000b650: 7374 6172 7473 3d73 7461 7274 5f70 726f  starts=start_pro
+0000b660: 622c 0a20 2020 2020 2020 2029 0a0a 2020  b,.        )..  
+0000b670: 2020 2020 2020 2320 7072 6564 6963 7420        # predict 
+0000b680: 6869 6464 656e 2073 7461 7465 730a 2020  hidden states.  
+0000b690: 2020 2020 2020 7072 6564 6963 7469 6f6e        prediction
+0000b6a0: 203d 206e 702e 6172 7261 7928 6d6f 6465   = np.array(mode
+0000b6b0: 6c2e 7072 6564 6963 7428 636f 756e 7473  l.predict(counts
+0000b6c0: 5b3a 2c20 4e6f 6e65 5d29 290a 0a20 2020  [:, None]))..   
+0000b6d0: 2020 2020 2023 2074 6162 756c 6174 6520       # tabulate 
+0000b6e0: 7275 6e73 206f 6620 686f 6d6f 7a79 676f  runs of homozygo
+0000b6f0: 7369 7479 2028 7374 6174 6520 3029 0a20  sity (state 0). 
+0000b700: 2020 2020 2020 2023 206e 6f69 6e73 7065         # noinspe
+0000b710: 6374 696f 6e20 5079 5479 7065 4368 6563  ction PyTypeChec
+0000b720: 6b65 720a 2020 2020 2020 2020 6466 5f62  ker.        df_b
+0000b730: 6c6f 636b 7320 3d20 7461 6275 6c61 7465  locks = tabulate
+0000b740: 5f73 7461 7465 5f62 6c6f 636b 7328 7072  _state_blocks(pr
+0000b750: 6564 6963 7469 6f6e 2c20 7374 6174 6573  ediction, states
+0000b760: 3d6c 6973 7428 7261 6e67 6528 6c65 6e28  =list(range(len(
+0000b770: 6865 745f 7078 2929 2929 0a20 2020 2020  het_px)))).     
+0000b780: 2020 2064 665f 726f 6820 3d20 6466 5f62     df_roh = df_b
+0000b790: 6c6f 636b 735b 2864 665f 626c 6f63 6b73  locks[(df_blocks
+0000b7a0: 5b22 7374 6174 6522 5d20 3d3d 2030 295d  ["state"] == 0)]
+0000b7b0: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
+0000b7c0: 703d 5472 7565 290a 0a20 2020 2020 2020  p=True)..       
+0000b7d0: 2023 2061 6461 7074 2074 6865 2064 6174   # adapt the dat
+0000b7e0: 6166 7261 6d65 2066 6f72 2052 4f48 0a20  aframe for ROH. 
+0000b7f0: 2020 2020 2020 2064 665f 726f 685b 2273         df_roh["s
+0000b800: 616d 706c 655f 6964 225d 203d 2073 616d  ample_id"] = sam
+0000b810: 706c 655f 6964 0a20 2020 2020 2020 2064  ple_id.        d
+0000b820: 665f 726f 685b 2263 6f6e 7469 6722 5d20  f_roh["contig"] 
+0000b830: 3d20 636f 6e74 6967 0a20 2020 2020 2020  = contig.       
+0000b840: 2064 665f 726f 685b 2272 6f68 5f73 7461   df_roh["roh_sta
+0000b850: 7274 225d 203d 2064 665f 726f 685b 2273  rt"] = df_roh["s
+0000b860: 7461 7274 5f72 6964 7822 5d2e 6170 706c  tart_ridx"].appl
+0000b870: 7928 6c61 6d62 6461 2079 3a20 7769 6e64  y(lambda y: wind
+0000b880: 6f77 735b 792c 2030 5d29 0a20 2020 2020  ows[y, 0]).     
+0000b890: 2020 2064 665f 726f 685b 2272 6f68 5f73     df_roh["roh_s
+0000b8a0: 746f 7022 5d20 3d20 6466 5f72 6f68 5b22  top"] = df_roh["
+0000b8b0: 7374 6f70 5f6c 6964 7822 5d2e 6170 706c  stop_lidx"].appl
+0000b8c0: 7928 6c61 6d62 6461 2079 3a20 7769 6e64  y(lambda y: wind
+0000b8d0: 6f77 735b 792c 2031 5d29 0a20 2020 2020  ows[y, 1]).     
+0000b8e0: 2020 2064 665f 726f 685b 2272 6f68 5f6c     df_roh["roh_l
+0000b8f0: 656e 6774 6822 5d20 3d20 6466 5f72 6f68  ength"] = df_roh
+0000b900: 5b22 726f 685f 7374 6f70 225d 202d 2064  ["roh_stop"] - d
+0000b910: 665f 726f 685b 2272 6f68 5f73 7461 7274  f_roh["roh_start
+0000b920: 225d 0a20 2020 2020 2020 2064 665f 726f  "].        df_ro
+0000b930: 682e 7265 6e61 6d65 2863 6f6c 756d 6e73  h.rename(columns
+0000b940: 3d7b 2269 735f 6d61 7267 696e 616c 223a  ={"is_marginal":
+0000b950: 2022 726f 685f 6973 5f6d 6172 6769 6e61   "roh_is_margina
+0000b960: 6c22 7d2c 2069 6e70 6c61 6365 3d54 7275  l"}, inplace=Tru
+0000b970: 6529 0a0a 2020 2020 2020 2020 7265 7475  e)..        retu
+0000b980: 726e 2064 665f 726f 685b 0a20 2020 2020  rn df_roh[.     
+0000b990: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+0000b9a0: 2020 2020 2020 2020 2022 7361 6d70 6c65           "sample
+0000b9b0: 5f69 6422 2c0a 2020 2020 2020 2020 2020  _id",.          
+0000b9c0: 2020 2020 2020 2263 6f6e 7469 6722 2c0a        "contig",.
+0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9e0: 2272 6f68 5f73 7461 7274 222c 0a20 2020  "roh_start",.   
+0000b9f0: 2020 2020 2020 2020 2020 2020 2022 726f               "ro
+0000ba00: 685f 7374 6f70 222c 0a20 2020 2020 2020  h_stop",.       
+0000ba10: 2020 2020 2020 2020 2022 726f 685f 6c65           "roh_le
+0000ba20: 6e67 7468 222c 0a20 2020 2020 2020 2020  ngth",.         
+0000ba30: 2020 2020 2020 2022 726f 685f 6973 5f6d         "roh_is_m
+0000ba40: 6172 6769 6e61 6c22 2c0a 2020 2020 2020  arginal",.      
+0000ba50: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+0000ba60: 5d0a 0a20 2020 2023 2053 7461 7274 206f  ]..    # Start o
+0000ba70: 6620 756e 6465 636f 7261 7465 6420 6675  f undecorated fu
+0000ba80: 6e63 7469 6f6e 730a 0a20 2020 2040 646f  nctions..    @do
+0000ba90: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
+0000baa0: 7279 3d22 4f70 656e 2073 6974 6520 6669  ry="Open site fi
+0000bab0: 6c74 6572 7320 7a61 7272 2e22 2c0a 2020  lters zarr.",.  
+0000bac0: 2020 2020 2020 7265 7475 726e 733d 225a        returns="Z
+0000bad0: 6172 7220 6869 6572 6172 6368 792e 222c  arr hierarchy.",
+0000bae0: 0a20 2020 2029 0a20 2020 2064 6566 206f  .    ).    def o
+0000baf0: 7065 6e5f 7369 7465 5f66 696c 7465 7273  pen_site_filters
+0000bb00: 2873 656c 662c 206d 6173 6b3a 2062 6173  (self, mask: bas
+0000bb10: 655f 7061 7261 6d73 2e73 6974 655f 6d61  e_params.site_ma
+0000bb20: 736b 2920 2d3e 207a 6172 722e 6869 6572  sk) -> zarr.hier
+0000bb30: 6172 6368 792e 4772 6f75 703a 0a20 2020  archy.Group:.   
+0000bb40: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000bb50: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000bb60: 662e 5f63 6163 6865 5f73 6974 655f 6669  f._cache_site_fi
+0000bb70: 6c74 6572 735b 6d61 736b 5d0a 2020 2020  lters[mask].    
+0000bb80: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0000bb90: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0000bba0: 2070 6174 6820 3d20 6622 7b73 656c 662e   path = f"{self.
+0000bbb0: 5f62 6173 655f 7061 7468 7d2f 7b73 656c  _base_path}/{sel
+0000bbc0: 662e 5f6d 616a 6f72 5f76 6572 7369 6f6e  f._major_version
+0000bbd0: 5f70 6174 687d 2f73 6974 655f 6669 6c74  _path}/site_filt
+0000bbe0: 6572 732f 7b73 656c 662e 5f73 6974 655f  ers/{self._site_
+0000bbf0: 6669 6c74 6572 735f 616e 616c 7973 6973  filters_analysis
+0000bc00: 7d2f 7b6d 6173 6b7d 2f22 0a20 2020 2020  }/{mask}/".     
+0000bc10: 2020 2020 2020 2073 746f 7265 203d 2069         store = i
+0000bc20: 6e69 745f 7a61 7272 5f73 746f 7265 2866  nit_zarr_store(f
+0000bc30: 733d 7365 6c66 2e5f 6673 2c20 7061 7468  s=self._fs, path
+0000bc40: 3d70 6174 6829 0a20 2020 2020 2020 2020  =path).         
+0000bc50: 2020 2072 6f6f 7420 3d20 7a61 7272 2e6f     root = zarr.o
+0000bc60: 7065 6e5f 636f 6e73 6f6c 6964 6174 6564  pen_consolidated
+0000bc70: 2873 746f 7265 3d73 746f 7265 290a 2020  (store=store).  
+0000bc80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000bc90: 6361 6368 655f 7369 7465 5f66 696c 7465  cache_site_filte
+0000bca0: 7273 5b6d 6173 6b5d 203d 2072 6f6f 740a  rs[mask] = root.
+0000bcb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000bcc0: 726e 2072 6f6f 740a 0a20 2020 2040 646f  rn root..    @do
+0000bcd0: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
+0000bce0: 7279 3d22 4f70 656e 2053 4e50 2073 6974  ry="Open SNP sit
+0000bcf0: 6573 207a 6172 7222 2c0a 2020 2020 2020  es zarr",.      
+0000bd00: 2020 7265 7475 726e 733d 225a 6172 7220    returns="Zarr 
+0000bd10: 6869 6572 6172 6368 792e 222c 0a20 2020  hierarchy.",.   
+0000bd20: 2029 0a20 2020 2064 6566 206f 7065 6e5f   ).    def open_
+0000bd30: 736e 705f 7369 7465 7328 7365 6c66 2920  snp_sites(self) 
+0000bd40: 2d3e 207a 6172 722e 6869 6572 6172 6368  -> zarr.hierarch
+0000bd50: 792e 4772 6f75 703a 0a20 2020 2020 2020  y.Group:.       
+0000bd60: 2069 6620 7365 6c66 2e5f 6361 6368 655f   if self._cache_
+0000bd70: 736e 705f 7369 7465 7320 6973 204e 6f6e  snp_sites is Non
+0000bd80: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0000bd90: 6174 6820 3d20 280a 2020 2020 2020 2020  ath = (.        
+0000bda0: 2020 2020 2020 2020 6622 7b73 656c 662e          f"{self.
+0000bdb0: 5f62 6173 655f 7061 7468 7d2f 7b73 656c  _base_path}/{sel
+0000bdc0: 662e 5f6d 616a 6f72 5f76 6572 7369 6f6e  f._major_version
+0000bdd0: 5f70 6174 687d 2f73 6e70 5f67 656e 6f74  _path}/snp_genot
+0000bde0: 7970 6573 2f61 6c6c 2f73 6974 6573 2f22  ypes/all/sites/"
+0000bdf0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000be00: 2020 2020 2020 2020 2020 2073 746f 7265             store
+0000be10: 203d 2069 6e69 745f 7a61 7272 5f73 746f   = init_zarr_sto
+0000be20: 7265 2866 733d 7365 6c66 2e5f 6673 2c20  re(fs=self._fs, 
+0000be30: 7061 7468 3d70 6174 6829 0a20 2020 2020  path=path).     
+0000be40: 2020 2020 2020 2072 6f6f 7420 3d20 7a61         root = za
+0000be50: 7272 2e6f 7065 6e5f 636f 6e73 6f6c 6964  rr.open_consolid
+0000be60: 6174 6564 2873 746f 7265 3d73 746f 7265  ated(store=store
+0000be70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000be80: 6c66 2e5f 6361 6368 655f 736e 705f 7369  lf._cache_snp_si
+0000be90: 7465 7320 3d20 726f 6f74 0a20 2020 2020  tes = root.     
+0000bea0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000beb0: 6361 6368 655f 736e 705f 7369 7465 730a  cache_snp_sites.
+0000bec0: 0a20 2020 2064 6566 205f 7072 6f67 7265  .    def _progre
+0000bed0: 7373 2873 656c 662c 2069 7465 7261 626c  ss(self, iterabl
+0000bee0: 652c 202a 2a6b 7761 7267 7329 3a0a 2020  e, **kwargs):.  
+0000bef0: 2020 2020 2020 2320 7072 6f67 7265 7373        # progress
+0000bf00: 2064 6f65 736e 2774 206d 6978 2077 656c   doesn't mix wel
+0000bf10: 6c20 7769 7468 2064 6562 7567 206c 6f67  l with debug log
+0000bf20: 6769 6e67 0a20 2020 2020 2020 2064 6973  ging.        dis
+0000bf30: 6162 6c65 203d 2073 656c 662e 5f64 6562  able = self._deb
+0000bf40: 7567 206f 7220 6e6f 7420 7365 6c66 2e5f  ug or not self._
+0000bf50: 7368 6f77 5f70 726f 6772 6573 730a 2020  show_progress.  
+0000bf60: 2020 2020 2020 7265 7475 726e 2074 7164        return tqd
+0000bf70: 6d28 6974 6572 6162 6c65 2c20 6469 7361  m(iterable, disa
+0000bf80: 626c 653d 6469 7361 626c 652c 202a 2a6b  ble=disable, **k
+0000bf90: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+0000bfa0: 5f73 6974 655f 6669 6c74 6572 7328 0a20  _site_filters(. 
+0000bfb0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000bfc0: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
+0000bfd0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+0000bfe0: 6d61 736b 2c0a 2020 2020 2020 2020 6669  mask,.        fi
+0000bff0: 656c 642c 0a20 2020 2020 2020 2069 6e6c  eld,.        inl
+0000c000: 696e 655f 6172 7261 792c 0a20 2020 2020  ine_array,.     
+0000c010: 2020 2063 6875 6e6b 732c 0a20 2020 2029     chunks,.    )
+0000c020: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
+0000c030: 2069 7369 6e73 7461 6e63 6528 7265 6769   isinstance(regi
+0000c040: 6f6e 2c20 5265 6769 6f6e 290a 2020 2020  on, Region).    
+0000c050: 2020 2020 726f 6f74 203d 2073 656c 662e      root = self.
+0000c060: 6f70 656e 5f73 6974 655f 6669 6c74 6572  open_site_filter
+0000c070: 7328 6d61 736b 3d6d 6173 6b29 0a20 2020  s(mask=mask).   
+0000c080: 2020 2020 207a 203d 2072 6f6f 745b 6622       z = root[f"
+0000c090: 7b72 6567 696f 6e2e 636f 6e74 6967 7d2f  {region.contig}/
+0000c0a0: 7661 7269 616e 7473 2f7b 6669 656c 647d  variants/{field}
+0000c0b0: 225d 0a20 2020 2020 2020 2064 203d 2064  "].        d = d
+0000c0c0: 615f 6672 6f6d 5f7a 6172 7228 7a2c 2069  a_from_zarr(z, i
+0000c0d0: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
+0000c0e0: 6e65 5f61 7272 6179 2c20 6368 756e 6b73  ne_array, chunks
+0000c0f0: 3d63 6875 6e6b 7329 0a20 2020 2020 2020  =chunks).       
+0000c100: 2069 6620 7265 6769 6f6e 2e73 7461 7274   if region.start
+0000c110: 206f 7220 7265 6769 6f6e 2e65 6e64 3a0a   or region.end:.
+0000c120: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+0000c130: 203d 2073 656c 662e 6f70 656e 5f73 6e70   = self.open_snp
+0000c140: 5f73 6974 6573 2829 0a20 2020 2020 2020  _sites().       
+0000c150: 2020 2020 2070 6f73 203d 2072 6f6f 745b       pos = root[
+0000c160: 6622 7b72 6567 696f 6e2e 636f 6e74 6967  f"{region.contig
+0000c170: 7d2f 7661 7269 616e 7473 2f50 4f53 225d  }/variants/POS"]
+0000c180: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
+0000c190: 6c6f 635f 7265 6769 6f6e 203d 206c 6f63  loc_region = loc
+0000c1a0: 6174 655f 7265 6769 6f6e 2872 6567 696f  ate_region(regio
+0000c1b0: 6e2c 2070 6f73 290a 2020 2020 2020 2020  n, pos).        
+0000c1c0: 2020 2020 6420 3d20 645b 6c6f 635f 7265      d = d[loc_re
+0000c1d0: 6769 6f6e 5d0a 2020 2020 2020 2020 7265  gion].        re
+0000c1e0: 7475 726e 2064 0a0a 2020 2020 4064 6f63  turn d..    @doc
+0000c1f0: 280a 2020 2020 2020 2020 7375 6d6d 6172  (.        summar
+0000c200: 793d 2241 6363 6573 7320 534e 5020 7369  y="Access SNP si
+0000c210: 7465 2066 696c 7465 7273 2e22 2c0a 2020  te filters.",.  
+0000c220: 2020 2020 2020 7265 7475 726e 733d 2222        returns=""
+0000c230: 220a 2020 2020 2020 2020 2020 2020 416e  ".            An
+0000c240: 2061 7272 6179 206f 6620 626f 6f6c 6561   array of boolea
+0000c250: 6e20 7661 6c75 6573 2069 6465 6e74 6966  n values identif
+0000c260: 7969 6e67 2073 6974 6573 2074 6861 7420  ying sites that 
+0000c270: 7061 7373 2074 6865 2066 696c 7465 7273  pass the filters
+0000c280: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
+0000c290: 2020 2029 0a20 2020 2064 6566 2073 6974     ).    def sit
+0000c2a0: 655f 6669 6c74 6572 7328 0a20 2020 2020  e_filters(.     
+0000c2b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000c2c0: 2072 6567 696f 6e3a 2062 6173 655f 7061   region: base_pa
+0000c2d0: 7261 6d73 2e72 6567 696f 6e2c 0a20 2020  rams.region,.   
+0000c2e0: 2020 2020 206d 6173 6b3a 2062 6173 655f       mask: base_
+0000c2f0: 7061 7261 6d73 2e73 6974 655f 6d61 736b  params.site_mask
+0000c300: 2c0a 2020 2020 2020 2020 6669 656c 643a  ,.        field:
+0000c310: 2062 6173 655f 7061 7261 6d73 2e66 6965   base_params.fie
+0000c320: 6c64 203d 2022 6669 6c74 6572 5f70 6173  ld = "filter_pas
+0000c330: 7322 2c0a 2020 2020 2020 2020 696e 6c69  s",.        inli
+0000c340: 6e65 5f61 7272 6179 3a20 6261 7365 5f70  ne_array: base_p
+0000c350: 6172 616d 732e 696e 6c69 6e65 5f61 7272  arams.inline_arr
+0000c360: 6179 203d 2062 6173 655f 7061 7261 6d73  ay = base_params
+0000c370: 2e69 6e6c 696e 655f 6172 7261 795f 6465  .inline_array_de
+0000c380: 6661 756c 742c 0a20 2020 2020 2020 2063  fault,.        c
+0000c390: 6875 6e6b 733a 2062 6173 655f 7061 7261  hunks: base_para
+0000c3a0: 6d73 2e63 6875 6e6b 7320 3d20 6261 7365  ms.chunks = base
+0000c3b0: 5f70 6172 616d 732e 6368 756e 6b73 5f64  _params.chunks_d
+0000c3c0: 6566 6175 6c74 2c0a 2020 2020 2920 2d3e  efault,.    ) ->
+0000c3d0: 2064 612e 4172 7261 793a 0a20 2020 2020   da.Array:.     
+0000c3e0: 2020 2023 2072 6573 6f6c 7665 2074 6865     # resolve the
+0000c3f0: 2072 6567 696f 6e20 7061 7261 6d65 7465   region paramete
+0000c400: 7220 746f 2061 2073 7461 6e64 6172 6420  r to a standard 
+0000c410: 7479 7065 0a20 2020 2020 2020 2072 6573  type.        res
+0000c420: 6f6c 7665 645f 7265 6769 6f6e 203d 2073  olved_region = s
+0000c430: 656c 662e 7265 736f 6c76 655f 7265 6769  elf.resolve_regi
+0000c440: 6f6e 2872 6567 696f 6e29 0a20 2020 2020  on(region).     
+0000c450: 2020 2064 656c 2072 6567 696f 6e0a 2020     del region.  
+0000c460: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000c470: 6e63 6528 7265 736f 6c76 6564 5f72 6567  nce(resolved_reg
+0000c480: 696f 6e2c 2052 6567 696f 6e29 3a0a 2020  ion, Region):.  
+0000c490: 2020 2020 2020 2020 2020 7265 736f 6c76            resolv
+0000c4a0: 6564 5f72 6567 696f 6e20 3d20 5b72 6573  ed_region = [res
+0000c4b0: 6f6c 7665 645f 7265 6769 6f6e 5d0a 0a20  olved_region].. 
+0000c4c0: 2020 2020 2020 2064 203d 2064 612e 636f         d = da.co
+0000c4d0: 6e63 6174 656e 6174 6528 0a20 2020 2020  ncatenate(.     
+0000c4e0: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+0000c4f0: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+0000c500: 6974 655f 6669 6c74 6572 7328 0a20 2020  ite_filters(.   
+0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c520: 2072 6567 696f 6e3d 722c 0a20 2020 2020   region=r,.     
+0000c530: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000c540: 6173 6b3d 6d61 736b 2c0a 2020 2020 2020  ask=mask,.      
+0000c550: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000c560: 656c 643d 6669 656c 642c 0a20 2020 2020  eld=field,.     
+0000c570: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c580: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
+0000c590: 6e65 5f61 7272 6179 2c0a 2020 2020 2020  ne_array,.      
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0000c5b0: 756e 6b73 3d63 6875 6e6b 732c 0a20 2020  unks=chunks,.   
+0000c5c0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000c5d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000c5e0: 6f72 2072 2069 6e20 7265 736f 6c76 6564  or r in resolved
+0000c5f0: 5f72 6567 696f 6e0a 2020 2020 2020 2020  _region.        
+0000c600: 2020 2020 5d0a 2020 2020 2020 2020 290a      ].        ).
+0000c610: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c620: 640a 0a20 2020 2064 6566 205f 736e 705f  d..    def _snp_
+0000c630: 7369 7465 735f 666f 725f 636f 6e74 6967  sites_for_contig
+0000c640: 2873 656c 662c 2063 6f6e 7469 672c 202a  (self, contig, *
+0000c650: 2c20 6669 656c 642c 2069 6e6c 696e 655f  , field, inline_
+0000c660: 6172 7261 792c 2063 6875 6e6b 7329 3a0a  array, chunks):.
+0000c670: 2020 2020 2020 2020 2222 2241 6363 6573          """Acces
+0000c680: 7320 534e 5020 7369 7465 7320 6461 7461  s SNP sites data
+0000c690: 2066 6f72 2061 2073 696e 676c 6520 636f   for a single co
+0000c6a0: 6e74 6967 2e22 2222 0a20 2020 2020 2020  ntig.""".       
+0000c6b0: 2072 6f6f 7420 3d20 7365 6c66 2e6f 7065   root = self.ope
+0000c6c0: 6e5f 736e 705f 7369 7465 7328 290a 2020  n_snp_sites().  
+0000c6d0: 2020 2020 2020 7a20 3d20 726f 6f74 5b66        z = root[f
+0000c6e0: 227b 636f 6e74 6967 7d2f 7661 7269 616e  "{contig}/varian
+0000c6f0: 7473 2f7b 6669 656c 647d 225d 0a20 2020  ts/{field}"].   
+0000c700: 2020 2020 2072 6574 203d 2064 615f 6672       ret = da_fr
+0000c710: 6f6d 5f7a 6172 7228 7a2c 2069 6e6c 696e  om_zarr(z, inlin
+0000c720: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
+0000c730: 7272 6179 2c20 6368 756e 6b73 3d63 6875  rray, chunks=chu
+0000c740: 6e6b 7329 0a20 2020 2020 2020 2072 6574  nks).        ret
+0000c750: 7572 6e20 7265 740a 0a20 2020 2064 6566  urn ret..    def
+0000c760: 205f 736e 705f 7369 7465 7328 0a20 2020   _snp_sites(.   
+0000c770: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000c780: 2020 202a 2c0a 2020 2020 2020 2020 7265     *,.        re
+0000c790: 6769 6f6e 2c0a 2020 2020 2020 2020 6669  gion,.        fi
+0000c7a0: 656c 642c 0a20 2020 2020 2020 2069 6e6c  eld,.        inl
+0000c7b0: 696e 655f 6172 7261 792c 0a20 2020 2020  ine_array,.     
+0000c7c0: 2020 2063 6875 6e6b 732c 0a20 2020 2029     chunks,.    )
+0000c7d0: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
+0000c7e0: 2069 7369 6e73 7461 6e63 6528 7265 6769   isinstance(regi
+0000c7f0: 6f6e 2c20 5265 6769 6f6e 292c 2074 7970  on, Region), typ
+0000c800: 6528 7265 6769 6f6e 290a 0a20 2020 2020  e(region)..     
+0000c810: 2020 2072 6574 203d 2073 656c 662e 5f73     ret = self._s
+0000c820: 6e70 5f73 6974 6573 5f66 6f72 5f63 6f6e  np_sites_for_con
+0000c830: 7469 6728 0a20 2020 2020 2020 2020 2020  tig(.           
+0000c840: 2063 6f6e 7469 673d 7265 6769 6f6e 2e63   contig=region.c
+0000c850: 6f6e 7469 672c 2066 6965 6c64 3d66 6965  ontig, field=fie
+0000c860: 6c64 2c20 696e 6c69 6e65 5f61 7272 6179  ld, inline_array
+0000c870: 3d69 6e6c 696e 655f 6172 7261 792c 2063  =inline_array, c
+0000c880: 6875 6e6b 733d 6368 756e 6b73 0a20 2020  hunks=chunks.   
+0000c890: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000c8a0: 6966 2072 6567 696f 6e2e 7374 6172 7420  if region.start 
+0000c8b0: 6f72 2072 6567 696f 6e2e 656e 643a 0a20  or region.end:. 
+0000c8c0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+0000c8d0: 656c 6420 3d3d 2022 504f 5322 3a0a 2020  eld == "POS":.  
+0000c8e0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000c8f0: 7320 3d20 7265 740a 2020 2020 2020 2020  s = ret.        
+0000c900: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c910: 2020 2020 2020 2020 2020 706f 7320 3d20            pos = 
+0000c920: 7365 6c66 2e5f 736e 705f 7369 7465 735f  self._snp_sites_
+0000c930: 666f 725f 636f 6e74 6967 280a 2020 2020  for_contig(.    
+0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c950: 636f 6e74 6967 3d72 6567 696f 6e2e 636f  contig=region.co
+0000c960: 6e74 6967 2c0a 2020 2020 2020 2020 2020  ntig,.          
+0000c970: 2020 2020 2020 2020 2020 6669 656c 643d            field=
+0000c980: 2250 4f53 222c 0a20 2020 2020 2020 2020  "POS",.         
+0000c990: 2020 2020 2020 2020 2020 2069 6e6c 696e             inlin
+0000c9a0: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
+0000c9b0: 7272 6179 2c0a 2020 2020 2020 2020 2020  rray,.          
+0000c9c0: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
+0000c9d0: 3d63 6875 6e6b 732c 0a20 2020 2020 2020  =chunks,.       
+0000c9e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c9f0: 2020 2020 2020 206c 6f63 5f72 6567 696f         loc_regio
+0000ca00: 6e20 3d20 6c6f 6361 7465 5f72 6567 696f  n = locate_regio
+0000ca10: 6e28 7265 6769 6f6e 2c20 706f 7329 0a20  n(region, pos). 
+0000ca20: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+0000ca30: 2072 6574 5b6c 6f63 5f72 6567 696f 6e5d   ret[loc_region]
+0000ca40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ca50: 7265 740a 0a20 2020 2040 646f 6328 0a20  ret..    @doc(. 
+0000ca60: 2020 2020 2020 2073 756d 6d61 7279 3d22         summary="
+0000ca70: 4163 6365 7373 2053 4e50 2073 6974 6520  Access SNP site 
+0000ca80: 6461 7461 2028 706f 7369 7469 6f6e 7320  data (positions 
+0000ca90: 616e 6420 616c 6c65 6c65 7329 2e22 2c0a  and alleles).",.
+0000caa0: 2020 2020 2020 2020 7265 7475 726e 733d          returns=
+0000cab0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0000cac0: 416e 2061 7272 6179 206f 6620 6569 7468  An array of eith
+0000cad0: 6572 2053 4e50 2070 6f73 6974 696f 6e73  er SNP positions
+0000cae0: 2028 2250 4f53 2229 2c20 7265 6665 7265   ("POS"), refere
+0000caf0: 6e63 6520 616c 6c65 6c65 7320 2822 5245  nce alleles ("RE
+0000cb00: 4622 2920 6f72 0a20 2020 2020 2020 2020  F") or.         
+0000cb10: 2020 2061 6c74 6572 6e61 7465 2061 6c6c     alternate all
+0000cb20: 656c 6573 2028 2241 4c54 2229 2e0a 2020  eles ("ALT")..  
+0000cb30: 2020 2020 2020 2222 222c 0a20 2020 2029        """,.    )
+0000cb40: 0a20 2020 2064 6566 2073 6e70 5f73 6974  .    def snp_sit
+0000cb50: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
+0000cb60: 2c0a 2020 2020 2020 2020 7265 6769 6f6e  ,.        region
+0000cb70: 3a20 6261 7365 5f70 6172 616d 732e 7265  : base_params.re
+0000cb80: 6769 6f6e 2c0a 2020 2020 2020 2020 6669  gion,.        fi
+0000cb90: 656c 643a 2062 6173 655f 7061 7261 6d73  eld: base_params
+0000cba0: 2e66 6965 6c64 2c0a 2020 2020 2020 2020  .field,.        
+0000cbb0: 7369 7465 5f6d 6173 6b3a 204f 7074 696f  site_mask: Optio
+0000cbc0: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
+0000cbd0: 7369 7465 5f6d 6173 6b5d 203d 204e 6f6e  site_mask] = Non
+0000cbe0: 652c 0a20 2020 2020 2020 2069 6e6c 696e  e,.        inlin
+0000cbf0: 655f 6172 7261 793a 2062 6173 655f 7061  e_array: base_pa
+0000cc00: 7261 6d73 2e69 6e6c 696e 655f 6172 7261  rams.inline_arra
+0000cc10: 7920 3d20 6261 7365 5f70 6172 616d 732e  y = base_params.
+0000cc20: 696e 6c69 6e65 5f61 7272 6179 5f64 6566  inline_array_def
+0000cc30: 6175 6c74 2c0a 2020 2020 2020 2020 6368  ault,.        ch
+0000cc40: 756e 6b73 3a20 6261 7365 5f70 6172 616d  unks: base_param
+0000cc50: 732e 6368 756e 6b73 203d 2062 6173 655f  s.chunks = base_
+0000cc60: 7061 7261 6d73 2e63 6875 6e6b 735f 6465  params.chunks_de
+0000cc70: 6661 756c 742c 0a20 2020 2029 202d 3e20  fault,.    ) -> 
+0000cc80: 6461 2e41 7272 6179 3a0a 2020 2020 2020  da.Array:.      
+0000cc90: 2020 6465 6275 6720 3d20 7365 6c66 2e5f    debug = self._
+0000cca0: 6c6f 672e 6465 6275 670a 0a20 2020 2020  log.debug..     
+0000ccb0: 2020 2023 2072 6573 6f6c 7665 2074 6865     # resolve the
+0000ccc0: 2072 6567 696f 6e20 7061 7261 6d65 7465   region paramete
+0000ccd0: 7220 746f 2061 2073 7461 6e64 6172 6420  r to a standard 
+0000cce0: 7479 7065 0a20 2020 2020 2020 2072 6573  type.        res
+0000ccf0: 6f6c 7665 645f 7265 6769 6f6e 203d 2073  olved_region = s
+0000cd00: 656c 662e 7265 736f 6c76 655f 7265 6769  elf.resolve_regi
+0000cd10: 6f6e 2872 6567 696f 6e29 0a20 2020 2020  on(region).     
+0000cd20: 2020 2064 656c 2072 6567 696f 6e0a 2020     del region.  
+0000cd30: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000cd40: 6e63 6528 7265 736f 6c76 6564 5f72 6567  nce(resolved_reg
+0000cd50: 696f 6e2c 2052 6567 696f 6e29 3a0a 2020  ion, Region):.  
+0000cd60: 2020 2020 2020 2020 2020 7265 736f 6c76            resolv
+0000cd70: 6564 5f72 6567 696f 6e20 3d20 5b72 6573  ed_region = [res
+0000cd80: 6f6c 7665 645f 7265 6769 6f6e 5d0a 0a20  olved_region].. 
+0000cd90: 2020 2020 2020 2064 6562 7567 2822 6163         debug("ac
+0000cda0: 6365 7373 2053 4e50 2073 6974 6573 2061  cess SNP sites a
+0000cdb0: 6e64 2063 6f6e 6361 7465 6e61 7465 206f  nd concatenate o
+0000cdc0: 7665 7220 7265 6769 6f6e 7322 290a 2020  ver regions").  
+0000cdd0: 2020 2020 2020 7265 7420 3d20 6461 2e63        ret = da.c
+0000cde0: 6f6e 6361 7465 6e61 7465 280a 2020 2020  oncatenate(.    
+0000cdf0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000ce00: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000ce10: 736e 705f 7369 7465 7328 0a20 2020 2020  snp_sites(.     
+0000ce20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ce30: 6567 696f 6e3d 722c 0a20 2020 2020 2020  egion=r,.       
+0000ce40: 2020 2020 2020 2020 2020 2020 2066 6965               fie
+0000ce50: 6c64 3d66 6965 6c64 2c0a 2020 2020 2020  ld=field,.      
+0000ce60: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0000ce70: 756e 6b73 3d63 6875 6e6b 732c 0a20 2020  unks=chunks,.   
+0000ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce90: 2069 6e6c 696e 655f 6172 7261 793d 696e   inline_array=in
+0000cea0: 6c69 6e65 5f61 7272 6179 2c0a 2020 2020  line_array,.    
+0000ceb0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000cec0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000ced0: 7220 7220 696e 2072 6573 6f6c 7665 645f  r r in resolved_
+0000cee0: 7265 6769 6f6e 0a20 2020 2020 2020 2020  region.         
+0000cef0: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
+0000cf00: 2020 6178 6973 3d30 2c0a 2020 2020 2020    axis=0,.      
+0000cf10: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
+0000cf20: 7567 2822 6170 706c 7920 7369 7465 206d  ug("apply site m
+0000cf30: 6173 6b20 6966 2072 6571 7565 7374 6564  ask if requested
+0000cf40: 2229 0a20 2020 2020 2020 2069 6620 7369  ").        if si
+0000cf50: 7465 5f6d 6173 6b20 6973 206e 6f74 204e  te_mask is not N
+0000cf60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000cf70: 206c 6f63 5f73 6974 6573 203d 2073 656c   loc_sites = sel
+0000cf80: 662e 7369 7465 5f66 696c 7465 7273 280a  f.site_filters(.
+0000cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfa0: 7265 6769 6f6e 3d72 6573 6f6c 7665 645f  region=resolved_
+0000cfb0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+0000cfc0: 2020 2020 2020 2020 6d61 736b 3d73 6974          mask=sit
+0000cfd0: 655f 6d61 736b 2c0a 2020 2020 2020 2020  e_mask,.        
+0000cfe0: 2020 2020 2020 2020 6368 756e 6b73 3d63          chunks=c
+0000cff0: 6875 6e6b 732c 0a20 2020 2020 2020 2020  hunks,.         
+0000d000: 2020 2020 2020 2069 6e6c 696e 655f 6172         inline_ar
+0000d010: 7261 793d 696e 6c69 6e65 5f61 7272 6179  ray=inline_array
+0000d020: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000d030: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
+0000d040: 3d20 6461 5f63 6f6d 7072 6573 7328 6c6f  = da_compress(lo
+0000d050: 635f 7369 7465 732c 2072 6574 2c20 6178  c_sites, ret, ax
+0000d060: 6973 3d30 290a 0a20 2020 2020 2020 2072  is=0)..        r
+0000d070: 6574 7572 6e20 7265 740a 0a20 2020 2040  eturn ret..    @
+0000d080: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
+0000d090: 6d61 7279 3d22 436f 6e76 6572 7420 6120  mary="Convert a 
+0000d0a0: 6765 6e6f 6d65 2072 6567 696f 6e20 696e  genome region in
+0000d0b0: 746f 2061 2073 7461 6e64 6172 6420 6461  to a standard da
+0000d0c0: 7461 2073 7472 7563 7475 7265 2e22 2c0a  ta structure.",.
+0000d0d0: 2020 2020 2020 2020 7265 7475 726e 733d          returns=
+0000d0e0: 2241 6e20 696e 7374 616e 6365 206f 6620  "An instance of 
+0000d0f0: 7468 6520 6052 6567 696f 6e60 2063 6c61  the `Region` cla
+0000d100: 7373 2e22 2c0a 2020 2020 290a 2020 2020  ss.",.    ).    
+0000d110: 6465 6620 7265 736f 6c76 655f 7265 6769  def resolve_regi
+0000d120: 6f6e 2873 656c 662c 2072 6567 696f 6e3a  on(self, region:
+0000d130: 2062 6173 655f 7061 7261 6d73 2e72 6567   base_params.reg
+0000d140: 696f 6e29 202d 3e20 5265 6769 6f6e 3a0a  ion) -> Region:.
+0000d150: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000d160: 6573 6f6c 7665 5f72 6567 696f 6e28 7365  esolve_region(se
+0000d170: 6c66 2c20 7265 6769 6f6e 290a 0a20 2020  lf, region)..   
+0000d180: 2064 6566 205f 7072 6570 5f72 6567 696f   def _prep_regio
+0000d190: 6e5f 6361 6368 655f 7061 7261 6d28 7365  n_cache_param(se
+0000d1a0: 6c66 2c20 2a2c 2072 6567 696f 6e29 3a0a  lf, *, region):.
+0000d1b0: 2020 2020 2020 2020 2222 224f 6274 6169          """Obtai
+0000d1c0: 6e20 6120 6e6f 726d 616c 6973 6564 2072  n a normalised r
+0000d1d0: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
+0000d1e0: 2061 2072 6567 696f 6e20 7061 7261 6d65   a region parame
+0000d1f0: 7465 7220 7768 6963 6820 6361 6e0a 2020  ter which can.  
+0000d200: 2020 2020 2020 6265 2075 7365 6420 7769        be used wi
+0000d210: 7468 2074 6865 2072 6573 756c 7473 2063  th the results c
+0000d220: 6163 6865 2e22 2222 0a0a 2020 2020 2020  ache."""..      
+0000d230: 2020 2320 4e2e 422e 2c20 7765 206e 6565    # N.B., we nee
+0000d240: 6420 746f 2063 6f6e 7665 7274 2074 6f20  d to convert to 
+0000d250: 6120 6469 6374 2c20 6265 6361 7573 6520  a dict, because 
+0000d260: 6361 6368 6520 7361 7665 7320 7061 7261  cache saves para
+0000d270: 6d73 2061 730a 2020 2020 2020 2020 2320  ms as.        # 
+0000d280: 4a53 4f4e 0a0a 2020 2020 2020 2020 7265  JSON..        re
+0000d290: 6769 6f6e 203d 2073 656c 662e 7265 736f  gion = self.reso
+0000d2a0: 6c76 655f 7265 6769 6f6e 2872 6567 696f  lve_region(regio
+0000d2b0: 6e29 0a20 2020 2020 2020 2069 6620 6973  n).        if is
+0000d2c0: 696e 7374 616e 6365 2872 6567 696f 6e2c  instance(region,
+0000d2d0: 206c 6973 7429 3a0a 2020 2020 2020 2020   list):.        
+0000d2e0: 2020 2020 7265 6769 6f6e 203d 205b 722e      region = [r.
+0000d2f0: 746f 5f64 6963 7428 2920 666f 7220 7220  to_dict() for r 
+0000d300: 696e 2072 6567 696f 6e5d 0a20 2020 2020  in region].     
+0000d310: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000d320: 2020 2020 2072 6567 696f 6e20 3d20 7265       region = re
+0000d330: 6769 6f6e 2e74 6f5f 6469 6374 2829 0a20  gion.to_dict(). 
+0000d340: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000d350: 6769 6f6e 0a0a 2020 2020 6465 6620 5f70  gion..    def _p
+0000d360: 7265 705f 7361 6d70 6c65 5f73 656c 6563  rep_sample_selec
+0000d370: 7469 6f6e 5f63 6163 6865 5f70 6172 616d  tion_cache_param
+0000d380: 7328 7365 6c66 2c20 2a2c 2073 616d 706c  s(self, *, sampl
+0000d390: 655f 7365 7473 2c20 7361 6d70 6c65 5f71  e_sets, sample_q
+0000d3a0: 7565 7279 293a 0a20 2020 2020 2020 2023  uery):.        #
+0000d3b0: 206e 6f72 6d61 6c69 7365 2073 616d 706c   normalise sampl
+0000d3c0: 6520 7365 7473 0a20 2020 2020 2020 2073  e sets.        s
+0000d3d0: 616d 706c 655f 7365 7473 203d 2073 656c  ample_sets = sel
+0000d3e0: 662e 5f70 7265 705f 7361 6d70 6c65 5f73  f._prep_sample_s
+0000d3f0: 6574 735f 7061 7261 6d28 7361 6d70 6c65  ets_param(sample
+0000d400: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
+0000d410: 7329 0a0a 2020 2020 2020 2020 2320 6e6f  s)..        # no
+0000d420: 726d 616c 697a 6520 7361 6d70 6c65 5f71  rmalize sample_q
+0000d430: 7565 7279 0a20 2020 2020 2020 2069 6620  uery.        if 
+0000d440: 6973 696e 7374 616e 6365 2873 616d 706c  isinstance(sampl
+0000d450: 655f 7175 6572 792c 2073 7472 293a 0a20  e_query, str):. 
+0000d460: 2020 2020 2020 2020 2020 2023 2072 6573             # res
+0000d470: 6f6c 7665 2071 7565 7279 2074 6f20 6120  olve query to a 
+0000d480: 6c69 7374 206f 6620 696e 7465 6765 7273  list of integers
+0000d490: 2066 6f72 206d 6f72 6520 6361 6368 6520   for more cache 
+0000d4a0: 6869 7473 202d 2077 650a 2020 2020 2020  hits - we.      
+0000d4b0: 2020 2020 2020 2320 646f 2074 6869 7320        # do this 
+0000d4c0: 6265 6361 7573 6520 7468 6572 6520 6172  because there ar
+0000d4d0: 6520 6469 6666 6572 656e 7420 7761 7973  e different ways
+0000d4e0: 2074 6f20 7772 6974 6520 7468 6520 7361   to write the sa
+0000d4f0: 6d65 2070 616e 6461 730a 2020 2020 2020  me pandas.      
+0000d500: 2020 2020 2020 2320 7175 6572 792c 2061        # query, a
+0000d510: 6e64 2073 6f20 6974 2773 2062 6574 7465  nd so it's bette
+0000d520: 7220 746f 2065 7661 6c75 6174 6520 7468  r to evaluate th
+0000d530: 6520 7175 6572 7920 616e 6420 7573 6520  e query and use 
+0000d540: 6120 6c69 7374 206f 660a 2020 2020 2020  a list of.      
+0000d550: 2020 2020 2020 2320 696e 7465 6765 7220        # integer 
+0000d560: 696e 6469 6365 7320 696e 7374 6561 640a  indices instead.
+0000d570: 2020 2020 2020 2020 2020 2020 6466 5f73              df_s
+0000d580: 616d 706c 6573 203d 2073 656c 662e 7361  amples = self.sa
+0000d590: 6d70 6c65 5f6d 6574 6164 6174 6128 7361  mple_metadata(sa
+0000d5a0: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
+0000d5b0: 5f73 6574 7329 0a20 2020 2020 2020 2020  _sets).         
+0000d5c0: 2020 206c 6f63 5f73 616d 706c 6573 203d     loc_samples =
+0000d5d0: 2064 665f 7361 6d70 6c65 732e 6576 616c   df_samples.eval
+0000d5e0: 2873 616d 706c 655f 7175 6572 7929 2e76  (sample_query).v
+0000d5f0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
+0000d600: 2020 7361 6d70 6c65 5f71 7565 7279 203d    sample_query =
+0000d610: 206e 702e 6e6f 6e7a 6572 6f28 6c6f 635f   np.nonzero(loc_
+0000d620: 7361 6d70 6c65 7329 5b30 5d2e 746f 6c69  samples)[0].toli
+0000d630: 7374 2829 0a0a 2020 2020 2020 2020 7265  st()..        re
+0000d640: 7475 726e 2073 616d 706c 655f 7365 7473  turn sample_sets
+0000d650: 2c20 7361 6d70 6c65 5f71 7565 7279 0a0a  , sample_query..
+0000d660: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+0000d670: 2020 7375 6d6d 6172 793d 224f 7065 6e20    summary="Open 
+0000d680: 534e 5020 6765 6e6f 7479 7065 7320 7a61  SNP genotypes za
+0000d690: 7272 2066 6f72 2061 2067 6976 656e 2073  rr for a given s
+0000d6a0: 616d 706c 6520 7365 742e 222c 0a20 2020  ample set.",.   
+0000d6b0: 2020 2020 2072 6574 7572 6e73 3d22 5a61       returns="Za
+0000d6c0: 7272 2068 6965 7261 7263 6879 2e22 2c0a  rr hierarchy.",.
+0000d6d0: 2020 2020 290a 2020 2020 6465 6620 6f70      ).    def op
+0000d6e0: 656e 5f73 6e70 5f67 656e 6f74 7970 6573  en_snp_genotypes
+0000d6f0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+0000d700: 7361 6d70 6c65 5f73 6574 3a20 6261 7365  sample_set: base
+0000d710: 5f70 6172 616d 732e 7361 6d70 6c65 5f73  _params.sample_s
+0000d720: 6574 0a20 2020 2029 202d 3e20 7a61 7272  et.    ) -> zarr
+0000d730: 2e68 6965 7261 7263 6879 2e47 726f 7570  .hierarchy.Group
+0000d740: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+0000d750: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d760: 6e20 7365 6c66 2e5f 6361 6368 655f 736e  n self._cache_sn
+0000d770: 705f 6765 6e6f 7479 7065 735b 7361 6d70  p_genotypes[samp
+0000d780: 6c65 5f73 6574 5d0a 2020 2020 2020 2020  le_set].        
+0000d790: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+0000d7a0: 0a20 2020 2020 2020 2020 2020 2072 656c  .            rel
+0000d7b0: 6561 7365 203d 2073 656c 662e 6c6f 6f6b  ease = self.look
+0000d7c0: 7570 5f72 656c 6561 7365 2873 616d 706c  up_release(sampl
+0000d7d0: 655f 7365 743d 7361 6d70 6c65 5f73 6574  e_set=sample_set
+0000d7e0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000d7f0: 6c65 6173 655f 7061 7468 203d 2073 656c  lease_path = sel
+0000d800: 662e 5f72 656c 6561 7365 5f74 6f5f 7061  f._release_to_pa
+0000d810: 7468 2872 656c 6561 7365 290a 2020 2020  th(release).    
+0000d820: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+0000d830: 227b 7365 6c66 2e5f 6261 7365 5f70 6174  "{self._base_pat
+0000d840: 687d 2f7b 7265 6c65 6173 655f 7061 7468  h}/{release_path
+0000d850: 7d2f 736e 705f 6765 6e6f 7479 7065 732f  }/snp_genotypes/
+0000d860: 616c 6c2f 7b73 616d 706c 655f 7365 747d  all/{sample_set}
+0000d870: 2f22 0a20 2020 2020 2020 2020 2020 2073  /".            s
+0000d880: 746f 7265 203d 2069 6e69 745f 7a61 7272  tore = init_zarr
+0000d890: 5f73 746f 7265 2866 733d 7365 6c66 2e5f  _store(fs=self._
+0000d8a0: 6673 2c20 7061 7468 3d70 6174 6829 0a20  fs, path=path). 
+0000d8b0: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
+0000d8c0: 3d20 7a61 7272 2e6f 7065 6e5f 636f 6e73  = zarr.open_cons
+0000d8d0: 6f6c 6964 6174 6564 2873 746f 7265 3d73  olidated(store=s
+0000d8e0: 746f 7265 290a 2020 2020 2020 2020 2020  tore).          
+0000d8f0: 2020 7365 6c66 2e5f 6361 6368 655f 736e    self._cache_sn
+0000d900: 705f 6765 6e6f 7479 7065 735b 7361 6d70  p_genotypes[samp
+0000d910: 6c65 5f73 6574 5d20 3d20 726f 6f74 0a20  le_set] = root. 
+0000d920: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d930: 6e20 726f 6f74 0a0a 2020 2020 6465 6620  n root..    def 
+0000d940: 5f73 6e70 5f67 656e 6f74 7970 6573 5f66  _snp_genotypes_f
+0000d950: 6f72 5f63 6f6e 7469 6728 0a20 2020 2020  or_contig(.     
+0000d960: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000d970: 202a 2c0a 2020 2020 2020 2020 636f 6e74   *,.        cont
+0000d980: 6967 3a20 7374 722c 0a20 2020 2020 2020  ig: str,.       
+0000d990: 2073 616d 706c 655f 7365 743a 2073 7472   sample_set: str
+0000d9a0: 2c0a 2020 2020 2020 2020 6669 656c 643a  ,.        field:
+0000d9b0: 2073 7472 2c0a 2020 2020 2020 2020 696e   str,.        in
+0000d9c0: 6c69 6e65 5f61 7272 6179 3a20 626f 6f6c  line_array: bool
+0000d9d0: 2c0a 2020 2020 2020 2020 6368 756e 6b73  ,.        chunks
+0000d9e0: 3a20 7374 722c 0a20 2020 2029 202d 3e20  : str,.    ) -> 
+0000d9f0: 6461 2e41 7272 6179 3a0a 2020 2020 2020  da.Array:.      
+0000da00: 2020 2222 2241 6363 6573 7320 534e 5020    """Access SNP 
+0000da10: 6765 6e6f 7479 7065 7320 666f 7220 6120  genotypes for a 
+0000da20: 7369 6e67 6c65 2063 6f6e 7469 6720 616e  single contig an
+0000da30: 6420 6120 7369 6e67 6c65 2073 616d 706c  d a single sampl
+0000da40: 6520 7365 742e 2222 220a 2020 2020 2020  e set.""".      
+0000da50: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+0000da60: 6e63 6528 636f 6e74 6967 2c20 7374 7229  nce(contig, str)
+0000da70: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0000da80: 6973 696e 7374 616e 6365 2873 616d 706c  isinstance(sampl
+0000da90: 655f 7365 742c 2073 7472 290a 2020 2020  e_set, str).    
+0000daa0: 2020 2020 726f 6f74 203d 2073 656c 662e      root = self.
+0000dab0: 6f70 656e 5f73 6e70 5f67 656e 6f74 7970  open_snp_genotyp
+0000dac0: 6573 2873 616d 706c 655f 7365 743d 7361  es(sample_set=sa
+0000dad0: 6d70 6c65 5f73 6574 290a 2020 2020 2020  mple_set).      
+0000dae0: 2020 7a20 3d20 726f 6f74 5b66 227b 636f    z = root[f"{co
+0000daf0: 6e74 6967 7d2f 6361 6c6c 6461 7461 2f7b  ntig}/calldata/{
+0000db00: 6669 656c 647d 225d 0a20 2020 2020 2020  field}"].       
+0000db10: 2064 203d 2064 615f 6672 6f6d 5f7a 6172   d = da_from_zar
+0000db20: 7228 7a2c 2069 6e6c 696e 655f 6172 7261  r(z, inline_arra
+0000db30: 793d 696e 6c69 6e65 5f61 7272 6179 2c20  y=inline_array, 
+0000db40: 6368 756e 6b73 3d63 6875 6e6b 7329 0a0a  chunks=chunks)..
+0000db50: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+0000db60: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+0000db70: 2020 2020 7375 6d6d 6172 793d 2241 6363      summary="Acc
+0000db80: 6573 7320 534e 5020 6765 6e6f 7479 7065  ess SNP genotype
+0000db90: 7320 616e 6420 6173 736f 6369 6174 6564  s and associated
+0000dba0: 2064 6174 612e 222c 0a20 2020 2020 2020   data.",.       
+0000dbb0: 2072 6574 7572 6e73 3d22 2222 0a20 2020   returns=""".   
+0000dbc0: 2020 2020 2020 2020 2041 6e20 6172 7261           An arra
+0000dbd0: 7920 6f66 2065 6974 6865 7220 6765 6e6f  y of either geno
+0000dbe0: 7479 7065 7320 2847 5429 2c20 6765 6e6f  types (GT), geno
+0000dbf0: 7479 7065 2071 7561 6c69 7479 2028 4751  type quality (GQ
+0000dc00: 292c 2061 6c6c 656c 650a 2020 2020 2020  ), allele.      
+0000dc10: 2020 2020 2020 6465 7074 6873 2028 4144        depths (AD
+0000dc20: 2920 6f72 206d 6170 7069 6e67 2071 7561  ) or mapping qua
+0000dc30: 6c69 7479 2028 4d51 2920 7661 6c75 6573  lity (MQ) values
+0000dc40: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
+0000dc50: 2020 2029 0a20 2020 2064 6566 2073 6e70     ).    def snp
+0000dc60: 5f67 656e 6f74 7970 6573 280a 2020 2020  _genotypes(.    
+0000dc70: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000dc80: 2020 7265 6769 6f6e 3a20 6261 7365 5f70    region: base_p
+0000dc90: 6172 616d 732e 7265 6769 6f6e 2c0a 2020  arams.region,.  
+0000dca0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+0000dcb0: 733a 204f 7074 696f 6e61 6c5b 6261 7365  s: Optional[base
+0000dcc0: 5f70 6172 616d 732e 7361 6d70 6c65 5f73  _params.sample_s
+0000dcd0: 6574 735d 203d 204e 6f6e 652c 0a20 2020  ets] = None,.   
+0000dce0: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
+0000dcf0: 793a 204f 7074 696f 6e61 6c5b 6261 7365  y: Optional[base
+0000dd00: 5f70 6172 616d 732e 7361 6d70 6c65 5f71  _params.sample_q
+0000dd10: 7565 7279 5d20 3d20 4e6f 6e65 2c0a 2020  uery] = None,.  
+0000dd20: 2020 2020 2020 6669 656c 643a 2062 6173        field: bas
+0000dd30: 655f 7061 7261 6d73 2e66 6965 6c64 203d  e_params.field =
+0000dd40: 2022 4754 222c 0a20 2020 2020 2020 2073   "GT",.        s
+0000dd50: 6974 655f 6d61 736b 3a20 4f70 7469 6f6e  ite_mask: Option
+0000dd60: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
+0000dd70: 6974 655f 6d61 736b 5d20 3d20 4e6f 6e65  ite_mask] = None
+0000dd80: 2c0a 2020 2020 2020 2020 696e 6c69 6e65  ,.        inline
+0000dd90: 5f61 7272 6179 3a20 6261 7365 5f70 6172  _array: base_par
+0000dda0: 616d 732e 696e 6c69 6e65 5f61 7272 6179  ams.inline_array
+0000ddb0: 203d 2062 6173 655f 7061 7261 6d73 2e69   = base_params.i
+0000ddc0: 6e6c 696e 655f 6172 7261 795f 6465 6661  nline_array_defa
+0000ddd0: 756c 742c 0a20 2020 2020 2020 2063 6875  ult,.        chu
+0000dde0: 6e6b 733a 2062 6173 655f 7061 7261 6d73  nks: base_params
+0000ddf0: 2e63 6875 6e6b 7320 3d20 6261 7365 5f70  .chunks = base_p
+0000de00: 6172 616d 732e 6368 756e 6b73 5f64 6566  arams.chunks_def
+0000de10: 6175 6c74 2c0a 2020 2020 2920 2d3e 2064  ault,.    ) -> d
+0000de20: 612e 4172 7261 793a 0a20 2020 2020 2020  a.Array:.       
+0000de30: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
+0000de40: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
+0000de50: 2020 6465 6275 6728 226e 6f72 6d61 6c69    debug("normali
+0000de60: 7365 2070 6172 616d 6574 6572 7322 290a  se parameters").
+0000de70: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0000de80: 6574 7320 3d20 7365 6c66 2e5f 7072 6570  ets = self._prep
+0000de90: 5f73 616d 706c 655f 7365 7473 5f70 6172  _sample_sets_par
+0000dea0: 616d 2873 616d 706c 655f 7365 7473 3d73  am(sample_sets=s
+0000deb0: 616d 706c 655f 7365 7473 290a 2020 2020  ample_sets).    
+0000dec0: 2020 2020 7265 736f 6c76 6564 5f72 6567      resolved_reg
+0000ded0: 696f 6e20 3d20 7365 6c66 2e72 6573 6f6c  ion = self.resol
+0000dee0: 7665 5f72 6567 696f 6e28 7265 6769 6f6e  ve_region(region
+0000def0: 290a 2020 2020 2020 2020 6465 6c20 7265  ).        del re
+0000df00: 6769 6f6e 0a0a 2020 2020 2020 2020 6465  gion..        de
+0000df10: 6275 6728 226e 6f72 6d61 6c69 7365 2072  bug("normalise r
+0000df20: 6567 696f 6e20 746f 206c 6973 7420 746f  egion to list to
+0000df30: 2073 696d 706c 6966 7920 636f 6e63 6174   simplify concat
+0000df40: 656e 6174 696f 6e20 6c6f 6769 6322 290a  enation logic").
+0000df50: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000df60: 7461 6e63 6528 7265 736f 6c76 6564 5f72  tance(resolved_r
+0000df70: 6567 696f 6e2c 2052 6567 696f 6e29 3a0a  egion, Region):.
+0000df80: 2020 2020 2020 2020 2020 2020 7265 736f              reso
+0000df90: 6c76 6564 5f72 6567 696f 6e20 3d20 5b72  lved_region = [r
+0000dfa0: 6573 6f6c 7665 645f 7265 6769 6f6e 5d0a  esolved_region].
+0000dfb0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0000dfc0: 636f 6e63 6174 656e 6174 6520 6d75 6c74  concatenate mult
+0000dfd0: 6970 6c65 2073 616d 706c 6520 7365 7473  iple sample sets
+0000dfe0: 2061 6e64 2f6f 7220 636f 6e74 6967 7322   and/or contigs"
+0000dff0: 290a 2020 2020 2020 2020 6c78 203d 205b  ).        lx = [
+0000e000: 5d0a 2020 2020 2020 2020 666f 7220 7220  ].        for r 
+0000e010: 696e 2072 6573 6f6c 7665 645f 7265 6769  in resolved_regi
+0000e020: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+0000e030: 6c79 203d 205b 5d0a 0a20 2020 2020 2020  ly = []..       
+0000e040: 2020 2020 2066 6f72 2073 2069 6e20 7361       for s in sa
+0000e050: 6d70 6c65 5f73 6574 733a 0a20 2020 2020  mple_sets:.     
+0000e060: 2020 2020 2020 2020 2020 2079 203d 2073             y = s
+0000e070: 656c 662e 5f73 6e70 5f67 656e 6f74 7970  elf._snp_genotyp
+0000e080: 6573 5f66 6f72 5f63 6f6e 7469 6728 0a20  es_for_contig(. 
+0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0a0: 2020 2063 6f6e 7469 673d 722e 636f 6e74     contig=r.cont
+0000e0b0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+0000e0c0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0000e0d0: 6574 3d73 2c0a 2020 2020 2020 2020 2020  et=s,.          
+0000e0e0: 2020 2020 2020 2020 2020 6669 656c 643d            field=
+0000e0f0: 6669 656c 642c 0a20 2020 2020 2020 2020  field,.         
+0000e100: 2020 2020 2020 2020 2020 2069 6e6c 696e             inlin
+0000e110: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
+0000e120: 7272 6179 2c0a 2020 2020 2020 2020 2020  rray,.          
+0000e130: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
+0000e140: 3d63 6875 6e6b 732c 0a20 2020 2020 2020  =chunks,.       
+0000e150: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e160: 2020 2020 2020 2020 2020 206c 792e 6170             ly.ap
+0000e170: 7065 6e64 2879 290a 0a20 2020 2020 2020  pend(y)..       
+0000e180: 2020 2020 2064 6562 7567 2822 636f 6e63       debug("conc
+0000e190: 6174 656e 6174 6520 6461 7461 2066 726f  atenate data fro
+0000e1a0: 6d20 6d75 6c74 6970 6c65 2073 616d 706c  m multiple sampl
+0000e1b0: 6520 7365 7473 2229 0a20 2020 2020 2020  e sets").       
+0000e1c0: 2020 2020 2078 203d 2064 612e 636f 6e63       x = da.conc
+0000e1d0: 6174 656e 6174 6528 6c79 2c20 6178 6973  atenate(ly, axis
+0000e1e0: 3d31 290a 0a20 2020 2020 2020 2020 2020  =1)..           
+0000e1f0: 2064 6562 7567 2822 6c6f 6361 7465 2072   debug("locate r
+0000e200: 6567 696f 6e20 2d20 646f 2074 6869 7320  egion - do this 
+0000e210: 6f6e 6c79 206f 6e63 652c 206f 7074 696d  only once, optim
+0000e220: 6973 6174 696f 6e22 290a 2020 2020 2020  isation").      
+0000e230: 2020 2020 2020 6966 2072 2e73 7461 7274        if r.start
+0000e240: 206f 7220 722e 656e 643a 0a20 2020 2020   or r.end:.     
+0000e250: 2020 2020 2020 2020 2020 2070 6f73 203d             pos =
+0000e260: 2073 656c 662e 736e 705f 7369 7465 7328   self.snp_sites(
+0000e270: 7265 6769 6f6e 3d72 2e63 6f6e 7469 672c  region=r.contig,
+0000e280: 2066 6965 6c64 3d22 504f 5322 290a 2020   field="POS").  
+0000e290: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0000e2a0: 635f 7265 6769 6f6e 203d 206c 6f63 6174  c_region = locat
+0000e2b0: 655f 7265 6769 6f6e 2872 2c20 706f 7329  e_region(r, pos)
+0000e2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e2d0: 2078 203d 2078 5b6c 6f63 5f72 6567 696f   x = x[loc_regio
+0000e2e0: 6e5d 0a0a 2020 2020 2020 2020 2020 2020  n]..            
+0000e2f0: 6c78 2e61 7070 656e 6428 7829 0a0a 2020  lx.append(x)..  
+0000e300: 2020 2020 2020 6465 6275 6728 2263 6f6e        debug("con
+0000e310: 6361 7465 6e61 7465 2064 6174 6120 6672  catenate data fr
+0000e320: 6f6d 206d 756c 7469 706c 6520 7265 6769  om multiple regi
+0000e330: 6f6e 7322 290a 2020 2020 2020 2020 6420  ons").        d 
+0000e340: 3d20 6461 2e63 6f6e 6361 7465 6e61 7465  = da.concatenate
+0000e350: 286c 782c 2061 7869 733d 3029 0a0a 2020  (lx, axis=0)..  
+0000e360: 2020 2020 2020 6465 6275 6728 2261 7070        debug("app
+0000e370: 6c79 2073 6974 6520 6669 6c74 6572 7320  ly site filters 
+0000e380: 6966 2072 6571 7565 7374 6564 2229 0a20  if requested"). 
+0000e390: 2020 2020 2020 2069 6620 7369 7465 5f6d         if site_m
+0000e3a0: 6173 6b20 6973 206e 6f74 204e 6f6e 653a  ask is not None:
+0000e3b0: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
+0000e3c0: 5f73 6974 6573 203d 2073 656c 662e 7369  _sites = self.si
+0000e3d0: 7465 5f66 696c 7465 7273 280a 2020 2020  te_filters(.    
+0000e3e0: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+0000e3f0: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
+0000e400: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0000e410: 2020 2020 6d61 736b 3d73 6974 655f 6d61      mask=site_ma
+0000e420: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
+0000e430: 290a 2020 2020 2020 2020 2020 2020 6420  ).            d 
+0000e440: 3d20 6461 5f63 6f6d 7072 6573 7328 6c6f  = da_compress(lo
+0000e450: 635f 7369 7465 732c 2064 2c20 6178 6973  c_sites, d, axis
+0000e460: 3d30 290a 0a20 2020 2020 2020 2064 6562  =0)..        deb
+0000e470: 7567 2822 6170 706c 7920 7361 6d70 6c65  ug("apply sample
+0000e480: 2071 7565 7279 2069 6620 7265 7175 6573   query if reques
+0000e490: 7465 6422 290a 2020 2020 2020 2020 6966  ted").        if
+0000e4a0: 2073 616d 706c 655f 7175 6572 7920 6973   sample_query is
+0000e4b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000e4c0: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
+0000e4d0: 7320 3d20 7365 6c66 2e73 616d 706c 655f  s = self.sample_
+0000e4e0: 6d65 7461 6461 7461 2873 616d 706c 655f  metadata(sample_
+0000e4f0: 7365 7473 3d73 616d 706c 655f 7365 7473  sets=sample_sets
+0000e500: 290a 2020 2020 2020 2020 2020 2020 6c6f  ).            lo
+0000e510: 635f 7361 6d70 6c65 7320 3d20 6466 5f73  c_samples = df_s
+0000e520: 616d 706c 6573 2e65 7661 6c28 7361 6d70  amples.eval(samp
+0000e530: 6c65 5f71 7565 7279 292e 7661 6c75 6573  le_query).values
+0000e540: 0a20 2020 2020 2020 2020 2020 2064 203d  .            d =
+0000e550: 2064 612e 636f 6d70 7265 7373 286c 6f63   da.compress(loc
+0000e560: 5f73 616d 706c 6573 2c20 642c 2061 7869  _samples, d, axi
+0000e570: 733d 3129 0a0a 2020 2020 2020 2020 7265  s=1)..        re
+0000e580: 7475 726e 2064 0a0a 2020 2020 4064 6f63  turn d..    @doc
+0000e590: 280a 2020 2020 2020 2020 7375 6d6d 6172  (.        summar
+0000e5a0: 793d 2243 6f6d 7075 7465 2067 656e 6f6d  y="Compute genom
+0000e5b0: 6520 6163 6365 7373 6962 696c 6974 7920  e accessibility 
+0000e5c0: 6172 7261 792e 222c 0a20 2020 2020 2020  array.",.       
+0000e5d0: 2072 6574 7572 6e73 3d22 416e 2061 7272   returns="An arr
+0000e5e0: 6179 206f 6620 626f 6f6c 6561 6e20 7661  ay of boolean va
+0000e5f0: 6c75 6573 2069 6465 6e74 6966 7969 6e67  lues identifying
+0000e600: 2061 6363 6573 7369 626c 6520 6765 6e6f   accessible geno
+0000e610: 6d65 2073 6974 6573 2e22 2c0a 2020 2020  me sites.",.    
+0000e620: 290a 2020 2020 6465 6620 6973 5f61 6363  ).    def is_acc
+0000e630: 6573 7369 626c 6528 0a20 2020 2020 2020  essible(.       
+0000e640: 2073 656c 662c 0a20 2020 2020 2020 2072   self,.        r
+0000e650: 6567 696f 6e3a 2062 6173 655f 7061 7261  egion: base_para
+0000e660: 6d73 2e72 6567 696f 6e2c 0a20 2020 2020  ms.region,.     
+0000e670: 2020 2073 6974 655f 6d61 736b 3a20 6261     site_mask: ba
+0000e680: 7365 5f70 6172 616d 732e 7369 7465 5f6d  se_params.site_m
+0000e690: 6173 6b20 3d20 4445 4641 554c 542c 0a20  ask = DEFAULT,. 
+0000e6a0: 2020 2029 202d 3e20 6e70 2e6e 6461 7272     ) -> np.ndarr
+0000e6b0: 6179 3a0a 2020 2020 2020 2020 6465 6275  ay:.        debu
+0000e6c0: 6720 3d20 7365 6c66 2e5f 6c6f 672e 6465  g = self._log.de
+0000e6d0: 6275 670a 0a20 2020 2020 2020 2064 6562  bug..        deb
+0000e6e0: 7567 2822 7265 736f 6c76 6520 7265 6769  ug("resolve regi
+0000e6f0: 6f6e 2229 0a20 2020 2020 2020 2072 6573  on").        res
+0000e700: 6f6c 7665 645f 7265 6769 6f6e 203d 2073  olved_region = s
+0000e710: 656c 662e 7265 736f 6c76 655f 7265 6769  elf.resolve_regi
+0000e720: 6f6e 2872 6567 696f 6e29 0a20 2020 2020  on(region).     
+0000e730: 2020 2064 656c 2072 6567 696f 6e0a 0a20     del region.. 
+0000e740: 2020 2020 2020 2064 6562 7567 2822 6465         debug("de
+0000e750: 7465 726d 696e 6520 636f 6e74 6967 2073  termine contig s
+0000e760: 6571 7565 6e63 6520 6c65 6e67 7468 2229  equence length")
+0000e770: 0a20 2020 2020 2020 2073 6571 5f6c 656e  .        seq_len
+0000e780: 6774 6820 3d20 7365 6c66 2e67 656e 6f6d  gth = self.genom
+0000e790: 655f 7365 7175 656e 6365 2872 6573 6f6c  e_sequence(resol
+0000e7a0: 7665 645f 7265 6769 6f6e 292e 7368 6170  ved_region).shap
+0000e7b0: 655b 305d 0a0a 2020 2020 2020 2020 6465  e[0]..        de
+0000e7c0: 6275 6728 2273 6574 2075 7020 6f75 7470  bug("set up outp
+0000e7d0: 7574 2229 0a20 2020 2020 2020 2069 735f  ut").        is_
+0000e7e0: 6163 6365 7373 6962 6c65 203d 206e 702e  accessible = np.
+0000e7f0: 7a65 726f 7328 7365 715f 6c65 6e67 7468  zeros(seq_length
+0000e800: 2c20 6474 7970 653d 626f 6f6c 290a 0a20  , dtype=bool).. 
+0000e810: 2020 2020 2020 2070 6f73 203d 2073 656c         pos = sel
+0000e820: 662e 736e 705f 7369 7465 7328 7265 6769  f.snp_sites(regi
+0000e830: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
+0000e840: 6f6e 2c20 6669 656c 643d 2250 4f53 2229  on, field="POS")
+0000e850: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
+0000e860: 2020 2069 6620 7265 736f 6c76 6564 5f72     if resolved_r
+0000e870: 6567 696f 6e2e 7374 6172 743a 0a20 2020  egion.start:.   
+0000e880: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
+0000e890: 3d20 7265 736f 6c76 6564 5f72 6567 696f  = resolved_regio
+0000e8a0: 6e2e 7374 6172 740a 2020 2020 2020 2020  n.start.        
+0000e8b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e8c0: 2020 6f66 6673 6574 203d 2031 0a0a 2020    offset = 1..  
+0000e8d0: 2020 2020 2020 6465 6275 6728 2261 6363        debug("acc
+0000e8e0: 6573 7320 7369 7465 2066 696c 7465 7273  ess site filters
+0000e8f0: 2229 0a20 2020 2020 2020 2066 696c 7465  ").        filte
+0000e900: 725f 7061 7373 203d 2073 656c 662e 7369  r_pass = self.si
+0000e910: 7465 5f66 696c 7465 7273 280a 2020 2020  te_filters(.    
+0000e920: 2020 2020 2020 2020 7265 6769 6f6e 3d72          region=r
+0000e930: 6573 6f6c 7665 645f 7265 6769 6f6e 2c0a  esolved_region,.
+0000e940: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+0000e950: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
+0000e960: 2020 2020 292e 636f 6d70 7574 6528 290a      ).compute().
+0000e970: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0000e980: 6173 7369 676e 2076 616c 7565 7320 6672  assign values fr
+0000e990: 6f6d 2073 6974 6520 6669 6c74 6572 7322  om site filters"
+0000e9a0: 290a 2020 2020 2020 2020 6973 5f61 6363  ).        is_acc
+0000e9b0: 6573 7369 626c 655b 706f 7320 2d20 6f66  essible[pos - of
+0000e9c0: 6673 6574 5d20 3d20 6669 6c74 6572 5f70  fset] = filter_p
+0000e9d0: 6173 730a 0a20 2020 2020 2020 2072 6574  ass..        ret
+0000e9e0: 7572 6e20 6973 5f61 6363 6573 7369 626c  urn is_accessibl
+0000e9f0: 650a 0a20 2020 2064 6566 205f 736e 705f  e..    def _snp_
+0000ea00: 6466 2873 656c 662c 202a 2c20 7472 616e  df(self, *, tran
+0000ea10: 7363 7269 7074 3a20 7374 7229 202d 3e20  script: str) -> 
+0000ea20: 5475 706c 655b 5265 6769 6f6e 2c20 7064  Tuple[Region, pd
+0000ea30: 2e44 6174 6146 7261 6d65 5d3a 0a20 2020  .DataFrame]:.   
+0000ea40: 2020 2020 2022 2222 5365 7420 7570 2061       """Set up a
+0000ea50: 2064 6174 6166 7261 6d65 2077 6974 6820   dataframe with 
+0000ea60: 534e 5020 7369 7465 2061 6e64 2066 696c  SNP site and fil
+0000ea70: 7465 7220 636f 6c75 6d6e 732e 2222 220a  ter columns.""".
+0000ea80: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
+0000ea90: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
+0000eaa0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0000eab0: 6765 7420 6665 6174 7572 6520 6469 7265  get feature dire
+0000eac0: 6374 2066 726f 6d20 6765 6e6f 6d65 5f66  ct from genome_f
+0000ead0: 6561 7475 7265 7322 290a 2020 2020 2020  eatures").      
+0000eae0: 2020 6773 203d 2073 656c 662e 6765 6e6f    gs = self.geno
+0000eaf0: 6d65 5f66 6561 7475 7265 7328 290a 2020  me_features().  
+0000eb00: 2020 2020 2020 6665 6174 7572 6520 3d20        feature = 
+0000eb10: 6773 5b67 735b 2249 4422 5d20 3d3d 2074  gs[gs["ID"] == t
+0000eb20: 7261 6e73 6372 6970 745d 2e73 7175 6565  ranscript].squee
+0000eb30: 7a65 2829 0a20 2020 2020 2020 2069 6620  ze().        if 
+0000eb40: 6665 6174 7572 652e 656d 7074 793a 0a20  feature.empty:. 
+0000eb50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000eb60: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0000eb70: 2020 2020 2020 2020 2020 2020 2066 224e               f"N
+0000eb80: 6f20 6765 6e6f 6d65 2066 6561 7475 7265  o genome feature
+0000eb90: 2049 4420 666f 756e 6420 6d61 7463 6869   ID found matchi
+0000eba0: 6e67 2074 7261 6e73 6372 6970 7420 7b74  ng transcript {t
+0000ebb0: 7261 6e73 6372 6970 747d 220a 2020 2020  ranscript}".    
+0000ebc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ebd0: 2020 636f 6e74 6967 203d 2066 6561 7475    contig = featu
+0000ebe0: 7265 2e63 6f6e 7469 670a 2020 2020 2020  re.contig.      
+0000ebf0: 2020 7265 6769 6f6e 203d 2052 6567 696f    region = Regio
+0000ec00: 6e28 636f 6e74 6967 2c20 6665 6174 7572  n(contig, featur
+0000ec10: 652e 7374 6172 742c 2066 6561 7475 7265  e.start, feature
+0000ec20: 2e65 6e64 290a 0a20 2020 2020 2020 2064  .end)..        d
+0000ec30: 6562 7567 2822 6772 6162 2070 6f73 2c20  ebug("grab pos, 
+0000ec40: 7265 6620 616e 6420 616c 7420 666f 7220  ref and alt for 
+0000ec50: 6368 726f 6d20 6172 6d20 6672 6f6d 2073  chrom arm from s
+0000ec60: 6e70 5f73 6974 6573 2229 0a20 2020 2020  np_sites").     
+0000ec70: 2020 2070 6f73 203d 2073 656c 662e 736e     pos = self.sn
+0000ec80: 705f 7369 7465 7328 7265 6769 6f6e 3d63  p_sites(region=c
+0000ec90: 6f6e 7469 672c 2066 6965 6c64 3d22 504f  ontig, field="PO
+0000eca0: 5322 290a 2020 2020 2020 2020 7265 6620  S").        ref 
+0000ecb0: 3d20 7365 6c66 2e73 6e70 5f73 6974 6573  = self.snp_sites
+0000ecc0: 2872 6567 696f 6e3d 636f 6e74 6967 2c20  (region=contig, 
+0000ecd0: 6669 656c 643d 2252 4546 2229 0a20 2020  field="REF").   
+0000ece0: 2020 2020 2061 6c74 203d 2073 656c 662e       alt = self.
+0000ecf0: 736e 705f 7369 7465 7328 7265 6769 6f6e  snp_sites(region
+0000ed00: 3d63 6f6e 7469 672c 2066 6965 6c64 3d22  =contig, field="
+0000ed10: 414c 5422 290a 2020 2020 2020 2020 6c6f  ALT").        lo
+0000ed20: 635f 6665 6174 7572 6520 3d20 6c6f 6361  c_feature = loca
+0000ed30: 7465 5f72 6567 696f 6e28 7265 6769 6f6e  te_region(region
+0000ed40: 2c20 706f 7329 0a20 2020 2020 2020 2070  , pos).        p
+0000ed50: 6f73 203d 2070 6f73 5b6c 6f63 5f66 6561  os = pos[loc_fea
+0000ed60: 7475 7265 5d2e 636f 6d70 7574 6528 290a  ture].compute().
+0000ed70: 2020 2020 2020 2020 7265 6620 3d20 7265          ref = re
+0000ed80: 665b 6c6f 635f 6665 6174 7572 655d 2e63  f[loc_feature].c
+0000ed90: 6f6d 7075 7465 2829 0a20 2020 2020 2020  ompute().       
+0000eda0: 2061 6c74 203d 2061 6c74 5b6c 6f63 5f66   alt = alt[loc_f
+0000edb0: 6561 7475 7265 5d2e 636f 6d70 7574 6528  eature].compute(
+0000edc0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+0000edd0: 2822 6163 6365 7373 2073 6974 6520 6669  ("access site fi
+0000ede0: 6c74 6572 7322 290a 2020 2020 2020 2020  lters").        
+0000edf0: 6669 6c74 6572 5f70 6173 7320 3d20 6469  filter_pass = di
+0000ee00: 6374 2829 0a20 2020 2020 2020 206d 6173  ct().        mas
+0000ee10: 6b73 203d 2073 656c 662e 7369 7465 5f6d  ks = self.site_m
+0000ee20: 6173 6b5f 6964 730a 2020 2020 2020 2020  ask_ids.        
+0000ee30: 666f 7220 6d20 696e 206d 6173 6b73 3a0a  for m in masks:.
+0000ee40: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0000ee50: 7365 6c66 2e73 6974 655f 6669 6c74 6572  self.site_filter
+0000ee60: 7328 7265 6769 6f6e 3d63 6f6e 7469 672c  s(region=contig,
+0000ee70: 206d 6173 6b3d 6d29 0a20 2020 2020 2020   mask=m).       
+0000ee80: 2020 2020 2078 203d 2078 5b6c 6f63 5f66       x = x[loc_f
+0000ee90: 6561 7475 7265 5d2e 636f 6d70 7574 6528  eature].compute(
+0000eea0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+0000eeb0: 6c74 6572 5f70 6173 735b 6d5d 203d 2078  lter_pass[m] = x
+0000eec0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0000eed0: 2273 6574 2075 7020 636f 6c75 6d6e 7320  "set up columns 
+0000eee0: 7769 7468 2063 6f6e 7469 672c 2070 6f73  with contig, pos
+0000eef0: 2c20 7265 662c 2061 6c74 2063 6f6c 756d  , ref, alt colum
+0000ef00: 6e73 2229 0a20 2020 2020 2020 2063 6f6c  ns").        col
+0000ef10: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+0000ef20: 2020 2263 6f6e 7469 6722 3a20 636f 6e74    "contig": cont
+0000ef30: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+0000ef40: 2270 6f73 6974 696f 6e22 3a20 6e70 2e72  "position": np.r
+0000ef50: 6570 6561 7428 706f 732c 2033 292c 0a20  epeat(pos, 3),. 
+0000ef60: 2020 2020 2020 2020 2020 2022 7265 665f             "ref_
+0000ef70: 616c 6c65 6c65 223a 206e 702e 7265 7065  allele": np.repe
+0000ef80: 6174 2872 6566 2e61 7374 7970 6528 2255  at(ref.astype("U
+0000ef90: 3122 292c 2033 292c 0a20 2020 2020 2020  1"), 3),.       
+0000efa0: 2020 2020 2022 616c 745f 616c 6c65 6c65       "alt_allele
+0000efb0: 223a 2061 6c74 2e61 7374 7970 6528 2255  ": alt.astype("U
+0000efc0: 3122 292e 666c 6174 7465 6e28 292c 0a20  1").flatten(),. 
+0000efd0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0000efe0: 2020 6465 6275 6728 2261 6464 206d 6173    debug("add mas
+0000eff0: 6b20 636f 6c75 6d6e 7322 290a 2020 2020  k columns").    
+0000f000: 2020 2020 666f 7220 6d20 696e 206d 6173      for m in mas
+0000f010: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+0000f020: 7820 3d20 6669 6c74 6572 5f70 6173 735b  x = filter_pass[
+0000f030: 6d5d 0a20 2020 2020 2020 2020 2020 2063  m].            c
+0000f040: 6f6c 735b 6622 7061 7373 5f7b 6d7d 225d  ols[f"pass_{m}"]
+0000f050: 203d 206e 702e 7265 7065 6174 2878 2c20   = np.repeat(x, 
+0000f060: 3329 0a0a 2020 2020 2020 2020 6465 6275  3)..        debu
+0000f070: 6728 2263 6f6e 7374 7275 6374 2064 6174  g("construct dat
+0000f080: 6166 7261 6d65 2229 0a20 2020 2020 2020  aframe").       
+0000f090: 2064 665f 736e 7073 203d 2070 642e 4461   df_snps = pd.Da
+0000f0a0: 7461 4672 616d 6528 636f 6c73 290a 0a20  taFrame(cols).. 
+0000f0b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000f0c0: 6769 6f6e 2c20 6466 5f73 6e70 730a 0a20  gion, df_snps.. 
+0000f0d0: 2020 2064 6566 205f 616e 6e6f 7461 746f     def _annotato
+0000f0e0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+0000f0f0: 2022 2222 5365 7420 7570 2076 6172 6961   """Set up varia
+0000f100: 6e74 2065 6666 6563 7420 616e 6e6f 7461  nt effect annota
+0000f110: 746f 722e 2222 220a 2020 2020 2020 2020  tor.""".        
+0000f120: 6966 2073 656c 662e 5f63 6163 6865 5f61  if self._cache_a
+0000f130: 6e6e 6f74 6174 6f72 2069 7320 4e6f 6e65  nnotator is None
+0000f140: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000f150: 6c66 2e5f 6361 6368 655f 616e 6e6f 7461  lf._cache_annota
+0000f160: 746f 7220 3d20 7665 6666 2e41 6e6e 6f74  tor = veff.Annot
+0000f170: 6174 6f72 280a 2020 2020 2020 2020 2020  ator(.          
+0000f180: 2020 2020 2020 6765 6e6f 6d65 3d73 656c        genome=sel
+0000f190: 662e 6f70 656e 5f67 656e 6f6d 6528 292c  f.open_genome(),
+0000f1a0: 2067 656e 6f6d 655f 6665 6174 7572 6573   genome_features
+0000f1b0: 3d73 656c 662e 6765 6e6f 6d65 5f66 6561  =self.genome_fea
+0000f1c0: 7475 7265 7328 290a 2020 2020 2020 2020  tures().        
+0000f1d0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0000f1e0: 7475 726e 2073 656c 662e 5f63 6163 6865  turn self._cache
+0000f1f0: 5f61 6e6e 6f74 6174 6f72 0a0a 2020 2020  _annotator..    
+0000f200: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
+0000f210: 6d6d 6172 793d 2243 6f6d 7075 7465 2076  mmary="Compute v
+0000f220: 6172 6961 6e74 2065 6666 6563 7473 2066  ariant effects f
+0000f230: 6f72 2061 2067 656e 6520 7472 616e 7363  or a gene transc
+0000f240: 7269 7074 2e22 2c0a 2020 2020 2020 2020  ript.",.        
+0000f250: 7265 7475 726e 733d 2222 220a 2020 2020  returns=""".    
+0000f260: 2020 2020 2020 2020 4120 6461 7461 6672          A datafr
+0000f270: 616d 6520 6f66 2061 6c6c 2070 6f73 7369  ame of all possi
+0000f280: 626c 6520 534e 5020 7661 7269 616e 7473  ble SNP variants
+0000f290: 2061 6e64 2074 6865 6972 2065 6666 6563   and their effec
+0000f2a0: 7473 2c20 6f6e 6520 726f 770a 2020 2020  ts, one row.    
+0000f2b0: 2020 2020 2020 2020 7065 7220 7661 7269          per vari
+0000f2c0: 616e 742e 0a20 2020 2020 2020 2022 2222  ant..        """
+0000f2d0: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
+0000f2e0: 736e 705f 6566 6665 6374 7328 0a20 2020  snp_effects(.   
+0000f2f0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000f300: 2020 2074 7261 6e73 6372 6970 743a 2062     transcript: b
+0000f310: 6173 655f 7061 7261 6d73 2e74 7261 6e73  ase_params.trans
+0000f320: 6372 6970 742c 0a20 2020 2020 2020 2073  cript,.        s
+0000f330: 6974 655f 6d61 736b 3a20 4f70 7469 6f6e  ite_mask: Option
+0000f340: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
+0000f350: 6974 655f 6d61 736b 5d20 3d20 4e6f 6e65  ite_mask] = None
+0000f360: 2c0a 2020 2020 2920 2d3e 2070 642e 4461  ,.    ) -> pd.Da
+0000f370: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
+0000f380: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
+0000f390: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
+0000f3a0: 2020 6465 6275 6728 2273 6574 7570 2069    debug("setup i
+0000f3b0: 6e69 7469 616c 2064 6174 6166 7261 6d65  nitial dataframe
+0000f3c0: 206f 6620 534e 5073 2229 0a20 2020 2020   of SNPs").     
+0000f3d0: 2020 205f 2c20 6466 5f73 6e70 7320 3d20     _, df_snps = 
+0000f3e0: 7365 6c66 2e5f 736e 705f 6466 2874 7261  self._snp_df(tra
+0000f3f0: 6e73 6372 6970 743d 7472 616e 7363 7269  nscript=transcri
+0000f400: 7074 290a 0a20 2020 2020 2020 2064 6562  pt)..        deb
+0000f410: 7567 2822 7365 7475 7020 7661 7269 616e  ug("setup varian
+0000f420: 7420 6566 6665 6374 2061 6e6e 6f74 6174  t effect annotat
+0000f430: 6f72 2229 0a20 2020 2020 2020 2061 6e6e  or").        ann
+0000f440: 203d 2073 656c 662e 5f61 6e6e 6f74 6174   = self._annotat
+0000f450: 6f72 2829 0a0a 2020 2020 2020 2020 6465  or()..        de
+0000f460: 6275 6728 2261 7070 6c79 206d 6173 6b20  bug("apply mask 
+0000f470: 6966 2072 6571 7565 7374 6564 2229 0a20  if requested"). 
+0000f480: 2020 2020 2020 2069 6620 7369 7465 5f6d         if site_m
+0000f490: 6173 6b20 6973 206e 6f74 204e 6f6e 653a  ask is not None:
+0000f4a0: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
+0000f4b0: 5f73 6974 6573 203d 2064 665f 736e 7073  _sites = df_snps
+0000f4c0: 5b66 2270 6173 735f 7b73 6974 655f 6d61  [f"pass_{site_ma
+0000f4d0: 736b 7d22 5d0a 2020 2020 2020 2020 2020  sk}"].          
+0000f4e0: 2020 6466 5f73 6e70 7320 3d20 6466 5f73    df_snps = df_s
+0000f4f0: 6e70 732e 6c6f 635b 6c6f 635f 7369 7465  nps.loc[loc_site
+0000f500: 735d 0a0a 2020 2020 2020 2020 6465 6275  s]..        debu
+0000f510: 6728 2272 6573 6574 2069 6e64 6578 2061  g("reset index a
+0000f520: 6674 6572 2066 696c 7465 7269 6e67 2229  fter filtering")
+0000f530: 0a20 2020 2020 2020 2064 665f 736e 7073  .        df_snps
+0000f540: 2e72 6573 6574 5f69 6e64 6578 2869 6e70  .reset_index(inp
+0000f550: 6c61 6365 3d54 7275 652c 2064 726f 703d  lace=True, drop=
+0000f560: 5472 7565 290a 0a20 2020 2020 2020 2064  True)..        d
+0000f570: 6562 7567 2822 6164 6420 6566 6665 6374  ebug("add effect
+0000f580: 7320 746f 2074 6865 2064 6174 6166 7261  s to the datafra
+0000f590: 6d65 2229 0a20 2020 2020 2020 2061 6e6e  me").        ann
+0000f5a0: 2e67 6574 5f65 6666 6563 7473 2874 7261  .get_effects(tra
+0000f5b0: 6e73 6372 6970 743d 7472 616e 7363 7269  nscript=transcri
+0000f5c0: 7074 2c20 7661 7269 616e 7473 3d64 665f  pt, variants=df_
+0000f5d0: 736e 7073 290a 0a20 2020 2020 2020 2072  snps)..        r
+0000f5e0: 6574 7572 6e20 6466 5f73 6e70 730a 0a20  eturn df_snps.. 
+0000f5f0: 2020 2064 6566 205f 736e 705f 7661 7269     def _snp_vari
+0000f600: 616e 7473 5f66 6f72 5f63 6f6e 7469 6728  ants_for_contig(
+0000f610: 7365 6c66 2c20 2a2c 2063 6f6e 7469 672c  self, *, contig,
+0000f620: 2069 6e6c 696e 655f 6172 7261 792c 2063   inline_array, c
+0000f630: 6875 6e6b 7329 3a0a 2020 2020 2020 2020  hunks):.        
+0000f640: 6465 6275 6720 3d20 7365 6c66 2e5f 6c6f  debug = self._lo
+0000f650: 672e 6465 6275 670a 0a20 2020 2020 2020  g.debug..       
+0000f660: 2063 6f6f 7264 7320 3d20 6469 6374 2829   coords = dict()
+0000f670: 0a20 2020 2020 2020 2064 6174 615f 7661  .        data_va
+0000f680: 7273 203d 2064 6963 7428 290a 0a20 2020  rs = dict()..   
+0000f690: 2020 2020 2064 6562 7567 2822 7661 7269       debug("vari
+0000f6a0: 616e 7420 6172 7261 7973 2229 0a20 2020  ant arrays").   
+0000f6b0: 2020 2020 2073 6974 6573 5f72 6f6f 7420       sites_root 
+0000f6c0: 3d20 7365 6c66 2e6f 7065 6e5f 736e 705f  = self.open_snp_
+0000f6d0: 7369 7465 7328 290a 0a20 2020 2020 2020  sites()..       
+0000f6e0: 2064 6562 7567 2822 7661 7269 616e 745f   debug("variant_
+0000f6f0: 706f 7369 7469 6f6e 2229 0a20 2020 2020  position").     
+0000f700: 2020 2070 6f73 5f7a 203d 2073 6974 6573     pos_z = sites
+0000f710: 5f72 6f6f 745b 6622 7b63 6f6e 7469 677d  _root[f"{contig}
+0000f720: 2f76 6172 6961 6e74 732f 504f 5322 5d0a  /variants/POS"].
+0000f730: 2020 2020 2020 2020 7661 7269 616e 745f          variant_
+0000f740: 706f 7369 7469 6f6e 203d 2064 615f 6672  position = da_fr
+0000f750: 6f6d 5f7a 6172 7228 706f 735f 7a2c 2069  om_zarr(pos_z, i
+0000f760: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
+0000f770: 6e65 5f61 7272 6179 2c20 6368 756e 6b73  ne_array, chunks
+0000f780: 3d63 6875 6e6b 7329 0a20 2020 2020 2020  =chunks).       
+0000f790: 2063 6f6f 7264 735b 2276 6172 6961 6e74   coords["variant
+0000f7a0: 5f70 6f73 6974 696f 6e22 5d20 3d20 5b44  _position"] = [D
+0000f7b0: 494d 5f56 4152 4941 4e54 5d2c 2076 6172  IM_VARIANT], var
+0000f7c0: 6961 6e74 5f70 6f73 6974 696f 6e0a 0a20  iant_position.. 
+0000f7d0: 2020 2020 2020 2064 6562 7567 2822 7661         debug("va
+0000f7e0: 7269 616e 745f 616c 6c65 6c65 2229 0a20  riant_allele"). 
+0000f7f0: 2020 2020 2020 2072 6566 5f7a 203d 2073         ref_z = s
+0000f800: 6974 6573 5f72 6f6f 745b 6622 7b63 6f6e  ites_root[f"{con
+0000f810: 7469 677d 2f76 6172 6961 6e74 732f 5245  tig}/variants/RE
+0000f820: 4622 5d0a 2020 2020 2020 2020 616c 745f  F"].        alt_
+0000f830: 7a20 3d20 7369 7465 735f 726f 6f74 5b66  z = sites_root[f
+0000f840: 227b 636f 6e74 6967 7d2f 7661 7269 616e  "{contig}/varian
+0000f850: 7473 2f41 4c54 225d 0a20 2020 2020 2020  ts/ALT"].       
+0000f860: 2072 6566 203d 2064 615f 6672 6f6d 5f7a   ref = da_from_z
+0000f870: 6172 7228 7265 665f 7a2c 2069 6e6c 696e  arr(ref_z, inlin
+0000f880: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
+0000f890: 7272 6179 2c20 6368 756e 6b73 3d63 6875  rray, chunks=chu
+0000f8a0: 6e6b 7329 0a20 2020 2020 2020 2061 6c74  nks).        alt
+0000f8b0: 203d 2064 615f 6672 6f6d 5f7a 6172 7228   = da_from_zarr(
+0000f8c0: 616c 745f 7a2c 2069 6e6c 696e 655f 6172  alt_z, inline_ar
+0000f8d0: 7261 793d 696e 6c69 6e65 5f61 7272 6179  ray=inline_array
+0000f8e0: 2c20 6368 756e 6b73 3d63 6875 6e6b 7329  , chunks=chunks)
+0000f8f0: 0a20 2020 2020 2020 2076 6172 6961 6e74  .        variant
+0000f900: 5f61 6c6c 656c 6520 3d20 6461 2e63 6f6e  _allele = da.con
+0000f910: 6361 7465 6e61 7465 285b 7265 665b 3a2c  catenate([ref[:,
+0000f920: 204e 6f6e 655d 2c20 616c 745d 2c20 6178   None], alt], ax
+0000f930: 6973 3d31 290a 2020 2020 2020 2020 6461  is=1).        da
+0000f940: 7461 5f76 6172 735b 2276 6172 6961 6e74  ta_vars["variant
+0000f950: 5f61 6c6c 656c 6522 5d20 3d20 5b44 494d  _allele"] = [DIM
+0000f960: 5f56 4152 4941 4e54 2c20 4449 4d5f 414c  _VARIANT, DIM_AL
+0000f970: 4c45 4c45 5d2c 2076 6172 6961 6e74 5f61  LELE], variant_a
+0000f980: 6c6c 656c 650a 0a20 2020 2020 2020 2064  llele..        d
+0000f990: 6562 7567 2822 7661 7269 616e 745f 636f  ebug("variant_co
+0000f9a0: 6e74 6967 2229 0a20 2020 2020 2020 2063  ntig").        c
+0000f9b0: 6f6e 7469 675f 696e 6465 7820 3d20 7365  ontig_index = se
+0000f9c0: 6c66 2e63 6f6e 7469 6773 2e69 6e64 6578  lf.contigs.index
+0000f9d0: 2863 6f6e 7469 6729 0a20 2020 2020 2020  (contig).       
+0000f9e0: 2076 6172 6961 6e74 5f63 6f6e 7469 6720   variant_contig 
+0000f9f0: 3d20 6461 2e66 756c 6c5f 6c69 6b65 280a  = da.full_like(.
+0000fa00: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0000fa10: 616e 745f 706f 7369 7469 6f6e 2c20 6669  ant_position, fi
+0000fa20: 6c6c 5f76 616c 7565 3d63 6f6e 7469 675f  ll_value=contig_
+0000fa30: 696e 6465 782c 2064 7479 7065 3d22 7531  index, dtype="u1
+0000fa40: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+0000fa50: 2020 2020 636f 6f72 6473 5b22 7661 7269      coords["vari
+0000fa60: 616e 745f 636f 6e74 6967 225d 203d 205b  ant_contig"] = [
+0000fa70: 4449 4d5f 5641 5249 414e 545d 2c20 7661  DIM_VARIANT], va
+0000fa80: 7269 616e 745f 636f 6e74 6967 0a0a 2020  riant_contig..  
+0000fa90: 2020 2020 2020 6465 6275 6728 2273 6974        debug("sit
+0000faa0: 6520 6669 6c74 6572 7320 6172 7261 7973  e filters arrays
+0000fab0: 2229 0a20 2020 2020 2020 2066 6f72 206d  ").        for m
+0000fac0: 6173 6b20 696e 2073 656c 662e 7369 7465  ask in self.site
+0000fad0: 5f6d 6173 6b5f 6964 733a 0a20 2020 2020  _mask_ids:.     
+0000fae0: 2020 2020 2020 2066 696c 7465 7273 5f72         filters_r
+0000faf0: 6f6f 7420 3d20 7365 6c66 2e6f 7065 6e5f  oot = self.open_
+0000fb00: 7369 7465 5f66 696c 7465 7273 286d 6173  site_filters(mas
+0000fb10: 6b3d 6d61 736b 290a 2020 2020 2020 2020  k=mask).        
+0000fb20: 2020 2020 7a20 3d20 6669 6c74 6572 735f      z = filters_
+0000fb30: 726f 6f74 5b66 227b 636f 6e74 6967 7d2f  root[f"{contig}/
+0000fb40: 7661 7269 616e 7473 2f66 696c 7465 725f  variants/filter_
+0000fb50: 7061 7373 225d 0a20 2020 2020 2020 2020  pass"].         
+0000fb60: 2020 2064 203d 2064 615f 6672 6f6d 5f7a     d = da_from_z
+0000fb70: 6172 7228 7a2c 2069 6e6c 696e 655f 6172  arr(z, inline_ar
+0000fb80: 7261 793d 696e 6c69 6e65 5f61 7272 6179  ray=inline_array
+0000fb90: 2c20 6368 756e 6b73 3d63 6875 6e6b 7329  , chunks=chunks)
+0000fba0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0000fbb0: 615f 7661 7273 5b66 2276 6172 6961 6e74  a_vars[f"variant
+0000fbc0: 5f66 696c 7465 725f 7061 7373 5f7b 6d61  _filter_pass_{ma
+0000fbd0: 736b 7d22 5d20 3d20 5b44 494d 5f56 4152  sk}"] = [DIM_VAR
+0000fbe0: 4941 4e54 5d2c 2064 0a0a 2020 2020 2020  IANT], d..      
+0000fbf0: 2020 6465 6275 6728 2273 6574 2075 7020    debug("set up 
+0000fc00: 6174 7472 6962 7574 6573 2229 0a20 2020  attributes").   
+0000fc10: 2020 2020 2061 7474 7273 203d 207b 2263       attrs = {"c
+0000fc20: 6f6e 7469 6773 223a 2073 656c 662e 636f  ontigs": self.co
+0000fc30: 6e74 6967 737d 0a0a 2020 2020 2020 2020  ntigs}..        
+0000fc40: 6465 6275 6728 2263 7265 6174 6520 6120  debug("create a 
+0000fc50: 6461 7461 7365 7422 290a 2020 2020 2020  dataset").      
+0000fc60: 2020 6473 203d 2078 722e 4461 7461 7365    ds = xr.Datase
+0000fc70: 7428 6461 7461 5f76 6172 733d 6461 7461  t(data_vars=data
+0000fc80: 5f76 6172 732c 2063 6f6f 7264 733d 636f  _vars, coords=co
+0000fc90: 6f72 6473 2c20 6174 7472 733d 6174 7472  ords, attrs=attr
+0000fca0: 7329 0a0a 2020 2020 2020 2020 7265 7475  s)..        retu
+0000fcb0: 726e 2064 730a 0a20 2020 2064 6566 205f  rn ds..    def _
+0000fcc0: 736e 705f 6361 6c6c 735f 666f 725f 636f  snp_calls_for_co
+0000fcd0: 6e74 6967 2873 656c 662c 202a 2c20 636f  ntig(self, *, co
+0000fce0: 6e74 6967 2c20 7361 6d70 6c65 5f73 6574  ntig, sample_set
+0000fcf0: 2c20 696e 6c69 6e65 5f61 7272 6179 2c20  , inline_array, 
+0000fd00: 6368 756e 6b73 293a 0a20 2020 2020 2020  chunks):.       
+0000fd10: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
+0000fd20: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
+0000fd30: 2020 636f 6f72 6473 203d 2064 6963 7428    coords = dict(
+0000fd40: 290a 2020 2020 2020 2020 6461 7461 5f76  ).        data_v
+0000fd50: 6172 7320 3d20 6469 6374 2829 0a0a 2020  ars = dict()..  
+0000fd60: 2020 2020 2020 6465 6275 6728 2263 616c        debug("cal
+0000fd70: 6c20 6172 7261 7973 2229 0a20 2020 2020  l arrays").     
+0000fd80: 2020 2063 616c 6c73 5f72 6f6f 7420 3d20     calls_root = 
+0000fd90: 7365 6c66 2e6f 7065 6e5f 736e 705f 6765  self.open_snp_ge
+0000fda0: 6e6f 7479 7065 7328 7361 6d70 6c65 5f73  notypes(sample_s
+0000fdb0: 6574 3d73 616d 706c 655f 7365 7429 0a20  et=sample_set). 
+0000fdc0: 2020 2020 2020 2067 745f 7a20 3d20 6361         gt_z = ca
+0000fdd0: 6c6c 735f 726f 6f74 5b66 227b 636f 6e74  lls_root[f"{cont
+0000fde0: 6967 7d2f 6361 6c6c 6461 7461 2f47 5422  ig}/calldata/GT"
+0000fdf0: 5d0a 2020 2020 2020 2020 6361 6c6c 5f67  ].        call_g
+0000fe00: 656e 6f74 7970 6520 3d20 6461 5f66 726f  enotype = da_fro
+0000fe10: 6d5f 7a61 7272 2867 745f 7a2c 2069 6e6c  m_zarr(gt_z, inl
+0000fe20: 696e 655f 6172 7261 793d 696e 6c69 6e65  ine_array=inline
+0000fe30: 5f61 7272 6179 2c20 6368 756e 6b73 3d63  _array, chunks=c
+0000fe40: 6875 6e6b 7329 0a20 2020 2020 2020 2067  hunks).        g
+0000fe50: 715f 7a20 3d20 6361 6c6c 735f 726f 6f74  q_z = calls_root
+0000fe60: 5b66 227b 636f 6e74 6967 7d2f 6361 6c6c  [f"{contig}/call
+0000fe70: 6461 7461 2f47 5122 5d0a 2020 2020 2020  data/GQ"].      
+0000fe80: 2020 6361 6c6c 5f67 7120 3d20 6461 5f66    call_gq = da_f
+0000fe90: 726f 6d5f 7a61 7272 2867 715f 7a2c 2069  rom_zarr(gq_z, i
+0000fea0: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
+0000feb0: 6e65 5f61 7272 6179 2c20 6368 756e 6b73  ne_array, chunks
+0000fec0: 3d63 6875 6e6b 7329 0a20 2020 2020 2020  =chunks).       
+0000fed0: 2061 645f 7a20 3d20 6361 6c6c 735f 726f   ad_z = calls_ro
+0000fee0: 6f74 5b66 227b 636f 6e74 6967 7d2f 6361  ot[f"{contig}/ca
+0000fef0: 6c6c 6461 7461 2f41 4422 5d0a 2020 2020  lldata/AD"].    
+0000ff00: 2020 2020 6361 6c6c 5f61 6420 3d20 6461      call_ad = da
+0000ff10: 5f66 726f 6d5f 7a61 7272 2861 645f 7a2c  _from_zarr(ad_z,
+0000ff20: 2069 6e6c 696e 655f 6172 7261 793d 696e   inline_array=in
+0000ff30: 6c69 6e65 5f61 7272 6179 2c20 6368 756e  line_array, chun
+0000ff40: 6b73 3d63 6875 6e6b 7329 0a20 2020 2020  ks=chunks).     
+0000ff50: 2020 206d 715f 7a20 3d20 6361 6c6c 735f     mq_z = calls_
+0000ff60: 726f 6f74 5b66 227b 636f 6e74 6967 7d2f  root[f"{contig}/
+0000ff70: 6361 6c6c 6461 7461 2f4d 5122 5d0a 2020  calldata/MQ"].  
+0000ff80: 2020 2020 2020 6361 6c6c 5f6d 7120 3d20        call_mq = 
+0000ff90: 6461 5f66 726f 6d5f 7a61 7272 286d 715f  da_from_zarr(mq_
+0000ffa0: 7a2c 2069 6e6c 696e 655f 6172 7261 793d  z, inline_array=
+0000ffb0: 696e 6c69 6e65 5f61 7272 6179 2c20 6368  inline_array, ch
+0000ffc0: 756e 6b73 3d63 6875 6e6b 7329 0a20 2020  unks=chunks).   
+0000ffd0: 2020 2020 2064 6174 615f 7661 7273 5b22       data_vars["
+0000ffe0: 6361 6c6c 5f67 656e 6f74 7970 6522 5d20  call_genotype"] 
+0000fff0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00010000: 5b44 494d 5f56 4152 4941 4e54 2c20 4449  [DIM_VARIANT, DI
+00010010: 4d5f 5341 4d50 4c45 2c20 4449 4d5f 504c  M_SAMPLE, DIM_PL
+00010020: 4f49 4459 5d2c 0a20 2020 2020 2020 2020  OIDY],.         
+00010030: 2020 2063 616c 6c5f 6765 6e6f 7479 7065     call_genotype
+00010040: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00010050: 2020 2020 6461 7461 5f76 6172 735b 2263      data_vars["c
+00010060: 616c 6c5f 4751 225d 203d 2028 5b44 494d  all_GQ"] = ([DIM
+00010070: 5f56 4152 4941 4e54 2c20 4449 4d5f 5341  _VARIANT, DIM_SA
+00010080: 4d50 4c45 5d2c 2063 616c 6c5f 6771 290a  MPLE], call_gq).
+00010090: 2020 2020 2020 2020 6461 7461 5f76 6172          data_var
+000100a0: 735b 2263 616c 6c5f 4d51 225d 203d 2028  s["call_MQ"] = (
+000100b0: 5b44 494d 5f56 4152 4941 4e54 2c20 4449  [DIM_VARIANT, DI
+000100c0: 4d5f 5341 4d50 4c45 5d2c 2063 616c 6c5f  M_SAMPLE], call_
+000100d0: 6d71 290a 2020 2020 2020 2020 6461 7461  mq).        data
+000100e0: 5f76 6172 735b 2263 616c 6c5f 4144 225d  _vars["call_AD"]
+000100f0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00010100: 205b 4449 4d5f 5641 5249 414e 542c 2044   [DIM_VARIANT, D
+00010110: 494d 5f53 414d 504c 452c 2044 494d 5f41  IM_SAMPLE, DIM_A
+00010120: 4c4c 454c 455d 2c0a 2020 2020 2020 2020  LLELE],.        
+00010130: 2020 2020 6361 6c6c 5f61 642c 0a20 2020      call_ad,.   
+00010140: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00010150: 6465 6275 6728 2273 616d 706c 6520 6172  debug("sample ar
+00010160: 7261 7973 2229 0a20 2020 2020 2020 207a  rays").        z
+00010170: 203d 2063 616c 6c73 5f72 6f6f 745b 2273   = calls_root["s
+00010180: 616d 706c 6573 225d 0a20 2020 2020 2020  amples"].       
+00010190: 2073 616d 706c 655f 6964 203d 2064 615f   sample_id = da_
+000101a0: 6672 6f6d 5f7a 6172 7228 7a2c 2069 6e6c  from_zarr(z, inl
+000101b0: 696e 655f 6172 7261 793d 696e 6c69 6e65  ine_array=inline
+000101c0: 5f61 7272 6179 2c20 6368 756e 6b73 3d63  _array, chunks=c
+000101d0: 6875 6e6b 7329 0a20 2020 2020 2020 2023  hunks).        #
+000101e0: 2064 6563 6f64 6520 746f 2073 7472 2c20   decode to str, 
+000101f0: 6173 2069 7420 6973 2073 746f 7265 6420  as it is stored 
+00010200: 6173 2062 7974 6573 206f 626a 6563 7473  as bytes objects
+00010210: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+00010220: 6964 203d 2073 616d 706c 655f 6964 2e61  id = sample_id.a
+00010230: 7374 7970 6528 2255 2229 0a20 2020 2020  stype("U").     
+00010240: 2020 2063 6f6f 7264 735b 2273 616d 706c     coords["sampl
+00010250: 655f 6964 225d 203d 205b 4449 4d5f 5341  e_id"] = [DIM_SA
+00010260: 4d50 4c45 5d2c 2073 616d 706c 655f 6964  MPLE], sample_id
+00010270: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+00010280: 2263 7265 6174 6520 6120 6461 7461 7365  "create a datase
+00010290: 7422 290a 2020 2020 2020 2020 6473 203d  t").        ds =
+000102a0: 2078 722e 4461 7461 7365 7428 6461 7461   xr.Dataset(data
+000102b0: 5f76 6172 733d 6461 7461 5f76 6172 732c  _vars=data_vars,
+000102c0: 2063 6f6f 7264 733d 636f 6f72 6473 290a   coords=coords).
+000102d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000102e0: 6473 0a0a 2020 2020 4064 6f63 280a 2020  ds..    @doc(.  
+000102f0: 2020 2020 2020 7375 6d6d 6172 793d 2241        summary="A
+00010300: 6363 6573 7320 534e 5020 7369 7465 732c  ccess SNP sites,
+00010310: 2073 6974 6520 6669 6c74 6572 7320 616e   site filters an
+00010320: 6420 6765 6e6f 7479 7065 2063 616c 6c73  d genotype calls
+00010330: 2e22 2c0a 2020 2020 2020 2020 7265 7475  .",.        retu
+00010340: 726e 733d 2241 2064 6174 6173 6574 2063  rns="A dataset c
+00010350: 6f6e 7461 696e 696e 6720 534e 5020 7369  ontaining SNP si
+00010360: 7465 732c 2073 6974 6520 6669 6c74 6572  tes, site filter
+00010370: 7320 616e 6420 6765 6e6f 7479 7065 2063  s and genotype c
+00010380: 616c 6c73 2e22 2c0a 2020 2020 290a 2020  alls.",.    ).  
+00010390: 2020 6465 6620 736e 705f 6361 6c6c 7328    def snp_calls(
+000103a0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000103b0: 2020 2020 2020 2072 6567 696f 6e3a 2062         region: b
+000103c0: 6173 655f 7061 7261 6d73 2e72 6567 696f  ase_params.regio
+000103d0: 6e2c 0a20 2020 2020 2020 2073 616d 706c  n,.        sampl
+000103e0: 655f 7365 7473 3a20 4f70 7469 6f6e 616c  e_sets: Optional
+000103f0: 5b62 6173 655f 7061 7261 6d73 2e73 616d  [base_params.sam
+00010400: 706c 655f 7365 7473 5d20 3d20 4e6f 6e65  ple_sets] = None
+00010410: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
+00010420: 5f71 7565 7279 3a20 4f70 7469 6f6e 616c  _query: Optional
+00010430: 5b62 6173 655f 7061 7261 6d73 2e73 616d  [base_params.sam
+00010440: 706c 655f 7175 6572 795d 203d 204e 6f6e  ple_query] = Non
+00010450: 652c 0a20 2020 2020 2020 2073 6974 655f  e,.        site_
+00010460: 6d61 736b 3a20 4f70 7469 6f6e 616c 5b62  mask: Optional[b
+00010470: 6173 655f 7061 7261 6d73 2e73 6974 655f  ase_params.site_
+00010480: 6d61 736b 5d20 3d20 4e6f 6e65 2c0a 2020  mask] = None,.  
+00010490: 2020 2020 2020 7369 7465 5f63 6c61 7373        site_class
+000104a0: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
+000104b0: 7061 7261 6d73 2e73 6974 655f 636c 6173  params.site_clas
+000104c0: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+000104d0: 2020 2069 6e6c 696e 655f 6172 7261 793a     inline_array:
+000104e0: 2062 6173 655f 7061 7261 6d73 2e69 6e6c   base_params.inl
+000104f0: 696e 655f 6172 7261 7920 3d20 6261 7365  ine_array = base
+00010500: 5f70 6172 616d 732e 696e 6c69 6e65 5f61  _params.inline_a
+00010510: 7272 6179 5f64 6566 6175 6c74 2c0a 2020  rray_default,.  
+00010520: 2020 2020 2020 6368 756e 6b73 3a20 6261        chunks: ba
+00010530: 7365 5f70 6172 616d 732e 6368 756e 6b73  se_params.chunks
+00010540: 203d 2062 6173 655f 7061 7261 6d73 2e63   = base_params.c
+00010550: 6875 6e6b 735f 6465 6661 756c 742c 0a20  hunks_default,. 
+00010560: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
+00010570: 7a65 3a20 4f70 7469 6f6e 616c 5b62 6173  ze: Optional[bas
+00010580: 655f 7061 7261 6d73 2e63 6f68 6f72 745f  e_params.cohort_
+00010590: 7369 7a65 5d20 3d20 4e6f 6e65 2c0a 2020  size] = None,.  
+000105a0: 2020 2020 2020 6d69 6e5f 636f 686f 7274        min_cohort
+000105b0: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
+000105c0: 6261 7365 5f70 6172 616d 732e 6d69 6e5f  base_params.min_
+000105d0: 636f 686f 7274 5f73 697a 655d 203d 204e  cohort_size] = N
+000105e0: 6f6e 652c 0a20 2020 2020 2020 206d 6178  one,.        max
+000105f0: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
+00010600: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+00010610: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
+00010620: 7a65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ze] = None,.    
+00010630: 2020 2020 7261 6e64 6f6d 5f73 6565 643a      random_seed:
+00010640: 2062 6173 655f 7061 7261 6d73 2e72 616e   base_params.ran
+00010650: 646f 6d5f 7365 6564 203d 2034 322c 0a20  dom_seed = 42,. 
+00010660: 2020 2029 202d 3e20 7872 2e44 6174 6173     ) -> xr.Datas
+00010670: 6574 3a0a 2020 2020 2020 2020 6465 6275  et:.        debu
+00010680: 6720 3d20 7365 6c66 2e5f 6c6f 672e 6465  g = self._log.de
+00010690: 6275 670a 0a20 2020 2020 2020 2064 6562  bug..        deb
+000106a0: 7567 2822 6e6f 726d 616c 6973 6520 7061  ug("normalise pa
+000106b0: 7261 6d65 7465 7273 2229 0a20 2020 2020  rameters").     
+000106c0: 2020 2073 616d 706c 655f 7365 7473 203d     sample_sets =
+000106d0: 2073 656c 662e 5f70 7265 705f 7361 6d70   self._prep_samp
+000106e0: 6c65 5f73 6574 735f 7061 7261 6d28 7361  le_sets_param(sa
+000106f0: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
+00010700: 5f73 6574 7329 0a20 2020 2020 2020 2072  _sets).        r
+00010710: 6573 6f6c 7665 645f 7265 6769 6f6e 203d  esolved_region =
+00010720: 2073 656c 662e 7265 736f 6c76 655f 7265   self.resolve_re
+00010730: 6769 6f6e 2872 6567 696f 6e29 0a20 2020  gion(region).   
+00010740: 2020 2020 2064 656c 2072 6567 696f 6e0a       del region.
+00010750: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00010760: 7461 6e63 6528 7265 736f 6c76 6564 5f72  tance(resolved_r
+00010770: 6567 696f 6e2c 2052 6567 696f 6e29 3a0a  egion, Region):.
+00010780: 2020 2020 2020 2020 2020 2020 7265 736f              reso
+00010790: 6c76 6564 5f72 6567 696f 6e20 3d20 5b72  lved_region = [r
+000107a0: 6573 6f6c 7665 645f 7265 6769 6f6e 5d0a  esolved_region].
+000107b0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+000107c0: 6163 6365 7373 2053 4e50 2063 616c 6c73  access SNP calls
+000107d0: 2061 6e64 2063 6f6e 6361 7465 6e61 7465   and concatenate
+000107e0: 206d 756c 7469 706c 6520 7361 6d70 6c65   multiple sample
+000107f0: 2073 6574 7320 616e 642f 6f72 2072 6567   sets and/or reg
+00010800: 696f 6e73 2229 0a20 2020 2020 2020 206c  ions").        l
+00010810: 7820 3d20 5b5d 0a20 2020 2020 2020 2066  x = [].        f
+00010820: 6f72 2072 2069 6e20 7265 736f 6c76 6564  or r in resolved
+00010830: 5f72 6567 696f 6e3a 0a20 2020 2020 2020  _region:.       
+00010840: 2020 2020 206c 7920 3d20 5b5d 0a20 2020       ly = [].   
+00010850: 2020 2020 2020 2020 2066 6f72 2073 2069           for s i
+00010860: 6e20 7361 6d70 6c65 5f73 6574 733a 0a20  n sample_sets:. 
+00010870: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00010880: 203d 2073 656c 662e 5f73 6e70 5f63 616c   = self._snp_cal
+00010890: 6c73 5f66 6f72 5f63 6f6e 7469 6728 0a20  ls_for_contig(. 
+000108a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000108b0: 2020 2063 6f6e 7469 673d 722e 636f 6e74     contig=r.cont
+000108c0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+000108d0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+000108e0: 6574 3d73 2c0a 2020 2020 2020 2020 2020  et=s,.          
+000108f0: 2020 2020 2020 2020 2020 696e 6c69 6e65            inline
+00010900: 5f61 7272 6179 3d69 6e6c 696e 655f 6172  _array=inline_ar
+00010910: 7261 792c 0a20 2020 2020 2020 2020 2020  ray,.           
+00010920: 2020 2020 2020 2020 2063 6875 6e6b 733d           chunks=
+00010930: 6368 756e 6b73 2c0a 2020 2020 2020 2020  chunks,.        
+00010940: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00010950: 2020 2020 2020 2020 2020 6c79 2e61 7070            ly.app
+00010960: 656e 6428 7929 0a0a 2020 2020 2020 2020  end(y)..        
+00010970: 2020 2020 6465 6275 6728 2263 6f6e 6361      debug("conca
+00010980: 7465 6e61 7465 2064 6174 6120 6672 6f6d  tenate data from
+00010990: 206d 756c 7469 706c 6520 7361 6d70 6c65   multiple sample
+000109a0: 2073 6574 7322 290a 2020 2020 2020 2020   sets").        
+000109b0: 2020 2020 7820 3d20 7369 6d70 6c65 5f78      x = simple_x
+000109c0: 6172 7261 795f 636f 6e63 6174 286c 792c  array_concat(ly,
+000109d0: 2064 696d 3d44 494d 5f53 414d 504c 4529   dim=DIM_SAMPLE)
+000109e0: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+000109f0: 6275 6728 2261 6464 2076 6172 6961 6e74  bug("add variant
+00010a00: 7320 7661 7269 6162 6c65 7322 290a 2020  s variables").  
+00010a10: 2020 2020 2020 2020 2020 7620 3d20 7365            v = se
+00010a20: 6c66 2e5f 736e 705f 7661 7269 616e 7473  lf._snp_variants
+00010a30: 5f66 6f72 5f63 6f6e 7469 6728 0a20 2020  _for_contig(.   
+00010a40: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00010a50: 7469 673d 722e 636f 6e74 6967 2c20 696e  tig=r.contig, in
+00010a60: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
+00010a70: 655f 6172 7261 792c 2063 6875 6e6b 733d  e_array, chunks=
+00010a80: 6368 756e 6b73 0a20 2020 2020 2020 2020  chunks.         
+00010a90: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00010aa0: 2078 203d 2078 722e 6d65 7267 6528 5b76   x = xr.merge([v
+00010ab0: 2c20 785d 2c20 636f 6d70 6174 3d22 6f76  , x], compat="ov
+00010ac0: 6572 7269 6465 222c 206a 6f69 6e3d 226f  erride", join="o
+00010ad0: 7665 7272 6964 6522 290a 0a20 2020 2020  verride")..     
+00010ae0: 2020 2020 2020 2064 6562 7567 2822 6861         debug("ha
+00010af0: 6e64 6c65 2073 6974 6520 636c 6173 7322  ndle site class"
+00010b00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010b10: 2073 6974 655f 636c 6173 7320 6973 206e   site_class is n
+00010b20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00010b30: 2020 2020 2020 2020 206c 6f63 5f61 6e6e           loc_ann
+00010b40: 203d 2073 656c 662e 5f6c 6f63 6174 655f   = self._locate_
+00010b50: 7369 7465 5f63 6c61 7373 280a 2020 2020  site_class(.    
+00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b70: 7265 6769 6f6e 3d72 2e63 6f6e 7469 672c  region=r.contig,
+00010b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010b90: 2020 2020 2073 6974 655f 636c 6173 733d       site_class=
+00010ba0: 7369 7465 5f63 6c61 7373 2c0a 2020 2020  site_class,.    
+00010bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bc0: 7369 7465 5f6d 6173 6b3d 4e6f 6e65 2c0a  site_mask=None,.
+00010bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010bf0: 2020 7820 3d20 782e 6973 656c 2876 6172    x = x.isel(var
+00010c00: 6961 6e74 733d 6c6f 635f 616e 6e29 0a0a  iants=loc_ann)..
+00010c10: 2020 2020 2020 2020 2020 2020 6465 6275              debu
+00010c20: 6728 2268 616e 646c 6520 7265 6769 6f6e  g("handle region
+00010c30: 2c20 646f 2074 6869 7320 6f6e 6c79 206f  , do this only o
+00010c40: 6e63 6520 2d20 6f70 7469 6d69 7361 7469  nce - optimisati
+00010c50: 6f6e 2229 0a20 2020 2020 2020 2020 2020  on").           
+00010c60: 2069 6620 722e 7374 6172 7420 6f72 2072   if r.start or r
+00010c70: 2e65 6e64 3a0a 2020 2020 2020 2020 2020  .end:.          
+00010c80: 2020 2020 2020 706f 7320 3d20 785b 2276        pos = x["v
+00010c90: 6172 6961 6e74 5f70 6f73 6974 696f 6e22  ariant_position"
+00010ca0: 5d2e 7661 6c75 6573 0a20 2020 2020 2020  ].values.       
+00010cb0: 2020 2020 2020 2020 206c 6f63 5f72 6567           loc_reg
+00010cc0: 696f 6e20 3d20 6c6f 6361 7465 5f72 6567  ion = locate_reg
+00010cd0: 696f 6e28 722c 2070 6f73 290a 2020 2020  ion(r, pos).    
+00010ce0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00010cf0: 782e 6973 656c 2876 6172 6961 6e74 733d  x.isel(variants=
+00010d00: 6c6f 635f 7265 6769 6f6e 290a 0a20 2020  loc_region)..   
+00010d10: 2020 2020 2020 2020 206c 782e 6170 7065           lx.appe
+00010d20: 6e64 2878 290a 0a20 2020 2020 2020 2064  nd(x)..        d
+00010d30: 6562 7567 2822 636f 6e63 6174 656e 6174  ebug("concatenat
+00010d40: 6520 6461 7461 2066 726f 6d20 6d75 6c74  e data from mult
+00010d50: 6970 6c65 2072 6567 696f 6e73 2229 0a20  iple regions"). 
+00010d60: 2020 2020 2020 2064 7320 3d20 7369 6d70         ds = simp
+00010d70: 6c65 5f78 6172 7261 795f 636f 6e63 6174  le_xarray_concat
+00010d80: 286c 782c 2064 696d 3d44 494d 5f56 4152  (lx, dim=DIM_VAR
+00010d90: 4941 4e54 290a 0a20 2020 2020 2020 2069  IANT)..        i
+00010da0: 6620 7369 7465 5f6d 6173 6b20 6973 206e  f site_mask is n
+00010db0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00010dc0: 2020 2020 2064 6562 7567 2822 6170 706c       debug("appl
+00010dd0: 7920 7369 7465 2066 696c 7465 7273 2229  y site filters")
+00010de0: 0a20 2020 2020 2020 2020 2020 2064 7320  .            ds 
+00010df0: 3d20 6461 736b 5f63 6f6d 7072 6573 735f  = dask_compress_
+00010e00: 6461 7461 7365 7428 0a20 2020 2020 2020  dataset(.       
+00010e10: 2020 2020 2020 2020 2064 732c 2069 6e64           ds, ind
+00010e20: 6578 6572 3d66 2276 6172 6961 6e74 5f66  exer=f"variant_f
+00010e30: 696c 7465 725f 7061 7373 5f7b 7369 7465  ilter_pass_{site
+00010e40: 5f6d 6173 6b7d 222c 2064 696d 3d44 494d  _mask}", dim=DIM
+00010e50: 5f56 4152 4941 4e54 0a20 2020 2020 2020  _VARIANT.       
+00010e60: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00010e70: 6465 6275 6728 2261 6464 2063 616c 6c5f  debug("add call_
+00010e80: 6765 6e6f 7479 7065 5f6d 6173 6b22 290a  genotype_mask").
+00010e90: 2020 2020 2020 2020 6473 5b22 6361 6c6c          ds["call
+00010ea0: 5f67 656e 6f74 7970 655f 6d61 736b 225d  _genotype_mask"]
+00010eb0: 203d 2064 735b 2263 616c 6c5f 6765 6e6f   = ds["call_geno
+00010ec0: 7479 7065 225d 203c 2030 0a0a 2020 2020  type"] < 0..    
+00010ed0: 2020 2020 6966 2073 616d 706c 655f 7175      if sample_qu
+00010ee0: 6572 7920 6973 206e 6f74 204e 6f6e 653a  ery is not None:
+00010ef0: 0a20 2020 2020 2020 2020 2020 2064 6562  .            deb
+00010f00: 7567 2822 6861 6e64 6c65 2073 616d 706c  ug("handle sampl
+00010f10: 6520 7175 6572 7922 290a 2020 2020 2020  e query").      
+00010f20: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00010f30: 6e63 6528 7361 6d70 6c65 5f71 7565 7279  nce(sample_query
+00010f40: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00010f50: 2020 2020 2020 2020 6466 5f73 616d 706c          df_sampl
+00010f60: 6573 203d 2073 656c 662e 7361 6d70 6c65  es = self.sample
+00010f70: 5f6d 6574 6164 6174 6128 7361 6d70 6c65  _metadata(sample
+00010f80: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
+00010f90: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00010fa0: 2020 206c 6f63 5f73 616d 706c 6573 203d     loc_samples =
+00010fb0: 2064 665f 7361 6d70 6c65 732e 6576 616c   df_samples.eval
+00010fc0: 2873 616d 706c 655f 7175 6572 7929 2e76  (sample_query).v
+00010fd0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
+00010fe0: 2020 2020 2020 6966 206e 702e 636f 756e        if np.coun
+00010ff0: 745f 6e6f 6e7a 6572 6f28 6c6f 635f 7361  t_nonzero(loc_sa
+00011000: 6d70 6c65 7329 203d 3d20 303a 0a20 2020  mples) == 0:.   
+00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011020: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00011030: 7228 6622 4e6f 2073 616d 706c 6573 2066  r(f"No samples f
+00011040: 6f75 6e64 2066 6f72 2071 7565 7279 207b  ound for query {
+00011050: 7361 6d70 6c65 5f71 7565 7279 2172 7d22  sample_query!r}"
+00011060: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00011070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00011080: 2020 2020 2320 6173 7375 6d65 2073 616d      # assume sam
+00011090: 706c 6520 7175 6572 7920 6973 2061 6e20  ple query is an 
+000110a0: 696e 6465 7865 722c 2065 2e67 2e2c 2061  indexer, e.g., a
+000110b0: 206c 6973 7420 6f66 2069 6e74 6567 6572   list of integer
+000110c0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+000110d0: 2020 6c6f 635f 7361 6d70 6c65 7320 3d20    loc_samples = 
+000110e0: 7361 6d70 6c65 5f71 7565 7279 0a20 2020  sample_query.   
+000110f0: 2020 2020 2020 2020 2064 7320 3d20 6473           ds = ds
+00011100: 2e69 7365 6c28 7361 6d70 6c65 733d 6c6f  .isel(samples=lo
+00011110: 635f 7361 6d70 6c65 7329 0a0a 2020 2020  c_samples)..    
+00011120: 2020 2020 6966 2063 6f68 6f72 745f 7369      if cohort_si
+00011130: 7a65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ze is not None:.
+00011140: 2020 2020 2020 2020 2020 2020 6465 6275              debu
+00011150: 6728 2268 616e 646c 6520 636f 686f 7274  g("handle cohort
+00011160: 2073 697a 6522 290a 2020 2020 2020 2020   size").        
+00011170: 2020 2020 2320 6f76 6572 7269 6465 7320      # overrides 
+00011180: 6d69 6e20 616e 6420 6d61 780a 2020 2020  min and max.    
+00011190: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
+000111a0: 7274 5f73 697a 6520 3d20 636f 686f 7274  rt_size = cohort
+000111b0: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
+000111c0: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
+000111d0: 6520 3d20 636f 686f 7274 5f73 697a 650a  e = cohort_size.
+000111e0: 0a20 2020 2020 2020 2069 6620 6d69 6e5f  .        if min_
+000111f0: 636f 686f 7274 5f73 697a 6520 6973 206e  cohort_size is n
+00011200: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00011210: 2020 2020 2064 6562 7567 2822 6861 6e64       debug("hand
+00011220: 6c65 206d 696e 2063 6f68 6f72 7420 7369  le min cohort si
+00011230: 7a65 2229 0a20 2020 2020 2020 2020 2020  ze").           
+00011240: 206e 5f73 616d 706c 6573 203d 2064 732e   n_samples = ds.
+00011250: 6469 6d73 5b22 7361 6d70 6c65 7322 5d0a  dims["samples"].
+00011260: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00011270: 5f73 616d 706c 6573 203c 206d 696e 5f63  _samples < min_c
+00011280: 6f68 6f72 745f 7369 7a65 3a0a 2020 2020  ohort_size:.    
+00011290: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000112a0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+000112b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112c0: 2020 6622 6e6f 7420 656e 6f75 6768 2073    f"not enough s
+000112d0: 616d 706c 6573 2028 7b6e 5f73 616d 706c  amples ({n_sampl
+000112e0: 6573 7d29 2066 6f72 206d 696e 696d 756d  es}) for minimum
+000112f0: 2063 6f68 6f72 7420 7369 7a65 2028 7b6d   cohort size ({m
+00011300: 696e 5f63 6f68 6f72 745f 7369 7a65 7d29  in_cohort_size})
+00011310: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00011320: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+00011330: 6d61 785f 636f 686f 7274 5f73 697a 6520  max_cohort_size 
+00011340: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00011350: 2020 2020 2020 2020 2064 6562 7567 2822           debug("
+00011360: 6861 6e64 6c65 206d 6178 2063 6f68 6f72  handle max cohor
+00011370: 7420 7369 7a65 2229 0a20 2020 2020 2020  t size").       
+00011380: 2020 2020 206e 5f73 616d 706c 6573 203d       n_samples =
+00011390: 2064 732e 6469 6d73 5b22 7361 6d70 6c65   ds.dims["sample
+000113a0: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
+000113b0: 6966 206e 5f73 616d 706c 6573 203e 206d  if n_samples > m
+000113c0: 6178 5f63 6f68 6f72 745f 7369 7a65 3a0a  ax_cohort_size:.
+000113d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113e0: 726e 6720 3d20 6e70 2e72 616e 646f 6d2e  rng = np.random.
+000113f0: 6465 6661 756c 745f 726e 6728 7365 6564  default_rng(seed
+00011400: 3d72 616e 646f 6d5f 7365 6564 290a 2020  =random_seed).  
+00011410: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00011420: 635f 646f 776e 7361 6d70 6c65 203d 2072  c_downsample = r
+00011430: 6e67 2e63 686f 6963 6528 0a20 2020 2020  ng.choice(.     
+00011440: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00011450: 5f73 616d 706c 6573 2c20 7369 7a65 3d6d  _samples, size=m
+00011460: 6178 5f63 6f68 6f72 745f 7369 7a65 2c20  ax_cohort_size, 
+00011470: 7265 706c 6163 653d 4661 6c73 650a 2020  replace=False.  
+00011480: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114a0: 6c6f 635f 646f 776e 7361 6d70 6c65 2e73  loc_downsample.s
+000114b0: 6f72 7428 290a 2020 2020 2020 2020 2020  ort().          
+000114c0: 2020 2020 2020 6473 203d 2064 732e 6973        ds = ds.is
+000114d0: 656c 2873 616d 706c 6573 3d6c 6f63 5f64  el(samples=loc_d
+000114e0: 6f77 6e73 616d 706c 6529 0a0a 2020 2020  ownsample)..    
+000114f0: 2020 2020 7265 7475 726e 2064 730a 0a20      return ds.. 
+00011500: 2020 2064 6566 2073 6e70 5f64 6174 6173     def snp_datas
+00011510: 6574 2873 656c 662c 202a 6172 6773 2c20  et(self, *args, 
+00011520: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+00011530: 2020 2022 2222 4465 7072 6563 6174 6564     """Deprecated
+00011540: 2c20 7468 6973 206d 6574 686f 6420 6861  , this method ha
+00011550: 7320 6265 656e 2072 656e 616d 6564 2074  s been renamed t
+00011560: 6f20 736e 705f 6361 6c6c 7328 292e 2222  o snp_calls().""
+00011570: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00011580: 2073 656c 662e 736e 705f 6361 6c6c 7328   self.snp_calls(
+00011590: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+000115a0: 0a0a 2020 2020 6465 6620 5f73 6e70 5f61  ..    def _snp_a
+000115b0: 6c6c 656c 655f 636f 756e 7473 280a 2020  llele_counts(.  
+000115c0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000115d0: 2020 2020 2a2c 0a20 2020 2020 2020 2072      *,.        r
+000115e0: 6567 696f 6e2c 0a20 2020 2020 2020 2073  egion,.        s
+000115f0: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
+00011600: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
+00011610: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
+00011620: 6173 6b2c 0a20 2020 2020 2020 2073 6974  ask,.        sit
+00011630: 655f 636c 6173 732c 0a20 2020 2020 2020  e_class,.       
+00011640: 2063 6f68 6f72 745f 7369 7a65 2c0a 2020   cohort_size,.  
+00011650: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+00011660: 642c 0a20 2020 2029 3a0a 2020 2020 2020  d,.    ):.      
+00011670: 2020 6465 6275 6720 3d20 7365 6c66 2e5f    debug = self._
+00011680: 6c6f 672e 6465 6275 670a 0a20 2020 2020  log.debug..     
+00011690: 2020 2064 6562 7567 2822 6163 6365 7373     debug("access
+000116a0: 2053 4e50 2063 616c 6c73 2229 0a20 2020   SNP calls").   
+000116b0: 2020 2020 2064 735f 736e 7073 203d 2073       ds_snps = s
+000116c0: 656c 662e 736e 705f 6361 6c6c 7328 0a20  elf.snp_calls(. 
+000116d0: 2020 2020 2020 2020 2020 2072 6567 696f             regio
+000116e0: 6e3d 7265 6769 6f6e 2c0a 2020 2020 2020  n=region,.      
+000116f0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+00011700: 733d 7361 6d70 6c65 5f73 6574 732c 0a20  s=sample_sets,. 
+00011710: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00011720: 655f 7175 6572 793d 7361 6d70 6c65 5f71  e_query=sample_q
+00011730: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
+00011740: 2020 7369 7465 5f6d 6173 6b3d 7369 7465    site_mask=site
+00011750: 5f6d 6173 6b2c 0a20 2020 2020 2020 2020  _mask,.         
+00011760: 2020 2073 6974 655f 636c 6173 733d 7369     site_class=si
+00011770: 7465 5f63 6c61 7373 2c0a 2020 2020 2020  te_class,.      
+00011780: 2020 2020 2020 636f 686f 7274 5f73 697a        cohort_siz
+00011790: 653d 636f 686f 7274 5f73 697a 652c 0a20  e=cohort_size,. 
+000117a0: 2020 2020 2020 2020 2020 2072 616e 646f             rando
+000117b0: 6d5f 7365 6564 3d72 616e 646f 6d5f 7365  m_seed=random_se
+000117c0: 6564 2c0a 2020 2020 2020 2020 290a 2020  ed,.        ).  
+000117d0: 2020 2020 2020 6774 203d 2064 735f 736e        gt = ds_sn
+000117e0: 7073 5b22 6361 6c6c 5f67 656e 6f74 7970  ps["call_genotyp
+000117f0: 6522 5d0a 0a20 2020 2020 2020 2064 6562  e"]..        deb
+00011800: 7567 2822 7365 7420 7570 2061 6e64 2072  ug("set up and r
+00011810: 756e 2061 6c6c 656c 6520 636f 756e 7473  un allele counts
+00011820: 2063 6f6d 7075 7461 7469 6f6e 2229 0a20   computation"). 
+00011830: 2020 2020 2020 2067 7420 3d20 616c 6c65         gt = alle
+00011840: 6c2e 4765 6e6f 7479 7065 4461 736b 4172  l.GenotypeDaskAr
+00011850: 7261 7928 6774 2e64 6174 6129 0a20 2020  ray(gt.data).   
+00011860: 2020 2020 2061 6320 3d20 6774 2e63 6f75       ac = gt.cou
+00011870: 6e74 5f61 6c6c 656c 6573 286d 6178 5f61  nt_alleles(max_a
+00011880: 6c6c 656c 653d 3329 0a20 2020 2020 2020  llele=3).       
+00011890: 2077 6974 6820 7365 6c66 2e5f 6461 736b   with self._dask
+000118a0: 5f70 726f 6772 6573 7328 6465 7363 3d22  _progress(desc="
+000118b0: 436f 6d70 7574 6520 534e 5020 616c 6c65  Compute SNP alle
+000118c0: 6c65 2063 6f75 6e74 7322 293a 0a20 2020  le counts"):.   
+000118d0: 2020 2020 2020 2020 2061 6320 3d20 6163           ac = ac
+000118e0: 2e63 6f6d 7075 7465 2829 0a0a 2020 2020  .compute()..    
+000118f0: 2020 2020 6465 6275 6728 2272 6574 7572      debug("retur
+00011900: 6e20 706c 6169 6e20 6e75 6d70 7920 6172  n plain numpy ar
+00011910: 7261 7922 290a 2020 2020 2020 2020 7265  ray").        re
+00011920: 7375 6c74 7320 3d20 6469 6374 2861 633d  sults = dict(ac=
+00011930: 6163 2e76 616c 7565 7329 0a0a 2020 2020  ac.values)..    
+00011940: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+00011950: 7473 0a0a 2020 2020 6465 6620 5f64 6173  ts..    def _das
+00011960: 6b5f 7072 6f67 7265 7373 2873 656c 662c  k_progress(self,
+00011970: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00011980: 2020 2020 6469 7361 626c 6520 3d20 6e6f      disable = no
+00011990: 7420 7365 6c66 2e5f 7368 6f77 5f70 726f  t self._show_pro
+000119a0: 6772 6573 730a 2020 2020 2020 2020 7265  gress.        re
+000119b0: 7475 726e 2054 7164 6d43 616c 6c62 6163  turn TqdmCallbac
+000119c0: 6b28 6469 7361 626c 653d 6469 7361 626c  k(disable=disabl
+000119d0: 652c 202a 2a6b 7761 7267 7329 0a0a 2020  e, **kwargs)..  
+000119e0: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
+000119f0: 7375 6d6d 6172 793d 2241 6363 6573 7320  summary="Access 
+00011a00: 534e 5020 7369 7465 7320 616e 6420 7369  SNP sites and si
+00011a10: 7465 2066 696c 7465 7273 2e22 2c0a 2020  te filters.",.  
+00011a20: 2020 2020 2020 7265 7475 726e 733d 2241        returns="A
+00011a30: 2064 6174 6173 6574 2063 6f6e 7461 696e   dataset contain
+00011a40: 696e 6720 534e 5020 7369 7465 7320 616e  ing SNP sites an
+00011a50: 6420 7369 7465 2066 696c 7465 7273 2e22  d site filters."
+00011a60: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
+00011a70: 736e 705f 7661 7269 616e 7473 280a 2020  snp_variants(.  
+00011a80: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00011a90: 2020 2020 7265 6769 6f6e 3a20 6261 7365      region: base
+00011aa0: 5f70 6172 616d 732e 7265 6769 6f6e 2c0a  _params.region,.
+00011ab0: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
+00011ac0: 6b3a 204f 7074 696f 6e61 6c5b 6261 7365  k: Optional[base
+00011ad0: 5f70 6172 616d 732e 7369 7465 5f6d 6173  _params.site_mas
+00011ae0: 6b5d 203d 204e 6f6e 652c 0a20 2020 2020  k] = None,.     
+00011af0: 2020 2069 6e6c 696e 655f 6172 7261 793a     inline_array:
+00011b00: 2062 6173 655f 7061 7261 6d73 2e69 6e6c   base_params.inl
+00011b10: 696e 655f 6172 7261 7920 3d20 6261 7365  ine_array = base
+00011b20: 5f70 6172 616d 732e 696e 6c69 6e65 5f61  _params.inline_a
+00011b30: 7272 6179 5f64 6566 6175 6c74 2c0a 2020  rray_default,.  
+00011b40: 2020 2020 2020 6368 756e 6b73 3a20 6261        chunks: ba
+00011b50: 7365 5f70 6172 616d 732e 6368 756e 6b73  se_params.chunks
+00011b60: 203d 2062 6173 655f 7061 7261 6d73 2e63   = base_params.c
+00011b70: 6875 6e6b 735f 6465 6661 756c 742c 0a20  hunks_default,. 
+00011b80: 2020 2029 3a0a 2020 2020 2020 2020 6465     ):.        de
+00011b90: 6275 6720 3d20 7365 6c66 2e5f 6c6f 672e  bug = self._log.
+00011ba0: 6465 6275 670a 0a20 2020 2020 2020 2064  debug..        d
+00011bb0: 6562 7567 2822 6e6f 726d 616c 6973 6520  ebug("normalise 
+00011bc0: 7061 7261 6d65 7465 7273 2229 0a20 2020  parameters").   
+00011bd0: 2020 2020 2072 6573 6f6c 7665 645f 7265       resolved_re
+00011be0: 6769 6f6e 203d 2073 656c 662e 7265 736f  gion = self.reso
+00011bf0: 6c76 655f 7265 6769 6f6e 2872 6567 696f  lve_region(regio
+00011c00: 6e29 0a20 2020 2020 2020 2064 656c 2072  n).        del r
+00011c10: 6567 696f 6e0a 2020 2020 2020 2020 6966  egion.        if
+00011c20: 2069 7369 6e73 7461 6e63 6528 7265 736f   isinstance(reso
+00011c30: 6c76 6564 5f72 6567 696f 6e2c 2052 6567  lved_region, Reg
+00011c40: 696f 6e29 3a0a 2020 2020 2020 2020 2020  ion):.          
+00011c50: 2020 7265 736f 6c76 6564 5f72 6567 696f    resolved_regio
+00011c60: 6e20 3d20 5b72 6573 6f6c 7665 645f 7265  n = [resolved_re
+00011c70: 6769 6f6e 5d0a 0a20 2020 2020 2020 2064  gion]..        d
+00011c80: 6562 7567 2822 6163 6365 7373 2053 4e50  ebug("access SNP
+00011c90: 2064 6174 6120 616e 6420 636f 6e63 6174   data and concat
+00011ca0: 656e 6174 6520 6d75 6c74 6970 6c65 2072  enate multiple r
+00011cb0: 6567 696f 6e73 2229 0a20 2020 2020 2020  egions").       
+00011cc0: 206c 7820 3d20 5b5d 0a20 2020 2020 2020   lx = [].       
+00011cd0: 2066 6f72 2072 2069 6e20 7265 736f 6c76   for r in resolv
+00011ce0: 6564 5f72 6567 696f 6e3a 0a20 2020 2020  ed_region:.     
+00011cf0: 2020 2020 2020 2064 6562 7567 2822 6163         debug("ac
+00011d00: 6365 7373 2076 6172 6961 6e74 7322 290a  cess variants").
+00011d10: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00011d20: 7365 6c66 2e5f 736e 705f 7661 7269 616e  self._snp_varian
+00011d30: 7473 5f66 6f72 5f63 6f6e 7469 6728 0a20  ts_for_contig(. 
+00011d40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00011d50: 6f6e 7469 673d 722e 636f 6e74 6967 2c0a  ontig=r.contig,.
+00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d70: 696e 6c69 6e65 5f61 7272 6179 3d69 6e6c  inline_array=inl
+00011d80: 696e 655f 6172 7261 792c 0a20 2020 2020  ine_array,.     
+00011d90: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00011da0: 733d 6368 756e 6b73 2c0a 2020 2020 2020  s=chunks,.      
+00011db0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00011dc0: 2020 2020 2064 6562 7567 2822 6861 6e64       debug("hand
+00011dd0: 6c65 2072 6567 696f 6e22 290a 2020 2020  le region").    
+00011de0: 2020 2020 2020 2020 6966 2072 2e73 7461          if r.sta
+00011df0: 7274 206f 7220 722e 656e 643a 0a20 2020  rt or r.end:.   
+00011e00: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00011e10: 203d 2078 5b22 7661 7269 616e 745f 706f   = x["variant_po
+00011e20: 7369 7469 6f6e 225d 2e76 616c 7565 730a  sition"].values.
+00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e40: 6c6f 635f 7265 6769 6f6e 203d 206c 6f63  loc_region = loc
+00011e50: 6174 655f 7265 6769 6f6e 2872 2c20 706f  ate_region(r, po
+00011e60: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00011e70: 2020 2078 203d 2078 2e69 7365 6c28 7661     x = x.isel(va
+00011e80: 7269 616e 7473 3d6c 6f63 5f72 6567 696f  riants=loc_regio
+00011e90: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
+00011ea0: 6c78 2e61 7070 656e 6428 7829 0a0a 2020  lx.append(x)..  
+00011eb0: 2020 2020 2020 6465 6275 6728 2263 6f6e        debug("con
+00011ec0: 6361 7465 6e61 7465 2064 6174 6120 6672  catenate data fr
+00011ed0: 6f6d 206d 756c 7469 706c 6520 7265 6769  om multiple regi
+00011ee0: 6f6e 7322 290a 2020 2020 2020 2020 6473  ons").        ds
+00011ef0: 203d 2073 696d 706c 655f 7861 7272 6179   = simple_xarray
+00011f00: 5f63 6f6e 6361 7428 6c78 2c20 6469 6d3d  _concat(lx, dim=
+00011f10: 4449 4d5f 5641 5249 414e 5429 0a0a 2020  DIM_VARIANT)..  
+00011f20: 2020 2020 2020 6465 6275 6728 2261 7070        debug("app
+00011f30: 6c79 2073 6974 6520 6669 6c74 6572 7322  ly site filters"
+00011f40: 290a 2020 2020 2020 2020 6966 2073 6974  ).        if sit
+00011f50: 655f 6d61 736b 2069 7320 6e6f 7420 4e6f  e_mask is not No
+00011f60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00011f70: 6473 203d 2064 6173 6b5f 636f 6d70 7265  ds = dask_compre
+00011f80: 7373 5f64 6174 6173 6574 280a 2020 2020  ss_dataset(.    
+00011f90: 2020 2020 2020 2020 2020 2020 6473 2c20              ds, 
+00011fa0: 696e 6465 7865 723d 6622 7661 7269 616e  indexer=f"varian
+00011fb0: 745f 6669 6c74 6572 5f70 6173 735f 7b73  t_filter_pass_{s
+00011fc0: 6974 655f 6d61 736b 7d22 2c20 6469 6d3d  ite_mask}", dim=
+00011fd0: 4449 4d5f 5641 5249 414e 540a 2020 2020  DIM_VARIANT.    
+00011fe0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00011ff0: 2020 2072 6574 7572 6e20 6473 0a0a 2020     return ds..  
+00012000: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
+00012010: 7375 6d6d 6172 793d 2222 2c0a 2020 2020  summary="",.    
+00012020: 2020 2020 7061 7261 6d65 7465 7273 3d64      parameters=d
+00012030: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
+00012040: 2074 7261 636b 733d 2243 6f6e 6669 6775   tracks="Configu
+00012050: 7261 7469 6f6e 2066 6f72 2061 6e79 2061  ration for any a
+00012060: 6464 6974 696f 6e61 6c20 7472 6163 6b73  dditional tracks
+00012070: 2e22 2c0a 2020 2020 2020 2020 292c 0a20  .",.        ),. 
+00012080: 2020 2020 2020 2072 6574 7572 6e73 3d22         returns="
+00012090: 4947 5620 6272 6f77 7365 722e 222c 0a20  IGV browser.",. 
+000120a0: 2020 2029 0a20 2020 2064 6566 2069 6776     ).    def igv
+000120b0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+000120c0: 7265 6769 6f6e 3a20 6261 7365 5f70 6172  region: base_par
+000120d0: 616d 732e 7265 6769 6f6e 2c20 7472 6163  ams.region, trac
+000120e0: 6b73 3a20 4f70 7469 6f6e 616c 5b4c 6973  ks: Optional[Lis
+000120f0: 745d 203d 204e 6f6e 650a 2020 2020 2920  t] = None.    ) 
+00012100: 2d3e 2069 6776 5f6e 6f74 6562 6f6f 6b2e  -> igv_notebook.
+00012110: 4272 6f77 7365 723a 0a20 2020 2020 2020  Browser:.       
+00012120: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
+00012130: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
+00012140: 2020 6465 6275 6728 2272 6573 6f6c 7665    debug("resolve
+00012150: 2072 6567 696f 6e22 290a 2020 2020 2020   region").      
+00012160: 2020 7265 6769 6f6e 203d 2073 656c 662e    region = self.
+00012170: 7265 736f 6c76 655f 7265 6769 6f6e 2872  resolve_region(r
+00012180: 6567 696f 6e29 0a0a 2020 2020 2020 2020  egion)..        
+00012190: 636f 6e66 6967 203d 207b 0a20 2020 2020  config = {.     
+000121a0: 2020 2020 2020 2022 7265 6665 7265 6e63         "referenc
+000121b0: 6522 3a20 7b0a 2020 2020 2020 2020 2020  e": {.          
+000121c0: 2020 2020 2020 2269 6422 3a20 7365 6c66        "id": self
+000121d0: 2e5f 6765 6e6f 6d65 5f72 6566 5f69 642c  ._genome_ref_id,
+000121e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000121f0: 2022 6e61 6d65 223a 2073 656c 662e 5f67   "name": self._g
+00012200: 656e 6f6d 655f 7265 665f 6e61 6d65 2c0a  enome_ref_name,.
+00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012220: 2266 6173 7461 5552 4c22 3a20 6622 7b73  "fastaURL": f"{s
+00012230: 656c 662e 5f67 6373 5f75 726c 7d7b 7365  elf._gcs_url}{se
+00012240: 6c66 2e5f 6765 6e6f 6d65 5f66 6173 7461  lf._genome_fasta
+00012250: 5f70 6174 687d 222c 0a20 2020 2020 2020  _path}",.       
+00012260: 2020 2020 2020 2020 2022 696e 6465 7855           "indexU
+00012270: 524c 223a 2066 227b 7365 6c66 2e5f 6763  RL": f"{self._gc
+00012280: 735f 7572 6c7d 7b73 656c 662e 5f67 656e  s_url}{self._gen
+00012290: 6f6d 655f 6661 695f 7061 7468 7d22 2c0a  ome_fai_path}",.
+000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122b0: 2274 7261 636b 7322 3a20 5b0a 2020 2020  "tracks": [.    
+000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122d0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000122e0: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
+000122f0: 3a20 2247 656e 6573 222c 0a20 2020 2020  : "Genes",.     
+00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012310: 2020 2022 7479 7065 223a 2022 616e 6e6f     "type": "anno
+00012320: 7461 7469 6f6e 222c 0a20 2020 2020 2020  tation",.       
+00012330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012340: 2022 666f 726d 6174 223a 2022 6766 6633   "format": "gff3
+00012350: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00012360: 2020 2020 2020 2020 2020 2022 7572 6c22             "url"
+00012370: 3a20 6622 7b73 656c 662e 5f67 6373 5f75  : f"{self._gcs_u
+00012380: 726c 7d7b 7365 6c66 2e5f 6765 6e65 7365  rl}{self._genese
+00012390: 745f 6766 6633 5f70 6174 687d 222c 0a20  t_gff3_path}",. 
+000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123b0: 2020 2020 2020 2022 696e 6465 7865 6422         "indexed"
+000123c0: 3a20 4661 6c73 652c 0a20 2020 2020 2020  : False,.       
+000123d0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+000123e0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+000123f0: 2c0a 2020 2020 2020 2020 2020 2020 7d2c  ,.            },
+00012400: 0a20 2020 2020 2020 2020 2020 2022 6c6f  .            "lo
+00012410: 6375 7322 3a20 7374 7228 7265 6769 6f6e  cus": str(region
+00012420: 292c 0a20 2020 2020 2020 207d 0a20 2020  ),.        }.   
+00012430: 2020 2020 2069 6620 7472 6163 6b73 3a0a       if tracks:.
+00012440: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00012450: 6967 5b22 7472 6163 6b73 225d 203d 2074  ig["tracks"] = t
+00012460: 7261 636b 730a 0a20 2020 2020 2020 2064  racks..        d
+00012470: 6562 7567 2863 6f6e 6669 6729 0a0a 2020  ebug(config)..  
+00012480: 2020 2020 2020 6967 765f 6e6f 7465 626f        igv_notebo
+00012490: 6f6b 2e69 6e69 7428 290a 2020 2020 2020  ok.init().      
+000124a0: 2020 6272 6f77 7365 7220 3d20 6967 765f    browser = igv_
+000124b0: 6e6f 7465 626f 6f6b 2e42 726f 7773 6572  notebook.Browser
+000124c0: 2863 6f6e 6669 6729 0a0a 2020 2020 2020  (config)..      
+000124d0: 2020 7265 7475 726e 2062 726f 7773 6572    return browser
+000124e0: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+000124f0: 2020 2020 7375 6d6d 6172 793d 2222 220a      summary=""".
+00012500: 2020 2020 2020 2020 2020 2020 4c61 756e              Laun
+00012510: 6368 2049 4756 2061 6e64 2076 6965 7720  ch IGV and view 
+00012520: 7365 7175 656e 6365 2072 6561 6420 616c  sequence read al
+00012530: 6967 6e6d 656e 7473 2061 6e64 2053 4e50  ignments and SNP
+00012540: 2067 656e 6f74 7970 6573 2066 726f 6d0a   genotypes from.
+00012550: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00012560: 6769 7665 6e20 7361 6d70 6c65 2e0a 2020  given sample..  
+00012570: 2020 2020 2020 2222 222c 0a20 2020 2020        """,.     
+00012580: 2020 2070 6172 616d 6574 6572 733d 6469     parameters=di
+00012590: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+000125a0: 7361 6d70 6c65 3d22 5361 6d70 6c65 2069  sample="Sample i
+000125b0: 6465 6e74 6966 6965 722e 222c 0a20 2020  dentifier.",.   
+000125c0: 2020 2020 2020 2020 2076 6973 6962 696c           visibil
+000125d0: 6974 795f 7769 6e64 6f77 3d22 2222 0a20  ity_window=""". 
+000125e0: 2020 2020 2020 2020 2020 2020 2020 205a                 Z
+000125f0: 6f6f 6d20 6c65 7665 6c20 696e 2062 6173  oom level in bas
+00012600: 6520 7061 6972 7320 6174 2077 6869 6368  e pairs at which
+00012610: 2061 6c69 676e 6d65 6e74 2061 6e64 2053   alignment and S
+00012620: 4e50 2064 6174 6120 7769 6c6c 2062 6563  NP data will bec
+00012630: 6f6d 650a 2020 2020 2020 2020 2020 2020  ome.            
+00012640: 2020 2020 7669 7369 626c 652e 0a20 2020      visible..   
+00012650: 2020 2020 2020 2020 2022 2222 2c0a 2020           """,.  
+00012660: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
+00012670: 2020 2064 6566 2076 6965 775f 616c 6967     def view_alig
+00012680: 6e6d 656e 7473 280a 2020 2020 2020 2020  nments(.        
+00012690: 7365 6c66 2c0a 2020 2020 2020 2020 7265  self,.        re
+000126a0: 6769 6f6e 3a20 6261 7365 5f70 6172 616d  gion: base_param
+000126b0: 732e 7265 6769 6f6e 2c0a 2020 2020 2020  s.region,.      
+000126c0: 2020 7361 6d70 6c65 3a20 7374 722c 0a20    sample: str,. 
+000126d0: 2020 2020 2020 2076 6973 6962 696c 6974         visibilit
+000126e0: 795f 7769 6e64 6f77 3a20 696e 7420 3d20  y_window: int = 
+000126f0: 3230 5f30 3030 2c0a 2020 2020 293a 0a20  20_000,.    ):. 
+00012700: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
+00012710: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
+00012720: 2020 2020 2020 2020 6465 6275 6728 226c          debug("l
+00012730: 6f6f 6b20 7570 2073 616d 706c 6520 7365  ook up sample se
+00012740: 7420 666f 7220 7361 6d70 6c65 2229 0a20  t for sample"). 
+00012750: 2020 2020 2020 2073 616d 706c 655f 7265         sample_re
+00012760: 6320 3d20 7365 6c66 2e73 616d 706c 655f  c = self.sample_
+00012770: 6d65 7461 6461 7461 2829 2e73 6574 5f69  metadata().set_i
+00012780: 6e64 6578 2822 7361 6d70 6c65 5f69 6422  ndex("sample_id"
+00012790: 292e 6c6f 635b 7361 6d70 6c65 5d0a 2020  ).loc[sample].  
+000127a0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+000127b0: 203d 2073 616d 706c 655f 7265 635b 2273   = sample_rec["s
+000127c0: 616d 706c 655f 7365 7422 5d0a 0a20 2020  ample_set"]..   
+000127d0: 2020 2020 2064 6562 7567 2822 6c6f 6164       debug("load
+000127e0: 2064 6174 6120 6361 7461 6c6f 6722 290a   data catalog").
+000127f0: 2020 2020 2020 2020 6466 5f63 6174 203d          df_cat =
+00012800: 2073 656c 662e 7767 735f 6461 7461 5f63   self.wgs_data_c
+00012810: 6174 616c 6f67 2873 616d 706c 655f 7365  atalog(sample_se
+00012820: 743d 7361 6d70 6c65 5f73 6574 290a 0a20  t=sample_set).. 
+00012830: 2020 2020 2020 2064 6562 7567 2822 6c6f         debug("lo
+00012840: 6361 7465 2072 6563 6f72 6420 666f 7220  cate record for 
+00012850: 7361 6d70 6c65 2229 0a20 2020 2020 2020  sample").       
+00012860: 2063 6174 5f72 6563 203d 2064 665f 6361   cat_rec = df_ca
+00012870: 742e 7365 745f 696e 6465 7828 2273 616d  t.set_index("sam
+00012880: 706c 655f 6964 2229 2e6c 6f63 5b73 616d  ple_id").loc[sam
+00012890: 706c 655d 0a20 2020 2020 2020 2062 616d  ple].        bam
+000128a0: 5f75 726c 203d 2063 6174 5f72 6563 5b22  _url = cat_rec["
+000128b0: 616c 6967 6e6d 656e 7473 5f62 616d 225d  alignments_bam"]
+000128c0: 0a20 2020 2020 2020 2076 6366 5f75 726c  .        vcf_url
+000128d0: 203d 2063 6174 5f72 6563 5b22 736e 705f   = cat_rec["snp_
+000128e0: 6765 6e6f 7479 7065 735f 7663 6622 5d0a  genotypes_vcf"].
+000128f0: 2020 2020 2020 2020 6465 6275 6728 6261          debug(ba
+00012900: 6d5f 7572 6c29 0a20 2020 2020 2020 2064  m_url).        d
+00012910: 6562 7567 2876 6366 5f75 726c 290a 0a20  ebug(vcf_url).. 
+00012920: 2020 2020 2020 2064 6562 7567 2822 7061         debug("pa
+00012930: 7273 6520 7265 6769 6f6e 2229 0a20 2020  rse region").   
+00012940: 2020 2020 2072 6573 6f6c 7665 645f 7265       resolved_re
+00012950: 6769 6f6e 203d 2073 656c 662e 7265 736f  gion = self.reso
+00012960: 6c76 655f 7265 6769 6f6e 2872 6567 696f  lve_region(regio
+00012970: 6e29 0a20 2020 2020 2020 2064 656c 2072  n).        del r
+00012980: 6567 696f 6e0a 2020 2020 2020 2020 636f  egion.        co
+00012990: 6e74 6967 203d 2072 6573 6f6c 7665 645f  ntig = resolved_
+000129a0: 7265 6769 6f6e 2e63 6f6e 7469 670a 0a20  region.contig.. 
+000129b0: 2020 2020 2020 2023 2062 6567 696e 2063         # begin c
+000129c0: 7265 6174 696e 6720 7472 6163 6b73 0a20  reating tracks. 
+000129d0: 2020 2020 2020 2074 7261 636b 733a 204c         tracks: L
+000129e0: 6973 745b 4469 6374 5d20 3d20 5b5d 0a0a  ist[Dict] = []..
+000129f0: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
+00012a00: 2f2f 6769 7468 7562 2e63 6f6d 2f69 6776  //github.com/igv
+00012a10: 7465 616d 2f69 6776 2d6e 6f74 6562 6f6f  team/igv-noteboo
+00012a20: 6b2f 6973 7375 6573 2f33 202d 2d20 7265  k/issues/3 -- re
+00012a30: 736f 6c76 6564 206e 6f77 0a20 2020 2020  solved now.     
+00012a40: 2020 2064 6562 7567 2822 7365 7420 7570     debug("set up
+00012a50: 2073 6974 6520 6669 6c74 6572 7320 7472   site filters tr
+00012a60: 6163 6b73 2229 0a20 2020 2020 2020 2073  acks").        s
+00012a70: 656c 662e 5f76 6965 775f 616c 6967 6e6d  elf._view_alignm
+00012a80: 656e 7473 5f61 6464 5f73 6974 655f 6669  ents_add_site_fi
+00012a90: 6c74 6572 735f 7472 6163 6b73 280a 2020  lters_tracks(.  
+00012aa0: 2020 2020 2020 2020 2020 636f 6e74 6967            contig
+00012ab0: 3d63 6f6e 7469 672c 2076 6973 6962 696c  =contig, visibil
+00012ac0: 6974 795f 7769 6e64 6f77 3d76 6973 6962  ity_window=visib
+00012ad0: 696c 6974 795f 7769 6e64 6f77 2c20 7472  ility_window, tr
+00012ae0: 6163 6b73 3d74 7261 636b 730a 2020 2020  acks=tracks.    
+00012af0: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+00012b00: 6562 7567 2822 6164 6420 534e 5073 2074  ebug("add SNPs t
+00012b10: 7261 636b 2229 0a20 2020 2020 2020 2074  rack").        t
+00012b20: 7261 636b 732e 6170 7065 6e64 280a 2020  racks.append(.  
+00012b30: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+00012b40: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
+00012b50: 6522 3a20 2253 4e50 7322 2c0a 2020 2020  e": "SNPs",.    
+00012b60: 2020 2020 2020 2020 2020 2020 2275 726c              "url
+00012b70: 223a 2076 6366 5f75 726c 2c0a 2020 2020  ": vcf_url,.    
+00012b80: 2020 2020 2020 2020 2020 2020 2269 6e64              "ind
+00012b90: 6578 5552 4c22 3a20 6622 7b76 6366 5f75  exURL": f"{vcf_u
+00012ba0: 726c 7d2e 7462 6922 2c0a 2020 2020 2020  rl}.tbi",.      
+00012bb0: 2020 2020 2020 2020 2020 2266 6f72 6d61            "forma
+00012bc0: 7422 3a20 2276 6366 222c 0a20 2020 2020  t": "vcf",.     
+00012bd0: 2020 2020 2020 2020 2020 2022 7479 7065             "type
+00012be0: 223a 2022 7661 7269 616e 7422 2c0a 2020  ": "variant",.  
+00012bf0: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+00012c00: 6973 6962 696c 6974 7957 696e 646f 7722  isibilityWindow"
+00012c10: 3a20 7669 7369 6269 6c69 7479 5f77 696e  : visibility_win
+00012c20: 646f 772c 2020 2320 6270 0a20 2020 2020  dow,  # bp.     
+00012c30: 2020 2020 2020 2020 2020 2022 6865 6967             "heig
+00012c40: 6874 223a 2035 302c 0a20 2020 2020 2020  ht": 50,.       
+00012c50: 2020 2020 207d 0a20 2020 2020 2020 2029       }.        )
+00012c60: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+00012c70: 2261 6464 2061 6c69 676e 6d65 6e74 7320  "add alignments 
+00012c80: 7472 6163 6b22 290a 2020 2020 2020 2020  track").        
+00012c90: 7472 6163 6b73 2e61 7070 656e 6428 0a20  tracks.append(. 
+00012ca0: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
+00012cb0: 2020 2020 2020 2020 2020 2020 2022 6e61               "na
+00012cc0: 6d65 223a 2022 416c 6967 6e6d 656e 7473  me": "Alignments
+00012cd0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00012ce0: 2020 2022 7572 6c22 3a20 6261 6d5f 7572     "url": bam_ur
+00012cf0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+00012d00: 2020 2022 696e 6465 7855 524c 223a 2066     "indexURL": f
+00012d10: 227b 6261 6d5f 7572 6c7d 2e62 6169 222c  "{bam_url}.bai",
+00012d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d30: 2022 666f 726d 6174 223a 2022 6261 6d22   "format": "bam"
+00012d40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012d50: 2020 2274 7970 6522 3a20 2261 6c69 676e    "type": "align
+00012d60: 6d65 6e74 222c 0a20 2020 2020 2020 2020  ment",.         
+00012d70: 2020 2020 2020 2022 7669 7369 6269 6c69         "visibili
+00012d80: 7479 5769 6e64 6f77 223a 2076 6973 6962  tyWindow": visib
+00012d90: 696c 6974 795f 7769 6e64 6f77 2c20 2023  ility_window,  #
+00012da0: 2062 700a 2020 2020 2020 2020 2020 2020   bp.            
+00012db0: 2020 2020 2268 6569 6768 7422 3a20 3530      "height": 50
+00012dc0: 302c 0a20 2020 2020 2020 2020 2020 207d  0,.            }
+00012dd0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00012de0: 2020 2020 6465 6275 6728 2263 7265 6174      debug("creat
+00012df0: 6520 4947 5620 6272 6f77 7365 7222 290a  e IGV browser").
+00012e00: 2020 2020 2020 2020 7365 6c66 2e69 6776          self.igv
+00012e10: 2872 6567 696f 6e3d 7265 736f 6c76 6564  (region=resolved
+00012e20: 5f72 6567 696f 6e2c 2074 7261 636b 733d  _region, tracks=
+00012e30: 7472 6163 6b73 290a 0a20 2020 2064 6566  tracks)..    def
+00012e40: 205f 7063 6128 0a20 2020 2020 2020 2073   _pca(.        s
+00012e50: 656c 662c 0a20 2020 2020 2020 202a 2c0a  elf,.        *,.
+00012e60: 2020 2020 2020 2020 7265 6769 6f6e 2c0a          region,.
+00012e70: 2020 2020 2020 2020 6e5f 736e 7073 2c0a          n_snps,.
+00012e80: 2020 2020 2020 2020 7468 696e 5f6f 6666          thin_off
+00012e90: 7365 742c 0a20 2020 2020 2020 2073 616d  set,.        sam
+00012ea0: 706c 655f 7365 7473 2c0a 2020 2020 2020  ple_sets,.      
+00012eb0: 2020 7361 6d70 6c65 5f71 7565 7279 2c0a    sample_query,.
+00012ec0: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
+00012ed0: 6b2c 0a20 2020 2020 2020 206d 696e 5f6d  k,.        min_m
+00012ee0: 696e 6f72 5f61 632c 0a20 2020 2020 2020  inor_ac,.       
+00012ef0: 206d 6178 5f6d 6973 7369 6e67 5f61 6e2c   max_missing_an,
+00012f00: 0a20 2020 2020 2020 206e 5f63 6f6d 706f  .        n_compo
+00012f10: 6e65 6e74 732c 0a20 2020 2029 3a0a 2020  nents,.    ):.  
+00012f20: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
+00012f30: 6c66 2e5f 6c6f 672e 6465 6275 670a 0a20  lf._log.debug.. 
+00012f40: 2020 2020 2020 2064 6562 7567 2822 6163         debug("ac
+00012f50: 6365 7373 2053 4e50 2063 616c 6c73 2229  cess SNP calls")
+00012f60: 0a20 2020 2020 2020 2064 735f 736e 7073  .        ds_snps
+00012f70: 203d 2073 656c 662e 736e 705f 6361 6c6c   = self.snp_call
+00012f80: 7328 0a20 2020 2020 2020 2020 2020 2072  s(.            r
+00012f90: 6567 696f 6e3d 7265 6769 6f6e 2c0a 2020  egion=region,.  
+00012fa0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+00012fb0: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
+00012fc0: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
+00012fd0: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
+00012fe0: 6c65 5f71 7565 7279 2c0a 2020 2020 2020  le_query,.      
+00012ff0: 2020 2020 2020 7369 7465 5f6d 6173 6b3d        site_mask=
+00013000: 7369 7465 5f6d 6173 6b2c 0a20 2020 2020  site_mask,.     
+00013010: 2020 2029 0a20 2020 2020 2020 2064 6562     ).        deb
+00013020: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
+00013030: 6622 7b64 735f 736e 7073 2e64 696d 735b  f"{ds_snps.dims[
+00013040: 2776 6172 6961 6e74 7327 5d3a 2c7d 2076  'variants']:,} v
+00013050: 6172 6961 6e74 732c 207b 6473 5f73 6e70  ariants, {ds_snp
+00013060: 732e 6469 6d73 5b27 7361 6d70 6c65 7327  s.dims['samples'
+00013070: 5d3a 2c7d 2073 616d 706c 6573 220a 2020  ]:,} samples".  
+00013080: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00013090: 2064 6562 7567 2822 7065 7266 6f72 6d20   debug("perform 
+000130a0: 616c 6c65 6c65 2063 6f75 6e74 2229 0a20  allele count"). 
+000130b0: 2020 2020 2020 2061 6320 3d20 7365 6c66         ac = self
+000130c0: 2e73 6e70 5f61 6c6c 656c 655f 636f 756e  .snp_allele_coun
+000130d0: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
+000130e0: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
+000130f0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00013100: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
+00013110: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00013120: 7361 6d70 6c65 5f71 7565 7279 3d73 616d  sample_query=sam
+00013130: 706c 655f 7175 6572 792c 0a20 2020 2020  ple_query,.     
+00013140: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+00013150: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
+00013160: 2020 2020 290a 2020 2020 2020 2020 6e5f      ).        n_
+00013170: 6368 726f 6d73 203d 2064 735f 736e 7073  chroms = ds_snps
+00013180: 2e64 696d 735b 2273 616d 706c 6573 225d  .dims["samples"]
+00013190: 202a 2032 0a20 2020 2020 2020 2061 6e5f   * 2.        an_
+000131a0: 6361 6c6c 6564 203d 2061 632e 7375 6d28  called = ac.sum(
+000131b0: 6178 6973 3d31 290a 2020 2020 2020 2020  axis=1).        
+000131c0: 616e 5f6d 6973 7369 6e67 203d 206e 5f63  an_missing = n_c
+000131d0: 6872 6f6d 7320 2d20 616e 5f63 616c 6c65  hroms - an_calle
+000131e0: 640a 0a20 2020 2020 2020 2064 6562 7567  d..        debug
+000131f0: 2822 6173 6365 7274 6169 6e20 7369 7465  ("ascertain site
+00013200: 7322 290a 2020 2020 2020 2020 6163 203d  s").        ac =
+00013210: 2061 6c6c 656c 2e41 6c6c 656c 6543 6f75   allel.AlleleCou
+00013220: 6e74 7341 7272 6179 2861 6329 0a20 2020  ntsArray(ac).   
+00013230: 2020 2020 206d 696e 5f72 6566 5f61 6320       min_ref_ac 
+00013240: 3d20 6d69 6e5f 6d69 6e6f 725f 6163 0a20  = min_minor_ac. 
+00013250: 2020 2020 2020 206d 6178 5f72 6566 5f61         max_ref_a
+00013260: 6320 3d20 6e5f 6368 726f 6d73 202d 206d  c = n_chroms - m
+00013270: 696e 5f6d 696e 6f72 5f61 630a 2020 2020  in_minor_ac.    
+00013280: 2020 2020 2320 6865 7265 2077 6520 6368      # here we ch
+00013290: 6f6f 7365 2062 6961 6c6c 656c 6963 2073  oose biallelic s
+000132a0: 6974 6573 2069 6e76 6f6c 7669 6e67 2074  ites involving t
+000132b0: 6865 2072 6566 6572 656e 6365 2061 6c6c  he reference all
+000132c0: 656c 650a 2020 2020 2020 2020 6c6f 635f  ele.        loc_
+000132d0: 7369 7465 7320 3d20 280a 2020 2020 2020  sites = (.      
+000132e0: 2020 2020 2020 6163 2e69 735f 6269 616c        ac.is_bial
+000132f0: 6c65 6c69 6328 290a 2020 2020 2020 2020  lelic().        
+00013300: 2020 2020 2620 2861 635b 3a2c 2030 5d20      & (ac[:, 0] 
+00013310: 3e3d 206d 696e 5f72 6566 5f61 6329 0a20  >= min_ref_ac). 
+00013320: 2020 2020 2020 2020 2020 2026 2028 6163             & (ac
+00013330: 5b3a 2c20 305d 203c 3d20 6d61 785f 7265  [:, 0] <= max_re
+00013340: 665f 6163 290a 2020 2020 2020 2020 2020  f_ac).          
+00013350: 2020 2620 2861 6e5f 6d69 7373 696e 6720    & (an_missing 
+00013360: 3c3d 206d 6178 5f6d 6973 7369 6e67 5f61  <= max_missing_a
+00013370: 6e29 0a20 2020 2020 2020 2029 0a20 2020  n).        ).   
+00013380: 2020 2020 2064 6562 7567 2866 2261 7363       debug(f"asc
+00013390: 6572 7461 696e 6564 207b 6e70 2e63 6f75  ertained {np.cou
+000133a0: 6e74 5f6e 6f6e 7a65 726f 286c 6f63 5f73  nt_nonzero(loc_s
+000133b0: 6974 6573 293a 2c7d 2073 6974 6573 2229  ites):,} sites")
+000133c0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+000133d0: 2274 6869 6e20 7369 7465 7320 746f 2061  "thin sites to a
+000133e0: 7070 726f 7869 6d61 7465 6c79 2064 6573  pproximately des
+000133f0: 6972 6564 206e 756d 6265 7222 290a 2020  ired number").  
+00013400: 2020 2020 2020 6c6f 635f 7369 7465 7320        loc_sites 
+00013410: 3d20 6e70 2e6e 6f6e 7a65 726f 286c 6f63  = np.nonzero(loc
+00013420: 5f73 6974 6573 295b 305d 0a20 2020 2020  _sites)[0].     
+00013430: 2020 2074 6869 6e5f 7374 6570 203d 206d     thin_step = m
+00013440: 6178 286c 6f63 5f73 6974 6573 2e73 6861  ax(loc_sites.sha
+00013450: 7065 5b30 5d20 2f2f 206e 5f73 6e70 732c  pe[0] // n_snps,
+00013460: 2031 290a 2020 2020 2020 2020 6c6f 635f   1).        loc_
+00013470: 7369 7465 735f 7468 696e 6e65 6420 3d20  sites_thinned = 
+00013480: 6c6f 635f 7369 7465 735b 7468 696e 5f6f  loc_sites[thin_o
+00013490: 6666 7365 743a 3a74 6869 6e5f 7374 6570  ffset::thin_step
+000134a0: 5d0a 2020 2020 2020 2020 6465 6275 6728  ].        debug(
+000134b0: 6622 7468 696e 6e65 6420 746f 207b 6e70  f"thinned to {np
+000134c0: 2e63 6f75 6e74 5f6e 6f6e 7a65 726f 286c  .count_nonzero(l
+000134d0: 6f63 5f73 6974 6573 5f74 6869 6e6e 6564  oc_sites_thinned
+000134e0: 293a 2c7d 2073 6974 6573 2229 0a0a 2020  ):,} sites")..  
+000134f0: 2020 2020 2020 6465 6275 6728 2261 6363        debug("acc
+00013500: 6573 7320 6765 6e6f 7479 7065 7322 290a  ess genotypes").
+00013510: 2020 2020 2020 2020 6774 203d 2064 735f          gt = ds_
+00013520: 736e 7073 5b22 6361 6c6c 5f67 656e 6f74  snps["call_genot
+00013530: 7970 6522 5d2e 6461 7461 0a20 2020 2020  ype"].data.     
+00013540: 2020 2067 745f 6173 6320 3d20 6461 2e74     gt_asc = da.t
+00013550: 616b 6528 6774 2c20 6c6f 635f 7369 7465  ake(gt, loc_site
+00013560: 735f 7468 696e 6e65 642c 2061 7869 733d  s_thinned, axis=
+00013570: 3029 0a20 2020 2020 2020 2067 6e5f 6173  0).        gn_as
+00013580: 6320 3d20 616c 6c65 6c2e 4765 6e6f 7479  c = allel.Genoty
+00013590: 7065 4461 736b 4172 7261 7928 6774 5f61  peDaskArray(gt_a
+000135a0: 7363 292e 746f 5f6e 5f61 6c74 2829 0a20  sc).to_n_alt(). 
+000135b0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+000135c0: 2e5f 6461 736b 5f70 726f 6772 6573 7328  ._dask_progress(
+000135d0: 6465 7363 3d22 4c6f 6164 2053 4e50 2067  desc="Load SNP g
+000135e0: 656e 6f74 7970 6573 2229 3a0a 2020 2020  enotypes"):.    
+000135f0: 2020 2020 2020 2020 676e 5f61 7363 203d          gn_asc =
+00013600: 2067 6e5f 6173 632e 636f 6d70 7574 6528   gn_asc.compute(
+00013610: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00013620: 2822 7265 6d6f 7665 2061 6e79 2073 6974  ("remove any sit
+00013630: 6573 2077 6865 7265 2061 6c6c 2067 656e  es where all gen
+00013640: 6f74 7970 6573 2061 7265 2069 6465 6e74  otypes are ident
+00013650: 6963 616c 2229 0a20 2020 2020 2020 206c  ical").        l
+00013660: 6f63 5f76 6172 203d 206e 702e 616e 7928  oc_var = np.any(
+00013670: 676e 5f61 7363 2021 3d20 676e 5f61 7363  gn_asc != gn_asc
+00013680: 5b3a 2c20 302c 206e 702e 6e65 7761 7869  [:, 0, np.newaxi
+00013690: 735d 2c20 6178 6973 3d31 290a 2020 2020  s], axis=1).    
+000136a0: 2020 2020 676e 5f76 6172 203d 206e 702e      gn_var = np.
+000136b0: 636f 6d70 7265 7373 286c 6f63 5f76 6172  compress(loc_var
+000136c0: 2c20 676e 5f61 7363 2c20 6178 6973 3d30  , gn_asc, axis=0
+000136d0: 290a 2020 2020 2020 2020 6465 6275 6728  ).        debug(
+000136e0: 6622 6669 6e61 6c20 7368 6170 6520 7b67  f"final shape {g
+000136f0: 6e5f 7661 722e 7368 6170 657d 2229 0a0a  n_var.shape}")..
+00013700: 2020 2020 2020 2020 6465 6275 6728 2272          debug("r
+00013710: 756e 2074 6865 2050 4341 2229 0a20 2020  un the PCA").   
+00013720: 2020 2020 2063 6f6f 7264 732c 206d 6f64       coords, mod
+00013730: 656c 203d 2061 6c6c 656c 2e70 6361 2867  el = allel.pca(g
+00013740: 6e5f 7661 722c 206e 5f63 6f6d 706f 6e65  n_var, n_compone
+00013750: 6e74 733d 6e5f 636f 6d70 6f6e 656e 7473  nts=n_components
+00013760: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00013770: 2822 776f 726b 2061 726f 756e 6420 7369  ("work around si
+00013780: 676e 2069 6e64 6574 6572 6d69 6e61 6379  gn indeterminacy
+00013790: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
+000137a0: 2069 6e20 7261 6e67 6528 6e5f 636f 6d70   in range(n_comp
+000137b0: 6f6e 656e 7473 293a 0a20 2020 2020 2020  onents):.       
+000137c0: 2020 2020 2063 203d 2063 6f6f 7264 735b       c = coords[
+000137d0: 3a2c 2069 5d0a 2020 2020 2020 2020 2020  :, i].          
+000137e0: 2020 6966 206e 702e 6162 7328 632e 6d69    if np.abs(c.mi
+000137f0: 6e28 2929 203e 206e 702e 6162 7328 632e  n()) > np.abs(c.
+00013800: 6d61 7828 2929 3a0a 2020 2020 2020 2020  max()):.        
+00013810: 2020 2020 2020 2020 636f 6f72 6473 5b3a          coords[:
+00013820: 2c20 695d 203d 2063 202a 202d 310a 0a20  , i] = c * -1.. 
+00013830: 2020 2020 2020 2072 6573 756c 7473 203d         results =
+00013840: 2064 6963 7428 636f 6f72 6473 3d63 6f6f   dict(coords=coo
+00013850: 7264 732c 2065 7672 3d6d 6f64 656c 2e65  rds, evr=model.e
+00013860: 7870 6c61 696e 6564 5f76 6172 6961 6e63  xplained_varianc
+00013870: 655f 7261 7469 6f5f 290a 2020 2020 2020  e_ratio_).      
+00013880: 2020 7265 7475 726e 2072 6573 756c 7473    return results
+00013890: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+000138a0: 2020 2020 7375 6d6d 6172 793d 2222 220a      summary=""".
+000138b0: 2020 2020 2020 2020 2020 2020 506c 6f74              Plot
+000138c0: 2065 7870 6c61 696e 6564 2076 6172 6961   explained varia
+000138d0: 6e63 6520 7261 7469 6f73 2066 726f 6d20  nce ratios from 
+000138e0: 6120 7072 696e 6369 7061 6c20 636f 6d70  a principal comp
+000138f0: 6f6e 656e 7473 2061 6e61 6c79 7369 730a  onents analysis.
+00013900: 2020 2020 2020 2020 2020 2020 2850 4341              (PCA
+00013910: 2920 7573 696e 6720 6120 706c 6f74 6c79  ) using a plotly
+00013920: 2062 6172 2070 6c6f 742e 0a20 2020 2020   bar plot..     
+00013930: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+00013940: 7061 7261 6d65 7465 7273 3d64 6963 7428  parameters=dict(
+00013950: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+00013960: 7267 733d 2250 6173 7365 6420 7468 726f  rgs="Passed thro
+00013970: 7567 6820 746f 2070 782e 6261 7228 292e  ugh to px.bar().
+00013980: 222c 0a20 2020 2020 2020 2029 2c0a 2020  ",.        ),.  
+00013990: 2020 2020 2020 7265 7475 726e 733d 2241        returns="A
+000139a0: 2070 6c6f 746c 7920 6669 6775 7265 2e22   plotly figure."
+000139b0: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
+000139c0: 706c 6f74 5f70 6361 5f76 6172 6961 6e63  plot_pca_varianc
+000139d0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+000139e0: 0a20 2020 2020 2020 2065 7672 3a20 7063  .        evr: pc
+000139f0: 615f 7061 7261 6d73 2e65 7672 2c0a 2020  a_params.evr,.  
+00013a00: 2020 2020 2020 7769 6474 683a 2070 6c6f        width: plo
+00013a10: 746c 795f 7061 7261 6d73 2e77 6964 7468  tly_params.width
+00013a20: 203d 2039 3030 2c0a 2020 2020 2020 2020   = 900,.        
+00013a30: 6865 6967 6874 3a20 706c 6f74 6c79 5f70  height: plotly_p
+00013a40: 6172 616d 732e 6865 6967 6874 203d 2034  arams.height = 4
+00013a50: 3030 2c0a 2020 2020 2020 2020 2a2a 6b77  00,.        **kw
+00013a60: 6172 6773 2c0a 2020 2020 2920 2d3e 2067  args,.    ) -> g
+00013a70: 6f2e 4669 6775 7265 3a0a 2020 2020 2020  o.Figure:.      
+00013a80: 2020 6465 6275 6720 3d20 7365 6c66 2e5f    debug = self._
+00013a90: 6c6f 672e 6465 6275 670a 0a20 2020 2020  log.debug..     
+00013aa0: 2020 2064 6562 7567 2822 7072 6570 6172     debug("prepar
+00013ab0: 6520 706c 6f74 7469 6e67 2076 6172 6961  e plotting varia
+00013ac0: 626c 6573 2229 0a20 2020 2020 2020 2079  bles").        y
+00013ad0: 203d 2065 7672 202a 2031 3030 2020 2320   = evr * 100  # 
+00013ae0: 636f 6e76 6572 7420 746f 2070 6572 6365  convert to perce
+00013af0: 6e74 0a20 2020 2020 2020 2078 203d 205b  nt.        x = [
+00013b00: 7374 7228 6920 2b20 3129 2066 6f72 2069  str(i + 1) for i
+00013b10: 2069 6e20 7261 6e67 6528 6c65 6e28 7929   in range(len(y)
+00013b20: 295d 0a0a 2020 2020 2020 2020 6465 6275  )]..        debu
+00013b30: 6728 2273 6574 2075 7020 706c 6f74 7469  g("set up plotti
+00013b40: 6e67 206f 7074 696f 6e73 2229 0a20 2020  ng options").   
+00013b50: 2020 2020 2070 6c6f 745f 6b77 6172 6773       plot_kwargs
+00013b60: 203d 2064 6963 7428 0a20 2020 2020 2020   = dict(.       
+00013b70: 2020 2020 206c 6162 656c 733d 7b0a 2020       labels={.  
+00013b80: 2020 2020 2020 2020 2020 2020 2020 2278                "x
+00013b90: 223a 2022 5072 696e 6369 7061 6c20 636f  ": "Principal co
+00013ba0: 6d70 6f6e 656e 7422 2c0a 2020 2020 2020  mponent",.      
+00013bb0: 2020 2020 2020 2020 2020 2279 223a 2022            "y": "
+00013bc0: 4578 706c 6169 6e65 6420 7661 7269 616e  Explained varian
+00013bd0: 6365 2028 2529 222c 0a20 2020 2020 2020  ce (%)",.       
+00013be0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00013bf0: 2020 2020 7465 6d70 6c61 7465 3d22 7369      template="si
+00013c00: 6d70 6c65 5f77 6869 7465 222c 0a20 2020  mple_white",.   
+00013c10: 2020 2020 2020 2020 2077 6964 7468 3d77           width=w
+00013c20: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
+00013c30: 2020 6865 6967 6874 3d68 6569 6768 742c    height=height,
+00013c40: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00013c50: 2020 2064 6562 7567 2822 6170 706c 7920     debug("apply 
+00013c60: 616e 7920 7573 6572 206f 7665 7272 6964  any user overrid
+00013c70: 6573 2229 0a20 2020 2020 2020 2070 6c6f  es").        plo
+00013c80: 745f 6b77 6172 6773 2e75 7064 6174 6528  t_kwargs.update(
+00013c90: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
+00013ca0: 2064 6562 7567 2822 6d61 6b65 2061 2062   debug("make a b
+00013cb0: 6172 2070 6c6f 7422 290a 2020 2020 2020  ar plot").      
+00013cc0: 2020 6669 6720 3d20 7078 2e62 6172 2878    fig = px.bar(x
+00013cd0: 3d78 2c20 793d 792c 202a 2a70 6c6f 745f  =x, y=y, **plot_
+00013ce0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
+00013cf0: 2072 6574 7572 6e20 6669 670a 0a20 2020   return fig..   
+00013d00: 2064 6566 205f 636f 686f 7274 5f61 6c74   def _cohort_alt
+00013d10: 5f61 6c6c 656c 655f 636f 756e 7473 5f6d  _allele_counts_m
+00013d20: 656c 7428 7365 6c66 2c20 6774 2c20 696e  elt(self, gt, in
+00013d30: 6469 6365 732c 206d 6178 5f61 6c6c 656c  dices, max_allel
+00013d40: 6529 3a0a 2020 2020 2020 2020 6163 5f61  e):.        ac_a
+00013d50: 6c74 5f6d 656c 742c 2061 6e20 3d20 7365  lt_melt, an = se
+00013d60: 6c66 2e5f 636f 686f 7274 5f61 6c74 5f61  lf._cohort_alt_a
+00013d70: 6c6c 656c 655f 636f 756e 7473 5f6d 656c  llele_counts_mel
+00013d80: 745f 6b65 726e 656c 280a 2020 2020 2020  t_kernel(.      
+00013d90: 2020 2020 2020 6774 2c20 696e 6469 6365        gt, indice
+00013da0: 732c 206d 6178 5f61 6c6c 656c 650a 2020  s, max_allele.  
+00013db0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00013dc0: 616e 5f6d 656c 7420 3d20 6e70 2e72 6570  an_melt = np.rep
+00013dd0: 6561 7428 616e 2c20 6d61 785f 616c 6c65  eat(an, max_alle
+00013de0: 6c65 2c20 6178 6973 3d30 290a 2020 2020  le, axis=0).    
+00013df0: 2020 2020 7265 7475 726e 2061 635f 616c      return ac_al
+00013e00: 745f 6d65 6c74 2c20 616e 5f6d 656c 740a  t_melt, an_melt.
+00013e10: 0a20 2020 2064 6566 205f 7072 6570 5f73  .    def _prep_s
+00013e20: 616d 706c 6573 5f66 6f72 5f63 6f68 6f72  amples_for_cohor
+00013e30: 745f 6772 6f75 7069 6e67 2873 656c 662c  t_grouping(self,
+00013e40: 202a 2c20 6466 5f73 616d 706c 6573 2c20   *, df_samples, 
+00013e50: 6172 6561 5f62 792c 2070 6572 696f 645f  area_by, period_
+00013e60: 6279 293a 0a20 2020 2020 2020 2023 2074  by):.        # t
+00013e70: 616b 6520 6120 636f 7079 2c20 6173 2077  ake a copy, as w
+00013e80: 6520 7769 6c6c 206d 6f64 6966 7920 7468  e will modify th
+00013e90: 6520 6461 7461 6672 616d 650a 2020 2020  e dataframe.    
+00013ea0: 2020 2020 6466 5f73 616d 706c 6573 203d      df_samples =
+00013eb0: 2064 665f 7361 6d70 6c65 732e 636f 7079   df_samples.copy
+00013ec0: 2829 0a0a 2020 2020 2020 2020 2320 6669  ()..        # fi
+00013ed0: 7820 696e 7465 726d 6564 6961 7465 2074  x intermediate t
+00013ee0: 6178 6f6e 2076 616c 7565 7320 2d20 7765  axon values - we
+00013ef0: 206f 6e6c 7920 7761 6e74 2074 6f20 6275   only want to bu
+00013f00: 696c 6420 636f 686f 7274 7320 7769 7468  ild cohorts with
+00013f10: 2063 6c65 616e 0a20 2020 2020 2020 2023   clean.        #
+00013f20: 2074 6178 6f6e 2063 616c 6c73 2c20 736f   taxon calls, so
+00013f30: 2077 6520 7365 7420 696e 7465 726d 6564   we set intermed
+00013f40: 6961 7465 2076 616c 7565 7320 746f 204e  iate values to N
+00013f50: 6f6e 650a 2020 2020 2020 2020 6c6f 635f  one.        loc_
+00013f60: 696e 7465 726d 6564 6961 7465 5f74 6178  intermediate_tax
+00013f70: 6f6e 203d 2028 0a20 2020 2020 2020 2020  on = (.         
+00013f80: 2020 2064 665f 7361 6d70 6c65 735b 2274     df_samples["t
+00013f90: 6178 6f6e 225d 2e73 7472 2e73 7461 7274  axon"].str.start
+00013fa0: 7377 6974 6828 2269 6e74 6572 6d65 6469  swith("intermedi
+00013fb0: 6174 6522 292e 6669 6c6c 6e61 2846 616c  ate").fillna(Fal
+00013fc0: 7365 290a 2020 2020 2020 2020 290a 2020  se).        ).  
+00013fd0: 2020 2020 2020 6466 5f73 616d 706c 6573        df_samples
+00013fe0: 2e6c 6f63 5b6c 6f63 5f69 6e74 6572 6d65  .loc[loc_interme
+00013ff0: 6469 6174 655f 7461 786f 6e2c 2022 7461  diate_taxon, "ta
+00014000: 786f 6e22 5d20 3d20 4e6f 6e65 0a0a 2020  xon"] = None..  
+00014010: 2020 2020 2020 2320 6164 6420 7065 7269        # add peri
+00014020: 6f64 2063 6f6c 756d 6e0a 2020 2020 2020  od column.      
+00014030: 2020 6966 2070 6572 696f 645f 6279 203d    if period_by =
+00014040: 3d20 2279 6561 7222 3a0a 2020 2020 2020  = "year":.      
+00014050: 2020 2020 2020 6d61 6b65 5f70 6572 696f        make_perio
+00014060: 6420 3d20 7365 6c66 2e5f 6d61 6b65 5f73  d = self._make_s
+00014070: 616d 706c 655f 7065 7269 6f64 5f79 6561  ample_period_yea
+00014080: 720a 2020 2020 2020 2020 656c 6966 2070  r.        elif p
+00014090: 6572 696f 645f 6279 203d 3d20 2271 7561  eriod_by == "qua
+000140a0: 7274 6572 223a 0a20 2020 2020 2020 2020  rter":.         
+000140b0: 2020 206d 616b 655f 7065 7269 6f64 203d     make_period =
+000140c0: 2073 656c 662e 5f6d 616b 655f 7361 6d70   self._make_samp
+000140d0: 6c65 5f70 6572 696f 645f 7175 6172 7465  le_period_quarte
+000140e0: 720a 2020 2020 2020 2020 656c 6966 2070  r.        elif p
+000140f0: 6572 696f 645f 6279 203d 3d20 226d 6f6e  eriod_by == "mon
+00014100: 7468 223a 0a20 2020 2020 2020 2020 2020  th":.           
+00014110: 206d 616b 655f 7065 7269 6f64 203d 2073   make_period = s
+00014120: 656c 662e 5f6d 616b 655f 7361 6d70 6c65  elf._make_sample
+00014130: 5f70 6572 696f 645f 6d6f 6e74 680a 2020  _period_month.  
+00014140: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014150: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00014160: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00014170: 2020 2020 2020 2020 2020 6622 5661 6c75            f"Valu
+00014180: 6520 666f 7220 7065 7269 6f64 5f62 7920  e for period_by 
+00014190: 7061 7261 6d65 7465 7220 6d75 7374 2062  parameter must b
+000141a0: 6520 6f6e 6520 6f66 2027 7965 6172 272c  e one of 'year',
+000141b0: 2027 7175 6172 7465 7227 2c20 276d 6f6e   'quarter', 'mon
+000141c0: 7468 273b 2066 6f75 6e64 207b 7065 7269  th'; found {peri
+000141d0: 6f64 5f62 7921 727d 2e22 0a20 2020 2020  od_by!r}.".     
+000141e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000141f0: 2073 616d 706c 655f 7065 7269 6f64 203d   sample_period =
+00014200: 2064 665f 7361 6d70 6c65 732e 6170 706c   df_samples.appl
+00014210: 7928 6d61 6b65 5f70 6572 696f 642c 2061  y(make_period, a
+00014220: 7869 733d 2263 6f6c 756d 6e73 2229 0a20  xis="columns"). 
+00014230: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
+00014240: 735b 2270 6572 696f 6422 5d20 3d20 7361  s["period"] = sa
+00014250: 6d70 6c65 5f70 6572 696f 640a 0a20 2020  mple_period..   
+00014260: 2020 2020 2023 2061 6464 2061 7265 6120       # add area 
+00014270: 636f 6c75 6d6e 2066 6f72 2063 6f6e 7369  column for consi
+00014280: 7374 656e 7420 6f75 7470 7574 0a20 2020  stent output.   
+00014290: 2020 2020 2064 665f 7361 6d70 6c65 735b       df_samples[
+000142a0: 2261 7265 6122 5d20 3d20 6466 5f73 616d  "area"] = df_sam
+000142b0: 706c 6573 5b61 7265 615f 6279 5d0a 0a20  ples[area_by].. 
+000142c0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+000142d0: 5f73 616d 706c 6573 0a0a 2020 2020 6465  _samples..    de
+000142e0: 6620 5f72 6567 696f 6e5f 7374 7228 7365  f _region_str(se
+000142f0: 6c66 2c20 7265 6769 6f6e 293a 0a20 2020  lf, region):.   
+00014300: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
+00014310: 6120 7265 6769 6f6e 2074 6f20 6120 7374  a region to a st
+00014320: 7269 6e67 2072 6570 7265 7365 6e74 6174  ring representat
+00014330: 696f 6e2e 0a0a 2020 2020 2020 2020 5061  ion...        Pa
+00014340: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00014350: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00014360: 2020 2020 7265 6769 6f6e 203a 2052 6567      region : Reg
+00014370: 696f 6e20 6f72 206c 6973 7420 6f66 2052  ion or list of R
+00014380: 6567 696f 6e0a 2020 2020 2020 2020 2020  egion.          
+00014390: 2020 5468 6520 7265 6769 6f6e 2074 6f20    The region to 
+000143a0: 6469 7370 6c61 792e 0a0a 2020 2020 2020  display...      
+000143b0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+000143c0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+000143d0: 2020 6f75 7420 3a20 7374 720a 0a20 2020    out : str..   
+000143e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000143f0: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
+00014400: 6567 696f 6e2c 206c 6973 7429 3a0a 2020  egion, list):.  
+00014410: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00014420: 2872 6567 696f 6e29 203e 2031 3a0a 2020  (region) > 1:.  
+00014430: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00014440: 7475 726e 2022 3b20 222e 6a6f 696e 285b  turn "; ".join([
+00014450: 7365 6c66 2e5f 7265 6769 6f6e 5f73 7472  self._region_str
+00014460: 2872 2920 666f 7220 7220 696e 2072 6567  (r) for r in reg
+00014470: 696f 6e5d 290a 2020 2020 2020 2020 2020  ion]).          
+00014480: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00014490: 2020 2020 2020 2020 7265 6769 6f6e 203d          region =
+000144a0: 2072 6567 696f 6e5b 305d 0a0a 2020 2020   region[0]..    
+000144b0: 2020 2020 2320 7361 6e69 7479 2063 6865      # sanity che
+000144c0: 636b 0a20 2020 2020 2020 2061 7373 6572  ck.        asser
+000144d0: 7420 6973 696e 7374 616e 6365 2872 6567  t isinstance(reg
+000144e0: 696f 6e2c 2052 6567 696f 6e29 0a0a 2020  ion, Region)..  
+000144f0: 2020 2020 2020 7265 7475 726e 2073 7472        return str
+00014500: 2872 6567 696f 6e29 0a0a 2020 2020 6465  (region)..    de
+00014510: 6620 5f6c 6f6f 6b75 705f 7361 6d70 6c65  f _lookup_sample
+00014520: 2873 656c 662c 2073 616d 706c 652c 2073  (self, sample, s
+00014530: 616d 706c 655f 7365 743d 4e6f 6e65 293a  ample_set=None):
+00014540: 0a20 2020 2020 2020 2064 665f 7361 6d70  .        df_samp
+00014550: 6c65 7320 3d20 7365 6c66 2e73 616d 706c  les = self.sampl
+00014560: 655f 6d65 7461 6461 7461 2873 616d 706c  e_metadata(sampl
+00014570: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
+00014580: 7429 2e73 6574 5f69 6e64 6578 2822 7361  t).set_index("sa
+00014590: 6d70 6c65 5f69 6422 290a 2020 2020 2020  mple_id").      
+000145a0: 2020 7361 6d70 6c65 5f72 6563 203d 204e    sample_rec = N
+000145b0: 6f6e 650a 2020 2020 2020 2020 6966 2069  one.        if i
+000145c0: 7369 6e73 7461 6e63 6528 7361 6d70 6c65  sinstance(sample
+000145d0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+000145e0: 2020 2020 7361 6d70 6c65 5f72 6563 203d      sample_rec =
+000145f0: 2064 665f 7361 6d70 6c65 732e 6c6f 635b   df_samples.loc[
+00014600: 7361 6d70 6c65 5d0a 2020 2020 2020 2020  sample].        
+00014610: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00014620: 7361 6d70 6c65 2c20 696e 7429 3a0a 2020  sample, int):.  
+00014630: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+00014640: 5f72 6563 203d 2064 665f 7361 6d70 6c65  _rec = df_sample
+00014650: 732e 696c 6f63 5b73 616d 706c 655d 0a20  s.iloc[sample]. 
+00014660: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014670: 2020 2020 2020 2020 2074 7970 655f 6572           type_er
+00014680: 726f 7228 6e61 6d65 3d22 7361 6d70 6c65  ror(name="sample
+00014690: 222c 2076 616c 7565 3d73 616d 706c 652c  ", value=sample,
+000146a0: 2065 7870 6563 7461 7469 6f6e 3d28 7374   expectation=(st
+000146b0: 722c 2069 6e74 2929 0a20 2020 2020 2020  r, int)).       
+000146c0: 2072 6574 7572 6e20 7361 6d70 6c65 5f72   return sample_r
+000146d0: 6563 0a0a 2020 2020 6465 6620 5f70 6c6f  ec..    def _plo
+000146e0: 745f 6865 7465 726f 7a79 676f 7369 7479  t_heterozygosity
+000146f0: 5f74 7261 636b 280a 2020 2020 2020 2020  _track(.        
+00014700: 7365 6c66 2c0a 2020 2020 2020 2020 2a2c  self,.        *,
+00014710: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+00014720: 6964 2c0a 2020 2020 2020 2020 7361 6d70  id,.        samp
+00014730: 6c65 5f73 6574 2c0a 2020 2020 2020 2020  le_set,.        
+00014740: 7769 6e64 6f77 732c 0a20 2020 2020 2020  windows,.       
+00014750: 2063 6f75 6e74 732c 0a20 2020 2020 2020   counts,.       
+00014760: 2072 6567 696f 6e2c 0a20 2020 2020 2020   region,.       
+00014770: 2077 696e 646f 775f 7369 7a65 2c0a 2020   window_size,.  
+00014780: 2020 2020 2020 795f 6d61 782c 0a20 2020        y_max,.   
+00014790: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
+000147a0: 2c0a 2020 2020 2020 2020 7769 6474 682c  ,.        width,
+000147b0: 0a20 2020 2020 2020 2068 6569 6768 742c  .        height,
+000147c0: 0a20 2020 2020 2020 2063 6972 636c 655f  .        circle_
+000147d0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+000147e0: 7368 6f77 2c0a 2020 2020 2020 2020 785f  show,.        x_
+000147f0: 7261 6e67 652c 0a20 2020 2029 3a0a 2020  range,.    ):.  
+00014800: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
+00014810: 6c66 2e5f 6c6f 672e 6465 6275 670a 0a20  lf._log.debug.. 
+00014820: 2020 2020 2020 2072 6567 696f 6e20 3d20         region = 
+00014830: 7365 6c66 2e72 6573 6f6c 7665 5f72 6567  self.resolve_reg
+00014840: 696f 6e28 7265 6769 6f6e 290a 0a20 2020  ion(region)..   
+00014850: 2020 2020 2023 2070 6f73 2061 7869 730a       # pos axis.
+00014860: 2020 2020 2020 2020 7769 6e64 6f77 5f70          window_p
+00014870: 6f73 203d 2077 696e 646f 7773 2e6d 6561  os = windows.mea
+00014880: 6e28 6178 6973 3d31 290a 0a20 2020 2020  n(axis=1)..     
+00014890: 2020 2023 2068 6574 2061 7869 730a 2020     # het axis.  
+000148a0: 2020 2020 2020 7769 6e64 6f77 5f68 6574        window_het
+000148b0: 203d 2063 6f75 6e74 7320 2f20 7769 6e64   = counts / wind
+000148c0: 6f77 5f73 697a 650a 0a20 2020 2020 2020  ow_size..       
+000148d0: 2023 2064 6574 6572 6d69 6e65 2070 6c6f   # determine plo
+000148e0: 7474 696e 6720 6c69 6d69 7473 0a20 2020  tting limits.   
+000148f0: 2020 2020 2069 6620 785f 7261 6e67 6520       if x_range 
+00014900: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00014910: 2020 2020 2069 6620 7265 6769 6f6e 2e73       if region.s
+00014920: 7461 7274 2069 7320 6e6f 7420 4e6f 6e65  tart is not None
+00014930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014940: 2020 785f 6d69 6e20 3d20 7265 6769 6f6e    x_min = region
+00014950: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
+00014960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00014970: 2020 2020 2020 2020 2078 5f6d 696e 203d           x_min =
+00014980: 2030 0a20 2020 2020 2020 2020 2020 2069   0.            i
+00014990: 6620 7265 6769 6f6e 2e65 6e64 2069 7320  f region.end is 
+000149a0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000149b0: 2020 2020 2020 2020 2020 785f 6d61 7820            x_max 
+000149c0: 3d20 7265 6769 6f6e 2e65 6e64 0a20 2020  = region.end.   
+000149d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000149e0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+000149f0: 5f6d 6178 203d 206c 656e 2873 656c 662e  _max = len(self.
+00014a00: 6765 6e6f 6d65 5f73 6571 7565 6e63 6528  genome_sequence(
+00014a10: 7265 6769 6f6e 2e63 6f6e 7469 6729 290a  region.contig)).
+00014a20: 2020 2020 2020 2020 2020 2020 785f 7261              x_ra
+00014a30: 6e67 6520 3d20 626f 6b65 682e 6d6f 6465  nge = bokeh.mode
+00014a40: 6c73 2e52 616e 6765 3164 2878 5f6d 696e  ls.Range1d(x_min
+00014a50: 2c20 785f 6d61 782c 2062 6f75 6e64 733d  , x_max, bounds=
+00014a60: 2261 7574 6f22 290a 0a20 2020 2020 2020  "auto")..       
+00014a70: 2064 6562 7567 2822 6372 6561 7465 2061   debug("create a
+00014a80: 2066 6967 7572 6520 666f 7220 706c 6f74   figure for plot
+00014a90: 7469 6e67 2229 0a20 2020 2020 2020 2078  ting").        x
+00014aa0: 7768 6565 6c5f 7a6f 6f6d 203d 2062 6f6b  wheel_zoom = bok
+00014ab0: 6568 2e6d 6f64 656c 732e 5768 6565 6c5a  eh.models.WheelZ
+00014ac0: 6f6f 6d54 6f6f 6c28 0a20 2020 2020 2020  oomTool(.       
+00014ad0: 2020 2020 2064 696d 656e 7369 6f6e 733d       dimensions=
+00014ae0: 2277 6964 7468 222c 206d 6169 6e74 6169  "width", maintai
+00014af0: 6e5f 666f 6375 733d 4661 6c73 650a 2020  n_focus=False.  
+00014b00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00014b10: 6669 6720 3d20 626f 6b65 682e 706c 6f74  fig = bokeh.plot
+00014b20: 7469 6e67 2e66 6967 7572 6528 0a20 2020  ting.figure(.   
+00014b30: 2020 2020 2020 2020 2074 6974 6c65 3d66           title=f
+00014b40: 227b 7361 6d70 6c65 5f69 647d 2028 7b73  "{sample_id} ({s
+00014b50: 616d 706c 655f 7365 747d 2922 2c0a 2020  ample_set})",.  
+00014b60: 2020 2020 2020 2020 2020 746f 6f6c 733d            tools=
+00014b70: 5b22 7870 616e 222c 2022 787a 6f6f 6d5f  ["xpan", "xzoom_
+00014b80: 696e 222c 2022 787a 6f6f 6d5f 6f75 7422  in", "xzoom_out"
+00014b90: 2c20 7877 6865 656c 5f7a 6f6f 6d2c 2022  , xwheel_zoom, "
+00014ba0: 7265 7365 7422 5d2c 0a20 2020 2020 2020  reset"],.       
+00014bb0: 2020 2020 2061 6374 6976 655f 7363 726f       active_scro
+00014bc0: 6c6c 3d78 7768 6565 6c5f 7a6f 6f6d 2c0a  ll=xwheel_zoom,.
+00014bd0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+00014be0: 7665 5f64 7261 673d 2278 7061 6e22 2c0a  ve_drag="xpan",.
+00014bf0: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
+00014c00: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
+00014c10: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
+00014c20: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
+00014c30: 2020 2020 2020 2020 2020 6865 6967 6874            height
+00014c40: 3d68 6569 6768 742c 0a20 2020 2020 2020  =height,.       
+00014c50: 2020 2020 2074 6f6f 6c62 6172 5f6c 6f63       toolbar_loc
+00014c60: 6174 696f 6e3d 2261 626f 7665 222c 0a20  ation="above",. 
+00014c70: 2020 2020 2020 2020 2020 2078 5f72 616e             x_ran
+00014c80: 6765 3d78 5f72 616e 6765 2c0a 2020 2020  ge=x_range,.    
+00014c90: 2020 2020 2020 2020 795f 7261 6e67 653d          y_range=
+00014ca0: 2830 2c20 795f 6d61 7829 2c0a 2020 2020  (0, y_max),.    
+00014cb0: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+00014cc0: 6562 7567 2822 706c 6f74 2068 6574 6572  ebug("plot heter
+00014cd0: 6f7a 7967 6f73 6974 7922 290a 2020 2020  ozygosity").    
+00014ce0: 2020 2020 6461 7461 203d 2070 642e 4461      data = pd.Da
+00014cf0: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
+00014d00: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00014d10: 2020 2020 2020 2022 706f 7369 7469 6f6e         "position
+00014d20: 223a 2077 696e 646f 775f 706f 732c 0a20  ": window_pos,. 
+00014d30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014d40: 6865 7465 726f 7a79 676f 7369 7479 223a  heterozygosity":
+00014d50: 2077 696e 646f 775f 6865 742c 0a20 2020   window_het,.   
+00014d60: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00014d70: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00014d80: 6369 7263 6c65 5f6b 7761 7267 7320 6973  circle_kwargs is
+00014d90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00014da0: 2020 2063 6972 636c 655f 6b77 6172 6773     circle_kwargs
+00014db0: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+00014dc0: 2020 6369 7263 6c65 5f6b 7761 7267 732e    circle_kwargs.
+00014dd0: 7365 7464 6566 6175 6c74 2822 7369 7a65  setdefault("size
+00014de0: 222c 2033 290a 2020 2020 2020 2020 6669  ", 3).        fi
+00014df0: 672e 6369 7263 6c65 2878 3d22 706f 7369  g.circle(x="posi
+00014e00: 7469 6f6e 222c 2079 3d22 6865 7465 726f  tion", y="hetero
+00014e10: 7a79 676f 7369 7479 222c 2073 6f75 7263  zygosity", sourc
+00014e20: 653d 6461 7461 2c20 2a2a 6369 7263 6c65  e=data, **circle
+00014e30: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
+00014e40: 2020 6465 6275 6728 2274 6964 7920 7570    debug("tidy up
+00014e50: 2074 6865 2070 6c6f 7422 290a 2020 2020   the plot").    
+00014e60: 2020 2020 6669 672e 7961 7869 732e 6178      fig.yaxis.ax
+00014e70: 6973 5f6c 6162 656c 203d 2022 4865 7465  is_label = "Hete
+00014e80: 726f 7a79 676f 7369 7479 2028 6270 e281  rozygosity (bp..
+00014e90: bbc2 b929 220a 2020 2020 2020 2020 7365  ...)".        se
+00014ea0: 6c66 2e5f 626f 6b65 685f 7374 796c 655f  lf._bokeh_style_
+00014eb0: 6765 6e6f 6d65 5f78 6178 6973 2866 6967  genome_xaxis(fig
+00014ec0: 2c20 7265 6769 6f6e 2e63 6f6e 7469 6729  , region.contig)
+00014ed0: 0a0a 2020 2020 2020 2020 6966 2073 686f  ..        if sho
+00014ee0: 773a 0a20 2020 2020 2020 2020 2020 2062  w:.            b
+00014ef0: 6f6b 6568 2e70 6c6f 7474 696e 672e 7368  okeh.plotting.sh
+00014f00: 6f77 2866 6967 290a 0a20 2020 2020 2020  ow(fig)..       
+00014f10: 2072 6574 7572 6e20 6669 670a 0a20 2020   return fig..   
+00014f20: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
+00014f30: 756d 6d61 7279 3d22 506c 6f74 2077 696e  ummary="Plot win
+00014f40: 646f 7765 6420 6865 7465 726f 7a79 676f  dowed heterozygo
+00014f50: 7369 7479 2066 6f72 2061 2073 696e 676c  sity for a singl
+00014f60: 6520 7361 6d70 6c65 206f 7665 7220 6120  e sample over a 
+00014f70: 6765 6e6f 6d65 2072 6567 696f 6e2e 222c  genome region.",
+00014f80: 0a20 2020 2029 0a20 2020 2064 6566 2070  .    ).    def p
+00014f90: 6c6f 745f 6865 7465 726f 7a79 676f 7369  lot_heterozygosi
+00014fa0: 7479 5f74 7261 636b 280a 2020 2020 2020  ty_track(.      
+00014fb0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00014fc0: 7361 6d70 6c65 3a20 6865 745f 7061 7261  sample: het_para
+00014fd0: 6d73 2e73 616d 706c 652c 0a20 2020 2020  ms.sample,.     
+00014fe0: 2020 2072 6567 696f 6e3a 2062 6173 655f     region: base_
+00014ff0: 7061 7261 6d73 2e72 6567 696f 6e2c 0a20  params.region,. 
+00015000: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
+00015010: 7a65 3a20 6865 745f 7061 7261 6d73 2e77  ze: het_params.w
+00015020: 696e 646f 775f 7369 7a65 203d 2068 6574  indow_size = het
+00015030: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
+00015040: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
+00015050: 2020 2020 2079 5f6d 6178 3a20 6865 745f       y_max: het_
+00015060: 7061 7261 6d73 2e79 5f6d 6178 203d 2068  params.y_max = h
+00015070: 6574 5f70 6172 616d 732e 795f 6d61 785f  et_params.y_max_
+00015080: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+00015090: 2063 6972 636c 655f 6b77 6172 6773 3a20   circle_kwargs: 
+000150a0: 4f70 7469 6f6e 616c 5b68 6574 5f70 6172  Optional[het_par
+000150b0: 616d 732e 6369 7263 6c65 5f6b 7761 7267  ams.circle_kwarg
+000150c0: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+000150d0: 2020 2073 6974 655f 6d61 736b 3a20 6261     site_mask: ba
+000150e0: 7365 5f70 6172 616d 732e 7369 7465 5f6d  se_params.site_m
+000150f0: 6173 6b20 3d20 4445 4641 554c 542c 0a20  ask = DEFAULT,. 
+00015100: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+00015110: 743a 204f 7074 696f 6e61 6c5b 6261 7365  t: Optional[base
+00015120: 5f70 6172 616d 732e 7361 6d70 6c65 5f73  _params.sample_s
+00015130: 6574 5d20 3d20 4e6f 6e65 2c0a 2020 2020  et] = None,.    
+00015140: 2020 2020 7369 7a69 6e67 5f6d 6f64 653a      sizing_mode:
+00015150: 2067 706c 745f 7061 7261 6d73 2e73 697a   gplt_params.siz
+00015160: 696e 675f 6d6f 6465 203d 2067 706c 745f  ing_mode = gplt_
+00015170: 7061 7261 6d73 2e73 697a 696e 675f 6d6f  params.sizing_mo
+00015180: 6465 5f64 6566 6175 6c74 2c0a 2020 2020  de_default,.    
+00015190: 2020 2020 7769 6474 683a 2067 706c 745f      width: gplt_
+000151a0: 7061 7261 6d73 2e77 6964 7468 203d 2067  params.width = g
+000151b0: 706c 745f 7061 7261 6d73 2e77 6964 7468  plt_params.width
+000151c0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+000151d0: 2020 6865 6967 6874 3a20 6770 6c74 5f70    height: gplt_p
+000151e0: 6172 616d 732e 6865 6967 6874 203d 2032  arams.height = 2
+000151f0: 3030 2c0a 2020 2020 2020 2020 7368 6f77  00,.        show
+00015200: 3a20 6770 6c74 5f70 6172 616d 732e 7368  : gplt_params.sh
+00015210: 6f77 203d 2054 7275 652c 0a20 2020 2020  ow = True,.     
+00015220: 2020 2078 5f72 616e 6765 3a20 4f70 7469     x_range: Opti
+00015230: 6f6e 616c 5b67 706c 745f 7061 7261 6d73  onal[gplt_params
+00015240: 2e78 5f72 616e 6765 5d20 3d20 4e6f 6e65  .x_range] = None
+00015250: 2c0a 2020 2020 2920 2d3e 2067 706c 745f  ,.    ) -> gplt_
+00015260: 7061 7261 6d73 2e66 6967 7572 653a 0a20  params.figure:. 
+00015270: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
+00015280: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
+00015290: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
+000152a0: 6f6d 7075 7465 2077 696e 646f 7765 6420  ompute windowed 
+000152b0: 6865 7465 726f 7a79 676f 7369 7479 2229  heterozygosity")
+000152c0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+000152d0: 6964 2c20 7361 6d70 6c65 5f73 6574 2c20  id, sample_set, 
+000152e0: 7769 6e64 6f77 732c 2063 6f75 6e74 7320  windows, counts 
+000152f0: 3d20 7365 6c66 2e5f 7361 6d70 6c65 5f63  = self._sample_c
+00015300: 6f75 6e74 5f68 6574 280a 2020 2020 2020  ount_het(.      
+00015310: 2020 2020 2020 7361 6d70 6c65 3d73 616d        sample=sam
+00015320: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
+00015330: 2072 6567 696f 6e3d 7265 6769 6f6e 2c0a   region=region,.
+00015340: 2020 2020 2020 2020 2020 2020 7369 7465              site
+00015350: 5f6d 6173 6b3d 7369 7465 5f6d 6173 6b2c  _mask=site_mask,
+00015360: 0a20 2020 2020 2020 2020 2020 2077 696e  .            win
+00015370: 646f 775f 7369 7a65 3d77 696e 646f 775f  dow_size=window_
+00015380: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+00015390: 2020 7361 6d70 6c65 5f73 6574 3d73 616d    sample_set=sam
+000153a0: 706c 655f 7365 742c 0a20 2020 2020 2020  ple_set,.       
+000153b0: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
+000153c0: 6728 2270 6c6f 7420 6865 7465 726f 7a79  g("plot heterozy
+000153d0: 676f 7369 7479 2229 0a20 2020 2020 2020  gosity").       
+000153e0: 2066 6967 203d 2073 656c 662e 5f70 6c6f   fig = self._plo
+000153f0: 745f 6865 7465 726f 7a79 676f 7369 7479  t_heterozygosity
+00015400: 5f74 7261 636b 280a 2020 2020 2020 2020  _track(.        
+00015410: 2020 2020 7361 6d70 6c65 5f69 643d 7361      sample_id=sa
+00015420: 6d70 6c65 5f69 642c 0a20 2020 2020 2020  mple_id,.       
+00015430: 2020 2020 2073 616d 706c 655f 7365 743d       sample_set=
+00015440: 7361 6d70 6c65 5f73 6574 2c0a 2020 2020  sample_set,.    
+00015450: 2020 2020 2020 2020 7769 6e64 6f77 733d          windows=
+00015460: 7769 6e64 6f77 732c 0a20 2020 2020 2020  windows,.       
+00015470: 2020 2020 2063 6f75 6e74 733d 636f 756e       counts=coun
+00015480: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00015490: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
+000154a0: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+000154b0: 775f 7369 7a65 3d77 696e 646f 775f 7369  w_size=window_si
+000154c0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+000154d0: 795f 6d61 783d 795f 6d61 782c 0a20 2020  y_max=y_max,.   
+000154e0: 2020 2020 2020 2020 2073 697a 696e 675f           sizing_
+000154f0: 6d6f 6465 3d73 697a 696e 675f 6d6f 6465  mode=sizing_mode
+00015500: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+00015510: 6474 683d 7769 6474 682c 0a20 2020 2020  dth=width,.     
+00015520: 2020 2020 2020 2068 6569 6768 743d 6865         height=he
+00015530: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+00015540: 2020 6369 7263 6c65 5f6b 7761 7267 733d    circle_kwargs=
+00015550: 6369 7263 6c65 5f6b 7761 7267 732c 0a20  circle_kwargs,. 
+00015560: 2020 2020 2020 2020 2020 2073 686f 773d             show=
+00015570: 7368 6f77 2c0a 2020 2020 2020 2020 2020  show,.          
+00015580: 2020 785f 7261 6e67 653d 785f 7261 6e67    x_range=x_rang
+00015590: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+000155a0: 2020 2020 2020 7265 7475 726e 2066 6967        return fig
+000155b0: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+000155c0: 2020 2020 7375 6d6d 6172 793d 2250 6c6f      summary="Plo
+000155d0: 7420 7769 6e64 6f77 6564 2068 6574 6572  t windowed heter
+000155e0: 6f7a 7967 6f73 6974 7920 666f 7220 6120  ozygosity for a 
+000155f0: 7369 6e67 6c65 2073 616d 706c 6520 6f76  single sample ov
+00015600: 6572 2061 2067 656e 6f6d 6520 7265 6769  er a genome regi
+00015610: 6f6e 2e22 2c0a 2020 2020 2020 2020 7265  on.",.        re
+00015620: 7475 726e 733d 2242 6f6b 6568 2066 6967  turns="Bokeh fig
+00015630: 7572 652e 222c 0a20 2020 2029 0a20 2020  ure.",.    ).   
+00015640: 2064 6566 2070 6c6f 745f 6865 7465 726f   def plot_hetero
+00015650: 7a79 676f 7369 7479 280a 2020 2020 2020  zygosity(.      
+00015660: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00015670: 7361 6d70 6c65 3a20 6865 745f 7061 7261  sample: het_para
+00015680: 6d73 2e73 616d 706c 652c 0a20 2020 2020  ms.sample,.     
+00015690: 2020 2072 6567 696f 6e3a 2062 6173 655f     region: base_
+000156a0: 7061 7261 6d73 2e72 6567 696f 6e2c 0a20  params.region,. 
+000156b0: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
+000156c0: 7a65 3a20 6865 745f 7061 7261 6d73 2e77  ze: het_params.w
+000156d0: 696e 646f 775f 7369 7a65 203d 2068 6574  indow_size = het
+000156e0: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
+000156f0: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
+00015700: 2020 2020 2079 5f6d 6178 3a20 6865 745f       y_max: het_
+00015710: 7061 7261 6d73 2e79 5f6d 6178 203d 2068  params.y_max = h
+00015720: 6574 5f70 6172 616d 732e 795f 6d61 785f  et_params.y_max_
+00015730: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+00015740: 2063 6972 636c 655f 6b77 6172 6773 3a20   circle_kwargs: 
+00015750: 4f70 7469 6f6e 616c 5b68 6574 5f70 6172  Optional[het_par
+00015760: 616d 732e 6369 7263 6c65 5f6b 7761 7267  ams.circle_kwarg
+00015770: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+00015780: 2020 2073 6974 655f 6d61 736b 3a20 6261     site_mask: ba
+00015790: 7365 5f70 6172 616d 732e 7369 7465 5f6d  se_params.site_m
+000157a0: 6173 6b20 3d20 4445 4641 554c 542c 0a20  ask = DEFAULT,. 
+000157b0: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+000157c0: 743a 204f 7074 696f 6e61 6c5b 6261 7365  t: Optional[base
+000157d0: 5f70 6172 616d 732e 7361 6d70 6c65 5f73  _params.sample_s
+000157e0: 6574 5d20 3d20 4e6f 6e65 2c0a 2020 2020  et] = None,.    
+000157f0: 2020 2020 7369 7a69 6e67 5f6d 6f64 653a      sizing_mode:
+00015800: 2067 706c 745f 7061 7261 6d73 2e73 697a   gplt_params.siz
+00015810: 696e 675f 6d6f 6465 203d 2067 706c 745f  ing_mode = gplt_
+00015820: 7061 7261 6d73 2e73 697a 696e 675f 6d6f  params.sizing_mo
+00015830: 6465 5f64 6566 6175 6c74 2c0a 2020 2020  de_default,.    
+00015840: 2020 2020 7769 6474 683a 2067 706c 745f      width: gplt_
+00015850: 7061 7261 6d73 2e77 6964 7468 203d 2067  params.width = g
+00015860: 706c 745f 7061 7261 6d73 2e77 6964 7468  plt_params.width
+00015870: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00015880: 2020 7472 6163 6b5f 6865 6967 6874 3a20    track_height: 
+00015890: 6770 6c74 5f70 6172 616d 732e 7472 6163  gplt_params.trac
+000158a0: 6b5f 6865 6967 6874 203d 2031 3730 2c0a  k_height = 170,.
+000158b0: 2020 2020 2020 2020 6765 6e65 735f 6865          genes_he
+000158c0: 6967 6874 3a20 6770 6c74 5f70 6172 616d  ight: gplt_param
+000158d0: 732e 6765 6e65 735f 6865 6967 6874 203d  s.genes_height =
+000158e0: 2067 706c 745f 7061 7261 6d73 2e67 656e   gplt_params.gen
+000158f0: 6573 5f68 6569 6768 745f 6465 6661 756c  es_height_defaul
+00015900: 742c 0a20 2020 2020 2020 2073 686f 773a  t,.        show:
+00015910: 2067 706c 745f 7061 7261 6d73 2e73 686f   gplt_params.sho
+00015920: 7720 3d20 5472 7565 2c0a 2020 2020 293a  w = True,.    ):
+00015930: 0a20 2020 2020 2020 2064 6562 7567 203d  .        debug =
+00015940: 2073 656c 662e 5f6c 6f67 2e64 6562 7567   self._log.debug
+00015950: 0a0a 2020 2020 2020 2020 2320 6e6f 726d  ..        # norm
+00015960: 616c 6973 6520 746f 2073 7570 706f 7274  alise to support
+00015970: 206d 756c 7469 706c 6520 7361 6d70 6c65   multiple sample
+00015980: 730a 2020 2020 2020 2020 6966 2069 7369  s.        if isi
+00015990: 6e73 7461 6e63 6528 7361 6d70 6c65 2c20  nstance(sample, 
+000159a0: 286c 6973 742c 2074 7570 6c65 2929 3a0a  (list, tuple)):.
+000159b0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+000159c0: 6c65 7320 3d20 7361 6d70 6c65 0a20 2020  les = sample.   
+000159d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000159e0: 2020 2020 2020 2073 616d 706c 6573 203d         samples =
+000159f0: 205b 7361 6d70 6c65 5d0a 0a20 2020 2020   [sample]..     
+00015a00: 2020 2064 6562 7567 2822 706c 6f74 2066     debug("plot f
+00015a10: 6972 7374 2073 616d 706c 6520 7472 6163  irst sample trac
+00015a20: 6b22 290a 2020 2020 2020 2020 6669 6731  k").        fig1
+00015a30: 203d 2073 656c 662e 706c 6f74 5f68 6574   = self.plot_het
+00015a40: 6572 6f7a 7967 6f73 6974 795f 7472 6163  erozygosity_trac
+00015a50: 6b28 0a20 2020 2020 2020 2020 2020 2073  k(.            s
+00015a60: 616d 706c 653d 7361 6d70 6c65 735b 305d  ample=samples[0]
+00015a70: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
+00015a80: 6d70 6c65 5f73 6574 3d73 616d 706c 655f  mple_set=sample_
+00015a90: 7365 742c 0a20 2020 2020 2020 2020 2020  set,.           
+00015aa0: 2072 6567 696f 6e3d 7265 6769 6f6e 2c0a   region=region,.
+00015ab0: 2020 2020 2020 2020 2020 2020 7369 7465              site
+00015ac0: 5f6d 6173 6b3d 7369 7465 5f6d 6173 6b2c  _mask=site_mask,
+00015ad0: 0a20 2020 2020 2020 2020 2020 2077 696e  .            win
+00015ae0: 646f 775f 7369 7a65 3d77 696e 646f 775f  dow_size=window_
+00015af0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+00015b00: 2020 795f 6d61 783d 795f 6d61 782c 0a20    y_max=y_max,. 
+00015b10: 2020 2020 2020 2020 2020 2073 697a 696e             sizin
+00015b20: 675f 6d6f 6465 3d73 697a 696e 675f 6d6f  g_mode=sizing_mo
+00015b30: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00015b40: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
+00015b50: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+00015b60: 7472 6163 6b5f 6865 6967 6874 2c0a 2020  track_height,.  
+00015b70: 2020 2020 2020 2020 2020 6369 7263 6c65            circle
+00015b80: 5f6b 7761 7267 733d 6369 7263 6c65 5f6b  _kwargs=circle_k
+00015b90: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+00015ba0: 2020 2073 686f 773d 4661 6c73 652c 0a20     show=False,. 
+00015bb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00015bc0: 2066 6967 312e 7861 7869 732e 7669 7369   fig1.xaxis.visi
+00015bd0: 626c 6520 3d20 4661 6c73 650a 2020 2020  ble = False.    
+00015be0: 2020 2020 6669 6773 203d 205b 6669 6731      figs = [fig1
+00015bf0: 5d0a 0a20 2020 2020 2020 2064 6562 7567  ]..        debug
+00015c00: 2822 706c 6f74 2072 656d 6169 6e69 6e67  ("plot remaining
+00015c10: 2073 616d 706c 6520 7472 6163 6b73 2229   sample tracks")
+00015c20: 0a20 2020 2020 2020 2066 6f72 2073 616d  .        for sam
+00015c30: 706c 6520 696e 2073 616d 706c 6573 5b31  ple in samples[1
+00015c40: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
+00015c50: 6669 675f 6865 7420 3d20 7365 6c66 2e70  fig_het = self.p
+00015c60: 6c6f 745f 6865 7465 726f 7a79 676f 7369  lot_heterozygosi
+00015c70: 7479 5f74 7261 636b 280a 2020 2020 2020  ty_track(.      
+00015c80: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+00015c90: 3d73 616d 706c 652c 0a20 2020 2020 2020  =sample,.       
+00015ca0: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
+00015cb0: 7365 743d 7361 6d70 6c65 5f73 6574 2c0a  set=sample_set,.
+00015cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015cd0: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
+00015ce0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015cf0: 6974 655f 6d61 736b 3d73 6974 655f 6d61  ite_mask=site_ma
+00015d00: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
+00015d10: 2020 2020 7769 6e64 6f77 5f73 697a 653d      window_size=
+00015d20: 7769 6e64 6f77 5f73 697a 652c 0a20 2020  window_size,.   
+00015d30: 2020 2020 2020 2020 2020 2020 2079 5f6d               y_m
+00015d40: 6178 3d79 5f6d 6178 2c0a 2020 2020 2020  ax=y_max,.      
+00015d50: 2020 2020 2020 2020 2020 7369 7a69 6e67            sizing
+00015d60: 5f6d 6f64 653d 7369 7a69 6e67 5f6d 6f64  _mode=sizing_mod
+00015d70: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00015d80: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
+00015d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015da0: 6865 6967 6874 3d74 7261 636b 5f68 6569  height=track_hei
+00015db0: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
+00015dc0: 2020 2020 2063 6972 636c 655f 6b77 6172       circle_kwar
+00015dd0: 6773 3d63 6972 636c 655f 6b77 6172 6773  gs=circle_kwargs
+00015de0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015df0: 2020 7368 6f77 3d46 616c 7365 2c0a 2020    show=False,.  
+00015e00: 2020 2020 2020 2020 2020 2020 2020 785f                x_
+00015e10: 7261 6e67 653d 6669 6731 2e78 5f72 616e  range=fig1.x_ran
+00015e20: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
+00015e30: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+00015e40: 675f 6865 742e 7861 7869 732e 7669 7369  g_het.xaxis.visi
+00015e50: 626c 6520 3d20 4661 6c73 650a 2020 2020  ble = False.    
+00015e60: 2020 2020 2020 2020 6669 6773 2e61 7070          figs.app
+00015e70: 656e 6428 6669 675f 6865 7429 0a0a 2020  end(fig_het)..  
+00015e80: 2020 2020 2020 6465 6275 6728 2270 6c6f        debug("plo
+00015e90: 7420 6765 6e65 7320 7472 6163 6b22 290a  t genes track").
+00015ea0: 2020 2020 2020 2020 6669 675f 6765 6e65          fig_gene
+00015eb0: 7320 3d20 7365 6c66 2e70 6c6f 745f 6765  s = self.plot_ge
+00015ec0: 6e65 7328 0a20 2020 2020 2020 2020 2020  nes(.           
+00015ed0: 2072 6567 696f 6e3d 7265 6769 6f6e 2c0a   region=region,.
+00015ee0: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
+00015ef0: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
+00015f00: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
+00015f10: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
+00015f20: 2020 2020 2020 2020 2020 6865 6967 6874            height
+00015f30: 3d67 656e 6573 5f68 6569 6768 742c 0a20  =genes_height,. 
+00015f40: 2020 2020 2020 2020 2020 2078 5f72 616e             x_ran
+00015f50: 6765 3d66 6967 312e 785f 7261 6e67 652c  ge=fig1.x_range,
+00015f60: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+00015f70: 773d 4661 6c73 652c 0a20 2020 2020 2020  w=False,.       
+00015f80: 2029 0a20 2020 2020 2020 2066 6967 732e   ).        figs.
+00015f90: 6170 7065 6e64 2866 6967 5f67 656e 6573  append(fig_genes
+00015fa0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00015fb0: 2822 636f 6d62 696e 6520 706c 6f74 7320  ("combine plots 
+00015fc0: 696e 746f 2061 2073 696e 676c 6520 6669  into a single fi
+00015fd0: 6775 7265 2229 0a20 2020 2020 2020 2066  gure").        f
+00015fe0: 6967 5f61 6c6c 203d 2062 6f6b 6568 2e6c  ig_all = bokeh.l
+00015ff0: 6179 6f75 7473 2e67 7269 6470 6c6f 7428  ayouts.gridplot(
+00016000: 0a20 2020 2020 2020 2020 2020 2066 6967  .            fig
+00016010: 732c 0a20 2020 2020 2020 2020 2020 206e  s,.            n
+00016020: 636f 6c73 3d31 2c0a 2020 2020 2020 2020  cols=1,.        
+00016030: 2020 2020 746f 6f6c 6261 725f 6c6f 6361      toolbar_loca
+00016040: 7469 6f6e 3d22 6162 6f76 6522 2c0a 2020  tion="above",.  
+00016050: 2020 2020 2020 2020 2020 6d65 7267 655f            merge_
+00016060: 746f 6f6c 733d 5472 7565 2c0a 2020 2020  tools=True,.    
+00016070: 2020 2020 2020 2020 7369 7a69 6e67 5f6d          sizing_m
+00016080: 6f64 653d 7369 7a69 6e67 5f6d 6f64 652c  ode=sizing_mode,
+00016090: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000160a0: 2020 2020 6966 2073 686f 773a 0a20 2020      if show:.   
+000160b0: 2020 2020 2020 2020 2062 6f6b 6568 2e70           bokeh.p
+000160c0: 6c6f 7474 696e 672e 7368 6f77 2866 6967  lotting.show(fig
+000160d0: 5f61 6c6c 290a 0a20 2020 2020 2020 2072  _all)..        r
+000160e0: 6574 7572 6e20 6669 675f 616c 6c0a 0a20  eturn fig_all.. 
+000160f0: 2020 2064 6566 205f 7361 6d70 6c65 5f63     def _sample_c
+00016100: 6f75 6e74 5f68 6574 280a 2020 2020 2020  ount_het(.      
+00016110: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00016120: 7361 6d70 6c65 2c0a 2020 2020 2020 2020  sample,.        
+00016130: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+00016140: 7369 7465 5f6d 6173 6b2c 0a20 2020 2020  site_mask,.     
+00016150: 2020 2077 696e 646f 775f 7369 7a65 2c0a     window_size,.
+00016160: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+00016170: 6574 3d4e 6f6e 652c 0a20 2020 2029 3a0a  et=None,.    ):.
+00016180: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
+00016190: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
+000161a0: 0a20 2020 2020 2020 2072 6567 696f 6e20  .        region 
+000161b0: 3d20 7365 6c66 2e72 6573 6f6c 7665 5f72  = self.resolve_r
+000161c0: 6567 696f 6e28 7265 6769 6f6e 290a 2020  egion(region).  
+000161d0: 2020 2020 2020 7369 7465 5f6d 6173 6b20        site_mask 
+000161e0: 3d20 7365 6c66 2e5f 7072 6570 5f73 6974  = self._prep_sit
+000161f0: 655f 6d61 736b 5f70 6172 616d 2873 6974  e_mask_param(sit
+00016200: 655f 6d61 736b 3d73 6974 655f 6d61 736b  e_mask=site_mask
+00016210: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00016220: 2822 6163 6365 7373 2073 616d 706c 6520  ("access sample 
+00016230: 6d65 7461 6461 7461 2c20 6c6f 6f6b 2075  metadata, look u
+00016240: 7020 7361 6d70 6c65 2229 0a20 2020 2020  p sample").     
+00016250: 2020 2073 616d 706c 655f 7265 6320 3d20     sample_rec = 
+00016260: 7365 6c66 2e5f 6c6f 6f6b 7570 5f73 616d  self._lookup_sam
+00016270: 706c 6528 7361 6d70 6c65 3d73 616d 706c  ple(sample=sampl
+00016280: 652c 2073 616d 706c 655f 7365 743d 7361  e, sample_set=sa
+00016290: 6d70 6c65 5f73 6574 290a 2020 2020 2020  mple_set).      
+000162a0: 2020 7361 6d70 6c65 5f69 6420 3d20 7361    sample_id = sa
+000162b0: 6d70 6c65 5f72 6563 2e6e 616d 6520 2023  mple_rec.name  #
+000162c0: 2073 616d 706c 655f 6964 0a20 2020 2020   sample_id.     
+000162d0: 2020 2073 616d 706c 655f 7365 7420 3d20     sample_set = 
+000162e0: 7361 6d70 6c65 5f72 6563 5b22 7361 6d70  sample_rec["samp
+000162f0: 6c65 5f73 6574 225d 0a0a 2020 2020 2020  le_set"]..      
+00016300: 2020 6465 6275 6728 2261 6363 6573 7320    debug("access 
+00016310: 534e 5073 2c20 7365 6c65 6374 2064 6174  SNPs, select dat
+00016320: 6120 666f 7220 7361 6d70 6c65 2229 0a20  a for sample"). 
+00016330: 2020 2020 2020 2064 735f 736e 7073 203d         ds_snps =
+00016340: 2073 656c 662e 736e 705f 6361 6c6c 7328   self.snp_calls(
+00016350: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+00016360: 696f 6e3d 7265 6769 6f6e 2c20 7361 6d70  ion=region, samp
+00016370: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
+00016380: 6574 2c20 7369 7465 5f6d 6173 6b3d 7369  et, site_mask=si
+00016390: 7465 5f6d 6173 6b0a 2020 2020 2020 2020  te_mask.        
+000163a0: 290a 2020 2020 2020 2020 6473 5f73 6e70  ).        ds_snp
+000163b0: 735f 7361 6d70 6c65 203d 2064 735f 736e  s_sample = ds_sn
+000163c0: 7073 2e73 6574 5f69 6e64 6578 2873 616d  ps.set_index(sam
+000163d0: 706c 6573 3d22 7361 6d70 6c65 5f69 6422  ples="sample_id"
+000163e0: 292e 7365 6c28 7361 6d70 6c65 733d 7361  ).sel(samples=sa
+000163f0: 6d70 6c65 5f69 6429 0a0a 2020 2020 2020  mple_id)..      
+00016400: 2020 2320 736e 7020 706f 7369 7469 6f6e    # snp position
+00016410: 730a 2020 2020 2020 2020 706f 7320 3d20  s.        pos = 
+00016420: 6473 5f73 6e70 735f 7361 6d70 6c65 5b22  ds_snps_sample["
+00016430: 7661 7269 616e 745f 706f 7369 7469 6f6e  variant_position
+00016440: 225d 2e76 616c 7565 730a 0a20 2020 2020  "].values..     
+00016450: 2020 2023 2061 6363 6573 7320 6765 6e6f     # access geno
+00016460: 7479 7065 730a 2020 2020 2020 2020 6774  types.        gt
+00016470: 203d 2061 6c6c 656c 2e47 656e 6f74 7970   = allel.Genotyp
+00016480: 6544 6173 6b56 6563 746f 7228 6473 5f73  eDaskVector(ds_s
+00016490: 6e70 735f 7361 6d70 6c65 5b22 6361 6c6c  nps_sample["call
+000164a0: 5f67 656e 6f74 7970 6522 5d2e 6461 7461  _genotype"].data
+000164b0: 290a 0a20 2020 2020 2020 2023 2063 6f6d  )..        # com
+000164c0: 7075 7465 2068 6574 0a20 2020 2020 2020  pute het.       
+000164d0: 2077 6974 6820 7365 6c66 2e5f 6461 736b   with self._dask
+000164e0: 5f70 726f 6772 6573 7328 6465 7363 3d22  _progress(desc="
+000164f0: 436f 6d70 7574 6520 6865 7465 726f 7a79  Compute heterozy
+00016500: 676f 7573 2067 656e 6f74 7970 6573 2229  gous genotypes")
+00016510: 3a0a 2020 2020 2020 2020 2020 2020 6973  :.            is
+00016520: 5f68 6574 203d 2067 742e 6973 5f68 6574  _het = gt.is_het
+00016530: 2829 2e63 6f6d 7075 7465 2829 0a0a 2020  ().compute()..  
+00016540: 2020 2020 2020 2320 636f 6d70 7574 6520        # compute 
+00016550: 7769 6e64 6f77 2063 6f6f 7264 696e 6174  window coordinat
+00016560: 6573 0a20 2020 2020 2020 2077 696e 646f  es.        windo
+00016570: 7773 203d 2061 6c6c 656c 2e6d 6f76 696e  ws = allel.movin
+00016580: 675f 7374 6174 6973 7469 6328 0a20 2020  g_statistic(.   
+00016590: 2020 2020 2020 2020 2076 616c 7565 733d           values=
+000165a0: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
+000165b0: 2073 7461 7469 7374 6963 3d6c 616d 6264   statistic=lambd
+000165c0: 6120 783a 205b 785b 305d 2c20 785b 2d31  a x: [x[0], x[-1
+000165d0: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+000165e0: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
+000165f0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00016600: 2020 2020 2023 2063 6f6d 7075 7465 2077       # compute w
+00016610: 696e 646f 7765 6420 6865 7465 726f 7a79  indowed heterozy
+00016620: 676f 7369 7479 0a20 2020 2020 2020 2063  gosity.        c
+00016630: 6f75 6e74 7320 3d20 616c 6c65 6c2e 6d6f  ounts = allel.mo
+00016640: 7669 6e67 5f73 7461 7469 7374 6963 280a  ving_statistic(.
+00016650: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00016660: 6573 3d69 735f 6865 742c 0a20 2020 2020  es=is_het,.     
+00016670: 2020 2020 2020 2073 7461 7469 7374 6963         statistic
+00016680: 3d6e 702e 7375 6d2c 0a20 2020 2020 2020  =np.sum,.       
+00016690: 2020 2020 2073 697a 653d 7769 6e64 6f77       size=window
+000166a0: 5f73 697a 652c 0a20 2020 2020 2020 2029  _size,.        )
+000166b0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000166c0: 2073 616d 706c 655f 6964 2c20 7361 6d70   sample_id, samp
+000166d0: 6c65 5f73 6574 2c20 7769 6e64 6f77 732c  le_set, windows,
+000166e0: 2063 6f75 6e74 730a 0a20 2020 2040 646f   counts..    @do
+000166f0: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
+00016700: 7279 3d22 496e 6665 7220 7275 6e73 206f  ry="Infer runs o
+00016710: 6620 686f 6d6f 7a79 676f 7369 7479 2066  f homozygosity f
+00016720: 6f72 2061 2073 696e 676c 6520 7361 6d70  or a single samp
+00016730: 6c65 206f 7665 7220 6120 6765 6e6f 6d65  le over a genome
+00016740: 2072 6567 696f 6e2e 222c 0a20 2020 2029   region.",.    )
+00016750: 0a20 2020 2064 6566 2072 6f68 5f68 6d6d  .    def roh_hmm
+00016760: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00016770: 2020 2020 2020 2020 7361 6d70 6c65 3a20          sample: 
+00016780: 6865 745f 7061 7261 6d73 2e73 616d 706c  het_params.sampl
+00016790: 652c 0a20 2020 2020 2020 2072 6567 696f  e,.        regio
+000167a0: 6e3a 2062 6173 655f 7061 7261 6d73 2e72  n: base_params.r
+000167b0: 6567 696f 6e2c 0a20 2020 2020 2020 2077  egion,.        w
+000167c0: 696e 646f 775f 7369 7a65 3a20 6865 745f  indow_size: het_
+000167d0: 7061 7261 6d73 2e77 696e 646f 775f 7369  params.window_si
+000167e0: 7a65 203d 2068 6574 5f70 6172 616d 732e  ze = het_params.
+000167f0: 7769 6e64 6f77 5f73 697a 655f 6465 6661  window_size_defa
+00016800: 756c 742c 0a20 2020 2020 2020 2073 6974  ult,.        sit
+00016810: 655f 6d61 736b 3a20 6261 7365 5f70 6172  e_mask: base_par
+00016820: 616d 732e 7369 7465 5f6d 6173 6b20 3d20  ams.site_mask = 
+00016830: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
+00016840: 2073 616d 706c 655f 7365 743a 204f 7074   sample_set: Opt
+00016850: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
+00016860: 732e 7361 6d70 6c65 5f73 6574 5d20 3d20  s.sample_set] = 
+00016870: 4e6f 6e65 2c0a 2020 2020 2020 2020 7068  None,.        ph
+00016880: 6574 5f72 6f68 3a20 6865 745f 7061 7261  et_roh: het_para
+00016890: 6d73 2e70 6865 745f 726f 6820 3d20 6865  ms.phet_roh = he
+000168a0: 745f 7061 7261 6d73 2e70 6865 745f 726f  t_params.phet_ro
+000168b0: 685f 6465 6661 756c 742c 0a20 2020 2020  h_default,.     
+000168c0: 2020 2070 6865 745f 6e6f 6e72 6f68 3a20     phet_nonroh: 
+000168d0: 6865 745f 7061 7261 6d73 2e70 6865 745f  het_params.phet_
+000168e0: 6e6f 6e72 6f68 203d 2068 6574 5f70 6172  nonroh = het_par
+000168f0: 616d 732e 7068 6574 5f6e 6f6e 726f 685f  ams.phet_nonroh_
+00016900: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+00016910: 2074 7261 6e73 6974 696f 6e3a 2068 6574   transition: het
+00016920: 5f70 6172 616d 732e 7472 616e 7369 7469  _params.transiti
+00016930: 6f6e 203d 2068 6574 5f70 6172 616d 732e  on = het_params.
+00016940: 7472 616e 7369 7469 6f6e 5f64 6566 6175  transition_defau
+00016950: 6c74 2c0a 2020 2020 2920 2d3e 2068 6574  lt,.    ) -> het
+00016960: 5f70 6172 616d 732e 6466 5f72 6f68 3a0a  _params.df_roh:.
+00016970: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
+00016980: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
+00016990: 0a20 2020 2020 2020 2072 6573 6f6c 7665  .        resolve
+000169a0: 645f 7265 6769 6f6e 203d 2073 656c 662e  d_region = self.
+000169b0: 7265 736f 6c76 655f 7265 6769 6f6e 2872  resolve_region(r
+000169c0: 6567 696f 6e29 0a20 2020 2020 2020 2064  egion).        d
+000169d0: 656c 2072 6567 696f 6e0a 0a20 2020 2020  el region..     
+000169e0: 2020 2064 6562 7567 2822 636f 6d70 7574     debug("comput
+000169f0: 6520 7769 6e64 6f77 6564 2068 6574 6572  e windowed heter
+00016a00: 6f7a 7967 6f73 6974 7922 290a 2020 2020  ozygosity").    
+00016a10: 2020 2020 7361 6d70 6c65 5f69 642c 2073      sample_id, s
+00016a20: 616d 706c 655f 7365 742c 2077 696e 646f  ample_set, windo
+00016a30: 7773 2c20 636f 756e 7473 203d 2073 656c  ws, counts = sel
+00016a40: 662e 5f73 616d 706c 655f 636f 756e 745f  f._sample_count_
+00016a50: 6865 7428 0a20 2020 2020 2020 2020 2020  het(.           
+00016a60: 2073 616d 706c 653d 7361 6d70 6c65 2c0a   sample=sample,.
+00016a70: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00016a80: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
+00016a90: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00016aa0: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
+00016ab0: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
+00016ac0: 2077 696e 646f 775f 7369 7a65 3d77 696e   window_size=win
+00016ad0: 646f 775f 7369 7a65 2c0a 2020 2020 2020  dow_size,.      
+00016ae0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+00016af0: 3d73 616d 706c 655f 7365 742c 0a20 2020  =sample_set,.   
+00016b00: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00016b10: 6465 6275 6728 2263 6f6d 7075 7465 2072  debug("compute r
+00016b20: 756e 7320 6f66 2068 6f6d 6f7a 7967 6f73  uns of homozygos
+00016b30: 6974 7922 290a 2020 2020 2020 2020 6466  ity").        df
+00016b40: 5f72 6f68 203d 2073 656c 662e 5f72 6f68  _roh = self._roh
+00016b50: 5f68 6d6d 5f70 7265 6469 6374 280a 2020  _hmm_predict(.  
+00016b60: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
+00016b70: 733d 7769 6e64 6f77 732c 0a20 2020 2020  s=windows,.     
+00016b80: 2020 2020 2020 2063 6f75 6e74 733d 636f         counts=co
+00016b90: 756e 7473 2c0a 2020 2020 2020 2020 2020  unts,.          
+00016ba0: 2020 7068 6574 5f72 6f68 3d70 6865 745f    phet_roh=phet_
+00016bb0: 726f 682c 0a20 2020 2020 2020 2020 2020  roh,.           
+00016bc0: 2070 6865 745f 6e6f 6e72 6f68 3d70 6865   phet_nonroh=phe
+00016bd0: 745f 6e6f 6e72 6f68 2c0a 2020 2020 2020  t_nonroh,.      
+00016be0: 2020 2020 2020 7472 616e 7369 7469 6f6e        transition
+00016bf0: 3d74 7261 6e73 6974 696f 6e2c 0a20 2020  =transition,.   
+00016c00: 2020 2020 2020 2020 2077 696e 646f 775f           window_
+00016c10: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
+00016c20: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
+00016c30: 6d70 6c65 5f69 643d 7361 6d70 6c65 5f69  mple_id=sample_i
+00016c40: 642c 0a20 2020 2020 2020 2020 2020 2063  d,.            c
+00016c50: 6f6e 7469 673d 7265 736f 6c76 6564 5f72  ontig=resolved_r
+00016c60: 6567 696f 6e2e 636f 6e74 6967 2c0a 2020  egion.contig,.  
+00016c70: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00016c80: 2072 6574 7572 6e20 6466 5f72 6f68 0a0a   return df_roh..
+00016c90: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+00016ca0: 2020 7375 6d6d 6172 793d 2250 6c6f 7420    summary="Plot 
+00016cb0: 6120 7275 6e73 206f 6620 686f 6d6f 7a79  a runs of homozy
+00016cc0: 676f 7369 7479 2074 7261 636b 2e22 2c0a  gosity track.",.
+00016cd0: 2020 2020 290a 2020 2020 6465 6620 706c      ).    def pl
+00016ce0: 6f74 5f72 6f68 5f74 7261 636b 280a 2020  ot_roh_track(.  
+00016cf0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00016d00: 2020 2020 6466 5f72 6f68 3a20 6865 745f      df_roh: het_
+00016d10: 7061 7261 6d73 2e64 665f 726f 682c 0a20  params.df_roh,. 
+00016d20: 2020 2020 2020 2072 6567 696f 6e3a 2062         region: b
+00016d30: 6173 655f 7061 7261 6d73 2e72 6567 696f  ase_params.regio
+00016d40: 6e2c 0a20 2020 2020 2020 2073 697a 696e  n,.        sizin
+00016d50: 675f 6d6f 6465 3a20 6770 6c74 5f70 6172  g_mode: gplt_par
+00016d60: 616d 732e 7369 7a69 6e67 5f6d 6f64 6520  ams.sizing_mode 
+00016d70: 3d20 6770 6c74 5f70 6172 616d 732e 7369  = gplt_params.si
+00016d80: 7a69 6e67 5f6d 6f64 655f 6465 6661 756c  zing_mode_defaul
+00016d90: 742c 0a20 2020 2020 2020 2077 6964 7468  t,.        width
+00016da0: 3a20 6770 6c74 5f70 6172 616d 732e 7769  : gplt_params.wi
+00016db0: 6474 6820 3d20 6770 6c74 5f70 6172 616d  dth = gplt_param
+00016dc0: 732e 7769 6474 685f 6465 6661 756c 742c  s.width_default,
+00016dd0: 0a20 2020 2020 2020 2068 6569 6768 743a  .        height:
+00016de0: 2067 706c 745f 7061 7261 6d73 2e68 6569   gplt_params.hei
+00016df0: 6768 7420 3d20 3130 302c 0a20 2020 2020  ght = 100,.     
+00016e00: 2020 2073 686f 773a 2067 706c 745f 7061     show: gplt_pa
+00016e10: 7261 6d73 2e73 686f 7720 3d20 5472 7565  rams.show = True
+00016e20: 2c0a 2020 2020 2020 2020 785f 7261 6e67  ,.        x_rang
+00016e30: 653a 204f 7074 696f 6e61 6c5b 6770 6c74  e: Optional[gplt
+00016e40: 5f70 6172 616d 732e 785f 7261 6e67 655d  _params.x_range]
+00016e50: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00016e60: 2074 6974 6c65 3a20 6770 6c74 5f70 6172   title: gplt_par
+00016e70: 616d 732e 7469 746c 6520 3d20 2252 756e  ams.title = "Run
+00016e80: 7320 6f66 2068 6f6d 6f7a 7967 6f73 6974  s of homozygosit
+00016e90: 7922 2c0a 2020 2020 2920 2d3e 2067 706c  y",.    ) -> gpl
+00016ea0: 745f 7061 7261 6d73 2e66 6967 7572 653a  t_params.figure:
+00016eb0: 0a20 2020 2020 2020 2064 6562 7567 203d  .        debug =
+00016ec0: 2073 656c 662e 5f6c 6f67 2e64 6562 7567   self._log.debug
+00016ed0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+00016ee0: 2268 616e 646c 6520 7265 6769 6f6e 2070  "handle region p
+00016ef0: 6172 616d 6574 6572 202d 2074 6869 7320  arameter - this 
+00016f00: 6465 7465 726d 696e 6573 2074 6865 2067  determines the g
+00016f10: 656e 6f6d 6520 7265 6769 6f6e 2074 6f20  enome region to 
+00016f20: 706c 6f74 2229 0a20 2020 2020 2020 2072  plot").        r
+00016f30: 6573 6f6c 7665 645f 7265 6769 6f6e 203d  esolved_region =
+00016f40: 2073 656c 662e 7265 736f 6c76 655f 7265   self.resolve_re
+00016f50: 6769 6f6e 2872 6567 696f 6e29 0a20 2020  gion(region).   
+00016f60: 2020 2020 2064 656c 2072 6567 696f 6e0a       del region.
+00016f70: 2020 2020 2020 2020 636f 6e74 6967 203d          contig =
+00016f80: 2072 6573 6f6c 7665 645f 7265 6769 6f6e   resolved_region
+00016f90: 2e63 6f6e 7469 670a 2020 2020 2020 2020  .contig.        
+00016fa0: 7374 6172 7420 3d20 7265 736f 6c76 6564  start = resolved
+00016fb0: 5f72 6567 696f 6e2e 7374 6172 740a 2020  _region.start.  
+00016fc0: 2020 2020 2020 656e 6420 3d20 7265 736f        end = reso
+00016fd0: 6c76 6564 5f72 6567 696f 6e2e 656e 640a  lved_region.end.
+00016fe0: 2020 2020 2020 2020 6966 2073 7461 7274          if start
+00016ff0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00017000: 2020 2020 2020 7374 6172 7420 3d20 300a        start = 0.
+00017010: 2020 2020 2020 2020 6966 2065 6e64 2069          if end i
+00017020: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00017030: 2020 2020 656e 6420 3d20 6c65 6e28 7365      end = len(se
+00017040: 6c66 2e67 656e 6f6d 655f 7365 7175 656e  lf.genome_sequen
+00017050: 6365 2863 6f6e 7469 6729 290a 0a20 2020  ce(contig))..   
+00017060: 2020 2020 2064 6562 7567 2822 6465 6669       debug("defi
+00017070: 6e65 2078 2061 7869 7320 7261 6e67 6522  ne x axis range"
+00017080: 290a 2020 2020 2020 2020 6966 2078 5f72  ).        if x_r
+00017090: 616e 6765 2069 7320 4e6f 6e65 3a0a 2020  ange is None:.  
+000170a0: 2020 2020 2020 2020 2020 785f 7261 6e67            x_rang
+000170b0: 6520 3d20 626f 6b65 682e 6d6f 6465 6c73  e = bokeh.models
+000170c0: 2e52 616e 6765 3164 2873 7461 7274 2c20  .Range1d(start, 
+000170d0: 656e 642c 2062 6f75 6e64 733d 2261 7574  end, bounds="aut
+000170e0: 6f22 290a 0a20 2020 2020 2020 2064 6562  o")..        deb
+000170f0: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
+00017100: 2277 6527 7265 2067 6f69 6e67 2074 6f20  "we're going to 
+00017110: 706c 6f74 2065 6163 6820 6765 6e65 2061  plot each gene a
+00017120: 7320 6120 7265 6374 616e 676c 652c 2073  s a rectangle, s
+00017130: 6f20 6164 6420 736f 6d65 2061 6464 6974  o add some addit
+00017140: 696f 6e61 6c20 636f 6c75 6d6e 7322 0a20  ional columns". 
+00017150: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00017160: 2064 6174 6120 3d20 6466 5f72 6f68 2e63   data = df_roh.c
+00017170: 6f70 7928 290a 2020 2020 2020 2020 6461  opy().        da
+00017180: 7461 5b22 626f 7474 6f6d 225d 203d 2030  ta["bottom"] = 0
+00017190: 2e32 0a20 2020 2020 2020 2064 6174 615b  .2.        data[
+000171a0: 2274 6f70 225d 203d 2030 2e38 0a0a 2020  "top"] = 0.8..  
+000171b0: 2020 2020 2020 6465 6275 6728 226d 616b        debug("mak
+000171c0: 6520 6120 6669 6775 7265 2229 0a20 2020  e a figure").   
+000171d0: 2020 2020 2078 7768 6565 6c5f 7a6f 6f6d       xwheel_zoom
+000171e0: 203d 2062 6f6b 6568 2e6d 6f64 656c 732e   = bokeh.models.
+000171f0: 5768 6565 6c5a 6f6f 6d54 6f6f 6c28 0a20  WheelZoomTool(. 
+00017200: 2020 2020 2020 2020 2020 2064 696d 656e             dimen
+00017210: 7369 6f6e 733d 2277 6964 7468 222c 206d  sions="width", m
+00017220: 6169 6e74 6169 6e5f 666f 6375 733d 4661  aintain_focus=Fa
+00017230: 6c73 650a 2020 2020 2020 2020 290a 2020  lse.        ).  
+00017240: 2020 2020 2020 6669 6720 3d20 626f 6b65        fig = boke
+00017250: 682e 706c 6f74 7469 6e67 2e66 6967 7572  h.plotting.figur
+00017260: 6528 0a20 2020 2020 2020 2020 2020 2074  e(.            t
+00017270: 6974 6c65 3d74 6974 6c65 2c0a 2020 2020  itle=title,.    
+00017280: 2020 2020 2020 2020 7369 7a69 6e67 5f6d          sizing_m
+00017290: 6f64 653d 7369 7a69 6e67 5f6d 6f64 652c  ode=sizing_mode,
+000172a0: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+000172b0: 7468 3d77 6964 7468 2c0a 2020 2020 2020  th=width,.      
+000172c0: 2020 2020 2020 6865 6967 6874 3d68 6569        height=hei
+000172d0: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
+000172e0: 2074 6f6f 6c73 3d5b 0a20 2020 2020 2020   tools=[.       
+000172f0: 2020 2020 2020 2020 2022 7870 616e 222c           "xpan",
+00017300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017310: 2022 787a 6f6f 6d5f 696e 222c 0a20 2020   "xzoom_in",.   
+00017320: 2020 2020 2020 2020 2020 2020 2022 787a               "xz
+00017330: 6f6f 6d5f 6f75 7422 2c0a 2020 2020 2020  oom_out",.      
+00017340: 2020 2020 2020 2020 2020 7877 6865 656c            xwheel
+00017350: 5f7a 6f6f 6d2c 0a20 2020 2020 2020 2020  _zoom,.         
+00017360: 2020 2020 2020 2022 7265 7365 7422 2c0a         "reset",.
+00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 2274 6170 222c 0a20 2020 2020 2020 2020  "tap",.         
+00017390: 2020 2020 2020 2022 686f 7665 7222 2c0a         "hover",.
+000173a0: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+000173b0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+000173c0: 655f 7363 726f 6c6c 3d78 7768 6565 6c5f  e_scroll=xwheel_
+000173d0: 7a6f 6f6d 2c0a 2020 2020 2020 2020 2020  zoom,.          
+000173e0: 2020 6163 7469 7665 5f64 7261 673d 2278    active_drag="x
+000173f0: 7061 6e22 2c0a 2020 2020 2020 2020 2020  pan",.          
+00017400: 2020 785f 7261 6e67 653d 785f 7261 6e67    x_range=x_rang
+00017410: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+00017420: 2020 2020 2020 6465 6275 6728 226e 6f77        debug("now
+00017430: 2070 6c6f 7420 7468 6520 524f 4820 6173   plot the ROH as
+00017440: 2072 6563 7461 6e67 6c65 7322 290a 2020   rectangles").  
+00017450: 2020 2020 2020 6669 672e 7175 6164 280a        fig.quad(.
+00017460: 2020 2020 2020 2020 2020 2020 626f 7474              bott
+00017470: 6f6d 3d22 626f 7474 6f6d 222c 0a20 2020  om="bottom",.   
+00017480: 2020 2020 2020 2020 2074 6f70 3d22 746f           top="to
+00017490: 7022 2c0a 2020 2020 2020 2020 2020 2020  p",.            
+000174a0: 6c65 6674 3d22 726f 685f 7374 6172 7422  left="roh_start"
+000174b0: 2c0a 2020 2020 2020 2020 2020 2020 7269  ,.            ri
+000174c0: 6768 743d 2272 6f68 5f73 746f 7022 2c0a  ght="roh_stop",.
+000174d0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+000174e0: 6365 3d64 6174 612c 0a20 2020 2020 2020  ce=data,.       
+000174f0: 2020 2020 206c 696e 655f 7769 6474 683d       line_width=
+00017500: 302e 352c 0a20 2020 2020 2020 2020 2020  0.5,.           
+00017510: 2066 696c 6c5f 616c 7068 613d 302e 352c   fill_alpha=0.5,
+00017520: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00017530: 2020 2020 6465 6275 6728 2274 6964 7920      debug("tidy 
+00017540: 7570 2074 6865 2070 6c6f 7422 290a 2020  up the plot").  
+00017550: 2020 2020 2020 6669 672e 795f 7261 6e67        fig.y_rang
+00017560: 6520 3d20 626f 6b65 682e 6d6f 6465 6c73  e = bokeh.models
+00017570: 2e52 616e 6765 3164 2830 2c20 3129 0a20  .Range1d(0, 1). 
+00017580: 2020 2020 2020 2066 6967 2e79 6772 6964         fig.ygrid
+00017590: 2e76 6973 6962 6c65 203d 2046 616c 7365  .visible = False
+000175a0: 0a20 2020 2020 2020 2066 6967 2e79 6178  .        fig.yax
+000175b0: 6973 2e74 6963 6b65 7220 3d20 5b5d 0a20  is.ticker = []. 
+000175c0: 2020 2020 2020 2073 656c 662e 5f62 6f6b         self._bok
+000175d0: 6568 5f73 7479 6c65 5f67 656e 6f6d 655f  eh_style_genome_
+000175e0: 7861 7869 7328 6669 672c 2072 6573 6f6c  xaxis(fig, resol
+000175f0: 7665 645f 7265 6769 6f6e 2e63 6f6e 7469  ved_region.conti
+00017600: 6729 0a0a 2020 2020 2020 2020 6966 2073  g)..        if s
+00017610: 686f 773a 0a20 2020 2020 2020 2020 2020  how:.           
+00017620: 2062 6f6b 6568 2e70 6c6f 7474 696e 672e   bokeh.plotting.
+00017630: 7368 6f77 2866 6967 290a 0a20 2020 2020  show(fig)..     
+00017640: 2020 2072 6574 7572 6e20 6669 670a 0a20     return fig.. 
+00017650: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
+00017660: 2073 756d 6d61 7279 3d22 2222 0a20 2020   summary=""".   
+00017670: 2020 2020 2020 2020 2050 6c6f 7420 7769           Plot wi
+00017680: 6e64 6f77 6564 2068 6574 6572 6f7a 7967  ndowed heterozyg
+00017690: 6f73 6974 7920 616e 6420 696e 6665 7272  osity and inferr
+000176a0: 6564 2072 756e 7320 6f66 2068 6f6d 6f7a  ed runs of homoz
+000176b0: 7967 6f73 6974 7920 666f 7220 610a 2020  ygosity for a.  
+000176c0: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
+000176d0: 2073 616d 706c 6520 6f76 6572 2061 2067   sample over a g
+000176e0: 656e 6f6d 6520 7265 6769 6f6e 2e0a 2020  enome region..  
+000176f0: 2020 2020 2020 2222 222c 0a20 2020 2029        """,.    )
+00017700: 0a20 2020 2064 6566 2070 6c6f 745f 726f  .    def plot_ro
+00017710: 6828 0a20 2020 2020 2020 2073 656c 662c  h(.        self,
+00017720: 0a20 2020 2020 2020 2073 616d 706c 653a  .        sample:
+00017730: 2068 6574 5f70 6172 616d 732e 7361 6d70   het_params.samp
+00017740: 6c65 2c0a 2020 2020 2020 2020 7265 6769  le,.        regi
+00017750: 6f6e 3a20 6261 7365 5f70 6172 616d 732e  on: base_params.
+00017760: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+00017770: 7769 6e64 6f77 5f73 697a 653a 2068 6574  window_size: het
+00017780: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
+00017790: 697a 6520 3d20 6865 745f 7061 7261 6d73  ize = het_params
+000177a0: 2e77 696e 646f 775f 7369 7a65 5f64 6566  .window_size_def
+000177b0: 6175 6c74 2c0a 2020 2020 2020 2020 7369  ault,.        si
+000177c0: 7465 5f6d 6173 6b3a 2062 6173 655f 7061  te_mask: base_pa
+000177d0: 7261 6d73 2e73 6974 655f 6d61 736b 203d  rams.site_mask =
+000177e0: 2044 4546 4155 4c54 2c0a 2020 2020 2020   DEFAULT,.      
+000177f0: 2020 7361 6d70 6c65 5f73 6574 3a20 4f70    sample_set: Op
+00017800: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+00017810: 6d73 2e73 616d 706c 655f 7365 745d 203d  ms.sample_set] =
+00017820: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
+00017830: 6865 745f 726f 683a 2068 6574 5f70 6172  het_roh: het_par
+00017840: 616d 732e 7068 6574 5f72 6f68 203d 2068  ams.phet_roh = h
+00017850: 6574 5f70 6172 616d 732e 7068 6574 5f72  et_params.phet_r
+00017860: 6f68 5f64 6566 6175 6c74 2c0a 2020 2020  oh_default,.    
+00017870: 2020 2020 7068 6574 5f6e 6f6e 726f 683a      phet_nonroh:
+00017880: 2068 6574 5f70 6172 616d 732e 7068 6574   het_params.phet
+00017890: 5f6e 6f6e 726f 6820 3d20 6865 745f 7061  _nonroh = het_pa
+000178a0: 7261 6d73 2e70 6865 745f 6e6f 6e72 6f68  rams.phet_nonroh
+000178b0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+000178c0: 2020 7472 616e 7369 7469 6f6e 3a20 6865    transition: he
+000178d0: 745f 7061 7261 6d73 2e74 7261 6e73 6974  t_params.transit
+000178e0: 696f 6e20 3d20 6865 745f 7061 7261 6d73  ion = het_params
+000178f0: 2e74 7261 6e73 6974 696f 6e5f 6465 6661  .transition_defa
+00017900: 756c 742c 0a20 2020 2020 2020 2079 5f6d  ult,.        y_m
+00017910: 6178 3a20 6865 745f 7061 7261 6d73 2e79  ax: het_params.y
+00017920: 5f6d 6178 203d 2068 6574 5f70 6172 616d  _max = het_param
+00017930: 732e 795f 6d61 785f 6465 6661 756c 742c  s.y_max_default,
+00017940: 0a20 2020 2020 2020 2073 697a 696e 675f  .        sizing_
+00017950: 6d6f 6465 3a20 6770 6c74 5f70 6172 616d  mode: gplt_param
+00017960: 732e 7369 7a69 6e67 5f6d 6f64 6520 3d20  s.sizing_mode = 
+00017970: 6770 6c74 5f70 6172 616d 732e 7369 7a69  gplt_params.sizi
+00017980: 6e67 5f6d 6f64 655f 6465 6661 756c 742c  ng_mode_default,
+00017990: 0a20 2020 2020 2020 2077 6964 7468 3a20  .        width: 
+000179a0: 6770 6c74 5f70 6172 616d 732e 7769 6474  gplt_params.widt
+000179b0: 6820 3d20 6770 6c74 5f70 6172 616d 732e  h = gplt_params.
+000179c0: 7769 6474 685f 6465 6661 756c 742c 0a20  width_default,. 
+000179d0: 2020 2020 2020 2068 6574 6572 6f7a 7967         heterozyg
+000179e0: 6f73 6974 795f 6865 6967 6874 3a20 6770  osity_height: gp
+000179f0: 6c74 5f70 6172 616d 732e 6865 6967 6874  lt_params.height
+00017a00: 203d 2031 3730 2c0a 2020 2020 2020 2020   = 170,.        
+00017a10: 726f 685f 6865 6967 6874 3a20 6770 6c74  roh_height: gplt
+00017a20: 5f70 6172 616d 732e 6865 6967 6874 203d  _params.height =
+00017a30: 2035 302c 0a20 2020 2020 2020 2067 656e   50,.        gen
+00017a40: 6573 5f68 6569 6768 743a 2067 706c 745f  es_height: gplt_
+00017a50: 7061 7261 6d73 2e67 656e 6573 5f68 6569  params.genes_hei
+00017a60: 6768 7420 3d20 6770 6c74 5f70 6172 616d  ght = gplt_param
+00017a70: 732e 6765 6e65 735f 6865 6967 6874 5f64  s.genes_height_d
+00017a80: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+00017a90: 6369 7263 6c65 5f6b 7761 7267 733a 204f  circle_kwargs: O
+00017aa0: 7074 696f 6e61 6c5b 6865 745f 7061 7261  ptional[het_para
+00017ab0: 6d73 2e63 6972 636c 655f 6b77 6172 6773  ms.circle_kwargs
+00017ac0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00017ad0: 2020 7368 6f77 3a20 6770 6c74 5f70 6172    show: gplt_par
+00017ae0: 616d 732e 7368 6f77 203d 2054 7275 652c  ams.show = True,
+00017af0: 0a20 2020 2029 202d 3e20 6770 6c74 5f70  .    ) -> gplt_p
+00017b00: 6172 616d 732e 6669 6775 7265 3a0a 2020  arams.figure:.  
+00017b10: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
+00017b20: 6c66 2e5f 6c6f 672e 6465 6275 670a 0a20  lf._log.debug.. 
+00017b30: 2020 2020 2020 2072 6573 6f6c 7665 645f         resolved_
+00017b40: 7265 6769 6f6e 203d 2073 656c 662e 7265  region = self.re
+00017b50: 736f 6c76 655f 7265 6769 6f6e 2872 6567  solve_region(reg
+00017b60: 696f 6e29 0a20 2020 2020 2020 2064 656c  ion).        del
+00017b70: 2072 6567 696f 6e0a 0a20 2020 2020 2020   region..       
+00017b80: 2064 6562 7567 2822 636f 6d70 7574 6520   debug("compute 
+00017b90: 7769 6e64 6f77 6564 2068 6574 6572 6f7a  windowed heteroz
+00017ba0: 7967 6f73 6974 7922 290a 2020 2020 2020  ygosity").      
+00017bb0: 2020 7361 6d70 6c65 5f69 642c 2073 616d    sample_id, sam
+00017bc0: 706c 655f 7365 742c 2077 696e 646f 7773  ple_set, windows
+00017bd0: 2c20 636f 756e 7473 203d 2073 656c 662e  , counts = self.
+00017be0: 5f73 616d 706c 655f 636f 756e 745f 6865  _sample_count_he
+00017bf0: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
+00017c00: 616d 706c 653d 7361 6d70 6c65 2c0a 2020  ample=sample,.  
+00017c10: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+00017c20: 3d72 6573 6f6c 7665 645f 7265 6769 6f6e  =resolved_region
+00017c30: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00017c40: 7465 5f6d 6173 6b3d 7369 7465 5f6d 6173  te_mask=site_mas
+00017c50: 6b2c 0a20 2020 2020 2020 2020 2020 2077  k,.            w
+00017c60: 696e 646f 775f 7369 7a65 3d77 696e 646f  indow_size=windo
+00017c70: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
+00017c80: 2020 2020 7361 6d70 6c65 5f73 6574 3d73      sample_set=s
+00017c90: 616d 706c 655f 7365 742c 0a20 2020 2020  ample_set,.     
+00017ca0: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
+00017cb0: 6275 6728 2270 6c6f 745f 6865 7465 726f  bug("plot_hetero
+00017cc0: 7a79 676f 7369 7479 2074 7261 636b 2229  zygosity track")
+00017cd0: 0a20 2020 2020 2020 2066 6967 5f68 6574  .        fig_het
+00017ce0: 203d 2073 656c 662e 5f70 6c6f 745f 6865   = self._plot_he
+00017cf0: 7465 726f 7a79 676f 7369 7479 5f74 7261  terozygosity_tra
+00017d00: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
+00017d10: 7361 6d70 6c65 5f69 643d 7361 6d70 6c65  sample_id=sample
+00017d20: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00017d30: 2073 616d 706c 655f 7365 743d 7361 6d70   sample_set=samp
+00017d40: 6c65 5f73 6574 2c0a 2020 2020 2020 2020  le_set,.        
+00017d50: 2020 2020 7769 6e64 6f77 733d 7769 6e64      windows=wind
+00017d60: 6f77 732c 0a20 2020 2020 2020 2020 2020  ows,.           
+00017d70: 2063 6f75 6e74 733d 636f 756e 7473 2c0a   counts=counts,.
+00017d80: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00017d90: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
+00017da0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00017db0: 7769 6e64 6f77 5f73 697a 653d 7769 6e64  window_size=wind
+00017dc0: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
+00017dd0: 2020 2020 2079 5f6d 6178 3d79 5f6d 6178       y_max=y_max
+00017de0: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00017df0: 7a69 6e67 5f6d 6f64 653d 7369 7a69 6e67  zing_mode=sizing
+00017e00: 5f6d 6f64 652c 0a20 2020 2020 2020 2020  _mode,.         
+00017e10: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
+00017e20: 2020 2020 2020 2020 2020 2020 6865 6967              heig
+00017e30: 6874 3d68 6574 6572 6f7a 7967 6f73 6974  ht=heterozygosit
+00017e40: 795f 6865 6967 6874 2c0a 2020 2020 2020  y_height,.      
+00017e50: 2020 2020 2020 6369 7263 6c65 5f6b 7761        circle_kwa
+00017e60: 7267 733d 6369 7263 6c65 5f6b 7761 7267  rgs=circle_kwarg
+00017e70: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
+00017e80: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
+00017e90: 2020 2020 2020 2078 5f72 616e 6765 3d4e         x_range=N
+00017ea0: 6f6e 652c 0a20 2020 2020 2020 2029 0a20  one,.        ). 
+00017eb0: 2020 2020 2020 2066 6967 5f68 6574 2e78         fig_het.x
+00017ec0: 6178 6973 2e76 6973 6962 6c65 203d 2046  axis.visible = F
+00017ed0: 616c 7365 0a20 2020 2020 2020 2066 6967  alse.        fig
+00017ee0: 7320 3d20 5b66 6967 5f68 6574 5d0a 0a20  s = [fig_het].. 
+00017ef0: 2020 2020 2020 2064 6562 7567 2822 636f         debug("co
+00017f00: 6d70 7574 6520 7275 6e73 206f 6620 686f  mpute runs of ho
+00017f10: 6d6f 7a79 676f 7369 7479 2229 0a20 2020  mozygosity").   
+00017f20: 2020 2020 2064 665f 726f 6820 3d20 7365       df_roh = se
+00017f30: 6c66 2e5f 726f 685f 686d 6d5f 7072 6564  lf._roh_hmm_pred
+00017f40: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
+00017f50: 2077 696e 646f 7773 3d77 696e 646f 7773   windows=windows
+00017f60: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00017f70: 756e 7473 3d63 6f75 6e74 732c 0a20 2020  unts=counts,.   
+00017f80: 2020 2020 2020 2020 2070 6865 745f 726f           phet_ro
+00017f90: 683d 7068 6574 5f72 6f68 2c0a 2020 2020  h=phet_roh,.    
+00017fa0: 2020 2020 2020 2020 7068 6574 5f6e 6f6e          phet_non
+00017fb0: 726f 683d 7068 6574 5f6e 6f6e 726f 682c  roh=phet_nonroh,
+00017fc0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00017fd0: 6e73 6974 696f 6e3d 7472 616e 7369 7469  nsition=transiti
+00017fe0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00017ff0: 7769 6e64 6f77 5f73 697a 653d 7769 6e64  window_size=wind
+00018000: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
+00018010: 2020 2020 2073 616d 706c 655f 6964 3d73       sample_id=s
+00018020: 616d 706c 655f 6964 2c0a 2020 2020 2020  ample_id,.      
+00018030: 2020 2020 2020 636f 6e74 6967 3d72 6573        contig=res
+00018040: 6f6c 7665 645f 7265 6769 6f6e 2e63 6f6e  olved_region.con
+00018050: 7469 672c 0a20 2020 2020 2020 2029 0a0a  tig,.        )..
+00018060: 2020 2020 2020 2020 6465 6275 6728 2270          debug("p
+00018070: 6c6f 7420 726f 6820 7472 6163 6b22 290a  lot roh track").
+00018080: 2020 2020 2020 2020 6669 675f 726f 6820          fig_roh 
+00018090: 3d20 7365 6c66 2e70 6c6f 745f 726f 685f  = self.plot_roh_
+000180a0: 7472 6163 6b28 0a20 2020 2020 2020 2020  track(.         
+000180b0: 2020 2064 665f 726f 682c 0a20 2020 2020     df_roh,.     
+000180c0: 2020 2020 2020 2072 6567 696f 6e3d 7265         region=re
+000180d0: 736f 6c76 6564 5f72 6567 696f 6e2c 0a20  solved_region,. 
+000180e0: 2020 2020 2020 2020 2020 2073 697a 696e             sizin
+000180f0: 675f 6d6f 6465 3d73 697a 696e 675f 6d6f  g_mode=sizing_mo
+00018100: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00018110: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
+00018120: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+00018130: 726f 685f 6865 6967 6874 2c0a 2020 2020  roh_height,.    
+00018140: 2020 2020 2020 2020 7368 6f77 3d46 616c          show=Fal
+00018150: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00018160: 785f 7261 6e67 653d 6669 675f 6865 742e  x_range=fig_het.
+00018170: 785f 7261 6e67 652c 0a20 2020 2020 2020  x_range,.       
+00018180: 2029 0a20 2020 2020 2020 2066 6967 5f72   ).        fig_r
+00018190: 6f68 2e78 6178 6973 2e76 6973 6962 6c65  oh.xaxis.visible
+000181a0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+000181b0: 2066 6967 732e 6170 7065 6e64 2866 6967   figs.append(fig
+000181c0: 5f72 6f68 290a 0a20 2020 2020 2020 2064  _roh)..        d
+000181d0: 6562 7567 2822 706c 6f74 2067 656e 6573  ebug("plot genes
+000181e0: 2074 7261 636b 2229 0a20 2020 2020 2020   track").       
+000181f0: 2066 6967 5f67 656e 6573 203d 2073 656c   fig_genes = sel
+00018200: 662e 706c 6f74 5f67 656e 6573 280a 2020  f.plot_genes(.  
+00018210: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+00018220: 3d72 6573 6f6c 7665 645f 7265 6769 6f6e  =resolved_region
+00018230: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00018240: 7a69 6e67 5f6d 6f64 653d 7369 7a69 6e67  zing_mode=sizing
+00018250: 5f6d 6f64 652c 0a20 2020 2020 2020 2020  _mode,.         
+00018260: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
+00018270: 2020 2020 2020 2020 2020 2020 6865 6967              heig
+00018280: 6874 3d67 656e 6573 5f68 6569 6768 742c  ht=genes_height,
+00018290: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
+000182a0: 616e 6765 3d66 6967 5f68 6574 2e78 5f72  ange=fig_het.x_r
+000182b0: 616e 6765 2c0a 2020 2020 2020 2020 2020  ange,.          
+000182c0: 2020 7368 6f77 3d46 616c 7365 2c0a 2020    show=False,.  
+000182d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000182e0: 6669 6773 2e61 7070 656e 6428 6669 675f  figs.append(fig_
+000182f0: 6765 6e65 7329 0a0a 2020 2020 2020 2020  genes)..        
+00018300: 6465 6275 6728 2263 6f6d 6269 6e65 2070  debug("combine p
+00018310: 6c6f 7473 2069 6e74 6f20 6120 7369 6e67  lots into a sing
+00018320: 6c65 2066 6967 7572 6522 290a 2020 2020  le figure").    
+00018330: 2020 2020 6669 675f 616c 6c20 3d20 626f      fig_all = bo
+00018340: 6b65 682e 6c61 796f 7574 732e 6772 6964  keh.layouts.grid
+00018350: 706c 6f74 280a 2020 2020 2020 2020 2020  plot(.          
+00018360: 2020 6669 6773 2c0a 2020 2020 2020 2020    figs,.        
+00018370: 2020 2020 6e63 6f6c 733d 312c 0a20 2020      ncols=1,.   
+00018380: 2020 2020 2020 2020 2074 6f6f 6c62 6172           toolbar
+00018390: 5f6c 6f63 6174 696f 6e3d 2261 626f 7665  _location="above
+000183a0: 222c 0a20 2020 2020 2020 2020 2020 206d  ",.            m
+000183b0: 6572 6765 5f74 6f6f 6c73 3d54 7275 652c  erge_tools=True,
+000183c0: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+000183d0: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
+000183e0: 6d6f 6465 2c0a 2020 2020 2020 2020 290a  mode,.        ).
+000183f0: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
+00018400: 3a0a 2020 2020 2020 2020 2020 2020 626f  :.            bo
+00018410: 6b65 682e 706c 6f74 7469 6e67 2e73 686f  keh.plotting.sho
+00018420: 7728 6669 675f 616c 6c29 0a0a 2020 2020  w(fig_all)..    
+00018430: 2020 2020 7265 7475 726e 2066 6967 5f61      return fig_a
+00018440: 6c6c 0a0a 2020 2020 6465 6620 5f6c 6f63  ll..    def _loc
+00018450: 6174 655f 7369 7465 5f63 6c61 7373 280a  ate_site_class(.
+00018460: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00018470: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
+00018480: 2072 6567 696f 6e2c 0a20 2020 2020 2020   region,.       
+00018490: 2073 6974 655f 6d61 736b 2c0a 2020 2020   site_mask,.    
+000184a0: 2020 2020 7369 7465 5f63 6c61 7373 2c0a      site_class,.
+000184b0: 2020 2020 293a 0a20 2020 2020 2020 2064      ):.        d
+000184c0: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
+000184d0: 2e64 6562 7567 0a0a 2020 2020 2020 2020  .debug..        
+000184e0: 2320 6361 6368 6520 7468 6573 6520 6461  # cache these da
+000184f0: 7461 2069 6e20 6d65 6d6f 7279 2074 6f20  ta in memory to 
+00018500: 6176 6f69 6420 7265 7065 6174 6564 2063  avoid repeated c
+00018510: 6f6d 7075 7461 7469 6f6e 0a20 2020 2020  omputation.     
+00018520: 2020 2063 6163 6865 5f6b 6579 203d 2028     cache_key = (
+00018530: 7265 6769 6f6e 2c20 7369 7465 5f6d 6173  region, site_mas
+00018540: 6b2c 2073 6974 655f 636c 6173 7329 0a0a  k, site_class)..
+00018550: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00018560: 2020 2020 2020 2020 206c 6f63 5f61 6e6e           loc_ann
+00018570: 203d 2073 656c 662e 5f63 6163 6865 5f6c   = self._cache_l
+00018580: 6f63 6174 655f 7369 7465 5f63 6c61 7373  ocate_site_class
+00018590: 5b63 6163 6865 5f6b 6579 5d0a 0a20 2020  [cache_key]..   
+000185a0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+000185b0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+000185c0: 2020 6465 6275 6728 2261 6363 6573 7320    debug("access 
+000185d0: 7369 7465 2061 6e6e 6f74 6174 696f 6e73  site annotations
+000185e0: 2064 6174 6122 290a 2020 2020 2020 2020   data").        
+000185f0: 2020 2020 6473 5f61 6e6e 203d 2073 656c      ds_ann = sel
+00018600: 662e 7369 7465 5f61 6e6e 6f74 6174 696f  f.site_annotatio
+00018610: 6e73 280a 2020 2020 2020 2020 2020 2020  ns(.            
+00018620: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
+00018630: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00018640: 2020 2073 6974 655f 6d61 736b 3d73 6974     site_mask=sit
+00018650: 655f 6d61 736b 2c0a 2020 2020 2020 2020  e_mask,.        
+00018660: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00018670: 2020 636f 646f 6e5f 706f 7320 3d20 6473    codon_pos = ds
+00018680: 5f61 6e6e 5b22 636f 646f 6e5f 706f 7369  _ann["codon_posi
+00018690: 7469 6f6e 225d 2e64 6174 610a 2020 2020  tion"].data.    
+000186a0: 2020 2020 2020 2020 636f 646f 6e5f 6465          codon_de
+000186b0: 6720 3d20 6473 5f61 6e6e 5b22 636f 646f  g = ds_ann["codo
+000186c0: 6e5f 6465 6765 6e65 7261 6379 225d 2e64  n_degeneracy"].d
+000186d0: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
+000186e0: 7365 715f 636c 7320 3d20 6473 5f61 6e6e  seq_cls = ds_ann
+000186f0: 5b22 7365 715f 636c 7322 5d2e 6461 7461  ["seq_cls"].data
+00018700: 0a20 2020 2020 2020 2020 2020 2073 6571  .            seq
+00018710: 5f66 6c65 6e20 3d20 6473 5f61 6e6e 5b22  _flen = ds_ann["
+00018720: 7365 715f 666c 656e 225d 2e64 6174 610a  seq_flen"].data.
+00018730: 2020 2020 2020 2020 2020 2020 7365 715f              seq_
+00018740: 7265 6c70 6f73 5f73 7461 7274 203d 2064  relpos_start = d
+00018750: 735f 616e 6e5b 2273 6571 5f72 656c 706f  s_ann["seq_relpo
+00018760: 735f 7374 6172 7422 5d2e 6461 7461 0a20  s_start"].data. 
+00018770: 2020 2020 2020 2020 2020 2073 6571 5f72             seq_r
+00018780: 656c 706f 735f 7374 6f70 203d 2064 735f  elpos_stop = ds_
+00018790: 616e 6e5b 2273 6571 5f72 656c 706f 735f  ann["seq_relpos_
+000187a0: 7374 6f70 225d 2e64 6174 610a 2020 2020  stop"].data.    
+000187b0: 2020 2020 2020 2020 7369 7465 5f63 6c61          site_cla
+000187c0: 7373 203d 2073 6974 655f 636c 6173 732e  ss = site_class.
+000187d0: 7570 7065 7228 290a 0a20 2020 2020 2020  upper()..       
+000187e0: 2020 2020 2064 6562 7567 2822 6465 6669       debug("defi
+000187f0: 6e65 2063 6f6e 7374 616e 7473 2075 7365  ne constants use
+00018800: 6420 696e 2073 6974 6520 616e 6e6f 7461  d in site annota
+00018810: 7469 6f6e 7320 6461 7461 2229 0a20 2020  tions data").   
+00018820: 2020 2020 2020 2020 2023 2046 4958 4d45           # FIXME
+00018830: 3a20 7661 7269 6162 6c65 2069 6e20 6675  : variable in fu
+00018840: 6e63 7469 6f6e 2073 686f 756c 6420 6265  nction should be
+00018850: 206c 6f77 6572 6361 7365 0a20 2020 2020   lowercase.     
+00018860: 2020 2020 2020 2053 4551 5f43 4c53 5f55         SEQ_CLS_U
+00018870: 4e4b 4e4f 574e 203d 2030 2020 2320 6e6f  NKNOWN = 0  # no
+00018880: 7161 0a20 2020 2020 2020 2020 2020 2053  qa.            S
+00018890: 4551 5f43 4c53 5f55 5053 5452 4541 4d20  EQ_CLS_UPSTREAM 
+000188a0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+000188b0: 5345 515f 434c 535f 444f 574e 5354 5245  SEQ_CLS_DOWNSTRE
+000188c0: 414d 203d 2032 0a20 2020 2020 2020 2020  AM = 2.         
+000188d0: 2020 2053 4551 5f43 4c53 5f35 5554 5220     SEQ_CLS_5UTR 
+000188e0: 3d20 330a 2020 2020 2020 2020 2020 2020  = 3.            
+000188f0: 5345 515f 434c 535f 3355 5452 203d 2034  SEQ_CLS_3UTR = 4
+00018900: 0a20 2020 2020 2020 2020 2020 2053 4551  .            SEQ
+00018910: 5f43 4c53 5f43 4453 5f46 4952 5354 203d  _CLS_CDS_FIRST =
+00018920: 2035 0a20 2020 2020 2020 2020 2020 2053   5.            S
+00018930: 4551 5f43 4c53 5f43 4453 5f4d 4944 203d  EQ_CLS_CDS_MID =
+00018940: 2036 0a20 2020 2020 2020 2020 2020 2053   6.            S
+00018950: 4551 5f43 4c53 5f43 4453 5f4c 4153 5420  EQ_CLS_CDS_LAST 
+00018960: 3d20 370a 2020 2020 2020 2020 2020 2020  = 7.            
+00018970: 5345 515f 434c 535f 494e 5452 4f4e 5f46  SEQ_CLS_INTRON_F
+00018980: 4952 5354 203d 2038 0a20 2020 2020 2020  IRST = 8.       
+00018990: 2020 2020 2053 4551 5f43 4c53 5f49 4e54       SEQ_CLS_INT
+000189a0: 524f 4e5f 4d49 4420 3d20 390a 2020 2020  RON_MID = 9.    
+000189b0: 2020 2020 2020 2020 5345 515f 434c 535f          SEQ_CLS_
+000189c0: 494e 5452 4f4e 5f4c 4153 5420 3d20 3130  INTRON_LAST = 10
+000189d0: 0a20 2020 2020 2020 2020 2020 2043 4f44  .            COD
+000189e0: 4f4e 5f44 4547 5f55 4e4b 4e4f 574e 203d  ON_DEG_UNKNOWN =
+000189f0: 2030 2020 2320 6e6f 7161 0a20 2020 2020   0  # noqa.     
+00018a00: 2020 2020 2020 2043 4f44 4f4e 5f44 4547         CODON_DEG
+00018a10: 5f30 203d 2031 0a20 2020 2020 2020 2020  _0 = 1.         
+00018a20: 2020 2043 4f44 4f4e 5f44 4547 5f32 5f53     CODON_DEG_2_S
+00018a30: 494d 504c 4520 3d20 320a 2020 2020 2020  IMPLE = 2.      
+00018a40: 2020 2020 2020 434f 444f 4e5f 4445 475f        CODON_DEG_
+00018a50: 325f 434f 4d50 4c45 5820 3d20 3320 2023  2_COMPLEX = 3  #
+00018a60: 206e 6f71 610a 2020 2020 2020 2020 2020   noqa.          
+00018a70: 2020 434f 444f 4e5f 4445 475f 3420 3d20    CODON_DEG_4 = 
+00018a80: 340a 0a20 2020 2020 2020 2020 2020 2064  4..            d
+00018a90: 6562 7567 2822 7365 7420 7570 2073 6974  ebug("set up sit
+00018aa0: 6520 7365 6c65 6374 696f 6e22 290a 0a20  e selection").. 
+00018ab0: 2020 2020 2020 2020 2020 2069 6620 7369             if si
+00018ac0: 7465 5f63 6c61 7373 203d 3d20 2243 4453  te_class == "CDS
+00018ad0: 5f44 4547 5f34 223a 0a20 2020 2020 2020  _DEG_4":.       
+00018ae0: 2020 2020 2020 2020 2023 2034 2d66 6f6c           # 4-fol
+00018af0: 6420 6465 6765 6e65 7261 7465 2063 6f64  d degenerate cod
+00018b00: 696e 6720 7369 7465 730a 2020 2020 2020  ing sites.      
+00018b10: 2020 2020 2020 2020 2020 6c6f 635f 616e            loc_an
+00018b20: 6e20 3d20 280a 2020 2020 2020 2020 2020  n = (.          
+00018b30: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+00018b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b50: 2020 2020 2873 6571 5f63 6c73 203d 3d20      (seq_cls == 
+00018b60: 5345 515f 434c 535f 4344 535f 4649 5253  SEQ_CLS_CDS_FIRS
+00018b70: 5429 0a20 2020 2020 2020 2020 2020 2020  T).             
+00018b80: 2020 2020 2020 2020 2020 207c 2028 7365             | (se
+00018b90: 715f 636c 7320 3d3d 2053 4551 5f43 4c53  q_cls == SEQ_CLS
+00018ba0: 5f43 4453 5f4d 4944 290a 2020 2020 2020  _CDS_MID).      
+00018bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bc0: 2020 7c20 2873 6571 5f63 6c73 203d 3d20    | (seq_cls == 
+00018bd0: 5345 515f 434c 535f 4344 535f 4c41 5354  SEQ_CLS_CDS_LAST
+00018be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018bf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00018c00: 2020 2020 2020 2020 2020 2020 2620 2863              & (c
+00018c10: 6f64 6f6e 5f70 6f73 203d 3d20 3229 0a20  odon_pos == 2). 
+00018c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c30: 2020 2026 2028 636f 646f 6e5f 6465 6720     & (codon_deg 
+00018c40: 3d3d 2043 4f44 4f4e 5f44 4547 5f34 290a  == CODON_DEG_4).
+00018c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c60: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00018c70: 6c69 6620 7369 7465 5f63 6c61 7373 203d  lif site_class =
+00018c80: 3d20 2243 4453 5f44 4547 5f32 5f53 494d  = "CDS_DEG_2_SIM
+00018c90: 504c 4522 3a0a 2020 2020 2020 2020 2020  PLE":.          
+00018ca0: 2020 2020 2020 2320 322d 666f 6c64 2064        # 2-fold d
+00018cb0: 6567 656e 6572 6174 6520 636f 6469 6e67  egenerate coding
+00018cc0: 2073 6974 6573 0a20 2020 2020 2020 2020   sites.         
+00018cd0: 2020 2020 2020 206c 6f63 5f61 6e6e 203d         loc_ann =
+00018ce0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00018cf0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00018d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d10: 2028 7365 715f 636c 7320 3d3d 2053 4551   (seq_cls == SEQ
+00018d20: 5f43 4c53 5f43 4453 5f46 4952 5354 290a  _CLS_CDS_FIRST).
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 2020 2020 2020 2020 7c20 2873 6571 5f63          | (seq_c
+00018d50: 6c73 203d 3d20 5345 515f 434c 535f 4344  ls == SEQ_CLS_CD
+00018d60: 535f 4d49 4429 0a20 2020 2020 2020 2020  S_MID).         
+00018d70: 2020 2020 2020 2020 2020 2020 2020 207c                 |
+00018d80: 2028 7365 715f 636c 7320 3d3d 2053 4551   (seq_cls == SEQ
+00018d90: 5f43 4c53 5f43 4453 5f4c 4153 5429 0a20  _CLS_CDS_LAST). 
+00018da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018db0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00018dc0: 2020 2020 2020 2020 2026 2028 636f 646f           & (codo
+00018dd0: 6e5f 706f 7320 3d3d 2032 290a 2020 2020  n_pos == 2).    
+00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018df0: 2620 2863 6f64 6f6e 5f64 6567 203d 3d20  & (codon_deg == 
+00018e00: 434f 444f 4e5f 4445 475f 325f 5349 4d50  CODON_DEG_2_SIMP
+00018e10: 4c45 290a 2020 2020 2020 2020 2020 2020  LE).            
+00018e20: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00018e30: 2020 2065 6c69 6620 7369 7465 5f63 6c61     elif site_cla
+00018e40: 7373 203d 3d20 2243 4453 5f44 4547 5f30  ss == "CDS_DEG_0
+00018e50: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00018e60: 2020 2023 206e 6f6e 2d64 6567 656e 6572     # non-degener
+00018e70: 6174 6520 636f 6469 6e67 2073 6974 6573  ate coding sites
+00018e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018e90: 206c 6f63 5f61 6e6e 203d 2028 0a20 2020   loc_ann = (.   
+00018ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018eb0: 2028 7365 715f 636c 7320 3d3d 2053 4551   (seq_cls == SEQ
+00018ec0: 5f43 4c53 5f43 4453 5f46 4952 5354 290a  _CLS_CDS_FIRST).
+00018ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ee0: 2020 2020 7c20 2873 6571 5f63 6c73 203d      | (seq_cls =
+00018ef0: 3d20 5345 515f 434c 535f 4344 535f 4d49  = SEQ_CLS_CDS_MI
+00018f00: 4429 0a20 2020 2020 2020 2020 2020 2020  D).             
+00018f10: 2020 2020 2020 207c 2028 7365 715f 636c         | (seq_cl
+00018f20: 7320 3d3d 2053 4551 5f43 4c53 5f43 4453  s == SEQ_CLS_CDS
+00018f30: 5f4c 4153 5429 0a20 2020 2020 2020 2020  _LAST).         
+00018f40: 2020 2020 2020 2029 2026 2028 636f 646f         ) & (codo
+00018f50: 6e5f 6465 6720 3d3d 2043 4f44 4f4e 5f44  n_deg == CODON_D
+00018f60: 4547 5f30 290a 0a20 2020 2020 2020 2020  EG_0)..         
+00018f70: 2020 2065 6c69 6620 7369 7465 5f63 6c61     elif site_cla
+00018f80: 7373 203d 3d20 2249 4e54 524f 4e5f 5348  ss == "INTRON_SH
+00018f90: 4f52 5422 3a0a 2020 2020 2020 2020 2020  ORT":.          
+00018fa0: 2020 2020 2020 2320 7368 6f72 7420 696e        # short in
+00018fb0: 7472 6f6e 732c 2065 7863 6c75 6469 6e67  trons, excluding
+00018fc0: 2073 706c 6963 6520 7265 6769 6f6e 730a   splice regions.
+00018fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018fe0: 6c6f 635f 616e 6e20 3d20 280a 2020 2020  loc_ann = (.    
+00018ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019000: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019010: 2020 2020 2020 2020 2020 2873 6571 5f63            (seq_c
+00019020: 6c73 203d 3d20 5345 515f 434c 535f 494e  ls == SEQ_CLS_IN
+00019030: 5452 4f4e 5f46 4952 5354 290a 2020 2020  TRON_FIRST).    
+00019040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019050: 2020 2020 7c20 2873 6571 5f63 6c73 203d      | (seq_cls =
+00019060: 3d20 5345 515f 434c 535f 494e 5452 4f4e  = SEQ_CLS_INTRON
+00019070: 5f4d 4944 290a 2020 2020 2020 2020 2020  _MID).          
+00019080: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
+00019090: 2873 6571 5f63 6c73 203d 3d20 5345 515f  (seq_cls == SEQ_
+000190a0: 434c 535f 494e 5452 4f4e 5f4c 4153 5429  CLS_INTRON_LAST)
+000190b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000190c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000190d0: 2020 2020 2020 2020 2020 2026 2028 7365             & (se
+000190e0: 715f 666c 656e 203c 2031 3030 290a 2020  q_flen < 100).  
+000190f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019100: 2020 2620 2873 6571 5f72 656c 706f 735f    & (seq_relpos_
+00019110: 7374 6172 7420 3e20 3130 290a 2020 2020  start > 10).    
+00019120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019130: 2620 2873 6571 5f72 656c 706f 735f 7374  & (seq_relpos_st
+00019140: 6f70 203e 2031 3029 0a20 2020 2020 2020  op > 10).       
+00019150: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00019160: 2020 2020 2020 2020 656c 6966 2073 6974          elif sit
+00019170: 655f 636c 6173 7320 3d3d 2022 494e 5452  e_class == "INTR
+00019180: 4f4e 5f4c 4f4e 4722 3a0a 2020 2020 2020  ON_LONG":.      
+00019190: 2020 2020 2020 2020 2020 2320 6c6f 6e67            # long
+000191a0: 2069 6e74 726f 6e73 2c20 6578 636c 7564   introns, exclud
+000191b0: 696e 6720 7370 6c69 6365 2072 6567 696f  ing splice regio
+000191c0: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
+000191d0: 2020 206c 6f63 5f61 6e6e 203d 2028 0a20     loc_ann = (. 
+000191e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191f0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+00019200: 2020 2020 2020 2020 2020 2020 2028 7365               (se
+00019210: 715f 636c 7320 3d3d 2053 4551 5f43 4c53  q_cls == SEQ_CLS
+00019220: 5f49 4e54 524f 4e5f 4649 5253 5429 0a20  _INTRON_FIRST). 
+00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019240: 2020 2020 2020 207c 2028 7365 715f 636c         | (seq_cl
+00019250: 7320 3d3d 2053 4551 5f43 4c53 5f49 4e54  s == SEQ_CLS_INT
+00019260: 524f 4e5f 4d49 4429 0a20 2020 2020 2020  RON_MID).       
+00019270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019280: 207c 2028 7365 715f 636c 7320 3d3d 2053   | (seq_cls == S
+00019290: 4551 5f43 4c53 5f49 4e54 524f 4e5f 4c41  EQ_CLS_INTRON_LA
+000192a0: 5354 290a 2020 2020 2020 2020 2020 2020  ST).            
+000192b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000192c0: 2020 2020 2020 2020 2020 2020 2020 2620                & 
+000192d0: 2873 6571 5f66 6c65 6e20 3e20 3230 3029  (seq_flen > 200)
+000192e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000192f0: 2020 2020 2026 2028 7365 715f 7265 6c70       & (seq_relp
+00019300: 6f73 5f73 7461 7274 203e 2031 3029 0a20  os_start > 10). 
+00019310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019320: 2020 2026 2028 7365 715f 7265 6c70 6f73     & (seq_relpos
+00019330: 5f73 746f 7020 3e20 3130 290a 2020 2020  _stop > 10).    
+00019340: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00019350: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00019360: 7369 7465 5f63 6c61 7373 203d 3d20 2249  site_class == "I
+00019370: 4e54 524f 4e5f 5350 4c49 4345 5f35 5052  NTRON_SPLICE_5PR
+00019380: 494d 4522 3a0a 2020 2020 2020 2020 2020  IME":.          
+00019390: 2020 2020 2020 2320 3527 2069 6e74 726f        # 5' intro
+000193a0: 6e20 7370 6c69 6365 2072 6567 696f 6e73  n splice regions
+000193b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000193c0: 206c 6f63 5f61 6e6e 203d 2028 0a20 2020   loc_ann = (.   
+000193d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193e0: 2028 7365 715f 636c 7320 3d3d 2053 4551   (seq_cls == SEQ
+000193f0: 5f43 4c53 5f49 4e54 524f 4e5f 4649 5253  _CLS_INTRON_FIRS
+00019400: 5429 0a20 2020 2020 2020 2020 2020 2020  T).             
+00019410: 2020 2020 2020 207c 2028 7365 715f 636c         | (seq_cl
+00019420: 7320 3d3d 2053 4551 5f43 4c53 5f49 4e54  s == SEQ_CLS_INT
+00019430: 524f 4e5f 4d49 4429 0a20 2020 2020 2020  RON_MID).       
+00019440: 2020 2020 2020 2020 2020 2020 207c 2028               | (
+00019450: 7365 715f 636c 7320 3d3d 2053 4551 5f43  seq_cls == SEQ_C
+00019460: 4c53 5f49 4e54 524f 4e5f 4c41 5354 290a  LS_INTRON_LAST).
+00019470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019480: 2920 2620 2873 6571 5f72 656c 706f 735f  ) & (seq_relpos_
+00019490: 7374 6172 7420 3c20 3229 0a0a 2020 2020  start < 2)..    
+000194a0: 2020 2020 2020 2020 656c 6966 2073 6974          elif sit
+000194b0: 655f 636c 6173 7320 3d3d 2022 494e 5452  e_class == "INTR
+000194c0: 4f4e 5f53 504c 4943 455f 3350 5249 4d45  ON_SPLICE_3PRIME
+000194d0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000194e0: 2020 2023 2033 2720 696e 7472 6f6e 2073     # 3' intron s
+000194f0: 706c 6963 6520 7265 6769 6f6e 730a 2020  plice regions.  
+00019500: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00019510: 635f 616e 6e20 3d20 280a 2020 2020 2020  c_ann = (.      
+00019520: 2020 2020 2020 2020 2020 2020 2020 2873                (s
+00019530: 6571 5f63 6c73 203d 3d20 5345 515f 434c  eq_cls == SEQ_CL
+00019540: 535f 494e 5452 4f4e 5f46 4952 5354 290a  S_INTRON_FIRST).
+00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019560: 2020 2020 7c20 2873 6571 5f63 6c73 203d      | (seq_cls =
+00019570: 3d20 5345 515f 434c 535f 494e 5452 4f4e  = SEQ_CLS_INTRON
+00019580: 5f4d 4944 290a 2020 2020 2020 2020 2020  _MID).          
+00019590: 2020 2020 2020 2020 2020 7c20 2873 6571            | (seq
+000195a0: 5f63 6c73 203d 3d20 5345 515f 434c 535f  _cls == SEQ_CLS_
+000195b0: 494e 5452 4f4e 5f4c 4153 5429 0a20 2020  INTRON_LAST).   
+000195c0: 2020 2020 2020 2020 2020 2020 2029 2026               ) &
+000195d0: 2028 7365 715f 7265 6c70 6f73 5f73 746f   (seq_relpos_sto
+000195e0: 7020 3c20 3229 0a0a 2020 2020 2020 2020  p < 2)..        
+000195f0: 2020 2020 656c 6966 2073 6974 655f 636c      elif site_cl
+00019600: 6173 7320 3d3d 2022 5554 525f 3550 5249  ass == "UTR_5PRI
+00019610: 4d45 223a 0a20 2020 2020 2020 2020 2020  ME":.           
+00019620: 2020 2020 2023 2035 2720 5554 520a 2020       # 5' UTR.  
+00019630: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00019640: 635f 616e 6e20 3d20 7365 715f 636c 7320  c_ann = seq_cls 
+00019650: 3d3d 2053 4551 5f43 4c53 5f35 5554 520a  == SEQ_CLS_5UTR.
+00019660: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00019670: 6620 7369 7465 5f63 6c61 7373 203d 3d20  f site_class == 
+00019680: 2255 5452 5f33 5052 494d 4522 3a0a 2020  "UTR_3PRIME":.  
+00019690: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000196a0: 3327 2055 5452 0a20 2020 2020 2020 2020  3' UTR.         
+000196b0: 2020 2020 2020 206c 6f63 5f61 6e6e 203d         loc_ann =
+000196c0: 2073 6571 5f63 6c73 203d 3d20 5345 515f   seq_cls == SEQ_
+000196d0: 434c 535f 3355 5452 0a0a 2020 2020 2020  CLS_3UTR..      
+000196e0: 2020 2020 2020 656c 6966 2073 6974 655f        elif site_
+000196f0: 636c 6173 7320 3d3d 2022 494e 5445 5247  class == "INTERG
+00019700: 454e 4943 223a 0a20 2020 2020 2020 2020  ENIC":.         
+00019710: 2020 2020 2020 2023 2069 6e74 6572 6765         # interge
+00019720: 6e69 6320 7265 6769 6f6e 732c 2064 6973  nic regions, dis
+00019730: 7461 6e74 2066 726f 6d20 6120 6765 6e65  tant from a gene
+00019740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019750: 206c 6f63 5f61 6e6e 203d 2028 0a20 2020   loc_ann = (.   
+00019760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019770: 2028 7365 715f 636c 7320 3d3d 2053 4551   (seq_cls == SEQ
+00019780: 5f43 4c53 5f55 5053 5452 4541 4d29 2026  _CLS_UPSTREAM) &
+00019790: 2028 7365 715f 7265 6c70 6f73 5f73 746f   (seq_relpos_sto
+000197a0: 7020 3e20 3130 5f30 3030 290a 2020 2020  p > 10_000).    
+000197b0: 2020 2020 2020 2020 2020 2020 2920 7c20              ) | 
+000197c0: 2828 7365 715f 636c 7320 3d3d 2053 4551  ((seq_cls == SEQ
+000197d0: 5f43 4c53 5f44 4f57 4e53 5452 4541 4d29  _CLS_DOWNSTREAM)
+000197e0: 2026 2028 7365 715f 7265 6c70 6f73 5f73   & (seq_relpos_s
+000197f0: 7461 7274 203e 2031 305f 3030 3029 290a  tart > 10_000)).
+00019800: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00019810: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00019820: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
+00019830: 656d 656e 7465 6445 7272 6f72 2873 6974  ementedError(sit
+00019840: 655f 636c 6173 7329 0a0a 2020 2020 2020  e_class)..      
+00019850: 2020 2020 2020 6465 6275 6728 2263 6f6d        debug("com
+00019860: 7075 7465 2073 6974 6520 7365 6c65 6374  pute site select
+00019870: 696f 6e22 290a 2020 2020 2020 2020 2020  ion").          
+00019880: 2020 7769 7468 2073 656c 662e 5f64 6173    with self._das
+00019890: 6b5f 7072 6f67 7265 7373 2864 6573 633d  k_progress(desc=
+000198a0: 6622 4c6f 6361 7465 207b 7369 7465 5f63  f"Locate {site_c
+000198b0: 6c61 7373 7d20 7369 7465 7322 293a 0a20  lass} sites"):. 
+000198c0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000198d0: 6f63 5f61 6e6e 203d 206c 6f63 5f61 6e6e  oc_ann = loc_ann
+000198e0: 2e63 6f6d 7075 7465 2829 0a0a 2020 2020  .compute()..    
+000198f0: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+00019900: 6368 655f 6c6f 6361 7465 5f73 6974 655f  che_locate_site_
+00019910: 636c 6173 735b 6361 6368 655f 6b65 795d  class[cache_key]
+00019920: 203d 206c 6f63 5f61 6e6e 0a0a 2020 2020   = loc_ann..    
+00019930: 2020 2020 7265 7475 726e 206c 6f63 5f61      return loc_a
+00019940: 6e6e 0a0a 2020 2020 4064 6f63 280a 2020  nn..    @doc(.  
+00019950: 2020 2020 2020 7375 6d6d 6172 793d 224c        summary="L
+00019960: 6f61 6420 7369 7465 2061 6e6e 6f74 6174  oad site annotat
+00019970: 696f 6e73 2e22 2c0a 2020 2020 2020 2020  ions.",.        
+00019980: 7265 7475 726e 733d 2241 2064 6174 6173  returns="A datas
+00019990: 6574 206f 6620 7369 7465 2061 6e6e 6f74  et of site annot
+000199a0: 6174 696f 6e73 2e22 2c0a 2020 2020 290a  ations.",.    ).
+000199b0: 2020 2020 6465 6620 7369 7465 5f61 6e6e      def site_ann
+000199c0: 6f74 6174 696f 6e73 280a 2020 2020 2020  otations(.      
+000199d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000199e0: 7265 6769 6f6e 3a20 6261 7365 5f70 6172  region: base_par
+000199f0: 616d 732e 7265 6769 6f6e 2c0a 2020 2020  ams.region,.    
+00019a00: 2020 2020 7369 7465 5f6d 6173 6b3a 204f      site_mask: O
+00019a10: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+00019a20: 616d 732e 7369 7465 5f6d 6173 6b5d 203d  ams.site_mask] =
+00019a30: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
+00019a40: 6e6c 696e 655f 6172 7261 793a 2062 6173  nline_array: bas
+00019a50: 655f 7061 7261 6d73 2e69 6e6c 696e 655f  e_params.inline_
+00019a60: 6172 7261 7920 3d20 6261 7365 5f70 6172  array = base_par
+00019a70: 616d 732e 696e 6c69 6e65 5f61 7272 6179  ams.inline_array
+00019a80: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00019a90: 2020 6368 756e 6b73 3a20 6261 7365 5f70    chunks: base_p
+00019aa0: 6172 616d 732e 6368 756e 6b73 203d 2062  arams.chunks = b
+00019ab0: 6173 655f 7061 7261 6d73 2e63 6875 6e6b  ase_params.chunk
+00019ac0: 735f 6465 6661 756c 742c 0a20 2020 2029  s_default,.    )
+00019ad0: 202d 3e20 7872 2e44 6174 6173 6574 3a0a   -> xr.Dataset:.
+00019ae0: 2020 2020 2020 2020 2320 4e2e 422e 2c20          # N.B., 
+00019af0: 7765 2064 6566 6175 6c74 2074 6f20 6368  we default to ch
+00019b00: 756e 6b73 3d22 6175 746f 2220 6865 7265  unks="auto" here
+00019b10: 2066 6f72 2070 6572 666f 726d 616e 6365   for performance
+00019b20: 2072 6561 736f 6e73 0a0a 2020 2020 2020   reasons..      
+00019b30: 2020 6465 6275 6720 3d20 7365 6c66 2e5f    debug = self._
+00019b40: 6c6f 672e 6465 6275 670a 0a20 2020 2020  log.debug..     
+00019b50: 2020 2064 6562 7567 2822 7265 736f 6c76     debug("resolv
+00019b60: 6520 7265 6769 6f6e 2229 0a20 2020 2020  e region").     
+00019b70: 2020 2072 6573 6f6c 7665 645f 7265 6769     resolved_regi
+00019b80: 6f6e 203d 2073 656c 662e 7265 736f 6c76  on = self.resolv
+00019b90: 655f 7265 6769 6f6e 2872 6567 696f 6e29  e_region(region)
+00019ba0: 0a20 2020 2020 2020 2064 656c 2072 6567  .        del reg
+00019bb0: 696f 6e0a 2020 2020 2020 2020 6966 2069  ion.        if i
+00019bc0: 7369 6e73 7461 6e63 6528 7265 736f 6c76  sinstance(resolv
+00019bd0: 6564 5f72 6567 696f 6e2c 206c 6973 7429  ed_region, list)
+00019be0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00019bf0: 6973 6520 5479 7065 4572 726f 7228 224d  ise TypeError("M
+00019c00: 756c 7469 706c 6520 7265 6769 6f6e 7320  ultiple regions 
+00019c10: 6e6f 7420 7375 7070 6f72 7465 642e 2229  not supported.")
+00019c20: 0a20 2020 2020 2020 2063 6f6e 7469 6720  .        contig 
+00019c30: 3d20 7265 736f 6c76 6564 5f72 6567 696f  = resolved_regio
+00019c40: 6e2e 636f 6e74 6967 0a0a 2020 2020 2020  n.contig..      
+00019c50: 2020 6465 6275 6728 226f 7065 6e20 7369    debug("open si
+00019c60: 7465 2061 6e6e 6f74 6174 696f 6e73 207a  te annotations z
+00019c70: 6172 7222 290a 2020 2020 2020 2020 726f  arr").        ro
+00019c80: 6f74 203d 2073 656c 662e 6f70 656e 5f73  ot = self.open_s
+00019c90: 6974 655f 616e 6e6f 7461 7469 6f6e 7328  ite_annotations(
+00019ca0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00019cb0: 2822 6275 696c 6420 6120 6461 7461 7365  ("build a datase
+00019cc0: 7422 290a 2020 2020 2020 2020 6473 203d  t").        ds =
+00019cd0: 2078 722e 4461 7461 7365 7428 290a 2020   xr.Dataset().  
+00019ce0: 2020 2020 2020 666f 7220 6669 656c 6420        for field 
+00019cf0: 696e 2028 0a20 2020 2020 2020 2020 2020  in (.           
+00019d00: 2022 636f 646f 6e5f 6465 6765 6e65 7261   "codon_degenera
+00019d10: 6379 222c 0a20 2020 2020 2020 2020 2020  cy",.           
+00019d20: 2022 636f 646f 6e5f 6e6f 6e73 796e 222c   "codon_nonsyn",
+00019d30: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
+00019d40: 646f 6e5f 706f 7369 7469 6f6e 222c 0a20  don_position",. 
+00019d50: 2020 2020 2020 2020 2020 2022 7365 715f             "seq_
+00019d60: 636c 7322 2c0a 2020 2020 2020 2020 2020  cls",.          
+00019d70: 2020 2273 6571 5f66 6c65 6e22 2c0a 2020    "seq_flen",.  
+00019d80: 2020 2020 2020 2020 2020 2273 6571 5f72            "seq_r
+00019d90: 656c 706f 735f 7374 6172 7422 2c0a 2020  elpos_start",.  
+00019da0: 2020 2020 2020 2020 2020 2273 6571 5f72            "seq_r
+00019db0: 656c 706f 735f 7374 6f70 222c 0a20 2020  elpos_stop",.   
+00019dc0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00019dd0: 2020 2020 6461 7461 203d 2064 615f 6672      data = da_fr
+00019de0: 6f6d 5f7a 6172 7228 0a20 2020 2020 2020  om_zarr(.       
+00019df0: 2020 2020 2020 2020 2072 6f6f 745b 6669           root[fi
+00019e00: 656c 645d 5b63 6f6e 7469 675d 2c0a 2020  eld][contig],.  
+00019e10: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00019e20: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
+00019e30: 655f 6172 7261 792c 0a20 2020 2020 2020  e_array,.       
+00019e40: 2020 2020 2020 2020 2063 6875 6e6b 733d           chunks=
+00019e50: 6368 756e 6b73 2c0a 2020 2020 2020 2020  chunks,.        
+00019e60: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00019e70: 2020 6473 5b66 6965 6c64 5d20 3d20 2276    ds[field] = "v
+00019e80: 6172 6961 6e74 7322 2c20 6461 7461 0a0a  ariants", data..
+00019e90: 2020 2020 2020 2020 6465 6275 6728 2273          debug("s
+00019ea0: 7562 7365 7420 746f 2053 4e50 2070 6f73  ubset to SNP pos
+00019eb0: 6974 696f 6e73 2229 0a20 2020 2020 2020  itions").       
+00019ec0: 2070 6f73 203d 2073 656c 662e 736e 705f   pos = self.snp_
+00019ed0: 7369 7465 7328 0a20 2020 2020 2020 2020  sites(.         
+00019ee0: 2020 2072 6567 696f 6e3d 636f 6e74 6967     region=contig
+00019ef0: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00019f00: 656c 643d 2250 4f53 222c 0a20 2020 2020  eld="POS",.     
+00019f10: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+00019f20: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
+00019f30: 2020 2020 2020 2020 696e 6c69 6e65 5f61          inline_a
+00019f40: 7272 6179 3d69 6e6c 696e 655f 6172 7261  rray=inline_arra
+00019f50: 792c 0a20 2020 2020 2020 2020 2020 2063  y,.            c
+00019f60: 6875 6e6b 733d 6368 756e 6b73 2c0a 2020  hunks=chunks,.  
+00019f70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00019f80: 706f 7320 3d20 706f 732e 636f 6d70 7574  pos = pos.comput
+00019f90: 6528 290a 2020 2020 2020 2020 6966 2072  e().        if r
+00019fa0: 6573 6f6c 7665 645f 7265 6769 6f6e 2e73  esolved_region.s
+00019fb0: 7461 7274 206f 7220 7265 736f 6c76 6564  tart or resolved
+00019fc0: 5f72 6567 696f 6e2e 656e 643a 0a20 2020  _region.end:.   
+00019fd0: 2020 2020 2020 2020 206c 6f63 5f72 6567           loc_reg
+00019fe0: 696f 6e20 3d20 6c6f 6361 7465 5f72 6567  ion = locate_reg
+00019ff0: 696f 6e28 7265 736f 6c76 6564 5f72 6567  ion(resolved_reg
+0001a000: 696f 6e2c 2070 6f73 290a 2020 2020 2020  ion, pos).      
+0001a010: 2020 2020 2020 706f 7320 3d20 706f 735b        pos = pos[
+0001a020: 6c6f 635f 7265 6769 6f6e 5d0a 2020 2020  loc_region].    
+0001a030: 2020 2020 6964 7820 3d20 706f 7320 2d20      idx = pos - 
+0001a040: 310a 2020 2020 2020 2020 6473 203d 2064  1.        ds = d
+0001a050: 732e 6973 656c 2876 6172 6961 6e74 733d  s.isel(variants=
+0001a060: 6964 7829 0a0a 2020 2020 2020 2020 7265  idx)..        re
+0001a070: 7475 726e 2064 730a 0a20 2020 2040 646f  turn ds..    @do
+0001a080: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
+0001a090: 7279 3d22 2222 0a20 2020 2020 2020 2020  ry=""".         
+0001a0a0: 2020 2052 756e 2061 2070 7269 6e63 6970     Run a princip
+0001a0b0: 616c 2063 6f6d 706f 6e65 6e74 7320 616e  al components an
+0001a0c0: 616c 7973 6973 2028 5043 4129 2075 7369  alysis (PCA) usi
+0001a0d0: 6e67 2062 6961 6c6c 656c 6963 2053 4e50  ng biallelic SNP
+0001a0e0: 7320 6672 6f6d 0a20 2020 2020 2020 2020  s from.         
+0001a0f0: 2020 2074 6865 2073 656c 6563 7465 6420     the selected 
+0001a100: 6765 6e6f 6d65 2072 6567 696f 6e20 616e  genome region an
+0001a110: 6420 7361 6d70 6c65 732e 0a20 2020 2020  d samples..     
+0001a120: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+0001a130: 7265 7475 726e 733d 2822 6466 5f70 6361  returns=("df_pca
+0001a140: 222c 2022 6576 7222 292c 0a20 2020 2020  ", "evr"),.     
+0001a150: 2020 206e 6f74 6573 3d22 2222 0a20 2020     notes=""".   
+0001a160: 2020 2020 2020 2020 2054 6869 7320 636f           This co
+0001a170: 6d70 7574 6174 696f 6e20 6d61 7920 7461  mputation may ta
+0001a180: 6b65 2073 6f6d 6520 7469 6d65 2074 6f20  ke some time to 
+0001a190: 7275 6e2c 2064 6570 656e 6469 6e67 206f  run, depending o
+0001a1a0: 6e20 796f 7572 2063 6f6d 7075 7469 6e67  n your computing
+0001a1b0: 0a20 2020 2020 2020 2020 2020 2065 6e76  .            env
+0001a1c0: 6972 6f6e 6d65 6e74 2e20 5265 7375 6c74  ironment. Result
+0001a1d0: 7320 6f66 2074 6869 7320 636f 6d70 7574  s of this comput
+0001a1e0: 6174 696f 6e20 7769 6c6c 2062 6520 6361  ation will be ca
+0001a1f0: 6368 6564 2061 6e64 2072 652d 7573 6564  ched and re-used
+0001a200: 2069 660a 2020 2020 2020 2020 2020 2020   if.            
+0001a210: 7468 6520 6072 6573 756c 7473 5f63 6163  the `results_cac
+0001a220: 6865 6020 7061 7261 6d65 7465 7220 7761  he` parameter wa
+0001a230: 7320 7365 7420 7768 656e 2069 6e73 7461  s set when insta
+0001a240: 6e74 6961 7469 6e67 2074 6865 2041 6733  ntiating the Ag3
+0001a250: 2063 6c61 7373 2e0a 2020 2020 2020 2020   class..        
+0001a260: 2222 222c 0a20 2020 2029 0a20 2020 2064  """,.    ).    d
+0001a270: 6566 2070 6361 280a 2020 2020 2020 2020  ef pca(.        
+0001a280: 7365 6c66 2c0a 2020 2020 2020 2020 7265  self,.        re
+0001a290: 6769 6f6e 3a20 6261 7365 5f70 6172 616d  gion: base_param
+0001a2a0: 732e 7265 6769 6f6e 2c0a 2020 2020 2020  s.region,.      
+0001a2b0: 2020 6e5f 736e 7073 3a20 7063 615f 7061    n_snps: pca_pa
+0001a2c0: 7261 6d73 2e6e 5f73 6e70 732c 0a20 2020  rams.n_snps,.   
+0001a2d0: 2020 2020 2074 6869 6e5f 6f66 6673 6574       thin_offset
+0001a2e0: 3a20 7063 615f 7061 7261 6d73 2e74 6869  : pca_params.thi
+0001a2f0: 6e5f 6f66 6673 6574 203d 2070 6361 5f70  n_offset = pca_p
+0001a300: 6172 616d 732e 7468 696e 5f6f 6666 7365  arams.thin_offse
+0001a310: 745f 6465 6661 756c 742c 0a20 2020 2020  t_default,.     
+0001a320: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
+0001a330: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0001a340: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
+0001a350: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0001a360: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
+0001a370: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0001a380: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
+0001a390: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
+0001a3a0: 2020 2073 6974 655f 6d61 736b 3a20 6261     site_mask: ba
+0001a3b0: 7365 5f70 6172 616d 732e 7369 7465 5f6d  se_params.site_m
+0001a3c0: 6173 6b20 3d20 4445 4641 554c 542c 0a20  ask = DEFAULT,. 
+0001a3d0: 2020 2020 2020 206d 696e 5f6d 696e 6f72         min_minor
+0001a3e0: 5f61 633a 2070 6361 5f70 6172 616d 732e  _ac: pca_params.
+0001a3f0: 6d69 6e5f 6d69 6e6f 725f 6163 203d 2070  min_minor_ac = p
+0001a400: 6361 5f70 6172 616d 732e 6d69 6e5f 6d69  ca_params.min_mi
+0001a410: 6e6f 725f 6163 5f64 6566 6175 6c74 2c0a  nor_ac_default,.
+0001a420: 2020 2020 2020 2020 6d61 785f 6d69 7373          max_miss
+0001a430: 696e 675f 616e 3a20 7063 615f 7061 7261  ing_an: pca_para
+0001a440: 6d73 2e6d 6178 5f6d 6973 7369 6e67 5f61  ms.max_missing_a
+0001a450: 6e20 3d20 7063 615f 7061 7261 6d73 2e6d  n = pca_params.m
+0001a460: 6178 5f6d 6973 7369 6e67 5f61 6e5f 6465  ax_missing_an_de
+0001a470: 6661 756c 742c 0a20 2020 2020 2020 206e  fault,.        n
+0001a480: 5f63 6f6d 706f 6e65 6e74 733a 2070 6361  _components: pca
+0001a490: 5f70 6172 616d 732e 6e5f 636f 6d70 6f6e  _params.n_compon
+0001a4a0: 656e 7473 203d 2070 6361 5f70 6172 616d  ents = pca_param
+0001a4b0: 732e 6e5f 636f 6d70 6f6e 656e 7473 5f64  s.n_components_d
+0001a4c0: 6566 6175 6c74 2c0a 2020 2020 2920 2d3e  efault,.    ) ->
+0001a4d0: 2054 7570 6c65 5b70 6361 5f70 6172 616d   Tuple[pca_param
+0001a4e0: 732e 6466 5f70 6361 2c20 7063 615f 7061  s.df_pca, pca_pa
+0001a4f0: 7261 6d73 2e65 7672 5d3a 0a20 2020 2020  rams.evr]:.     
+0001a500: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
+0001a510: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
+0001a520: 2020 2020 2320 6368 616e 6765 2074 6869      # change thi
+0001a530: 7320 6e61 6d65 2069 6620 796f 7520 6576  s name if you ev
+0001a540: 6572 2063 6861 6e67 6520 7468 6520 6265  er change the be
+0001a550: 6861 7669 6f75 7220 6f66 2074 6869 7320  haviour of this 
+0001a560: 6675 6e63 7469 6f6e 2c20 746f 0a20 2020  function, to.   
+0001a570: 2020 2020 2023 2069 6e76 616c 6964 6174       # invalidat
+0001a580: 6520 616e 7920 7072 6576 696f 7573 6c79  e any previously
+0001a590: 2063 6163 6865 6420 6461 7461 0a20 2020   cached data.   
+0001a5a0: 2020 2020 206e 616d 6520 3d20 7365 6c66       name = self
+0001a5b0: 2e5f 7063 615f 7265 7375 6c74 735f 6361  ._pca_results_ca
+0001a5c0: 6368 655f 6e61 6d65 0a0a 2020 2020 2020  che_name..      
+0001a5d0: 2020 6465 6275 6728 226e 6f72 6d61 6c69    debug("normali
+0001a5e0: 7a65 2070 6172 616d 7320 666f 7220 636f  ze params for co
+0001a5f0: 6e73 6973 7465 6e74 2068 6173 6820 7661  nsistent hash va
+0001a600: 6c75 6522 290a 2020 2020 2020 2020 7361  lue").        sa
+0001a610: 6d70 6c65 5f73 6574 732c 2073 616d 706c  mple_sets, sampl
+0001a620: 655f 7175 6572 7920 3d20 7365 6c66 2e5f  e_query = self._
+0001a630: 7072 6570 5f73 616d 706c 655f 7365 6c65  prep_sample_sele
+0001a640: 6374 696f 6e5f 6361 6368 655f 7061 7261  ction_cache_para
+0001a650: 6d73 280a 2020 2020 2020 2020 2020 2020  ms(.            
+0001a660: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
+0001a670: 6c65 5f73 6574 732c 2073 616d 706c 655f  le_sets, sample_
+0001a680: 7175 6572 793d 7361 6d70 6c65 5f71 7565  query=sample_que
+0001a690: 7279 0a20 2020 2020 2020 2029 0a20 2020  ry.        ).   
+0001a6a0: 2020 2020 2072 6567 696f 6e20 3d20 7365       region = se
+0001a6b0: 6c66 2e5f 7072 6570 5f72 6567 696f 6e5f  lf._prep_region_
+0001a6c0: 6361 6368 655f 7061 7261 6d28 7265 6769  cache_param(regi
+0001a6d0: 6f6e 3d72 6567 696f 6e29 0a20 2020 2020  on=region).     
+0001a6e0: 2020 2073 6974 655f 6d61 736b 203d 2073     site_mask = s
+0001a6f0: 656c 662e 5f70 7265 705f 7369 7465 5f6d  elf._prep_site_m
+0001a700: 6173 6b5f 7061 7261 6d28 7369 7465 5f6d  ask_param(site_m
+0001a710: 6173 6b3d 7369 7465 5f6d 6173 6b29 0a20  ask=site_mask). 
+0001a720: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0001a730: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
+0001a740: 2020 7265 6769 6f6e 3d72 6567 696f 6e2c    region=region,
+0001a750: 0a20 2020 2020 2020 2020 2020 206e 5f73  .            n_s
+0001a760: 6e70 733d 6e5f 736e 7073 2c0a 2020 2020  nps=n_snps,.    
+0001a770: 2020 2020 2020 2020 7468 696e 5f6f 6666          thin_off
+0001a780: 7365 743d 7468 696e 5f6f 6666 7365 742c  set=thin_offset,
+0001a790: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+0001a7a0: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
+0001a7b0: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
+0001a7c0: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
+0001a7d0: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+0001a7e0: 2020 2020 2020 2020 2073 6974 655f 6d61           site_ma
+0001a7f0: 736b 3d73 6974 655f 6d61 736b 2c0a 2020  sk=site_mask,.  
+0001a800: 2020 2020 2020 2020 2020 6d69 6e5f 6d69            min_mi
+0001a810: 6e6f 725f 6163 3d6d 696e 5f6d 696e 6f72  nor_ac=min_minor
+0001a820: 5f61 632c 0a20 2020 2020 2020 2020 2020  _ac,.           
+0001a830: 206d 6178 5f6d 6973 7369 6e67 5f61 6e3d   max_missing_an=
+0001a840: 6d61 785f 6d69 7373 696e 675f 616e 2c0a  max_missing_an,.
+0001a850: 2020 2020 2020 2020 2020 2020 6e5f 636f              n_co
+0001a860: 6d70 6f6e 656e 7473 3d6e 5f63 6f6d 706f  mponents=n_compo
+0001a870: 6e65 6e74 732c 0a20 2020 2020 2020 2029  nents,.        )
+0001a880: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001a890: 2274 7279 2074 6f20 7265 7472 6965 7665  "try to retrieve
+0001a8a0: 2072 6573 756c 7473 2066 726f 6d20 7468   results from th
+0001a8b0: 6520 6361 6368 6522 290a 2020 2020 2020  e cache").      
+0001a8c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001a8d0: 2020 2072 6573 756c 7473 203d 2073 656c     results = sel
+0001a8e0: 662e 7265 7375 6c74 735f 6361 6368 655f  f.results_cache_
+0001a8f0: 6765 7428 6e61 6d65 3d6e 616d 652c 2070  get(name=name, p
+0001a900: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
+0001a910: 2020 2020 2020 2065 7863 6570 7420 4361         except Ca
+0001a920: 6368 654d 6973 733a 0a20 2020 2020 2020  cheMiss:.       
+0001a930: 2020 2020 2072 6573 756c 7473 203d 2073       results = s
+0001a940: 656c 662e 5f70 6361 282a 2a70 6172 616d  elf._pca(**param
+0001a950: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
+0001a960: 656c 662e 7265 7375 6c74 735f 6361 6368  elf.results_cach
+0001a970: 655f 7365 7428 6e61 6d65 3d6e 616d 652c  e_set(name=name,
+0001a980: 2070 6172 616d 733d 7061 7261 6d73 2c20   params=params, 
+0001a990: 7265 7375 6c74 733d 7265 7375 6c74 7329  results=results)
+0001a9a0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001a9b0: 2275 6e70 6163 6b20 7265 7375 6c74 7322  "unpack results"
+0001a9c0: 290a 2020 2020 2020 2020 636f 6f72 6473  ).        coords
+0001a9d0: 203d 2072 6573 756c 7473 5b22 636f 6f72   = results["coor
+0001a9e0: 6473 225d 0a20 2020 2020 2020 2065 7672  ds"].        evr
+0001a9f0: 203d 2072 6573 756c 7473 5b22 6576 7222   = results["evr"
+0001aa00: 5d0a 0a20 2020 2020 2020 2064 6562 7567  ]..        debug
+0001aa10: 2822 6164 6420 636f 6f72 6473 2074 6f20  ("add coords to 
+0001aa20: 7361 6d70 6c65 206d 6574 6164 6174 6120  sample metadata 
+0001aa30: 6461 7461 6672 616d 6522 290a 2020 2020  dataframe").    
+0001aa40: 2020 2020 6466 5f73 616d 706c 6573 203d      df_samples =
+0001aa50: 2073 656c 662e 7361 6d70 6c65 5f6d 6574   self.sample_met
+0001aa60: 6164 6174 6128 0a20 2020 2020 2020 2020  adata(.         
+0001aa70: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
+0001aa80: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
+0001aa90: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
+0001aaa0: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
+0001aab0: 792c 0a20 2020 2020 2020 2029 0a20 2020  y,.        ).   
+0001aac0: 2020 2020 2064 665f 636f 6f72 6473 203d       df_coords =
+0001aad0: 2070 642e 4461 7461 4672 616d 6528 0a20   pd.DataFrame(. 
+0001aae0: 2020 2020 2020 2020 2020 207b 6622 5043             {f"PC
+0001aaf0: 7b69 202b 2031 7d22 3a20 636f 6f72 6473  {i + 1}": coords
+0001ab00: 5b3a 2c20 695d 2066 6f72 2069 2069 6e20  [:, i] for i in 
+0001ab10: 7261 6e67 6528 6e5f 636f 6d70 6f6e 656e  range(n_componen
+0001ab20: 7473 297d 0a20 2020 2020 2020 2029 0a20  ts)}.        ). 
+0001ab30: 2020 2020 2020 2064 665f 7063 6120 3d20         df_pca = 
+0001ab40: 7064 2e63 6f6e 6361 7428 5b64 665f 7361  pd.concat([df_sa
+0001ab50: 6d70 6c65 732c 2064 665f 636f 6f72 6473  mples, df_coords
+0001ab60: 5d2c 2061 7869 733d 2263 6f6c 756d 6e73  ], axis="columns
+0001ab70: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+0001ab80: 726e 2064 665f 7063 612c 2065 7672 0a0a  rn df_pca, evr..
+0001ab90: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+0001aba0: 2020 7375 6d6d 6172 793d 2222 220a 2020    summary=""".  
+0001abb0: 2020 2020 2020 2020 2020 506c 6f74 2053            Plot S
+0001abc0: 4e50 7320 696e 2061 2067 6976 656e 2067  NPs in a given g
+0001abd0: 656e 6f6d 6520 7265 6769 6f6e 2e20 534e  enome region. SN
+0001abe0: 5073 2061 7265 2073 686f 776e 2061 7320  Ps are shown as 
+0001abf0: 7265 6374 616e 676c 6573 2c0a 2020 2020  rectangles,.    
+0001ac00: 2020 2020 2020 2020 7769 7468 2073 6567          with seg
+0001ac10: 7265 6761 7469 6e67 2061 6e64 206e 6f6e  regating and non
+0001ac20: 2d73 6567 7265 6761 7469 6e67 2053 4e50  -segregating SNP
+0001ac30: 7320 706f 7369 7469 6f6e 6564 206f 6e20  s positioned on 
+0001ac40: 6469 6666 6572 656e 7420 6c65 7665 6c73  different levels
+0001ac50: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
+0001ac60: 6420 636f 6c6f 7572 6564 2062 7920 7369  d coloured by si
+0001ac70: 7465 2066 696c 7465 722e 0a20 2020 2020  te filter..     
+0001ac80: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+0001ac90: 7061 7261 6d65 7465 7273 3d64 6963 7428  parameters=dict(
+0001aca0: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+0001acb0: 5f73 6e70 733d 224d 6178 696d 756d 206e  _snps="Maximum n
+0001acc0: 756d 6265 7220 6f66 2053 4e50 7320 746f  umber of SNPs to
+0001acd0: 2073 686f 772e 222c 0a20 2020 2020 2020   show.",.       
+0001ace0: 2029 2c0a 2020 2020 290a 2020 2020 6465   ),.    ).    de
+0001acf0: 6620 706c 6f74 5f73 6e70 7328 0a20 2020  f plot_snps(.   
+0001ad00: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0001ad10: 2020 2072 6567 696f 6e3a 2062 6173 655f     region: base_
+0001ad20: 7061 7261 6d73 2e72 6567 696f 6e2c 0a20  params.region,. 
+0001ad30: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+0001ad40: 7473 3a20 4f70 7469 6f6e 616c 5b62 6173  ts: Optional[bas
+0001ad50: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
+0001ad60: 7365 7473 5d20 3d20 4e6f 6e65 2c0a 2020  sets] = None,.  
+0001ad70: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
+0001ad80: 7279 3a20 4f70 7469 6f6e 616c 5b62 6173  ry: Optional[bas
+0001ad90: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
+0001ada0: 7175 6572 795d 203d 204e 6f6e 652c 0a20  query] = None,. 
+0001adb0: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+0001adc0: 3a20 6261 7365 5f70 6172 616d 732e 7369  : base_params.si
+0001add0: 7465 5f6d 6173 6b20 3d20 4445 4641 554c  te_mask = DEFAUL
+0001ade0: 542c 0a20 2020 2020 2020 2063 6f68 6f72  T,.        cohor
+0001adf0: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
+0001ae00: 5b62 6173 655f 7061 7261 6d73 2e63 6f68  [base_params.coh
+0001ae10: 6f72 745f 7369 7a65 5d20 3d20 4e6f 6e65  ort_size] = None
+0001ae20: 2c0a 2020 2020 2020 2020 7369 7a69 6e67  ,.        sizing
+0001ae30: 5f6d 6f64 653a 2067 706c 745f 7061 7261  _mode: gplt_para
+0001ae40: 6d73 2e73 697a 696e 675f 6d6f 6465 203d  ms.sizing_mode =
+0001ae50: 2067 706c 745f 7061 7261 6d73 2e73 697a   gplt_params.siz
+0001ae60: 696e 675f 6d6f 6465 5f64 6566 6175 6c74  ing_mode_default
+0001ae70: 2c0a 2020 2020 2020 2020 7769 6474 683a  ,.        width:
+0001ae80: 2067 706c 745f 7061 7261 6d73 2e77 6964   gplt_params.wid
+0001ae90: 7468 203d 2067 706c 745f 7061 7261 6d73  th = gplt_params
+0001aea0: 2e77 6964 7468 5f64 6566 6175 6c74 2c0a  .width_default,.
+0001aeb0: 2020 2020 2020 2020 7472 6163 6b5f 6865          track_he
+0001aec0: 6967 6874 3a20 6770 6c74 5f70 6172 616d  ight: gplt_param
+0001aed0: 732e 6865 6967 6874 203d 2038 302c 0a20  s.height = 80,. 
+0001aee0: 2020 2020 2020 2067 656e 6573 5f68 6569         genes_hei
+0001aef0: 6768 743a 2067 706c 745f 7061 7261 6d73  ght: gplt_params
+0001af00: 2e67 656e 6573 5f68 6569 6768 7420 3d20  .genes_height = 
+0001af10: 6770 6c74 5f70 6172 616d 732e 6765 6e65  gplt_params.gene
+0001af20: 735f 6865 6967 6874 5f64 6566 6175 6c74  s_height_default
+0001af30: 2c0a 2020 2020 2020 2020 6d61 785f 736e  ,.        max_sn
+0001af40: 7073 3a20 696e 7420 3d20 3230 305f 3030  ps: int = 200_00
+0001af50: 302c 0a20 2020 2020 2020 2073 686f 773a  0,.        show:
+0001af60: 2067 706c 745f 7061 7261 6d73 2e73 686f   gplt_params.sho
+0001af70: 7720 3d20 5472 7565 2c0a 2020 2020 2920  w = True,.    ) 
+0001af80: 2d3e 2067 706c 745f 7061 7261 6d73 2e66  -> gplt_params.f
+0001af90: 6967 7572 653a 0a20 2020 2020 2020 2064  igure:.        d
+0001afa0: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
+0001afb0: 2e64 6562 7567 0a0a 2020 2020 2020 2020  .debug..        
+0001afc0: 6465 6275 6728 2270 6c6f 7420 534e 5073  debug("plot SNPs
+0001afd0: 2074 7261 636b 2229 0a20 2020 2020 2020   track").       
+0001afe0: 2066 6967 3120 3d20 7365 6c66 2e70 6c6f   fig1 = self.plo
+0001aff0: 745f 736e 7073 5f74 7261 636b 280a 2020  t_snps_track(.  
+0001b000: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0001b010: 3d72 6567 696f 6e2c 0a20 2020 2020 2020  =region,.       
+0001b020: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
+0001b030: 3d73 616d 706c 655f 7365 7473 2c0a 2020  =sample_sets,.  
+0001b040: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+0001b050: 5f71 7565 7279 3d73 616d 706c 655f 7175  _query=sample_qu
+0001b060: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
+0001b070: 2073 6974 655f 6d61 736b 3d73 6974 655f   site_mask=site_
+0001b080: 6d61 736b 2c0a 2020 2020 2020 2020 2020  mask,.          
+0001b090: 2020 636f 686f 7274 5f73 697a 653d 636f    cohort_size=co
+0001b0a0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+0001b0b0: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+0001b0c0: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
+0001b0d0: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+0001b0e0: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
+0001b0f0: 2020 2020 2068 6569 6768 743d 7472 6163       height=trac
+0001b100: 6b5f 6865 6967 6874 2c0a 2020 2020 2020  k_height,.      
+0001b110: 2020 2020 2020 6d61 785f 736e 7073 3d6d        max_snps=m
+0001b120: 6178 5f73 6e70 732c 0a20 2020 2020 2020  ax_snps,.       
+0001b130: 2020 2020 2073 686f 773d 4661 6c73 652c       show=False,
+0001b140: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001b150: 2020 2066 6967 312e 7861 7869 732e 7669     fig1.xaxis.vi
+0001b160: 7369 626c 6520 3d20 4661 6c73 650a 0a20  sible = False.. 
+0001b170: 2020 2020 2020 2064 6562 7567 2822 706c         debug("pl
+0001b180: 6f74 2067 656e 6573 2074 7261 636b 2229  ot genes track")
+0001b190: 0a20 2020 2020 2020 2066 6967 3220 3d20  .        fig2 = 
+0001b1a0: 7365 6c66 2e70 6c6f 745f 6765 6e65 7328  self.plot_genes(
+0001b1b0: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+0001b1c0: 696f 6e3d 7265 6769 6f6e 2c0a 2020 2020  ion=region,.    
+0001b1d0: 2020 2020 2020 2020 7369 7a69 6e67 5f6d          sizing_m
+0001b1e0: 6f64 653d 7369 7a69 6e67 5f6d 6f64 652c  ode=sizing_mode,
+0001b1f0: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+0001b200: 7468 3d77 6964 7468 2c0a 2020 2020 2020  th=width,.      
+0001b210: 2020 2020 2020 6865 6967 6874 3d67 656e        height=gen
+0001b220: 6573 5f68 6569 6768 742c 0a20 2020 2020  es_height,.     
+0001b230: 2020 2020 2020 2078 5f72 616e 6765 3d66         x_range=f
+0001b240: 6967 312e 785f 7261 6e67 652c 0a20 2020  ig1.x_range,.   
+0001b250: 2020 2020 2020 2020 2073 686f 773d 4661           show=Fa
+0001b260: 6c73 652c 0a20 2020 2020 2020 2029 0a0a  lse,.        )..
+0001b270: 2020 2020 2020 2020 6669 6720 3d20 626f          fig = bo
+0001b280: 6b65 682e 6c61 796f 7574 732e 6772 6964  keh.layouts.grid
+0001b290: 706c 6f74 280a 2020 2020 2020 2020 2020  plot(.          
+0001b2a0: 2020 5b66 6967 312c 2066 6967 325d 2c0a    [fig1, fig2],.
+0001b2b0: 2020 2020 2020 2020 2020 2020 6e63 6f6c              ncol
+0001b2c0: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
+0001b2d0: 2074 6f6f 6c62 6172 5f6c 6f63 6174 696f   toolbar_locatio
+0001b2e0: 6e3d 2261 626f 7665 222c 0a20 2020 2020  n="above",.     
+0001b2f0: 2020 2020 2020 206d 6572 6765 5f74 6f6f         merge_too
+0001b300: 6c73 3d54 7275 652c 0a20 2020 2020 2020  ls=True,.       
+0001b310: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
+0001b320: 3d73 697a 696e 675f 6d6f 6465 2c0a 2020  =sizing_mode,.  
+0001b330: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0001b340: 2069 6620 7368 6f77 3a0a 2020 2020 2020   if show:.      
+0001b350: 2020 2020 2020 626f 6b65 682e 706c 6f74        bokeh.plot
+0001b360: 7469 6e67 2e73 686f 7728 6669 6729 0a0a  ting.show(fig)..
+0001b370: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+0001b380: 6967 0a0a 2020 2020 4064 6f63 280a 2020  ig..    @doc(.  
+0001b390: 2020 2020 2020 7375 6d6d 6172 793d 224f        summary="O
+0001b3a0: 7065 6e20 7369 7465 2061 6e6e 6f74 6174  pen site annotat
+0001b3b0: 696f 6e73 207a 6172 722e 222c 0a20 2020  ions zarr.",.   
+0001b3c0: 2020 2020 2072 6574 7572 6e73 3d22 5a61       returns="Za
+0001b3d0: 7272 2068 6965 7261 7263 6879 2e22 2c0a  rr hierarchy.",.
+0001b3e0: 2020 2020 290a 2020 2020 6465 6620 6f70      ).    def op
+0001b3f0: 656e 5f73 6974 655f 616e 6e6f 7461 7469  en_site_annotati
+0001b400: 6f6e 7328 7365 6c66 2920 2d3e 207a 6172  ons(self) -> zar
+0001b410: 722e 6869 6572 6172 6368 792e 4772 6f75  r.hierarchy.Grou
+0001b420: 703a 0a20 2020 2020 2020 2069 6620 7365  p:.        if se
+0001b430: 6c66 2e5f 6361 6368 655f 7369 7465 5f61  lf._cache_site_a
+0001b440: 6e6e 6f74 6174 696f 6e73 2069 7320 4e6f  nnotations is No
+0001b450: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001b460: 7061 7468 203d 2066 227b 7365 6c66 2e5f  path = f"{self._
+0001b470: 6261 7365 5f70 6174 687d 2f7b 7365 6c66  base_path}/{self
+0001b480: 2e5f 7369 7465 5f61 6e6e 6f74 6174 696f  ._site_annotatio
+0001b490: 6e73 5f7a 6172 725f 7061 7468 7d22 0a20  ns_zarr_path}". 
+0001b4a0: 2020 2020 2020 2020 2020 2073 746f 7265             store
+0001b4b0: 203d 2069 6e69 745f 7a61 7272 5f73 746f   = init_zarr_sto
+0001b4c0: 7265 2866 733d 7365 6c66 2e5f 6673 2c20  re(fs=self._fs, 
+0001b4d0: 7061 7468 3d70 6174 6829 0a20 2020 2020  path=path).     
+0001b4e0: 2020 2020 2020 2073 656c 662e 5f63 6163         self._cac
+0001b4f0: 6865 5f73 6974 655f 616e 6e6f 7461 7469  he_site_annotati
+0001b500: 6f6e 7320 3d20 7a61 7272 2e6f 7065 6e5f  ons = zarr.open_
+0001b510: 636f 6e73 6f6c 6964 6174 6564 2873 746f  consolidated(sto
+0001b520: 7265 3d73 746f 7265 290a 2020 2020 2020  re=store).      
+0001b530: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+0001b540: 6163 6865 5f73 6974 655f 616e 6e6f 7461  ache_site_annota
+0001b550: 7469 6f6e 730a 0a20 2020 2040 646f 6328  tions..    @doc(
+0001b560: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
+0001b570: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
+0001b580: 2050 6c6f 7420 534e 5073 2069 6e20 6120   Plot SNPs in a 
+0001b590: 6769 7665 6e20 6765 6e6f 6d65 2072 6567  given genome reg
+0001b5a0: 696f 6e2e 2053 4e50 7320 6172 6520 7368  ion. SNPs are sh
+0001b5b0: 6f77 6e20 6173 2072 6563 7461 6e67 6c65  own as rectangle
+0001b5c0: 732c 0a20 2020 2020 2020 2020 2020 2077  s,.            w
+0001b5d0: 6974 6820 7365 6772 6567 6174 696e 6720  ith segregating 
+0001b5e0: 616e 6420 6e6f 6e2d 7365 6772 6567 6174  and non-segregat
+0001b5f0: 696e 6720 534e 5073 2070 6f73 6974 696f  ing SNPs positio
+0001b600: 6e65 6420 6f6e 2064 6966 6665 7265 6e74  ned on different
+0001b610: 206c 6576 656c 732c 0a20 2020 2020 2020   levels,.       
+0001b620: 2020 2020 2061 6e64 2063 6f6c 6f75 7265       and coloure
+0001b630: 6420 6279 2073 6974 6520 6669 6c74 6572  d by site filter
+0001b640: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
+0001b650: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
+0001b660: 733d 6469 6374 280a 2020 2020 2020 2020  s=dict(.        
+0001b670: 2020 2020 6d61 785f 736e 7073 3d22 4d61      max_snps="Ma
+0001b680: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
+0001b690: 534e 5073 2074 6f20 7368 6f77 2e22 2c0a  SNPs to show.",.
+0001b6a0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+0001b6b0: 0a20 2020 2064 6566 2070 6c6f 745f 736e  .    def plot_sn
+0001b6c0: 7073 5f74 7261 636b 280a 2020 2020 2020  ps_track(.      
+0001b6d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0001b6e0: 7265 6769 6f6e 3a20 6261 7365 5f70 6172  region: base_par
+0001b6f0: 616d 732e 7265 6769 6f6e 2c0a 2020 2020  ams.region,.    
+0001b700: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
+0001b710: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
+0001b720: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
+0001b730: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+0001b740: 2020 2073 616d 706c 655f 7175 6572 793a     sample_query:
+0001b750: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
+0001b760: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
+0001b770: 7279 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ry] = None,.    
+0001b780: 2020 2020 7369 7465 5f6d 6173 6b3a 2062      site_mask: b
+0001b790: 6173 655f 7061 7261 6d73 2e73 6974 655f  ase_params.site_
+0001b7a0: 6d61 736b 203d 2044 4546 4155 4c54 2c0a  mask = DEFAULT,.
+0001b7b0: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
+0001b7c0: 697a 653a 204f 7074 696f 6e61 6c5b 6261  ize: Optional[ba
+0001b7d0: 7365 5f70 6172 616d 732e 636f 686f 7274  se_params.cohort
+0001b7e0: 5f73 697a 655d 203d 204e 6f6e 652c 0a20  _size] = None,. 
+0001b7f0: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+0001b800: 6465 3a20 6770 6c74 5f70 6172 616d 732e  de: gplt_params.
+0001b810: 7369 7a69 6e67 5f6d 6f64 6520 3d20 6770  sizing_mode = gp
+0001b820: 6c74 5f70 6172 616d 732e 7369 7a69 6e67  lt_params.sizing
+0001b830: 5f6d 6f64 655f 6465 6661 756c 742c 0a20  _mode_default,. 
+0001b840: 2020 2020 2020 2077 6964 7468 3a20 6770         width: gp
+0001b850: 6c74 5f70 6172 616d 732e 7769 6474 6820  lt_params.width 
+0001b860: 3d20 6770 6c74 5f70 6172 616d 732e 7769  = gplt_params.wi
+0001b870: 6474 685f 6465 6661 756c 742c 0a20 2020  dth_default,.   
+0001b880: 2020 2020 2068 6569 6768 743a 2067 706c       height: gpl
+0001b890: 745f 7061 7261 6d73 2e68 6569 6768 7420  t_params.height 
+0001b8a0: 3d20 3132 302c 0a20 2020 2020 2020 206d  = 120,.        m
+0001b8b0: 6178 5f73 6e70 733a 2069 6e74 203d 2032  ax_snps: int = 2
+0001b8c0: 3030 5f30 3030 2c0a 2020 2020 2020 2020  00_000,.        
+0001b8d0: 785f 7261 6e67 653a 204f 7074 696f 6e61  x_range: Optiona
+0001b8e0: 6c5b 6770 6c74 5f70 6172 616d 732e 785f  l[gplt_params.x_
+0001b8f0: 7261 6e67 655d 203d 204e 6f6e 652c 0a20  range] = None,. 
+0001b900: 2020 2020 2020 2073 686f 773a 2067 706c         show: gpl
+0001b910: 745f 7061 7261 6d73 2e73 686f 7720 3d20  t_params.show = 
+0001b920: 5472 7565 2c0a 2020 2020 2920 2d3e 2067  True,.    ) -> g
+0001b930: 706c 745f 7061 7261 6d73 2e66 6967 7572  plt_params.figur
+0001b940: 653a 0a20 2020 2020 2020 2064 6562 7567  e:.        debug
+0001b950: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
+0001b960: 7567 0a0a 2020 2020 2020 2020 7369 7465  ug..        site
+0001b970: 5f6d 6173 6b20 3d20 7365 6c66 2e5f 7072  _mask = self._pr
+0001b980: 6570 5f73 6974 655f 6d61 736b 5f70 6172  ep_site_mask_par
+0001b990: 616d 2873 6974 655f 6d61 736b 3d73 6974  am(site_mask=sit
+0001b9a0: 655f 6d61 736b 290a 0a20 2020 2020 2020  e_mask)..       
+0001b9b0: 2064 6562 7567 2822 7265 736f 6c76 6520   debug("resolve 
+0001b9c0: 616e 6420 6368 6563 6b20 7265 6769 6f6e  and check region
+0001b9d0: 2229 0a20 2020 2020 2020 2072 6573 6f6c  ").        resol
+0001b9e0: 7665 645f 7265 6769 6f6e 203d 2073 656c  ved_region = sel
+0001b9f0: 662e 7265 736f 6c76 655f 7265 6769 6f6e  f.resolve_region
+0001ba00: 2872 6567 696f 6e29 0a20 2020 2020 2020  (region).       
+0001ba10: 2064 656c 2072 6567 696f 6e0a 0a20 2020   del region..   
+0001ba20: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+0001ba30: 2020 2020 2020 2872 6573 6f6c 7665 645f        (resolved_
+0001ba40: 7265 6769 6f6e 2e73 7461 7274 2069 7320  region.start is 
+0001ba50: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+0001ba60: 2020 6f72 2028 7265 736f 6c76 6564 5f72    or (resolved_r
+0001ba70: 6567 696f 6e2e 656e 6420 6973 204e 6f6e  egion.end is Non
+0001ba80: 6529 0a20 2020 2020 2020 2020 2020 206f  e).            o
+0001ba90: 7220 2828 7265 736f 6c76 6564 5f72 6567  r ((resolved_reg
+0001baa0: 696f 6e2e 656e 6420 2d20 7265 736f 6c76  ion.end - resolv
+0001bab0: 6564 5f72 6567 696f 6e2e 7374 6172 7429  ed_region.start)
+0001bac0: 203e 206d 6178 5f73 6e70 7329 0a20 2020   > max_snps).   
+0001bad0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0001bae0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001baf0: 7272 6f72 2822 5265 6769 6f6e 2069 7320  rror("Region is 
+0001bb00: 746f 6f20 6c61 7267 652c 2070 6c65 6173  too large, pleas
+0001bb10: 6520 7072 6f76 6964 6520 6120 736d 616c  e provide a smal
+0001bb20: 6c65 7220 7265 6769 6f6e 2e22 290a 0a20  ler region.").. 
+0001bb30: 2020 2020 2020 2064 6562 7567 2822 636f         debug("co
+0001bb40: 6d70 7574 6520 616c 6c65 6c65 2063 6f75  mpute allele cou
+0001bb50: 6e74 7322 290a 2020 2020 2020 2020 6163  nts").        ac
+0001bb60: 203d 2061 6c6c 656c 2e41 6c6c 656c 6543   = allel.AlleleC
+0001bb70: 6f75 6e74 7341 7272 6179 280a 2020 2020  ountsArray(.    
+0001bb80: 2020 2020 2020 2020 7365 6c66 2e73 6e70          self.snp
+0001bb90: 5f61 6c6c 656c 655f 636f 756e 7473 280a  _allele_counts(.
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 7265 6769 6f6e 3d72 6573 6f6c 7665 645f  region=resolved_
+0001bbc0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+0001bbd0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0001bbe0: 6574 733d 7361 6d70 6c65 5f73 6574 732c  ets=sample_sets,
+0001bbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bc00: 2073 616d 706c 655f 7175 6572 793d 7361   sample_query=sa
+0001bc10: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
+0001bc20: 2020 2020 2020 2020 2020 2020 7369 7465              site
+0001bc30: 5f6d 6173 6b3d 4e6f 6e65 2c0a 2020 2020  _mask=None,.    
+0001bc40: 2020 2020 2020 2020 2020 2020 636f 686f              coho
+0001bc50: 7274 5f73 697a 653d 636f 686f 7274 5f73  rt_size=cohort_s
+0001bc60: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0001bc70: 2029 0a20 2020 2020 2020 2029 0a20 2020   ).        ).   
+0001bc80: 2020 2020 2061 6e20 3d20 6163 2e73 756d       an = ac.sum
+0001bc90: 2861 7869 733d 3129 0a20 2020 2020 2020  (axis=1).       
+0001bca0: 2069 735f 7365 6720 3d20 6163 2e69 735f   is_seg = ac.is_
+0001bcb0: 7365 6772 6567 6174 696e 6728 290a 2020  segregating().  
+0001bcc0: 2020 2020 2020 6973 5f76 6172 203d 2061        is_var = a
+0001bcd0: 632e 6973 5f76 6172 6961 6e74 2829 0a20  c.is_variant(). 
+0001bce0: 2020 2020 2020 2061 6c6c 656c 6973 6d20         allelism 
+0001bcf0: 3d20 6163 2e61 6c6c 656c 6973 6d28 290a  = ac.allelism().
+0001bd00: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0001bd10: 6f62 7461 696e 2053 4e50 2076 6172 6961  obtain SNP varia
+0001bd20: 6e74 7320 6461 7461 2229 0a20 2020 2020  nts data").     
+0001bd30: 2020 2064 735f 7369 7465 7320 3d20 7365     ds_sites = se
+0001bd40: 6c66 2e73 6e70 5f76 6172 6961 6e74 7328  lf.snp_variants(
+0001bd50: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+0001bd60: 696f 6e3d 7265 736f 6c76 6564 5f72 6567  ion=resolved_reg
+0001bd70: 696f 6e2c 0a20 2020 2020 2020 2029 2e63  ion,.        ).c
+0001bd80: 6f6d 7075 7465 2829 0a0a 2020 2020 2020  ompute()..      
+0001bd90: 2020 6465 6275 6728 2262 7569 6c64 2061    debug("build a
+0001bda0: 2064 6174 6166 7261 6d65 2229 0a20 2020   dataframe").   
+0001bdb0: 2020 2020 2070 6f73 203d 2064 735f 7369       pos = ds_si
+0001bdc0: 7465 735b 2276 6172 6961 6e74 5f70 6f73  tes["variant_pos
+0001bdd0: 6974 696f 6e22 5d2e 7661 6c75 6573 0a20  ition"].values. 
+0001bde0: 2020 2020 2020 2061 6c6c 656c 6573 203d         alleles =
+0001bdf0: 2064 735f 7369 7465 735b 2276 6172 6961   ds_sites["varia
+0001be00: 6e74 5f61 6c6c 656c 6522 5d2e 7661 6c75  nt_allele"].valu
+0001be10: 6573 2e61 7374 7970 6528 2255 2229 0a20  es.astype("U"). 
+0001be20: 2020 2020 2020 2063 6f6c 7320 3d20 7b0a         cols = {.
+0001be30: 2020 2020 2020 2020 2020 2020 2270 6f73              "pos
+0001be40: 223a 2070 6f73 2c0a 2020 2020 2020 2020  ": pos,.        
+0001be50: 2020 2020 2261 6c6c 656c 655f 3022 3a20      "allele_0": 
+0001be60: 616c 6c65 6c65 735b 3a2c 2030 5d2c 0a20  alleles[:, 0],. 
+0001be70: 2020 2020 2020 2020 2020 2022 616c 6c65             "alle
+0001be80: 6c65 5f31 223a 2061 6c6c 656c 6573 5b3a  le_1": alleles[:
+0001be90: 2c20 315d 2c0a 2020 2020 2020 2020 2020  , 1],.          
+0001bea0: 2020 2261 6c6c 656c 655f 3222 3a20 616c    "allele_2": al
+0001beb0: 6c65 6c65 735b 3a2c 2032 5d2c 0a20 2020  leles[:, 2],.   
+0001bec0: 2020 2020 2020 2020 2022 616c 6c65 6c65           "allele
+0001bed0: 5f33 223a 2061 6c6c 656c 6573 5b3a 2c20  _3": alleles[:, 
+0001bee0: 335d 2c0a 2020 2020 2020 2020 2020 2020  3],.            
+0001bef0: 2261 635f 3022 3a20 6163 5b3a 2c20 305d  "ac_0": ac[:, 0]
+0001bf00: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
+0001bf10: 635f 3122 3a20 6163 5b3a 2c20 315d 2c0a  c_1": ac[:, 1],.
+0001bf20: 2020 2020 2020 2020 2020 2020 2261 635f              "ac_
+0001bf30: 3222 3a20 6163 5b3a 2c20 325d 2c0a 2020  2": ac[:, 2],.  
+0001bf40: 2020 2020 2020 2020 2020 2261 635f 3322            "ac_3"
+0001bf50: 3a20 6163 5b3a 2c20 335d 2c0a 2020 2020  : ac[:, 3],.    
+0001bf60: 2020 2020 2020 2020 2261 6e22 3a20 616e          "an": an
+0001bf70: 2c0a 2020 2020 2020 2020 2020 2020 2269  ,.            "i
+0001bf80: 735f 7365 6722 3a20 6973 5f73 6567 2c0a  s_seg": is_seg,.
+0001bf90: 2020 2020 2020 2020 2020 2020 2269 735f              "is_
+0001bfa0: 7661 7222 3a20 6973 5f76 6172 2c0a 2020  var": is_var,.  
+0001bfb0: 2020 2020 2020 2020 2020 2261 6c6c 656c            "allel
+0001bfc0: 6973 6d22 3a20 616c 6c65 6c69 736d 2c0a  ism": allelism,.
+0001bfd0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+0001bfe0: 2020 2066 6f72 2073 6974 655f 6d61 736b     for site_mask
+0001bff0: 5f69 6420 696e 2073 656c 662e 7369 7465  _id in self.site
+0001c000: 5f6d 6173 6b5f 6964 733a 0a20 2020 2020  _mask_ids:.     
+0001c010: 2020 2020 2020 2063 6f6c 735b 6622 7061         cols[f"pa
+0001c020: 7373 5f7b 7369 7465 5f6d 6173 6b5f 6964  ss_{site_mask_id
+0001c030: 7d22 5d20 3d20 6473 5f73 6974 6573 5b0a  }"] = ds_sites[.
+0001c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c050: 6622 7661 7269 616e 745f 6669 6c74 6572  f"variant_filter
+0001c060: 5f70 6173 735f 7b73 6974 655f 6d61 736b  _pass_{site_mask
+0001c070: 5f69 647d 220a 2020 2020 2020 2020 2020  _id}".          
+0001c080: 2020 5d2e 7661 6c75 6573 0a0a 2020 2020    ].values..    
+0001c090: 2020 2020 6461 7461 203d 2070 642e 4461      data = pd.Da
+0001c0a0: 7461 4672 616d 6528 636f 6c73 290a 0a20  taFrame(cols).. 
+0001c0b0: 2020 2020 2020 2064 6562 7567 2822 6372         debug("cr
+0001c0c0: 6561 7465 2066 6967 7572 6522 290a 2020  eate figure").  
+0001c0d0: 2020 2020 2020 7877 6865 656c 5f7a 6f6f        xwheel_zoo
+0001c0e0: 6d20 3d20 626f 6b65 682e 6d6f 6465 6c73  m = bokeh.models
+0001c0f0: 2e57 6865 656c 5a6f 6f6d 546f 6f6c 280a  .WheelZoomTool(.
+0001c100: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
+0001c110: 6e73 696f 6e73 3d22 7769 6474 6822 2c20  nsions="width", 
+0001c120: 6d61 696e 7461 696e 5f66 6f63 7573 3d46  maintain_focus=F
+0001c130: 616c 7365 0a20 2020 2020 2020 2029 0a20  alse.        ). 
+0001c140: 2020 2020 2020 2070 6f73 203d 2064 6174         pos = dat
+0001c150: 615b 2270 6f73 225d 2e76 616c 7565 730a  a["pos"].values.
+0001c160: 2020 2020 2020 2020 785f 6d69 6e20 3d20          x_min = 
+0001c170: 706f 735b 305d 0a20 2020 2020 2020 2078  pos[0].        x
+0001c180: 5f6d 6178 203d 2070 6f73 5b2d 315d 0a20  _max = pos[-1]. 
+0001c190: 2020 2020 2020 2069 6620 785f 7261 6e67         if x_rang
+0001c1a0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0001c1b0: 2020 2020 2020 2078 5f72 616e 6765 203d         x_range =
+0001c1c0: 2062 6f6b 6568 2e6d 6f64 656c 732e 5261   bokeh.models.Ra
+0001c1d0: 6e67 6531 6428 785f 6d69 6e2c 2078 5f6d  nge1d(x_min, x_m
+0001c1e0: 6178 2c20 626f 756e 6473 3d22 6175 746f  ax, bounds="auto
+0001c1f0: 2229 0a0a 2020 2020 2020 2020 746f 6f6c  ")..        tool
+0001c200: 7469 7073 203d 205b 0a20 2020 2020 2020  tips = [.       
+0001c210: 2020 2020 2028 2250 6f73 6974 696f 6e22       ("Position"
+0001c220: 2c20 2224 787b 302c 307d 2229 2c0a 2020  , "$x{0,0}"),.  
+0001c230: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+0001c240: 2020 2020 2020 2020 2020 2020 2241 6c6c              "All
+0001c250: 656c 6573 222c 0a20 2020 2020 2020 2020  eles",.         
+0001c260: 2020 2020 2020 2022 4061 6c6c 656c 655f         "@allele_
+0001c270: 3020 2840 6163 5f30 292c 2040 616c 6c65  0 (@ac_0), @alle
+0001c280: 6c65 5f31 2028 4061 635f 3129 2c20 4061  le_1 (@ac_1), @a
+0001c290: 6c6c 656c 655f 3220 2840 6163 5f32 292c  llele_2 (@ac_2),
+0001c2a0: 2040 616c 6c65 6c65 5f33 2028 4061 635f   @allele_3 (@ac_
+0001c2b0: 3329 222c 0a20 2020 2020 2020 2020 2020  3)",.           
+0001c2c0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0001c2d0: 2822 4e6f 2e20 616c 6c65 6c65 7322 2c20  ("No. alleles", 
+0001c2e0: 2240 616c 6c65 6c69 736d 2229 2c0a 2020  "@allelism"),.  
+0001c2f0: 2020 2020 2020 2020 2020 2822 416c 6c65            ("Alle
+0001c300: 6c65 2063 616c 6c73 222c 2022 4061 6e22  le calls", "@an"
+0001c310: 292c 0a20 2020 2020 2020 205d 0a0a 2020  ),.        ]..  
+0001c320: 2020 2020 2020 666f 7220 7369 7465 5f6d        for site_m
+0001c330: 6173 6b5f 6964 2069 6e20 7365 6c66 2e73  ask_id in self.s
+0001c340: 6974 655f 6d61 736b 5f69 6473 3a0a 2020  ite_mask_ids:.  
+0001c350: 2020 2020 2020 2020 2020 746f 6f6c 7469            toolti
+0001c360: 7073 2e61 7070 656e 6428 2866 2250 6173  ps.append((f"Pas
+0001c370: 7320 7b73 6974 655f 6d61 736b 5f69 647d  s {site_mask_id}
+0001c380: 222c 2066 2240 7061 7373 5f7b 7369 7465  ", f"@pass_{site
+0001c390: 5f6d 6173 6b5f 6964 7d22 2929 0a0a 2020  _mask_id}"))..  
+0001c3a0: 2020 2020 2020 6669 6720 3d20 626f 6b65        fig = boke
+0001c3b0: 682e 706c 6f74 7469 6e67 2e66 6967 7572  h.plotting.figur
+0001c3c0: 6528 0a20 2020 2020 2020 2020 2020 2074  e(.            t
+0001c3d0: 6974 6c65 3d22 534e 5073 222c 0a20 2020  itle="SNPs",.   
+0001c3e0: 2020 2020 2020 2020 2074 6f6f 6c73 3d5b           tools=[
+0001c3f0: 2278 7061 6e22 2c20 2278 7a6f 6f6d 5f69  "xpan", "xzoom_i
+0001c400: 6e22 2c20 2278 7a6f 6f6d 5f6f 7574 222c  n", "xzoom_out",
+0001c410: 2078 7768 6565 6c5f 7a6f 6f6d 2c20 2272   xwheel_zoom, "r
+0001c420: 6573 6574 225d 2c0a 2020 2020 2020 2020  eset"],.        
+0001c430: 2020 2020 6163 7469 7665 5f73 6372 6f6c      active_scrol
+0001c440: 6c3d 7877 6865 656c 5f7a 6f6f 6d2c 0a20  l=xwheel_zoom,. 
+0001c450: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+0001c460: 655f 6472 6167 3d22 7870 616e 222c 0a20  e_drag="xpan",. 
+0001c470: 2020 2020 2020 2020 2020 2073 697a 696e             sizin
+0001c480: 675f 6d6f 6465 3d73 697a 696e 675f 6d6f  g_mode=sizing_mo
+0001c490: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+0001c4a0: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
+0001c4b0: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+0001c4c0: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
+0001c4d0: 2020 2020 746f 6f6c 6261 725f 6c6f 6361      toolbar_loca
+0001c4e0: 7469 6f6e 3d22 6162 6f76 6522 2c0a 2020  tion="above",.  
+0001c4f0: 2020 2020 2020 2020 2020 785f 7261 6e67            x_rang
+0001c500: 653d 785f 7261 6e67 652c 0a20 2020 2020  e=x_range,.     
+0001c510: 2020 2020 2020 2079 5f72 616e 6765 3d28         y_range=(
+0001c520: 302e 352c 2032 2e35 292c 0a20 2020 2020  0.5, 2.5),.     
+0001c530: 2020 2020 2020 2074 6f6f 6c74 6970 733d         tooltips=
+0001c540: 746f 6f6c 7469 7073 2c0a 2020 2020 2020  tooltips,.      
+0001c550: 2020 290a 2020 2020 2020 2020 686f 7665    ).        hove
+0001c560: 725f 746f 6f6c 203d 2066 6967 2e73 656c  r_tool = fig.sel
+0001c570: 6563 7428 7479 7065 3d62 6f6b 6568 2e6d  ect(type=bokeh.m
+0001c580: 6f64 656c 732e 486f 7665 7254 6f6f 6c29  odels.HoverTool)
+0001c590: 0a20 2020 2020 2020 2068 6f76 6572 5f74  .        hover_t
+0001c5a0: 6f6f 6c2e 6e61 6d65 7320 3d20 5b22 736e  ool.names = ["sn
+0001c5b0: 7073 225d 0a0a 2020 2020 2020 2020 6465  ps"]..        de
+0001c5c0: 6275 6728 2270 6c6f 7420 6761 7073 2069  bug("plot gaps i
+0001c5d0: 6e20 7468 6520 7265 6665 7265 6e63 6520  n the reference 
+0001c5e0: 6765 6e6f 6d65 2229 0a20 2020 2020 2020  genome").       
+0001c5f0: 2073 6571 203d 2073 656c 662e 6765 6e6f   seq = self.geno
+0001c600: 6d65 5f73 6571 7565 6e63 6528 7265 6769  me_sequence(regi
+0001c610: 6f6e 3d72 6573 6f6c 7665 645f 7265 6769  on=resolved_regi
+0001c620: 6f6e 2e63 6f6e 7469 6729 2e63 6f6d 7075  on.contig).compu
+0001c630: 7465 2829 0a20 2020 2020 2020 2069 735f  te().        is_
+0001c640: 6e20 3d20 2873 6571 203d 3d20 6222 4e22  n = (seq == b"N"
+0001c650: 2920 7c20 2873 6571 203d 3d20 6222 6e22  ) | (seq == b"n"
+0001c660: 290a 2020 2020 2020 2020 6c6f 635f 6e5f  ).        loc_n_
+0001c670: 7374 6172 7420 3d20 7e69 735f 6e5b 3a2d  start = ~is_n[:-
+0001c680: 315d 2026 2069 735f 6e5b 313a 5d0a 2020  1] & is_n[1:].  
+0001c690: 2020 2020 2020 6c6f 635f 6e5f 7374 6f70        loc_n_stop
+0001c6a0: 203d 2069 735f 6e5b 3a2d 315d 2026 207e   = is_n[:-1] & ~
+0001c6b0: 6973 5f6e 5b31 3a5d 0a20 2020 2020 2020  is_n[1:].       
+0001c6c0: 206e 5f73 7461 7274 7320 3d20 6e70 2e6e   n_starts = np.n
+0001c6d0: 6f6e 7a65 726f 286c 6f63 5f6e 5f73 7461  onzero(loc_n_sta
+0001c6e0: 7274 295b 305d 0a20 2020 2020 2020 206e  rt)[0].        n
+0001c6f0: 5f73 746f 7073 203d 206e 702e 6e6f 6e7a  _stops = np.nonz
+0001c700: 6572 6f28 6c6f 635f 6e5f 7374 6f70 295b  ero(loc_n_stop)[
+0001c710: 305d 0a20 2020 2020 2020 2064 665f 6e5f  0].        df_n_
+0001c720: 7275 6e73 203d 2070 642e 4461 7461 4672  runs = pd.DataFr
+0001c730: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
+0001c740: 207b 226c 6566 7422 3a20 6e5f 7374 6172   {"left": n_star
+0001c750: 7473 202b 2031 2e36 2c20 2272 6967 6874  ts + 1.6, "right
+0001c760: 223a 206e 5f73 746f 7073 202b 2031 2e34  ": n_stops + 1.4
+0001c770: 2c20 2274 6f70 223a 2032 2e35 2c20 2262  , "top": 2.5, "b
+0001c780: 6f74 746f 6d22 3a20 302e 357d 0a20 2020  ottom": 0.5}.   
+0001c790: 2020 2020 2029 0a20 2020 2020 2020 2066       ).        f
+0001c7a0: 6967 2e71 7561 6428 0a20 2020 2020 2020  ig.quad(.       
+0001c7b0: 2020 2020 2074 6f70 3d22 746f 7022 2c0a       top="top",.
+0001c7c0: 2020 2020 2020 2020 2020 2020 626f 7474              bott
+0001c7d0: 6f6d 3d22 626f 7474 6f6d 222c 0a20 2020  om="bottom",.   
+0001c7e0: 2020 2020 2020 2020 206c 6566 743d 226c           left="l
+0001c7f0: 6566 7422 2c0a 2020 2020 2020 2020 2020  eft",.          
+0001c800: 2020 7269 6768 743d 2272 6967 6874 222c    right="right",
+0001c810: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+0001c820: 6f72 3d22 2363 6363 6363 6322 2c0a 2020  or="#cccccc",.  
+0001c830: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0001c840: 3d64 665f 6e5f 7275 6e73 2c0a 2020 2020  =df_n_runs,.    
+0001c850: 2020 2020 2020 2020 6e61 6d65 3d22 6761          name="ga
+0001c860: 7073 222c 0a20 2020 2020 2020 2029 0a0a  ps",.        )..
+0001c870: 2020 2020 2020 2020 6465 6275 6728 2270          debug("p
+0001c880: 6c6f 7420 534e 5073 2229 0a20 2020 2020  lot SNPs").     
+0001c890: 2020 2063 6f6c 6f72 5f70 6173 7320 3d20     color_pass = 
+0001c8a0: 626f 6b65 682e 7061 6c65 7474 6573 2e43  bokeh.palettes.C
+0001c8b0: 6f6c 6f72 626c 696e 6436 5b33 5d0a 2020  olorblind6[3].  
+0001c8c0: 2020 2020 2020 636f 6c6f 725f 6661 696c        color_fail
+0001c8d0: 203d 2062 6f6b 6568 2e70 616c 6574 7465   = bokeh.palette
+0001c8e0: 732e 436f 6c6f 7262 6c69 6e64 365b 355d  s.Colorblind6[5]
+0001c8f0: 0a20 2020 2020 2020 2064 6174 615b 226c  .        data["l
+0001c900: 6566 7422 5d20 3d20 6461 7461 5b22 706f  eft"] = data["po
+0001c910: 7322 5d20 2d20 302e 340a 2020 2020 2020  s"] - 0.4.      
+0001c920: 2020 6461 7461 5b22 7269 6768 7422 5d20    data["right"] 
+0001c930: 3d20 6461 7461 5b22 706f 7322 5d20 2b20  = data["pos"] + 
+0001c940: 302e 340a 2020 2020 2020 2020 6461 7461  0.4.        data
+0001c950: 5b22 626f 7474 6f6d 225d 203d 206e 702e  ["bottom"] = np.
+0001c960: 7768 6572 6528 6461 7461 5b22 6973 5f73  where(data["is_s
+0001c970: 6567 225d 2c20 312e 362c 2030 2e36 290a  eg"], 1.6, 0.6).
+0001c980: 2020 2020 2020 2020 6461 7461 5b22 746f          data["to
+0001c990: 7022 5d20 3d20 6461 7461 5b22 626f 7474  p"] = data["bott
+0001c9a0: 6f6d 225d 202b 2030 2e38 0a20 2020 2020  om"] + 0.8.     
+0001c9b0: 2020 2064 6174 615b 2263 6f6c 6f72 225d     data["color"]
+0001c9c0: 203d 206e 702e 7768 6572 6528 6461 7461   = np.where(data
+0001c9d0: 5b66 2270 6173 735f 7b73 6974 655f 6d61  [f"pass_{site_ma
+0001c9e0: 736b 7d22 5d2c 2063 6f6c 6f72 5f70 6173  sk}"], color_pas
+0001c9f0: 732c 2063 6f6c 6f72 5f66 6169 6c29 0a20  s, color_fail). 
+0001ca00: 2020 2020 2020 2066 6967 2e71 7561 6428         fig.quad(
+0001ca10: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+0001ca20: 3d22 746f 7022 2c0a 2020 2020 2020 2020  ="top",.        
+0001ca30: 2020 2020 626f 7474 6f6d 3d22 626f 7474      bottom="bott
+0001ca40: 6f6d 222c 0a20 2020 2020 2020 2020 2020  om",.           
+0001ca50: 206c 6566 743d 226c 6566 7422 2c0a 2020   left="left",.  
+0001ca60: 2020 2020 2020 2020 2020 7269 6768 743d            right=
+0001ca70: 2272 6967 6874 222c 0a20 2020 2020 2020  "right",.       
+0001ca80: 2020 2020 2063 6f6c 6f72 3d22 636f 6c6f       color="colo
+0001ca90: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
+0001caa0: 736f 7572 6365 3d64 6174 612c 0a20 2020  source=data,.   
+0001cab0: 2020 2020 2020 2020 206e 616d 653d 2273           name="s
+0001cac0: 6e70 7322 2c0a 2020 2020 2020 2020 290a  nps",.        ).
+0001cad0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0001cae0: 7469 6479 2070 6c6f 7422 290a 2020 2020  tidy plot").    
+0001caf0: 2020 2020 6669 672e 7961 7869 732e 7469      fig.yaxis.ti
+0001cb00: 636b 6572 203d 2062 6f6b 6568 2e6d 6f64  cker = bokeh.mod
+0001cb10: 656c 732e 4669 7865 6454 6963 6b65 7228  els.FixedTicker(
+0001cb20: 0a20 2020 2020 2020 2020 2020 2074 6963  .            tic
+0001cb30: 6b73 3d5b 312c 2032 5d2c 0a20 2020 2020  ks=[1, 2],.     
+0001cb40: 2020 2029 0a20 2020 2020 2020 2066 6967     ).        fig
+0001cb50: 2e79 6178 6973 2e6d 616a 6f72 5f6c 6162  .yaxis.major_lab
+0001cb60: 656c 5f6f 7665 7272 6964 6573 203d 207b  el_overrides = {
+0001cb70: 0a20 2020 2020 2020 2020 2020 2031 3a20  .            1: 
+0001cb80: 224e 6f6e 2d73 6567 7265 6761 7469 6e67  "Non-segregating
+0001cb90: 222c 0a20 2020 2020 2020 2020 2020 2032  ",.            2
+0001cba0: 3a20 2253 6567 7265 6761 7469 6e67 222c  : "Segregating",
+0001cbb0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0001cbc0: 2020 2066 6967 2e78 6178 6973 2e61 7869     fig.xaxis.axi
+0001cbd0: 735f 6c61 6265 6c20 3d20 6622 436f 6e74  s_label = f"Cont
+0001cbe0: 6967 207b 7265 736f 6c76 6564 5f72 6567  ig {resolved_reg
+0001cbf0: 696f 6e2e 636f 6e74 6967 7d20 706f 7369  ion.contig} posi
+0001cc00: 7469 6f6e 2028 6270 2922 0a20 2020 2020  tion (bp)".     
+0001cc10: 2020 2066 6967 2e78 6178 6973 2e74 6963     fig.xaxis.tic
+0001cc20: 6b65 7220 3d20 626f 6b65 682e 6d6f 6465  ker = bokeh.mode
+0001cc30: 6c73 2e41 6461 7074 6976 6554 6963 6b65  ls.AdaptiveTicke
+0001cc40: 7228 6d69 6e5f 696e 7465 7276 616c 3d31  r(min_interval=1
+0001cc50: 290a 2020 2020 2020 2020 6669 672e 7861  ).        fig.xa
+0001cc60: 7869 732e 6d69 6e6f 725f 7469 636b 5f6c  xis.minor_tick_l
+0001cc70: 696e 655f 636f 6c6f 7220 3d20 4e6f 6e65  ine_color = None
+0001cc80: 0a20 2020 2020 2020 2066 6967 2e78 6178  .        fig.xax
+0001cc90: 6973 5b30 5d2e 666f 726d 6174 7465 7220  is[0].formatter 
+0001cca0: 3d20 626f 6b65 682e 6d6f 6465 6c73 2e4e  = bokeh.models.N
+0001ccb0: 756d 6572 616c 5469 636b 466f 726d 6174  umeralTickFormat
+0001ccc0: 7465 7228 666f 726d 6174 3d22 302c 3022  ter(format="0,0"
+0001ccd0: 290a 0a20 2020 2020 2020 2069 6620 7368  )..        if sh
+0001cce0: 6f77 3a0a 2020 2020 2020 2020 2020 2020  ow:.            
+0001ccf0: 626f 6b65 682e 706c 6f74 7469 6e67 2e73  bokeh.plotting.s
+0001cd00: 686f 7728 6669 6729 0a0a 2020 2020 2020  how(fig)..      
+0001cd10: 2020 7265 7475 726e 2066 6967 0a0a 2020    return fig..  
+0001cd20: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
+0001cd30: 7375 6d6d 6172 793d 2222 220a 2020 2020  summary=""".    
+0001cd40: 2020 2020 2020 2020 436f 6d70 7574 6520          Compute 
+0001cd50: 534e 5020 616c 6c65 6c65 2066 7265 7175  SNP allele frequ
+0001cd60: 656e 6369 6573 2066 6f72 2061 2067 656e  encies for a gen
+0001cd70: 6520 7472 616e 7363 7269 7074 2e0a 2020  e transcript..  
+0001cd80: 2020 2020 2020 2222 222c 0a20 2020 2020        """,.     
+0001cd90: 2020 2072 6574 7572 6e73 3d22 2222 0a20     returns=""". 
+0001cda0: 2020 2020 2020 2020 2020 2041 2064 6174             A dat
+0001cdb0: 6166 7261 6d65 206f 6620 534e 5020 616c  aframe of SNP al
+0001cdc0: 6c65 6c65 2066 7265 7175 656e 6369 6573  lele frequencies
+0001cdd0: 2c20 6f6e 6520 726f 7720 7065 7220 7661  , one row per va
+0001cde0: 7269 616e 7420 616c 6c65 6c65 2e0a 2020  riant allele..  
+0001cdf0: 2020 2020 2020 2222 222c 0a20 2020 2020        """,.     
+0001ce00: 2020 206e 6f74 6573 3d22 2222 0a20 2020     notes=""".   
+0001ce10: 2020 2020 2020 2020 2043 6f68 6f72 7473           Cohorts
+0001ce20: 2077 6974 6820 6665 7765 7220 7361 6d70   with fewer samp
+0001ce30: 6c65 7320 7468 616e 2060 6d69 6e5f 636f  les than `min_co
+0001ce40: 686f 7274 5f73 697a 6560 2077 696c 6c20  hort_size` will 
+0001ce50: 6265 2065 7863 6c75 6465 6420 6672 6f6d  be excluded from
+0001ce60: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0001ce70: 7075 7420 6461 7461 2066 7261 6d65 2e0a  put data frame..
+0001ce80: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
+0001ce90: 2029 0a20 2020 2064 6566 2073 6e70 5f61   ).    def snp_a
+0001cea0: 6c6c 656c 655f 6672 6571 7565 6e63 6965  llele_frequencie
+0001ceb0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+0001cec0: 0a20 2020 2020 2020 2074 7261 6e73 6372  .        transcr
+0001ced0: 6970 743a 2062 6173 655f 7061 7261 6d73  ipt: base_params
+0001cee0: 2e74 7261 6e73 6372 6970 742c 0a20 2020  .transcript,.   
+0001cef0: 2020 2020 2063 6f68 6f72 7473 3a20 6261       cohorts: ba
+0001cf00: 7365 5f70 6172 616d 732e 636f 686f 7274  se_params.cohort
+0001cf10: 732c 0a20 2020 2020 2020 2073 616d 706c  s,.        sampl
+0001cf20: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
+0001cf30: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+0001cf40: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
+0001cf50: 6e65 2c0a 2020 2020 2020 2020 6d69 6e5f  ne,.        min_
+0001cf60: 636f 686f 7274 5f73 697a 653a 2062 6173  cohort_size: bas
+0001cf70: 655f 7061 7261 6d73 2e6d 696e 5f63 6f68  e_params.min_coh
+0001cf80: 6f72 745f 7369 7a65 203d 2031 302c 0a20  ort_size = 10,. 
+0001cf90: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+0001cfa0: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
+0001cfb0: 7061 7261 6d73 2e73 6974 655f 6d61 736b  params.site_mask
+0001cfc0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0001cfd0: 2020 7361 6d70 6c65 5f73 6574 733a 204f    sample_sets: O
+0001cfe0: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+0001cff0: 616d 732e 7361 6d70 6c65 5f73 6574 735d  ams.sample_sets]
+0001d000: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001d010: 2064 726f 705f 696e 7661 7269 616e 743a   drop_invariant:
+0001d020: 2066 7271 5f70 6172 616d 732e 6472 6f70   frq_params.drop
+0001d030: 5f69 6e76 6172 6961 6e74 203d 2054 7275  _invariant = Tru
+0001d040: 652c 0a20 2020 2020 2020 2065 6666 6563  e,.        effec
+0001d050: 7473 3a20 6672 715f 7061 7261 6d73 2e65  ts: frq_params.e
+0001d060: 6666 6563 7473 203d 2054 7275 652c 0a20  ffects = True,. 
+0001d070: 2020 2029 202d 3e20 7064 2e44 6174 6146     ) -> pd.DataF
+0001d080: 7261 6d65 3a0a 2020 2020 2020 2020 6465  rame:.        de
+0001d090: 6275 6720 3d20 7365 6c66 2e5f 6c6f 672e  bug = self._log.
+0001d0a0: 6465 6275 670a 0a20 2020 2020 2020 2064  debug..        d
+0001d0b0: 6562 7567 2822 6368 6563 6b20 7061 7261  ebug("check para
+0001d0c0: 6d65 7465 7273 2229 0a20 2020 2020 2020  meters").       
+0001d0d0: 2073 656c 662e 5f63 6865 636b 5f70 6172   self._check_par
+0001d0e0: 616d 5f6d 696e 5f63 6f68 6f72 745f 7369  am_min_cohort_si
+0001d0f0: 7a65 286d 696e 5f63 6f68 6f72 745f 7369  ze(min_cohort_si
+0001d100: 7a65 290a 0a20 2020 2020 2020 2064 6562  ze)..        deb
+0001d110: 7567 2822 6163 6365 7373 2073 616d 706c  ug("access sampl
+0001d120: 6520 6d65 7461 6461 7461 2229 0a20 2020  e metadata").   
+0001d130: 2020 2020 2064 665f 7361 6d70 6c65 7320       df_samples 
+0001d140: 3d20 7365 6c66 2e73 616d 706c 655f 6d65  = self.sample_me
+0001d150: 7461 6461 7461 280a 2020 2020 2020 2020  tadata(.        
+0001d160: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
+0001d170: 7361 6d70 6c65 5f73 6574 732c 2073 616d  sample_sets, sam
+0001d180: 706c 655f 7175 6572 793d 7361 6d70 6c65  ple_query=sample
+0001d190: 5f71 7565 7279 0a20 2020 2020 2020 2029  _query.        )
+0001d1a0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001d1b0: 2273 6574 7570 2069 6e69 7469 616c 2064  "setup initial d
+0001d1c0: 6174 6166 7261 6d65 206f 6620 534e 5073  ataframe of SNPs
+0001d1d0: 2229 0a20 2020 2020 2020 2072 6567 696f  ").        regio
+0001d1e0: 6e2c 2064 665f 736e 7073 203d 2073 656c  n, df_snps = sel
+0001d1f0: 662e 5f73 6e70 5f64 6628 7472 616e 7363  f._snp_df(transc
+0001d200: 7269 7074 3d74 7261 6e73 6372 6970 7429  ript=transcript)
+0001d210: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001d220: 2267 6574 2067 656e 6f74 7970 6573 2229  "get genotypes")
+0001d230: 0a20 2020 2020 2020 2067 7420 3d20 7365  .        gt = se
+0001d240: 6c66 2e73 6e70 5f67 656e 6f74 7970 6573  lf.snp_genotypes
+0001d250: 280a 2020 2020 2020 2020 2020 2020 7265  (.            re
+0001d260: 6769 6f6e 3d72 6567 696f 6e2c 0a20 2020  gion=region,.   
+0001d270: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
+0001d280: 7365 7473 3d73 616d 706c 655f 7365 7473  sets=sample_sets
+0001d290: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
+0001d2a0: 6d70 6c65 5f71 7565 7279 3d73 616d 706c  mple_query=sampl
+0001d2b0: 655f 7175 6572 792c 0a20 2020 2020 2020  e_query,.       
+0001d2c0: 2020 2020 2066 6965 6c64 3d22 4754 222c       field="GT",
+0001d2d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001d2e0: 2020 2020 6465 6275 6728 2273 6c69 6365      debug("slice
+0001d2f0: 2074 6f20 6665 6174 7572 6520 6c6f 6361   to feature loca
+0001d300: 7469 6f6e 2229 0a20 2020 2020 2020 2077  tion").        w
+0001d310: 6974 6820 7365 6c66 2e5f 6461 736b 5f70  ith self._dask_p
+0001d320: 726f 6772 6573 7328 6465 7363 3d22 4c6f  rogress(desc="Lo
+0001d330: 6164 2053 4e50 2067 656e 6f74 7970 6573  ad SNP genotypes
+0001d340: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0001d350: 6774 203d 2067 742e 636f 6d70 7574 6528  gt = gt.compute(
+0001d360: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+0001d370: 2822 6275 696c 6420 636f 6820 6469 6374  ("build coh dict
+0001d380: 2229 0a20 2020 2020 2020 2063 6f68 5f64  ").        coh_d
+0001d390: 6963 7420 3d20 7365 6c66 2e5f 6c6f 6361  ict = self._loca
+0001d3a0: 7465 5f63 6f68 6f72 7473 2863 6f68 6f72  te_cohorts(cohor
+0001d3b0: 7473 3d63 6f68 6f72 7473 2c20 6466 5f73  ts=cohorts, df_s
+0001d3c0: 616d 706c 6573 3d64 665f 7361 6d70 6c65  amples=df_sample
+0001d3d0: 7329 0a0a 2020 2020 2020 2020 6465 6275  s)..        debu
+0001d3e0: 6728 2263 6f75 6e74 2061 6c6c 656c 6573  g("count alleles
+0001d3f0: 2229 0a20 2020 2020 2020 2066 7265 715f  ").        freq_
+0001d400: 636f 6c73 203d 2064 6963 7428 290a 2020  cols = dict().  
+0001d410: 2020 2020 2020 636f 686f 7274 735f 6974        cohorts_it
+0001d420: 6572 6174 6f72 203d 2073 656c 662e 5f70  erator = self._p
+0001d430: 726f 6772 6573 7328 0a20 2020 2020 2020  rogress(.       
+0001d440: 2020 2020 2063 6f68 5f64 6963 742e 6974       coh_dict.it
+0001d450: 656d 7328 292c 2064 6573 633d 2243 6f6d  ems(), desc="Com
+0001d460: 7075 7465 2061 6c6c 656c 6520 6672 6571  pute allele freq
+0001d470: 7565 6e63 6965 7322 0a20 2020 2020 2020  uencies".       
+0001d480: 2029 0a20 2020 2020 2020 2066 6f72 2063   ).        for c
+0001d490: 6f68 2c20 6c6f 635f 636f 6820 696e 2063  oh, loc_coh in c
+0001d4a0: 6f68 6f72 7473 5f69 7465 7261 746f 723a  ohorts_iterator:
+0001d4b0: 0a20 2020 2020 2020 2020 2020 206e 5f73  .            n_s
+0001d4c0: 616d 706c 6573 203d 206e 702e 636f 756e  amples = np.coun
+0001d4d0: 745f 6e6f 6e7a 6572 6f28 6c6f 635f 636f  t_nonzero(loc_co
+0001d4e0: 6829 0a20 2020 2020 2020 2020 2020 2064  h).            d
+0001d4f0: 6562 7567 2866 227b 636f 687d 2c20 7b6e  ebug(f"{coh}, {n
+0001d500: 5f73 616d 706c 6573 7d20 7361 6d70 6c65  _samples} sample
+0001d510: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
+0001d520: 6966 206e 5f73 616d 706c 6573 203e 3d20  if n_samples >= 
+0001d530: 6d69 6e5f 636f 686f 7274 5f73 697a 653a  min_cohort_size:
+0001d540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d550: 2067 745f 636f 6820 3d20 6e70 2e63 6f6d   gt_coh = np.com
+0001d560: 7072 6573 7328 6c6f 635f 636f 682c 2067  press(loc_coh, g
+0001d570: 742c 2061 7869 733d 3129 0a20 2020 2020  t, axis=1).     
+0001d580: 2020 2020 2020 2020 2020 2061 635f 636f             ac_co
+0001d590: 6820 3d20 616c 6c65 6c2e 4765 6e6f 7479  h = allel.Genoty
+0001d5a0: 7065 4172 7261 7928 6774 5f63 6f68 292e  peArray(gt_coh).
+0001d5b0: 636f 756e 745f 616c 6c65 6c65 7328 6d61  count_alleles(ma
+0001d5c0: 785f 616c 6c65 6c65 3d33 290a 2020 2020  x_allele=3).    
+0001d5d0: 2020 2020 2020 2020 2020 2020 6166 5f63              af_c
+0001d5e0: 6f68 203d 2061 635f 636f 682e 746f 5f66  oh = ac_coh.to_f
+0001d5f0: 7265 7175 656e 6369 6573 2829 0a20 2020  requencies().   
+0001d600: 2020 2020 2020 2020 2020 2020 2066 7265               fre
+0001d610: 715f 636f 6c73 5b22 6672 715f 2220 2b20  q_cols["frq_" + 
+0001d620: 636f 685d 203d 2061 665f 636f 685b 3a2c  coh] = af_coh[:,
+0001d630: 2031 3a5d 2e66 6c61 7474 656e 2829 0a0a   1:].flatten()..
+0001d640: 2020 2020 2020 2020 6465 6275 6728 2262          debug("b
+0001d650: 7569 6c64 2061 2064 6174 6166 7261 6d65  uild a dataframe
+0001d660: 2077 6974 6820 7468 6520 6672 6571 7565   with the freque
+0001d670: 6e63 7920 636f 6c75 6d6e 7322 290a 2020  ncy columns").  
+0001d680: 2020 2020 2020 6466 5f66 7265 7173 203d        df_freqs =
+0001d690: 2070 642e 4461 7461 4672 616d 6528 6672   pd.DataFrame(fr
+0001d6a0: 6571 5f63 6f6c 7329 0a0a 2020 2020 2020  eq_cols)..      
+0001d6b0: 2020 6465 6275 6728 2263 6f6d 7075 7465    debug("compute
+0001d6c0: 206d 6178 5f61 6622 290a 2020 2020 2020   max_af").      
+0001d6d0: 2020 6466 5f6d 6178 5f61 6620 3d20 7064    df_max_af = pd
+0001d6e0: 2e44 6174 6146 7261 6d65 287b 226d 6178  .DataFrame({"max
+0001d6f0: 5f61 6622 3a20 6466 5f66 7265 7173 2e6d  _af": df_freqs.m
+0001d700: 6178 2861 7869 733d 3129 7d29 0a0a 2020  ax(axis=1)})..  
+0001d710: 2020 2020 2020 6465 6275 6728 2262 7569        debug("bui
+0001d720: 6c64 2074 6865 2066 696e 616c 2064 6174  ld the final dat
+0001d730: 6166 7261 6d65 2229 0a20 2020 2020 2020  aframe").       
+0001d740: 2064 665f 736e 7073 2e72 6573 6574 5f69   df_snps.reset_i
+0001d750: 6e64 6578 2864 726f 703d 5472 7565 2c20  ndex(drop=True, 
+0001d760: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+0001d770: 2020 2020 2020 6466 5f73 6e70 7320 3d20        df_snps = 
+0001d780: 7064 2e63 6f6e 6361 7428 5b64 665f 736e  pd.concat([df_sn
+0001d790: 7073 2c20 6466 5f66 7265 7173 2c20 6466  ps, df_freqs, df
+0001d7a0: 5f6d 6178 5f61 665d 2c20 6178 6973 3d31  _max_af], axis=1
+0001d7b0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+0001d7c0: 2822 6170 706c 7920 7369 7465 206d 6173  ("apply site mas
+0001d7d0: 6b20 6966 2072 6571 7565 7374 6564 2229  k if requested")
+0001d7e0: 0a20 2020 2020 2020 2069 6620 7369 7465  .        if site
+0001d7f0: 5f6d 6173 6b20 6973 206e 6f74 204e 6f6e  _mask is not Non
+0001d800: 653a 0a20 2020 2020 2020 2020 2020 206c  e:.            l
+0001d810: 6f63 5f73 6974 6573 203d 2064 665f 736e  oc_sites = df_sn
+0001d820: 7073 5b66 2270 6173 735f 7b73 6974 655f  ps[f"pass_{site_
+0001d830: 6d61 736b 7d22 5d0a 2020 2020 2020 2020  mask}"].        
+0001d840: 2020 2020 6466 5f73 6e70 7320 3d20 6466      df_snps = df
+0001d850: 5f73 6e70 732e 6c6f 635b 6c6f 635f 7369  _snps.loc[loc_si
+0001d860: 7465 735d 0a0a 2020 2020 2020 2020 6465  tes]..        de
+0001d870: 6275 6728 2264 726f 7020 696e 7661 7269  bug("drop invari
+0001d880: 616e 7473 2229 0a20 2020 2020 2020 2069  ants").        i
+0001d890: 6620 6472 6f70 5f69 6e76 6172 6961 6e74  f drop_invariant
+0001d8a0: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0001d8b0: 635f 7661 7269 616e 7420 3d20 6466 5f73  c_variant = df_s
+0001d8c0: 6e70 735b 226d 6178 5f61 6622 5d20 3e20  nps["max_af"] > 
+0001d8d0: 300a 2020 2020 2020 2020 2020 2020 6466  0.            df
+0001d8e0: 5f73 6e70 7320 3d20 6466 5f73 6e70 732e  _snps = df_snps.
+0001d8f0: 6c6f 635b 6c6f 635f 7661 7269 616e 745d  loc[loc_variant]
+0001d900: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001d910: 2272 6573 6574 2069 6e64 6578 2061 6674  "reset index aft
+0001d920: 6572 2066 696c 7465 7269 6e67 2229 0a20  er filtering"). 
+0001d930: 2020 2020 2020 2064 665f 736e 7073 2e72         df_snps.r
+0001d940: 6573 6574 5f69 6e64 6578 2869 6e70 6c61  eset_index(inpla
+0001d950: 6365 3d54 7275 652c 2064 726f 703d 5472  ce=True, drop=Tr
+0001d960: 7565 290a 0a20 2020 2020 2020 2069 6620  ue)..        if 
+0001d970: 6566 6665 6374 733a 0a20 2020 2020 2020  effects:.       
+0001d980: 2020 2020 2064 6562 7567 2822 6164 6420       debug("add 
+0001d990: 6566 6665 6374 2061 6e6e 6f74 6174 696f  effect annotatio
+0001d9a0: 6e73 2229 0a20 2020 2020 2020 2020 2020  ns").           
+0001d9b0: 2061 6e6e 203d 2073 656c 662e 5f61 6e6e   ann = self._ann
+0001d9c0: 6f74 6174 6f72 2829 0a20 2020 2020 2020  otator().       
+0001d9d0: 2020 2020 2061 6e6e 2e67 6574 5f65 6666       ann.get_eff
+0001d9e0: 6563 7473 280a 2020 2020 2020 2020 2020  ects(.          
+0001d9f0: 2020 2020 2020 7472 616e 7363 7269 7074        transcript
+0001da00: 3d74 7261 6e73 6372 6970 742c 2076 6172  =transcript, var
+0001da10: 6961 6e74 733d 6466 5f73 6e70 732c 2070  iants=df_snps, p
+0001da20: 726f 6772 6573 733d 7365 6c66 2e5f 7072  rogress=self._pr
+0001da30: 6f67 7265 7373 0a20 2020 2020 2020 2020  ogress.         
+0001da40: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0001da50: 2020 6465 6275 6728 2261 6464 206c 6162    debug("add lab
+0001da60: 656c 2229 0a20 2020 2020 2020 2020 2020  el").           
+0001da70: 2064 665f 736e 7073 5b22 6c61 6265 6c22   df_snps["label"
+0001da80: 5d20 3d20 7365 6c66 2e5f 7061 6e64 6173  ] = self._pandas
+0001da90: 5f61 7070 6c79 280a 2020 2020 2020 2020  _apply(.        
+0001daa0: 2020 2020 2020 2020 7365 6c66 2e5f 6d61          self._ma
+0001dab0: 6b65 5f73 6e70 5f6c 6162 656c 5f65 6666  ke_snp_label_eff
+0001dac0: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
+0001dad0: 2020 2020 2064 665f 736e 7073 2c0a 2020       df_snps,.  
+0001dae0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001daf0: 6c75 6d6e 733d 5b22 636f 6e74 6967 222c  lumns=["contig",
+0001db00: 2022 706f 7369 7469 6f6e 222c 2022 7265   "position", "re
+0001db10: 665f 616c 6c65 6c65 222c 2022 616c 745f  f_allele", "alt_
+0001db20: 616c 6c65 6c65 222c 2022 6161 5f63 6861  allele", "aa_cha
+0001db30: 6e67 6522 5d2c 0a20 2020 2020 2020 2020  nge"],.         
+0001db40: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0001db50: 2020 6465 6275 6728 2273 6574 2069 6e64    debug("set ind
+0001db60: 6578 2229 0a20 2020 2020 2020 2020 2020  ex").           
+0001db70: 2064 665f 736e 7073 2e73 6574 5f69 6e64   df_snps.set_ind
+0001db80: 6578 280a 2020 2020 2020 2020 2020 2020  ex(.            
+0001db90: 2020 2020 5b22 636f 6e74 6967 222c 2022      ["contig", "
+0001dba0: 706f 7369 7469 6f6e 222c 2022 7265 665f  position", "ref_
+0001dbb0: 616c 6c65 6c65 222c 2022 616c 745f 616c  allele", "alt_al
+0001dbc0: 6c65 6c65 222c 2022 6161 5f63 6861 6e67  lele", "aa_chang
+0001dbd0: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
+0001dbe0: 2020 2020 2069 6e70 6c61 6365 3d54 7275       inplace=Tru
+0001dbf0: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+0001dc00: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
+0001dc10: 2020 2020 2020 2020 2020 2020 6465 6275              debu
+0001dc20: 6728 2261 6464 206c 6162 656c 2229 0a20  g("add label"). 
+0001dc30: 2020 2020 2020 2020 2020 2064 665f 736e             df_sn
+0001dc40: 7073 5b22 6c61 6265 6c22 5d20 3d20 7365  ps["label"] = se
+0001dc50: 6c66 2e5f 7061 6e64 6173 5f61 7070 6c79  lf._pandas_apply
+0001dc60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001dc70: 2020 7365 6c66 2e5f 6d61 6b65 5f73 6e70    self._make_snp
+0001dc80: 5f6c 6162 656c 2c0a 2020 2020 2020 2020  _label,.        
+0001dc90: 2020 2020 2020 2020 6466 5f73 6e70 732c          df_snps,
+0001dca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dcb0: 2063 6f6c 756d 6e73 3d5b 2263 6f6e 7469   columns=["conti
+0001dcc0: 6722 2c20 2270 6f73 6974 696f 6e22 2c20  g", "position", 
+0001dcd0: 2272 6566 5f61 6c6c 656c 6522 2c20 2261  "ref_allele", "a
+0001dce0: 6c74 5f61 6c6c 656c 6522 5d2c 0a20 2020  lt_allele"],.   
+0001dcf0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001dd00: 2020 2020 2020 2020 6465 6275 6728 2273          debug("s
+0001dd10: 6574 2069 6e64 6578 2229 0a20 2020 2020  et index").     
+0001dd20: 2020 2020 2020 2064 665f 736e 7073 2e73         df_snps.s
+0001dd30: 6574 5f69 6e64 6578 280a 2020 2020 2020  et_index(.      
+0001dd40: 2020 2020 2020 2020 2020 5b22 636f 6e74            ["cont
+0001dd50: 6967 222c 2022 706f 7369 7469 6f6e 222c  ig", "position",
+0001dd60: 2022 7265 665f 616c 6c65 6c65 222c 2022   "ref_allele", "
+0001dd70: 616c 745f 616c 6c65 6c65 225d 2c0a 2020  alt_allele"],.  
+0001dd80: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001dd90: 706c 6163 653d 5472 7565 2c0a 2020 2020  place=True,.    
+0001dda0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001ddb0: 2020 2064 6562 7567 2822 6164 6420 6461     debug("add da
+0001ddc0: 7461 6672 616d 6520 6d65 7461 6461 7461  taframe metadata
+0001ddd0: 2229 0a20 2020 2020 2020 2067 656e 655f  ").        gene_
+0001dde0: 6e61 6d65 203d 2073 656c 662e 5f74 7261  name = self._tra
+0001ddf0: 6e73 6372 6970 745f 746f 5f67 656e 655f  nscript_to_gene_
+0001de00: 6e61 6d65 2874 7261 6e73 6372 6970 7429  name(transcript)
+0001de10: 0a20 2020 2020 2020 2074 6974 6c65 203d  .        title =
+0001de20: 2074 7261 6e73 6372 6970 740a 2020 2020   transcript.    
+0001de30: 2020 2020 6966 2067 656e 655f 6e61 6d65      if gene_name
+0001de40: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+0001de50: 746c 6520 2b3d 2066 2220 287b 6765 6e65  tle += f" ({gene
+0001de60: 5f6e 616d 657d 2922 0a20 2020 2020 2020  _name})".       
+0001de70: 2074 6974 6c65 202b 3d20 2220 534e 5020   title += " SNP 
+0001de80: 6672 6571 7565 6e63 6965 7322 0a20 2020  frequencies".   
+0001de90: 2020 2020 2064 665f 736e 7073 2e61 7474       df_snps.att
+0001dea0: 7273 5b22 7469 746c 6522 5d20 3d20 7469  rs["title"] = ti
+0001deb0: 746c 650a 0a20 2020 2020 2020 2072 6574  tle..        ret
+0001dec0: 7572 6e20 6466 5f73 6e70 730a 0a20 2020  urn df_snps..   
+0001ded0: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
+0001dee0: 756d 6d61 7279 3d22 2222 0a20 2020 2020  ummary=""".     
+0001def0: 2020 2020 2020 2043 6f6d 7075 7465 2061         Compute a
+0001df00: 6d69 6e6f 2061 6369 6420 7375 6273 7469  mino acid substi
+0001df10: 7475 7469 6f6e 2066 7265 7175 656e 6369  tution frequenci
+0001df20: 6573 2066 6f72 2061 2067 656e 6520 7472  es for a gene tr
+0001df30: 616e 7363 7269 7074 2e0a 2020 2020 2020  anscript..      
+0001df40: 2020 2222 222c 0a20 2020 2020 2020 2072    """,.        r
+0001df50: 6574 7572 6e73 3d22 2222 0a20 2020 2020  eturns=""".     
+0001df60: 2020 2020 2020 2041 2064 6174 6166 7261         A datafra
+0001df70: 6d65 206f 6620 616d 696e 6f20 6163 6964  me of amino acid
+0001df80: 2061 6c6c 656c 6520 6672 6571 7565 6e63   allele frequenc
+0001df90: 6965 732c 206f 6e65 2072 6f77 2070 6572  ies, one row per
+0001dfa0: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0001dfb0: 7374 6974 7574 696f 6e2e 0a20 2020 2020  stitution..     
+0001dfc0: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+0001dfd0: 6e6f 7465 733d 2222 220a 2020 2020 2020  notes=""".      
+0001dfe0: 2020 2020 2020 436f 686f 7274 7320 7769        Cohorts wi
+0001dff0: 7468 2066 6577 6572 2073 616d 706c 6573  th fewer samples
+0001e000: 2074 6861 6e20 606d 696e 5f63 6f68 6f72   than `min_cohor
+0001e010: 745f 7369 7a65 6020 7769 6c6c 2062 6520  t_size` will be 
+0001e020: 6578 636c 7564 6564 2066 726f 6d0a 2020  excluded from.  
+0001e030: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+0001e040: 2064 6174 6120 6672 616d 652e 0a20 2020   data frame..   
+0001e050: 2020 2020 2022 2222 2c0a 2020 2020 290a       """,.    ).
+0001e060: 2020 2020 6465 6620 6161 5f61 6c6c 656c      def aa_allel
+0001e070: 655f 6672 6571 7565 6e63 6965 7328 0a20  e_frequencies(. 
+0001e080: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0001e090: 2020 2020 2074 7261 6e73 6372 6970 743a       transcript:
+0001e0a0: 2062 6173 655f 7061 7261 6d73 2e74 7261   base_params.tra
+0001e0b0: 6e73 6372 6970 742c 0a20 2020 2020 2020  nscript,.       
+0001e0c0: 2063 6f68 6f72 7473 3a20 6261 7365 5f70   cohorts: base_p
+0001e0d0: 6172 616d 732e 636f 686f 7274 732c 0a20  arams.cohorts,. 
+0001e0e0: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
+0001e0f0: 6572 793a 204f 7074 696f 6e61 6c5b 6261  ery: Optional[ba
+0001e100: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
+0001e110: 5f71 7565 7279 5d20 3d20 4e6f 6e65 2c0a  _query] = None,.
+0001e120: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
+0001e130: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
+0001e140: 6c5b 6261 7365 5f70 6172 616d 732e 6d69  l[base_params.mi
+0001e150: 6e5f 636f 686f 7274 5f73 697a 655d 203d  n_cohort_size] =
+0001e160: 2031 302c 0a20 2020 2020 2020 2073 6974   10,.        sit
+0001e170: 655f 6d61 736b 3a20 4f70 7469 6f6e 616c  e_mask: Optional
+0001e180: 5b62 6173 655f 7061 7261 6d73 2e73 6974  [base_params.sit
+0001e190: 655f 6d61 736b 5d20 3d20 4e6f 6e65 2c0a  e_mask] = None,.
+0001e1a0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0001e1b0: 6574 733a 204f 7074 696f 6e61 6c5b 6261  ets: Optional[ba
+0001e1c0: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
+0001e1d0: 5f73 6574 735d 203d 204e 6f6e 652c 0a20  _sets] = None,. 
+0001e1e0: 2020 2020 2020 2064 726f 705f 696e 7661         drop_inva
+0001e1f0: 7269 616e 743a 2066 7271 5f70 6172 616d  riant: frq_param
+0001e200: 732e 6472 6f70 5f69 6e76 6172 6961 6e74  s.drop_invariant
+0001e210: 203d 2054 7275 652c 0a20 2020 2029 202d   = True,.    ) -
+0001e220: 3e20 7064 2e44 6174 6146 7261 6d65 3a0a  > pd.DataFrame:.
+0001e230: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
+0001e240: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
+0001e250: 0a20 2020 2020 2020 2064 665f 736e 7073  .        df_snps
+0001e260: 203d 2073 656c 662e 736e 705f 616c 6c65   = self.snp_alle
+0001e270: 6c65 5f66 7265 7175 656e 6369 6573 280a  le_frequencies(.
+0001e280: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+0001e290: 7363 7269 7074 3d74 7261 6e73 6372 6970  script=transcrip
+0001e2a0: 742c 0a20 2020 2020 2020 2020 2020 2063  t,.            c
+0001e2b0: 6f68 6f72 7473 3d63 6f68 6f72 7473 2c0a  ohorts=cohorts,.
+0001e2c0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+0001e2d0: 6c65 5f71 7565 7279 3d73 616d 706c 655f  le_query=sample_
+0001e2e0: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
+0001e2f0: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
+0001e300: 7a65 3d6d 696e 5f63 6f68 6f72 745f 7369  ze=min_cohort_si
+0001e310: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+0001e320: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
+0001e330: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
+0001e340: 2073 616d 706c 655f 7365 7473 3d73 616d   sample_sets=sam
+0001e350: 706c 655f 7365 7473 2c0a 2020 2020 2020  ple_sets,.      
+0001e360: 2020 2020 2020 6472 6f70 5f69 6e76 6172        drop_invar
+0001e370: 6961 6e74 3d64 726f 705f 696e 7661 7269  iant=drop_invari
+0001e380: 616e 742c 0a20 2020 2020 2020 2020 2020  ant,.           
+0001e390: 2065 6666 6563 7473 3d54 7275 652c 0a20   effects=True,. 
+0001e3a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001e3b0: 2064 665f 736e 7073 2e72 6573 6574 5f69   df_snps.reset_i
+0001e3c0: 6e64 6578 2869 6e70 6c61 6365 3d54 7275  ndex(inplace=Tru
+0001e3d0: 6529 0a0a 2020 2020 2020 2020 2320 7765  e)..        # we
+0001e3e0: 206a 7573 7420 7761 6e74 2061 6120 6368   just want aa ch
+0001e3f0: 616e 6765 0a20 2020 2020 2020 2064 665f  ange.        df_
+0001e400: 6e73 5f73 6e70 7320 3d20 6466 5f73 6e70  ns_snps = df_snp
+0001e410: 732e 7175 6572 7928 4141 5f43 4841 4e47  s.query(AA_CHANG
+0001e420: 455f 5155 4552 5929 2e63 6f70 7928 290a  E_QUERY).copy().
+0001e430: 0a20 2020 2020 2020 2023 204e 2e42 2e2c  .        # N.B.,
+0001e440: 2077 6520 6e65 6564 2074 6f20 776f 7272   we need to worr
+0001e450: 7920 6162 6f75 7420 7468 6520 706f 7373  y about the poss
+0001e460: 6962 696c 6974 7920 6f66 2074 6865 0a20  ibility of the. 
+0001e470: 2020 2020 2020 2023 2073 616d 6520 6161         # same aa
+0001e480: 2063 6861 6e67 6520 6475 6520 746f 2053   change due to S
+0001e490: 4e50 7320 6174 2064 6966 6665 7265 6e74  NPs at different
+0001e4a0: 2070 6f73 6974 696f 6e73 2e20 5765 2063   positions. We c
+0001e4b0: 616e 6e6f 740a 2020 2020 2020 2020 2320  annot.        # 
+0001e4c0: 7375 6d20 6672 6571 7565 6e63 6965 7320  sum frequencies 
+0001e4d0: 6f66 2053 4e50 7320 6174 2064 6966 6665  of SNPs at diffe
+0001e4e0: 7265 6e74 2067 656e 6f6d 6963 2070 6f73  rent genomic pos
+0001e4f0: 6974 696f 6e73 2e20 5468 6973 0a20 2020  itions. This.   
+0001e500: 2020 2020 2023 2069 7320 7768 7920 7765       # is why we
+0001e510: 2067 726f 7570 2062 7920 706f 7369 7469   group by positi
+0001e520: 6f6e 2061 6e64 2061 615f 6368 616e 6765  on and aa_change
+0001e530: 2c20 6e6f 7420 6a75 7374 2061 615f 6368  , not just aa_ch
+0001e540: 616e 6765 2e0a 0a20 2020 2020 2020 2064  ange...        d
+0001e550: 6562 7567 2822 6772 6f75 7020 616e 6420  ebug("group and 
+0001e560: 7375 6d20 746f 2063 6f6c 6c61 7073 6520  sum to collapse 
+0001e570: 6d75 6c74 6920 7661 7269 616e 7420 616c  multi variant al
+0001e580: 6c65 6c65 2063 6861 6e67 6573 2229 0a20  lele changes"). 
+0001e590: 2020 2020 2020 2066 7265 715f 636f 6c73         freq_cols
+0001e5a0: 203d 205b 636f 6c20 666f 7220 636f 6c20   = [col for col 
+0001e5b0: 696e 2064 665f 6e73 5f73 6e70 7320 6966  in df_ns_snps if
+0001e5c0: 2063 6f6c 2e73 7461 7274 7377 6974 6828   col.startswith(
+0001e5d0: 2266 7271 2229 5d0a 2020 2020 2020 2020  "frq")].        
+0001e5e0: 6167 673a 2044 6963 745b 7374 722c 2055  agg: Dict[str, U
+0001e5f0: 6e69 6f6e 5b43 616c 6c61 626c 652c 2073  nion[Callable, s
+0001e600: 7472 5d5d 203d 207b 633a 206e 702e 6e61  tr]] = {c: np.na
+0001e610: 6e73 756d 2066 6f72 2063 2069 6e20 6672  nsum for c in fr
+0001e620: 6571 5f63 6f6c 737d 0a20 2020 2020 2020  eq_cols}.       
+0001e630: 206b 6565 705f 636f 6c73 203d 2028 0a20   keep_cols = (. 
+0001e640: 2020 2020 2020 2020 2020 2022 636f 6e74             "cont
+0001e650: 6967 222c 0a20 2020 2020 2020 2020 2020  ig",.           
+0001e660: 2022 7472 616e 7363 7269 7074 222c 0a20   "transcript",. 
+0001e670: 2020 2020 2020 2020 2020 2022 6161 5f70             "aa_p
+0001e680: 6f73 222c 0a20 2020 2020 2020 2020 2020  os",.           
+0001e690: 2022 7265 665f 616c 6c65 6c65 222c 0a20   "ref_allele",. 
+0001e6a0: 2020 2020 2020 2020 2020 2022 7265 665f             "ref_
+0001e6b0: 6161 222c 0a20 2020 2020 2020 2020 2020  aa",.           
+0001e6c0: 2022 616c 745f 6161 222c 0a20 2020 2020   "alt_aa",.     
+0001e6d0: 2020 2020 2020 2022 6566 6665 6374 222c         "effect",
+0001e6e0: 0a20 2020 2020 2020 2020 2020 2022 696d  .            "im
+0001e6f0: 7061 6374 222c 0a20 2020 2020 2020 2029  pact",.        )
+0001e700: 0a20 2020 2020 2020 2066 6f72 2063 2069  .        for c i
+0001e710: 6e20 6b65 6570 5f63 6f6c 733a 0a20 2020  n keep_cols:.   
+0001e720: 2020 2020 2020 2020 2061 6767 5b63 5d20           agg[c] 
+0001e730: 3d20 2266 6972 7374 220a 2020 2020 2020  = "first".      
+0001e740: 2020 6167 675b 2261 6c74 5f61 6c6c 656c    agg["alt_allel
+0001e750: 6522 5d20 3d20 6c61 6d62 6461 2076 3a20  e"] = lambda v: 
+0001e760: 227b 2220 2b20 222c 222e 6a6f 696e 2876  "{" + ",".join(v
+0001e770: 2920 2b20 227d 2220 6966 206c 656e 2876  ) + "}" if len(v
+0001e780: 2920 3e20 3120 656c 7365 2076 0a20 2020  ) > 1 else v.   
+0001e790: 2020 2020 2064 665f 6161 6620 3d20 6466       df_aaf = df
+0001e7a0: 5f6e 735f 736e 7073 2e67 726f 7570 6279  _ns_snps.groupby
+0001e7b0: 285b 2270 6f73 6974 696f 6e22 2c20 2261  (["position", "a
+0001e7c0: 615f 6368 616e 6765 225d 292e 6167 6728  a_change"]).agg(
+0001e7d0: 6167 6729 2e72 6573 6574 5f69 6e64 6578  agg).reset_index
+0001e7e0: 2829 0a0a 2020 2020 2020 2020 6465 6275  ()..        debu
+0001e7f0: 6728 2263 6f6d 7075 7465 206e 6577 206d  g("compute new m
+0001e800: 6178 5f61 6622 290a 2020 2020 2020 2020  ax_af").        
+0001e810: 6466 5f61 6166 5b22 6d61 785f 6166 225d  df_aaf["max_af"]
+0001e820: 203d 2064 665f 6161 665b 6672 6571 5f63   = df_aaf[freq_c
+0001e830: 6f6c 735d 2e6d 6178 2861 7869 733d 3129  ols].max(axis=1)
+0001e840: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001e850: 2261 6464 206c 6162 656c 2229 0a20 2020  "add label").   
+0001e860: 2020 2020 2064 665f 6161 665b 226c 6162       df_aaf["lab
+0001e870: 656c 225d 203d 2073 656c 662e 5f70 616e  el"] = self._pan
+0001e880: 6461 735f 6170 706c 7928 0a20 2020 2020  das_apply(.     
+0001e890: 2020 2020 2020 2073 656c 662e 5f6d 616b         self._mak
+0001e8a0: 655f 736e 705f 6c61 6265 6c5f 6161 2c0a  e_snp_label_aa,.
+0001e8b0: 2020 2020 2020 2020 2020 2020 6466 5f61              df_a
+0001e8c0: 6166 2c0a 2020 2020 2020 2020 2020 2020  af,.            
+0001e8d0: 636f 6c75 6d6e 733d 5b22 6161 5f63 6861  columns=["aa_cha
+0001e8e0: 6e67 6522 2c20 2263 6f6e 7469 6722 2c20  nge", "contig", 
+0001e8f0: 2270 6f73 6974 696f 6e22 2c20 2272 6566  "position", "ref
+0001e900: 5f61 6c6c 656c 6522 2c20 2261 6c74 5f61  _allele", "alt_a
+0001e910: 6c6c 656c 6522 5d2c 0a20 2020 2020 2020  llele"],.       
+0001e920: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
+0001e930: 6728 2273 6f72 7420 6279 2067 656e 6f6d  g("sort by genom
+0001e940: 6963 2070 6f73 6974 696f 6e22 290a 2020  ic position").  
+0001e950: 2020 2020 2020 6466 5f61 6166 203d 2064        df_aaf = d
+0001e960: 665f 6161 662e 736f 7274 5f76 616c 7565  f_aaf.sort_value
+0001e970: 7328 5b22 706f 7369 7469 6f6e 222c 2022  s(["position", "
+0001e980: 6161 5f63 6861 6e67 6522 5d29 0a0a 2020  aa_change"])..  
+0001e990: 2020 2020 2020 6465 6275 6728 2273 6574        debug("set
+0001e9a0: 2069 6e64 6578 2229 0a20 2020 2020 2020   index").       
+0001e9b0: 2064 665f 6161 662e 7365 745f 696e 6465   df_aaf.set_inde
+0001e9c0: 7828 5b22 6161 5f63 6861 6e67 6522 2c20  x(["aa_change", 
+0001e9d0: 2263 6f6e 7469 6722 2c20 2270 6f73 6974  "contig", "posit
+0001e9e0: 696f 6e22 5d2c 2069 6e70 6c61 6365 3d54  ion"], inplace=T
+0001e9f0: 7275 6529 0a0a 2020 2020 2020 2020 6465  rue)..        de
+0001ea00: 6275 6728 2261 6464 206d 6574 6164 6174  bug("add metadat
+0001ea10: 6122 290a 2020 2020 2020 2020 6765 6e65  a").        gene
+0001ea20: 5f6e 616d 6520 3d20 7365 6c66 2e5f 7472  _name = self._tr
+0001ea30: 616e 7363 7269 7074 5f74 6f5f 6765 6e65  anscript_to_gene
+0001ea40: 5f6e 616d 6528 7472 616e 7363 7269 7074  _name(transcript
+0001ea50: 290a 2020 2020 2020 2020 7469 746c 6520  ).        title 
+0001ea60: 3d20 7472 616e 7363 7269 7074 0a20 2020  = transcript.   
+0001ea70: 2020 2020 2069 6620 6765 6e65 5f6e 616d       if gene_nam
+0001ea80: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+0001ea90: 6974 6c65 202b 3d20 6622 2028 7b67 656e  itle += f" ({gen
+0001eaa0: 655f 6e61 6d65 7d29 220a 2020 2020 2020  e_name})".      
+0001eab0: 2020 7469 746c 6520 2b3d 2022 2053 4e50    title += " SNP
+0001eac0: 2066 7265 7175 656e 6369 6573 220a 2020   frequencies".  
+0001ead0: 2020 2020 2020 6466 5f61 6166 2e61 7474        df_aaf.att
+0001eae0: 7273 5b22 7469 746c 6522 5d20 3d20 7469  rs["title"] = ti
+0001eaf0: 746c 650a 0a20 2020 2020 2020 2072 6574  tle..        ret
+0001eb00: 7572 6e20 6466 5f61 6166 0a0a 2020 2020  urn df_aaf..    
+0001eb10: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
+0001eb20: 6d6d 6172 793d 2222 220a 2020 2020 2020  mmary=""".      
+0001eb30: 2020 2020 2020 4772 6f75 7020 7361 6d70        Group samp
+0001eb40: 6c65 7320 6279 2074 6178 6f6e 2c20 6172  les by taxon, ar
+0001eb50: 6561 2028 7370 6163 6529 2061 6e64 2070  ea (space) and p
+0001eb60: 6572 696f 6420 2874 696d 6529 2c20 7468  eriod (time), th
+0001eb70: 656e 2063 6f6d 7075 7465 0a20 2020 2020  en compute.     
+0001eb80: 2020 2020 2020 2061 6d69 6e6f 2061 6369         amino aci
+0001eb90: 6420 6368 616e 6765 2061 6c6c 656c 6520  d change allele 
+0001eba0: 6672 6571 7565 6e63 6965 732e 0a20 2020  frequencies..   
+0001ebb0: 2020 2020 2022 2222 2c0a 2020 2020 2020       """,.      
+0001ebc0: 2020 7265 7475 726e 733d 2222 220a 2020    returns=""".  
+0001ebd0: 2020 2020 2020 2020 2020 5468 6520 7265            The re
+0001ebe0: 7375 6c74 696e 6720 6461 7461 7365 7420  sulting dataset 
+0001ebf0: 636f 6e74 6169 6e73 2064 6174 6120 6861  contains data ha
+0001ec00: 7320 6469 6d65 6e73 696f 6e73 2022 636f  s dimensions "co
+0001ec10: 686f 7274 7322 2061 6e64 0a20 2020 2020  horts" and.     
+0001ec20: 2020 2020 2020 2022 7661 7269 616e 7473         "variants
+0001ec30: 222e 2056 6172 6961 626c 6573 2070 7265  ". Variables pre
+0001ec40: 6669 7865 6420 7769 7468 2022 636f 686f  fixed with "coho
+0001ec50: 7274 2220 6172 6520 312d 6469 6d65 6e73  rt" are 1-dimens
+0001ec60: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0001ec70: 2020 6172 7261 7973 2077 6974 6820 6461    arrays with da
+0001ec80: 7461 2061 626f 7574 2074 6865 2063 6f68  ta about the coh
+0001ec90: 6f72 7473 2c20 7375 6368 2061 7320 7468  orts, such as th
+0001eca0: 6520 6172 6561 2c20 7065 7269 6f64 2c20  e area, period, 
+0001ecb0: 7461 786f 6e0a 2020 2020 2020 2020 2020  taxon.          
+0001ecc0: 2020 616e 6420 636f 686f 7274 2073 697a    and cohort siz
+0001ecd0: 652e 2056 6172 6961 626c 6573 2070 7265  e. Variables pre
+0001ece0: 6669 7865 6420 7769 7468 2022 7661 7269  fixed with "vari
+0001ecf0: 616e 7422 2061 7265 0a20 2020 2020 2020  ant" are.       
+0001ed00: 2020 2020 2031 2d64 696d 656e 7369 6f6e       1-dimension
+0001ed10: 616c 2061 7272 6179 7320 7769 7468 2064  al arrays with d
+0001ed20: 6174 6120 6162 6f75 7420 7468 6520 7661  ata about the va
+0001ed30: 7269 616e 7473 2c20 7375 6368 2061 7320  riants, such as 
+0001ed40: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0001ed50: 636f 6e74 6967 2c20 706f 7369 7469 6f6e  contig, position
+0001ed60: 2c20 7265 6665 7265 6e63 6520 616e 6420  , reference and 
+0001ed70: 616c 7465 726e 6174 6520 616c 6c65 6c65  alternate allele
+0001ed80: 732e 2056 6172 6961 626c 6573 0a20 2020  s. Variables.   
+0001ed90: 2020 2020 2020 2020 2070 7265 6669 7865           prefixe
+0001eda0: 6420 7769 7468 2022 6576 656e 7422 2061  d with "event" a
+0001edb0: 7265 2032 2d64 696d 656e 7369 6f6e 616c  re 2-dimensional
+0001edc0: 2061 7272 6179 7320 7769 7468 2074 6865   arrays with the
+0001edd0: 2061 6c6c 656c 650a 2020 2020 2020 2020   allele.        
+0001ede0: 2020 2020 636f 756e 7473 2061 6e64 2066      counts and f
+0001edf0: 7265 7175 656e 6379 2063 616c 6375 6c61  requency calcula
+0001ee00: 7469 6f6e 732e 0a20 2020 2020 2020 2022  tions..        "
+0001ee10: 2222 2c0a 2020 2020 290a 2020 2020 6465  "",.    ).    de
+0001ee20: 6620 6161 5f61 6c6c 656c 655f 6672 6571  f aa_allele_freq
+0001ee30: 7565 6e63 6965 735f 6164 7661 6e63 6564  uencies_advanced
+0001ee40: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001ee50: 2020 2020 2020 2020 7472 616e 7363 7269          transcri
+0001ee60: 7074 3a20 6261 7365 5f70 6172 616d 732e  pt: base_params.
+0001ee70: 7472 616e 7363 7269 7074 2c0a 2020 2020  transcript,.    
+0001ee80: 2020 2020 6172 6561 5f62 793a 2066 7271      area_by: frq
+0001ee90: 5f70 6172 616d 732e 6172 6561 5f62 792c  _params.area_by,
+0001eea0: 0a20 2020 2020 2020 2070 6572 696f 645f  .        period_
+0001eeb0: 6279 3a20 6672 715f 7061 7261 6d73 2e70  by: frq_params.p
+0001eec0: 6572 696f 645f 6279 2c0a 2020 2020 2020  eriod_by,.      
+0001eed0: 2020 7361 6d70 6c65 5f73 6574 733a 204f    sample_sets: O
+0001eee0: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+0001eef0: 616d 732e 7361 6d70 6c65 5f73 6574 735d  ams.sample_sets]
+0001ef00: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001ef10: 2073 616d 706c 655f 7175 6572 793a 204f   sample_query: O
+0001ef20: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+0001ef30: 616d 732e 7361 6d70 6c65 5f71 7565 7279  ams.sample_query
+0001ef40: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0001ef50: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
+0001ef60: 653a 2062 6173 655f 7061 7261 6d73 2e6d  e: base_params.m
+0001ef70: 696e 5f63 6f68 6f72 745f 7369 7a65 203d  in_cohort_size =
+0001ef80: 2031 302c 0a20 2020 2020 2020 2076 6172   10,.        var
+0001ef90: 6961 6e74 5f71 7565 7279 3a20 4f70 7469  iant_query: Opti
+0001efa0: 6f6e 616c 5b66 7271 5f70 6172 616d 732e  onal[frq_params.
+0001efb0: 7661 7269 616e 745f 7175 6572 795d 203d  variant_query] =
+0001efc0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+0001efd0: 6974 655f 6d61 736b 3a20 4f70 7469 6f6e  ite_mask: Option
+0001efe0: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
+0001eff0: 6974 655f 6d61 736b 5d20 3d20 4e6f 6e65  ite_mask] = None
+0001f000: 2c0a 2020 2020 2020 2020 6e6f 6273 5f6d  ,.        nobs_m
+0001f010: 6f64 653a 2066 7271 5f70 6172 616d 732e  ode: frq_params.
+0001f020: 6e6f 6273 5f6d 6f64 6520 3d20 2263 616c  nobs_mode = "cal
+0001f030: 6c65 6422 2c0a 2020 2020 2020 2020 6369  led",.        ci
+0001f040: 5f6d 6574 686f 643a 204f 7074 696f 6e61  _method: Optiona
+0001f050: 6c5b 6672 715f 7061 7261 6d73 2e63 695f  l[frq_params.ci_
+0001f060: 6d65 7468 6f64 5d20 3d20 2277 696c 736f  method] = "wilso
+0001f070: 6e22 2c0a 2020 2020 2920 2d3e 2078 722e  n",.    ) -> xr.
+0001f080: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0001f090: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
+0001f0a0: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
+0001f0b0: 2020 6465 6275 6728 2262 6567 696e 2062    debug("begin b
+0001f0c0: 7920 636f 6d70 7574 696e 6720 534e 5020  y computing SNP 
+0001f0d0: 616c 6c65 6c65 2066 7265 7175 656e 6369  allele frequenci
+0001f0e0: 6573 2229 0a20 2020 2020 2020 2064 735f  es").        ds_
+0001f0f0: 736e 705f 6672 7120 3d20 7365 6c66 2e73  snp_frq = self.s
+0001f100: 6e70 5f61 6c6c 656c 655f 6672 6571 7565  np_allele_freque
+0001f110: 6e63 6965 735f 6164 7661 6e63 6564 280a  ncies_advanced(.
+0001f120: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+0001f130: 7363 7269 7074 3d74 7261 6e73 6372 6970  script=transcrip
+0001f140: 742c 0a20 2020 2020 2020 2020 2020 2061  t,.            a
+0001f150: 7265 615f 6279 3d61 7265 615f 6279 2c0a  rea_by=area_by,.
+0001f160: 2020 2020 2020 2020 2020 2020 7065 7269              peri
+0001f170: 6f64 5f62 793d 7065 7269 6f64 5f62 792c  od_by=period_by,
+0001f180: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+0001f190: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
+0001f1a0: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
+0001f1b0: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
+0001f1c0: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+0001f1d0: 2020 2020 2020 2020 206d 696e 5f63 6f68           min_coh
+0001f1e0: 6f72 745f 7369 7a65 3d6d 696e 5f63 6f68  ort_size=min_coh
+0001f1f0: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
+0001f200: 2020 2020 2020 6472 6f70 5f69 6e76 6172        drop_invar
+0001f210: 6961 6e74 3d54 7275 652c 2020 2320 616c  iant=True,  # al
+0001f220: 7761 7973 2064 726f 7020 696e 7661 7269  ways drop invari
+0001f230: 616e 7420 666f 7220 6161 2066 7265 7175  ant for aa frequ
+0001f240: 656e 6369 6573 0a20 2020 2020 2020 2020  encies.         
+0001f250: 2020 2076 6172 6961 6e74 5f71 7565 7279     variant_query
+0001f260: 3d41 415f 4348 414e 4745 5f51 5545 5259  =AA_CHANGE_QUERY
+0001f270: 2c20 2023 2077 6527 6c6c 2061 6c73 6f20  ,  # we'll also 
+0001f280: 6170 706c 7920 6120 7661 7269 616e 7420  apply a variant 
+0001f290: 7175 6572 7920 6c61 7465 720a 2020 2020  query later.    
+0001f2a0: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
+0001f2b0: 6b3d 7369 7465 5f6d 6173 6b2c 0a20 2020  k=site_mask,.   
+0001f2c0: 2020 2020 2020 2020 206e 6f62 735f 6d6f           nobs_mo
+0001f2d0: 6465 3d6e 6f62 735f 6d6f 6465 2c0a 2020  de=nobs_mode,.  
+0001f2e0: 2020 2020 2020 2020 2020 6369 5f6d 6574            ci_met
+0001f2f0: 686f 643d 4e6f 6e65 2c20 2023 2077 6520  hod=None,  # we 
+0001f300: 7769 6c6c 2072 6563 6f6d 7075 7465 2063  will recompute c
+0001f310: 6f6e 6669 6465 6e63 6520 696e 7465 7276  onfidence interv
+0001f320: 616c 7320 6c61 7465 720a 2020 2020 2020  als later.      
+0001f330: 2020 290a 0a20 2020 2020 2020 2023 204e    )..        # N
+0001f340: 2e42 2e2c 2077 6520 6e65 6564 2074 6f20  .B., we need to 
+0001f350: 776f 7272 7920 6162 6f75 7420 7468 6520  worry about the 
+0001f360: 706f 7373 6962 696c 6974 7920 6f66 2074  possibility of t
+0001f370: 6865 0a20 2020 2020 2020 2023 2073 616d  he.        # sam
+0001f380: 6520 6161 2063 6861 6e67 6520 6475 6520  e aa change due 
+0001f390: 746f 2053 4e50 7320 6174 2064 6966 6665  to SNPs at diffe
+0001f3a0: 7265 6e74 2070 6f73 6974 696f 6e73 2e20  rent positions. 
+0001f3b0: 5765 2063 616e 6e6f 740a 2020 2020 2020  We cannot.      
+0001f3c0: 2020 2320 7375 6d20 6672 6571 7565 6e63    # sum frequenc
+0001f3d0: 6965 7320 6f66 2053 4e50 7320 6174 2064  ies of SNPs at d
+0001f3e0: 6966 6665 7265 6e74 2067 656e 6f6d 6963  ifferent genomic
+0001f3f0: 2070 6f73 6974 696f 6e73 2e20 5468 6973   positions. This
+0001f400: 0a20 2020 2020 2020 2023 2069 7320 7768  .        # is wh
+0001f410: 7920 7765 2067 726f 7570 2062 7920 706f  y we group by po
+0001f420: 7369 7469 6f6e 2061 6e64 2061 615f 6368  sition and aa_ch
+0001f430: 616e 6765 2c20 6e6f 7420 6a75 7374 2061  ange, not just a
+0001f440: 615f 6368 616e 6765 2e0a 0a20 2020 2020  a_change...     
+0001f450: 2020 2023 2061 6464 2069 6e20 6120 7370     # add in a sp
+0001f460: 6563 6961 6c20 6772 6f75 7069 6e67 2063  ecial grouping c
+0001f470: 6f6c 756d 6e20 746f 2077 6f72 6b20 6172  olumn to work ar
+0001f480: 6f75 6e64 2074 6865 2066 6163 7420 7468  ound the fact th
+0001f490: 6174 2078 6172 7261 7920 6375 7272 656e  at xarray curren
+0001f4a0: 746c 790a 2020 2020 2020 2020 2320 646f  tly.        # do
+0001f4b0: 6573 6e27 7420 7375 7070 6f72 7420 6772  esn't support gr
+0001f4c0: 6f75 7069 6e67 2062 7920 6d75 6c74 6970  ouping by multip
+0001f4d0: 6c65 2076 6172 6961 626c 6573 2069 6e20  le variables in 
+0001f4e0: 7468 6520 7361 6d65 2064 696d 656e 7369  the same dimensi
+0001f4f0: 6f6e 0a20 2020 2020 2020 2064 665f 6772  on.        df_gr
+0001f500: 6f75 7065 7220 3d20 6473 5f73 6e70 5f66  ouper = ds_snp_f
+0001f510: 7271 5b0a 2020 2020 2020 2020 2020 2020  rq[.            
+0001f520: 5b22 7661 7269 616e 745f 706f 7369 7469  ["variant_positi
+0001f530: 6f6e 222c 2022 7661 7269 616e 745f 6161  on", "variant_aa
+0001f540: 5f63 6861 6e67 6522 5d0a 2020 2020 2020  _change"].      
+0001f550: 2020 5d2e 746f 5f64 6174 6166 7261 6d65    ].to_dataframe
+0001f560: 2829 0a20 2020 2020 2020 2067 726f 7570  ().        group
+0001f570: 6572 5f76 6172 203d 2064 665f 6772 6f75  er_var = df_grou
+0001f580: 7065 722e 6170 706c 7928 0a20 2020 2020  per.apply(.     
+0001f590: 2020 2020 2020 206c 616d 6264 6120 726f         lambda ro
+0001f5a0: 773a 2022 5f22 2e6a 6f69 6e28 5b73 7472  w: "_".join([str
+0001f5b0: 2876 2920 666f 7220 7620 696e 2072 6f77  (v) for v in row
+0001f5c0: 5d29 2c20 6178 6973 3d22 636f 6c75 6d6e  ]), axis="column
+0001f5d0: 7322 0a20 2020 2020 2020 2029 0a20 2020  s".        ).   
+0001f5e0: 2020 2020 2064 735f 736e 705f 6672 715b       ds_snp_frq[
+0001f5f0: 2276 6172 6961 6e74 5f70 6f73 6974 696f  "variant_positio
+0001f600: 6e5f 6161 5f63 6861 6e67 6522 5d20 3d20  n_aa_change"] = 
+0001f610: 2276 6172 6961 6e74 7322 2c20 6772 6f75  "variants", grou
+0001f620: 7065 725f 7661 720a 0a20 2020 2020 2020  per_var..       
+0001f630: 2064 6562 7567 2822 6772 6f75 7020 6279   debug("group by
+0001f640: 2070 6f73 6974 696f 6e20 616e 6420 616d   position and am
+0001f650: 696e 6f20 6163 6964 2063 6861 6e67 6522  ino acid change"
+0001f660: 290a 2020 2020 2020 2020 6772 6f75 705f  ).        group_
+0001f670: 6279 5f61 615f 6368 616e 6765 203d 2064  by_aa_change = d
+0001f680: 735f 736e 705f 6672 712e 6772 6f75 7062  s_snp_frq.groupb
+0001f690: 7928 2276 6172 6961 6e74 5f70 6f73 6974  y("variant_posit
+0001f6a0: 696f 6e5f 6161 5f63 6861 6e67 6522 290a  ion_aa_change").
+0001f6b0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0001f6c0: 6170 706c 7920 6167 6772 6567 6174 696f  apply aggregatio
+0001f6d0: 6e22 290a 2020 2020 2020 2020 6473 5f61  n").        ds_a
+0001f6e0: 615f 6672 7120 3d20 6772 6f75 705f 6279  a_frq = group_by
+0001f6f0: 5f61 615f 6368 616e 6765 2e6d 6170 2873  _aa_change.map(s
+0001f700: 656c 662e 5f6d 6170 5f73 6e70 5f74 6f5f  elf._map_snp_to_
+0001f710: 6161 5f63 6861 6e67 655f 6672 715f 6473  aa_change_frq_ds
+0001f720: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+0001f730: 2822 6164 6420 6261 636b 2069 6e20 636f  ("add back in co
+0001f740: 686f 7274 2076 6172 6961 626c 6573 2c20  hort variables, 
+0001f750: 756e 6166 6665 6374 6564 2062 7920 6167  unaffected by ag
+0001f760: 6772 6567 6174 696f 6e22 290a 2020 2020  gregation").    
+0001f770: 2020 2020 636f 686f 7274 5f76 6172 7320      cohort_vars 
+0001f780: 3d20 5b76 2066 6f72 2076 2069 6e20 6473  = [v for v in ds
+0001f790: 5f73 6e70 5f66 7271 2069 6620 762e 7374  _snp_frq if v.st
+0001f7a0: 6172 7473 7769 7468 2822 636f 686f 7274  artswith("cohort
+0001f7b0: 5f22 295d 0a20 2020 2020 2020 2066 6f72  _")].        for
+0001f7c0: 2076 2069 6e20 636f 686f 7274 5f76 6172   v in cohort_var
+0001f7d0: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
+0001f7e0: 735f 6161 5f66 7271 5b76 5d20 3d20 6473  s_aa_frq[v] = ds
+0001f7f0: 5f73 6e70 5f66 7271 5b76 5d0a 0a20 2020  _snp_frq[v]..   
+0001f800: 2020 2020 2064 6562 7567 2822 736f 7274       debug("sort
+0001f810: 2062 7920 6765 6e6f 6d69 6320 706f 7369   by genomic posi
+0001f820: 7469 6f6e 2229 0a20 2020 2020 2020 2064  tion").        d
+0001f830: 735f 6161 5f66 7271 203d 2064 735f 6161  s_aa_frq = ds_aa
+0001f840: 5f66 7271 2e73 6f72 7462 7928 5b22 7661  _frq.sortby(["va
+0001f850: 7269 616e 745f 706f 7369 7469 6f6e 222c  riant_position",
+0001f860: 2022 7661 7269 616e 745f 6161 5f63 6861   "variant_aa_cha
+0001f870: 6e67 6522 5d29 0a0a 2020 2020 2020 2020  nge"])..        
+0001f880: 6465 6275 6728 2272 6563 6f6d 7075 7465  debug("recompute
+0001f890: 2066 7265 7175 656e 6379 2229 0a20 2020   frequency").   
+0001f8a0: 2020 2020 2063 6f75 6e74 203d 2064 735f       count = ds_
+0001f8b0: 6161 5f66 7271 5b22 6576 656e 745f 636f  aa_frq["event_co
+0001f8c0: 756e 7422 5d2e 7661 6c75 6573 0a20 2020  unt"].values.   
+0001f8d0: 2020 2020 206e 6f62 7320 3d20 6473 5f61       nobs = ds_a
+0001f8e0: 615f 6672 715b 2265 7665 6e74 5f6e 6f62  a_frq["event_nob
+0001f8f0: 7322 5d2e 7661 6c75 6573 0a20 2020 2020  s"].values.     
+0001f900: 2020 2077 6974 6820 6e70 2e65 7272 7374     with np.errst
+0001f910: 6174 6528 6469 7669 6465 3d22 6967 6e6f  ate(divide="igno
+0001f920: 7265 222c 2069 6e76 616c 6964 3d22 6967  re", invalid="ig
+0001f930: 6e6f 7265 2229 3a0a 2020 2020 2020 2020  nore"):.        
+0001f940: 2020 2020 6672 6571 7565 6e63 7920 3d20      frequency = 
+0001f950: 636f 756e 7420 2f20 6e6f 6273 2020 2320  count / nobs  # 
+0001f960: 6967 6e6f 7265 2064 6976 6973 696f 6e20  ignore division 
+0001f970: 7761 726e 696e 6773 0a20 2020 2020 2020  warnings.       
+0001f980: 2064 735f 6161 5f66 7271 5b22 6576 656e   ds_aa_frq["even
+0001f990: 745f 6672 6571 7565 6e63 7922 5d20 3d20  t_frequency"] = 
+0001f9a0: 2822 7661 7269 616e 7473 222c 2022 636f  ("variants", "co
+0001f9b0: 686f 7274 7322 292c 2066 7265 7175 656e  horts"), frequen
+0001f9c0: 6379 0a0a 2020 2020 2020 2020 6465 6275  cy..        debu
+0001f9d0: 6728 2272 6563 6f6d 7075 7465 206d 6178  g("recompute max
+0001f9e0: 2066 7265 7175 656e 6379 206f 7665 7220   frequency over 
+0001f9f0: 636f 686f 7274 7322 290a 2020 2020 2020  cohorts").      
+0001fa00: 2020 7769 7468 2077 6172 6e69 6e67 732e    with warnings.
+0001fa10: 6361 7463 685f 7761 726e 696e 6773 2829  catch_warnings()
+0001fa20: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001fa30: 6967 6e6f 7265 2022 416c 6c2d 4e61 4e20  ignore "All-NaN 
+0001fa40: 736c 6963 6520 656e 636f 756e 7465 7265  slice encountere
+0001fa50: 6422 2077 6172 6e69 6e67 730a 2020 2020  d" warnings.    
+0001fa60: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+0001fa70: 2e73 696d 706c 6566 696c 7465 7228 2269  .simplefilter("i
+0001fa80: 676e 6f72 6522 2c20 6361 7465 676f 7279  gnore", category
+0001fa90: 3d52 756e 7469 6d65 5761 726e 696e 6729  =RuntimeWarning)
+0001faa0: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+0001fab0: 5f61 6620 3d20 6e70 2e6e 616e 6d61 7828  _af = np.nanmax(
+0001fac0: 6473 5f61 615f 6672 715b 2265 7665 6e74  ds_aa_frq["event
+0001fad0: 5f66 7265 7175 656e 6379 225d 2e76 616c  _frequency"].val
+0001fae0: 7565 732c 2061 7869 733d 3129 0a20 2020  ues, axis=1).   
+0001faf0: 2020 2020 2064 735f 6161 5f66 7271 5b22       ds_aa_frq["
+0001fb00: 7661 7269 616e 745f 6d61 785f 6166 225d  variant_max_af"]
+0001fb10: 203d 2022 7661 7269 616e 7473 222c 206d   = "variants", m
+0001fb20: 6178 5f61 660a 0a20 2020 2020 2020 2064  ax_af..        d
+0001fb30: 6562 7567 2822 7365 7420 7570 2076 6172  ebug("set up var
+0001fb40: 6961 6e74 2064 6174 6166 7261 6d65 2c20  iant dataframe, 
+0001fb50: 7573 6566 756c 2069 6e74 6572 6d65 6469  useful intermedi
+0001fb60: 6174 6522 290a 2020 2020 2020 2020 7661  ate").        va
+0001fb70: 7269 616e 745f 636f 6c73 203d 205b 7620  riant_cols = [v 
+0001fb80: 666f 7220 7620 696e 2064 735f 6161 5f66  for v in ds_aa_f
+0001fb90: 7271 2069 6620 762e 7374 6172 7473 7769  rq if v.startswi
+0001fba0: 7468 2822 7661 7269 616e 745f 2229 5d0a  th("variant_")].
+0001fbb0: 2020 2020 2020 2020 6466 5f76 6172 6961          df_varia
+0001fbc0: 6e74 7320 3d20 6473 5f61 615f 6672 715b  nts = ds_aa_frq[
+0001fbd0: 7661 7269 616e 745f 636f 6c73 5d2e 746f  variant_cols].to
+0001fbe0: 5f64 6174 6166 7261 6d65 2829 0a20 2020  _dataframe().   
+0001fbf0: 2020 2020 2064 665f 7661 7269 616e 7473       df_variants
+0001fc00: 2e63 6f6c 756d 6e73 203d 205b 632e 7370  .columns = [c.sp
+0001fc10: 6c69 7428 2276 6172 6961 6e74 5f22 295b  lit("variant_")[
+0001fc20: 315d 2066 6f72 2063 2069 6e20 6466 5f76  1] for c in df_v
+0001fc30: 6172 6961 6e74 732e 636f 6c75 6d6e 735d  ariants.columns]
+0001fc40: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001fc50: 2261 7373 6967 6e20 6e65 7720 7661 7269  "assign new vari
+0001fc60: 616e 7420 6c61 6265 6c22 290a 2020 2020  ant label").    
+0001fc70: 2020 2020 6c61 6265 6c20 3d20 7365 6c66      label = self
+0001fc80: 2e5f 7061 6e64 6173 5f61 7070 6c79 280a  ._pandas_apply(.
+0001fc90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001fca0: 2e5f 6d61 6b65 5f73 6e70 5f6c 6162 656c  ._make_snp_label
+0001fcb0: 5f61 612c 0a20 2020 2020 2020 2020 2020  _aa,.           
+0001fcc0: 2064 665f 7661 7269 616e 7473 2c0a 2020   df_variants,.  
+0001fcd0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+0001fce0: 733d 5b22 6161 5f63 6861 6e67 6522 2c20  s=["aa_change", 
+0001fcf0: 2263 6f6e 7469 6722 2c20 2270 6f73 6974  "contig", "posit
+0001fd00: 696f 6e22 2c20 2272 6566 5f61 6c6c 656c  ion", "ref_allel
+0001fd10: 6522 2c20 2261 6c74 5f61 6c6c 656c 6522  e", "alt_allele"
+0001fd20: 5d2c 0a20 2020 2020 2020 2029 0a20 2020  ],.        ).   
+0001fd30: 2020 2020 2064 735f 6161 5f66 7271 5b22       ds_aa_frq["
+0001fd40: 7661 7269 616e 745f 6c61 6265 6c22 5d20  variant_label"] 
+0001fd50: 3d20 2276 6172 6961 6e74 7322 2c20 6c61  = "variants", la
+0001fd60: 6265 6c0a 0a20 2020 2020 2020 2064 6562  bel..        deb
+0001fd70: 7567 2822 6170 706c 7920 7661 7269 616e  ug("apply varian
+0001fd80: 7420 7175 6572 7920 6966 2067 6976 656e  t query if given
+0001fd90: 2229 0a20 2020 2020 2020 2069 6620 7661  ").        if va
+0001fda0: 7269 616e 745f 7175 6572 7920 6973 206e  riant_query is n
+0001fdb0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001fdc0: 2020 2020 206c 6f63 5f76 6172 6961 6e74       loc_variant
+0001fdd0: 7320 3d20 6466 5f76 6172 6961 6e74 732e  s = df_variants.
+0001fde0: 6576 616c 2876 6172 6961 6e74 5f71 7565  eval(variant_que
+0001fdf0: 7279 292e 7661 6c75 6573 0a20 2020 2020  ry).values.     
+0001fe00: 2020 2020 2020 2064 735f 6161 5f66 7271         ds_aa_frq
+0001fe10: 203d 2064 735f 6161 5f66 7271 2e69 7365   = ds_aa_frq.ise
+0001fe20: 6c28 7661 7269 616e 7473 3d6c 6f63 5f76  l(variants=loc_v
+0001fe30: 6172 6961 6e74 7329 0a0a 2020 2020 2020  ariants)..      
+0001fe40: 2020 6465 6275 6728 2263 6f6d 7075 7465    debug("compute
+0001fe50: 206e 6577 2063 6f6e 6669 6465 6e63 6520   new confidence 
+0001fe60: 696e 7465 7276 616c 7322 290a 2020 2020  intervals").    
+0001fe70: 2020 2020 7365 6c66 2e5f 6164 645f 6672      self._add_fr
+0001fe80: 6571 7565 6e63 795f 6369 2864 735f 6161  equency_ci(ds_aa
+0001fe90: 5f66 7271 2c20 6369 5f6d 6574 686f 6429  _frq, ci_method)
+0001fea0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0001feb0: 2274 6964 7920 7570 2064 6973 706c 6179  "tidy up display
+0001fec0: 2062 7920 736f 7274 696e 6720 7661 7269   by sorting vari
+0001fed0: 6162 6c65 7322 290a 2020 2020 2020 2020  ables").        
+0001fee0: 6473 5f61 615f 6672 7120 3d20 6473 5f61  ds_aa_frq = ds_a
+0001fef0: 615f 6672 715b 736f 7274 6564 2864 735f  a_frq[sorted(ds_
+0001ff00: 6161 5f66 7271 295d 0a0a 2020 2020 2020  aa_frq)]..      
+0001ff10: 2020 6765 6e65 5f6e 616d 6520 3d20 7365    gene_name = se
+0001ff20: 6c66 2e5f 7472 616e 7363 7269 7074 5f74  lf._transcript_t
+0001ff30: 6f5f 6765 6e65 5f6e 616d 6528 7472 616e  o_gene_name(tran
+0001ff40: 7363 7269 7074 290a 2020 2020 2020 2020  script).        
+0001ff50: 7469 746c 6520 3d20 7472 616e 7363 7269  title = transcri
+0001ff60: 7074 0a20 2020 2020 2020 2069 6620 6765  pt.        if ge
+0001ff70: 6e65 5f6e 616d 653a 0a20 2020 2020 2020  ne_name:.       
+0001ff80: 2020 2020 2074 6974 6c65 202b 3d20 6622       title += f"
+0001ff90: 2028 7b67 656e 655f 6e61 6d65 7d29 220a   ({gene_name})".
+0001ffa0: 2020 2020 2020 2020 7469 746c 6520 2b3d          title +=
+0001ffb0: 2022 2053 4e50 2066 7265 7175 656e 6369   " SNP frequenci
+0001ffc0: 6573 220a 2020 2020 2020 2020 6473 5f61  es".        ds_a
+0001ffd0: 615f 6672 712e 6174 7472 735b 2274 6974  a_frq.attrs["tit
+0001ffe0: 6c65 225d 203d 2074 6974 6c65 0a0a 2020  le"] = title..  
+0001fff0: 2020 2020 2020 7265 7475 726e 2064 735f        return ds_
+00020000: 6161 5f66 7271 0a0a 2020 2020 6465 6620  aa_frq..    def 
+00020010: 5f62 6c6f 636b 5f6a 6163 6b6b 6e69 6665  _block_jackknife
+00020020: 5f63 6f68 6f72 745f 6469 7665 7273 6974  _cohort_diversit
+00020030: 795f 7374 6174 7328 0a20 2020 2020 2020  y_stats(.       
+00020040: 2073 656c 662c 202a 2c20 636f 686f 7274   self, *, cohort
+00020050: 5f6c 6162 656c 2c20 6163 2c20 6e5f 6a61  _label, ac, n_ja
+00020060: 636b 2c20 636f 6e66 6964 656e 6365 5f6c  ck, confidence_l
+00020070: 6576 656c 0a20 2020 2029 3a0a 2020 2020  evel.    ):.    
+00020080: 2020 2020 6465 6275 6720 3d20 7365 6c66      debug = self
+00020090: 2e5f 6c6f 672e 6465 6275 670a 0a20 2020  ._log.debug..   
+000200a0: 2020 2020 2064 6562 7567 2822 7365 7420       debug("set 
+000200b0: 7570 2066 6f72 2064 6976 6572 7369 7479  up for diversity
+000200c0: 2063 616c 6375 6c61 7469 6f6e 7322 290a   calculations").
+000200d0: 2020 2020 2020 2020 6e5f 7369 7465 7320          n_sites 
+000200e0: 3d20 6163 2e73 6861 7065 5b30 5d0a 2020  = ac.shape[0].  
+000200f0: 2020 2020 2020 6163 203d 2061 6c6c 656c        ac = allel
+00020100: 2e41 6c6c 656c 6543 6f75 6e74 7341 7272  .AlleleCountsArr
+00020110: 6179 2861 6329 0a20 2020 2020 2020 206e  ay(ac).        n
+00020120: 203d 2061 632e 7375 6d28 6178 6973 3d31   = ac.sum(axis=1
+00020130: 292e 6d61 7828 2920 2023 206e 756d 6265  ).max()  # numbe
+00020140: 7220 6f66 2063 6872 6f6d 6f73 6f6d 6573  r of chromosomes
+00020150: 2073 616d 706c 6564 0a20 2020 2020 2020   sampled.       
+00020160: 206e 5f73 6974 6573 203d 206d 696e 286e   n_sites = min(n
+00020170: 5f73 6974 6573 2c20 6163 2e73 6861 7065  _sites, ac.shape
+00020180: 5b30 5d29 2020 2320 6e75 6d62 6572 206f  [0])  # number o
+00020190: 6620 7369 7465 730a 2020 2020 2020 2020  f sites.        
+000201a0: 626c 6f63 6b5f 6c65 6e67 7468 203d 206e  block_length = n
+000201b0: 5f73 6974 6573 202f 2f20 6e5f 6a61 636b  _sites // n_jack
+000201c0: 2020 2320 6e75 6d62 6572 206f 6620 7369    # number of si
+000201d0: 7465 7320 696e 2065 6163 6820 626c 6f63  tes in each bloc
+000201e0: 6b0a 2020 2020 2020 2020 6e5f 7369 7465  k.        n_site
+000201f0: 735f 6a20 3d20 6e5f 7369 7465 7320 2d20  s_j = n_sites - 
+00020200: 626c 6f63 6b5f 6c65 6e67 7468 2020 2320  block_length  # 
+00020210: 6e75 6d62 6572 206f 6620 7369 7465 7320  number of sites 
+00020220: 696e 2065 6163 6820 6a61 636b 6b6e 6966  in each jackknif
+00020230: 6520 7265 7361 6d70 6c65 0a0a 2020 2020  e resample..    
+00020240: 2020 2020 6465 6275 6728 2263 6f6d 7075      debug("compu
+00020250: 7465 2073 6361 6c69 6e67 2063 6f6e 7374  te scaling const
+00020260: 616e 7473 2229 0a20 2020 2020 2020 2061  ants").        a
+00020270: 3120 3d20 6e70 2e73 756d 2831 202f 206e  1 = np.sum(1 / n
+00020280: 702e 6172 616e 6765 2831 2c20 6e29 290a  p.arange(1, n)).
+00020290: 2020 2020 2020 2020 6132 203d 206e 702e          a2 = np.
+000202a0: 7375 6d28 3120 2f20 286e 702e 6172 616e  sum(1 / (np.aran
+000202b0: 6765 2831 2c20 6e29 202a 2a20 3229 290a  ge(1, n) ** 2)).
+000202c0: 2020 2020 2020 2020 6231 203d 2028 6e20          b1 = (n 
+000202d0: 2b20 3129 202f 2028 3320 2a20 286e 202d  + 1) / (3 * (n -
+000202e0: 2031 2929 0a20 2020 2020 2020 2062 3220   1)).        b2 
+000202f0: 3d20 3220 2a20 286e 2a2a 3220 2b20 6e20  = 2 * (n**2 + n 
+00020300: 2b20 3329 202f 2028 3920 2a20 6e20 2a20  + 3) / (9 * n * 
+00020310: 286e 202d 2031 2929 0a20 2020 2020 2020  (n - 1)).       
+00020320: 2063 3120 3d20 6231 202d 2028 3120 2f20   c1 = b1 - (1 / 
+00020330: 6131 290a 2020 2020 2020 2020 6332 203d  a1).        c2 =
+00020340: 2062 3220 2d20 2828 6e20 2b20 3229 202f   b2 - ((n + 2) /
+00020350: 2028 6131 202a 206e 2929 202b 2028 6132   (a1 * n)) + (a2
+00020360: 202f 2028 6131 2a2a 3229 290a 2020 2020   / (a1**2)).    
+00020370: 2020 2020 6531 203d 2063 3120 2f20 6131      e1 = c1 / a1
+00020380: 0a20 2020 2020 2020 2065 3220 3d20 6332  .        e2 = c2
+00020390: 202f 2028 6131 2a2a 3220 2b20 6132 290a   / (a1**2 + a2).
+000203a0: 0a20 2020 2020 2020 2064 6562 7567 280a  .        debug(.
+000203b0: 2020 2020 2020 2020 2020 2020 2263 6f6d              "com
+000203c0: 7075 7465 2073 6f6d 6520 696e 7465 726d  pute some interm
+000203d0: 6564 6961 7465 7320 6168 6561 6420 6f66  ediates ahead of
+000203e0: 2074 696d 652c 2074 6f20 6d69 6e69 6d69   time, to minimi
+000203f0: 7365 2063 6f6d 7075 7461 7469 6f6e 2064  se computation d
+00020400: 7572 696e 6720 6a61 636b 6b6e 6966 6520  uring jackknife 
+00020410: 7265 7361 6d70 6c69 6e67 220a 2020 2020  resampling".    
+00020420: 2020 2020 290a 2020 2020 2020 2020 6d70      ).        mp
+00020430: 645f 6461 7461 203d 2061 6c6c 656c 2e6d  d_data = allel.m
+00020440: 6561 6e5f 7061 6972 7769 7365 5f64 6966  ean_pairwise_dif
+00020450: 6665 7265 6e63 6528 6163 2c20 6669 6c6c  ference(ac, fill
+00020460: 3d30 290a 2020 2020 2020 2020 2320 4e2e  =0).        # N.
+00020470: 422e 2c20 6865 7265 2077 6520 636f 6d70  B., here we comp
+00020480: 7574 6520 7468 6520 6e75 6d62 6572 206f  ute the number o
+00020490: 6620 7365 6772 6567 6174 696e 6720 7369  f segregating si
+000204a0: 7465 7320 6173 2074 6865 206e 756d 6265  tes as the numbe
+000204b0: 720a 2020 2020 2020 2020 2320 6f66 2061  r.        # of a
+000204c0: 6c6c 656c 6573 206d 696e 7573 2031 2e20  lleles minus 1. 
+000204d0: 5468 6973 2066 6f6c 6c6f 7773 2074 6865  This follows the
+000204e0: 2073 676b 6974 2061 6e64 2074 736b 6974   sgkit and tskit
+000204f0: 2069 6d70 6c65 6d65 6e74 6174 696f 6e73   implementations
+00020500: 2c0a 2020 2020 2020 2020 2320 616e 6420  ,.        # and 
+00020510: 6973 2064 6966 6665 7265 6e74 2066 726f  is different fro
+00020520: 6d20 7363 696b 6974 2d61 6c6c 656c 2e0a  m scikit-allel..
+00020530: 2020 2020 2020 2020 7365 675f 6461 7461          seg_data
+00020540: 203d 2061 632e 616c 6c65 6c69 736d 2829   = ac.allelism()
+00020550: 202d 2031 0a0a 2020 2020 2020 2020 6465   - 1..        de
+00020560: 6275 6728 2263 6f6d 7075 7465 2065 7374  bug("compute est
+00020570: 696d 6174 6573 2066 726f 6d20 616c 6c20  imates from all 
+00020580: 6461 7461 2229 0a20 2020 2020 2020 2074  data").        t
+00020590: 6865 7461 5f70 695f 6162 735f 6461 7461  heta_pi_abs_data
+000205a0: 203d 206e 702e 7375 6d28 6d70 645f 6461   = np.sum(mpd_da
+000205b0: 7461 290a 2020 2020 2020 2020 7468 6574  ta).        thet
+000205c0: 615f 7069 5f64 6174 6120 3d20 7468 6574  a_pi_data = thet
+000205d0: 615f 7069 5f61 6273 5f64 6174 6120 2f20  a_pi_abs_data / 
+000205e0: 6e5f 7369 7465 730a 2020 2020 2020 2020  n_sites.        
+000205f0: 535f 6461 7461 203d 206e 702e 7375 6d28  S_data = np.sum(
+00020600: 7365 675f 6461 7461 290a 2020 2020 2020  seg_data).      
+00020610: 2020 7468 6574 615f 775f 6162 735f 6461    theta_w_abs_da
+00020620: 7461 203d 2053 5f64 6174 6120 2f20 6131  ta = S_data / a1
+00020630: 0a20 2020 2020 2020 2074 6865 7461 5f77  .        theta_w
+00020640: 5f64 6174 6120 3d20 7468 6574 615f 775f  _data = theta_w_
+00020650: 6162 735f 6461 7461 202f 206e 5f73 6974  abs_data / n_sit
+00020660: 6573 0a20 2020 2020 2020 2064 5f64 6174  es.        d_dat
+00020670: 6120 3d20 7468 6574 615f 7069 5f61 6273  a = theta_pi_abs
+00020680: 5f64 6174 6120 2d20 7468 6574 615f 775f  _data - theta_w_
+00020690: 6162 735f 6461 7461 0a20 2020 2020 2020  abs_data.       
+000206a0: 2064 5f73 7464 6576 5f64 6174 6120 3d20   d_stdev_data = 
+000206b0: 6e70 2e73 7172 7428 2865 3120 2a20 535f  np.sqrt((e1 * S_
+000206c0: 6461 7461 2920 2b20 2865 3220 2a20 535f  data) + (e2 * S_
+000206d0: 6461 7461 202a 2028 535f 6461 7461 202d  data * (S_data -
+000206e0: 2031 2929 290a 2020 2020 2020 2020 7461   1))).        ta
+000206f0: 6a69 6d61 5f64 5f64 6174 6120 3d20 645f  jima_d_data = d_
+00020700: 6461 7461 202f 2064 5f73 7464 6576 5f64  data / d_stdev_d
+00020710: 6174 610a 0a20 2020 2020 2020 2064 6562  ata..        deb
+00020720: 7567 2822 7365 7420 7570 2066 6f72 206a  ug("set up for j
+00020730: 6163 6b6b 6e69 6665 2072 6573 616d 706c  ackknife resampl
+00020740: 696e 6722 290a 2020 2020 2020 2020 6a61  ing").        ja
+00020750: 636b 5f74 6865 7461 5f70 6920 3d20 5b5d  ck_theta_pi = []
+00020760: 0a20 2020 2020 2020 206a 6163 6b5f 7468  .        jack_th
+00020770: 6574 615f 7720 3d20 5b5d 0a20 2020 2020  eta_w = [].     
+00020780: 2020 206a 6163 6b5f 7461 6a69 6d61 5f64     jack_tajima_d
+00020790: 203d 205b 5d0a 0a20 2020 2020 2020 2064   = []..        d
+000207a0: 6562 7567 2822 6265 6769 6e20 6a61 636b  ebug("begin jack
+000207b0: 6b6e 6966 6520 7265 7361 6d70 6c69 6e67  knife resampling
+000207c0: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
+000207d0: 2069 6e20 7261 6e67 6528 6e5f 6a61 636b   in range(n_jack
+000207e0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+000207f0: 206c 6f63 6174 6520 626c 6f63 6b20 746f   locate block to
+00020800: 2064 656c 6574 650a 2020 2020 2020 2020   delete.        
+00020810: 2020 2020 626c 6f63 6b5f 7374 6172 7420      block_start 
+00020820: 3d20 6920 2a20 626c 6f63 6b5f 6c65 6e67  = i * block_leng
+00020830: 7468 0a20 2020 2020 2020 2020 2020 2062  th.            b
+00020840: 6c6f 636b 5f73 746f 7020 3d20 626c 6f63  lock_stop = bloc
+00020850: 6b5f 7374 6172 7420 2b20 626c 6f63 6b5f  k_start + block_
+00020860: 6c65 6e67 7468 0a20 2020 2020 2020 2020  length.         
+00020870: 2020 206c 6f63 5f6a 203d 206e 702e 6f6e     loc_j = np.on
+00020880: 6573 286e 5f73 6974 6573 2c20 6474 7970  es(n_sites, dtyp
+00020890: 653d 626f 6f6c 290a 2020 2020 2020 2020  e=bool).        
+000208a0: 2020 2020 6c6f 635f 6a5b 626c 6f63 6b5f      loc_j[block_
+000208b0: 7374 6172 743a 626c 6f63 6b5f 7374 6f70  start:block_stop
+000208c0: 5d20 3d20 4661 6c73 650a 2020 2020 2020  ] = False.      
+000208d0: 2020 2020 2020 6173 7365 7274 206e 702e        assert np.
+000208e0: 636f 756e 745f 6e6f 6e7a 6572 6f28 6c6f  count_nonzero(lo
+000208f0: 635f 6a29 203d 3d20 6e5f 7369 7465 735f  c_j) == n_sites_
+00020900: 6a0a 0a20 2020 2020 2020 2020 2020 2023  j..            #
+00020910: 2072 6573 616d 706c 6520 6461 7461 2061   resample data a
+00020920: 6e64 2063 6f6d 7075 7465 2073 7461 7469  nd compute stati
+00020930: 7374 6963 730a 0a20 2020 2020 2020 2020  stics..         
+00020940: 2020 2023 2074 6865 7461 5f70 690a 2020     # theta_pi.  
+00020950: 2020 2020 2020 2020 2020 6d70 645f 6a20            mpd_j 
+00020960: 3d20 6d70 645f 6461 7461 5b6c 6f63 5f6a  = mpd_data[loc_j
+00020970: 5d0a 2020 2020 2020 2020 2020 2020 7468  ].            th
+00020980: 6574 615f 7069 5f61 6273 5f6a 203d 206e  eta_pi_abs_j = n
+00020990: 702e 7375 6d28 6d70 645f 6a29 0a20 2020  p.sum(mpd_j).   
+000209a0: 2020 2020 2020 2020 2074 6865 7461 5f70           theta_p
+000209b0: 695f 6a20 3d20 7468 6574 615f 7069 5f61  i_j = theta_pi_a
+000209c0: 6273 5f6a 202f 206e 5f73 6974 6573 5f6a  bs_j / n_sites_j
+000209d0: 0a20 2020 2020 2020 2020 2020 206a 6163  .            jac
+000209e0: 6b5f 7468 6574 615f 7069 2e61 7070 656e  k_theta_pi.appen
+000209f0: 6428 7468 6574 615f 7069 5f6a 290a 0a20  d(theta_pi_j).. 
+00020a00: 2020 2020 2020 2020 2020 2023 2074 6865             # the
+00020a10: 7461 5f77 0a20 2020 2020 2020 2020 2020  ta_w.           
+00020a20: 2073 6567 5f6a 203d 2073 6567 5f64 6174   seg_j = seg_dat
+00020a30: 615b 6c6f 635f 6a5d 0a20 2020 2020 2020  a[loc_j].       
+00020a40: 2020 2020 2053 5f6a 203d 206e 702e 7375       S_j = np.su
+00020a50: 6d28 7365 675f 6a29 0a20 2020 2020 2020  m(seg_j).       
+00020a60: 2020 2020 2074 6865 7461 5f77 5f61 6273       theta_w_abs
+00020a70: 5f6a 203d 2053 5f6a 202f 2061 310a 2020  _j = S_j / a1.  
+00020a80: 2020 2020 2020 2020 2020 7468 6574 615f            theta_
+00020a90: 775f 6a20 3d20 7468 6574 615f 775f 6162  w_j = theta_w_ab
+00020aa0: 735f 6a20 2f20 6e5f 7369 7465 735f 6a0a  s_j / n_sites_j.
+00020ab0: 2020 2020 2020 2020 2020 2020 6a61 636b              jack
+00020ac0: 5f74 6865 7461 5f77 2e61 7070 656e 6428  _theta_w.append(
+00020ad0: 7468 6574 615f 775f 6a29 0a0a 2020 2020  theta_w_j)..    
+00020ae0: 2020 2020 2020 2020 2320 7461 6a69 6d61          # tajima
+00020af0: 5f64 0a20 2020 2020 2020 2020 2020 2064  _d.            d
+00020b00: 5f6a 203d 2074 6865 7461 5f70 695f 6162  _j = theta_pi_ab
+00020b10: 735f 6a20 2d20 7468 6574 615f 775f 6162  s_j - theta_w_ab
+00020b20: 735f 6a0a 2020 2020 2020 2020 2020 2020  s_j.            
+00020b30: 645f 7374 6465 765f 6a20 3d20 6e70 2e73  d_stdev_j = np.s
+00020b40: 7172 7428 2865 3120 2a20 535f 6a29 202b  qrt((e1 * S_j) +
+00020b50: 2028 6532 202a 2053 5f6a 202a 2028 535f   (e2 * S_j * (S_
+00020b60: 6a20 2d20 3129 2929 0a20 2020 2020 2020  j - 1))).       
+00020b70: 2020 2020 2074 616a 696d 615f 645f 6a20       tajima_d_j 
+00020b80: 3d20 645f 6a20 2f20 645f 7374 6465 765f  = d_j / d_stdev_
+00020b90: 6a0a 2020 2020 2020 2020 2020 2020 6a61  j.            ja
+00020ba0: 636b 5f74 616a 696d 615f 642e 6170 7065  ck_tajima_d.appe
+00020bb0: 6e64 2874 616a 696d 615f 645f 6a29 0a0a  nd(tajima_d_j)..
+00020bc0: 2020 2020 2020 2020 2320 6361 6c63 756c          # calcul
+00020bd0: 6174 6520 6a61 636b 6b6e 6966 6520 7374  ate jackknife st
+00020be0: 6174 730a 2020 2020 2020 2020 280a 2020  ats.        (.  
+00020bf0: 2020 2020 2020 2020 2020 7468 6574 615f            theta_
+00020c00: 7069 5f65 7374 696d 6174 652c 0a20 2020  pi_estimate,.   
+00020c10: 2020 2020 2020 2020 2074 6865 7461 5f70           theta_p
+00020c20: 695f 6269 6173 2c0a 2020 2020 2020 2020  i_bias,.        
+00020c30: 2020 2020 7468 6574 615f 7069 5f73 7464      theta_pi_std
+00020c40: 5f65 7272 2c0a 2020 2020 2020 2020 2020  _err,.          
+00020c50: 2020 7468 6574 615f 7069 5f63 695f 6572    theta_pi_ci_er
+00020c60: 722c 0a20 2020 2020 2020 2020 2020 2074  r,.            t
+00020c70: 6865 7461 5f70 695f 6369 5f6c 6f77 2c0a  heta_pi_ci_low,.
+00020c80: 2020 2020 2020 2020 2020 2020 7468 6574              thet
+00020c90: 615f 7069 5f63 695f 7570 702c 0a20 2020  a_pi_ci_upp,.   
+00020ca0: 2020 2020 2029 203d 206a 6163 6b6b 6e69       ) = jackkni
+00020cb0: 6665 5f63 6928 0a20 2020 2020 2020 2020  fe_ci(.         
+00020cc0: 2020 2073 7461 745f 6461 7461 3d74 6865     stat_data=the
+00020cd0: 7461 5f70 695f 6461 7461 2c0a 2020 2020  ta_pi_data,.    
+00020ce0: 2020 2020 2020 2020 6a61 636b 5f73 7461          jack_sta
+00020cf0: 743d 6a61 636b 5f74 6865 7461 5f70 692c  t=jack_theta_pi,
+00020d00: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00020d10: 6669 6465 6e63 655f 6c65 7665 6c3d 636f  fidence_level=co
+00020d20: 6e66 6964 656e 6365 5f6c 6576 656c 2c0a  nfidence_level,.
+00020d30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00020d40: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00020d50: 7468 6574 615f 775f 6573 7469 6d61 7465  theta_w_estimate
+00020d60: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
+00020d70: 6574 615f 775f 6269 6173 2c0a 2020 2020  eta_w_bias,.    
+00020d80: 2020 2020 2020 2020 7468 6574 615f 775f          theta_w_
+00020d90: 7374 645f 6572 722c 0a20 2020 2020 2020  std_err,.       
+00020da0: 2020 2020 2074 6865 7461 5f77 5f63 695f       theta_w_ci_
+00020db0: 6572 722c 0a20 2020 2020 2020 2020 2020  err,.           
+00020dc0: 2074 6865 7461 5f77 5f63 695f 6c6f 772c   theta_w_ci_low,
+00020dd0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00020de0: 7461 5f77 5f63 695f 7570 702c 0a20 2020  ta_w_ci_upp,.   
+00020df0: 2020 2020 2029 203d 206a 6163 6b6b 6e69       ) = jackkni
+00020e00: 6665 5f63 6928 0a20 2020 2020 2020 2020  fe_ci(.         
+00020e10: 2020 2073 7461 745f 6461 7461 3d74 6865     stat_data=the
+00020e20: 7461 5f77 5f64 6174 612c 0a20 2020 2020  ta_w_data,.     
+00020e30: 2020 2020 2020 206a 6163 6b5f 7374 6174         jack_stat
+00020e40: 3d6a 6163 6b5f 7468 6574 615f 772c 0a20  =jack_theta_w,. 
+00020e50: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00020e60: 6465 6e63 655f 6c65 7665 6c3d 636f 6e66  dence_level=conf
+00020e70: 6964 656e 6365 5f6c 6576 656c 2c0a 2020  idence_level,.  
+00020e80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00020e90: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
+00020ea0: 6a69 6d61 5f64 5f65 7374 696d 6174 652c  jima_d_estimate,
+00020eb0: 0a20 2020 2020 2020 2020 2020 2074 616a  .            taj
+00020ec0: 696d 615f 645f 6269 6173 2c0a 2020 2020  ima_d_bias,.    
+00020ed0: 2020 2020 2020 2020 7461 6a69 6d61 5f64          tajima_d
+00020ee0: 5f73 7464 5f65 7272 2c0a 2020 2020 2020  _std_err,.      
+00020ef0: 2020 2020 2020 7461 6a69 6d61 5f64 5f63        tajima_d_c
+00020f00: 695f 6572 722c 0a20 2020 2020 2020 2020  i_err,.         
+00020f10: 2020 2074 616a 696d 615f 645f 6369 5f6c     tajima_d_ci_l
+00020f20: 6f77 2c0a 2020 2020 2020 2020 2020 2020  ow,.            
+00020f30: 7461 6a69 6d61 5f64 5f63 695f 7570 702c  tajima_d_ci_upp,
+00020f40: 0a20 2020 2020 2020 2029 203d 206a 6163  .        ) = jac
+00020f50: 6b6b 6e69 6665 5f63 6928 0a20 2020 2020  kknife_ci(.     
+00020f60: 2020 2020 2020 2073 7461 745f 6461 7461         stat_data
+00020f70: 3d74 616a 696d 615f 645f 6461 7461 2c0a  =tajima_d_data,.
+00020f80: 2020 2020 2020 2020 2020 2020 6a61 636b              jack
+00020f90: 5f73 7461 743d 6a61 636b 5f74 616a 696d  _stat=jack_tajim
+00020fa0: 615f 642c 0a20 2020 2020 2020 2020 2020  a_d,.           
+00020fb0: 2063 6f6e 6669 6465 6e63 655f 6c65 7665   confidence_leve
+00020fc0: 6c3d 636f 6e66 6964 656e 6365 5f6c 6576  l=confidence_lev
+00020fd0: 656c 2c0a 2020 2020 2020 2020 290a 0a20  el,.        ).. 
+00020fe0: 2020 2020 2020 2072 6574 7572 6e20 6469         return di
+00020ff0: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+00021000: 636f 686f 7274 3d63 6f68 6f72 745f 6c61  cohort=cohort_la
+00021010: 6265 6c2c 0a20 2020 2020 2020 2020 2020  bel,.           
+00021020: 2074 6865 7461 5f70 693d 7468 6574 615f   theta_pi=theta_
+00021030: 7069 5f64 6174 612c 0a20 2020 2020 2020  pi_data,.       
+00021040: 2020 2020 2074 6865 7461 5f70 695f 6573       theta_pi_es
+00021050: 7469 6d61 7465 3d74 6865 7461 5f70 695f  timate=theta_pi_
+00021060: 6573 7469 6d61 7465 2c0a 2020 2020 2020  estimate,.      
+00021070: 2020 2020 2020 7468 6574 615f 7069 5f62        theta_pi_b
+00021080: 6961 733d 7468 6574 615f 7069 5f62 6961  ias=theta_pi_bia
+00021090: 732c 0a20 2020 2020 2020 2020 2020 2074  s,.            t
+000210a0: 6865 7461 5f70 695f 7374 645f 6572 723d  heta_pi_std_err=
+000210b0: 7468 6574 615f 7069 5f73 7464 5f65 7272  theta_pi_std_err
+000210c0: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
+000210d0: 6574 615f 7069 5f63 695f 6572 723d 7468  eta_pi_ci_err=th
+000210e0: 6574 615f 7069 5f63 695f 6572 722c 0a20  eta_pi_ci_err,. 
+000210f0: 2020 2020 2020 2020 2020 2074 6865 7461             theta
+00021100: 5f70 695f 6369 5f6c 6f77 3d74 6865 7461  _pi_ci_low=theta
+00021110: 5f70 695f 6369 5f6c 6f77 2c0a 2020 2020  _pi_ci_low,.    
+00021120: 2020 2020 2020 2020 7468 6574 615f 7069          theta_pi
+00021130: 5f63 695f 7570 703d 7468 6574 615f 7069  _ci_upp=theta_pi
+00021140: 5f63 695f 7570 702c 0a20 2020 2020 2020  _ci_upp,.       
+00021150: 2020 2020 2074 6865 7461 5f77 3d74 6865       theta_w=the
+00021160: 7461 5f77 5f64 6174 612c 0a20 2020 2020  ta_w_data,.     
+00021170: 2020 2020 2020 2074 6865 7461 5f77 5f65         theta_w_e
+00021180: 7374 696d 6174 653d 7468 6574 615f 775f  stimate=theta_w_
+00021190: 6573 7469 6d61 7465 2c0a 2020 2020 2020  estimate,.      
+000211a0: 2020 2020 2020 7468 6574 615f 775f 6269        theta_w_bi
+000211b0: 6173 3d74 6865 7461 5f77 5f62 6961 732c  as=theta_w_bias,
+000211c0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+000211d0: 7461 5f77 5f73 7464 5f65 7272 3d74 6865  ta_w_std_err=the
+000211e0: 7461 5f77 5f73 7464 5f65 7272 2c0a 2020  ta_w_std_err,.  
+000211f0: 2020 2020 2020 2020 2020 7468 6574 615f            theta_
+00021200: 775f 6369 5f65 7272 3d74 6865 7461 5f77  w_ci_err=theta_w
+00021210: 5f63 695f 6572 722c 0a20 2020 2020 2020  _ci_err,.       
+00021220: 2020 2020 2074 6865 7461 5f77 5f63 695f       theta_w_ci_
+00021230: 6c6f 773d 7468 6574 615f 775f 6369 5f6c  low=theta_w_ci_l
+00021240: 6f77 2c0a 2020 2020 2020 2020 2020 2020  ow,.            
+00021250: 7468 6574 615f 775f 6369 5f75 7070 3d74  theta_w_ci_upp=t
+00021260: 6865 7461 5f77 5f63 695f 7570 702c 0a20  heta_w_ci_upp,. 
+00021270: 2020 2020 2020 2020 2020 2074 616a 696d             tajim
+00021280: 615f 643d 7461 6a69 6d61 5f64 5f64 6174  a_d=tajima_d_dat
+00021290: 612c 0a20 2020 2020 2020 2020 2020 2074  a,.            t
+000212a0: 616a 696d 615f 645f 6573 7469 6d61 7465  ajima_d_estimate
+000212b0: 3d74 616a 696d 615f 645f 6573 7469 6d61  =tajima_d_estima
+000212c0: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
+000212d0: 7461 6a69 6d61 5f64 5f62 6961 733d 7461  tajima_d_bias=ta
+000212e0: 6a69 6d61 5f64 5f62 6961 732c 0a20 2020  jima_d_bias,.   
+000212f0: 2020 2020 2020 2020 2074 616a 696d 615f           tajima_
+00021300: 645f 7374 645f 6572 723d 7461 6a69 6d61  d_std_err=tajima
+00021310: 5f64 5f73 7464 5f65 7272 2c0a 2020 2020  _d_std_err,.    
+00021320: 2020 2020 2020 2020 7461 6a69 6d61 5f64          tajima_d
+00021330: 5f63 695f 6572 723d 7461 6a69 6d61 5f64  _ci_err=tajima_d
+00021340: 5f63 695f 6572 722c 0a20 2020 2020 2020  _ci_err,.       
+00021350: 2020 2020 2074 616a 696d 615f 645f 6369       tajima_d_ci
+00021360: 5f6c 6f77 3d74 616a 696d 615f 645f 6369  _low=tajima_d_ci
+00021370: 5f6c 6f77 2c0a 2020 2020 2020 2020 2020  _low,.          
+00021380: 2020 7461 6a69 6d61 5f64 5f63 695f 7570    tajima_d_ci_up
+00021390: 703d 7461 6a69 6d61 5f64 5f63 695f 7570  p=tajima_d_ci_up
+000213a0: 702c 0a20 2020 2020 2020 2029 0a0a 2020  p,.        )..  
+000213b0: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
+000213c0: 7375 6d6d 6172 793d 2222 220a 2020 2020  summary=""".    
+000213d0: 2020 2020 2020 2020 436f 6d70 7574 6520          Compute 
+000213e0: 6765 6e65 7469 6320 6469 7665 7273 6974  genetic diversit
+000213f0: 7920 7375 6d6d 6172 7920 7374 6174 6973  y summary statis
+00021400: 7469 6373 2066 6f72 2061 2063 6f68 6f72  tics for a cohor
+00021410: 7420 6f66 0a20 2020 2020 2020 2020 2020  t of.           
+00021420: 2069 6e64 6976 6964 7561 6c73 2e0a 2020   individuals..  
+00021430: 2020 2020 2020 2222 222c 0a20 2020 2020        """,.     
+00021440: 2020 2072 6574 7572 6e73 3d22 2222 0a20     returns=""". 
+00021450: 2020 2020 2020 2020 2020 2041 2070 616e             A pan
+00021460: 6461 7320 7365 7269 6573 2077 6974 6820  das series with 
+00021470: 7375 6d6d 6172 7920 7374 6174 6973 7469  summary statisti
+00021480: 6373 2061 6e64 2074 6865 6972 2063 6f6e  cs and their con
+00021490: 6669 6465 6e63 650a 2020 2020 2020 2020  fidence.        
+000214a0: 2020 2020 696e 7465 7276 616c 732e 0a20      intervals.. 
+000214b0: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
+000214c0: 290a 2020 2020 6465 6620 636f 686f 7274  ).    def cohort
+000214d0: 5f64 6976 6572 7369 7479 5f73 7461 7473  _diversity_stats
+000214e0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+000214f0: 2020 2020 2020 2020 636f 686f 7274 3a20          cohort: 
+00021500: 6261 7365 5f70 6172 616d 732e 636f 686f  base_params.coho
+00021510: 7274 2c0a 2020 2020 2020 2020 636f 686f  rt,.        coho
+00021520: 7274 5f73 697a 653a 2062 6173 655f 7061  rt_size: base_pa
+00021530: 7261 6d73 2e63 6f68 6f72 745f 7369 7a65  rams.cohort_size
+00021540: 2c0a 2020 2020 2020 2020 7265 6769 6f6e  ,.        region
+00021550: 3a20 6261 7365 5f70 6172 616d 732e 7265  : base_params.re
+00021560: 6769 6f6e 2c0a 2020 2020 2020 2020 7369  gion,.        si
+00021570: 7465 5f6d 6173 6b3a 204f 7074 696f 6e61  te_mask: Optiona
+00021580: 6c5b 6261 7365 5f70 6172 616d 732e 7369  l[base_params.si
+00021590: 7465 5f6d 6173 6b5d 203d 2044 4546 4155  te_mask] = DEFAU
+000215a0: 4c54 2c0a 2020 2020 2020 2020 7369 7465  LT,.        site
+000215b0: 5f63 6c61 7373 3a20 4f70 7469 6f6e 616c  _class: Optional
+000215c0: 5b62 6173 655f 7061 7261 6d73 2e73 6974  [base_params.sit
+000215d0: 655f 636c 6173 735d 203d 204e 6f6e 652c  e_class] = None,
+000215e0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+000215f0: 7365 7473 3a20 4f70 7469 6f6e 616c 5b62  sets: Optional[b
+00021600: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
+00021610: 655f 7365 7473 5d20 3d20 4e6f 6e65 2c0a  e_sets] = None,.
+00021620: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
+00021630: 6565 643a 2062 6173 655f 7061 7261 6d73  eed: base_params
+00021640: 2e72 616e 646f 6d5f 7365 6564 203d 2034  .random_seed = 4
+00021650: 322c 0a20 2020 2020 2020 206e 5f6a 6163  2,.        n_jac
+00021660: 6b3a 2062 6173 655f 7061 7261 6d73 2e6e  k: base_params.n
+00021670: 5f6a 6163 6b20 3d20 3230 302c 0a20 2020  _jack = 200,.   
+00021680: 2020 2020 2063 6f6e 6669 6465 6e63 655f       confidence_
+00021690: 6c65 7665 6c3a 2062 6173 655f 7061 7261  level: base_para
+000216a0: 6d73 2e63 6f6e 6669 6465 6e63 655f 6c65  ms.confidence_le
+000216b0: 7665 6c20 3d20 302e 3935 2c0a 2020 2020  vel = 0.95,.    
+000216c0: 2920 2d3e 2070 642e 5365 7269 6573 3a0a  ) -> pd.Series:.
+000216d0: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
+000216e0: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
+000216f0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+00021700: 7072 6f63 6573 7320 636f 686f 7274 2070  process cohort p
+00021710: 6172 616d 6574 6572 2229 0a20 2020 2020  arameter").     
+00021720: 2020 2063 6f68 6f72 745f 7175 6572 7920     cohort_query 
+00021730: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+00021740: 6620 6973 696e 7374 616e 6365 2863 6f68  f isinstance(coh
+00021750: 6f72 742c 2073 7472 293a 0a20 2020 2020  ort, str):.     
+00021760: 2020 2020 2020 2023 2061 7373 756d 6520         # assume 
+00021770: 6974 2069 7320 6f6e 6520 6f66 2074 6865  it is one of the
+00021780: 2070 7265 6465 6669 6e65 6420 636f 686f   predefined coho
+00021790: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
+000217a0: 636f 686f 7274 5f6c 6162 656c 203d 2063  cohort_label = c
+000217b0: 6f68 6f72 740a 2020 2020 2020 2020 2020  ohort.          
+000217c0: 2020 6466 5f73 616d 706c 6573 203d 2073    df_samples = s
+000217d0: 656c 662e 7361 6d70 6c65 5f6d 6574 6164  elf.sample_metad
+000217e0: 6174 6128 7361 6d70 6c65 5f73 6574 733d  ata(sample_sets=
+000217f0: 7361 6d70 6c65 5f73 6574 7329 0a20 2020  sample_sets).   
+00021800: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
+00021810: 636f 6c73 203d 205b 6320 666f 7220 6320  cols = [c for c 
+00021820: 696e 2064 665f 7361 6d70 6c65 732e 636f  in df_samples.co
+00021830: 6c75 6d6e 7320 6966 2063 2e73 7461 7274  lumns if c.start
+00021840: 7377 6974 6828 2263 6f68 6f72 745f 2229  swith("cohort_")
+00021850: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+00021860: 7220 6320 696e 2063 6f68 6f72 745f 636f  r c in cohort_co
+00021870: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+00021880: 2020 2020 6966 2063 6f68 6f72 7420 696e      if cohort in
+00021890: 2073 6574 2864 665f 7361 6d70 6c65 735b   set(df_samples[
+000218a0: 635d 293a 0a20 2020 2020 2020 2020 2020  c]):.           
+000218b0: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
+000218c0: 7175 6572 7920 3d20 6622 7b63 7d20 3d3d  query = f"{c} ==
+000218d0: 2027 7b63 6f68 6f72 747d 2722 0a20 2020   '{cohort}'".   
+000218e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000218f0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00021900: 2020 2069 6620 636f 686f 7274 5f71 7565     if cohort_que
+00021910: 7279 2069 7320 4e6f 6e65 3a0a 2020 2020  ry is None:.    
+00021920: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00021930: 6520 5661 6c75 6545 7272 6f72 2866 2275  e ValueError(f"u
+00021940: 6e6b 6e6f 776e 2063 6f68 6f72 743a 207b  nknown cohort: {
+00021950: 636f 686f 7274 7d22 290a 0a20 2020 2020  cohort}")..     
+00021960: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00021970: 6365 2863 6f68 6f72 742c 2028 6c69 7374  ce(cohort, (list
+00021980: 2c20 7475 706c 6529 2920 616e 6420 6c65  , tuple)) and le
+00021990: 6e28 636f 686f 7274 2920 3d3d 2032 3a0a  n(cohort) == 2:.
+000219a0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
+000219b0: 7274 5f6c 6162 656c 2c20 636f 686f 7274  rt_label, cohort
+000219c0: 5f71 7565 7279 203d 2063 6f68 6f72 740a  _query = cohort.
+000219d0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000219e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000219f0: 2054 7970 6545 7272 6f72 2872 2269 6e76   TypeError(r"inv
+00021a00: 616c 6964 2063 6f68 6f72 7420 7061 7261  alid cohort para
+00021a10: 6d65 7465 723a 207b 636f 686f 7274 2172  meter: {cohort!r
+00021a20: 7d22 290a 0a20 2020 2020 2020 2064 6562  }")..        deb
+00021a30: 7567 2822 6163 6365 7373 2061 6c6c 656c  ug("access allel
+00021a40: 6520 636f 756e 7473 2229 0a20 2020 2020  e counts").     
+00021a50: 2020 2061 6320 3d20 7365 6c66 2e73 6e70     ac = self.snp
+00021a60: 5f61 6c6c 656c 655f 636f 756e 7473 280a  _allele_counts(.
+00021a70: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00021a80: 6f6e 3d72 6567 696f 6e2c 0a20 2020 2020  on=region,.     
+00021a90: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+00021aa0: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
+00021ab0: 2020 2020 2020 2020 7369 7465 5f63 6c61          site_cla
+00021ac0: 7373 3d73 6974 655f 636c 6173 732c 0a20  ss=site_class,. 
+00021ad0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00021ae0: 655f 7175 6572 793d 636f 686f 7274 5f71  e_query=cohort_q
+00021af0: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
+00021b00: 2020 7361 6d70 6c65 5f73 6574 733d 7361    sample_sets=sa
+00021b10: 6d70 6c65 5f73 6574 732c 0a20 2020 2020  mple_sets,.     
+00021b20: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
+00021b30: 7a65 3d63 6f68 6f72 745f 7369 7a65 2c0a  ze=cohort_size,.
+00021b40: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+00021b50: 6f6d 5f73 6565 643d 7261 6e64 6f6d 5f73  om_seed=random_s
+00021b60: 6565 642c 0a20 2020 2020 2020 2029 0a0a  eed,.        )..
+00021b70: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
+00021b80: 6f6d 7075 7465 2064 6976 6572 7369 7479  ompute diversity
+00021b90: 2073 7461 7473 2229 0a20 2020 2020 2020   stats").       
+00021ba0: 2073 7461 7473 203d 2073 656c 662e 5f62   stats = self._b
+00021bb0: 6c6f 636b 5f6a 6163 6b6b 6e69 6665 5f63  lock_jackknife_c
+00021bc0: 6f68 6f72 745f 6469 7665 7273 6974 795f  ohort_diversity_
+00021bd0: 7374 6174 7328 0a20 2020 2020 2020 2020  stats(.         
+00021be0: 2020 2063 6f68 6f72 745f 6c61 6265 6c3d     cohort_label=
+00021bf0: 636f 686f 7274 5f6c 6162 656c 2c0a 2020  cohort_label,.  
+00021c00: 2020 2020 2020 2020 2020 6163 3d61 632c            ac=ac,
+00021c10: 0a20 2020 2020 2020 2020 2020 206e 5f6a  .            n_j
+00021c20: 6163 6b3d 6e5f 6a61 636b 2c0a 2020 2020  ack=n_jack,.    
+00021c30: 2020 2020 2020 2020 636f 6e66 6964 656e          confiden
+00021c40: 6365 5f6c 6576 656c 3d63 6f6e 6669 6465  ce_level=confide
+00021c50: 6e63 655f 6c65 7665 6c2c 0a20 2020 2020  nce_level,.     
+00021c60: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
+00021c70: 6275 6728 2263 6f6d 7075 7465 2073 6f6d  bug("compute som
+00021c80: 6520 6578 7472 6120 636f 686f 7274 2076  e extra cohort v
+00021c90: 6172 6961 626c 6573 2229 0a20 2020 2020  ariables").     
+00021ca0: 2020 2064 665f 7361 6d70 6c65 7320 3d20     df_samples = 
+00021cb0: 7365 6c66 2e73 616d 706c 655f 6d65 7461  self.sample_meta
+00021cc0: 6461 7461 280a 2020 2020 2020 2020 2020  data(.          
+00021cd0: 2020 7361 6d70 6c65 5f73 6574 733d 7361    sample_sets=sa
+00021ce0: 6d70 6c65 5f73 6574 732c 2073 616d 706c  mple_sets, sampl
+00021cf0: 655f 7175 6572 793d 636f 686f 7274 5f71  e_query=cohort_q
+00021d00: 7565 7279 0a20 2020 2020 2020 2029 0a20  uery.        ). 
+00021d10: 2020 2020 2020 2065 7874 7261 5f66 6965         extra_fie
+00021d20: 6c64 7320 3d20 5b0a 2020 2020 2020 2020  lds = [.        
+00021d30: 2020 2020 2822 7461 786f 6e22 2c20 2275      ("taxon", "u
+00021d40: 6e69 7175 6522 292c 0a20 2020 2020 2020  nique"),.       
+00021d50: 2020 2020 2028 2279 6561 7222 2c20 2275       ("year", "u
+00021d60: 6e69 7175 6522 292c 0a20 2020 2020 2020  nique"),.       
+00021d70: 2020 2020 2028 226d 6f6e 7468 222c 2022       ("month", "
+00021d80: 756e 6971 7565 2229 2c0a 2020 2020 2020  unique"),.      
+00021d90: 2020 2020 2020 2822 636f 756e 7472 7922        ("country"
+00021da0: 2c20 2275 6e69 7175 6522 292c 0a20 2020  , "unique"),.   
+00021db0: 2020 2020 2020 2020 2028 2261 646d 696e           ("admin
+00021dc0: 315f 6973 6f22 2c20 2275 6e69 7175 6522  1_iso", "unique"
+00021dd0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+00021de0: 2261 646d 696e 315f 6e61 6d65 222c 2022  "admin1_name", "
+00021df0: 756e 6971 7565 2229 2c0a 2020 2020 2020  unique"),.      
+00021e00: 2020 2020 2020 2822 6164 6d69 6e32 5f6e        ("admin2_n
+00021e10: 616d 6522 2c20 2275 6e69 7175 6522 292c  ame", "unique"),
+00021e20: 0a20 2020 2020 2020 2020 2020 2028 226c  .            ("l
+00021e30: 6f6e 6769 7475 6465 222c 2022 6d65 616e  ongitude", "mean
+00021e40: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00021e50: 2822 6c61 7469 7475 6465 222c 2022 6d65  ("latitude", "me
+00021e60: 616e 2229 2c0a 2020 2020 2020 2020 5d0a  an"),.        ].
+00021e70: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
+00021e80: 642c 2061 6767 2069 6e20 6578 7472 615f  d, agg in extra_
+00021e90: 6669 656c 6473 3a0a 2020 2020 2020 2020  fields:.        
+00021ea0: 2020 2020 6966 2061 6767 203d 3d20 2275      if agg == "u
+00021eb0: 6e69 7175 6522 3a0a 2020 2020 2020 2020  nique":.        
+00021ec0: 2020 2020 2020 2020 7661 6c73 203d 2064          vals = d
+00021ed0: 665f 7361 6d70 6c65 735b 6669 656c 645d  f_samples[field]
+00021ee0: 2e73 6f72 745f 7661 6c75 6573 2829 2e75  .sort_values().u
+00021ef0: 6e69 7175 6528 290a 2020 2020 2020 2020  nique().        
+00021f00: 2020 2020 2020 2020 6966 206c 656e 2876          if len(v
+00021f10: 616c 7329 203d 3d20 303a 0a20 2020 2020  als) == 0:.     
+00021f20: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00021f30: 616c 203d 206e 702e 6e61 6e0a 2020 2020  al = np.nan.    
+00021f40: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00021f50: 206c 656e 2876 616c 7329 203d 3d20 313a   len(vals) == 1:
+00021f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021f70: 2020 2020 2076 616c 203d 2076 616c 735b       val = vals[
+00021f80: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00021f90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00021fa0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00021fb0: 203d 2076 616c 732e 746f 6c69 7374 2829   = vals.tolist()
+00021fc0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00021fd0: 6620 6167 6720 3d3d 2022 6d65 616e 223a  f agg == "mean":
+00021fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021ff0: 2076 616c 7320 3d20 6466 5f73 616d 706c   vals = df_sampl
+00022000: 6573 5b66 6965 6c64 5d0a 2020 2020 2020  es[field].      
+00022010: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00022020: 2876 616c 7329 203d 3d20 303a 0a20 2020  (vals) == 0:.   
+00022030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022040: 2076 616c 203d 206e 702e 6e61 6e0a 2020   val = np.nan.  
+00022050: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00022060: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00022070: 2020 2020 2020 2020 7661 6c20 3d20 6e70          val = np
+00022080: 2e6d 6561 6e28 7661 6c73 290a 2020 2020  .mean(vals).    
+00022090: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000220a0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+000220b0: 6c20 3d20 6e70 2e6e 616e 0a20 2020 2020  l = np.nan.     
+000220c0: 2020 2020 2020 2073 7461 7473 5b66 6965         stats[fie
+000220d0: 6c64 5d20 3d20 7661 6c0a 0a20 2020 2020  ld] = val..     
+000220e0: 2020 2072 6574 7572 6e20 7064 2e53 6572     return pd.Ser
+000220f0: 6965 7328 7374 6174 7329 0a0a 2020 2020  ies(stats)..    
+00022100: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
+00022110: 6d6d 6172 793d 2222 220a 2020 2020 2020  mmary=""".      
+00022120: 2020 2020 2020 436f 6d70 7574 6520 6765        Compute ge
+00022130: 6e65 7469 6320 6469 7665 7273 6974 7920  netic diversity 
+00022140: 7375 6d6d 6172 7920 7374 6174 6973 7469  summary statisti
+00022150: 6373 2066 6f72 206d 756c 7469 706c 6520  cs for multiple 
+00022160: 636f 686f 7274 732e 0a20 2020 2020 2020  cohorts..       
+00022170: 2022 2222 2c0a 2020 2020 2020 2020 7265   """,.        re
+00022180: 7475 726e 733d 2222 220a 2020 2020 2020  turns=""".      
+00022190: 2020 2020 2020 4120 4461 7461 4672 616d        A DataFram
+000221a0: 6520 7768 6572 6520 6561 6368 2072 6f77  e where each row
+000221b0: 2070 726f 7669 6465 7320 7375 6d6d 6172   provides summar
+000221c0: 7920 7374 6174 6973 7469 6373 2061 6e64  y statistics and
+000221d0: 2074 6865 6972 0a20 2020 2020 2020 2020   their.         
+000221e0: 2020 2063 6f6e 6669 6465 6e63 6520 696e     confidence in
+000221f0: 7465 7276 616c 7320 666f 7220 6120 7369  tervals for a si
+00022200: 6e67 6c65 2063 6f68 6f72 742e 0a20 2020  ngle cohort..   
+00022210: 2020 2020 2022 2222 2c0a 2020 2020 290a       """,.    ).
+00022220: 2020 2020 6465 6620 6469 7665 7273 6974      def diversit
+00022230: 795f 7374 6174 7328 0a20 2020 2020 2020  y_stats(.       
+00022240: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
+00022250: 6f68 6f72 7473 3a20 6261 7365 5f70 6172  ohorts: base_par
+00022260: 616d 732e 636f 686f 7274 732c 0a20 2020  ams.cohorts,.   
+00022270: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
+00022280: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
+00022290: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+000222a0: 2020 2072 6567 696f 6e3a 2062 6173 655f     region: base_
+000222b0: 7061 7261 6d73 2e72 6567 696f 6e2c 0a20  params.region,. 
+000222c0: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+000222d0: 3a20 6261 7365 5f70 6172 616d 732e 7369  : base_params.si
+000222e0: 7465 5f6d 6173 6b20 3d20 4445 4641 554c  te_mask = DEFAUL
+000222f0: 542c 0a20 2020 2020 2020 2073 6974 655f  T,.        site_
+00022300: 636c 6173 733a 204f 7074 696f 6e61 6c5b  class: Optional[
+00022310: 6261 7365 5f70 6172 616d 732e 7369 7465  base_params.site
+00022320: 5f63 6c61 7373 5d20 3d20 4e6f 6e65 2c0a  _class] = None,.
+00022330: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
+00022340: 7565 7279 3a20 4f70 7469 6f6e 616c 5b62  uery: Optional[b
+00022350: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
+00022360: 655f 7175 6572 795d 203d 204e 6f6e 652c  e_query] = None,
+00022370: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+00022380: 7365 7473 3a20 4f70 7469 6f6e 616c 5b62  sets: Optional[b
+00022390: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
+000223a0: 655f 7365 7473 5d20 3d20 4e6f 6e65 2c0a  e_sets] = None,.
+000223b0: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
+000223c0: 6565 643a 2062 6173 655f 7061 7261 6d73  eed: base_params
+000223d0: 2e72 616e 646f 6d5f 7365 6564 203d 2034  .random_seed = 4
+000223e0: 322c 0a20 2020 2020 2020 206e 5f6a 6163  2,.        n_jac
+000223f0: 6b3a 2062 6173 655f 7061 7261 6d73 2e6e  k: base_params.n
+00022400: 5f6a 6163 6b20 3d20 3230 302c 0a20 2020  _jack = 200,.   
+00022410: 2020 2020 2063 6f6e 6669 6465 6e63 655f       confidence_
+00022420: 6c65 7665 6c3a 2062 6173 655f 7061 7261  level: base_para
+00022430: 6d73 2e63 6f6e 6669 6465 6e63 655f 6c65  ms.confidence_le
+00022440: 7665 6c20 3d20 302e 3935 2c0a 2020 2020  vel = 0.95,.    
+00022450: 2920 2d3e 2070 642e 4461 7461 4672 616d  ) -> pd.DataFram
+00022460: 653a 0a20 2020 2020 2020 2064 6562 7567  e:.        debug
+00022470: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
+00022480: 7567 0a20 2020 2020 2020 2069 6e66 6f20  ug.        info 
+00022490: 3d20 7365 6c66 2e5f 6c6f 672e 696e 666f  = self._log.info
+000224a0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+000224b0: 2273 6574 2075 7020 636f 686f 7274 7322  "set up cohorts"
+000224c0: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
+000224d0: 6e73 7461 6e63 6528 636f 686f 7274 732c  nstance(cohorts,
+000224e0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+000224f0: 2020 2020 2320 7573 6572 2068 6173 2073      # user has s
+00022500: 7570 706c 6965 6420 6120 6375 7374 6f6d  upplied a custom
+00022510: 2064 6963 7469 6f6e 6172 7920 6d61 7070   dictionary mapp
+00022520: 696e 6720 636f 686f 7274 2069 6465 6e74  ing cohort ident
+00022530: 6966 6965 7273 0a20 2020 2020 2020 2020  ifiers.         
+00022540: 2020 2023 2074 6f20 7061 6e64 6173 2071     # to pandas q
+00022550: 7565 7269 6573 0a20 2020 2020 2020 2020  ueries.         
+00022560: 2020 2063 6f68 6f72 745f 7175 6572 6965     cohort_querie
+00022570: 7320 3d20 636f 686f 7274 730a 0a20 2020  s = cohorts..   
+00022580: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00022590: 616e 6365 2863 6f68 6f72 7473 2c20 7374  ance(cohorts, st
+000225a0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000225b0: 2320 7573 6572 2068 6173 2073 7570 706c  # user has suppl
+000225c0: 6965 6420 6f6e 6520 6f66 2074 6865 2070  ied one of the p
+000225d0: 7265 6465 6669 6e65 6420 636f 686f 7274  redefined cohort
+000225e0: 2073 6574 730a 0a20 2020 2020 2020 2020   sets..         
+000225f0: 2020 2064 665f 7361 6d70 6c65 7320 3d20     df_samples = 
+00022600: 7365 6c66 2e73 616d 706c 655f 6d65 7461  self.sample_meta
+00022610: 6461 7461 280a 2020 2020 2020 2020 2020  data(.          
+00022620: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+00022630: 733d 7361 6d70 6c65 5f73 6574 732c 2073  s=sample_sets, s
+00022640: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
+00022650: 6c65 5f71 7565 7279 0a20 2020 2020 2020  le_query.       
+00022660: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00022670: 2020 2020 2320 6465 7465 726d 696e 6520      # determine 
+00022680: 636f 6c75 6d6e 2069 6e20 6461 7461 6672  column in datafr
+00022690: 616d 6520 2d20 616c 6c6f 7720 6162 6272  ame - allow abbr
+000226a0: 6576 6961 7469 6f6e 0a20 2020 2020 2020  eviation.       
+000226b0: 2020 2020 2069 6620 636f 686f 7274 732e       if cohorts.
+000226c0: 7374 6172 7473 7769 7468 2822 636f 686f  startswith("coho
+000226d0: 7274 5f22 293a 0a20 2020 2020 2020 2020  rt_"):.         
+000226e0: 2020 2020 2020 2063 6f68 6f72 7473 5f63         cohorts_c
+000226f0: 6f6c 203d 2063 6f68 6f72 7473 0a20 2020  ol = cohorts.   
+00022700: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00022710: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022720: 6f68 6f72 7473 5f63 6f6c 203d 2022 636f  ohorts_col = "co
+00022730: 686f 7274 5f22 202b 2063 6f68 6f72 7473  hort_" + cohorts
+00022740: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00022750: 636f 686f 7274 735f 636f 6c20 6e6f 7420  cohorts_col not 
+00022760: 696e 2064 665f 7361 6d70 6c65 732e 636f  in df_samples.co
+00022770: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
+00022780: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00022790: 7565 4572 726f 7228 6622 7b63 6f68 6f72  ueError(f"{cohor
+000227a0: 7473 5f63 6f6c 2172 7d20 6973 206e 6f74  ts_col!r} is not
+000227b0: 2061 206b 6e6f 776e 2063 6f68 6f72 7420   a known cohort 
+000227c0: 7365 7422 290a 0a20 2020 2020 2020 2020  set")..         
+000227d0: 2020 2023 2066 696e 6420 636f 686f 7274     # find cohort
+000227e0: 206c 6162 656c 7320 616e 6420 6275 696c   labels and buil
+000227f0: 6420 7175 6572 6965 7320 6469 6374 696f  d queries dictio
+00022800: 6e61 7279 0a20 2020 2020 2020 2020 2020  nary.           
+00022810: 2063 6f68 6f72 745f 6c61 6265 6c73 203d   cohort_labels =
+00022820: 2073 6f72 7465 6428 6466 5f73 616d 706c   sorted(df_sampl
+00022830: 6573 5b63 6f68 6f72 7473 5f63 6f6c 5d2e  es[cohorts_col].
+00022840: 6472 6f70 6e61 2829 2e75 6e69 7175 6528  dropna().unique(
+00022850: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
+00022860: 6f68 6f72 745f 7175 6572 6965 7320 3d20  ohort_queries = 
+00022870: 7b63 6f68 3a20 6622 7b63 6f68 6f72 7473  {coh: f"{cohorts
+00022880: 5f63 6f6c 7d20 3d3d 2027 7b63 6f68 7d27  _col} == '{coh}'
+00022890: 2220 666f 7220 636f 6820 696e 2063 6f68  " for coh in coh
+000228a0: 6f72 745f 6c61 6265 6c73 7d0a 0a20 2020  ort_labels}..   
+000228b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000228c0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+000228d0: 6545 7272 6f72 2822 636f 686f 7274 7320  eError("cohorts 
+000228e0: 7061 7261 6d65 7465 7220 7368 6f75 6c64  parameter should
+000228f0: 2062 6520 6469 6374 206f 7220 7374 7222   be dict or str"
+00022900: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
+00022910: 2822 6861 6e64 6c65 2073 616d 706c 655f  ("handle sample_
+00022920: 7175 6572 7920 7061 7261 6d65 7465 7222  query parameter"
+00022930: 290a 2020 2020 2020 2020 6966 2073 616d  ).        if sam
+00022940: 706c 655f 7175 6572 7920 6973 206e 6f74  ple_query is not
+00022950: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00022960: 2020 2063 6f68 6f72 745f 7175 6572 6965     cohort_querie
+00022970: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+00022980: 2020 2020 2020 636f 686f 7274 5f6c 6162        cohort_lab
+00022990: 656c 3a20 6622 287b 636f 686f 7274 5f71  el: f"({cohort_q
+000229a0: 7565 7279 7d29 2061 6e64 2028 7b73 616d  uery}) and ({sam
+000229b0: 706c 655f 7175 6572 797d 2922 0a20 2020  ple_query})".   
+000229c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000229d0: 2063 6f68 6f72 745f 6c61 6265 6c2c 2063   cohort_label, c
+000229e0: 6f68 6f72 745f 7175 6572 7920 696e 2063  ohort_query in c
+000229f0: 6f68 6f72 745f 7175 6572 6965 732e 6974  ohort_queries.it
+00022a00: 656d 7328 290a 2020 2020 2020 2020 2020  ems().          
+00022a10: 2020 7d0a 0a20 2020 2020 2020 2064 6562    }..        deb
+00022a20: 7567 2822 6368 6563 6b20 636f 686f 7274  ug("check cohort
+00022a30: 2073 697a 6573 2c20 6472 6f70 2061 6e79   sizes, drop any
+00022a40: 2063 6f68 6f72 7473 2077 6869 6368 2061   cohorts which a
+00022a50: 7265 2074 6f6f 2073 6d61 6c6c 2229 0a20  re too small"). 
+00022a60: 2020 2020 2020 2063 6f68 6f72 745f 7175         cohort_qu
+00022a70: 6572 6965 735f 6368 6563 6b65 6420 3d20  eries_checked = 
+00022a80: 6469 6374 2829 0a20 2020 2020 2020 2066  dict().        f
+00022a90: 6f72 2063 6f68 6f72 745f 6c61 6265 6c2c  or cohort_label,
+00022aa0: 2063 6f68 6f72 745f 7175 6572 7920 696e   cohort_query in
+00022ab0: 2063 6f68 6f72 745f 7175 6572 6965 732e   cohort_queries.
+00022ac0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00022ad0: 2020 2020 2064 665f 636f 686f 7274 5f73       df_cohort_s
+00022ae0: 616d 706c 6573 203d 2073 656c 662e 7361  amples = self.sa
+00022af0: 6d70 6c65 5f6d 6574 6164 6174 6128 0a20  mple_metadata(. 
+00022b00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00022b10: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
+00022b20: 655f 7365 7473 2c20 7361 6d70 6c65 5f71  e_sets, sample_q
+00022b30: 7565 7279 3d63 6f68 6f72 745f 7175 6572  uery=cohort_quer
+00022b40: 790a 2020 2020 2020 2020 2020 2020 290a  y.            ).
+00022b50: 2020 2020 2020 2020 2020 2020 6e5f 7361              n_sa
+00022b60: 6d70 6c65 7320 3d20 6c65 6e28 6466 5f63  mples = len(df_c
+00022b70: 6f68 6f72 745f 7361 6d70 6c65 7329 0a20  ohort_samples). 
+00022b80: 2020 2020 2020 2020 2020 2069 6620 6e5f             if n_
+00022b90: 7361 6d70 6c65 7320 3c20 636f 686f 7274  samples < cohort
+00022ba0: 5f73 697a 653a 0a20 2020 2020 2020 2020  _size:.         
+00022bb0: 2020 2020 2020 2069 6e66 6f28 0a20 2020         info(.   
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bd0: 2066 2263 6f68 6f72 7420 287b 636f 686f   f"cohort ({coho
+00022be0: 7274 5f6c 6162 656c 7d29 2068 6173 2069  rt_label}) has i
+00022bf0: 6e73 7566 6669 6369 656e 7420 7361 6d70  nsufficient samp
+00022c00: 6c65 7320 287b 6e5f 7361 6d70 6c65 737d  les ({n_samples}
+00022c10: 2920 666f 7220 7265 7175 6573 7465 6420  ) for requested 
+00022c20: 636f 686f 7274 2073 697a 6520 287b 636f  cohort size ({co
+00022c30: 686f 7274 5f73 697a 657d 292c 2064 726f  hort_size}), dro
+00022c40: 7070 696e 6722 2020 2320 6e6f 7161 0a20  pping"  # noqa. 
+00022c50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00022c60: 2020 2320 6e6f 7161 0a20 2020 2020 2020    # noqa.       
+00022c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00022c80: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
+00022c90: 745f 7175 6572 6965 735f 6368 6563 6b65  t_queries_checke
+00022ca0: 645b 636f 686f 7274 5f6c 6162 656c 5d20  d[cohort_label] 
+00022cb0: 3d20 636f 686f 7274 5f71 7565 7279 0a0a  = cohort_query..
+00022cc0: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
+00022cd0: 6f6d 7075 7465 2064 6976 6572 7369 7479  ompute diversity
+00022ce0: 2073 7461 7473 2066 6f72 2063 6f68 6f72   stats for cohor
+00022cf0: 7473 2229 0a20 2020 2020 2020 2061 6c6c  ts").        all
+00022d00: 5f73 7461 7473 203d 205b 5d0a 2020 2020  _stats = [].    
+00022d10: 2020 2020 666f 7220 636f 686f 7274 5f6c      for cohort_l
+00022d20: 6162 656c 2c20 636f 686f 7274 5f71 7565  abel, cohort_que
+00022d30: 7279 2069 6e20 636f 686f 7274 5f71 7565  ry in cohort_que
+00022d40: 7269 6573 5f63 6865 636b 6564 2e69 7465  ries_checked.ite
+00022d50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00022d60: 2020 7374 6174 7320 3d20 7365 6c66 2e63    stats = self.c
+00022d70: 6f68 6f72 745f 6469 7665 7273 6974 795f  ohort_diversity_
+00022d80: 7374 6174 7328 0a20 2020 2020 2020 2020  stats(.         
+00022d90: 2020 2020 2020 2063 6f68 6f72 743d 2863         cohort=(c
+00022da0: 6f68 6f72 745f 6c61 6265 6c2c 2063 6f68  ohort_label, coh
+00022db0: 6f72 745f 7175 6572 7929 2c0a 2020 2020  ort_query),.    
+00022dc0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
+00022dd0: 7274 5f73 697a 653d 636f 686f 7274 5f73  rt_size=cohort_s
+00022de0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+00022df0: 2020 2020 2072 6567 696f 6e3d 7265 6769       region=regi
+00022e00: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00022e10: 2020 2020 7369 7465 5f6d 6173 6b3d 7369      site_mask=si
+00022e20: 7465 5f6d 6173 6b2c 0a20 2020 2020 2020  te_mask,.       
+00022e30: 2020 2020 2020 2020 2073 6974 655f 636c           site_cl
+00022e40: 6173 733d 7369 7465 5f63 6c61 7373 2c0a  ass=site_class,.
+00022e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e60: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
+00022e70: 6c65 5f73 6574 732c 0a20 2020 2020 2020  le_sets,.       
+00022e80: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
+00022e90: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
+00022ea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022eb0: 2020 6e5f 6a61 636b 3d6e 5f6a 6163 6b2c    n_jack=n_jack,
+00022ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ed0: 2063 6f6e 6669 6465 6e63 655f 6c65 7665   confidence_leve
+00022ee0: 6c3d 636f 6e66 6964 656e 6365 5f6c 6576  l=confidence_lev
+00022ef0: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
+00022f00: 290a 2020 2020 2020 2020 2020 2020 616c  ).            al
+00022f10: 6c5f 7374 6174 732e 6170 7065 6e64 2873  l_stats.append(s
+00022f20: 7461 7473 290a 2020 2020 2020 2020 6466  tats).        df
+00022f30: 5f73 7461 7473 203d 2070 642e 4461 7461  _stats = pd.Data
+00022f40: 4672 616d 6528 616c 6c5f 7374 6174 7329  Frame(all_stats)
+00022f50: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00022f60: 2064 665f 7374 6174 730a 0a20 2020 2040   df_stats..    @
+00022f70: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
+00022f80: 6d61 7279 3d22 2222 0a20 2020 2020 2020  mary=""".       
+00022f90: 2020 2020 2052 756e 2061 2046 7374 2067       Run a Fst g
+00022fa0: 656e 6f6d 652d 7769 6465 2073 6361 6e20  enome-wide scan 
+00022fb0: 746f 2069 6e76 6573 7469 6761 7465 2067  to investigate g
+00022fc0: 656e 6574 6963 2064 6966 6665 7265 6e74  enetic different
+00022fd0: 6961 7469 6f6e 0a20 2020 2020 2020 2020  iation.         
+00022fe0: 2020 2062 6574 7765 656e 2074 776f 2063     between two c
+00022ff0: 6f68 6f72 7473 2e0a 2020 2020 2020 2020  ohorts..        
+00023000: 2222 222c 0a20 2020 2020 2020 2072 6574  """,.        ret
+00023010: 7572 6e73 3d64 6963 7428 0a20 2020 2020  urns=dict(.     
+00023020: 2020 2020 2020 2078 3d22 416e 2061 7272         x="An arr
+00023030: 6179 2063 6f6e 7461 696e 696e 6720 7468  ay containing th
+00023040: 6520 7769 6e64 6f77 2063 656e 7472 6520  e window centre 
+00023050: 706f 696e 7420 6765 6e6f 6d69 6320 706f  point genomic po
+00023060: 7369 7469 6f6e 7322 2c0a 2020 2020 2020  sitions",.      
+00023070: 2020 2020 2020 6673 743d 2241 6e20 6172        fst="An ar
+00023080: 7261 7920 7769 7468 2046 7374 2073 7461  ray with Fst sta
+00023090: 7469 7374 6963 2076 616c 7565 7320 666f  tistic values fo
+000230a0: 7220 6561 6368 2077 696e 646f 772e 222c  r each window.",
+000230b0: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+000230c0: 290a 2020 2020 6465 6620 6673 745f 6777  ).    def fst_gw
+000230d0: 7373 280a 2020 2020 2020 2020 7365 6c66  ss(.        self
+000230e0: 2c0a 2020 2020 2020 2020 636f 6e74 6967  ,.        contig
+000230f0: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
+00023100: 6e74 6967 2c0a 2020 2020 2020 2020 7769  ntig,.        wi
+00023110: 6e64 6f77 5f73 697a 653a 2066 7374 5f70  ndow_size: fst_p
+00023120: 6172 616d 732e 7769 6e64 6f77 5f73 697a  arams.window_siz
+00023130: 652c 0a20 2020 2020 2020 2063 6f68 6f72  e,.        cohor
+00023140: 7431 5f71 7565 7279 3a20 6261 7365 5f70  t1_query: base_p
+00023150: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
+00023160: 7279 2c0a 2020 2020 2020 2020 636f 686f  ry,.        coho
+00023170: 7274 325f 7175 6572 793a 2062 6173 655f  rt2_query: base_
+00023180: 7061 7261 6d73 2e73 616d 706c 655f 7175  params.sample_qu
+00023190: 6572 792c 0a20 2020 2020 2020 2073 616d  ery,.        sam
+000231a0: 706c 655f 7365 7473 3a20 4f70 7469 6f6e  ple_sets: Option
+000231b0: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
+000231c0: 616d 706c 655f 7365 7473 5d20 3d20 4e6f  ample_sets] = No
+000231d0: 6e65 2c0a 2020 2020 2020 2020 7369 7465  ne,.        site
+000231e0: 5f6d 6173 6b3a 2062 6173 655f 7061 7261  _mask: base_para
+000231f0: 6d73 2e73 6974 655f 6d61 736b 203d 2044  ms.site_mask = D
+00023200: 4546 4155 4c54 2c0a 2020 2020 2020 2020  EFAULT,.        
+00023210: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+00023220: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
+00023230: 732e 636f 686f 7274 5f73 697a 655d 203d  s.cohort_size] =
+00023240: 2066 7374 5f70 6172 616d 732e 636f 686f   fst_params.coho
+00023250: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
+00023260: 0a20 2020 2020 2020 206d 696e 5f63 6f68  .        min_coh
+00023270: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
+00023280: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
+00023290: 6261 7365 5f70 6172 616d 732e 6d69 6e5f  base_params.min_
+000232a0: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
+000232b0: 2020 2020 5d20 3d20 6673 745f 7061 7261      ] = fst_para
+000232c0: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
+000232d0: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
+000232e0: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
+000232f0: 697a 653a 204f 7074 696f 6e61 6c5b 0a20  ize: Optional[. 
+00023300: 2020 2020 2020 2020 2020 2062 6173 655f             base_
+00023310: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
+00023320: 745f 7369 7a65 0a20 2020 2020 2020 205d  t_size.        ]
+00023330: 203d 2066 7374 5f70 6172 616d 732e 6d61   = fst_params.ma
+00023340: 785f 636f 686f 7274 5f73 697a 655f 6465  x_cohort_size_de
+00023350: 6661 756c 742c 0a20 2020 2020 2020 2072  fault,.        r
+00023360: 616e 646f 6d5f 7365 6564 3a20 6261 7365  andom_seed: base
+00023370: 5f70 6172 616d 732e 7261 6e64 6f6d 5f73  _params.random_s
+00023380: 6565 6420 3d20 3432 2c0a 2020 2020 2920  eed = 42,.    ) 
+00023390: 2d3e 2054 7570 6c65 5b6e 702e 6e64 6172  -> Tuple[np.ndar
+000233a0: 7261 792c 206e 702e 6e64 6172 7261 795d  ray, np.ndarray]
+000233b0: 3a0a 2020 2020 2020 2020 2320 544f 444f  :.        # TODO
+000233c0: 2063 6f75 6c64 2067 656e 6572 616c 6973   could generalis
+000233d0: 652c 2064 6f20 7468 6973 206f 6e20 6120  e, do this on a 
+000233e0: 7265 6769 6f6e 2072 6174 6865 7220 7468  region rather th
+000233f0: 616e 2061 2063 6f6e 7469 670a 0a20 2020  an a contig..   
+00023400: 2020 2020 2023 2054 4f44 4f20 6265 7474       # TODO bett
+00023410: 6572 2074 6f20 7375 7070 6f72 7420 6d69  er to support mi
+00023420: 6e5f 636f 686f 7274 5f73 697a 6520 616e  n_cohort_size an
+00023430: 6420 6d61 785f 636f 686f 7274 5f73 697a  d max_cohort_siz
+00023440: 6520 6865 7265 0a20 2020 2020 2020 2023  e here.        #
+00023450: 2072 6174 6865 7220 7468 616e 206a 7573   rather than jus
+00023460: 7420 6120 6669 7865 6420 636f 686f 7274  t a fixed cohort
+00023470: 5f73 697a 650a 0a20 2020 2020 2020 2023  _size..        #
+00023480: 2063 6861 6e67 6520 7468 6973 206e 616d   change this nam
+00023490: 6520 6966 2079 6f75 2065 7665 7220 6368  e if you ever ch
+000234a0: 616e 6765 2074 6865 2062 6568 6176 696f  ange the behavio
+000234b0: 7572 206f 6620 7468 6973 2066 756e 6374  ur of this funct
+000234c0: 696f 6e2c 2074 6f0a 2020 2020 2020 2020  ion, to.        
+000234d0: 2320 696e 7661 6c69 6461 7465 2061 6e79  # invalidate any
+000234e0: 2070 7265 7669 6f75 736c 7920 6361 6368   previously cach
+000234f0: 6564 2064 6174 610a 2020 2020 2020 2020  ed data.        
+00023500: 6e61 6d65 203d 2073 656c 662e 5f66 7374  name = self._fst
+00023510: 5f67 7773 735f 7265 7375 6c74 735f 6361  _gwss_results_ca
+00023520: 6368 655f 6e61 6d65 0a0a 2020 2020 2020  che_name..      
+00023530: 2020 7061 7261 6d73 203d 2064 6963 7428    params = dict(
+00023540: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00023550: 7469 673d 636f 6e74 6967 2c0a 2020 2020  tig=contig,.    
+00023560: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
+00023570: 697a 653d 7769 6e64 6f77 5f73 697a 652c  ize=window_size,
+00023580: 0a20 2020 2020 2020 2020 2020 2063 6f68  .            coh
+00023590: 6f72 7431 5f71 7565 7279 3d63 6f68 6f72  ort1_query=cohor
+000235a0: 7431 5f71 7565 7279 2c0a 2020 2020 2020  t1_query,.      
+000235b0: 2020 2020 2020 636f 686f 7274 325f 7175        cohort2_qu
+000235c0: 6572 793d 636f 686f 7274 325f 7175 6572  ery=cohort2_quer
+000235d0: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
+000235e0: 616d 706c 655f 7365 7473 3d73 656c 662e  ample_sets=self.
+000235f0: 5f70 7265 705f 7361 6d70 6c65 5f73 6574  _prep_sample_set
+00023600: 735f 7061 7261 6d28 7361 6d70 6c65 5f73  s_param(sample_s
+00023610: 6574 733d 7361 6d70 6c65 5f73 6574 7329  ets=sample_sets)
+00023620: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00023630: 7465 5f6d 6173 6b3d 7365 6c66 2e5f 7072  te_mask=self._pr
+00023640: 6570 5f73 6974 655f 6d61 736b 5f70 6172  ep_site_mask_par
+00023650: 616d 2873 6974 655f 6d61 736b 3d73 6974  am(site_mask=sit
+00023660: 655f 6d61 736b 292c 0a20 2020 2020 2020  e_mask),.       
+00023670: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
+00023680: 3d63 6f68 6f72 745f 7369 7a65 2c0a 2020  =cohort_size,.  
+00023690: 2020 2020 2020 2020 2020 6d69 6e5f 636f            min_co
+000236a0: 686f 7274 5f73 697a 653d 6d69 6e5f 636f  hort_size=min_co
+000236b0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+000236c0: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+000236d0: 745f 7369 7a65 3d6d 6178 5f63 6f68 6f72  t_size=max_cohor
+000236e0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
+000236f0: 2020 2020 7261 6e64 6f6d 5f73 6565 643d      random_seed=
+00023700: 7261 6e64 6f6d 5f73 6565 642c 0a20 2020  random_seed,.   
+00023710: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00023720: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00023730: 2072 6573 756c 7473 203d 2073 656c 662e   results = self.
+00023740: 7265 7375 6c74 735f 6361 6368 655f 6765  results_cache_ge
+00023750: 7428 6e61 6d65 3d6e 616d 652c 2070 6172  t(name=name, par
+00023760: 616d 733d 7061 7261 6d73 290a 0a20 2020  ams=params)..   
+00023770: 2020 2020 2065 7863 6570 7420 4361 6368       except Cach
+00023780: 654d 6973 733a 0a20 2020 2020 2020 2020  eMiss:.         
+00023790: 2020 2072 6573 756c 7473 203d 2073 656c     results = sel
+000237a0: 662e 5f66 7374 5f67 7773 7328 2a2a 7061  f._fst_gwss(**pa
+000237b0: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+000237c0: 2020 7365 6c66 2e72 6573 756c 7473 5f63    self.results_c
+000237d0: 6163 6865 5f73 6574 286e 616d 653d 6e61  ache_set(name=na
+000237e0: 6d65 2c20 7061 7261 6d73 3d70 6172 616d  me, params=param
+000237f0: 732c 2072 6573 756c 7473 3d72 6573 756c  s, results=resul
+00023800: 7473 290a 0a20 2020 2020 2020 2078 203d  ts)..        x =
+00023810: 2072 6573 756c 7473 5b22 7822 5d0a 2020   results["x"].  
+00023820: 2020 2020 2020 6673 7420 3d20 7265 7375        fst = resu
+00023830: 6c74 735b 2266 7374 225d 0a0a 2020 2020  lts["fst"]..    
+00023840: 2020 2020 7265 7475 726e 2078 2c20 6673      return x, fs
+00023850: 740a 0a20 2020 2064 6566 205f 6673 745f  t..    def _fst_
+00023860: 6777 7373 280a 2020 2020 2020 2020 7365  gwss(.        se
+00023870: 6c66 2c0a 2020 2020 2020 2020 636f 6e74  lf,.        cont
+00023880: 6967 2c0a 2020 2020 2020 2020 7769 6e64  ig,.        wind
+00023890: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
+000238a0: 2073 616d 706c 655f 7365 7473 2c0a 2020   sample_sets,.  
+000238b0: 2020 2020 2020 636f 686f 7274 315f 7175        cohort1_qu
+000238c0: 6572 792c 0a20 2020 2020 2020 2063 6f68  ery,.        coh
+000238d0: 6f72 7432 5f71 7565 7279 2c0a 2020 2020  ort2_query,.    
+000238e0: 2020 2020 7369 7465 5f6d 6173 6b2c 0a20      site_mask,. 
+000238f0: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
+00023900: 7a65 2c0a 2020 2020 2020 2020 6d69 6e5f  ze,.        min_
+00023910: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00023920: 2020 2020 206d 6178 5f63 6f68 6f72 745f       max_cohort_
+00023930: 7369 7a65 2c0a 2020 2020 2020 2020 7261  size,.        ra
+00023940: 6e64 6f6d 5f73 6565 642c 0a20 2020 2029  ndom_seed,.    )
+00023950: 3a0a 2020 2020 2020 2020 6473 5f73 6e70  :.        ds_snp
+00023960: 7331 203d 2073 656c 662e 736e 705f 6361  s1 = self.snp_ca
+00023970: 6c6c 7328 0a20 2020 2020 2020 2020 2020  lls(.           
+00023980: 2072 6567 696f 6e3d 636f 6e74 6967 2c0a   region=contig,.
+00023990: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+000239a0: 6c65 5f71 7565 7279 3d63 6f68 6f72 7431  le_query=cohort1
+000239b0: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
+000239c0: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
+000239d0: 7361 6d70 6c65 5f73 6574 732c 0a20 2020  sample_sets,.   
+000239e0: 2020 2020 2020 2020 2073 6974 655f 6d61           site_ma
+000239f0: 736b 3d73 6974 655f 6d61 736b 2c0a 2020  sk=site_mask,.  
+00023a00: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
+00023a10: 5f73 697a 653d 636f 686f 7274 5f73 697a  _size=cohort_siz
+00023a20: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00023a30: 696e 5f63 6f68 6f72 745f 7369 7a65 3d6d  in_cohort_size=m
+00023a40: 696e 5f63 6f68 6f72 745f 7369 7a65 2c0a  in_cohort_size,.
+00023a50: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00023a60: 636f 686f 7274 5f73 697a 653d 6d61 785f  cohort_size=max_
+00023a70: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00023a80: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
+00023a90: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
+00023aa0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00023ab0: 2020 2020 2064 735f 736e 7073 3220 3d20       ds_snps2 = 
+00023ac0: 7365 6c66 2e73 6e70 5f63 616c 6c73 280a  self.snp_calls(.
+00023ad0: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00023ae0: 6f6e 3d63 6f6e 7469 672c 0a20 2020 2020  on=contig,.     
+00023af0: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
+00023b00: 6572 793d 636f 686f 7274 325f 7175 6572  ery=cohort2_quer
+00023b10: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
+00023b20: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
+00023b30: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
+00023b40: 2020 2020 7369 7465 5f6d 6173 6b3d 7369      site_mask=si
+00023b50: 7465 5f6d 6173 6b2c 0a20 2020 2020 2020  te_mask,.       
+00023b60: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
+00023b70: 3d63 6f68 6f72 745f 7369 7a65 2c0a 2020  =cohort_size,.  
+00023b80: 2020 2020 2020 2020 2020 6d69 6e5f 636f            min_co
+00023b90: 686f 7274 5f73 697a 653d 6d69 6e5f 636f  hort_size=min_co
+00023ba0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+00023bb0: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+00023bc0: 745f 7369 7a65 3d6d 6178 5f63 6f68 6f72  t_size=max_cohor
+00023bd0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
+00023be0: 2020 2020 7261 6e64 6f6d 5f73 6565 643d      random_seed=
+00023bf0: 7261 6e64 6f6d 5f73 6565 642c 0a20 2020  random_seed,.   
+00023c00: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00023c10: 6774 3120 3d20 616c 6c65 6c2e 4765 6e6f  gt1 = allel.Geno
+00023c20: 7479 7065 4461 736b 4172 7261 7928 6473  typeDaskArray(ds
+00023c30: 5f73 6e70 7331 5b22 6361 6c6c 5f67 656e  _snps1["call_gen
+00023c40: 6f74 7970 6522 5d2e 6461 7461 290a 2020  otype"].data).  
+00023c50: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00023c60: 5f64 6173 6b5f 7072 6f67 7265 7373 2864  _dask_progress(d
+00023c70: 6573 633d 2243 6f6d 7075 7465 2061 6c6c  esc="Compute all
+00023c80: 656c 6520 636f 756e 7473 2066 6f72 2063  ele counts for c
+00023c90: 6f68 6f72 7420 3122 293a 0a20 2020 2020  ohort 1"):.     
+00023ca0: 2020 2020 2020 2061 6331 203d 2067 7431         ac1 = gt1
+00023cb0: 2e63 6f75 6e74 5f61 6c6c 656c 6573 286d  .count_alleles(m
+00023cc0: 6178 5f61 6c6c 656c 653d 3329 2e63 6f6d  ax_allele=3).com
+00023cd0: 7075 7465 2829 0a0a 2020 2020 2020 2020  pute()..        
+00023ce0: 6774 3220 3d20 616c 6c65 6c2e 4765 6e6f  gt2 = allel.Geno
+00023cf0: 7479 7065 4461 736b 4172 7261 7928 6473  typeDaskArray(ds
+00023d00: 5f73 6e70 7332 5b22 6361 6c6c 5f67 656e  _snps2["call_gen
+00023d10: 6f74 7970 6522 5d2e 6461 7461 290a 2020  otype"].data).  
+00023d20: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00023d30: 5f64 6173 6b5f 7072 6f67 7265 7373 2864  _dask_progress(d
+00023d40: 6573 633d 2243 6f6d 7075 7465 2061 6c6c  esc="Compute all
+00023d50: 656c 6520 636f 756e 7473 2066 6f72 2063  ele counts for c
+00023d60: 6f68 6f72 7420 3222 293a 0a20 2020 2020  ohort 2"):.     
+00023d70: 2020 2020 2020 2061 6332 203d 2067 7432         ac2 = gt2
+00023d80: 2e63 6f75 6e74 5f61 6c6c 656c 6573 286d  .count_alleles(m
+00023d90: 6178 5f61 6c6c 656c 653d 3329 2e63 6f6d  ax_allele=3).com
+00023da0: 7075 7465 2829 0a0a 2020 2020 2020 2020  pute()..        
+00023db0: 706f 7320 3d20 6473 5f73 6e70 7331 5b22  pos = ds_snps1["
+00023dc0: 7661 7269 616e 745f 706f 7369 7469 6f6e  variant_position
+00023dd0: 225d 2e76 616c 7565 730a 0a20 2020 2020  "].values..     
+00023de0: 2020 2066 7374 203d 2061 6c6c 656c 2e6d     fst = allel.m
+00023df0: 6f76 696e 675f 6875 6473 6f6e 5f66 7374  oving_hudson_fst
+00023e00: 2861 6331 2c20 6163 322c 2073 697a 653d  (ac1, ac2, size=
+00023e10: 7769 6e64 6f77 5f73 697a 6529 0a20 2020  window_size).   
+00023e20: 2020 2020 2078 203d 2061 6c6c 656c 2e6d       x = allel.m
+00023e30: 6f76 696e 675f 7374 6174 6973 7469 6328  oving_statistic(
+00023e40: 706f 732c 2073 7461 7469 7374 6963 3d6e  pos, statistic=n
+00023e50: 702e 6d65 616e 2c20 7369 7a65 3d77 696e  p.mean, size=win
+00023e60: 646f 775f 7369 7a65 290a 0a20 2020 2020  dow_size)..     
+00023e70: 2020 2072 6573 756c 7473 203d 2064 6963     results = dic
+00023e80: 7428 783d 782c 2066 7374 3d66 7374 290a  t(x=x, fst=fst).
+00023e90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00023ea0: 7265 7375 6c74 730a 0a20 2020 2040 646f  results..    @do
+00023eb0: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
+00023ec0: 7279 3d22 2222 0a20 2020 2020 2020 2020  ry=""".         
+00023ed0: 2020 2050 6c6f 7420 6120 6865 6174 6d61     Plot a heatma
+00023ee0: 7020 6672 6f6d 2061 2070 616e 6461 7320  p from a pandas 
+00023ef0: 4461 7461 4672 616d 6520 6f66 2066 7265  DataFrame of fre
+00023f00: 7175 656e 6369 6573 2c20 652e 672e 2c20  quencies, e.g., 
+00023f10: 6f75 7470 7574 0a20 2020 2020 2020 2020  output.         
+00023f20: 2020 2066 726f 6d20 6073 6e70 5f61 6c6c     from `snp_all
+00023f30: 656c 655f 6672 6571 7565 6e63 6965 7328  ele_frequencies(
+00023f40: 2960 206f 7220 6067 656e 655f 636e 765f  )` or `gene_cnv_
+00023f50: 6672 6571 7565 6e63 6965 7328 2960 2e0a  frequencies()`..
+00023f60: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
+00023f70: 2020 2020 2070 6172 616d 6574 6572 733d       parameters=
+00023f80: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
+00023f90: 2020 6466 3d22 2222 0a20 2020 2020 2020    df=""".       
+00023fa0: 2020 2020 2020 2020 2041 2044 6174 6146           A DataF
+00023fb0: 7261 6d65 206f 6620 6672 6571 7565 6e63  rame of frequenc
+00023fc0: 6965 732c 2065 2e67 2e2c 206f 7574 7075  ies, e.g., outpu
+00023fd0: 7420 6672 6f6d 0a20 2020 2020 2020 2020  t from.         
+00023fe0: 2020 2020 2020 2060 736e 705f 616c 6c65         `snp_alle
+00023ff0: 6c65 5f66 7265 7175 656e 6369 6573 2829  le_frequencies()
+00024000: 6020 6f72 2060 6765 6e65 5f63 6e76 5f66  ` or `gene_cnv_f
+00024010: 7265 7175 656e 6369 6573 2829 602e 0a20  requencies()`.. 
+00024020: 2020 2020 2020 2020 2020 2022 2222 2c0a             """,.
+00024030: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00024040: 783d 2222 220a 2020 2020 2020 2020 2020  x=""".          
+00024050: 2020 2020 2020 4f6e 6520 6f72 206d 6f72        One or mor
+00024060: 6520 636f 6c75 6d6e 2068 6561 6465 7273  e column headers
+00024070: 2074 6861 7420 6172 6520 7072 6573 656e   that are presen
+00024080: 7420 696e 2074 6865 2069 6e70 7574 2064  t in the input d
+00024090: 6174 6166 7261 6d65 2e0a 2020 2020 2020  ataframe..      
+000240a0: 2020 2020 2020 2020 2020 5468 6973 2062            This b
+000240b0: 6563 6f6d 6573 2074 6865 2068 6561 746d  ecomes the heatm
+000240c0: 6170 2079 2d61 7869 7320 726f 7720 6c61  ap y-axis row la
+000240d0: 6265 6c73 2e20 5468 6520 636f 6c75 6d6e  bels. The column
+000240e0: 2f73 206d 7573 740a 2020 2020 2020 2020  /s must.        
+000240f0: 2020 2020 2020 2020 7072 6f64 7563 6520          produce 
+00024100: 6120 756e 6971 7565 2069 6e64 6578 2e0a  a unique index..
+00024110: 2020 2020 2020 2020 2020 2020 2222 222c              """,
+00024120: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+00024130: 5f6c 656e 3d22 2222 0a20 2020 2020 2020  _len=""".       
+00024140: 2020 2020 2020 2020 2044 6973 706c 6179           Display
+00024150: 696e 6720 6c61 7267 6520 7374 796c 6564  ing large styled
+00024160: 2064 6174 6166 7261 6d65 7320 6d61 7920   dataframes may 
+00024170: 6361 7573 6520 6970 7974 686f 6e20 6e6f  cause ipython no
+00024180: 7465 626f 6f6b 7320 746f 0a20 2020 2020  tebooks to.     
+00024190: 2020 2020 2020 2020 2020 2063 7261 7368             crash
+000241a0: 2e20 4966 2074 6865 2069 6e70 7574 2064  . If the input d
+000241b0: 6174 6166 7261 6d65 2069 7320 6c61 7267  ataframe is larg
+000241c0: 6572 2074 6861 6e20 7468 6973 2076 616c  er than this val
+000241d0: 7565 2c20 616e 2065 7272 6f72 0a20 2020  ue, an error.   
+000241e0: 2020 2020 2020 2020 2020 2020 2077 696c               wil
+000241f0: 6c20 6265 2072 6169 7365 642e 0a20 2020  l be raised..   
+00024200: 2020 2020 2020 2020 2022 2222 2c0a 2020           """,.  
+00024210: 2020 2020 2020 2020 2020 636f 6c5f 7769            col_wi
+00024220: 6474 683d 2222 220a 2020 2020 2020 2020  dth=""".        
+00024230: 2020 2020 2020 2020 506c 6f74 2077 6964          Plot wid
+00024240: 7468 2070 6572 2063 6f6c 756d 6e20 696e  th per column in
+00024250: 2070 6978 656c 7320 2870 7829 2e0a 2020   pixels (px)..  
+00024260: 2020 2020 2020 2020 2020 2222 222c 0a20            """,. 
+00024270: 2020 2020 2020 2020 2020 2072 6f77 5f68             row_h
+00024280: 6569 6768 743d 2222 220a 2020 2020 2020  eight=""".      
+00024290: 2020 2020 2020 2020 2020 506c 6f74 2068            Plot h
+000242a0: 6569 6768 7420 7065 7220 726f 7720 696e  eight per row in
+000242b0: 2070 6978 656c 7320 2870 7829 2e0a 2020   pixels (px)..  
+000242c0: 2020 2020 2020 2020 2020 2222 222c 0a20            """,. 
+000242d0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+000242e0: 733d 2222 220a 2020 2020 2020 2020 2020  s=""".          
+000242f0: 2020 2020 2020 5061 7373 6564 2074 6872        Passed thr
+00024300: 6f75 6768 2074 6f20 6070 782e 696d 7368  ough to `px.imsh
+00024310: 6f77 2829 602e 0a20 2020 2020 2020 2020  ow()`..         
+00024320: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+00024330: 292c 0a20 2020 2020 2020 206e 6f74 6573  ),.        notes
+00024340: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
+00024350: 2049 7427 7320 7265 636f 6d6d 656e 6465   It's recommende
+00024360: 6420 746f 2066 696c 7465 7220 7468 6520  d to filter the 
+00024370: 696e 7075 7420 4461 7461 4672 616d 6520  input DataFrame 
+00024380: 746f 206a 7573 7420 726f 7773 206f 6620  to just rows of 
+00024390: 696e 7465 7265 7374 2c0a 2020 2020 2020  interest,.      
+000243a0: 2020 2020 2020 692e 652e 2c20 6665 7765        i.e., fewe
+000243b0: 7220 726f 7773 2074 6861 6e20 606d 6178  r rows than `max
+000243c0: 5f6c 656e 602e 0a20 2020 2020 2020 2022  _len`..        "
+000243d0: 2222 2c0a 2020 2020 290a 2020 2020 6465  "",.    ).    de
+000243e0: 6620 706c 6f74 5f66 7265 7175 656e 6369  f plot_frequenci
+000243f0: 6573 5f68 6561 746d 6170 280a 2020 2020  es_heatmap(.    
+00024400: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00024410: 2020 6466 3a20 7064 2e44 6174 6146 7261    df: pd.DataFra
+00024420: 6d65 2c0a 2020 2020 2020 2020 696e 6465  me,.        inde
+00024430: 783a 2055 6e69 6f6e 5b73 7472 2c20 4c69  x: Union[str, Li
+00024440: 7374 5b73 7472 5d5d 203d 2022 6c61 6265  st[str]] = "labe
+00024450: 6c22 2c0a 2020 2020 2020 2020 6d61 785f  l",.        max_
+00024460: 6c65 6e3a 204f 7074 696f 6e61 6c5b 696e  len: Optional[in
+00024470: 745d 203d 2031 3030 2c0a 2020 2020 2020  t] = 100,.      
+00024480: 2020 636f 6c5f 7769 6474 683a 2069 6e74    col_width: int
+00024490: 203d 2034 302c 0a20 2020 2020 2020 2072   = 40,.        r
+000244a0: 6f77 5f68 6569 6768 743a 2069 6e74 203d  ow_height: int =
+000244b0: 2032 302c 0a20 2020 2020 2020 2078 5f6c   20,.        x_l
+000244c0: 6162 656c 3a20 706c 6f74 6c79 5f70 6172  abel: plotly_par
+000244d0: 616d 732e 785f 6c61 6265 6c20 3d20 2243  ams.x_label = "C
+000244e0: 6f68 6f72 7473 222c 0a20 2020 2020 2020  ohorts",.       
+000244f0: 2079 5f6c 6162 656c 3a20 706c 6f74 6c79   y_label: plotly
+00024500: 5f70 6172 616d 732e 795f 6c61 6265 6c20  _params.y_label 
+00024510: 3d20 2256 6172 6961 6e74 7322 2c0a 2020  = "Variants",.  
+00024520: 2020 2020 2020 636f 6c6f 7262 6172 3a20        colorbar: 
+00024530: 706c 6f74 6c79 5f70 6172 616d 732e 636f  plotly_params.co
+00024540: 6c6f 7262 6172 203d 2054 7275 652c 0a20  lorbar = True,. 
+00024550: 2020 2020 2020 2077 6964 7468 3a20 706c         width: pl
+00024560: 6f74 6c79 5f70 6172 616d 732e 7769 6474  otly_params.widt
+00024570: 6820 3d20 4e6f 6e65 2c0a 2020 2020 2020  h = None,.      
+00024580: 2020 6865 6967 6874 3a20 706c 6f74 6c79    height: plotly
+00024590: 5f70 6172 616d 732e 6865 6967 6874 203d  _params.height =
+000245a0: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
+000245b0: 6578 745f 6175 746f 3a20 706c 6f74 6c79  ext_auto: plotly
+000245c0: 5f70 6172 616d 732e 7465 7874 5f61 7574  _params.text_aut
+000245d0: 6f20 3d20 222e 3025 222c 0a20 2020 2020  o = ".0%",.     
+000245e0: 2020 2061 7370 6563 743a 2070 6c6f 746c     aspect: plotl
+000245f0: 795f 7061 7261 6d73 2e61 7370 6563 7420  y_params.aspect 
+00024600: 3d20 2261 7574 6f22 2c0a 2020 2020 2020  = "auto",.      
+00024610: 2020 636f 6c6f 725f 636f 6e74 696e 756f    color_continuo
+00024620: 7573 5f73 6361 6c65 3a20 706c 6f74 6c79  us_scale: plotly
+00024630: 5f70 6172 616d 732e 636f 6c6f 725f 636f  _params.color_co
+00024640: 6e74 696e 756f 7573 5f73 6361 6c65 203d  ntinuous_scale =
+00024650: 2022 5265 6473 222c 0a20 2020 2020 2020   "Reds",.       
+00024660: 2074 6974 6c65 3a20 706c 6f74 6c79 5f70   title: plotly_p
+00024670: 6172 616d 732e 7469 746c 6520 3d20 5472  arams.title = Tr
+00024680: 7565 2c0a 2020 2020 2020 2020 2a2a 6b77  ue,.        **kw
+00024690: 6172 6773 2c0a 2020 2020 2920 2d3e 2070  args,.    ) -> p
+000246a0: 6c6f 746c 795f 7061 7261 6d73 2e66 6967  lotly_params.fig
+000246b0: 7572 653a 0a20 2020 2020 2020 2064 6562  ure:.        deb
+000246c0: 7567 203d 2073 656c 662e 5f6c 6f67 2e64  ug = self._log.d
+000246d0: 6562 7567 0a0a 2020 2020 2020 2020 6465  ebug..        de
+000246e0: 6275 6728 2263 6865 636b 206c 656e 206f  bug("check len o
+000246f0: 6620 696e 7075 7422 290a 2020 2020 2020  f input").      
+00024700: 2020 6966 206d 6178 5f6c 656e 2061 6e64    if max_len and
+00024710: 206c 656e 2864 6629 203e 206d 6178 5f6c   len(df) > max_l
+00024720: 656e 3a0a 2020 2020 2020 2020 2020 2020  en:.            
+00024730: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00024740: 2866 2249 6e70 7574 2044 6174 6146 7261  (f"Input DataFra
+00024750: 6d65 2069 7320 6c6f 6e67 6572 2074 6861  me is longer tha
+00024760: 6e20 7b6d 6178 5f6c 656e 7d22 290a 0a20  n {max_len}").. 
+00024770: 2020 2020 2020 2064 6562 7567 2822 6861         debug("ha
+00024780: 6e64 6c65 2074 6974 6c65 2229 0a20 2020  ndle title").   
+00024790: 2020 2020 2069 6620 7469 746c 6520 6973       if title is
+000247a0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+000247b0: 2020 2074 6974 6c65 203d 2064 662e 6174     title = df.at
+000247c0: 7472 732e 6765 7428 2274 6974 6c65 222c  trs.get("title",
+000247d0: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
+000247e0: 6465 6275 6728 2269 6e64 6578 696e 6722  debug("indexing"
+000247f0: 290a 2020 2020 2020 2020 6966 2069 6e64  ).        if ind
+00024800: 6578 2069 7320 4e6f 6e65 3a0a 2020 2020  ex is None:.    
+00024810: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+00024820: 6c69 7374 2864 662e 696e 6465 782e 6e61  list(df.index.na
+00024830: 6d65 7329 0a20 2020 2020 2020 2064 6620  mes).        df 
+00024840: 3d20 6466 2e72 6573 6574 5f69 6e64 6578  = df.reset_index
+00024850: 2829 2e63 6f70 7928 290a 2020 2020 2020  ().copy().      
+00024860: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00024870: 696e 6465 782c 206c 6973 7429 3a0a 2020  index, list):.  
+00024880: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+00024890: 636f 6c20 3d20 280a 2020 2020 2020 2020  col = (.        
+000248a0: 2020 2020 2020 2020 6466 5b69 6e64 6578          df[index
+000248b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000248c0: 2020 2e61 7374 7970 6528 7374 7229 0a20    .astype(str). 
+000248d0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+000248e0: 6170 706c 7928 0a20 2020 2020 2020 2020  apply(.         
+000248f0: 2020 2020 2020 2020 2020 206c 616d 6264             lambd
+00024900: 6120 726f 773a 2022 2c20 222e 6a6f 696e  a row: ", ".join
+00024910: 285b 6f20 666f 7220 6f20 696e 2072 6f77  ([o for o in row
+00024920: 2069 6620 6f20 6973 206e 6f74 204e 6f6e   if o is not Non
+00024930: 655d 292c 0a20 2020 2020 2020 2020 2020  e]),.           
+00024940: 2020 2020 2020 2020 2061 7869 733d 2263           axis="c
+00024950: 6f6c 756d 6e73 222c 0a20 2020 2020 2020  olumns",.       
+00024960: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00024970: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00024980: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00024990: 2869 6e64 6578 2c20 7374 7229 3a0a 2020  (index, str):.  
+000249a0: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+000249b0: 636f 6c20 3d20 6466 5b69 6e64 6578 5d2e  col = df[index].
+000249c0: 6173 7479 7065 2873 7472 290a 2020 2020  astype(str).    
+000249d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000249e0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+000249f0: 4572 726f 7228 2277 726f 6e67 2074 7970  Error("wrong typ
+00024a00: 6520 666f 7220 696e 6465 7820 7061 7261  e for index para
+00024a10: 6d65 7465 722c 2065 7870 6563 7465 6420  meter, expected 
+00024a20: 6c69 7374 206f 7220 7374 7222 290a 0a20  list or str").. 
+00024a30: 2020 2020 2020 2064 6562 7567 2822 6368         debug("ch
+00024a40: 6563 6b20 7468 6174 2069 6e64 6578 2069  eck that index i
+00024a50: 7320 756e 6971 7565 2229 0a20 2020 2020  s unique").     
+00024a60: 2020 2069 6620 6e6f 7420 696e 6465 785f     if not index_
+00024a70: 636f 6c2e 6973 5f75 6e69 7175 653a 0a20  col.is_unique:. 
+00024a80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00024a90: 2056 616c 7565 4572 726f 7228 6622 7b69   ValueError(f"{i
+00024aa0: 6e64 6578 7d20 646f 6573 206e 6f74 2070  ndex} does not p
+00024ab0: 726f 6475 6365 2061 2075 6e69 7175 6520  roduce a unique 
+00024ac0: 696e 6465 7822 290a 0a20 2020 2020 2020  index")..       
+00024ad0: 2064 6562 7567 2822 6472 6f70 2061 6e64   debug("drop and
+00024ae0: 2072 652d 6f72 6465 7220 636f 6c75 6d6e   re-order column
+00024af0: 7322 290a 2020 2020 2020 2020 6672 715f  s").        frq_
+00024b00: 636f 6c73 203d 205b 636f 6c20 666f 7220  cols = [col for 
+00024b10: 636f 6c20 696e 2064 662e 636f 6c75 6d6e  col in df.column
+00024b20: 7320 6966 2063 6f6c 2e73 7461 7274 7377  s if col.startsw
+00024b30: 6974 6828 2266 7271 5f22 295d 0a0a 2020  ith("frq_")]..  
+00024b40: 2020 2020 2020 6465 6275 6728 226b 6565        debug("kee
+00024b50: 7020 6f6e 6c79 2066 7265 7120 636f 6c73  p only freq cols
+00024b60: 2229 0a20 2020 2020 2020 2068 6561 746d  ").        heatm
+00024b70: 6170 5f64 6620 3d20 6466 5b66 7271 5f63  ap_df = df[frq_c
+00024b80: 6f6c 735d 2e63 6f70 7928 290a 0a20 2020  ols].copy()..   
+00024b90: 2020 2020 2064 6562 7567 2822 7365 7420       debug("set 
+00024ba0: 696e 6465 7822 290a 2020 2020 2020 2020  index").        
+00024bb0: 6865 6174 6d61 705f 6466 2e73 6574 5f69  heatmap_df.set_i
+00024bc0: 6e64 6578 2869 6e64 6578 5f63 6f6c 2c20  ndex(index_col, 
+00024bd0: 696e 706c 6163 653d 5472 7565 290a 0a20  inplace=True).. 
+00024be0: 2020 2020 2020 2064 6562 7567 2822 636c         debug("cl
+00024bf0: 6561 6e20 636f 6c75 6d6e 206e 616d 6573  ean column names
+00024c00: 2229 0a20 2020 2020 2020 2068 6561 746d  ").        heatm
+00024c10: 6170 5f64 662e 636f 6c75 6d6e 7320 3d20  ap_df.columns = 
+00024c20: 6865 6174 6d61 705f 6466 2e63 6f6c 756d  heatmap_df.colum
+00024c30: 6e73 2e73 7472 2e6c 7374 7269 7028 2266  ns.str.lstrip("f
+00024c40: 7271 5f22 290a 0a20 2020 2020 2020 2064  rq_")..        d
+00024c50: 6562 7567 2822 6465 616c 2077 6974 6820  ebug("deal with 
+00024c60: 7769 6474 6820 616e 6420 6865 6967 6874  width and height
+00024c70: 2229 0a20 2020 2020 2020 2069 6620 7769  ").        if wi
+00024c80: 6474 6820 6973 204e 6f6e 653a 0a20 2020  dth is None:.   
+00024c90: 2020 2020 2020 2020 2077 6964 7468 203d           width =
+00024ca0: 2034 3030 202b 2063 6f6c 5f77 6964 7468   400 + col_width
+00024cb0: 202a 206c 656e 2868 6561 746d 6170 5f64   * len(heatmap_d
+00024cc0: 662e 636f 6c75 6d6e 7329 0a20 2020 2020  f.columns).     
+00024cd0: 2020 2020 2020 2069 6620 636f 6c6f 7262         if colorb
+00024ce0: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
+00024cf0: 2020 2020 7769 6474 6820 2b3d 2034 300a      width += 40.
+00024d00: 2020 2020 2020 2020 6966 2068 6569 6768          if heigh
+00024d10: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+00024d20: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
+00024d30: 3230 3020 2b20 726f 775f 6865 6967 6874  200 + row_height
+00024d40: 202a 206c 656e 2868 6561 746d 6170 5f64   * len(heatmap_d
+00024d50: 6629 0a20 2020 2020 2020 2020 2020 2069  f).            i
+00024d60: 6620 7469 746c 6520 6973 206e 6f74 204e  f title is not N
+00024d70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00024d80: 2020 2020 2068 6569 6768 7420 2b3d 2034       height += 4
+00024d90: 300a 0a20 2020 2020 2020 2064 6562 7567  0..        debug
+00024da0: 2822 706c 6f74 6c79 2068 6561 746d 6170  ("plotly heatmap
+00024db0: 2073 7479 6c69 6e67 2229 0a20 2020 2020   styling").     
+00024dc0: 2020 2066 6967 203d 2070 782e 696d 7368     fig = px.imsh
+00024dd0: 6f77 280a 2020 2020 2020 2020 2020 2020  ow(.            
+00024de0: 696d 673d 6865 6174 6d61 705f 6466 2c0a  img=heatmap_df,.
+00024df0: 2020 2020 2020 2020 2020 2020 7a6d 696e              zmin
+00024e00: 3d30 2c0a 2020 2020 2020 2020 2020 2020  =0,.            
+00024e10: 7a6d 6178 3d31 2c0a 2020 2020 2020 2020  zmax=1,.        
+00024e20: 2020 2020 7769 6474 683d 7769 6474 682c      width=width,
+00024e30: 0a20 2020 2020 2020 2020 2020 2068 6569  .            hei
+00024e40: 6768 743d 6865 6967 6874 2c0a 2020 2020  ght=height,.    
+00024e50: 2020 2020 2020 2020 7465 7874 5f61 7574          text_aut
+00024e60: 6f3d 7465 7874 5f61 7574 6f2c 0a20 2020  o=text_auto,.   
+00024e70: 2020 2020 2020 2020 2061 7370 6563 743d           aspect=
+00024e80: 6173 7065 6374 2c0a 2020 2020 2020 2020  aspect,.        
+00024e90: 2020 2020 636f 6c6f 725f 636f 6e74 696e      color_contin
+00024ea0: 756f 7573 5f73 6361 6c65 3d63 6f6c 6f72  uous_scale=color
+00024eb0: 5f63 6f6e 7469 6e75 6f75 735f 7363 616c  _continuous_scal
+00024ec0: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
+00024ed0: 6974 6c65 3d74 6974 6c65 2c0a 2020 2020  itle=title,.    
+00024ee0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00024ef0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00024f00: 2020 2020 2066 6967 2e75 7064 6174 655f       fig.update_
+00024f10: 7861 7865 7328 7369 6465 3d22 626f 7474  xaxes(side="bott
+00024f20: 6f6d 222c 2074 6963 6b61 6e67 6c65 3d33  om", tickangle=3
+00024f30: 3029 0a20 2020 2020 2020 2069 6620 785f  0).        if x_
+00024f40: 6c61 6265 6c20 6973 206e 6f74 204e 6f6e  label is not Non
+00024f50: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+00024f60: 6967 2e75 7064 6174 655f 7861 7865 7328  ig.update_xaxes(
+00024f70: 7469 746c 653d 785f 6c61 6265 6c29 0a20  title=x_label). 
+00024f80: 2020 2020 2020 2069 6620 795f 6c61 6265         if y_labe
+00024f90: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
+00024fa0: 2020 2020 2020 2020 2020 2066 6967 2e75             fig.u
+00024fb0: 7064 6174 655f 7961 7865 7328 7469 746c  pdate_yaxes(titl
+00024fc0: 653d 795f 6c61 6265 6c29 0a20 2020 2020  e=y_label).     
+00024fd0: 2020 2066 6967 2e75 7064 6174 655f 6c61     fig.update_la
+00024fe0: 796f 7574 280a 2020 2020 2020 2020 2020  yout(.          
+00024ff0: 2020 636f 6c6f 7261 7869 735f 636f 6c6f    coloraxis_colo
+00025000: 7262 6172 3d64 6963 7428 0a20 2020 2020  rbar=dict(.     
+00025010: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+00025020: 3d22 4672 6571 7565 6e63 7922 2c0a 2020  ="Frequency",.  
+00025030: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00025040: 636b 7661 6c73 3d5b 302c 2030 2e32 2c20  ckvals=[0, 0.2, 
+00025050: 302e 342c 2030 2e36 2c20 302e 382c 2031  0.4, 0.6, 0.8, 1
+00025060: 2e30 5d2c 0a20 2020 2020 2020 2020 2020  .0],.           
+00025070: 2020 2020 2074 6963 6b74 6578 743d 5b22       ticktext=["
+00025080: 3025 222c 2022 3230 2522 2c20 2234 3025  0%", "20%", "40%
+00025090: 222c 2022 3630 2522 2c20 2238 3025 222c  ", "60%", "80%",
+000250a0: 2022 3130 3025 225d 2c0a 2020 2020 2020   "100%"],.      
+000250b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000250c0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+000250d0: 2063 6f6c 6f72 6261 723a 0a20 2020 2020   colorbar:.     
+000250e0: 2020 2020 2020 2066 6967 2e75 7064 6174         fig.updat
+000250f0: 6528 6c61 796f 7574 5f63 6f6c 6f72 6178  e(layout_colorax
+00025100: 6973 5f73 686f 7773 6361 6c65 3d46 616c  is_showscale=Fal
+00025110: 7365 290a 0a20 2020 2020 2020 2072 6574  se)..        ret
+00025120: 7572 6e20 6669 670a 0a20 2020 2040 646f  urn fig..    @do
+00025130: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
+00025140: 7279 3d22 4372 6561 7465 2061 2074 696d  ry="Create a tim
+00025150: 6520 7365 7269 6573 2070 6c6f 7420 6f66  e series plot of
+00025160: 2076 6172 6961 6e74 2066 7265 7175 656e   variant frequen
+00025170: 6369 6573 2075 7369 6e67 2070 6c6f 746c  cies using plotl
+00025180: 792e 222c 0a20 2020 2020 2020 2070 6172  y.",.        par
+00025190: 616d 6574 6572 733d 6469 6374 280a 2020  ameters=dict(.  
+000251a0: 2020 2020 2020 2020 2020 6473 3d22 2222            ds="""
+000251b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000251c0: 2041 2064 6174 6173 6574 206f 6620 7661   A dataset of va
+000251d0: 7269 616e 7420 6672 6571 7565 6e63 6965  riant frequencie
+000251e0: 732c 2073 7563 6820 6173 2072 6574 7572  s, such as retur
+000251f0: 6e65 6420 6279 0a20 2020 2020 2020 2020  ned by.         
+00025200: 2020 2020 2020 2060 736e 705f 616c 6c65         `snp_alle
+00025210: 6c65 5f66 7265 7175 656e 6369 6573 5f61  le_frequencies_a
+00025220: 6476 616e 6365 6428 2960 2c0a 2020 2020  dvanced()`,.    
+00025230: 2020 2020 2020 2020 2020 2020 6061 615f              `aa_
+00025240: 616c 6c65 6c65 5f66 7265 7175 656e 6369  allele_frequenci
+00025250: 6573 5f61 6476 616e 6365 6428 2960 206f  es_advanced()` o
+00025260: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00025270: 2020 6067 656e 655f 636e 765f 6672 6571    `gene_cnv_freq
+00025280: 7565 6e63 6965 735f 6164 7661 6e63 6564  uencies_advanced
+00025290: 2829 602e 0a20 2020 2020 2020 2020 2020  ()`..           
+000252a0: 2022 2222 2c0a 2020 2020 2020 2020 2020   """,.          
+000252b0: 2020 6b77 6172 6773 3d22 5061 7373 6564    kwargs="Passed
+000252c0: 2074 6872 6f75 6768 2074 6f20 6070 782e   through to `px.
+000252d0: 6c69 6e65 2829 602e 222c 0a20 2020 2020  line()`.",.     
+000252e0: 2020 2029 2c0a 2020 2020 2020 2020 7265     ),.        re
+000252f0: 7475 726e 733d 2222 220a 2020 2020 2020  turns=""".      
+00025300: 2020 2020 2020 4120 706c 6f74 6c79 2066        A plotly f
+00025310: 6967 7572 6520 636f 6e74 6169 6e69 6e67  igure containing
+00025320: 206c 696e 6520 6772 6170 6873 2e20 5468   line graphs. Th
+00025330: 6520 7265 7375 6c74 696e 6720 6669 6775  e resulting figu
+00025340: 7265 2077 696c 6c0a 2020 2020 2020 2020  re will.        
+00025350: 2020 2020 6861 7665 206f 6e65 2070 616e      have one pan
+00025360: 656c 2070 6572 2063 6f68 6f72 742c 2067  el per cohort, g
+00025370: 726f 7570 6564 2069 6e74 6f20 636f 6c75  rouped into colu
+00025380: 6d6e 7320 6279 2074 6178 6f6e 2c20 616e  mns by taxon, an
+00025390: 640a 2020 2020 2020 2020 2020 2020 6772  d.            gr
+000253a0: 6f75 7065 6420 696e 746f 2072 6f77 7320  ouped into rows 
+000253b0: 6279 2061 7265 612e 204d 6172 6b65 7273  by area. Markers
+000253c0: 2061 6e64 206c 696e 6573 2073 686f 7720   and lines show 
+000253d0: 6672 6571 7565 6e63 6965 7320 6f66 0a20  frequencies of. 
+000253e0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+000253f0: 6e74 732e 0a20 2020 2020 2020 2022 2222  nts..        """
+00025400: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
+00025410: 706c 6f74 5f66 7265 7175 656e 6369 6573  plot_frequencies
+00025420: 5f74 696d 655f 7365 7269 6573 280a 2020  _time_series(.  
+00025430: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00025440: 2020 2020 6473 3a20 7872 2e44 6174 6173      ds: xr.Datas
+00025450: 6574 2c0a 2020 2020 2020 2020 6865 6967  et,.        heig
+00025460: 6874 3a20 706c 6f74 6c79 5f70 6172 616d  ht: plotly_param
+00025470: 732e 6865 6967 6874 203d 204e 6f6e 652c  s.height = None,
+00025480: 0a20 2020 2020 2020 2077 6964 7468 3a20  .        width: 
+00025490: 706c 6f74 6c79 5f70 6172 616d 732e 7769  plotly_params.wi
+000254a0: 6474 6820 3d20 4e6f 6e65 2c0a 2020 2020  dth = None,.    
+000254b0: 2020 2020 7469 746c 653a 2070 6c6f 746c      title: plotl
+000254c0: 795f 7061 7261 6d73 2e74 6974 6c65 203d  y_params.title =
+000254d0: 2054 7275 652c 0a20 2020 2020 2020 202a   True,.        *
+000254e0: 2a6b 7761 7267 732c 0a20 2020 2029 202d  *kwargs,.    ) -
+000254f0: 3e20 706c 6f74 6c79 5f70 6172 616d 732e  > plotly_params.
+00025500: 6669 6775 7265 3a0a 2020 2020 2020 2020  figure:.        
+00025510: 6465 6275 6720 3d20 7365 6c66 2e5f 6c6f  debug = self._lo
+00025520: 672e 6465 6275 670a 0a20 2020 2020 2020  g.debug..       
+00025530: 2064 6562 7567 2822 6861 6e64 6c65 2074   debug("handle t
+00025540: 6974 6c65 2229 0a20 2020 2020 2020 2069  itle").        i
+00025550: 6620 7469 746c 6520 6973 2054 7275 653a  f title is True:
+00025560: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
+00025570: 6c65 203d 2064 732e 6174 7472 732e 6765  le = ds.attrs.ge
+00025580: 7428 2274 6974 6c65 222c 204e 6f6e 6529  t("title", None)
+00025590: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+000255a0: 2265 7874 7261 6374 2063 6f68 6f72 7473  "extract cohorts
+000255b0: 2069 6e74 6f20 6120 6461 7461 6672 616d   into a datafram
+000255c0: 6522 290a 2020 2020 2020 2020 636f 686f  e").        coho
+000255d0: 7274 5f76 6172 7320 3d20 5b76 2066 6f72  rt_vars = [v for
+000255e0: 2076 2069 6e20 6473 2069 6620 7374 7228   v in ds if str(
+000255f0: 7629 2e73 7461 7274 7377 6974 6828 2263  v).startswith("c
+00025600: 6f68 6f72 745f 2229 5d0a 2020 2020 2020  ohort_")].      
+00025610: 2020 6466 5f63 6f68 6f72 7473 203d 2064    df_cohorts = d
+00025620: 735b 636f 686f 7274 5f76 6172 735d 2e74  s[cohort_vars].t
+00025630: 6f5f 6461 7461 6672 616d 6528 290a 2020  o_dataframe().  
+00025640: 2020 2020 2020 6466 5f63 6f68 6f72 7473        df_cohorts
+00025650: 2e63 6f6c 756d 6e73 203d 205b 632e 7370  .columns = [c.sp
+00025660: 6c69 7428 2263 6f68 6f72 745f 2229 5b31  lit("cohort_")[1
+00025670: 5d20 666f 7220 6320 696e 2064 665f 636f  ] for c in df_co
+00025680: 686f 7274 732e 636f 6c75 6d6e 735d 0a0a  horts.columns]..
+00025690: 2020 2020 2020 2020 6465 6275 6728 2265          debug("e
+000256a0: 7874 7261 6374 2076 6172 6961 6e74 206c  xtract variant l
+000256b0: 6162 656c 7322 290a 2020 2020 2020 2020  abels").        
+000256c0: 7661 7269 616e 745f 6c61 6265 6c73 203d  variant_labels =
+000256d0: 2064 735b 2276 6172 6961 6e74 5f6c 6162   ds["variant_lab
+000256e0: 656c 225d 2e76 616c 7565 730a 0a20 2020  el"].values..   
+000256f0: 2020 2020 2064 6562 7567 2822 6275 696c       debug("buil
+00025700: 6420 6120 6c6f 6e67 2d66 6f72 6d20 6461  d a long-form da
+00025710: 7461 6672 616d 6520 6672 6f6d 2074 6865  taframe from the
+00025720: 2064 6174 6173 6574 2229 0a20 2020 2020   dataset").     
+00025730: 2020 2064 6673 203d 205b 5d0a 2020 2020     dfs = [].    
+00025740: 2020 2020 666f 7220 636f 686f 7274 5f69      for cohort_i
+00025750: 6e64 6578 2c20 636f 686f 7274 2069 6e20  ndex, cohort in 
+00025760: 656e 756d 6572 6174 6528 6466 5f63 6f68  enumerate(df_coh
+00025770: 6f72 7473 2e69 7465 7274 7570 6c65 7328  orts.itertuples(
+00025780: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00025790: 6473 5f63 6f68 6f72 7420 3d20 6473 2e69  ds_cohort = ds.i
+000257a0: 7365 6c28 636f 686f 7274 733d 636f 686f  sel(cohorts=coho
+000257b0: 7274 5f69 6e64 6578 290a 2020 2020 2020  rt_index).      
+000257c0: 2020 2020 2020 6466 203d 2070 642e 4461        df = pd.Da
+000257d0: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
+000257e0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+000257f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00025800: 7461 786f 6e22 3a20 636f 686f 7274 2e74  taxon": cohort.t
+00025810: 6178 6f6e 2c0a 2020 2020 2020 2020 2020  axon,.          
+00025820: 2020 2020 2020 2020 2020 2261 7265 6122            "area"
+00025830: 3a20 636f 686f 7274 2e61 7265 612c 0a20  : cohort.area,. 
 00025840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025850: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
-00025860: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00025870: 6974 655f 6d61 736b 3d73 6974 655f 6d61  ite_mask=site_ma
-00025880: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
-00025890: 2020 2020 7369 7465 5f63 6c61 7373 3d73      site_class=s
-000258a0: 6974 655f 636c 6173 732c 0a20 2020 2020  ite_class,.     
-000258b0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-000258c0: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
-000258d0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-000258e0: 2020 2020 7261 6e64 6f6d 5f73 6565 643d      random_seed=
-000258f0: 7261 6e64 6f6d 5f73 6565 642c 0a20 2020  random_seed,.   
-00025900: 2020 2020 2020 2020 2020 2020 206e 5f6a               n_j
-00025910: 6163 6b3d 6e5f 6a61 636b 2c0a 2020 2020  ack=n_jack,.    
-00025920: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00025930: 6964 656e 6365 5f6c 6576 656c 3d63 6f6e  idence_level=con
-00025940: 6669 6465 6e63 655f 6c65 7665 6c2c 0a20  fidence_level,. 
-00025950: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00025960: 2020 2020 2020 2020 2061 6c6c 5f73 7461           all_sta
-00025970: 7473 2e61 7070 656e 6428 7374 6174 7329  ts.append(stats)
-00025980: 0a20 2020 2020 2020 2064 665f 7374 6174  .        df_stat
-00025990: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
-000259a0: 2861 6c6c 5f73 7461 7473 290a 0a20 2020  (all_stats)..   
-000259b0: 2020 2020 2072 6574 7572 6e20 6466 5f73       return df_s
-000259c0: 7461 7473 0a0a 2020 2020 4064 6f63 280a  tats..    @doc(.
-000259d0: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-000259e0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-000259f0: 4372 6561 7465 2061 2070 6976 6f74 2074  Create a pivot t
-00025a00: 6162 6c65 2073 686f 7769 6e67 206e 756d  able showing num
-00025a10: 6265 7273 206f 6620 7361 6d70 6c65 7320  bers of samples 
-00025a20: 6176 6169 6c61 626c 6520 6279 2073 7061  available by spa
-00025a30: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00025a40: 7469 6d65 2061 6e64 2074 6178 6f6e 2e0a  time and taxon..
-00025a50: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-00025a60: 2020 2020 2070 6172 616d 6574 6572 733d       parameters=
-00025a70: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
-00025a80: 2020 696e 6465 783d 2253 616d 706c 6520    index="Sample 
-00025a90: 6d65 7461 6461 7461 2063 6f6c 756d 6e73  metadata columns
-00025aa0: 2074 6f20 7573 6520 666f 7220 7468 6520   to use for the 
-00025ab0: 7069 766f 7420 7461 626c 6520 696e 6465  pivot table inde
-00025ac0: 782e 222c 0a20 2020 2020 2020 2020 2020  x.",.           
-00025ad0: 2063 6f6c 756d 6e73 3d22 5361 6d70 6c65   columns="Sample
-00025ae0: 206d 6574 6164 6174 6120 636f 6c75 6d6e   metadata column
-00025af0: 7320 746f 2075 7365 2066 6f72 2074 6865  s to use for the
-00025b00: 2070 6976 6f74 2074 6162 6c65 2063 6f6c   pivot table col
-00025b10: 756d 6e73 2e22 2c0a 2020 2020 2020 2020  umns.",.        
-00025b20: 292c 0a20 2020 2020 2020 2072 6574 7572  ),.        retur
-00025b30: 6e73 3d22 5069 766f 7420 7461 626c 6520  ns="Pivot table 
-00025b40: 6f66 2073 616d 706c 6520 636f 756e 7473  of sample counts
-00025b50: 2e22 2c0a 2020 2020 290a 2020 2020 6465  .",.    ).    de
-00025b60: 6620 636f 756e 745f 7361 6d70 6c65 7328  f count_samples(
-00025b70: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00025b80: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-00025b90: 7473 3a20 4f70 7469 6f6e 616c 5b62 6173  ts: Optional[bas
-00025ba0: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
-00025bb0: 7365 7473 5d20 3d20 4e6f 6e65 2c0a 2020  sets] = None,.  
-00025bc0: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
-00025bd0: 7279 3a20 4f70 7469 6f6e 616c 5b62 6173  ry: Optional[bas
-00025be0: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
-00025bf0: 7175 6572 795d 203d 204e 6f6e 652c 0a20  query] = None,. 
-00025c00: 2020 2020 2020 2069 6e64 6578 3a20 556e         index: Un
-00025c10: 696f 6e5b 7374 722c 2054 7570 6c65 5b73  ion[str, Tuple[s
-00025c20: 7472 2c20 2e2e 2e5d 5d20 3d20 280a 2020  tr, ...]] = (.  
-00025c30: 2020 2020 2020 2020 2020 2263 6f75 6e74            "count
-00025c40: 7279 222c 0a20 2020 2020 2020 2020 2020  ry",.           
-00025c50: 2022 6164 6d69 6e31 5f69 736f 222c 0a20   "admin1_iso",. 
-00025c60: 2020 2020 2020 2020 2020 2022 6164 6d69             "admi
-00025c70: 6e31 5f6e 616d 6522 2c0a 2020 2020 2020  n1_name",.      
-00025c80: 2020 2020 2020 2261 646d 696e 325f 6e61        "admin2_na
-00025c90: 6d65 222c 0a20 2020 2020 2020 2020 2020  me",.           
-00025ca0: 2022 7965 6172 222c 0a20 2020 2020 2020   "year",.       
-00025cb0: 2029 2c0a 2020 2020 2020 2020 636f 6c75   ),.        colu
-00025cc0: 6d6e 733a 2055 6e69 6f6e 5b73 7472 2c20  mns: Union[str, 
-00025cd0: 5475 706c 655b 7374 722c 202e 2e2e 5d5d  Tuple[str, ...]]
-00025ce0: 203d 2022 7461 786f 6e22 2c0a 2020 2020   = "taxon",.    
-00025cf0: 2920 2d3e 2070 642e 4461 7461 4672 616d  ) -> pd.DataFram
-00025d00: 653a 0a20 2020 2020 2020 2064 6562 7567  e:.        debug
-00025d10: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
-00025d20: 7567 0a0a 2020 2020 2020 2020 6465 6275  ug..        debu
-00025d30: 6728 226c 6f61 6420 7361 6d70 6c65 206d  g("load sample m
-00025d40: 6574 6164 6174 6122 290a 2020 2020 2020  etadata").      
-00025d50: 2020 6466 5f73 616d 706c 6573 203d 2073    df_samples = s
-00025d60: 656c 662e 7361 6d70 6c65 5f6d 6574 6164  elf.sample_metad
-00025d70: 6174 6128 0a20 2020 2020 2020 2020 2020  ata(.           
-00025d80: 2073 616d 706c 655f 7365 7473 3d73 616d   sample_sets=sam
-00025d90: 706c 655f 7365 7473 2c20 7361 6d70 6c65  ple_sets, sample
-00025da0: 5f71 7565 7279 3d73 616d 706c 655f 7175  _query=sample_qu
-00025db0: 6572 790a 2020 2020 2020 2020 290a 0a20  ery.        ).. 
-00025dc0: 2020 2020 2020 2064 6562 7567 2822 6372         debug("cr
-00025dd0: 6561 7465 2070 6976 6f74 2074 6162 6c65  eate pivot table
-00025de0: 2229 0a20 2020 2020 2020 2064 665f 7069  ").        df_pi
-00025df0: 766f 7420 3d20 6466 5f73 616d 706c 6573  vot = df_samples
-00025e00: 2e70 6976 6f74 5f74 6162 6c65 280a 2020  .pivot_table(.  
-00025e10: 2020 2020 2020 2020 2020 696e 6465 783d            index=
-00025e20: 696e 6465 782c 0a20 2020 2020 2020 2020  index,.         
-00025e30: 2020 2063 6f6c 756d 6e73 3d63 6f6c 756d     columns=colum
-00025e40: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-00025e50: 7661 6c75 6573 3d22 7361 6d70 6c65 5f69  values="sample_i
-00025e60: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00025e70: 6167 6766 756e 633d 2263 6f75 6e74 222c  aggfunc="count",
-00025e80: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00025e90: 6c5f 7661 6c75 653d 302c 0a20 2020 2020  l_value=0,.     
-00025ea0: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-00025eb0: 7475 726e 2064 665f 7069 766f 740a 0a20  turn df_pivot.. 
-00025ec0: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
-00025ed0: 2073 756d 6d61 7279 3d22 2222 0a20 2020   summary=""".   
-00025ee0: 2020 2020 2020 2020 2052 756e 2061 2046           Run a F
-00025ef0: 7374 2067 656e 6f6d 652d 7769 6465 2073  st genome-wide s
-00025f00: 6361 6e20 746f 2069 6e76 6573 7469 6761  can to investiga
-00025f10: 7465 2067 656e 6574 6963 2064 6966 6665  te genetic diffe
-00025f20: 7265 6e74 6961 7469 6f6e 0a20 2020 2020  rentiation.     
-00025f30: 2020 2020 2020 2062 6574 7765 656e 2074         between t
-00025f40: 776f 2063 6f68 6f72 7473 2e0a 2020 2020  wo cohorts..    
-00025f50: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
-00025f60: 2072 6574 7572 6e73 3d64 6963 7428 0a20   returns=dict(. 
-00025f70: 2020 2020 2020 2020 2020 2078 3d22 416e             x="An
-00025f80: 2061 7272 6179 2063 6f6e 7461 696e 696e   array containin
-00025f90: 6720 7468 6520 7769 6e64 6f77 2063 656e  g the window cen
-00025fa0: 7472 6520 706f 696e 7420 6765 6e6f 6d69  tre point genomi
-00025fb0: 6320 706f 7369 7469 6f6e 7322 2c0a 2020  c positions",.  
-00025fc0: 2020 2020 2020 2020 2020 6673 743d 2241            fst="A
-00025fd0: 6e20 6172 7261 7920 7769 7468 2046 7374  n array with Fst
-00025fe0: 2073 7461 7469 7374 6963 2076 616c 7565   statistic value
-00025ff0: 7320 666f 7220 6561 6368 2077 696e 646f  s for each windo
-00026000: 772e 222c 0a20 2020 2020 2020 2029 2c0a  w.",.        ),.
-00026010: 2020 2020 290a 2020 2020 6465 6620 6673      ).    def fs
-00026020: 745f 6777 7373 280a 2020 2020 2020 2020  t_gwss(.        
-00026030: 7365 6c66 2c0a 2020 2020 2020 2020 636f  self,.        co
-00026040: 6e74 6967 3a20 6261 7365 5f70 6172 616d  ntig: base_param
-00026050: 732e 636f 6e74 6967 2c0a 2020 2020 2020  s.contig,.      
-00026060: 2020 7769 6e64 6f77 5f73 697a 653a 2066    window_size: f
-00026070: 7374 5f70 6172 616d 732e 7769 6e64 6f77  st_params.window
-00026080: 5f73 697a 652c 0a20 2020 2020 2020 2063  _size,.        c
-00026090: 6f68 6f72 7431 5f71 7565 7279 3a20 6261  ohort1_query: ba
-000260a0: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
-000260b0: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-000260c0: 636f 686f 7274 325f 7175 6572 793a 2062  cohort2_query: b
-000260d0: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
-000260e0: 655f 7175 6572 792c 0a20 2020 2020 2020  e_query,.       
-000260f0: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
-00026100: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-00026110: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
-00026120: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00026130: 7369 7465 5f6d 6173 6b3a 2062 6173 655f  site_mask: base_
-00026140: 7061 7261 6d73 2e73 6974 655f 6d61 736b  params.site_mask
-00026150: 203d 2044 4546 4155 4c54 2c0a 2020 2020   = DEFAULT,.    
-00026160: 2020 2020 636f 686f 7274 5f73 697a 653a      cohort_size:
-00026170: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00026180: 6172 616d 732e 636f 686f 7274 5f73 697a  arams.cohort_siz
-00026190: 655d 203d 2066 7374 5f70 6172 616d 732e  e] = fst_params.
-000261a0: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
-000261b0: 756c 742c 0a20 2020 2020 2020 206d 696e  ult,.        min
-000261c0: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
-000261d0: 7469 6f6e 616c 5b0a 2020 2020 2020 2020  tional[.        
-000261e0: 2020 2020 6261 7365 5f70 6172 616d 732e      base_params.
-000261f0: 6d69 6e5f 636f 686f 7274 5f73 697a 650a  min_cohort_size.
-00026200: 2020 2020 2020 2020 5d20 3d20 6673 745f          ] = fst_
-00026210: 7061 7261 6d73 2e6d 696e 5f63 6f68 6f72  params.min_cohor
-00026220: 745f 7369 7a65 5f64 6566 6175 6c74 2c0a  t_size_default,.
-00026230: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
-00026240: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-00026250: 6c5b 0a20 2020 2020 2020 2020 2020 2062  l[.            b
-00026260: 6173 655f 7061 7261 6d73 2e6d 6178 5f63  ase_params.max_c
-00026270: 6f68 6f72 745f 7369 7a65 0a20 2020 2020  ohort_size.     
-00026280: 2020 205d 203d 2066 7374 5f70 6172 616d     ] = fst_param
-00026290: 732e 6d61 785f 636f 686f 7274 5f73 697a  s.max_cohort_siz
-000262a0: 655f 6465 6661 756c 742c 0a20 2020 2020  e_default,.     
-000262b0: 2020 2072 616e 646f 6d5f 7365 6564 3a20     random_seed: 
-000262c0: 6261 7365 5f70 6172 616d 732e 7261 6e64  base_params.rand
-000262d0: 6f6d 5f73 6565 6420 3d20 3432 2c0a 2020  om_seed = 42,.  
-000262e0: 2020 2920 2d3e 2054 7570 6c65 5b6e 702e    ) -> Tuple[np.
-000262f0: 6e64 6172 7261 792c 206e 702e 6e64 6172  ndarray, np.ndar
-00026300: 7261 795d 3a0a 2020 2020 2020 2020 2320  ray]:.        # 
-00026310: 544f 444f 2063 6f75 6c64 2067 656e 6572  TODO could gener
-00026320: 616c 6973 652c 2064 6f20 7468 6973 206f  alise, do this o
-00026330: 6e20 6120 7265 6769 6f6e 2072 6174 6865  n a region rathe
-00026340: 7220 7468 616e 2061 2063 6f6e 7469 670a  r than a contig.
-00026350: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
-00026360: 6265 7474 6572 2074 6f20 7375 7070 6f72  better to suppor
-00026370: 7420 6d69 6e5f 636f 686f 7274 5f73 697a  t min_cohort_siz
-00026380: 6520 616e 6420 6d61 785f 636f 686f 7274  e and max_cohort
-00026390: 5f73 697a 6520 6865 7265 0a20 2020 2020  _size here.     
-000263a0: 2020 2023 2072 6174 6865 7220 7468 616e     # rather than
-000263b0: 206a 7573 7420 6120 6669 7865 6420 636f   just a fixed co
-000263c0: 686f 7274 5f73 697a 650a 0a20 2020 2020  hort_size..     
-000263d0: 2020 2023 2063 6861 6e67 6520 7468 6973     # change this
-000263e0: 206e 616d 6520 6966 2079 6f75 2065 7665   name if you eve
-000263f0: 7220 6368 616e 6765 2074 6865 2062 6568  r change the beh
-00026400: 6176 696f 7572 206f 6620 7468 6973 2066  aviour of this f
-00026410: 756e 6374 696f 6e2c 2074 6f0a 2020 2020  unction, to.    
-00026420: 2020 2020 2320 696e 7661 6c69 6461 7465      # invalidate
-00026430: 2061 6e79 2070 7265 7669 6f75 736c 7920   any previously 
-00026440: 6361 6368 6564 2064 6174 610a 2020 2020  cached data.    
-00026450: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
-00026460: 5f66 7374 5f67 7773 735f 7265 7375 6c74  _fst_gwss_result
-00026470: 735f 6361 6368 655f 6e61 6d65 0a0a 2020  s_cache_name..  
-00026480: 2020 2020 2020 7061 7261 6d73 203d 2064        params = d
-00026490: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
-000264a0: 2063 6f6e 7469 673d 636f 6e74 6967 2c0a   contig=contig,.
-000264b0: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-000264c0: 6f77 5f73 697a 653d 7769 6e64 6f77 5f73  ow_size=window_s
-000264d0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-000264e0: 2063 6f68 6f72 7431 5f71 7565 7279 3d63   cohort1_query=c
-000264f0: 6f68 6f72 7431 5f71 7565 7279 2c0a 2020  ohort1_query,.  
-00026500: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
-00026510: 325f 7175 6572 793d 636f 686f 7274 325f  2_query=cohort2_
-00026520: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
-00026530: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-00026540: 656c 662e 5f70 7265 705f 7361 6d70 6c65  elf._prep_sample
-00026550: 5f73 6574 735f 7061 7261 6d28 7361 6d70  _sets_param(samp
-00026560: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-00026570: 6574 7329 2c0a 2020 2020 2020 2020 2020  ets),.          
-00026580: 2020 7369 7465 5f6d 6173 6b3d 7365 6c66    site_mask=self
-00026590: 2e5f 7072 6570 5f73 6974 655f 6d61 736b  ._prep_site_mask
-000265a0: 5f70 6172 616d 2873 6974 655f 6d61 736b  _param(site_mask
-000265b0: 3d73 6974 655f 6d61 736b 292c 0a20 2020  =site_mask),.   
-000265c0: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
-000265d0: 7369 7a65 3d63 6f68 6f72 745f 7369 7a65  size=cohort_size
-000265e0: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-000265f0: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
-00026600: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-00026610: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-00026620: 6f68 6f72 745f 7369 7a65 3d6d 6178 5f63  ohort_size=max_c
-00026630: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00026640: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-00026650: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00026660: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00026670: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00026680: 2020 2020 2072 6573 756c 7473 203d 2073       results = s
-00026690: 656c 662e 7265 7375 6c74 735f 6361 6368  elf.results_cach
-000266a0: 655f 6765 7428 6e61 6d65 3d6e 616d 652c  e_get(name=name,
-000266b0: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
-000266c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000266d0: 4361 6368 654d 6973 733a 0a20 2020 2020  CacheMiss:.     
-000266e0: 2020 2020 2020 2072 6573 756c 7473 203d         results =
-000266f0: 2073 656c 662e 5f66 7374 5f67 7773 7328   self._fst_gwss(
-00026700: 2a2a 7061 7261 6d73 290a 2020 2020 2020  **params).      
-00026710: 2020 2020 2020 7365 6c66 2e72 6573 756c        self.resul
-00026720: 7473 5f63 6163 6865 5f73 6574 286e 616d  ts_cache_set(nam
-00026730: 653d 6e61 6d65 2c20 7061 7261 6d73 3d70  e=name, params=p
-00026740: 6172 616d 732c 2072 6573 756c 7473 3d72  arams, results=r
-00026750: 6573 756c 7473 290a 0a20 2020 2020 2020  esults)..       
-00026760: 2078 203d 2072 6573 756c 7473 5b22 7822   x = results["x"
-00026770: 5d0a 2020 2020 2020 2020 6673 7420 3d20  ].        fst = 
-00026780: 7265 7375 6c74 735b 2266 7374 225d 0a0a  results["fst"]..
-00026790: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-000267a0: 2c20 6673 740a 0a20 2020 2064 6566 205f  , fst..    def _
-000267b0: 6673 745f 6777 7373 280a 2020 2020 2020  fst_gwss(.      
-000267c0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000267d0: 636f 6e74 6967 2c0a 2020 2020 2020 2020  contig,.        
-000267e0: 7769 6e64 6f77 5f73 697a 652c 0a20 2020  window_size,.   
-000267f0: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
-00026800: 2c0a 2020 2020 2020 2020 636f 686f 7274  ,.        cohort
-00026810: 315f 7175 6572 792c 0a20 2020 2020 2020  1_query,.       
-00026820: 2063 6f68 6f72 7432 5f71 7565 7279 2c0a   cohort2_query,.
-00026830: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-00026840: 6b2c 0a20 2020 2020 2020 2063 6f68 6f72  k,.        cohor
-00026850: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-00026860: 6d69 6e5f 636f 686f 7274 5f73 697a 652c  min_cohort_size,
-00026870: 0a20 2020 2020 2020 206d 6178 5f63 6f68  .        max_coh
-00026880: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
-00026890: 2020 7261 6e64 6f6d 5f73 6565 642c 0a20    random_seed,. 
-000268a0: 2020 2029 3a0a 2020 2020 2020 2020 6473     ):.        ds
-000268b0: 5f73 6e70 7331 203d 2073 656c 662e 736e  _snps1 = self.sn
-000268c0: 705f 6361 6c6c 7328 0a20 2020 2020 2020  p_calls(.       
-000268d0: 2020 2020 2072 6567 696f 6e3d 636f 6e74       region=cont
-000268e0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-000268f0: 7361 6d70 6c65 5f71 7565 7279 3d63 6f68  sample_query=coh
-00026900: 6f72 7431 5f71 7565 7279 2c0a 2020 2020  ort1_query,.    
-00026910: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-00026920: 6574 733d 7361 6d70 6c65 5f73 6574 732c  ets=sample_sets,
-00026930: 0a20 2020 2020 2020 2020 2020 2073 6974  .            sit
-00026940: 655f 6d61 736b 3d73 6974 655f 6d61 736b  e_mask=site_mask
-00026950: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00026960: 686f 7274 5f73 697a 653d 636f 686f 7274  hort_size=cohort
-00026970: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00026980: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-00026990: 7a65 3d6d 696e 5f63 6f68 6f72 745f 7369  ze=min_cohort_si
-000269a0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-000269b0: 6d61 785f 636f 686f 7274 5f73 697a 653d  max_cohort_size=
-000269c0: 6d61 785f 636f 686f 7274 5f73 697a 652c  max_cohort_size,
-000269d0: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
-000269e0: 646f 6d5f 7365 6564 3d72 616e 646f 6d5f  dom_seed=random_
-000269f0: 7365 6564 2c0a 2020 2020 2020 2020 290a  seed,.        ).
-00026a00: 0a20 2020 2020 2020 2064 735f 736e 7073  .        ds_snps
-00026a10: 3220 3d20 7365 6c66 2e73 6e70 5f63 616c  2 = self.snp_cal
-00026a20: 6c73 280a 2020 2020 2020 2020 2020 2020  ls(.            
-00026a30: 7265 6769 6f6e 3d63 6f6e 7469 672c 0a20  region=contig,. 
-00026a40: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-00026a50: 655f 7175 6572 793d 636f 686f 7274 325f  e_query=cohort2_
-00026a60: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
-00026a70: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-00026a80: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
-00026a90: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-00026aa0: 6b3d 7369 7465 5f6d 6173 6b2c 0a20 2020  k=site_mask,.   
-00026ab0: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
-00026ac0: 7369 7a65 3d63 6f68 6f72 745f 7369 7a65  size=cohort_size
-00026ad0: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-00026ae0: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
-00026af0: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-00026b00: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-00026b10: 6f68 6f72 745f 7369 7a65 3d6d 6178 5f63  ohort_size=max_c
-00026b20: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00026b30: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-00026b40: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00026b50: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00026b60: 2020 2020 6774 3120 3d20 616c 6c65 6c2e      gt1 = allel.
-00026b70: 4765 6e6f 7479 7065 4461 736b 4172 7261  GenotypeDaskArra
-00026b80: 7928 6473 5f73 6e70 7331 5b22 6361 6c6c  y(ds_snps1["call
-00026b90: 5f67 656e 6f74 7970 6522 5d2e 6461 7461  _genotype"].data
-00026ba0: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-00026bb0: 656c 662e 5f64 6173 6b5f 7072 6f67 7265  elf._dask_progre
-00026bc0: 7373 2864 6573 633d 2243 6f6d 7075 7465  ss(desc="Compute
-00026bd0: 2061 6c6c 656c 6520 636f 756e 7473 2066   allele counts f
-00026be0: 6f72 2063 6f68 6f72 7420 3122 293a 0a20  or cohort 1"):. 
-00026bf0: 2020 2020 2020 2020 2020 2061 6331 203d             ac1 =
-00026c00: 2067 7431 2e63 6f75 6e74 5f61 6c6c 656c   gt1.count_allel
-00026c10: 6573 286d 6178 5f61 6c6c 656c 653d 3329  es(max_allele=3)
-00026c20: 2e63 6f6d 7075 7465 2829 0a0a 2020 2020  .compute()..    
-00026c30: 2020 2020 6774 3220 3d20 616c 6c65 6c2e      gt2 = allel.
-00026c40: 4765 6e6f 7479 7065 4461 736b 4172 7261  GenotypeDaskArra
-00026c50: 7928 6473 5f73 6e70 7332 5b22 6361 6c6c  y(ds_snps2["call
-00026c60: 5f67 656e 6f74 7970 6522 5d2e 6461 7461  _genotype"].data
-00026c70: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-00026c80: 656c 662e 5f64 6173 6b5f 7072 6f67 7265  elf._dask_progre
-00026c90: 7373 2864 6573 633d 2243 6f6d 7075 7465  ss(desc="Compute
-00026ca0: 2061 6c6c 656c 6520 636f 756e 7473 2066   allele counts f
-00026cb0: 6f72 2063 6f68 6f72 7420 3222 293a 0a20  or cohort 2"):. 
-00026cc0: 2020 2020 2020 2020 2020 2061 6332 203d             ac2 =
-00026cd0: 2067 7432 2e63 6f75 6e74 5f61 6c6c 656c   gt2.count_allel
-00026ce0: 6573 286d 6178 5f61 6c6c 656c 653d 3329  es(max_allele=3)
-00026cf0: 2e63 6f6d 7075 7465 2829 0a0a 2020 2020  .compute()..    
-00026d00: 2020 2020 706f 7320 3d20 6473 5f73 6e70      pos = ds_snp
-00026d10: 7331 5b22 7661 7269 616e 745f 706f 7369  s1["variant_posi
-00026d20: 7469 6f6e 225d 2e76 616c 7565 730a 0a20  tion"].values.. 
-00026d30: 2020 2020 2020 2066 7374 203d 2061 6c6c         fst = all
-00026d40: 656c 2e6d 6f76 696e 675f 6875 6473 6f6e  el.moving_hudson
-00026d50: 5f66 7374 2861 6331 2c20 6163 322c 2073  _fst(ac1, ac2, s
-00026d60: 697a 653d 7769 6e64 6f77 5f73 697a 6529  ize=window_size)
-00026d70: 0a20 2020 2020 2020 2078 203d 2061 6c6c  .        x = all
-00026d80: 656c 2e6d 6f76 696e 675f 7374 6174 6973  el.moving_statis
-00026d90: 7469 6328 706f 732c 2073 7461 7469 7374  tic(pos, statist
-00026da0: 6963 3d6e 702e 6d65 616e 2c20 7369 7a65  ic=np.mean, size
-00026db0: 3d77 696e 646f 775f 7369 7a65 290a 0a20  =window_size).. 
-00026dc0: 2020 2020 2020 2072 6573 756c 7473 203d         results =
-00026dd0: 2064 6963 7428 783d 782c 2066 7374 3d66   dict(x=x, fst=f
-00026de0: 7374 290a 0a20 2020 2020 2020 2072 6574  st)..        ret
-00026df0: 7572 6e20 7265 7375 6c74 730a 0a20 2020  urn results..   
-00026e00: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
-00026e10: 756d 6d61 7279 3d22 2222 0a20 2020 2020  ummary=""".     
-00026e20: 2020 2020 2020 2050 6c6f 7420 6120 6865         Plot a he
-00026e30: 6174 6d61 7020 6672 6f6d 2061 2070 616e  atmap from a pan
-00026e40: 6461 7320 4461 7461 4672 616d 6520 6f66  das DataFrame of
-00026e50: 2066 7265 7175 656e 6369 6573 2c20 652e   frequencies, e.
-00026e60: 672e 2c20 6f75 7470 7574 0a20 2020 2020  g., output.     
-00026e70: 2020 2020 2020 2066 726f 6d20 6073 6e70         from `snp
-00026e80: 5f61 6c6c 656c 655f 6672 6571 7565 6e63  _allele_frequenc
-00026e90: 6965 7328 2960 206f 7220 6067 656e 655f  ies()` or `gene_
-00026ea0: 636e 765f 6672 6571 7565 6e63 6965 7328  cnv_frequencies(
-00026eb0: 2960 2e0a 2020 2020 2020 2020 2222 222c  )`..        """,
-00026ec0: 0a20 2020 2020 2020 2070 6172 616d 6574  .        paramet
-00026ed0: 6572 733d 6469 6374 280a 2020 2020 2020  ers=dict(.      
-00026ee0: 2020 2020 2020 6466 3d22 2222 0a20 2020        df=""".   
-00026ef0: 2020 2020 2020 2020 2020 2020 2041 2044               A D
-00026f00: 6174 6146 7261 6d65 206f 6620 6672 6571  ataFrame of freq
-00026f10: 7565 6e63 6965 732c 2065 2e67 2e2c 206f  uencies, e.g., o
-00026f20: 7574 7075 7420 6672 6f6d 0a20 2020 2020  utput from.     
-00026f30: 2020 2020 2020 2020 2020 2060 736e 705f             `snp_
-00026f40: 616c 6c65 6c65 5f66 7265 7175 656e 6369  allele_frequenci
-00026f50: 6573 2829 6020 6f72 2060 6765 6e65 5f63  es()` or `gene_c
-00026f60: 6e76 5f66 7265 7175 656e 6369 6573 2829  nv_frequencies()
-00026f70: 602e 0a20 2020 2020 2020 2020 2020 2022  `..            "
-00026f80: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-00026f90: 696e 6465 783d 2222 220a 2020 2020 2020  index=""".      
-00026fa0: 2020 2020 2020 2020 2020 4f6e 6520 6f72            One or
-00026fb0: 206d 6f72 6520 636f 6c75 6d6e 2068 6561   more column hea
-00026fc0: 6465 7273 2074 6861 7420 6172 6520 7072  ders that are pr
-00026fd0: 6573 656e 7420 696e 2074 6865 2069 6e70  esent in the inp
-00026fe0: 7574 2064 6174 6166 7261 6d65 2e0a 2020  ut dataframe..  
-00026ff0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-00027000: 6973 2062 6563 6f6d 6573 2074 6865 2068  is becomes the h
-00027010: 6561 746d 6170 2079 2d61 7869 7320 726f  eatmap y-axis ro
-00027020: 7720 6c61 6265 6c73 2e20 5468 6520 636f  w labels. The co
-00027030: 6c75 6d6e 2f73 206d 7573 740a 2020 2020  lumn/s must.    
-00027040: 2020 2020 2020 2020 2020 2020 7072 6f64              prod
-00027050: 7563 6520 6120 756e 6971 7565 2069 6e64  uce a unique ind
-00027060: 6578 2e0a 2020 2020 2020 2020 2020 2020  ex..            
-00027070: 2222 222c 0a20 2020 2020 2020 2020 2020  """,.           
-00027080: 206d 6178 5f6c 656e 3d22 2222 0a20 2020   max_len=""".   
-00027090: 2020 2020 2020 2020 2020 2020 2044 6973               Dis
-000270a0: 706c 6179 696e 6720 6c61 7267 6520 7374  playing large st
-000270b0: 796c 6564 2064 6174 6166 7261 6d65 7320  yled dataframes 
-000270c0: 6d61 7920 6361 7573 6520 6970 7974 686f  may cause ipytho
-000270d0: 6e20 6e6f 7465 626f 6f6b 7320 746f 0a20  n notebooks to. 
-000270e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000270f0: 7261 7368 2e20 4966 2074 6865 2069 6e70  rash. If the inp
-00027100: 7574 2064 6174 6166 7261 6d65 2069 7320  ut dataframe is 
-00027110: 6c61 7267 6572 2074 6861 6e20 7468 6973  larger than this
-00027120: 2076 616c 7565 2c20 616e 2065 7272 6f72   value, an error
-00027130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027140: 2077 696c 6c20 6265 2072 6169 7365 642e   will be raised.
-00027150: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-00027160: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00027170: 6c5f 7769 6474 683d 2222 220a 2020 2020  l_width=""".    
-00027180: 2020 2020 2020 2020 2020 2020 506c 6f74              Plot
-00027190: 2077 6964 7468 2070 6572 2063 6f6c 756d   width per colum
-000271a0: 6e20 696e 2070 6978 656c 7320 2870 7829  n in pixels (px)
-000271b0: 2e0a 2020 2020 2020 2020 2020 2020 2222  ..            ""
-000271c0: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
-000271d0: 6f77 5f68 6569 6768 743d 2222 220a 2020  ow_height=""".  
-000271e0: 2020 2020 2020 2020 2020 2020 2020 506c                Pl
-000271f0: 6f74 2068 6569 6768 7420 7065 7220 726f  ot height per ro
-00027200: 7720 696e 2070 6978 656c 7320 2870 7829  w in pixels (px)
-00027210: 2e0a 2020 2020 2020 2020 2020 2020 2222  ..            ""
-00027220: 222c 0a20 2020 2020 2020 2020 2020 206b  ",.            k
-00027230: 7761 7267 733d 2222 220a 2020 2020 2020  wargs=""".      
-00027240: 2020 2020 2020 2020 2020 5061 7373 6564            Passed
-00027250: 2074 6872 6f75 6768 2074 6f20 6070 782e   through to `px.
-00027260: 696d 7368 6f77 2829 602e 0a20 2020 2020  imshow()`..     
-00027270: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-00027280: 2020 2020 292c 0a20 2020 2020 2020 206e      ),.        n
-00027290: 6f74 6573 3d22 2222 0a20 2020 2020 2020  otes=""".       
-000272a0: 2020 2020 2049 7427 7320 7265 636f 6d6d       It's recomm
-000272b0: 656e 6465 6420 746f 2066 696c 7465 7220  ended to filter 
-000272c0: 7468 6520 696e 7075 7420 4461 7461 4672  the input DataFr
-000272d0: 616d 6520 746f 206a 7573 7420 726f 7773  ame to just rows
-000272e0: 206f 6620 696e 7465 7265 7374 2c0a 2020   of interest,.  
-000272f0: 2020 2020 2020 2020 2020 692e 652e 2c20            i.e., 
-00027300: 6665 7765 7220 726f 7773 2074 6861 6e20  fewer rows than 
-00027310: 606d 6178 5f6c 656e 602e 0a20 2020 2020  `max_len`..     
-00027320: 2020 2022 2222 2c0a 2020 2020 290a 2020     """,.    ).  
-00027330: 2020 6465 6620 706c 6f74 5f66 7265 7175    def plot_frequ
-00027340: 656e 6369 6573 5f68 6561 746d 6170 280a  encies_heatmap(.
-00027350: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00027360: 2020 2020 2020 6466 3a20 7064 2e44 6174        df: pd.Dat
-00027370: 6146 7261 6d65 2c0a 2020 2020 2020 2020  aFrame,.        
-00027380: 696e 6465 783a 2055 6e69 6f6e 5b73 7472  index: Union[str
-00027390: 2c20 4c69 7374 5b73 7472 5d5d 203d 2022  , List[str]] = "
-000273a0: 6c61 6265 6c22 2c0a 2020 2020 2020 2020  label",.        
-000273b0: 6d61 785f 6c65 6e3a 204f 7074 696f 6e61  max_len: Optiona
-000273c0: 6c5b 696e 745d 203d 2031 3030 2c0a 2020  l[int] = 100,.  
-000273d0: 2020 2020 2020 636f 6c5f 7769 6474 683a        col_width:
-000273e0: 2069 6e74 203d 2034 302c 0a20 2020 2020   int = 40,.     
-000273f0: 2020 2072 6f77 5f68 6569 6768 743a 2069     row_height: i
-00027400: 6e74 203d 2032 302c 0a20 2020 2020 2020  nt = 20,.       
-00027410: 2078 5f6c 6162 656c 3a20 706c 6f74 6c79   x_label: plotly
-00027420: 5f70 6172 616d 732e 785f 6c61 6265 6c20  _params.x_label 
-00027430: 3d20 2243 6f68 6f72 7473 222c 0a20 2020  = "Cohorts",.   
-00027440: 2020 2020 2079 5f6c 6162 656c 3a20 706c       y_label: pl
-00027450: 6f74 6c79 5f70 6172 616d 732e 795f 6c61  otly_params.y_la
-00027460: 6265 6c20 3d20 2256 6172 6961 6e74 7322  bel = "Variants"
-00027470: 2c0a 2020 2020 2020 2020 636f 6c6f 7262  ,.        colorb
-00027480: 6172 3a20 706c 6f74 6c79 5f70 6172 616d  ar: plotly_param
-00027490: 732e 636f 6c6f 7262 6172 203d 2054 7275  s.colorbar = Tru
-000274a0: 652c 0a20 2020 2020 2020 2077 6964 7468  e,.        width
-000274b0: 3a20 706c 6f74 6c79 5f70 6172 616d 732e  : plotly_params.
-000274c0: 7769 6474 6820 3d20 4e6f 6e65 2c0a 2020  width = None,.  
-000274d0: 2020 2020 2020 6865 6967 6874 3a20 706c        height: pl
-000274e0: 6f74 6c79 5f70 6172 616d 732e 6865 6967  otly_params.heig
-000274f0: 6874 203d 204e 6f6e 652c 0a20 2020 2020  ht = None,.     
-00027500: 2020 2074 6578 745f 6175 746f 3a20 706c     text_auto: pl
-00027510: 6f74 6c79 5f70 6172 616d 732e 7465 7874  otly_params.text
-00027520: 5f61 7574 6f20 3d20 222e 3025 222c 0a20  _auto = ".0%",. 
-00027530: 2020 2020 2020 2061 7370 6563 743a 2070         aspect: p
-00027540: 6c6f 746c 795f 7061 7261 6d73 2e61 7370  lotly_params.asp
-00027550: 6563 7420 3d20 2261 7574 6f22 2c0a 2020  ect = "auto",.  
-00027560: 2020 2020 2020 636f 6c6f 725f 636f 6e74        color_cont
-00027570: 696e 756f 7573 5f73 6361 6c65 3a20 706c  inuous_scale: pl
-00027580: 6f74 6c79 5f70 6172 616d 732e 636f 6c6f  otly_params.colo
-00027590: 725f 636f 6e74 696e 756f 7573 5f73 6361  r_continuous_sca
-000275a0: 6c65 203d 2022 5265 6473 222c 0a20 2020  le = "Reds",.   
-000275b0: 2020 2020 2074 6974 6c65 3a20 706c 6f74       title: plot
-000275c0: 6c79 5f70 6172 616d 732e 7469 746c 6520  ly_params.title 
-000275d0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-000275e0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2920  **kwargs,.    ) 
-000275f0: 2d3e 2070 6c6f 746c 795f 7061 7261 6d73  -> plotly_params
-00027600: 2e66 6967 7572 653a 0a20 2020 2020 2020  .figure:.       
-00027610: 2064 6562 7567 203d 2073 656c 662e 5f6c   debug = self._l
-00027620: 6f67 2e64 6562 7567 0a0a 2020 2020 2020  og.debug..      
-00027630: 2020 6465 6275 6728 2263 6865 636b 206c    debug("check l
-00027640: 656e 206f 6620 696e 7075 7422 290a 2020  en of input").  
-00027650: 2020 2020 2020 6966 206d 6178 5f6c 656e        if max_len
-00027660: 2061 6e64 206c 656e 2864 6629 203e 206d   and len(df) > m
-00027670: 6178 5f6c 656e 3a0a 2020 2020 2020 2020  ax_len:.        
-00027680: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00027690: 7272 6f72 2866 2249 6e70 7574 2044 6174  rror(f"Input Dat
-000276a0: 6146 7261 6d65 2069 7320 6c6f 6e67 6572  aFrame is longer
-000276b0: 2074 6861 6e20 7b6d 6178 5f6c 656e 7d22   than {max_len}"
-000276c0: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
-000276d0: 2822 6861 6e64 6c65 2074 6974 6c65 2229  ("handle title")
-000276e0: 0a20 2020 2020 2020 2069 6620 7469 746c  .        if titl
-000276f0: 6520 6973 2054 7275 653a 0a20 2020 2020  e is True:.     
-00027700: 2020 2020 2020 2074 6974 6c65 203d 2064         title = d
-00027710: 662e 6174 7472 732e 6765 7428 2274 6974  f.attrs.get("tit
-00027720: 6c65 222c 204e 6f6e 6529 0a0a 2020 2020  le", None)..    
-00027730: 2020 2020 6465 6275 6728 2269 6e64 6578      debug("index
-00027740: 696e 6722 290a 2020 2020 2020 2020 6966  ing").        if
-00027750: 2069 6e64 6578 2069 7320 4e6f 6e65 3a0a   index is None:.
-00027760: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00027770: 7820 3d20 6c69 7374 2864 662e 696e 6465  x = list(df.inde
-00027780: 782e 6e61 6d65 7329 0a20 2020 2020 2020  x.names).       
-00027790: 2064 6620 3d20 6466 2e72 6573 6574 5f69   df = df.reset_i
-000277a0: 6e64 6578 2829 2e63 6f70 7928 290a 2020  ndex().copy().  
-000277b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000277c0: 6e63 6528 696e 6465 782c 206c 6973 7429  nce(index, list)
-000277d0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-000277e0: 6465 785f 636f 6c20 3d20 280a 2020 2020  dex_col = (.    
-000277f0: 2020 2020 2020 2020 2020 2020 6466 5b69              df[i
-00027800: 6e64 6578 5d0a 2020 2020 2020 2020 2020  ndex].          
-00027810: 2020 2020 2020 2e61 7374 7970 6528 7374        .astype(st
-00027820: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00027830: 2020 202e 6170 706c 7928 0a20 2020 2020     .apply(.     
-00027840: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00027850: 616d 6264 6120 726f 773a 2022 2c20 222e  ambda row: ", ".
-00027860: 6a6f 696e 285b 6f20 666f 7220 6f20 696e  join([o for o in
-00027870: 2072 6f77 2069 6620 6f20 6973 206e 6f74   row if o is not
-00027880: 204e 6f6e 655d 292c 0a20 2020 2020 2020   None]),.       
-00027890: 2020 2020 2020 2020 2020 2020 2061 7869               axi
-000278a0: 733d 2263 6f6c 756d 6e73 222c 0a20 2020  s="columns",.   
-000278b0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-000278c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000278d0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-000278e0: 616e 6365 2869 6e64 6578 2c20 7374 7229  ance(index, str)
-000278f0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-00027900: 6465 785f 636f 6c20 3d20 6466 5b69 6e64  dex_col = df[ind
-00027910: 6578 5d2e 6173 7479 7065 2873 7472 290a  ex].astype(str).
-00027920: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00027930: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00027940: 5479 7065 4572 726f 7228 2277 726f 6e67  TypeError("wrong
-00027950: 2074 7970 6520 666f 7220 696e 6465 7820   type for index 
-00027960: 7061 7261 6d65 7465 722c 2065 7870 6563  parameter, expec
-00027970: 7465 6420 6c69 7374 206f 7220 7374 7222  ted list or str"
-00027980: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
-00027990: 2822 6368 6563 6b20 7468 6174 2069 6e64  ("check that ind
-000279a0: 6578 2069 7320 756e 6971 7565 2229 0a20  ex is unique"). 
-000279b0: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
-000279c0: 6465 785f 636f 6c2e 6973 5f75 6e69 7175  dex_col.is_uniqu
-000279d0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000279e0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000279f0: 6622 7b69 6e64 6578 7d20 646f 6573 206e  f"{index} does n
-00027a00: 6f74 2070 726f 6475 6365 2061 2075 6e69  ot produce a uni
-00027a10: 7175 6520 696e 6465 7822 290a 0a20 2020  que index")..   
-00027a20: 2020 2020 2064 6562 7567 2822 6472 6f70       debug("drop
-00027a30: 2061 6e64 2072 652d 6f72 6465 7220 636f   and re-order co
-00027a40: 6c75 6d6e 7322 290a 2020 2020 2020 2020  lumns").        
-00027a50: 6672 715f 636f 6c73 203d 205b 636f 6c20  frq_cols = [col 
-00027a60: 666f 7220 636f 6c20 696e 2064 662e 636f  for col in df.co
-00027a70: 6c75 6d6e 7320 6966 2063 6f6c 2e73 7461  lumns if col.sta
-00027a80: 7274 7377 6974 6828 2266 7271 5f22 295d  rtswith("frq_")]
-00027a90: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00027aa0: 226b 6565 7020 6f6e 6c79 2066 7265 7120  "keep only freq 
-00027ab0: 636f 6c73 2229 0a20 2020 2020 2020 2068  cols").        h
-00027ac0: 6561 746d 6170 5f64 6620 3d20 6466 5b66  eatmap_df = df[f
-00027ad0: 7271 5f63 6f6c 735d 2e63 6f70 7928 290a  rq_cols].copy().
-00027ae0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00027af0: 7365 7420 696e 6465 7822 290a 2020 2020  set index").    
-00027b00: 2020 2020 6865 6174 6d61 705f 6466 2e73      heatmap_df.s
-00027b10: 6574 5f69 6e64 6578 2869 6e64 6578 5f63  et_index(index_c
-00027b20: 6f6c 2c20 696e 706c 6163 653d 5472 7565  ol, inplace=True
-00027b30: 290a 0a20 2020 2020 2020 2064 6562 7567  )..        debug
-00027b40: 2822 636c 6561 6e20 636f 6c75 6d6e 206e  ("clean column n
-00027b50: 616d 6573 2229 0a20 2020 2020 2020 2068  ames").        h
-00027b60: 6561 746d 6170 5f64 662e 636f 6c75 6d6e  eatmap_df.column
-00027b70: 7320 3d20 6865 6174 6d61 705f 6466 2e63  s = heatmap_df.c
-00027b80: 6f6c 756d 6e73 2e73 7472 2e6c 7374 7269  olumns.str.lstri
-00027b90: 7028 2266 7271 5f22 290a 0a20 2020 2020  p("frq_")..     
-00027ba0: 2020 2064 6562 7567 2822 6465 616c 2077     debug("deal w
-00027bb0: 6974 6820 7769 6474 6820 616e 6420 6865  ith width and he
-00027bc0: 6967 6874 2229 0a20 2020 2020 2020 2069  ight").        i
-00027bd0: 6620 7769 6474 6820 6973 204e 6f6e 653a  f width is None:
-00027be0: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
-00027bf0: 7468 203d 2034 3030 202b 2063 6f6c 5f77  th = 400 + col_w
-00027c00: 6964 7468 202a 206c 656e 2868 6561 746d  idth * len(heatm
-00027c10: 6170 5f64 662e 636f 6c75 6d6e 7329 0a20  ap_df.columns). 
-00027c20: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00027c30: 6c6f 7262 6172 3a0a 2020 2020 2020 2020  lorbar:.        
-00027c40: 2020 2020 2020 2020 7769 6474 6820 2b3d          width +=
-00027c50: 2034 300a 2020 2020 2020 2020 6966 2068   40.        if h
-00027c60: 6569 6768 7420 6973 204e 6f6e 653a 0a20  eight is None:. 
-00027c70: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00027c80: 7420 3d20 3230 3020 2b20 726f 775f 6865  t = 200 + row_he
-00027c90: 6967 6874 202a 206c 656e 2868 6561 746d  ight * len(heatm
-00027ca0: 6170 5f64 6629 0a20 2020 2020 2020 2020  ap_df).         
-00027cb0: 2020 2069 6620 7469 746c 6520 6973 206e     if title is n
-00027cc0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00027cd0: 2020 2020 2020 2020 2068 6569 6768 7420           height 
-00027ce0: 2b3d 2034 300a 0a20 2020 2020 2020 2064  += 40..        d
-00027cf0: 6562 7567 2822 706c 6f74 6c79 2068 6561  ebug("plotly hea
-00027d00: 746d 6170 2073 7479 6c69 6e67 2229 0a20  tmap styling"). 
-00027d10: 2020 2020 2020 2066 6967 203d 2070 782e         fig = px.
-00027d20: 696d 7368 6f77 280a 2020 2020 2020 2020  imshow(.        
-00027d30: 2020 2020 696d 673d 6865 6174 6d61 705f      img=heatmap_
-00027d40: 6466 2c0a 2020 2020 2020 2020 2020 2020  df,.            
-00027d50: 7a6d 696e 3d30 2c0a 2020 2020 2020 2020  zmin=0,.        
-00027d60: 2020 2020 7a6d 6178 3d31 2c0a 2020 2020      zmax=1,.    
-00027d70: 2020 2020 2020 2020 7769 6474 683d 7769          width=wi
-00027d80: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
-00027d90: 2068 6569 6768 743d 6865 6967 6874 2c0a   height=height,.
-00027da0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00027db0: 5f61 7574 6f3d 7465 7874 5f61 7574 6f2c  _auto=text_auto,
-00027dc0: 0a20 2020 2020 2020 2020 2020 2061 7370  .            asp
-00027dd0: 6563 743d 6173 7065 6374 2c0a 2020 2020  ect=aspect,.    
-00027de0: 2020 2020 2020 2020 636f 6c6f 725f 636f          color_co
-00027df0: 6e74 696e 756f 7573 5f73 6361 6c65 3d63  ntinuous_scale=c
-00027e00: 6f6c 6f72 5f63 6f6e 7469 6e75 6f75 735f  olor_continuous_
-00027e10: 7363 616c 652c 0a20 2020 2020 2020 2020  scale,.         
-00027e20: 2020 2074 6974 6c65 3d74 6974 6c65 2c0a     title=title,.
-00027e30: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-00027e40: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
-00027e50: 0a20 2020 2020 2020 2066 6967 2e75 7064  .        fig.upd
-00027e60: 6174 655f 7861 7865 7328 7369 6465 3d22  ate_xaxes(side="
-00027e70: 626f 7474 6f6d 222c 2074 6963 6b61 6e67  bottom", tickang
-00027e80: 6c65 3d33 3029 0a20 2020 2020 2020 2069  le=30).        i
-00027e90: 6620 785f 6c61 6265 6c20 6973 206e 6f74  f x_label is not
-00027ea0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00027eb0: 2020 2066 6967 2e75 7064 6174 655f 7861     fig.update_xa
-00027ec0: 7865 7328 7469 746c 653d 785f 6c61 6265  xes(title=x_labe
-00027ed0: 6c29 0a20 2020 2020 2020 2069 6620 795f  l).        if y_
-00027ee0: 6c61 6265 6c20 6973 206e 6f74 204e 6f6e  label is not Non
-00027ef0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-00027f00: 6967 2e75 7064 6174 655f 7961 7865 7328  ig.update_yaxes(
-00027f10: 7469 746c 653d 795f 6c61 6265 6c29 0a20  title=y_label). 
-00027f20: 2020 2020 2020 2066 6967 2e75 7064 6174         fig.updat
-00027f30: 655f 6c61 796f 7574 280a 2020 2020 2020  e_layout(.      
-00027f40: 2020 2020 2020 636f 6c6f 7261 7869 735f        coloraxis_
-00027f50: 636f 6c6f 7262 6172 3d64 6963 7428 0a20  colorbar=dict(. 
-00027f60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00027f70: 6974 6c65 3d22 4672 6571 7565 6e63 7922  itle="Frequency"
-00027f80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00027f90: 2020 7469 636b 7661 6c73 3d5b 302c 2030    tickvals=[0, 0
-00027fa0: 2e32 2c20 302e 342c 2030 2e36 2c20 302e  .2, 0.4, 0.6, 0.
-00027fb0: 382c 2031 2e30 5d2c 0a20 2020 2020 2020  8, 1.0],.       
-00027fc0: 2020 2020 2020 2020 2074 6963 6b74 6578           ticktex
-00027fd0: 743d 5b22 3025 222c 2022 3230 2522 2c20  t=["0%", "20%", 
-00027fe0: 2234 3025 222c 2022 3630 2522 2c20 2238  "40%", "60%", "8
-00027ff0: 3025 222c 2022 3130 3025 225d 2c0a 2020  0%", "100%"],.  
-00028000: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00028010: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-00028020: 206e 6f74 2063 6f6c 6f72 6261 723a 0a20   not colorbar:. 
-00028030: 2020 2020 2020 2020 2020 2066 6967 2e75             fig.u
-00028040: 7064 6174 6528 6c61 796f 7574 5f63 6f6c  pdate(layout_col
-00028050: 6f72 6178 6973 5f73 686f 7773 6361 6c65  oraxis_showscale
-00028060: 3d46 616c 7365 290a 0a20 2020 2020 2020  =False)..       
-00028070: 2072 6574 7572 6e20 6669 670a 0a20 2020   return fig..   
-00028080: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
-00028090: 756d 6d61 7279 3d22 4372 6561 7465 2061  ummary="Create a
-000280a0: 2074 696d 6520 7365 7269 6573 2070 6c6f   time series plo
-000280b0: 7420 6f66 2076 6172 6961 6e74 2066 7265  t of variant fre
-000280c0: 7175 656e 6369 6573 2075 7369 6e67 2070  quencies using p
-000280d0: 6c6f 746c 792e 222c 0a20 2020 2020 2020  lotly.",.       
-000280e0: 2070 6172 616d 6574 6572 733d 6469 6374   parameters=dict
-000280f0: 280a 2020 2020 2020 2020 2020 2020 6473  (.            ds
-00028100: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-00028110: 2020 2020 2041 2064 6174 6173 6574 206f       A dataset o
-00028120: 6620 7661 7269 616e 7420 6672 6571 7565  f variant freque
-00028130: 6e63 6965 732c 2073 7563 6820 6173 2072  ncies, such as r
-00028140: 6574 7572 6e65 6420 6279 0a20 2020 2020  eturned by.     
-00028150: 2020 2020 2020 2020 2020 2060 736e 705f             `snp_
-00028160: 616c 6c65 6c65 5f66 7265 7175 656e 6369  allele_frequenci
-00028170: 6573 5f61 6476 616e 6365 6428 2960 2c0a  es_advanced()`,.
-00028180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028190: 6061 615f 616c 6c65 6c65 5f66 7265 7175  `aa_allele_frequ
-000281a0: 656e 6369 6573 5f61 6476 616e 6365 6428  encies_advanced(
-000281b0: 2960 206f 720a 2020 2020 2020 2020 2020  )` or.          
-000281c0: 2020 2020 2020 6067 656e 655f 636e 765f        `gene_cnv_
-000281d0: 6672 6571 7565 6e63 6965 735f 6164 7661  frequencies_adva
-000281e0: 6e63 6564 2829 602e 0a20 2020 2020 2020  nced()`..       
-000281f0: 2020 2020 2022 2222 2c0a 2020 2020 2020       """,.      
-00028200: 2020 2020 2020 6b77 6172 6773 3d22 5061        kwargs="Pa
-00028210: 7373 6564 2074 6872 6f75 6768 2074 6f20  ssed through to 
-00028220: 6070 782e 6c69 6e65 2829 602e 222c 0a20  `px.line()`.",. 
-00028230: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00028240: 2020 7265 7475 726e 733d 2222 220a 2020    returns=""".  
-00028250: 2020 2020 2020 2020 2020 4120 706c 6f74            A plot
-00028260: 6c79 2066 6967 7572 6520 636f 6e74 6169  ly figure contai
-00028270: 6e69 6e67 206c 696e 6520 6772 6170 6873  ning line graphs
-00028280: 2e20 5468 6520 7265 7375 6c74 696e 6720  . The resulting 
-00028290: 6669 6775 7265 2077 696c 6c0a 2020 2020  figure will.    
-000282a0: 2020 2020 2020 2020 6861 7665 206f 6e65          have one
-000282b0: 2070 616e 656c 2070 6572 2063 6f68 6f72   panel per cohor
-000282c0: 742c 2067 726f 7570 6564 2069 6e74 6f20  t, grouped into 
-000282d0: 636f 6c75 6d6e 7320 6279 2074 6178 6f6e  columns by taxon
-000282e0: 2c20 616e 640a 2020 2020 2020 2020 2020  , and.          
-000282f0: 2020 6772 6f75 7065 6420 696e 746f 2072    grouped into r
-00028300: 6f77 7320 6279 2061 7265 612e 204d 6172  ows by area. Mar
-00028310: 6b65 7273 2061 6e64 206c 696e 6573 2073  kers and lines s
-00028320: 686f 7720 6672 6571 7565 6e63 6965 7320  how frequencies 
-00028330: 6f66 0a20 2020 2020 2020 2020 2020 2076  of.            v
-00028340: 6172 6961 6e74 732e 0a20 2020 2020 2020  ariants..       
-00028350: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
-00028360: 6465 6620 706c 6f74 5f66 7265 7175 656e  def plot_frequen
-00028370: 6369 6573 5f74 696d 655f 7365 7269 6573  cies_time_series
-00028380: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00028390: 2020 2020 2020 2020 6473 3a20 7872 2e44          ds: xr.D
-000283a0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
-000283b0: 6865 6967 6874 3a20 706c 6f74 6c79 5f70  height: plotly_p
-000283c0: 6172 616d 732e 6865 6967 6874 203d 204e  arams.height = N
-000283d0: 6f6e 652c 0a20 2020 2020 2020 2077 6964  one,.        wid
-000283e0: 7468 3a20 706c 6f74 6c79 5f70 6172 616d  th: plotly_param
-000283f0: 732e 7769 6474 6820 3d20 4e6f 6e65 2c0a  s.width = None,.
-00028400: 2020 2020 2020 2020 7469 746c 653a 2070          title: p
-00028410: 6c6f 746c 795f 7061 7261 6d73 2e74 6974  lotly_params.tit
-00028420: 6c65 203d 2054 7275 652c 0a20 2020 2020  le = True,.     
-00028430: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-00028440: 2029 202d 3e20 706c 6f74 6c79 5f70 6172   ) -> plotly_par
-00028450: 616d 732e 6669 6775 7265 3a0a 2020 2020  ams.figure:.    
-00028460: 2020 2020 6465 6275 6720 3d20 7365 6c66      debug = self
-00028470: 2e5f 6c6f 672e 6465 6275 670a 0a20 2020  ._log.debug..   
-00028480: 2020 2020 2064 6562 7567 2822 6861 6e64       debug("hand
-00028490: 6c65 2074 6974 6c65 2229 0a20 2020 2020  le title").     
-000284a0: 2020 2069 6620 7469 746c 6520 6973 2054     if title is T
-000284b0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
-000284c0: 2074 6974 6c65 203d 2064 732e 6174 7472   title = ds.attr
-000284d0: 732e 6765 7428 2274 6974 6c65 222c 204e  s.get("title", N
-000284e0: 6f6e 6529 0a0a 2020 2020 2020 2020 6465  one)..        de
-000284f0: 6275 6728 2265 7874 7261 6374 2063 6f68  bug("extract coh
-00028500: 6f72 7473 2069 6e74 6f20 6120 6461 7461  orts into a data
-00028510: 6672 616d 6522 290a 2020 2020 2020 2020  frame").        
-00028520: 636f 686f 7274 5f76 6172 7320 3d20 5b76  cohort_vars = [v
-00028530: 2066 6f72 2076 2069 6e20 6473 2069 6620   for v in ds if 
-00028540: 7374 7228 7629 2e73 7461 7274 7377 6974  str(v).startswit
-00028550: 6828 2263 6f68 6f72 745f 2229 5d0a 2020  h("cohort_")].  
-00028560: 2020 2020 2020 6466 5f63 6f68 6f72 7473        df_cohorts
-00028570: 203d 2064 735b 636f 686f 7274 5f76 6172   = ds[cohort_var
-00028580: 735d 2e74 6f5f 6461 7461 6672 616d 6528  s].to_dataframe(
-00028590: 290a 2020 2020 2020 2020 6466 5f63 6f68  ).        df_coh
-000285a0: 6f72 7473 2e63 6f6c 756d 6e73 203d 205b  orts.columns = [
-000285b0: 632e 7370 6c69 7428 2263 6f68 6f72 745f  c.split("cohort_
-000285c0: 2229 5b31 5d20 666f 7220 6320 696e 2064  ")[1] for c in d
-000285d0: 665f 636f 686f 7274 732e 636f 6c75 6d6e  f_cohorts.column
-000285e0: 735d 0a0a 2020 2020 2020 2020 6465 6275  s]..        debu
-000285f0: 6728 2265 7874 7261 6374 2076 6172 6961  g("extract varia
-00028600: 6e74 206c 6162 656c 7322 290a 2020 2020  nt labels").    
-00028610: 2020 2020 7661 7269 616e 745f 6c61 6265      variant_labe
-00028620: 6c73 203d 2064 735b 2276 6172 6961 6e74  ls = ds["variant
-00028630: 5f6c 6162 656c 225d 2e76 616c 7565 730a  _label"].values.
-00028640: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00028650: 6275 696c 6420 6120 6c6f 6e67 2d66 6f72  build a long-for
-00028660: 6d20 6461 7461 6672 616d 6520 6672 6f6d  m dataframe from
-00028670: 2074 6865 2064 6174 6173 6574 2229 0a20   the dataset"). 
-00028680: 2020 2020 2020 2064 6673 203d 205b 5d0a         dfs = [].
-00028690: 2020 2020 2020 2020 666f 7220 636f 686f          for coho
-000286a0: 7274 5f69 6e64 6578 2c20 636f 686f 7274  rt_index, cohort
-000286b0: 2069 6e20 656e 756d 6572 6174 6528 6466   in enumerate(df
-000286c0: 5f63 6f68 6f72 7473 2e69 7465 7274 7570  _cohorts.itertup
-000286d0: 6c65 7328 2929 3a0a 2020 2020 2020 2020  les()):.        
-000286e0: 2020 2020 6473 5f63 6f68 6f72 7420 3d20      ds_cohort = 
-000286f0: 6473 2e69 7365 6c28 636f 686f 7274 733d  ds.isel(cohorts=
-00028700: 636f 686f 7274 5f69 6e64 6578 290a 2020  cohort_index).  
-00028710: 2020 2020 2020 2020 2020 6466 203d 2070            df = p
-00028720: 642e 4461 7461 4672 616d 6528 0a20 2020  d.DataFrame(.   
-00028730: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
-00028740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028750: 2020 2022 7461 786f 6e22 3a20 636f 686f     "taxon": coho
-00028760: 7274 2e74 6178 6f6e 2c0a 2020 2020 2020  rt.taxon,.      
-00028770: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-00028780: 7265 6122 3a20 636f 686f 7274 2e61 7265  rea": cohort.are
-00028790: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
-000287a0: 2020 2020 2020 2022 6461 7465 223a 2063         "date": c
-000287b0: 6f68 6f72 742e 7065 7269 6f64 5f73 7461  ohort.period_sta
-000287c0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-000287d0: 2020 2020 2020 2020 2270 6572 696f 6422          "period"
-000287e0: 3a20 7374 7228 0a20 2020 2020 2020 2020  : str(.         
-000287f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00028800: 6f68 6f72 742e 7065 7269 6f64 0a20 2020  ohort.period.   
-00028810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028820: 2029 2c20 2023 2075 7365 2073 7472 696e   ),  # use strin
-00028830: 6720 7265 7072 6573 656e 7461 7469 6f6e  g representation
-00028840: 2066 6f72 2068 6f76 6572 206c 6162 656c   for hover label
-00028850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028860: 2020 2020 2022 7361 6d70 6c65 5f73 697a       "sample_siz
-00028870: 6522 3a20 636f 686f 7274 2e73 697a 652c  e": cohort.size,
-00028880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028890: 2020 2020 2022 7661 7269 616e 7422 3a20       "variant": 
-000288a0: 7661 7269 616e 745f 6c61 6265 6c73 2c0a  variant_labels,.
-000288b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288c0: 2020 2020 2263 6f75 6e74 223a 2064 735f      "count": ds_
-000288d0: 636f 686f 7274 5b22 6576 656e 745f 636f  cohort["event_co
-000288e0: 756e 7422 5d2e 7661 6c75 6573 2c0a 2020  unt"].values,.  
-000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028900: 2020 226e 6f62 7322 3a20 6473 5f63 6f68    "nobs": ds_coh
-00028910: 6f72 745b 2265 7665 6e74 5f6e 6f62 7322  ort["event_nobs"
-00028920: 5d2e 7661 6c75 6573 2c0a 2020 2020 2020  ].values,.      
-00028930: 2020 2020 2020 2020 2020 2020 2020 2266                "f
-00028940: 7265 7175 656e 6379 223a 2064 735f 636f  requency": ds_co
-00028950: 686f 7274 5b22 6576 656e 745f 6672 6571  hort["event_freq
-00028960: 7565 6e63 7922 5d2e 7661 6c75 6573 2c0a  uency"].values,.
-00028970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028980: 2020 2020 2266 7265 7175 656e 6379 5f63      "frequency_c
-00028990: 695f 6c6f 7722 3a20 6473 5f63 6f68 6f72  i_low": ds_cohor
-000289a0: 745b 2265 7665 6e74 5f66 7265 7175 656e  t["event_frequen
-000289b0: 6379 5f63 695f 6c6f 7722 5d2e 7661 6c75  cy_ci_low"].valu
-000289c0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-000289d0: 2020 2020 2020 2020 2266 7265 7175 656e          "frequen
-000289e0: 6379 5f63 695f 7570 7022 3a20 6473 5f63  cy_ci_upp": ds_c
-000289f0: 6f68 6f72 745b 2265 7665 6e74 5f66 7265  ohort["event_fre
-00028a00: 7175 656e 6379 5f63 695f 7570 7022 5d2e  quency_ci_upp"].
-00028a10: 7661 6c75 6573 2c0a 2020 2020 2020 2020  values,.        
-00028a20: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00028a30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00028a40: 2020 2020 6466 732e 6170 7065 6e64 2864      dfs.append(d
-00028a50: 6629 0a20 2020 2020 2020 2064 665f 6576  f).        df_ev
-00028a60: 656e 7473 203d 2070 642e 636f 6e63 6174  ents = pd.concat
-00028a70: 2864 6673 2c20 6178 6973 3d30 292e 7265  (dfs, axis=0).re
-00028a80: 7365 745f 696e 6465 7828 6472 6f70 3d54  set_index(drop=T
-00028a90: 7275 6529 0a0a 2020 2020 2020 2020 6465  rue)..        de
-00028aa0: 6275 6728 2272 656d 6f76 6520 6576 656e  bug("remove even
-00028ab0: 7473 2077 6974 6820 6e6f 206f 6273 6572  ts with no obser
-00028ac0: 7661 7469 6f6e 7322 290a 2020 2020 2020  vations").      
-00028ad0: 2020 6466 5f65 7665 6e74 7320 3d20 6466    df_events = df
-00028ae0: 5f65 7665 6e74 732e 7175 6572 7928 226e  _events.query("n
-00028af0: 6f62 7320 3e20 3022 290a 0a20 2020 2020  obs > 0")..     
-00028b00: 2020 2064 6562 7567 2822 6361 6c63 756c     debug("calcul
-00028b10: 6174 6520 6572 726f 7220 6261 7273 2229  ate error bars")
-00028b20: 0a20 2020 2020 2020 2066 7271 203d 2064  .        frq = d
-00028b30: 665f 6576 656e 7473 5b22 6672 6571 7565  f_events["freque
-00028b40: 6e63 7922 5d0a 2020 2020 2020 2020 6672  ncy"].        fr
-00028b50: 715f 6369 5f6c 6f77 203d 2064 665f 6576  q_ci_low = df_ev
-00028b60: 656e 7473 5b22 6672 6571 7565 6e63 795f  ents["frequency_
-00028b70: 6369 5f6c 6f77 225d 0a20 2020 2020 2020  ci_low"].       
-00028b80: 2066 7271 5f63 695f 7570 7020 3d20 6466   frq_ci_upp = df
-00028b90: 5f65 7665 6e74 735b 2266 7265 7175 656e  _events["frequen
-00028ba0: 6379 5f63 695f 7570 7022 5d0a 2020 2020  cy_ci_upp"].    
-00028bb0: 2020 2020 6466 5f65 7665 6e74 735b 2266      df_events["f
-00028bc0: 7265 7175 656e 6379 5f65 7272 6f72 225d  requency_error"]
-00028bd0: 203d 2066 7271 5f63 695f 7570 7020 2d20   = frq_ci_upp - 
-00028be0: 6672 710a 2020 2020 2020 2020 6466 5f65  frq.        df_e
-00028bf0: 7665 6e74 735b 2266 7265 7175 656e 6379  vents["frequency
-00028c00: 5f65 7272 6f72 5f6d 696e 7573 225d 203d  _error_minus"] =
-00028c10: 2066 7271 202d 2066 7271 5f63 695f 6c6f   frq - frq_ci_lo
-00028c20: 770a 0a20 2020 2020 2020 2064 6562 7567  w..        debug
-00028c30: 2822 6d61 6b65 2061 2070 6c6f 7422 290a  ("make a plot").
-00028c40: 2020 2020 2020 2020 6669 6720 3d20 7078          fig = px
-00028c50: 2e6c 696e 6528 0a20 2020 2020 2020 2020  .line(.         
-00028c60: 2020 2064 665f 6576 656e 7473 2c0a 2020     df_events,.  
-00028c70: 2020 2020 2020 2020 2020 6661 6365 745f            facet_
-00028c80: 636f 6c3d 2274 6178 6f6e 222c 0a20 2020  col="taxon",.   
-00028c90: 2020 2020 2020 2020 2066 6163 6574 5f72           facet_r
-00028ca0: 6f77 3d22 6172 6561 222c 0a20 2020 2020  ow="area",.     
-00028cb0: 2020 2020 2020 2078 3d22 6461 7465 222c         x="date",
-00028cc0: 0a20 2020 2020 2020 2020 2020 2079 3d22  .            y="
-00028cd0: 6672 6571 7565 6e63 7922 2c0a 2020 2020  frequency",.    
-00028ce0: 2020 2020 2020 2020 6572 726f 725f 793d          error_y=
-00028cf0: 2266 7265 7175 656e 6379 5f65 7272 6f72  "frequency_error
-00028d00: 222c 0a20 2020 2020 2020 2020 2020 2065  ",.            e
-00028d10: 7272 6f72 5f79 5f6d 696e 7573 3d22 6672  rror_y_minus="fr
-00028d20: 6571 7565 6e63 795f 6572 726f 725f 6d69  equency_error_mi
-00028d30: 6e75 7322 2c0a 2020 2020 2020 2020 2020  nus",.          
-00028d40: 2020 636f 6c6f 723d 2276 6172 6961 6e74    color="variant
-00028d50: 222c 0a20 2020 2020 2020 2020 2020 206d  ",.            m
-00028d60: 6172 6b65 7273 3d54 7275 652c 0a20 2020  arkers=True,.   
-00028d70: 2020 2020 2020 2020 2068 6f76 6572 5f6e           hover_n
-00028d80: 616d 653d 2276 6172 6961 6e74 222c 0a20  ame="variant",. 
-00028d90: 2020 2020 2020 2020 2020 2068 6f76 6572             hover
-00028da0: 5f64 6174 613d 7b0a 2020 2020 2020 2020  _data={.        
-00028db0: 2020 2020 2020 2020 2266 7265 7175 656e          "frequen
-00028dc0: 6379 223a 2022 3a2e 3025 222c 0a20 2020  cy": ":.0%",.   
-00028dd0: 2020 2020 2020 2020 2020 2020 2022 7065               "pe
-00028de0: 7269 6f64 223a 2054 7275 652c 0a20 2020  riod": True,.   
-00028df0: 2020 2020 2020 2020 2020 2020 2022 6172               "ar
-00028e00: 6561 223a 2054 7275 652c 0a20 2020 2020  ea": True,.     
-00028e10: 2020 2020 2020 2020 2020 2022 7461 786f             "taxo
-00028e20: 6e22 3a20 5472 7565 2c0a 2020 2020 2020  n": True,.      
-00028e30: 2020 2020 2020 2020 2020 2273 616d 706c            "sampl
-00028e40: 655f 7369 7a65 223a 2054 7275 652c 0a20  e_size": True,. 
-00028e50: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00028e60: 6461 7465 223a 2046 616c 7365 2c0a 2020  date": False,.  
-00028e70: 2020 2020 2020 2020 2020 2020 2020 2276                "v
-00028e80: 6172 6961 6e74 223a 2046 616c 7365 2c0a  ariant": False,.
-00028e90: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
-00028ea0: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00028eb0: 743d 6865 6967 6874 2c0a 2020 2020 2020  t=height,.      
-00028ec0: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
-00028ed0: 682c 0a20 2020 2020 2020 2020 2020 2074  h,.            t
-00028ee0: 6974 6c65 3d74 6974 6c65 2c0a 2020 2020  itle=title,.    
-00028ef0: 2020 2020 2020 2020 6c61 6265 6c73 3d7b          labels={
-00028f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028f10: 2022 6461 7465 223a 2022 4461 7465 222c   "date": "Date",
-00028f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028f30: 2022 6672 6571 7565 6e63 7922 3a20 2246   "frequency": "F
-00028f40: 7265 7175 656e 6379 222c 0a20 2020 2020  requency",.     
-00028f50: 2020 2020 2020 2020 2020 2022 7661 7269             "vari
-00028f60: 616e 7422 3a20 2256 6172 6961 6e74 222c  ant": "Variant",
-00028f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028f80: 2022 7461 786f 6e22 3a20 2254 6178 6f6e   "taxon": "Taxon
-00028f90: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00028fa0: 2020 2022 6172 6561 223a 2022 4172 6561     "area": "Area
-00028fb0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00028fc0: 2020 2022 7065 7269 6f64 223a 2022 5065     "period": "Pe
-00028fd0: 7269 6f64 222c 0a20 2020 2020 2020 2020  riod",.         
-00028fe0: 2020 2020 2020 2022 7361 6d70 6c65 5f73         "sample_s
-00028ff0: 697a 6522 3a20 2253 616d 706c 6520 7369  ize": "Sample si
-00029000: 7a65 222c 0a20 2020 2020 2020 2020 2020  ze",.           
-00029010: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00029020: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-00029030: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
-00029040: 7567 2822 7469 6479 2070 6c6f 7422 290a  ug("tidy plot").
-00029050: 2020 2020 2020 2020 6669 672e 7570 6461          fig.upda
-00029060: 7465 5f6c 6179 6f75 7428 7961 7869 735f  te_layout(yaxis_
-00029070: 7261 6e67 653d 5b2d 302e 3035 2c20 312e  range=[-0.05, 1.
-00029080: 3035 5d29 0a0a 2020 2020 2020 2020 7265  05])..        re
-00029090: 7475 726e 2066 6967 0a0a 2020 2020 4064  turn fig..    @d
-000290a0: 6f63 280a 2020 2020 2020 2020 7375 6d6d  oc(.        summ
-000290b0: 6172 793d 2222 220a 2020 2020 2020 2020  ary=""".        
-000290c0: 2020 2020 506c 6f74 206d 6172 6b65 7273      Plot markers
-000290d0: 206f 6e20 6120 6d61 7020 7368 6f77 696e   on a map showin
-000290e0: 6720 7661 7269 616e 7420 6672 6571 7565  g variant freque
-000290f0: 6e63 6965 7320 666f 7220 636f 686f 7274  ncies for cohort
-00029100: 7320 6772 6f75 7065 640a 2020 2020 2020  s grouped.      
-00029110: 2020 2020 2020 6279 2061 7265 6120 2873        by area (s
-00029120: 7061 6365 292c 2070 6572 696f 6420 2874  pace), period (t
-00029130: 696d 6529 2061 6e64 2074 6178 6f6e 2e0a  ime) and taxon..
-00029140: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-00029150: 2020 2020 2070 6172 616d 6574 6572 733d       parameters=
-00029160: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
-00029170: 2020 6d3d 2254 6865 206d 6170 206f 6e20    m="The map on 
-00029180: 7768 6963 6820 746f 2061 6464 2074 6865  which to add the
-00029190: 206d 6172 6b65 7273 2e22 2c0a 2020 2020   markers.",.    
-000291a0: 2020 2020 2020 2020 7661 7269 616e 743d          variant=
-000291b0: 2249 6e64 6578 206f 7220 6c61 6265 6c20  "Index or label 
-000291c0: 6f66 2076 6172 6961 6e74 2074 6f20 706c  of variant to pl
-000291d0: 6f74 2e22 2c0a 2020 2020 2020 2020 2020  ot.",.          
-000291e0: 2020 7461 786f 6e3d 2254 6178 6f6e 2074    taxon="Taxon t
-000291f0: 6f20 7368 6f77 206d 6172 6b65 7273 2066  o show markers f
-00029200: 6f72 2e22 2c0a 2020 2020 2020 2020 2020  or.",.          
-00029210: 2020 7065 7269 6f64 3d22 5469 6d65 2070    period="Time p
-00029220: 6572 696f 6420 746f 2073 686f 7720 6d61  eriod to show ma
-00029230: 726b 6572 7320 666f 722e 222c 0a20 2020  rkers for.",.   
-00029240: 2020 2020 2020 2020 2063 6c65 6172 3d22           clear="
-00029250: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
-00029260: 2020 2049 6620 5472 7565 2c20 636c 6561     If True, clea
-00029270: 7220 616c 6c20 6c61 7965 7273 2028 6578  r all layers (ex
-00029280: 6365 7074 2074 6865 2062 6173 6520 6c61  cept the base la
-00029290: 7965 7229 2066 726f 6d20 7468 6520 6d61  yer) from the ma
-000292a0: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-000292b0: 2020 6265 666f 7265 2061 6464 696e 6720    before adding 
-000292c0: 6e65 7720 6d61 726b 6572 732e 0a20 2020  new markers..   
-000292d0: 2020 2020 2020 2020 2022 2222 2c0a 2020           """,.  
-000292e0: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
-000292f0: 2020 2064 6566 2070 6c6f 745f 6672 6571     def plot_freq
-00029300: 7565 6e63 6965 735f 6d61 705f 6d61 726b  uencies_map_mark
-00029310: 6572 7328 0a20 2020 2020 2020 2073 656c  ers(.        sel
-00029320: 662c 0a20 2020 2020 2020 206d 2c0a 2020  f,.        m,.  
-00029330: 2020 2020 2020 6473 3a20 6672 715f 7061        ds: frq_pa
-00029340: 7261 6d73 2e64 735f 6672 6571 7565 6e63  rams.ds_frequenc
-00029350: 6965 735f 6164 7661 6e63 6564 2c0a 2020  ies_advanced,.  
-00029360: 2020 2020 2020 7661 7269 616e 743a 2055        variant: U
-00029370: 6e69 6f6e 5b69 6e74 2c20 7374 725d 2c0a  nion[int, str],.
-00029380: 2020 2020 2020 2020 7461 786f 6e3a 2073          taxon: s
-00029390: 7472 2c0a 2020 2020 2020 2020 7065 7269  tr,.        peri
-000293a0: 6f64 3a20 7064 2e50 6572 696f 642c 0a20  od: pd.Period,. 
-000293b0: 2020 2020 2020 2063 6c65 6172 3a20 626f         clear: bo
-000293c0: 6f6c 203d 2054 7275 652c 0a20 2020 2029  ol = True,.    )
-000293d0: 3a0a 2020 2020 2020 2020 6465 6275 6720  :.        debug 
-000293e0: 3d20 7365 6c66 2e5f 6c6f 672e 6465 6275  = self._log.debu
-000293f0: 670a 2020 2020 2020 2020 2320 6f6e 6c79  g.        # only
-00029400: 2069 6d70 6f72 7420 6865 7265 2062 6563   import here bec
-00029410: 6175 7365 206f 6620 736f 6d65 2070 726f  ause of some pro
-00029420: 626c 656d 7320 696d 706f 7274 696e 6720  blems importing 
-00029430: 676c 6f62 616c 6c79 0a20 2020 2020 2020  globally.       
-00029440: 2069 6d70 6f72 7420 6970 796c 6561 666c   import ipyleafl
-00029450: 6574 0a20 2020 2020 2020 2069 6d70 6f72  et.        impor
-00029460: 7420 6970 7977 6964 6765 7473 0a0a 2020  t ipywidgets..  
-00029470: 2020 2020 2020 6465 6275 6728 2273 6c69        debug("sli
-00029480: 6365 2064 6174 6173 6574 2074 6f20 7661  ce dataset to va
-00029490: 7269 616e 7420 6f66 2069 6e74 6572 6573  riant of interes
-000294a0: 7422 290a 2020 2020 2020 2020 6966 2069  t").        if i
-000294b0: 7369 6e73 7461 6e63 6528 7661 7269 616e  sinstance(varian
-000294c0: 742c 2069 6e74 293a 0a20 2020 2020 2020  t, int):.       
-000294d0: 2020 2020 2064 735f 7661 7269 616e 7420       ds_variant 
-000294e0: 3d20 6473 2e69 7365 6c28 7661 7269 616e  = ds.isel(varian
-000294f0: 7473 3d76 6172 6961 6e74 290a 2020 2020  ts=variant).    
-00029500: 2020 2020 2020 2020 7661 7269 616e 745f          variant_
-00029510: 6c61 6265 6c20 3d20 6473 5b22 7661 7269  label = ds["vari
-00029520: 616e 745f 6c61 6265 6c22 5d2e 7661 6c75  ant_label"].valu
-00029530: 6573 5b76 6172 6961 6e74 5d0a 2020 2020  es[variant].    
-00029540: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00029550: 6e63 6528 7661 7269 616e 742c 2073 7472  nce(variant, str
-00029560: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-00029570: 735f 7661 7269 616e 7420 3d20 6473 2e73  s_variant = ds.s
-00029580: 6574 5f69 6e64 6578 2876 6172 6961 6e74  et_index(variant
-00029590: 733d 2276 6172 6961 6e74 5f6c 6162 656c  s="variant_label
-000295a0: 2229 2e73 656c 2876 6172 6961 6e74 733d  ").sel(variants=
-000295b0: 7661 7269 616e 7429 0a20 2020 2020 2020  variant).       
-000295c0: 2020 2020 2076 6172 6961 6e74 5f6c 6162       variant_lab
-000295d0: 656c 203d 2076 6172 6961 6e74 0a20 2020  el = variant.   
-000295e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000295f0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00029600: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00029610: 2020 2020 2020 2020 6622 4261 6420 7479          f"Bad ty
-00029620: 7065 2066 6f72 2076 6172 6961 6e74 2070  pe for variant p
-00029630: 6172 616d 6574 6572 3b20 6578 7065 6374  arameter; expect
-00029640: 6564 2069 6e74 206f 7220 7374 722c 2066  ed int or str, f
-00029650: 6f75 6e64 207b 7479 7065 2876 6172 6961  ound {type(varia
-00029660: 6e74 297d 2e22 0a20 2020 2020 2020 2020  nt)}.".         
-00029670: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-00029680: 6275 6728 2263 6f6e 7665 7274 2074 6f20  bug("convert to 
-00029690: 6120 6461 7461 6672 616d 6520 666f 7220  a dataframe for 
-000296a0: 636f 6e76 656e 6965 6e63 6522 290a 2020  convenience").  
-000296b0: 2020 2020 2020 6466 5f6d 6172 6b65 7273        df_markers
-000296c0: 203d 2064 735f 7661 7269 616e 745b 0a20   = ds_variant[. 
-000296d0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-000296e0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-000296f0: 686f 7274 5f74 6178 6f6e 222c 0a20 2020  hort_taxon",.   
-00029700: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-00029710: 686f 7274 5f61 7265 6122 2c0a 2020 2020  hort_area",.    
-00029720: 2020 2020 2020 2020 2020 2020 2263 6f68              "coh
-00029730: 6f72 745f 7065 7269 6f64 222c 0a20 2020  ort_period",.   
-00029740: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-00029750: 686f 7274 5f6c 6174 5f6d 6561 6e22 2c0a  hort_lat_mean",.
-00029760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029770: 2263 6f68 6f72 745f 6c6f 6e5f 6d65 616e  "cohort_lon_mean
-00029780: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00029790: 2020 2022 636f 686f 7274 5f73 697a 6522     "cohort_size"
-000297a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000297b0: 2020 2265 7665 6e74 5f66 7265 7175 656e    "event_frequen
-000297c0: 6379 222c 0a20 2020 2020 2020 2020 2020  cy",.           
-000297d0: 2020 2020 2022 6576 656e 745f 6672 6571       "event_freq
-000297e0: 7565 6e63 795f 6369 5f6c 6f77 222c 0a20  uency_ci_low",. 
-000297f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00029800: 6576 656e 745f 6672 6571 7565 6e63 795f  event_frequency_
-00029810: 6369 5f75 7070 222c 0a20 2020 2020 2020  ci_upp",.       
-00029820: 2020 2020 205d 0a20 2020 2020 2020 205d       ].        ]
-00029830: 2e74 6f5f 6461 7461 6672 616d 6528 290a  .to_dataframe().
-00029840: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00029850: 7365 6c65 6374 2064 6174 6120 6d61 7463  select data matc
-00029860: 6869 6e67 2074 6178 6f6e 2061 6e64 2070  hing taxon and p
-00029870: 6572 696f 6420 7061 7261 6d65 7465 7273  eriod parameters
-00029880: 2229 0a20 2020 2020 2020 2064 665f 6d61  ").        df_ma
-00029890: 726b 6572 7320 3d20 6466 5f6d 6172 6b65  rkers = df_marke
-000298a0: 7273 2e6c 6f63 5b0a 2020 2020 2020 2020  rs.loc[.        
-000298b0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-000298c0: 2020 2020 2020 2864 665f 6d61 726b 6572        (df_marker
-000298d0: 735b 2263 6f68 6f72 745f 7461 786f 6e22  s["cohort_taxon"
-000298e0: 5d20 3d3d 2074 6178 6f6e 290a 2020 2020  ] == taxon).    
-000298f0: 2020 2020 2020 2020 2020 2020 2620 2864              & (d
-00029900: 665f 6d61 726b 6572 735b 2263 6f68 6f72  f_markers["cohor
-00029910: 745f 7065 7269 6f64 225d 203d 3d20 7065  t_period"] == pe
-00029920: 7269 6f64 290a 2020 2020 2020 2020 2020  riod).          
-00029930: 2020 290a 2020 2020 2020 2020 5d0a 0a20    ).        ].. 
-00029940: 2020 2020 2020 2064 6562 7567 2822 636c         debug("cl
-00029950: 6561 7220 6578 6973 7469 6e67 206c 6179  ear existing lay
-00029960: 6572 7320 696e 2074 6865 206d 6170 2229  ers in the map")
-00029970: 0a20 2020 2020 2020 2069 6620 636c 6561  .        if clea
-00029980: 723a 0a20 2020 2020 2020 2020 2020 2066  r:.            f
-00029990: 6f72 206c 6179 6572 2069 6e20 6d2e 6c61  or layer in m.la
-000299a0: 7965 7273 5b31 3a5d 3a0a 2020 2020 2020  yers[1:]:.      
-000299b0: 2020 2020 2020 2020 2020 6d2e 7265 6d6f            m.remo
-000299c0: 7665 5f6c 6179 6572 286c 6179 6572 290a  ve_layer(layer).
-000299d0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-000299e0: 6164 6420 6d61 726b 6572 7322 290a 2020  add markers").  
-000299f0: 2020 2020 2020 666f 7220 7820 696e 2064        for x in d
-00029a00: 665f 6d61 726b 6572 732e 6974 6572 7475  f_markers.itertu
-00029a10: 706c 6573 2829 3a0a 2020 2020 2020 2020  ples():.        
-00029a20: 2020 2020 6d61 726b 6572 203d 2069 7079      marker = ipy
-00029a30: 6c65 6166 6c65 742e 4369 7263 6c65 4d61  leaflet.CircleMa
-00029a40: 726b 6572 2829 0a20 2020 2020 2020 2020  rker().         
-00029a50: 2020 206d 6172 6b65 722e 6c6f 6361 7469     marker.locati
-00029a60: 6f6e 203d 2028 782e 636f 686f 7274 5f6c  on = (x.cohort_l
-00029a70: 6174 5f6d 6561 6e2c 2078 2e63 6f68 6f72  at_mean, x.cohor
-00029a80: 745f 6c6f 6e5f 6d65 616e 290a 2020 2020  t_lon_mean).    
-00029a90: 2020 2020 2020 2020 6d61 726b 6572 2e72          marker.r
-00029aa0: 6164 6975 7320 3d20 3230 0a20 2020 2020  adius = 20.     
-00029ab0: 2020 2020 2020 206d 6172 6b65 722e 636f         marker.co
-00029ac0: 6c6f 7220 3d20 2262 6c61 636b 220a 2020  lor = "black".  
-00029ad0: 2020 2020 2020 2020 2020 6d61 726b 6572            marker
-00029ae0: 2e77 6569 6768 7420 3d20 310a 2020 2020  .weight = 1.    
-00029af0: 2020 2020 2020 2020 6d61 726b 6572 2e66          marker.f
-00029b00: 696c 6c5f 636f 6c6f 7220 3d20 2272 6564  ill_color = "red
-00029b10: 220a 2020 2020 2020 2020 2020 2020 6d61  ".            ma
-00029b20: 726b 6572 2e66 696c 6c5f 6f70 6163 6974  rker.fill_opacit
-00029b30: 7920 3d20 782e 6576 656e 745f 6672 6571  y = x.event_freq
-00029b40: 7565 6e63 790a 2020 2020 2020 2020 2020  uency.          
-00029b50: 2020 706f 7075 705f 6874 6d6c 203d 2066    popup_html = f
-00029b60: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00029b70: 2020 2020 3c73 7472 6f6e 673e 7b76 6172      <strong>{var
-00029b80: 6961 6e74 5f6c 6162 656c 7d3c 2f73 7472  iant_label}</str
-00029b90: 6f6e 673e 203c 6272 2f3e 0a20 2020 2020  ong> <br/>.     
-00029ba0: 2020 2020 2020 2020 2020 2054 6178 6f6e             Taxon
-00029bb0: 3a20 7b78 2e63 6f68 6f72 745f 7461 786f  : {x.cohort_taxo
-00029bc0: 6e7d 203c 6272 2f3e 0a20 2020 2020 2020  n} <br/>.       
-00029bd0: 2020 2020 2020 2020 2041 7265 613a 207b           Area: {
-00029be0: 782e 636f 686f 7274 5f61 7265 617d 203c  x.cohort_area} <
-00029bf0: 6272 2f3e 0a20 2020 2020 2020 2020 2020  br/>.           
-00029c00: 2020 2020 2050 6572 696f 643a 207b 782e       Period: {x.
-00029c10: 636f 686f 7274 5f70 6572 696f 647d 203c  cohort_period} <
-00029c20: 6272 2f3e 0a20 2020 2020 2020 2020 2020  br/>.           
-00029c30: 2020 2020 2053 616d 706c 6520 7369 7a65       Sample size
-00029c40: 3a20 7b78 2e63 6f68 6f72 745f 7369 7a65  : {x.cohort_size
-00029c50: 7d20 3c62 722f 3e0a 2020 2020 2020 2020  } <br/>.        
-00029c60: 2020 2020 2020 2020 4672 6571 7565 6e63          Frequenc
-00029c70: 793a 207b 782e 6576 656e 745f 6672 6571  y: {x.event_freq
-00029c80: 7565 6e63 793a 2e30 257d 0a20 2020 2020  uency:.0%}.     
-00029c90: 2020 2020 2020 2020 2020 2028 3935 2520             (95% 
-00029ca0: 4349 3a20 7b78 2e65 7665 6e74 5f66 7265  CI: {x.event_fre
-00029cb0: 7175 656e 6379 5f63 695f 6c6f 773a 2e30  quency_ci_low:.0
-00029cc0: 257d 202d 207b 782e 6576 656e 745f 6672  %} - {x.event_fr
-00029cd0: 6571 7565 6e63 795f 6369 5f75 7070 3a2e  equency_ci_upp:.
-00029ce0: 3025 7d29 0a20 2020 2020 2020 2020 2020  0%}).           
-00029cf0: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
-00029d00: 206d 6172 6b65 722e 706f 7075 7020 3d20   marker.popup = 
-00029d10: 6970 796c 6561 666c 6574 2e50 6f70 7570  ipyleaflet.Popup
-00029d20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00029d30: 2020 6368 696c 643d 6970 7977 6964 6765    child=ipywidge
-00029d40: 7473 2e48 544d 4c28 706f 7075 705f 6874  ts.HTML(popup_ht
-00029d50: 6d6c 292c 0a20 2020 2020 2020 2020 2020  ml),.           
-00029d60: 2029 0a20 2020 2020 2020 2020 2020 206d   ).            m
-00029d70: 2e61 6464 5f6c 6179 6572 286d 6172 6b65  .add_layer(marke
-00029d80: 7229 0a0a 2020 2020 4064 6f63 280a 2020  r)..    @doc(.  
-00029d90: 2020 2020 2020 7375 6d6d 6172 793d 2222        summary=""
-00029da0: 220a 2020 2020 2020 2020 2020 2020 4372  ".            Cr
-00029db0: 6561 7465 2061 6e20 696e 7465 7261 6374  eate an interact
-00029dc0: 6976 6520 6d61 7020 7769 7468 206d 6172  ive map with mar
-00029dd0: 6b65 7273 2073 686f 7769 6e67 2076 6172  kers showing var
-00029de0: 6961 6e74 2066 7265 7175 656e 6369 6573  iant frequencies
-00029df0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-00029e00: 636f 686f 7274 7320 6772 6f75 7065 6420  cohorts grouped 
-00029e10: 6279 2061 7265 6120 2873 7061 6365 292c  by area (space),
-00029e20: 2070 6572 696f 6420 2874 696d 6529 2061   period (time) a
-00029e30: 6e64 2074 6178 6f6e 2e0a 2020 2020 2020  nd taxon..      
-00029e40: 2020 2222 222c 0a20 2020 2020 2020 2070    """,.        p
-00029e50: 6172 616d 6574 6572 733d 6469 6374 280a  arameters=dict(.
-00029e60: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-00029e70: 653d 2222 220a 2020 2020 2020 2020 2020  e=""".          
-00029e80: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
-00029e90: 7474 656d 7074 2074 6f20 7573 6520 6d65  ttempt to use me
-00029ea0: 7461 6461 7461 2066 726f 6d20 696e 7075  tadata from inpu
-00029eb0: 7420 6461 7461 7365 7420 6173 2061 2070  t dataset as a p
-00029ec0: 6c6f 740a 2020 2020 2020 2020 2020 2020  lot.            
-00029ed0: 2020 2020 7469 746c 652e 204f 7468 6572      title. Other
-00029ee0: 7769 7365 2c20 7573 6520 7375 7070 6c69  wise, use suppli
-00029ef0: 6564 2076 616c 7565 2061 7320 6120 7469  ed value as a ti
-00029f00: 746c 652e 0a20 2020 2020 2020 2020 2020  tle..           
-00029f10: 2022 2222 2c0a 2020 2020 2020 2020 2020   """,.          
-00029f20: 2020 6570 696c 6f67 7565 3d22 4164 6469    epilogue="Addi
-00029f30: 7469 6f6e 616c 2074 6578 7420 746f 2064  tional text to d
-00029f40: 6973 706c 6179 2062 656c 6f77 2074 6865  isplay below the
-00029f50: 206d 6170 2e22 2c0a 2020 2020 2020 2020   map.",.        
-00029f60: 292c 0a20 2020 2020 2020 2072 6574 7572  ),.        retur
-00029f70: 6e73 3d22 2222 0a20 2020 2020 2020 2020  ns=""".         
-00029f80: 2020 2041 6e20 696e 7465 7261 6374 6976     An interactiv
-00029f90: 6520 6d61 7020 7769 7468 2077 6964 6765  e map with widge
-00029fa0: 7473 2066 6f72 2073 656c 6563 7469 6e67  ts for selecting
-00029fb0: 2077 6869 6368 2076 6172 6961 6e74 2c20   which variant, 
-00029fc0: 7461 786f 6e0a 2020 2020 2020 2020 2020  taxon.          
-00029fd0: 2020 616e 6420 7469 6d65 2070 6572 696f    and time perio
-00029fe0: 6420 746f 2064 6973 706c 6179 2e0a 2020  d to display..  
-00029ff0: 2020 2020 2020 2222 222c 0a20 2020 2029        """,.    )
-0002a000: 0a20 2020 2064 6566 2070 6c6f 745f 6672  .    def plot_fr
-0002a010: 6571 7565 6e63 6965 735f 696e 7465 7261  equencies_intera
-0002a020: 6374 6976 655f 6d61 7028 0a20 2020 2020  ctive_map(.     
-0002a030: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0002a040: 2064 733a 2066 7271 5f70 6172 616d 732e   ds: frq_params.
-0002a050: 6473 5f66 7265 7175 656e 6369 6573 5f61  ds_frequencies_a
-0002a060: 6476 616e 6365 642c 0a20 2020 2020 2020  dvanced,.       
-0002a070: 2063 656e 7465 723a 206d 6170 5f70 6172   center: map_par
-0002a080: 616d 732e 6365 6e74 6572 203d 206d 6170  ams.center = map
-0002a090: 5f70 6172 616d 732e 6365 6e74 6572 5f64  _params.center_d
-0002a0a0: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-0002a0b0: 7a6f 6f6d 3a20 6d61 705f 7061 7261 6d73  zoom: map_params
-0002a0c0: 2e7a 6f6f 6d20 3d20 6d61 705f 7061 7261  .zoom = map_para
-0002a0d0: 6d73 2e7a 6f6f 6d5f 6465 6661 756c 742c  ms.zoom_default,
-0002a0e0: 0a20 2020 2020 2020 2074 6974 6c65 3a20  .        title: 
-0002a0f0: 556e 696f 6e5b 626f 6f6c 2c20 7374 725d  Union[bool, str]
-0002a100: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-0002a110: 2065 7069 6c6f 6775 653a 2055 6e69 6f6e   epilogue: Union
-0002a120: 5b62 6f6f 6c2c 2073 7472 5d20 3d20 5472  [bool, str] = Tr
-0002a130: 7565 2c0a 2020 2020 293a 0a20 2020 2020  ue,.    ):.     
-0002a140: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-0002a150: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-0002a160: 2020 2020 696d 706f 7274 2069 7079 6c65      import ipyle
-0002a170: 6166 6c65 740a 2020 2020 2020 2020 696d  aflet.        im
-0002a180: 706f 7274 2069 7079 7769 6467 6574 730a  port ipywidgets.
-0002a190: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-0002a1a0: 6861 6e64 6c65 2074 6974 6c65 2229 0a20  handle title"). 
-0002a1b0: 2020 2020 2020 2069 6620 7469 746c 6520         if title 
-0002a1c0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
-0002a1d0: 2020 2020 2074 6974 6c65 203d 2064 732e       title = ds.
-0002a1e0: 6174 7472 732e 6765 7428 2274 6974 6c65  attrs.get("title
-0002a1f0: 222c 204e 6f6e 6529 0a0a 2020 2020 2020  ", None)..      
-0002a200: 2020 6465 6275 6728 2263 7265 6174 6520    debug("create 
-0002a210: 6120 6d61 7022 290a 2020 2020 2020 2020  a map").        
-0002a220: 6672 6571 5f6d 6170 203d 2069 7079 6c65  freq_map = ipyle
-0002a230: 6166 6c65 742e 4d61 7028 6365 6e74 6572  aflet.Map(center
-0002a240: 3d63 656e 7465 722c 207a 6f6f 6d3d 7a6f  =center, zoom=zo
-0002a250: 6f6d 290a 0a20 2020 2020 2020 2064 6562  om)..        deb
-0002a260: 7567 2822 7365 7420 7570 2069 6e74 6572  ug("set up inter
-0002a270: 6163 7469 7665 2063 6f6e 7472 6f6c 7322  active controls"
-0002a280: 290a 2020 2020 2020 2020 7661 7269 616e  ).        varian
-0002a290: 7473 203d 2064 735b 2276 6172 6961 6e74  ts = ds["variant
-0002a2a0: 5f6c 6162 656c 225d 2e76 616c 7565 730a  _label"].values.
-0002a2b0: 2020 2020 2020 2020 7461 7861 203d 206e          taxa = n
-0002a2c0: 702e 756e 6971 7565 2864 735b 2263 6f68  p.unique(ds["coh
-0002a2d0: 6f72 745f 7461 786f 6e22 5d2e 7661 6c75  ort_taxon"].valu
-0002a2e0: 6573 290a 2020 2020 2020 2020 7065 7269  es).        peri
-0002a2f0: 6f64 7320 3d20 6e70 2e75 6e69 7175 6528  ods = np.unique(
-0002a300: 6473 5b22 636f 686f 7274 5f70 6572 696f  ds["cohort_perio
-0002a310: 6422 5d2e 7661 6c75 6573 290a 2020 2020  d"].values).    
-0002a320: 2020 2020 636f 6e74 726f 6c73 203d 2069      controls = i
-0002a330: 7079 7769 6467 6574 732e 696e 7465 7261  pywidgets.intera
-0002a340: 6374 6976 6528 0a20 2020 2020 2020 2020  ctive(.         
-0002a350: 2020 2073 656c 662e 706c 6f74 5f66 7265     self.plot_fre
-0002a360: 7175 656e 6369 6573 5f6d 6170 5f6d 6172  quencies_map_mar
-0002a370: 6b65 7273 2c0a 2020 2020 2020 2020 2020  kers,.          
-0002a380: 2020 6d3d 6970 7977 6964 6765 7473 2e66    m=ipywidgets.f
-0002a390: 6978 6564 2866 7265 715f 6d61 7029 2c0a  ixed(freq_map),.
-0002a3a0: 2020 2020 2020 2020 2020 2020 6473 3d69              ds=i
-0002a3b0: 7079 7769 6467 6574 732e 6669 7865 6428  pywidgets.fixed(
-0002a3c0: 6473 292c 0a20 2020 2020 2020 2020 2020  ds),.           
-0002a3d0: 2076 6172 6961 6e74 3d69 7079 7769 6467   variant=ipywidg
-0002a3e0: 6574 732e 4472 6f70 646f 776e 286f 7074  ets.Dropdown(opt
-0002a3f0: 696f 6e73 3d76 6172 6961 6e74 732c 2064  ions=variants, d
-0002a400: 6573 6372 6970 7469 6f6e 3d22 5661 7269  escription="Vari
-0002a410: 616e 743a 2022 292c 0a20 2020 2020 2020  ant: "),.       
-0002a420: 2020 2020 2074 6178 6f6e 3d69 7079 7769       taxon=ipywi
-0002a430: 6467 6574 732e 4472 6f70 646f 776e 286f  dgets.Dropdown(o
-0002a440: 7074 696f 6e73 3d74 6178 612c 2064 6573  ptions=taxa, des
-0002a450: 6372 6970 7469 6f6e 3d22 5461 786f 6e3a  cription="Taxon:
-0002a460: 2022 292c 0a20 2020 2020 2020 2020 2020   "),.           
-0002a470: 2070 6572 696f 643d 6970 7977 6964 6765   period=ipywidge
-0002a480: 7473 2e44 726f 7064 6f77 6e28 6f70 7469  ts.Dropdown(opti
-0002a490: 6f6e 733d 7065 7269 6f64 732c 2064 6573  ons=periods, des
-0002a4a0: 6372 6970 7469 6f6e 3d22 5065 7269 6f64  cription="Period
-0002a4b0: 3a20 2229 2c0a 2020 2020 2020 2020 2020  : "),.          
-0002a4c0: 2020 636c 6561 723d 6970 7977 6964 6765    clear=ipywidge
-0002a4d0: 7473 2e66 6978 6564 2854 7275 6529 2c0a  ts.fixed(True),.
-0002a4e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0002a4f0: 2020 2064 6562 7567 2822 6c61 7920 6f75     debug("lay ou
-0002a500: 7420 7769 6467 6574 7322 290a 2020 2020  t widgets").    
-0002a510: 2020 2020 636f 6d70 6f6e 656e 7473 203d      components =
-0002a520: 205b 5d0a 2020 2020 2020 2020 6966 2074   [].        if t
-0002a530: 6974 6c65 2069 7320 6e6f 7420 4e6f 6e65  itle is not None
-0002a540: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0002a550: 6d70 6f6e 656e 7473 2e61 7070 656e 6428  mponents.append(
-0002a560: 6970 7977 6964 6765 7473 2e48 544d 4c28  ipywidgets.HTML(
-0002a570: 7661 6c75 653d 6622 3c68 333e 7b74 6974  value=f"<h3>{tit
-0002a580: 6c65 7d3c 2f68 333e 2229 290a 2020 2020  le}</h3>")).    
-0002a590: 2020 2020 636f 6d70 6f6e 656e 7473 2e61      components.a
-0002a5a0: 7070 656e 6428 636f 6e74 726f 6c73 290a  ppend(controls).
-0002a5b0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0002a5c0: 7473 2e61 7070 656e 6428 6672 6571 5f6d  ts.append(freq_m
-0002a5d0: 6170 290a 2020 2020 2020 2020 6966 2065  ap).        if e
-0002a5e0: 7069 6c6f 6775 6520 6973 2054 7275 653a  pilogue is True:
-0002a5f0: 0a20 2020 2020 2020 2020 2020 2065 7069  .            epi
-0002a600: 6c6f 6775 6520 3d20 2222 220a 2020 2020  logue = """.    
-0002a610: 2020 2020 2020 2020 2020 2020 5661 7269              Vari
-0002a620: 616e 7420 6672 6571 7565 6e63 6965 7320  ant frequencies 
-0002a630: 6172 6520 7368 6f77 6e20 6173 2063 6f6c  are shown as col
-0002a640: 6f75 7265 6420 6d61 726b 6572 732e 204f  oured markers. O
-0002a650: 7061 6369 7479 206f 6620 636f 6c6f 720a  pacity of color.
-0002a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a670: 6465 6e6f 7465 7320 6672 6571 7565 6e63  denotes frequenc
-0002a680: 792e 2043 6c69 636b 206f 6e20 6120 6d61  y. Click on a ma
-0002a690: 726b 6572 2066 6f72 206d 6f72 6520 696e  rker for more in
-0002a6a0: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
-0002a6b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0002a6c0: 2020 2069 6620 6570 696c 6f67 7565 3a0a     if epilogue:.
-0002a6d0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0002a6e0: 6f6e 656e 7473 2e61 7070 656e 6428 6970  onents.append(ip
-0002a6f0: 7977 6964 6765 7473 2e48 544d 4c28 7661  ywidgets.HTML(va
-0002a700: 6c75 653d 6622 7b65 7069 6c6f 6775 657d  lue=f"{epilogue}
-0002a710: 2229 290a 0a20 2020 2020 2020 206f 7574  "))..        out
-0002a720: 203d 2069 7079 7769 6467 6574 732e 5642   = ipywidgets.VB
-0002a730: 6f78 2863 6f6d 706f 6e65 6e74 7329 0a0a  ox(components)..
-0002a740: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0002a750: 7574 0a0a 2020 2020 4064 6f63 280a 2020  ut..    @doc(.  
-0002a760: 2020 2020 2020 7375 6d6d 6172 793d 2222        summary=""
-0002a770: 220a 2020 2020 2020 2020 2020 2020 506c  ".            Pl
-0002a780: 6f74 2073 616d 706c 6520 636f 6f72 6469  ot sample coordi
-0002a790: 6e61 7465 7320 6672 6f6d 2061 2070 7269  nates from a pri
-0002a7a0: 6e63 6970 616c 2063 6f6d 706f 6e65 6e74  ncipal component
-0002a7b0: 7320 616e 616c 7973 6973 2028 5043 4129  s analysis (PCA)
-0002a7c0: 0a20 2020 2020 2020 2020 2020 2061 7320  .            as 
-0002a7d0: 6120 706c 6f74 6c79 2073 6361 7474 6572  a plotly scatter
-0002a7e0: 2070 6c6f 742e 0a20 2020 2020 2020 2022   plot..        "
-0002a7f0: 2222 2c0a 2020 2020 2020 2020 7061 7261  "",.        para
-0002a800: 6d65 7465 7273 3d64 6963 7428 0a20 2020  meters=dict(.   
-0002a810: 2020 2020 2020 2020 206b 7761 7267 733d           kwargs=
-0002a820: 2250 6173 7365 6420 7468 726f 7567 6820  "Passed through 
-0002a830: 746f 2060 7078 2e73 6361 7474 6572 2829  to `px.scatter()
-0002a840: 6022 2c0a 2020 2020 2020 2020 292c 0a20  `",.        ),. 
-0002a850: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
-0002a860: 745f 7063 615f 636f 6f72 6473 280a 2020  t_pca_coords(.  
-0002a870: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0002a880: 2020 2020 6461 7461 3a20 7063 615f 7061      data: pca_pa
-0002a890: 7261 6d73 2e64 665f 7063 612c 0a20 2020  rams.df_pca,.   
-0002a8a0: 2020 2020 2078 3a20 706c 6f74 6c79 5f70       x: plotly_p
-0002a8b0: 6172 616d 732e 7820 3d20 2250 4331 222c  arams.x = "PC1",
-0002a8c0: 0a20 2020 2020 2020 2079 3a20 706c 6f74  .        y: plot
-0002a8d0: 6c79 5f70 6172 616d 732e 7920 3d20 2250  ly_params.y = "P
-0002a8e0: 4332 222c 0a20 2020 2020 2020 2063 6f6c  C2",.        col
-0002a8f0: 6f72 3a20 706c 6f74 6c79 5f70 6172 616d  or: plotly_param
-0002a900: 732e 636f 6c6f 7220 3d20 4e6f 6e65 2c0a  s.color = None,.
-0002a910: 2020 2020 2020 2020 7379 6d62 6f6c 3a20          symbol: 
-0002a920: 706c 6f74 6c79 5f70 6172 616d 732e 7379  plotly_params.sy
-0002a930: 6d62 6f6c 203d 204e 6f6e 652c 0a20 2020  mbol = None,.   
-0002a940: 2020 2020 206a 6974 7465 725f 6672 6163       jitter_frac
-0002a950: 3a20 706c 6f74 6c79 5f70 6172 616d 732e  : plotly_params.
-0002a960: 6a69 7474 6572 5f66 7261 6320 3d20 302e  jitter_frac = 0.
-0002a970: 3032 2c0a 2020 2020 2020 2020 7261 6e64  02,.        rand
-0002a980: 6f6d 5f73 6565 643a 2062 6173 655f 7061  om_seed: base_pa
-0002a990: 7261 6d73 2e72 616e 646f 6d5f 7365 6564  rams.random_seed
-0002a9a0: 203d 2034 322c 0a20 2020 2020 2020 2077   = 42,.        w
-0002a9b0: 6964 7468 3a20 706c 6f74 6c79 5f70 6172  idth: plotly_par
-0002a9c0: 616d 732e 7769 6474 6820 3d20 3930 302c  ams.width = 900,
-0002a9d0: 0a20 2020 2020 2020 2068 6569 6768 743a  .        height:
-0002a9e0: 2070 6c6f 746c 795f 7061 7261 6d73 2e68   plotly_params.h
-0002a9f0: 6569 6768 7420 3d20 3630 302c 0a20 2020  eight = 600,.   
-0002aa00: 2020 2020 206d 6172 6b65 725f 7369 7a65       marker_size
-0002aa10: 3a20 706c 6f74 6c79 5f70 6172 616d 732e  : plotly_params.
-0002aa20: 6d61 726b 6572 5f73 697a 6520 3d20 3130  marker_size = 10
-0002aa30: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-0002aa40: 6773 2c0a 2020 2020 2920 2d3e 2070 6c6f  gs,.    ) -> plo
-0002aa50: 746c 795f 7061 7261 6d73 2e66 6967 7572  tly_params.figur
-0002aa60: 653a 0a20 2020 2020 2020 2064 6562 7567  e:.        debug
-0002aa70: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
-0002aa80: 7567 0a0a 2020 2020 2020 2020 6465 6275  ug..        debu
-0002aa90: 6728 0a20 2020 2020 2020 2020 2020 2022  g(.            "
-0002aaa0: 7365 7420 7570 2064 6174 6120 2d20 636f  set up data - co
-0002aab0: 7079 2061 6e64 2073 6875 6666 6c65 2073  py and shuffle s
-0002aac0: 6f20 7468 6174 2077 6520 646f 6e27 7420  o that we don't 
-0002aad0: 6765 7420 7379 7374 656d 6174 6963 206f  get systematic o
-0002aae0: 7665 722d 706c 6f74 7469 6e67 220a 2020  ver-plotting".  
-0002aaf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0002ab00: 2320 544f 444f 2064 6f65 7320 7468 6520  # TODO does the 
-0002ab10: 7368 7566 666c 696e 6720 6163 7475 616c  shuffling actual
-0002ab20: 6c79 2077 6f72 6b3f 0a20 2020 2020 2020  ly work?.       
-0002ab30: 2064 6174 6120 3d20 280a 2020 2020 2020   data = (.      
-0002ab40: 2020 2020 2020 6461 7461 2e63 6f70 7928        data.copy(
-0002ab50: 292e 7361 6d70 6c65 2866 7261 633d 312c  ).sample(frac=1,
-0002ab60: 2072 616e 646f 6d5f 7374 6174 653d 7261   random_state=ra
-0002ab70: 6e64 6f6d 5f73 6565 6429 2e72 6573 6574  ndom_seed).reset
-0002ab80: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
-0002ab90: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-0002aba0: 2020 2020 2064 6562 7567 280a 2020 2020       debug(.    
-0002abb0: 2020 2020 2020 2020 2261 7070 6c79 206a          "apply j
-0002abc0: 6974 7465 7220 6966 2064 6573 6972 6564  itter if desired
-0002abd0: 202d 2068 656c 7073 2073 7072 6561 6420   - helps spread 
-0002abe0: 6f75 7420 706f 696e 7473 2077 6865 6e20  out points when 
-0002abf0: 7469 6768 746c 7920 636c 7573 7465 7265  tightly clustere
-0002ac00: 6422 0a20 2020 2020 2020 2029 0a20 2020  d".        ).   
-0002ac10: 2020 2020 2069 6620 6a69 7474 6572 5f66       if jitter_f
-0002ac20: 7261 633a 0a20 2020 2020 2020 2020 2020  rac:.           
-0002ac30: 206e 702e 7261 6e64 6f6d 2e73 6565 6428   np.random.seed(
-0002ac40: 7261 6e64 6f6d 5f73 6565 6429 0a20 2020  random_seed).   
-0002ac50: 2020 2020 2020 2020 2064 6174 615b 785d           data[x]
-0002ac60: 203d 206a 6974 7465 7228 6461 7461 5b78   = jitter(data[x
-0002ac70: 5d2c 206a 6974 7465 725f 6672 6163 290a  ], jitter_frac).
-0002ac80: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0002ac90: 5b79 5d20 3d20 6a69 7474 6572 2864 6174  [y] = jitter(dat
-0002aca0: 615b 795d 2c20 6a69 7474 6572 5f66 7261  a[y], jitter_fra
-0002acb0: 6329 0a0a 2020 2020 2020 2020 6465 6275  c)..        debu
-0002acc0: 6728 2263 6f6e 7665 6e69 656e 6365 2076  g("convenience v
-0002acd0: 6172 6961 626c 6573 2229 0a20 2020 2020  ariables").     
-0002ace0: 2020 2064 6174 615b 2263 6f75 6e74 7279     data["country
-0002acf0: 5f6c 6f63 6174 696f 6e22 5d20 3d20 6461  _location"] = da
-0002ad00: 7461 5b22 636f 756e 7472 7922 5d20 2b20  ta["country"] + 
-0002ad10: 2220 2d20 2220 2b20 6461 7461 5b22 6c6f  " - " + data["lo
-0002ad20: 6361 7469 6f6e 225d 0a0a 2020 2020 2020  cation"]..      
-0002ad30: 2020 6465 6275 6728 2273 6574 2075 7020    debug("set up 
-0002ad40: 706c 6f74 7469 6e67 206f 7074 696f 6e73  plotting options
-0002ad50: 2229 0a20 2020 2020 2020 2068 6f76 6572  ").        hover
-0002ad60: 5f64 6174 6120 3d20 5b0a 2020 2020 2020  _data = [.      
-0002ad70: 2020 2020 2020 2270 6172 746e 6572 5f73        "partner_s
-0002ad80: 616d 706c 655f 6964 222c 0a20 2020 2020  ample_id",.     
-0002ad90: 2020 2020 2020 2022 7361 6d70 6c65 5f73         "sample_s
-0002ada0: 6574 222c 0a20 2020 2020 2020 2020 2020  et",.           
-0002adb0: 2022 7461 786f 6e22 2c0a 2020 2020 2020   "taxon",.      
-0002adc0: 2020 2020 2020 2263 6f75 6e74 7279 222c        "country",
-0002add0: 0a20 2020 2020 2020 2020 2020 2022 6164  .            "ad
-0002ade0: 6d69 6e31 5f69 736f 222c 0a20 2020 2020  min1_iso",.     
-0002adf0: 2020 2020 2020 2022 6164 6d69 6e31 5f6e         "admin1_n
-0002ae00: 616d 6522 2c0a 2020 2020 2020 2020 2020  ame",.          
-0002ae10: 2020 2261 646d 696e 325f 6e61 6d65 222c    "admin2_name",
-0002ae20: 0a20 2020 2020 2020 2020 2020 2022 6c6f  .            "lo
-0002ae30: 6361 7469 6f6e 222c 0a20 2020 2020 2020  cation",.       
-0002ae40: 2020 2020 2022 7965 6172 222c 0a20 2020       "year",.   
-0002ae50: 2020 2020 2020 2020 2022 6d6f 6e74 6822           "month"
-0002ae60: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
-0002ae70: 2020 2020 706c 6f74 5f6b 7761 7267 7320      plot_kwargs 
-0002ae80: 3d20 6469 6374 280a 2020 2020 2020 2020  = dict(.        
-0002ae90: 2020 2020 7769 6474 683d 7769 6474 682c      width=width,
-0002aea0: 0a20 2020 2020 2020 2020 2020 2068 6569  .            hei
-0002aeb0: 6768 743d 6865 6967 6874 2c0a 2020 2020  ght=height,.    
-0002aec0: 2020 2020 2020 2020 636f 6c6f 723d 636f          color=co
-0002aed0: 6c6f 722c 0a20 2020 2020 2020 2020 2020  lor,.           
-0002aee0: 2073 796d 626f 6c3d 7379 6d62 6f6c 2c0a   symbol=symbol,.
-0002aef0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0002af00: 6c61 7465 3d22 7369 6d70 6c65 5f77 6869  late="simple_whi
-0002af10: 7465 222c 0a20 2020 2020 2020 2020 2020  te",.           
-0002af20: 2068 6f76 6572 5f6e 616d 653d 2273 616d   hover_name="sam
-0002af30: 706c 655f 6964 222c 0a20 2020 2020 2020  ple_id",.       
-0002af40: 2020 2020 2068 6f76 6572 5f64 6174 613d       hover_data=
-0002af50: 686f 7665 725f 6461 7461 2c0a 2020 2020  hover_data,.    
-0002af60: 2020 2020 2020 2020 6f70 6163 6974 793d          opacity=
-0002af70: 302e 392c 0a20 2020 2020 2020 2020 2020  0.9,.           
-0002af80: 2072 656e 6465 725f 6d6f 6465 3d22 7376   render_mode="sv
-0002af90: 6722 2c0a 2020 2020 2020 2020 290a 0a20  g",.        ).. 
-0002afa0: 2020 2020 2020 2064 6562 7567 2822 7370         debug("sp
-0002afb0: 6563 6961 6c20 6861 6e64 6c69 6e67 2066  ecial handling f
-0002afc0: 6f72 2074 6178 6f6e 2063 6f6c 6f72 2229  or taxon color")
-0002afd0: 0a20 2020 2020 2020 2069 6620 636f 6c6f  .        if colo
-0002afe0: 7220 3d3d 2022 7461 786f 6e22 3a0a 2020  r == "taxon":.  
-0002aff0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0002b000: 7365 7475 705f 7461 786f 6e5f 636f 6c6f  setup_taxon_colo
-0002b010: 7273 2870 6c6f 745f 6b77 6172 6773 290a  rs(plot_kwargs).
-0002b020: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-0002b030: 6170 706c 7920 616e 7920 7573 6572 206f  apply any user o
-0002b040: 7665 7272 6964 6573 2229 0a20 2020 2020  verrides").     
-0002b050: 2020 2070 6c6f 745f 6b77 6172 6773 2e75     plot_kwargs.u
-0002b060: 7064 6174 6528 6b77 6172 6773 290a 0a20  pdate(kwargs).. 
-0002b070: 2020 2020 2020 2064 6562 7567 2822 3244         debug("2D
-0002b080: 2073 6361 7474 6572 2070 6c6f 7422 290a   scatter plot").
-0002b090: 2020 2020 2020 2020 6669 6720 3d20 7078          fig = px
-0002b0a0: 2e73 6361 7474 6572 2864 6174 612c 2078  .scatter(data, x
-0002b0b0: 3d78 2c20 793d 792c 202a 2a70 6c6f 745f  =x, y=y, **plot_
-0002b0c0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
-0002b0d0: 2064 6562 7567 2822 7469 6479 2075 7022   debug("tidy up"
-0002b0e0: 290a 2020 2020 2020 2020 6669 672e 7570  ).        fig.up
-0002b0f0: 6461 7465 5f6c 6179 6f75 7428 0a20 2020  date_layout(.   
-0002b100: 2020 2020 2020 2020 206c 6567 656e 643d           legend=
-0002b110: 6469 6374 2869 7465 6d73 697a 696e 673d  dict(itemsizing=
-0002b120: 2263 6f6e 7374 616e 7422 292c 0a20 2020  "constant"),.   
-0002b130: 2020 2020 2029 0a20 2020 2020 2020 2066       ).        f
-0002b140: 6967 2e75 7064 6174 655f 7472 6163 6573  ig.update_traces
-0002b150: 286d 6172 6b65 723d 7b22 7369 7a65 223a  (marker={"size":
-0002b160: 206d 6172 6b65 725f 7369 7a65 7d29 0a0a   marker_size})..
-0002b170: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0002b180: 6967 0a0a 2020 2020 4064 6f63 280a 2020  ig..    @doc(.  
-0002b190: 2020 2020 2020 7375 6d6d 6172 793d 2222        summary=""
-0002b1a0: 220a 2020 2020 2020 2020 2020 2020 506c  ".            Pl
-0002b1b0: 6f74 2073 616d 706c 6520 636f 6f72 6469  ot sample coordi
-0002b1c0: 6e61 7465 7320 6672 6f6d 2061 2070 7269  nates from a pri
-0002b1d0: 6e63 6970 616c 2063 6f6d 706f 6e65 6e74  ncipal component
-0002b1e0: 7320 616e 616c 7973 6973 2028 5043 4129  s analysis (PCA)
-0002b1f0: 0a20 2020 2020 2020 2020 2020 2061 7320  .            as 
-0002b200: 6120 706c 6f74 6c79 2033 4420 7363 6174  a plotly 3D scat
-0002b210: 7465 7220 706c 6f74 2e0a 2020 2020 2020  ter plot..      
-0002b220: 2020 2222 222c 0a20 2020 2020 2020 2070    """,.        p
-0002b230: 6172 616d 6574 6572 733d 6469 6374 280a  arameters=dict(.
-0002b240: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-0002b250: 6773 3d22 5061 7373 6564 2074 6872 6f75  gs="Passed throu
-0002b260: 6768 2074 6f20 6070 782e 7363 6174 7465  gh to `px.scatte
-0002b270: 725f 3364 2829 6022 2c0a 2020 2020 2020  r_3d()`",.      
-0002b280: 2020 292c 0a20 2020 2029 0a20 2020 2064    ),.    ).    d
-0002b290: 6566 2070 6c6f 745f 7063 615f 636f 6f72  ef plot_pca_coor
-0002b2a0: 6473 5f33 6428 0a20 2020 2020 2020 2073  ds_3d(.        s
-0002b2b0: 656c 662c 0a20 2020 2020 2020 2064 6174  elf,.        dat
-0002b2c0: 613a 2070 6361 5f70 6172 616d 732e 6466  a: pca_params.df
-0002b2d0: 5f70 6361 2c0a 2020 2020 2020 2020 783a  _pca,.        x:
-0002b2e0: 2070 6c6f 746c 795f 7061 7261 6d73 2e78   plotly_params.x
-0002b2f0: 203d 2022 5043 3122 2c0a 2020 2020 2020   = "PC1",.      
-0002b300: 2020 793a 2070 6c6f 746c 795f 7061 7261    y: plotly_para
-0002b310: 6d73 2e79 203d 2022 5043 3222 2c0a 2020  ms.y = "PC2",.  
-0002b320: 2020 2020 2020 7a3a 2070 6c6f 746c 795f        z: plotly_
-0002b330: 7061 7261 6d73 2e7a 203d 2022 5043 3322  params.z = "PC3"
-0002b340: 2c0a 2020 2020 2020 2020 636f 6c6f 723a  ,.        color:
-0002b350: 2070 6c6f 746c 795f 7061 7261 6d73 2e63   plotly_params.c
-0002b360: 6f6c 6f72 203d 204e 6f6e 652c 0a20 2020  olor = None,.   
-0002b370: 2020 2020 2073 796d 626f 6c3a 2070 6c6f       symbol: plo
-0002b380: 746c 795f 7061 7261 6d73 2e73 796d 626f  tly_params.symbo
-0002b390: 6c20 3d20 4e6f 6e65 2c0a 2020 2020 2020  l = None,.      
-0002b3a0: 2020 6a69 7474 6572 5f66 7261 633a 2070    jitter_frac: p
-0002b3b0: 6c6f 746c 795f 7061 7261 6d73 2e6a 6974  lotly_params.jit
-0002b3c0: 7465 725f 6672 6163 203d 2030 2e30 322c  ter_frac = 0.02,
-0002b3d0: 0a20 2020 2020 2020 2072 616e 646f 6d5f  .        random_
-0002b3e0: 7365 6564 3a20 6261 7365 5f70 6172 616d  seed: base_param
-0002b3f0: 732e 7261 6e64 6f6d 5f73 6565 6420 3d20  s.random_seed = 
-0002b400: 3432 2c0a 2020 2020 2020 2020 7769 6474  42,.        widt
-0002b410: 683a 2070 6c6f 746c 795f 7061 7261 6d73  h: plotly_params
-0002b420: 2e77 6964 7468 203d 2039 3030 2c0a 2020  .width = 900,.  
-0002b430: 2020 2020 2020 6865 6967 6874 3a20 706c        height: pl
-0002b440: 6f74 6c79 5f70 6172 616d 732e 6865 6967  otly_params.heig
-0002b450: 6874 203d 2036 3030 2c0a 2020 2020 2020  ht = 600,.      
-0002b460: 2020 6d61 726b 6572 5f73 697a 653a 2070    marker_size: p
-0002b470: 6c6f 746c 795f 7061 7261 6d73 2e6d 6172  lotly_params.mar
-0002b480: 6b65 725f 7369 7a65 203d 2035 2c0a 2020  ker_size = 5,.  
-0002b490: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-0002b4a0: 2020 2020 2920 2d3e 2070 6c6f 746c 795f      ) -> plotly_
-0002b4b0: 7061 7261 6d73 2e66 6967 7572 653a 0a20  params.figure:. 
-0002b4c0: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
-0002b4d0: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
-0002b4e0: 2020 2020 2020 2020 6465 6275 6728 0a20          debug(. 
-0002b4f0: 2020 2020 2020 2020 2020 2022 7365 7420             "set 
-0002b500: 7570 2064 6174 6120 2d20 636f 7079 2061  up data - copy a
-0002b510: 6e64 2073 6875 6666 6c65 2073 6f20 7468  nd shuffle so th
-0002b520: 6174 2077 6520 646f 6e27 7420 6765 7420  at we don't get 
-0002b530: 7379 7374 656d 6174 6963 206f 7665 722d  systematic over-
-0002b540: 706c 6f74 7469 6e67 220a 2020 2020 2020  plotting".      
-0002b550: 2020 290a 2020 2020 2020 2020 2320 544f    ).        # TO
-0002b560: 444f 2064 6f65 7320 7468 6973 2061 6374  DO does this act
-0002b570: 7561 6c6c 7920 776f 726b 3f0a 2020 2020  ually work?.    
-0002b580: 2020 2020 6461 7461 203d 2028 0a20 2020      data = (.   
-0002b590: 2020 2020 2020 2020 2064 6174 612e 636f           data.co
-0002b5a0: 7079 2829 2e73 616d 706c 6528 6672 6163  py().sample(frac
-0002b5b0: 3d31 2c20 7261 6e64 6f6d 5f73 7461 7465  =1, random_state
-0002b5c0: 3d72 616e 646f 6d5f 7365 6564 292e 7265  =random_seed).re
-0002b5d0: 7365 745f 696e 6465 7828 6472 6f70 3d54  set_index(drop=T
-0002b5e0: 7275 6529 0a20 2020 2020 2020 2029 0a0a  rue).        )..
-0002b5f0: 2020 2020 2020 2020 6465 6275 6728 0a20          debug(. 
-0002b600: 2020 2020 2020 2020 2020 2022 6170 706c             "appl
-0002b610: 7920 6a69 7474 6572 2069 6620 6465 7369  y jitter if desi
-0002b620: 7265 6420 2d20 6865 6c70 7320 7370 7265  red - helps spre
-0002b630: 6164 206f 7574 2070 6f69 6e74 7320 7768  ad out points wh
-0002b640: 656e 2074 6967 6874 6c79 2063 6c75 7374  en tightly clust
-0002b650: 6572 6564 220a 2020 2020 2020 2020 290a  ered".        ).
-0002b660: 2020 2020 2020 2020 6966 206a 6974 7465          if jitte
-0002b670: 725f 6672 6163 3a0a 2020 2020 2020 2020  r_frac:.        
-0002b680: 2020 2020 6e70 2e72 616e 646f 6d2e 7365      np.random.se
-0002b690: 6564 2872 616e 646f 6d5f 7365 6564 290a  ed(random_seed).
-0002b6a0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0002b6b0: 5b78 5d20 3d20 6a69 7474 6572 2864 6174  [x] = jitter(dat
-0002b6c0: 615b 785d 2c20 6a69 7474 6572 5f66 7261  a[x], jitter_fra
-0002b6d0: 6329 0a20 2020 2020 2020 2020 2020 2064  c).            d
-0002b6e0: 6174 615b 795d 203d 206a 6974 7465 7228  ata[y] = jitter(
-0002b6f0: 6461 7461 5b79 5d2c 206a 6974 7465 725f  data[y], jitter_
-0002b700: 6672 6163 290a 2020 2020 2020 2020 2020  frac).          
-0002b710: 2020 6461 7461 5b7a 5d20 3d20 6a69 7474    data[z] = jitt
-0002b720: 6572 2864 6174 615b 7a5d 2c20 6a69 7474  er(data[z], jitt
-0002b730: 6572 5f66 7261 6329 0a0a 2020 2020 2020  er_frac)..      
-0002b740: 2020 6465 6275 6728 2263 6f6e 7665 6e69    debug("conveni
-0002b750: 656e 6365 2076 6172 6961 626c 6573 2229  ence variables")
-0002b760: 0a20 2020 2020 2020 2064 6174 615b 2263  .        data["c
-0002b770: 6f75 6e74 7279 5f6c 6f63 6174 696f 6e22  ountry_location"
-0002b780: 5d20 3d20 6461 7461 5b22 636f 756e 7472  ] = data["countr
-0002b790: 7922 5d20 2b20 2220 2d20 2220 2b20 6461  y"] + " - " + da
-0002b7a0: 7461 5b22 6c6f 6361 7469 6f6e 225d 0a0a  ta["location"]..
-0002b7b0: 2020 2020 2020 2020 6465 6275 6728 2273          debug("s
-0002b7c0: 6574 2075 7020 706c 6f74 7469 6e67 206f  et up plotting o
-0002b7d0: 7074 696f 6e73 2229 0a20 2020 2020 2020  ptions").       
-0002b7e0: 2068 6f76 6572 5f64 6174 6120 3d20 5b0a   hover_data = [.
-0002b7f0: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-0002b800: 746e 6572 5f73 616d 706c 655f 6964 222c  tner_sample_id",
-0002b810: 0a20 2020 2020 2020 2020 2020 2022 7361  .            "sa
-0002b820: 6d70 6c65 5f73 6574 222c 0a20 2020 2020  mple_set",.     
-0002b830: 2020 2020 2020 2022 7461 786f 6e22 2c0a         "taxon",.
-0002b840: 2020 2020 2020 2020 2020 2020 2263 6f75              "cou
-0002b850: 6e74 7279 222c 0a20 2020 2020 2020 2020  ntry",.         
-0002b860: 2020 2022 6164 6d69 6e31 5f69 736f 222c     "admin1_iso",
-0002b870: 0a20 2020 2020 2020 2020 2020 2022 6164  .            "ad
-0002b880: 6d69 6e31 5f6e 616d 6522 2c0a 2020 2020  min1_name",.    
-0002b890: 2020 2020 2020 2020 2261 646d 696e 325f          "admin2_
-0002b8a0: 6e61 6d65 222c 0a20 2020 2020 2020 2020  name",.         
-0002b8b0: 2020 2022 6c6f 6361 7469 6f6e 222c 0a20     "location",. 
-0002b8c0: 2020 2020 2020 2020 2020 2022 7965 6172             "year
-0002b8d0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-0002b8e0: 6d6f 6e74 6822 2c0a 2020 2020 2020 2020  month",.        
-0002b8f0: 5d0a 2020 2020 2020 2020 706c 6f74 5f6b  ].        plot_k
-0002b900: 7761 7267 7320 3d20 6469 6374 280a 2020  wargs = dict(.  
-0002b910: 2020 2020 2020 2020 2020 7769 6474 683d            width=
-0002b920: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0002b930: 2020 2068 6569 6768 743d 6865 6967 6874     height=height
-0002b940: 2c0a 2020 2020 2020 2020 2020 2020 686f  ,.            ho
-0002b950: 7665 725f 6e61 6d65 3d22 7361 6d70 6c65  ver_name="sample
-0002b960: 5f69 6422 2c0a 2020 2020 2020 2020 2020  _id",.          
-0002b970: 2020 686f 7665 725f 6461 7461 3d68 6f76    hover_data=hov
-0002b980: 6572 5f64 6174 612c 0a20 2020 2020 2020  er_data,.       
-0002b990: 2020 2020 2063 6f6c 6f72 3d63 6f6c 6f72       color=color
-0002b9a0: 2c0a 2020 2020 2020 2020 2020 2020 7379  ,.            sy
-0002b9b0: 6d62 6f6c 3d73 796d 626f 6c2c 0a20 2020  mbol=symbol,.   
-0002b9c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0002b9d0: 6465 6275 6728 2273 7065 6369 616c 2068  debug("special h
-0002b9e0: 616e 646c 696e 6720 666f 7220 7461 786f  andling for taxo
-0002b9f0: 6e20 636f 6c6f 7222 290a 2020 2020 2020  n color").      
-0002ba00: 2020 6966 2063 6f6c 6f72 203d 3d20 2274    if color == "t
-0002ba10: 6178 6f6e 223a 0a20 2020 2020 2020 2020  axon":.         
-0002ba20: 2020 2073 656c 662e 5f73 6574 7570 5f74     self._setup_t
-0002ba30: 6178 6f6e 5f63 6f6c 6f72 7328 706c 6f74  axon_colors(plot
-0002ba40: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
-0002ba50: 2020 6465 6275 6728 2261 7070 6c79 2061    debug("apply a
-0002ba60: 6e79 2075 7365 7220 6f76 6572 7269 6465  ny user override
-0002ba70: 7322 290a 2020 2020 2020 2020 706c 6f74  s").        plot
-0002ba80: 5f6b 7761 7267 732e 7570 6461 7465 286b  _kwargs.update(k
-0002ba90: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
-0002baa0: 6465 6275 6728 2233 4420 7363 6174 7465  debug("3D scatte
-0002bab0: 7220 706c 6f74 2229 0a20 2020 2020 2020  r plot").       
-0002bac0: 2066 6967 203d 2070 782e 7363 6174 7465   fig = px.scatte
-0002bad0: 725f 3364 2864 6174 612c 2078 3d78 2c20  r_3d(data, x=x, 
-0002bae0: 793d 792c 207a 3d7a 2c20 2a2a 706c 6f74  y=y, z=z, **plot
-0002baf0: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
-0002bb00: 2020 6465 6275 6728 2274 6964 7920 7570    debug("tidy up
-0002bb10: 2229 0a20 2020 2020 2020 2066 6967 2e75  ").        fig.u
-0002bb20: 7064 6174 655f 6c61 796f 7574 280a 2020  pdate_layout(.  
-0002bb30: 2020 2020 2020 2020 2020 7363 656e 653d            scene=
-0002bb40: 6469 6374 2861 7370 6563 746d 6f64 653d  dict(aspectmode=
-0002bb50: 2263 7562 6522 292c 0a20 2020 2020 2020  "cube"),.       
-0002bb60: 2020 2020 206c 6567 656e 643d 6469 6374       legend=dict
-0002bb70: 2869 7465 6d73 697a 696e 673d 2263 6f6e  (itemsizing="con
-0002bb80: 7374 616e 7422 292c 0a20 2020 2020 2020  stant"),.       
-0002bb90: 2029 0a20 2020 2020 2020 2066 6967 2e75   ).        fig.u
-0002bba0: 7064 6174 655f 7472 6163 6573 286d 6172  pdate_traces(mar
-0002bbb0: 6b65 723d 7b22 7369 7a65 223a 206d 6172  ker={"size": mar
-0002bbc0: 6b65 725f 7369 7a65 7d29 0a0a 2020 2020  ker_size})..    
-0002bbd0: 2020 2020 7265 7475 726e 2066 6967 0a0a      return fig..
-0002bbe0: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
-0002bbf0: 2020 7375 6d6d 6172 793d 2250 6c6f 7420    summary="Plot 
-0002bc00: 6469 7665 7273 6974 7920 7375 6d6d 6172  diversity summar
-0002bc10: 7920 7374 6174 6973 7469 6373 2066 6f72  y statistics for
-0002bc20: 206d 756c 7469 706c 6520 636f 686f 7274   multiple cohort
-0002bc30: 732e 222c 0a20 2020 2020 2020 2070 6172  s.",.        par
-0002bc40: 616d 6574 6572 733d 6469 6374 280a 2020  ameters=dict(.  
-0002bc50: 2020 2020 2020 2020 2020 6466 5f73 7461            df_sta
-0002bc60: 7473 3d22 4f75 7470 7574 2066 726f 6d20  ts="Output from 
-0002bc70: 6064 6976 6572 7369 7479 5f73 7461 7473  `diversity_stats
-0002bc80: 2829 602e 222c 0a20 2020 2020 2020 2020  ()`.",.         
-0002bc90: 2020 2062 6172 5f70 6c6f 745f 6865 6967     bar_plot_heig
-0002bca0: 6874 3d22 4865 6967 6874 206f 6620 6261  ht="Height of ba
-0002bcb0: 7220 706c 6f74 7320 696e 2070 6978 656c  r plots in pixel
-0002bcc0: 7320 2870 7829 2e22 2c0a 2020 2020 2020  s (px).",.      
-0002bcd0: 2020 2020 2020 6261 725f 7769 6474 683d        bar_width=
-0002bce0: 2257 6964 7468 2070 6572 2062 6172 2069  "Width per bar i
-0002bcf0: 6e20 7069 7865 6c73 2028 7078 292e 222c  n pixels (px).",
-0002bd00: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
-0002bd10: 7474 6572 5f70 6c6f 745f 6865 6967 6874  tter_plot_height
-0002bd20: 3d22 4865 6967 6874 206f 6620 7363 6174  ="Height of scat
-0002bd30: 7465 7220 706c 6f74 2069 6e20 7069 7865  ter plot in pixe
-0002bd40: 6c73 2028 7078 292e 222c 0a20 2020 2020  ls (px).",.     
-0002bd50: 2020 2020 2020 2073 6361 7474 6572 5f70         scatter_p
-0002bd60: 6c6f 745f 7769 6474 683d 2257 6964 7468  lot_width="Width
-0002bd70: 206f 6620 7363 6174 7465 7220 706c 6f74   of scatter plot
-0002bd80: 2069 6e20 7069 7865 6c73 2028 7078 292e   in pixels (px).
-0002bd90: 222c 0a20 2020 2020 2020 2020 2020 2070  ",.            p
-0002bda0: 6c6f 745f 6b77 6172 6773 3d22 4578 7472  lot_kwargs="Extr
-0002bdb0: 6120 706c 6f74 7469 6e67 2070 6172 616d  a plotting param
-0002bdc0: 6574 6572 732e 222c 0a20 2020 2020 2020  eters.",.       
-0002bdd0: 2029 2c0a 2020 2020 290a 2020 2020 6465   ),.    ).    de
-0002bde0: 6620 706c 6f74 5f64 6976 6572 7369 7479  f plot_diversity
-0002bdf0: 5f73 7461 7473 280a 2020 2020 2020 2020  _stats(.        
-0002be00: 7365 6c66 2c0a 2020 2020 2020 2020 6466  self,.        df
-0002be10: 5f73 7461 7473 3a20 7064 2e44 6174 6146  _stats: pd.DataF
-0002be20: 7261 6d65 2c0a 2020 2020 2020 2020 636f  rame,.        co
-0002be30: 6c6f 723a 2070 6c6f 746c 795f 7061 7261  lor: plotly_para
-0002be40: 6d73 2e63 6f6c 6f72 203d 204e 6f6e 652c  ms.color = None,
-0002be50: 0a20 2020 2020 2020 2062 6172 5f70 6c6f  .        bar_plo
-0002be60: 745f 6865 6967 6874 3a20 696e 7420 3d20  t_height: int = 
-0002be70: 3435 302c 0a20 2020 2020 2020 2062 6172  450,.        bar
-0002be80: 5f77 6964 7468 3a20 696e 7420 3d20 3330  _width: int = 30
-0002be90: 2c0a 2020 2020 2020 2020 7363 6174 7465  ,.        scatte
-0002bea0: 725f 706c 6f74 5f68 6569 6768 743a 2069  r_plot_height: i
-0002beb0: 6e74 203d 2035 3030 2c0a 2020 2020 2020  nt = 500,.      
-0002bec0: 2020 7363 6174 7465 725f 706c 6f74 5f77    scatter_plot_w
-0002bed0: 6964 7468 3a20 696e 7420 3d20 3530 302c  idth: int = 500,
-0002bee0: 0a20 2020 2020 2020 2074 656d 706c 6174  .        templat
-0002bef0: 653a 2070 6c6f 746c 795f 7061 7261 6d73  e: plotly_params
-0002bf00: 2e74 656d 706c 6174 6520 3d20 2270 6c6f  .template = "plo
-0002bf10: 746c 795f 7768 6974 6522 2c0a 2020 2020  tly_white",.    
-0002bf20: 2020 2020 706c 6f74 5f6b 7761 7267 733a      plot_kwargs:
-0002bf30: 204f 7074 696f 6e61 6c5b 4d61 7070 696e   Optional[Mappin
-0002bf40: 675d 203d 204e 6f6e 652c 0a20 2020 2029  g] = None,.    )
-0002bf50: 3a0a 2020 2020 2020 2020 6465 6275 6720  :.        debug 
-0002bf60: 3d20 7365 6c66 2e5f 6c6f 672e 6465 6275  = self._log.debu
-0002bf70: 670a 0a20 2020 2020 2020 2064 6562 7567  g..        debug
-0002bf80: 2822 7365 7420 7570 2063 6f6d 6d6f 6e20  ("set up common 
-0002bf90: 706c 6f74 7469 6e67 2070 6172 616d 6574  plotting paramet
-0002bfa0: 6572 7322 290a 2020 2020 2020 2020 6966  ers").        if
-0002bfb0: 2070 6c6f 745f 6b77 6172 6773 2069 7320   plot_kwargs is 
-0002bfc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002bfd0: 2020 706c 6f74 5f6b 7761 7267 7320 3d20    plot_kwargs = 
-0002bfe0: 6469 6374 2829 0a20 2020 2020 2020 2064  dict().        d
-0002bff0: 6566 6175 6c74 5f70 6c6f 745f 6b77 6172  efault_plot_kwar
-0002c000: 6773 203d 2064 6963 7428 0a20 2020 2020  gs = dict(.     
-0002c010: 2020 2020 2020 2068 6f76 6572 5f6e 616d         hover_nam
-0002c020: 653d 2263 6f68 6f72 7422 2c0a 2020 2020  e="cohort",.    
-0002c030: 2020 2020 2020 2020 686f 7665 725f 6461          hover_da
-0002c040: 7461 3d5b 0a20 2020 2020 2020 2020 2020  ta=[.           
-0002c050: 2020 2020 2022 7461 786f 6e22 2c0a 2020       "taxon",.  
-0002c060: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-0002c070: 6f75 6e74 7279 222c 0a20 2020 2020 2020  ountry",.       
-0002c080: 2020 2020 2020 2020 2022 6164 6d69 6e31           "admin1
-0002c090: 5f69 736f 222c 0a20 2020 2020 2020 2020  _iso",.         
-0002c0a0: 2020 2020 2020 2022 6164 6d69 6e31 5f6e         "admin1_n
-0002c0b0: 616d 6522 2c0a 2020 2020 2020 2020 2020  ame",.          
-0002c0c0: 2020 2020 2020 2261 646d 696e 325f 6e61        "admin2_na
-0002c0d0: 6d65 222c 0a20 2020 2020 2020 2020 2020  me",.           
-0002c0e0: 2020 2020 2022 6c6f 6e67 6974 7564 6522       "longitude"
-0002c0f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c100: 2020 226c 6174 6974 7564 6522 2c0a 2020    "latitude",.  
-0002c110: 2020 2020 2020 2020 2020 2020 2020 2279                "y
-0002c120: 6561 7222 2c0a 2020 2020 2020 2020 2020  ear",.          
-0002c130: 2020 2020 2020 226d 6f6e 7468 222c 0a20        "month",. 
-0002c140: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
-0002c150: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
-0002c160: 3d7b 0a20 2020 2020 2020 2020 2020 2020  ={.             
-0002c170: 2020 2022 7468 6574 615f 7069 5f65 7374     "theta_pi_est
-0002c180: 696d 6174 6522 3a20 7222 245c 7769 6465  imate": r"$\wide
-0002c190: 6861 747b 5c74 6865 7461 7d5f 7b5c 7069  hat{\theta}_{\pi
-0002c1a0: 7d24 222c 0a20 2020 2020 2020 2020 2020  }$",.           
-0002c1b0: 2020 2020 2022 7468 6574 615f 775f 6573       "theta_w_es
-0002c1c0: 7469 6d61 7465 223a 2072 2224 5c77 6964  timate": r"$\wid
-0002c1d0: 6568 6174 7b5c 7468 6574 617d 5f7b 777d  ehat{\theta}_{w}
-0002c1e0: 2422 2c0a 2020 2020 2020 2020 2020 2020  $",.            
-0002c1f0: 2020 2020 2274 616a 696d 615f 645f 6573      "tajima_d_es
-0002c200: 7469 6d61 7465 223a 2072 2224 4424 222c  timate": r"$D$",
-0002c210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c220: 2022 636f 686f 7274 223a 2022 436f 686f   "cohort": "Coho
-0002c230: 7274 222c 0a20 2020 2020 2020 2020 2020  rt",.           
-0002c240: 2020 2020 2022 7461 786f 6e22 3a20 2254       "taxon": "T
-0002c250: 6178 6f6e 222c 0a20 2020 2020 2020 2020  axon",.         
-0002c260: 2020 2020 2020 2022 636f 756e 7472 7922         "country"
-0002c270: 3a20 2243 6f75 6e74 7279 222c 0a20 2020  : "Country",.   
-0002c280: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
-0002c290: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-0002c2a0: 2063 6f6c 6f72 203d 3d20 2274 6178 6f6e   color == "taxon
-0002c2b0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-0002c2c0: 656c 662e 5f73 6574 7570 5f74 6178 6f6e  elf._setup_taxon
-0002c2d0: 5f63 6f6c 6f72 7328 706c 6f74 5f6b 7761  _colors(plot_kwa
-0002c2e0: 7267 733d 6465 6661 756c 745f 706c 6f74  rgs=default_plot
-0002c2f0: 5f6b 7761 7267 7329 0a20 2020 2020 2020  _kwargs).       
-0002c300: 2064 6566 6175 6c74 5f70 6c6f 745f 6b77   default_plot_kw
-0002c310: 6172 6773 2e75 7064 6174 6528 706c 6f74  args.update(plot
-0002c320: 5f6b 7761 7267 7329 0a20 2020 2020 2020  _kwargs).       
-0002c330: 2070 6c6f 745f 6b77 6172 6773 203d 2064   plot_kwargs = d
-0002c340: 6566 6175 6c74 5f70 6c6f 745f 6b77 6172  efault_plot_kwar
-0002c350: 6773 0a20 2020 2020 2020 2062 6172 5f70  gs.        bar_p
-0002c360: 6c6f 745f 7769 6474 6820 3d20 3330 3020  lot_width = 300 
-0002c370: 2b20 6261 725f 7769 6474 6820 2a20 6c65  + bar_width * le
-0002c380: 6e28 6466 5f73 7461 7473 290a 0a20 2020  n(df_stats)..   
-0002c390: 2020 2020 2064 6562 7567 2822 6e75 636c       debug("nucl
-0002c3a0: 656f 7469 6465 2064 6976 6572 7369 7479  eotide diversity
-0002c3b0: 2062 6172 2070 6c6f 7422 290a 2020 2020   bar plot").    
-0002c3c0: 2020 2020 6669 6720 3d20 7078 2e62 6172      fig = px.bar
-0002c3d0: 280a 2020 2020 2020 2020 2020 2020 6461  (.            da
-0002c3e0: 7461 5f66 7261 6d65 3d64 665f 7374 6174  ta_frame=df_stat
-0002c3f0: 732c 0a20 2020 2020 2020 2020 2020 2078  s,.            x
-0002c400: 3d22 636f 686f 7274 222c 0a20 2020 2020  ="cohort",.     
-0002c410: 2020 2020 2020 2079 3d22 7468 6574 615f         y="theta_
-0002c420: 7069 5f65 7374 696d 6174 6522 2c0a 2020  pi_estimate",.  
-0002c430: 2020 2020 2020 2020 2020 6572 726f 725f            error_
-0002c440: 793d 2274 6865 7461 5f70 695f 6369 5f65  y="theta_pi_ci_e
-0002c450: 7272 222c 0a20 2020 2020 2020 2020 2020  rr",.           
-0002c460: 2074 6974 6c65 3d22 4e75 636c 656f 7469   title="Nucleoti
-0002c470: 6465 2064 6976 6572 7369 7479 222c 0a20  de diversity",. 
-0002c480: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
-0002c490: 3d63 6f6c 6f72 2c0a 2020 2020 2020 2020  =color,.        
-0002c4a0: 2020 2020 6865 6967 6874 3d62 6172 5f70      height=bar_p
-0002c4b0: 6c6f 745f 6865 6967 6874 2c0a 2020 2020  lot_height,.    
-0002c4c0: 2020 2020 2020 2020 7769 6474 683d 6261          width=ba
-0002c4d0: 725f 706c 6f74 5f77 6964 7468 2c0a 2020  r_plot_width,.  
-0002c4e0: 2020 2020 2020 2020 2020 7465 6d70 6c61            templa
-0002c4f0: 7465 3d74 656d 706c 6174 652c 0a20 2020  te=template,.   
-0002c500: 2020 2020 2020 2020 202a 2a70 6c6f 745f           **plot_
-0002c510: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-0002c520: 290a 2020 2020 2020 2020 6669 672e 7368  ).        fig.sh
-0002c530: 6f77 2829 0a0a 2020 2020 2020 2020 6465  ow()..        de
-0002c540: 6275 6728 2257 6174 7465 7273 6f6e 2773  bug("Watterson's
-0002c550: 2065 7374 696d 6174 6f72 2062 6172 2070   estimator bar p
-0002c560: 6c6f 7422 290a 2020 2020 2020 2020 6669  lot").        fi
-0002c570: 6720 3d20 7078 2e62 6172 280a 2020 2020  g = px.bar(.    
-0002c580: 2020 2020 2020 2020 6461 7461 5f66 7261          data_fra
-0002c590: 6d65 3d64 665f 7374 6174 732c 0a20 2020  me=df_stats,.   
-0002c5a0: 2020 2020 2020 2020 2078 3d22 636f 686f           x="coho
-0002c5b0: 7274 222c 0a20 2020 2020 2020 2020 2020  rt",.           
-0002c5c0: 2079 3d22 7468 6574 615f 775f 6573 7469   y="theta_w_esti
-0002c5d0: 6d61 7465 222c 0a20 2020 2020 2020 2020  mate",.         
-0002c5e0: 2020 2065 7272 6f72 5f79 3d22 7468 6574     error_y="thet
-0002c5f0: 615f 775f 6369 5f65 7272 222c 0a20 2020  a_w_ci_err",.   
-0002c600: 2020 2020 2020 2020 2074 6974 6c65 3d22           title="
-0002c610: 5761 7474 6572 736f 6e27 7320 6573 7469  Watterson's esti
-0002c620: 6d61 746f 7222 2c0a 2020 2020 2020 2020  mator",.        
-0002c630: 2020 2020 636f 6c6f 723d 636f 6c6f 722c      color=color,
-0002c640: 0a20 2020 2020 2020 2020 2020 2068 6569  .            hei
-0002c650: 6768 743d 6261 725f 706c 6f74 5f68 6569  ght=bar_plot_hei
-0002c660: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
-0002c670: 2077 6964 7468 3d62 6172 5f70 6c6f 745f   width=bar_plot_
-0002c680: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0002c690: 2020 2074 656d 706c 6174 653d 7465 6d70     template=temp
-0002c6a0: 6c61 7465 2c0a 2020 2020 2020 2020 2020  late,.          
-0002c6b0: 2020 2a2a 706c 6f74 5f6b 7761 7267 732c    **plot_kwargs,
-0002c6c0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0002c6d0: 2020 2066 6967 2e73 686f 7728 290a 0a20     fig.show().. 
-0002c6e0: 2020 2020 2020 2064 6562 7567 2822 5461         debug("Ta
-0002c6f0: 6a69 6d61 2773 2044 2062 6172 2070 6c6f  jima's D bar plo
-0002c700: 7422 290a 2020 2020 2020 2020 6669 6720  t").        fig 
-0002c710: 3d20 7078 2e62 6172 280a 2020 2020 2020  = px.bar(.      
-0002c720: 2020 2020 2020 6461 7461 5f66 7261 6d65        data_frame
-0002c730: 3d64 665f 7374 6174 732c 0a20 2020 2020  =df_stats,.     
-0002c740: 2020 2020 2020 2078 3d22 636f 686f 7274         x="cohort
-0002c750: 222c 0a20 2020 2020 2020 2020 2020 2079  ",.            y
-0002c760: 3d22 7461 6a69 6d61 5f64 5f65 7374 696d  ="tajima_d_estim
-0002c770: 6174 6522 2c0a 2020 2020 2020 2020 2020  ate",.          
-0002c780: 2020 6572 726f 725f 793d 2274 616a 696d    error_y="tajim
-0002c790: 615f 645f 6369 5f65 7272 222c 0a20 2020  a_d_ci_err",.   
-0002c7a0: 2020 2020 2020 2020 2074 6974 6c65 3d22           title="
-0002c7b0: 5461 6a69 6d61 2773 2044 222c 0a20 2020  Tajima's D",.   
-0002c7c0: 2020 2020 2020 2020 2063 6f6c 6f72 3d63           color=c
-0002c7d0: 6f6c 6f72 2c0a 2020 2020 2020 2020 2020  olor,.          
-0002c7e0: 2020 6865 6967 6874 3d62 6172 5f70 6c6f    height=bar_plo
-0002c7f0: 745f 6865 6967 6874 2c0a 2020 2020 2020  t_height,.      
-0002c800: 2020 2020 2020 7769 6474 683d 6261 725f        width=bar_
-0002c810: 706c 6f74 5f77 6964 7468 2c0a 2020 2020  plot_width,.    
-0002c820: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
-0002c830: 3d74 656d 706c 6174 652c 0a20 2020 2020  =template,.     
-0002c840: 2020 2020 2020 202a 2a70 6c6f 745f 6b77         **plot_kw
-0002c850: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
-0002c860: 2020 2020 2020 2020 6669 672e 7368 6f77          fig.show
-0002c870: 2829 0a0a 2020 2020 2020 2020 6465 6275  ()..        debu
-0002c880: 6728 2273 6361 7474 6572 2070 6c6f 7420  g("scatter plot 
-0002c890: 636f 6d70 6172 696e 6720 6469 7665 7273  comparing divers
-0002c8a0: 6974 7920 6573 7469 6d61 746f 7273 2229  ity estimators")
-0002c8b0: 0a20 2020 2020 2020 2066 6967 203d 2070  .        fig = p
-0002c8c0: 782e 7363 6174 7465 7228 0a20 2020 2020  x.scatter(.     
-0002c8d0: 2020 2020 2020 2064 6174 615f 6672 616d         data_fram
-0002c8e0: 653d 6466 5f73 7461 7473 2c0a 2020 2020  e=df_stats,.    
-0002c8f0: 2020 2020 2020 2020 783d 2274 6865 7461          x="theta
-0002c900: 5f70 695f 6573 7469 6d61 7465 222c 0a20  _pi_estimate",. 
-0002c910: 2020 2020 2020 2020 2020 2079 3d22 7468             y="th
-0002c920: 6574 615f 775f 6573 7469 6d61 7465 222c  eta_w_estimate",
-0002c930: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-0002c940: 6f72 5f78 3d22 7468 6574 615f 7069 5f63  or_x="theta_pi_c
-0002c950: 695f 6572 7222 2c0a 2020 2020 2020 2020  i_err",.        
-0002c960: 2020 2020 6572 726f 725f 793d 2274 6865      error_y="the
-0002c970: 7461 5f77 5f63 695f 6572 7222 2c0a 2020  ta_w_ci_err",.  
-0002c980: 2020 2020 2020 2020 2020 7469 746c 653d            title=
-0002c990: 2244 6976 6572 7369 7479 2065 7374 696d  "Diversity estim
-0002c9a0: 6174 6f72 7322 2c0a 2020 2020 2020 2020  ators",.        
-0002c9b0: 2020 2020 636f 6c6f 723d 636f 6c6f 722c      color=color,
-0002c9c0: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
-0002c9d0: 7468 3d73 6361 7474 6572 5f70 6c6f 745f  th=scatter_plot_
-0002c9e0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0002c9f0: 2020 2068 6569 6768 743d 7363 6174 7465     height=scatte
-0002ca00: 725f 706c 6f74 5f68 6569 6768 742c 0a20  r_plot_height,. 
-0002ca10: 2020 2020 2020 2020 2020 2074 656d 706c             templ
-0002ca20: 6174 653d 7465 6d70 6c61 7465 2c0a 2020  ate=template,.  
-0002ca30: 2020 2020 2020 2020 2020 2a2a 706c 6f74            **plot
-0002ca40: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
-0002ca50: 2029 0a20 2020 2020 2020 2066 6967 2e73   ).        fig.s
-0002ca60: 686f 7728 290a 0a20 2020 2040 646f 6328  how()..    @doc(
-0002ca70: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-0002ca80: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-0002ca90: 2050 6c6f 7420 616e 2069 6e74 6572 6163   Plot an interac
-0002caa0: 7469 7665 206d 6170 2073 686f 7769 6e67  tive map showing
-0002cab0: 2073 616d 706c 696e 6720 6c6f 6361 7469   sampling locati
-0002cac0: 6f6e 7320 7573 696e 6720 6970 796c 6561  ons using ipylea
-0002cad0: 666c 6574 2e0a 2020 2020 2020 2020 2222  flet..        ""
-0002cae0: 222c 0a20 2020 2020 2020 2070 6172 616d  ",.        param
-0002caf0: 6574 6572 733d 6469 6374 280a 2020 2020  eters=dict(.    
-0002cb00: 2020 2020 2020 2020 6d69 6e5f 7361 6d70          min_samp
-0002cb10: 6c65 733d 2222 220a 2020 2020 2020 2020  les=""".        
-0002cb20: 2020 2020 2020 2020 4d69 6e69 6d75 6d20          Minimum 
-0002cb30: 6e75 6d62 6572 206f 6620 7361 6d70 6c65  number of sample
-0002cb40: 7320 7265 7175 6972 6564 2074 6f20 7368  s required to sh
-0002cb50: 6f77 2061 206d 6172 6b65 7220 666f 7220  ow a marker for 
-0002cb60: 6120 6769 7665 6e0a 2020 2020 2020 2020  a given.        
-0002cb70: 2020 2020 2020 2020 6c6f 6361 7469 6f6e          location
-0002cb80: 2e0a 2020 2020 2020 2020 2020 2020 2222  ..            ""
-0002cb90: 222c 0a20 2020 2020 2020 2029 2c0a 2020  ",.        ),.  
-0002cba0: 2020 2020 2020 7265 7475 726e 733d 2249        returns="I
-0002cbb0: 7079 6c65 6166 6c65 7420 6d61 7020 7769  pyleaflet map wi
-0002cbc0: 6467 6574 2e22 2c0a 2020 2020 290a 2020  dget.",.    ).  
-0002cbd0: 2020 6465 6620 706c 6f74 5f73 616d 706c    def plot_sampl
-0002cbe0: 6573 5f69 6e74 6572 6163 7469 7665 5f6d  es_interactive_m
-0002cbf0: 6170 280a 2020 2020 2020 2020 7365 6c66  ap(.        self
-0002cc00: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
-0002cc10: 5f73 6574 733a 204f 7074 696f 6e61 6c5b  _sets: Optional[
-0002cc20: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-0002cc30: 6c65 5f73 6574 735d 203d 204e 6f6e 652c  le_sets] = None,
-0002cc40: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-0002cc50: 7175 6572 793a 204f 7074 696f 6e61 6c5b  query: Optional[
-0002cc60: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-0002cc70: 6c65 5f71 7565 7279 5d20 3d20 4e6f 6e65  le_query] = None
-0002cc80: 2c0a 2020 2020 2020 2020 6261 7365 6d61  ,.        basema
-0002cc90: 703a 206d 6170 5f70 6172 616d 732e 6261  p: map_params.ba
-0002cca0: 7365 6d61 7020 3d20 6d61 705f 7061 7261  semap = map_para
-0002ccb0: 6d73 2e62 6173 656d 6170 5f64 6566 6175  ms.basemap_defau
-0002ccc0: 6c74 2c0a 2020 2020 2020 2020 6365 6e74  lt,.        cent
-0002ccd0: 6572 3a20 6d61 705f 7061 7261 6d73 2e63  er: map_params.c
-0002cce0: 656e 7465 7220 3d20 6d61 705f 7061 7261  enter = map_para
-0002ccf0: 6d73 2e63 656e 7465 725f 6465 6661 756c  ms.center_defaul
-0002cd00: 742c 0a20 2020 2020 2020 207a 6f6f 6d3a  t,.        zoom:
-0002cd10: 206d 6170 5f70 6172 616d 732e 7a6f 6f6d   map_params.zoom
-0002cd20: 203d 206d 6170 5f70 6172 616d 732e 7a6f   = map_params.zo
-0002cd30: 6f6d 5f64 6566 6175 6c74 2c0a 2020 2020  om_default,.    
-0002cd40: 2020 2020 6d69 6e5f 7361 6d70 6c65 733a      min_samples:
-0002cd50: 2069 6e74 203d 2031 2c0a 2020 2020 2020   int = 1,.      
-0002cd60: 2020 6865 6967 6874 3a20 6d61 705f 7061    height: map_pa
-0002cd70: 7261 6d73 2e68 6569 6768 7420 3d20 6d61  rams.height = ma
-0002cd80: 705f 7061 7261 6d73 2e68 6569 6768 745f  p_params.height_
-0002cd90: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-0002cda0: 2077 6964 7468 3a20 6d61 705f 7061 7261   width: map_para
-0002cdb0: 6d73 2e77 6964 7468 203d 206d 6170 5f70  ms.width = map_p
-0002cdc0: 6172 616d 732e 7769 6474 685f 6465 6661  arams.width_defa
-0002cdd0: 756c 742c 0a20 2020 2029 202d 3e20 6970  ult,.    ) -> ip
-0002cde0: 796c 6561 666c 6574 2e4d 6170 3a0a 2020  yleaflet.Map:.  
-0002cdf0: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
-0002ce00: 6c66 2e5f 6c6f 672e 6465 6275 670a 0a20  lf._log.debug.. 
-0002ce10: 2020 2020 2020 2023 206e 6f72 6d61 6c69         # normali
-0002ce20: 7365 2068 6569 6768 7420 616e 6420 7769  se height and wi
-0002ce30: 6474 6820 746f 2073 7472 696e 670a 2020  dth to string.  
-0002ce40: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0002ce50: 6e63 6528 6865 6967 6874 2c20 696e 7429  nce(height, int)
-0002ce60: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-0002ce70: 6967 6874 203d 2066 227b 6865 6967 6874  ight = f"{height
-0002ce80: 7d70 7822 0a20 2020 2020 2020 2069 6620  }px".        if 
-0002ce90: 6973 696e 7374 616e 6365 2877 6964 7468  isinstance(width
-0002cea0: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
-0002ceb0: 2020 2020 7769 6474 6820 3d20 6622 7b77      width = f"{w
-0002cec0: 6964 7468 7d70 7822 0a0a 2020 2020 2020  idth}px"..      
-0002ced0: 2020 6465 6275 6728 226c 6f61 6420 7361    debug("load sa
-0002cee0: 6d70 6c65 206d 6574 6164 6174 6122 290a  mple metadata").
-0002cef0: 2020 2020 2020 2020 6466 5f73 616d 706c          df_sampl
-0002cf00: 6573 203d 2073 656c 662e 7361 6d70 6c65  es = self.sample
-0002cf10: 5f6d 6574 6164 6174 6128 0a20 2020 2020  _metadata(.     
-0002cf20: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-0002cf30: 7473 3d73 616d 706c 655f 7365 7473 2c20  ts=sample_sets, 
-0002cf40: 7361 6d70 6c65 5f71 7565 7279 3d73 616d  sample_query=sam
-0002cf50: 706c 655f 7175 6572 790a 2020 2020 2020  ple_query.      
-0002cf60: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
-0002cf70: 7567 2822 7069 766f 7420 7461 7861 2062  ug("pivot taxa b
-0002cf80: 7920 6c6f 6361 7469 6f6e 7322 290a 2020  y locations").  
-0002cf90: 2020 2020 2020 6c6f 6361 7469 6f6e 5f63        location_c
-0002cfa0: 6f6d 706f 7369 7465 5f6b 6579 203d 205b  omposite_key = [
-0002cfb0: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
-0002cfc0: 756e 7472 7922 2c0a 2020 2020 2020 2020  untry",.        
-0002cfd0: 2020 2020 2261 646d 696e 315f 6973 6f22      "admin1_iso"
-0002cfe0: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
-0002cff0: 646d 696e 315f 6e61 6d65 222c 0a20 2020  dmin1_name",.   
-0002d000: 2020 2020 2020 2020 2022 6164 6d69 6e32           "admin2
-0002d010: 5f6e 616d 6522 2c0a 2020 2020 2020 2020  _name",.        
-0002d020: 2020 2020 226c 6f63 6174 696f 6e22 2c0a      "location",.
-0002d030: 2020 2020 2020 2020 2020 2020 226c 6174              "lat
-0002d040: 6974 7564 6522 2c0a 2020 2020 2020 2020  itude",.        
-0002d050: 2020 2020 226c 6f6e 6769 7475 6465 222c      "longitude",
-0002d060: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-0002d070: 2020 2070 6976 6f74 5f6c 6f63 6174 696f     pivot_locatio
-0002d080: 6e5f 7461 786f 6e20 3d20 6466 5f73 616d  n_taxon = df_sam
-0002d090: 706c 6573 2e70 6976 6f74 5f74 6162 6c65  ples.pivot_table
-0002d0a0: 280a 2020 2020 2020 2020 2020 2020 696e  (.            in
-0002d0b0: 6465 783d 6c6f 6361 7469 6f6e 5f63 6f6d  dex=location_com
-0002d0c0: 706f 7369 7465 5f6b 6579 2c0a 2020 2020  posite_key,.    
-0002d0d0: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-0002d0e0: 5b22 7461 786f 6e22 5d2c 0a20 2020 2020  ["taxon"],.     
-0002d0f0: 2020 2020 2020 2076 616c 7565 733d 2273         values="s
-0002d100: 616d 706c 655f 6964 222c 0a20 2020 2020  ample_id",.     
-0002d110: 2020 2020 2020 2061 6767 6675 6e63 3d22         aggfunc="
-0002d120: 636f 756e 7422 2c0a 2020 2020 2020 2020  count",.        
-0002d130: 2020 2020 6669 6c6c 5f76 616c 7565 3d30      fill_value=0
-0002d140: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0002d150: 2020 2020 2064 6562 7567 2822 6170 7065       debug("appe
-0002d160: 6e64 2061 6767 7265 6761 7469 6f6e 7320  nd aggregations 
-0002d170: 746f 2070 6976 6f74 2229 0a20 2020 2020  to pivot").     
-0002d180: 2020 2064 665f 6c6f 6361 7469 6f6e 5f61     df_location_a
-0002d190: 6767 7320 3d20 6466 5f73 616d 706c 6573  ggs = df_samples
-0002d1a0: 2e67 726f 7570 6279 286c 6f63 6174 696f  .groupby(locatio
-0002d1b0: 6e5f 636f 6d70 6f73 6974 655f 6b65 7929  n_composite_key)
-0002d1c0: 2e61 6767 280a 2020 2020 2020 2020 2020  .agg(.          
-0002d1d0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-0002d1e0: 2020 2020 2279 6561 7222 3a20 6c61 6d62      "year": lamb
-0002d1f0: 6461 2078 3a20 222c 2022 2e6a 6f69 6e28  da x: ", ".join(
-0002d200: 7374 7228 7929 2066 6f72 2079 2069 6e20  str(y) for y in 
-0002d210: 736f 7274 6564 2878 2e75 6e69 7175 6528  sorted(x.unique(
-0002d220: 2929 292c 0a20 2020 2020 2020 2020 2020  ))),.           
-0002d230: 2020 2020 2022 7361 6d70 6c65 5f73 6574       "sample_set
-0002d240: 223a 206c 616d 6264 6120 783a 2022 2c20  ": lambda x: ", 
-0002d250: 222e 6a6f 696e 2873 7472 2879 2920 666f  ".join(str(y) fo
-0002d260: 7220 7920 696e 2073 6f72 7465 6428 782e  r y in sorted(x.
-0002d270: 756e 6971 7565 2829 2929 2c0a 2020 2020  unique())),.    
-0002d280: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
-0002d290: 7472 6962 7574 6f72 223a 206c 616d 6264  tributor": lambd
-0002d2a0: 6120 783a 2022 2c20 222e 6a6f 696e 2873  a x: ", ".join(s
-0002d2b0: 7472 2879 2920 666f 7220 7920 696e 2073  tr(y) for y in s
-0002d2c0: 6f72 7465 6428 782e 756e 6971 7565 2829  orted(x.unique()
-0002d2d0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-0002d2e0: 7d0a 2020 2020 2020 2020 290a 2020 2020  }.        ).    
-0002d2f0: 2020 2020 7069 766f 745f 6c6f 6361 7469      pivot_locati
-0002d300: 6f6e 5f74 6178 6f6e 203d 2070 6976 6f74  on_taxon = pivot
-0002d310: 5f6c 6f63 6174 696f 6e5f 7461 786f 6e2e  _location_taxon.
-0002d320: 6d65 7267 6528 0a20 2020 2020 2020 2020  merge(.         
-0002d330: 2020 2064 665f 6c6f 6361 7469 6f6e 5f61     df_location_a
-0002d340: 6767 732c 206f 6e3d 6c6f 6361 7469 6f6e  ggs, on=location
-0002d350: 5f63 6f6d 706f 7369 7465 5f6b 6579 2c20  _composite_key, 
-0002d360: 7661 6c69 6461 7465 3d22 6f6e 655f 746f  validate="one_to
-0002d370: 5f6f 6e65 220a 2020 2020 2020 2020 290a  _one".        ).
-0002d380: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-0002d390: 6861 6e64 6c65 2062 6173 656d 6170 2229  handle basemap")
-0002d3a0: 0a20 2020 2020 2020 2062 6173 656d 6170  .        basemap
-0002d3b0: 5f70 726f 7669 6465 7273 5f64 6963 7420  _providers_dict 
-0002d3c0: 3d20 5f67 6574 5f62 6173 656d 6170 5f61  = _get_basemap_a
-0002d3d0: 6262 7265 7673 2829 0a0a 2020 2020 2020  bbrevs()..      
-0002d3e0: 2020 2320 4465 7465 726d 696e 6520 6261    # Determine ba
-0002d3f0: 7365 6d61 705f 7072 6f76 6964 6572 2076  semap_provider v
-0002d400: 6961 2062 6173 656d 6170 0a20 2020 2020  ia basemap.     
-0002d410: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0002d420: 2862 6173 656d 6170 2c20 7374 7229 3a0a  (basemap, str):.
-0002d430: 2020 2020 2020 2020 2020 2020 2320 496e              # In
-0002d440: 7465 7270 7265 7420 7374 7269 6e67 0a20  terpret string. 
-0002d450: 2020 2020 2020 2020 2020 2023 2053 7570             # Sup
-0002d460: 706f 7274 2063 6173 652d 696e 7365 6e73  port case-insens
-0002d470: 6974 6976 6520 6261 7365 6d61 7020 6162  itive basemap ab
-0002d480: 6272 6576 6961 7469 6f6e 730a 2020 2020  breviations.    
-0002d490: 2020 2020 2020 2020 6261 7365 6d61 705f          basemap_
-0002d4a0: 7374 7220 3d20 6261 7365 6d61 702e 6c6f  str = basemap.lo
-0002d4b0: 7765 7228 290a 2020 2020 2020 2020 2020  wer().          
-0002d4c0: 2020 6966 2062 6173 656d 6170 5f73 7472    if basemap_str
-0002d4d0: 206e 6f74 2069 6e20 6261 7365 6d61 705f   not in basemap_
-0002d4e0: 7072 6f76 6964 6572 735f 6469 6374 3a0a  providers_dict:.
-0002d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d500: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0002d510: 2822 4261 7365 6d61 7020 6162 6272 6576  ("Basemap abbrev
-0002d520: 6961 7469 6f6e 206e 6f74 2072 6563 6f67  iation not recog
-0002d530: 6e69 7365 643a 222c 2062 6173 656d 6170  nised:", basemap
-0002d540: 5f73 7472 290a 2020 2020 2020 2020 2020  _str).          
-0002d550: 2020 6261 7365 6d61 705f 7072 6f76 6964    basemap_provid
-0002d560: 6572 203d 2062 6173 656d 6170 5f70 726f  er = basemap_pro
-0002d570: 7669 6465 7273 5f64 6963 745b 6261 7365  viders_dict[base
-0002d580: 6d61 705f 7374 725d 0a20 2020 2020 2020  map_str].       
-0002d590: 2065 6c69 6620 6261 7365 6d61 7020 6973   elif basemap is
-0002d5a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002d5b0: 2020 2023 2044 6566 6175 6c74 0a20 2020     # Default.   
-0002d5c0: 2020 2020 2020 2020 2062 6173 656d 6170           basemap
-0002d5d0: 5f70 726f 7669 6465 7220 3d20 6970 796c  _provider = ipyl
-0002d5e0: 6561 666c 6574 2e62 6173 656d 6170 732e  eaflet.basemaps.
-0002d5f0: 4573 7269 2e57 6f72 6c64 496d 6167 6572  Esri.WorldImager
-0002d600: 790a 2020 2020 2020 2020 656c 7365 3a0a  y.        else:.
-0002d610: 2020 2020 2020 2020 2020 2020 2320 4578              # Ex
-0002d620: 7065 6374 2064 6963 7420 6f72 2054 696c  pect dict or Til
-0002d630: 6550 726f 7669 6465 7220 6f72 2054 696c  eProvider or Til
-0002d640: 654c 6179 6572 0a20 2020 2020 2020 2020  eLayer.         
-0002d650: 2020 2062 6173 656d 6170 5f70 726f 7669     basemap_provi
-0002d660: 6465 7220 3d20 6261 7365 6d61 700a 0a20  der = basemap.. 
-0002d670: 2020 2020 2020 2064 6562 7567 2822 6372         debug("cr
-0002d680: 6561 7465 2061 206d 6170 2229 0a20 2020  eate a map").   
-0002d690: 2020 2020 2073 616d 706c 6573 5f6d 6170       samples_map
-0002d6a0: 203d 2069 7079 6c65 6166 6c65 742e 4d61   = ipyleaflet.Ma
-0002d6b0: 7028 0a20 2020 2020 2020 2020 2020 2063  p(.            c
-0002d6c0: 656e 7465 723d 6365 6e74 6572 2c0a 2020  enter=center,.  
-0002d6d0: 2020 2020 2020 2020 2020 7a6f 6f6d 3d7a            zoom=z
-0002d6e0: 6f6f 6d2c 0a20 2020 2020 2020 2020 2020  oom,.           
-0002d6f0: 2062 6173 656d 6170 3d62 6173 656d 6170   basemap=basemap
-0002d700: 5f70 726f 7669 6465 722c 0a20 2020 2020  _provider,.     
-0002d710: 2020 2029 0a20 2020 2020 2020 2073 6361     ).        sca
-0002d720: 6c65 5f63 6f6e 7472 6f6c 203d 2069 7079  le_control = ipy
-0002d730: 6c65 6166 6c65 742e 5363 616c 6543 6f6e  leaflet.ScaleCon
-0002d740: 7472 6f6c 2870 6f73 6974 696f 6e3d 2262  trol(position="b
-0002d750: 6f74 746f 6d6c 6566 7422 290a 2020 2020  ottomleft").    
-0002d760: 2020 2020 7361 6d70 6c65 735f 6d61 702e      samples_map.
-0002d770: 6164 645f 636f 6e74 726f 6c28 7363 616c  add_control(scal
-0002d780: 655f 636f 6e74 726f 6c29 0a20 2020 2020  e_control).     
-0002d790: 2020 2073 616d 706c 6573 5f6d 6170 2e6c     samples_map.l
-0002d7a0: 6179 6f75 742e 6865 6967 6874 203d 2068  ayout.height = h
-0002d7b0: 6569 6768 740a 2020 2020 2020 2020 7361  eight.        sa
-0002d7c0: 6d70 6c65 735f 6d61 702e 6c61 796f 7574  mples_map.layout
-0002d7d0: 2e77 6964 7468 203d 2077 6964 7468 0a0a  .width = width..
-0002d7e0: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-0002d7f0: 6464 206d 6172 6b65 7273 2229 0a20 2020  dd markers").   
-0002d800: 2020 2020 2074 6178 6120 3d20 6466 5f73       taxa = df_s
-0002d810: 616d 706c 6573 5b22 7461 786f 6e22 5d2e  amples["taxon"].
-0002d820: 6472 6f70 6e61 2829 2e73 6f72 745f 7661  dropna().sort_va
-0002d830: 6c75 6573 2829 2e75 6e69 7175 6528 290a  lues().unique().
-0002d840: 2020 2020 2020 2020 666f 7220 5f2c 2072          for _, r
-0002d850: 6f77 2069 6e20 7069 766f 745f 6c6f 6361  ow in pivot_loca
-0002d860: 7469 6f6e 5f74 6178 6f6e 2e72 6573 6574  tion_taxon.reset
-0002d870: 5f69 6e64 6578 2829 2e69 7465 7272 6f77  _index().iterrow
-0002d880: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0002d890: 2074 6974 6c65 203d 2028 0a20 2020 2020   title = (.     
-0002d8a0: 2020 2020 2020 2020 2020 2066 224c 6f63             f"Loc
-0002d8b0: 6174 696f 6e3a 207b 726f 772e 6c6f 6361  ation: {row.loca
-0002d8c0: 7469 6f6e 7d20 287b 726f 772e 6c61 7469  tion} ({row.lati
-0002d8d0: 7475 6465 3a2e 3366 7d2c 207b 726f 772e  tude:.3f}, {row.
-0002d8e0: 6c6f 6e67 6974 7564 653a 2e33 667d 2922  longitude:.3f})"
-0002d8f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0002d900: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-0002d910: 202b 3d20 6622 5c6e 4164 6d69 6e20 6c65   += f"\nAdmin le
-0002d920: 7665 6c20 323a 207b 726f 772e 6164 6d69  vel 2: {row.admi
-0002d930: 6e32 5f6e 616d 657d 220a 2020 2020 2020  n2_name}".      
-0002d940: 2020 2020 2020 7469 746c 6520 2b3d 2066        title += f
-0002d950: 225c 6e41 646d 696e 206c 6576 656c 2031  "\nAdmin level 1
-0002d960: 3a20 7b72 6f77 2e61 646d 696e 315f 6e61  : {row.admin1_na
-0002d970: 6d65 7d20 287b 726f 772e 6164 6d69 6e31  me} ({row.admin1
-0002d980: 5f69 736f 7d29 220a 2020 2020 2020 2020  _iso})".        
-0002d990: 2020 2020 7469 746c 6520 2b3d 2066 225c      title += f"\
-0002d9a0: 6e43 6f75 6e74 7279 3a20 7b72 6f77 2e63  nCountry: {row.c
-0002d9b0: 6f75 6e74 7279 7d22 0a20 2020 2020 2020  ountry}".       
-0002d9c0: 2020 2020 2074 6974 6c65 202b 3d20 6622       title += f"
-0002d9d0: 5c6e 5965 6172 733a 207b 726f 772e 7965  \nYears: {row.ye
-0002d9e0: 6172 7d22 0a20 2020 2020 2020 2020 2020  ar}".           
-0002d9f0: 2074 6974 6c65 202b 3d20 6622 5c6e 5361   title += f"\nSa
-0002da00: 6d70 6c65 2073 6574 733a 207b 726f 772e  mple sets: {row.
-0002da10: 7361 6d70 6c65 5f73 6574 7d22 0a20 2020  sample_set}".   
-0002da20: 2020 2020 2020 2020 2074 6974 6c65 202b           title +
-0002da30: 3d20 6622 5c6e 436f 6e74 7269 6275 746f  = f"\nContributo
-0002da40: 7273 3a20 7b72 6f77 2e63 6f6e 7472 6962  rs: {row.contrib
-0002da50: 7574 6f72 7d22 0a20 2020 2020 2020 2020  utor}".         
-0002da60: 2020 2074 6974 6c65 202b 3d20 225c 6e4e     title += "\nN
-0002da70: 6f2e 2073 7065 6369 6d65 6e73 3a20 220a  o. specimens: ".
-0002da80: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
-0002da90: 6e20 3d20 300a 2020 2020 2020 2020 2020  n = 0.          
-0002daa0: 2020 666f 7220 7461 786f 6e20 696e 2074    for taxon in t
-0002dab0: 6178 613a 0a20 2020 2020 2020 2020 2020  axa:.           
-0002dac0: 2020 2020 2023 2047 6574 2074 6865 206e       # Get the n
-0002dad0: 756d 6265 7220 6f66 2073 616d 706c 6573  umber of samples
-0002dae0: 2069 6e20 7468 6973 2074 6178 6f6e 0a20   in this taxon. 
-0002daf0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002db00: 203d 2072 6f77 5b74 6178 6f6e 5d0a 2020   = row[taxon].  
-0002db10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0002db20: 436f 756e 7420 7468 6520 6e75 6d62 6572  Count the number
-0002db30: 206f 6620 7361 6d70 6c65 7320 696e 2061   of samples in a
-0002db40: 6c6c 2074 6178 610a 2020 2020 2020 2020  ll taxa.        
-0002db50: 2020 2020 2020 2020 616c 6c5f 6e20 2b3d          all_n +=
-0002db60: 206e 0a20 2020 2020 2020 2020 2020 2020   n.             
-0002db70: 2020 2069 6620 6e20 3e20 303a 0a20 2020     if n > 0:.   
-0002db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db90: 2074 6974 6c65 202b 3d20 6622 7b6e 7d20   title += f"{n} 
-0002dba0: 7b74 6178 6f6e 7d3b 2022 0a20 2020 2020  {taxon}; ".     
-0002dbb0: 2020 2020 2020 2023 204f 6e6c 7920 7368         # Only sh
-0002dbc0: 6f77 2061 206d 6172 6b65 7220 7768 656e  ow a marker when
-0002dbd0: 2074 6865 7265 2061 7265 2065 6e6f 7567   there are enoug
-0002dbe0: 6820 7361 6d70 6c65 730a 2020 2020 2020  h samples.      
-0002dbf0: 2020 2020 2020 6966 2061 6c6c 5f6e 203e        if all_n >
-0002dc00: 3d20 6d69 6e5f 7361 6d70 6c65 733a 0a20  = min_samples:. 
-0002dc10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0002dc20: 6172 6b65 7220 3d20 6970 796c 6561 666c  arker = ipyleafl
-0002dc30: 6574 2e4d 6172 6b65 7228 0a20 2020 2020  et.Marker(.     
-0002dc40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0002dc50: 6f63 6174 696f 6e3d 2872 6f77 2e6c 6174  ocation=(row.lat
-0002dc60: 6974 7564 652c 2072 6f77 2e6c 6f6e 6769  itude, row.longi
-0002dc70: 7475 6465 292c 0a20 2020 2020 2020 2020  tude),.         
-0002dc80: 2020 2020 2020 2020 2020 2064 7261 6767             dragg
-0002dc90: 6162 6c65 3d46 616c 7365 2c0a 2020 2020  able=False,.    
-0002dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dcb0: 7469 746c 653d 7469 746c 652c 0a20 2020  title=title,.   
-0002dcc0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0002dcd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002dce0: 616d 706c 6573 5f6d 6170 2e61 6464 5f6c  amples_map.add_l
-0002dcf0: 6179 6572 286d 6172 6b65 7229 0a0a 2020  ayer(marker)..  
-0002dd00: 2020 2020 2020 7265 7475 726e 2073 616d        return sam
-0002dd10: 706c 6573 5f6d 6170 0a0a 2020 2020 4064  ples_map..    @d
-0002dd20: 6f63 280a 2020 2020 2020 2020 7375 6d6d  oc(.        summ
-0002dd30: 6172 793d 2222 220a 2020 2020 2020 2020  ary=""".        
-0002dd40: 2020 2020 5275 6e20 616e 6420 706c 6f74      Run and plot
-0002dd50: 2061 2046 7374 2067 656e 6f6d 652d 7769   a Fst genome-wi
-0002dd60: 6465 2073 6361 6e20 746f 2069 6e76 6573  de scan to inves
-0002dd70: 7469 6761 7465 2067 656e 6574 6963 0a20  tigate genetic. 
-0002dd80: 2020 2020 2020 2020 2020 2064 6966 6665             diffe
-0002dd90: 7265 6e74 6961 7469 6f6e 2062 6574 7765  rentiation betwe
-0002dda0: 656e 2074 776f 2063 6f68 6f72 7473 2e0a  en two cohorts..
-0002ddb0: 2020 2020 2020 2020 2222 222c 0a20 2020          """,.   
-0002ddc0: 2029 0a20 2020 2064 6566 2070 6c6f 745f   ).    def plot_
-0002ddd0: 6673 745f 6777 7373 5f74 7261 636b 280a  fst_gwss_track(.
-0002dde0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0002ddf0: 2020 2020 2020 636f 6e74 6967 3a20 6261        contig: ba
-0002de00: 7365 5f70 6172 616d 732e 636f 6e74 6967  se_params.contig
-0002de10: 2c0a 2020 2020 2020 2020 7769 6e64 6f77  ,.        window
-0002de20: 5f73 697a 653a 2066 7374 5f70 6172 616d  _size: fst_param
-0002de30: 732e 7769 6e64 6f77 5f73 697a 652c 0a20  s.window_size,. 
-0002de40: 2020 2020 2020 2063 6f68 6f72 7431 5f71         cohort1_q
-0002de50: 7565 7279 3a20 6261 7365 5f70 6172 616d  uery: base_param
-0002de60: 732e 7361 6d70 6c65 5f71 7565 7279 2c0a  s.sample_query,.
-0002de70: 2020 2020 2020 2020 636f 686f 7274 325f          cohort2_
-0002de80: 7175 6572 793a 2062 6173 655f 7061 7261  query: base_para
-0002de90: 6d73 2e73 616d 706c 655f 7175 6572 792c  ms.sample_query,
-0002dea0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-0002deb0: 7365 7473 3a20 4f70 7469 6f6e 616c 5b62  sets: Optional[b
-0002dec0: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
-0002ded0: 655f 7365 7473 5d20 3d20 4e6f 6e65 2c0a  e_sets] = None,.
-0002dee0: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-0002def0: 6b3a 2062 6173 655f 7061 7261 6d73 2e73  k: base_params.s
-0002df00: 6974 655f 6d61 736b 203d 2044 4546 4155  ite_mask = DEFAU
-0002df10: 4c54 2c0a 2020 2020 2020 2020 636f 686f  LT,.        coho
-0002df20: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-0002df30: 6c5b 6261 7365 5f70 6172 616d 732e 636f  l[base_params.co
-0002df40: 686f 7274 5f73 697a 655d 203d 2066 7374  hort_size] = fst
-0002df50: 5f70 6172 616d 732e 636f 686f 7274 5f73  _params.cohort_s
-0002df60: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
-0002df70: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-0002df80: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b0a  size: Optional[.
-0002df90: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0002dfa0: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
-0002dfb0: 7274 5f73 697a 650a 2020 2020 2020 2020  rt_size.        
-0002dfc0: 5d20 3d20 6673 745f 7061 7261 6d73 2e6d  ] = fst_params.m
-0002dfd0: 696e 5f63 6f68 6f72 745f 7369 7a65 5f64  in_cohort_size_d
-0002dfe0: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-0002dff0: 6d61 785f 636f 686f 7274 5f73 697a 653a  max_cohort_size:
-0002e000: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-0002e010: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
-0002e020: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
-0002e030: 7a65 0a20 2020 2020 2020 205d 203d 2066  ze.        ] = f
-0002e040: 7374 5f70 6172 616d 732e 6d61 785f 636f  st_params.max_co
-0002e050: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
-0002e060: 742c 0a20 2020 2020 2020 2072 616e 646f  t,.        rando
-0002e070: 6d5f 7365 6564 3a20 6261 7365 5f70 6172  m_seed: base_par
-0002e080: 616d 732e 7261 6e64 6f6d 5f73 6565 6420  ams.random_seed 
-0002e090: 3d20 3432 2c0a 2020 2020 2020 2020 7469  = 42,.        ti
-0002e0a0: 746c 653a 204f 7074 696f 6e61 6c5b 6770  tle: Optional[gp
-0002e0b0: 6c74 5f70 6172 616d 732e 7469 746c 655d  lt_params.title]
-0002e0c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0002e0d0: 2073 697a 696e 675f 6d6f 6465 3a20 6770   sizing_mode: gp
-0002e0e0: 6c74 5f70 6172 616d 732e 7369 7a69 6e67  lt_params.sizing
-0002e0f0: 5f6d 6f64 6520 3d20 6770 6c74 5f70 6172  _mode = gplt_par
-0002e100: 616d 732e 7369 7a69 6e67 5f6d 6f64 655f  ams.sizing_mode_
-0002e110: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-0002e120: 2077 6964 7468 3a20 6770 6c74 5f70 6172   width: gplt_par
-0002e130: 616d 732e 7769 6474 6820 3d20 6770 6c74  ams.width = gplt
-0002e140: 5f70 6172 616d 732e 7769 6474 685f 6465  _params.width_de
-0002e150: 6661 756c 742c 0a20 2020 2020 2020 2068  fault,.        h
-0002e160: 6569 6768 743a 2067 706c 745f 7061 7261  eight: gplt_para
-0002e170: 6d73 2e68 6569 6768 7420 3d20 3230 302c  ms.height = 200,
-0002e180: 0a20 2020 2020 2020 2073 686f 773a 2067  .        show: g
-0002e190: 706c 745f 7061 7261 6d73 2e73 686f 7720  plt_params.show 
-0002e1a0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-0002e1b0: 785f 7261 6e67 653a 204f 7074 696f 6e61  x_range: Optiona
-0002e1c0: 6c5b 6770 6c74 5f70 6172 616d 732e 785f  l[gplt_params.x_
-0002e1d0: 7261 6e67 655d 203d 204e 6f6e 652c 0a20  range] = None,. 
-0002e1e0: 2020 2029 202d 3e20 6770 6c74 5f70 6172     ) -> gplt_par
-0002e1f0: 616d 732e 6669 6775 7265 3a0a 2020 2020  ams.figure:.    
-0002e200: 2020 2020 2320 636f 6d70 7574 6520 4673      # compute Fs
-0002e210: 740a 2020 2020 2020 2020 782c 2066 7374  t.        x, fst
-0002e220: 203d 2073 656c 662e 6673 745f 6777 7373   = self.fst_gwss
-0002e230: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
-0002e240: 6e74 6967 3d63 6f6e 7469 672c 0a20 2020  ntig=contig,.   
-0002e250: 2020 2020 2020 2020 2077 696e 646f 775f           window_
-0002e260: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
-0002e270: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-0002e280: 686f 7274 5f73 697a 653d 636f 686f 7274  hort_size=cohort
-0002e290: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-0002e2a0: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-0002e2b0: 7a65 3d6d 696e 5f63 6f68 6f72 745f 7369  ze=min_cohort_si
-0002e2c0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-0002e2d0: 6d61 785f 636f 686f 7274 5f73 697a 653d  max_cohort_size=
-0002e2e0: 6d61 785f 636f 686f 7274 5f73 697a 652c  max_cohort_size,
-0002e2f0: 0a20 2020 2020 2020 2020 2020 2063 6f68  .            coh
-0002e300: 6f72 7431 5f71 7565 7279 3d63 6f68 6f72  ort1_query=cohor
-0002e310: 7431 5f71 7565 7279 2c0a 2020 2020 2020  t1_query,.      
-0002e320: 2020 2020 2020 636f 686f 7274 325f 7175        cohort2_qu
-0002e330: 6572 793d 636f 686f 7274 325f 7175 6572  ery=cohort2_quer
-0002e340: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
-0002e350: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
-0002e360: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
-0002e370: 2020 2020 7369 7465 5f6d 6173 6b3d 7369      site_mask=si
-0002e380: 7465 5f6d 6173 6b2c 0a20 2020 2020 2020  te_mask,.       
-0002e390: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-0002e3a0: 3d72 616e 646f 6d5f 7365 6564 2c0a 2020  =random_seed,.  
-0002e3b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0002e3c0: 2023 2064 6574 6572 6d69 6e65 2058 2061   # determine X a
-0002e3d0: 7869 7320 7261 6e67 650a 2020 2020 2020  xis range.      
-0002e3e0: 2020 785f 6d69 6e20 3d20 785b 305d 0a20    x_min = x[0]. 
-0002e3f0: 2020 2020 2020 2078 5f6d 6178 203d 2078         x_max = x
-0002e400: 5b2d 315d 0a20 2020 2020 2020 2069 6620  [-1].        if 
-0002e410: 785f 7261 6e67 6520 6973 204e 6f6e 653a  x_range is None:
-0002e420: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
-0002e430: 616e 6765 203d 2062 6f6b 6568 2e6d 6f64  ange = bokeh.mod
-0002e440: 656c 732e 5261 6e67 6531 6428 785f 6d69  els.Range1d(x_mi
-0002e450: 6e2c 2078 5f6d 6178 2c20 626f 756e 6473  n, x_max, bounds
-0002e460: 3d22 6175 746f 2229 0a0a 2020 2020 2020  ="auto")..      
-0002e470: 2020 2320 6372 6561 7465 2061 2066 6967    # create a fig
-0002e480: 7572 650a 2020 2020 2020 2020 7877 6865  ure.        xwhe
-0002e490: 656c 5f7a 6f6f 6d20 3d20 626f 6b65 682e  el_zoom = bokeh.
-0002e4a0: 6d6f 6465 6c73 2e57 6865 656c 5a6f 6f6d  models.WheelZoom
-0002e4b0: 546f 6f6c 280a 2020 2020 2020 2020 2020  Tool(.          
-0002e4c0: 2020 6469 6d65 6e73 696f 6e73 3d22 7769    dimensions="wi
-0002e4d0: 6474 6822 2c20 6d61 696e 7461 696e 5f66  dth", maintain_f
-0002e4e0: 6f63 7573 3d46 616c 7365 0a20 2020 2020  ocus=False.     
-0002e4f0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-0002e500: 7469 746c 6520 6973 204e 6f6e 653a 0a20  title is None:. 
-0002e510: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-0002e520: 203d 2066 2243 6f68 6f72 7420 313a 207b   = f"Cohort 1: {
-0002e530: 636f 686f 7274 315f 7175 6572 797d 5c6e  cohort1_query}\n
-0002e540: 436f 686f 7274 2032 3a20 7b63 6f68 6f72  Cohort 2: {cohor
-0002e550: 7432 5f71 7565 7279 7d22 0a20 2020 2020  t2_query}".     
-0002e560: 2020 2066 6967 203d 2062 6f6b 6568 2e70     fig = bokeh.p
-0002e570: 6c6f 7474 696e 672e 6669 6775 7265 280a  lotting.figure(.
-0002e580: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-0002e590: 653d 7469 746c 652c 0a20 2020 2020 2020  e=title,.       
-0002e5a0: 2020 2020 2074 6f6f 6c73 3d5b 2278 7061       tools=["xpa
-0002e5b0: 6e22 2c20 2278 7a6f 6f6d 5f69 6e22 2c20  n", "xzoom_in", 
-0002e5c0: 2278 7a6f 6f6d 5f6f 7574 222c 2078 7768  "xzoom_out", xwh
-0002e5d0: 6565 6c5f 7a6f 6f6d 2c20 2272 6573 6574  eel_zoom, "reset
-0002e5e0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0002e5f0: 6163 7469 7665 5f73 6372 6f6c 6c3d 7877  active_scroll=xw
-0002e600: 6865 656c 5f7a 6f6f 6d2c 0a20 2020 2020  heel_zoom,.     
-0002e610: 2020 2020 2020 2061 6374 6976 655f 6472         active_dr
-0002e620: 6167 3d22 7870 616e 222c 0a20 2020 2020  ag="xpan",.     
-0002e630: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
-0002e640: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
-0002e650: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-0002e660: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
-0002e670: 2020 2020 2068 6569 6768 743d 6865 6967       height=heig
-0002e680: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
-0002e690: 746f 6f6c 6261 725f 6c6f 6361 7469 6f6e  toolbar_location
-0002e6a0: 3d22 6162 6f76 6522 2c0a 2020 2020 2020  ="above",.      
-0002e6b0: 2020 2020 2020 785f 7261 6e67 653d 785f        x_range=x_
-0002e6c0: 7261 6e67 652c 0a20 2020 2020 2020 2020  range,.         
-0002e6d0: 2020 2079 5f72 616e 6765 3d28 302c 2031     y_range=(0, 1
-0002e6e0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-0002e6f0: 2020 2020 2020 2320 706c 6f74 2046 7374        # plot Fst
-0002e700: 0a20 2020 2020 2020 2066 6967 2e63 6972  .        fig.cir
-0002e710: 636c 6528 0a20 2020 2020 2020 2020 2020  cle(.           
-0002e720: 2078 3d78 2c0a 2020 2020 2020 2020 2020   x=x,.          
-0002e730: 2020 793d 6673 742c 0a20 2020 2020 2020    y=fst,.       
-0002e740: 2020 2020 2073 697a 653d 332c 0a20 2020       size=3,.   
-0002e750: 2020 2020 2020 2020 206c 696e 655f 7769           line_wi
-0002e760: 6474 683d 302e 352c 0a20 2020 2020 2020  dth=0.5,.       
-0002e770: 2020 2020 206c 696e 655f 636f 6c6f 723d       line_color=
-0002e780: 2262 6c61 636b 222c 0a20 2020 2020 2020  "black",.       
-0002e790: 2020 2020 2066 696c 6c5f 636f 6c6f 723d       fill_color=
-0002e7a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 290a  None,.        ).
-0002e7b0: 0a20 2020 2020 2020 2023 2074 6964 7920  .        # tidy 
-0002e7c0: 7570 2074 6865 2070 6c6f 740a 2020 2020  up the plot.    
-0002e7d0: 2020 2020 6669 672e 7961 7869 732e 6178      fig.yaxis.ax
-0002e7e0: 6973 5f6c 6162 656c 203d 2022 4673 7422  is_label = "Fst"
-0002e7f0: 0a20 2020 2020 2020 2066 6967 2e79 6178  .        fig.yax
-0002e800: 6973 2e74 6963 6b65 7220 3d20 5b30 2c20  is.ticker = [0, 
-0002e810: 315d 0a20 2020 2020 2020 2073 656c 662e  1].        self.
-0002e820: 5f62 6f6b 6568 5f73 7479 6c65 5f67 656e  _bokeh_style_gen
-0002e830: 6f6d 655f 7861 7869 7328 6669 672c 2063  ome_xaxis(fig, c
-0002e840: 6f6e 7469 6729 0a0a 2020 2020 2020 2020  ontig)..        
-0002e850: 6966 2073 686f 773a 0a20 2020 2020 2020  if show:.       
-0002e860: 2020 2020 2062 6f6b 6568 2e70 6c6f 7474       bokeh.plott
-0002e870: 696e 672e 7368 6f77 2866 6967 290a 0a20  ing.show(fig).. 
-0002e880: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-0002e890: 670a 0a20 2020 2040 646f 6328 0a20 2020  g..    @doc(.   
-0002e8a0: 2020 2020 2073 756d 6d61 7279 3d22 2222       summary="""
-0002e8b0: 0a20 2020 2020 2020 2020 2020 2052 756e  .            Run
-0002e8c0: 2061 6e64 2070 6c6f 7420 6120 4673 7420   and plot a Fst 
-0002e8d0: 6765 6e6f 6d65 2d77 6964 6520 7363 616e  genome-wide scan
-0002e8e0: 2074 6f20 696e 7665 7374 6967 6174 6520   to investigate 
-0002e8f0: 6765 6e65 7469 630a 2020 2020 2020 2020  genetic.        
-0002e900: 2020 2020 6469 6666 6572 656e 7469 6174      differentiat
-0002e910: 696f 6e20 6265 7477 6565 6e20 7477 6f20  ion between two 
-0002e920: 636f 686f 7274 732e 0a20 2020 2020 2020  cohorts..       
-0002e930: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
-0002e940: 6465 6620 706c 6f74 5f66 7374 5f67 7773  def plot_fst_gws
-0002e950: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0002e960: 0a20 2020 2020 2020 2063 6f6e 7469 673a  .        contig:
-0002e970: 2062 6173 655f 7061 7261 6d73 2e63 6f6e   base_params.con
-0002e980: 7469 672c 0a20 2020 2020 2020 2077 696e  tig,.        win
-0002e990: 646f 775f 7369 7a65 3a20 6673 745f 7061  dow_size: fst_pa
-0002e9a0: 7261 6d73 2e77 696e 646f 775f 7369 7a65  rams.window_size
-0002e9b0: 2c0a 2020 2020 2020 2020 636f 686f 7274  ,.        cohort
-0002e9c0: 315f 7175 6572 793a 2062 6173 655f 7061  1_query: base_pa
-0002e9d0: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
-0002e9e0: 792c 0a20 2020 2020 2020 2063 6f68 6f72  y,.        cohor
-0002e9f0: 7432 5f71 7565 7279 3a20 6261 7365 5f70  t2_query: base_p
-0002ea00: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
-0002ea10: 7279 2c0a 2020 2020 2020 2020 7361 6d70  ry,.        samp
-0002ea20: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
-0002ea30: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-0002ea40: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
-0002ea50: 652c 0a20 2020 2020 2020 2073 6974 655f  e,.        site_
-0002ea60: 6d61 736b 3a20 6261 7365 5f70 6172 616d  mask: base_param
-0002ea70: 732e 7369 7465 5f6d 6173 6b20 3d20 4445  s.site_mask = DE
-0002ea80: 4641 554c 542c 0a20 2020 2020 2020 2063  FAULT,.        c
-0002ea90: 6f68 6f72 745f 7369 7a65 3a20 4f70 7469  ohort_size: Opti
-0002eaa0: 6f6e 616c 5b62 6173 655f 7061 7261 6d73  onal[base_params
-0002eab0: 2e63 6f68 6f72 745f 7369 7a65 5d20 3d20  .cohort_size] = 
-0002eac0: 6673 745f 7061 7261 6d73 2e63 6f68 6f72  fst_params.cohor
-0002ead0: 745f 7369 7a65 5f64 6566 6175 6c74 2c0a  t_size_default,.
-0002eae0: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
-0002eaf0: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-0002eb00: 6c5b 0a20 2020 2020 2020 2020 2020 2062  l[.            b
-0002eb10: 6173 655f 7061 7261 6d73 2e6d 696e 5f63  ase_params.min_c
-0002eb20: 6f68 6f72 745f 7369 7a65 0a20 2020 2020  ohort_size.     
-0002eb30: 2020 205d 203d 2066 7374 5f70 6172 616d     ] = fst_param
-0002eb40: 732e 6d69 6e5f 636f 686f 7274 5f73 697a  s.min_cohort_siz
-0002eb50: 655f 6465 6661 756c 742c 0a20 2020 2020  e_default,.     
-0002eb60: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
-0002eb70: 7a65 3a20 4f70 7469 6f6e 616c 5b0a 2020  ze: Optional[.  
-0002eb80: 2020 2020 2020 2020 2020 6261 7365 5f70            base_p
-0002eb90: 6172 616d 732e 6d61 785f 636f 686f 7274  arams.max_cohort
-0002eba0: 5f73 697a 650a 2020 2020 2020 2020 5d20  _size.        ] 
-0002ebb0: 3d20 6673 745f 7061 7261 6d73 2e6d 6178  = fst_params.max
-0002ebc0: 5f63 6f68 6f72 745f 7369 7a65 5f64 6566  _cohort_size_def
-0002ebd0: 6175 6c74 2c0a 2020 2020 2020 2020 7261  ault,.        ra
-0002ebe0: 6e64 6f6d 5f73 6565 643a 2062 6173 655f  ndom_seed: base_
-0002ebf0: 7061 7261 6d73 2e72 616e 646f 6d5f 7365  params.random_se
-0002ec00: 6564 203d 2034 322c 0a20 2020 2020 2020  ed = 42,.       
-0002ec10: 2074 6974 6c65 3a20 4f70 7469 6f6e 616c   title: Optional
-0002ec20: 5b67 706c 745f 7061 7261 6d73 2e74 6974  [gplt_params.tit
-0002ec30: 6c65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  le] = None,.    
-0002ec40: 2020 2020 7369 7a69 6e67 5f6d 6f64 653a      sizing_mode:
-0002ec50: 2067 706c 745f 7061 7261 6d73 2e73 697a   gplt_params.siz
-0002ec60: 696e 675f 6d6f 6465 203d 2067 706c 745f  ing_mode = gplt_
-0002ec70: 7061 7261 6d73 2e73 697a 696e 675f 6d6f  params.sizing_mo
-0002ec80: 6465 5f64 6566 6175 6c74 2c0a 2020 2020  de_default,.    
-0002ec90: 2020 2020 7769 6474 683a 2067 706c 745f      width: gplt_
-0002eca0: 7061 7261 6d73 2e77 6964 7468 203d 2067  params.width = g
-0002ecb0: 706c 745f 7061 7261 6d73 2e77 6964 7468  plt_params.width
-0002ecc0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-0002ecd0: 2020 7472 6163 6b5f 6865 6967 6874 3a20    track_height: 
-0002ece0: 6770 6c74 5f70 6172 616d 732e 7472 6163  gplt_params.trac
-0002ecf0: 6b5f 6865 6967 6874 203d 2031 3930 2c0a  k_height = 190,.
-0002ed00: 2020 2020 2020 2020 6765 6e65 735f 6865          genes_he
-0002ed10: 6967 6874 3a20 6770 6c74 5f70 6172 616d  ight: gplt_param
-0002ed20: 732e 6765 6e65 735f 6865 6967 6874 203d  s.genes_height =
-0002ed30: 2067 706c 745f 7061 7261 6d73 2e67 656e   gplt_params.gen
-0002ed40: 6573 5f68 6569 6768 745f 6465 6661 756c  es_height_defaul
-0002ed50: 742c 0a20 2020 2029 202d 3e20 4e6f 6e65  t,.    ) -> None
-0002ed60: 3a0a 2020 2020 2020 2020 2320 6777 7373  :.        # gwss
-0002ed70: 2074 7261 636b 0a20 2020 2020 2020 2066   track.        f
-0002ed80: 6967 3120 3d20 7365 6c66 2e70 6c6f 745f  ig1 = self.plot_
-0002ed90: 6673 745f 6777 7373 5f74 7261 636b 280a  fst_gwss_track(.
-0002eda0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0002edb0: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
-0002edc0: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
-0002edd0: 7a65 3d77 696e 646f 775f 7369 7a65 2c0a  ze=window_size,.
-0002ede0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
-0002edf0: 7274 315f 7175 6572 793d 636f 686f 7274  rt1_query=cohort
-0002ee00: 315f 7175 6572 792c 0a20 2020 2020 2020  1_query,.       
-0002ee10: 2020 2020 2063 6f68 6f72 7432 5f71 7565       cohort2_que
-0002ee20: 7279 3d63 6f68 6f72 7432 5f71 7565 7279  ry=cohort2_query
-0002ee30: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
-0002ee40: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
-0002ee50: 5f73 6574 732c 0a20 2020 2020 2020 2020  _sets,.         
-0002ee60: 2020 2073 6974 655f 6d61 736b 3d73 6974     site_mask=sit
-0002ee70: 655f 6d61 736b 2c0a 2020 2020 2020 2020  e_mask,.        
-0002ee80: 2020 2020 636f 686f 7274 5f73 697a 653d      cohort_size=
-0002ee90: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
-0002eea0: 2020 2020 2020 2020 206d 696e 5f63 6f68           min_coh
-0002eeb0: 6f72 745f 7369 7a65 3d6d 696e 5f63 6f68  ort_size=min_coh
-0002eec0: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
-0002eed0: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
-0002eee0: 5f73 697a 653d 6d61 785f 636f 686f 7274  _size=max_cohort
-0002eef0: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-0002ef00: 2020 2072 616e 646f 6d5f 7365 6564 3d72     random_seed=r
-0002ef10: 616e 646f 6d5f 7365 6564 2c0a 2020 2020  andom_seed,.    
-0002ef20: 2020 2020 2020 2020 7469 746c 653d 7469          title=ti
-0002ef30: 746c 652c 0a20 2020 2020 2020 2020 2020  tle,.           
-0002ef40: 2073 697a 696e 675f 6d6f 6465 3d73 697a   sizing_mode=siz
-0002ef50: 696e 675f 6d6f 6465 2c0a 2020 2020 2020  ing_mode,.      
-0002ef60: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
-0002ef70: 682c 0a20 2020 2020 2020 2020 2020 2068  h,.            h
-0002ef80: 6569 6768 743d 7472 6163 6b5f 6865 6967  eight=track_heig
-0002ef90: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
-0002efa0: 7368 6f77 3d46 616c 7365 2c0a 2020 2020  show=False,.    
-0002efb0: 2020 2020 290a 0a20 2020 2020 2020 2066      )..        f
-0002efc0: 6967 312e 7861 7869 732e 7669 7369 626c  ig1.xaxis.visibl
-0002efd0: 6520 3d20 4661 6c73 650a 0a20 2020 2020  e = False..     
-0002efe0: 2020 2023 2070 6c6f 7420 6765 6e65 730a     # plot genes.
-0002eff0: 2020 2020 2020 2020 6669 6732 203d 2073          fig2 = s
-0002f000: 656c 662e 706c 6f74 5f67 656e 6573 280a  elf.plot_genes(.
-0002f010: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-0002f020: 6f6e 3d63 6f6e 7469 672c 0a20 2020 2020  on=contig,.     
-0002f030: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
-0002f040: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
-0002f050: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-0002f060: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
-0002f070: 2020 2020 2068 6569 6768 743d 6765 6e65       height=gene
-0002f080: 735f 6865 6967 6874 2c0a 2020 2020 2020  s_height,.      
-0002f090: 2020 2020 2020 785f 7261 6e67 653d 6669        x_range=fi
-0002f0a0: 6731 2e78 5f72 616e 6765 2c0a 2020 2020  g1.x_range,.    
-0002f0b0: 2020 2020 2020 2020 7368 6f77 3d46 616c          show=Fal
-0002f0c0: 7365 2c0a 2020 2020 2020 2020 290a 0a20  se,.        ).. 
-0002f0d0: 2020 2020 2020 2023 2063 6f6d 6269 6e65         # combine
-0002f0e0: 2070 6c6f 7473 2069 6e74 6f20 6120 7369   plots into a si
-0002f0f0: 6e67 6c65 2066 6967 7572 650a 2020 2020  ngle figure.    
-0002f100: 2020 2020 6669 6720 3d20 626f 6b65 682e      fig = bokeh.
-0002f110: 6c61 796f 7574 732e 6772 6964 706c 6f74  layouts.gridplot
-0002f120: 280a 2020 2020 2020 2020 2020 2020 5b66  (.            [f
-0002f130: 6967 312c 2066 6967 325d 2c0a 2020 2020  ig1, fig2],.    
-0002f140: 2020 2020 2020 2020 6e63 6f6c 733d 312c          ncols=1,
-0002f150: 0a20 2020 2020 2020 2020 2020 2074 6f6f  .            too
-0002f160: 6c62 6172 5f6c 6f63 6174 696f 6e3d 2261  lbar_location="a
-0002f170: 626f 7665 222c 0a20 2020 2020 2020 2020  bove",.         
-0002f180: 2020 206d 6572 6765 5f74 6f6f 6c73 3d54     merge_tools=T
-0002f190: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-0002f1a0: 2073 697a 696e 675f 6d6f 6465 3d73 697a   sizing_mode=siz
-0002f1b0: 696e 675f 6d6f 6465 2c0a 2020 2020 2020  ing_mode,.      
-0002f1c0: 2020 290a 0a20 2020 2020 2020 2062 6f6b    )..        bok
-0002f1d0: 6568 2e70 6c6f 7474 696e 672e 7368 6f77  eh.plotting.show
-0002f1e0: 2866 6967 290a 0a20 2020 2040 646f 6328  (fig)..    @doc(
-0002f1f0: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-0002f200: 3d22 4f70 656e 2068 6170 6c6f 7479 7065  ="Open haplotype
-0002f210: 7320 7a61 7272 2e22 2c0a 2020 2020 2020  s zarr.",.      
-0002f220: 2020 7265 7475 726e 733d 225a 6172 7220    returns="Zarr 
-0002f230: 6869 6572 6172 6368 792e 222c 0a20 2020  hierarchy.",.   
-0002f240: 2029 0a20 2020 2064 6566 206f 7065 6e5f   ).    def open_
-0002f250: 6861 706c 6f74 7970 6573 280a 2020 2020  haplotypes(.    
-0002f260: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0002f270: 2020 7361 6d70 6c65 5f73 6574 3a20 6261    sample_set: ba
-0002f280: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
-0002f290: 5f73 6574 2c0a 2020 2020 2020 2020 616e  _set,.        an
-0002f2a0: 616c 7973 6973 3a20 6861 705f 7061 7261  alysis: hap_para
-0002f2b0: 6d73 2e61 6e61 6c79 7369 7320 3d20 4445  ms.analysis = DE
-0002f2c0: 4641 554c 542c 0a20 2020 2029 202d 3e20  FAULT,.    ) -> 
-0002f2d0: 7a61 7272 2e68 6965 7261 7263 6879 2e47  zarr.hierarchy.G
-0002f2e0: 726f 7570 3a0a 2020 2020 2020 2020 616e  roup:.        an
-0002f2f0: 616c 7973 6973 203d 2073 656c 662e 5f70  alysis = self._p
-0002f300: 7265 705f 7068 6173 696e 675f 616e 616c  rep_phasing_anal
-0002f310: 7973 6973 5f70 6172 616d 2861 6e61 6c79  ysis_param(analy
-0002f320: 7369 733d 616e 616c 7973 6973 290a 2020  sis=analysis).  
-0002f330: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0002f340: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0002f350: 6c66 2e5f 6361 6368 655f 6861 706c 6f74  lf._cache_haplot
-0002f360: 7970 6573 5b28 7361 6d70 6c65 5f73 6574  ypes[(sample_set
-0002f370: 2c20 616e 616c 7973 6973 295d 0a20 2020  , analysis)].   
-0002f380: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-0002f390: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0002f3a0: 2020 7265 6c65 6173 6520 3d20 7365 6c66    release = self
-0002f3b0: 2e6c 6f6f 6b75 705f 7265 6c65 6173 6528  .lookup_release(
-0002f3c0: 7361 6d70 6c65 5f73 6574 3d73 616d 706c  sample_set=sampl
-0002f3d0: 655f 7365 7429 0a20 2020 2020 2020 2020  e_set).         
-0002f3e0: 2020 2072 656c 6561 7365 5f70 6174 6820     release_path 
-0002f3f0: 3d20 7365 6c66 2e5f 7265 6c65 6173 655f  = self._release_
-0002f400: 746f 5f70 6174 6828 7265 6c65 6173 6529  to_path(release)
-0002f410: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0002f420: 6820 3d20 6622 7b73 656c 662e 5f62 6173  h = f"{self._bas
-0002f430: 655f 7061 7468 7d2f 7b72 656c 6561 7365  e_path}/{release
-0002f440: 5f70 6174 687d 2f73 6e70 5f68 6170 6c6f  _path}/snp_haplo
-0002f450: 7479 7065 732f 7b73 616d 706c 655f 7365  types/{sample_se
-0002f460: 747d 2f7b 616e 616c 7973 6973 7d2f 7a61  t}/{analysis}/za
-0002f470: 7272 220a 2020 2020 2020 2020 2020 2020  rr".            
-0002f480: 7374 6f72 6520 3d20 696e 6974 5f7a 6172  store = init_zar
-0002f490: 725f 7374 6f72 6528 6673 3d73 656c 662e  r_store(fs=self.
-0002f4a0: 5f66 732c 2070 6174 683d 7061 7468 290a  _fs, path=path).
-0002f4b0: 2020 2020 2020 2020 2020 2020 2320 736f              # so
-0002f4c0: 6d65 2073 616d 706c 6520 7365 7473 2068  me sample sets h
-0002f4d0: 6176 6520 6e6f 2064 6174 6120 666f 7220  ave no data for 
-0002f4e0: 6120 6769 7665 6e20 616e 616c 7973 6973  a given analysis
-0002f4f0: 2c20 6861 6e64 6c65 2074 6869 730a 2020  , handle this.  
-0002f500: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0002f510: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002f520: 6f6f 7420 3d20 7a61 7272 2e6f 7065 6e5f  oot = zarr.open_
-0002f530: 636f 6e73 6f6c 6964 6174 6564 2873 746f  consolidated(sto
-0002f540: 7265 3d73 746f 7265 290a 2020 2020 2020  re=store).      
-0002f550: 2020 2020 2020 6578 6365 7074 2046 696c        except Fil
-0002f560: 654e 6f74 466f 756e 6445 7272 6f72 3a0a  eNotFoundError:.
-0002f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f580: 726f 6f74 203d 204e 6f6e 650a 2020 2020  root = None.    
-0002f590: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
-0002f5a0: 6368 655f 6861 706c 6f74 7970 6573 5b28  che_haplotypes[(
-0002f5b0: 7361 6d70 6c65 5f73 6574 2c20 616e 616c  sample_set, anal
-0002f5c0: 7973 6973 295d 203d 2072 6f6f 740a 2020  ysis)] = root.  
-0002f5d0: 2020 2020 2020 7265 7475 726e 2072 6f6f        return roo
-0002f5e0: 740a 0a20 2020 2040 646f 6328 0a20 2020  t..    @doc(.   
-0002f5f0: 2020 2020 2073 756d 6d61 7279 3d22 4f70       summary="Op
-0002f600: 656e 2068 6170 6c6f 7479 7065 2073 6974  en haplotype sit
-0002f610: 6573 207a 6172 722e 222c 0a20 2020 2020  es zarr.",.     
-0002f620: 2020 2072 6574 7572 6e73 3d22 5a61 7272     returns="Zarr
-0002f630: 2068 6965 7261 7263 6879 2e22 2c0a 2020   hierarchy.",.  
-0002f640: 2020 290a 2020 2020 6465 6620 6f70 656e    ).    def open
-0002f650: 5f68 6170 6c6f 7479 7065 5f73 6974 6573  _haplotype_sites
-0002f660: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-0002f670: 616e 616c 7973 6973 3a20 6861 705f 7061  analysis: hap_pa
-0002f680: 7261 6d73 2e61 6e61 6c79 7369 7320 3d20  rams.analysis = 
-0002f690: 4445 4641 554c 540a 2020 2020 2920 2d3e  DEFAULT.    ) ->
-0002f6a0: 207a 6172 722e 6869 6572 6172 6368 792e   zarr.hierarchy.
-0002f6b0: 4772 6f75 703a 0a20 2020 2020 2020 2061  Group:.        a
-0002f6c0: 6e61 6c79 7369 7320 3d20 7365 6c66 2e5f  nalysis = self._
-0002f6d0: 7072 6570 5f70 6861 7369 6e67 5f61 6e61  prep_phasing_ana
-0002f6e0: 6c79 7369 735f 7061 7261 6d28 616e 616c  lysis_param(anal
-0002f6f0: 7973 6973 3d61 6e61 6c79 7369 7329 0a20  ysis=analysis). 
-0002f700: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0002f710: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0002f720: 656c 662e 5f63 6163 6865 5f68 6170 6c6f  elf._cache_haplo
-0002f730: 7479 7065 5f73 6974 6573 5b61 6e61 6c79  type_sites[analy
-0002f740: 7369 735d 0a20 2020 2020 2020 2065 7863  sis].        exc
-0002f750: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
-0002f760: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-0002f770: 2066 227b 7365 6c66 2e5f 6261 7365 5f70   f"{self._base_p
-0002f780: 6174 687d 2f7b 7365 6c66 2e5f 6d61 6a6f  ath}/{self._majo
-0002f790: 725f 7665 7273 696f 6e5f 7061 7468 7d2f  r_version_path}/
-0002f7a0: 736e 705f 6861 706c 6f74 7970 6573 2f73  snp_haplotypes/s
-0002f7b0: 6974 6573 2f7b 616e 616c 7973 6973 7d2f  ites/{analysis}/
-0002f7c0: 7a61 7272 220a 2020 2020 2020 2020 2020  zarr".          
-0002f7d0: 2020 7374 6f72 6520 3d20 696e 6974 5f7a    store = init_z
-0002f7e0: 6172 725f 7374 6f72 6528 6673 3d73 656c  arr_store(fs=sel
-0002f7f0: 662e 5f66 732c 2070 6174 683d 7061 7468  f._fs, path=path
-0002f800: 290a 2020 2020 2020 2020 2020 2020 726f  ).            ro
-0002f810: 6f74 203d 207a 6172 722e 6f70 656e 5f63  ot = zarr.open_c
-0002f820: 6f6e 736f 6c69 6461 7465 6428 7374 6f72  onsolidated(stor
-0002f830: 653d 7374 6f72 6529 0a20 2020 2020 2020  e=store).       
-0002f840: 2020 2020 2073 656c 662e 5f63 6163 6865       self._cache
-0002f850: 5f68 6170 6c6f 7479 7065 5f73 6974 6573  _haplotype_sites
-0002f860: 5b61 6e61 6c79 7369 735d 203d 2072 6f6f  [analysis] = roo
-0002f870: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
-0002f880: 2072 6f6f 740a 0a20 2020 2064 6566 205f   root..    def _
-0002f890: 6861 706c 6f74 7970 655f 7369 7465 735f  haplotype_sites_
-0002f8a0: 666f 725f 636f 6e74 6967 280a 2020 2020  for_contig(.    
-0002f8b0: 2020 2020 7365 6c66 2c20 2a2c 2063 6f6e      self, *, con
-0002f8c0: 7469 672c 2061 6e61 6c79 7369 732c 2066  tig, analysis, f
-0002f8d0: 6965 6c64 2c20 696e 6c69 6e65 5f61 7272  ield, inline_arr
-0002f8e0: 6179 2c20 6368 756e 6b73 0a20 2020 2029  ay, chunks.    )
-0002f8f0: 3a0a 2020 2020 2020 2020 7369 7465 7320  :.        sites 
-0002f900: 3d20 7365 6c66 2e6f 7065 6e5f 6861 706c  = self.open_hapl
-0002f910: 6f74 7970 655f 7369 7465 7328 616e 616c  otype_sites(anal
-0002f920: 7973 6973 3d61 6e61 6c79 7369 7329 0a20  ysis=analysis). 
-0002f930: 2020 2020 2020 2061 7272 203d 2073 6974         arr = sit
-0002f940: 6573 5b66 227b 636f 6e74 6967 7d2f 7661  es[f"{contig}/va
-0002f950: 7269 616e 7473 2f7b 6669 656c 647d 225d  riants/{field}"]
-0002f960: 0a20 2020 2020 2020 2061 7272 203d 2064  .        arr = d
-0002f970: 615f 6672 6f6d 5f7a 6172 7228 6172 722c  a_from_zarr(arr,
-0002f980: 2069 6e6c 696e 655f 6172 7261 793d 696e   inline_array=in
-0002f990: 6c69 6e65 5f61 7272 6179 2c20 6368 756e  line_array, chun
-0002f9a0: 6b73 3d63 6875 6e6b 7329 0a20 2020 2020  ks=chunks).     
-0002f9b0: 2020 2072 6574 7572 6e20 6172 720a 0a20     return arr.. 
-0002f9c0: 2020 2064 6566 205f 6861 706c 6f74 7970     def _haplotyp
-0002f9d0: 6573 5f66 6f72 5f63 6f6e 7469 6728 0a20  es_for_contig(. 
-0002f9e0: 2020 2020 2020 2073 656c 662c 202a 2c20         self, *, 
-0002f9f0: 636f 6e74 6967 2c20 7361 6d70 6c65 5f73  contig, sample_s
-0002fa00: 6574 2c20 616e 616c 7973 6973 2c20 696e  et, analysis, in
-0002fa10: 6c69 6e65 5f61 7272 6179 2c20 6368 756e  line_array, chun
-0002fa20: 6b73 0a20 2020 2029 3a0a 2020 2020 2020  ks.    ):.      
-0002fa30: 2020 6465 6275 6720 3d20 7365 6c66 2e5f    debug = self._
-0002fa40: 6c6f 672e 6465 6275 670a 0a20 2020 2020  log.debug..     
-0002fa50: 2020 2064 6562 7567 2822 6f70 656e 207a     debug("open z
-0002fa60: 6172 7222 290a 2020 2020 2020 2020 726f  arr").        ro
-0002fa70: 6f74 203d 2073 656c 662e 6f70 656e 5f68  ot = self.open_h
-0002fa80: 6170 6c6f 7479 7065 7328 7361 6d70 6c65  aplotypes(sample
-0002fa90: 5f73 6574 3d73 616d 706c 655f 7365 742c  _set=sample_set,
-0002faa0: 2061 6e61 6c79 7369 733d 616e 616c 7973   analysis=analys
-0002fab0: 6973 290a 2020 2020 2020 2020 7369 7465  is).        site
-0002fac0: 7320 3d20 7365 6c66 2e6f 7065 6e5f 6861  s = self.open_ha
-0002fad0: 706c 6f74 7970 655f 7369 7465 7328 616e  plotype_sites(an
-0002fae0: 616c 7973 6973 3d61 6e61 6c79 7369 7329  alysis=analysis)
-0002faf0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-0002fb00: 2276 6172 6961 6e74 5f70 6f73 6974 696f  "variant_positio
-0002fb10: 6e22 290a 2020 2020 2020 2020 706f 7320  n").        pos 
-0002fb20: 3d20 7369 7465 735b 6622 7b63 6f6e 7469  = sites[f"{conti
-0002fb30: 677d 2f76 6172 6961 6e74 732f 504f 5322  g}/variants/POS"
-0002fb40: 5d0a 0a20 2020 2020 2020 2023 2073 6f6d  ]..        # som
-0002fb50: 6520 7361 6d70 6c65 2073 6574 7320 6861  e sample sets ha
-0002fb60: 7665 206e 6f20 6461 7461 2066 6f72 2061  ve no data for a
-0002fb70: 2067 6976 656e 2061 6e61 6c79 7369 732c   given analysis,
-0002fb80: 2068 616e 646c 6520 7468 6973 0a20 2020   handle this.   
-0002fb90: 2020 2020 2023 2054 4f44 4f20 636f 6e73       # TODO cons
-0002fba0: 6964 6572 2072 6574 7572 6e69 6e67 2061  ider returning a
-0002fbb0: 2064 6174 6173 6574 2077 6974 6820 3020   dataset with 0 
-0002fbc0: 6c65 6e67 7468 2073 616d 706c 6573 2064  length samples d
-0002fbd0: 696d 656e 7369 6f6e 2069 6e73 7465 6164  imension instead
-0002fbe0: 2c20 776f 756c 640a 2020 2020 2020 2020  , would.        
-0002fbf0: 2320 7072 6f62 6162 6c79 2073 696d 706c  # probably simpl
-0002fc00: 6966 7920 6120 6c6f 7420 6f66 206f 7468  ify a lot of oth
-0002fc10: 6572 206c 6f67 6963 0a20 2020 2020 2020  er logic.       
-0002fc20: 2069 6620 726f 6f74 2069 7320 4e6f 6e65   if root is None
-0002fc30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0002fc40: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
-0002fc50: 2020 2063 6f6f 7264 7320 3d20 6469 6374     coords = dict
-0002fc60: 2829 0a20 2020 2020 2020 2064 6174 615f  ().        data_
-0002fc70: 7661 7273 203d 2064 6963 7428 290a 0a20  vars = dict().. 
-0002fc80: 2020 2020 2020 2063 6f6f 7264 735b 2276         coords["v
-0002fc90: 6172 6961 6e74 5f70 6f73 6974 696f 6e22  ariant_position"
-0002fca0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0002fcb0: 2020 5b44 494d 5f56 4152 4941 4e54 5d2c    [DIM_VARIANT],
-0002fcc0: 0a20 2020 2020 2020 2020 2020 2064 615f  .            da_
-0002fcd0: 6672 6f6d 5f7a 6172 7228 706f 732c 2069  from_zarr(pos, i
-0002fce0: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
-0002fcf0: 6e65 5f61 7272 6179 2c20 6368 756e 6b73  ne_array, chunks
-0002fd00: 3d63 6875 6e6b 7329 2c0a 2020 2020 2020  =chunks),.      
-0002fd10: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
-0002fd20: 7567 2822 7661 7269 616e 745f 636f 6e74  ug("variant_cont
-0002fd30: 6967 2229 0a20 2020 2020 2020 2063 6f6e  ig").        con
-0002fd40: 7469 675f 696e 6465 7820 3d20 7365 6c66  tig_index = self
-0002fd50: 2e63 6f6e 7469 6773 2e69 6e64 6578 2863  .contigs.index(c
-0002fd60: 6f6e 7469 6729 0a20 2020 2020 2020 2063  ontig).        c
-0002fd70: 6f6f 7264 735b 2276 6172 6961 6e74 5f63  oords["variant_c
-0002fd80: 6f6e 7469 6722 5d20 3d20 280a 2020 2020  ontig"] = (.    
-0002fd90: 2020 2020 2020 2020 5b44 494d 5f56 4152          [DIM_VAR
-0002fda0: 4941 4e54 5d2c 0a20 2020 2020 2020 2020  IANT],.         
-0002fdb0: 2020 2064 612e 6675 6c6c 5f6c 696b 6528     da.full_like(
-0002fdc0: 706f 732c 2066 696c 6c5f 7661 6c75 653d  pos, fill_value=
-0002fdd0: 636f 6e74 6967 5f69 6e64 6578 2c20 6474  contig_index, dt
-0002fde0: 7970 653d 2275 3122 292c 0a20 2020 2020  ype="u1"),.     
-0002fdf0: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-0002fe00: 6275 6728 2276 6172 6961 6e74 5f61 6c6c  bug("variant_all
-0002fe10: 656c 6522 290a 2020 2020 2020 2020 7265  ele").        re
-0002fe20: 6620 3d20 6461 5f66 726f 6d5f 7a61 7272  f = da_from_zarr
-0002fe30: 280a 2020 2020 2020 2020 2020 2020 7369  (.            si
-0002fe40: 7465 735b 6622 7b63 6f6e 7469 677d 2f76  tes[f"{contig}/v
-0002fe50: 6172 6961 6e74 732f 5245 4622 5d2c 2069  ariants/REF"], i
-0002fe60: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
-0002fe70: 6e65 5f61 7272 6179 2c20 6368 756e 6b73  ne_array, chunks
-0002fe80: 3d63 6875 6e6b 730a 2020 2020 2020 2020  =chunks.        
-0002fe90: 290a 2020 2020 2020 2020 616c 7420 3d20  ).        alt = 
-0002fea0: 6461 5f66 726f 6d5f 7a61 7272 280a 2020  da_from_zarr(.  
-0002feb0: 2020 2020 2020 2020 2020 7369 7465 735b            sites[
-0002fec0: 6622 7b63 6f6e 7469 677d 2f76 6172 6961  f"{contig}/varia
-0002fed0: 6e74 732f 414c 5422 5d2c 2069 6e6c 696e  nts/ALT"], inlin
-0002fee0: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
-0002fef0: 7272 6179 2c20 6368 756e 6b73 3d63 6875  rray, chunks=chu
-0002ff00: 6e6b 730a 2020 2020 2020 2020 290a 2020  nks.        ).  
-0002ff10: 2020 2020 2020 7661 7269 616e 745f 616c        variant_al
-0002ff20: 6c65 6c65 203d 2064 612e 6873 7461 636b  lele = da.hstack
-0002ff30: 285b 7265 665b 3a2c 204e 6f6e 655d 2c20  ([ref[:, None], 
-0002ff40: 616c 745b 3a2c 204e 6f6e 655d 5d29 0a20  alt[:, None]]). 
-0002ff50: 2020 2020 2020 2064 6174 615f 7661 7273         data_vars
-0002ff60: 5b22 7661 7269 616e 745f 616c 6c65 6c65  ["variant_allele
-0002ff70: 225d 203d 205b 4449 4d5f 5641 5249 414e  "] = [DIM_VARIAN
-0002ff80: 542c 2044 494d 5f41 4c4c 454c 455d 2c20  T, DIM_ALLELE], 
-0002ff90: 7661 7269 616e 745f 616c 6c65 6c65 0a0a  variant_allele..
-0002ffa0: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
-0002ffb0: 616c 6c5f 6765 6e6f 7479 7065 2229 0a20  all_genotype"). 
-0002ffc0: 2020 2020 2020 2064 6174 615f 7661 7273         data_vars
-0002ffd0: 5b22 6361 6c6c 5f67 656e 6f74 7970 6522  ["call_genotype"
-0002ffe0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0002fff0: 2020 5b44 494d 5f56 4152 4941 4e54 2c20    [DIM_VARIANT, 
-00030000: 4449 4d5f 5341 4d50 4c45 2c20 4449 4d5f  DIM_SAMPLE, DIM_
-00030010: 504c 4f49 4459 5d2c 0a20 2020 2020 2020  PLOIDY],.       
-00030020: 2020 2020 2064 615f 6672 6f6d 5f7a 6172       da_from_zar
-00030030: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00030040: 2020 2072 6f6f 745b 6622 7b63 6f6e 7469     root[f"{conti
-00030050: 677d 2f63 616c 6c64 6174 612f 4754 225d  g}/calldata/GT"]
-00030060: 2c20 696e 6c69 6e65 5f61 7272 6179 3d69  , inline_array=i
-00030070: 6e6c 696e 655f 6172 7261 792c 2063 6875  nline_array, chu
-00030080: 6e6b 733d 6368 756e 6b73 0a20 2020 2020  nks=chunks.     
-00030090: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-000300a0: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
-000300b0: 7567 2822 7361 6d70 6c65 2061 7272 6179  ug("sample array
-000300c0: 7322 290a 2020 2020 2020 2020 636f 6f72  s").        coor
-000300d0: 6473 5b22 7361 6d70 6c65 5f69 6422 5d20  ds["sample_id"] 
-000300e0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000300f0: 5b44 494d 5f53 414d 504c 455d 2c0a 2020  [DIM_SAMPLE],.  
-00030100: 2020 2020 2020 2020 2020 6461 5f66 726f            da_fro
-00030110: 6d5f 7a61 7272 2872 6f6f 745b 2273 616d  m_zarr(root["sam
-00030120: 706c 6573 225d 2c20 696e 6c69 6e65 5f61  ples"], inline_a
-00030130: 7272 6179 3d69 6e6c 696e 655f 6172 7261  rray=inline_arra
-00030140: 792c 2063 6875 6e6b 733d 6368 756e 6b73  y, chunks=chunks
-00030150: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00030160: 2020 2020 2020 6465 6275 6728 2273 6574        debug("set
-00030170: 2075 7020 6174 7472 6962 7574 6573 2229   up attributes")
-00030180: 0a20 2020 2020 2020 2061 7474 7273 203d  .        attrs =
-00030190: 207b 2263 6f6e 7469 6773 223a 2073 656c   {"contigs": sel
-000301a0: 662e 636f 6e74 6967 737d 0a0a 2020 2020  f.contigs}..    
-000301b0: 2020 2020 6465 6275 6728 2263 7265 6174      debug("creat
-000301c0: 6520 6120 6461 7461 7365 7422 290a 2020  e a dataset").  
-000301d0: 2020 2020 2020 6473 203d 2078 722e 4461        ds = xr.Da
-000301e0: 7461 7365 7428 6461 7461 5f76 6172 733d  taset(data_vars=
-000301f0: 6461 7461 5f76 6172 732c 2063 6f6f 7264  data_vars, coord
-00030200: 733d 636f 6f72 6473 2c20 6174 7472 733d  s=coords, attrs=
-00030210: 6174 7472 7329 0a0a 2020 2020 2020 2020  attrs)..        
-00030220: 7265 7475 726e 2064 730a 0a20 2020 2040  return ds..    @
-00030230: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-00030240: 6d61 7279 3d22 4163 6365 7373 2068 6170  mary="Access hap
-00030250: 6c6f 7479 7065 2064 6174 612e 222c 0a20  lotype data.",. 
-00030260: 2020 2020 2020 2072 6574 7572 6e73 3d22         returns="
-00030270: 4120 6461 7461 7365 7420 6f66 2068 6170  A dataset of hap
-00030280: 6c6f 7479 7065 7320 616e 6420 6173 736f  lotypes and asso
-00030290: 6369 6174 6564 2064 6174 612e 222c 0a20  ciated data.",. 
-000302a0: 2020 2029 0a20 2020 2064 6566 2068 6170     ).    def hap
-000302b0: 6c6f 7479 7065 7328 0a20 2020 2020 2020  lotypes(.       
-000302c0: 2073 656c 662c 0a20 2020 2020 2020 2072   self,.        r
-000302d0: 6567 696f 6e3a 2062 6173 655f 7061 7261  egion: base_para
-000302e0: 6d73 2e72 6567 696f 6e2c 0a20 2020 2020  ms.region,.     
-000302f0: 2020 2061 6e61 6c79 7369 733a 2068 6170     analysis: hap
-00030300: 5f70 6172 616d 732e 616e 616c 7973 6973  _params.analysis
-00030310: 203d 2044 4546 4155 4c54 2c0a 2020 2020   = DEFAULT,.    
-00030320: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
-00030330: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00030340: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
-00030350: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-00030360: 2020 2073 616d 706c 655f 7175 6572 793a     sample_query:
-00030370: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-00030380: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
-00030390: 7279 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ry] = None,.    
-000303a0: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
-000303b0: 3a20 6261 7365 5f70 6172 616d 732e 696e  : base_params.in
-000303c0: 6c69 6e65 5f61 7272 6179 203d 2062 6173  line_array = bas
-000303d0: 655f 7061 7261 6d73 2e69 6e6c 696e 655f  e_params.inline_
-000303e0: 6172 7261 795f 6465 6661 756c 742c 0a20  array_default,. 
-000303f0: 2020 2020 2020 2063 6875 6e6b 733a 2062         chunks: b
-00030400: 6173 655f 7061 7261 6d73 2e63 6875 6e6b  ase_params.chunk
-00030410: 7320 3d20 6261 7365 5f70 6172 616d 732e  s = base_params.
-00030420: 6368 756e 6b73 5f64 6566 6175 6c74 2c0a  chunks_default,.
-00030430: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
-00030440: 697a 653a 204f 7074 696f 6e61 6c5b 6261  ize: Optional[ba
-00030450: 7365 5f70 6172 616d 732e 636f 686f 7274  se_params.cohort
-00030460: 5f73 697a 655d 203d 204e 6f6e 652c 0a20  _size] = None,. 
-00030470: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
-00030480: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
-00030490: 5b62 6173 655f 7061 7261 6d73 2e6d 696e  [base_params.min
-000304a0: 5f63 6f68 6f72 745f 7369 7a65 5d20 3d20  _cohort_size] = 
-000304b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d61  None,.        ma
-000304c0: 785f 636f 686f 7274 5f73 697a 653a 204f  x_cohort_size: O
-000304d0: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-000304e0: 616d 732e 6d61 785f 636f 686f 7274 5f73  ams.max_cohort_s
-000304f0: 697a 655d 203d 204e 6f6e 652c 0a20 2020  ize] = None,.   
-00030500: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-00030510: 3a20 6261 7365 5f70 6172 616d 732e 7261  : base_params.ra
-00030520: 6e64 6f6d 5f73 6565 6420 3d20 3432 2c0a  ndom_seed = 42,.
-00030530: 2020 2020 2920 2d3e 204f 7074 696f 6e61      ) -> Optiona
-00030540: 6c5b 7872 2e44 6174 6173 6574 5d3a 0a20  l[xr.Dataset]:. 
-00030550: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
-00030560: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
-00030570: 2020 2020 2020 2020 6465 6275 6728 226e          debug("n
-00030580: 6f72 6d61 6c69 7365 2070 6172 616d 6574  ormalise paramet
-00030590: 6572 7322 290a 2020 2020 2020 2020 7361  ers").        sa
-000305a0: 6d70 6c65 5f73 6574 7320 3d20 7365 6c66  mple_sets = self
-000305b0: 2e5f 7072 6570 5f73 616d 706c 655f 7365  ._prep_sample_se
-000305c0: 7473 5f70 6172 616d 2873 616d 706c 655f  ts_param(sample_
-000305d0: 7365 7473 3d73 616d 706c 655f 7365 7473  sets=sample_sets
-000305e0: 290a 2020 2020 2020 2020 7265 736f 6c76  ).        resolv
-000305f0: 6564 5f72 6567 696f 6e20 3d20 7365 6c66  ed_region = self
-00030600: 2e72 6573 6f6c 7665 5f72 6567 696f 6e28  .resolve_region(
-00030610: 7265 6769 6f6e 290a 2020 2020 2020 2020  region).        
-00030620: 6465 6c20 7265 6769 6f6e 0a0a 2020 2020  del region..    
-00030630: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00030640: 6528 7265 736f 6c76 6564 5f72 6567 696f  e(resolved_regio
-00030650: 6e2c 2052 6567 696f 6e29 3a0a 2020 2020  n, Region):.    
-00030660: 2020 2020 2020 2020 7265 736f 6c76 6564          resolved
-00030670: 5f72 6567 696f 6e20 3d20 5b72 6573 6f6c  _region = [resol
-00030680: 7665 645f 7265 6769 6f6e 5d0a 2020 2020  ved_region].    
-00030690: 2020 2020 616e 616c 7973 6973 203d 2073      analysis = s
-000306a0: 656c 662e 5f70 7265 705f 7068 6173 696e  elf._prep_phasin
-000306b0: 675f 616e 616c 7973 6973 5f70 6172 616d  g_analysis_param
-000306c0: 2861 6e61 6c79 7369 733d 616e 616c 7973  (analysis=analys
-000306d0: 6973 290a 0a20 2020 2020 2020 2064 6562  is)..        deb
-000306e0: 7567 2822 6275 696c 6420 6461 7461 7365  ug("build datase
-000306f0: 7422 290a 2020 2020 2020 2020 6c78 203d  t").        lx =
-00030700: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-00030710: 7220 696e 2072 6573 6f6c 7665 645f 7265  r in resolved_re
-00030720: 6769 6f6e 3a0a 2020 2020 2020 2020 2020  gion:.          
-00030730: 2020 6c79 203d 205b 5d0a 0a20 2020 2020    ly = []..     
-00030740: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
-00030750: 7361 6d70 6c65 5f73 6574 733a 0a20 2020  sample_sets:.   
-00030760: 2020 2020 2020 2020 2020 2020 2079 203d               y =
-00030770: 2073 656c 662e 5f68 6170 6c6f 7479 7065   self._haplotype
-00030780: 735f 666f 725f 636f 6e74 6967 280a 2020  s_for_contig(.  
-00030790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000307a0: 2020 636f 6e74 6967 3d72 2e63 6f6e 7469    contig=r.conti
-000307b0: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
-000307c0: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-000307d0: 743d 732c 0a20 2020 2020 2020 2020 2020  t=s,.           
-000307e0: 2020 2020 2020 2020 2061 6e61 6c79 7369           analysi
-000307f0: 733d 616e 616c 7973 6973 2c0a 2020 2020  s=analysis,.    
-00030800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030810: 696e 6c69 6e65 5f61 7272 6179 3d69 6e6c  inline_array=inl
-00030820: 696e 655f 6172 7261 792c 0a20 2020 2020  ine_array,.     
-00030830: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00030840: 6875 6e6b 733d 6368 756e 6b73 2c0a 2020  hunks=chunks,.  
-00030850: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00030860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030870: 6966 2079 2069 7320 6e6f 7420 4e6f 6e65  if y is not None
-00030880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00030890: 2020 2020 2020 6c79 2e61 7070 656e 6428        ly.append(
-000308a0: 7929 0a0a 2020 2020 2020 2020 2020 2020  y)..            
-000308b0: 6966 206c 656e 286c 7929 203d 3d20 303a  if len(ly) == 0:
-000308c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000308d0: 2064 6562 7567 2822 6561 726c 7920 6f75   debug("early ou
-000308e0: 742c 206e 6f20 6461 7461 2066 6f72 2067  t, no data for g
-000308f0: 6976 656e 2073 616d 706c 6520 7365 7473  iven sample sets
-00030900: 2061 6e64 2061 6e61 6c79 7369 7322 290a   and analysis").
-00030910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030920: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-00030930: 2020 2020 2020 2020 2064 6562 7567 2822           debug("
-00030940: 636f 6e63 6174 656e 6174 6520 6461 7461  concatenate data
-00030950: 2066 726f 6d20 6d75 6c74 6970 6c65 2073   from multiple s
-00030960: 616d 706c 6520 7365 7473 2229 0a20 2020  ample sets").   
-00030970: 2020 2020 2020 2020 2078 203d 2078 6172           x = xar
-00030980: 7261 795f 636f 6e63 6174 286c 792c 2064  ray_concat(ly, d
-00030990: 696d 3d44 494d 5f53 414d 504c 4529 0a0a  im=DIM_SAMPLE)..
-000309a0: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-000309b0: 6728 2268 616e 646c 6520 7265 6769 6f6e  g("handle region
-000309c0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-000309d0: 6620 722e 7374 6172 7420 6f72 2072 2e65  f r.start or r.e
-000309e0: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-000309f0: 2020 2020 706f 7320 3d20 785b 2276 6172      pos = x["var
-00030a00: 6961 6e74 5f70 6f73 6974 696f 6e22 5d2e  iant_position"].
-00030a10: 7661 6c75 6573 0a20 2020 2020 2020 2020  values.         
-00030a20: 2020 2020 2020 206c 6f63 5f72 6567 696f         loc_regio
-00030a30: 6e20 3d20 6c6f 6361 7465 5f72 6567 696f  n = locate_regio
-00030a40: 6e28 722c 2070 6f73 290a 2020 2020 2020  n(r, pos).      
-00030a50: 2020 2020 2020 2020 2020 7820 3d20 782e            x = x.
-00030a60: 6973 656c 2876 6172 6961 6e74 733d 6c6f  isel(variants=lo
-00030a70: 635f 7265 6769 6f6e 290a 0a20 2020 2020  c_region)..     
-00030a80: 2020 2020 2020 206c 782e 6170 7065 6e64         lx.append
-00030a90: 2878 290a 0a20 2020 2020 2020 2064 6562  (x)..        deb
-00030aa0: 7567 2822 636f 6e63 6174 656e 6174 6520  ug("concatenate 
-00030ab0: 6461 7461 2066 726f 6d20 6d75 6c74 6970  data from multip
-00030ac0: 6c65 2072 6567 696f 6e73 2229 0a20 2020  le regions").   
-00030ad0: 2020 2020 2064 7320 3d20 7861 7272 6179       ds = xarray
-00030ae0: 5f63 6f6e 6361 7428 6c78 2c20 6469 6d3d  _concat(lx, dim=
-00030af0: 4449 4d5f 5641 5249 414e 5429 0a0a 2020  DIM_VARIANT)..  
-00030b00: 2020 2020 2020 6465 6275 6728 2268 616e        debug("han
-00030b10: 646c 6520 7361 6d70 6c65 2071 7565 7279  dle sample query
-00030b20: 2229 0a20 2020 2020 2020 2069 6620 7361  ").        if sa
-00030b30: 6d70 6c65 5f71 7565 7279 2069 7320 6e6f  mple_query is no
-00030b40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00030b50: 2020 2020 6465 6275 6728 226c 6f61 6420      debug("load 
-00030b60: 7361 6d70 6c65 206d 6574 6164 6174 6122  sample metadata"
-00030b70: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-00030b80: 5f73 616d 706c 6573 203d 2073 656c 662e  _samples = self.
-00030b90: 7361 6d70 6c65 5f6d 6574 6164 6174 6128  sample_metadata(
-00030ba0: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
-00030bb0: 6c65 5f73 6574 7329 0a0a 2020 2020 2020  le_sets)..      
-00030bc0: 2020 2020 2020 6465 6275 6728 2261 6c69        debug("ali
-00030bd0: 676e 2073 616d 706c 6520 6d65 7461 6461  gn sample metada
-00030be0: 7461 2077 6974 6820 6861 706c 6f74 7970  ta with haplotyp
-00030bf0: 6573 2229 0a20 2020 2020 2020 2020 2020  es").           
-00030c00: 2070 6861 7365 645f 7361 6d70 6c65 7320   phased_samples 
-00030c10: 3d20 6473 5b22 7361 6d70 6c65 5f69 6422  = ds["sample_id"
-00030c20: 5d2e 7661 6c75 6573 2e74 6f6c 6973 7428  ].values.tolist(
-00030c30: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-00030c40: 5f73 616d 706c 6573 5f70 6861 7365 6420  _samples_phased 
-00030c50: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00030c60: 2020 2020 6466 5f73 616d 706c 6573 2e73      df_samples.s
-00030c70: 6574 5f69 6e64 6578 2822 7361 6d70 6c65  et_index("sample
-00030c80: 5f69 6422 292e 6c6f 635b 7068 6173 6564  _id").loc[phased
-00030c90: 5f73 616d 706c 6573 5d2e 7265 7365 745f  _samples].reset_
-00030ca0: 696e 6465 7828 290a 2020 2020 2020 2020  index().        
-00030cb0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00030cc0: 2020 2064 6562 7567 2822 6170 706c 7920     debug("apply 
-00030cd0: 7468 6520 7175 6572 7922 290a 2020 2020  the query").    
-00030ce0: 2020 2020 2020 2020 6c6f 635f 7361 6d70          loc_samp
-00030cf0: 6c65 7320 3d20 6466 5f73 616d 706c 6573  les = df_samples
-00030d00: 5f70 6861 7365 642e 6576 616c 2873 616d  _phased.eval(sam
-00030d10: 706c 655f 7175 6572 7929 2e76 616c 7565  ple_query).value
-00030d20: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-00030d30: 206e 702e 636f 756e 745f 6e6f 6e7a 6572   np.count_nonzer
-00030d40: 6f28 6c6f 635f 7361 6d70 6c65 7329 203d  o(loc_samples) =
-00030d50: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00030d60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00030d70: 4572 726f 7228 6622 4e6f 2073 616d 706c  Error(f"No sampl
-00030d80: 6573 2066 6f75 6e64 2066 6f72 2071 7565  es found for que
-00030d90: 7279 207b 7361 6d70 6c65 5f71 7565 7279  ry {sample_query
-00030da0: 2172 7d22 290a 2020 2020 2020 2020 2020  !r}").          
-00030db0: 2020 6473 203d 2064 732e 6973 656c 2873    ds = ds.isel(s
-00030dc0: 616d 706c 6573 3d6c 6f63 5f73 616d 706c  amples=loc_sampl
-00030dd0: 6573 290a 0a20 2020 2020 2020 2064 6562  es)..        deb
-00030de0: 7567 2822 6861 6e64 6c65 2063 6f68 6f72  ug("handle cohor
-00030df0: 7420 7369 7a65 2229 0a20 2020 2020 2020  t size").       
-00030e00: 2069 6620 636f 686f 7274 5f73 697a 6520   if cohort_size 
-00030e10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00030e20: 2020 2020 2020 2020 2064 6562 7567 2822           debug("
-00030e30: 6861 6e64 6c65 2063 6f68 6f72 7420 7369  handle cohort si
-00030e40: 7a65 2229 0a20 2020 2020 2020 2020 2020  ze").           
-00030e50: 2023 206f 7665 7272 6964 6573 206d 696e   # overrides min
-00030e60: 2061 6e64 206d 6178 0a20 2020 2020 2020   and max.       
-00030e70: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-00030e80: 7369 7a65 203d 2063 6f68 6f72 745f 7369  size = cohort_si
-00030e90: 7a65 0a20 2020 2020 2020 2020 2020 206d  ze.            m
-00030ea0: 6178 5f63 6f68 6f72 745f 7369 7a65 203d  ax_cohort_size =
-00030eb0: 2063 6f68 6f72 745f 7369 7a65 0a0a 2020   cohort_size..  
-00030ec0: 2020 2020 2020 6966 206d 696e 5f63 6f68        if min_coh
-00030ed0: 6f72 745f 7369 7a65 2069 7320 6e6f 7420  ort_size is not 
-00030ee0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00030ef0: 2020 6465 6275 6728 2268 616e 646c 6520    debug("handle 
-00030f00: 6d69 6e20 636f 686f 7274 2073 697a 6522  min cohort size"
-00030f10: 290a 2020 2020 2020 2020 2020 2020 6e5f  ).            n_
-00030f20: 7361 6d70 6c65 7320 3d20 6473 2e64 696d  samples = ds.dim
-00030f30: 735b 2273 616d 706c 6573 225d 0a20 2020  s["samples"].   
-00030f40: 2020 2020 2020 2020 2069 6620 6e5f 7361           if n_sa
-00030f50: 6d70 6c65 7320 3c20 6d69 6e5f 636f 686f  mples < min_coho
-00030f60: 7274 5f73 697a 653a 0a20 2020 2020 2020  rt_size:.       
-00030f70: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00030f80: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00030f90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00030fa0: 226e 6f74 2065 6e6f 7567 6820 7361 6d70  "not enough samp
-00030fb0: 6c65 7320 287b 6e5f 7361 6d70 6c65 737d  les ({n_samples}
-00030fc0: 2920 666f 7220 6d69 6e69 6d75 6d20 636f  ) for minimum co
-00030fd0: 686f 7274 2073 697a 6520 287b 6d69 6e5f  hort size ({min_
-00030fe0: 636f 686f 7274 5f73 697a 657d 2922 0a20  cohort_size})". 
-00030ff0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00031000: 0a0a 2020 2020 2020 2020 6966 206d 6178  ..        if max
-00031010: 5f63 6f68 6f72 745f 7369 7a65 2069 7320  _cohort_size is 
-00031020: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00031030: 2020 2020 2020 6465 6275 6728 2268 616e        debug("han
-00031040: 646c 6520 6d61 7820 636f 686f 7274 2073  dle max cohort s
-00031050: 697a 6522 290a 2020 2020 2020 2020 2020  ize").          
-00031060: 2020 6e5f 7361 6d70 6c65 7320 3d20 6473    n_samples = ds
-00031070: 2e64 696d 735b 2273 616d 706c 6573 225d  .dims["samples"]
-00031080: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00031090: 6e5f 7361 6d70 6c65 7320 3e20 6d61 785f  n_samples > max_
-000310a0: 636f 686f 7274 5f73 697a 653a 0a20 2020  cohort_size:.   
-000310b0: 2020 2020 2020 2020 2020 2020 2072 6e67               rng
-000310c0: 203d 206e 702e 7261 6e64 6f6d 2e64 6566   = np.random.def
-000310d0: 6175 6c74 5f72 6e67 2873 6565 643d 7261  ault_rng(seed=ra
-000310e0: 6e64 6f6d 5f73 6565 6429 0a20 2020 2020  ndom_seed).     
-000310f0: 2020 2020 2020 2020 2020 206c 6f63 5f64             loc_d
-00031100: 6f77 6e73 616d 706c 6520 3d20 726e 672e  ownsample = rng.
-00031110: 6368 6f69 6365 280a 2020 2020 2020 2020  choice(.        
-00031120: 2020 2020 2020 2020 2020 2020 6e5f 7361              n_sa
-00031130: 6d70 6c65 732c 2073 697a 653d 6d61 785f  mples, size=max_
-00031140: 636f 686f 7274 5f73 697a 652c 2072 6570  cohort_size, rep
-00031150: 6c61 6365 3d46 616c 7365 0a20 2020 2020  lace=False.     
-00031160: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00031170: 2020 2020 2020 2020 2020 2020 206c 6f63               loc
-00031180: 5f64 6f77 6e73 616d 706c 652e 736f 7274  _downsample.sort
-00031190: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000311a0: 2020 2064 7320 3d20 6473 2e69 7365 6c28     ds = ds.isel(
-000311b0: 7361 6d70 6c65 733d 6c6f 635f 646f 776e  samples=loc_down
-000311c0: 7361 6d70 6c65 290a 0a20 2020 2020 2020  sample)..       
-000311d0: 2072 6574 7572 6e20 6473 0a0a 2020 2020   return ds..    
-000311e0: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
-000311f0: 6d6d 6172 793d 2247 656e 6572 6174 6520  mmary="Generate 
-00031200: 6831 3220 4757 5353 2063 616c 6962 7261  h12 GWSS calibra
-00031210: 7469 6f6e 2064 6174 6120 666f 7220 6469  tion data for di
-00031220: 6666 6572 656e 7420 7769 6e64 6f77 2073  fferent window s
-00031230: 697a 6573 2e22 2c0a 2020 2020 2020 2020  izes.",.        
-00031240: 7265 7475 726e 733d 2222 220a 2020 2020  returns=""".    
-00031250: 2020 2020 2020 2020 4120 6c69 7374 206f          A list o
-00031260: 6620 4831 3220 6361 6c69 6272 6174 696f  f H12 calibratio
-00031270: 6e20 7275 6e20 6172 7261 7973 2066 6f72  n run arrays for
-00031280: 2065 6163 6820 7769 6e64 6f77 2073 697a   each window siz
-00031290: 652c 2063 6f6e 7461 696e 696e 670a 2020  e, containing.  
-000312a0: 2020 2020 2020 2020 2020 7661 6c75 6573            values
-000312b0: 2061 6e64 2070 6572 6365 6e74 696c 6573   and percentiles
-000312c0: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
-000312d0: 2020 2029 0a20 2020 2064 6566 2068 3132     ).    def h12
-000312e0: 5f63 616c 6962 7261 7469 6f6e 280a 2020  _calibration(.  
-000312f0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00031300: 2020 2020 636f 6e74 6967 3a20 6261 7365      contig: base
-00031310: 5f70 6172 616d 732e 636f 6e74 6967 2c0a  _params.contig,.
-00031320: 2020 2020 2020 2020 616e 616c 7973 6973          analysis
-00031330: 3a20 6861 705f 7061 7261 6d73 2e61 6e61  : hap_params.ana
-00031340: 6c79 7369 7320 3d20 4445 4641 554c 542c  lysis = DEFAULT,
-00031350: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00031360: 7175 6572 793a 204f 7074 696f 6e61 6c5b  query: Optional[
-00031370: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-00031380: 6c65 5f71 7565 7279 5d20 3d20 4e6f 6e65  le_query] = None
-00031390: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
-000313a0: 5f73 6574 733a 204f 7074 696f 6e61 6c5b  _sets: Optional[
-000313b0: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-000313c0: 6c65 5f73 6574 735d 203d 204e 6f6e 652c  le_sets] = None,
-000313d0: 0a20 2020 2020 2020 2063 6f68 6f72 745f  .        cohort_
-000313e0: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b62  size: Optional[b
-000313f0: 6173 655f 7061 7261 6d73 2e63 6f68 6f72  ase_params.cohor
-00031400: 745f 7369 7a65 5d20 3d20 6831 325f 7061  t_size] = h12_pa
-00031410: 7261 6d73 2e63 6f68 6f72 745f 7369 7a65  rams.cohort_size
-00031420: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-00031430: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
-00031440: 653a 204f 7074 696f 6e61 6c5b 0a20 2020  e: Optional[.   
-00031450: 2020 2020 2020 2020 2062 6173 655f 7061           base_pa
-00031460: 7261 6d73 2e6d 696e 5f63 6f68 6f72 745f  rams.min_cohort_
-00031470: 7369 7a65 0a20 2020 2020 2020 205d 203d  size.        ] =
-00031480: 2068 3132 5f70 6172 616d 732e 6d69 6e5f   h12_params.min_
-00031490: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
-000314a0: 756c 742c 0a20 2020 2020 2020 206d 6178  ult,.        max
-000314b0: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
-000314c0: 7469 6f6e 616c 5b0a 2020 2020 2020 2020  tional[.        
-000314d0: 2020 2020 6261 7365 5f70 6172 616d 732e      base_params.
-000314e0: 6d61 785f 636f 686f 7274 5f73 697a 650a  max_cohort_size.
-000314f0: 2020 2020 2020 2020 5d20 3d20 6831 325f          ] = h12_
-00031500: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
-00031510: 745f 7369 7a65 5f64 6566 6175 6c74 2c0a  t_size_default,.
-00031520: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
-00031530: 697a 6573 3a20 6831 325f 7061 7261 6d73  izes: h12_params
-00031540: 2e77 696e 646f 775f 7369 7a65 7320 3d20  .window_sizes = 
-00031550: 6831 325f 7061 7261 6d73 2e77 696e 646f  h12_params.windo
-00031560: 775f 7369 7a65 735f 6465 6661 756c 742c  w_sizes_default,
-00031570: 0a20 2020 2020 2020 2072 616e 646f 6d5f  .        random_
-00031580: 7365 6564 3a20 6261 7365 5f70 6172 616d  seed: base_param
-00031590: 732e 7261 6e64 6f6d 5f73 6565 6420 3d20  s.random_seed = 
-000315a0: 3432 2c0a 2020 2020 2920 2d3e 204c 6973  42,.    ) -> Lis
-000315b0: 745b 6e70 2e6e 6461 7272 6179 5d3a 0a20  t[np.ndarray]:. 
-000315c0: 2020 2020 2020 2023 2063 6861 6e67 6520         # change 
-000315d0: 7468 6973 206e 616d 6520 6966 2079 6f75  this name if you
-000315e0: 2065 7665 7220 6368 616e 6765 2074 6865   ever change the
-000315f0: 2062 6568 6176 696f 7572 206f 6620 7468   behaviour of th
-00031600: 6973 2066 756e 6374 696f 6e2c 2074 6f0a  is function, to.
-00031610: 2020 2020 2020 2020 2320 696e 7661 6c69          # invali
-00031620: 6461 7465 2061 6e79 2070 7265 7669 6f75  date any previou
-00031630: 736c 7920 6361 6368 6564 2064 6174 610a  sly cached data.
-00031640: 2020 2020 2020 2020 6e61 6d65 203d 2073          name = s
-00031650: 656c 662e 5f68 3132 5f63 616c 6962 7261  elf._h12_calibra
-00031660: 7469 6f6e 5f63 6163 6865 5f6e 616d 650a  tion_cache_name.
-00031670: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00031680: 3d20 6469 6374 280a 2020 2020 2020 2020  = dict(.        
-00031690: 2020 2020 636f 6e74 6967 3d63 6f6e 7469      contig=conti
-000316a0: 672c 0a20 2020 2020 2020 2020 2020 2061  g,.            a
-000316b0: 6e61 6c79 7369 733d 7365 6c66 2e5f 7072  nalysis=self._pr
-000316c0: 6570 5f70 6861 7369 6e67 5f61 6e61 6c79  ep_phasing_analy
-000316d0: 7369 735f 7061 7261 6d28 616e 616c 7973  sis_param(analys
-000316e0: 6973 3d61 6e61 6c79 7369 7329 2c0a 2020  is=analysis),.  
-000316f0: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
-00031700: 5f73 697a 6573 3d77 696e 646f 775f 7369  _sizes=window_si
-00031710: 7a65 732c 0a20 2020 2020 2020 2020 2020  zes,.           
-00031720: 2073 616d 706c 655f 7365 7473 3d73 656c   sample_sets=sel
-00031730: 662e 5f70 7265 705f 7361 6d70 6c65 5f73  f._prep_sample_s
-00031740: 6574 735f 7061 7261 6d28 7361 6d70 6c65  ets_param(sample
-00031750: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
-00031760: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-00031770: 2320 4e2e 422e 2c20 646f 206e 6f74 2062  # N.B., do not b
-00031780: 6520 7465 6d70 7465 6420 746f 2063 6f6e  e tempted to con
-00031790: 7665 7274 2074 6869 7320 7361 6d70 6c65  vert this sample
-000317a0: 2071 7565 7279 2069 6e74 6f20 696e 7465   query into inte
-000317b0: 6765 720a 2020 2020 2020 2020 2020 2020  ger.            
-000317c0: 2320 696e 6469 6365 7320 7573 696e 6720  # indices using 
-000317d0: 5f70 7265 705f 7361 6d70 6c65 5f73 656c  _prep_sample_sel
-000317e0: 6563 7469 6f6e 5f70 6172 616d 732c 2062  ection_params, b
-000317f0: 6563 6175 7365 2074 6865 2069 6e64 6963  ecause the indic
-00031800: 6573 0a20 2020 2020 2020 2020 2020 2023  es.            #
-00031810: 2061 7265 2064 6966 6665 7265 6e74 2069   are different i
-00031820: 6e20 7468 6520 6861 706c 6f74 7970 6520  n the haplotype 
-00031830: 6461 7461 2e0a 2020 2020 2020 2020 2020  data..          
-00031840: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
-00031850: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
-00031860: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
-00031870: 7369 7a65 3d63 6f68 6f72 745f 7369 7a65  size=cohort_size
-00031880: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-00031890: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
-000318a0: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-000318b0: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-000318c0: 6f68 6f72 745f 7369 7a65 3d6d 6178 5f63  ohort_size=max_c
-000318d0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-000318e0: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-000318f0: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00031900: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00031910: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00031920: 2020 2020 2063 616c 6962 7261 7469 6f6e       calibration
-00031930: 5f72 756e 7320 3d20 7365 6c66 2e72 6573  _runs = self.res
-00031940: 756c 7473 5f63 6163 6865 5f67 6574 286e  ults_cache_get(n
-00031950: 616d 653d 6e61 6d65 2c20 7061 7261 6d73  ame=name, params
-00031960: 3d70 6172 616d 7329 0a0a 2020 2020 2020  =params)..      
-00031970: 2020 6578 6365 7074 2043 6163 6865 4d69    except CacheMi
-00031980: 7373 3a0a 2020 2020 2020 2020 2020 2020  ss:.            
-00031990: 6361 6c69 6272 6174 696f 6e5f 7275 6e73  calibration_runs
-000319a0: 203d 2073 656c 662e 5f68 3132 5f63 616c   = self._h12_cal
-000319b0: 6962 7261 7469 6f6e 282a 2a70 6172 616d  ibration(**param
-000319c0: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-000319d0: 656c 662e 7265 7375 6c74 735f 6361 6368  elf.results_cach
-000319e0: 655f 7365 7428 6e61 6d65 3d6e 616d 652c  e_set(name=name,
-000319f0: 2070 6172 616d 733d 7061 7261 6d73 2c20   params=params, 
-00031a00: 7265 7375 6c74 733d 6361 6c69 6272 6174  results=calibrat
-00031a10: 696f 6e5f 7275 6e73 290a 0a20 2020 2020  ion_runs)..     
-00031a20: 2020 2072 6574 7572 6e20 6361 6c69 6272     return calibr
-00031a30: 6174 696f 6e5f 7275 6e73 0a0a 2020 2020  ation_runs..    
-00031a40: 6465 6620 5f68 3132 5f63 616c 6962 7261  def _h12_calibra
-00031a50: 7469 6f6e 280a 2020 2020 2020 2020 7365  tion(.        se
-00031a60: 6c66 2c0a 2020 2020 2020 2020 636f 6e74  lf,.        cont
-00031a70: 6967 2c0a 2020 2020 2020 2020 616e 616c  ig,.        anal
-00031a80: 7973 6973 2c0a 2020 2020 2020 2020 7361  ysis,.        sa
-00031a90: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
-00031aa0: 2020 2020 7361 6d70 6c65 5f73 6574 732c      sample_sets,
-00031ab0: 0a20 2020 2020 2020 2063 6f68 6f72 745f  .        cohort_
-00031ac0: 7369 7a65 2c0a 2020 2020 2020 2020 6d69  size,.        mi
-00031ad0: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-00031ae0: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
-00031af0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-00031b00: 7769 6e64 6f77 5f73 697a 6573 2c0a 2020  window_sizes,.  
-00031b10: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
-00031b20: 642c 0a20 2020 2029 3a0a 2020 2020 2020  d,.    ):.      
-00031b30: 2020 2320 6163 6365 7373 2068 6170 6c6f    # access haplo
-00031b40: 7479 7065 730a 2020 2020 2020 2020 6473  types.        ds
-00031b50: 5f68 6170 7320 3d20 7365 6c66 2e68 6170  _haps = self.hap
-00031b60: 6c6f 7479 7065 7328 0a20 2020 2020 2020  lotypes(.       
-00031b70: 2020 2020 2072 6567 696f 6e3d 636f 6e74       region=cont
-00031b80: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-00031b90: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
-00031ba0: 6c65 5f73 6574 732c 0a20 2020 2020 2020  le_sets,.       
-00031bb0: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
-00031bc0: 793d 7361 6d70 6c65 5f71 7565 7279 2c0a  y=sample_query,.
-00031bd0: 2020 2020 2020 2020 2020 2020 616e 616c              anal
-00031be0: 7973 6973 3d61 6e61 6c79 7369 732c 0a20  ysis=analysis,. 
-00031bf0: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
-00031c00: 745f 7369 7a65 3d63 6f68 6f72 745f 7369  t_size=cohort_si
-00031c10: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-00031c20: 6d69 6e5f 636f 686f 7274 5f73 697a 653d  min_cohort_size=
-00031c30: 6d69 6e5f 636f 686f 7274 5f73 697a 652c  min_cohort_size,
-00031c40: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-00031c50: 5f63 6f68 6f72 745f 7369 7a65 3d6d 6178  _cohort_size=max
-00031c60: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
-00031c70: 2020 2020 2020 2020 2020 7261 6e64 6f6d            random
-00031c80: 5f73 6565 643d 7261 6e64 6f6d 5f73 6565  _seed=random_see
-00031c90: 642c 0a20 2020 2020 2020 2029 0a0a 2020  d,.        )..  
-00031ca0: 2020 2020 2020 6774 203d 2061 6c6c 656c        gt = allel
-00031cb0: 2e47 656e 6f74 7970 6544 6173 6b41 7272  .GenotypeDaskArr
-00031cc0: 6179 2864 735f 6861 7073 5b22 6361 6c6c  ay(ds_haps["call
-00031cd0: 5f67 656e 6f74 7970 6522 5d2e 6461 7461  _genotype"].data
-00031ce0: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-00031cf0: 656c 662e 5f64 6173 6b5f 7072 6f67 7265  elf._dask_progre
-00031d00: 7373 2864 6573 633d 224c 6f61 6420 6861  ss(desc="Load ha
-00031d10: 706c 6f74 7970 6573 2229 3a0a 2020 2020  plotypes"):.    
-00031d20: 2020 2020 2020 2020 6874 203d 2067 742e          ht = gt.
-00031d30: 746f 5f68 6170 6c6f 7479 7065 7328 292e  to_haplotypes().
-00031d40: 636f 6d70 7574 6528 290a 0a20 2020 2020  compute()..     
-00031d50: 2020 2063 616c 6962 7261 7469 6f6e 5f72     calibration_r
-00031d60: 756e 7320 3d20 6469 6374 2829 0a20 2020  uns = dict().   
-00031d70: 2020 2020 2066 6f72 2077 696e 646f 775f       for window_
-00031d80: 7369 7a65 2069 6e20 7365 6c66 2e5f 7072  size in self._pr
-00031d90: 6f67 7265 7373 2877 696e 646f 775f 7369  ogress(window_si
-00031da0: 7a65 732c 2064 6573 633d 2243 6f6d 7075  zes, desc="Compu
-00031db0: 7465 2048 3132 2229 3a0a 2020 2020 2020  te H12"):.      
-00031dc0: 2020 2020 2020 6831 2c20 6831 322c 2068        h1, h12, h
-00031dd0: 3132 332c 2068 325f 6831 203d 2061 6c6c  123, h2_h1 = all
-00031de0: 656c 2e6d 6f76 696e 675f 6761 7275 645f  el.moving_garud_
-00031df0: 6828 6874 2c20 7369 7a65 3d77 696e 646f  h(ht, size=windo
-00031e00: 775f 7369 7a65 290a 2020 2020 2020 2020  w_size).        
-00031e10: 2020 2020 6361 6c69 6272 6174 696f 6e5f      calibration_
-00031e20: 7275 6e73 5b73 7472 2877 696e 646f 775f  runs[str(window_
-00031e30: 7369 7a65 295d 203d 2068 3132 0a0a 2020  size)] = h12..  
-00031e40: 2020 2020 2020 7265 7475 726e 2063 616c        return cal
-00031e50: 6962 7261 7469 6f6e 5f72 756e 730a 0a20  ibration_runs.. 
-00031e60: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
-00031e70: 2073 756d 6d61 7279 3d22 506c 6f74 2068   summary="Plot h
-00031e80: 3132 2047 5753 5320 6361 6c69 6272 6174  12 GWSS calibrat
-00031e90: 696f 6e20 6461 7461 2066 6f72 2064 6966  ion data for dif
-00031ea0: 6665 7265 6e74 2077 696e 646f 7720 7369  ferent window si
-00031eb0: 7a65 732e 222c 0a20 2020 2020 2020 2070  zes.",.        p
-00031ec0: 6172 616d 6574 6572 733d 6469 6374 280a  arameters=dict(.
-00031ed0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-00031ee0: 653d 2250 6c6f 7420 7469 746c 652e 222c  e="Plot title.",
-00031ef0: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-00031f00: 773d 2249 6620 5472 7565 2c20 7368 6f77  w="If True, show
-00031f10: 2074 6865 2070 6c6f 742e 222c 0a20 2020   the plot.",.   
-00031f20: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
-00031f30: 2020 6465 6620 706c 6f74 5f68 3132 5f63    def plot_h12_c
-00031f40: 616c 6962 7261 7469 6f6e 280a 2020 2020  alibration(.    
-00031f50: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00031f60: 2020 636f 6e74 6967 3a20 6261 7365 5f70    contig: base_p
-00031f70: 6172 616d 732e 636f 6e74 6967 2c0a 2020  arams.contig,.  
-00031f80: 2020 2020 2020 616e 616c 7973 6973 3a20        analysis: 
-00031f90: 6861 705f 7061 7261 6d73 2e61 6e61 6c79  hap_params.analy
-00031fa0: 7369 7320 3d20 4445 4641 554c 542c 0a20  sis = DEFAULT,. 
-00031fb0: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
-00031fc0: 6572 793a 204f 7074 696f 6e61 6c5b 6261  ery: Optional[ba
-00031fd0: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
-00031fe0: 5f71 7565 7279 5d20 3d20 4e6f 6e65 2c0a  _query] = None,.
-00031ff0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-00032000: 6574 733a 204f 7074 696f 6e61 6c5b 6261  ets: Optional[ba
-00032010: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
-00032020: 5f73 6574 735d 203d 204e 6f6e 652c 0a20  _sets] = None,. 
-00032030: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
-00032040: 7a65 3a20 4f70 7469 6f6e 616c 5b62 6173  ze: Optional[bas
-00032050: 655f 7061 7261 6d73 2e63 6f68 6f72 745f  e_params.cohort_
-00032060: 7369 7a65 5d20 3d20 6831 325f 7061 7261  size] = h12_para
-00032070: 6d73 2e63 6f68 6f72 745f 7369 7a65 5f64  ms.cohort_size_d
-00032080: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-00032090: 6d69 6e5f 636f 686f 7274 5f73 697a 653a  min_cohort_size:
-000320a0: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-000320b0: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
-000320c0: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
-000320d0: 7a65 0a20 2020 2020 2020 205d 203d 2068  ze.        ] = h
-000320e0: 3132 5f70 6172 616d 732e 6d69 6e5f 636f  12_params.min_co
-000320f0: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
-00032100: 742c 0a20 2020 2020 2020 206d 6178 5f63  t,.        max_c
-00032110: 6f68 6f72 745f 7369 7a65 3a20 4f70 7469  ohort_size: Opti
-00032120: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
-00032130: 2020 6261 7365 5f70 6172 616d 732e 6d61    base_params.ma
-00032140: 785f 636f 686f 7274 5f73 697a 650a 2020  x_cohort_size.  
-00032150: 2020 2020 2020 5d20 3d20 6831 325f 7061        ] = h12_pa
-00032160: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
-00032170: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
-00032180: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
-00032190: 6573 3a20 6831 325f 7061 7261 6d73 2e77  es: h12_params.w
-000321a0: 696e 646f 775f 7369 7a65 7320 3d20 6831  indow_sizes = h1
-000321b0: 325f 7061 7261 6d73 2e77 696e 646f 775f  2_params.window_
-000321c0: 7369 7a65 735f 6465 6661 756c 742c 0a20  sizes_default,. 
-000321d0: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-000321e0: 6564 3a20 6261 7365 5f70 6172 616d 732e  ed: base_params.
-000321f0: 7261 6e64 6f6d 5f73 6565 6420 3d20 3432  random_seed = 42
-00032200: 2c0a 2020 2020 2020 2020 7469 746c 653a  ,.        title:
-00032210: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00032220: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-00032230: 686f 773a 2062 6f6f 6c20 3d20 5472 7565  how: bool = True
-00032240: 2c0a 2020 2020 2920 2d3e 2067 706c 745f  ,.    ) -> gplt_
-00032250: 7061 7261 6d73 2e66 6967 7572 653a 0a20  params.figure:. 
-00032260: 2020 2020 2020 2023 2067 6574 2048 3132         # get H12
-00032270: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
-00032280: 6361 6c69 6272 6174 696f 6e5f 7275 6e73  calibration_runs
-00032290: 203d 2073 656c 662e 6831 325f 6361 6c69   = self.h12_cali
-000322a0: 6272 6174 696f 6e28 0a20 2020 2020 2020  bration(.       
-000322b0: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
-000322c0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-000322d0: 616e 616c 7973 6973 3d61 6e61 6c79 7369  analysis=analysi
-000322e0: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
-000322f0: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
-00032300: 6c65 5f71 7565 7279 2c0a 2020 2020 2020  le_query,.      
-00032310: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
-00032320: 733d 7361 6d70 6c65 5f73 6574 732c 0a20  s=sample_sets,. 
-00032330: 2020 2020 2020 2020 2020 2077 696e 646f             windo
-00032340: 775f 7369 7a65 733d 7769 6e64 6f77 5f73  w_sizes=window_s
-00032350: 697a 6573 2c0a 2020 2020 2020 2020 2020  izes,.          
-00032360: 2020 636f 686f 7274 5f73 697a 653d 636f    cohort_size=co
-00032370: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-00032380: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
-00032390: 745f 7369 7a65 3d6d 696e 5f63 6f68 6f72  t_size=min_cohor
-000323a0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-000323b0: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
-000323c0: 697a 653d 6d61 785f 636f 686f 7274 5f73  ize=max_cohort_s
-000323d0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-000323e0: 2072 616e 646f 6d5f 7365 6564 3d72 616e   random_seed=ran
-000323f0: 646f 6d5f 7365 6564 2c0a 2020 2020 2020  dom_seed,.      
-00032400: 2020 290a 0a20 2020 2020 2020 2023 2063    )..        # c
-00032410: 6f6d 7075 7465 2073 756d 6d61 7269 6573  ompute summaries
-00032420: 0a20 2020 2020 2020 2071 3530 203d 205b  .        q50 = [
-00032430: 6e70 2e6d 6564 6961 6e28 6361 6c69 6272  np.median(calibr
-00032440: 6174 696f 6e5f 7275 6e73 5b73 7472 2877  ation_runs[str(w
-00032450: 696e 646f 7729 5d29 2066 6f72 2077 696e  indow)]) for win
-00032460: 646f 7720 696e 2077 696e 646f 775f 7369  dow in window_si
-00032470: 7a65 735d 0a20 2020 2020 2020 2071 3235  zes].        q25
-00032480: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00032490: 206e 702e 7065 7263 656e 7469 6c65 2863   np.percentile(c
-000324a0: 616c 6962 7261 7469 6f6e 5f72 756e 735b  alibration_runs[
-000324b0: 7374 7228 7769 6e64 6f77 295d 2c20 3235  str(window)], 25
-000324c0: 2920 666f 7220 7769 6e64 6f77 2069 6e20  ) for window in 
-000324d0: 7769 6e64 6f77 5f73 697a 6573 0a20 2020  window_sizes.   
-000324e0: 2020 2020 205d 0a20 2020 2020 2020 2071       ].        q
-000324f0: 3735 203d 205b 0a20 2020 2020 2020 2020  75 = [.         
-00032500: 2020 206e 702e 7065 7263 656e 7469 6c65     np.percentile
-00032510: 2863 616c 6962 7261 7469 6f6e 5f72 756e  (calibration_run
-00032520: 735b 7374 7228 7769 6e64 6f77 295d 2c20  s[str(window)], 
-00032530: 3735 2920 666f 7220 7769 6e64 6f77 2069  75) for window i
-00032540: 6e20 7769 6e64 6f77 5f73 697a 6573 0a20  n window_sizes. 
-00032550: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00032560: 2071 3035 203d 205b 0a20 2020 2020 2020   q05 = [.       
-00032570: 2020 2020 206e 702e 7065 7263 656e 7469       np.percenti
-00032580: 6c65 2863 616c 6962 7261 7469 6f6e 5f72  le(calibration_r
-00032590: 756e 735b 7374 7228 7769 6e64 6f77 295d  uns[str(window)]
-000325a0: 2c20 3529 2066 6f72 2077 696e 646f 7720  , 5) for window 
-000325b0: 696e 2077 696e 646f 775f 7369 7a65 730a  in window_sizes.
-000325c0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-000325d0: 2020 7139 3520 3d20 5b0a 2020 2020 2020    q95 = [.      
-000325e0: 2020 2020 2020 6e70 2e70 6572 6365 6e74        np.percent
-000325f0: 696c 6528 6361 6c69 6272 6174 696f 6e5f  ile(calibration_
-00032600: 7275 6e73 5b73 7472 2877 696e 646f 7729  runs[str(window)
-00032610: 5d2c 2039 3529 2066 6f72 2077 696e 646f  ], 95) for windo
-00032620: 7720 696e 2077 696e 646f 775f 7369 7a65  w in window_size
-00032630: 730a 2020 2020 2020 2020 5d0a 0a20 2020  s.        ]..   
-00032640: 2020 2020 2023 206d 616b 6520 706c 6f74       # make plot
-00032650: 0a20 2020 2020 2020 2066 6967 203d 2062  .        fig = b
-00032660: 6f6b 6568 2e70 6c6f 7474 696e 672e 6669  okeh.plotting.fi
-00032670: 6775 7265 2877 6964 7468 3d37 3030 2c20  gure(width=700, 
-00032680: 6865 6967 6874 3d34 3030 2c20 785f 6178  height=400, x_ax
-00032690: 6973 5f74 7970 653d 226c 6f67 2229 0a20  is_type="log"). 
-000326a0: 2020 2020 2020 2066 6967 2e70 6174 6368         fig.patch
-000326b0: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
-000326c0: 6e64 6f77 5f73 697a 6573 202b 2077 696e  ndow_sizes + win
-000326d0: 646f 775f 7369 7a65 735b 3a3a 2d31 5d2c  dow_sizes[::-1],
-000326e0: 0a20 2020 2020 2020 2020 2020 2071 3735  .            q75
-000326f0: 202b 2071 3235 5b3a 3a2d 315d 2c0a 2020   + q25[::-1],.  
-00032700: 2020 2020 2020 2020 2020 616c 7068 613d            alpha=
-00032710: 302e 3735 2c0a 2020 2020 2020 2020 2020  0.75,.          
-00032720: 2020 6c69 6e65 5f77 6964 7468 3d32 2c0a    line_width=2,.
-00032730: 2020 2020 2020 2020 2020 2020 6c65 6765              lege
-00032740: 6e64 5f6c 6162 656c 3d22 3235 2d37 3525  nd_label="25-75%
-00032750: 222c 0a20 2020 2020 2020 2029 0a20 2020  ",.        ).   
-00032760: 2020 2020 2066 6967 2e70 6174 6368 280a       fig.patch(.
-00032770: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-00032780: 6f77 5f73 697a 6573 202b 2077 696e 646f  ow_sizes + windo
-00032790: 775f 7369 7a65 735b 3a3a 2d31 5d2c 0a20  w_sizes[::-1],. 
-000327a0: 2020 2020 2020 2020 2020 2071 3935 202b             q95 +
-000327b0: 2071 3035 5b3a 3a2d 315d 2c0a 2020 2020   q05[::-1],.    
-000327c0: 2020 2020 2020 2020 616c 7068 613d 302e          alpha=0.
-000327d0: 352c 0a20 2020 2020 2020 2020 2020 206c  5,.            l
-000327e0: 696e 655f 7769 6474 683d 322c 0a20 2020  ine_width=2,.   
-000327f0: 2020 2020 2020 2020 206c 6567 656e 645f           legend_
-00032800: 6c61 6265 6c3d 2235 2d39 3525 222c 0a20  label="5-95%",. 
-00032810: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00032820: 2066 6967 2e6c 696e 6528 0a20 2020 2020   fig.line(.     
-00032830: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
-00032840: 7a65 732c 2071 3530 2c20 6c69 6e65 5f63  zes, q50, line_c
-00032850: 6f6c 6f72 3d22 626c 6163 6b22 2c20 6c69  olor="black", li
-00032860: 6e65 5f77 6964 7468 3d34 2c20 6c65 6765  ne_width=4, lege
-00032870: 6e64 5f6c 6162 656c 3d22 6d65 6469 616e  nd_label="median
-00032880: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00032890: 2020 2020 6669 672e 6369 7263 6c65 2877      fig.circle(w
-000328a0: 696e 646f 775f 7369 7a65 732c 2071 3530  indow_sizes, q50
-000328b0: 2c20 636f 6c6f 723d 2262 6c61 636b 222c  , color="black",
-000328c0: 2066 696c 6c5f 636f 6c6f 723d 2262 6c61   fill_color="bla
-000328d0: 636b 222c 2073 697a 653d 3829 0a0a 2020  ck", size=8)..  
-000328e0: 2020 2020 2020 6669 672e 7861 7869 732e        fig.xaxis.
-000328f0: 7469 636b 6572 203d 2077 696e 646f 775f  ticker = window_
-00032900: 7369 7a65 730a 2020 2020 2020 2020 6669  sizes.        fi
-00032910: 672e 785f 7261 6e67 6520 3d20 626f 6b65  g.x_range = boke
-00032920: 682e 6d6f 6465 6c73 2e52 616e 6765 3164  h.models.Range1d
-00032930: 2877 696e 646f 775f 7369 7a65 735b 305d  (window_sizes[0]
-00032940: 2c20 7769 6e64 6f77 5f73 697a 6573 5b2d  , window_sizes[-
-00032950: 315d 290a 2020 2020 2020 2020 6966 2074  1]).        if t
-00032960: 6974 6c65 2069 7320 4e6f 6e65 3a0a 2020  itle is None:.  
-00032970: 2020 2020 2020 2020 2020 7469 746c 6520            title 
-00032980: 3d20 7361 6d70 6c65 5f71 7565 7279 0a20  = sample_query. 
-00032990: 2020 2020 2020 2066 6967 2e74 6974 6c65         fig.title
-000329a0: 203d 2074 6974 6c65 0a20 2020 2020 2020   = title.       
-000329b0: 2069 6620 7368 6f77 3a0a 2020 2020 2020   if show:.      
-000329c0: 2020 2020 2020 626f 6b65 682e 706c 6f74        bokeh.plot
-000329d0: 7469 6e67 2e73 686f 7728 6669 6729 0a20  ting.show(fig). 
-000329e0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-000329f0: 670a 0a20 2020 2040 646f 6328 0a20 2020  g..    @doc(.   
-00032a00: 2020 2020 2073 756d 6d61 7279 3d22 5275       summary="Ru
-00032a10: 6e20 6831 3220 6765 6e6f 6d65 2d77 6964  n h12 genome-wid
-00032a20: 6520 7365 6c65 6374 696f 6e20 7363 616e  e selection scan
-00032a30: 2e22 2c0a 2020 2020 2020 2020 7265 7475  .",.        retu
-00032a40: 726e 733d 6469 6374 280a 2020 2020 2020  rns=dict(.      
-00032a50: 2020 2020 2020 783d 2241 6e20 6172 7261        x="An arra
-00032a60: 7920 636f 6e74 6169 6e69 6e67 2074 6865  y containing the
-00032a70: 2077 696e 646f 7720 6365 6e74 7265 2070   window centre p
-00032a80: 6f69 6e74 2067 656e 6f6d 6963 2070 6f73  oint genomic pos
-00032a90: 6974 696f 6e73 2e22 2c0a 2020 2020 2020  itions.",.      
-00032aa0: 2020 2020 2020 6831 323d 2241 6e20 6172        h12="An ar
-00032ab0: 7261 7920 7769 7468 2068 3132 2073 7461  ray with h12 sta
-00032ac0: 7469 7374 6963 2076 616c 7565 7320 666f  tistic values fo
-00032ad0: 7220 6561 6368 2077 696e 646f 772e 222c  r each window.",
-00032ae0: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
-00032af0: 290a 2020 2020 6465 6620 6831 325f 6777  ).    def h12_gw
-00032b00: 7373 280a 2020 2020 2020 2020 7365 6c66  ss(.        self
-00032b10: 2c0a 2020 2020 2020 2020 636f 6e74 6967  ,.        contig
-00032b20: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
-00032b30: 6e74 6967 2c0a 2020 2020 2020 2020 7769  ntig,.        wi
-00032b40: 6e64 6f77 5f73 697a 653a 2068 3132 5f70  ndow_size: h12_p
-00032b50: 6172 616d 732e 7769 6e64 6f77 5f73 697a  arams.window_siz
-00032b60: 652c 0a20 2020 2020 2020 2061 6e61 6c79  e,.        analy
-00032b70: 7369 733a 2068 6170 5f70 6172 616d 732e  sis: hap_params.
-00032b80: 616e 616c 7973 6973 203d 2044 4546 4155  analysis = DEFAU
-00032b90: 4c54 2c0a 2020 2020 2020 2020 7361 6d70  LT,.        samp
-00032ba0: 6c65 5f71 7565 7279 3a20 4f70 7469 6f6e  le_query: Option
-00032bb0: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-00032bc0: 616d 706c 655f 7175 6572 795d 203d 204e  ample_query] = N
-00032bd0: 6f6e 652c 0a20 2020 2020 2020 2073 616d  one,.        sam
-00032be0: 706c 655f 7365 7473 3a20 4f70 7469 6f6e  ple_sets: Option
-00032bf0: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
-00032c00: 616d 706c 655f 7365 7473 5d20 3d20 4e6f  ample_sets] = No
-00032c10: 6e65 2c0a 2020 2020 2020 2020 636f 686f  ne,.        coho
-00032c20: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-00032c30: 6c5b 6261 7365 5f70 6172 616d 732e 636f  l[base_params.co
-00032c40: 686f 7274 5f73 697a 655d 203d 2068 3132  hort_size] = h12
-00032c50: 5f70 6172 616d 732e 636f 686f 7274 5f73  _params.cohort_s
-00032c60: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
-00032c70: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-00032c80: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b0a  size: Optional[.
-00032c90: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00032ca0: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
-00032cb0: 7274 5f73 697a 650a 2020 2020 2020 2020  rt_size.        
-00032cc0: 5d20 3d20 6831 325f 7061 7261 6d73 2e6d  ] = h12_params.m
-00032cd0: 696e 5f63 6f68 6f72 745f 7369 7a65 5f64  in_cohort_size_d
-00032ce0: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-00032cf0: 6d61 785f 636f 686f 7274 5f73 697a 653a  max_cohort_size:
-00032d00: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-00032d10: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
-00032d20: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
-00032d30: 7a65 0a20 2020 2020 2020 205d 203d 2068  ze.        ] = h
-00032d40: 3132 5f70 6172 616d 732e 6d61 785f 636f  12_params.max_co
-00032d50: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
-00032d60: 742c 0a20 2020 2020 2020 2072 616e 646f  t,.        rando
-00032d70: 6d5f 7365 6564 3a20 6261 7365 5f70 6172  m_seed: base_par
-00032d80: 616d 732e 7261 6e64 6f6d 5f73 6565 6420  ams.random_seed 
-00032d90: 3d20 3432 2c0a 2020 2020 2920 2d3e 2054  = 42,.    ) -> T
-00032da0: 7570 6c65 5b6e 702e 6e64 6172 7261 792c  uple[np.ndarray,
-00032db0: 206e 702e 6e64 6172 7261 795d 3a0a 2020   np.ndarray]:.  
-00032dc0: 2020 2020 2020 2320 6368 616e 6765 2074        # change t
-00032dd0: 6869 7320 6e61 6d65 2069 6620 796f 7520  his name if you 
-00032de0: 6576 6572 2063 6861 6e67 6520 7468 6520  ever change the 
-00032df0: 6265 6861 7669 6f75 7220 6f66 2074 6869  behaviour of thi
-00032e00: 7320 6675 6e63 7469 6f6e 2c20 746f 0a20  s function, to. 
-00032e10: 2020 2020 2020 2023 2069 6e76 616c 6964         # invalid
-00032e20: 6174 6520 616e 7920 7072 6576 696f 7573  ate any previous
-00032e30: 6c79 2063 6163 6865 6420 6461 7461 0a20  ly cached data. 
-00032e40: 2020 2020 2020 206e 616d 6520 3d20 7365         name = se
-00032e50: 6c66 2e5f 6831 325f 6777 7373 5f63 6163  lf._h12_gwss_cac
-00032e60: 6865 5f6e 616d 650a 0a20 2020 2020 2020  he_name..       
-00032e70: 2070 6172 616d 7320 3d20 6469 6374 280a   params = dict(.
-00032e80: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00032e90: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
-00032ea0: 2020 2020 2020 2061 6e61 6c79 7369 733d         analysis=
-00032eb0: 7365 6c66 2e5f 7072 6570 5f70 6861 7369  self._prep_phasi
-00032ec0: 6e67 5f61 6e61 6c79 7369 735f 7061 7261  ng_analysis_para
-00032ed0: 6d28 616e 616c 7973 6973 3d61 6e61 6c79  m(analysis=analy
-00032ee0: 7369 7329 2c0a 2020 2020 2020 2020 2020  sis),.          
-00032ef0: 2020 7769 6e64 6f77 5f73 697a 653d 7769    window_size=wi
-00032f00: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
-00032f10: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-00032f20: 7473 3d73 656c 662e 5f70 7265 705f 7361  ts=self._prep_sa
-00032f30: 6d70 6c65 5f73 6574 735f 7061 7261 6d28  mple_sets_param(
-00032f40: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
-00032f50: 6c65 5f73 6574 7329 2c0a 2020 2020 2020  le_sets),.      
-00032f60: 2020 2020 2020 2320 4e2e 422e 2c20 646f        # N.B., do
-00032f70: 206e 6f74 2062 6520 7465 6d70 7465 6420   not be tempted 
-00032f80: 746f 2063 6f6e 7665 7274 2074 6869 7320  to convert this 
-00032f90: 7361 6d70 6c65 2071 7565 7279 2069 6e74  sample query int
-00032fa0: 6f20 696e 7465 6765 720a 2020 2020 2020  o integer.      
-00032fb0: 2020 2020 2020 2320 696e 6469 6365 7320        # indices 
-00032fc0: 7573 696e 6720 5f70 7265 705f 7361 6d70  using _prep_samp
-00032fd0: 6c65 5f73 656c 6563 7469 6f6e 5f70 6172  le_selection_par
-00032fe0: 616d 732c 2062 6563 6175 7365 2074 6865  ams, because the
-00032ff0: 2069 6e64 6963 6573 0a20 2020 2020 2020   indices.       
-00033000: 2020 2020 2023 2061 7265 2064 6966 6665       # are diffe
-00033010: 7265 6e74 2069 6e20 7468 6520 6861 706c  rent in the hapl
-00033020: 6f74 7970 6520 6461 7461 2e0a 2020 2020  otype data..    
-00033030: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
-00033040: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
-00033050: 792c 0a20 2020 2020 2020 2020 2020 2063  y,.            c
-00033060: 6f68 6f72 745f 7369 7a65 3d63 6f68 6f72  ohort_size=cohor
-00033070: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-00033080: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
-00033090: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
-000330a0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-000330b0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
-000330c0: 3d6d 6178 5f63 6f68 6f72 745f 7369 7a65  =max_cohort_size
-000330d0: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
-000330e0: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
-000330f0: 5f73 6565 642c 0a20 2020 2020 2020 2029  _seed,.        )
-00033100: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-00033110: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00033120: 7473 203d 2073 656c 662e 7265 7375 6c74  ts = self.result
-00033130: 735f 6361 6368 655f 6765 7428 6e61 6d65  s_cache_get(name
-00033140: 3d6e 616d 652c 2070 6172 616d 733d 7061  =name, params=pa
-00033150: 7261 6d73 290a 0a20 2020 2020 2020 2065  rams)..        e
-00033160: 7863 6570 7420 4361 6368 654d 6973 733a  xcept CacheMiss:
-00033170: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00033180: 756c 7473 203d 2073 656c 662e 5f68 3132  ults = self._h12
-00033190: 5f67 7773 7328 2a2a 7061 7261 6d73 290a  _gwss(**params).
-000331a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000331b0: 2e72 6573 756c 7473 5f63 6163 6865 5f73  .results_cache_s
-000331c0: 6574 286e 616d 653d 6e61 6d65 2c20 7061  et(name=name, pa
-000331d0: 7261 6d73 3d70 6172 616d 732c 2072 6573  rams=params, res
-000331e0: 756c 7473 3d72 6573 756c 7473 290a 0a20  ults=results).. 
-000331f0: 2020 2020 2020 2078 203d 2072 6573 756c         x = resul
-00033200: 7473 5b22 7822 5d0a 2020 2020 2020 2020  ts["x"].        
-00033210: 6831 3220 3d20 7265 7375 6c74 735b 2268  h12 = results["h
-00033220: 3132 225d 0a0a 2020 2020 2020 2020 7265  12"]..        re
-00033230: 7475 726e 2078 2c20 6831 320a 0a20 2020  turn x, h12..   
-00033240: 2064 6566 205f 6831 325f 6777 7373 280a   def _h12_gwss(.
-00033250: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00033260: 2020 2020 2020 636f 6e74 6967 2c0a 2020        contig,.  
-00033270: 2020 2020 2020 616e 616c 7973 6973 2c0a        analysis,.
-00033280: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
-00033290: 697a 652c 0a20 2020 2020 2020 2073 616d  ize,.        sam
-000332a0: 706c 655f 7365 7473 2c0a 2020 2020 2020  ple_sets,.      
-000332b0: 2020 7361 6d70 6c65 5f71 7565 7279 2c0a    sample_query,.
-000332c0: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
-000332d0: 697a 652c 0a20 2020 2020 2020 206d 696e  ize,.        min
-000332e0: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
-000332f0: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
-00033300: 5f73 697a 652c 0a20 2020 2020 2020 2072  _size,.        r
-00033310: 616e 646f 6d5f 7365 6564 2c0a 2020 2020  andom_seed,.    
-00033320: 293a 0a20 2020 2020 2020 2064 735f 6861  ):.        ds_ha
-00033330: 7073 203d 2073 656c 662e 6861 706c 6f74  ps = self.haplot
-00033340: 7970 6573 280a 2020 2020 2020 2020 2020  ypes(.          
-00033350: 2020 7265 6769 6f6e 3d63 6f6e 7469 672c    region=contig,
-00033360: 0a20 2020 2020 2020 2020 2020 2061 6e61  .            ana
-00033370: 6c79 7369 733d 616e 616c 7973 6973 2c0a  lysis=analysis,.
-00033380: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00033390: 6c65 5f71 7565 7279 3d73 616d 706c 655f  le_query=sample_
-000333a0: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
-000333b0: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-000333c0: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
-000333d0: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
-000333e0: 697a 653d 636f 686f 7274 5f73 697a 652c  ize=cohort_size,
-000333f0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-00033400: 5f63 6f68 6f72 745f 7369 7a65 3d6d 696e  _cohort_size=min
-00033410: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
-00033420: 2020 2020 2020 2020 2020 6d61 785f 636f            max_co
-00033430: 686f 7274 5f73 697a 653d 6d61 785f 636f  hort_size=max_co
-00033440: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-00033450: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-00033460: 6564 3d72 616e 646f 6d5f 7365 6564 2c0a  ed=random_seed,.
-00033470: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00033480: 2020 2067 7420 3d20 616c 6c65 6c2e 4765     gt = allel.Ge
-00033490: 6e6f 7479 7065 4461 736b 4172 7261 7928  notypeDaskArray(
-000334a0: 6473 5f68 6170 735b 2263 616c 6c5f 6765  ds_haps["call_ge
-000334b0: 6e6f 7479 7065 225d 2e64 6174 6129 0a20  notype"].data). 
-000334c0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-000334d0: 2e5f 6461 736b 5f70 726f 6772 6573 7328  ._dask_progress(
-000334e0: 6465 7363 3d22 4c6f 6164 2068 6170 6c6f  desc="Load haplo
-000334f0: 7479 7065 7322 293a 0a20 2020 2020 2020  types"):.       
-00033500: 2020 2020 2068 7420 3d20 6774 2e74 6f5f       ht = gt.to_
-00033510: 6861 706c 6f74 7970 6573 2829 2e63 6f6d  haplotypes().com
-00033520: 7075 7465 2829 0a20 2020 2020 2020 2070  pute().        p
-00033530: 6f73 203d 2064 735f 6861 7073 5b22 7661  os = ds_haps["va
-00033540: 7269 616e 745f 706f 7369 7469 6f6e 225d  riant_position"]
-00033550: 2e76 616c 7565 730a 0a20 2020 2020 2020  .values..       
-00033560: 2068 312c 2068 3132 2c20 6831 3233 2c20   h1, h12, h123, 
-00033570: 6832 5f68 3120 3d20 616c 6c65 6c2e 6d6f  h2_h1 = allel.mo
-00033580: 7669 6e67 5f67 6172 7564 5f68 2868 742c  ving_garud_h(ht,
-00033590: 2073 697a 653d 7769 6e64 6f77 5f73 697a   size=window_siz
-000335a0: 6529 0a0a 2020 2020 2020 2020 7820 3d20  e)..        x = 
-000335b0: 616c 6c65 6c2e 6d6f 7669 6e67 5f73 7461  allel.moving_sta
-000335c0: 7469 7374 6963 2870 6f73 2c20 7374 6174  tistic(pos, stat
-000335d0: 6973 7469 633d 6e70 2e6d 6561 6e2c 2073  istic=np.mean, s
-000335e0: 697a 653d 7769 6e64 6f77 5f73 697a 6529  ize=window_size)
-000335f0: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00033600: 7320 3d20 6469 6374 2878 3d78 2c20 6831  s = dict(x=x, h1
-00033610: 323d 6831 3229 0a0a 2020 2020 2020 2020  2=h12)..        
-00033620: 7265 7475 726e 2072 6573 756c 7473 0a0a  return results..
-00033630: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
-00033640: 2020 7375 6d6d 6172 793d 2250 6c6f 7420    summary="Plot 
-00033650: 6831 3220 4757 5353 2064 6174 612e 222c  h12 GWSS data.",
-00033660: 0a20 2020 2029 0a20 2020 2064 6566 2070  .    ).    def p
-00033670: 6c6f 745f 6831 325f 6777 7373 5f74 7261  lot_h12_gwss_tra
-00033680: 636b 280a 2020 2020 2020 2020 7365 6c66  ck(.        self
-00033690: 2c0a 2020 2020 2020 2020 636f 6e74 6967  ,.        contig
-000336a0: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
-000336b0: 6e74 6967 2c0a 2020 2020 2020 2020 7769  ntig,.        wi
-000336c0: 6e64 6f77 5f73 697a 653a 2068 3132 5f70  ndow_size: h12_p
-000336d0: 6172 616d 732e 7769 6e64 6f77 5f73 697a  arams.window_siz
-000336e0: 652c 0a20 2020 2020 2020 2061 6e61 6c79  e,.        analy
-000336f0: 7369 733a 2068 6170 5f70 6172 616d 732e  sis: hap_params.
-00033700: 616e 616c 7973 6973 203d 2044 4546 4155  analysis = DEFAU
-00033710: 4c54 2c0a 2020 2020 2020 2020 7361 6d70  LT,.        samp
-00033720: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
-00033730: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-00033740: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
-00033750: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
-00033760: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
-00033770: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-00033780: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
-00033790: 6e65 2c0a 2020 2020 2020 2020 636f 686f  ne,.        coho
-000337a0: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-000337b0: 6c5b 6261 7365 5f70 6172 616d 732e 636f  l[base_params.co
-000337c0: 686f 7274 5f73 697a 655d 203d 2068 3132  hort_size] = h12
-000337d0: 5f70 6172 616d 732e 636f 686f 7274 5f73  _params.cohort_s
-000337e0: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
-000337f0: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-00033800: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b0a  size: Optional[.
-00033810: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00033820: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
-00033830: 7274 5f73 697a 650a 2020 2020 2020 2020  rt_size.        
-00033840: 5d20 3d20 6831 325f 7061 7261 6d73 2e6d  ] = h12_params.m
-00033850: 696e 5f63 6f68 6f72 745f 7369 7a65 5f64  in_cohort_size_d
-00033860: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-00033870: 6d61 785f 636f 686f 7274 5f73 697a 653a  max_cohort_size:
-00033880: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-00033890: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
-000338a0: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
-000338b0: 7a65 0a20 2020 2020 2020 205d 203d 2068  ze.        ] = h
-000338c0: 3132 5f70 6172 616d 732e 6d61 785f 636f  12_params.max_co
-000338d0: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
-000338e0: 742c 0a20 2020 2020 2020 2072 616e 646f  t,.        rando
-000338f0: 6d5f 7365 6564 3a20 6261 7365 5f70 6172  m_seed: base_par
-00033900: 616d 732e 7261 6e64 6f6d 5f73 6565 6420  ams.random_seed 
-00033910: 3d20 3432 2c0a 2020 2020 2020 2020 7469  = 42,.        ti
-00033920: 746c 653a 204f 7074 696f 6e61 6c5b 6770  tle: Optional[gp
-00033930: 6c74 5f70 6172 616d 732e 7469 746c 655d  lt_params.title]
-00033940: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00033950: 2073 697a 696e 675f 6d6f 6465 3a20 6770   sizing_mode: gp
-00033960: 6c74 5f70 6172 616d 732e 7369 7a69 6e67  lt_params.sizing
-00033970: 5f6d 6f64 6520 3d20 6770 6c74 5f70 6172  _mode = gplt_par
-00033980: 616d 732e 7369 7a69 6e67 5f6d 6f64 655f  ams.sizing_mode_
-00033990: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-000339a0: 2077 6964 7468 3a20 6770 6c74 5f70 6172   width: gplt_par
-000339b0: 616d 732e 7769 6474 6820 3d20 6770 6c74  ams.width = gplt
-000339c0: 5f70 6172 616d 732e 7769 6474 685f 6465  _params.width_de
-000339d0: 6661 756c 742c 0a20 2020 2020 2020 2068  fault,.        h
-000339e0: 6569 6768 743a 2067 706c 745f 7061 7261  eight: gplt_para
-000339f0: 6d73 2e68 6569 6768 7420 3d20 3230 302c  ms.height = 200,
-00033a00: 0a20 2020 2020 2020 2073 686f 773a 2067  .        show: g
-00033a10: 706c 745f 7061 7261 6d73 2e73 686f 7720  plt_params.show 
-00033a20: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00033a30: 785f 7261 6e67 653a 204f 7074 696f 6e61  x_range: Optiona
-00033a40: 6c5b 6770 6c74 5f70 6172 616d 732e 785f  l[gplt_params.x_
-00033a50: 7261 6e67 655d 203d 204e 6f6e 652c 0a20  range] = None,. 
-00033a60: 2020 2029 202d 3e20 6770 6c74 5f70 6172     ) -> gplt_par
-00033a70: 616d 732e 6669 6775 7265 3a0a 2020 2020  ams.figure:.    
-00033a80: 2020 2020 2320 636f 6d70 7574 6520 4831      # compute H1
-00033a90: 320a 2020 2020 2020 2020 782c 2068 3132  2.        x, h12
-00033aa0: 203d 2073 656c 662e 6831 325f 6777 7373   = self.h12_gwss
-00033ab0: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
-00033ac0: 6e74 6967 3d63 6f6e 7469 672c 0a20 2020  ntig=contig,.   
-00033ad0: 2020 2020 2020 2020 2061 6e61 6c79 7369           analysi
-00033ae0: 733d 616e 616c 7973 6973 2c0a 2020 2020  s=analysis,.    
-00033af0: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
-00033b00: 697a 653d 7769 6e64 6f77 5f73 697a 652c  ize=window_size,
-00033b10: 0a20 2020 2020 2020 2020 2020 2063 6f68  .            coh
-00033b20: 6f72 745f 7369 7a65 3d63 6f68 6f72 745f  ort_size=cohort_
-00033b30: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-00033b40: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
-00033b50: 653d 6d69 6e5f 636f 686f 7274 5f73 697a  e=min_cohort_siz
-00033b60: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-00033b70: 6178 5f63 6f68 6f72 745f 7369 7a65 3d6d  ax_cohort_size=m
-00033b80: 6178 5f63 6f68 6f72 745f 7369 7a65 2c0a  ax_cohort_size,.
-00033b90: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00033ba0: 6c65 5f71 7565 7279 3d73 616d 706c 655f  le_query=sample_
-00033bb0: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
-00033bc0: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-00033bd0: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
-00033be0: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-00033bf0: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00033c00: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00033c10: 2020 2020 2320 6465 7465 726d 696e 6520      # determine 
-00033c20: 5820 6178 6973 2072 616e 6765 0a20 2020  X axis range.   
-00033c30: 2020 2020 2078 5f6d 696e 203d 2078 5b30       x_min = x[0
-00033c40: 5d0a 2020 2020 2020 2020 785f 6d61 7820  ].        x_max 
-00033c50: 3d20 785b 2d31 5d0a 2020 2020 2020 2020  = x[-1].        
-00033c60: 6966 2078 5f72 616e 6765 2069 7320 4e6f  if x_range is No
-00033c70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00033c80: 785f 7261 6e67 6520 3d20 626f 6b65 682e  x_range = bokeh.
-00033c90: 6d6f 6465 6c73 2e52 616e 6765 3164 2878  models.Range1d(x
-00033ca0: 5f6d 696e 2c20 785f 6d61 782c 2062 6f75  _min, x_max, bou
-00033cb0: 6e64 733d 2261 7574 6f22 290a 0a20 2020  nds="auto")..   
-00033cc0: 2020 2020 2023 2063 7265 6174 6520 6120       # create a 
-00033cd0: 6669 6775 7265 0a20 2020 2020 2020 2078  figure.        x
-00033ce0: 7768 6565 6c5f 7a6f 6f6d 203d 2062 6f6b  wheel_zoom = bok
-00033cf0: 6568 2e6d 6f64 656c 732e 5768 6565 6c5a  eh.models.WheelZ
-00033d00: 6f6f 6d54 6f6f 6c28 0a20 2020 2020 2020  oomTool(.       
-00033d10: 2020 2020 2064 696d 656e 7369 6f6e 733d       dimensions=
-00033d20: 2277 6964 7468 222c 206d 6169 6e74 6169  "width", maintai
-00033d30: 6e5f 666f 6375 733d 4661 6c73 650a 2020  n_focus=False.  
-00033d40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00033d50: 6966 2074 6974 6c65 2069 7320 4e6f 6e65  if title is None
-00033d60: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
-00033d70: 746c 6520 3d20 7361 6d70 6c65 5f71 7565  tle = sample_que
-00033d80: 7279 0a20 2020 2020 2020 2066 6967 203d  ry.        fig =
-00033d90: 2062 6f6b 6568 2e70 6c6f 7474 696e 672e   bokeh.plotting.
-00033da0: 6669 6775 7265 280a 2020 2020 2020 2020  figure(.        
-00033db0: 2020 2020 7469 746c 653d 7469 746c 652c      title=title,
-00033dc0: 0a20 2020 2020 2020 2020 2020 2074 6f6f  .            too
-00033dd0: 6c73 3d5b 2278 7061 6e22 2c20 2278 7a6f  ls=["xpan", "xzo
-00033de0: 6f6d 5f69 6e22 2c20 2278 7a6f 6f6d 5f6f  om_in", "xzoom_o
-00033df0: 7574 222c 2078 7768 6565 6c5f 7a6f 6f6d  ut", xwheel_zoom
-00033e00: 2c20 2272 6573 6574 225d 2c0a 2020 2020  , "reset"],.    
-00033e10: 2020 2020 2020 2020 6163 7469 7665 5f73          active_s
-00033e20: 6372 6f6c 6c3d 7877 6865 656c 5f7a 6f6f  croll=xwheel_zoo
-00033e30: 6d2c 0a20 2020 2020 2020 2020 2020 2061  m,.            a
-00033e40: 6374 6976 655f 6472 6167 3d22 7870 616e  ctive_drag="xpan
-00033e50: 222c 0a20 2020 2020 2020 2020 2020 2073  ",.            s
-00033e60: 697a 696e 675f 6d6f 6465 3d73 697a 696e  izing_mode=sizin
-00033e70: 675f 6d6f 6465 2c0a 2020 2020 2020 2020  g_mode,.        
-00033e80: 2020 2020 7769 6474 683d 7769 6474 682c      width=width,
-00033e90: 0a20 2020 2020 2020 2020 2020 2068 6569  .            hei
-00033ea0: 6768 743d 6865 6967 6874 2c0a 2020 2020  ght=height,.    
-00033eb0: 2020 2020 2020 2020 746f 6f6c 6261 725f          toolbar_
-00033ec0: 6c6f 6361 7469 6f6e 3d22 6162 6f76 6522  location="above"
-00033ed0: 2c0a 2020 2020 2020 2020 2020 2020 785f  ,.            x_
-00033ee0: 7261 6e67 653d 785f 7261 6e67 652c 0a20  range=x_range,. 
-00033ef0: 2020 2020 2020 2020 2020 2079 5f72 616e             y_ran
-00033f00: 6765 3d28 302c 2031 292c 0a20 2020 2020  ge=(0, 1),.     
-00033f10: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00033f20: 706c 6f74 2048 3132 0a20 2020 2020 2020  plot H12.       
-00033f30: 2066 6967 2e63 6972 636c 6528 0a20 2020   fig.circle(.   
-00033f40: 2020 2020 2020 2020 2078 3d78 2c0a 2020           x=x,.  
-00033f50: 2020 2020 2020 2020 2020 793d 6831 322c            y=h12,
-00033f60: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
-00033f70: 653d 332c 0a20 2020 2020 2020 2020 2020  e=3,.           
-00033f80: 206c 696e 655f 7769 6474 683d 302e 352c   line_width=0.5,
-00033f90: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-00033fa0: 655f 636f 6c6f 723d 2262 6c61 636b 222c  e_color="black",
-00033fb0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00033fc0: 6c5f 636f 6c6f 723d 4e6f 6e65 2c0a 2020  l_color=None,.  
-00033fd0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00033fe0: 2023 2074 6964 7920 7570 2074 6865 2070   # tidy up the p
-00033ff0: 6c6f 740a 2020 2020 2020 2020 6669 672e  lot.        fig.
-00034000: 7961 7869 732e 6178 6973 5f6c 6162 656c  yaxis.axis_label
-00034010: 203d 2022 4831 3222 0a20 2020 2020 2020   = "H12".       
-00034020: 2066 6967 2e79 6178 6973 2e74 6963 6b65   fig.yaxis.ticke
-00034030: 7220 3d20 5b30 2c20 315d 0a20 2020 2020  r = [0, 1].     
-00034040: 2020 2073 656c 662e 5f62 6f6b 6568 5f73     self._bokeh_s
-00034050: 7479 6c65 5f67 656e 6f6d 655f 7861 7869  tyle_genome_xaxi
-00034060: 7328 6669 672c 2063 6f6e 7469 6729 0a0a  s(fig, contig)..
-00034070: 2020 2020 2020 2020 6966 2073 686f 773a          if show:
-00034080: 0a20 2020 2020 2020 2020 2020 2062 6f6b  .            bok
-00034090: 6568 2e70 6c6f 7474 696e 672e 7368 6f77  eh.plotting.show
-000340a0: 2866 6967 290a 0a20 2020 2020 2020 2072  (fig)..        r
-000340b0: 6574 7572 6e20 6669 670a 0a20 2020 2040  eturn fig..    @
-000340c0: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-000340d0: 6d61 7279 3d22 506c 6f74 2068 3132 2047  mary="Plot h12 G
-000340e0: 5753 5320 6461 7461 2e22 2c0a 2020 2020  WSS data.",.    
-000340f0: 290a 2020 2020 6465 6620 706c 6f74 5f68  ).    def plot_h
-00034100: 3132 5f67 7773 7328 0a20 2020 2020 2020  12_gwss(.       
-00034110: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
-00034120: 6f6e 7469 673a 2062 6173 655f 7061 7261  ontig: base_para
-00034130: 6d73 2e63 6f6e 7469 672c 0a20 2020 2020  ms.contig,.     
-00034140: 2020 2077 696e 646f 775f 7369 7a65 3a20     window_size: 
-00034150: 6831 325f 7061 7261 6d73 2e77 696e 646f  h12_params.windo
-00034160: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
-00034170: 616e 616c 7973 6973 3a20 6861 705f 7061  analysis: hap_pa
-00034180: 7261 6d73 2e61 6e61 6c79 7369 7320 3d20  rams.analysis = 
-00034190: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
-000341a0: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
-000341b0: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-000341c0: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
-000341d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000341e0: 7361 6d70 6c65 5f71 7565 7279 3a20 4f70  sample_query: Op
-000341f0: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-00034200: 6d73 2e73 616d 706c 655f 7175 6572 795d  ms.sample_query]
-00034210: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00034220: 2063 6f68 6f72 745f 7369 7a65 3a20 4f70   cohort_size: Op
-00034230: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-00034240: 6d73 2e63 6f68 6f72 745f 7369 7a65 5d20  ms.cohort_size] 
-00034250: 3d20 6831 325f 7061 7261 6d73 2e63 6f68  = h12_params.coh
-00034260: 6f72 745f 7369 7a65 5f64 6566 6175 6c74  ort_size_default
-00034270: 2c0a 2020 2020 2020 2020 6d69 6e5f 636f  ,.        min_co
-00034280: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
-00034290: 6e61 6c5b 0a20 2020 2020 2020 2020 2020  nal[.           
-000342a0: 2062 6173 655f 7061 7261 6d73 2e6d 696e   base_params.min
-000342b0: 5f63 6f68 6f72 745f 7369 7a65 0a20 2020  _cohort_size.   
-000342c0: 2020 2020 205d 203d 2068 3132 5f70 6172       ] = h12_par
-000342d0: 616d 732e 6d69 6e5f 636f 686f 7274 5f73  ams.min_cohort_s
-000342e0: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
-000342f0: 2020 2020 206d 6178 5f63 6f68 6f72 745f       max_cohort_
-00034300: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b0a  size: Optional[.
-00034310: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00034320: 5f70 6172 616d 732e 6d61 785f 636f 686f  _params.max_coho
-00034330: 7274 5f73 697a 650a 2020 2020 2020 2020  rt_size.        
-00034340: 5d20 3d20 6831 325f 7061 7261 6d73 2e6d  ] = h12_params.m
-00034350: 6178 5f63 6f68 6f72 745f 7369 7a65 5f64  ax_cohort_size_d
-00034360: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-00034370: 7261 6e64 6f6d 5f73 6565 643a 2062 6173  random_seed: bas
-00034380: 655f 7061 7261 6d73 2e72 616e 646f 6d5f  e_params.random_
-00034390: 7365 6564 203d 2034 322c 0a20 2020 2020  seed = 42,.     
-000343a0: 2020 2074 6974 6c65 3a20 4f70 7469 6f6e     title: Option
-000343b0: 616c 5b67 706c 745f 7061 7261 6d73 2e74  al[gplt_params.t
-000343c0: 6974 6c65 5d20 3d20 4e6f 6e65 2c0a 2020  itle] = None,.  
-000343d0: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-000343e0: 653a 2067 706c 745f 7061 7261 6d73 2e73  e: gplt_params.s
-000343f0: 697a 696e 675f 6d6f 6465 203d 2067 706c  izing_mode = gpl
-00034400: 745f 7061 7261 6d73 2e73 697a 696e 675f  t_params.sizing_
-00034410: 6d6f 6465 5f64 6566 6175 6c74 2c0a 2020  mode_default,.  
-00034420: 2020 2020 2020 7769 6474 683a 2067 706c        width: gpl
-00034430: 745f 7061 7261 6d73 2e77 6964 7468 203d  t_params.width =
-00034440: 2067 706c 745f 7061 7261 6d73 2e77 6964   gplt_params.wid
-00034450: 7468 5f64 6566 6175 6c74 2c0a 2020 2020  th_default,.    
-00034460: 2020 2020 7472 6163 6b5f 6865 6967 6874      track_height
-00034470: 3a20 6770 6c74 5f70 6172 616d 732e 7472  : gplt_params.tr
-00034480: 6163 6b5f 6865 6967 6874 203d 2031 3730  ack_height = 170
-00034490: 2c0a 2020 2020 2020 2020 6765 6e65 735f  ,.        genes_
-000344a0: 6865 6967 6874 3a20 6770 6c74 5f70 6172  height: gplt_par
-000344b0: 616d 732e 6765 6e65 735f 6865 6967 6874  ams.genes_height
-000344c0: 203d 2067 706c 745f 7061 7261 6d73 2e67   = gplt_params.g
-000344d0: 656e 6573 5f68 6569 6768 745f 6465 6661  enes_height_defa
-000344e0: 756c 742c 0a20 2020 2029 202d 3e20 4e6f  ult,.    ) -> No
-000344f0: 6e65 3a0a 2020 2020 2020 2020 2320 6777  ne:.        # gw
-00034500: 7373 2074 7261 636b 0a20 2020 2020 2020  ss track.       
-00034510: 2066 6967 3120 3d20 7365 6c66 2e70 6c6f   fig1 = self.plo
-00034520: 745f 6831 325f 6777 7373 5f74 7261 636b  t_h12_gwss_track
-00034530: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
-00034540: 6e74 6967 3d63 6f6e 7469 672c 0a20 2020  ntig=contig,.   
-00034550: 2020 2020 2020 2020 2061 6e61 6c79 7369           analysi
-00034560: 733d 616e 616c 7973 6973 2c0a 2020 2020  s=analysis,.    
-00034570: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
-00034580: 697a 653d 7769 6e64 6f77 5f73 697a 652c  ize=window_size,
-00034590: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-000345a0: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-000345b0: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
-000345c0: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
-000345d0: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
-000345e0: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
-000345f0: 7369 7a65 3d63 6f68 6f72 745f 7369 7a65  size=cohort_size
-00034600: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-00034610: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
-00034620: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-00034630: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-00034640: 6f68 6f72 745f 7369 7a65 3d6d 6178 5f63  ohort_size=max_c
-00034650: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00034660: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-00034670: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00034680: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
-00034690: 6c65 3d74 6974 6c65 2c0a 2020 2020 2020  le=title,.      
-000346a0: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-000346b0: 653d 7369 7a69 6e67 5f6d 6f64 652c 0a20  e=sizing_mode,. 
-000346c0: 2020 2020 2020 2020 2020 2077 6964 7468             width
-000346d0: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
-000346e0: 2020 2020 6865 6967 6874 3d74 7261 636b      height=track
-000346f0: 5f68 6569 6768 742c 0a20 2020 2020 2020  _height,.       
-00034700: 2020 2020 2073 686f 773d 4661 6c73 652c       show=False,
-00034710: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00034720: 2020 2020 6669 6731 2e78 6178 6973 2e76      fig1.xaxis.v
-00034730: 6973 6962 6c65 203d 2046 616c 7365 0a0a  isible = False..
-00034740: 2020 2020 2020 2020 2320 706c 6f74 2067          # plot g
-00034750: 656e 6573 0a20 2020 2020 2020 2066 6967  enes.        fig
-00034760: 3220 3d20 7365 6c66 2e70 6c6f 745f 6765  2 = self.plot_ge
-00034770: 6e65 7328 0a20 2020 2020 2020 2020 2020  nes(.           
-00034780: 2072 6567 696f 6e3d 636f 6e74 6967 2c0a   region=contig,.
-00034790: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
-000347a0: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
-000347b0: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
-000347c0: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
-000347d0: 2020 2020 2020 2020 2020 6865 6967 6874            height
-000347e0: 3d67 656e 6573 5f68 6569 6768 742c 0a20  =genes_height,. 
-000347f0: 2020 2020 2020 2020 2020 2078 5f72 616e             x_ran
-00034800: 6765 3d66 6967 312e 785f 7261 6e67 652c  ge=fig1.x_range,
-00034810: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-00034820: 773d 4661 6c73 652c 0a20 2020 2020 2020  w=False,.       
-00034830: 2029 0a0a 2020 2020 2020 2020 2320 636f   )..        # co
-00034840: 6d62 696e 6520 706c 6f74 7320 696e 746f  mbine plots into
-00034850: 2061 2073 696e 676c 6520 6669 6775 7265   a single figure
-00034860: 0a20 2020 2020 2020 2066 6967 203d 2062  .        fig = b
-00034870: 6f6b 6568 2e6c 6179 6f75 7473 2e67 7269  okeh.layouts.gri
-00034880: 6470 6c6f 7428 0a20 2020 2020 2020 2020  dplot(.         
-00034890: 2020 205b 6669 6731 2c20 6669 6732 5d2c     [fig1, fig2],
-000348a0: 0a20 2020 2020 2020 2020 2020 206e 636f  .            nco
-000348b0: 6c73 3d31 2c0a 2020 2020 2020 2020 2020  ls=1,.          
-000348c0: 2020 746f 6f6c 6261 725f 6c6f 6361 7469    toolbar_locati
-000348d0: 6f6e 3d22 6162 6f76 6522 2c0a 2020 2020  on="above",.    
-000348e0: 2020 2020 2020 2020 6d65 7267 655f 746f          merge_to
-000348f0: 6f6c 733d 5472 7565 2c0a 2020 2020 2020  ols=True,.      
-00034900: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-00034910: 653d 7369 7a69 6e67 5f6d 6f64 652c 0a20  e=sizing_mode,. 
-00034920: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00034930: 2020 626f 6b65 682e 706c 6f74 7469 6e67    bokeh.plotting
-00034940: 2e73 686f 7728 6669 6729 0a0a 2020 2020  .show(fig)..    
-00034950: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
-00034960: 6d6d 6172 793d 2222 220a 2020 2020 2020  mmary=""".      
-00034970: 2020 2020 2020 5275 6e20 6120 4831 5820        Run a H1X 
-00034980: 6765 6e6f 6d65 2d77 6964 6520 7363 616e  genome-wide scan
-00034990: 2074 6f20 6465 7465 6374 2067 656e 6f6d   to detect genom
-000349a0: 6520 7265 6769 6f6e 7320 7769 7468 0a20  e regions with. 
-000349b0: 2020 2020 2020 2020 2020 2073 6861 7265             share
-000349c0: 6420 7365 6c65 6374 6976 6520 7377 6565  d selective swee
-000349d0: 7073 2062 6574 7765 656e 2074 776f 2063  ps between two c
-000349e0: 6f68 6f72 7473 2e0a 2020 2020 2020 2020  ohorts..        
-000349f0: 2222 222c 0a20 2020 2020 2020 2072 6574  """,.        ret
-00034a00: 7572 6e73 3d64 6963 7428 0a20 2020 2020  urns=dict(.     
-00034a10: 2020 2020 2020 2078 3d22 416e 2061 7272         x="An arr
-00034a20: 6179 2063 6f6e 7461 696e 696e 6720 7468  ay containing th
-00034a30: 6520 7769 6e64 6f77 2063 656e 7472 6520  e window centre 
-00034a40: 706f 696e 7420 6765 6e6f 6d69 6320 706f  point genomic po
-00034a50: 7369 7469 6f6e 732e 222c 0a20 2020 2020  sitions.",.     
-00034a60: 2020 2020 2020 2068 3178 3d22 416e 2061         h1x="An a
-00034a70: 7272 6179 2077 6974 6820 4831 5820 7374  rray with H1X st
-00034a80: 6174 6973 7469 6320 7661 6c75 6573 2066  atistic values f
-00034a90: 6f72 2065 6163 6820 7769 6e64 6f77 2e22  or each window."
-00034aa0: 2c0a 2020 2020 2020 2020 292c 0a20 2020  ,.        ),.   
-00034ab0: 2029 0a20 2020 2064 6566 2068 3178 5f67   ).    def h1x_g
-00034ac0: 7773 7328 0a20 2020 2020 2020 2073 656c  wss(.        sel
-00034ad0: 662c 0a20 2020 2020 2020 2063 6f6e 7469  f,.        conti
-00034ae0: 673a 2062 6173 655f 7061 7261 6d73 2e63  g: base_params.c
-00034af0: 6f6e 7469 672c 0a20 2020 2020 2020 2077  ontig,.        w
-00034b00: 696e 646f 775f 7369 7a65 3a20 6831 325f  indow_size: h12_
-00034b10: 7061 7261 6d73 2e77 696e 646f 775f 7369  params.window_si
-00034b20: 7a65 2c0a 2020 2020 2020 2020 636f 686f  ze,.        coho
-00034b30: 7274 315f 7175 6572 793a 2062 6173 655f  rt1_query: base_
-00034b40: 7061 7261 6d73 2e73 616d 706c 655f 7175  params.sample_qu
-00034b50: 6572 792c 0a20 2020 2020 2020 2063 6f68  ery,.        coh
-00034b60: 6f72 7432 5f71 7565 7279 3a20 6261 7365  ort2_query: base
-00034b70: 5f70 6172 616d 732e 7361 6d70 6c65 5f71  _params.sample_q
-00034b80: 7565 7279 2c0a 2020 2020 2020 2020 616e  uery,.        an
-00034b90: 616c 7973 6973 3a20 6861 705f 7061 7261  alysis: hap_para
-00034ba0: 6d73 2e61 6e61 6c79 7369 7320 3d20 4445  ms.analysis = DE
-00034bb0: 4641 554c 542c 0a20 2020 2020 2020 2073  FAULT,.        s
-00034bc0: 616d 706c 655f 7365 7473 3a20 4f70 7469  ample_sets: Opti
-00034bd0: 6f6e 616c 5b62 6173 655f 7061 7261 6d73  onal[base_params
-00034be0: 2e73 616d 706c 655f 7365 7473 5d20 3d20  .sample_sets] = 
-00034bf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
-00034c00: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
-00034c10: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
-00034c20: 636f 686f 7274 5f73 697a 655d 203d 2068  cohort_size] = h
-00034c30: 3132 5f70 6172 616d 732e 636f 686f 7274  12_params.cohort
-00034c40: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
-00034c50: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
-00034c60: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
-00034c70: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
-00034c80: 7365 5f70 6172 616d 732e 6d69 6e5f 636f  se_params.min_co
-00034c90: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
-00034ca0: 2020 5d20 3d20 6831 325f 7061 7261 6d73    ] = h12_params
-00034cb0: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
-00034cc0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-00034cd0: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
-00034ce0: 653a 204f 7074 696f 6e61 6c5b 0a20 2020  e: Optional[.   
-00034cf0: 2020 2020 2020 2020 2062 6173 655f 7061           base_pa
-00034d00: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
-00034d10: 7369 7a65 0a20 2020 2020 2020 205d 203d  size.        ] =
-00034d20: 2068 3132 5f70 6172 616d 732e 6d61 785f   h12_params.max_
-00034d30: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
-00034d40: 756c 742c 0a20 2020 2020 2020 2072 616e  ult,.        ran
-00034d50: 646f 6d5f 7365 6564 3a20 6261 7365 5f70  dom_seed: base_p
-00034d60: 6172 616d 732e 7261 6e64 6f6d 5f73 6565  arams.random_see
-00034d70: 6420 3d20 3432 2c0a 2020 2020 2920 2d3e  d = 42,.    ) ->
-00034d80: 2054 7570 6c65 5b6e 702e 6e64 6172 7261   Tuple[np.ndarra
-00034d90: 792c 206e 702e 6e64 6172 7261 795d 3a0a  y, np.ndarray]:.
-00034da0: 2020 2020 2020 2020 2320 6368 616e 6765          # change
-00034db0: 2074 6869 7320 6e61 6d65 2069 6620 796f   this name if yo
-00034dc0: 7520 6576 6572 2063 6861 6e67 6520 7468  u ever change th
-00034dd0: 6520 6265 6861 7669 6f75 7220 6f66 2074  e behaviour of t
-00034de0: 6869 7320 6675 6e63 7469 6f6e 2c20 746f  his function, to
-00034df0: 0a20 2020 2020 2020 2023 2069 6e76 616c  .        # inval
-00034e00: 6964 6174 6520 616e 7920 7072 6576 696f  idate any previo
-00034e10: 7573 6c79 2063 6163 6865 6420 6461 7461  usly cached data
-00034e20: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-00034e30: 7365 6c66 2e5f 6831 785f 6777 7373 5f63  self._h1x_gwss_c
-00034e40: 6163 6865 5f6e 616d 650a 0a20 2020 2020  ache_name..     
-00034e50: 2020 2070 6172 616d 7320 3d20 6469 6374     params = dict
-00034e60: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
-00034e70: 6e74 6967 3d63 6f6e 7469 672c 0a20 2020  ntig=contig,.   
-00034e80: 2020 2020 2020 2020 2061 6e61 6c79 7369           analysi
-00034e90: 733d 7365 6c66 2e5f 7072 6570 5f70 6861  s=self._prep_pha
-00034ea0: 7369 6e67 5f61 6e61 6c79 7369 735f 7061  sing_analysis_pa
-00034eb0: 7261 6d28 616e 616c 7973 6973 3d61 6e61  ram(analysis=ana
-00034ec0: 6c79 7369 7329 2c0a 2020 2020 2020 2020  lysis),.        
-00034ed0: 2020 2020 7769 6e64 6f77 5f73 697a 653d      window_size=
-00034ee0: 7769 6e64 6f77 5f73 697a 652c 0a20 2020  window_size,.   
-00034ef0: 2020 2020 2020 2020 2023 204e 2e42 2e2c           # N.B.,
-00034f00: 2064 6f20 6e6f 7420 6265 2074 656d 7074   do not be tempt
-00034f10: 6564 2074 6f20 636f 6e76 6572 7420 7468  ed to convert th
-00034f20: 6573 6520 7361 6d70 6c65 2071 7565 7269  ese sample queri
-00034f30: 6573 2069 6e74 6f20 696e 7465 6765 720a  es into integer.
-00034f40: 2020 2020 2020 2020 2020 2020 2320 696e              # in
-00034f50: 6469 6365 7320 7573 696e 6720 5f70 7265  dices using _pre
-00034f60: 705f 7361 6d70 6c65 5f73 656c 6563 7469  p_sample_selecti
-00034f70: 6f6e 5f70 6172 616d 732c 2062 6563 6175  on_params, becau
-00034f80: 7365 2074 6865 2069 6e64 6963 6573 0a20  se the indices. 
-00034f90: 2020 2020 2020 2020 2020 2023 2061 7265             # are
-00034fa0: 2064 6966 6665 7265 6e74 2069 6e20 7468   different in th
-00034fb0: 6520 6861 706c 6f74 7970 6520 6461 7461  e haplotype data
-00034fc0: 2e0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00034fd0: 686f 7274 315f 7175 6572 793d 636f 686f  hort1_query=coho
-00034fe0: 7274 315f 7175 6572 792c 0a20 2020 2020  rt1_query,.     
-00034ff0: 2020 2020 2020 2063 6f68 6f72 7432 5f71         cohort2_q
-00035000: 7565 7279 3d63 6f68 6f72 7432 5f71 7565  uery=cohort2_que
-00035010: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-00035020: 7361 6d70 6c65 5f73 6574 733d 7365 6c66  sample_sets=self
-00035030: 2e5f 7072 6570 5f73 616d 706c 655f 7365  ._prep_sample_se
-00035040: 7473 5f70 6172 616d 2873 616d 706c 655f  ts_param(sample_
-00035050: 7365 7473 3d73 616d 706c 655f 7365 7473  sets=sample_sets
-00035060: 292c 0a20 2020 2020 2020 2020 2020 2063  ),.            c
-00035070: 6f68 6f72 745f 7369 7a65 3d63 6f68 6f72  ohort_size=cohor
-00035080: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-00035090: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
-000350a0: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
-000350b0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-000350c0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
-000350d0: 3d6d 6178 5f63 6f68 6f72 745f 7369 7a65  =max_cohort_size
-000350e0: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
-000350f0: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
-00035100: 5f73 6565 642c 0a20 2020 2020 2020 2029  _seed,.        )
-00035110: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-00035120: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00035130: 7473 203d 2073 656c 662e 7265 7375 6c74  ts = self.result
-00035140: 735f 6361 6368 655f 6765 7428 6e61 6d65  s_cache_get(name
-00035150: 3d6e 616d 652c 2070 6172 616d 733d 7061  =name, params=pa
-00035160: 7261 6d73 290a 0a20 2020 2020 2020 2065  rams)..        e
-00035170: 7863 6570 7420 4361 6368 654d 6973 733a  xcept CacheMiss:
-00035180: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00035190: 756c 7473 203d 2073 656c 662e 5f68 3178  ults = self._h1x
-000351a0: 5f67 7773 7328 2a2a 7061 7261 6d73 290a  _gwss(**params).
-000351b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000351c0: 2e72 6573 756c 7473 5f63 6163 6865 5f73  .results_cache_s
-000351d0: 6574 286e 616d 653d 6e61 6d65 2c20 7061  et(name=name, pa
-000351e0: 7261 6d73 3d70 6172 616d 732c 2072 6573  rams=params, res
-000351f0: 756c 7473 3d72 6573 756c 7473 290a 0a20  ults=results).. 
-00035200: 2020 2020 2020 2078 203d 2072 6573 756c         x = resul
-00035210: 7473 5b22 7822 5d0a 2020 2020 2020 2020  ts["x"].        
-00035220: 6831 7820 3d20 7265 7375 6c74 735b 2268  h1x = results["h
-00035230: 3178 225d 0a0a 2020 2020 2020 2020 7265  1x"]..        re
-00035240: 7475 726e 2078 2c20 6831 780a 0a20 2020  turn x, h1x..   
-00035250: 2064 6566 205f 6831 785f 6777 7373 280a   def _h1x_gwss(.
-00035260: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00035270: 2020 2020 2020 636f 6e74 6967 2c0a 2020        contig,.  
-00035280: 2020 2020 2020 616e 616c 7973 6973 2c0a        analysis,.
-00035290: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
-000352a0: 697a 652c 0a20 2020 2020 2020 2073 616d  ize,.        sam
-000352b0: 706c 655f 7365 7473 2c0a 2020 2020 2020  ple_sets,.      
-000352c0: 2020 636f 686f 7274 315f 7175 6572 792c    cohort1_query,
-000352d0: 0a20 2020 2020 2020 2063 6f68 6f72 7432  .        cohort2
-000352e0: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-000352f0: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
-00035300: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-00035310: 7369 7a65 2c0a 2020 2020 2020 2020 6d61  size,.        ma
-00035320: 785f 636f 686f 7274 5f73 697a 652c 0a20  x_cohort_size,. 
-00035330: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-00035340: 6564 2c0a 2020 2020 293a 0a20 2020 2020  ed,.    ):.     
-00035350: 2020 2023 2061 6363 6573 7320 6861 706c     # access hapl
-00035360: 6f74 7970 6520 6461 7461 7365 7473 2066  otype datasets f
-00035370: 6f72 2065 6163 6820 636f 686f 7274 0a20  or each cohort. 
-00035380: 2020 2020 2020 2064 7331 203d 2073 656c         ds1 = sel
-00035390: 662e 6861 706c 6f74 7970 6573 280a 2020  f.haplotypes(.  
-000353a0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-000353b0: 3d63 6f6e 7469 672c 0a20 2020 2020 2020  =contig,.       
-000353c0: 2020 2020 2061 6e61 6c79 7369 733d 616e       analysis=an
-000353d0: 616c 7973 6973 2c0a 2020 2020 2020 2020  alysis,.        
-000353e0: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-000353f0: 3d63 6f68 6f72 7431 5f71 7565 7279 2c0a  =cohort1_query,.
-00035400: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00035410: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-00035420: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
-00035430: 2063 6f68 6f72 745f 7369 7a65 3d63 6f68   cohort_size=coh
-00035440: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
-00035450: 2020 2020 2020 6d69 6e5f 636f 686f 7274        min_cohort
-00035460: 5f73 697a 653d 6d69 6e5f 636f 686f 7274  _size=min_cohort
-00035470: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00035480: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
-00035490: 7a65 3d6d 6178 5f63 6f68 6f72 745f 7369  ze=max_cohort_si
-000354a0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-000354b0: 7261 6e64 6f6d 5f73 6565 643d 7261 6e64  random_seed=rand
-000354c0: 6f6d 5f73 6565 642c 0a20 2020 2020 2020  om_seed,.       
-000354d0: 2029 0a20 2020 2020 2020 2064 7332 203d   ).        ds2 =
-000354e0: 2073 656c 662e 6861 706c 6f74 7970 6573   self.haplotypes
-000354f0: 280a 2020 2020 2020 2020 2020 2020 7265  (.            re
-00035500: 6769 6f6e 3d63 6f6e 7469 672c 0a20 2020  gion=contig,.   
-00035510: 2020 2020 2020 2020 2061 6e61 6c79 7369           analysi
-00035520: 733d 616e 616c 7973 6973 2c0a 2020 2020  s=analysis,.    
-00035530: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
-00035540: 7565 7279 3d63 6f68 6f72 7432 5f71 7565  uery=cohort2_que
-00035550: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-00035560: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
-00035570: 6c65 5f73 6574 732c 0a20 2020 2020 2020  le_sets,.       
-00035580: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
-00035590: 3d63 6f68 6f72 745f 7369 7a65 2c0a 2020  =cohort_size,.  
-000355a0: 2020 2020 2020 2020 2020 6d69 6e5f 636f            min_co
-000355b0: 686f 7274 5f73 697a 653d 6d69 6e5f 636f  hort_size=min_co
-000355c0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-000355d0: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
-000355e0: 745f 7369 7a65 3d6d 6178 5f63 6f68 6f72  t_size=max_cohor
-000355f0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
-00035600: 2020 2020 7261 6e64 6f6d 5f73 6565 643d      random_seed=
-00035610: 7261 6e64 6f6d 5f73 6565 642c 0a20 2020  random_seed,.   
-00035620: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00035630: 2320 6c6f 6164 2064 6174 6120 696e 746f  # load data into
-00035640: 206d 656d 6f72 790a 2020 2020 2020 2020   memory.        
-00035650: 6774 3120 3d20 616c 6c65 6c2e 4765 6e6f  gt1 = allel.Geno
-00035660: 7479 7065 4461 736b 4172 7261 7928 6473  typeDaskArray(ds
-00035670: 315b 2263 616c 6c5f 6765 6e6f 7479 7065  1["call_genotype
-00035680: 225d 2e64 6174 6129 0a20 2020 2020 2020  "].data).       
-00035690: 2077 6974 6820 7365 6c66 2e5f 6461 736b   with self._dask
-000356a0: 5f70 726f 6772 6573 7328 6465 7363 3d22  _progress(desc="
-000356b0: 4c6f 6164 2068 6170 6c6f 7479 7065 7320  Load haplotypes 
-000356c0: 666f 7220 636f 686f 7274 2031 2229 3a0a  for cohort 1"):.
-000356d0: 2020 2020 2020 2020 2020 2020 6874 3120              ht1 
-000356e0: 3d20 6774 312e 746f 5f68 6170 6c6f 7479  = gt1.to_haploty
-000356f0: 7065 7328 292e 636f 6d70 7574 6528 290a  pes().compute().
-00035700: 2020 2020 2020 2020 6774 3220 3d20 616c          gt2 = al
-00035710: 6c65 6c2e 4765 6e6f 7479 7065 4461 736b  lel.GenotypeDask
-00035720: 4172 7261 7928 6473 325b 2263 616c 6c5f  Array(ds2["call_
-00035730: 6765 6e6f 7479 7065 225d 2e64 6174 6129  genotype"].data)
-00035740: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00035750: 6c66 2e5f 6461 736b 5f70 726f 6772 6573  lf._dask_progres
-00035760: 7328 6465 7363 3d22 4c6f 6164 2068 6170  s(desc="Load hap
-00035770: 6c6f 7479 7065 7320 666f 7220 636f 686f  lotypes for coho
-00035780: 7274 2032 2229 3a0a 2020 2020 2020 2020  rt 2"):.        
-00035790: 2020 2020 6874 3220 3d20 6774 322e 746f      ht2 = gt2.to
-000357a0: 5f68 6170 6c6f 7479 7065 7328 292e 636f  _haplotypes().co
-000357b0: 6d70 7574 6528 290a 2020 2020 2020 2020  mpute().        
-000357c0: 706f 7320 3d20 6473 315b 2276 6172 6961  pos = ds1["varia
-000357d0: 6e74 5f70 6f73 6974 696f 6e22 5d2e 7661  nt_position"].va
-000357e0: 6c75 6573 0a0a 2020 2020 2020 2020 2320  lues..        # 
-000357f0: 7275 6e20 4831 5820 7363 616e 0a20 2020  run H1X scan.   
-00035800: 2020 2020 2068 3178 203d 205f 6d6f 7669       h1x = _movi
-00035810: 6e67 5f68 3178 2868 7431 2c20 6874 322c  ng_h1x(ht1, ht2,
-00035820: 2073 697a 653d 7769 6e64 6f77 5f73 697a   size=window_siz
-00035830: 6529 0a0a 2020 2020 2020 2020 2320 636f  e)..        # co
-00035840: 6d70 7574 6520 7769 6e64 6f77 206d 6964  mpute window mid
-00035850: 706f 696e 7473 0a20 2020 2020 2020 2078  points.        x
-00035860: 203d 2061 6c6c 656c 2e6d 6f76 696e 675f   = allel.moving_
-00035870: 7374 6174 6973 7469 6328 706f 732c 2073  statistic(pos, s
-00035880: 7461 7469 7374 6963 3d6e 702e 6d65 616e  tatistic=np.mean
-00035890: 2c20 7369 7a65 3d77 696e 646f 775f 7369  , size=window_si
-000358a0: 7a65 290a 0a20 2020 2020 2020 2072 6573  ze)..        res
-000358b0: 756c 7473 203d 2064 6963 7428 783d 782c  ults = dict(x=x,
-000358c0: 2068 3178 3d68 3178 290a 0a20 2020 2020   h1x=h1x)..     
-000358d0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-000358e0: 730a 0a20 2020 2040 646f 6328 0a20 2020  s..    @doc(.   
-000358f0: 2020 2020 2073 756d 6d61 7279 3d22 2222       summary="""
-00035900: 0a20 2020 2020 2020 2020 2020 2052 756e  .            Run
-00035910: 2061 6e64 2070 6c6f 7420 6120 4831 5820   and plot a H1X 
-00035920: 6765 6e6f 6d65 2d77 6964 6520 7363 616e  genome-wide scan
-00035930: 2074 6f20 6465 7465 6374 2067 656e 6f6d   to detect genom
-00035940: 6520 7265 6769 6f6e 730a 2020 2020 2020  e regions.      
-00035950: 2020 2020 2020 7769 7468 2073 6861 7265        with share
-00035960: 6420 7365 6c65 6374 6976 6520 7377 6565  d selective swee
-00035970: 7073 2062 6574 7765 656e 2074 776f 2063  ps between two c
-00035980: 6f68 6f72 7473 2e0a 2020 2020 2020 2020  ohorts..        
-00035990: 2222 220a 2020 2020 290a 2020 2020 6465  """.    ).    de
-000359a0: 6620 706c 6f74 5f68 3178 5f67 7773 735f  f plot_h1x_gwss_
-000359b0: 7472 6163 6b28 0a20 2020 2020 2020 2073  track(.        s
-000359c0: 656c 662c 0a20 2020 2020 2020 2063 6f6e  elf,.        con
-000359d0: 7469 673a 2062 6173 655f 7061 7261 6d73  tig: base_params
-000359e0: 2e63 6f6e 7469 672c 0a20 2020 2020 2020  .contig,.       
-000359f0: 2077 696e 646f 775f 7369 7a65 3a20 6831   window_size: h1
-00035a00: 325f 7061 7261 6d73 2e77 696e 646f 775f  2_params.window_
-00035a10: 7369 7a65 2c0a 2020 2020 2020 2020 636f  size,.        co
-00035a20: 686f 7274 315f 7175 6572 793a 2062 6173  hort1_query: bas
-00035a30: 655f 7061 7261 6d73 2e63 6f68 6f72 7431  e_params.cohort1
-00035a40: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-00035a50: 636f 686f 7274 325f 7175 6572 793a 2062  cohort2_query: b
-00035a60: 6173 655f 7061 7261 6d73 2e63 6f68 6f72  ase_params.cohor
-00035a70: 7432 5f71 7565 7279 2c0a 2020 2020 2020  t2_query,.      
-00035a80: 2020 616e 616c 7973 6973 3a20 6861 705f    analysis: hap_
-00035a90: 7061 7261 6d73 2e61 6e61 6c79 7369 7320  params.analysis 
-00035aa0: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
-00035ab0: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
-00035ac0: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-00035ad0: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
-00035ae0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00035af0: 2020 636f 686f 7274 5f73 697a 653a 204f    cohort_size: O
-00035b00: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
-00035b10: 616d 732e 636f 686f 7274 5f73 697a 655d  ams.cohort_size]
-00035b20: 203d 2068 3132 5f70 6172 616d 732e 636f   = h12_params.co
-00035b30: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
-00035b40: 742c 0a20 2020 2020 2020 206d 696e 5f63  t,.        min_c
-00035b50: 6f68 6f72 745f 7369 7a65 3a20 4f70 7469  ohort_size: Opti
-00035b60: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
-00035b70: 2020 6261 7365 5f70 6172 616d 732e 6d69    base_params.mi
-00035b80: 6e5f 636f 686f 7274 5f73 697a 650a 2020  n_cohort_size.  
-00035b90: 2020 2020 2020 5d20 3d20 6831 325f 7061        ] = h12_pa
-00035ba0: 7261 6d73 2e6d 696e 5f63 6f68 6f72 745f  rams.min_cohort_
-00035bb0: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
-00035bc0: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
-00035bd0: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
-00035be0: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
-00035bf0: 655f 7061 7261 6d73 2e6d 6178 5f63 6f68  e_params.max_coh
-00035c00: 6f72 745f 7369 7a65 0a20 2020 2020 2020  ort_size.       
-00035c10: 205d 203d 2068 3132 5f70 6172 616d 732e   ] = h12_params.
-00035c20: 6d61 785f 636f 686f 7274 5f73 697a 655f  max_cohort_size_
-00035c30: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-00035c40: 2072 616e 646f 6d5f 7365 6564 3a20 6261   random_seed: ba
-00035c50: 7365 5f70 6172 616d 732e 7261 6e64 6f6d  se_params.random
-00035c60: 5f73 6565 6420 3d20 3432 2c0a 2020 2020  _seed = 42,.    
-00035c70: 2020 2020 7469 746c 653a 204f 7074 696f      title: Optio
-00035c80: 6e61 6c5b 6770 6c74 5f70 6172 616d 732e  nal[gplt_params.
-00035c90: 7469 746c 655d 203d 204e 6f6e 652c 0a20  title] = None,. 
-00035ca0: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
-00035cb0: 6465 3a20 6770 6c74 5f70 6172 616d 732e  de: gplt_params.
-00035cc0: 7369 7a69 6e67 5f6d 6f64 6520 3d20 6770  sizing_mode = gp
-00035cd0: 6c74 5f70 6172 616d 732e 7369 7a69 6e67  lt_params.sizing
-00035ce0: 5f6d 6f64 655f 6465 6661 756c 742c 0a20  _mode_default,. 
-00035cf0: 2020 2020 2020 2077 6964 7468 3a20 6770         width: gp
-00035d00: 6c74 5f70 6172 616d 732e 7769 6474 6820  lt_params.width 
-00035d10: 3d20 6770 6c74 5f70 6172 616d 732e 7769  = gplt_params.wi
-00035d20: 6474 685f 6465 6661 756c 742c 0a20 2020  dth_default,.   
-00035d30: 2020 2020 2068 6569 6768 743a 2067 706c       height: gpl
-00035d40: 745f 7061 7261 6d73 2e68 6569 6768 7420  t_params.height 
-00035d50: 3d20 3230 302c 0a20 2020 2020 2020 2073  = 200,.        s
-00035d60: 686f 773a 2067 706c 745f 7061 7261 6d73  how: gplt_params
-00035d70: 2e73 686f 7720 3d20 5472 7565 2c0a 2020  .show = True,.  
-00035d80: 2020 2020 2020 785f 7261 6e67 653a 204f        x_range: O
-00035d90: 7074 696f 6e61 6c5b 6770 6c74 5f70 6172  ptional[gplt_par
-00035da0: 616d 732e 785f 7261 6e67 655d 203d 204e  ams.x_range] = N
-00035db0: 6f6e 652c 0a20 2020 2029 202d 3e20 6770  one,.    ) -> gp
-00035dc0: 6c74 5f70 6172 616d 732e 6669 6775 7265  lt_params.figure
-00035dd0: 3a0a 2020 2020 2020 2020 2320 636f 6d70  :.        # comp
-00035de0: 7574 6520 4831 580a 2020 2020 2020 2020  ute H1X.        
-00035df0: 782c 2068 3178 203d 2073 656c 662e 6831  x, h1x = self.h1
-00035e00: 785f 6777 7373 280a 2020 2020 2020 2020  x_gwss(.        
-00035e10: 2020 2020 636f 6e74 6967 3d63 6f6e 7469      contig=conti
-00035e20: 672c 0a20 2020 2020 2020 2020 2020 2061  g,.            a
-00035e30: 6e61 6c79 7369 733d 616e 616c 7973 6973  nalysis=analysis
-00035e40: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
-00035e50: 6e64 6f77 5f73 697a 653d 7769 6e64 6f77  ndow_size=window
-00035e60: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00035e70: 2020 2063 6f68 6f72 745f 7369 7a65 3d63     cohort_size=c
-00035e80: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00035e90: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
-00035ea0: 7274 5f73 697a 653d 6d69 6e5f 636f 686f  rt_size=min_coho
-00035eb0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
-00035ec0: 2020 2020 206d 6178 5f63 6f68 6f72 745f       max_cohort_
-00035ed0: 7369 7a65 3d6d 6178 5f63 6f68 6f72 745f  size=max_cohort_
-00035ee0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-00035ef0: 2020 636f 686f 7274 315f 7175 6572 793d    cohort1_query=
-00035f00: 636f 686f 7274 315f 7175 6572 792c 0a20  cohort1_query,. 
-00035f10: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
-00035f20: 7432 5f71 7565 7279 3d63 6f68 6f72 7432  t2_query=cohort2
-00035f30: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-00035f40: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
-00035f50: 7361 6d70 6c65 5f73 6574 732c 0a20 2020  sample_sets,.   
-00035f60: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
-00035f70: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
-00035f80: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00035f90: 2020 2020 2023 2064 6574 6572 6d69 6e65       # determine
-00035fa0: 2058 2061 7869 7320 7261 6e67 650a 2020   X axis range.  
-00035fb0: 2020 2020 2020 785f 6d69 6e20 3d20 785b        x_min = x[
-00035fc0: 305d 0a20 2020 2020 2020 2078 5f6d 6178  0].        x_max
-00035fd0: 203d 2078 5b2d 315d 0a20 2020 2020 2020   = x[-1].       
-00035fe0: 2069 6620 785f 7261 6e67 6520 6973 204e   if x_range is N
-00035ff0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00036000: 2078 5f72 616e 6765 203d 2062 6f6b 6568   x_range = bokeh
-00036010: 2e6d 6f64 656c 732e 5261 6e67 6531 6428  .models.Range1d(
-00036020: 785f 6d69 6e2c 2078 5f6d 6178 2c20 626f  x_min, x_max, bo
-00036030: 756e 6473 3d22 6175 746f 2229 0a0a 2020  unds="auto")..  
-00036040: 2020 2020 2020 2320 6372 6561 7465 2061        # create a
-00036050: 2066 6967 7572 650a 2020 2020 2020 2020   figure.        
-00036060: 7877 6865 656c 5f7a 6f6f 6d20 3d20 626f  xwheel_zoom = bo
-00036070: 6b65 682e 6d6f 6465 6c73 2e57 6865 656c  keh.models.Wheel
-00036080: 5a6f 6f6d 546f 6f6c 280a 2020 2020 2020  ZoomTool(.      
-00036090: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-000360a0: 3d22 7769 6474 6822 2c20 6d61 696e 7461  ="width", mainta
-000360b0: 696e 5f66 6f63 7573 3d46 616c 7365 0a20  in_focus=False. 
-000360c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000360d0: 2069 6620 7469 746c 6520 6973 204e 6f6e   if title is Non
-000360e0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-000360f0: 6974 6c65 203d 2066 2243 6f68 6f72 7420  itle = f"Cohort 
-00036100: 313a 207b 636f 686f 7274 315f 7175 6572  1: {cohort1_quer
-00036110: 797d 5c6e 436f 686f 7274 2032 3a20 7b63  y}\nCohort 2: {c
-00036120: 6f68 6f72 7432 5f71 7565 7279 7d22 0a20  ohort2_query}". 
-00036130: 2020 2020 2020 2066 6967 203d 2062 6f6b         fig = bok
-00036140: 6568 2e70 6c6f 7474 696e 672e 6669 6775  eh.plotting.figu
-00036150: 7265 280a 2020 2020 2020 2020 2020 2020  re(.            
-00036160: 7469 746c 653d 7469 746c 652c 0a20 2020  title=title,.   
-00036170: 2020 2020 2020 2020 2074 6f6f 6c73 3d5b           tools=[
-00036180: 2278 7061 6e22 2c20 2278 7a6f 6f6d 5f69  "xpan", "xzoom_i
-00036190: 6e22 2c20 2278 7a6f 6f6d 5f6f 7574 222c  n", "xzoom_out",
-000361a0: 2078 7768 6565 6c5f 7a6f 6f6d 2c20 2272   xwheel_zoom, "r
-000361b0: 6573 6574 225d 2c0a 2020 2020 2020 2020  eset"],.        
-000361c0: 2020 2020 6163 7469 7665 5f73 6372 6f6c      active_scrol
-000361d0: 6c3d 7877 6865 656c 5f7a 6f6f 6d2c 0a20  l=xwheel_zoom,. 
-000361e0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
-000361f0: 655f 6472 6167 3d22 7870 616e 222c 0a20  e_drag="xpan",. 
-00036200: 2020 2020 2020 2020 2020 2073 697a 696e             sizin
-00036210: 675f 6d6f 6465 3d73 697a 696e 675f 6d6f  g_mode=sizing_mo
-00036220: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-00036230: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
-00036240: 2020 2020 2020 2020 2068 6569 6768 743d           height=
-00036250: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
-00036260: 2020 2020 746f 6f6c 6261 725f 6c6f 6361      toolbar_loca
-00036270: 7469 6f6e 3d22 6162 6f76 6522 2c0a 2020  tion="above",.  
-00036280: 2020 2020 2020 2020 2020 785f 7261 6e67            x_rang
-00036290: 653d 785f 7261 6e67 652c 0a20 2020 2020  e=x_range,.     
-000362a0: 2020 2020 2020 2079 5f72 616e 6765 3d28         y_range=(
-000362b0: 302c 2031 292c 0a20 2020 2020 2020 2029  0, 1),.        )
-000362c0: 0a0a 2020 2020 2020 2020 2320 706c 6f74  ..        # plot
-000362d0: 2048 3158 0a20 2020 2020 2020 2066 6967   H1X.        fig
-000362e0: 2e63 6972 636c 6528 0a20 2020 2020 2020  .circle(.       
-000362f0: 2020 2020 2078 3d78 2c0a 2020 2020 2020       x=x,.      
-00036300: 2020 2020 2020 793d 6831 782c 0a20 2020        y=h1x,.   
-00036310: 2020 2020 2020 2020 2073 697a 653d 332c           size=3,
-00036320: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-00036330: 655f 7769 6474 683d 302e 352c 0a20 2020  e_width=0.5,.   
-00036340: 2020 2020 2020 2020 206c 696e 655f 636f           line_co
-00036350: 6c6f 723d 2262 6c61 636b 222c 0a20 2020  lor="black",.   
-00036360: 2020 2020 2020 2020 2066 696c 6c5f 636f           fill_co
-00036370: 6c6f 723d 4e6f 6e65 2c0a 2020 2020 2020  lor=None,.      
-00036380: 2020 290a 0a20 2020 2020 2020 2023 2074    )..        # t
-00036390: 6964 7920 7570 2074 6865 2070 6c6f 740a  idy up the plot.
-000363a0: 2020 2020 2020 2020 6669 672e 7961 7869          fig.yaxi
-000363b0: 732e 6178 6973 5f6c 6162 656c 203d 2022  s.axis_label = "
-000363c0: 4831 5822 0a20 2020 2020 2020 2066 6967  H1X".        fig
-000363d0: 2e79 6178 6973 2e74 6963 6b65 7220 3d20  .yaxis.ticker = 
-000363e0: 5b30 2c20 315d 0a20 2020 2020 2020 2073  [0, 1].        s
-000363f0: 656c 662e 5f62 6f6b 6568 5f73 7479 6c65  elf._bokeh_style
-00036400: 5f67 656e 6f6d 655f 7861 7869 7328 6669  _genome_xaxis(fi
-00036410: 672c 2063 6f6e 7469 6729 0a0a 2020 2020  g, contig)..    
-00036420: 2020 2020 6966 2073 686f 773a 0a20 2020      if show:.   
-00036430: 2020 2020 2020 2020 2062 6f6b 6568 2e70           bokeh.p
-00036440: 6c6f 7474 696e 672e 7368 6f77 2866 6967  lotting.show(fig
-00036450: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00036460: 6e20 6669 670a 0a20 2020 2040 646f 6328  n fig..    @doc(
-00036470: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
-00036480: 3d22 2222 0a20 2020 2020 2020 2020 2020  =""".           
-00036490: 2052 756e 2061 6e64 2070 6c6f 7420 6120   Run and plot a 
-000364a0: 4831 5820 6765 6e6f 6d65 2d77 6964 6520  H1X genome-wide 
-000364b0: 7363 616e 2074 6f20 6465 7465 6374 2067  scan to detect g
-000364c0: 656e 6f6d 6520 7265 6769 6f6e 730a 2020  enome regions.  
-000364d0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-000364e0: 6861 7265 6420 7365 6c65 6374 6976 6520  hared selective 
-000364f0: 7377 6565 7073 2062 6574 7765 656e 2074  sweeps between t
-00036500: 776f 2063 6f68 6f72 7473 2e0a 2020 2020  wo cohorts..    
-00036510: 2020 2020 2222 220a 2020 2020 290a 2020      """.    ).  
-00036520: 2020 6465 6620 706c 6f74 5f68 3178 5f67    def plot_h1x_g
-00036530: 7773 7328 0a20 2020 2020 2020 2073 656c  wss(.        sel
-00036540: 662c 0a20 2020 2020 2020 2063 6f6e 7469  f,.        conti
-00036550: 673a 2062 6173 655f 7061 7261 6d73 2e63  g: base_params.c
-00036560: 6f6e 7469 672c 0a20 2020 2020 2020 2077  ontig,.        w
-00036570: 696e 646f 775f 7369 7a65 3a20 6831 325f  indow_size: h12_
-00036580: 7061 7261 6d73 2e77 696e 646f 775f 7369  params.window_si
-00036590: 7a65 2c0a 2020 2020 2020 2020 636f 686f  ze,.        coho
-000365a0: 7274 315f 7175 6572 793a 2062 6173 655f  rt1_query: base_
-000365b0: 7061 7261 6d73 2e63 6f68 6f72 7431 5f71  params.cohort1_q
-000365c0: 7565 7279 2c0a 2020 2020 2020 2020 636f  uery,.        co
-000365d0: 686f 7274 325f 7175 6572 793a 2062 6173  hort2_query: bas
-000365e0: 655f 7061 7261 6d73 2e63 6f68 6f72 7432  e_params.cohort2
-000365f0: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-00036600: 616e 616c 7973 6973 3a20 6861 705f 7061  analysis: hap_pa
-00036610: 7261 6d73 2e61 6e61 6c79 7369 7320 3d20  rams.analysis = 
-00036620: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
-00036630: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
-00036640: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
-00036650: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
-00036660: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00036670: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
-00036680: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
-00036690: 732e 636f 686f 7274 5f73 697a 655d 203d  s.cohort_size] =
-000366a0: 2068 3132 5f70 6172 616d 732e 636f 686f   h12_params.coho
-000366b0: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
-000366c0: 0a20 2020 2020 2020 206d 696e 5f63 6f68  .        min_coh
-000366d0: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
-000366e0: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
-000366f0: 6261 7365 5f70 6172 616d 732e 6d69 6e5f  base_params.min_
-00036700: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
-00036710: 2020 2020 5d20 3d20 6831 325f 7061 7261      ] = h12_para
-00036720: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
-00036730: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
-00036740: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
-00036750: 697a 653a 204f 7074 696f 6e61 6c5b 0a20  ize: Optional[. 
-00036760: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-00036770: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
-00036780: 745f 7369 7a65 0a20 2020 2020 2020 205d  t_size.        ]
-00036790: 203d 2068 3132 5f70 6172 616d 732e 6d61   = h12_params.ma
-000367a0: 785f 636f 686f 7274 5f73 697a 655f 6465  x_cohort_size_de
-000367b0: 6661 756c 742c 0a20 2020 2020 2020 2072  fault,.        r
-000367c0: 616e 646f 6d5f 7365 6564 3a20 6261 7365  andom_seed: base
-000367d0: 5f70 6172 616d 732e 7261 6e64 6f6d 5f73  _params.random_s
-000367e0: 6565 6420 3d20 3432 2c0a 2020 2020 2020  eed = 42,.      
-000367f0: 2020 7469 746c 653a 204f 7074 696f 6e61    title: Optiona
-00036800: 6c5b 6770 6c74 5f70 6172 616d 732e 7469  l[gplt_params.ti
-00036810: 746c 655d 203d 204e 6f6e 652c 0a20 2020  tle] = None,.   
-00036820: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
-00036830: 3a20 6770 6c74 5f70 6172 616d 732e 7369  : gplt_params.si
-00036840: 7a69 6e67 5f6d 6f64 6520 3d20 6770 6c74  zing_mode = gplt
-00036850: 5f70 6172 616d 732e 7369 7a69 6e67 5f6d  _params.sizing_m
-00036860: 6f64 655f 6465 6661 756c 742c 0a20 2020  ode_default,.   
-00036870: 2020 2020 2077 6964 7468 3a20 6770 6c74       width: gplt
-00036880: 5f70 6172 616d 732e 7769 6474 6820 3d20  _params.width = 
-00036890: 6770 6c74 5f70 6172 616d 732e 7769 6474  gplt_params.widt
-000368a0: 685f 6465 6661 756c 742c 0a20 2020 2020  h_default,.     
-000368b0: 2020 2074 7261 636b 5f68 6569 6768 743a     track_height:
-000368c0: 2067 706c 745f 7061 7261 6d73 2e74 7261   gplt_params.tra
-000368d0: 636b 5f68 6569 6768 7420 3d20 3139 302c  ck_height = 190,
-000368e0: 0a20 2020 2020 2020 2067 656e 6573 5f68  .        genes_h
-000368f0: 6569 6768 743a 2067 706c 745f 7061 7261  eight: gplt_para
-00036900: 6d73 2e67 656e 6573 5f68 6569 6768 7420  ms.genes_height 
-00036910: 3d20 6770 6c74 5f70 6172 616d 732e 6765  = gplt_params.ge
-00036920: 6e65 735f 6865 6967 6874 5f64 6566 6175  nes_height_defau
-00036930: 6c74 2c0a 2020 2020 2920 2d3e 204e 6f6e  lt,.    ) -> Non
-00036940: 653a 0a20 2020 2020 2020 2023 2067 7773  e:.        # gws
-00036950: 7320 7472 6163 6b0a 2020 2020 2020 2020  s track.        
-00036960: 6669 6731 203d 2073 656c 662e 706c 6f74  fig1 = self.plot
-00036970: 5f68 3178 5f67 7773 735f 7472 6163 6b28  _h1x_gwss_track(
-00036980: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00036990: 7469 673d 636f 6e74 6967 2c0a 2020 2020  tig=contig,.    
-000369a0: 2020 2020 2020 2020 616e 616c 7973 6973          analysis
-000369b0: 3d61 6e61 6c79 7369 732c 0a20 2020 2020  =analysis,.     
-000369c0: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
-000369d0: 7a65 3d77 696e 646f 775f 7369 7a65 2c0a  ze=window_size,.
-000369e0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
-000369f0: 7274 315f 7175 6572 793d 636f 686f 7274  rt1_query=cohort
-00036a00: 315f 7175 6572 792c 0a20 2020 2020 2020  1_query,.       
-00036a10: 2020 2020 2063 6f68 6f72 7432 5f71 7565       cohort2_que
-00036a20: 7279 3d63 6f68 6f72 7432 5f71 7565 7279  ry=cohort2_query
-00036a30: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
-00036a40: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
-00036a50: 5f73 6574 732c 0a20 2020 2020 2020 2020  _sets,.         
-00036a60: 2020 2063 6f68 6f72 745f 7369 7a65 3d63     cohort_size=c
-00036a70: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00036a80: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
-00036a90: 7274 5f73 697a 653d 6d69 6e5f 636f 686f  rt_size=min_coho
-00036aa0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
-00036ab0: 2020 2020 206d 6178 5f63 6f68 6f72 745f       max_cohort_
-00036ac0: 7369 7a65 3d6d 6178 5f63 6f68 6f72 745f  size=max_cohort_
-00036ad0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-00036ae0: 2020 7261 6e64 6f6d 5f73 6565 643d 7261    random_seed=ra
-00036af0: 6e64 6f6d 5f73 6565 642c 0a20 2020 2020  ndom_seed,.     
-00036b00: 2020 2020 2020 2074 6974 6c65 3d74 6974         title=tit
-00036b10: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00036b20: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-00036b30: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-00036b40: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-00036b50: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-00036b60: 6967 6874 3d74 7261 636b 5f68 6569 6768  ight=track_heigh
-00036b70: 742c 0a20 2020 2020 2020 2020 2020 2073  t,.            s
-00036b80: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
-00036b90: 2020 2029 0a0a 2020 2020 2020 2020 6669     )..        fi
-00036ba0: 6731 2e78 6178 6973 2e76 6973 6962 6c65  g1.xaxis.visible
-00036bb0: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-00036bc0: 2020 2320 706c 6f74 2067 656e 6573 0a20    # plot genes. 
-00036bd0: 2020 2020 2020 2066 6967 3220 3d20 7365         fig2 = se
-00036be0: 6c66 2e70 6c6f 745f 6765 6e65 7328 0a20  lf.plot_genes(. 
-00036bf0: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-00036c00: 6e3d 636f 6e74 6967 2c0a 2020 2020 2020  n=contig,.      
-00036c10: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-00036c20: 653d 7369 7a69 6e67 5f6d 6f64 652c 0a20  e=sizing_mode,. 
-00036c30: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00036c40: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
-00036c50: 2020 2020 6865 6967 6874 3d67 656e 6573      height=genes
-00036c60: 5f68 6569 6768 742c 0a20 2020 2020 2020  _height,.       
-00036c70: 2020 2020 2078 5f72 616e 6765 3d66 6967       x_range=fig
-00036c80: 312e 785f 7261 6e67 652c 0a20 2020 2020  1.x_range,.     
-00036c90: 2020 2020 2020 2073 686f 773d 4661 6c73         show=Fals
-00036ca0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-00036cb0: 2020 2020 2020 2320 636f 6d62 696e 6520        # combine 
-00036cc0: 706c 6f74 7320 696e 746f 2061 2073 696e  plots into a sin
-00036cd0: 676c 6520 6669 6775 7265 0a20 2020 2020  gle figure.     
-00036ce0: 2020 2066 6967 203d 2062 6f6b 6568 2e6c     fig = bokeh.l
-00036cf0: 6179 6f75 7473 2e67 7269 6470 6c6f 7428  ayouts.gridplot(
-00036d00: 0a20 2020 2020 2020 2020 2020 205b 6669  .            [fi
-00036d10: 6731 2c20 6669 6732 5d2c 0a20 2020 2020  g1, fig2],.     
-00036d20: 2020 2020 2020 206e 636f 6c73 3d31 2c0a         ncols=1,.
-00036d30: 2020 2020 2020 2020 2020 2020 746f 6f6c              tool
-00036d40: 6261 725f 6c6f 6361 7469 6f6e 3d22 6162  bar_location="ab
-00036d50: 6f76 6522 2c0a 2020 2020 2020 2020 2020  ove",.          
-00036d60: 2020 6d65 7267 655f 746f 6f6c 733d 5472    merge_tools=Tr
-00036d70: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00036d80: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-00036d90: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-00036da0: 2029 0a0a 2020 2020 2020 2020 626f 6b65   )..        boke
-00036db0: 682e 706c 6f74 7469 6e67 2e73 686f 7728  h.plotting.show(
-00036dc0: 6669 6729 0a0a 2020 2020 4064 6f63 280a  fig)..    @doc(.
-00036dd0: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-00036de0: 2252 756e 2069 4853 2047 5753 532e 222c  "Run iHS GWSS.",
-00036df0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
-00036e00: 3d64 6963 7428 0a20 2020 2020 2020 2020  =dict(.         
-00036e10: 2020 2078 3d22 416e 2061 7272 6179 2063     x="An array c
-00036e20: 6f6e 7461 696e 696e 6720 7468 6520 7769  ontaining the wi
-00036e30: 6e64 6f77 2063 656e 7472 6520 706f 696e  ndow centre poin
-00036e40: 7420 6765 6e6f 6d69 6320 706f 7369 7469  t genomic positi
-00036e50: 6f6e 732e 222c 0a20 2020 2020 2020 2020  ons.",.         
-00036e60: 2020 2069 6873 3d22 416e 2061 7272 6179     ihs="An array
-00036e70: 2077 6974 6820 6948 5320 7374 6174 6973   with iHS statis
-00036e80: 7469 6320 7661 6c75 6573 2066 6f72 2065  tic values for e
-00036e90: 6163 6820 7769 6e64 6f77 2e22 2c0a 2020  ach window.",.  
-00036ea0: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
-00036eb0: 2020 2064 6566 2069 6873 5f67 7773 7328     def ihs_gwss(
-00036ec0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00036ed0: 2020 2020 2020 2063 6f6e 7469 673a 2062         contig: b
-00036ee0: 6173 655f 7061 7261 6d73 2e63 6f6e 7469  ase_params.conti
-00036ef0: 672c 0a20 2020 2020 2020 2061 6e61 6c79  g,.        analy
-00036f00: 7369 733a 2068 6170 5f70 6172 616d 732e  sis: hap_params.
-00036f10: 616e 616c 7973 6973 203d 2044 4546 4155  analysis = DEFAU
-00036f20: 4c54 2c0a 2020 2020 2020 2020 7361 6d70  LT,.        samp
-00036f30: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
-00036f40: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-00036f50: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
-00036f60: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
-00036f70: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
-00036f80: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-00036f90: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
-00036fa0: 6e65 2c0a 2020 2020 2020 2020 7769 6e64  ne,.        wind
-00036fb0: 6f77 5f73 697a 653a 2069 6873 5f70 6172  ow_size: ihs_par
-00036fc0: 616d 732e 7769 6e64 6f77 5f73 697a 6520  ams.window_size 
-00036fd0: 3d20 6968 735f 7061 7261 6d73 2e77 696e  = ihs_params.win
-00036fe0: 646f 775f 7369 7a65 5f64 6566 6175 6c74  dow_size_default
-00036ff0: 2c0a 2020 2020 2020 2020 7065 7263 656e  ,.        percen
-00037000: 7469 6c65 733a 2069 6873 5f70 6172 616d  tiles: ihs_param
-00037010: 732e 7065 7263 656e 7469 6c65 7320 3d20  s.percentiles = 
-00037020: 6968 735f 7061 7261 6d73 2e70 6572 6365  ihs_params.perce
-00037030: 6e74 696c 6573 5f64 6566 6175 6c74 2c0a  ntiles_default,.
-00037040: 2020 2020 2020 2020 7374 616e 6461 7264          standard
-00037050: 697a 653a 2069 6873 5f70 6172 616d 732e  ize: ihs_params.
-00037060: 7374 616e 6461 7264 697a 6520 3d20 5472  standardize = Tr
-00037070: 7565 2c0a 2020 2020 2020 2020 7374 616e  ue,.        stan
-00037080: 6461 7264 697a 6174 696f 6e5f 6269 6e73  dardization_bins
-00037090: 3a20 4f70 7469 6f6e 616c 5b69 6873 5f70  : Optional[ihs_p
-000370a0: 6172 616d 732e 7374 616e 6461 7264 697a  arams.standardiz
-000370b0: 6174 696f 6e5f 6269 6e73 5d20 3d20 4e6f  ation_bins] = No
-000370c0: 6e65 2c0a 2020 2020 2020 2020 7374 616e  ne,.        stan
-000370d0: 6461 7264 697a 6174 696f 6e5f 6e5f 6269  dardization_n_bi
-000370e0: 6e73 3a20 6968 735f 7061 7261 6d73 2e73  ns: ihs_params.s
-000370f0: 7461 6e64 6172 6469 7a61 7469 6f6e 5f6e  tandardization_n
-00037100: 5f62 696e 7320 3d20 6968 735f 7061 7261  _bins = ihs_para
-00037110: 6d73 2e73 7461 6e64 6172 6469 7a61 7469  ms.standardizati
-00037120: 6f6e 5f6e 5f62 696e 735f 6465 6661 756c  on_n_bins_defaul
-00037130: 742c 0a20 2020 2020 2020 2073 7461 6e64  t,.        stand
-00037140: 6172 6469 7a61 7469 6f6e 5f64 6961 676e  ardization_diagn
-00037150: 6f73 7469 6373 3a20 6968 735f 7061 7261  ostics: ihs_para
-00037160: 6d73 2e73 7461 6e64 6172 6469 7a61 7469  ms.standardizati
-00037170: 6f6e 5f64 6961 676e 6f73 7469 6373 203d  on_diagnostics =
-00037180: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00037190: 6669 6c74 6572 5f6d 696e 5f6d 6166 3a20  filter_min_maf: 
-000371a0: 6968 735f 7061 7261 6d73 2e66 696c 7465  ihs_params.filte
-000371b0: 725f 6d69 6e5f 6d61 6620 3d20 6968 735f  r_min_maf = ihs_
-000371c0: 7061 7261 6d73 2e66 696c 7465 725f 6d69  params.filter_mi
-000371d0: 6e5f 6d61 665f 6465 6661 756c 742c 0a20  n_maf_default,. 
-000371e0: 2020 2020 2020 2063 6f6d 7075 7465 5f6d         compute_m
-000371f0: 696e 5f6d 6166 3a20 6968 735f 7061 7261  in_maf: ihs_para
-00037200: 6d73 2e63 6f6d 7075 7465 5f6d 696e 5f6d  ms.compute_min_m
-00037210: 6166 203d 2069 6873 5f70 6172 616d 732e  af = ihs_params.
-00037220: 636f 6d70 7574 655f 6d69 6e5f 6d61 665f  compute_min_maf_
-00037230: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-00037240: 206d 696e 5f65 6868 3a20 6968 735f 7061   min_ehh: ihs_pa
-00037250: 7261 6d73 2e6d 696e 5f65 6868 203d 2069  rams.min_ehh = i
-00037260: 6873 5f70 6172 616d 732e 6d69 6e5f 6568  hs_params.min_eh
-00037270: 685f 6465 6661 756c 742c 0a20 2020 2020  h_default,.     
-00037280: 2020 206d 6178 5f67 6170 3a20 6968 735f     max_gap: ihs_
-00037290: 7061 7261 6d73 2e6d 6178 5f67 6170 203d  params.max_gap =
-000372a0: 2069 6873 5f70 6172 616d 732e 6d61 785f   ihs_params.max_
-000372b0: 6761 705f 6465 6661 756c 742c 0a20 2020  gap_default,.   
-000372c0: 2020 2020 2067 6170 5f73 6361 6c65 3a20       gap_scale: 
-000372d0: 6968 735f 7061 7261 6d73 2e67 6170 5f73  ihs_params.gap_s
-000372e0: 6361 6c65 203d 2069 6873 5f70 6172 616d  cale = ihs_param
-000372f0: 732e 6761 705f 7363 616c 655f 6465 6661  s.gap_scale_defa
-00037300: 756c 742c 0a20 2020 2020 2020 2069 6e63  ult,.        inc
-00037310: 6c75 6465 5f65 6467 6573 3a20 6968 735f  lude_edges: ihs_
-00037320: 7061 7261 6d73 2e69 6e63 6c75 6465 5f65  params.include_e
-00037330: 6467 6573 203d 2054 7275 652c 0a20 2020  dges = True,.   
-00037340: 2020 2020 2075 7365 5f74 6872 6561 6473       use_threads
-00037350: 3a20 6968 735f 7061 7261 6d73 2e75 7365  : ihs_params.use
-00037360: 5f74 6872 6561 6473 203d 2054 7275 652c  _threads = True,
-00037370: 0a20 2020 2020 2020 206d 696e 5f63 6f68  .        min_coh
-00037380: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
-00037390: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
-000373a0: 6261 7365 5f70 6172 616d 732e 6d69 6e5f  base_params.min_
-000373b0: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
-000373c0: 2020 2020 5d20 3d20 6968 735f 7061 7261      ] = ihs_para
-000373d0: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
-000373e0: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
-000373f0: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
-00037400: 697a 653a 204f 7074 696f 6e61 6c5b 0a20  ize: Optional[. 
-00037410: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-00037420: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
-00037430: 745f 7369 7a65 0a20 2020 2020 2020 205d  t_size.        ]
-00037440: 203d 2069 6873 5f70 6172 616d 732e 6d61   = ihs_params.ma
-00037450: 785f 636f 686f 7274 5f73 697a 655f 6465  x_cohort_size_de
-00037460: 6661 756c 742c 0a20 2020 2020 2020 2072  fault,.        r
-00037470: 616e 646f 6d5f 7365 6564 3a20 6261 7365  andom_seed: base
-00037480: 5f70 6172 616d 732e 7261 6e64 6f6d 5f73  _params.random_s
-00037490: 6565 6420 3d20 3432 2c0a 2020 2020 2920  eed = 42,.    ) 
-000374a0: 2d3e 2054 7570 6c65 5b6e 702e 6e64 6172  -> Tuple[np.ndar
-000374b0: 7261 792c 206e 702e 6e64 6172 7261 795d  ray, np.ndarray]
-000374c0: 3a0a 2020 2020 2020 2020 2320 6368 616e  :.        # chan
-000374d0: 6765 2074 6869 7320 6e61 6d65 2069 6620  ge this name if 
-000374e0: 796f 7520 6576 6572 2063 6861 6e67 6520  you ever change 
-000374f0: 7468 6520 6265 6861 7669 6f75 7220 6f66  the behaviour of
-00037500: 2074 6869 7320 6675 6e63 7469 6f6e 2c20   this function, 
-00037510: 746f 0a20 2020 2020 2020 2023 2069 6e76  to.        # inv
-00037520: 616c 6964 6174 6520 616e 7920 7072 6576  alidate any prev
-00037530: 696f 7573 6c79 2063 6163 6865 6420 6461  iously cached da
-00037540: 7461 0a20 2020 2020 2020 206e 616d 6520  ta.        name 
-00037550: 3d20 7365 6c66 2e5f 6968 735f 6777 7373  = self._ihs_gwss
-00037560: 5f63 6163 6865 5f6e 616d 650a 0a20 2020  _cache_name..   
-00037570: 2020 2020 2070 6172 616d 7320 3d20 6469       params = di
-00037580: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-00037590: 636f 6e74 6967 3d63 6f6e 7469 672c 0a20  contig=contig,. 
-000375a0: 2020 2020 2020 2020 2020 2061 6e61 6c79             analy
-000375b0: 7369 733d 7365 6c66 2e5f 7072 6570 5f70  sis=self._prep_p
-000375c0: 6861 7369 6e67 5f61 6e61 6c79 7369 735f  hasing_analysis_
-000375d0: 7061 7261 6d28 616e 616c 7973 6973 3d61  param(analysis=a
-000375e0: 6e61 6c79 7369 7329 2c0a 2020 2020 2020  nalysis),.      
-000375f0: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
-00037600: 653d 7769 6e64 6f77 5f73 697a 652c 0a20  e=window_size,. 
-00037610: 2020 2020 2020 2020 2020 2070 6572 6365             perce
-00037620: 6e74 696c 6573 3d70 6572 6365 6e74 696c  ntiles=percentil
-00037630: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00037640: 7374 616e 6461 7264 697a 653d 7374 616e  standardize=stan
-00037650: 6461 7264 697a 652c 0a20 2020 2020 2020  dardize,.       
-00037660: 2020 2020 2073 7461 6e64 6172 6469 7a61       standardiza
-00037670: 7469 6f6e 5f62 696e 733d 7374 616e 6461  tion_bins=standa
-00037680: 7264 697a 6174 696f 6e5f 6269 6e73 2c0a  rdization_bins,.
-00037690: 2020 2020 2020 2020 2020 2020 7374 616e              stan
-000376a0: 6461 7264 697a 6174 696f 6e5f 6e5f 6269  dardization_n_bi
-000376b0: 6e73 3d73 7461 6e64 6172 6469 7a61 7469  ns=standardizati
-000376c0: 6f6e 5f6e 5f62 696e 732c 0a20 2020 2020  on_n_bins,.     
-000376d0: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
-000376e0: 7a61 7469 6f6e 5f64 6961 676e 6f73 7469  zation_diagnosti
-000376f0: 6373 3d73 7461 6e64 6172 6469 7a61 7469  cs=standardizati
-00037700: 6f6e 5f64 6961 676e 6f73 7469 6373 2c0a  on_diagnostics,.
-00037710: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00037720: 6572 5f6d 696e 5f6d 6166 3d66 696c 7465  er_min_maf=filte
-00037730: 725f 6d69 6e5f 6d61 662c 0a20 2020 2020  r_min_maf,.     
-00037740: 2020 2020 2020 2063 6f6d 7075 7465 5f6d         compute_m
-00037750: 696e 5f6d 6166 3d63 6f6d 7075 7465 5f6d  in_maf=compute_m
-00037760: 696e 5f6d 6166 2c0a 2020 2020 2020 2020  in_maf,.        
-00037770: 2020 2020 6d69 6e5f 6568 683d 6d69 6e5f      min_ehh=min_
-00037780: 6568 682c 0a20 2020 2020 2020 2020 2020  ehh,.           
-00037790: 2069 6e63 6c75 6465 5f65 6467 6573 3d69   include_edges=i
-000377a0: 6e63 6c75 6465 5f65 6467 6573 2c0a 2020  nclude_edges,.  
-000377b0: 2020 2020 2020 2020 2020 6d61 785f 6761            max_ga
-000377c0: 703d 6d61 785f 6761 702c 0a20 2020 2020  p=max_gap,.     
-000377d0: 2020 2020 2020 2067 6170 5f73 6361 6c65         gap_scale
-000377e0: 3d67 6170 5f73 6361 6c65 2c0a 2020 2020  =gap_scale,.    
-000377f0: 2020 2020 2020 2020 7573 655f 7468 7265          use_thre
-00037800: 6164 733d 7573 655f 7468 7265 6164 732c  ads=use_threads,
-00037810: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00037820: 706c 655f 7365 7473 3d73 656c 662e 5f70  ple_sets=self._p
-00037830: 7265 705f 7361 6d70 6c65 5f73 6574 735f  rep_sample_sets_
-00037840: 7061 7261 6d28 7361 6d70 6c65 5f73 6574  param(sample_set
-00037850: 733d 7361 6d70 6c65 5f73 6574 7329 2c0a  s=sample_sets),.
-00037860: 2020 2020 2020 2020 2020 2020 2320 4e2e              # N.
-00037870: 422e 2c20 646f 206e 6f74 2062 6520 7465  B., do not be te
-00037880: 6d70 7465 6420 746f 2063 6f6e 7665 7274  mpted to convert
-00037890: 2074 6869 7320 7361 6d70 6c65 2071 7565   this sample que
-000378a0: 7279 2069 6e74 6f20 696e 7465 6765 720a  ry into integer.
-000378b0: 2020 2020 2020 2020 2020 2020 2320 696e              # in
-000378c0: 6469 6365 7320 7573 696e 6720 5f70 7265  dices using _pre
-000378d0: 705f 7361 6d70 6c65 5f73 656c 6563 7469  p_sample_selecti
-000378e0: 6f6e 5f70 6172 616d 732c 2062 6563 6175  on_params, becau
-000378f0: 7365 2074 6865 2069 6e64 6963 6573 0a20  se the indices. 
-00037900: 2020 2020 2020 2020 2020 2023 2061 7265             # are
-00037910: 2064 6966 6665 7265 6e74 2069 6e20 7468   different in th
-00037920: 6520 6861 706c 6f74 7970 6520 6461 7461  e haplotype data
-00037930: 2e0a 2020 2020 2020 2020 2020 2020 7361  ..            sa
-00037940: 6d70 6c65 5f71 7565 7279 3d73 616d 706c  mple_query=sampl
-00037950: 655f 7175 6572 792c 0a20 2020 2020 2020  e_query,.       
-00037960: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-00037970: 7369 7a65 3d6d 696e 5f63 6f68 6f72 745f  size=min_cohort_
-00037980: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-00037990: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
-000379a0: 653d 6d61 785f 636f 686f 7274 5f73 697a  e=max_cohort_siz
-000379b0: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
-000379c0: 616e 646f 6d5f 7365 6564 3d72 616e 646f  andom_seed=rando
-000379d0: 6d5f 7365 6564 2c0a 2020 2020 2020 2020  m_seed,.        
-000379e0: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
-000379f0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00037a00: 6c74 7320 3d20 7365 6c66 2e72 6573 756c  lts = self.resul
-00037a10: 7473 5f63 6163 6865 5f67 6574 286e 616d  ts_cache_get(nam
-00037a20: 653d 6e61 6d65 2c20 7061 7261 6d73 3d70  e=name, params=p
-00037a30: 6172 616d 7329 0a0a 2020 2020 2020 2020  arams)..        
-00037a40: 6578 6365 7074 2043 6163 6865 4d69 7373  except CacheMiss
-00037a50: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00037a60: 7375 6c74 7320 3d20 7365 6c66 2e5f 6968  sults = self._ih
-00037a70: 735f 6777 7373 282a 2a70 6172 616d 7329  s_gwss(**params)
-00037a80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00037a90: 662e 7265 7375 6c74 735f 6361 6368 655f  f.results_cache_
-00037aa0: 7365 7428 6e61 6d65 3d6e 616d 652c 2070  set(name=name, p
-00037ab0: 6172 616d 733d 7061 7261 6d73 2c20 7265  arams=params, re
-00037ac0: 7375 6c74 733d 7265 7375 6c74 7329 0a0a  sults=results)..
-00037ad0: 2020 2020 2020 2020 7820 3d20 7265 7375          x = resu
-00037ae0: 6c74 735b 2278 225d 0a20 2020 2020 2020  lts["x"].       
-00037af0: 2069 6873 203d 2072 6573 756c 7473 5b22   ihs = results["
-00037b00: 6968 7322 5d0a 0a20 2020 2020 2020 2072  ihs"]..        r
-00037b10: 6574 7572 6e20 782c 2069 6873 0a0a 2020  eturn x, ihs..  
-00037b20: 2020 6465 6620 5f69 6873 5f67 7773 7328    def _ihs_gwss(
-00037b30: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00037b40: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
-00037b50: 2020 636f 6e74 6967 2c0a 2020 2020 2020    contig,.      
-00037b60: 2020 616e 616c 7973 6973 2c0a 2020 2020    analysis,.    
-00037b70: 2020 2020 7361 6d70 6c65 5f73 6574 732c      sample_sets,
-00037b80: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00037b90: 7175 6572 792c 0a20 2020 2020 2020 2077  query,.        w
-00037ba0: 696e 646f 775f 7369 7a65 2c0a 2020 2020  indow_size,.    
-00037bb0: 2020 2020 7065 7263 656e 7469 6c65 732c      percentiles,
-00037bc0: 0a20 2020 2020 2020 2073 7461 6e64 6172  .        standar
-00037bd0: 6469 7a65 2c0a 2020 2020 2020 2020 7374  dize,.        st
-00037be0: 616e 6461 7264 697a 6174 696f 6e5f 6269  andardization_bi
-00037bf0: 6e73 2c0a 2020 2020 2020 2020 7374 616e  ns,.        stan
-00037c00: 6461 7264 697a 6174 696f 6e5f 6e5f 6269  dardization_n_bi
-00037c10: 6e73 2c0a 2020 2020 2020 2020 7374 616e  ns,.        stan
-00037c20: 6461 7264 697a 6174 696f 6e5f 6469 6167  dardization_diag
-00037c30: 6e6f 7374 6963 732c 0a20 2020 2020 2020  nostics,.       
-00037c40: 2066 696c 7465 725f 6d69 6e5f 6d61 662c   filter_min_maf,
-00037c50: 0a20 2020 2020 2020 2063 6f6d 7075 7465  .        compute
-00037c60: 5f6d 696e 5f6d 6166 2c0a 2020 2020 2020  _min_maf,.      
-00037c70: 2020 6d69 6e5f 6568 682c 0a20 2020 2020    min_ehh,.     
-00037c80: 2020 206d 6178 5f67 6170 2c0a 2020 2020     max_gap,.    
-00037c90: 2020 2020 6761 705f 7363 616c 652c 0a20      gap_scale,. 
-00037ca0: 2020 2020 2020 2069 6e63 6c75 6465 5f65         include_e
-00037cb0: 6467 6573 2c0a 2020 2020 2020 2020 7573  dges,.        us
-00037cc0: 655f 7468 7265 6164 732c 0a20 2020 2020  e_threads,.     
-00037cd0: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-00037ce0: 7a65 2c0a 2020 2020 2020 2020 6d61 785f  ze,.        max_
-00037cf0: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
-00037d00: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-00037d10: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00037d20: 2064 735f 6861 7073 203d 2073 656c 662e   ds_haps = self.
-00037d30: 6861 706c 6f74 7970 6573 280a 2020 2020  haplotypes(.    
-00037d40: 2020 2020 2020 2020 7265 6769 6f6e 3d63          region=c
-00037d50: 6f6e 7469 672c 0a20 2020 2020 2020 2020  ontig,.         
-00037d60: 2020 2061 6e61 6c79 7369 733d 616e 616c     analysis=anal
-00037d70: 7973 6973 2c0a 2020 2020 2020 2020 2020  ysis,.          
-00037d80: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
-00037d90: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
-00037da0: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
-00037db0: 7365 7473 3d73 616d 706c 655f 7365 7473  sets=sample_sets
-00037dc0: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-00037dd0: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
-00037de0: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
-00037df0: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-00037e00: 6f68 6f72 745f 7369 7a65 3d6d 6178 5f63  ohort_size=max_c
-00037e10: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-00037e20: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-00037e30: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
-00037e40: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00037e50: 2020 2020 6774 203d 2061 6c6c 656c 2e47      gt = allel.G
-00037e60: 656e 6f74 7970 6544 6173 6b41 7272 6179  enotypeDaskArray
-00037e70: 2864 735f 6861 7073 5b22 6361 6c6c 5f67  (ds_haps["call_g
-00037e80: 656e 6f74 7970 6522 5d2e 6461 7461 290a  enotype"].data).
-00037e90: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-00037ea0: 662e 5f64 6173 6b5f 7072 6f67 7265 7373  f._dask_progress
-00037eb0: 2864 6573 633d 224c 6f61 6420 6861 706c  (desc="Load hapl
-00037ec0: 6f74 7970 6573 2229 3a0a 2020 2020 2020  otypes"):.      
-00037ed0: 2020 2020 2020 6874 203d 2067 742e 746f        ht = gt.to
-00037ee0: 5f68 6170 6c6f 7479 7065 7328 292e 636f  _haplotypes().co
-00037ef0: 6d70 7574 6528 290a 0a20 2020 2020 2020  mpute()..       
-00037f00: 2061 6320 3d20 6874 2e63 6f75 6e74 5f61   ac = ht.count_a
-00037f10: 6c6c 656c 6573 286d 6178 5f61 6c6c 656c  lleles(max_allel
-00037f20: 653d 3129 0a20 2020 2020 2020 2070 6f73  e=1).        pos
-00037f30: 203d 2064 735f 6861 7073 5b22 7661 7269   = ds_haps["vari
-00037f40: 616e 745f 706f 7369 7469 6f6e 225d 2e76  ant_position"].v
-00037f50: 616c 7565 730a 0a20 2020 2020 2020 2069  alues..        i
-00037f60: 6620 6669 6c74 6572 5f6d 696e 5f6d 6166  f filter_min_maf
-00037f70: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00037f80: 2020 6166 203d 2061 632e 746f 5f66 7265    af = ac.to_fre
-00037f90: 7175 656e 6369 6573 2829 0a20 2020 2020  quencies().     
-00037fa0: 2020 2020 2020 206d 6166 203d 206e 702e         maf = np.
-00037fb0: 6d69 6e28 6166 2c20 6178 6973 3d31 290a  min(af, axis=1).
-00037fc0: 2020 2020 2020 2020 2020 2020 6d61 665f              maf_
-00037fd0: 6669 6c74 6572 203d 206d 6166 203e 2066  filter = maf > f
-00037fe0: 696c 7465 725f 6d69 6e5f 6d61 660a 2020  ilter_min_maf.  
-00037ff0: 2020 2020 2020 2020 2020 6874 203d 2068            ht = h
-00038000: 742e 636f 6d70 7265 7373 286d 6166 5f66  t.compress(maf_f
-00038010: 696c 7465 722c 2061 7869 733d 3029 0a20  ilter, axis=0). 
-00038020: 2020 2020 2020 2020 2020 2070 6f73 203d             pos =
-00038030: 2070 6f73 5b6d 6166 5f66 696c 7465 725d   pos[maf_filter]
-00038040: 0a20 2020 2020 2020 2020 2020 2061 6320  .            ac 
-00038050: 3d20 6163 5b6d 6166 5f66 696c 7465 725d  = ac[maf_filter]
-00038060: 0a0a 2020 2020 2020 2020 2320 636f 6d70  ..        # comp
-00038070: 7574 6520 6948 530a 2020 2020 2020 2020  ute iHS.        
-00038080: 6968 7320 3d20 616c 6c65 6c2e 6968 7328  ihs = allel.ihs(
-00038090: 0a20 2020 2020 2020 2020 2020 2068 3d68  .            h=h
-000380a0: 742c 0a20 2020 2020 2020 2020 2020 2070  t,.            p
-000380b0: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
-000380c0: 2020 2020 6d69 6e5f 6d61 663d 636f 6d70      min_maf=comp
-000380d0: 7574 655f 6d69 6e5f 6d61 662c 0a20 2020  ute_min_maf,.   
-000380e0: 2020 2020 2020 2020 206d 696e 5f65 6868           min_ehh
-000380f0: 3d6d 696e 5f65 6868 2c0a 2020 2020 2020  =min_ehh,.      
-00038100: 2020 2020 2020 696e 636c 7564 655f 6564        include_ed
-00038110: 6765 733d 696e 636c 7564 655f 6564 6765  ges=include_edge
-00038120: 732c 0a20 2020 2020 2020 2020 2020 206d  s,.            m
-00038130: 6178 5f67 6170 3d6d 6178 5f67 6170 2c0a  ax_gap=max_gap,.
-00038140: 2020 2020 2020 2020 2020 2020 6761 705f              gap_
-00038150: 7363 616c 653d 6761 705f 7363 616c 652c  scale=gap_scale,
-00038160: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-00038170: 5f74 6872 6561 6473 3d75 7365 5f74 6872  _threads=use_thr
-00038180: 6561 6473 2c0a 2020 2020 2020 2020 290a  eads,.        ).
-00038190: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
-000381a0: 6520 616e 7920 4e61 4e73 0a20 2020 2020  e any NaNs.     
-000381b0: 2020 206e 615f 6d61 736b 203d 207e 6e70     na_mask = ~np
-000381c0: 2e69 736e 616e 2869 6873 290a 2020 2020  .isnan(ihs).    
-000381d0: 2020 2020 6968 7320 3d20 6968 735b 6e61      ihs = ihs[na
-000381e0: 5f6d 6173 6b5d 0a20 2020 2020 2020 2070  _mask].        p
-000381f0: 6f73 203d 2070 6f73 5b6e 615f 6d61 736b  os = pos[na_mask
-00038200: 5d0a 2020 2020 2020 2020 6163 203d 2061  ].        ac = a
-00038210: 635b 6e61 5f6d 6173 6b5d 0a0a 2020 2020  c[na_mask]..    
-00038220: 2020 2020 2320 7461 6b65 2061 6273 6f6c      # take absol
-00038230: 7574 6520 7661 6c75 650a 2020 2020 2020  ute value.      
-00038240: 2020 6968 7320 3d20 6e70 2e66 6162 7328    ihs = np.fabs(
-00038250: 6968 7329 0a0a 2020 2020 2020 2020 6966  ihs)..        if
-00038260: 2073 7461 6e64 6172 6469 7a65 3a0a 2020   standardize:.  
-00038270: 2020 2020 2020 2020 2020 6968 732c 205f            ihs, _
-00038280: 203d 2061 6c6c 656c 2e73 7461 6e64 6172   = allel.standar
-00038290: 6469 7a65 5f62 795f 616c 6c65 6c65 5f63  dize_by_allele_c
-000382a0: 6f75 6e74 280a 2020 2020 2020 2020 2020  ount(.          
-000382b0: 2020 2020 2020 7363 6f72 653d 6968 732c        score=ihs,
-000382c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000382d0: 2061 6163 3d61 635b 3a2c 2031 5d2c 0a20   aac=ac[:, 1],. 
-000382e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000382f0: 696e 733d 7374 616e 6461 7264 697a 6174  ins=standardizat
-00038300: 696f 6e5f 6269 6e73 2c0a 2020 2020 2020  ion_bins,.      
-00038310: 2020 2020 2020 2020 2020 6e5f 6269 6e73            n_bins
-00038320: 3d73 7461 6e64 6172 6469 7a61 7469 6f6e  =standardization
-00038330: 5f6e 5f62 696e 732c 0a20 2020 2020 2020  _n_bins,.       
-00038340: 2020 2020 2020 2020 2064 6961 676e 6f73           diagnos
-00038350: 7469 6373 3d73 7461 6e64 6172 6469 7a61  tics=standardiza
-00038360: 7469 6f6e 5f64 6961 676e 6f73 7469 6373  tion_diagnostics
-00038370: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00038380: 0a20 2020 2020 2020 2069 6620 7769 6e64  .        if wind
-00038390: 6f77 5f73 697a 653a 0a20 2020 2020 2020  ow_size:.       
-000383a0: 2020 2020 2069 6873 203d 2061 6c6c 656c       ihs = allel
-000383b0: 2e6d 6f76 696e 675f 7374 6174 6973 7469  .moving_statisti
-000383c0: 6328 0a20 2020 2020 2020 2020 2020 2020  c(.             
-000383d0: 2020 2069 6873 2c20 7374 6174 6973 7469     ihs, statisti
-000383e0: 633d 6e70 2e70 6572 6365 6e74 696c 652c  c=np.percentile,
-000383f0: 2073 697a 653d 7769 6e64 6f77 5f73 697a   size=window_siz
-00038400: 652c 2071 3d70 6572 6365 6e74 696c 6573  e, q=percentiles
-00038410: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00038420: 2020 2020 2020 2020 2020 2070 6f73 203d             pos =
-00038430: 2061 6c6c 656c 2e6d 6f76 696e 675f 7374   allel.moving_st
-00038440: 6174 6973 7469 6328 706f 732c 2073 7461  atistic(pos, sta
-00038450: 7469 7374 6963 3d6e 702e 6d65 616e 2c20  tistic=np.mean, 
-00038460: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
-00038470: 290a 0a20 2020 2020 2020 2072 6573 756c  )..        resul
-00038480: 7473 203d 2064 6963 7428 783d 706f 732c  ts = dict(x=pos,
-00038490: 2069 6873 3d69 6873 290a 0a20 2020 2020   ihs=ihs)..     
-000384a0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-000384b0: 730a 0a20 2020 2040 646f 6328 0a20 2020  s..    @doc(.   
-000384c0: 2020 2020 2073 756d 6d61 7279 3d22 5275       summary="Ru
-000384d0: 6e20 616e 6420 706c 6f74 2069 4853 2047  n and plot iHS G
-000384e0: 5753 5320 6461 7461 2e22 2c0a 2020 2020  WSS data.",.    
-000384f0: 290a 2020 2020 6465 6620 706c 6f74 5f69  ).    def plot_i
-00038500: 6873 5f67 7773 735f 7472 6163 6b28 0a20  hs_gwss_track(. 
-00038510: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00038520: 2020 2020 2063 6f6e 7469 673a 2062 6173       contig: bas
-00038530: 655f 7061 7261 6d73 2e63 6f6e 7469 672c  e_params.contig,
-00038540: 0a20 2020 2020 2020 2061 6e61 6c79 7369  .        analysi
-00038550: 733a 2068 6170 5f70 6172 616d 732e 616e  s: hap_params.an
-00038560: 616c 7973 6973 203d 2044 4546 4155 4c54  alysis = DEFAULT
-00038570: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
-00038580: 5f73 6574 733a 204f 7074 696f 6e61 6c5b  _sets: Optional[
-00038590: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-000385a0: 6c65 5f73 6574 735d 203d 204e 6f6e 652c  le_sets] = None,
-000385b0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-000385c0: 7175 6572 793a 204f 7074 696f 6e61 6c5b  query: Optional[
-000385d0: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
-000385e0: 6c65 5f71 7565 7279 5d20 3d20 4e6f 6e65  le_query] = None
-000385f0: 2c0a 2020 2020 2020 2020 7769 6e64 6f77  ,.        window
-00038600: 5f73 697a 653a 2069 6873 5f70 6172 616d  _size: ihs_param
-00038610: 732e 7769 6e64 6f77 5f73 697a 6520 3d20  s.window_size = 
-00038620: 6968 735f 7061 7261 6d73 2e77 696e 646f  ihs_params.windo
-00038630: 775f 7369 7a65 5f64 6566 6175 6c74 2c0a  w_size_default,.
-00038640: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
-00038650: 6c65 733a 2069 6873 5f70 6172 616d 732e  les: ihs_params.
-00038660: 7065 7263 656e 7469 6c65 7320 3d20 6968  percentiles = ih
-00038670: 735f 7061 7261 6d73 2e70 6572 6365 6e74  s_params.percent
-00038680: 696c 6573 5f64 6566 6175 6c74 2c0a 2020  iles_default,.  
-00038690: 2020 2020 2020 7374 616e 6461 7264 697a        standardiz
-000386a0: 653a 2069 6873 5f70 6172 616d 732e 7374  e: ihs_params.st
-000386b0: 616e 6461 7264 697a 6520 3d20 5472 7565  andardize = True
-000386c0: 2c0a 2020 2020 2020 2020 7374 616e 6461  ,.        standa
-000386d0: 7264 697a 6174 696f 6e5f 6269 6e73 3a20  rdization_bins: 
-000386e0: 4f70 7469 6f6e 616c 5b69 6873 5f70 6172  Optional[ihs_par
-000386f0: 616d 732e 7374 616e 6461 7264 697a 6174  ams.standardizat
-00038700: 696f 6e5f 6269 6e73 5d20 3d20 4e6f 6e65  ion_bins] = None
-00038710: 2c0a 2020 2020 2020 2020 7374 616e 6461  ,.        standa
-00038720: 7264 697a 6174 696f 6e5f 6e5f 6269 6e73  rdization_n_bins
-00038730: 3a20 6968 735f 7061 7261 6d73 2e73 7461  : ihs_params.sta
-00038740: 6e64 6172 6469 7a61 7469 6f6e 5f6e 5f62  ndardization_n_b
-00038750: 696e 7320 3d20 6968 735f 7061 7261 6d73  ins = ihs_params
-00038760: 2e73 7461 6e64 6172 6469 7a61 7469 6f6e  .standardization
-00038770: 5f6e 5f62 696e 735f 6465 6661 756c 742c  _n_bins_default,
-00038780: 0a20 2020 2020 2020 2073 7461 6e64 6172  .        standar
-00038790: 6469 7a61 7469 6f6e 5f64 6961 676e 6f73  dization_diagnos
-000387a0: 7469 6373 3a20 6968 735f 7061 7261 6d73  tics: ihs_params
-000387b0: 2e73 7461 6e64 6172 6469 7a61 7469 6f6e  .standardization
-000387c0: 5f64 6961 676e 6f73 7469 6373 203d 2046  _diagnostics = F
-000387d0: 616c 7365 2c0a 2020 2020 2020 2020 6669  alse,.        fi
-000387e0: 6c74 6572 5f6d 696e 5f6d 6166 3a20 6968  lter_min_maf: ih
-000387f0: 735f 7061 7261 6d73 2e66 696c 7465 725f  s_params.filter_
-00038800: 6d69 6e5f 6d61 6620 3d20 6968 735f 7061  min_maf = ihs_pa
-00038810: 7261 6d73 2e66 696c 7465 725f 6d69 6e5f  rams.filter_min_
-00038820: 6d61 665f 6465 6661 756c 742c 0a20 2020  maf_default,.   
-00038830: 2020 2020 2063 6f6d 7075 7465 5f6d 696e       compute_min
-00038840: 5f6d 6166 3a20 6968 735f 7061 7261 6d73  _maf: ihs_params
-00038850: 2e63 6f6d 7075 7465 5f6d 696e 5f6d 6166  .compute_min_maf
-00038860: 203d 2069 6873 5f70 6172 616d 732e 636f   = ihs_params.co
-00038870: 6d70 7574 655f 6d69 6e5f 6d61 665f 6465  mpute_min_maf_de
-00038880: 6661 756c 742c 0a20 2020 2020 2020 206d  fault,.        m
-00038890: 696e 5f65 6868 3a20 6968 735f 7061 7261  in_ehh: ihs_para
-000388a0: 6d73 2e6d 696e 5f65 6868 203d 2069 6873  ms.min_ehh = ihs
-000388b0: 5f70 6172 616d 732e 6d69 6e5f 6568 685f  _params.min_ehh_
-000388c0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-000388d0: 206d 6178 5f67 6170 3a20 6968 735f 7061   max_gap: ihs_pa
-000388e0: 7261 6d73 2e6d 6178 5f67 6170 203d 2069  rams.max_gap = i
-000388f0: 6873 5f70 6172 616d 732e 6d61 785f 6761  hs_params.max_ga
-00038900: 705f 6465 6661 756c 742c 0a20 2020 2020  p_default,.     
-00038910: 2020 2067 6170 5f73 6361 6c65 3a20 6968     gap_scale: ih
-00038920: 735f 7061 7261 6d73 2e67 6170 5f73 6361  s_params.gap_sca
-00038930: 6c65 203d 2069 6873 5f70 6172 616d 732e  le = ihs_params.
-00038940: 6761 705f 7363 616c 655f 6465 6661 756c  gap_scale_defaul
-00038950: 742c 0a20 2020 2020 2020 2069 6e63 6c75  t,.        inclu
-00038960: 6465 5f65 6467 6573 3a20 6968 735f 7061  de_edges: ihs_pa
-00038970: 7261 6d73 2e69 6e63 6c75 6465 5f65 6467  rams.include_edg
-00038980: 6573 203d 2054 7275 652c 0a20 2020 2020  es = True,.     
-00038990: 2020 2075 7365 5f74 6872 6561 6473 3a20     use_threads: 
-000389a0: 6968 735f 7061 7261 6d73 2e75 7365 5f74  ihs_params.use_t
-000389b0: 6872 6561 6473 203d 2054 7275 652c 0a20  hreads = True,. 
-000389c0: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
-000389d0: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
-000389e0: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
-000389f0: 7365 5f70 6172 616d 732e 6d69 6e5f 636f  se_params.min_co
-00038a00: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
-00038a10: 2020 5d20 3d20 6968 735f 7061 7261 6d73    ] = ihs_params
-00038a20: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
-00038a30: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-00038a40: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
-00038a50: 653a 204f 7074 696f 6e61 6c5b 0a20 2020  e: Optional[.   
-00038a60: 2020 2020 2020 2020 2062 6173 655f 7061           base_pa
-00038a70: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
-00038a80: 7369 7a65 0a20 2020 2020 2020 205d 203d  size.        ] =
-00038a90: 2069 6873 5f70 6172 616d 732e 6d61 785f   ihs_params.max_
-00038aa0: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
-00038ab0: 756c 742c 0a20 2020 2020 2020 2072 616e  ult,.        ran
-00038ac0: 646f 6d5f 7365 6564 3a20 6261 7365 5f70  dom_seed: base_p
-00038ad0: 6172 616d 732e 7261 6e64 6f6d 5f73 6565  arams.random_see
-00038ae0: 6420 3d20 3432 2c0a 2020 2020 2020 2020  d = 42,.        
-00038af0: 7061 6c65 7474 653a 2069 6873 5f70 6172  palette: ihs_par
-00038b00: 616d 732e 7061 6c65 7474 6520 3d20 6968  ams.palette = ih
-00038b10: 735f 7061 7261 6d73 2e70 616c 6574 7465  s_params.palette
-00038b20: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-00038b30: 2020 7469 746c 653a 204f 7074 696f 6e61    title: Optiona
-00038b40: 6c5b 6770 6c74 5f70 6172 616d 732e 7469  l[gplt_params.ti
-00038b50: 746c 655d 203d 204e 6f6e 652c 0a20 2020  tle] = None,.   
-00038b60: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
-00038b70: 3a20 6770 6c74 5f70 6172 616d 732e 7369  : gplt_params.si
-00038b80: 7a69 6e67 5f6d 6f64 6520 3d20 6770 6c74  zing_mode = gplt
-00038b90: 5f70 6172 616d 732e 7369 7a69 6e67 5f6d  _params.sizing_m
-00038ba0: 6f64 655f 6465 6661 756c 742c 0a20 2020  ode_default,.   
-00038bb0: 2020 2020 2077 6964 7468 3a20 6770 6c74       width: gplt
-00038bc0: 5f70 6172 616d 732e 7769 6474 6820 3d20  _params.width = 
-00038bd0: 6770 6c74 5f70 6172 616d 732e 7769 6474  gplt_params.widt
-00038be0: 685f 6465 6661 756c 742c 0a20 2020 2020  h_default,.     
-00038bf0: 2020 2068 6569 6768 743a 2067 706c 745f     height: gplt_
-00038c00: 7061 7261 6d73 2e68 6569 6768 7420 3d20  params.height = 
-00038c10: 3230 302c 0a20 2020 2020 2020 2073 686f  200,.        sho
-00038c20: 773a 2067 706c 745f 7061 7261 6d73 2e73  w: gplt_params.s
-00038c30: 686f 7720 3d20 5472 7565 2c0a 2020 2020  how = True,.    
-00038c40: 2020 2020 785f 7261 6e67 653a 204f 7074      x_range: Opt
-00038c50: 696f 6e61 6c5b 6770 6c74 5f70 6172 616d  ional[gplt_param
-00038c60: 732e 785f 7261 6e67 655d 203d 204e 6f6e  s.x_range] = Non
-00038c70: 652c 0a20 2020 2029 202d 3e20 6770 6c74  e,.    ) -> gplt
-00038c80: 5f70 6172 616d 732e 6669 6775 7265 3a0a  _params.figure:.
-00038c90: 2020 2020 2020 2020 2320 636f 6d70 7574          # comput
-00038ca0: 6520 6968 730a 2020 2020 2020 2020 782c  e ihs.        x,
-00038cb0: 2069 6873 203d 2073 656c 662e 6968 735f   ihs = self.ihs_
-00038cc0: 6777 7373 280a 2020 2020 2020 2020 2020  gwss(.          
-00038cd0: 2020 636f 6e74 6967 3d63 6f6e 7469 672c    contig=contig,
-00038ce0: 0a20 2020 2020 2020 2020 2020 2061 6e61  .            ana
-00038cf0: 6c79 7369 733d 616e 616c 7973 6973 2c0a  lysis=analysis,.
-00038d00: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-00038d10: 6f77 5f73 697a 653d 7769 6e64 6f77 5f73  ow_size=window_s
-00038d20: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-00038d30: 2070 6572 6365 6e74 696c 6573 3d70 6572   percentiles=per
-00038d40: 6365 6e74 696c 6573 2c0a 2020 2020 2020  centiles,.      
-00038d50: 2020 2020 2020 7374 616e 6461 7264 697a        standardiz
-00038d60: 653d 7374 616e 6461 7264 697a 652c 0a20  e=standardize,. 
-00038d70: 2020 2020 2020 2020 2020 2073 7461 6e64             stand
-00038d80: 6172 6469 7a61 7469 6f6e 5f62 696e 733d  ardization_bins=
-00038d90: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
-00038da0: 6269 6e73 2c0a 2020 2020 2020 2020 2020  bins,.          
-00038db0: 2020 7374 616e 6461 7264 697a 6174 696f    standardizatio
-00038dc0: 6e5f 6e5f 6269 6e73 3d73 7461 6e64 6172  n_n_bins=standar
-00038dd0: 6469 7a61 7469 6f6e 5f6e 5f62 696e 732c  dization_n_bins,
-00038de0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00038df0: 6e64 6172 6469 7a61 7469 6f6e 5f64 6961  ndardization_dia
-00038e00: 676e 6f73 7469 6373 3d73 7461 6e64 6172  gnostics=standar
-00038e10: 6469 7a61 7469 6f6e 5f64 6961 676e 6f73  dization_diagnos
-00038e20: 7469 6373 2c0a 2020 2020 2020 2020 2020  tics,.          
-00038e30: 2020 6669 6c74 6572 5f6d 696e 5f6d 6166    filter_min_maf
-00038e40: 3d66 696c 7465 725f 6d69 6e5f 6d61 662c  =filter_min_maf,
-00038e50: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-00038e60: 7075 7465 5f6d 696e 5f6d 6166 3d63 6f6d  pute_min_maf=com
-00038e70: 7075 7465 5f6d 696e 5f6d 6166 2c0a 2020  pute_min_maf,.  
-00038e80: 2020 2020 2020 2020 2020 6d69 6e5f 6568            min_eh
-00038e90: 683d 6d69 6e5f 6568 682c 0a20 2020 2020  h=min_ehh,.     
-00038ea0: 2020 2020 2020 206d 6178 5f67 6170 3d6d         max_gap=m
-00038eb0: 6178 5f67 6170 2c0a 2020 2020 2020 2020  ax_gap,.        
-00038ec0: 2020 2020 6761 705f 7363 616c 653d 6761      gap_scale=ga
-00038ed0: 705f 7363 616c 652c 0a20 2020 2020 2020  p_scale,.       
-00038ee0: 2020 2020 2069 6e63 6c75 6465 5f65 6467       include_edg
-00038ef0: 6573 3d69 6e63 6c75 6465 5f65 6467 6573  es=include_edges
-00038f00: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
-00038f10: 655f 7468 7265 6164 733d 7573 655f 7468  e_threads=use_th
-00038f20: 7265 6164 732c 0a20 2020 2020 2020 2020  reads,.         
-00038f30: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-00038f40: 7a65 3d6d 696e 5f63 6f68 6f72 745f 7369  ze=min_cohort_si
-00038f50: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-00038f60: 6d61 785f 636f 686f 7274 5f73 697a 653d  max_cohort_size=
-00038f70: 6d61 785f 636f 686f 7274 5f73 697a 652c  max_cohort_size,
-00038f80: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00038f90: 706c 655f 7175 6572 793d 7361 6d70 6c65  ple_query=sample
-00038fa0: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
-00038fb0: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
-00038fc0: 7361 6d70 6c65 5f73 6574 732c 0a20 2020  sample_sets,.   
-00038fd0: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
-00038fe0: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
-00038ff0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00039000: 2020 2020 2023 2064 6574 6572 6d69 6e65       # determine
-00039010: 2058 2061 7869 7320 7261 6e67 650a 2020   X axis range.  
-00039020: 2020 2020 2020 785f 6d69 6e20 3d20 785b        x_min = x[
-00039030: 305d 0a20 2020 2020 2020 2078 5f6d 6178  0].        x_max
-00039040: 203d 2078 5b2d 315d 0a20 2020 2020 2020   = x[-1].       
-00039050: 2069 6620 785f 7261 6e67 6520 6973 204e   if x_range is N
-00039060: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00039070: 2078 5f72 616e 6765 203d 2062 6f6b 6568   x_range = bokeh
-00039080: 2e6d 6f64 656c 732e 5261 6e67 6531 6428  .models.Range1d(
-00039090: 785f 6d69 6e2c 2078 5f6d 6178 2c20 626f  x_min, x_max, bo
-000390a0: 756e 6473 3d22 6175 746f 2229 0a0a 2020  unds="auto")..  
-000390b0: 2020 2020 2020 2320 6372 6561 7465 2061        # create a
-000390c0: 2066 6967 7572 650a 2020 2020 2020 2020   figure.        
-000390d0: 7877 6865 656c 5f7a 6f6f 6d20 3d20 626f  xwheel_zoom = bo
-000390e0: 6b65 682e 6d6f 6465 6c73 2e57 6865 656c  keh.models.Wheel
-000390f0: 5a6f 6f6d 546f 6f6c 280a 2020 2020 2020  ZoomTool(.      
-00039100: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-00039110: 3d22 7769 6474 6822 2c20 6d61 696e 7461  ="width", mainta
-00039120: 696e 5f66 6f63 7573 3d46 616c 7365 0a20  in_focus=False. 
-00039130: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00039140: 2069 6620 7469 746c 6520 6973 204e 6f6e   if title is Non
-00039150: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-00039160: 6974 6c65 203d 2073 616d 706c 655f 7175  itle = sample_qu
-00039170: 6572 790a 2020 2020 2020 2020 6669 6720  ery.        fig 
-00039180: 3d20 626f 6b65 682e 706c 6f74 7469 6e67  = bokeh.plotting
-00039190: 2e66 6967 7572 6528 0a20 2020 2020 2020  .figure(.       
-000391a0: 2020 2020 2074 6974 6c65 3d74 6974 6c65       title=title
-000391b0: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
-000391c0: 6f6c 733d 5b22 7870 616e 222c 2022 787a  ols=["xpan", "xz
-000391d0: 6f6f 6d5f 696e 222c 2022 787a 6f6f 6d5f  oom_in", "xzoom_
-000391e0: 6f75 7422 2c20 7877 6865 656c 5f7a 6f6f  out", xwheel_zoo
-000391f0: 6d2c 2022 7265 7365 7422 5d2c 0a20 2020  m, "reset"],.   
-00039200: 2020 2020 2020 2020 2061 6374 6976 655f           active_
-00039210: 7363 726f 6c6c 3d78 7768 6565 6c5f 7a6f  scroll=xwheel_zo
-00039220: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
-00039230: 6163 7469 7665 5f64 7261 673d 2278 7061  active_drag="xpa
-00039240: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-00039250: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-00039260: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-00039270: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-00039280: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-00039290: 6967 6874 3d68 6569 6768 742c 0a20 2020  ight=height,.   
-000392a0: 2020 2020 2020 2020 2074 6f6f 6c62 6172           toolbar
-000392b0: 5f6c 6f63 6174 696f 6e3d 2261 626f 7665  _location="above
-000392c0: 222c 0a20 2020 2020 2020 2020 2020 2078  ",.            x
-000392d0: 5f72 616e 6765 3d78 5f72 616e 6765 2c0a  _range=x_range,.
-000392e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000392f0: 2020 2069 6620 7769 6e64 6f77 5f73 697a     if window_siz
-00039300: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00039310: 6620 6973 696e 7374 616e 6365 2870 6572  f isinstance(per
-00039320: 6365 6e74 696c 6573 2c20 696e 7429 3a0a  centiles, int):.
-00039330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039340: 7065 7263 656e 7469 6c65 7320 3d20 2870  percentiles = (p
-00039350: 6572 6365 6e74 696c 6573 2c29 0a0a 2020  ercentiles,)..  
-00039360: 2020 2020 2020 2320 6164 6420 616e 2065        # add an e
-00039370: 6d70 7479 2064 696d 656e 7369 6f6e 2074  mpty dimension t
-00039380: 6f20 6968 7320 6172 7261 7920 6966 2031  o ihs array if 1
-00039390: 440a 2020 2020 2020 2020 6968 7320 3d20  D.        ihs = 
-000393a0: 6e70 2e72 6573 6861 7065 2869 6873 2c20  np.reshape(ihs, 
-000393b0: 2869 6873 2e73 6861 7065 5b30 5d2c 202d  (ihs.shape[0], -
-000393c0: 3129 290a 2020 2020 2020 2020 626f 6b65  1)).        boke
-000393d0: 685f 7061 6c65 7474 6520 3d20 626f 6b65  h_palette = boke
-000393e0: 682e 7061 6c65 7474 6573 2e61 6c6c 5f70  h.palettes.all_p
-000393f0: 616c 6574 7465 735b 7061 6c65 7474 655d  alettes[palette]
-00039400: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-00039410: 6e20 7261 6e67 6528 6968 732e 7368 6170  n range(ihs.shap
-00039420: 655b 315d 293a 0a20 2020 2020 2020 2020  e[1]):.         
-00039430: 2020 2069 6873 5f70 6572 6320 3d20 6968     ihs_perc = ih
-00039440: 735b 3a2c 2069 5d0a 2020 2020 2020 2020  s[:, i].        
-00039450: 2020 2020 6966 2069 6873 2e73 6861 7065      if ihs.shape
-00039460: 5b31 5d20 3e3d 2033 3a0a 2020 2020 2020  [1] >= 3:.      
-00039470: 2020 2020 2020 2020 2020 636f 6c6f 7220            color 
-00039480: 3d20 626f 6b65 685f 7061 6c65 7474 655b  = bokeh_palette[
-00039490: 6968 732e 7368 6170 655b 315d 5d5b 695d  ihs.shape[1]][i]
-000394a0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000394b0: 6620 6968 732e 7368 6170 655b 315d 203d  f ihs.shape[1] =
-000394c0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-000394d0: 2020 2020 2063 6f6c 6f72 203d 2062 6f6b       color = bok
-000394e0: 6568 5f70 616c 6574 7465 5b33 5d5b 695d  eh_palette[3][i]
-000394f0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00039500: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00039510: 2020 2063 6f6c 6f72 203d 204e 6f6e 650a     color = None.
-00039520: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-00039530: 6c6f 7420 6968 730a 2020 2020 2020 2020  lot ihs.        
-00039540: 2020 2020 6669 672e 6369 7263 6c65 280a      fig.circle(.
-00039550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039560: 783d 782c 0a20 2020 2020 2020 2020 2020  x=x,.           
-00039570: 2020 2020 2079 3d69 6873 5f70 6572 632c       y=ihs_perc,
-00039580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039590: 2073 697a 653d 332c 0a20 2020 2020 2020   size=3,.       
-000395a0: 2020 2020 2020 2020 206c 696e 655f 7769           line_wi
-000395b0: 6474 683d 302e 3135 2c0a 2020 2020 2020  dth=0.15,.      
-000395c0: 2020 2020 2020 2020 2020 6c69 6e65 5f63            line_c
-000395d0: 6f6c 6f72 3d22 626c 6163 6b22 2c0a 2020  olor="black",.  
-000395e0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000395f0: 6c6c 5f63 6f6c 6f72 3d63 6f6c 6f72 2c0a  ll_color=color,.
-00039600: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00039610: 2020 2020 2020 2023 2074 6964 7920 7570         # tidy up
-00039620: 2074 6865 2070 6c6f 740a 2020 2020 2020   the plot.      
-00039630: 2020 6669 672e 7961 7869 732e 6178 6973    fig.yaxis.axis
-00039640: 5f6c 6162 656c 203d 2022 6968 7322 0a20  _label = "ihs". 
-00039650: 2020 2020 2020 2073 656c 662e 5f62 6f6b         self._bok
-00039660: 6568 5f73 7479 6c65 5f67 656e 6f6d 655f  eh_style_genome_
-00039670: 7861 7869 7328 6669 672c 2063 6f6e 7469  xaxis(fig, conti
-00039680: 6729 0a0a 2020 2020 2020 2020 6966 2073  g)..        if s
-00039690: 686f 773a 0a20 2020 2020 2020 2020 2020  how:.           
-000396a0: 2062 6f6b 6568 2e70 6c6f 7474 696e 672e   bokeh.plotting.
-000396b0: 7368 6f77 2866 6967 290a 0a20 2020 2020  show(fig)..     
-000396c0: 2020 2072 6574 7572 6e20 6669 670a 0a20     return fig.. 
-000396d0: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
-000396e0: 2073 756d 6d61 7279 3d22 5275 6e20 616e   summary="Run an
-000396f0: 6420 706c 6f74 2069 4853 2047 5753 5320  d plot iHS GWSS 
-00039700: 6461 7461 2e22 2c0a 2020 2020 290a 2020  data.",.    ).  
-00039710: 2020 6465 6620 706c 6f74 5f69 6873 5f67    def plot_ihs_g
-00039720: 7773 7328 0a20 2020 2020 2020 2073 656c  wss(.        sel
-00039730: 662c 0a20 2020 2020 2020 2063 6f6e 7469  f,.        conti
-00039740: 673a 2062 6173 655f 7061 7261 6d73 2e63  g: base_params.c
-00039750: 6f6e 7469 672c 0a20 2020 2020 2020 2061  ontig,.        a
-00039760: 6e61 6c79 7369 733a 2068 6170 5f70 6172  nalysis: hap_par
-00039770: 616d 732e 616e 616c 7973 6973 203d 2044  ams.analysis = D
-00039780: 4546 4155 4c54 2c0a 2020 2020 2020 2020  EFAULT,.        
-00039790: 7361 6d70 6c65 5f73 6574 733a 204f 7074  sample_sets: Opt
-000397a0: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
-000397b0: 732e 7361 6d70 6c65 5f73 6574 735d 203d  s.sample_sets] =
-000397c0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-000397d0: 616d 706c 655f 7175 6572 793a 204f 7074  ample_query: Opt
-000397e0: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
-000397f0: 732e 7361 6d70 6c65 5f71 7565 7279 5d20  s.sample_query] 
-00039800: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00039810: 7769 6e64 6f77 5f73 697a 653a 2069 6873  window_size: ihs
-00039820: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
-00039830: 697a 6520 3d20 6968 735f 7061 7261 6d73  ize = ihs_params
-00039840: 2e77 696e 646f 775f 7369 7a65 5f64 6566  .window_size_def
-00039850: 6175 6c74 2c0a 2020 2020 2020 2020 7065  ault,.        pe
-00039860: 7263 656e 7469 6c65 733a 2069 6873 5f70  rcentiles: ihs_p
-00039870: 6172 616d 732e 7065 7263 656e 7469 6c65  arams.percentile
-00039880: 7320 3d20 6968 735f 7061 7261 6d73 2e70  s = ihs_params.p
-00039890: 6572 6365 6e74 696c 6573 5f64 6566 6175  ercentiles_defau
-000398a0: 6c74 2c0a 2020 2020 2020 2020 7374 616e  lt,.        stan
-000398b0: 6461 7264 697a 653a 2069 6873 5f70 6172  dardize: ihs_par
-000398c0: 616d 732e 7374 616e 6461 7264 697a 6520  ams.standardize 
-000398d0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-000398e0: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
-000398f0: 6269 6e73 3a20 4f70 7469 6f6e 616c 5b69  bins: Optional[i
-00039900: 6873 5f70 6172 616d 732e 7374 616e 6461  hs_params.standa
-00039910: 7264 697a 6174 696f 6e5f 6269 6e73 5d20  rdization_bins] 
-00039920: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00039930: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
-00039940: 6e5f 6269 6e73 3a20 6968 735f 7061 7261  n_bins: ihs_para
-00039950: 6d73 2e73 7461 6e64 6172 6469 7a61 7469  ms.standardizati
-00039960: 6f6e 5f6e 5f62 696e 7320 3d20 6968 735f  on_n_bins = ihs_
-00039970: 7061 7261 6d73 2e73 7461 6e64 6172 6469  params.standardi
-00039980: 7a61 7469 6f6e 5f6e 5f62 696e 735f 6465  zation_n_bins_de
-00039990: 6661 756c 742c 0a20 2020 2020 2020 2073  fault,.        s
-000399a0: 7461 6e64 6172 6469 7a61 7469 6f6e 5f64  tandardization_d
-000399b0: 6961 676e 6f73 7469 6373 3a20 6968 735f  iagnostics: ihs_
-000399c0: 7061 7261 6d73 2e73 7461 6e64 6172 6469  params.standardi
-000399d0: 7a61 7469 6f6e 5f64 6961 676e 6f73 7469  zation_diagnosti
-000399e0: 6373 203d 2046 616c 7365 2c0a 2020 2020  cs = False,.    
-000399f0: 2020 2020 6669 6c74 6572 5f6d 696e 5f6d      filter_min_m
-00039a00: 6166 3a20 6968 735f 7061 7261 6d73 2e66  af: ihs_params.f
-00039a10: 696c 7465 725f 6d69 6e5f 6d61 6620 3d20  ilter_min_maf = 
-00039a20: 6968 735f 7061 7261 6d73 2e66 696c 7465  ihs_params.filte
-00039a30: 725f 6d69 6e5f 6d61 665f 6465 6661 756c  r_min_maf_defaul
-00039a40: 742c 0a20 2020 2020 2020 2063 6f6d 7075  t,.        compu
-00039a50: 7465 5f6d 696e 5f6d 6166 3a20 6968 735f  te_min_maf: ihs_
-00039a60: 7061 7261 6d73 2e63 6f6d 7075 7465 5f6d  params.compute_m
-00039a70: 696e 5f6d 6166 203d 2069 6873 5f70 6172  in_maf = ihs_par
-00039a80: 616d 732e 636f 6d70 7574 655f 6d69 6e5f  ams.compute_min_
-00039a90: 6d61 665f 6465 6661 756c 742c 0a20 2020  maf_default,.   
-00039aa0: 2020 2020 206d 696e 5f65 6868 3a20 6968       min_ehh: ih
-00039ab0: 735f 7061 7261 6d73 2e6d 696e 5f65 6868  s_params.min_ehh
-00039ac0: 203d 2069 6873 5f70 6172 616d 732e 6d69   = ihs_params.mi
-00039ad0: 6e5f 6568 685f 6465 6661 756c 742c 0a20  n_ehh_default,. 
-00039ae0: 2020 2020 2020 206d 6178 5f67 6170 3a20         max_gap: 
-00039af0: 6968 735f 7061 7261 6d73 2e6d 6178 5f67  ihs_params.max_g
-00039b00: 6170 203d 2069 6873 5f70 6172 616d 732e  ap = ihs_params.
-00039b10: 6d61 785f 6761 705f 6465 6661 756c 742c  max_gap_default,
-00039b20: 0a20 2020 2020 2020 2067 6170 5f73 6361  .        gap_sca
-00039b30: 6c65 3a20 6968 735f 7061 7261 6d73 2e67  le: ihs_params.g
-00039b40: 6170 5f73 6361 6c65 203d 2069 6873 5f70  ap_scale = ihs_p
-00039b50: 6172 616d 732e 6761 705f 7363 616c 655f  arams.gap_scale_
-00039b60: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-00039b70: 2069 6e63 6c75 6465 5f65 6467 6573 3a20   include_edges: 
-00039b80: 6968 735f 7061 7261 6d73 2e69 6e63 6c75  ihs_params.inclu
-00039b90: 6465 5f65 6467 6573 203d 2054 7275 652c  de_edges = True,
-00039ba0: 0a20 2020 2020 2020 2075 7365 5f74 6872  .        use_thr
-00039bb0: 6561 6473 3a20 6968 735f 7061 7261 6d73  eads: ihs_params
-00039bc0: 2e75 7365 5f74 6872 6561 6473 203d 2054  .use_threads = T
-00039bd0: 7275 652c 0a20 2020 2020 2020 206d 696e  rue,.        min
-00039be0: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
-00039bf0: 7469 6f6e 616c 5b0a 2020 2020 2020 2020  tional[.        
-00039c00: 2020 2020 6261 7365 5f70 6172 616d 732e      base_params.
-00039c10: 6d69 6e5f 636f 686f 7274 5f73 697a 650a  min_cohort_size.
-00039c20: 2020 2020 2020 2020 5d20 3d20 6968 735f          ] = ihs_
-00039c30: 7061 7261 6d73 2e6d 696e 5f63 6f68 6f72  params.min_cohor
-00039c40: 745f 7369 7a65 5f64 6566 6175 6c74 2c0a  t_size_default,.
-00039c50: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
-00039c60: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
-00039c70: 6c5b 0a20 2020 2020 2020 2020 2020 2062  l[.            b
-00039c80: 6173 655f 7061 7261 6d73 2e6d 6178 5f63  ase_params.max_c
-00039c90: 6f68 6f72 745f 7369 7a65 0a20 2020 2020  ohort_size.     
-00039ca0: 2020 205d 203d 2069 6873 5f70 6172 616d     ] = ihs_param
-00039cb0: 732e 6d61 785f 636f 686f 7274 5f73 697a  s.max_cohort_siz
-00039cc0: 655f 6465 6661 756c 742c 0a20 2020 2020  e_default,.     
-00039cd0: 2020 2072 616e 646f 6d5f 7365 6564 3a20     random_seed: 
-00039ce0: 6261 7365 5f70 6172 616d 732e 7261 6e64  base_params.rand
-00039cf0: 6f6d 5f73 6565 6420 3d20 3432 2c0a 2020  om_seed = 42,.  
-00039d00: 2020 2020 2020 7061 6c65 7474 653a 2069        palette: i
-00039d10: 6873 5f70 6172 616d 732e 7061 6c65 7474  hs_params.palett
-00039d20: 6520 3d20 6968 735f 7061 7261 6d73 2e70  e = ihs_params.p
-00039d30: 616c 6574 7465 5f64 6566 6175 6c74 2c0a  alette_default,.
-00039d40: 2020 2020 2020 2020 7469 746c 653a 204f          title: O
-00039d50: 7074 696f 6e61 6c5b 6770 6c74 5f70 6172  ptional[gplt_par
-00039d60: 616d 732e 7469 746c 655d 203d 204e 6f6e  ams.title] = Non
-00039d70: 652c 0a20 2020 2020 2020 2073 697a 696e  e,.        sizin
-00039d80: 675f 6d6f 6465 3a20 6770 6c74 5f70 6172  g_mode: gplt_par
-00039d90: 616d 732e 7369 7a69 6e67 5f6d 6f64 6520  ams.sizing_mode 
-00039da0: 3d20 6770 6c74 5f70 6172 616d 732e 7369  = gplt_params.si
-00039db0: 7a69 6e67 5f6d 6f64 655f 6465 6661 756c  zing_mode_defaul
-00039dc0: 742c 0a20 2020 2020 2020 2077 6964 7468  t,.        width
-00039dd0: 3a20 6770 6c74 5f70 6172 616d 732e 7769  : gplt_params.wi
-00039de0: 6474 6820 3d20 6770 6c74 5f70 6172 616d  dth = gplt_param
-00039df0: 732e 7769 6474 685f 6465 6661 756c 742c  s.width_default,
-00039e00: 0a20 2020 2020 2020 2074 7261 636b 5f68  .        track_h
-00039e10: 6569 6768 743a 2067 706c 745f 7061 7261  eight: gplt_para
-00039e20: 6d73 2e74 7261 636b 5f68 6569 6768 7420  ms.track_height 
-00039e30: 3d20 3137 302c 0a20 2020 2020 2020 2067  = 170,.        g
-00039e40: 656e 6573 5f68 6569 6768 743a 2067 706c  enes_height: gpl
-00039e50: 745f 7061 7261 6d73 2e67 656e 6573 5f68  t_params.genes_h
-00039e60: 6569 6768 7420 3d20 6770 6c74 5f70 6172  eight = gplt_par
-00039e70: 616d 732e 6765 6e65 735f 6865 6967 6874  ams.genes_height
-00039e80: 5f64 6566 6175 6c74 2c0a 2020 2020 2920  _default,.    ) 
-00039e90: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00039ea0: 2023 2067 7773 7320 7472 6163 6b0a 2020   # gwss track.  
-00039eb0: 2020 2020 2020 6669 6731 203d 2073 656c        fig1 = sel
-00039ec0: 662e 706c 6f74 5f69 6873 5f67 7773 735f  f.plot_ihs_gwss_
-00039ed0: 7472 6163 6b28 0a20 2020 2020 2020 2020  track(.         
-00039ee0: 2020 2063 6f6e 7469 673d 636f 6e74 6967     contig=contig
-00039ef0: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
-00039f00: 616c 7973 6973 3d61 6e61 6c79 7369 732c  alysis=analysis,
-00039f10: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00039f20: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
-00039f30: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
-00039f40: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
-00039f50: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
-00039f60: 2020 2020 2020 2020 2077 696e 646f 775f           window_
-00039f70: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
-00039f80: 2c0a 2020 2020 2020 2020 2020 2020 7065  ,.            pe
-00039f90: 7263 656e 7469 6c65 733d 7065 7263 656e  rcentiles=percen
-00039fa0: 7469 6c65 732c 0a20 2020 2020 2020 2020  tiles,.         
-00039fb0: 2020 2070 616c 6574 7465 3d70 616c 6574     palette=palet
-00039fc0: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-00039fd0: 7374 616e 6461 7264 697a 653d 7374 616e  standardize=stan
-00039fe0: 6461 7264 697a 652c 0a20 2020 2020 2020  dardize,.       
-00039ff0: 2020 2020 2073 7461 6e64 6172 6469 7a61       standardiza
-0003a000: 7469 6f6e 5f62 696e 733d 7374 616e 6461  tion_bins=standa
-0003a010: 7264 697a 6174 696f 6e5f 6269 6e73 2c0a  rdization_bins,.
-0003a020: 2020 2020 2020 2020 2020 2020 7374 616e              stan
-0003a030: 6461 7264 697a 6174 696f 6e5f 6e5f 6269  dardization_n_bi
-0003a040: 6e73 3d73 7461 6e64 6172 6469 7a61 7469  ns=standardizati
-0003a050: 6f6e 5f6e 5f62 696e 732c 0a20 2020 2020  on_n_bins,.     
-0003a060: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
-0003a070: 7a61 7469 6f6e 5f64 6961 676e 6f73 7469  zation_diagnosti
-0003a080: 6373 3d73 7461 6e64 6172 6469 7a61 7469  cs=standardizati
-0003a090: 6f6e 5f64 6961 676e 6f73 7469 6373 2c0a  on_diagnostics,.
-0003a0a0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-0003a0b0: 6572 5f6d 696e 5f6d 6166 3d66 696c 7465  er_min_maf=filte
-0003a0c0: 725f 6d69 6e5f 6d61 662c 0a20 2020 2020  r_min_maf,.     
-0003a0d0: 2020 2020 2020 2063 6f6d 7075 7465 5f6d         compute_m
-0003a0e0: 696e 5f6d 6166 3d63 6f6d 7075 7465 5f6d  in_maf=compute_m
-0003a0f0: 696e 5f6d 6166 2c0a 2020 2020 2020 2020  in_maf,.        
-0003a100: 2020 2020 6d69 6e5f 6568 683d 6d69 6e5f      min_ehh=min_
-0003a110: 6568 682c 0a20 2020 2020 2020 2020 2020  ehh,.           
-0003a120: 206d 6178 5f67 6170 3d6d 6178 5f67 6170   max_gap=max_gap
-0003a130: 2c0a 2020 2020 2020 2020 2020 2020 6761  ,.            ga
-0003a140: 705f 7363 616c 653d 6761 705f 7363 616c  p_scale=gap_scal
-0003a150: 652c 0a20 2020 2020 2020 2020 2020 2069  e,.            i
-0003a160: 6e63 6c75 6465 5f65 6467 6573 3d69 6e63  nclude_edges=inc
-0003a170: 6c75 6465 5f65 6467 6573 2c0a 2020 2020  lude_edges,.    
-0003a180: 2020 2020 2020 2020 7573 655f 7468 7265          use_thre
-0003a190: 6164 733d 7573 655f 7468 7265 6164 732c  ads=use_threads,
-0003a1a0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-0003a1b0: 5f63 6f68 6f72 745f 7369 7a65 3d6d 696e  _cohort_size=min
-0003a1c0: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
-0003a1d0: 2020 2020 2020 2020 2020 6d61 785f 636f            max_co
-0003a1e0: 686f 7274 5f73 697a 653d 6d61 785f 636f  hort_size=max_co
-0003a1f0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-0003a200: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-0003a210: 6564 3d72 616e 646f 6d5f 7365 6564 2c0a  ed=random_seed,.
-0003a220: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-0003a230: 653d 7469 746c 652c 0a20 2020 2020 2020  e=title,.       
-0003a240: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
-0003a250: 3d73 697a 696e 675f 6d6f 6465 2c0a 2020  =sizing_mode,.  
-0003a260: 2020 2020 2020 2020 2020 7769 6474 683d            width=
-0003a270: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0003a280: 2020 2068 6569 6768 743d 7472 6163 6b5f     height=track_
-0003a290: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
-0003a2a0: 2020 2020 7368 6f77 3d46 616c 7365 2c0a      show=False,.
-0003a2b0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0003a2c0: 2020 2066 6967 312e 7861 7869 732e 7669     fig1.xaxis.vi
-0003a2d0: 7369 626c 6520 3d20 4661 6c73 650a 0a20  sible = False.. 
-0003a2e0: 2020 2020 2020 2023 2070 6c6f 7420 6765         # plot ge
-0003a2f0: 6e65 730a 2020 2020 2020 2020 6669 6732  nes.        fig2
-0003a300: 203d 2073 656c 662e 706c 6f74 5f67 656e   = self.plot_gen
-0003a310: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-0003a320: 7265 6769 6f6e 3d63 6f6e 7469 672c 0a20  region=contig,. 
-0003a330: 2020 2020 2020 2020 2020 2073 697a 696e             sizin
-0003a340: 675f 6d6f 6465 3d73 697a 696e 675f 6d6f  g_mode=sizing_mo
-0003a350: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-0003a360: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
-0003a370: 2020 2020 2020 2020 2068 6569 6768 743d           height=
-0003a380: 6765 6e65 735f 6865 6967 6874 2c0a 2020  genes_height,.  
-0003a390: 2020 2020 2020 2020 2020 785f 7261 6e67            x_rang
-0003a3a0: 653d 6669 6731 2e78 5f72 616e 6765 2c0a  e=fig1.x_range,.
-0003a3b0: 2020 2020 2020 2020 2020 2020 7368 6f77              show
-0003a3c0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0003a3d0: 290a 0a20 2020 2020 2020 2023 2063 6f6d  )..        # com
-0003a3e0: 6269 6e65 2070 6c6f 7473 2069 6e74 6f20  bine plots into 
-0003a3f0: 6120 7369 6e67 6c65 2066 6967 7572 650a  a single figure.
-0003a400: 2020 2020 2020 2020 6669 6720 3d20 626f          fig = bo
-0003a410: 6b65 682e 6c61 796f 7574 732e 6772 6964  keh.layouts.grid
-0003a420: 706c 6f74 280a 2020 2020 2020 2020 2020  plot(.          
-0003a430: 2020 5b66 6967 312c 2066 6967 325d 2c0a    [fig1, fig2],.
-0003a440: 2020 2020 2020 2020 2020 2020 6e63 6f6c              ncol
-0003a450: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
-0003a460: 2074 6f6f 6c62 6172 5f6c 6f63 6174 696f   toolbar_locatio
-0003a470: 6e3d 2261 626f 7665 222c 0a20 2020 2020  n="above",.     
-0003a480: 2020 2020 2020 206d 6572 6765 5f74 6f6f         merge_too
-0003a490: 6c73 3d54 7275 652c 0a20 2020 2020 2020  ls=True,.       
-0003a4a0: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
-0003a4b0: 3d73 697a 696e 675f 6d6f 6465 2c0a 2020  =sizing_mode,.  
-0003a4c0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0003a4d0: 2062 6f6b 6568 2e70 6c6f 7474 696e 672e   bokeh.plotting.
-0003a4e0: 7368 6f77 2866 6967 290a 0a20 2020 2064  show(fig)..    d
-0003a4f0: 6566 205f 6761 7275 645f 6731 3233 2873  ef _garud_g123(s
-0003a500: 656c 662c 2067 7429 3a0a 2020 2020 2020  elf, gt):.      
-0003a510: 2020 2222 2243 6f6d 7075 7465 2047 6172    """Compute Gar
-0003a520: 7564 2773 2047 3132 332e 2222 220a 0a20  ud's G123.""".. 
-0003a530: 2020 2020 2020 2023 2063 6f6d 7075 7465         # compute
-0003a540: 2064 6970 6c6f 7479 7065 2066 7265 7175   diplotype frequ
-0003a550: 656e 6369 6573 0a20 2020 2020 2020 2066  encies.        f
-0003a560: 7271 5f63 6f75 6e74 6572 203d 205f 6469  rq_counter = _di
-0003a570: 706c 6f74 7970 655f 6672 6571 7565 6e63  plotype_frequenc
-0003a580: 6965 7328 6774 290a 0a20 2020 2020 2020  ies(gt)..       
-0003a590: 2023 2063 6f6e 7665 7274 2074 6f20 6172   # convert to ar
-0003a5a0: 7261 7920 6f66 2073 6f72 7465 6420 6672  ray of sorted fr
-0003a5b0: 6571 7565 6e63 6965 730a 2020 2020 2020  equencies.      
-0003a5c0: 2020 6620 3d20 6e70 2e73 6f72 7428 6e70    f = np.sort(np
-0003a5d0: 2e66 726f 6d69 7465 7228 6672 715f 636f  .fromiter(frq_co
-0003a5e0: 756e 7465 722e 7661 6c75 6573 2829 2c20  unter.values(), 
-0003a5f0: 6474 7970 653d 666c 6f61 7429 295b 3a3a  dtype=float))[::
-0003a600: 2d31 5d0a 0a20 2020 2020 2020 2023 2063  -1]..        # c
-0003a610: 6f6d 7075 7465 2047 3132 330a 2020 2020  ompute G123.    
-0003a620: 2020 2020 6731 3233 203d 206e 702e 7375      g123 = np.su
-0003a630: 6d28 665b 3a33 5d29 202a 2a20 3220 2b20  m(f[:3]) ** 2 + 
-0003a640: 6e70 2e73 756d 2866 5b33 3a5d 202a 2a20  np.sum(f[3:] ** 
-0003a650: 3229 0a0a 2020 2020 2020 2020 2320 5468  2)..        # Th
-0003a660: 6573 6520 6f74 6865 7220 7374 6174 6973  ese other statis
-0003a670: 7469 6373 2061 7265 206e 6f74 2063 7572  tics are not cur
-0003a680: 7265 6e74 6c79 206e 6565 6465 642c 2062  rently needed, b
-0003a690: 7574 206c 6561 7669 6e67 2068 6572 650a  ut leaving here.
-0003a6a0: 2020 2020 2020 2020 2320 636f 6d6d 656e          # commen
-0003a6b0: 7465 6420 6f75 7420 666f 7220 6675 7475  ted out for futu
-0003a6c0: 7265 2072 6566 6572 656e 6365 2e2e 2e0a  re reference....
-0003a6d0: 0a20 2020 2020 2020 2023 2063 6f6d 7075  .        # compu
-0003a6e0: 7465 2047 310a 2020 2020 2020 2020 2320  te G1.        # 
-0003a6f0: 6731 203d 206e 702e 7375 6d28 662a 2a32  g1 = np.sum(f**2
-0003a700: 290a 0a20 2020 2020 2020 2023 2063 6f6d  )..        # com
-0003a710: 7075 7465 2047 3132 0a20 2020 2020 2020  pute G12.       
-0003a720: 2023 2067 3132 203d 206e 702e 7375 6d28   # g12 = np.sum(
-0003a730: 665b 3a32 5d29 202a 2a20 3220 2b20 6e70  f[:2]) ** 2 + np
-0003a740: 2e73 756d 2866 5b32 3a5d 202a 2a20 3229  .sum(f[2:] ** 2)
-0003a750: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-0003a760: 5b69 6e64 6578 5d0a 0a20 2020 2020 2020  [index]..       
-0003a770: 2023 2063 6f6d 7075 7465 2047 322f 4731   # compute G2/G1
-0003a780: 0a20 2020 2020 2020 2023 2067 3220 3d20  .        # g2 = 
-0003a790: 6731 202d 2066 5b30 5d20 2a2a 2032 2020  g1 - f[0] ** 2  
-0003a7a0: 2320 7479 7065 3a20 6967 6e6f 7265 5b69  # type: ignore[i
-0003a7b0: 6e64 6578 5d0a 2020 2020 2020 2020 2320  ndex].        # 
-0003a7c0: 6732 5f67 3120 3d20 6732 202f 2067 310a  g2_g1 = g2 / g1.
-0003a7d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0003a7e0: 6731 3233 0a0a 2020 2020 4064 6f63 280a  g123..    @doc(.
-0003a7f0: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-0003a800: 2252 756e 2061 2047 3132 3320 6765 6e6f  "Run a G123 geno
-0003a810: 6d65 2d77 6964 6520 7365 6c65 6374 696f  me-wide selectio
-0003a820: 6e20 7363 616e 2e22 2c0a 2020 2020 2020  n scan.",.      
-0003a830: 2020 7265 7475 726e 733d 6469 6374 280a    returns=dict(.
-0003a840: 2020 2020 2020 2020 2020 2020 783d 2241              x="A
-0003a850: 6e20 6172 7261 7920 636f 6e74 6169 6e69  n array containi
-0003a860: 6e67 2074 6865 2077 696e 646f 7720 6365  ng the window ce
-0003a870: 6e74 7265 2070 6f69 6e74 2067 656e 6f6d  ntre point genom
-0003a880: 6963 2070 6f73 6974 696f 6e73 2e22 2c0a  ic positions.",.
-0003a890: 2020 2020 2020 2020 2020 2020 6731 3233              g123
-0003a8a0: 3d22 416e 2061 7272 6179 2077 6974 6820  ="An array with 
-0003a8b0: 4731 3233 2073 7461 7469 7374 6963 2076  G123 statistic v
-0003a8c0: 616c 7565 7320 666f 7220 6561 6368 2077  alues for each w
-0003a8d0: 696e 646f 772e 222c 0a20 2020 2020 2020  indow.",.       
-0003a8e0: 2029 2c0a 2020 2020 290a 2020 2020 6465   ),.    ).    de
-0003a8f0: 6620 6731 3233 5f67 7773 7328 0a20 2020  f g123_gwss(.   
-0003a900: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0003a910: 2020 2063 6f6e 7469 673a 2062 6173 655f     contig: base_
-0003a920: 7061 7261 6d73 2e63 6f6e 7469 672c 0a20  params.contig,. 
-0003a930: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
-0003a940: 7a65 3a20 6731 3233 5f70 6172 616d 732e  ze: g123_params.
-0003a950: 7769 6e64 6f77 5f73 697a 652c 0a20 2020  window_size,.   
-0003a960: 2020 2020 2073 6974 6573 3a20 6731 3233       sites: g123
-0003a970: 5f70 6172 616d 732e 7369 7465 7320 3d20  _params.sites = 
-0003a980: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
-0003a990: 2073 6974 655f 6d61 736b 3a20 6261 7365   site_mask: base
-0003a9a0: 5f70 6172 616d 732e 7369 7465 5f6d 6173  _params.site_mas
-0003a9b0: 6b20 3d20 4445 4641 554c 542c 0a20 2020  k = DEFAULT,.   
-0003a9c0: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
-0003a9d0: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-0003a9e0: 7061 7261 6d73 2e73 616d 706c 655f 7365  params.sample_se
-0003a9f0: 7473 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ts] = None,.    
-0003aa00: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-0003aa10: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-0003aa20: 7061 7261 6d73 2e73 616d 706c 655f 7175  params.sample_qu
-0003aa30: 6572 795d 203d 204e 6f6e 652c 0a20 2020  ery] = None,.   
-0003aa40: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-0003aa50: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b0a  size: Optional[.
-0003aa60: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0003aa70: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
-0003aa80: 7274 5f73 697a 650a 2020 2020 2020 2020  rt_size.        
-0003aa90: 5d20 3d20 6731 3233 5f70 6172 616d 732e  ] = g123_params.
-0003aaa0: 6d69 6e5f 636f 686f 7274 5f73 697a 655f  min_cohort_size_
-0003aab0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-0003aac0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
-0003aad0: 3a20 4f70 7469 6f6e 616c 5b0a 2020 2020  : Optional[.    
-0003aae0: 2020 2020 2020 2020 6261 7365 5f70 6172          base_par
-0003aaf0: 616d 732e 6d61 785f 636f 686f 7274 5f73  ams.max_cohort_s
-0003ab00: 697a 650a 2020 2020 2020 2020 5d20 3d20  ize.        ] = 
-0003ab10: 6731 3233 5f70 6172 616d 732e 6d61 785f  g123_params.max_
-0003ab20: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
-0003ab30: 756c 742c 0a20 2020 2020 2020 2072 616e  ult,.        ran
-0003ab40: 646f 6d5f 7365 6564 3a20 6261 7365 5f70  dom_seed: base_p
-0003ab50: 6172 616d 732e 7261 6e64 6f6d 5f73 6565  arams.random_see
-0003ab60: 6420 3d20 3432 2c0a 2020 2020 2920 2d3e  d = 42,.    ) ->
-0003ab70: 2054 7570 6c65 5b6e 702e 6e64 6172 7261   Tuple[np.ndarra
-0003ab80: 792c 206e 702e 6e64 6172 7261 795d 3a0a  y, np.ndarray]:.
-0003ab90: 2020 2020 2020 2020 2320 6368 616e 6765          # change
-0003aba0: 2074 6869 7320 6e61 6d65 2069 6620 796f   this name if yo
-0003abb0: 7520 6576 6572 2063 6861 6e67 6520 7468  u ever change th
-0003abc0: 6520 6265 6861 7669 6f75 7220 6f66 2074  e behaviour of t
-0003abd0: 6869 7320 6675 6e63 7469 6f6e 2c20 746f  his function, to
-0003abe0: 0a20 2020 2020 2020 2023 2069 6e76 616c  .        # inval
-0003abf0: 6964 6174 6520 616e 7920 7072 6576 696f  idate any previo
-0003ac00: 7573 6c79 2063 6163 6865 6420 6461 7461  usly cached data
-0003ac10: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-0003ac20: 7365 6c66 2e5f 6731 3233 5f67 7773 735f  self._g123_gwss_
-0003ac30: 6361 6368 655f 6e61 6d65 0a0a 2020 2020  cache_name..    
-0003ac40: 2020 2020 6966 2073 6974 6573 203d 3d20      if sites == 
-0003ac50: 4445 4641 554c 543a 0a20 2020 2020 2020  DEFAULT:.       
-0003ac60: 2020 2020 2073 6974 6573 203d 2073 656c       sites = sel
-0003ac70: 662e 5f64 6566 6175 6c74 5f70 6861 7369  f._default_phasi
-0003ac80: 6e67 5f61 6e61 6c79 7369 730a 2020 2020  ng_analysis.    
-0003ac90: 2020 2020 7661 6c69 645f 7369 7465 7320      valid_sites 
-0003aca0: 3d20 7365 6c66 2e70 6861 7369 6e67 5f61  = self.phasing_a
-0003acb0: 6e61 6c79 7369 735f 6964 7320 2b20 2822  nalysis_ids + ("
-0003acc0: 616c 6c22 2c20 2273 6567 7265 6761 7469  all", "segregati
-0003acd0: 6e67 2229 0a20 2020 2020 2020 2069 6620  ng").        if 
-0003ace0: 7369 7465 7320 6e6f 7420 696e 2076 616c  sites not in val
-0003acf0: 6964 5f73 6974 6573 3a0a 2020 2020 2020  id_sites:.      
-0003ad00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0003ad10: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0003ad20: 2020 2020 2020 2020 6622 496e 7661 6c69          f"Invali
-0003ad30: 6420 7661 6c75 6520 666f 7220 6073 6974  d value for `sit
-0003ad40: 6573 6020 7061 7261 6d65 7465 722c 206d  es` parameter, m
-0003ad50: 7573 7420 6265 206f 6e65 206f 6620 7b76  ust be one of {v
-0003ad60: 616c 6964 5f73 6974 6573 7d2e 220a 2020  alid_sites}.".  
-0003ad70: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0003ad80: 2020 2020 2070 6172 616d 7320 3d20 6469       params = di
-0003ad90: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-0003ada0: 636f 6e74 6967 3d63 6f6e 7469 672c 0a20  contig=contig,. 
-0003adb0: 2020 2020 2020 2020 2020 2073 6974 6573             sites
-0003adc0: 3d73 6974 6573 2c0a 2020 2020 2020 2020  =sites,.        
-0003add0: 2020 2020 7369 7465 5f6d 6173 6b3d 7369      site_mask=si
-0003ade0: 7465 5f6d 6173 6b2c 0a20 2020 2020 2020  te_mask,.       
-0003adf0: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
-0003ae00: 3d77 696e 646f 775f 7369 7a65 2c0a 2020  =window_size,.  
-0003ae10: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
-0003ae20: 5f73 6574 733d 7365 6c66 2e5f 7072 6570  _sets=self._prep
-0003ae30: 5f73 616d 706c 655f 7365 7473 5f70 6172  _sample_sets_par
-0003ae40: 616d 2873 616d 706c 655f 7365 7473 3d73  am(sample_sets=s
-0003ae50: 616d 706c 655f 7365 7473 292c 0a20 2020  ample_sets),.   
-0003ae60: 2020 2020 2020 2020 2023 204e 2e42 2e2c           # N.B.,
-0003ae70: 2064 6f20 6e6f 7420 6265 2074 656d 7074   do not be tempt
-0003ae80: 6564 2074 6f20 636f 6e76 6572 7420 7468  ed to convert th
-0003ae90: 6973 2073 616d 706c 6520 7175 6572 7920  is sample query 
-0003aea0: 696e 746f 2069 6e74 6567 6572 0a20 2020  into integer.   
-0003aeb0: 2020 2020 2020 2020 2023 2069 6e64 6963           # indic
-0003aec0: 6573 2075 7369 6e67 205f 7072 6570 5f73  es using _prep_s
-0003aed0: 616d 706c 655f 7365 6c65 6374 696f 6e5f  ample_selection_
-0003aee0: 7061 7261 6d73 2c20 6265 6361 7573 6520  params, because 
-0003aef0: 7468 6520 696e 6469 6365 730a 2020 2020  the indices.    
-0003af00: 2020 2020 2020 2020 2320 6172 6520 6469          # are di
-0003af10: 6666 6572 656e 7420 696e 2074 6865 2068  fferent in the h
-0003af20: 6170 6c6f 7479 7065 2064 6174 612e 0a20  aplotype data.. 
-0003af30: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-0003af40: 655f 7175 6572 793d 7361 6d70 6c65 5f71  e_query=sample_q
-0003af50: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
-0003af60: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
-0003af70: 653d 6d69 6e5f 636f 686f 7274 5f73 697a  e=min_cohort_siz
-0003af80: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-0003af90: 6178 5f63 6f68 6f72 745f 7369 7a65 3d6d  ax_cohort_size=m
-0003afa0: 6178 5f63 6f68 6f72 745f 7369 7a65 2c0a  ax_cohort_size,.
-0003afb0: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
-0003afc0: 6f6d 5f73 6565 643d 7261 6e64 6f6d 5f73  om_seed=random_s
-0003afd0: 6565 642c 0a20 2020 2020 2020 2029 0a0a  eed,.        )..
-0003afe0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0003aff0: 2020 2020 2020 2020 2072 6573 756c 7473           results
-0003b000: 203d 2073 656c 662e 7265 7375 6c74 735f   = self.results_
-0003b010: 6361 6368 655f 6765 7428 6e61 6d65 3d6e  cache_get(name=n
-0003b020: 616d 652c 2070 6172 616d 733d 7061 7261  ame, params=para
-0003b030: 6d73 290a 0a20 2020 2020 2020 2065 7863  ms)..        exc
-0003b040: 6570 7420 4361 6368 654d 6973 733a 0a20  ept CacheMiss:. 
-0003b050: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0003b060: 7473 203d 2073 656c 662e 5f67 3132 335f  ts = self._g123_
-0003b070: 6777 7373 282a 2a70 6172 616d 7329 0a20  gwss(**params). 
-0003b080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003b090: 7265 7375 6c74 735f 6361 6368 655f 7365  results_cache_se
-0003b0a0: 7428 6e61 6d65 3d6e 616d 652c 2070 6172  t(name=name, par
-0003b0b0: 616d 733d 7061 7261 6d73 2c20 7265 7375  ams=params, resu
-0003b0c0: 6c74 733d 7265 7375 6c74 7329 0a0a 2020  lts=results)..  
-0003b0d0: 2020 2020 2020 7820 3d20 7265 7375 6c74        x = result
-0003b0e0: 735b 2278 225d 0a20 2020 2020 2020 2067  s["x"].        g
-0003b0f0: 3132 3320 3d20 7265 7375 6c74 735b 2267  123 = results["g
-0003b100: 3132 3322 5d0a 0a20 2020 2020 2020 2072  123"]..        r
-0003b110: 6574 7572 6e20 782c 2067 3132 330a 0a20  eturn x, g123.. 
-0003b120: 2020 2064 6566 205f 6731 3233 5f67 7773     def _g123_gws
-0003b130: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0003b140: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
-0003b150: 2020 2020 636f 6e74 6967 2c0a 2020 2020      contig,.    
-0003b160: 2020 2020 7369 7465 732c 0a20 2020 2020      sites,.     
-0003b170: 2020 2073 6974 655f 6d61 736b 2c0a 2020     site_mask,.  
-0003b180: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
-0003b190: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
-0003b1a0: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
-0003b1b0: 7361 6d70 6c65 5f71 7565 7279 2c0a 2020  sample_query,.  
-0003b1c0: 2020 2020 2020 6d69 6e5f 636f 686f 7274        min_cohort
-0003b1d0: 5f73 697a 652c 0a20 2020 2020 2020 206d  _size,.        m
-0003b1e0: 6178 5f63 6f68 6f72 745f 7369 7a65 2c0a  ax_cohort_size,.
-0003b1f0: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-0003b200: 6565 642c 0a20 2020 2029 3a0a 2020 2020  eed,.    ):.    
-0003b210: 2020 2020 6774 2c20 706f 7320 3d20 7365      gt, pos = se
-0003b220: 6c66 2e5f 6c6f 6164 5f64 6174 615f 666f  lf._load_data_fo
-0003b230: 725f 6731 3233 280a 2020 2020 2020 2020  r_g123(.        
-0003b240: 2020 2020 636f 6e74 6967 3d63 6f6e 7469      contig=conti
-0003b250: 672c 0a20 2020 2020 2020 2020 2020 2073  g,.            s
-0003b260: 6974 6573 3d73 6974 6573 2c0a 2020 2020  ites=sites,.    
-0003b270: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
-0003b280: 6b3d 7369 7465 5f6d 6173 6b2c 0a20 2020  k=site_mask,.   
-0003b290: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
-0003b2a0: 7365 7473 3d73 616d 706c 655f 7365 7473  sets=sample_sets
-0003b2b0: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
-0003b2c0: 6d70 6c65 5f71 7565 7279 3d73 616d 706c  mple_query=sampl
-0003b2d0: 655f 7175 6572 792c 0a20 2020 2020 2020  e_query,.       
-0003b2e0: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
-0003b2f0: 7369 7a65 3d6d 696e 5f63 6f68 6f72 745f  size=min_cohort_
-0003b300: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-0003b310: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
-0003b320: 653d 6d61 785f 636f 686f 7274 5f73 697a  e=max_cohort_siz
-0003b330: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
-0003b340: 616e 646f 6d5f 7365 6564 3d72 616e 646f  andom_seed=rando
-0003b350: 6d5f 7365 6564 2c0a 2020 2020 2020 2020  m_seed,.        
-0003b360: 290a 0a20 2020 2020 2020 2067 3132 3320  )..        g123 
-0003b370: 3d20 616c 6c65 6c2e 6d6f 7669 6e67 5f73  = allel.moving_s
-0003b380: 7461 7469 7374 6963 2867 742c 2073 7461  tatistic(gt, sta
-0003b390: 7469 7374 6963 3d73 656c 662e 5f67 6172  tistic=self._gar
-0003b3a0: 7564 5f67 3132 332c 2073 697a 653d 7769  ud_g123, size=wi
-0003b3b0: 6e64 6f77 5f73 697a 6529 0a20 2020 2020  ndow_size).     
-0003b3c0: 2020 2078 203d 2061 6c6c 656c 2e6d 6f76     x = allel.mov
-0003b3d0: 696e 675f 7374 6174 6973 7469 6328 706f  ing_statistic(po
-0003b3e0: 732c 2073 7461 7469 7374 6963 3d6e 702e  s, statistic=np.
-0003b3f0: 6d65 616e 2c20 7369 7a65 3d77 696e 646f  mean, size=windo
-0003b400: 775f 7369 7a65 290a 0a20 2020 2020 2020  w_size)..       
-0003b410: 2072 6573 756c 7473 203d 2064 6963 7428   results = dict(
-0003b420: 783d 782c 2067 3132 333d 6731 3233 290a  x=x, g123=g123).
-0003b430: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0003b440: 7265 7375 6c74 730a 0a20 2020 2040 646f  results..    @do
-0003b450: 6328 0a20 2020 2020 2020 2073 756d 6d61  c(.        summa
-0003b460: 7279 3d22 506c 6f74 2047 3132 3320 4757  ry="Plot G123 GW
-0003b470: 5353 2064 6174 612e 222c 0a20 2020 2029  SS data.",.    )
-0003b480: 0a20 2020 2064 6566 2070 6c6f 745f 6731  .    def plot_g1
-0003b490: 3233 5f67 7773 735f 7472 6163 6b28 0a20  23_gwss_track(. 
-0003b4a0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0003b4b0: 2020 2020 2063 6f6e 7469 673a 2062 6173       contig: bas
-0003b4c0: 655f 7061 7261 6d73 2e63 6f6e 7469 672c  e_params.contig,
-0003b4d0: 0a20 2020 2020 2020 2077 696e 646f 775f  .        window_
-0003b4e0: 7369 7a65 3a20 6731 3233 5f70 6172 616d  size: g123_param
-0003b4f0: 732e 7769 6e64 6f77 5f73 697a 652c 0a20  s.window_size,. 
-0003b500: 2020 2020 2020 2073 6974 6573 3a20 6731         sites: g1
-0003b510: 3233 5f70 6172 616d 732e 7369 7465 7320  23_params.sites 
-0003b520: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
-0003b530: 2020 2073 6974 655f 6d61 736b 3a20 6261     site_mask: ba
-0003b540: 7365 5f70 6172 616d 732e 7369 7465 5f6d  se_params.site_m
-0003b550: 6173 6b20 3d20 4445 4641 554c 542c 0a20  ask = DEFAULT,. 
-0003b560: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-0003b570: 7473 3a20 4f70 7469 6f6e 616c 5b62 6173  ts: Optional[bas
-0003b580: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
-0003b590: 7365 7473 5d20 3d20 4e6f 6e65 2c0a 2020  sets] = None,.  
-0003b5a0: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
-0003b5b0: 7279 3a20 4f70 7469 6f6e 616c 5b62 6173  ry: Optional[bas
-0003b5c0: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
-0003b5d0: 7175 6572 795d 203d 204e 6f6e 652c 0a20  query] = None,. 
-0003b5e0: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
-0003b5f0: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
-0003b600: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
-0003b610: 7365 5f70 6172 616d 732e 6d69 6e5f 636f  se_params.min_co
-0003b620: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
-0003b630: 2020 5d20 3d20 6731 3233 5f70 6172 616d    ] = g123_param
-0003b640: 732e 6d69 6e5f 636f 686f 7274 5f73 697a  s.min_cohort_siz
-0003b650: 655f 6465 6661 756c 742c 0a20 2020 2020  e_default,.     
-0003b660: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
-0003b670: 7a65 3a20 4f70 7469 6f6e 616c 5b0a 2020  ze: Optional[.  
-0003b680: 2020 2020 2020 2020 2020 6261 7365 5f70            base_p
-0003b690: 6172 616d 732e 6d61 785f 636f 686f 7274  arams.max_cohort
-0003b6a0: 5f73 697a 650a 2020 2020 2020 2020 5d20  _size.        ] 
-0003b6b0: 3d20 6731 3233 5f70 6172 616d 732e 6d61  = g123_params.ma
-0003b6c0: 785f 636f 686f 7274 5f73 697a 655f 6465  x_cohort_size_de
-0003b6d0: 6661 756c 742c 0a20 2020 2020 2020 2072  fault,.        r
-0003b6e0: 616e 646f 6d5f 7365 6564 3a20 6261 7365  andom_seed: base
-0003b6f0: 5f70 6172 616d 732e 7261 6e64 6f6d 5f73  _params.random_s
-0003b700: 6565 6420 3d20 3432 2c0a 2020 2020 2020  eed = 42,.      
-0003b710: 2020 7469 746c 653a 204f 7074 696f 6e61    title: Optiona
-0003b720: 6c5b 6770 6c74 5f70 6172 616d 732e 7469  l[gplt_params.ti
-0003b730: 746c 655d 203d 204e 6f6e 652c 0a20 2020  tle] = None,.   
-0003b740: 2020 2020 2073 697a 696e 675f 6d6f 6465       sizing_mode
-0003b750: 3a20 6770 6c74 5f70 6172 616d 732e 7369  : gplt_params.si
-0003b760: 7a69 6e67 5f6d 6f64 6520 3d20 6770 6c74  zing_mode = gplt
-0003b770: 5f70 6172 616d 732e 7369 7a69 6e67 5f6d  _params.sizing_m
-0003b780: 6f64 655f 6465 6661 756c 742c 0a20 2020  ode_default,.   
-0003b790: 2020 2020 2077 6964 7468 3a20 6770 6c74       width: gplt
-0003b7a0: 5f70 6172 616d 732e 7769 6474 6820 3d20  _params.width = 
-0003b7b0: 6770 6c74 5f70 6172 616d 732e 7769 6474  gplt_params.widt
-0003b7c0: 685f 6465 6661 756c 742c 0a20 2020 2020  h_default,.     
-0003b7d0: 2020 2068 6569 6768 743a 2067 706c 745f     height: gplt_
-0003b7e0: 7061 7261 6d73 2e68 6569 6768 7420 3d20  params.height = 
-0003b7f0: 3230 302c 0a20 2020 2020 2020 2073 686f  200,.        sho
-0003b800: 773a 2067 706c 745f 7061 7261 6d73 2e73  w: gplt_params.s
-0003b810: 686f 7720 3d20 5472 7565 2c0a 2020 2020  how = True,.    
-0003b820: 2020 2020 785f 7261 6e67 653a 204f 7074      x_range: Opt
-0003b830: 696f 6e61 6c5b 6770 6c74 5f70 6172 616d  ional[gplt_param
-0003b840: 732e 785f 7261 6e67 655d 203d 204e 6f6e  s.x_range] = Non
-0003b850: 652c 0a20 2020 2029 202d 3e20 6770 6c74  e,.    ) -> gplt
-0003b860: 5f70 6172 616d 732e 6669 6775 7265 3a0a  _params.figure:.
-0003b870: 2020 2020 2020 2020 2320 636f 6d70 7574          # comput
-0003b880: 6520 4731 3233 0a20 2020 2020 2020 2078  e G123.        x
-0003b890: 2c20 6731 3233 203d 2073 656c 662e 6731  , g123 = self.g1
-0003b8a0: 3233 5f67 7773 7328 0a20 2020 2020 2020  23_gwss(.       
-0003b8b0: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
-0003b8c0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-0003b8d0: 7369 7465 733d 7369 7465 732c 0a20 2020  sites=sites,.   
-0003b8e0: 2020 2020 2020 2020 2073 6974 655f 6d61           site_ma
-0003b8f0: 736b 3d73 6974 655f 6d61 736b 2c0a 2020  sk=site_mask,.  
-0003b900: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
-0003b910: 5f73 697a 653d 7769 6e64 6f77 5f73 697a  _size=window_siz
-0003b920: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-0003b930: 696e 5f63 6f68 6f72 745f 7369 7a65 3d6d  in_cohort_size=m
-0003b940: 696e 5f63 6f68 6f72 745f 7369 7a65 2c0a  in_cohort_size,.
-0003b950: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-0003b960: 636f 686f 7274 5f73 697a 653d 6d61 785f  cohort_size=max_
-0003b970: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
-0003b980: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
-0003b990: 7175 6572 793d 7361 6d70 6c65 5f71 7565  query=sample_que
-0003b9a0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-0003b9b0: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
-0003b9c0: 6c65 5f73 6574 732c 0a20 2020 2020 2020  le_sets,.       
-0003b9d0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-0003b9e0: 3d72 616e 646f 6d5f 7365 6564 2c0a 2020  =random_seed,.  
-0003b9f0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0003ba00: 2023 2064 6574 6572 6d69 6e65 2058 2061   # determine X a
-0003ba10: 7869 7320 7261 6e67 650a 2020 2020 2020  xis range.      
-0003ba20: 2020 785f 6d69 6e20 3d20 785b 305d 0a20    x_min = x[0]. 
-0003ba30: 2020 2020 2020 2078 5f6d 6178 203d 2078         x_max = x
-0003ba40: 5b2d 315d 0a20 2020 2020 2020 2069 6620  [-1].        if 
-0003ba50: 785f 7261 6e67 6520 6973 204e 6f6e 653a  x_range is None:
-0003ba60: 0a20 2020 2020 2020 2020 2020 2078 5f72  .            x_r
-0003ba70: 616e 6765 203d 2062 6f6b 6568 2e6d 6f64  ange = bokeh.mod
-0003ba80: 656c 732e 5261 6e67 6531 6428 785f 6d69  els.Range1d(x_mi
-0003ba90: 6e2c 2078 5f6d 6178 2c20 626f 756e 6473  n, x_max, bounds
-0003baa0: 3d22 6175 746f 2229 0a0a 2020 2020 2020  ="auto")..      
-0003bab0: 2020 2320 6372 6561 7465 2061 2066 6967    # create a fig
-0003bac0: 7572 650a 2020 2020 2020 2020 7877 6865  ure.        xwhe
-0003bad0: 656c 5f7a 6f6f 6d20 3d20 626f 6b65 682e  el_zoom = bokeh.
-0003bae0: 6d6f 6465 6c73 2e57 6865 656c 5a6f 6f6d  models.WheelZoom
-0003baf0: 546f 6f6c 280a 2020 2020 2020 2020 2020  Tool(.          
-0003bb00: 2020 6469 6d65 6e73 696f 6e73 3d22 7769    dimensions="wi
-0003bb10: 6474 6822 2c20 6d61 696e 7461 696e 5f66  dth", maintain_f
-0003bb20: 6f63 7573 3d46 616c 7365 0a20 2020 2020  ocus=False.     
-0003bb30: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-0003bb40: 7469 746c 6520 6973 204e 6f6e 653a 0a20  title is None:. 
-0003bb50: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-0003bb60: 203d 2073 616d 706c 655f 7175 6572 790a   = sample_query.
-0003bb70: 2020 2020 2020 2020 6669 6720 3d20 626f          fig = bo
-0003bb80: 6b65 682e 706c 6f74 7469 6e67 2e66 6967  keh.plotting.fig
-0003bb90: 7572 6528 0a20 2020 2020 2020 2020 2020  ure(.           
-0003bba0: 2074 6974 6c65 3d74 6974 6c65 2c0a 2020   title=title,.  
-0003bbb0: 2020 2020 2020 2020 2020 746f 6f6c 733d            tools=
-0003bbc0: 5b22 7870 616e 222c 2022 787a 6f6f 6d5f  ["xpan", "xzoom_
-0003bbd0: 696e 222c 2022 787a 6f6f 6d5f 6f75 7422  in", "xzoom_out"
-0003bbe0: 2c20 7877 6865 656c 5f7a 6f6f 6d2c 2022  , xwheel_zoom, "
-0003bbf0: 7265 7365 7422 5d2c 0a20 2020 2020 2020  reset"],.       
-0003bc00: 2020 2020 2061 6374 6976 655f 7363 726f       active_scro
-0003bc10: 6c6c 3d78 7768 6565 6c5f 7a6f 6f6d 2c0a  ll=xwheel_zoom,.
-0003bc20: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-0003bc30: 7665 5f64 7261 673d 2278 7061 6e22 2c0a  ve_drag="xpan",.
-0003bc40: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
-0003bc50: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
-0003bc60: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
-0003bc70: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
-0003bc80: 2020 2020 2020 2020 2020 6865 6967 6874            height
-0003bc90: 3d68 6569 6768 742c 0a20 2020 2020 2020  =height,.       
-0003bca0: 2020 2020 2074 6f6f 6c62 6172 5f6c 6f63       toolbar_loc
-0003bcb0: 6174 696f 6e3d 2261 626f 7665 222c 0a20  ation="above",. 
-0003bcc0: 2020 2020 2020 2020 2020 2078 5f72 616e             x_ran
-0003bcd0: 6765 3d78 5f72 616e 6765 2c0a 2020 2020  ge=x_range,.    
-0003bce0: 2020 2020 2020 2020 795f 7261 6e67 653d          y_range=
-0003bcf0: 2830 2c20 3129 2c0a 2020 2020 2020 2020  (0, 1),.        
-0003bd00: 290a 0a20 2020 2020 2020 2023 2070 6c6f  )..        # plo
-0003bd10: 7420 4731 3233 0a20 2020 2020 2020 2066  t G123.        f
-0003bd20: 6967 2e63 6972 636c 6528 0a20 2020 2020  ig.circle(.     
-0003bd30: 2020 2020 2020 2078 3d78 2c0a 2020 2020         x=x,.    
-0003bd40: 2020 2020 2020 2020 793d 6731 3233 2c0a          y=g123,.
-0003bd50: 2020 2020 2020 2020 2020 2020 7369 7a65              size
-0003bd60: 3d33 2c0a 2020 2020 2020 2020 2020 2020  =3,.            
-0003bd70: 6c69 6e65 5f77 6964 7468 3d30 2e35 2c0a  line_width=0.5,.
-0003bd80: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0003bd90: 5f63 6f6c 6f72 3d22 626c 6163 6b22 2c0a  _color="black",.
-0003bda0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0003bdb0: 5f63 6f6c 6f72 3d4e 6f6e 652c 0a20 2020  _color=None,.   
-0003bdc0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0003bdd0: 2320 7469 6479 2075 7020 7468 6520 706c  # tidy up the pl
-0003bde0: 6f74 0a20 2020 2020 2020 2066 6967 2e79  ot.        fig.y
-0003bdf0: 6178 6973 2e61 7869 735f 6c61 6265 6c20  axis.axis_label 
-0003be00: 3d20 2247 3132 3322 0a20 2020 2020 2020  = "G123".       
-0003be10: 2066 6967 2e79 6178 6973 2e74 6963 6b65   fig.yaxis.ticke
-0003be20: 7220 3d20 5b30 2c20 315d 0a20 2020 2020  r = [0, 1].     
-0003be30: 2020 2073 656c 662e 5f62 6f6b 6568 5f73     self._bokeh_s
-0003be40: 7479 6c65 5f67 656e 6f6d 655f 7861 7869  tyle_genome_xaxi
-0003be50: 7328 6669 672c 2063 6f6e 7469 6729 0a0a  s(fig, contig)..
-0003be60: 2020 2020 2020 2020 6966 2073 686f 773a          if show:
-0003be70: 0a20 2020 2020 2020 2020 2020 2062 6f6b  .            bok
-0003be80: 6568 2e70 6c6f 7474 696e 672e 7368 6f77  eh.plotting.show
-0003be90: 2866 6967 290a 0a20 2020 2020 2020 2072  (fig)..        r
-0003bea0: 6574 7572 6e20 6669 670a 0a20 2020 2040  eturn fig..    @
-0003beb0: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-0003bec0: 6d61 7279 3d22 506c 6f74 2047 3132 3320  mary="Plot G123 
-0003bed0: 4757 5353 2064 6174 612e 222c 0a20 2020  GWSS data.",.   
-0003bee0: 2029 0a20 2020 2064 6566 2070 6c6f 745f   ).    def plot_
-0003bef0: 6731 3233 5f67 7773 7328 0a20 2020 2020  g123_gwss(.     
-0003bf00: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0003bf10: 2063 6f6e 7469 673a 2062 6173 655f 7061   contig: base_pa
-0003bf20: 7261 6d73 2e63 6f6e 7469 672c 0a20 2020  rams.contig,.   
-0003bf30: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
-0003bf40: 3a20 6731 3233 5f70 6172 616d 732e 7769  : g123_params.wi
-0003bf50: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
-0003bf60: 2020 2073 6974 6573 3a20 6731 3233 5f70     sites: g123_p
-0003bf70: 6172 616d 732e 7369 7465 7320 3d20 4445  arams.sites = DE
-0003bf80: 4641 554c 542c 0a20 2020 2020 2020 2073  FAULT,.        s
-0003bf90: 6974 655f 6d61 736b 3a20 6261 7365 5f70  ite_mask: base_p
-0003bfa0: 6172 616d 732e 7369 7465 5f6d 6173 6b20  arams.site_mask 
-0003bfb0: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
-0003bfc0: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
-0003bfd0: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-0003bfe0: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
-0003bff0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0003c000: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
-0003c010: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
-0003c020: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
-0003c030: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
-0003c040: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-0003c050: 7a65 3a20 4f70 7469 6f6e 616c 5b0a 2020  ze: Optional[.  
-0003c060: 2020 2020 2020 2020 2020 6261 7365 5f70            base_p
-0003c070: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
-0003c080: 5f73 697a 650a 2020 2020 2020 2020 5d20  _size.        ] 
-0003c090: 3d20 6731 3233 5f70 6172 616d 732e 6d69  = g123_params.mi
-0003c0a0: 6e5f 636f 686f 7274 5f73 697a 655f 6465  n_cohort_size_de
-0003c0b0: 6661 756c 742c 0a20 2020 2020 2020 206d  fault,.        m
-0003c0c0: 6178 5f63 6f68 6f72 745f 7369 7a65 3a20  ax_cohort_size: 
-0003c0d0: 4f70 7469 6f6e 616c 5b0a 2020 2020 2020  Optional[.      
-0003c0e0: 2020 2020 2020 6261 7365 5f70 6172 616d        base_param
-0003c0f0: 732e 6d61 785f 636f 686f 7274 5f73 697a  s.max_cohort_siz
-0003c100: 650a 2020 2020 2020 2020 5d20 3d20 6731  e.        ] = g1
-0003c110: 3233 5f70 6172 616d 732e 6d61 785f 636f  23_params.max_co
-0003c120: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
-0003c130: 742c 0a20 2020 2020 2020 2072 616e 646f  t,.        rando
-0003c140: 6d5f 7365 6564 3a20 6261 7365 5f70 6172  m_seed: base_par
-0003c150: 616d 732e 7261 6e64 6f6d 5f73 6565 6420  ams.random_seed 
-0003c160: 3d20 3432 2c0a 2020 2020 2020 2020 7469  = 42,.        ti
-0003c170: 746c 653a 204f 7074 696f 6e61 6c5b 6770  tle: Optional[gp
-0003c180: 6c74 5f70 6172 616d 732e 7469 746c 655d  lt_params.title]
-0003c190: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0003c1a0: 2073 697a 696e 675f 6d6f 6465 3a20 6770   sizing_mode: gp
-0003c1b0: 6c74 5f70 6172 616d 732e 7369 7a69 6e67  lt_params.sizing
-0003c1c0: 5f6d 6f64 6520 3d20 6770 6c74 5f70 6172  _mode = gplt_par
-0003c1d0: 616d 732e 7369 7a69 6e67 5f6d 6f64 655f  ams.sizing_mode_
-0003c1e0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-0003c1f0: 2077 6964 7468 3a20 6770 6c74 5f70 6172   width: gplt_par
-0003c200: 616d 732e 7769 6474 6820 3d20 6770 6c74  ams.width = gplt
-0003c210: 5f70 6172 616d 732e 7769 6474 685f 6465  _params.width_de
-0003c220: 6661 756c 742c 0a20 2020 2020 2020 2074  fault,.        t
-0003c230: 7261 636b 5f68 6569 6768 743a 2067 706c  rack_height: gpl
-0003c240: 745f 7061 7261 6d73 2e74 7261 636b 5f68  t_params.track_h
-0003c250: 6569 6768 7420 3d20 3137 302c 0a20 2020  eight = 170,.   
-0003c260: 2020 2020 2067 656e 6573 5f68 6569 6768       genes_heigh
-0003c270: 743a 2067 706c 745f 7061 7261 6d73 2e67  t: gplt_params.g
-0003c280: 656e 6573 5f68 6569 6768 7420 3d20 6770  enes_height = gp
-0003c290: 6c74 5f70 6172 616d 732e 6765 6e65 735f  lt_params.genes_
-0003c2a0: 6865 6967 6874 5f64 6566 6175 6c74 2c0a  height_default,.
-0003c2b0: 2020 2020 293a 0a20 2020 2020 2020 2023      ):.        #
-0003c2c0: 2067 7773 7320 7472 6163 6b0a 2020 2020   gwss track.    
-0003c2d0: 2020 2020 6669 6731 203d 2073 656c 662e      fig1 = self.
-0003c2e0: 706c 6f74 5f67 3132 335f 6777 7373 5f74  plot_g123_gwss_t
-0003c2f0: 7261 636b 280a 2020 2020 2020 2020 2020  rack(.          
-0003c300: 2020 636f 6e74 6967 3d63 6f6e 7469 672c    contig=contig,
-0003c310: 0a20 2020 2020 2020 2020 2020 2073 6974  .            sit
-0003c320: 6573 3d73 6974 6573 2c0a 2020 2020 2020  es=sites,.      
-0003c330: 2020 2020 2020 7369 7465 5f6d 6173 6b3d        site_mask=
-0003c340: 7369 7465 5f6d 6173 6b2c 0a20 2020 2020  site_mask,.     
-0003c350: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
-0003c360: 7a65 3d77 696e 646f 775f 7369 7a65 2c0a  ze=window_size,.
-0003c370: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-0003c380: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-0003c390: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
-0003c3a0: 2073 616d 706c 655f 7175 6572 793d 7361   sample_query=sa
-0003c3b0: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
-0003c3c0: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
-0003c3d0: 7274 5f73 697a 653d 6d69 6e5f 636f 686f  rt_size=min_coho
-0003c3e0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
-0003c3f0: 2020 2020 206d 6178 5f63 6f68 6f72 745f       max_cohort_
-0003c400: 7369 7a65 3d6d 6178 5f63 6f68 6f72 745f  size=max_cohort_
-0003c410: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
-0003c420: 2020 7261 6e64 6f6d 5f73 6565 643d 7261    random_seed=ra
-0003c430: 6e64 6f6d 5f73 6565 642c 0a20 2020 2020  ndom_seed,.     
-0003c440: 2020 2020 2020 2074 6974 6c65 3d74 6974         title=tit
-0003c450: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-0003c460: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-0003c470: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-0003c480: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-0003c490: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-0003c4a0: 6967 6874 3d74 7261 636b 5f68 6569 6768  ight=track_heigh
-0003c4b0: 742c 0a20 2020 2020 2020 2020 2020 2073  t,.            s
-0003c4c0: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
-0003c4d0: 2020 2029 0a0a 2020 2020 2020 2020 6669     )..        fi
-0003c4e0: 6731 2e78 6178 6973 2e76 6973 6962 6c65  g1.xaxis.visible
-0003c4f0: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-0003c500: 2020 2320 706c 6f74 2067 656e 6573 0a20    # plot genes. 
-0003c510: 2020 2020 2020 2066 6967 3220 3d20 7365         fig2 = se
-0003c520: 6c66 2e70 6c6f 745f 6765 6e65 7328 0a20  lf.plot_genes(. 
-0003c530: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-0003c540: 6e3d 636f 6e74 6967 2c0a 2020 2020 2020  n=contig,.      
-0003c550: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
-0003c560: 653d 7369 7a69 6e67 5f6d 6f64 652c 0a20  e=sizing_mode,. 
-0003c570: 2020 2020 2020 2020 2020 2077 6964 7468             width
-0003c580: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
-0003c590: 2020 2020 6865 6967 6874 3d67 656e 6573      height=genes
-0003c5a0: 5f68 6569 6768 742c 0a20 2020 2020 2020  _height,.       
-0003c5b0: 2020 2020 2078 5f72 616e 6765 3d66 6967       x_range=fig
-0003c5c0: 312e 785f 7261 6e67 652c 0a20 2020 2020  1.x_range,.     
-0003c5d0: 2020 2020 2020 2073 686f 773d 4661 6c73         show=Fals
-0003c5e0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-0003c5f0: 2020 2020 2020 2320 636f 6d62 696e 6520        # combine 
-0003c600: 706c 6f74 7320 696e 746f 2061 2073 696e  plots into a sin
-0003c610: 676c 6520 6669 6775 7265 0a20 2020 2020  gle figure.     
-0003c620: 2020 2066 6967 203d 2062 6f6b 6568 2e6c     fig = bokeh.l
-0003c630: 6179 6f75 7473 2e67 7269 6470 6c6f 7428  ayouts.gridplot(
-0003c640: 0a20 2020 2020 2020 2020 2020 205b 6669  .            [fi
-0003c650: 6731 2c20 6669 6732 5d2c 0a20 2020 2020  g1, fig2],.     
-0003c660: 2020 2020 2020 206e 636f 6c73 3d31 2c0a         ncols=1,.
-0003c670: 2020 2020 2020 2020 2020 2020 746f 6f6c              tool
-0003c680: 6261 725f 6c6f 6361 7469 6f6e 3d22 6162  bar_location="ab
-0003c690: 6f76 6522 2c0a 2020 2020 2020 2020 2020  ove",.          
-0003c6a0: 2020 6d65 7267 655f 746f 6f6c 733d 5472    merge_tools=Tr
-0003c6b0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0003c6c0: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
-0003c6d0: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
-0003c6e0: 2029 0a0a 2020 2020 2020 2020 626f 6b65   )..        boke
-0003c6f0: 682e 706c 6f74 7469 6e67 2e73 686f 7728  h.plotting.show(
-0003c700: 6669 6729 0a0a 2020 2020 6465 6620 5f6c  fig)..    def _l
-0003c710: 6f61 645f 6461 7461 5f66 6f72 5f67 3132  oad_data_for_g12
-0003c720: 3328 0a20 2020 2020 2020 2073 656c 662c  3(.        self,
-0003c730: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
-0003c740: 2020 2020 636f 6e74 6967 2c0a 2020 2020      contig,.    
-0003c750: 2020 2020 7369 7465 732c 0a20 2020 2020      sites,.     
-0003c760: 2020 2073 6974 655f 6d61 736b 2c0a 2020     site_mask,.  
-0003c770: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
-0003c780: 732c 0a20 2020 2020 2020 2073 616d 706c  s,.        sampl
-0003c790: 655f 7175 6572 792c 0a20 2020 2020 2020  e_query,.       
-0003c7a0: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
-0003c7b0: 2c0a 2020 2020 2020 2020 6d61 785f 636f  ,.        max_co
-0003c7c0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-0003c7d0: 2020 2072 616e 646f 6d5f 7365 6564 2c0a     random_seed,.
-0003c7e0: 2020 2020 293a 0a20 2020 2020 2020 2064      ):.        d
-0003c7f0: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
-0003c800: 2e64 6562 7567 0a20 2020 2020 2020 2064  .debug.        d
-0003c810: 735f 736e 7073 203d 2073 656c 662e 736e  s_snps = self.sn
-0003c820: 705f 6361 6c6c 7328 0a20 2020 2020 2020  p_calls(.       
-0003c830: 2020 2020 2072 6567 696f 6e3d 636f 6e74       region=cont
-0003c840: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-0003c850: 7361 6d70 6c65 5f71 7565 7279 3d73 616d  sample_query=sam
-0003c860: 706c 655f 7175 6572 792c 0a20 2020 2020  ple_query,.     
-0003c870: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
-0003c880: 7473 3d73 616d 706c 655f 7365 7473 2c0a  ts=sample_sets,.
-0003c890: 2020 2020 2020 2020 2020 2020 7369 7465              site
-0003c8a0: 5f6d 6173 6b3d 7369 7465 5f6d 6173 6b2c  _mask=site_mask,
-0003c8b0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-0003c8c0: 5f63 6f68 6f72 745f 7369 7a65 3d6d 696e  _cohort_size=min
-0003c8d0: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
-0003c8e0: 2020 2020 2020 2020 2020 6d61 785f 636f            max_co
-0003c8f0: 686f 7274 5f73 697a 653d 6d61 785f 636f  hort_size=max_co
-0003c900: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
-0003c910: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-0003c920: 6564 3d72 616e 646f 6d5f 7365 6564 2c0a  ed=random_seed,.
-0003c930: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0003c940: 2020 2067 7420 3d20 616c 6c65 6c2e 4765     gt = allel.Ge
-0003c950: 6e6f 7479 7065 4461 736b 4172 7261 7928  notypeDaskArray(
-0003c960: 6473 5f73 6e70 735b 2263 616c 6c5f 6765  ds_snps["call_ge
-0003c970: 6e6f 7479 7065 225d 2e64 6174 6129 0a20  notype"].data). 
-0003c980: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0003c990: 2e5f 6461 736b 5f70 726f 6772 6573 7328  ._dask_progress(
-0003c9a0: 6465 7363 3d22 4c6f 6164 2067 656e 6f74  desc="Load genot
-0003c9b0: 7970 6573 2229 3a0a 2020 2020 2020 2020  ypes"):.        
-0003c9c0: 2020 2020 6774 203d 2067 742e 636f 6d70      gt = gt.comp
-0003c9d0: 7574 6528 290a 2020 2020 2020 2020 706f  ute().        po
-0003c9e0: 7320 3d20 6473 5f73 6e70 735b 2276 6172  s = ds_snps["var
-0003c9f0: 6961 6e74 5f70 6f73 6974 696f 6e22 5d2e  iant_position"].
-0003ca00: 7661 6c75 6573 0a0a 2020 2020 2020 2020  values..        
-0003ca10: 6966 2073 6974 6573 2069 6e20 7365 6c66  if sites in self
-0003ca20: 2e70 6861 7369 6e67 5f61 6e61 6c79 7369  .phasing_analysi
-0003ca30: 735f 6964 733a 0a20 2020 2020 2020 2020  s_ids:.         
-0003ca40: 2020 2064 6562 7567 2822 7375 6273 6574     debug("subset
-0003ca50: 7469 6e67 2074 6f20 6861 706c 6f74 7970  ting to haplotyp
-0003ca60: 6520 706f 7369 7469 6f6e 7322 290a 2020  e positions").  
-0003ca70: 2020 2020 2020 2020 2020 6861 706c 6f74            haplot
-0003ca80: 7970 655f 706f 7320 3d20 7365 6c66 2e5f  ype_pos = self._
-0003ca90: 6861 706c 6f74 7970 655f 7369 7465 735f  haplotype_sites_
-0003caa0: 666f 725f 636f 6e74 6967 280a 2020 2020  for_contig(.    
-0003cab0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0003cac0: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
-0003cad0: 2020 2020 2020 2020 2020 2061 6e61 6c79             analy
-0003cae0: 7369 733d 7369 7465 732c 0a20 2020 2020  sis=sites,.     
-0003caf0: 2020 2020 2020 2020 2020 2066 6965 6c64             field
-0003cb00: 3d22 504f 5322 2c0a 2020 2020 2020 2020  ="POS",.        
-0003cb10: 2020 2020 2020 2020 696e 6c69 6e65 5f61          inline_a
-0003cb20: 7272 6179 3d54 7275 652c 0a20 2020 2020  rray=True,.     
-0003cb30: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-0003cb40: 733d 226e 6174 6976 6522 2c0a 2020 2020  s="native",.    
-0003cb50: 2020 2020 2020 2020 292e 636f 6d70 7574          ).comput
-0003cb60: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0003cb70: 6861 705f 7369 7465 5f6d 6173 6b20 3d20  hap_site_mask = 
-0003cb80: 6e70 2e69 6e31 6428 706f 732c 2068 6170  np.in1d(pos, hap
-0003cb90: 6c6f 7479 7065 5f70 6f73 2c20 6173 7375  lotype_pos, assu
-0003cba0: 6d65 5f75 6e69 7175 653d 5472 7565 290a  me_unique=True).
-0003cbb0: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-0003cbc0: 3d20 706f 735b 6861 705f 7369 7465 5f6d  = pos[hap_site_m
-0003cbd0: 6173 6b5d 0a20 2020 2020 2020 2020 2020  ask].           
-0003cbe0: 2067 7420 3d20 6774 2e63 6f6d 7072 6573   gt = gt.compres
-0003cbf0: 7328 6861 705f 7369 7465 5f6d 6173 6b2c  s(hap_site_mask,
-0003cc00: 2061 7869 733d 3029 0a0a 2020 2020 2020   axis=0)..      
-0003cc10: 2020 656c 6966 2073 6974 6573 203d 3d20    elif sites == 
-0003cc20: 2273 6567 7265 6761 7469 6e67 223a 0a20  "segregating":. 
-0003cc30: 2020 2020 2020 2020 2020 2064 6562 7567             debug
-0003cc40: 2822 7375 6273 6574 7469 6e67 2074 6f20  ("subsetting to 
-0003cc50: 7365 6772 6567 6174 696e 6720 7369 7465  segregating site
-0003cc60: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
-0003cc70: 6163 203d 2067 742e 636f 756e 745f 616c  ac = gt.count_al
-0003cc80: 6c65 6c65 7328 6d61 785f 616c 6c65 6c65  leles(max_allele
-0003cc90: 3d33 290a 2020 2020 2020 2020 2020 2020  =3).            
-0003cca0: 7365 6720 3d20 6163 2e69 735f 7365 6772  seg = ac.is_segr
-0003ccb0: 6567 6174 696e 6728 290a 2020 2020 2020  egating().      
-0003ccc0: 2020 2020 2020 706f 7320 3d20 706f 735b        pos = pos[
-0003ccd0: 7365 675d 0a20 2020 2020 2020 2020 2020  seg].           
-0003cce0: 2067 7420 3d20 6774 2e63 6f6d 7072 6573   gt = gt.compres
-0003ccf0: 7328 7365 672c 2061 7869 733d 3029 0a0a  s(seg, axis=0)..
-0003cd00: 2020 2020 2020 2020 656c 6966 2073 6974          elif sit
-0003cd10: 6573 203d 3d20 2261 6c6c 223a 0a20 2020  es == "all":.   
-0003cd20: 2020 2020 2020 2020 2064 6562 7567 2822           debug("
-0003cd30: 7573 696e 6720 616c 6c20 7369 7465 7322  using all sites"
-0003cd40: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0003cd50: 6e20 6774 2c20 706f 730a 0a20 2020 2040  n gt, pos..    @
-0003cd60: 646f 6328 0a20 2020 2020 2020 2073 756d  doc(.        sum
-0003cd70: 6d61 7279 3d22 4765 6e65 7261 7465 2067  mary="Generate g
-0003cd80: 3132 3320 4757 5353 2063 616c 6962 7261  123 GWSS calibra
-0003cd90: 7469 6f6e 2064 6174 6120 666f 7220 6469  tion data for di
-0003cda0: 6666 6572 656e 7420 7769 6e64 6f77 2073  fferent window s
-0003cdb0: 697a 6573 2e22 2c0a 2020 2020 2020 2020  izes.",.        
-0003cdc0: 7265 7475 726e 733d 2222 220a 2020 2020  returns=""".    
-0003cdd0: 2020 2020 2020 2020 4120 6c69 7374 206f          A list o
-0003cde0: 6620 6731 3233 2063 616c 6962 7261 7469  f g123 calibrati
-0003cdf0: 6f6e 2072 756e 2061 7272 6179 7320 666f  on run arrays fo
-0003ce00: 7220 6561 6368 2077 696e 646f 7720 7369  r each window si
-0003ce10: 7a65 2c20 636f 6e74 6169 6e69 6e67 0a20  ze, containing. 
-0003ce20: 2020 2020 2020 2020 2020 2076 616c 7565             value
-0003ce30: 7320 616e 6420 7065 7263 656e 7469 6c65  s and percentile
-0003ce40: 732e 0a20 2020 2020 2020 2022 2222 2c0a  s..        """,.
-0003ce50: 2020 2020 290a 2020 2020 6465 6620 6731      ).    def g1
-0003ce60: 3233 5f63 616c 6962 7261 7469 6f6e 280a  23_calibration(.
-0003ce70: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0003ce80: 2020 2020 2020 636f 6e74 6967 3a20 6261        contig: ba
-0003ce90: 7365 5f70 6172 616d 732e 636f 6e74 6967  se_params.contig
-0003cea0: 2c0a 2020 2020 2020 2020 7369 7465 733a  ,.        sites:
-0003ceb0: 2067 3132 335f 7061 7261 6d73 2e73 6974   g123_params.sit
-0003cec0: 6573 203d 2044 4546 4155 4c54 2c0a 2020  es = DEFAULT,.  
-0003ced0: 2020 2020 2020 7369 7465 5f6d 6173 6b3a        site_mask:
-0003cee0: 2062 6173 655f 7061 7261 6d73 2e73 6974   base_params.sit
-0003cef0: 655f 6d61 736b 203d 2044 4546 4155 4c54  e_mask = DEFAULT
-0003cf00: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
-0003cf10: 5f71 7565 7279 3a20 4f70 7469 6f6e 616c  _query: Optional
-0003cf20: 5b62 6173 655f 7061 7261 6d73 2e73 616d  [base_params.sam
-0003cf30: 706c 655f 7175 6572 795d 203d 204e 6f6e  ple_query] = Non
-0003cf40: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
-0003cf50: 655f 7365 7473 3a20 4f70 7469 6f6e 616c  e_sets: Optional
-0003cf60: 5b62 6173 655f 7061 7261 6d73 2e73 616d  [base_params.sam
-0003cf70: 706c 655f 7365 7473 5d20 3d20 4e6f 6e65  ple_sets] = None
-0003cf80: 2c0a 2020 2020 2020 2020 6d69 6e5f 636f  ,.        min_co
-0003cf90: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
-0003cfa0: 6e61 6c5b 0a20 2020 2020 2020 2020 2020  nal[.           
-0003cfb0: 2062 6173 655f 7061 7261 6d73 2e6d 696e   base_params.min
-0003cfc0: 5f63 6f68 6f72 745f 7369 7a65 0a20 2020  _cohort_size.   
-0003cfd0: 2020 2020 205d 203d 2067 3132 335f 7061       ] = g123_pa
-0003cfe0: 7261 6d73 2e6d 696e 5f63 6f68 6f72 745f  rams.min_cohort_
-0003cff0: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
-0003d000: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
-0003d010: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
-0003d020: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
-0003d030: 655f 7061 7261 6d73 2e6d 6178 5f63 6f68  e_params.max_coh
-0003d040: 6f72 745f 7369 7a65 0a20 2020 2020 2020  ort_size.       
-0003d050: 205d 203d 2067 3132 335f 7061 7261 6d73   ] = g123_params
-0003d060: 2e6d 6178 5f63 6f68 6f72 745f 7369 7a65  .max_cohort_size
-0003d070: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-0003d080: 2020 7769 6e64 6f77 5f73 697a 6573 3a20    window_sizes: 
-0003d090: 6731 3233 5f70 6172 616d 732e 7769 6e64  g123_params.wind
-0003d0a0: 6f77 5f73 697a 6573 203d 2067 3132 335f  ow_sizes = g123_
-0003d0b0: 7061 7261 6d73 2e77 696e 646f 775f 7369  params.window_si
-0003d0c0: 7a65 735f 6465 6661 756c 742c 0a20 2020  zes_default,.   
-0003d0d0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-0003d0e0: 3a20 6261 7365 5f70 6172 616d 732e 7261  : base_params.ra
-0003d0f0: 6e64 6f6d 5f73 6565 6420 3d20 3432 2c0a  ndom_seed = 42,.
-0003d100: 2020 2020 2920 2d3e 204c 6973 745b 6e70      ) -> List[np
-0003d110: 2e6e 6461 7272 6179 5d3a 0a20 2020 2020  .ndarray]:.     
-0003d120: 2020 2023 2063 6861 6e67 6520 7468 6973     # change this
-0003d130: 206e 616d 6520 6966 2079 6f75 2065 7665   name if you eve
-0003d140: 7220 6368 616e 6765 2074 6865 2062 6568  r change the beh
-0003d150: 6176 696f 7572 206f 6620 7468 6973 2066  aviour of this f
-0003d160: 756e 6374 696f 6e2c 2074 6f0a 2020 2020  unction, to.    
-0003d170: 2020 2020 2320 696e 7661 6c69 6461 7465      # invalidate
-0003d180: 2061 6e79 2070 7265 7669 6f75 736c 7920   any previously 
-0003d190: 6361 6368 6564 2064 6174 610a 2020 2020  cached data.    
-0003d1a0: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
-0003d1b0: 5f67 3132 335f 6361 6c69 6272 6174 696f  _g123_calibratio
-0003d1c0: 6e5f 6361 6368 655f 6e61 6d65 0a0a 2020  n_cache_name..  
-0003d1d0: 2020 2020 2020 7061 7261 6d73 203d 2064        params = d
-0003d1e0: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
-0003d1f0: 2063 6f6e 7469 673d 636f 6e74 6967 2c0a   contig=contig,.
-0003d200: 2020 2020 2020 2020 2020 2020 7369 7465              site
-0003d210: 733d 7369 7465 732c 0a20 2020 2020 2020  s=sites,.       
-0003d220: 2020 2020 2073 6974 655f 6d61 736b 3d73       site_mask=s
-0003d230: 656c 662e 5f70 7265 705f 7369 7465 5f6d  elf._prep_site_m
-0003d240: 6173 6b5f 7061 7261 6d28 7369 7465 5f6d  ask_param(site_m
-0003d250: 6173 6b3d 7369 7465 5f6d 6173 6b29 2c0a  ask=site_mask),.
-0003d260: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-0003d270: 6f77 5f73 697a 6573 3d77 696e 646f 775f  ow_sizes=window_
-0003d280: 7369 7a65 732c 0a20 2020 2020 2020 2020  sizes,.         
-0003d290: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
-0003d2a0: 656c 662e 5f70 7265 705f 7361 6d70 6c65  elf._prep_sample
-0003d2b0: 5f73 6574 735f 7061 7261 6d28 7361 6d70  _sets_param(samp
-0003d2c0: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-0003d2d0: 6574 7329 2c0a 2020 2020 2020 2020 2020  ets),.          
-0003d2e0: 2020 2320 4e2e 422e 2c20 646f 206e 6f74    # N.B., do not
-0003d2f0: 2062 6520 7465 6d70 7465 6420 746f 2063   be tempted to c
-0003d300: 6f6e 7665 7274 2074 6869 7320 7361 6d70  onvert this samp
-0003d310: 6c65 2071 7565 7279 2069 6e74 6f20 696e  le query into in
-0003d320: 7465 6765 720a 2020 2020 2020 2020 2020  teger.          
-0003d330: 2020 2320 696e 6469 6365 7320 7573 696e    # indices usin
-0003d340: 6720 5f70 7265 705f 7361 6d70 6c65 5f73  g _prep_sample_s
-0003d350: 656c 6563 7469 6f6e 5f70 6172 616d 732c  election_params,
-0003d360: 2062 6563 6175 7365 2074 6865 2069 6e64   because the ind
-0003d370: 6963 6573 0a20 2020 2020 2020 2020 2020  ices.           
-0003d380: 2023 2061 7265 2064 6966 6665 7265 6e74   # are different
-0003d390: 2069 6e20 7468 6520 6861 706c 6f74 7970   in the haplotyp
-0003d3a0: 6520 6461 7461 2e0a 2020 2020 2020 2020  e data..        
-0003d3b0: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-0003d3c0: 3d73 616d 706c 655f 7175 6572 792c 0a20  =sample_query,. 
-0003d3d0: 2020 2020 2020 2020 2020 206d 696e 5f63             min_c
-0003d3e0: 6f68 6f72 745f 7369 7a65 3d6d 696e 5f63  ohort_size=min_c
-0003d3f0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
-0003d400: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
-0003d410: 7274 5f73 697a 653d 6d61 785f 636f 686f  rt_size=max_coho
-0003d420: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
-0003d430: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-0003d440: 3d72 616e 646f 6d5f 7365 6564 2c0a 2020  =random_seed,.  
-0003d450: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0003d460: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0003d470: 2020 6361 6c69 6272 6174 696f 6e5f 7275    calibration_ru
-0003d480: 6e73 203d 2073 656c 662e 7265 7375 6c74  ns = self.result
-0003d490: 735f 6361 6368 655f 6765 7428 6e61 6d65  s_cache_get(name
-0003d4a0: 3d6e 616d 652c 2070 6172 616d 733d 7061  =name, params=pa
-0003d4b0: 7261 6d73 290a 0a20 2020 2020 2020 2065  rams)..        e
-0003d4c0: 7863 6570 7420 4361 6368 654d 6973 733a  xcept CacheMiss:
-0003d4d0: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-0003d4e0: 6962 7261 7469 6f6e 5f72 756e 7320 3d20  ibration_runs = 
-0003d4f0: 7365 6c66 2e5f 6731 3233 5f63 616c 6962  self._g123_calib
-0003d500: 7261 7469 6f6e 282a 2a70 6172 616d 7329  ration(**params)
-0003d510: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003d520: 662e 7265 7375 6c74 735f 6361 6368 655f  f.results_cache_
-0003d530: 7365 7428 6e61 6d65 3d6e 616d 652c 2070  set(name=name, p
-0003d540: 6172 616d 733d 7061 7261 6d73 2c20 7265  arams=params, re
-0003d550: 7375 6c74 733d 6361 6c69 6272 6174 696f  sults=calibratio
-0003d560: 6e5f 7275 6e73 290a 0a20 2020 2020 2020  n_runs)..       
-0003d570: 2072 6574 7572 6e20 6361 6c69 6272 6174   return calibrat
-0003d580: 696f 6e5f 7275 6e73 0a0a 2020 2020 6465  ion_runs..    de
-0003d590: 6620 5f67 3132 335f 6361 6c69 6272 6174  f _g123_calibrat
-0003d5a0: 696f 6e28 0a20 2020 2020 2020 2073 656c  ion(.        sel
-0003d5b0: 662c 0a20 2020 2020 2020 202a 2c0a 2020  f,.        *,.  
-0003d5c0: 2020 2020 2020 636f 6e74 6967 2c0a 2020        contig,.  
-0003d5d0: 2020 2020 2020 7369 7465 732c 0a20 2020        sites,.   
-0003d5e0: 2020 2020 2073 6974 655f 6d61 736b 2c0a       site_mask,.
-0003d5f0: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
-0003d600: 7565 7279 2c0a 2020 2020 2020 2020 7361  uery,.        sa
-0003d610: 6d70 6c65 5f73 6574 732c 0a20 2020 2020  mple_sets,.     
-0003d620: 2020 206d 696e 5f63 6f68 6f72 745f 7369     min_cohort_si
-0003d630: 7a65 2c0a 2020 2020 2020 2020 6d61 785f  ze,.        max_
-0003d640: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
-0003d650: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
-0003d660: 732c 0a20 2020 2020 2020 2072 616e 646f  s,.        rando
-0003d670: 6d5f 7365 6564 2c0a 2020 2020 293a 0a20  m_seed,.    ):. 
-0003d680: 2020 2020 2020 2067 742c 205f 203d 2073         gt, _ = s
-0003d690: 656c 662e 5f6c 6f61 645f 6461 7461 5f66  elf._load_data_f
-0003d6a0: 6f72 5f67 3132 3328 0a20 2020 2020 2020  or_g123(.       
-0003d6b0: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
-0003d6c0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
-0003d6d0: 7369 7465 733d 7369 7465 732c 0a20 2020  sites=sites,.   
-0003d6e0: 2020 2020 2020 2020 2073 6974 655f 6d61           site_ma
-0003d6f0: 736b 3d73 6974 655f 6d61 736b 2c0a 2020  sk=site_mask,.  
-0003d700: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
-0003d710: 5f71 7565 7279 3d73 616d 706c 655f 7175  _query=sample_qu
-0003d720: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
-0003d730: 2073 616d 706c 655f 7365 7473 3d73 616d   sample_sets=sam
-0003d740: 706c 655f 7365 7473 2c0a 2020 2020 2020  ple_sets,.      
-0003d750: 2020 2020 2020 6d69 6e5f 636f 686f 7274        min_cohort
-0003d760: 5f73 697a 653d 6d69 6e5f 636f 686f 7274  _size=min_cohort
-0003d770: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-0003d780: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
-0003d790: 7a65 3d6d 6178 5f63 6f68 6f72 745f 7369  ze=max_cohort_si
-0003d7a0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-0003d7b0: 7261 6e64 6f6d 5f73 6565 643d 7261 6e64  random_seed=rand
-0003d7c0: 6f6d 5f73 6565 642c 0a20 2020 2020 2020  om_seed,.       
-0003d7d0: 2029 0a0a 2020 2020 2020 2020 6361 6c69   )..        cali
-0003d7e0: 6272 6174 696f 6e5f 7275 6e73 203d 2064  bration_runs = d
-0003d7f0: 6963 7428 290a 2020 2020 2020 2020 666f  ict().        fo
-0003d800: 7220 7769 6e64 6f77 5f73 697a 6520 696e  r window_size in
-0003d810: 2073 656c 662e 5f70 726f 6772 6573 7328   self._progress(
-0003d820: 7769 6e64 6f77 5f73 697a 6573 2c20 6465  window_sizes, de
-0003d830: 7363 3d22 436f 6d70 7574 6520 6731 3233  sc="Compute g123
-0003d840: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-0003d850: 6731 3233 203d 2061 6c6c 656c 2e6d 6f76  g123 = allel.mov
-0003d860: 696e 675f 7374 6174 6973 7469 6328 0a20  ing_statistic(. 
-0003d870: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0003d880: 742c 2073 7461 7469 7374 6963 3d73 656c  t, statistic=sel
-0003d890: 662e 5f67 6172 7564 5f67 3132 332c 2073  f._garud_g123, s
-0003d8a0: 697a 653d 7769 6e64 6f77 5f73 697a 650a  ize=window_size.
-0003d8b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0003d8c0: 2020 2020 2020 2020 2020 6361 6c69 6272            calibr
-0003d8d0: 6174 696f 6e5f 7275 6e73 5b73 7472 2877  ation_runs[str(w
-0003d8e0: 696e 646f 775f 7369 7a65 295d 203d 2067  indow_size)] = g
-0003d8f0: 3132 330a 0a20 2020 2020 2020 2072 6574  123..        ret
-0003d900: 7572 6e20 6361 6c69 6272 6174 696f 6e5f  urn calibration_
-0003d910: 7275 6e73 0a0a 2020 2020 4064 6f63 280a  runs..    @doc(.
-0003d920: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
-0003d930: 2250 6c6f 7420 6731 3233 2047 5753 5320  "Plot g123 GWSS 
-0003d940: 6361 6c69 6272 6174 696f 6e20 6461 7461  calibration data
-0003d950: 2066 6f72 2064 6966 6665 7265 6e74 2077   for different w
-0003d960: 696e 646f 7720 7369 7a65 732e 222c 0a20  indow sizes.",. 
-0003d970: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
-0003d980: 745f 6731 3233 5f63 616c 6962 7261 7469  t_g123_calibrati
-0003d990: 6f6e 280a 2020 2020 2020 2020 7365 6c66  on(.        self
-0003d9a0: 2c0a 2020 2020 2020 2020 636f 6e74 6967  ,.        contig
-0003d9b0: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
-0003d9c0: 6e74 6967 2c0a 2020 2020 2020 2020 7369  ntig,.        si
-0003d9d0: 7465 733a 2067 3132 335f 7061 7261 6d73  tes: g123_params
-0003d9e0: 2e73 6974 6573 2c0a 2020 2020 2020 2020  .sites,.        
-0003d9f0: 7369 7465 5f6d 6173 6b3a 2062 6173 655f  site_mask: base_
-0003da00: 7061 7261 6d73 2e73 6974 655f 6d61 736b  params.site_mask
-0003da10: 203d 2044 4546 4155 4c54 2c0a 2020 2020   = DEFAULT,.    
-0003da20: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
-0003da30: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-0003da40: 7061 7261 6d73 2e73 616d 706c 655f 7175  params.sample_qu
-0003da50: 6572 795d 203d 204e 6f6e 652c 0a20 2020  ery] = None,.   
-0003da60: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
-0003da70: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
-0003da80: 7061 7261 6d73 2e73 616d 706c 655f 7365  params.sample_se
-0003da90: 7473 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ts] = None,.    
-0003daa0: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
-0003dab0: 697a 653a 204f 7074 696f 6e61 6c5b 0a20  ize: Optional[. 
-0003dac0: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-0003dad0: 7061 7261 6d73 2e6d 696e 5f63 6f68 6f72  params.min_cohor
-0003dae0: 745f 7369 7a65 0a20 2020 2020 2020 205d  t_size.        ]
-0003daf0: 203d 2067 3132 335f 7061 7261 6d73 2e6d   = g123_params.m
-0003db00: 696e 5f63 6f68 6f72 745f 7369 7a65 5f64  in_cohort_size_d
-0003db10: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-0003db20: 6d61 785f 636f 686f 7274 5f73 697a 653a  max_cohort_size:
-0003db30: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-0003db40: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
-0003db50: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
-0003db60: 7a65 0a20 2020 2020 2020 205d 203d 2067  ze.        ] = g
-0003db70: 3132 335f 7061 7261 6d73 2e6d 6178 5f63  123_params.max_c
-0003db80: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
-0003db90: 6c74 2c0a 2020 2020 2020 2020 7769 6e64  lt,.        wind
-0003dba0: 6f77 5f73 697a 6573 3a20 6731 3233 5f70  ow_sizes: g123_p
-0003dbb0: 6172 616d 732e 7769 6e64 6f77 5f73 697a  arams.window_siz
-0003dbc0: 6573 203d 2067 3132 335f 7061 7261 6d73  es = g123_params
-0003dbd0: 2e77 696e 646f 775f 7369 7a65 735f 6465  .window_sizes_de
-0003dbe0: 6661 756c 742c 0a20 2020 2020 2020 2072  fault,.        r
-0003dbf0: 616e 646f 6d5f 7365 6564 3a20 6261 7365  andom_seed: base
-0003dc00: 5f70 6172 616d 732e 7261 6e64 6f6d 5f73  _params.random_s
-0003dc10: 6565 6420 3d20 3432 2c0a 2020 2020 2020  eed = 42,.      
-0003dc20: 2020 7469 746c 653a 204f 7074 696f 6e61    title: Optiona
-0003dc30: 6c5b 6770 6c74 5f70 6172 616d 732e 7469  l[gplt_params.ti
-0003dc40: 746c 655d 203d 204e 6f6e 652c 0a20 2020  tle] = None,.   
-0003dc50: 2029 3a0a 2020 2020 2020 2020 2320 6765   ):.        # ge
-0003dc60: 7420 6731 3233 2076 616c 7565 730a 2020  t g123 values.  
-0003dc70: 2020 2020 2020 6361 6c69 6272 6174 696f        calibratio
-0003dc80: 6e5f 7275 6e73 203d 2073 656c 662e 6731  n_runs = self.g1
-0003dc90: 3233 5f63 616c 6962 7261 7469 6f6e 280a  23_calibration(.
-0003dca0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0003dcb0: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
-0003dcc0: 2020 2020 2020 2073 6974 6573 3d73 6974         sites=sit
-0003dcd0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0003dce0: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
-0003dcf0: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
-0003dd00: 2073 616d 706c 655f 7175 6572 793d 7361   sample_query=sa
-0003dd10: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
-0003dd20: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
-0003dd30: 6574 733d 7361 6d70 6c65 5f73 6574 732c  ets=sample_sets,
-0003dd40: 0a20 2020 2020 2020 2020 2020 2077 696e  .            win
-0003dd50: 646f 775f 7369 7a65 733d 7769 6e64 6f77  dow_sizes=window
-0003dd60: 5f73 697a 6573 2c0a 2020 2020 2020 2020  _sizes,.        
-0003dd70: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
-0003dd80: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
-0003dd90: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-0003dda0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
-0003ddb0: 3d6d 6178 5f63 6f68 6f72 745f 7369 7a65  =max_cohort_size
-0003ddc0: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
-0003ddd0: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
-0003dde0: 5f73 6565 642c 0a20 2020 2020 2020 2029  _seed,.        )
-0003ddf0: 0a0a 2020 2020 2020 2020 2320 636f 6d70  ..        # comp
-0003de00: 7574 6520 7375 6d6d 6172 6965 730a 2020  ute summaries.  
-0003de10: 2020 2020 2020 7135 3020 3d20 5b6e 702e        q50 = [np.
-0003de20: 6d65 6469 616e 2863 616c 6962 7261 7469  median(calibrati
-0003de30: 6f6e 5f72 756e 735b 7374 7228 7769 6e64  on_runs[str(wind
-0003de40: 6f77 295d 2920 666f 7220 7769 6e64 6f77  ow)]) for window
-0003de50: 2069 6e20 7769 6e64 6f77 5f73 697a 6573   in window_sizes
-0003de60: 5d0a 2020 2020 2020 2020 7132 3520 3d20  ].        q25 = 
-0003de70: 5b0a 2020 2020 2020 2020 2020 2020 6e70  [.            np
-0003de80: 2e70 6572 6365 6e74 696c 6528 6361 6c69  .percentile(cali
-0003de90: 6272 6174 696f 6e5f 7275 6e73 5b73 7472  bration_runs[str
-0003dea0: 2877 696e 646f 7729 5d2c 2032 3529 2066  (window)], 25) f
-0003deb0: 6f72 2077 696e 646f 7720 696e 2077 696e  or window in win
-0003dec0: 646f 775f 7369 7a65 730a 2020 2020 2020  dow_sizes.      
-0003ded0: 2020 5d0a 2020 2020 2020 2020 7137 3520    ].        q75 
-0003dee0: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-0003def0: 6e70 2e70 6572 6365 6e74 696c 6528 6361  np.percentile(ca
-0003df00: 6c69 6272 6174 696f 6e5f 7275 6e73 5b73  libration_runs[s
-0003df10: 7472 2877 696e 646f 7729 5d2c 2037 3529  tr(window)], 75)
-0003df20: 2066 6f72 2077 696e 646f 7720 696e 2077   for window in w
-0003df30: 696e 646f 775f 7369 7a65 730a 2020 2020  indow_sizes.    
-0003df40: 2020 2020 5d0a 2020 2020 2020 2020 7130      ].        q0
-0003df50: 3520 3d20 5b0a 2020 2020 2020 2020 2020  5 = [.          
-0003df60: 2020 6e70 2e70 6572 6365 6e74 696c 6528    np.percentile(
-0003df70: 6361 6c69 6272 6174 696f 6e5f 7275 6e73  calibration_runs
-0003df80: 5b73 7472 2877 696e 646f 7729 5d2c 2035  [str(window)], 5
-0003df90: 2920 666f 7220 7769 6e64 6f77 2069 6e20  ) for window in 
-0003dfa0: 7769 6e64 6f77 5f73 697a 6573 0a20 2020  window_sizes.   
-0003dfb0: 2020 2020 205d 0a20 2020 2020 2020 2071       ].        q
-0003dfc0: 3935 203d 205b 0a20 2020 2020 2020 2020  95 = [.         
-0003dfd0: 2020 206e 702e 7065 7263 656e 7469 6c65     np.percentile
-0003dfe0: 2863 616c 6962 7261 7469 6f6e 5f72 756e  (calibration_run
-0003dff0: 735b 7374 7228 7769 6e64 6f77 295d 2c20  s[str(window)], 
-0003e000: 3935 2920 666f 7220 7769 6e64 6f77 2069  95) for window i
-0003e010: 6e20 7769 6e64 6f77 5f73 697a 6573 0a20  n window_sizes. 
-0003e020: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-0003e030: 2020 2320 6d61 6b65 2070 6c6f 740a 2020    # make plot.  
-0003e040: 2020 2020 2020 6669 6720 3d20 626f 6b65        fig = boke
-0003e050: 682e 706c 6f74 7469 6e67 2e66 6967 7572  h.plotting.figur
-0003e060: 6528 7769 6474 683d 3730 302c 2068 6569  e(width=700, hei
-0003e070: 6768 743d 3430 302c 2078 5f61 7869 735f  ght=400, x_axis_
-0003e080: 7479 7065 3d22 6c6f 6722 290a 2020 2020  type="log").    
-0003e090: 2020 2020 6669 672e 7061 7463 6828 0a20      fig.patch(. 
-0003e0a0: 2020 2020 2020 2020 2020 2077 696e 646f             windo
-0003e0b0: 775f 7369 7a65 7320 2b20 7769 6e64 6f77  w_sizes + window
-0003e0c0: 5f73 697a 6573 5b3a 3a2d 315d 2c0a 2020  _sizes[::-1],.  
-0003e0d0: 2020 2020 2020 2020 2020 7137 3520 2b20            q75 + 
-0003e0e0: 7132 355b 3a3a 2d31 5d2c 0a20 2020 2020  q25[::-1],.     
-0003e0f0: 2020 2020 2020 2061 6c70 6861 3d30 2e37         alpha=0.7
-0003e100: 352c 0a20 2020 2020 2020 2020 2020 206c  5,.            l
-0003e110: 696e 655f 7769 6474 683d 322c 0a20 2020  ine_width=2,.   
-0003e120: 2020 2020 2020 2020 206c 6567 656e 645f           legend_
-0003e130: 6c61 6265 6c3d 2232 352d 3735 2522 2c0a  label="25-75%",.
-0003e140: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0003e150: 2020 6669 672e 7061 7463 6828 0a20 2020    fig.patch(.   
-0003e160: 2020 2020 2020 2020 2077 696e 646f 775f           window_
-0003e170: 7369 7a65 7320 2b20 7769 6e64 6f77 5f73  sizes + window_s
-0003e180: 697a 6573 5b3a 3a2d 315d 2c0a 2020 2020  izes[::-1],.    
-0003e190: 2020 2020 2020 2020 7139 3520 2b20 7130          q95 + q0
-0003e1a0: 355b 3a3a 2d31 5d2c 0a20 2020 2020 2020  5[::-1],.       
-0003e1b0: 2020 2020 2061 6c70 6861 3d30 2e35 2c0a       alpha=0.5,.
-0003e1c0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0003e1d0: 5f77 6964 7468 3d32 2c0a 2020 2020 2020  _width=2,.      
-0003e1e0: 2020 2020 2020 6c65 6765 6e64 5f6c 6162        legend_lab
-0003e1f0: 656c 3d22 352d 3935 2522 2c0a 2020 2020  el="5-95%",.    
-0003e200: 2020 2020 290a 2020 2020 2020 2020 6669      ).        fi
-0003e210: 672e 6c69 6e65 280a 2020 2020 2020 2020  g.line(.        
-0003e220: 2020 2020 7769 6e64 6f77 5f73 697a 6573      window_sizes
-0003e230: 2c20 7135 302c 206c 696e 655f 636f 6c6f  , q50, line_colo
-0003e240: 723d 2262 6c61 636b 222c 206c 696e 655f  r="black", line_
-0003e250: 7769 6474 683d 342c 206c 6567 656e 645f  width=4, legend_
-0003e260: 6c61 6265 6c3d 226d 6564 6961 6e22 0a20  label="median". 
-0003e270: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0003e280: 2066 6967 2e63 6972 636c 6528 7769 6e64   fig.circle(wind
-0003e290: 6f77 5f73 697a 6573 2c20 7135 302c 2063  ow_sizes, q50, c
-0003e2a0: 6f6c 6f72 3d22 626c 6163 6b22 2c20 6669  olor="black", fi
-0003e2b0: 6c6c 5f63 6f6c 6f72 3d22 626c 6163 6b22  ll_color="black"
-0003e2c0: 2c20 7369 7a65 3d38 290a 0a20 2020 2020  , size=8)..     
-0003e2d0: 2020 2066 6967 2e78 6178 6973 2e74 6963     fig.xaxis.tic
-0003e2e0: 6b65 7220 3d20 7769 6e64 6f77 5f73 697a  ker = window_siz
-0003e2f0: 6573 0a20 2020 2020 2020 2066 6967 2e78  es.        fig.x
-0003e300: 5f72 616e 6765 203d 2062 6f6b 6568 2e6d  _range = bokeh.m
-0003e310: 6f64 656c 732e 5261 6e67 6531 6428 7769  odels.Range1d(wi
-0003e320: 6e64 6f77 5f73 697a 6573 5b30 5d2c 2077  ndow_sizes[0], w
-0003e330: 696e 646f 775f 7369 7a65 735b 2d31 5d29  indow_sizes[-1])
-0003e340: 0a20 2020 2020 2020 2069 6620 7469 746c  .        if titl
-0003e350: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0003e360: 2020 2020 2020 2074 6974 6c65 203d 2073         title = s
-0003e370: 616d 706c 655f 7175 6572 790a 2020 2020  ample_query.    
-0003e380: 2020 2020 6669 672e 7469 746c 6520 3d20      fig.title = 
-0003e390: 7469 746c 650a 2020 2020 2020 2020 626f  title.        bo
-0003e3a0: 6b65 682e 706c 6f74 7469 6e67 2e73 686f  keh.plotting.sho
-0003e3b0: 7728 6669 6729 0a0a 2020 2020 4064 6f63  w(fig)..    @doc
-0003e3c0: 280a 2020 2020 2020 2020 7375 6d6d 6172  (.        summar
-0003e3d0: 793d 2222 220a 2020 2020 2020 2020 2020  y=""".          
-0003e3e0: 2020 4869 6572 6172 6368 6963 616c 6c79    Hierarchically
-0003e3f0: 2063 6c75 7374 6572 2068 6170 6c6f 7479   cluster haploty
-0003e400: 7065 7320 696e 2072 6567 696f 6e20 616e  pes in region an
-0003e410: 6420 7072 6f64 7563 6520 616e 2069 6e74  d produce an int
-0003e420: 6572 6163 7469 7665 2070 6c6f 742e 0a20  eractive plot.. 
-0003e430: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-0003e440: 2020 2020 7061 7261 6d65 7465 7273 3d64      parameters=d
-0003e450: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
-0003e460: 206b 7761 7267 733d 2250 6173 7365 6420   kwargs="Passed 
-0003e470: 7468 726f 7567 6820 746f 2060 7078 2e73  through to `px.s
-0003e480: 6361 7474 6572 2829 602e 222c 0a20 2020  catter()`.",.   
-0003e490: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
-0003e4a0: 2020 6465 6620 706c 6f74 5f68 6170 6c6f    def plot_haplo
-0003e4b0: 7479 7065 5f63 6c75 7374 6572 696e 6728  type_clustering(
-0003e4c0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0003e4d0: 2020 2020 2020 2072 6567 696f 6e3a 2062         region: b
-0003e4e0: 6173 655f 7061 7261 6d73 2e72 6567 696f  ase_params.regio
-0003e4f0: 6e2c 0a20 2020 2020 2020 2061 6e61 6c79  n,.        analy
-0003e500: 7369 733a 2068 6170 5f70 6172 616d 732e  sis: hap_params.
-0003e510: 616e 616c 7973 6973 203d 2044 4546 4155  analysis = DEFAU
-0003e520: 4c54 2c0a 2020 2020 2020 2020 7361 6d70  LT,.        samp
-0003e530: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
-0003e540: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-0003e550: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
-0003e560: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
-0003e570: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
-0003e580: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
-0003e590: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
-0003e5a0: 6e65 2c0a 2020 2020 2020 2020 636f 6c6f  ne,.        colo
-0003e5b0: 723a 2070 6c6f 746c 795f 7061 7261 6d73  r: plotly_params
-0003e5c0: 2e63 6f6c 6f72 203d 204e 6f6e 652c 0a20  .color = None,. 
-0003e5d0: 2020 2020 2020 2073 796d 626f 6c3a 2070         symbol: p
-0003e5e0: 6c6f 746c 795f 7061 7261 6d73 2e73 796d  lotly_params.sym
-0003e5f0: 626f 6c20 3d20 4e6f 6e65 2c0a 2020 2020  bol = None,.    
-0003e600: 2020 2020 6c69 6e6b 6167 655f 6d65 7468      linkage_meth
-0003e610: 6f64 3a20 6861 7063 6c75 7374 5f70 6172  od: hapclust_par
-0003e620: 616d 732e 6c69 6e6b 6167 655f 6d65 7468  ams.linkage_meth
-0003e630: 6f64 203d 2068 6170 636c 7573 745f 7061  od = hapclust_pa
-0003e640: 7261 6d73 2e6c 696e 6b61 6765 5f6d 6574  rams.linkage_met
-0003e650: 686f 645f 6465 6661 756c 742c 0a20 2020  hod_default,.   
-0003e660: 2020 2020 2063 6f75 6e74 5f73 6f72 743a       count_sort:
-0003e670: 2068 6170 636c 7573 745f 7061 7261 6d73   hapclust_params
-0003e680: 2e63 6f75 6e74 5f73 6f72 7420 3d20 5472  .count_sort = Tr
-0003e690: 7565 2c0a 2020 2020 2020 2020 6469 7374  ue,.        dist
-0003e6a0: 616e 6365 5f73 6f72 743a 2068 6170 636c  ance_sort: hapcl
-0003e6b0: 7573 745f 7061 7261 6d73 2e64 6973 7461  ust_params.dista
-0003e6c0: 6e63 655f 736f 7274 203d 2046 616c 7365  nce_sort = False
-0003e6d0: 2c0a 2020 2020 2020 2020 636f 686f 7274  ,.        cohort
-0003e6e0: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
-0003e6f0: 6261 7365 5f70 6172 616d 732e 636f 686f  base_params.coho
-0003e700: 7274 5f73 697a 655d 203d 204e 6f6e 652c  rt_size] = None,
-0003e710: 0a20 2020 2020 2020 2072 616e 646f 6d5f  .        random_
-0003e720: 7365 6564 3a20 6261 7365 5f70 6172 616d  seed: base_param
-0003e730: 732e 7261 6e64 6f6d 5f73 6565 6420 3d20  s.random_seed = 
-0003e740: 3432 2c0a 2020 2020 2020 2020 7769 6474  42,.        widt
-0003e750: 683a 2070 6c6f 746c 795f 7061 7261 6d73  h: plotly_params
-0003e760: 2e77 6964 7468 203d 2031 3030 302c 0a20  .width = 1000,. 
-0003e770: 2020 2020 2020 2068 6569 6768 743a 2070         height: p
-0003e780: 6c6f 746c 795f 7061 7261 6d73 2e68 6569  lotly_params.hei
-0003e790: 6768 7420 3d20 3530 302c 0a20 2020 2020  ght = 500,.     
-0003e7a0: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-0003e7b0: 2029 202d 3e20 706c 6f74 6c79 5f70 6172   ) -> plotly_par
-0003e7c0: 616d 732e 6669 6775 7265 3a0a 2020 2020  ams.figure:.    
-0003e7d0: 2020 2020 6672 6f6d 2073 6369 7079 2e63      from scipy.c
-0003e7e0: 6c75 7374 6572 2e68 6965 7261 7263 6879  luster.hierarchy
-0003e7f0: 2069 6d70 6f72 7420 6c69 6e6b 6167 650a   import linkage.
-0003e800: 0a20 2020 2020 2020 2066 726f 6d20 2e70  .        from .p
-0003e810: 6c6f 746c 795f 6465 6e64 726f 6772 616d  lotly_dendrogram
-0003e820: 2069 6d70 6f72 7420 6372 6561 7465 5f64   import create_d
-0003e830: 656e 6472 6f67 7261 6d0a 0a20 2020 2020  endrogram..     
-0003e840: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
-0003e850: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
-0003e860: 2020 2020 6473 5f68 6170 7320 3d20 7365      ds_haps = se
-0003e870: 6c66 2e68 6170 6c6f 7479 7065 7328 0a20  lf.haplotypes(. 
-0003e880: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-0003e890: 6e3d 7265 6769 6f6e 2c0a 2020 2020 2020  n=region,.      
-0003e8a0: 2020 2020 2020 616e 616c 7973 6973 3d61        analysis=a
-0003e8b0: 6e61 6c79 7369 732c 0a20 2020 2020 2020  nalysis,.       
-0003e8c0: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
-0003e8d0: 793d 7361 6d70 6c65 5f71 7565 7279 2c0a  y=sample_query,.
-0003e8e0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-0003e8f0: 6c65 5f73 6574 733d 7361 6d70 6c65 5f73  le_sets=sample_s
-0003e900: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
-0003e910: 2063 6f68 6f72 745f 7369 7a65 3d63 6f68   cohort_size=coh
-0003e920: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
-0003e930: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
-0003e940: 643d 7261 6e64 6f6d 5f73 6565 642c 0a20  d=random_seed,. 
-0003e950: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0003e960: 2020 6774 203d 2061 6c6c 656c 2e47 656e    gt = allel.Gen
-0003e970: 6f74 7970 6544 6173 6b41 7272 6179 2864  otypeDaskArray(d
-0003e980: 735f 6861 7073 5b22 6361 6c6c 5f67 656e  s_haps["call_gen
-0003e990: 6f74 7970 6522 5d2e 6461 7461 290a 2020  otype"].data).  
-0003e9a0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-0003e9b0: 5f64 6173 6b5f 7072 6f67 7265 7373 2864  _dask_progress(d
-0003e9c0: 6573 633d 224c 6f61 6420 6861 706c 6f74  esc="Load haplot
-0003e9d0: 7970 6573 2229 3a0a 2020 2020 2020 2020  ypes"):.        
-0003e9e0: 2020 2020 6874 203d 2067 742e 746f 5f68      ht = gt.to_h
-0003e9f0: 6170 6c6f 7479 7065 7328 292e 636f 6d70  aplotypes().comp
-0003ea00: 7574 6528 290a 0a20 2020 2020 2020 2064  ute()..        d
-0003ea10: 6562 7567 2822 6c6f 6164 2073 616d 706c  ebug("load sampl
-0003ea20: 6520 6d65 7461 6461 7461 2229 0a20 2020  e metadata").   
-0003ea30: 2020 2020 2064 665f 7361 6d70 6c65 7320       df_samples 
-0003ea40: 3d20 7365 6c66 2e73 616d 706c 655f 6d65  = self.sample_me
-0003ea50: 7461 6461 7461 280a 2020 2020 2020 2020  tadata(.        
-0003ea60: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
-0003ea70: 7361 6d70 6c65 5f73 6574 732c 2073 616d  sample_sets, sam
-0003ea80: 706c 655f 7175 6572 793d 7361 6d70 6c65  ple_query=sample
-0003ea90: 5f71 7565 7279 0a20 2020 2020 2020 2029  _query.        )
-0003eaa0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-0003eab0: 616c 6967 6e20 7361 6d70 6c65 206d 6574  align sample met
-0003eac0: 6164 6174 6120 7769 7468 2068 6170 6c6f  adata with haplo
-0003ead0: 7479 7065 7322 290a 2020 2020 2020 2020  types").        
-0003eae0: 7068 6173 6564 5f73 616d 706c 6573 203d  phased_samples =
-0003eaf0: 2064 735f 6861 7073 5b22 7361 6d70 6c65   ds_haps["sample
-0003eb00: 5f69 6422 5d2e 7661 6c75 6573 2e74 6f6c  _id"].values.tol
-0003eb10: 6973 7428 290a 2020 2020 2020 2020 6466  ist().        df
-0003eb20: 5f73 616d 706c 6573 5f70 6861 7365 6420  _samples_phased 
-0003eb30: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0003eb40: 6466 5f73 616d 706c 6573 2e73 6574 5f69  df_samples.set_i
-0003eb50: 6e64 6578 2822 7361 6d70 6c65 5f69 6422  ndex("sample_id"
-0003eb60: 292e 6c6f 635b 7068 6173 6564 5f73 616d  ).loc[phased_sam
-0003eb70: 706c 6573 5d2e 7265 7365 745f 696e 6465  ples].reset_inde
-0003eb80: 7828 290a 2020 2020 2020 2020 290a 0a20  x().        ).. 
-0003eb90: 2020 2020 2020 2064 6562 7567 2822 7365         debug("se
-0003eba0: 7420 7570 2070 6c6f 7474 696e 6720 6f70  t up plotting op
-0003ebb0: 7469 6f6e 7322 290a 2020 2020 2020 2020  tions").        
-0003ebc0: 686f 7665 725f 6461 7461 203d 205b 0a20  hover_data = [. 
-0003ebd0: 2020 2020 2020 2020 2020 2022 7361 6d70             "samp
-0003ebe0: 6c65 5f69 6422 2c0a 2020 2020 2020 2020  le_id",.        
-0003ebf0: 2020 2020 2270 6172 746e 6572 5f73 616d      "partner_sam
-0003ec00: 706c 655f 6964 222c 0a20 2020 2020 2020  ple_id",.       
-0003ec10: 2020 2020 2022 7361 6d70 6c65 5f73 6574       "sample_set
-0003ec20: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-0003ec30: 7461 786f 6e22 2c0a 2020 2020 2020 2020  taxon",.        
-0003ec40: 2020 2020 2263 6f75 6e74 7279 222c 0a20      "country",. 
-0003ec50: 2020 2020 2020 2020 2020 2022 6164 6d69             "admi
-0003ec60: 6e31 5f69 736f 222c 0a20 2020 2020 2020  n1_iso",.       
-0003ec70: 2020 2020 2022 6164 6d69 6e31 5f6e 616d       "admin1_nam
-0003ec80: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0003ec90: 2261 646d 696e 325f 6e61 6d65 222c 0a20  "admin2_name",. 
-0003eca0: 2020 2020 2020 2020 2020 2022 6c6f 6361             "loca
-0003ecb0: 7469 6f6e 222c 0a20 2020 2020 2020 2020  tion",.         
-0003ecc0: 2020 2022 7965 6172 222c 0a20 2020 2020     "year",.     
-0003ecd0: 2020 2020 2020 2022 6d6f 6e74 6822 2c0a         "month",.
-0003ece0: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
-0003ecf0: 2020 2069 6620 636f 6c6f 7220 616e 6420     if color and 
-0003ed00: 636f 6c6f 7220 6e6f 7420 696e 2068 6f76  color not in hov
-0003ed10: 6572 5f64 6174 613a 0a20 2020 2020 2020  er_data:.       
-0003ed20: 2020 2020 2068 6f76 6572 5f64 6174 612e       hover_data.
-0003ed30: 6170 7065 6e64 2863 6f6c 6f72 290a 2020  append(color).  
-0003ed40: 2020 2020 2020 6966 2073 796d 626f 6c20        if symbol 
-0003ed50: 616e 6420 7379 6d62 6f6c 206e 6f74 2069  and symbol not i
-0003ed60: 6e20 686f 7665 725f 6461 7461 3a0a 2020  n hover_data:.  
-0003ed70: 2020 2020 2020 2020 2020 686f 7665 725f            hover_
-0003ed80: 6461 7461 2e61 7070 656e 6428 7379 6d62  data.append(symb
-0003ed90: 6f6c 290a 0a20 2020 2020 2020 2070 6c6f  ol)..        plo
-0003eda0: 745f 6b77 6172 6773 203d 2064 6963 7428  t_kwargs = dict(
-0003edb0: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
-0003edc0: 706c 6174 653d 2273 696d 706c 655f 7768  plate="simple_wh
-0003edd0: 6974 6522 2c0a 2020 2020 2020 2020 2020  ite",.          
-0003ede0: 2020 686f 7665 725f 6e61 6d65 3d22 7361    hover_name="sa
-0003edf0: 6d70 6c65 5f69 6422 2c0a 2020 2020 2020  mple_id",.      
-0003ee00: 2020 2020 2020 686f 7665 725f 6461 7461        hover_data
-0003ee10: 3d68 6f76 6572 5f64 6174 612c 0a20 2020  =hover_data,.   
-0003ee20: 2020 2020 2020 2020 2072 656e 6465 725f           render_
-0003ee30: 6d6f 6465 3d22 7376 6722 2c0a 2020 2020  mode="svg",.    
-0003ee40: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
-0003ee50: 6562 7567 2822 7370 6563 6961 6c20 6861  ebug("special ha
-0003ee60: 6e64 6c69 6e67 2066 6f72 2074 6178 6f6e  ndling for taxon
-0003ee70: 2063 6f6c 6f72 2229 0a20 2020 2020 2020   color").       
-0003ee80: 2069 6620 636f 6c6f 7220 3d3d 2022 7461   if color == "ta
-0003ee90: 786f 6e22 3a0a 2020 2020 2020 2020 2020  xon":.          
-0003eea0: 2020 7365 6c66 2e5f 7365 7475 705f 7461    self._setup_ta
-0003eeb0: 786f 6e5f 636f 6c6f 7273 2870 6c6f 745f  xon_colors(plot_
-0003eec0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
-0003eed0: 2064 6562 7567 2822 6170 706c 7920 616e   debug("apply an
-0003eee0: 7920 7573 6572 206f 7665 7272 6964 6573  y user overrides
-0003eef0: 2229 0a20 2020 2020 2020 2070 6c6f 745f  ").        plot_
-0003ef00: 6b77 6172 6773 2e75 7064 6174 6528 6b77  kwargs.update(kw
-0003ef10: 6172 6773 290a 0a20 2020 2020 2020 2064  args)..        d
-0003ef20: 6562 7567 2822 4372 6561 7465 2064 656e  ebug("Create den
-0003ef30: 6472 6f67 7261 6d20 7769 7468 2070 6c6f  drogram with plo
-0003ef40: 746c 7922 290a 2020 2020 2020 2020 2320  tly").        # 
-0003ef50: 7365 7420 6c61 6265 6c73 2061 7320 7468  set labels as th
-0003ef60: 6520 696e 6465 7820 7768 6963 6820 7765  e index which we
-0003ef70: 2065 7874 7261 6374 2074 6f20 7265 6f72   extract to reor
-0003ef80: 6465 7220 6d65 7461 6461 7461 0a20 2020  der metadata.   
-0003ef90: 2020 2020 206c 6561 665f 6c61 6265 6c73       leaf_labels
-0003efa0: 203d 206e 702e 6172 616e 6765 2868 742e   = np.arange(ht.
-0003efb0: 7368 6170 655b 315d 290a 2020 2020 2020  shape[1]).      
-0003efc0: 2020 2320 6765 7420 7468 6520 6d61 7820    # get the max 
-0003efd0: 6469 7374 616e 6365 2c20 7265 7175 6972  distance, requir
-0003efe0: 6564 2074 6f20 7365 7420 786d 696e 2c20  ed to set xmin, 
-0003eff0: 786d 6178 2c20 7768 6963 6820 7765 206e  xmax, which we n
-0003f000: 6565 6420 786d 696e 2074 6f20 6265 2073  eed xmin to be s
-0003f010: 6c69 6768 746c 7920 6265 6c6f 7720 300a  lightly below 0.
-0003f020: 2020 2020 2020 2020 6d61 785f 6469 7374          max_dist
-0003f030: 203d 205f 6765 745f 6d61 785f 6861 6d6d   = _get_max_hamm
-0003f040: 696e 675f 6469 7374 616e 6365 280a 2020  ing_distance(.  
-0003f050: 2020 2020 2020 2020 2020 6874 2e54 2c20            ht.T, 
-0003f060: 6d65 7472 6963 3d22 6861 6d6d 696e 6722  metric="hamming"
-0003f070: 2c20 6c69 6e6b 6167 655f 6d65 7468 6f64  , linkage_method
-0003f080: 3d6c 696e 6b61 6765 5f6d 6574 686f 640a  =linkage_method.
-0003f090: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0003f0a0: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
-0003f0b0: 2050 7954 7970 6543 6865 636b 6572 0a20   PyTypeChecker. 
-0003f0c0: 2020 2020 2020 2066 6967 203d 2063 7265         fig = cre
-0003f0d0: 6174 655f 6465 6e64 726f 6772 616d 280a  ate_dendrogram(.
-0003f0e0: 2020 2020 2020 2020 2020 2020 6874 2e54              ht.T
-0003f0f0: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
-0003f100: 7374 6675 6e3d 6c61 6d62 6461 2078 3a20  stfun=lambda x: 
-0003f110: 5f68 616d 6d69 6e67 5f74 6f5f 736e 7073  _hamming_to_snps
-0003f120: 2878 292c 0a20 2020 2020 2020 2020 2020  (x),.           
-0003f130: 206c 696e 6b61 6765 6675 6e3d 6c61 6d62   linkagefun=lamb
-0003f140: 6461 2078 3a20 6c69 6e6b 6167 6528 782c  da x: linkage(x,
-0003f150: 206d 6574 686f 643d 6c69 6e6b 6167 655f   method=linkage_
-0003f160: 6d65 7468 6f64 292c 0a20 2020 2020 2020  method),.       
-0003f170: 2020 2020 206c 6162 656c 733d 6c65 6166       labels=leaf
-0003f180: 5f6c 6162 656c 732c 0a20 2020 2020 2020  _labels,.       
-0003f190: 2020 2020 2063 6f6c 6f72 5f74 6872 6573       color_thres
-0003f1a0: 686f 6c64 3d30 2c0a 2020 2020 2020 2020  hold=0,.        
-0003f1b0: 2020 2020 636f 756e 745f 736f 7274 3d63      count_sort=c
-0003f1c0: 6f75 6e74 5f73 6f72 742c 0a20 2020 2020  ount_sort,.     
-0003f1d0: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
-0003f1e0: 736f 7274 3d64 6973 7461 6e63 655f 736f  sort=distance_so
-0003f1f0: 7274 2c0a 2020 2020 2020 2020 290a 2020  rt,.        ).  
-0003f200: 2020 2020 2020 6669 672e 7570 6461 7465        fig.update
-0003f210: 5f74 7261 6365 7328 0a20 2020 2020 2020  _traces(.       
-0003f220: 2020 2020 2068 6f76 6572 696e 666f 3d22       hoverinfo="
-0003f230: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-0003f240: 6c69 6e65 3d64 6963 7428 7769 6474 683d  line=dict(width=
-0003f250: 302e 352c 2063 6f6c 6f72 3d22 626c 6163  0.5, color="blac
-0003f260: 6b22 292c 0a20 2020 2020 2020 2029 0a0a  k"),.        )..
-0003f270: 2020 2020 2020 2020 7469 746c 655f 6c69          title_li
-0003f280: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-0003f290: 2069 6620 7361 6d70 6c65 5f73 6574 7320   if sample_sets 
-0003f2a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0003f2b0: 2020 2020 2020 2020 2074 6974 6c65 5f6c           title_l
-0003f2c0: 696e 6573 2e61 7070 656e 6428 6622 7361  ines.append(f"sa
-0003f2d0: 6d70 6c65 2073 6574 733a 207b 7361 6d70  mple sets: {samp
-0003f2e0: 6c65 5f73 6574 737d 2229 0a20 2020 2020  le_sets}").     
-0003f2f0: 2020 2069 6620 7361 6d70 6c65 5f71 7565     if sample_que
-0003f300: 7279 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ry is not None:.
-0003f310: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-0003f320: 655f 6c69 6e65 732e 6170 7065 6e64 2866  e_lines.append(f
-0003f330: 2273 616d 706c 6520 7175 6572 793a 207b  "sample query: {
-0003f340: 7361 6d70 6c65 5f71 7565 7279 7d22 290a  sample_query}").
-0003f350: 2020 2020 2020 2020 7469 746c 655f 6c69          title_li
-0003f360: 6e65 732e 6170 7065 6e64 2866 2267 656e  nes.append(f"gen
-0003f370: 6f6d 6963 2072 6567 696f 6e3a 207b 7265  omic region: {re
-0003f380: 6769 6f6e 7d20 287b 6874 2e73 6861 7065  gion} ({ht.shape
-0003f390: 5b30 5d7d 2053 4e50 7329 2229 0a20 2020  [0]} SNPs)").   
-0003f3a0: 2020 2020 2074 6974 6c65 203d 2022 3c62       title = "<b
-0003f3b0: 723e 222e 6a6f 696e 2874 6974 6c65 5f6c  r>".join(title_l
-0003f3c0: 696e 6573 290a 0a20 2020 2020 2020 2066  ines)..        f
-0003f3d0: 6967 2e75 7064 6174 655f 6c61 796f 7574  ig.update_layout
-0003f3e0: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
-0003f3f0: 6474 683d 7769 6474 682c 0a20 2020 2020  dth=width,.     
-0003f400: 2020 2020 2020 2068 6569 6768 743d 6865         height=he
-0003f410: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
-0003f420: 2020 7469 746c 653d 7469 746c 652c 0a20    title=title,. 
-0003f430: 2020 2020 2020 2020 2020 2061 7574 6f73             autos
-0003f440: 697a 653d 5472 7565 2c0a 2020 2020 2020  ize=True,.      
-0003f450: 2020 2020 2020 686f 7665 726d 6f64 653d        hovermode=
-0003f460: 2263 6c6f 7365 7374 222c 0a20 2020 2020  "closest",.     
-0003f470: 2020 2020 2020 2070 6c6f 745f 6267 636f         plot_bgco
-0003f480: 6c6f 723d 2277 6869 7465 222c 0a20 2020  lor="white",.   
-0003f490: 2020 2020 2020 2020 2079 6178 6973 5f74           yaxis_t
-0003f4a0: 6974 6c65 3d22 4469 7374 616e 6365 2028  itle="Distance (
-0003f4b0: 6e6f 2e20 534e 5073 2922 2c0a 2020 2020  no. SNPs)",.    
-0003f4c0: 2020 2020 2020 2020 7861 7869 735f 7469          xaxis_ti
-0003f4d0: 746c 653d 2248 6170 6c6f 7479 7065 7322  tle="Haplotypes"
-0003f4e0: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
-0003f4f0: 6f77 6c65 6765 6e64 3d54 7275 652c 0a20  owlegend=True,. 
-0003f500: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0003f510: 2020 2320 5265 7065 6174 2074 6865 2064    # Repeat the d
-0003f520: 6174 6166 7261 6d65 2073 6f20 7468 6572  ataframe so ther
-0003f530: 6520 6973 206f 6e65 2072 6f77 206f 6620  e is one row of 
-0003f540: 6d65 7461 6461 7461 2066 6f72 2065 6163  metadata for eac
-0003f550: 6820 6861 706c 6f74 7970 650a 2020 2020  h haplotype.    
-0003f560: 2020 2020 6466 5f73 616d 706c 6573 5f70      df_samples_p
-0003f570: 6861 7365 645f 6861 7073 203d 2070 642e  hased_haps = pd.
-0003f580: 4461 7461 4672 616d 6528 0a20 2020 2020  DataFrame(.     
-0003f590: 2020 2020 2020 206e 702e 7265 7065 6174         np.repeat
-0003f5a0: 2864 665f 7361 6d70 6c65 735f 7068 6173  (df_samples_phas
-0003f5b0: 6564 2e76 616c 7565 732c 2032 2c20 6178  ed.values, 2, ax
-0003f5c0: 6973 3d30 290a 2020 2020 2020 2020 290a  is=0).        ).
-0003f5d0: 2020 2020 2020 2020 6466 5f73 616d 706c          df_sampl
-0003f5e0: 6573 5f70 6861 7365 645f 6861 7073 2e63  es_phased_haps.c
-0003f5f0: 6f6c 756d 6e73 203d 2064 665f 7361 6d70  olumns = df_samp
-0003f600: 6c65 735f 7068 6173 6564 2e63 6f6c 756d  les_phased.colum
-0003f610: 6e73 0a20 2020 2020 2020 2023 2073 656c  ns.        # sel
-0003f620: 6563 7420 6f6e 6c79 2063 6f6c 756d 6e73  ect only columns
-0003f630: 2069 6e20 686f 7665 725f 6461 7461 0a20   in hover_data. 
-0003f640: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
-0003f650: 735f 7068 6173 6564 5f68 6170 7320 3d20  s_phased_haps = 
-0003f660: 6466 5f73 616d 706c 6573 5f70 6861 7365  df_samples_phase
-0003f670: 645f 6861 7073 5b68 6f76 6572 5f64 6174  d_haps[hover_dat
-0003f680: 615d 0a20 2020 2020 2020 2064 6562 7567  a].        debug
-0003f690: 2822 5265 6f72 6465 7220 6861 706c 6f74  ("Reorder haplot
-0003f6a0: 7970 6520 6d65 7461 6461 7461 2074 6f20  ype metadata to 
-0003f6b0: 616c 6967 6e20 7769 7468 2068 6170 6c6f  align with haplo
-0003f6c0: 7479 7065 2063 6c75 7374 6572 696e 6722  type clustering"
-0003f6d0: 290a 2020 2020 2020 2020 6466 5f73 616d  ).        df_sam
-0003f6e0: 706c 6573 5f70 6861 7365 645f 6861 7073  ples_phased_haps
-0003f6f0: 203d 2064 665f 7361 6d70 6c65 735f 7068   = df_samples_ph
-0003f700: 6173 6564 5f68 6170 732e 6c6f 635b 0a20  ased_haps.loc[. 
-0003f710: 2020 2020 2020 2020 2020 2066 6967 2e6c             fig.l
-0003f720: 6179 6f75 742e 7861 7869 735b 2274 6963  ayout.xaxis["tic
-0003f730: 6b74 6578 7422 5d0a 2020 2020 2020 2020  ktext"].        
-0003f740: 5d0a 2020 2020 2020 2020 6669 672e 7570  ].        fig.up
-0003f750: 6461 7465 5f78 6178 6573 286d 6972 726f  date_xaxes(mirro
-0003f760: 723d 4661 6c73 652c 2073 686f 7767 7269  r=False, showgri
-0003f770: 643d 5472 7565 2c20 7368 6f77 7469 636b  d=True, showtick
-0003f780: 6c61 6265 6c73 3d46 616c 7365 2c20 7469  labels=False, ti
-0003f790: 636b 733d 2222 290a 2020 2020 2020 2020  cks="").        
-0003f7a0: 6669 672e 7570 6461 7465 5f79 6178 6573  fig.update_yaxes
-0003f7b0: 280a 2020 2020 2020 2020 2020 2020 6d69  (.            mi
-0003f7c0: 7272 6f72 3d46 616c 7365 2c20 7368 6f77  rror=False, show
-0003f7d0: 6772 6964 3d54 7275 652c 2073 686f 776c  grid=True, showl
-0003f7e0: 696e 653d 5472 7565 2c20 7261 6e67 653d  ine=True, range=
-0003f7f0: 5b2d 322c 206d 6178 5f64 6973 7420 2b20  [-2, max_dist + 
-0003f800: 315d 0a20 2020 2020 2020 2029 0a0a 2020  1].        )..  
-0003f810: 2020 2020 2020 6465 6275 6728 2241 6464        debug("Add
-0003f820: 2073 6361 7474 6572 2070 6c6f 7420 7769   scatter plot wi
-0003f830: 7468 2068 6f76 6572 2074 6578 7422 290a  th hover text").
-0003f840: 2020 2020 2020 2020 6669 672e 6164 645f          fig.add_
-0003f850: 7472 6163 6573 280a 2020 2020 2020 2020  traces(.        
-0003f860: 2020 2020 6c69 7374 280a 2020 2020 2020      list(.      
-0003f870: 2020 2020 2020 2020 2020 7078 2e73 6361            px.sca
-0003f880: 7474 6572 280a 2020 2020 2020 2020 2020  tter(.          
-0003f890: 2020 2020 2020 2020 2020 6466 5f73 616d            df_sam
-0003f8a0: 706c 6573 5f70 6861 7365 645f 6861 7073  ples_phased_haps
-0003f8b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0003f8c0: 2020 2020 2020 783d 6669 672e 6c61 796f        x=fig.layo
-0003f8d0: 7574 2e78 6178 6973 5b22 7469 636b 7661  ut.xaxis["tickva
-0003f8e0: 6c73 225d 2c0a 2020 2020 2020 2020 2020  ls"],.          
-0003f8f0: 2020 2020 2020 2020 2020 793d 6e70 2e72            y=np.r
-0003f900: 6570 6561 7428 2d31 2c20 6c65 6e28 6874  epeat(-1, len(ht
-0003f910: 2e54 2929 2c0a 2020 2020 2020 2020 2020  .T)),.          
-0003f920: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
-0003f930: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
-0003f940: 2020 2020 2020 2020 2020 2073 796d 626f             symbo
-0003f950: 6c3d 7379 6d62 6f6c 2c0a 2020 2020 2020  l=symbol,.      
-0003f960: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0003f970: 706c 6f74 5f6b 7761 7267 732c 0a20 2020  plot_kwargs,.   
-0003f980: 2020 2020 2020 2020 2020 2020 2029 2e73               ).s
-0003f990: 656c 6563 745f 7472 6163 6573 2829 0a20  elect_traces(). 
-0003f9a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0003f9b0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0003f9c0: 7265 7475 726e 2066 6967 0a0a 2020 2020  return fig..    
-0003f9d0: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
-0003f9e0: 6d6d 6172 793d 2222 220a 2020 2020 2020  mmary=""".      
-0003f9f0: 2020 2020 2020 436f 6e73 7472 7563 7420        Construct 
-0003fa00: 6120 6d65 6469 616e 2d6a 6f69 6e69 6e67  a median-joining
-0003fa10: 2068 6170 6c6f 7479 7065 206e 6574 776f   haplotype netwo
-0003fa20: 726b 2061 6e64 2064 6973 706c 6179 2069  rk and display i
-0003fa30: 7420 7573 696e 670a 2020 2020 2020 2020  t using.        
-0003fa40: 2020 2020 4379 746f 7363 6170 652e 0a20      Cytoscape.. 
-0003fa50: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
-0003fa60: 2020 2020 6578 7465 6e64 6564 5f73 756d      extended_sum
-0003fa70: 6d61 7279 3d22 2222 0a20 2020 2020 2020  mary=""".       
-0003fa80: 2020 2020 2041 2068 6170 6c6f 7479 7065       A haplotype
-0003fa90: 206e 6574 776f 726b 2070 726f 7669 6465   network provide
-0003faa0: 7320 6120 7669 7375 616c 6973 6174 696f  s a visualisatio
-0003fab0: 6e20 6f66 2074 6865 2067 656e 6574 6963  n of the genetic
-0003fac0: 2064 6973 7461 6e63 650a 2020 2020 2020   distance.      
-0003fad0: 2020 2020 2020 6265 7477 6565 6e20 6861        between ha
-0003fae0: 706c 6f74 7970 655f 2045 6163 6820 6e6f  plotype_ Each no
-0003faf0: 6465 2069 6e20 7468 6520 6e65 7477 6f72  de in the networ
-0003fb00: 6b20 7265 7072 6573 656e 7473 2061 2075  k represents a u
-0003fb10: 6e69 7175 650a 2020 2020 2020 2020 2020  nique.          
-0003fb20: 2020 6861 706c 6f74 7970 652e 2054 6865    haplotype. The
-0003fb30: 2073 697a 6520 2861 7265 6129 206f 6620   size (area) of 
-0003fb40: 7468 6520 6e6f 6465 2069 7320 7363 616c  the node is scal
-0003fb50: 6564 2062 7920 7468 6520 6e75 6d62 6572  ed by the number
-0003fb60: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-0003fb70: 7469 6d65 7320 7468 6174 2075 6e69 7175  times that uniqu
-0003fb80: 6520 6861 706c 6f74 7970 6520 7761 7320  e haplotype was 
-0003fb90: 6f62 7365 7276 6564 2077 6974 6869 6e20  observed within 
-0003fba0: 7468 6520 7365 6c65 6374 6564 2073 616d  the selected sam
-0003fbb0: 706c 6573 2e0a 2020 2020 2020 2020 2020  ples..          
-0003fbc0: 2020 4120 636f 6e6e 6563 7469 6f6e 2062    A connection b
-0003fbd0: 6574 7765 656e 2074 776f 206e 6f64 6573  etween two nodes
-0003fbe0: 2072 6570 7265 7365 6e74 7320 6120 7369   represents a si
-0003fbf0: 6e67 6c65 2053 4e50 2064 6966 6665 7265  ngle SNP differe
-0003fc00: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
-0003fc10: 6265 7477 6565 6e20 7468 6520 636f 7272  between the corr
-0003fc20: 6573 706f 6e64 696e 6720 6861 706c 6f74  esponding haplot
-0003fc30: 7970 6573 2e0a 2020 2020 2020 2020 2222  ypes..        ""
-0003fc40: 222c 0a20 2020 2029 0a20 2020 2064 6566  ",.    ).    def
-0003fc50: 2070 6c6f 745f 6861 706c 6f74 7970 655f   plot_haplotype_
-0003fc60: 6e65 7477 6f72 6b28 0a20 2020 2020 2020  network(.       
-0003fc70: 2073 656c 662c 0a20 2020 2020 2020 2072   self,.        r
-0003fc80: 6567 696f 6e3a 2062 6173 655f 7061 7261  egion: base_para
-0003fc90: 6d73 2e72 6567 696f 6e2c 0a20 2020 2020  ms.region,.     
-0003fca0: 2020 2061 6e61 6c79 7369 733a 2068 6170     analysis: hap
-0003fcb0: 5f70 6172 616d 732e 616e 616c 7973 6973  _params.analysis
-0003fcc0: 203d 2044 4546 4155 4c54 2c0a 2020 2020   = DEFAULT,.    
-0003fcd0: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
-0003fce0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-0003fcf0: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
-0003fd00: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-0003fd10: 2020 2073 616d 706c 655f 7175 6572 793a     sample_query:
-0003fd20: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
-0003fd30: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
-0003fd40: 7279 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ry] = None,.    
-0003fd50: 2020 2020 6d61 785f 6469 7374 3a20 6861      max_dist: ha
-0003fd60: 706e 6574 5f70 6172 616d 732e 6d61 785f  pnet_params.max_
-0003fd70: 6469 7374 203d 2068 6170 6e65 745f 7061  dist = hapnet_pa
-0003fd80: 7261 6d73 2e6d 6178 5f64 6973 745f 6465  rams.max_dist_de
-0003fd90: 6661 756c 742c 0a20 2020 2020 2020 2063  fault,.        c
-0003fda0: 6f6c 6f72 3a20 4f70 7469 6f6e 616c 5b68  olor: Optional[h
-0003fdb0: 6170 6e65 745f 7061 7261 6d73 2e63 6f6c  apnet_params.col
-0003fdc0: 6f72 5d20 3d20 4e6f 6e65 2c0a 2020 2020  or] = None,.    
-0003fdd0: 2020 2020 636f 6c6f 725f 6469 7363 7265      color_discre
-0003fde0: 7465 5f73 6571 7565 6e63 653a 204f 7074  te_sequence: Opt
-0003fdf0: 696f 6e61 6c5b 6861 706e 6574 5f70 6172  ional[hapnet_par
-0003fe00: 616d 732e 636f 6c6f 725f 6469 7363 7265  ams.color_discre
-0003fe10: 7465 5f73 6571 7565 6e63 655d 203d 204e  te_sequence] = N
-0003fe20: 6f6e 652c 0a20 2020 2020 2020 2063 6f6c  one,.        col
-0003fe30: 6f72 5f64 6973 6372 6574 655f 6d61 703a  or_discrete_map:
-0003fe40: 204f 7074 696f 6e61 6c5b 6861 706e 6574   Optional[hapnet
-0003fe50: 5f70 6172 616d 732e 636f 6c6f 725f 6469  _params.color_di
-0003fe60: 7363 7265 7465 5f6d 6170 5d20 3d20 4e6f  screte_map] = No
-0003fe70: 6e65 2c0a 2020 2020 2020 2020 6361 7465  ne,.        cate
-0003fe80: 676f 7279 5f6f 7264 6572 733a 204f 7074  gory_orders: Opt
-0003fe90: 696f 6e61 6c5b 6861 706e 6574 5f70 6172  ional[hapnet_par
-0003fea0: 616d 732e 6361 7465 676f 7279 5f6f 7264  ams.category_ord
-0003feb0: 6572 5d20 3d20 4e6f 6e65 2c0a 2020 2020  er] = None,.    
-0003fec0: 2020 2020 6e6f 6465 5f73 697a 655f 6661      node_size_fa
-0003fed0: 6374 6f72 3a20 6861 706e 6574 5f70 6172  ctor: hapnet_par
-0003fee0: 616d 732e 6e6f 6465 5f73 697a 655f 6661  ams.node_size_fa
-0003fef0: 6374 6f72 203d 2068 6170 6e65 745f 7061  ctor = hapnet_pa
-0003ff00: 7261 6d73 2e6e 6f64 655f 7369 7a65 5f66  rams.node_size_f
-0003ff10: 6163 746f 725f 6465 6661 756c 742c 0a20  actor_default,. 
-0003ff20: 2020 2020 2020 206c 6179 6f75 743a 2068         layout: h
-0003ff30: 6170 6e65 745f 7061 7261 6d73 2e6c 6179  apnet_params.lay
-0003ff40: 6f75 7420 3d20 6861 706e 6574 5f70 6172  out = hapnet_par
-0003ff50: 616d 732e 6c61 796f 7574 5f64 6566 6175  ams.layout_defau
-0003ff60: 6c74 2c0a 2020 2020 2020 2020 6c61 796f  lt,.        layo
-0003ff70: 7574 5f70 6172 616d 733a 204f 7074 696f  ut_params: Optio
-0003ff80: 6e61 6c5b 6861 706e 6574 5f70 6172 616d  nal[hapnet_param
-0003ff90: 732e 6c61 796f 7574 5f70 6172 616d 735d  s.layout_params]
-0003ffa0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0003ffb0: 2073 6572 7665 725f 706f 7274 3a20 4f70   server_port: Op
-0003ffc0: 7469 6f6e 616c 5b64 6173 685f 7061 7261  tional[dash_para
-0003ffd0: 6d73 2e73 6572 7665 725f 706f 7274 5d20  ms.server_port] 
-0003ffe0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0003fff0: 7365 7276 6572 5f6d 6f64 653a 204f 7074  server_mode: Opt
-00040000: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
-00040010: 2020 2064 6173 685f 7061 7261 6d73 2e73     dash_params.s
-00040020: 6572 7665 725f 6d6f 6465 0a20 2020 2020  erver_mode.     
-00040030: 2020 205d 203d 2064 6173 685f 7061 7261     ] = dash_para
-00040040: 6d73 2e73 6572 7665 725f 6d6f 6465 5f64  ms.server_mode_d
-00040050: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
-00040060: 6865 6967 6874 3a20 6461 7368 5f70 6172  height: dash_par
-00040070: 616d 732e 6865 6967 6874 203d 2036 3530  ams.height = 650
-00040080: 2c0a 2020 2020 2020 2020 7769 6474 683a  ,.        width:
-00040090: 204f 7074 696f 6e61 6c5b 6461 7368 5f70   Optional[dash_p
-000400a0: 6172 616d 732e 7769 6474 685d 203d 2022  arams.width] = "
-000400b0: 3130 3025 222c 0a20 2020 2029 3a0a 2020  100%",.    ):.  
-000400c0: 2020 2020 2020 696d 706f 7274 2064 6173        import das
-000400d0: 685f 6379 746f 7363 6170 6520 6173 2063  h_cytoscape as c
-000400e0: 7974 6f0a 2020 2020 2020 2020 6672 6f6d  yto.        from
-000400f0: 2064 6173 6820 696d 706f 7274 2064 6363   dash import dcc
-00040100: 2c20 6874 6d6c 0a20 2020 2020 2020 2066  , html.        f
-00040110: 726f 6d20 6461 7368 2e64 6570 656e 6465  rom dash.depende
-00040120: 6e63 6965 7320 696d 706f 7274 2049 6e70  ncies import Inp
-00040130: 7574 2c20 4f75 7470 7574 0a20 2020 2020  ut, Output.     
-00040140: 2020 2066 726f 6d20 6a75 7079 7465 725f     from jupyter_
-00040150: 6461 7368 2069 6d70 6f72 7420 4a75 7079  dash import Jupy
-00040160: 7465 7244 6173 680a 0a20 2020 2020 2020  terDash..       
-00040170: 2069 6620 6c61 796f 7574 2021 3d20 2263   if layout != "c
-00040180: 6f73 6522 3a0a 2020 2020 2020 2020 2020  ose":.          
-00040190: 2020 6379 746f 2e6c 6f61 645f 6578 7472    cyto.load_extr
-000401a0: 615f 6c61 796f 7574 7328 290a 2020 2020  a_layouts().    
-000401b0: 2020 2020 2320 6c65 6176 6520 7468 6973      # leave this
-000401c0: 2066 6f72 2075 7365 7220 636f 6465 2c20   for user code, 
-000401d0: 6966 206e 6565 6465 6420 2864 6f65 736e  if needed (doesn
-000401e0: 2774 2073 6565 6d20 6e65 6365 7373 6172  't seem necessar
-000401f0: 7920 6f6e 2063 6f6c 6162 290a 2020 2020  y on colab).    
-00040200: 2020 2020 2320 4a75 7079 7465 7244 6173      # JupyterDas
-00040210: 682e 696e 6665 725f 6a75 7079 7465 725f  h.infer_jupyter_
-00040220: 7072 6f78 795f 636f 6e66 6967 2829 0a0a  proxy_config()..
-00040230: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-00040240: 7365 6c66 2e5f 6c6f 672e 6465 6275 670a  self._log.debug.
-00040250: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00040260: 6163 6365 7373 2068 6170 6c6f 7479 7065  access haplotype
-00040270: 7320 6461 7461 7365 7422 290a 2020 2020  s dataset").    
-00040280: 2020 2020 6473 5f68 6170 7320 3d20 7365      ds_haps = se
-00040290: 6c66 2e68 6170 6c6f 7479 7065 7328 0a20  lf.haplotypes(. 
-000402a0: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-000402b0: 6e3d 7265 6769 6f6e 2c0a 2020 2020 2020  n=region,.      
-000402c0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
-000402d0: 733d 7361 6d70 6c65 5f73 6574 732c 0a20  s=sample_sets,. 
-000402e0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-000402f0: 655f 7175 6572 793d 7361 6d70 6c65 5f71  e_query=sample_q
-00040300: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
-00040310: 2020 616e 616c 7973 6973 3d61 6e61 6c79    analysis=analy
-00040320: 7369 732c 0a20 2020 2020 2020 2029 0a0a  sis,.        )..
-00040330: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
-00040340: 6363 6573 7320 7361 6d70 6c65 206d 6574  ccess sample met
-00040350: 6164 6174 6122 290a 2020 2020 2020 2020  adata").        
-00040360: 6466 5f73 616d 706c 6573 203d 2073 656c  df_samples = sel
-00040370: 662e 7361 6d70 6c65 5f6d 6574 6164 6174  f.sample_metadat
-00040380: 6128 0a20 2020 2020 2020 2020 2020 2073  a(.            s
-00040390: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
-000403a0: 6c65 5f71 7565 7279 2c20 7361 6d70 6c65  le_query, sample
-000403b0: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
-000403c0: 730a 2020 2020 2020 2020 290a 0a20 2020  s.        )..   
-000403d0: 2020 2020 2064 6562 7567 2822 7365 7475       debug("setu
-000403e0: 7020 6861 706c 6f74 7970 6520 6d65 7461  p haplotype meta
-000403f0: 6461 7461 2229 0a20 2020 2020 2020 2073  data").        s
-00040400: 616d 706c 6573 5f70 6861 7365 6420 3d20  amples_phased = 
-00040410: 6473 5f68 6170 735b 2273 616d 706c 655f  ds_haps["sample_
-00040420: 6964 225d 2e76 616c 7565 730a 2020 2020  id"].values.    
-00040430: 2020 2020 6466 5f73 616d 706c 6573 5f70      df_samples_p
-00040440: 6861 7365 6420 3d20 280a 2020 2020 2020  hased = (.      
-00040450: 2020 2020 2020 6466 5f73 616d 706c 6573        df_samples
-00040460: 2e73 6574 5f69 6e64 6578 2822 7361 6d70  .set_index("samp
-00040470: 6c65 5f69 6422 292e 6c6f 635b 7361 6d70  le_id").loc[samp
-00040480: 6c65 735f 7068 6173 6564 5d2e 7265 7365  les_phased].rese
-00040490: 745f 696e 6465 7828 290a 2020 2020 2020  t_index().      
-000404a0: 2020 290a 2020 2020 2020 2020 6466 5f68    ).        df_h
-000404b0: 6170 7320 3d20 6466 5f73 616d 706c 6573  aps = df_samples
-000404c0: 5f70 6861 7365 642e 6c6f 635b 6466 5f73  _phased.loc[df_s
-000404d0: 616d 706c 6573 5f70 6861 7365 642e 696e  amples_phased.in
-000404e0: 6465 782e 7265 7065 6174 2832 295d 2e72  dex.repeat(2)].r
-000404f0: 6573 6574 5f69 6e64 6578 280a 2020 2020  eset_index(.    
-00040500: 2020 2020 2020 2020 6472 6f70 3d54 7275          drop=Tru
-00040510: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-00040520: 2020 2020 2064 6562 7567 2822 6c6f 6164       debug("load
-00040530: 2068 6170 6c6f 7479 7065 7322 290a 2020   haplotypes").  
-00040540: 2020 2020 2020 6774 203d 2061 6c6c 656c        gt = allel
-00040550: 2e47 656e 6f74 7970 6544 6173 6b41 7272  .GenotypeDaskArr
-00040560: 6179 2864 735f 6861 7073 5b22 6361 6c6c  ay(ds_haps["call
-00040570: 5f67 656e 6f74 7970 6522 5d2e 6461 7461  _genotype"].data
-00040580: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-00040590: 656c 662e 5f64 6173 6b5f 7072 6f67 7265  elf._dask_progre
-000405a0: 7373 2864 6573 633d 224c 6f61 6420 6861  ss(desc="Load ha
-000405b0: 706c 6f74 7970 6573 2229 3a0a 2020 2020  plotypes"):.    
-000405c0: 2020 2020 2020 2020 6874 203d 2067 742e          ht = gt.
-000405d0: 746f 5f68 6170 6c6f 7479 7065 7328 292e  to_haplotypes().
-000405e0: 636f 6d70 7574 6528 290a 0a20 2020 2020  compute()..     
-000405f0: 2020 2064 6562 7567 2822 636f 756e 7420     debug("count 
-00040600: 616c 6c65 6c65 7320 616e 6420 7365 6c65  alleles and sele
-00040610: 6374 2073 6567 7265 6761 7469 6e67 2073  ct segregating s
-00040620: 6974 6573 2229 0a20 2020 2020 2020 2061  ites").        a
-00040630: 6320 3d20 6774 2e63 6f75 6e74 5f61 6c6c  c = gt.count_all
-00040640: 656c 6573 286d 6178 5f61 6c6c 656c 653d  eles(max_allele=
-00040650: 3129 0a20 2020 2020 2020 206c 6f63 5f73  1).        loc_s
-00040660: 6567 203d 2061 632e 6973 5f73 6567 7265  eg = ac.is_segre
-00040670: 6761 7469 6e67 2829 0a20 2020 2020 2020  gating().       
-00040680: 2068 745f 7365 6720 3d20 6874 5b6c 6f63   ht_seg = ht[loc
-00040690: 5f73 6567 5d0a 0a20 2020 2020 2020 2064  _seg]..        d
-000406a0: 6562 7567 2822 6964 656e 7469 6679 2064  ebug("identify d
-000406b0: 6973 7469 6e63 7420 6861 706c 6f74 7970  istinct haplotyp
-000406c0: 6573 2229 0a20 2020 2020 2020 2068 745f  es").        ht_
-000406d0: 6469 7374 696e 6374 5f73 6574 7320 3d20  distinct_sets = 
-000406e0: 6874 5f73 6567 2e64 6973 7469 6e63 7428  ht_seg.distinct(
-000406f0: 290a 2020 2020 2020 2020 2320 6669 6e64  ).        # find
-00040700: 2069 6e64 6963 6573 206f 6620 6469 7374   indices of dist
-00040710: 696e 6374 2068 6170 6c6f 7479 7065 7320  inct haplotypes 
-00040720: 2d20 6a75 7374 206e 6565 6420 6f6e 6520  - just need one 
-00040730: 7065 7220 7365 740a 2020 2020 2020 2020  per set.        
-00040740: 6874 5f64 6973 7469 6e63 745f 696e 6469  ht_distinct_indi
-00040750: 6365 7320 3d20 5b6d 696e 2873 2920 666f  ces = [min(s) fo
-00040760: 7220 7320 696e 2068 745f 6469 7374 696e  r s in ht_distin
-00040770: 6374 5f73 6574 735d 0a20 2020 2020 2020  ct_sets].       
-00040780: 2023 2072 656f 7264 6572 2062 7920 696e   # reorder by in
-00040790: 6465 7820 2d20 544f 444f 2069 7320 7468  dex - TODO is th
-000407a0: 6973 206e 6563 6573 7361 7279 3f0a 2020  is necessary?.  
-000407b0: 2020 2020 2020 6978 203d 206e 702e 6172        ix = np.ar
-000407c0: 6773 6f72 7428 6874 5f64 6973 7469 6e63  gsort(ht_distinc
-000407d0: 745f 696e 6469 6365 7329 0a20 2020 2020  t_indices).     
-000407e0: 2020 2068 745f 6469 7374 696e 6374 5f69     ht_distinct_i
-000407f0: 6e64 6963 6573 203d 205b 6874 5f64 6973  ndices = [ht_dis
-00040800: 7469 6e63 745f 696e 6469 6365 735b 695d  tinct_indices[i]
-00040810: 2066 6f72 2069 2069 6e20 6978 5d0a 2020   for i in ix].  
-00040820: 2020 2020 2020 6874 5f64 6973 7469 6e63        ht_distinc
-00040830: 745f 7365 7473 203d 205b 6874 5f64 6973  t_sets = [ht_dis
-00040840: 7469 6e63 745f 7365 7473 5b69 5d20 666f  tinct_sets[i] fo
-00040850: 7220 6920 696e 2069 785d 0a20 2020 2020  r i in ix].     
-00040860: 2020 2023 206f 6274 6169 6e20 616e 2061     # obtain an a
-00040870: 7272 6179 206f 6620 6469 7374 696e 6374  rray of distinct
-00040880: 2068 6170 6c6f 7479 7065 730a 2020 2020   haplotypes.    
-00040890: 2020 2020 6874 5f64 6973 7469 6e63 7420      ht_distinct 
-000408a0: 3d20 6874 5f73 6567 2e74 616b 6528 6874  = ht_seg.take(ht
-000408b0: 5f64 6973 7469 6e63 745f 696e 6469 6365  _distinct_indice
-000408c0: 732c 2061 7869 733d 3129 0a20 2020 2020  s, axis=1).     
-000408d0: 2020 2023 2063 6f75 6e74 2068 6f77 206d     # count how m
-000408e0: 616e 7920 6f62 7365 7276 6174 696f 6e73  any observations
-000408f0: 2070 6572 2064 6973 7469 6e63 7420 6861   per distinct ha
-00040900: 706c 6f74 7970 650a 2020 2020 2020 2020  plotype.        
-00040910: 6874 5f63 6f75 6e74 7320 3d20 5b6c 656e  ht_counts = [len
-00040920: 2873 2920 666f 7220 7320 696e 2068 745f  (s) for s in ht_
-00040930: 6469 7374 696e 6374 5f73 6574 735d 0a0a  distinct_sets]..
-00040940: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
-00040950: 6f6e 7374 7275 6374 206d 6564 6961 6e20  onstruct median 
-00040960: 6a6f 696e 696e 6720 6e65 7477 6f72 6b22  joining network"
-00040970: 290a 2020 2020 2020 2020 6874 5f64 6973  ).        ht_dis
-00040980: 7469 6e63 745f 6d6a 6e2c 2065 6467 6573  tinct_mjn, edges
-00040990: 2c20 616c 745f 6564 6765 7320 3d20 6d65  , alt_edges = me
-000409a0: 6469 616e 5f6a 6f69 6e69 6e67 5f6e 6574  dian_joining_net
-000409b0: 776f 726b 280a 2020 2020 2020 2020 2020  work(.          
-000409c0: 2020 6874 5f64 6973 7469 6e63 742c 206d    ht_distinct, m
-000409d0: 6178 5f64 6973 743d 6d61 785f 6469 7374  ax_dist=max_dist
-000409e0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000409f0: 2020 2065 6467 6573 203d 206e 702e 7472     edges = np.tr
-00040a00: 6975 2865 6467 6573 290a 2020 2020 2020  iu(edges).      
-00040a10: 2020 616c 745f 6564 6765 7320 3d20 6e70    alt_edges = np
-00040a20: 2e74 7269 7528 616c 745f 6564 6765 7329  .triu(alt_edges)
-00040a30: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
-00040a40: 2273 6574 7570 2063 6f6c 6f72 7322 290a  "setup colors").
-00040a50: 2020 2020 2020 2020 636f 6c6f 725f 7661          color_va
-00040a60: 6c75 6573 203d 204e 6f6e 650a 2020 2020  lues = None.    
-00040a70: 2020 2020 636f 6c6f 725f 7661 6c75 6573      color_values
-00040a80: 5f64 6973 706c 6179 203d 204e 6f6e 650a  _display = None.
-00040a90: 2020 2020 2020 2020 636f 6c6f 725f 6469          color_di
-00040aa0: 7363 7265 7465 5f6d 6170 5f64 6973 706c  screte_map_displ
-00040ab0: 6179 203d 204e 6f6e 650a 2020 2020 2020  ay = None.      
-00040ac0: 2020 6874 5f63 6f6c 6f72 5f63 6f75 6e74    ht_color_count
-00040ad0: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
-00040ae0: 2069 6620 636f 6c6f 7220 6973 206e 6f74   if color is not
-00040af0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00040b00: 2020 2023 2073 616e 6974 6973 6520 636f     # sanitise co
-00040b10: 6c6f 7220 636f 6c75 6d6e 202d 206e 6563  lor column - nec
-00040b20: 6573 7361 7279 2074 6f20 6176 6f69 6420  essary to avoid 
-00040b30: 6772 6579 2070 6965 2063 6861 7274 2073  grey pie chart s
-00040b40: 6567 6d65 6e74 730a 2020 2020 2020 2020  egments.        
-00040b50: 2020 2020 6466 5f68 6170 735b 2270 6172      df_haps["par
-00040b60: 7469 7469 6f6e 225d 203d 2064 665f 6861  tition"] = df_ha
-00040b70: 7073 5b63 6f6c 6f72 5d2e 7374 722e 7265  ps[color].str.re
-00040b80: 706c 6163 6528 7222 5c57 222c 2022 222c  place(r"\W", "",
-00040b90: 2072 6567 6578 3d54 7275 6529 0a0a 2020   regex=True)..  
-00040ba0: 2020 2020 2020 2020 2020 2320 6578 7472            # extr
-00040bb0: 6163 7420 616c 6c20 756e 6971 7565 2076  act all unique v
-00040bc0: 616c 7565 7320 6f66 2074 6865 2063 6f6c  alues of the col
-00040bd0: 6f72 2063 6f6c 756d 6e0a 2020 2020 2020  or column.      
-00040be0: 2020 2020 2020 636f 6c6f 725f 7661 6c75        color_valu
-00040bf0: 6573 203d 2064 665f 6861 7073 5b22 7061  es = df_haps["pa
-00040c00: 7274 6974 696f 6e22 5d2e 756e 6971 7565  rtition"].unique
-00040c10: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-00040c20: 6f6c 6f72 5f76 616c 7565 735f 6d61 7070  olor_values_mapp
-00040c30: 696e 6720 3d20 6469 6374 287a 6970 2864  ing = dict(zip(d
-00040c40: 665f 6861 7073 5b22 7061 7274 6974 696f  f_haps["partitio
-00040c50: 6e22 5d2c 2064 665f 6861 7073 5b63 6f6c  n"], df_haps[col
-00040c60: 6f72 5d29 290a 2020 2020 2020 2020 2020  or])).          
-00040c70: 2020 636f 6c6f 725f 7661 6c75 6573 5f64    color_values_d
-00040c80: 6973 706c 6179 203d 205b 636f 6c6f 725f  isplay = [color_
-00040c90: 7661 6c75 6573 5f6d 6170 7069 6e67 5b63  values_mapping[c
-00040ca0: 5d20 666f 7220 6320 696e 2063 6f6c 6f72  ] for c in color
-00040cb0: 5f76 616c 7565 735d 0a0a 2020 2020 2020  _values]..      
-00040cc0: 2020 2020 2020 2320 636f 756e 7420 636f        # count co
-00040cd0: 6c6f 7220 7661 6c75 6573 2066 6f72 2065  lor values for e
-00040ce0: 6163 6820 6469 7374 696e 6374 2068 6170  ach distinct hap
-00040cf0: 6c6f 7479 7065 0a20 2020 2020 2020 2020  lotype.         
-00040d00: 2020 2068 745f 636f 6c6f 725f 636f 756e     ht_color_coun
-00040d10: 7473 203d 205b 0a20 2020 2020 2020 2020  ts = [.         
-00040d20: 2020 2020 2020 2064 665f 6861 7073 2e69         df_haps.i
-00040d30: 6c6f 635b 6c69 7374 2873 295d 5b22 7061  loc[list(s)]["pa
-00040d40: 7274 6974 696f 6e22 5d2e 7661 6c75 655f  rtition"].value_
-00040d50: 636f 756e 7473 2829 2e74 6f5f 6469 6374  counts().to_dict
-00040d60: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00040d70: 2020 2066 6f72 2073 2069 6e20 6874 5f64     for s in ht_d
-00040d80: 6973 7469 6e63 745f 7365 7473 0a20 2020  istinct_sets.   
-00040d90: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
-00040da0: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
-00040db0: 203d 3d20 2274 6178 6f6e 223a 0a20 2020   == "taxon":.   
-00040dc0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00040dd0: 7065 6369 616c 2063 6173 652c 2073 7461  pecial case, sta
-00040de0: 6e64 6172 6469 7365 2074 6178 6f6e 2063  ndardise taxon c
-00040df0: 6f6c 6f72 7320 616e 6420 6f72 6465 720a  olors and order.
-00040e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040e10: 636f 6c6f 725f 7061 7261 6d73 203d 2073  color_params = s
-00040e20: 656c 662e 5f73 6574 7570 5f74 6178 6f6e  elf._setup_taxon
-00040e30: 5f63 6f6c 6f72 7328 290a 2020 2020 2020  _colors().      
-00040e40: 2020 2020 2020 2020 2020 636f 6c6f 725f            color_
-00040e50: 6469 7363 7265 7465 5f6d 6170 203d 2063  discrete_map = c
-00040e60: 6f6c 6f72 5f70 6172 616d 735b 2263 6f6c  olor_params["col
-00040e70: 6f72 5f64 6973 6372 6574 655f 6d61 7022  or_discrete_map"
-00040e80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00040e90: 2020 636f 6c6f 725f 6469 7363 7265 7465    color_discrete
-00040ea0: 5f6d 6170 5f64 6973 706c 6179 203d 2063  _map_display = c
-00040eb0: 6f6c 6f72 5f64 6973 6372 6574 655f 6d61  olor_discrete_ma
-00040ec0: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00040ed0: 2020 6361 7465 676f 7279 5f6f 7264 6572    category_order
-00040ee0: 7320 3d20 636f 6c6f 725f 7061 7261 6d73  s = color_params
-00040ef0: 5b22 6361 7465 676f 7279 5f6f 7264 6572  ["category_order
-00040f00: 7322 5d0a 0a20 2020 2020 2020 2020 2020  s"]..           
-00040f10: 2065 6c69 6620 636f 6c6f 725f 6469 7363   elif color_disc
-00040f20: 7265 7465 5f6d 6170 2069 7320 4e6f 6e65  rete_map is None
-00040f30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00040f40: 2020 2320 7365 7420 7570 2061 2063 6f6c    # set up a col
-00040f50: 6f72 2070 616c 6574 7465 0a20 2020 2020  or palette.     
-00040f60: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00040f70: 6c6f 725f 6469 7363 7265 7465 5f73 6571  lor_discrete_seq
-00040f80: 7565 6e63 6520 6973 204e 6f6e 653a 0a20  uence is None:. 
-00040f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040fa0: 2020 2069 6620 6c65 6e28 636f 6c6f 725f     if len(color_
-00040fb0: 7661 6c75 6573 2920 3c3d 2031 303a 0a20  values) <= 10:. 
-00040fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040fd0: 2020 2020 2020 2063 6f6c 6f72 5f64 6973         color_dis
-00040fe0: 6372 6574 655f 7365 7175 656e 6365 203d  crete_sequence =
-00040ff0: 2070 782e 636f 6c6f 7273 2e71 7561 6c69   px.colors.quali
-00041000: 7461 7469 7665 2e50 6c6f 746c 790a 2020  tative.Plotly.  
-00041010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041020: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00041030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041040: 636f 6c6f 725f 6469 7363 7265 7465 5f73  color_discrete_s
-00041050: 6571 7565 6e63 6520 3d20 7078 2e63 6f6c  equence = px.col
-00041060: 6f72 732e 7175 616c 6974 6174 6976 652e  ors.qualitative.
-00041070: 416c 7068 6162 6574 0a0a 2020 2020 2020  Alphabet..      
-00041080: 2020 2020 2020 2020 2020 2320 6d61 7020            # map 
-00041090: 7661 6c75 6573 2074 6f20 636f 6c6f 7273  values to colors
-000410a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000410b0: 2063 6f6c 6f72 5f64 6973 6372 6574 655f   color_discrete_
-000410c0: 6d61 7020 3d20 7b0a 2020 2020 2020 2020  map = {.        
-000410d0: 2020 2020 2020 2020 2020 2020 763a 2063              v: c
-000410e0: 2066 6f72 2076 2c20 6320 696e 207a 6970   for v, c in zip
-000410f0: 2863 6f6c 6f72 5f76 616c 7565 732c 2063  (color_values, c
-00041100: 7963 6c65 2863 6f6c 6f72 5f64 6973 6372  ycle(color_discr
-00041110: 6574 655f 7365 7175 656e 6365 2929 0a20  ete_sequence)). 
-00041120: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00041130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041140: 2063 6f6c 6f72 5f64 6973 6372 6574 655f   color_discrete_
-00041150: 6d61 705f 6469 7370 6c61 7920 3d20 7b0a  map_display = {.
-00041160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041170: 2020 2020 763a 2063 0a20 2020 2020 2020      v: c.       
-00041180: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00041190: 2076 2c20 6320 696e 207a 6970 280a 2020   v, c in zip(.  
-000411a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000411b0: 2020 2020 2020 636f 6c6f 725f 7661 6c75        color_valu
-000411c0: 6573 5f64 6973 706c 6179 2c20 6379 636c  es_display, cycl
-000411d0: 6528 636f 6c6f 725f 6469 7363 7265 7465  e(color_discrete
-000411e0: 5f73 6571 7565 6e63 6529 0a20 2020 2020  _sequence).     
-000411f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00041200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041210: 207d 0a0a 2020 2020 2020 2020 6465 6275   }..        debu
-00041220: 6728 2263 6f6e 7374 7275 6374 2067 7261  g("construct gra
-00041230: 7068 2229 0a20 2020 2020 2020 2061 6e6f  ph").        ano
-00041240: 6e5f 7769 6474 6820 3d20 6e70 2e73 7172  n_width = np.sqr
-00041250: 7428 302e 3320 2a20 6e6f 6465 5f73 697a  t(0.3 * node_siz
-00041260: 655f 6661 6374 6f72 290a 2020 2020 2020  e_factor).      
-00041270: 2020 6772 6170 685f 6e6f 6465 732c 2067    graph_nodes, g
-00041280: 7261 7068 5f65 6467 6573 203d 206d 6a6e  raph_edges = mjn
-00041290: 5f67 7261 7068 280a 2020 2020 2020 2020  _graph(.        
-000412a0: 2020 2020 6874 5f64 6973 7469 6e63 743d      ht_distinct=
-000412b0: 6874 5f64 6973 7469 6e63 742c 0a20 2020  ht_distinct,.   
-000412c0: 2020 2020 2020 2020 2068 745f 6469 7374           ht_dist
-000412d0: 696e 6374 5f6d 6a6e 3d68 745f 6469 7374  inct_mjn=ht_dist
-000412e0: 696e 6374 5f6d 6a6e 2c0a 2020 2020 2020  inct_mjn,.      
-000412f0: 2020 2020 2020 6874 5f63 6f75 6e74 733d        ht_counts=
-00041300: 6874 5f63 6f75 6e74 732c 0a20 2020 2020  ht_counts,.     
-00041310: 2020 2020 2020 2068 745f 636f 6c6f 725f         ht_color_
-00041320: 636f 756e 7473 3d68 745f 636f 6c6f 725f  counts=ht_color_
-00041330: 636f 756e 7473 2c0a 2020 2020 2020 2020  counts,.        
-00041340: 2020 2020 636f 6c6f 723d 636f 6c6f 722c      color=color,
-00041350: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00041360: 6f72 5f76 616c 7565 733d 636f 6c6f 725f  or_values=color_
-00041370: 7661 6c75 6573 2c0a 2020 2020 2020 2020  values,.        
-00041380: 2020 2020 6564 6765 733d 6564 6765 732c      edges=edges,
-00041390: 0a20 2020 2020 2020 2020 2020 2061 6c74  .            alt
-000413a0: 5f65 6467 6573 3d61 6c74 5f65 6467 6573  _edges=alt_edges
-000413b0: 2c0a 2020 2020 2020 2020 2020 2020 6e6f  ,.            no
-000413c0: 6465 5f73 697a 655f 6661 6374 6f72 3d6e  de_size_factor=n
-000413d0: 6f64 655f 7369 7a65 5f66 6163 746f 722c  ode_size_factor,
-000413e0: 0a20 2020 2020 2020 2020 2020 2061 6e6f  .            ano
-000413f0: 6e5f 7769 6474 683d 616e 6f6e 5f77 6964  n_width=anon_wid
-00041400: 7468 2c0a 2020 2020 2020 2020 290a 0a20  th,.        ).. 
-00041410: 2020 2020 2020 2064 6562 7567 2822 7072         debug("pr
-00041420: 6570 6172 6520 6772 6170 6820 6461 7461  epare graph data
-00041430: 2066 6f72 2063 7974 6f73 6361 7065 2229   for cytoscape")
-00041440: 0a20 2020 2020 2020 2065 6c65 6d65 6e74  .        element
-00041450: 7320 3d20 5b7b 2264 6174 6122 3a20 6e7d  s = [{"data": n}
-00041460: 2066 6f72 206e 2069 6e20 6772 6170 685f   for n in graph_
-00041470: 6e6f 6465 735d 202b 205b 0a20 2020 2020  nodes] + [.     
-00041480: 2020 2020 2020 207b 2264 6174 6122 3a20         {"data": 
-00041490: 657d 2066 6f72 2065 2069 6e20 6772 6170  e} for e in grap
-000414a0: 685f 6564 6765 730a 2020 2020 2020 2020  h_edges.        
-000414b0: 5d0a 0a20 2020 2020 2020 2064 6562 7567  ]..        debug
-000414c0: 2822 6465 6669 6e65 206e 6f64 6520 7374  ("define node st
-000414d0: 796c 6522 290a 2020 2020 2020 2020 6e6f  yle").        no
-000414e0: 6465 5f73 7479 6c65 203d 207b 0a20 2020  de_style = {.   
-000414f0: 2020 2020 2020 2020 2022 7769 6474 6822           "width"
-00041500: 3a20 2264 6174 6128 7769 6474 6829 222c  : "data(width)",
-00041510: 0a20 2020 2020 2020 2020 2020 2022 6865  .            "he
-00041520: 6967 6874 223a 2022 6461 7461 2877 6964  ight": "data(wid
-00041530: 7468 2922 2c0a 2020 2020 2020 2020 2020  th)",.          
-00041540: 2020 2270 6965 2d73 697a 6522 3a20 2231    "pie-size": "1
-00041550: 3030 2522 2c0a 2020 2020 2020 2020 7d0a  00%",.        }.
-00041560: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
-00041570: 2061 6e64 2063 6f6c 6f72 5f64 6973 6372   and color_discr
-00041580: 6574 655f 6d61 7020 6973 206e 6f74 204e  ete_map is not N
-00041590: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000415a0: 2023 2068 6572 6520 6172 6520 7468 6520   # here are the 
-000415b0: 7374 796c 6573 2077 6869 6368 2063 6f6e  styles which con
-000415c0: 7472 6f6c 2074 6865 2064 6973 706c 6179  trol the display
-000415d0: 206f 6620 6e6f 6465 7320 6173 2070 6965   of nodes as pie
-000415e0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-000415f0: 6861 7274 730a 2020 2020 2020 2020 2020  harts.          
-00041600: 2020 666f 7220 692c 2028 762c 2063 2920    for i, (v, c) 
-00041610: 696e 2065 6e75 6d65 7261 7465 2863 6f6c  in enumerate(col
-00041620: 6f72 5f64 6973 6372 6574 655f 6d61 702e  or_discrete_map.
-00041630: 6974 656d 7328 2929 3a0a 2020 2020 2020  items()):.      
-00041640: 2020 2020 2020 2020 2020 6e6f 6465 5f73            node_s
-00041650: 7479 6c65 5b66 2270 6965 2d7b 6920 2b20  tyle[f"pie-{i + 
-00041660: 317d 2d62 6163 6b67 726f 756e 642d 636f  1}-background-co
-00041670: 6c6f 7222 5d20 3d20 630a 2020 2020 2020  lor"] = c.      
-00041680: 2020 2020 2020 2020 2020 6e6f 6465 5f73            node_s
-00041690: 7479 6c65 5b0a 2020 2020 2020 2020 2020  tyle[.          
-000416a0: 2020 2020 2020 2020 2020 6622 7069 652d            f"pie-
-000416b0: 7b69 202b 2031 7d2d 6261 636b 6772 6f75  {i + 1}-backgrou
-000416c0: 6e64 2d73 697a 6522 0a20 2020 2020 2020  nd-size".       
-000416d0: 2020 2020 2020 2020 205d 203d 2066 226d           ] = f"m
-000416e0: 6170 4461 7461 287b 767d 2c20 302c 2031  apData({v}, 0, 1
-000416f0: 3030 2c20 302c 2031 3030 2922 0a20 2020  00, 0, 100)".   
-00041700: 2020 2020 206e 6f64 655f 7374 796c 6573       node_styles
-00041710: 6865 6574 203d 207b 0a20 2020 2020 2020  heet = {.       
-00041720: 2020 2020 2022 7365 6c65 6374 6f72 223a       "selector":
-00041730: 2022 6e6f 6465 222c 0a20 2020 2020 2020   "node",.       
-00041740: 2020 2020 2022 7374 796c 6522 3a20 6e6f       "style": no
-00041750: 6465 5f73 7479 6c65 2c0a 2020 2020 2020  de_style,.      
-00041760: 2020 7d0a 2020 2020 2020 2020 6465 6275    }.        debu
-00041770: 6728 6e6f 6465 5f73 7479 6c65 7368 6565  g(node_styleshee
-00041780: 7429 0a0a 2020 2020 2020 2020 6465 6275  t)..        debu
-00041790: 6728 2264 6566 696e 6520 6564 6765 2073  g("define edge s
-000417a0: 7479 6c65 2229 0a20 2020 2020 2020 2065  tyle").        e
-000417b0: 6467 655f 7374 796c 6573 6865 6574 203d  dge_stylesheet =
-000417c0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-000417d0: 7365 6c65 6374 6f72 223a 2022 6564 6765  selector": "edge
-000417e0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-000417f0: 7374 796c 6522 3a20 7b22 6375 7276 652d  style": {"curve-
-00041800: 7374 796c 6522 3a20 2262 657a 6965 7222  style": "bezier"
-00041810: 2c20 2277 6964 7468 223a 2032 2c20 226f  , "width": 2, "o
-00041820: 7061 6369 7479 223a 2030 2e35 7d2c 0a20  pacity": 0.5},. 
-00041830: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-00041840: 2020 6465 6275 6728 2264 6566 696e 6520    debug("define 
-00041850: 7374 796c 6520 666f 7220 7365 6c65 6374  style for select
-00041860: 6564 206e 6f64 6522 290a 2020 2020 2020  ed node").      
-00041870: 2020 7365 6c65 6374 6564 5f73 7479 6c65    selected_style
-00041880: 7368 6565 7420 3d20 7b0a 2020 2020 2020  sheet = {.      
-00041890: 2020 2020 2020 2273 656c 6563 746f 7222        "selector"
-000418a0: 3a20 223a 7365 6c65 6374 6564 222c 0a20  : ":selected",. 
-000418b0: 2020 2020 2020 2020 2020 2022 7374 796c             "styl
-000418c0: 6522 3a20 7b0a 2020 2020 2020 2020 2020  e": {.          
-000418d0: 2020 2020 2020 2262 6f72 6465 722d 7769        "border-wi
-000418e0: 6474 6822 3a20 2233 7078 222c 0a20 2020  dth": "3px",.   
-000418f0: 2020 2020 2020 2020 2020 2020 2022 626f               "bo
-00041900: 7264 6572 2d73 7479 6c65 223a 2022 736f  rder-style": "so
-00041910: 6c69 6422 2c0a 2020 2020 2020 2020 2020  lid",.          
-00041920: 2020 2020 2020 2262 6f72 6465 722d 636f        "border-co
-00041930: 6c6f 7222 3a20 2262 6c61 636b 222c 0a20  lor": "black",. 
-00041940: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
-00041950: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00041960: 2064 6562 7567 2822 6372 6561 7465 2066   debug("create f
-00041970: 6967 7572 6520 6c65 6765 6e64 2229 0a20  igure legend"). 
-00041980: 2020 2020 2020 2069 6620 636f 6c6f 7220         if color 
-00041990: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000419a0: 2020 2020 2020 2020 206c 6567 656e 645f           legend_
-000419b0: 6669 6720 3d20 706c 6f74 6c79 5f64 6973  fig = plotly_dis
-000419c0: 6372 6574 655f 6c65 6765 6e64 280a 2020  crete_legend(.  
-000419d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000419e0: 6c6f 723d 636f 6c6f 722c 0a20 2020 2020  lor=color,.     
-000419f0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
-00041a00: 5f76 616c 7565 733d 636f 6c6f 725f 7661  _values=color_va
-00041a10: 6c75 6573 5f64 6973 706c 6179 2c0a 2020  lues_display,.  
-00041a20: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00041a30: 6c6f 725f 6469 7363 7265 7465 5f6d 6170  lor_discrete_map
-00041a40: 3d63 6f6c 6f72 5f64 6973 6372 6574 655f  =color_discrete_
-00041a50: 6d61 705f 6469 7370 6c61 792c 0a20 2020  map_display,.   
-00041a60: 2020 2020 2020 2020 2020 2020 2063 6174               cat
-00041a70: 6567 6f72 795f 6f72 6465 7273 3d63 6174  egory_orders=cat
-00041a80: 6567 6f72 795f 6f72 6465 7273 2c0a 2020  egory_orders,.  
-00041a90: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00041aa0: 2020 2020 2020 2020 6c65 6765 6e64 5f63          legend_c
-00041ab0: 6f6d 706f 6e65 6e74 203d 2064 6363 2e47  omponent = dcc.G
-00041ac0: 7261 7068 280a 2020 2020 2020 2020 2020  raph(.          
-00041ad0: 2020 2020 2020 6964 3d22 6c65 6765 6e64        id="legend
-00041ae0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00041af0: 2020 2066 6967 7572 653d 6c65 6765 6e64     figure=legend
-00041b00: 5f66 6967 2c0a 2020 2020 2020 2020 2020  _fig,.          
-00041b10: 2020 2020 2020 636f 6e66 6967 3d64 6963        config=dic
-00041b20: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00041b30: 2020 2020 2020 2064 6973 706c 6179 4d6f         displayMo
-00041b40: 6465 4261 723d 4661 6c73 652c 0a20 2020  deBar=False,.   
-00041b50: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00041b60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00041b70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00041b80: 2020 2020 2020 2020 6c65 6765 6e64 5f63          legend_c
-00041b90: 6f6d 706f 6e65 6e74 203d 2068 746d 6c2e  omponent = html.
-00041ba0: 4469 7628 290a 0a20 2020 2020 2020 2064  Div()..        d
-00041bb0: 6562 7567 2822 6465 6669 6e65 2063 7974  ebug("define cyt
-00041bc0: 6f73 6361 7065 2063 6f6d 706f 6e65 6e74  oscape component
-00041bd0: 2229 0a20 2020 2020 2020 2069 6620 6c61  ").        if la
-00041be0: 796f 7574 5f70 6172 616d 7320 6973 204e  yout_params is N
-00041bf0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00041c00: 2067 7261 7068 5f6c 6179 6f75 745f 7061   graph_layout_pa
-00041c10: 7261 6d73 203d 2064 6963 7428 290a 2020  rams = dict().  
-00041c20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00041c30: 2020 2020 2020 2020 6772 6170 685f 6c61          graph_la
-00041c40: 796f 7574 5f70 6172 616d 7320 3d20 6469  yout_params = di
-00041c50: 6374 282a 2a6c 6179 6f75 745f 7061 7261  ct(**layout_para
-00041c60: 6d73 290a 2020 2020 2020 2020 6772 6170  ms).        grap
-00041c70: 685f 6c61 796f 7574 5f70 6172 616d 735b  h_layout_params[
-00041c80: 226e 616d 6522 5d20 3d20 6c61 796f 7574  "name"] = layout
-00041c90: 0a20 2020 2020 2020 2067 7261 7068 5f6c  .        graph_l
-00041ca0: 6179 6f75 745f 7061 7261 6d73 2e73 6574  ayout_params.set
-00041cb0: 6465 6661 756c 7428 2270 6164 6469 6e67  default("padding
-00041cc0: 222c 2031 3029 0a20 2020 2020 2020 2067  ", 10).        g
-00041cd0: 7261 7068 5f6c 6179 6f75 745f 7061 7261  raph_layout_para
-00041ce0: 6d73 2e73 6574 6465 6661 756c 7428 2261  ms.setdefault("a
-00041cf0: 6e69 6d61 7465 222c 2046 616c 7365 290a  nimate", False).
-00041d00: 0a20 2020 2020 2020 2063 7974 6f73 6361  .        cytosca
-00041d10: 7065 5f63 6f6d 706f 6e65 6e74 203d 2063  pe_component = c
-00041d20: 7974 6f2e 4379 746f 7363 6170 6528 0a20  yto.Cytoscape(. 
-00041d30: 2020 2020 2020 2020 2020 2069 643d 2263             id="c
-00041d40: 7974 6f73 6361 7065 222c 0a20 2020 2020  ytoscape",.     
-00041d50: 2020 2020 2020 2065 6c65 6d65 6e74 733d         elements=
-00041d60: 656c 656d 656e 7473 2c0a 2020 2020 2020  elements,.      
-00041d70: 2020 2020 2020 6c61 796f 7574 3d67 7261        layout=gra
-00041d80: 7068 5f6c 6179 6f75 745f 7061 7261 6d73  ph_layout_params
-00041d90: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
-00041da0: 796c 6573 6865 6574 3d5b 0a20 2020 2020  ylesheet=[.     
-00041db0: 2020 2020 2020 2020 2020 206e 6f64 655f             node_
-00041dc0: 7374 796c 6573 6865 6574 2c0a 2020 2020  stylesheet,.    
-00041dd0: 2020 2020 2020 2020 2020 2020 6564 6765              edge
-00041de0: 5f73 7479 6c65 7368 6565 742c 0a20 2020  _stylesheet,.   
-00041df0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00041e00: 6563 7465 645f 7374 796c 6573 6865 6574  ected_stylesheet
-00041e10: 2c0a 2020 2020 2020 2020 2020 2020 5d2c  ,.            ],
-00041e20: 0a20 2020 2020 2020 2020 2020 2073 7479  .            sty
-00041e30: 6c65 3d7b 0a20 2020 2020 2020 2020 2020  le={.           
-00041e40: 2020 2020 2023 2077 6964 7468 2061 6e64       # width and
-00041e50: 2068 6569 6768 7420 6e65 6564 6564 2074   height needed t
-00041e60: 6f20 6765 7420 6379 746f 7363 6170 6520  o get cytoscape 
-00041e70: 636f 6d70 6f6e 656e 7420 746f 2064 6973  component to dis
-00041e80: 706c 6179 0a20 2020 2020 2020 2020 2020  play.           
-00041e90: 2020 2020 2022 7769 6474 6822 3a20 2231       "width": "1
-00041ea0: 3030 2522 2c0a 2020 2020 2020 2020 2020  00%",.          
-00041eb0: 2020 2020 2020 2268 6569 6768 7422 3a20        "height": 
-00041ec0: 2231 3030 2522 2c0a 2020 2020 2020 2020  "100%",.        
-00041ed0: 2020 2020 2020 2020 2262 6163 6b67 726f          "backgro
-00041ee0: 756e 642d 636f 6c6f 7222 3a20 2277 6869  und-color": "whi
-00041ef0: 7465 222c 0a20 2020 2020 2020 2020 2020  te",.           
-00041f00: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00041f10: 2320 656e 6162 6c65 2073 656c 6563 7469  # enable selecti
-00041f20: 6e67 206d 756c 7469 706c 6520 6e6f 6465  ng multiple node
-00041f30: 7320 7769 7468 2073 6869 6674 2063 6c69  s with shift cli
-00041f40: 636b 2061 6e64 2064 7261 670a 2020 2020  ck and drag.    
-00041f50: 2020 2020 2020 2020 626f 7853 656c 6563          boxSelec
-00041f60: 7469 6f6e 456e 6162 6c65 643d 5472 7565  tionEnabled=True
-00041f70: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
-00041f80: 7072 6576 656e 7420 6163 6369 6465 6e74  prevent accident
-00041f90: 616c 6c79 207a 6f6f 6d69 6e67 206f 7574  ally zooming out
-00041fa0: 2074 6f20 6f62 6c69 7669 6f6e 0a20 2020   to oblivion.   
-00041fb0: 2020 2020 2020 2020 206d 696e 5a6f 6f6d           minZoom
-00041fc0: 3d30 2e31 2c0a 2020 2020 2020 2020 290a  =0.1,.        ).
-00041fd0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
-00041fe0: 6372 6561 7465 2064 6173 6820 6170 7022  create dash app"
-00041ff0: 290a 2020 2020 2020 2020 6170 7020 3d20  ).        app = 
-00042000: 4a75 7079 7465 7244 6173 6828 0a20 2020  JupyterDash(.   
-00042010: 2020 2020 2020 2020 2022 6461 7368 2d63           "dash-c
-00042020: 7974 6f73 6361 7065 2d6e 6574 776f 726b  ytoscape-network
-00042030: 222c 0a20 2020 2020 2020 2020 2020 2023  ",.            #
-00042040: 2074 6869 7320 7374 796c 6573 6865 6574   this stylesheet
-00042050: 2069 7320 7573 6564 2074 6f20 7072 6f76   is used to prov
-00042060: 6964 6520 7375 7070 6f72 7420 666f 7220  ide support for 
-00042070: 6120 726f 7773 2061 6e64 2063 6f6c 756d  a rows and colum
-00042080: 6e73 0a20 2020 2020 2020 2020 2020 2023  ns.            #
-00042090: 206c 6179 6f75 7420 6f66 2074 6865 2063   layout of the c
-000420a0: 6f6d 706f 6e65 6e74 730a 2020 2020 2020  omponents.      
-000420b0: 2020 2020 2020 6578 7465 726e 616c 5f73        external_s
-000420c0: 7479 6c65 7368 6565 7473 3d5b 2268 7474  tylesheets=["htt
-000420d0: 7073 3a2f 2f63 6f64 6570 656e 2e69 6f2f  ps://codepen.io/
-000420e0: 6368 7269 6464 7970 2f70 656e 2f62 574c  chriddyp/pen/bWL
-000420f0: 7767 502e 6373 7322 5d2c 0a20 2020 2020  wgP.css"],.     
-00042100: 2020 2029 0a20 2020 2020 2020 2023 2074     ).        # t
-00042110: 6869 7320 6973 2061 6e20 6f70 7469 6d69  his is an optimi
-00042120: 7361 7469 6f6e 2c20 6974 2773 2067 656e  sation, it's gen
-00042130: 6572 616c 6c79 2066 6173 7465 7220 746f  erally faster to
-00042140: 2073 6572 7665 2073 6372 6970 7420 6669   serve script fi
-00042150: 6c65 7320 6672 6f6d 2043 444e 0a20 2020  les from CDN.   
-00042160: 2020 2020 2061 7070 2e73 6372 6970 7473       app.scripts
-00042170: 2e63 6f6e 6669 672e 7365 7276 655f 6c6f  .config.serve_lo
-00042180: 6361 6c6c 7920 3d20 4661 6c73 650a 2020  cally = False.  
-00042190: 2020 2020 2020 6170 702e 6c61 796f 7574        app.layout
-000421a0: 203d 2068 746d 6c2e 4469 7628 0a20 2020   = html.Div(.   
-000421b0: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-000421c0: 2020 2020 2020 2020 2020 2068 746d 6c2e             html.
-000421d0: 4469 7628 0a20 2020 2020 2020 2020 2020  Div(.           
-000421e0: 2020 2020 2020 2020 2063 7974 6f73 6361           cytosca
-000421f0: 7065 5f63 6f6d 706f 6e65 6e74 2c0a 2020  pe_component,.  
-00042200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042210: 2020 636c 6173 734e 616d 653d 226e 696e    className="nin
-00042220: 6520 636f 6c75 6d6e 7322 2c0a 2020 2020  e columns",.    
-00042230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042240: 7374 796c 653d 7b0a 2020 2020 2020 2020  style={.        
-00042250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042260: 2320 7265 7175 6972 6564 2074 6f20 6765  # required to ge
-00042270: 7420 6379 746f 7363 6170 6520 636f 6d70  t cytoscape comp
-00042280: 6f6e 656e 7420 746f 2073 686f 7720 2e2e  onent to show ..
-00042290: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000422a0: 2020 2020 2020 2020 2020 2320 6d75 6c74            # mult
-000422b0: 6970 6c79 2062 7920 6661 6374 6f72 203c  iply by factor <
-000422c0: 3120 746f 2070 7265 7665 6e74 2073 6372  1 to prevent scr
-000422d0: 6f6c 6c20 6f76 6572 666c 6f77 0a20 2020  oll overflow.   
-000422e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000422f0: 2020 2020 2022 6865 6967 6874 223a 2066       "height": f
-00042300: 227b 6865 6967 6874 202a 202e 3933 7d70  "{height * .93}p
-00042310: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
-00042320: 2020 2020 2020 2020 2020 2020 2262 6f72              "bor
-00042330: 6465 7222 3a20 2231 7078 2073 6f6c 6964  der": "1px solid
-00042340: 2062 6c61 636b 222c 0a20 2020 2020 2020   black",.       
-00042350: 2020 2020 2020 2020 2020 2020 207d 2c0a               },.
-00042360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042370: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00042380: 2020 2068 746d 6c2e 4469 7628 0a20 2020     html.Div(.   
-00042390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000423a0: 206c 6567 656e 645f 636f 6d70 6f6e 656e   legend_componen
-000423b0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-000423c0: 2020 2020 2020 2063 6c61 7373 4e61 6d65         className
-000423d0: 3d22 7468 7265 6520 636f 6c75 6d6e 7322  ="three columns"
-000423e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000423f0: 2020 2020 2020 7374 796c 653d 7b0a 2020        style={.  
-00042400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042410: 2020 2020 2020 2268 6569 6768 7422 3a20        "height": 
-00042420: 6622 7b68 6569 6768 7420 2a20 2e39 337d  f"{height * .93}
-00042430: 7078 222c 0a20 2020 2020 2020 2020 2020  px",.           
-00042440: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
-00042450: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-00042460: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00042470: 746d 6c2e 4469 7628 6964 3d22 6f75 7470  tml.Div(id="outp
-00042480: 7574 2229 2c0a 2020 2020 2020 2020 2020  ut"),.          
-00042490: 2020 5d2c 0a20 2020 2020 2020 2029 0a0a    ],.        )..
-000424a0: 2020 2020 2020 2020 6465 6275 6728 0a20          debug(. 
-000424b0: 2020 2020 2020 2020 2020 2022 6465 6669             "defi
-000424c0: 6e65 2061 2063 616c 6c62 6163 6b20 6675  ne a callback fu
-000424d0: 6e63 7469 6f6e 2074 6f20 6469 7370 6c61  nction to displa
-000424e0: 7920 696e 666f 726d 6174 696f 6e20 6162  y information ab
-000424f0: 6f75 7420 7468 6520 7365 6c65 6374 6564  out the selected
-00042500: 206e 6f64 6522 0a20 2020 2020 2020 2029   node".        )
-00042510: 0a0a 2020 2020 2020 2020 4061 7070 2e63  ..        @app.c
-00042520: 616c 6c62 6163 6b28 4f75 7470 7574 2822  allback(Output("
-00042530: 6f75 7470 7574 222c 2022 6368 696c 6472  output", "childr
-00042540: 656e 2229 2c20 496e 7075 7428 2263 7974  en"), Input("cyt
-00042550: 6f73 6361 7065 222c 2022 7461 704e 6f64  oscape", "tapNod
-00042560: 6544 6174 6122 2929 0a20 2020 2020 2020  eData")).       
-00042570: 2064 6566 2064 6973 706c 6179 5f74 6170   def display_tap
-00042580: 5f6e 6f64 655f 6461 7461 2864 6174 6129  _node_data(data)
-00042590: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000425a0: 2064 6174 6120 6973 204e 6f6e 653a 0a20   data is None:. 
-000425b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000425c0: 6574 7572 6e20 2243 6c69 636b 206f 7220  eturn "Click or 
-000425d0: 7461 7020 6120 6e6f 6465 2066 6f72 206d  tap a node for m
-000425e0: 6f72 6520 696e 666f 726d 6174 696f 6e2e  ore information.
-000425f0: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
-00042600: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00042610: 2020 2020 6e20 3d20 6461 7461 5b22 636f      n = data["co
-00042620: 756e 7422 5d0a 2020 2020 2020 2020 2020  unt"].          
-00042630: 2020 2020 2020 7465 7874 203d 2066 224e        text = f"N
-00042640: 6f2e 2068 6170 6c6f 7479 7065 733a 207b  o. haplotypes: {
-00042650: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
-00042660: 2020 2020 7365 6c65 6374 6564 5f63 6f6c      selected_col
-00042670: 6f72 5f64 6174 6120 3d20 7b0a 2020 2020  or_data = {.    
-00042680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042690: 636f 6c6f 725f 765f 6469 7370 6c61 793a  color_v_display:
-000426a0: 2069 6e74 2864 6174 612e 6765 7428 636f   int(data.get(co
-000426b0: 6c6f 725f 762c 2030 2920 2a20 6e20 2f20  lor_v, 0) * n / 
-000426c0: 3130 3029 0a20 2020 2020 2020 2020 2020  100).           
-000426d0: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
-000426e0: 6f72 5f76 2c20 636f 6c6f 725f 765f 6469  or_v, color_v_di
-000426f0: 7370 6c61 7920 696e 207a 6970 280a 2020  splay in zip(.  
-00042700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042710: 2020 2020 2020 636f 6c6f 725f 7661 6c75        color_valu
-00042720: 6573 2c20 636f 6c6f 725f 7661 6c75 6573  es, color_values
-00042730: 5f64 6973 706c 6179 0a20 2020 2020 2020  _display.       
-00042740: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00042750: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00042760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042770: 2073 656c 6563 7465 645f 636f 6c6f 725f   selected_color_
-00042780: 6461 7461 203d 2073 6f72 7465 6428 0a20  data = sorted(. 
-00042790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000427a0: 2020 2073 656c 6563 7465 645f 636f 6c6f     selected_colo
-000427b0: 725f 6461 7461 2e69 7465 6d73 2829 2c20  r_data.items(), 
-000427c0: 6b65 793d 6c61 6d62 6461 2069 7465 6d3a  key=lambda item:
-000427d0: 2069 7465 6d5b 315d 2c20 7265 7665 7273   item[1], revers
-000427e0: 653d 5472 7565 0a20 2020 2020 2020 2020  e=True.         
-000427f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00042800: 2020 2020 2020 2020 2063 6f6c 6f72 5f74           color_t
-00042810: 6578 7473 203d 205b 0a20 2020 2020 2020  exts = [.       
-00042820: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-00042830: 636f 6c6f 725f 767d 3a20 7b63 6f6c 6f72  color_v}: {color
-00042840: 5f6e 7d22 0a20 2020 2020 2020 2020 2020  _n}".           
-00042850: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
-00042860: 6f72 5f76 2c20 636f 6c6f 725f 6e20 696e  or_v, color_n in
-00042870: 2073 656c 6563 7465 645f 636f 6c6f 725f   selected_color_
-00042880: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
-00042890: 2020 2020 2020 2020 2069 6620 636f 6c6f           if colo
-000428a0: 725f 6e20 3e20 300a 2020 2020 2020 2020  r_n > 0.        
-000428b0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-000428c0: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-000428d0: 6f72 5f74 6578 7473 3a0a 2020 2020 2020  or_texts:.      
-000428e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000428f0: 6c6f 725f 7465 7874 7320 3d20 223b 2022  lor_texts = "; "
-00042900: 2e6a 6f69 6e28 636f 6c6f 725f 7465 7874  .join(color_text
-00042910: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00042920: 2020 2020 2020 2074 6578 7420 2b3d 2066         text += f
-00042930: 2220 287b 636f 6c6f 725f 7465 7874 737d  " ({color_texts}
-00042940: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
-00042950: 2020 2072 6574 7572 6e20 7465 7874 0a0a     return text..
-00042960: 2020 2020 2020 2020 6465 6275 6728 2273          debug("s
-00042970: 6574 2075 7020 7275 6e20 7061 7261 6d65  et up run parame
-00042980: 7465 7273 2229 0a20 2020 2020 2020 2023  ters").        #
-00042990: 2077 6f72 6b61 726f 756e 6420 7765 6972   workaround weir
-000429a0: 6420 6d79 7079 2062 7567 2068 6572 650a  d mypy bug here.
-000429b0: 2020 2020 2020 2020 7275 6e5f 7061 7261          run_para
-000429c0: 6d73 3a20 4469 6374 5b73 7472 2c20 416e  ms: Dict[str, An
-000429d0: 795d 203d 2064 6963 7428 290a 2020 2020  y] = dict().    
-000429e0: 2020 2020 6966 2068 6569 6768 7420 6973      if height is
-000429f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00042a00: 2020 2020 2020 2072 756e 5f70 6172 616d         run_param
-00042a10: 735b 2268 6569 6768 7422 5d20 3d20 6865  s["height"] = he
-00042a20: 6967 6874 0a20 2020 2020 2020 2069 6620  ight.        if 
-00042a30: 7769 6474 6820 6973 206e 6f74 204e 6f6e  width is not Non
-00042a40: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00042a50: 756e 5f70 6172 616d 735b 2277 6964 7468  un_params["width
-00042a60: 225d 203d 2077 6964 7468 0a20 2020 2020  "] = width.     
-00042a70: 2020 2069 6620 7365 7276 6572 5f70 6f72     if server_por
-00042a80: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-00042a90: 2020 2020 2020 2020 2020 2072 756e 5f70             run_p
-00042aa0: 6172 616d 735b 2270 6f72 7422 5d20 3d20  arams["port"] = 
-00042ab0: 7365 7276 6572 5f70 6f72 740a 2020 2020  server_port.    
-00042ac0: 2020 2020 6966 2073 6572 7665 725f 6d6f      if server_mo
-00042ad0: 6465 2069 7320 6e6f 7420 4e6f 6e65 3a0a  de is not None:.
-00042ae0: 2020 2020 2020 2020 2020 2020 7275 6e5f              run_
-00042af0: 7061 7261 6d73 5b22 6d6f 6465 225d 203d  params["mode"] =
-00042b00: 2073 6572 7665 725f 6d6f 6465 0a0a 2020   server_mode..  
-00042b10: 2020 2020 2020 6465 6275 6728 226c 6175        debug("lau
-00042b20: 6e63 6820 7468 6520 6461 7368 2061 7070  nch the dash app
-00042b30: 2229 0a20 2020 2020 2020 2023 2054 4f44  ").        # TOD
-00042b40: 4f20 4920 646f 6e27 7420 7468 696e 6b20  O I don't think 
-00042b50: 7468 6973 2061 6374 7561 6c6c 7920 7265  this actually re
-00042b60: 7475 726e 7320 616e 7974 6869 6e67 0a20  turns anything. 
-00042b70: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
-00042b80: 702e 7275 6e5f 7365 7276 6572 282a 2a72  p.run_server(**r
-00042b90: 756e 5f70 6172 616d 7329 0a0a 0a64 6566  un_params)...def
-00042ba0: 205f 6861 6d6d 696e 675f 746f 5f73 6e70   _hamming_to_snp
-00042bb0: 7328 6829 3a0a 2020 2020 2222 220a 2020  s(h):.    """.  
-00042bc0: 2020 436c 7573 7465 7220 6861 706c 6f74    Cluster haplot
-00042bd0: 7970 6520 6172 7261 7920 616e 6420 7265  ype array and re
-00042be0: 7475 726e 2074 6865 206e 756d 6265 7220  turn the number 
-00042bf0: 6f66 2053 4e50 2064 6966 6665 7265 6e63  of SNP differenc
-00042c00: 6573 0a20 2020 2022 2222 0a20 2020 2066  es.    """.    f
-00042c10: 726f 6d20 7363 6970 792e 7370 6174 6961  rom scipy.spatia
-00042c20: 6c2e 6469 7374 616e 6365 2069 6d70 6f72  l.distance impor
-00042c30: 7420 7064 6973 740a 0a20 2020 2064 6973  t pdist..    dis
-00042c40: 7420 3d20 7064 6973 7428 682c 206d 6574  t = pdist(h, met
-00042c50: 7269 633d 2268 616d 6d69 6e67 2229 0a20  ric="hamming"). 
-00042c60: 2020 2064 6973 7420 2a3d 2068 2e73 6861     dist *= h.sha
-00042c70: 7065 5b31 5d0a 2020 2020 7265 7475 726e  pe[1].    return
-00042c80: 2064 6973 740a 0a0a 6465 6620 5f67 6574   dist...def _get
-00042c90: 5f6d 6178 5f68 616d 6d69 6e67 5f64 6973  _max_hamming_dis
-00042ca0: 7461 6e63 6528 682c 206d 6574 7269 633d  tance(h, metric=
-00042cb0: 2268 616d 6d69 6e67 222c 206c 696e 6b61  "hamming", linka
-00042cc0: 6765 5f6d 6574 686f 643d 2273 696e 676c  ge_method="singl
-00042cd0: 6522 293a 0a20 2020 2022 2222 0a20 2020  e"):.    """.   
-00042ce0: 2046 696e 6420 7468 6520 6d61 7869 6d75   Find the maximu
-00042cf0: 6d20 6861 6d6d 696e 6720 6469 7374 616e  m hamming distan
-00042d00: 6365 2062 6574 7765 656e 2068 6170 6c6f  ce between haplo
-00042d10: 7479 7065 730a 2020 2020 2222 220a 2020  types.    """.  
-00042d20: 2020 6672 6f6d 2073 6369 7079 2e63 6c75    from scipy.clu
-00042d30: 7374 6572 2e68 6965 7261 7263 6879 2069  ster.hierarchy i
-00042d40: 6d70 6f72 7420 6c69 6e6b 6167 650a 0a20  mport linkage.. 
-00042d50: 2020 207a 203d 206c 696e 6b61 6765 2868     z = linkage(h
-00042d60: 2c20 6d65 7472 6963 3d6d 6574 7269 632c  , metric=metric,
-00042d70: 206d 6574 686f 643d 6c69 6e6b 6167 655f   method=linkage_
-00042d80: 6d65 7468 6f64 290a 0a20 2020 2023 2047  method)..    # G
-00042d90: 6574 2074 6865 2064 6973 7461 6e63 6573  et the distances
-00042da0: 2063 6f6c 756d 6e0a 2020 2020 6469 7374   column.    dist
-00042db0: 7320 3d20 7a5b 3a2c 2032 5d0a 2020 2020  s = z[:, 2].    
-00042dc0: 2320 436f 6e76 6572 7420 746f 2074 6865  # Convert to the
-00042dd0: 206e 756d 6265 7220 6f66 2053 4e50 2064   number of SNP d
-00042de0: 6966 6665 7265 6e63 6573 0a20 2020 2064  ifferences.    d
-00042df0: 6973 7473 202a 3d20 682e 7368 6170 655b  ists *= h.shape[
-00042e00: 315d 0a20 2020 2023 2052 6574 7572 6e20  1].    # Return 
-00042e10: 7468 6520 6d61 7869 6d75 6d0a 2020 2020  the maximum.    
-00042e20: 7265 7475 726e 2064 6973 7473 2e6d 6178  return dists.max
-00042e30: 2829 0a0a 0a64 6566 205f 6469 706c 6f74  ()...def _diplot
-00042e40: 7970 655f 6672 6571 7565 6e63 6965 7328  ype_frequencies(
-00042e50: 6774 293a 0a20 2020 2022 2222 436f 6d70  gt):.    """Comp
-00042e60: 7574 6520 6469 706c 6f74 7970 6520 6672  ute diplotype fr
-00042e70: 6571 7565 6e63 6965 732c 2072 6574 7572  equencies, retur
-00042e80: 6e69 6e67 2061 2064 6963 7469 6f6e 6172  ning a dictionar
-00042e90: 7920 7468 6174 206d 6170 730a 2020 2020  y that maps.    
-00042ea0: 6469 706c 6f74 7970 6520 6861 7368 2076  diplotype hash v
-00042eb0: 616c 7565 7320 746f 2066 7265 7175 656e  alues to frequen
-00042ec0: 6369 6573 2e22 2222 0a20 2020 2023 2054  cies.""".    # T
-00042ed0: 4f44 4f20 636f 756c 6420 7573 6520 6661  ODO could use fa
-00042ee0: 7374 6572 2068 6173 6869 6e67 0a20 2020  ster hashing.   
-00042ef0: 206e 203d 2067 742e 7368 6170 655b 315d   n = gt.shape[1]
-00042f00: 0a20 2020 2068 6173 6865 7320 3d20 5b68  .    hashes = [h
-00042f10: 6173 6828 6774 5b3a 2c20 695d 2e74 6f62  ash(gt[:, i].tob
-00042f20: 7974 6573 2829 2920 666f 7220 6920 696e  ytes()) for i in
-00042f30: 2072 616e 6765 286e 295d 0a20 2020 2063   range(n)].    c
-00042f40: 6f75 6e74 7320 3d20 436f 756e 7465 7228  ounts = Counter(
-00042f50: 6861 7368 6573 290a 2020 2020 6672 6571  hashes).    freq
-00042f60: 7320 3d20 7b6b 6579 3a20 636f 756e 7420  s = {key: count 
-00042f70: 2f20 6e20 666f 7220 6b65 792c 2063 6f75  / n for key, cou
-00042f80: 6e74 2069 6e20 636f 756e 7473 2e69 7465  nt in counts.ite
-00042f90: 6d73 2829 7d0a 2020 2020 7265 7475 726e  ms()}.    return
-00042fa0: 2066 7265 7173 0a0a 0a64 6566 205f 6861   freqs...def _ha
-00042fb0: 706c 6f74 7970 655f 6672 6571 7565 6e63  plotype_frequenc
-00042fc0: 6965 7328 6829 3a0a 2020 2020 2222 2243  ies(h):.    """C
-00042fd0: 6f6d 7075 7465 2068 6170 6c6f 7479 7065  ompute haplotype
-00042fe0: 2066 7265 7175 656e 6369 6573 2c20 7265   frequencies, re
-00042ff0: 7475 726e 696e 6720 6120 6469 6374 696f  turning a dictio
-00043000: 6e61 7279 2074 6861 7420 6d61 7073 0a20  nary that maps. 
-00043010: 2020 2068 6170 6c6f 7479 7065 2068 6173     haplotype has
-00043020: 6820 7661 6c75 6573 2074 6f20 6672 6571  h values to freq
-00043030: 7565 6e63 6965 732e 2222 220a 2020 2020  uencies.""".    
-00043040: 2320 544f 444f 2063 6f75 6c64 2075 7365  # TODO could use
-00043050: 2066 6173 7465 7220 6861 7368 696e 670a   faster hashing.
-00043060: 2020 2020 6e20 3d20 682e 7368 6170 655b      n = h.shape[
-00043070: 315d 0a20 2020 2068 6173 6865 7320 3d20  1].    hashes = 
-00043080: 5b68 6173 6828 685b 3a2c 2069 5d2e 746f  [hash(h[:, i].to
-00043090: 6279 7465 7328 2929 2066 6f72 2069 2069  bytes()) for i i
-000430a0: 6e20 7261 6e67 6528 6e29 5d0a 2020 2020  n range(n)].    
-000430b0: 636f 756e 7473 203d 2043 6f75 6e74 6572  counts = Counter
-000430c0: 2868 6173 6865 7329 0a20 2020 2066 7265  (hashes).    fre
-000430d0: 7173 203d 207b 6b65 793a 2063 6f75 6e74  qs = {key: count
-000430e0: 202f 206e 2066 6f72 206b 6579 2c20 636f   / n for key, co
-000430f0: 756e 7420 696e 2063 6f75 6e74 732e 6974  unt in counts.it
-00043100: 656d 7328 297d 0a20 2020 2072 6574 7572  ems()}.    retur
-00043110: 6e20 6672 6571 730a 0a0a 6465 6620 5f68  n freqs...def _h
-00043120: 6170 6c6f 7479 7065 5f6a 6f69 6e74 5f66  aplotype_joint_f
-00043130: 7265 7175 656e 6369 6573 2868 612c 2068  requencies(ha, h
-00043140: 6229 3a0a 2020 2020 2222 2243 6f6d 7075  b):.    """Compu
-00043150: 7465 2074 6865 206a 6f69 6e74 2066 7265  te the joint fre
-00043160: 7175 656e 6379 206f 6620 6861 706c 6f74  quency of haplot
-00043170: 7970 6573 2069 6e20 7477 6f20 6469 6666  ypes in two diff
-00043180: 6572 656e 6365 0a20 2020 2063 6f68 6f72  erence.    cohor
-00043190: 7473 2e20 5265 7475 726e 7320 6120 6469  ts. Returns a di
-000431a0: 6374 696f 6e61 7279 206d 6170 7069 6e67  ctionary mapping
-000431b0: 2068 6170 6c6f 7479 7065 2068 6173 6820   haplotype hash 
-000431c0: 7661 6c75 6573 2074 6f0a 2020 2020 7468  values to.    th
-000431d0: 6520 7072 6f64 7563 7420 6f66 2066 7265  e product of fre
-000431e0: 7175 656e 6369 6573 2069 6e20 6561 6368  quencies in each
-000431f0: 2063 6f68 6f72 742e 2222 220a 2020 2020   cohort.""".    
-00043200: 6672 7161 203d 205f 6861 706c 6f74 7970  frqa = _haplotyp
-00043210: 655f 6672 6571 7565 6e63 6965 7328 6861  e_frequencies(ha
-00043220: 290a 2020 2020 6672 7162 203d 205f 6861  ).    frqb = _ha
-00043230: 706c 6f74 7970 655f 6672 6571 7565 6e63  plotype_frequenc
-00043240: 6965 7328 6862 290a 2020 2020 6b65 7973  ies(hb).    keys
-00043250: 203d 2073 6574 2866 7271 612e 6b65 7973   = set(frqa.keys
-00043260: 2829 2920 7c20 7365 7428 6672 7162 2e6b  ()) | set(frqb.k
-00043270: 6579 7328 2929 0a20 2020 206a 6f69 6e74  eys()).    joint
-00043280: 5f66 7265 7173 203d 207b 6b65 793a 2066  _freqs = {key: f
-00043290: 7271 612e 6765 7428 6b65 792c 2030 2920  rqa.get(key, 0) 
-000432a0: 2a20 6672 7162 2e67 6574 286b 6579 2c20  * frqb.get(key, 
-000432b0: 3029 2066 6f72 206b 6579 2069 6e20 6b65  0) for key in ke
-000432c0: 7973 7d0a 2020 2020 7265 7475 726e 206a  ys}.    return j
-000432d0: 6f69 6e74 5f66 7265 7173 0a0a 0a64 6566  oint_freqs...def
-000432e0: 205f 6831 7828 6861 2c20 6862 293a 0a20   _h1x(ha, hb):. 
-000432f0: 2020 2022 2222 436f 6d70 7574 6520 4831     """Compute H1
-00043300: 582c 2074 6865 2073 756d 206f 6620 6a6f  X, the sum of jo
-00043310: 696e 7420 6861 706c 6f74 7970 6520 6672  int haplotype fr
-00043320: 6571 7565 6e63 6965 7320 6265 7477 6565  equencies betwee
-00043330: 6e0a 2020 2020 7477 6f20 636f 686f 7274  n.    two cohort
-00043340: 732c 2077 6869 6368 2069 7320 6120 7375  s, which is a su
-00043350: 6d6d 6172 7920 7374 6174 6973 7469 6320  mmary statistic 
-00043360: 7573 6566 756c 2066 6f72 2064 6574 6563  useful for detec
-00043370: 7469 6e67 0a20 2020 2073 6861 7265 6420  ting.    shared 
-00043380: 7365 6c65 6374 6976 6520 7377 6565 7073  selective sweeps
-00043390: 2e22 2222 0a20 2020 206a 6620 3d20 5f68  .""".    jf = _h
-000433a0: 6170 6c6f 7479 7065 5f6a 6f69 6e74 5f66  aplotype_joint_f
-000433b0: 7265 7175 656e 6369 6573 2868 612c 2068  requencies(ha, h
-000433c0: 6229 0a20 2020 2072 6574 7572 6e20 6e70  b).    return np
-000433d0: 2e73 756d 286c 6973 7428 6a66 2e76 616c  .sum(list(jf.val
-000433e0: 7565 7328 2929 290a 0a0a 6465 6620 5f6d  ues()))...def _m
-000433f0: 6f76 696e 675f 6831 7828 6861 2c20 6862  oving_h1x(ha, hb
-00043400: 2c20 7369 7a65 2c20 7374 6172 743d 302c  , size, start=0,
-00043410: 2073 746f 703d 4e6f 6e65 2c20 7374 6570   stop=None, step
-00043420: 3d4e 6f6e 6529 3a0a 2020 2020 2222 2243  =None):.    """C
-00043430: 6f6d 7075 7465 2048 3158 2069 6e20 6d6f  ompute H1X in mo
-00043440: 7669 6e67 2077 696e 646f 7773 2e0a 0a20  ving windows... 
-00043450: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00043460: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00043470: 2068 6120 3a20 6172 7261 795f 6c69 6b65   ha : array_like
-00043480: 2c20 696e 742c 2073 6861 7065 2028 6e5f  , int, shape (n_
-00043490: 7661 7269 616e 7473 2c20 6e5f 6861 706c  variants, n_hapl
-000434a0: 6f74 7970 6573 290a 2020 2020 2020 2020  otypes).        
-000434b0: 4861 706c 6f74 7970 6520 6172 7261 7920  Haplotype array 
-000434c0: 666f 7220 7468 6520 6669 7273 7420 636f  for the first co
-000434d0: 686f 7274 2e0a 2020 2020 6862 203a 2061  hort..    hb : a
-000434e0: 7272 6179 5f6c 696b 652c 2069 6e74 2c20  rray_like, int, 
-000434f0: 7368 6170 6520 286e 5f76 6172 6961 6e74  shape (n_variant
-00043500: 732c 206e 5f68 6170 6c6f 7479 7065 7329  s, n_haplotypes)
-00043510: 0a20 2020 2020 2020 2048 6170 6c6f 7479  .        Haploty
-00043520: 7065 2061 7272 6179 2066 6f72 2074 6865  pe array for the
-00043530: 2073 6563 6f6e 6420 636f 686f 7274 2e0a   second cohort..
-00043540: 2020 2020 7369 7a65 203a 2069 6e74 0a20      size : int. 
-00043550: 2020 2020 2020 2054 6865 2077 696e 646f         The windo
-00043560: 7720 7369 7a65 2028 6e75 6d62 6572 206f  w size (number o
-00043570: 6620 7661 7269 616e 7473 292e 0a20 2020  f variants)..   
-00043580: 2073 7461 7274 203a 2069 6e74 2c20 6f70   start : int, op
-00043590: 7469 6f6e 616c 0a20 2020 2020 2020 2054  tional.        T
-000435a0: 6865 2069 6e64 6578 2061 7420 7768 6963  he index at whic
-000435b0: 6820 746f 2073 7461 7274 2e0a 2020 2020  h to start..    
-000435c0: 7374 6f70 203a 2069 6e74 2c20 6f70 7469  stop : int, opti
-000435d0: 6f6e 616c 0a20 2020 2020 2020 2054 6865  onal.        The
-000435e0: 2069 6e64 6578 2061 7420 7768 6963 6820   index at which 
-000435f0: 746f 2073 746f 702e 0a20 2020 2073 7465  to stop..    ste
-00043600: 7020 3a20 696e 742c 206f 7074 696f 6e61  p : int, optiona
-00043610: 6c0a 2020 2020 2020 2020 5468 6520 6e75  l.        The nu
-00043620: 6d62 6572 206f 6620 7661 7269 616e 7473  mber of variants
-00043630: 2062 6574 7765 656e 2073 7461 7274 2070   between start p
-00043640: 6f73 6974 696f 6e73 206f 6620 7769 6e64  ositions of wind
-00043650: 6f77 732e 2049 6620 6e6f 740a 2020 2020  ows. If not.    
-00043660: 2020 2020 6769 7665 6e2c 2064 6566 6175      given, defau
-00043670: 6c74 7320 746f 2074 6865 2077 696e 646f  lts to the windo
-00043680: 7720 7369 7a65 2c20 692e 652e 2c20 6e6f  w size, i.e., no
-00043690: 6e2d 6f76 6572 6c61 7070 696e 6720 7769  n-overlapping wi
-000436a0: 6e64 6f77 732e 0a0a 2020 2020 5265 7475  ndows...    Retu
-000436b0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-000436c0: 2020 2020 6831 7820 3a20 6e64 6172 7261      h1x : ndarra
-000436d0: 792c 2066 6c6f 6174 2c20 7368 6170 6520  y, float, shape 
-000436e0: 286e 5f77 696e 646f 7773 2c29 0a20 2020  (n_windows,).   
-000436f0: 2020 2020 2048 3158 2076 616c 7565 7320       H1X values 
-00043700: 2873 756d 206f 6620 7371 7561 7265 7320  (sum of squares 
-00043710: 6f66 206a 6f69 6e74 2068 6170 6c6f 7479  of joint haploty
-00043720: 7065 2066 7265 7175 656e 6369 6573 292e  pe frequencies).
-00043730: 0a20 2020 2022 2222 0a0a 2020 2020 6173  .    """..    as
-00043740: 7365 7274 2068 612e 6e64 696d 203d 3d20  sert ha.ndim == 
-00043750: 6862 2e6e 6469 6d20 3d3d 2032 0a20 2020  hb.ndim == 2.   
-00043760: 2061 7373 6572 7420 6861 2e73 6861 7065   assert ha.shape
-00043770: 5b30 5d20 3d3d 2068 622e 7368 6170 655b  [0] == hb.shape[
-00043780: 305d 0a0a 2020 2020 2320 636f 6e73 7472  0]..    # constr
-00043790: 7563 7420 6d6f 7669 6e67 2077 696e 646f  uct moving windo
-000437a0: 7773 0a20 2020 2077 696e 646f 7773 203d  ws.    windows =
-000437b0: 2061 6c6c 656c 2e69 6e64 6578 5f77 696e   allel.index_win
-000437c0: 646f 7773 2868 612c 2073 697a 652c 2073  dows(ha, size, s
-000437d0: 7461 7274 2c20 7374 6f70 2c20 7374 6570  tart, stop, step
-000437e0: 290a 0a20 2020 2023 2063 6f6d 7075 7465  )..    # compute
-000437f0: 2073 7461 7469 7374 6963 7320 666f 7220   statistics for 
-00043800: 6561 6368 2077 696e 646f 770a 2020 2020  each window.    
-00043810: 6f75 7420 3d20 6e70 2e61 7272 6179 285b  out = np.array([
-00043820: 5f68 3178 2868 615b 693a 6a5d 2c20 6862  _h1x(ha[i:j], hb
-00043830: 5b69 3a6a 5d29 2066 6f72 2069 2c20 6a20  [i:j]) for i, j 
-00043840: 696e 2077 696e 646f 7773 5d29 0a0a 2020  in windows])..  
-00043850: 2020 7265 7475 726e 206f 7574 0a0a 0a64    return out...d
-00043860: 6566 205f 6765 745f 6261 7365 6d61 705f  ef _get_basemap_
-00043870: 6162 6272 6576 7328 293a 0a20 2020 2022  abbrevs():.    "
-00043880: 2222 4765 7420 7468 6520 6469 6374 206f  ""Get the dict o
-00043890: 6620 6261 7365 6d61 7020 6162 6272 6576  f basemap abbrev
-000438a0: 6961 7469 6f6e 732e 0a0a 2020 2020 5265  iations...    Re
-000438b0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-000438c0: 2d0a 2020 2020 6261 7365 6d61 705f 6162  -.    basemap_ab
-000438d0: 6272 6576 7320 3a20 6469 6374 0a20 2020  brevs : dict.   
-000438e0: 2020 2020 2041 2064 6963 7469 6f6e 6172       A dictionar
-000438f0: 7920 7768 6572 6520 6561 6368 206b 6579  y where each key
-00043900: 2069 7320 6120 6261 7365 6d61 7020 6162   is a basemap ab
-00043910: 6272 6576 6961 7469 6f6e 2073 7472 696e  breviation strin
-00043920: 672c 2065 2e67 2e20 226d 6170 6e69 6b22  g, e.g. "mapnik"
-00043930: 2c0a 2020 2020 2020 2020 616e 6420 6561  ,.        and ea
-00043940: 6368 2076 616c 7565 2069 7320 6120 636f  ch value is a co
-00043950: 7272 6573 706f 6e64 696e 6720 5469 6c65  rresponding Tile
-00043960: 5072 6f76 6964 6572 2c20 652e 672e 2060  Provider, e.g. `
-00043970: 6970 796c 6561 666c 6574 2e62 6173 656d  ipyleaflet.basem
-00043980: 6170 732e 4f70 656e 5374 7265 6574 4d61  aps.OpenStreetMa
-00043990: 702e 4d61 706e 696b 602e 0a20 2020 2022  p.Mapnik`..    "
-000439a0: 2222 0a20 2020 2069 6d70 6f72 7420 6970  "".    import ip
-000439b0: 796c 6561 666c 6574 0a0a 2020 2020 6261  yleaflet..    ba
-000439c0: 7365 6d61 705f 6162 6272 6576 7320 3d20  semap_abbrevs = 
-000439d0: 7b0a 2020 2020 2020 2020 226d 6170 6e69  {.        "mapni
-000439e0: 6b22 3a20 6970 796c 6561 666c 6574 2e62  k": ipyleaflet.b
-000439f0: 6173 656d 6170 732e 4f70 656e 5374 7265  asemaps.OpenStre
-00043a00: 6574 4d61 702e 4d61 706e 696b 2c0a 2020  etMap.Mapnik,.  
-00043a10: 2020 2020 2020 226e 6174 6765 6f77 6f72        "natgeowor
-00043a20: 6c64 6d61 7022 3a20 6970 796c 6561 666c  ldmap": ipyleafl
-00043a30: 6574 2e62 6173 656d 6170 732e 4573 7269  et.basemaps.Esri
-00043a40: 2e4e 6174 4765 6f57 6f72 6c64 4d61 702c  .NatGeoWorldMap,
-00043a50: 0a20 2020 2020 2020 2022 6f70 656e 746f  .        "opento
-00043a60: 706f 6d61 7022 3a20 6970 796c 6561 666c  pomap": ipyleafl
-00043a70: 6574 2e62 6173 656d 6170 732e 4f70 656e  et.basemaps.Open
-00043a80: 546f 706f 4d61 702c 0a20 2020 2020 2020  TopoMap,.       
-00043a90: 2022 706f 7369 7472 6f6e 223a 2069 7079   "positron": ipy
-00043aa0: 6c65 6166 6c65 742e 6261 7365 6d61 7073  leaflet.basemaps
-00043ab0: 2e43 6172 746f 4442 2e50 6f73 6974 726f  .CartoDB.Positro
-00043ac0: 6e2c 0a20 2020 2020 2020 2022 7361 7465  n,.        "sate
-00043ad0: 6c6c 6974 6522 3a20 6970 796c 6561 666c  llite": ipyleafl
-00043ae0: 6574 2e62 6173 656d 6170 732e 4761 6f64  et.basemaps.Gaod
-00043af0: 652e 5361 7465 6c6c 6974 652c 0a20 2020  e.Satellite,.   
-00043b00: 2020 2020 2022 7465 7272 6169 6e22 3a20       "terrain": 
-00043b10: 6970 796c 6561 666c 6574 2e62 6173 656d  ipyleaflet.basem
-00043b20: 6170 732e 5374 616d 656e 2e54 6572 7261  aps.Stamen.Terra
-00043b30: 696e 2c0a 2020 2020 2020 2020 2277 6174  in,.        "wat
-00043b40: 6572 636f 6c6f 7222 3a20 6970 796c 6561  ercolor": ipylea
-00043b50: 666c 6574 2e62 6173 656d 6170 732e 5374  flet.basemaps.St
-00043b60: 616d 656e 2e57 6174 6572 636f 6c6f 722c  amen.Watercolor,
-00043b70: 0a20 2020 2020 2020 2022 776f 726c 6469  .        "worldi
-00043b80: 6d61 6765 7279 223a 2069 7079 6c65 6166  magery": ipyleaf
-00043b90: 6c65 742e 6261 7365 6d61 7073 2e45 7372  let.basemaps.Esr
-00043ba0: 692e 576f 726c 6449 6d61 6765 7279 2c0a  i.WorldImagery,.
-00043bb0: 2020 2020 2020 2020 2277 6f72 6c64 7374          "worldst
-00043bc0: 7265 6574 6d61 7022 3a20 6970 796c 6561  reetmap": ipylea
-00043bd0: 666c 6574 2e62 6173 656d 6170 732e 4573  flet.basemaps.Es
-00043be0: 7269 2e57 6f72 6c64 5374 7265 6574 4d61  ri.WorldStreetMa
-00043bf0: 702c 0a20 2020 2020 2020 2022 776f 726c  p,.        "worl
-00043c00: 6474 6f70 6f6d 6170 223a 2069 7079 6c65  dtopomap": ipyle
-00043c10: 6166 6c65 742e 6261 7365 6d61 7073 2e45  aflet.basemaps.E
-00043c20: 7372 692e 576f 726c 6454 6f70 6f4d 6170  sri.WorldTopoMap
-00043c30: 2c0a 2020 2020 7d0a 2020 2020 7265 7475  ,.    }.    retu
-00043c40: 726e 2062 6173 656d 6170 5f61 6262 7265  rn basemap_abbre
-00043c50: 7673 0a                                  vs.
+00025850: 2020 2022 6461 7465 223a 2063 6f68 6f72     "date": cohor
+00025860: 742e 7065 7269 6f64 5f73 7461 7274 2c0a  t.period_start,.
+00025870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025880: 2020 2020 2270 6572 696f 6422 3a20 7374      "period": st
+00025890: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+000258a0: 2020 2020 2020 2020 2020 2063 6f68 6f72             cohor
+000258b0: 742e 7065 7269 6f64 0a20 2020 2020 2020  t.period.       
+000258c0: 2020 2020 2020 2020 2020 2020 2029 2c20               ), 
+000258d0: 2023 2075 7365 2073 7472 696e 6720 7265   # use string re
+000258e0: 7072 6573 656e 7461 7469 6f6e 2066 6f72  presentation for
+000258f0: 2068 6f76 6572 206c 6162 656c 0a20 2020   hover label.   
+00025900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025910: 2022 7361 6d70 6c65 5f73 697a 6522 3a20   "sample_size": 
+00025920: 636f 686f 7274 2e73 697a 652c 0a20 2020  cohort.size,.   
+00025930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025940: 2022 7661 7269 616e 7422 3a20 7661 7269   "variant": vari
+00025950: 616e 745f 6c61 6265 6c73 2c0a 2020 2020  ant_labels,.    
+00025960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025970: 2263 6f75 6e74 223a 2064 735f 636f 686f  "count": ds_coho
+00025980: 7274 5b22 6576 656e 745f 636f 756e 7422  rt["event_count"
+00025990: 5d2e 7661 6c75 6573 2c0a 2020 2020 2020  ].values,.      
+000259a0: 2020 2020 2020 2020 2020 2020 2020 226e                "n
+000259b0: 6f62 7322 3a20 6473 5f63 6f68 6f72 745b  obs": ds_cohort[
+000259c0: 2265 7665 6e74 5f6e 6f62 7322 5d2e 7661  "event_nobs"].va
+000259d0: 6c75 6573 2c0a 2020 2020 2020 2020 2020  lues,.          
+000259e0: 2020 2020 2020 2020 2020 2266 7265 7175            "frequ
+000259f0: 656e 6379 223a 2064 735f 636f 686f 7274  ency": ds_cohort
+00025a00: 5b22 6576 656e 745f 6672 6571 7565 6e63  ["event_frequenc
+00025a10: 7922 5d2e 7661 6c75 6573 2c0a 2020 2020  y"].values,.    
+00025a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a30: 2266 7265 7175 656e 6379 5f63 695f 6c6f  "frequency_ci_lo
+00025a40: 7722 3a20 6473 5f63 6f68 6f72 745b 2265  w": ds_cohort["e
+00025a50: 7665 6e74 5f66 7265 7175 656e 6379 5f63  vent_frequency_c
+00025a60: 695f 6c6f 7722 5d2e 7661 6c75 6573 2c0a  i_low"].values,.
+00025a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a80: 2020 2020 2266 7265 7175 656e 6379 5f63      "frequency_c
+00025a90: 695f 7570 7022 3a20 6473 5f63 6f68 6f72  i_upp": ds_cohor
+00025aa0: 745b 2265 7665 6e74 5f66 7265 7175 656e  t["event_frequen
+00025ab0: 6379 5f63 695f 7570 7022 5d2e 7661 6c75  cy_ci_upp"].valu
+00025ac0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00025ad0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00025ae0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00025af0: 6466 732e 6170 7065 6e64 2864 6629 0a20  dfs.append(df). 
+00025b00: 2020 2020 2020 2064 665f 6576 656e 7473         df_events
+00025b10: 203d 2070 642e 636f 6e63 6174 2864 6673   = pd.concat(dfs
+00025b20: 2c20 6178 6973 3d30 292e 7265 7365 745f  , axis=0).reset_
+00025b30: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+00025b40: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+00025b50: 2272 656d 6f76 6520 6576 656e 7473 2077  "remove events w
+00025b60: 6974 6820 6e6f 206f 6273 6572 7661 7469  ith no observati
+00025b70: 6f6e 7322 290a 2020 2020 2020 2020 6466  ons").        df
+00025b80: 5f65 7665 6e74 7320 3d20 6466 5f65 7665  _events = df_eve
+00025b90: 6e74 732e 7175 6572 7928 226e 6f62 7320  nts.query("nobs 
+00025ba0: 3e20 3022 290a 0a20 2020 2020 2020 2064  > 0")..        d
+00025bb0: 6562 7567 2822 6361 6c63 756c 6174 6520  ebug("calculate 
+00025bc0: 6572 726f 7220 6261 7273 2229 0a20 2020  error bars").   
+00025bd0: 2020 2020 2066 7271 203d 2064 665f 6576       frq = df_ev
+00025be0: 656e 7473 5b22 6672 6571 7565 6e63 7922  ents["frequency"
+00025bf0: 5d0a 2020 2020 2020 2020 6672 715f 6369  ].        frq_ci
+00025c00: 5f6c 6f77 203d 2064 665f 6576 656e 7473  _low = df_events
+00025c10: 5b22 6672 6571 7565 6e63 795f 6369 5f6c  ["frequency_ci_l
+00025c20: 6f77 225d 0a20 2020 2020 2020 2066 7271  ow"].        frq
+00025c30: 5f63 695f 7570 7020 3d20 6466 5f65 7665  _ci_upp = df_eve
+00025c40: 6e74 735b 2266 7265 7175 656e 6379 5f63  nts["frequency_c
+00025c50: 695f 7570 7022 5d0a 2020 2020 2020 2020  i_upp"].        
+00025c60: 6466 5f65 7665 6e74 735b 2266 7265 7175  df_events["frequ
+00025c70: 656e 6379 5f65 7272 6f72 225d 203d 2066  ency_error"] = f
+00025c80: 7271 5f63 695f 7570 7020 2d20 6672 710a  rq_ci_upp - frq.
+00025c90: 2020 2020 2020 2020 6466 5f65 7665 6e74          df_event
+00025ca0: 735b 2266 7265 7175 656e 6379 5f65 7272  s["frequency_err
+00025cb0: 6f72 5f6d 696e 7573 225d 203d 2066 7271  or_minus"] = frq
+00025cc0: 202d 2066 7271 5f63 695f 6c6f 770a 0a20   - frq_ci_low.. 
+00025cd0: 2020 2020 2020 2064 6562 7567 2822 6d61         debug("ma
+00025ce0: 6b65 2061 2070 6c6f 7422 290a 2020 2020  ke a plot").    
+00025cf0: 2020 2020 6669 6720 3d20 7078 2e6c 696e      fig = px.lin
+00025d00: 6528 0a20 2020 2020 2020 2020 2020 2064  e(.            d
+00025d10: 665f 6576 656e 7473 2c0a 2020 2020 2020  f_events,.      
+00025d20: 2020 2020 2020 6661 6365 745f 636f 6c3d        facet_col=
+00025d30: 2274 6178 6f6e 222c 0a20 2020 2020 2020  "taxon",.       
+00025d40: 2020 2020 2066 6163 6574 5f72 6f77 3d22       facet_row="
+00025d50: 6172 6561 222c 0a20 2020 2020 2020 2020  area",.         
+00025d60: 2020 2078 3d22 6461 7465 222c 0a20 2020     x="date",.   
+00025d70: 2020 2020 2020 2020 2079 3d22 6672 6571           y="freq
+00025d80: 7565 6e63 7922 2c0a 2020 2020 2020 2020  uency",.        
+00025d90: 2020 2020 6572 726f 725f 793d 2266 7265      error_y="fre
+00025da0: 7175 656e 6379 5f65 7272 6f72 222c 0a20  quency_error",. 
+00025db0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00025dc0: 5f79 5f6d 696e 7573 3d22 6672 6571 7565  _y_minus="freque
+00025dd0: 6e63 795f 6572 726f 725f 6d69 6e75 7322  ncy_error_minus"
+00025de0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00025df0: 6c6f 723d 2276 6172 6961 6e74 222c 0a20  lor="variant",. 
+00025e00: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
+00025e10: 7273 3d54 7275 652c 0a20 2020 2020 2020  rs=True,.       
+00025e20: 2020 2020 2068 6f76 6572 5f6e 616d 653d       hover_name=
+00025e30: 2276 6172 6961 6e74 222c 0a20 2020 2020  "variant",.     
+00025e40: 2020 2020 2020 2068 6f76 6572 5f64 6174         hover_dat
+00025e50: 613d 7b0a 2020 2020 2020 2020 2020 2020  a={.            
+00025e60: 2020 2020 2266 7265 7175 656e 6379 223a      "frequency":
+00025e70: 2022 3a2e 3025 222c 0a20 2020 2020 2020   ":.0%",.       
+00025e80: 2020 2020 2020 2020 2022 7065 7269 6f64           "period
+00025e90: 223a 2054 7275 652c 0a20 2020 2020 2020  ": True,.       
+00025ea0: 2020 2020 2020 2020 2022 6172 6561 223a           "area":
+00025eb0: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
+00025ec0: 2020 2020 2020 2022 7461 786f 6e22 3a20         "taxon": 
+00025ed0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00025ee0: 2020 2020 2020 2273 616d 706c 655f 7369        "sample_si
+00025ef0: 7a65 223a 2054 7275 652c 0a20 2020 2020  ze": True,.     
+00025f00: 2020 2020 2020 2020 2020 2022 6461 7465             "date
+00025f10: 223a 2046 616c 7365 2c0a 2020 2020 2020  ": False,.      
+00025f20: 2020 2020 2020 2020 2020 2276 6172 6961            "varia
+00025f30: 6e74 223a 2046 616c 7365 2c0a 2020 2020  nt": False,.    
+00025f40: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+00025f50: 2020 2020 2020 2068 6569 6768 743d 6865         height=he
+00025f60: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+00025f70: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
+00025f80: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+00025f90: 3d74 6974 6c65 2c0a 2020 2020 2020 2020  =title,.        
+00025fa0: 2020 2020 6c61 6265 6c73 3d7b 0a20 2020      labels={.   
+00025fb0: 2020 2020 2020 2020 2020 2020 2022 6461               "da
+00025fc0: 7465 223a 2022 4461 7465 222c 0a20 2020  te": "Date",.   
+00025fd0: 2020 2020 2020 2020 2020 2020 2022 6672               "fr
+00025fe0: 6571 7565 6e63 7922 3a20 2246 7265 7175  equency": "Frequ
+00025ff0: 656e 6379 222c 0a20 2020 2020 2020 2020  ency",.         
+00026000: 2020 2020 2020 2022 7661 7269 616e 7422         "variant"
+00026010: 3a20 2256 6172 6961 6e74 222c 0a20 2020  : "Variant",.   
+00026020: 2020 2020 2020 2020 2020 2020 2022 7461               "ta
+00026030: 786f 6e22 3a20 2254 6178 6f6e 222c 0a20  xon": "Taxon",. 
+00026040: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00026050: 6172 6561 223a 2022 4172 6561 222c 0a20  area": "Area",. 
+00026060: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00026070: 7065 7269 6f64 223a 2022 5065 7269 6f64  period": "Period
+00026080: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00026090: 2020 2022 7361 6d70 6c65 5f73 697a 6522     "sample_size"
+000260a0: 3a20 2253 616d 706c 6520 7369 7a65 222c  : "Sample size",
+000260b0: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
+000260c0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+000260d0: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
+000260e0: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+000260f0: 7469 6479 2070 6c6f 7422 290a 2020 2020  tidy plot").    
+00026100: 2020 2020 6669 672e 7570 6461 7465 5f6c      fig.update_l
+00026110: 6179 6f75 7428 7961 7869 735f 7261 6e67  ayout(yaxis_rang
+00026120: 653d 5b2d 302e 3035 2c20 312e 3035 5d29  e=[-0.05, 1.05])
+00026130: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00026140: 2066 6967 0a0a 2020 2020 4064 6f63 280a   fig..    @doc(.
+00026150: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
+00026160: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00026170: 506c 6f74 206d 6172 6b65 7273 206f 6e20  Plot markers on 
+00026180: 6120 6d61 7020 7368 6f77 696e 6720 7661  a map showing va
+00026190: 7269 616e 7420 6672 6571 7565 6e63 6965  riant frequencie
+000261a0: 7320 666f 7220 636f 686f 7274 7320 6772  s for cohorts gr
+000261b0: 6f75 7065 640a 2020 2020 2020 2020 2020  ouped.          
+000261c0: 2020 6279 2061 7265 6120 2873 7061 6365    by area (space
+000261d0: 292c 2070 6572 696f 6420 2874 696d 6529  ), period (time)
+000261e0: 2061 6e64 2074 6178 6f6e 2e0a 2020 2020   and taxon..    
+000261f0: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
+00026200: 2070 6172 616d 6574 6572 733d 6469 6374   parameters=dict
+00026210: 280a 2020 2020 2020 2020 2020 2020 6d3d  (.            m=
+00026220: 2254 6865 206d 6170 206f 6e20 7768 6963  "The map on whic
+00026230: 6820 746f 2061 6464 2074 6865 206d 6172  h to add the mar
+00026240: 6b65 7273 2e22 2c0a 2020 2020 2020 2020  kers.",.        
+00026250: 2020 2020 7661 7269 616e 743d 2249 6e64      variant="Ind
+00026260: 6578 206f 7220 6c61 6265 6c20 6f66 2076  ex or label of v
+00026270: 6172 6961 6e74 2074 6f20 706c 6f74 2e22  ariant to plot."
+00026280: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
+00026290: 786f 6e3d 2254 6178 6f6e 2074 6f20 7368  xon="Taxon to sh
+000262a0: 6f77 206d 6172 6b65 7273 2066 6f72 2e22  ow markers for."
+000262b0: 2c0a 2020 2020 2020 2020 2020 2020 7065  ,.            pe
+000262c0: 7269 6f64 3d22 5469 6d65 2070 6572 696f  riod="Time perio
+000262d0: 6420 746f 2073 686f 7720 6d61 726b 6572  d to show marker
+000262e0: 7320 666f 722e 222c 0a20 2020 2020 2020  s for.",.       
+000262f0: 2020 2020 2063 6c65 6172 3d22 2222 0a20       clear=""". 
+00026300: 2020 2020 2020 2020 2020 2020 2020 2049                 I
+00026310: 6620 5472 7565 2c20 636c 6561 7220 616c  f True, clear al
+00026320: 6c20 6c61 7965 7273 2028 6578 6365 7074  l layers (except
+00026330: 2074 6865 2062 6173 6520 6c61 7965 7229   the base layer)
+00026340: 2066 726f 6d20 7468 6520 6d61 700a 2020   from the map.  
+00026350: 2020 2020 2020 2020 2020 2020 2020 6265                be
+00026360: 666f 7265 2061 6464 696e 6720 6e65 7720  fore adding new 
+00026370: 6d61 726b 6572 732e 0a20 2020 2020 2020  markers..       
+00026380: 2020 2020 2022 2222 2c0a 2020 2020 2020       """,.      
+00026390: 2020 292c 0a20 2020 2029 0a20 2020 2064    ),.    ).    d
+000263a0: 6566 2070 6c6f 745f 6672 6571 7565 6e63  ef plot_frequenc
+000263b0: 6965 735f 6d61 705f 6d61 726b 6572 7328  ies_map_markers(
+000263c0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000263d0: 2020 2020 2020 206d 2c0a 2020 2020 2020         m,.      
+000263e0: 2020 6473 3a20 6672 715f 7061 7261 6d73    ds: frq_params
+000263f0: 2e64 735f 6672 6571 7565 6e63 6965 735f  .ds_frequencies_
+00026400: 6164 7661 6e63 6564 2c0a 2020 2020 2020  advanced,.      
+00026410: 2020 7661 7269 616e 743a 2055 6e69 6f6e    variant: Union
+00026420: 5b69 6e74 2c20 7374 725d 2c0a 2020 2020  [int, str],.    
+00026430: 2020 2020 7461 786f 6e3a 2073 7472 2c0a      taxon: str,.
+00026440: 2020 2020 2020 2020 7065 7269 6f64 3a20          period: 
+00026450: 7064 2e50 6572 696f 642c 0a20 2020 2020  pd.Period,.     
+00026460: 2020 2063 6c65 6172 3a20 626f 6f6c 203d     clear: bool =
+00026470: 2054 7275 652c 0a20 2020 2029 3a0a 2020   True,.    ):.  
+00026480: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
+00026490: 6c66 2e5f 6c6f 672e 6465 6275 670a 2020  lf._log.debug.  
+000264a0: 2020 2020 2020 2320 6f6e 6c79 2069 6d70        # only imp
+000264b0: 6f72 7420 6865 7265 2062 6563 6175 7365  ort here because
+000264c0: 206f 6620 736f 6d65 2070 726f 626c 656d   of some problem
+000264d0: 7320 696d 706f 7274 696e 6720 676c 6f62  s importing glob
+000264e0: 616c 6c79 0a20 2020 2020 2020 2069 6d70  ally.        imp
+000264f0: 6f72 7420 6970 796c 6561 666c 6574 0a20  ort ipyleaflet. 
+00026500: 2020 2020 2020 2069 6d70 6f72 7420 6970         import ip
+00026510: 7977 6964 6765 7473 0a0a 2020 2020 2020  ywidgets..      
+00026520: 2020 6465 6275 6728 2273 6c69 6365 2064    debug("slice d
+00026530: 6174 6173 6574 2074 6f20 7661 7269 616e  ataset to varian
+00026540: 7420 6f66 2069 6e74 6572 6573 7422 290a  t of interest").
+00026550: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00026560: 7461 6e63 6528 7661 7269 616e 742c 2069  tance(variant, i
+00026570: 6e74 293a 0a20 2020 2020 2020 2020 2020  nt):.           
+00026580: 2064 735f 7661 7269 616e 7420 3d20 6473   ds_variant = ds
+00026590: 2e69 7365 6c28 7661 7269 616e 7473 3d76  .isel(variants=v
+000265a0: 6172 6961 6e74 290a 2020 2020 2020 2020  ariant).        
+000265b0: 2020 2020 7661 7269 616e 745f 6c61 6265      variant_labe
+000265c0: 6c20 3d20 6473 5b22 7661 7269 616e 745f  l = ds["variant_
+000265d0: 6c61 6265 6c22 5d2e 7661 6c75 6573 5b76  label"].values[v
+000265e0: 6172 6961 6e74 5d0a 2020 2020 2020 2020  ariant].        
+000265f0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00026600: 7661 7269 616e 742c 2073 7472 293a 0a20  variant, str):. 
+00026610: 2020 2020 2020 2020 2020 2064 735f 7661             ds_va
+00026620: 7269 616e 7420 3d20 6473 2e73 6574 5f69  riant = ds.set_i
+00026630: 6e64 6578 2876 6172 6961 6e74 733d 2276  ndex(variants="v
+00026640: 6172 6961 6e74 5f6c 6162 656c 2229 2e73  ariant_label").s
+00026650: 656c 2876 6172 6961 6e74 733d 7661 7269  el(variants=vari
+00026660: 616e 7429 0a20 2020 2020 2020 2020 2020  ant).           
+00026670: 2076 6172 6961 6e74 5f6c 6162 656c 203d   variant_label =
+00026680: 2076 6172 6961 6e74 0a20 2020 2020 2020   variant.       
+00026690: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000266a0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000266b0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+000266c0: 2020 2020 6622 4261 6420 7479 7065 2066      f"Bad type f
+000266d0: 6f72 2076 6172 6961 6e74 2070 6172 616d  or variant param
+000266e0: 6574 6572 3b20 6578 7065 6374 6564 2069  eter; expected i
+000266f0: 6e74 206f 7220 7374 722c 2066 6f75 6e64  nt or str, found
+00026700: 207b 7479 7065 2876 6172 6961 6e74 297d   {type(variant)}
+00026710: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
+00026720: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+00026730: 2263 6f6e 7665 7274 2074 6f20 6120 6461  "convert to a da
+00026740: 7461 6672 616d 6520 666f 7220 636f 6e76  taframe for conv
+00026750: 656e 6965 6e63 6522 290a 2020 2020 2020  enience").      
+00026760: 2020 6466 5f6d 6172 6b65 7273 203d 2064    df_markers = d
+00026770: 735f 7661 7269 616e 745b 0a20 2020 2020  s_variant[.     
+00026780: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+00026790: 2020 2020 2020 2020 2022 636f 686f 7274           "cohort
+000267a0: 5f74 6178 6f6e 222c 0a20 2020 2020 2020  _taxon",.       
+000267b0: 2020 2020 2020 2020 2022 636f 686f 7274           "cohort
+000267c0: 5f61 7265 6122 2c0a 2020 2020 2020 2020  _area",.        
+000267d0: 2020 2020 2020 2020 2263 6f68 6f72 745f          "cohort_
+000267e0: 7065 7269 6f64 222c 0a20 2020 2020 2020  period",.       
+000267f0: 2020 2020 2020 2020 2022 636f 686f 7274           "cohort
+00026800: 5f6c 6174 5f6d 6561 6e22 2c0a 2020 2020  _lat_mean",.    
+00026810: 2020 2020 2020 2020 2020 2020 2263 6f68              "coh
+00026820: 6f72 745f 6c6f 6e5f 6d65 616e 222c 0a20  ort_lon_mean",. 
+00026830: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00026840: 636f 686f 7274 5f73 697a 6522 2c0a 2020  cohort_size",.  
+00026850: 2020 2020 2020 2020 2020 2020 2020 2265                "e
+00026860: 7665 6e74 5f66 7265 7175 656e 6379 222c  vent_frequency",
+00026870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026880: 2022 6576 656e 745f 6672 6571 7565 6e63   "event_frequenc
+00026890: 795f 6369 5f6c 6f77 222c 0a20 2020 2020  y_ci_low",.     
+000268a0: 2020 2020 2020 2020 2020 2022 6576 656e             "even
+000268b0: 745f 6672 6571 7565 6e63 795f 6369 5f75  t_frequency_ci_u
+000268c0: 7070 222c 0a20 2020 2020 2020 2020 2020  pp",.           
+000268d0: 205d 0a20 2020 2020 2020 205d 2e74 6f5f   ].        ].to_
+000268e0: 6461 7461 6672 616d 6528 290a 0a20 2020  dataframe()..   
+000268f0: 2020 2020 2064 6562 7567 2822 7365 6c65       debug("sele
+00026900: 6374 2064 6174 6120 6d61 7463 6869 6e67  ct data matching
+00026910: 2074 6178 6f6e 2061 6e64 2070 6572 696f   taxon and perio
+00026920: 6420 7061 7261 6d65 7465 7273 2229 0a20  d parameters"). 
+00026930: 2020 2020 2020 2064 665f 6d61 726b 6572         df_marker
+00026940: 7320 3d20 6466 5f6d 6172 6b65 7273 2e6c  s = df_markers.l
+00026950: 6f63 5b0a 2020 2020 2020 2020 2020 2020  oc[.            
+00026960: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00026970: 2020 2864 665f 6d61 726b 6572 735b 2263    (df_markers["c
+00026980: 6f68 6f72 745f 7461 786f 6e22 5d20 3d3d  ohort_taxon"] ==
+00026990: 2074 6178 6f6e 290a 2020 2020 2020 2020   taxon).        
+000269a0: 2020 2020 2020 2020 2620 2864 665f 6d61          & (df_ma
+000269b0: 726b 6572 735b 2263 6f68 6f72 745f 7065  rkers["cohort_pe
+000269c0: 7269 6f64 225d 203d 3d20 7065 7269 6f64  riod"] == period
+000269d0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+000269e0: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
+000269f0: 2020 2064 6562 7567 2822 636c 6561 7220     debug("clear 
+00026a00: 6578 6973 7469 6e67 206c 6179 6572 7320  existing layers 
+00026a10: 696e 2074 6865 206d 6170 2229 0a20 2020  in the map").   
+00026a20: 2020 2020 2069 6620 636c 6561 723a 0a20       if clear:. 
+00026a30: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
+00026a40: 6179 6572 2069 6e20 6d2e 6c61 7965 7273  ayer in m.layers
+00026a50: 5b31 3a5d 3a0a 2020 2020 2020 2020 2020  [1:]:.          
+00026a60: 2020 2020 2020 6d2e 7265 6d6f 7665 5f6c        m.remove_l
+00026a70: 6179 6572 286c 6179 6572 290a 0a20 2020  ayer(layer)..   
+00026a80: 2020 2020 2064 6562 7567 2822 6164 6420       debug("add 
+00026a90: 6d61 726b 6572 7322 290a 2020 2020 2020  markers").      
+00026aa0: 2020 666f 7220 7820 696e 2064 665f 6d61    for x in df_ma
+00026ab0: 726b 6572 732e 6974 6572 7475 706c 6573  rkers.itertuples
+00026ac0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00026ad0: 6d61 726b 6572 203d 2069 7079 6c65 6166  marker = ipyleaf
+00026ae0: 6c65 742e 4369 7263 6c65 4d61 726b 6572  let.CircleMarker
+00026af0: 2829 0a20 2020 2020 2020 2020 2020 206d  ().            m
+00026b00: 6172 6b65 722e 6c6f 6361 7469 6f6e 203d  arker.location =
+00026b10: 2028 782e 636f 686f 7274 5f6c 6174 5f6d   (x.cohort_lat_m
+00026b20: 6561 6e2c 2078 2e63 6f68 6f72 745f 6c6f  ean, x.cohort_lo
+00026b30: 6e5f 6d65 616e 290a 2020 2020 2020 2020  n_mean).        
+00026b40: 2020 2020 6d61 726b 6572 2e72 6164 6975      marker.radiu
+00026b50: 7320 3d20 3230 0a20 2020 2020 2020 2020  s = 20.         
+00026b60: 2020 206d 6172 6b65 722e 636f 6c6f 7220     marker.color 
+00026b70: 3d20 2262 6c61 636b 220a 2020 2020 2020  = "black".      
+00026b80: 2020 2020 2020 6d61 726b 6572 2e77 6569        marker.wei
+00026b90: 6768 7420 3d20 310a 2020 2020 2020 2020  ght = 1.        
+00026ba0: 2020 2020 6d61 726b 6572 2e66 696c 6c5f      marker.fill_
+00026bb0: 636f 6c6f 7220 3d20 2272 6564 220a 2020  color = "red".  
+00026bc0: 2020 2020 2020 2020 2020 6d61 726b 6572            marker
+00026bd0: 2e66 696c 6c5f 6f70 6163 6974 7920 3d20  .fill_opacity = 
+00026be0: 782e 6576 656e 745f 6672 6571 7565 6e63  x.event_frequenc
+00026bf0: 790a 2020 2020 2020 2020 2020 2020 706f  y.            po
+00026c00: 7075 705f 6874 6d6c 203d 2066 2222 220a  pup_html = f""".
+00026c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c20: 3c73 7472 6f6e 673e 7b76 6172 6961 6e74  <strong>{variant
+00026c30: 5f6c 6162 656c 7d3c 2f73 7472 6f6e 673e  _label}</strong>
+00026c40: 203c 6272 2f3e 0a20 2020 2020 2020 2020   <br/>.         
+00026c50: 2020 2020 2020 2054 6178 6f6e 3a20 7b78         Taxon: {x
+00026c60: 2e63 6f68 6f72 745f 7461 786f 6e7d 203c  .cohort_taxon} <
+00026c70: 6272 2f3e 0a20 2020 2020 2020 2020 2020  br/>.           
+00026c80: 2020 2020 2041 7265 613a 207b 782e 636f       Area: {x.co
+00026c90: 686f 7274 5f61 7265 617d 203c 6272 2f3e  hort_area} <br/>
+00026ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026cb0: 2050 6572 696f 643a 207b 782e 636f 686f   Period: {x.coho
+00026cc0: 7274 5f70 6572 696f 647d 203c 6272 2f3e  rt_period} <br/>
+00026cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026ce0: 2053 616d 706c 6520 7369 7a65 3a20 7b78   Sample size: {x
+00026cf0: 2e63 6f68 6f72 745f 7369 7a65 7d20 3c62  .cohort_size} <b
+00026d00: 722f 3e0a 2020 2020 2020 2020 2020 2020  r/>.            
+00026d10: 2020 2020 4672 6571 7565 6e63 793a 207b      Frequency: {
+00026d20: 782e 6576 656e 745f 6672 6571 7565 6e63  x.event_frequenc
+00026d30: 793a 2e30 257d 0a20 2020 2020 2020 2020  y:.0%}.         
+00026d40: 2020 2020 2020 2028 3935 2520 4349 3a20         (95% CI: 
+00026d50: 7b78 2e65 7665 6e74 5f66 7265 7175 656e  {x.event_frequen
+00026d60: 6379 5f63 695f 6c6f 773a 2e30 257d 202d  cy_ci_low:.0%} -
+00026d70: 207b 782e 6576 656e 745f 6672 6571 7565   {x.event_freque
+00026d80: 6e63 795f 6369 5f75 7070 3a2e 3025 7d29  ncy_ci_upp:.0%})
+00026d90: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+00026da0: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00026db0: 6b65 722e 706f 7075 7020 3d20 6970 796c  ker.popup = ipyl
+00026dc0: 6561 666c 6574 2e50 6f70 7570 280a 2020  eaflet.Popup(.  
+00026dd0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00026de0: 696c 643d 6970 7977 6964 6765 7473 2e48  ild=ipywidgets.H
+00026df0: 544d 4c28 706f 7075 705f 6874 6d6c 292c  TML(popup_html),
+00026e00: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00026e10: 2020 2020 2020 2020 2020 206d 2e61 6464             m.add
+00026e20: 5f6c 6179 6572 286d 6172 6b65 7229 0a0a  _layer(marker)..
+00026e30: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+00026e40: 2020 7375 6d6d 6172 793d 2222 220a 2020    summary=""".  
+00026e50: 2020 2020 2020 2020 2020 4372 6561 7465            Create
+00026e60: 2061 6e20 696e 7465 7261 6374 6976 6520   an interactive 
+00026e70: 6d61 7020 7769 7468 206d 6172 6b65 7273  map with markers
+00026e80: 2073 686f 7769 6e67 2076 6172 6961 6e74   showing variant
+00026e90: 2066 7265 7175 656e 6369 6573 206f 720a   frequencies or.
+00026ea0: 2020 2020 2020 2020 2020 2020 636f 686f              coho
+00026eb0: 7274 7320 6772 6f75 7065 6420 6279 2061  rts grouped by a
+00026ec0: 7265 6120 2873 7061 6365 292c 2070 6572  rea (space), per
+00026ed0: 696f 6420 2874 696d 6529 2061 6e64 2074  iod (time) and t
+00026ee0: 6178 6f6e 2e0a 2020 2020 2020 2020 2222  axon..        ""
+00026ef0: 222c 0a20 2020 2020 2020 2070 6172 616d  ",.        param
+00026f00: 6574 6572 733d 6469 6374 280a 2020 2020  eters=dict(.    
+00026f10: 2020 2020 2020 2020 7469 746c 653d 2222          title=""
+00026f20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00026f30: 2020 4966 2054 7275 652c 2061 7474 656d    If True, attem
+00026f40: 7074 2074 6f20 7573 6520 6d65 7461 6461  pt to use metada
+00026f50: 7461 2066 726f 6d20 696e 7075 7420 6461  ta from input da
+00026f60: 7461 7365 7420 6173 2061 2070 6c6f 740a  taset as a plot.
+00026f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f80: 7469 746c 652e 204f 7468 6572 7769 7365  title. Otherwise
+00026f90: 2c20 7573 6520 7375 7070 6c69 6564 2076  , use supplied v
+00026fa0: 616c 7565 2061 7320 6120 7469 746c 652e  alue as a title.
+00026fb0: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+00026fc0: 2c0a 2020 2020 2020 2020 2020 2020 6570  ,.            ep
+00026fd0: 696c 6f67 7565 3d22 4164 6469 7469 6f6e  ilogue="Addition
+00026fe0: 616c 2074 6578 7420 746f 2064 6973 706c  al text to displ
+00026ff0: 6179 2062 656c 6f77 2074 6865 206d 6170  ay below the map
+00027000: 2e22 2c0a 2020 2020 2020 2020 292c 0a20  .",.        ),. 
+00027010: 2020 2020 2020 2072 6574 7572 6e73 3d22         returns="
+00027020: 2222 0a20 2020 2020 2020 2020 2020 2041  "".            A
+00027030: 6e20 696e 7465 7261 6374 6976 6520 6d61  n interactive ma
+00027040: 7020 7769 7468 2077 6964 6765 7473 2066  p with widgets f
+00027050: 6f72 2073 656c 6563 7469 6e67 2077 6869  or selecting whi
+00027060: 6368 2076 6172 6961 6e74 2c20 7461 786f  ch variant, taxo
+00027070: 6e0a 2020 2020 2020 2020 2020 2020 616e  n.            an
+00027080: 6420 7469 6d65 2070 6572 696f 6420 746f  d time period to
+00027090: 2064 6973 706c 6179 2e0a 2020 2020 2020   display..      
+000270a0: 2020 2222 222c 0a20 2020 2029 0a20 2020    """,.    ).   
+000270b0: 2064 6566 2070 6c6f 745f 6672 6571 7565   def plot_freque
+000270c0: 6e63 6965 735f 696e 7465 7261 6374 6976  ncies_interactiv
+000270d0: 655f 6d61 7028 0a20 2020 2020 2020 2073  e_map(.        s
+000270e0: 656c 662c 0a20 2020 2020 2020 2064 733a  elf,.        ds:
+000270f0: 2066 7271 5f70 6172 616d 732e 6473 5f66   frq_params.ds_f
+00027100: 7265 7175 656e 6369 6573 5f61 6476 616e  requencies_advan
+00027110: 6365 642c 0a20 2020 2020 2020 2063 656e  ced,.        cen
+00027120: 7465 723a 206d 6170 5f70 6172 616d 732e  ter: map_params.
+00027130: 6365 6e74 6572 203d 206d 6170 5f70 6172  center = map_par
+00027140: 616d 732e 6365 6e74 6572 5f64 6566 6175  ams.center_defau
+00027150: 6c74 2c0a 2020 2020 2020 2020 7a6f 6f6d  lt,.        zoom
+00027160: 3a20 6d61 705f 7061 7261 6d73 2e7a 6f6f  : map_params.zoo
+00027170: 6d20 3d20 6d61 705f 7061 7261 6d73 2e7a  m = map_params.z
+00027180: 6f6f 6d5f 6465 6661 756c 742c 0a20 2020  oom_default,.   
+00027190: 2020 2020 2074 6974 6c65 3a20 556e 696f       title: Unio
+000271a0: 6e5b 626f 6f6c 2c20 7374 725d 203d 2054  n[bool, str] = T
+000271b0: 7275 652c 0a20 2020 2020 2020 2065 7069  rue,.        epi
+000271c0: 6c6f 6775 653a 2055 6e69 6f6e 5b62 6f6f  logue: Union[boo
+000271d0: 6c2c 2073 7472 5d20 3d20 5472 7565 2c0a  l, str] = True,.
+000271e0: 2020 2020 293a 0a20 2020 2020 2020 2064      ):.        d
+000271f0: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
+00027200: 2e64 6562 7567 0a0a 2020 2020 2020 2020  .debug..        
+00027210: 696d 706f 7274 2069 7079 6c65 6166 6c65  import ipyleafle
+00027220: 740a 2020 2020 2020 2020 696d 706f 7274  t.        import
+00027230: 2069 7079 7769 6467 6574 730a 0a20 2020   ipywidgets..   
+00027240: 2020 2020 2064 6562 7567 2822 6861 6e64       debug("hand
+00027250: 6c65 2074 6974 6c65 2229 0a20 2020 2020  le title").     
+00027260: 2020 2069 6620 7469 746c 6520 6973 2054     if title is T
+00027270: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00027280: 2074 6974 6c65 203d 2064 732e 6174 7472   title = ds.attr
+00027290: 732e 6765 7428 2274 6974 6c65 222c 204e  s.get("title", N
+000272a0: 6f6e 6529 0a0a 2020 2020 2020 2020 6465  one)..        de
+000272b0: 6275 6728 2263 7265 6174 6520 6120 6d61  bug("create a ma
+000272c0: 7022 290a 2020 2020 2020 2020 6672 6571  p").        freq
+000272d0: 5f6d 6170 203d 2069 7079 6c65 6166 6c65  _map = ipyleafle
+000272e0: 742e 4d61 7028 6365 6e74 6572 3d63 656e  t.Map(center=cen
+000272f0: 7465 722c 207a 6f6f 6d3d 7a6f 6f6d 290a  ter, zoom=zoom).
+00027300: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+00027310: 7365 7420 7570 2069 6e74 6572 6163 7469  set up interacti
+00027320: 7665 2063 6f6e 7472 6f6c 7322 290a 2020  ve controls").  
+00027330: 2020 2020 2020 7661 7269 616e 7473 203d        variants =
+00027340: 2064 735b 2276 6172 6961 6e74 5f6c 6162   ds["variant_lab
+00027350: 656c 225d 2e76 616c 7565 730a 2020 2020  el"].values.    
+00027360: 2020 2020 7461 7861 203d 206e 702e 756e      taxa = np.un
+00027370: 6971 7565 2864 735b 2263 6f68 6f72 745f  ique(ds["cohort_
+00027380: 7461 786f 6e22 5d2e 7661 6c75 6573 290a  taxon"].values).
+00027390: 2020 2020 2020 2020 7065 7269 6f64 7320          periods 
+000273a0: 3d20 6e70 2e75 6e69 7175 6528 6473 5b22  = np.unique(ds["
+000273b0: 636f 686f 7274 5f70 6572 696f 6422 5d2e  cohort_period"].
+000273c0: 7661 6c75 6573 290a 2020 2020 2020 2020  values).        
+000273d0: 636f 6e74 726f 6c73 203d 2069 7079 7769  controls = ipywi
+000273e0: 6467 6574 732e 696e 7465 7261 6374 6976  dgets.interactiv
+000273f0: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
+00027400: 656c 662e 706c 6f74 5f66 7265 7175 656e  elf.plot_frequen
+00027410: 6369 6573 5f6d 6170 5f6d 6172 6b65 7273  cies_map_markers
+00027420: 2c0a 2020 2020 2020 2020 2020 2020 6d3d  ,.            m=
+00027430: 6970 7977 6964 6765 7473 2e66 6978 6564  ipywidgets.fixed
+00027440: 2866 7265 715f 6d61 7029 2c0a 2020 2020  (freq_map),.    
+00027450: 2020 2020 2020 2020 6473 3d69 7079 7769          ds=ipywi
+00027460: 6467 6574 732e 6669 7865 6428 6473 292c  dgets.fixed(ds),
+00027470: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+00027480: 6961 6e74 3d69 7079 7769 6467 6574 732e  iant=ipywidgets.
+00027490: 4472 6f70 646f 776e 286f 7074 696f 6e73  Dropdown(options
+000274a0: 3d76 6172 6961 6e74 732c 2064 6573 6372  =variants, descr
+000274b0: 6970 7469 6f6e 3d22 5661 7269 616e 743a  iption="Variant:
+000274c0: 2022 292c 0a20 2020 2020 2020 2020 2020   "),.           
+000274d0: 2074 6178 6f6e 3d69 7079 7769 6467 6574   taxon=ipywidget
+000274e0: 732e 4472 6f70 646f 776e 286f 7074 696f  s.Dropdown(optio
+000274f0: 6e73 3d74 6178 612c 2064 6573 6372 6970  ns=taxa, descrip
+00027500: 7469 6f6e 3d22 5461 786f 6e3a 2022 292c  tion="Taxon: "),
+00027510: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
+00027520: 696f 643d 6970 7977 6964 6765 7473 2e44  iod=ipywidgets.D
+00027530: 726f 7064 6f77 6e28 6f70 7469 6f6e 733d  ropdown(options=
+00027540: 7065 7269 6f64 732c 2064 6573 6372 6970  periods, descrip
+00027550: 7469 6f6e 3d22 5065 7269 6f64 3a20 2229  tion="Period: ")
+00027560: 2c0a 2020 2020 2020 2020 2020 2020 636c  ,.            cl
+00027570: 6561 723d 6970 7977 6964 6765 7473 2e66  ear=ipywidgets.f
+00027580: 6978 6564 2854 7275 6529 2c0a 2020 2020  ixed(True),.    
+00027590: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+000275a0: 6562 7567 2822 6c61 7920 6f75 7420 7769  ebug("lay out wi
+000275b0: 6467 6574 7322 290a 2020 2020 2020 2020  dgets").        
+000275c0: 636f 6d70 6f6e 656e 7473 203d 205b 5d0a  components = [].
+000275d0: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
+000275e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000275f0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+00027600: 656e 7473 2e61 7070 656e 6428 6970 7977  ents.append(ipyw
+00027610: 6964 6765 7473 2e48 544d 4c28 7661 6c75  idgets.HTML(valu
+00027620: 653d 6622 3c68 333e 7b74 6974 6c65 7d3c  e=f"<h3>{title}<
+00027630: 2f68 333e 2229 290a 2020 2020 2020 2020  /h3>")).        
+00027640: 636f 6d70 6f6e 656e 7473 2e61 7070 656e  components.appen
+00027650: 6428 636f 6e74 726f 6c73 290a 2020 2020  d(controls).    
+00027660: 2020 2020 636f 6d70 6f6e 656e 7473 2e61      components.a
+00027670: 7070 656e 6428 6672 6571 5f6d 6170 290a  ppend(freq_map).
+00027680: 2020 2020 2020 2020 6966 2065 7069 6c6f          if epilo
+00027690: 6775 6520 6973 2054 7275 653a 0a20 2020  gue is True:.   
+000276a0: 2020 2020 2020 2020 2065 7069 6c6f 6775           epilogu
+000276b0: 6520 3d20 2222 220a 2020 2020 2020 2020  e = """.        
+000276c0: 2020 2020 2020 2020 5661 7269 616e 7420          Variant 
+000276d0: 6672 6571 7565 6e63 6965 7320 6172 6520  frequencies are 
+000276e0: 7368 6f77 6e20 6173 2063 6f6c 6f75 7265  shown as coloure
+000276f0: 6420 6d61 726b 6572 732e 204f 7061 6369  d markers. Opaci
+00027700: 7479 206f 6620 636f 6c6f 720a 2020 2020  ty of color.    
+00027710: 2020 2020 2020 2020 2020 2020 6465 6e6f              deno
+00027720: 7465 7320 6672 6571 7565 6e63 792e 2043  tes frequency. C
+00027730: 6c69 636b 206f 6e20 6120 6d61 726b 6572  lick on a marker
+00027740: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
+00027750: 6174 696f 6e2e 0a20 2020 2020 2020 2020  ation..         
+00027760: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00027770: 6620 6570 696c 6f67 7565 3a0a 2020 2020  f epilogue:.    
+00027780: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00027790: 7473 2e61 7070 656e 6428 6970 7977 6964  ts.append(ipywid
+000277a0: 6765 7473 2e48 544d 4c28 7661 6c75 653d  gets.HTML(value=
+000277b0: 6622 7b65 7069 6c6f 6775 657d 2229 290a  f"{epilogue}")).
+000277c0: 0a20 2020 2020 2020 206f 7574 203d 2069  .        out = i
+000277d0: 7079 7769 6467 6574 732e 5642 6f78 2863  pywidgets.VBox(c
+000277e0: 6f6d 706f 6e65 6e74 7329 0a0a 2020 2020  omponents)..    
+000277f0: 2020 2020 7265 7475 726e 206f 7574 0a0a      return out..
+00027800: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+00027810: 2020 7375 6d6d 6172 793d 2222 220a 2020    summary=""".  
+00027820: 2020 2020 2020 2020 2020 506c 6f74 2073            Plot s
+00027830: 616d 706c 6520 636f 6f72 6469 6e61 7465  ample coordinate
+00027840: 7320 6672 6f6d 2061 2070 7269 6e63 6970  s from a princip
+00027850: 616c 2063 6f6d 706f 6e65 6e74 7320 616e  al components an
+00027860: 616c 7973 6973 2028 5043 4129 0a20 2020  alysis (PCA).   
+00027870: 2020 2020 2020 2020 2061 7320 6120 706c           as a pl
+00027880: 6f74 6c79 2073 6361 7474 6572 2070 6c6f  otly scatter plo
+00027890: 742e 0a20 2020 2020 2020 2022 2222 2c0a  t..        """,.
+000278a0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+000278b0: 7273 3d64 6963 7428 0a20 2020 2020 2020  rs=dict(.       
+000278c0: 2020 2020 206b 7761 7267 733d 2250 6173       kwargs="Pas
+000278d0: 7365 6420 7468 726f 7567 6820 746f 2060  sed through to `
+000278e0: 7078 2e73 6361 7474 6572 2829 6022 2c0a  px.scatter()`",.
+000278f0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+00027900: 0a20 2020 2064 6566 2070 6c6f 745f 7063  .    def plot_pc
+00027910: 615f 636f 6f72 6473 280a 2020 2020 2020  a_coords(.      
+00027920: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00027930: 6461 7461 3a20 7063 615f 7061 7261 6d73  data: pca_params
+00027940: 2e64 665f 7063 612c 0a20 2020 2020 2020  .df_pca,.       
+00027950: 2078 3a20 706c 6f74 6c79 5f70 6172 616d   x: plotly_param
+00027960: 732e 7820 3d20 2250 4331 222c 0a20 2020  s.x = "PC1",.   
+00027970: 2020 2020 2079 3a20 706c 6f74 6c79 5f70       y: plotly_p
+00027980: 6172 616d 732e 7920 3d20 2250 4332 222c  arams.y = "PC2",
+00027990: 0a20 2020 2020 2020 2063 6f6c 6f72 3a20  .        color: 
+000279a0: 706c 6f74 6c79 5f70 6172 616d 732e 636f  plotly_params.co
+000279b0: 6c6f 7220 3d20 4e6f 6e65 2c0a 2020 2020  lor = None,.    
+000279c0: 2020 2020 7379 6d62 6f6c 3a20 706c 6f74      symbol: plot
+000279d0: 6c79 5f70 6172 616d 732e 7379 6d62 6f6c  ly_params.symbol
+000279e0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000279f0: 206a 6974 7465 725f 6672 6163 3a20 706c   jitter_frac: pl
+00027a00: 6f74 6c79 5f70 6172 616d 732e 6a69 7474  otly_params.jitt
+00027a10: 6572 5f66 7261 6320 3d20 302e 3032 2c0a  er_frac = 0.02,.
+00027a20: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
+00027a30: 6565 643a 2062 6173 655f 7061 7261 6d73  eed: base_params
+00027a40: 2e72 616e 646f 6d5f 7365 6564 203d 2034  .random_seed = 4
+00027a50: 322c 0a20 2020 2020 2020 2077 6964 7468  2,.        width
+00027a60: 3a20 706c 6f74 6c79 5f70 6172 616d 732e  : plotly_params.
+00027a70: 7769 6474 6820 3d20 3930 302c 0a20 2020  width = 900,.   
+00027a80: 2020 2020 2068 6569 6768 743a 2070 6c6f       height: plo
+00027a90: 746c 795f 7061 7261 6d73 2e68 6569 6768  tly_params.heigh
+00027aa0: 7420 3d20 3630 302c 0a20 2020 2020 2020  t = 600,.       
+00027ab0: 206d 6172 6b65 725f 7369 7a65 3a20 706c   marker_size: pl
+00027ac0: 6f74 6c79 5f70 6172 616d 732e 6d61 726b  otly_params.mark
+00027ad0: 6572 5f73 697a 6520 3d20 3130 2c0a 2020  er_size = 10,.  
+00027ae0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+00027af0: 2020 2020 2920 2d3e 2070 6c6f 746c 795f      ) -> plotly_
+00027b00: 7061 7261 6d73 2e66 6967 7572 653a 0a20  params.figure:. 
+00027b10: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
+00027b20: 656c 662e 5f6c 6f67 2e64 6562 7567 0a0a  elf._log.debug..
+00027b30: 2020 2020 2020 2020 6465 6275 6728 0a20          debug(. 
+00027b40: 2020 2020 2020 2020 2020 2022 7365 7420             "set 
+00027b50: 7570 2064 6174 6120 2d20 636f 7079 2061  up data - copy a
+00027b60: 6e64 2073 6875 6666 6c65 2073 6f20 7468  nd shuffle so th
+00027b70: 6174 2077 6520 646f 6e27 7420 6765 7420  at we don't get 
+00027b80: 7379 7374 656d 6174 6963 206f 7665 722d  systematic over-
+00027b90: 706c 6f74 7469 6e67 220a 2020 2020 2020  plotting".      
+00027ba0: 2020 290a 2020 2020 2020 2020 2320 544f    ).        # TO
+00027bb0: 444f 2064 6f65 7320 7468 6520 7368 7566  DO does the shuf
+00027bc0: 666c 696e 6720 6163 7475 616c 6c79 2077  fling actually w
+00027bd0: 6f72 6b3f 0a20 2020 2020 2020 2064 6174  ork?.        dat
+00027be0: 6120 3d20 280a 2020 2020 2020 2020 2020  a = (.          
+00027bf0: 2020 6461 7461 2e63 6f70 7928 292e 7361    data.copy().sa
+00027c00: 6d70 6c65 2866 7261 633d 312c 2072 616e  mple(frac=1, ran
+00027c10: 646f 6d5f 7374 6174 653d 7261 6e64 6f6d  dom_state=random
+00027c20: 5f73 6565 6429 2e72 6573 6574 5f69 6e64  _seed).reset_ind
+00027c30: 6578 2864 726f 703d 5472 7565 290a 2020  ex(drop=True).  
+00027c40: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00027c50: 2064 6562 7567 280a 2020 2020 2020 2020   debug(.        
+00027c60: 2020 2020 2261 7070 6c79 206a 6974 7465      "apply jitte
+00027c70: 7220 6966 2064 6573 6972 6564 202d 2068  r if desired - h
+00027c80: 656c 7073 2073 7072 6561 6420 6f75 7420  elps spread out 
+00027c90: 706f 696e 7473 2077 6865 6e20 7469 6768  points when tigh
+00027ca0: 746c 7920 636c 7573 7465 7265 6422 0a20  tly clustered". 
+00027cb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00027cc0: 2069 6620 6a69 7474 6572 5f66 7261 633a   if jitter_frac:
+00027cd0: 0a20 2020 2020 2020 2020 2020 206e 702e  .            np.
+00027ce0: 7261 6e64 6f6d 2e73 6565 6428 7261 6e64  random.seed(rand
+00027cf0: 6f6d 5f73 6565 6429 0a20 2020 2020 2020  om_seed).       
+00027d00: 2020 2020 2064 6174 615b 785d 203d 206a       data[x] = j
+00027d10: 6974 7465 7228 6461 7461 5b78 5d2c 206a  itter(data[x], j
+00027d20: 6974 7465 725f 6672 6163 290a 2020 2020  itter_frac).    
+00027d30: 2020 2020 2020 2020 6461 7461 5b79 5d20          data[y] 
+00027d40: 3d20 6a69 7474 6572 2864 6174 615b 795d  = jitter(data[y]
+00027d50: 2c20 6a69 7474 6572 5f66 7261 6329 0a0a  , jitter_frac)..
+00027d60: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
+00027d70: 6f6e 7665 6e69 656e 6365 2076 6172 6961  onvenience varia
+00027d80: 626c 6573 2229 0a20 2020 2020 2020 2064  bles").        d
+00027d90: 6174 615b 2263 6f75 6e74 7279 5f6c 6f63  ata["country_loc
+00027da0: 6174 696f 6e22 5d20 3d20 6461 7461 5b22  ation"] = data["
+00027db0: 636f 756e 7472 7922 5d20 2b20 2220 2d20  country"] + " - 
+00027dc0: 2220 2b20 6461 7461 5b22 6c6f 6361 7469  " + data["locati
+00027dd0: 6f6e 225d 0a0a 2020 2020 2020 2020 6465  on"]..        de
+00027de0: 6275 6728 2273 6574 2075 7020 706c 6f74  bug("set up plot
+00027df0: 7469 6e67 206f 7074 696f 6e73 2229 0a20  ting options"). 
+00027e00: 2020 2020 2020 2068 6f76 6572 5f64 6174         hover_dat
+00027e10: 6120 3d20 5b0a 2020 2020 2020 2020 2020  a = [.          
+00027e20: 2020 2270 6172 746e 6572 5f73 616d 706c    "partner_sampl
+00027e30: 655f 6964 222c 0a20 2020 2020 2020 2020  e_id",.         
+00027e40: 2020 2022 7361 6d70 6c65 5f73 6574 222c     "sample_set",
+00027e50: 0a20 2020 2020 2020 2020 2020 2022 7461  .            "ta
+00027e60: 786f 6e22 2c0a 2020 2020 2020 2020 2020  xon",.          
+00027e70: 2020 2263 6f75 6e74 7279 222c 0a20 2020    "country",.   
+00027e80: 2020 2020 2020 2020 2022 6164 6d69 6e31           "admin1
+00027e90: 5f69 736f 222c 0a20 2020 2020 2020 2020  _iso",.         
+00027ea0: 2020 2022 6164 6d69 6e31 5f6e 616d 6522     "admin1_name"
+00027eb0: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
+00027ec0: 646d 696e 325f 6e61 6d65 222c 0a20 2020  dmin2_name",.   
+00027ed0: 2020 2020 2020 2020 2022 6c6f 6361 7469           "locati
+00027ee0: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
+00027ef0: 2022 7965 6172 222c 0a20 2020 2020 2020   "year",.       
+00027f00: 2020 2020 2022 6d6f 6e74 6822 2c0a 2020       "month",.  
+00027f10: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00027f20: 706c 6f74 5f6b 7761 7267 7320 3d20 6469  plot_kwargs = di
+00027f30: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+00027f40: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
+00027f50: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+00027f60: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
+00027f70: 2020 2020 636f 6c6f 723d 636f 6c6f 722c      color=color,
+00027f80: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
+00027f90: 626f 6c3d 7379 6d62 6f6c 2c0a 2020 2020  bol=symbol,.    
+00027fa0: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
+00027fb0: 3d22 7369 6d70 6c65 5f77 6869 7465 222c  ="simple_white",
+00027fc0: 0a20 2020 2020 2020 2020 2020 2068 6f76  .            hov
+00027fd0: 6572 5f6e 616d 653d 2273 616d 706c 655f  er_name="sample_
+00027fe0: 6964 222c 0a20 2020 2020 2020 2020 2020  id",.           
+00027ff0: 2068 6f76 6572 5f64 6174 613d 686f 7665   hover_data=hove
+00028000: 725f 6461 7461 2c0a 2020 2020 2020 2020  r_data,.        
+00028010: 2020 2020 6f70 6163 6974 793d 302e 392c      opacity=0.9,
+00028020: 0a20 2020 2020 2020 2020 2020 2072 656e  .            ren
+00028030: 6465 725f 6d6f 6465 3d22 7376 6722 2c0a  der_mode="svg",.
+00028040: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00028050: 2020 2064 6562 7567 2822 7370 6563 6961     debug("specia
+00028060: 6c20 6861 6e64 6c69 6e67 2066 6f72 2074  l handling for t
+00028070: 6178 6f6e 2063 6f6c 6f72 2229 0a20 2020  axon color").   
+00028080: 2020 2020 2069 6620 636f 6c6f 7220 3d3d       if color ==
+00028090: 2022 7461 786f 6e22 3a0a 2020 2020 2020   "taxon":.      
+000280a0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+000280b0: 705f 7461 786f 6e5f 636f 6c6f 7273 2870  p_taxon_colors(p
+000280c0: 6c6f 745f 6b77 6172 6773 290a 0a20 2020  lot_kwargs)..   
+000280d0: 2020 2020 2064 6562 7567 2822 6170 706c       debug("appl
+000280e0: 7920 616e 7920 7573 6572 206f 7665 7272  y any user overr
+000280f0: 6964 6573 2229 0a20 2020 2020 2020 2070  ides").        p
+00028100: 6c6f 745f 6b77 6172 6773 2e75 7064 6174  lot_kwargs.updat
+00028110: 6528 6b77 6172 6773 290a 0a20 2020 2020  e(kwargs)..     
+00028120: 2020 2064 6562 7567 2822 3244 2073 6361     debug("2D sca
+00028130: 7474 6572 2070 6c6f 7422 290a 2020 2020  tter plot").    
+00028140: 2020 2020 6669 6720 3d20 7078 2e73 6361      fig = px.sca
+00028150: 7474 6572 2864 6174 612c 2078 3d78 2c20  tter(data, x=x, 
+00028160: 793d 792c 202a 2a70 6c6f 745f 6b77 6172  y=y, **plot_kwar
+00028170: 6773 290a 0a20 2020 2020 2020 2064 6562  gs)..        deb
+00028180: 7567 2822 7469 6479 2075 7022 290a 2020  ug("tidy up").  
+00028190: 2020 2020 2020 6669 672e 7570 6461 7465        fig.update
+000281a0: 5f6c 6179 6f75 7428 0a20 2020 2020 2020  _layout(.       
+000281b0: 2020 2020 206c 6567 656e 643d 6469 6374       legend=dict
+000281c0: 2869 7465 6d73 697a 696e 673d 2263 6f6e  (itemsizing="con
+000281d0: 7374 616e 7422 292c 0a20 2020 2020 2020  stant"),.       
+000281e0: 2029 0a20 2020 2020 2020 2066 6967 2e75   ).        fig.u
+000281f0: 7064 6174 655f 7472 6163 6573 286d 6172  pdate_traces(mar
+00028200: 6b65 723d 7b22 7369 7a65 223a 206d 6172  ker={"size": mar
+00028210: 6b65 725f 7369 7a65 7d29 0a0a 2020 2020  ker_size})..    
+00028220: 2020 2020 7265 7475 726e 2066 6967 0a0a      return fig..
+00028230: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+00028240: 2020 7375 6d6d 6172 793d 2222 220a 2020    summary=""".  
+00028250: 2020 2020 2020 2020 2020 506c 6f74 2073            Plot s
+00028260: 616d 706c 6520 636f 6f72 6469 6e61 7465  ample coordinate
+00028270: 7320 6672 6f6d 2061 2070 7269 6e63 6970  s from a princip
+00028280: 616c 2063 6f6d 706f 6e65 6e74 7320 616e  al components an
+00028290: 616c 7973 6973 2028 5043 4129 0a20 2020  alysis (PCA).   
+000282a0: 2020 2020 2020 2020 2061 7320 6120 706c           as a pl
+000282b0: 6f74 6c79 2033 4420 7363 6174 7465 7220  otly 3D scatter 
+000282c0: 706c 6f74 2e0a 2020 2020 2020 2020 2222  plot..        ""
+000282d0: 222c 0a20 2020 2020 2020 2070 6172 616d  ",.        param
+000282e0: 6574 6572 733d 6469 6374 280a 2020 2020  eters=dict(.    
+000282f0: 2020 2020 2020 2020 6b77 6172 6773 3d22          kwargs="
+00028300: 5061 7373 6564 2074 6872 6f75 6768 2074  Passed through t
+00028310: 6f20 6070 782e 7363 6174 7465 725f 3364  o `px.scatter_3d
+00028320: 2829 6022 2c0a 2020 2020 2020 2020 292c  ()`",.        ),
+00028330: 0a20 2020 2029 0a20 2020 2064 6566 2070  .    ).    def p
+00028340: 6c6f 745f 7063 615f 636f 6f72 6473 5f33  lot_pca_coords_3
+00028350: 6428 0a20 2020 2020 2020 2073 656c 662c  d(.        self,
+00028360: 0a20 2020 2020 2020 2064 6174 613a 2070  .        data: p
+00028370: 6361 5f70 6172 616d 732e 6466 5f70 6361  ca_params.df_pca
+00028380: 2c0a 2020 2020 2020 2020 783a 2070 6c6f  ,.        x: plo
+00028390: 746c 795f 7061 7261 6d73 2e78 203d 2022  tly_params.x = "
+000283a0: 5043 3122 2c0a 2020 2020 2020 2020 793a  PC1",.        y:
+000283b0: 2070 6c6f 746c 795f 7061 7261 6d73 2e79   plotly_params.y
+000283c0: 203d 2022 5043 3222 2c0a 2020 2020 2020   = "PC2",.      
+000283d0: 2020 7a3a 2070 6c6f 746c 795f 7061 7261    z: plotly_para
+000283e0: 6d73 2e7a 203d 2022 5043 3322 2c0a 2020  ms.z = "PC3",.  
+000283f0: 2020 2020 2020 636f 6c6f 723a 2070 6c6f        color: plo
+00028400: 746c 795f 7061 7261 6d73 2e63 6f6c 6f72  tly_params.color
+00028410: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00028420: 2073 796d 626f 6c3a 2070 6c6f 746c 795f   symbol: plotly_
+00028430: 7061 7261 6d73 2e73 796d 626f 6c20 3d20  params.symbol = 
+00028440: 4e6f 6e65 2c0a 2020 2020 2020 2020 6a69  None,.        ji
+00028450: 7474 6572 5f66 7261 633a 2070 6c6f 746c  tter_frac: plotl
+00028460: 795f 7061 7261 6d73 2e6a 6974 7465 725f  y_params.jitter_
+00028470: 6672 6163 203d 2030 2e30 322c 0a20 2020  frac = 0.02,.   
+00028480: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+00028490: 3a20 6261 7365 5f70 6172 616d 732e 7261  : base_params.ra
+000284a0: 6e64 6f6d 5f73 6565 6420 3d20 3432 2c0a  ndom_seed = 42,.
+000284b0: 2020 2020 2020 2020 7769 6474 683a 2070          width: p
+000284c0: 6c6f 746c 795f 7061 7261 6d73 2e77 6964  lotly_params.wid
+000284d0: 7468 203d 2039 3030 2c0a 2020 2020 2020  th = 900,.      
+000284e0: 2020 6865 6967 6874 3a20 706c 6f74 6c79    height: plotly
+000284f0: 5f70 6172 616d 732e 6865 6967 6874 203d  _params.height =
+00028500: 2036 3030 2c0a 2020 2020 2020 2020 6d61   600,.        ma
+00028510: 726b 6572 5f73 697a 653a 2070 6c6f 746c  rker_size: plotl
+00028520: 795f 7061 7261 6d73 2e6d 6172 6b65 725f  y_params.marker_
+00028530: 7369 7a65 203d 2035 2c0a 2020 2020 2020  size = 5,.      
+00028540: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00028550: 2920 2d3e 2070 6c6f 746c 795f 7061 7261  ) -> plotly_para
+00028560: 6d73 2e66 6967 7572 653a 0a20 2020 2020  ms.figure:.     
+00028570: 2020 2064 6562 7567 203d 2073 656c 662e     debug = self.
+00028580: 5f6c 6f67 2e64 6562 7567 0a0a 2020 2020  _log.debug..    
+00028590: 2020 2020 6465 6275 6728 0a20 2020 2020      debug(.     
+000285a0: 2020 2020 2020 2022 7365 7420 7570 2064         "set up d
+000285b0: 6174 6120 2d20 636f 7079 2061 6e64 2073  ata - copy and s
+000285c0: 6875 6666 6c65 2073 6f20 7468 6174 2077  huffle so that w
+000285d0: 6520 646f 6e27 7420 6765 7420 7379 7374  e don't get syst
+000285e0: 656d 6174 6963 206f 7665 722d 706c 6f74  ematic over-plot
+000285f0: 7469 6e67 220a 2020 2020 2020 2020 290a  ting".        ).
+00028600: 2020 2020 2020 2020 2320 544f 444f 2064          # TODO d
+00028610: 6f65 7320 7468 6973 2061 6374 7561 6c6c  oes this actuall
+00028620: 7920 776f 726b 3f0a 2020 2020 2020 2020  y work?.        
+00028630: 6461 7461 203d 2028 0a20 2020 2020 2020  data = (.       
+00028640: 2020 2020 2064 6174 612e 636f 7079 2829       data.copy()
+00028650: 2e73 616d 706c 6528 6672 6163 3d31 2c20  .sample(frac=1, 
+00028660: 7261 6e64 6f6d 5f73 7461 7465 3d72 616e  random_state=ran
+00028670: 646f 6d5f 7365 6564 292e 7265 7365 745f  dom_seed).reset_
+00028680: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+00028690: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000286a0: 2020 2020 6465 6275 6728 0a20 2020 2020      debug(.     
+000286b0: 2020 2020 2020 2022 6170 706c 7920 6a69         "apply ji
+000286c0: 7474 6572 2069 6620 6465 7369 7265 6420  tter if desired 
+000286d0: 2d20 6865 6c70 7320 7370 7265 6164 206f  - helps spread o
+000286e0: 7574 2070 6f69 6e74 7320 7768 656e 2074  ut points when t
+000286f0: 6967 6874 6c79 2063 6c75 7374 6572 6564  ightly clustered
+00028700: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00028710: 2020 2020 6966 206a 6974 7465 725f 6672      if jitter_fr
+00028720: 6163 3a0a 2020 2020 2020 2020 2020 2020  ac:.            
+00028730: 6e70 2e72 616e 646f 6d2e 7365 6564 2872  np.random.seed(r
+00028740: 616e 646f 6d5f 7365 6564 290a 2020 2020  andom_seed).    
+00028750: 2020 2020 2020 2020 6461 7461 5b78 5d20          data[x] 
+00028760: 3d20 6a69 7474 6572 2864 6174 615b 785d  = jitter(data[x]
+00028770: 2c20 6a69 7474 6572 5f66 7261 6329 0a20  , jitter_frac). 
+00028780: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+00028790: 795d 203d 206a 6974 7465 7228 6461 7461  y] = jitter(data
+000287a0: 5b79 5d2c 206a 6974 7465 725f 6672 6163  [y], jitter_frac
+000287b0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
+000287c0: 7461 5b7a 5d20 3d20 6a69 7474 6572 2864  ta[z] = jitter(d
+000287d0: 6174 615b 7a5d 2c20 6a69 7474 6572 5f66  ata[z], jitter_f
+000287e0: 7261 6329 0a0a 2020 2020 2020 2020 6465  rac)..        de
+000287f0: 6275 6728 2263 6f6e 7665 6e69 656e 6365  bug("convenience
+00028800: 2076 6172 6961 626c 6573 2229 0a20 2020   variables").   
+00028810: 2020 2020 2064 6174 615b 2263 6f75 6e74       data["count
+00028820: 7279 5f6c 6f63 6174 696f 6e22 5d20 3d20  ry_location"] = 
+00028830: 6461 7461 5b22 636f 756e 7472 7922 5d20  data["country"] 
+00028840: 2b20 2220 2d20 2220 2b20 6461 7461 5b22  + " - " + data["
+00028850: 6c6f 6361 7469 6f6e 225d 0a0a 2020 2020  location"]..    
+00028860: 2020 2020 6465 6275 6728 2273 6574 2075      debug("set u
+00028870: 7020 706c 6f74 7469 6e67 206f 7074 696f  p plotting optio
+00028880: 6e73 2229 0a20 2020 2020 2020 2068 6f76  ns").        hov
+00028890: 6572 5f64 6174 6120 3d20 5b0a 2020 2020  er_data = [.    
+000288a0: 2020 2020 2020 2020 2270 6172 746e 6572          "partner
+000288b0: 5f73 616d 706c 655f 6964 222c 0a20 2020  _sample_id",.   
+000288c0: 2020 2020 2020 2020 2022 7361 6d70 6c65           "sample
+000288d0: 5f73 6574 222c 0a20 2020 2020 2020 2020  _set",.         
+000288e0: 2020 2022 7461 786f 6e22 2c0a 2020 2020     "taxon",.    
+000288f0: 2020 2020 2020 2020 2263 6f75 6e74 7279          "country
+00028900: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00028910: 6164 6d69 6e31 5f69 736f 222c 0a20 2020  admin1_iso",.   
+00028920: 2020 2020 2020 2020 2022 6164 6d69 6e31           "admin1
+00028930: 5f6e 616d 6522 2c0a 2020 2020 2020 2020  _name",.        
+00028940: 2020 2020 2261 646d 696e 325f 6e61 6d65      "admin2_name
+00028950: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00028960: 6c6f 6361 7469 6f6e 222c 0a20 2020 2020  location",.     
+00028970: 2020 2020 2020 2022 7965 6172 222c 0a20         "year",. 
+00028980: 2020 2020 2020 2020 2020 2022 6d6f 6e74             "mont
+00028990: 6822 2c0a 2020 2020 2020 2020 5d0a 2020  h",.        ].  
+000289a0: 2020 2020 2020 706c 6f74 5f6b 7761 7267        plot_kwarg
+000289b0: 7320 3d20 6469 6374 280a 2020 2020 2020  s = dict(.      
+000289c0: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
+000289d0: 682c 0a20 2020 2020 2020 2020 2020 2068  h,.            h
+000289e0: 6569 6768 743d 6865 6967 6874 2c0a 2020  eight=height,.  
+000289f0: 2020 2020 2020 2020 2020 686f 7665 725f            hover_
+00028a00: 6e61 6d65 3d22 7361 6d70 6c65 5f69 6422  name="sample_id"
+00028a10: 2c0a 2020 2020 2020 2020 2020 2020 686f  ,.            ho
+00028a20: 7665 725f 6461 7461 3d68 6f76 6572 5f64  ver_data=hover_d
+00028a30: 6174 612c 0a20 2020 2020 2020 2020 2020  ata,.           
+00028a40: 2063 6f6c 6f72 3d63 6f6c 6f72 2c0a 2020   color=color,.  
+00028a50: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
+00028a60: 3d73 796d 626f 6c2c 0a20 2020 2020 2020  =symbol,.       
+00028a70: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
+00028a80: 6728 2273 7065 6369 616c 2068 616e 646c  g("special handl
+00028a90: 696e 6720 666f 7220 7461 786f 6e20 636f  ing for taxon co
+00028aa0: 6c6f 7222 290a 2020 2020 2020 2020 6966  lor").        if
+00028ab0: 2063 6f6c 6f72 203d 3d20 2274 6178 6f6e   color == "taxon
+00028ac0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+00028ad0: 656c 662e 5f73 6574 7570 5f74 6178 6f6e  elf._setup_taxon
+00028ae0: 5f63 6f6c 6f72 7328 706c 6f74 5f6b 7761  _colors(plot_kwa
+00028af0: 7267 7329 0a0a 2020 2020 2020 2020 6465  rgs)..        de
+00028b00: 6275 6728 2261 7070 6c79 2061 6e79 2075  bug("apply any u
+00028b10: 7365 7220 6f76 6572 7269 6465 7322 290a  ser overrides").
+00028b20: 2020 2020 2020 2020 706c 6f74 5f6b 7761          plot_kwa
+00028b30: 7267 732e 7570 6461 7465 286b 7761 7267  rgs.update(kwarg
+00028b40: 7329 0a0a 2020 2020 2020 2020 6465 6275  s)..        debu
+00028b50: 6728 2233 4420 7363 6174 7465 7220 706c  g("3D scatter pl
+00028b60: 6f74 2229 0a20 2020 2020 2020 2066 6967  ot").        fig
+00028b70: 203d 2070 782e 7363 6174 7465 725f 3364   = px.scatter_3d
+00028b80: 2864 6174 612c 2078 3d78 2c20 793d 792c  (data, x=x, y=y,
+00028b90: 207a 3d7a 2c20 2a2a 706c 6f74 5f6b 7761   z=z, **plot_kwa
+00028ba0: 7267 7329 0a0a 2020 2020 2020 2020 6465  rgs)..        de
+00028bb0: 6275 6728 2274 6964 7920 7570 2229 0a20  bug("tidy up"). 
+00028bc0: 2020 2020 2020 2066 6967 2e75 7064 6174         fig.updat
+00028bd0: 655f 6c61 796f 7574 280a 2020 2020 2020  e_layout(.      
+00028be0: 2020 2020 2020 7363 656e 653d 6469 6374        scene=dict
+00028bf0: 2861 7370 6563 746d 6f64 653d 2263 7562  (aspectmode="cub
+00028c00: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
+00028c10: 206c 6567 656e 643d 6469 6374 2869 7465   legend=dict(ite
+00028c20: 6d73 697a 696e 673d 2263 6f6e 7374 616e  msizing="constan
+00028c30: 7422 292c 0a20 2020 2020 2020 2029 0a20  t"),.        ). 
+00028c40: 2020 2020 2020 2066 6967 2e75 7064 6174         fig.updat
+00028c50: 655f 7472 6163 6573 286d 6172 6b65 723d  e_traces(marker=
+00028c60: 7b22 7369 7a65 223a 206d 6172 6b65 725f  {"size": marker_
+00028c70: 7369 7a65 7d29 0a0a 2020 2020 2020 2020  size})..        
+00028c80: 7265 7475 726e 2066 6967 0a0a 2020 2020  return fig..    
+00028c90: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
+00028ca0: 6d6d 6172 793d 2250 6c6f 7420 6469 7665  mmary="Plot dive
+00028cb0: 7273 6974 7920 7375 6d6d 6172 7920 7374  rsity summary st
+00028cc0: 6174 6973 7469 6373 2066 6f72 206d 756c  atistics for mul
+00028cd0: 7469 706c 6520 636f 686f 7274 732e 222c  tiple cohorts.",
+00028ce0: 0a20 2020 2020 2020 2070 6172 616d 6574  .        paramet
+00028cf0: 6572 733d 6469 6374 280a 2020 2020 2020  ers=dict(.      
+00028d00: 2020 2020 2020 6466 5f73 7461 7473 3d22        df_stats="
+00028d10: 4f75 7470 7574 2066 726f 6d20 6064 6976  Output from `div
+00028d20: 6572 7369 7479 5f73 7461 7473 2829 602e  ersity_stats()`.
+00028d30: 222c 0a20 2020 2020 2020 2020 2020 2062  ",.            b
+00028d40: 6172 5f70 6c6f 745f 6865 6967 6874 3d22  ar_plot_height="
+00028d50: 4865 6967 6874 206f 6620 6261 7220 706c  Height of bar pl
+00028d60: 6f74 7320 696e 2070 6978 656c 7320 2870  ots in pixels (p
+00028d70: 7829 2e22 2c0a 2020 2020 2020 2020 2020  x).",.          
+00028d80: 2020 6261 725f 7769 6474 683d 2257 6964    bar_width="Wid
+00028d90: 7468 2070 6572 2062 6172 2069 6e20 7069  th per bar in pi
+00028da0: 7865 6c73 2028 7078 292e 222c 0a20 2020  xels (px).",.   
+00028db0: 2020 2020 2020 2020 2073 6361 7474 6572           scatter
+00028dc0: 5f70 6c6f 745f 6865 6967 6874 3d22 4865  _plot_height="He
+00028dd0: 6967 6874 206f 6620 7363 6174 7465 7220  ight of scatter 
+00028de0: 706c 6f74 2069 6e20 7069 7865 6c73 2028  plot in pixels (
+00028df0: 7078 292e 222c 0a20 2020 2020 2020 2020  px).",.         
+00028e00: 2020 2073 6361 7474 6572 5f70 6c6f 745f     scatter_plot_
+00028e10: 7769 6474 683d 2257 6964 7468 206f 6620  width="Width of 
+00028e20: 7363 6174 7465 7220 706c 6f74 2069 6e20  scatter plot in 
+00028e30: 7069 7865 6c73 2028 7078 292e 222c 0a20  pixels (px).",. 
+00028e40: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+00028e50: 6b77 6172 6773 3d22 4578 7472 6120 706c  kwargs="Extra pl
+00028e60: 6f74 7469 6e67 2070 6172 616d 6574 6572  otting parameter
+00028e70: 732e 222c 0a20 2020 2020 2020 2029 2c0a  s.",.        ),.
+00028e80: 2020 2020 290a 2020 2020 6465 6620 706c      ).    def pl
+00028e90: 6f74 5f64 6976 6572 7369 7479 5f73 7461  ot_diversity_sta
+00028ea0: 7473 280a 2020 2020 2020 2020 7365 6c66  ts(.        self
+00028eb0: 2c0a 2020 2020 2020 2020 6466 5f73 7461  ,.        df_sta
+00028ec0: 7473 3a20 7064 2e44 6174 6146 7261 6d65  ts: pd.DataFrame
+00028ed0: 2c0a 2020 2020 2020 2020 636f 6c6f 723a  ,.        color:
+00028ee0: 2070 6c6f 746c 795f 7061 7261 6d73 2e63   plotly_params.c
+00028ef0: 6f6c 6f72 203d 204e 6f6e 652c 0a20 2020  olor = None,.   
+00028f00: 2020 2020 2062 6172 5f70 6c6f 745f 6865       bar_plot_he
+00028f10: 6967 6874 3a20 696e 7420 3d20 3435 302c  ight: int = 450,
+00028f20: 0a20 2020 2020 2020 2062 6172 5f77 6964  .        bar_wid
+00028f30: 7468 3a20 696e 7420 3d20 3330 2c0a 2020  th: int = 30,.  
+00028f40: 2020 2020 2020 7363 6174 7465 725f 706c        scatter_pl
+00028f50: 6f74 5f68 6569 6768 743a 2069 6e74 203d  ot_height: int =
+00028f60: 2035 3030 2c0a 2020 2020 2020 2020 7363   500,.        sc
+00028f70: 6174 7465 725f 706c 6f74 5f77 6964 7468  atter_plot_width
+00028f80: 3a20 696e 7420 3d20 3530 302c 0a20 2020  : int = 500,.   
+00028f90: 2020 2020 2074 656d 706c 6174 653a 2070       template: p
+00028fa0: 6c6f 746c 795f 7061 7261 6d73 2e74 656d  lotly_params.tem
+00028fb0: 706c 6174 6520 3d20 2270 6c6f 746c 795f  plate = "plotly_
+00028fc0: 7768 6974 6522 2c0a 2020 2020 2020 2020  white",.        
+00028fd0: 706c 6f74 5f6b 7761 7267 733a 204f 7074  plot_kwargs: Opt
+00028fe0: 696f 6e61 6c5b 4d61 7070 696e 675d 203d  ional[Mapping] =
+00028ff0: 204e 6f6e 652c 0a20 2020 2029 3a0a 2020   None,.    ):.  
+00029000: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
+00029010: 6c66 2e5f 6c6f 672e 6465 6275 670a 0a20  lf._log.debug.. 
+00029020: 2020 2020 2020 2064 6562 7567 2822 7365         debug("se
+00029030: 7420 7570 2063 6f6d 6d6f 6e20 706c 6f74  t up common plot
+00029040: 7469 6e67 2070 6172 616d 6574 6572 7322  ting parameters"
+00029050: 290a 2020 2020 2020 2020 6966 2070 6c6f  ).        if plo
+00029060: 745f 6b77 6172 6773 2069 7320 4e6f 6e65  t_kwargs is None
+00029070: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
+00029080: 6f74 5f6b 7761 7267 7320 3d20 6469 6374  ot_kwargs = dict
+00029090: 2829 0a20 2020 2020 2020 2064 6566 6175  ().        defau
+000290a0: 6c74 5f70 6c6f 745f 6b77 6172 6773 203d  lt_plot_kwargs =
+000290b0: 2064 6963 7428 0a20 2020 2020 2020 2020   dict(.         
+000290c0: 2020 2068 6f76 6572 5f6e 616d 653d 2263     hover_name="c
+000290d0: 6f68 6f72 7422 2c0a 2020 2020 2020 2020  ohort",.        
+000290e0: 2020 2020 686f 7665 725f 6461 7461 3d5b      hover_data=[
+000290f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029100: 2022 7461 786f 6e22 2c0a 2020 2020 2020   "taxon",.      
+00029110: 2020 2020 2020 2020 2020 2263 6f75 6e74            "count
+00029120: 7279 222c 0a20 2020 2020 2020 2020 2020  ry",.           
+00029130: 2020 2020 2022 6164 6d69 6e31 5f69 736f       "admin1_iso
+00029140: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00029150: 2020 2022 6164 6d69 6e31 5f6e 616d 6522     "admin1_name"
+00029160: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00029170: 2020 2261 646d 696e 325f 6e61 6d65 222c    "admin2_name",
+00029180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029190: 2022 6c6f 6e67 6974 7564 6522 2c0a 2020   "longitude",.  
+000291a0: 2020 2020 2020 2020 2020 2020 2020 226c                "l
+000291b0: 6174 6974 7564 6522 2c0a 2020 2020 2020  atitude",.      
+000291c0: 2020 2020 2020 2020 2020 2279 6561 7222            "year"
+000291d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000291e0: 2020 226d 6f6e 7468 222c 0a20 2020 2020    "month",.     
+000291f0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+00029200: 2020 2020 2020 6c61 6265 6c73 3d7b 0a20        labels={. 
+00029210: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00029220: 7468 6574 615f 7069 5f65 7374 696d 6174  theta_pi_estimat
+00029230: 6522 3a20 7222 245c 7769 6465 6861 747b  e": r"$\widehat{
+00029240: 5c74 6865 7461 7d5f 7b5c 7069 7d24 222c  \theta}_{\pi}$",
+00029250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029260: 2022 7468 6574 615f 775f 6573 7469 6d61   "theta_w_estima
+00029270: 7465 223a 2072 2224 5c77 6964 6568 6174  te": r"$\widehat
+00029280: 7b5c 7468 6574 617d 5f7b 777d 2422 2c0a  {\theta}_{w}$",.
+00029290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292a0: 2274 616a 696d 615f 645f 6573 7469 6d61  "tajima_d_estima
+000292b0: 7465 223a 2072 2224 4424 222c 0a20 2020  te": r"$D$",.   
+000292c0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
+000292d0: 686f 7274 223a 2022 436f 686f 7274 222c  hort": "Cohort",
+000292e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000292f0: 2022 7461 786f 6e22 3a20 2254 6178 6f6e   "taxon": "Taxon
+00029300: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00029310: 2020 2022 636f 756e 7472 7922 3a20 2243     "country": "C
+00029320: 6f75 6e74 7279 222c 0a20 2020 2020 2020  ountry",.       
+00029330: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00029340: 290a 2020 2020 2020 2020 6966 2063 6f6c  ).        if col
+00029350: 6f72 203d 3d20 2274 6178 6f6e 223a 0a20  or == "taxon":. 
+00029360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00029370: 5f73 6574 7570 5f74 6178 6f6e 5f63 6f6c  _setup_taxon_col
+00029380: 6f72 7328 706c 6f74 5f6b 7761 7267 733d  ors(plot_kwargs=
+00029390: 6465 6661 756c 745f 706c 6f74 5f6b 7761  default_plot_kwa
+000293a0: 7267 7329 0a20 2020 2020 2020 2064 6566  rgs).        def
+000293b0: 6175 6c74 5f70 6c6f 745f 6b77 6172 6773  ault_plot_kwargs
+000293c0: 2e75 7064 6174 6528 706c 6f74 5f6b 7761  .update(plot_kwa
+000293d0: 7267 7329 0a20 2020 2020 2020 2070 6c6f  rgs).        plo
+000293e0: 745f 6b77 6172 6773 203d 2064 6566 6175  t_kwargs = defau
+000293f0: 6c74 5f70 6c6f 745f 6b77 6172 6773 0a20  lt_plot_kwargs. 
+00029400: 2020 2020 2020 2062 6172 5f70 6c6f 745f         bar_plot_
+00029410: 7769 6474 6820 3d20 3330 3020 2b20 6261  width = 300 + ba
+00029420: 725f 7769 6474 6820 2a20 6c65 6e28 6466  r_width * len(df
+00029430: 5f73 7461 7473 290a 0a20 2020 2020 2020  _stats)..       
+00029440: 2064 6562 7567 2822 6e75 636c 656f 7469   debug("nucleoti
+00029450: 6465 2064 6976 6572 7369 7479 2062 6172  de diversity bar
+00029460: 2070 6c6f 7422 290a 2020 2020 2020 2020   plot").        
+00029470: 6669 6720 3d20 7078 2e62 6172 280a 2020  fig = px.bar(.  
+00029480: 2020 2020 2020 2020 2020 6461 7461 5f66            data_f
+00029490: 7261 6d65 3d64 665f 7374 6174 732c 0a20  rame=df_stats,. 
+000294a0: 2020 2020 2020 2020 2020 2078 3d22 636f             x="co
+000294b0: 686f 7274 222c 0a20 2020 2020 2020 2020  hort",.         
+000294c0: 2020 2079 3d22 7468 6574 615f 7069 5f65     y="theta_pi_e
+000294d0: 7374 696d 6174 6522 2c0a 2020 2020 2020  stimate",.      
+000294e0: 2020 2020 2020 6572 726f 725f 793d 2274        error_y="t
+000294f0: 6865 7461 5f70 695f 6369 5f65 7272 222c  heta_pi_ci_err",
+00029500: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
+00029510: 6c65 3d22 4e75 636c 656f 7469 6465 2064  le="Nucleotide d
+00029520: 6976 6572 7369 7479 222c 0a20 2020 2020  iversity",.     
+00029530: 2020 2020 2020 2063 6f6c 6f72 3d63 6f6c         color=col
+00029540: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00029550: 6865 6967 6874 3d62 6172 5f70 6c6f 745f  height=bar_plot_
+00029560: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
+00029570: 2020 2020 7769 6474 683d 6261 725f 706c      width=bar_pl
+00029580: 6f74 5f77 6964 7468 2c0a 2020 2020 2020  ot_width,.      
+00029590: 2020 2020 2020 7465 6d70 6c61 7465 3d74        template=t
+000295a0: 656d 706c 6174 652c 0a20 2020 2020 2020  emplate,.       
+000295b0: 2020 2020 202a 2a70 6c6f 745f 6b77 6172       **plot_kwar
+000295c0: 6773 2c0a 2020 2020 2020 2020 290a 2020  gs,.        ).  
+000295d0: 2020 2020 2020 6669 672e 7368 6f77 2829        fig.show()
+000295e0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+000295f0: 2257 6174 7465 7273 6f6e 2773 2065 7374  "Watterson's est
+00029600: 696d 6174 6f72 2062 6172 2070 6c6f 7422  imator bar plot"
+00029610: 290a 2020 2020 2020 2020 6669 6720 3d20  ).        fig = 
+00029620: 7078 2e62 6172 280a 2020 2020 2020 2020  px.bar(.        
+00029630: 2020 2020 6461 7461 5f66 7261 6d65 3d64      data_frame=d
+00029640: 665f 7374 6174 732c 0a20 2020 2020 2020  f_stats,.       
+00029650: 2020 2020 2078 3d22 636f 686f 7274 222c       x="cohort",
+00029660: 0a20 2020 2020 2020 2020 2020 2079 3d22  .            y="
+00029670: 7468 6574 615f 775f 6573 7469 6d61 7465  theta_w_estimate
+00029680: 222c 0a20 2020 2020 2020 2020 2020 2065  ",.            e
+00029690: 7272 6f72 5f79 3d22 7468 6574 615f 775f  rror_y="theta_w_
+000296a0: 6369 5f65 7272 222c 0a20 2020 2020 2020  ci_err",.       
+000296b0: 2020 2020 2074 6974 6c65 3d22 5761 7474       title="Watt
+000296c0: 6572 736f 6e27 7320 6573 7469 6d61 746f  erson's estimato
+000296d0: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
+000296e0: 636f 6c6f 723d 636f 6c6f 722c 0a20 2020  color=color,.   
+000296f0: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+00029700: 6261 725f 706c 6f74 5f68 6569 6768 742c  bar_plot_height,
+00029710: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+00029720: 7468 3d62 6172 5f70 6c6f 745f 7769 6474  th=bar_plot_widt
+00029730: 682c 0a20 2020 2020 2020 2020 2020 2074  h,.            t
+00029740: 656d 706c 6174 653d 7465 6d70 6c61 7465  emplate=template
+00029750: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
+00029760: 706c 6f74 5f6b 7761 7267 732c 0a20 2020  plot_kwargs,.   
+00029770: 2020 2020 2029 0a20 2020 2020 2020 2066       ).        f
+00029780: 6967 2e73 686f 7728 290a 0a20 2020 2020  ig.show()..     
+00029790: 2020 2064 6562 7567 2822 5461 6a69 6d61     debug("Tajima
+000297a0: 2773 2044 2062 6172 2070 6c6f 7422 290a  's D bar plot").
+000297b0: 2020 2020 2020 2020 6669 6720 3d20 7078          fig = px
+000297c0: 2e62 6172 280a 2020 2020 2020 2020 2020  .bar(.          
+000297d0: 2020 6461 7461 5f66 7261 6d65 3d64 665f    data_frame=df_
+000297e0: 7374 6174 732c 0a20 2020 2020 2020 2020  stats,.         
+000297f0: 2020 2078 3d22 636f 686f 7274 222c 0a20     x="cohort",. 
+00029800: 2020 2020 2020 2020 2020 2079 3d22 7461             y="ta
+00029810: 6a69 6d61 5f64 5f65 7374 696d 6174 6522  jima_d_estimate"
+00029820: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
+00029830: 726f 725f 793d 2274 616a 696d 615f 645f  ror_y="tajima_d_
+00029840: 6369 5f65 7272 222c 0a20 2020 2020 2020  ci_err",.       
+00029850: 2020 2020 2074 6974 6c65 3d22 5461 6a69       title="Taji
+00029860: 6d61 2773 2044 222c 0a20 2020 2020 2020  ma's D",.       
+00029870: 2020 2020 2063 6f6c 6f72 3d63 6f6c 6f72       color=color
+00029880: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+00029890: 6967 6874 3d62 6172 5f70 6c6f 745f 6865  ight=bar_plot_he
+000298a0: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+000298b0: 2020 7769 6474 683d 6261 725f 706c 6f74    width=bar_plot
+000298c0: 5f77 6964 7468 2c0a 2020 2020 2020 2020  _width,.        
+000298d0: 2020 2020 7465 6d70 6c61 7465 3d74 656d      template=tem
+000298e0: 706c 6174 652c 0a20 2020 2020 2020 2020  plate,.         
+000298f0: 2020 202a 2a70 6c6f 745f 6b77 6172 6773     **plot_kwargs
+00029900: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00029910: 2020 2020 6669 672e 7368 6f77 2829 0a0a      fig.show()..
+00029920: 2020 2020 2020 2020 6465 6275 6728 2273          debug("s
+00029930: 6361 7474 6572 2070 6c6f 7420 636f 6d70  catter plot comp
+00029940: 6172 696e 6720 6469 7665 7273 6974 7920  aring diversity 
+00029950: 6573 7469 6d61 746f 7273 2229 0a20 2020  estimators").   
+00029960: 2020 2020 2066 6967 203d 2070 782e 7363       fig = px.sc
+00029970: 6174 7465 7228 0a20 2020 2020 2020 2020  atter(.         
+00029980: 2020 2064 6174 615f 6672 616d 653d 6466     data_frame=df
+00029990: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
+000299a0: 2020 2020 783d 2274 6865 7461 5f70 695f      x="theta_pi_
+000299b0: 6573 7469 6d61 7465 222c 0a20 2020 2020  estimate",.     
+000299c0: 2020 2020 2020 2079 3d22 7468 6574 615f         y="theta_
+000299d0: 775f 6573 7469 6d61 7465 222c 0a20 2020  w_estimate",.   
+000299e0: 2020 2020 2020 2020 2065 7272 6f72 5f78           error_x
+000299f0: 3d22 7468 6574 615f 7069 5f63 695f 6572  ="theta_pi_ci_er
+00029a00: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
+00029a10: 6572 726f 725f 793d 2274 6865 7461 5f77  error_y="theta_w
+00029a20: 5f63 695f 6572 7222 2c0a 2020 2020 2020  _ci_err",.      
+00029a30: 2020 2020 2020 7469 746c 653d 2244 6976        title="Div
+00029a40: 6572 7369 7479 2065 7374 696d 6174 6f72  ersity estimator
+00029a50: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+00029a60: 636f 6c6f 723d 636f 6c6f 722c 0a20 2020  color=color,.   
+00029a70: 2020 2020 2020 2020 2077 6964 7468 3d73           width=s
+00029a80: 6361 7474 6572 5f70 6c6f 745f 7769 6474  catter_plot_widt
+00029a90: 682c 0a20 2020 2020 2020 2020 2020 2068  h,.            h
+00029aa0: 6569 6768 743d 7363 6174 7465 725f 706c  eight=scatter_pl
+00029ab0: 6f74 5f68 6569 6768 742c 0a20 2020 2020  ot_height,.     
+00029ac0: 2020 2020 2020 2074 656d 706c 6174 653d         template=
+00029ad0: 7465 6d70 6c61 7465 2c0a 2020 2020 2020  template,.      
+00029ae0: 2020 2020 2020 2a2a 706c 6f74 5f6b 7761        **plot_kwa
+00029af0: 7267 732c 0a20 2020 2020 2020 2029 0a20  rgs,.        ). 
+00029b00: 2020 2020 2020 2066 6967 2e73 686f 7728         fig.show(
+00029b10: 290a 0a20 2020 2040 646f 6328 0a20 2020  )..    @doc(.   
+00029b20: 2020 2020 2073 756d 6d61 7279 3d22 2222       summary="""
+00029b30: 0a20 2020 2020 2020 2020 2020 2052 756e  .            Run
+00029b40: 2061 6e64 2070 6c6f 7420 6120 4673 7420   and plot a Fst 
+00029b50: 6765 6e6f 6d65 2d77 6964 6520 7363 616e  genome-wide scan
+00029b60: 2074 6f20 696e 7665 7374 6967 6174 6520   to investigate 
+00029b70: 6765 6e65 7469 630a 2020 2020 2020 2020  genetic.        
+00029b80: 2020 2020 6469 6666 6572 656e 7469 6174      differentiat
+00029b90: 696f 6e20 6265 7477 6565 6e20 7477 6f20  ion between two 
+00029ba0: 636f 686f 7274 732e 0a20 2020 2020 2020  cohorts..       
+00029bb0: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
+00029bc0: 6465 6620 706c 6f74 5f66 7374 5f67 7773  def plot_fst_gws
+00029bd0: 735f 7472 6163 6b28 0a20 2020 2020 2020  s_track(.       
+00029be0: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
+00029bf0: 6f6e 7469 673a 2062 6173 655f 7061 7261  ontig: base_para
+00029c00: 6d73 2e63 6f6e 7469 672c 0a20 2020 2020  ms.contig,.     
+00029c10: 2020 2077 696e 646f 775f 7369 7a65 3a20     window_size: 
+00029c20: 6673 745f 7061 7261 6d73 2e77 696e 646f  fst_params.windo
+00029c30: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
+00029c40: 636f 686f 7274 315f 7175 6572 793a 2062  cohort1_query: b
+00029c50: 6173 655f 7061 7261 6d73 2e73 616d 706c  ase_params.sampl
+00029c60: 655f 7175 6572 792c 0a20 2020 2020 2020  e_query,.       
+00029c70: 2063 6f68 6f72 7432 5f71 7565 7279 3a20   cohort2_query: 
+00029c80: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
+00029c90: 6c65 5f71 7565 7279 2c0a 2020 2020 2020  le_query,.      
+00029ca0: 2020 7361 6d70 6c65 5f73 6574 733a 204f    sample_sets: O
+00029cb0: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+00029cc0: 616d 732e 7361 6d70 6c65 5f73 6574 735d  ams.sample_sets]
+00029cd0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00029ce0: 2073 6974 655f 6d61 736b 3a20 6261 7365   site_mask: base
+00029cf0: 5f70 6172 616d 732e 7369 7465 5f6d 6173  _params.site_mas
+00029d00: 6b20 3d20 4445 4641 554c 542c 0a20 2020  k = DEFAULT,.   
+00029d10: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
+00029d20: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
+00029d30: 7061 7261 6d73 2e63 6f68 6f72 745f 7369  params.cohort_si
+00029d40: 7a65 5d20 3d20 6673 745f 7061 7261 6d73  ze] = fst_params
+00029d50: 2e63 6f68 6f72 745f 7369 7a65 5f64 6566  .cohort_size_def
+00029d60: 6175 6c74 2c0a 2020 2020 2020 2020 6d69  ault,.        mi
+00029d70: 6e5f 636f 686f 7274 5f73 697a 653a 204f  n_cohort_size: O
+00029d80: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+00029d90: 2020 2020 2062 6173 655f 7061 7261 6d73       base_params
+00029da0: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
+00029db0: 0a20 2020 2020 2020 205d 203d 2066 7374  .        ] = fst
+00029dc0: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
+00029dd0: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
+00029de0: 0a20 2020 2020 2020 206d 6178 5f63 6f68  .        max_coh
+00029df0: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
+00029e00: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
+00029e10: 6261 7365 5f70 6172 616d 732e 6d61 785f  base_params.max_
+00029e20: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
+00029e30: 2020 2020 5d20 3d20 6673 745f 7061 7261      ] = fst_para
+00029e40: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
+00029e50: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
+00029e60: 2020 2020 7261 6e64 6f6d 5f73 6565 643a      random_seed:
+00029e70: 2062 6173 655f 7061 7261 6d73 2e72 616e   base_params.ran
+00029e80: 646f 6d5f 7365 6564 203d 2034 322c 0a20  dom_seed = 42,. 
+00029e90: 2020 2020 2020 2074 6974 6c65 3a20 4f70         title: Op
+00029ea0: 7469 6f6e 616c 5b67 706c 745f 7061 7261  tional[gplt_para
+00029eb0: 6d73 2e74 6974 6c65 5d20 3d20 4e6f 6e65  ms.title] = None
+00029ec0: 2c0a 2020 2020 2020 2020 7369 7a69 6e67  ,.        sizing
+00029ed0: 5f6d 6f64 653a 2067 706c 745f 7061 7261  _mode: gplt_para
+00029ee0: 6d73 2e73 697a 696e 675f 6d6f 6465 203d  ms.sizing_mode =
+00029ef0: 2067 706c 745f 7061 7261 6d73 2e73 697a   gplt_params.siz
+00029f00: 696e 675f 6d6f 6465 5f64 6566 6175 6c74  ing_mode_default
+00029f10: 2c0a 2020 2020 2020 2020 7769 6474 683a  ,.        width:
+00029f20: 2067 706c 745f 7061 7261 6d73 2e77 6964   gplt_params.wid
+00029f30: 7468 203d 2067 706c 745f 7061 7261 6d73  th = gplt_params
+00029f40: 2e77 6964 7468 5f64 6566 6175 6c74 2c0a  .width_default,.
+00029f50: 2020 2020 2020 2020 6865 6967 6874 3a20          height: 
+00029f60: 6770 6c74 5f70 6172 616d 732e 6865 6967  gplt_params.heig
+00029f70: 6874 203d 2032 3030 2c0a 2020 2020 2020  ht = 200,.      
+00029f80: 2020 7368 6f77 3a20 6770 6c74 5f70 6172    show: gplt_par
+00029f90: 616d 732e 7368 6f77 203d 2054 7275 652c  ams.show = True,
+00029fa0: 0a20 2020 2020 2020 2078 5f72 616e 6765  .        x_range
+00029fb0: 3a20 4f70 7469 6f6e 616c 5b67 706c 745f  : Optional[gplt_
+00029fc0: 7061 7261 6d73 2e78 5f72 616e 6765 5d20  params.x_range] 
+00029fd0: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+00029fe0: 2067 706c 745f 7061 7261 6d73 2e66 6967   gplt_params.fig
+00029ff0: 7572 653a 0a20 2020 2020 2020 2023 2063  ure:.        # c
+0002a000: 6f6d 7075 7465 2046 7374 0a20 2020 2020  ompute Fst.     
+0002a010: 2020 2078 2c20 6673 7420 3d20 7365 6c66     x, fst = self
+0002a020: 2e66 7374 5f67 7773 7328 0a20 2020 2020  .fst_gwss(.     
+0002a030: 2020 2020 2020 2063 6f6e 7469 673d 636f         contig=co
+0002a040: 6e74 6967 2c0a 2020 2020 2020 2020 2020  ntig,.          
+0002a050: 2020 7769 6e64 6f77 5f73 697a 653d 7769    window_size=wi
+0002a060: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
+0002a070: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
+0002a080: 7a65 3d63 6f68 6f72 745f 7369 7a65 2c0a  ze=cohort_size,.
+0002a090: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+0002a0a0: 636f 686f 7274 5f73 697a 653d 6d69 6e5f  cohort_size=min_
+0002a0b0: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+0002a0c0: 2020 2020 2020 2020 206d 6178 5f63 6f68           max_coh
+0002a0d0: 6f72 745f 7369 7a65 3d6d 6178 5f63 6f68  ort_size=max_coh
+0002a0e0: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
+0002a0f0: 2020 2020 2020 636f 686f 7274 315f 7175        cohort1_qu
+0002a100: 6572 793d 636f 686f 7274 315f 7175 6572  ery=cohort1_quer
+0002a110: 792c 0a20 2020 2020 2020 2020 2020 2063  y,.            c
+0002a120: 6f68 6f72 7432 5f71 7565 7279 3d63 6f68  ohort2_query=coh
+0002a130: 6f72 7432 5f71 7565 7279 2c0a 2020 2020  ort2_query,.    
+0002a140: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0002a150: 6574 733d 7361 6d70 6c65 5f73 6574 732c  ets=sample_sets,
+0002a160: 0a20 2020 2020 2020 2020 2020 2073 6974  .            sit
+0002a170: 655f 6d61 736b 3d73 6974 655f 6d61 736b  e_mask=site_mask
+0002a180: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
+0002a190: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
+0002a1a0: 5f73 6565 642c 0a20 2020 2020 2020 2029  _seed,.        )
+0002a1b0: 0a0a 2020 2020 2020 2020 2320 6465 7465  ..        # dete
+0002a1c0: 726d 696e 6520 5820 6178 6973 2072 616e  rmine X axis ran
+0002a1d0: 6765 0a20 2020 2020 2020 2078 5f6d 696e  ge.        x_min
+0002a1e0: 203d 2078 5b30 5d0a 2020 2020 2020 2020   = x[0].        
+0002a1f0: 785f 6d61 7820 3d20 785b 2d31 5d0a 2020  x_max = x[-1].  
+0002a200: 2020 2020 2020 6966 2078 5f72 616e 6765        if x_range
+0002a210: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0002a220: 2020 2020 2020 785f 7261 6e67 6520 3d20        x_range = 
+0002a230: 626f 6b65 682e 6d6f 6465 6c73 2e52 616e  bokeh.models.Ran
+0002a240: 6765 3164 2878 5f6d 696e 2c20 785f 6d61  ge1d(x_min, x_ma
+0002a250: 782c 2062 6f75 6e64 733d 2261 7574 6f22  x, bounds="auto"
+0002a260: 290a 0a20 2020 2020 2020 2023 2063 7265  )..        # cre
+0002a270: 6174 6520 6120 6669 6775 7265 0a20 2020  ate a figure.   
+0002a280: 2020 2020 2078 7768 6565 6c5f 7a6f 6f6d       xwheel_zoom
+0002a290: 203d 2062 6f6b 6568 2e6d 6f64 656c 732e   = bokeh.models.
+0002a2a0: 5768 6565 6c5a 6f6f 6d54 6f6f 6c28 0a20  WheelZoomTool(. 
+0002a2b0: 2020 2020 2020 2020 2020 2064 696d 656e             dimen
+0002a2c0: 7369 6f6e 733d 2277 6964 7468 222c 206d  sions="width", m
+0002a2d0: 6169 6e74 6169 6e5f 666f 6375 733d 4661  aintain_focus=Fa
+0002a2e0: 6c73 650a 2020 2020 2020 2020 290a 2020  lse.        ).  
+0002a2f0: 2020 2020 2020 6966 2074 6974 6c65 2069        if title i
+0002a300: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002a310: 2020 2020 7469 746c 6520 3d20 6622 436f      title = f"Co
+0002a320: 686f 7274 2031 3a20 7b63 6f68 6f72 7431  hort 1: {cohort1
+0002a330: 5f71 7565 7279 7d5c 6e43 6f68 6f72 7420  _query}\nCohort 
+0002a340: 323a 207b 636f 686f 7274 325f 7175 6572  2: {cohort2_quer
+0002a350: 797d 220a 2020 2020 2020 2020 6669 6720  y}".        fig 
+0002a360: 3d20 626f 6b65 682e 706c 6f74 7469 6e67  = bokeh.plotting
+0002a370: 2e66 6967 7572 6528 0a20 2020 2020 2020  .figure(.       
+0002a380: 2020 2020 2074 6974 6c65 3d74 6974 6c65       title=title
+0002a390: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
+0002a3a0: 6f6c 733d 5b22 7870 616e 222c 2022 787a  ols=["xpan", "xz
+0002a3b0: 6f6f 6d5f 696e 222c 2022 787a 6f6f 6d5f  oom_in", "xzoom_
+0002a3c0: 6f75 7422 2c20 7877 6865 656c 5f7a 6f6f  out", xwheel_zoo
+0002a3d0: 6d2c 2022 7265 7365 7422 5d2c 0a20 2020  m, "reset"],.   
+0002a3e0: 2020 2020 2020 2020 2061 6374 6976 655f           active_
+0002a3f0: 7363 726f 6c6c 3d78 7768 6565 6c5f 7a6f  scroll=xwheel_zo
+0002a400: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
+0002a410: 6163 7469 7665 5f64 7261 673d 2278 7061  active_drag="xpa
+0002a420: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
+0002a430: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
+0002a440: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
+0002a450: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
+0002a460: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+0002a470: 6967 6874 3d68 6569 6768 742c 0a20 2020  ight=height,.   
+0002a480: 2020 2020 2020 2020 2074 6f6f 6c62 6172           toolbar
+0002a490: 5f6c 6f63 6174 696f 6e3d 2261 626f 7665  _location="above
+0002a4a0: 222c 0a20 2020 2020 2020 2020 2020 2078  ",.            x
+0002a4b0: 5f72 616e 6765 3d78 5f72 616e 6765 2c0a  _range=x_range,.
+0002a4c0: 2020 2020 2020 2020 2020 2020 795f 7261              y_ra
+0002a4d0: 6e67 653d 2830 2c20 3129 2c0a 2020 2020  nge=(0, 1),.    
+0002a4e0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+0002a4f0: 2070 6c6f 7420 4673 740a 2020 2020 2020   plot Fst.      
+0002a500: 2020 6669 672e 6369 7263 6c65 280a 2020    fig.circle(.  
+0002a510: 2020 2020 2020 2020 2020 783d 782c 0a20            x=x,. 
+0002a520: 2020 2020 2020 2020 2020 2079 3d66 7374             y=fst
+0002a530: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+0002a540: 7a65 3d33 2c0a 2020 2020 2020 2020 2020  ze=3,.          
+0002a550: 2020 6c69 6e65 5f77 6964 7468 3d30 2e35    line_width=0.5
+0002a560: 2c0a 2020 2020 2020 2020 2020 2020 6c69  ,.            li
+0002a570: 6e65 5f63 6f6c 6f72 3d22 626c 6163 6b22  ne_color="black"
+0002a580: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+0002a590: 6c6c 5f63 6f6c 6f72 3d4e 6f6e 652c 0a20  ll_color=None,. 
+0002a5a0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0002a5b0: 2020 2320 7469 6479 2075 7020 7468 6520    # tidy up the 
+0002a5c0: 706c 6f74 0a20 2020 2020 2020 2066 6967  plot.        fig
+0002a5d0: 2e79 6178 6973 2e61 7869 735f 6c61 6265  .yaxis.axis_labe
+0002a5e0: 6c20 3d20 2246 7374 220a 2020 2020 2020  l = "Fst".      
+0002a5f0: 2020 6669 672e 7961 7869 732e 7469 636b    fig.yaxis.tick
+0002a600: 6572 203d 205b 302c 2031 5d0a 2020 2020  er = [0, 1].    
+0002a610: 2020 2020 7365 6c66 2e5f 626f 6b65 685f      self._bokeh_
+0002a620: 7374 796c 655f 6765 6e6f 6d65 5f78 6178  style_genome_xax
+0002a630: 6973 2866 6967 2c20 636f 6e74 6967 290a  is(fig, contig).
+0002a640: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
+0002a650: 3a0a 2020 2020 2020 2020 2020 2020 626f  :.            bo
+0002a660: 6b65 682e 706c 6f74 7469 6e67 2e73 686f  keh.plotting.sho
+0002a670: 7728 6669 6729 0a0a 2020 2020 2020 2020  w(fig)..        
+0002a680: 7265 7475 726e 2066 6967 0a0a 2020 2020  return fig..    
+0002a690: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
+0002a6a0: 6d6d 6172 793d 2222 220a 2020 2020 2020  mmary=""".      
+0002a6b0: 2020 2020 2020 5275 6e20 616e 6420 706c        Run and pl
+0002a6c0: 6f74 2061 2046 7374 2067 656e 6f6d 652d  ot a Fst genome-
+0002a6d0: 7769 6465 2073 6361 6e20 746f 2069 6e76  wide scan to inv
+0002a6e0: 6573 7469 6761 7465 2067 656e 6574 6963  estigate genetic
+0002a6f0: 0a20 2020 2020 2020 2020 2020 2064 6966  .            dif
+0002a700: 6665 7265 6e74 6961 7469 6f6e 2062 6574  ferentiation bet
+0002a710: 7765 656e 2074 776f 2063 6f68 6f72 7473  ween two cohorts
+0002a720: 2e0a 2020 2020 2020 2020 2222 222c 0a20  ..        """,. 
+0002a730: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
+0002a740: 745f 6673 745f 6777 7373 280a 2020 2020  t_fst_gwss(.    
+0002a750: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0002a760: 2020 636f 6e74 6967 3a20 6261 7365 5f70    contig: base_p
+0002a770: 6172 616d 732e 636f 6e74 6967 2c0a 2020  arams.contig,.  
+0002a780: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
+0002a790: 653a 2066 7374 5f70 6172 616d 732e 7769  e: fst_params.wi
+0002a7a0: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
+0002a7b0: 2020 2063 6f68 6f72 7431 5f71 7565 7279     cohort1_query
+0002a7c0: 3a20 6261 7365 5f70 6172 616d 732e 7361  : base_params.sa
+0002a7d0: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
+0002a7e0: 2020 2020 636f 686f 7274 325f 7175 6572      cohort2_quer
+0002a7f0: 793a 2062 6173 655f 7061 7261 6d73 2e73  y: base_params.s
+0002a800: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+0002a810: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
+0002a820: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
+0002a830: 7061 7261 6d73 2e73 616d 706c 655f 7365  params.sample_se
+0002a840: 7473 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ts] = None,.    
+0002a850: 2020 2020 7369 7465 5f6d 6173 6b3a 2062      site_mask: b
+0002a860: 6173 655f 7061 7261 6d73 2e73 6974 655f  ase_params.site_
+0002a870: 6d61 736b 203d 2044 4546 4155 4c54 2c0a  mask = DEFAULT,.
+0002a880: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
+0002a890: 697a 653a 204f 7074 696f 6e61 6c5b 6261  ize: Optional[ba
+0002a8a0: 7365 5f70 6172 616d 732e 636f 686f 7274  se_params.cohort
+0002a8b0: 5f73 697a 655d 203d 2066 7374 5f70 6172  _size] = fst_par
+0002a8c0: 616d 732e 636f 686f 7274 5f73 697a 655f  ams.cohort_size_
+0002a8d0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+0002a8e0: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+0002a8f0: 3a20 4f70 7469 6f6e 616c 5b0a 2020 2020  : Optional[.    
+0002a900: 2020 2020 2020 2020 6261 7365 5f70 6172          base_par
+0002a910: 616d 732e 6d69 6e5f 636f 686f 7274 5f73  ams.min_cohort_s
+0002a920: 697a 650a 2020 2020 2020 2020 5d20 3d20  ize.        ] = 
+0002a930: 6673 745f 7061 7261 6d73 2e6d 696e 5f63  fst_params.min_c
+0002a940: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
+0002a950: 6c74 2c0a 2020 2020 2020 2020 6d61 785f  lt,.        max_
+0002a960: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+0002a970: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
+0002a980: 2020 2062 6173 655f 7061 7261 6d73 2e6d     base_params.m
+0002a990: 6178 5f63 6f68 6f72 745f 7369 7a65 0a20  ax_cohort_size. 
+0002a9a0: 2020 2020 2020 205d 203d 2066 7374 5f70         ] = fst_p
+0002a9b0: 6172 616d 732e 6d61 785f 636f 686f 7274  arams.max_cohort
+0002a9c0: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
+0002a9d0: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
+0002a9e0: 6564 3a20 6261 7365 5f70 6172 616d 732e  ed: base_params.
+0002a9f0: 7261 6e64 6f6d 5f73 6565 6420 3d20 3432  random_seed = 42
+0002aa00: 2c0a 2020 2020 2020 2020 7469 746c 653a  ,.        title:
+0002aa10: 204f 7074 696f 6e61 6c5b 6770 6c74 5f70   Optional[gplt_p
+0002aa20: 6172 616d 732e 7469 746c 655d 203d 204e  arams.title] = N
+0002aa30: 6f6e 652c 0a20 2020 2020 2020 2073 697a  one,.        siz
+0002aa40: 696e 675f 6d6f 6465 3a20 6770 6c74 5f70  ing_mode: gplt_p
+0002aa50: 6172 616d 732e 7369 7a69 6e67 5f6d 6f64  arams.sizing_mod
+0002aa60: 6520 3d20 6770 6c74 5f70 6172 616d 732e  e = gplt_params.
+0002aa70: 7369 7a69 6e67 5f6d 6f64 655f 6465 6661  sizing_mode_defa
+0002aa80: 756c 742c 0a20 2020 2020 2020 2077 6964  ult,.        wid
+0002aa90: 7468 3a20 6770 6c74 5f70 6172 616d 732e  th: gplt_params.
+0002aaa0: 7769 6474 6820 3d20 6770 6c74 5f70 6172  width = gplt_par
+0002aab0: 616d 732e 7769 6474 685f 6465 6661 756c  ams.width_defaul
+0002aac0: 742c 0a20 2020 2020 2020 2074 7261 636b  t,.        track
+0002aad0: 5f68 6569 6768 743a 2067 706c 745f 7061  _height: gplt_pa
+0002aae0: 7261 6d73 2e74 7261 636b 5f68 6569 6768  rams.track_heigh
+0002aaf0: 7420 3d20 3139 302c 0a20 2020 2020 2020  t = 190,.       
+0002ab00: 2067 656e 6573 5f68 6569 6768 743a 2067   genes_height: g
+0002ab10: 706c 745f 7061 7261 6d73 2e67 656e 6573  plt_params.genes
+0002ab20: 5f68 6569 6768 7420 3d20 6770 6c74 5f70  _height = gplt_p
+0002ab30: 6172 616d 732e 6765 6e65 735f 6865 6967  arams.genes_heig
+0002ab40: 6874 5f64 6566 6175 6c74 2c0a 2020 2020  ht_default,.    
+0002ab50: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0002ab60: 2020 2023 2067 7773 7320 7472 6163 6b0a     # gwss track.
+0002ab70: 2020 2020 2020 2020 6669 6731 203d 2073          fig1 = s
+0002ab80: 656c 662e 706c 6f74 5f66 7374 5f67 7773  elf.plot_fst_gws
+0002ab90: 735f 7472 6163 6b28 0a20 2020 2020 2020  s_track(.       
+0002aba0: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
+0002abb0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+0002abc0: 7769 6e64 6f77 5f73 697a 653d 7769 6e64  window_size=wind
+0002abd0: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
+0002abe0: 2020 2020 2063 6f68 6f72 7431 5f71 7565       cohort1_que
+0002abf0: 7279 3d63 6f68 6f72 7431 5f71 7565 7279  ry=cohort1_query
+0002ac00: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+0002ac10: 686f 7274 325f 7175 6572 793d 636f 686f  hort2_query=coho
+0002ac20: 7274 325f 7175 6572 792c 0a20 2020 2020  rt2_query,.     
+0002ac30: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+0002ac40: 7473 3d73 616d 706c 655f 7365 7473 2c0a  ts=sample_sets,.
+0002ac50: 2020 2020 2020 2020 2020 2020 7369 7465              site
+0002ac60: 5f6d 6173 6b3d 7369 7465 5f6d 6173 6b2c  _mask=site_mask,
+0002ac70: 0a20 2020 2020 2020 2020 2020 2063 6f68  .            coh
+0002ac80: 6f72 745f 7369 7a65 3d63 6f68 6f72 745f  ort_size=cohort_
+0002ac90: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+0002aca0: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
+0002acb0: 653d 6d69 6e5f 636f 686f 7274 5f73 697a  e=min_cohort_siz
+0002acc0: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+0002acd0: 6178 5f63 6f68 6f72 745f 7369 7a65 3d6d  ax_cohort_size=m
+0002ace0: 6178 5f63 6f68 6f72 745f 7369 7a65 2c0a  ax_cohort_size,.
+0002acf0: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+0002ad00: 6f6d 5f73 6565 643d 7261 6e64 6f6d 5f73  om_seed=random_s
+0002ad10: 6565 642c 0a20 2020 2020 2020 2020 2020  eed,.           
+0002ad20: 2074 6974 6c65 3d74 6974 6c65 2c0a 2020   title=title,.  
+0002ad30: 2020 2020 2020 2020 2020 7369 7a69 6e67            sizing
+0002ad40: 5f6d 6f64 653d 7369 7a69 6e67 5f6d 6f64  _mode=sizing_mod
+0002ad50: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
+0002ad60: 6964 7468 3d77 6964 7468 2c0a 2020 2020  idth=width,.    
+0002ad70: 2020 2020 2020 2020 6865 6967 6874 3d74          height=t
+0002ad80: 7261 636b 5f68 6569 6768 742c 0a20 2020  rack_height,.   
+0002ad90: 2020 2020 2020 2020 2073 686f 773d 4661           show=Fa
+0002ada0: 6c73 652c 0a20 2020 2020 2020 2029 0a0a  lse,.        )..
+0002adb0: 2020 2020 2020 2020 6669 6731 2e78 6178          fig1.xax
+0002adc0: 6973 2e76 6973 6962 6c65 203d 2046 616c  is.visible = Fal
+0002add0: 7365 0a0a 2020 2020 2020 2020 2320 706c  se..        # pl
+0002ade0: 6f74 2067 656e 6573 0a20 2020 2020 2020  ot genes.       
+0002adf0: 2066 6967 3220 3d20 7365 6c66 2e70 6c6f   fig2 = self.plo
+0002ae00: 745f 6765 6e65 7328 0a20 2020 2020 2020  t_genes(.       
+0002ae10: 2020 2020 2072 6567 696f 6e3d 636f 6e74       region=cont
+0002ae20: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+0002ae30: 7369 7a69 6e67 5f6d 6f64 653d 7369 7a69  sizing_mode=sizi
+0002ae40: 6e67 5f6d 6f64 652c 0a20 2020 2020 2020  ng_mode,.       
+0002ae50: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
+0002ae60: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+0002ae70: 6967 6874 3d67 656e 6573 5f68 6569 6768  ight=genes_heigh
+0002ae80: 742c 0a20 2020 2020 2020 2020 2020 2078  t,.            x
+0002ae90: 5f72 616e 6765 3d66 6967 312e 785f 7261  _range=fig1.x_ra
+0002aea0: 6e67 652c 0a20 2020 2020 2020 2020 2020  nge,.           
+0002aeb0: 2073 686f 773d 4661 6c73 652c 0a20 2020   show=False,.   
+0002aec0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0002aed0: 2320 636f 6d62 696e 6520 706c 6f74 7320  # combine plots 
+0002aee0: 696e 746f 2061 2073 696e 676c 6520 6669  into a single fi
+0002aef0: 6775 7265 0a20 2020 2020 2020 2066 6967  gure.        fig
+0002af00: 203d 2062 6f6b 6568 2e6c 6179 6f75 7473   = bokeh.layouts
+0002af10: 2e67 7269 6470 6c6f 7428 0a20 2020 2020  .gridplot(.     
+0002af20: 2020 2020 2020 205b 6669 6731 2c20 6669         [fig1, fi
+0002af30: 6732 5d2c 0a20 2020 2020 2020 2020 2020  g2],.           
+0002af40: 206e 636f 6c73 3d31 2c0a 2020 2020 2020   ncols=1,.      
+0002af50: 2020 2020 2020 746f 6f6c 6261 725f 6c6f        toolbar_lo
+0002af60: 6361 7469 6f6e 3d22 6162 6f76 6522 2c0a  cation="above",.
+0002af70: 2020 2020 2020 2020 2020 2020 6d65 7267              merg
+0002af80: 655f 746f 6f6c 733d 5472 7565 2c0a 2020  e_tools=True,.  
+0002af90: 2020 2020 2020 2020 2020 7369 7a69 6e67            sizing
+0002afa0: 5f6d 6f64 653d 7369 7a69 6e67 5f6d 6f64  _mode=sizing_mod
+0002afb0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+0002afc0: 2020 2020 2020 626f 6b65 682e 706c 6f74        bokeh.plot
+0002afd0: 7469 6e67 2e73 686f 7728 6669 6729 0a0a  ting.show(fig)..
+0002afe0: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+0002aff0: 2020 7375 6d6d 6172 793d 224f 7065 6e20    summary="Open 
+0002b000: 6861 706c 6f74 7970 6573 207a 6172 722e  haplotypes zarr.
+0002b010: 222c 0a20 2020 2020 2020 2072 6574 7572  ",.        retur
+0002b020: 6e73 3d22 5a61 7272 2068 6965 7261 7263  ns="Zarr hierarc
+0002b030: 6879 2e22 2c0a 2020 2020 290a 2020 2020  hy.",.    ).    
+0002b040: 6465 6620 6f70 656e 5f68 6170 6c6f 7479  def open_haploty
+0002b050: 7065 7328 0a20 2020 2020 2020 2073 656c  pes(.        sel
+0002b060: 662c 0a20 2020 2020 2020 2073 616d 706c  f,.        sampl
+0002b070: 655f 7365 743a 2062 6173 655f 7061 7261  e_set: base_para
+0002b080: 6d73 2e73 616d 706c 655f 7365 742c 0a20  ms.sample_set,. 
+0002b090: 2020 2020 2020 2061 6e61 6c79 7369 733a         analysis:
+0002b0a0: 2068 6170 5f70 6172 616d 732e 616e 616c   hap_params.anal
+0002b0b0: 7973 6973 203d 2044 4546 4155 4c54 2c0a  ysis = DEFAULT,.
+0002b0c0: 2020 2020 2920 2d3e 207a 6172 722e 6869      ) -> zarr.hi
+0002b0d0: 6572 6172 6368 792e 4772 6f75 703a 0a20  erarchy.Group:. 
+0002b0e0: 2020 2020 2020 2061 6e61 6c79 7369 7320         analysis 
+0002b0f0: 3d20 7365 6c66 2e5f 7072 6570 5f70 6861  = self._prep_pha
+0002b100: 7369 6e67 5f61 6e61 6c79 7369 735f 7061  sing_analysis_pa
+0002b110: 7261 6d28 616e 616c 7973 6973 3d61 6e61  ram(analysis=ana
+0002b120: 6c79 7369 7329 0a20 2020 2020 2020 2074  lysis).        t
+0002b130: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0002b140: 7265 7475 726e 2073 656c 662e 5f63 6163  return self._cac
+0002b150: 6865 5f68 6170 6c6f 7479 7065 735b 2873  he_haplotypes[(s
+0002b160: 616d 706c 655f 7365 742c 2061 6e61 6c79  ample_set, analy
+0002b170: 7369 7329 5d0a 2020 2020 2020 2020 6578  sis)].        ex
+0002b180: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
+0002b190: 2020 2020 2020 2020 2020 2072 656c 6561             relea
+0002b1a0: 7365 203d 2073 656c 662e 6c6f 6f6b 7570  se = self.lookup
+0002b1b0: 5f72 656c 6561 7365 2873 616d 706c 655f  _release(sample_
+0002b1c0: 7365 743d 7361 6d70 6c65 5f73 6574 290a  set=sample_set).
+0002b1d0: 2020 2020 2020 2020 2020 2020 7265 6c65              rele
+0002b1e0: 6173 655f 7061 7468 203d 2073 656c 662e  ase_path = self.
+0002b1f0: 5f72 656c 6561 7365 5f74 6f5f 7061 7468  _release_to_path
+0002b200: 2872 656c 6561 7365 290a 2020 2020 2020  (release).      
+0002b210: 2020 2020 2020 7061 7468 203d 2066 227b        path = f"{
+0002b220: 7365 6c66 2e5f 6261 7365 5f70 6174 687d  self._base_path}
+0002b230: 2f7b 7265 6c65 6173 655f 7061 7468 7d2f  /{release_path}/
+0002b240: 736e 705f 6861 706c 6f74 7970 6573 2f7b  snp_haplotypes/{
+0002b250: 7361 6d70 6c65 5f73 6574 7d2f 7b61 6e61  sample_set}/{ana
+0002b260: 6c79 7369 737d 2f7a 6172 7222 0a20 2020  lysis}/zarr".   
+0002b270: 2020 2020 2020 2020 2073 746f 7265 203d           store =
+0002b280: 2069 6e69 745f 7a61 7272 5f73 746f 7265   init_zarr_store
+0002b290: 2866 733d 7365 6c66 2e5f 6673 2c20 7061  (fs=self._fs, pa
+0002b2a0: 7468 3d70 6174 6829 0a20 2020 2020 2020  th=path).       
+0002b2b0: 2020 2020 2023 2073 6f6d 6520 7361 6d70       # some samp
+0002b2c0: 6c65 2073 6574 7320 6861 7665 206e 6f20  le sets have no 
+0002b2d0: 6461 7461 2066 6f72 2061 2067 6976 656e  data for a given
+0002b2e0: 2061 6e61 6c79 7369 732c 2068 616e 646c   analysis, handl
+0002b2f0: 6520 7468 6973 0a20 2020 2020 2020 2020  e this.         
+0002b300: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0002b310: 2020 2020 2020 2020 726f 6f74 203d 207a          root = z
+0002b320: 6172 722e 6f70 656e 5f63 6f6e 736f 6c69  arr.open_consoli
+0002b330: 6461 7465 6428 7374 6f72 653d 7374 6f72  dated(store=stor
+0002b340: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+0002b350: 7863 6570 7420 4669 6c65 4e6f 7446 6f75  xcept FileNotFou
+0002b360: 6e64 4572 726f 723a 0a20 2020 2020 2020  ndError:.       
+0002b370: 2020 2020 2020 2020 2072 6f6f 7420 3d20           root = 
+0002b380: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002b390: 2073 656c 662e 5f63 6163 6865 5f68 6170   self._cache_hap
+0002b3a0: 6c6f 7479 7065 735b 2873 616d 706c 655f  lotypes[(sample_
+0002b3b0: 7365 742c 2061 6e61 6c79 7369 7329 5d20  set, analysis)] 
+0002b3c0: 3d20 726f 6f74 0a20 2020 2020 2020 2072  = root.        r
+0002b3d0: 6574 7572 6e20 726f 6f74 0a0a 2020 2020  eturn root..    
+0002b3e0: 4064 6f63 280a 2020 2020 2020 2020 7375  @doc(.        su
+0002b3f0: 6d6d 6172 793d 224f 7065 6e20 6861 706c  mmary="Open hapl
+0002b400: 6f74 7970 6520 7369 7465 7320 7a61 7272  otype sites zarr
+0002b410: 2e22 2c0a 2020 2020 2020 2020 7265 7475  .",.        retu
+0002b420: 726e 733d 225a 6172 7220 6869 6572 6172  rns="Zarr hierar
+0002b430: 6368 792e 222c 0a20 2020 2029 0a20 2020  chy.",.    ).   
+0002b440: 2064 6566 206f 7065 6e5f 6861 706c 6f74   def open_haplot
+0002b450: 7970 655f 7369 7465 7328 0a20 2020 2020  ype_sites(.     
+0002b460: 2020 2073 656c 662c 2061 6e61 6c79 7369     self, analysi
+0002b470: 733a 2068 6170 5f70 6172 616d 732e 616e  s: hap_params.an
+0002b480: 616c 7973 6973 203d 2044 4546 4155 4c54  alysis = DEFAULT
+0002b490: 0a20 2020 2029 202d 3e20 7a61 7272 2e68  .    ) -> zarr.h
+0002b4a0: 6965 7261 7263 6879 2e47 726f 7570 3a0a  ierarchy.Group:.
+0002b4b0: 2020 2020 2020 2020 616e 616c 7973 6973          analysis
+0002b4c0: 203d 2073 656c 662e 5f70 7265 705f 7068   = self._prep_ph
+0002b4d0: 6173 696e 675f 616e 616c 7973 6973 5f70  asing_analysis_p
+0002b4e0: 6172 616d 2861 6e61 6c79 7369 733d 616e  aram(analysis=an
+0002b4f0: 616c 7973 6973 290a 2020 2020 2020 2020  alysis).        
+0002b500: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0002b510: 2072 6574 7572 6e20 7365 6c66 2e5f 6361   return self._ca
+0002b520: 6368 655f 6861 706c 6f74 7970 655f 7369  che_haplotype_si
+0002b530: 7465 735b 616e 616c 7973 6973 5d0a 2020  tes[analysis].  
+0002b540: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+0002b550: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+0002b560: 2020 2070 6174 6820 3d20 6622 7b73 656c     path = f"{sel
+0002b570: 662e 5f62 6173 655f 7061 7468 7d2f 7b73  f._base_path}/{s
+0002b580: 656c 662e 5f6d 616a 6f72 5f76 6572 7369  elf._major_versi
+0002b590: 6f6e 5f70 6174 687d 2f73 6e70 5f68 6170  on_path}/snp_hap
+0002b5a0: 6c6f 7479 7065 732f 7369 7465 732f 7b61  lotypes/sites/{a
+0002b5b0: 6e61 6c79 7369 737d 2f7a 6172 7222 0a20  nalysis}/zarr". 
+0002b5c0: 2020 2020 2020 2020 2020 2073 746f 7265             store
+0002b5d0: 203d 2069 6e69 745f 7a61 7272 5f73 746f   = init_zarr_sto
+0002b5e0: 7265 2866 733d 7365 6c66 2e5f 6673 2c20  re(fs=self._fs, 
+0002b5f0: 7061 7468 3d70 6174 6829 0a20 2020 2020  path=path).     
+0002b600: 2020 2020 2020 2072 6f6f 7420 3d20 7a61         root = za
+0002b610: 7272 2e6f 7065 6e5f 636f 6e73 6f6c 6964  rr.open_consolid
+0002b620: 6174 6564 2873 746f 7265 3d73 746f 7265  ated(store=store
+0002b630: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0002b640: 6c66 2e5f 6361 6368 655f 6861 706c 6f74  lf._cache_haplot
+0002b650: 7970 655f 7369 7465 735b 616e 616c 7973  ype_sites[analys
+0002b660: 6973 5d20 3d20 726f 6f74 0a20 2020 2020  is] = root.     
+0002b670: 2020 2072 6574 7572 6e20 726f 6f74 0a0a     return root..
+0002b680: 2020 2020 6465 6620 5f68 6170 6c6f 7479      def _haploty
+0002b690: 7065 5f73 6974 6573 5f66 6f72 5f63 6f6e  pe_sites_for_con
+0002b6a0: 7469 6728 0a20 2020 2020 2020 2073 656c  tig(.        sel
+0002b6b0: 662c 202a 2c20 636f 6e74 6967 2c20 616e  f, *, contig, an
+0002b6c0: 616c 7973 6973 2c20 6669 656c 642c 2069  alysis, field, i
+0002b6d0: 6e6c 696e 655f 6172 7261 792c 2063 6875  nline_array, chu
+0002b6e0: 6e6b 730a 2020 2020 293a 0a20 2020 2020  nks.    ):.     
+0002b6f0: 2020 2073 6974 6573 203d 2073 656c 662e     sites = self.
+0002b700: 6f70 656e 5f68 6170 6c6f 7479 7065 5f73  open_haplotype_s
+0002b710: 6974 6573 2861 6e61 6c79 7369 733d 616e  ites(analysis=an
+0002b720: 616c 7973 6973 290a 2020 2020 2020 2020  alysis).        
+0002b730: 6172 7220 3d20 7369 7465 735b 6622 7b63  arr = sites[f"{c
+0002b740: 6f6e 7469 677d 2f76 6172 6961 6e74 732f  ontig}/variants/
+0002b750: 7b66 6965 6c64 7d22 5d0a 2020 2020 2020  {field}"].      
+0002b760: 2020 6172 7220 3d20 6461 5f66 726f 6d5f    arr = da_from_
+0002b770: 7a61 7272 2861 7272 2c20 696e 6c69 6e65  zarr(arr, inline
+0002b780: 5f61 7272 6179 3d69 6e6c 696e 655f 6172  _array=inline_ar
+0002b790: 7261 792c 2063 6875 6e6b 733d 6368 756e  ray, chunks=chun
+0002b7a0: 6b73 290a 2020 2020 2020 2020 7265 7475  ks).        retu
+0002b7b0: 726e 2061 7272 0a0a 2020 2020 6465 6620  rn arr..    def 
+0002b7c0: 5f68 6170 6c6f 7479 7065 735f 666f 725f  _haplotypes_for_
+0002b7d0: 636f 6e74 6967 280a 2020 2020 2020 2020  contig(.        
+0002b7e0: 7365 6c66 2c20 2a2c 2063 6f6e 7469 672c  self, *, contig,
+0002b7f0: 2073 616d 706c 655f 7365 742c 2061 6e61   sample_set, ana
+0002b800: 6c79 7369 732c 2069 6e6c 696e 655f 6172  lysis, inline_ar
+0002b810: 7261 792c 2063 6875 6e6b 730a 2020 2020  ray, chunks.    
+0002b820: 293a 0a20 2020 2020 2020 2064 6562 7567  ):.        debug
+0002b830: 203d 2073 656c 662e 5f6c 6f67 2e64 6562   = self._log.deb
+0002b840: 7567 0a0a 2020 2020 2020 2020 6465 6275  ug..        debu
+0002b850: 6728 226f 7065 6e20 7a61 7272 2229 0a20  g("open zarr"). 
+0002b860: 2020 2020 2020 2072 6f6f 7420 3d20 7365         root = se
+0002b870: 6c66 2e6f 7065 6e5f 6861 706c 6f74 7970  lf.open_haplotyp
+0002b880: 6573 2873 616d 706c 655f 7365 743d 7361  es(sample_set=sa
+0002b890: 6d70 6c65 5f73 6574 2c20 616e 616c 7973  mple_set, analys
+0002b8a0: 6973 3d61 6e61 6c79 7369 7329 0a20 2020  is=analysis).   
+0002b8b0: 2020 2020 2073 6974 6573 203d 2073 656c       sites = sel
+0002b8c0: 662e 6f70 656e 5f68 6170 6c6f 7479 7065  f.open_haplotype
+0002b8d0: 5f73 6974 6573 2861 6e61 6c79 7369 733d  _sites(analysis=
+0002b8e0: 616e 616c 7973 6973 290a 0a20 2020 2020  analysis)..     
+0002b8f0: 2020 2064 6562 7567 2822 7661 7269 616e     debug("varian
+0002b900: 745f 706f 7369 7469 6f6e 2229 0a20 2020  t_position").   
+0002b910: 2020 2020 2070 6f73 203d 2073 6974 6573       pos = sites
+0002b920: 5b66 227b 636f 6e74 6967 7d2f 7661 7269  [f"{contig}/vari
+0002b930: 616e 7473 2f50 4f53 225d 0a0a 2020 2020  ants/POS"]..    
+0002b940: 2020 2020 2320 736f 6d65 2073 616d 706c      # some sampl
+0002b950: 6520 7365 7473 2068 6176 6520 6e6f 2064  e sets have no d
+0002b960: 6174 6120 666f 7220 6120 6769 7665 6e20  ata for a given 
+0002b970: 616e 616c 7973 6973 2c20 6861 6e64 6c65  analysis, handle
+0002b980: 2074 6869 730a 2020 2020 2020 2020 2320   this.        # 
+0002b990: 544f 444f 2063 6f6e 7369 6465 7220 7265  TODO consider re
+0002b9a0: 7475 726e 696e 6720 6120 6461 7461 7365  turning a datase
+0002b9b0: 7420 7769 7468 2030 206c 656e 6774 6820  t with 0 length 
+0002b9c0: 7361 6d70 6c65 7320 6469 6d65 6e73 696f  samples dimensio
+0002b9d0: 6e20 696e 7374 6561 642c 2077 6f75 6c64  n instead, would
+0002b9e0: 0a20 2020 2020 2020 2023 2070 726f 6261  .        # proba
+0002b9f0: 626c 7920 7369 6d70 6c69 6679 2061 206c  bly simplify a l
+0002ba00: 6f74 206f 6620 6f74 6865 7220 6c6f 6769  ot of other logi
+0002ba10: 630a 2020 2020 2020 2020 6966 2072 6f6f  c.        if roo
+0002ba20: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+0002ba30: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0002ba40: 6e65 0a0a 2020 2020 2020 2020 636f 6f72  ne..        coor
+0002ba50: 6473 203d 2064 6963 7428 290a 2020 2020  ds = dict().    
+0002ba60: 2020 2020 6461 7461 5f76 6172 7320 3d20      data_vars = 
+0002ba70: 6469 6374 2829 0a0a 2020 2020 2020 2020  dict()..        
+0002ba80: 636f 6f72 6473 5b22 7661 7269 616e 745f  coords["variant_
+0002ba90: 706f 7369 7469 6f6e 225d 203d 2028 0a20  position"] = (. 
+0002baa0: 2020 2020 2020 2020 2020 205b 4449 4d5f             [DIM_
+0002bab0: 5641 5249 414e 545d 2c0a 2020 2020 2020  VARIANT],.      
+0002bac0: 2020 2020 2020 6461 5f66 726f 6d5f 7a61        da_from_za
+0002bad0: 7272 2870 6f73 2c20 696e 6c69 6e65 5f61  rr(pos, inline_a
+0002bae0: 7272 6179 3d69 6e6c 696e 655f 6172 7261  rray=inline_arra
+0002baf0: 792c 2063 6875 6e6b 733d 6368 756e 6b73  y, chunks=chunks
+0002bb00: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+0002bb10: 2020 2020 2020 6465 6275 6728 2276 6172        debug("var
+0002bb20: 6961 6e74 5f63 6f6e 7469 6722 290a 2020  iant_contig").  
+0002bb30: 2020 2020 2020 636f 6e74 6967 5f69 6e64        contig_ind
+0002bb40: 6578 203d 2073 656c 662e 636f 6e74 6967  ex = self.contig
+0002bb50: 732e 696e 6465 7828 636f 6e74 6967 290a  s.index(contig).
+0002bb60: 2020 2020 2020 2020 636f 6f72 6473 5b22          coords["
+0002bb70: 7661 7269 616e 745f 636f 6e74 6967 225d  variant_contig"]
+0002bb80: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0002bb90: 205b 4449 4d5f 5641 5249 414e 545d 2c0a   [DIM_VARIANT],.
+0002bba0: 2020 2020 2020 2020 2020 2020 6461 2e66              da.f
+0002bbb0: 756c 6c5f 6c69 6b65 2870 6f73 2c20 6669  ull_like(pos, fi
+0002bbc0: 6c6c 5f76 616c 7565 3d63 6f6e 7469 675f  ll_value=contig_
+0002bbd0: 696e 6465 782c 2064 7479 7065 3d22 7531  index, dtype="u1
+0002bbe0: 2229 2c0a 2020 2020 2020 2020 290a 0a20  "),.        ).. 
+0002bbf0: 2020 2020 2020 2064 6562 7567 2822 7661         debug("va
+0002bc00: 7269 616e 745f 616c 6c65 6c65 2229 0a20  riant_allele"). 
+0002bc10: 2020 2020 2020 2072 6566 203d 2064 615f         ref = da_
+0002bc20: 6672 6f6d 5f7a 6172 7228 0a20 2020 2020  from_zarr(.     
+0002bc30: 2020 2020 2020 2073 6974 6573 5b66 227b         sites[f"{
+0002bc40: 636f 6e74 6967 7d2f 7661 7269 616e 7473  contig}/variants
+0002bc50: 2f52 4546 225d 2c20 696e 6c69 6e65 5f61  /REF"], inline_a
+0002bc60: 7272 6179 3d69 6e6c 696e 655f 6172 7261  rray=inline_arra
+0002bc70: 792c 2063 6875 6e6b 733d 6368 756e 6b73  y, chunks=chunks
+0002bc80: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0002bc90: 2020 2061 6c74 203d 2064 615f 6672 6f6d     alt = da_from
+0002bca0: 5f7a 6172 7228 0a20 2020 2020 2020 2020  _zarr(.         
+0002bcb0: 2020 2073 6974 6573 5b66 227b 636f 6e74     sites[f"{cont
+0002bcc0: 6967 7d2f 7661 7269 616e 7473 2f41 4c54  ig}/variants/ALT
+0002bcd0: 225d 2c20 696e 6c69 6e65 5f61 7272 6179  "], inline_array
+0002bce0: 3d69 6e6c 696e 655f 6172 7261 792c 2063  =inline_array, c
+0002bcf0: 6875 6e6b 733d 6368 756e 6b73 0a20 2020  hunks=chunks.   
+0002bd00: 2020 2020 2029 0a20 2020 2020 2020 2076       ).        v
+0002bd10: 6172 6961 6e74 5f61 6c6c 656c 6520 3d20  ariant_allele = 
+0002bd20: 6461 2e68 7374 6163 6b28 5b72 6566 5b3a  da.hstack([ref[:
+0002bd30: 2c20 4e6f 6e65 5d2c 2061 6c74 5b3a 2c20  , None], alt[:, 
+0002bd40: 4e6f 6e65 5d5d 290a 2020 2020 2020 2020  None]]).        
+0002bd50: 6461 7461 5f76 6172 735b 2276 6172 6961  data_vars["varia
+0002bd60: 6e74 5f61 6c6c 656c 6522 5d20 3d20 5b44  nt_allele"] = [D
+0002bd70: 494d 5f56 4152 4941 4e54 2c20 4449 4d5f  IM_VARIANT, DIM_
+0002bd80: 414c 4c45 4c45 5d2c 2076 6172 6961 6e74  ALLELE], variant
+0002bd90: 5f61 6c6c 656c 650a 0a20 2020 2020 2020  _allele..       
+0002bda0: 2064 6562 7567 2822 6361 6c6c 5f67 656e   debug("call_gen
+0002bdb0: 6f74 7970 6522 290a 2020 2020 2020 2020  otype").        
+0002bdc0: 6461 7461 5f76 6172 735b 2263 616c 6c5f  data_vars["call_
+0002bdd0: 6765 6e6f 7479 7065 225d 203d 2028 0a20  genotype"] = (. 
+0002bde0: 2020 2020 2020 2020 2020 205b 4449 4d5f             [DIM_
+0002bdf0: 5641 5249 414e 542c 2044 494d 5f53 414d  VARIANT, DIM_SAM
+0002be00: 504c 452c 2044 494d 5f50 4c4f 4944 595d  PLE, DIM_PLOIDY]
+0002be10: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
+0002be20: 5f66 726f 6d5f 7a61 7272 280a 2020 2020  _from_zarr(.    
+0002be30: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+0002be40: 5b66 227b 636f 6e74 6967 7d2f 6361 6c6c  [f"{contig}/call
+0002be50: 6461 7461 2f47 5422 5d2c 2069 6e6c 696e  data/GT"], inlin
+0002be60: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
+0002be70: 7272 6179 2c20 6368 756e 6b73 3d63 6875  rray, chunks=chu
+0002be80: 6e6b 730a 2020 2020 2020 2020 2020 2020  nks.            
+0002be90: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+0002bea0: 2020 2020 2020 6465 6275 6728 2273 616d        debug("sam
+0002beb0: 706c 6520 6172 7261 7973 2229 0a20 2020  ple arrays").   
+0002bec0: 2020 2020 2063 6f6f 7264 735b 2273 616d       coords["sam
+0002bed0: 706c 655f 6964 225d 203d 2028 0a20 2020  ple_id"] = (.   
+0002bee0: 2020 2020 2020 2020 205b 4449 4d5f 5341           [DIM_SA
+0002bef0: 4d50 4c45 5d2c 0a20 2020 2020 2020 2020  MPLE],.         
+0002bf00: 2020 2064 615f 6672 6f6d 5f7a 6172 7228     da_from_zarr(
+0002bf10: 726f 6f74 5b22 7361 6d70 6c65 7322 5d2c  root["samples"],
+0002bf20: 2069 6e6c 696e 655f 6172 7261 793d 696e   inline_array=in
+0002bf30: 6c69 6e65 5f61 7272 6179 2c20 6368 756e  line_array, chun
+0002bf40: 6b73 3d63 6875 6e6b 7329 2c0a 2020 2020  ks=chunks),.    
+0002bf50: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+0002bf60: 6562 7567 2822 7365 7420 7570 2061 7474  ebug("set up att
+0002bf70: 7269 6275 7465 7322 290a 2020 2020 2020  ributes").      
+0002bf80: 2020 6174 7472 7320 3d20 7b22 636f 6e74    attrs = {"cont
+0002bf90: 6967 7322 3a20 7365 6c66 2e63 6f6e 7469  igs": self.conti
+0002bfa0: 6773 7d0a 0a20 2020 2020 2020 2064 6562  gs}..        deb
+0002bfb0: 7567 2822 6372 6561 7465 2061 2064 6174  ug("create a dat
+0002bfc0: 6173 6574 2229 0a20 2020 2020 2020 2064  aset").        d
+0002bfd0: 7320 3d20 7872 2e44 6174 6173 6574 2864  s = xr.Dataset(d
+0002bfe0: 6174 615f 7661 7273 3d64 6174 615f 7661  ata_vars=data_va
+0002bff0: 7273 2c20 636f 6f72 6473 3d63 6f6f 7264  rs, coords=coord
+0002c000: 732c 2061 7474 7273 3d61 7474 7273 290a  s, attrs=attrs).
+0002c010: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002c020: 6473 0a0a 2020 2020 4064 6f63 280a 2020  ds..    @doc(.  
+0002c030: 2020 2020 2020 7375 6d6d 6172 793d 2241        summary="A
+0002c040: 6363 6573 7320 6861 706c 6f74 7970 6520  ccess haplotype 
+0002c050: 6461 7461 2e22 2c0a 2020 2020 2020 2020  data.",.        
+0002c060: 7265 7475 726e 733d 2241 2064 6174 6173  returns="A datas
+0002c070: 6574 206f 6620 6861 706c 6f74 7970 6573  et of haplotypes
+0002c080: 2061 6e64 2061 7373 6f63 6961 7465 6420   and associated 
+0002c090: 6461 7461 2e22 2c0a 2020 2020 290a 2020  data.",.    ).  
+0002c0a0: 2020 6465 6620 6861 706c 6f74 7970 6573    def haplotypes
+0002c0b0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0002c0c0: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
+0002c0d0: 6261 7365 5f70 6172 616d 732e 7265 6769  base_params.regi
+0002c0e0: 6f6e 2c0a 2020 2020 2020 2020 616e 616c  on,.        anal
+0002c0f0: 7973 6973 3a20 6861 705f 7061 7261 6d73  ysis: hap_params
+0002c100: 2e61 6e61 6c79 7369 7320 3d20 4445 4641  .analysis = DEFA
+0002c110: 554c 542c 0a20 2020 2020 2020 2073 616d  ULT,.        sam
+0002c120: 706c 655f 7365 7473 3a20 4f70 7469 6f6e  ple_sets: Option
+0002c130: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
+0002c140: 616d 706c 655f 7365 7473 5d20 3d20 4e6f  ample_sets] = No
+0002c150: 6e65 2c0a 2020 2020 2020 2020 7361 6d70  ne,.        samp
+0002c160: 6c65 5f71 7565 7279 3a20 4f70 7469 6f6e  le_query: Option
+0002c170: 616c 5b62 6173 655f 7061 7261 6d73 2e73  al[base_params.s
+0002c180: 616d 706c 655f 7175 6572 795d 203d 204e  ample_query] = N
+0002c190: 6f6e 652c 0a20 2020 2020 2020 2069 6e6c  one,.        inl
+0002c1a0: 696e 655f 6172 7261 793a 2062 6173 655f  ine_array: base_
+0002c1b0: 7061 7261 6d73 2e69 6e6c 696e 655f 6172  params.inline_ar
+0002c1c0: 7261 7920 3d20 6261 7365 5f70 6172 616d  ray = base_param
+0002c1d0: 732e 696e 6c69 6e65 5f61 7272 6179 5f64  s.inline_array_d
+0002c1e0: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+0002c1f0: 6368 756e 6b73 3a20 6261 7365 5f70 6172  chunks: base_par
+0002c200: 616d 732e 6368 756e 6b73 203d 2062 6173  ams.chunks = bas
+0002c210: 655f 7061 7261 6d73 2e63 6875 6e6b 735f  e_params.chunks_
+0002c220: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+0002c230: 2063 6f68 6f72 745f 7369 7a65 3a20 4f70   cohort_size: Op
+0002c240: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+0002c250: 6d73 2e63 6f68 6f72 745f 7369 7a65 5d20  ms.cohort_size] 
+0002c260: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0002c270: 6d69 6e5f 636f 686f 7274 5f73 697a 653a  min_cohort_size:
+0002c280: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
+0002c290: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
+0002c2a0: 5f73 697a 655d 203d 204e 6f6e 652c 0a20  _size] = None,. 
+0002c2b0: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+0002c2c0: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
+0002c2d0: 5b62 6173 655f 7061 7261 6d73 2e6d 6178  [base_params.max
+0002c2e0: 5f63 6f68 6f72 745f 7369 7a65 5d20 3d20  _cohort_size] = 
+0002c2f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7261  None,.        ra
+0002c300: 6e64 6f6d 5f73 6565 643a 2062 6173 655f  ndom_seed: base_
+0002c310: 7061 7261 6d73 2e72 616e 646f 6d5f 7365  params.random_se
+0002c320: 6564 203d 2034 322c 0a20 2020 2029 202d  ed = 42,.    ) -
+0002c330: 3e20 4f70 7469 6f6e 616c 5b78 722e 4461  > Optional[xr.Da
+0002c340: 7461 7365 745d 3a0a 2020 2020 2020 2020  taset]:.        
+0002c350: 6465 6275 6720 3d20 7365 6c66 2e5f 6c6f  debug = self._lo
+0002c360: 672e 6465 6275 670a 0a20 2020 2020 2020  g.debug..       
+0002c370: 2064 6562 7567 2822 6e6f 726d 616c 6973   debug("normalis
+0002c380: 6520 7061 7261 6d65 7465 7273 2229 0a20  e parameters"). 
+0002c390: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+0002c3a0: 7473 203d 2073 656c 662e 5f70 7265 705f  ts = self._prep_
+0002c3b0: 7361 6d70 6c65 5f73 6574 735f 7061 7261  sample_sets_para
+0002c3c0: 6d28 7361 6d70 6c65 5f73 6574 733d 7361  m(sample_sets=sa
+0002c3d0: 6d70 6c65 5f73 6574 7329 0a20 2020 2020  mple_sets).     
+0002c3e0: 2020 2072 6573 6f6c 7665 645f 7265 6769     resolved_regi
+0002c3f0: 6f6e 203d 2073 656c 662e 7265 736f 6c76  on = self.resolv
+0002c400: 655f 7265 6769 6f6e 2872 6567 696f 6e29  e_region(region)
+0002c410: 0a20 2020 2020 2020 2064 656c 2072 6567  .        del reg
+0002c420: 696f 6e0a 0a20 2020 2020 2020 2069 6620  ion..        if 
+0002c430: 6973 696e 7374 616e 6365 2872 6573 6f6c  isinstance(resol
+0002c440: 7665 645f 7265 6769 6f6e 2c20 5265 6769  ved_region, Regi
+0002c450: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
+0002c460: 2072 6573 6f6c 7665 645f 7265 6769 6f6e   resolved_region
+0002c470: 203d 205b 7265 736f 6c76 6564 5f72 6567   = [resolved_reg
+0002c480: 696f 6e5d 0a20 2020 2020 2020 2061 6e61  ion].        ana
+0002c490: 6c79 7369 7320 3d20 7365 6c66 2e5f 7072  lysis = self._pr
+0002c4a0: 6570 5f70 6861 7369 6e67 5f61 6e61 6c79  ep_phasing_analy
+0002c4b0: 7369 735f 7061 7261 6d28 616e 616c 7973  sis_param(analys
+0002c4c0: 6973 3d61 6e61 6c79 7369 7329 0a0a 2020  is=analysis)..  
+0002c4d0: 2020 2020 2020 6465 6275 6728 2262 7569        debug("bui
+0002c4e0: 6c64 2064 6174 6173 6574 2229 0a20 2020  ld dataset").   
+0002c4f0: 2020 2020 206c 7820 3d20 5b5d 0a20 2020       lx = [].   
+0002c500: 2020 2020 2066 6f72 2072 2069 6e20 7265       for r in re
+0002c510: 736f 6c76 6564 5f72 6567 696f 6e3a 0a20  solved_region:. 
+0002c520: 2020 2020 2020 2020 2020 206c 7920 3d20             ly = 
+0002c530: 5b5d 0a0a 2020 2020 2020 2020 2020 2020  []..            
+0002c540: 666f 7220 7320 696e 2073 616d 706c 655f  for s in sample_
+0002c550: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
+0002c560: 2020 2020 2020 7920 3d20 7365 6c66 2e5f        y = self._
+0002c570: 6861 706c 6f74 7970 6573 5f66 6f72 5f63  haplotypes_for_c
+0002c580: 6f6e 7469 6728 0a20 2020 2020 2020 2020  ontig(.         
+0002c590: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0002c5a0: 673d 722e 636f 6e74 6967 2c0a 2020 2020  g=r.contig,.    
+0002c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c5c0: 7361 6d70 6c65 5f73 6574 3d73 2c0a 2020  sample_set=s,.  
+0002c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c5e0: 2020 616e 616c 7973 6973 3d61 6e61 6c79    analysis=analy
+0002c5f0: 7369 732c 0a20 2020 2020 2020 2020 2020  sis,.           
+0002c600: 2020 2020 2020 2020 2069 6e6c 696e 655f           inline_
+0002c610: 6172 7261 793d 696e 6c69 6e65 5f61 7272  array=inline_arr
+0002c620: 6179 2c0a 2020 2020 2020 2020 2020 2020  ay,.            
+0002c630: 2020 2020 2020 2020 6368 756e 6b73 3d63          chunks=c
+0002c640: 6875 6e6b 732c 0a20 2020 2020 2020 2020  hunks,.         
+0002c650: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002c660: 2020 2020 2020 2020 2069 6620 7920 6973           if y is
+0002c670: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0002c680: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0002c690: 792e 6170 7065 6e64 2879 290a 0a20 2020  y.append(y)..   
+0002c6a0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0002c6b0: 6c79 2920 3d3d 2030 3a0a 2020 2020 2020  ly) == 0:.      
+0002c6c0: 2020 2020 2020 2020 2020 6465 6275 6728            debug(
+0002c6d0: 2265 6172 6c79 206f 7574 2c20 6e6f 2064  "early out, no d
+0002c6e0: 6174 6120 666f 7220 6769 7665 6e20 7361  ata for given sa
+0002c6f0: 6d70 6c65 2073 6574 7320 616e 6420 616e  mple sets and an
+0002c700: 616c 7973 6973 2229 0a20 2020 2020 2020  alysis").       
+0002c710: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002c720: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
+0002c730: 2020 6465 6275 6728 2263 6f6e 6361 7465    debug("concate
+0002c740: 6e61 7465 2064 6174 6120 6672 6f6d 206d  nate data from m
+0002c750: 756c 7469 706c 6520 7361 6d70 6c65 2073  ultiple sample s
+0002c760: 6574 7322 290a 2020 2020 2020 2020 2020  ets").          
+0002c770: 2020 7820 3d20 7369 6d70 6c65 5f78 6172    x = simple_xar
+0002c780: 7261 795f 636f 6e63 6174 286c 792c 2064  ray_concat(ly, d
+0002c790: 696d 3d44 494d 5f53 414d 504c 4529 0a0a  im=DIM_SAMPLE)..
+0002c7a0: 2020 2020 2020 2020 2020 2020 6465 6275              debu
+0002c7b0: 6728 2268 616e 646c 6520 7265 6769 6f6e  g("handle region
+0002c7c0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0002c7d0: 6620 722e 7374 6172 7420 6f72 2072 2e65  f r.start or r.e
+0002c7e0: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+0002c7f0: 2020 2020 706f 7320 3d20 785b 2276 6172      pos = x["var
+0002c800: 6961 6e74 5f70 6f73 6974 696f 6e22 5d2e  iant_position"].
+0002c810: 7661 6c75 6573 0a20 2020 2020 2020 2020  values.         
+0002c820: 2020 2020 2020 206c 6f63 5f72 6567 696f         loc_regio
+0002c830: 6e20 3d20 6c6f 6361 7465 5f72 6567 696f  n = locate_regio
+0002c840: 6e28 722c 2070 6f73 290a 2020 2020 2020  n(r, pos).      
+0002c850: 2020 2020 2020 2020 2020 7820 3d20 782e            x = x.
+0002c860: 6973 656c 2876 6172 6961 6e74 733d 6c6f  isel(variants=lo
+0002c870: 635f 7265 6769 6f6e 290a 0a20 2020 2020  c_region)..     
+0002c880: 2020 2020 2020 206c 782e 6170 7065 6e64         lx.append
+0002c890: 2878 290a 0a20 2020 2020 2020 2064 6562  (x)..        deb
+0002c8a0: 7567 2822 636f 6e63 6174 656e 6174 6520  ug("concatenate 
+0002c8b0: 6461 7461 2066 726f 6d20 6d75 6c74 6970  data from multip
+0002c8c0: 6c65 2072 6567 696f 6e73 2229 0a20 2020  le regions").   
+0002c8d0: 2020 2020 2064 7320 3d20 7369 6d70 6c65       ds = simple
+0002c8e0: 5f78 6172 7261 795f 636f 6e63 6174 286c  _xarray_concat(l
+0002c8f0: 782c 2064 696d 3d44 494d 5f56 4152 4941  x, dim=DIM_VARIA
+0002c900: 4e54 290a 0a20 2020 2020 2020 2064 6562  NT)..        deb
+0002c910: 7567 2822 6861 6e64 6c65 2073 616d 706c  ug("handle sampl
+0002c920: 6520 7175 6572 7922 290a 2020 2020 2020  e query").      
+0002c930: 2020 6966 2073 616d 706c 655f 7175 6572    if sample_quer
+0002c940: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
+0002c950: 2020 2020 2020 2020 2020 2064 6562 7567             debug
+0002c960: 2822 6c6f 6164 2073 616d 706c 6520 6d65  ("load sample me
+0002c970: 7461 6461 7461 2229 0a20 2020 2020 2020  tadata").       
+0002c980: 2020 2020 2064 665f 7361 6d70 6c65 7320       df_samples 
+0002c990: 3d20 7365 6c66 2e73 616d 706c 655f 6d65  = self.sample_me
+0002c9a0: 7461 6461 7461 2873 616d 706c 655f 7365  tadata(sample_se
+0002c9b0: 7473 3d73 616d 706c 655f 7365 7473 290a  ts=sample_sets).
+0002c9c0: 0a20 2020 2020 2020 2020 2020 2064 6562  .            deb
+0002c9d0: 7567 2822 616c 6967 6e20 7361 6d70 6c65  ug("align sample
+0002c9e0: 206d 6574 6164 6174 6120 7769 7468 2068   metadata with h
+0002c9f0: 6170 6c6f 7479 7065 7322 290a 2020 2020  aplotypes").    
+0002ca00: 2020 2020 2020 2020 7068 6173 6564 5f73          phased_s
+0002ca10: 616d 706c 6573 203d 2064 735b 2273 616d  amples = ds["sam
+0002ca20: 706c 655f 6964 225d 2e76 616c 7565 732e  ple_id"].values.
+0002ca30: 746f 6c69 7374 2829 0a20 2020 2020 2020  tolist().       
+0002ca40: 2020 2020 2064 665f 7361 6d70 6c65 735f       df_samples_
+0002ca50: 7068 6173 6564 203d 2028 0a20 2020 2020  phased = (.     
+0002ca60: 2020 2020 2020 2020 2020 2064 665f 7361             df_sa
+0002ca70: 6d70 6c65 732e 7365 745f 696e 6465 7828  mples.set_index(
+0002ca80: 2273 616d 706c 655f 6964 2229 2e6c 6f63  "sample_id").loc
+0002ca90: 5b70 6861 7365 645f 7361 6d70 6c65 735d  [phased_samples]
+0002caa0: 2e72 6573 6574 5f69 6e64 6578 2829 0a20  .reset_index(). 
+0002cab0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0002cac0: 2020 2020 2020 2020 2020 6465 6275 6728            debug(
+0002cad0: 2261 7070 6c79 2074 6865 2071 7565 7279  "apply the query
+0002cae0: 2229 0a20 2020 2020 2020 2020 2020 206c  ").            l
+0002caf0: 6f63 5f73 616d 706c 6573 203d 2064 665f  oc_samples = df_
+0002cb00: 7361 6d70 6c65 735f 7068 6173 6564 2e65  samples_phased.e
+0002cb10: 7661 6c28 7361 6d70 6c65 5f71 7565 7279  val(sample_query
+0002cb20: 292e 7661 6c75 6573 0a20 2020 2020 2020  ).values.       
+0002cb30: 2020 2020 2069 6620 6e70 2e63 6f75 6e74       if np.count
+0002cb40: 5f6e 6f6e 7a65 726f 286c 6f63 5f73 616d  _nonzero(loc_sam
+0002cb50: 706c 6573 2920 3d3d 2030 3a0a 2020 2020  ples) == 0:.    
+0002cb60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002cb70: 6520 5661 6c75 6545 7272 6f72 2866 224e  e ValueError(f"N
+0002cb80: 6f20 7361 6d70 6c65 7320 666f 756e 6420  o samples found 
+0002cb90: 666f 7220 7175 6572 7920 7b73 616d 706c  for query {sampl
+0002cba0: 655f 7175 6572 7921 727d 2229 0a20 2020  e_query!r}").   
+0002cbb0: 2020 2020 2020 2020 2064 7320 3d20 6473           ds = ds
+0002cbc0: 2e69 7365 6c28 7361 6d70 6c65 733d 6c6f  .isel(samples=lo
+0002cbd0: 635f 7361 6d70 6c65 7329 0a0a 2020 2020  c_samples)..    
+0002cbe0: 2020 2020 6465 6275 6728 2268 616e 646c      debug("handl
+0002cbf0: 6520 636f 686f 7274 2073 697a 6522 290a  e cohort size").
+0002cc00: 2020 2020 2020 2020 6966 2063 6f68 6f72          if cohor
+0002cc10: 745f 7369 7a65 2069 7320 6e6f 7420 4e6f  t_size is not No
+0002cc20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002cc30: 6465 6275 6728 2268 616e 646c 6520 636f  debug("handle co
+0002cc40: 686f 7274 2073 697a 6522 290a 2020 2020  hort size").    
+0002cc50: 2020 2020 2020 2020 2320 6f76 6572 7269          # overri
+0002cc60: 6465 7320 6d69 6e20 616e 6420 6d61 780a  des min and max.
+0002cc70: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+0002cc80: 636f 686f 7274 5f73 697a 6520 3d20 636f  cohort_size = co
+0002cc90: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
+0002cca0: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
+0002ccb0: 5f73 697a 6520 3d20 636f 686f 7274 5f73  _size = cohort_s
+0002ccc0: 697a 650a 0a20 2020 2020 2020 2069 6620  ize..        if 
+0002ccd0: 6d69 6e5f 636f 686f 7274 5f73 697a 6520  min_cohort_size 
+0002cce0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0002ccf0: 2020 2020 2020 2020 2064 6562 7567 2822           debug("
+0002cd00: 6861 6e64 6c65 206d 696e 2063 6f68 6f72  handle min cohor
+0002cd10: 7420 7369 7a65 2229 0a20 2020 2020 2020  t size").       
+0002cd20: 2020 2020 206e 5f73 616d 706c 6573 203d       n_samples =
+0002cd30: 2064 732e 6469 6d73 5b22 7361 6d70 6c65   ds.dims["sample
+0002cd40: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
+0002cd50: 6966 206e 5f73 616d 706c 6573 203c 206d  if n_samples < m
+0002cd60: 696e 5f63 6f68 6f72 745f 7369 7a65 3a0a  in_cohort_size:.
+0002cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd80: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0002cd90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002cda0: 2020 2020 2020 6622 6e6f 7420 656e 6f75        f"not enou
+0002cdb0: 6768 2073 616d 706c 6573 2028 7b6e 5f73  gh samples ({n_s
+0002cdc0: 616d 706c 6573 7d29 2066 6f72 206d 696e  amples}) for min
+0002cdd0: 696d 756d 2063 6f68 6f72 7420 7369 7a65  imum cohort size
+0002cde0: 2028 7b6d 696e 5f63 6f68 6f72 745f 7369   ({min_cohort_si
+0002cdf0: 7a65 7d29 220a 2020 2020 2020 2020 2020  ze})".          
+0002ce00: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0002ce10: 2069 6620 6d61 785f 636f 686f 7274 5f73   if max_cohort_s
+0002ce20: 697a 6520 6973 206e 6f74 204e 6f6e 653a  ize is not None:
+0002ce30: 0a20 2020 2020 2020 2020 2020 2064 6562  .            deb
+0002ce40: 7567 2822 6861 6e64 6c65 206d 6178 2063  ug("handle max c
+0002ce50: 6f68 6f72 7420 7369 7a65 2229 0a20 2020  ohort size").   
+0002ce60: 2020 2020 2020 2020 206e 5f73 616d 706c           n_sampl
+0002ce70: 6573 203d 2064 732e 6469 6d73 5b22 7361  es = ds.dims["sa
+0002ce80: 6d70 6c65 7322 5d0a 2020 2020 2020 2020  mples"].        
+0002ce90: 2020 2020 6966 206e 5f73 616d 706c 6573      if n_samples
+0002cea0: 203e 206d 6178 5f63 6f68 6f72 745f 7369   > max_cohort_si
+0002ceb0: 7a65 3a0a 2020 2020 2020 2020 2020 2020  ze:.            
+0002cec0: 2020 2020 726e 6720 3d20 6e70 2e72 616e      rng = np.ran
+0002ced0: 646f 6d2e 6465 6661 756c 745f 726e 6728  dom.default_rng(
+0002cee0: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
+0002cef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002cf00: 2020 6c6f 635f 646f 776e 7361 6d70 6c65    loc_downsample
+0002cf10: 203d 2072 6e67 2e63 686f 6963 6528 0a20   = rng.choice(. 
+0002cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf30: 2020 206e 5f73 616d 706c 6573 2c20 7369     n_samples, si
+0002cf40: 7a65 3d6d 6178 5f63 6f68 6f72 745f 7369  ze=max_cohort_si
+0002cf50: 7a65 2c20 7265 706c 6163 653d 4661 6c73  ze, replace=Fals
+0002cf60: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002cf70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0002cf80: 2020 2020 6c6f 635f 646f 776e 7361 6d70      loc_downsamp
+0002cf90: 6c65 2e73 6f72 7428 290a 2020 2020 2020  le.sort().      
+0002cfa0: 2020 2020 2020 2020 2020 6473 203d 2064            ds = d
+0002cfb0: 732e 6973 656c 2873 616d 706c 6573 3d6c  s.isel(samples=l
+0002cfc0: 6f63 5f64 6f77 6e73 616d 706c 6529 0a0a  oc_downsample)..
+0002cfd0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+0002cfe0: 730a 0a20 2020 2040 646f 6328 0a20 2020  s..    @doc(.   
+0002cff0: 2020 2020 2073 756d 6d61 7279 3d22 4765       summary="Ge
+0002d000: 6e65 7261 7465 2068 3132 2047 5753 5320  nerate h12 GWSS 
+0002d010: 6361 6c69 6272 6174 696f 6e20 6461 7461  calibration data
+0002d020: 2066 6f72 2064 6966 6665 7265 6e74 2077   for different w
+0002d030: 696e 646f 7720 7369 7a65 732e 222c 0a20  indow sizes.",. 
+0002d040: 2020 2020 2020 2072 6574 7572 6e73 3d22         returns="
+0002d050: 2222 0a20 2020 2020 2020 2020 2020 2041  "".            A
+0002d060: 206c 6973 7420 6f66 2048 3132 2063 616c   list of H12 cal
+0002d070: 6962 7261 7469 6f6e 2072 756e 2061 7272  ibration run arr
+0002d080: 6179 7320 666f 7220 6561 6368 2077 696e  ays for each win
+0002d090: 646f 7720 7369 7a65 2c20 636f 6e74 6169  dow size, contai
+0002d0a0: 6e69 6e67 0a20 2020 2020 2020 2020 2020  ning.           
+0002d0b0: 2076 616c 7565 7320 616e 6420 7065 7263   values and perc
+0002d0c0: 656e 7469 6c65 732e 0a20 2020 2020 2020  entiles..       
+0002d0d0: 2022 2222 2c0a 2020 2020 290a 2020 2020   """,.    ).    
+0002d0e0: 6465 6620 6831 325f 6361 6c69 6272 6174  def h12_calibrat
+0002d0f0: 696f 6e28 0a20 2020 2020 2020 2073 656c  ion(.        sel
+0002d100: 662c 0a20 2020 2020 2020 2063 6f6e 7469  f,.        conti
+0002d110: 673a 2062 6173 655f 7061 7261 6d73 2e63  g: base_params.c
+0002d120: 6f6e 7469 672c 0a20 2020 2020 2020 2061  ontig,.        a
+0002d130: 6e61 6c79 7369 733a 2068 6170 5f70 6172  nalysis: hap_par
+0002d140: 616d 732e 616e 616c 7973 6973 203d 2044  ams.analysis = D
+0002d150: 4546 4155 4c54 2c0a 2020 2020 2020 2020  EFAULT,.        
+0002d160: 7361 6d70 6c65 5f71 7565 7279 3a20 4f70  sample_query: Op
+0002d170: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+0002d180: 6d73 2e73 616d 706c 655f 7175 6572 795d  ms.sample_query]
+0002d190: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0002d1a0: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
+0002d1b0: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+0002d1c0: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
+0002d1d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0002d1e0: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+0002d1f0: 696f 6e61 6c5b 6261 7365 5f70 6172 616d  ional[base_param
+0002d200: 732e 636f 686f 7274 5f73 697a 655d 203d  s.cohort_size] =
+0002d210: 2068 3132 5f70 6172 616d 732e 636f 686f   h12_params.coho
+0002d220: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
+0002d230: 0a20 2020 2020 2020 206d 696e 5f63 6f68  .        min_coh
+0002d240: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
+0002d250: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
+0002d260: 6261 7365 5f70 6172 616d 732e 6d69 6e5f  base_params.min_
+0002d270: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
+0002d280: 2020 2020 5d20 3d20 6831 325f 7061 7261      ] = h12_para
+0002d290: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
+0002d2a0: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
+0002d2b0: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
+0002d2c0: 697a 653a 204f 7074 696f 6e61 6c5b 0a20  ize: Optional[. 
+0002d2d0: 2020 2020 2020 2020 2020 2062 6173 655f             base_
+0002d2e0: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
+0002d2f0: 745f 7369 7a65 0a20 2020 2020 2020 205d  t_size.        ]
+0002d300: 203d 2068 3132 5f70 6172 616d 732e 6d61   = h12_params.ma
+0002d310: 785f 636f 686f 7274 5f73 697a 655f 6465  x_cohort_size_de
+0002d320: 6661 756c 742c 0a20 2020 2020 2020 2077  fault,.        w
+0002d330: 696e 646f 775f 7369 7a65 733a 2068 3132  indow_sizes: h12
+0002d340: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
+0002d350: 697a 6573 203d 2068 3132 5f70 6172 616d  izes = h12_param
+0002d360: 732e 7769 6e64 6f77 5f73 697a 6573 5f64  s.window_sizes_d
+0002d370: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+0002d380: 7261 6e64 6f6d 5f73 6565 643a 2062 6173  random_seed: bas
+0002d390: 655f 7061 7261 6d73 2e72 616e 646f 6d5f  e_params.random_
+0002d3a0: 7365 6564 203d 2034 322c 0a20 2020 2029  seed = 42,.    )
+0002d3b0: 202d 3e20 4c69 7374 5b6e 702e 6e64 6172   -> List[np.ndar
+0002d3c0: 7261 795d 3a0a 2020 2020 2020 2020 2320  ray]:.        # 
+0002d3d0: 6368 616e 6765 2074 6869 7320 6e61 6d65  change this name
+0002d3e0: 2069 6620 796f 7520 6576 6572 2063 6861   if you ever cha
+0002d3f0: 6e67 6520 7468 6520 6265 6861 7669 6f75  nge the behaviou
+0002d400: 7220 6f66 2074 6869 7320 6675 6e63 7469  r of this functi
+0002d410: 6f6e 2c20 746f 0a20 2020 2020 2020 2023  on, to.        #
+0002d420: 2069 6e76 616c 6964 6174 6520 616e 7920   invalidate any 
+0002d430: 7072 6576 696f 7573 6c79 2063 6163 6865  previously cache
+0002d440: 6420 6461 7461 0a20 2020 2020 2020 206e  d data.        n
+0002d450: 616d 6520 3d20 7365 6c66 2e5f 6831 325f  ame = self._h12_
+0002d460: 6361 6c69 6272 6174 696f 6e5f 6361 6368  calibration_cach
+0002d470: 655f 6e61 6d65 0a0a 2020 2020 2020 2020  e_name..        
+0002d480: 7061 7261 6d73 203d 2064 6963 7428 0a20  params = dict(. 
+0002d490: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0002d4a0: 673d 636f 6e74 6967 2c0a 2020 2020 2020  g=contig,.      
+0002d4b0: 2020 2020 2020 616e 616c 7973 6973 3d73        analysis=s
+0002d4c0: 656c 662e 5f70 7265 705f 7068 6173 696e  elf._prep_phasin
+0002d4d0: 675f 616e 616c 7973 6973 5f70 6172 616d  g_analysis_param
+0002d4e0: 2861 6e61 6c79 7369 733d 616e 616c 7973  (analysis=analys
+0002d4f0: 6973 292c 0a20 2020 2020 2020 2020 2020  is),.           
+0002d500: 2077 696e 646f 775f 7369 7a65 733d 7769   window_sizes=wi
+0002d510: 6e64 6f77 5f73 697a 6573 2c0a 2020 2020  ndow_sizes,.    
+0002d520: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0002d530: 6574 733d 7365 6c66 2e5f 7072 6570 5f73  ets=self._prep_s
+0002d540: 616d 706c 655f 7365 7473 5f70 6172 616d  ample_sets_param
+0002d550: 2873 616d 706c 655f 7365 7473 3d73 616d  (sample_sets=sam
+0002d560: 706c 655f 7365 7473 292c 0a20 2020 2020  ple_sets),.     
+0002d570: 2020 2020 2020 2023 204e 2e42 2e2c 2064         # N.B., d
+0002d580: 6f20 6e6f 7420 6265 2074 656d 7074 6564  o not be tempted
+0002d590: 2074 6f20 636f 6e76 6572 7420 7468 6973   to convert this
+0002d5a0: 2073 616d 706c 6520 7175 6572 7920 696e   sample query in
+0002d5b0: 746f 2069 6e74 6567 6572 0a20 2020 2020  to integer.     
+0002d5c0: 2020 2020 2020 2023 2069 6e64 6963 6573         # indices
+0002d5d0: 2075 7369 6e67 205f 7072 6570 5f73 616d   using _prep_sam
+0002d5e0: 706c 655f 7365 6c65 6374 696f 6e5f 7061  ple_selection_pa
+0002d5f0: 7261 6d73 2c20 6265 6361 7573 6520 7468  rams, because th
+0002d600: 6520 696e 6469 6365 730a 2020 2020 2020  e indices.      
+0002d610: 2020 2020 2020 2320 6172 6520 6469 6666        # are diff
+0002d620: 6572 656e 7420 696e 2074 6865 2068 6170  erent in the hap
+0002d630: 6c6f 7479 7065 2064 6174 612e 0a20 2020  lotype data..   
+0002d640: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
+0002d650: 7175 6572 793d 7361 6d70 6c65 5f71 7565  query=sample_que
+0002d660: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+0002d670: 636f 686f 7274 5f73 697a 653d 636f 686f  cohort_size=coho
+0002d680: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
+0002d690: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
+0002d6a0: 7369 7a65 3d6d 696e 5f63 6f68 6f72 745f  size=min_cohort_
+0002d6b0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+0002d6c0: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
+0002d6d0: 653d 6d61 785f 636f 686f 7274 5f73 697a  e=max_cohort_siz
+0002d6e0: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
+0002d6f0: 616e 646f 6d5f 7365 6564 3d72 616e 646f  andom_seed=rando
+0002d700: 6d5f 7365 6564 2c0a 2020 2020 2020 2020  m_seed,.        
+0002d710: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
+0002d720: 2020 2020 2020 2020 2020 2020 6361 6c69              cali
+0002d730: 6272 6174 696f 6e5f 7275 6e73 203d 2073  bration_runs = s
+0002d740: 656c 662e 7265 7375 6c74 735f 6361 6368  elf.results_cach
+0002d750: 655f 6765 7428 6e61 6d65 3d6e 616d 652c  e_get(name=name,
+0002d760: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
+0002d770: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0002d780: 4361 6368 654d 6973 733a 0a20 2020 2020  CacheMiss:.     
+0002d790: 2020 2020 2020 2063 616c 6962 7261 7469         calibrati
+0002d7a0: 6f6e 5f72 756e 7320 3d20 7365 6c66 2e5f  on_runs = self._
+0002d7b0: 6831 325f 6361 6c69 6272 6174 696f 6e28  h12_calibration(
+0002d7c0: 2a2a 7061 7261 6d73 290a 2020 2020 2020  **params).      
+0002d7d0: 2020 2020 2020 7365 6c66 2e72 6573 756c        self.resul
+0002d7e0: 7473 5f63 6163 6865 5f73 6574 286e 616d  ts_cache_set(nam
+0002d7f0: 653d 6e61 6d65 2c20 7061 7261 6d73 3d70  e=name, params=p
+0002d800: 6172 616d 732c 2072 6573 756c 7473 3d63  arams, results=c
+0002d810: 616c 6962 7261 7469 6f6e 5f72 756e 7329  alibration_runs)
+0002d820: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002d830: 2063 616c 6962 7261 7469 6f6e 5f72 756e   calibration_run
+0002d840: 730a 0a20 2020 2064 6566 205f 6831 325f  s..    def _h12_
+0002d850: 6361 6c69 6272 6174 696f 6e28 0a20 2020  calibration(.   
+0002d860: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0002d870: 2020 2063 6f6e 7469 672c 0a20 2020 2020     contig,.     
+0002d880: 2020 2061 6e61 6c79 7369 732c 0a20 2020     analysis,.   
+0002d890: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
+0002d8a0: 792c 0a20 2020 2020 2020 2073 616d 706c  y,.        sampl
+0002d8b0: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
+0002d8c0: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+0002d8d0: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
+0002d8e0: 7369 7a65 2c0a 2020 2020 2020 2020 6d61  size,.        ma
+0002d8f0: 785f 636f 686f 7274 5f73 697a 652c 0a20  x_cohort_size,. 
+0002d900: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
+0002d910: 7a65 732c 0a20 2020 2020 2020 2072 616e  zes,.        ran
+0002d920: 646f 6d5f 7365 6564 2c0a 2020 2020 293a  dom_seed,.    ):
+0002d930: 0a20 2020 2020 2020 2023 2061 6363 6573  .        # acces
+0002d940: 7320 6861 706c 6f74 7970 6573 0a20 2020  s haplotypes.   
+0002d950: 2020 2020 2064 735f 6861 7073 203d 2073       ds_haps = s
+0002d960: 656c 662e 6861 706c 6f74 7970 6573 280a  elf.haplotypes(.
+0002d970: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+0002d980: 6f6e 3d63 6f6e 7469 672c 0a20 2020 2020  on=contig,.     
+0002d990: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+0002d9a0: 7473 3d73 616d 706c 655f 7365 7473 2c0a  ts=sample_sets,.
+0002d9b0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+0002d9c0: 6c65 5f71 7565 7279 3d73 616d 706c 655f  le_query=sample_
+0002d9d0: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
+0002d9e0: 2020 2061 6e61 6c79 7369 733d 616e 616c     analysis=anal
+0002d9f0: 7973 6973 2c0a 2020 2020 2020 2020 2020  ysis,.          
+0002da00: 2020 636f 686f 7274 5f73 697a 653d 636f    cohort_size=co
+0002da10: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+0002da20: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
+0002da30: 745f 7369 7a65 3d6d 696e 5f63 6f68 6f72  t_size=min_cohor
+0002da40: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
+0002da50: 2020 2020 6d61 785f 636f 686f 7274 5f73      max_cohort_s
+0002da60: 697a 653d 6d61 785f 636f 686f 7274 5f73  ize=max_cohort_s
+0002da70: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0002da80: 2072 616e 646f 6d5f 7365 6564 3d72 616e   random_seed=ran
+0002da90: 646f 6d5f 7365 6564 2c0a 2020 2020 2020  dom_seed,.      
+0002daa0: 2020 290a 0a20 2020 2020 2020 2067 7420    )..        gt 
+0002dab0: 3d20 616c 6c65 6c2e 4765 6e6f 7479 7065  = allel.Genotype
+0002dac0: 4461 736b 4172 7261 7928 6473 5f68 6170  DaskArray(ds_hap
+0002dad0: 735b 2263 616c 6c5f 6765 6e6f 7479 7065  s["call_genotype
+0002dae0: 225d 2e64 6174 6129 0a20 2020 2020 2020  "].data).       
+0002daf0: 2077 6974 6820 7365 6c66 2e5f 6461 736b   with self._dask
+0002db00: 5f70 726f 6772 6573 7328 6465 7363 3d22  _progress(desc="
+0002db10: 4c6f 6164 2068 6170 6c6f 7479 7065 7322  Load haplotypes"
+0002db20: 293a 0a20 2020 2020 2020 2020 2020 2068  ):.            h
+0002db30: 7420 3d20 6774 2e74 6f5f 6861 706c 6f74  t = gt.to_haplot
+0002db40: 7970 6573 2829 2e63 6f6d 7075 7465 2829  ypes().compute()
+0002db50: 0a0a 2020 2020 2020 2020 6361 6c69 6272  ..        calibr
+0002db60: 6174 696f 6e5f 7275 6e73 203d 2064 6963  ation_runs = dic
+0002db70: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
+0002db80: 7769 6e64 6f77 5f73 697a 6520 696e 2073  window_size in s
+0002db90: 656c 662e 5f70 726f 6772 6573 7328 7769  elf._progress(wi
+0002dba0: 6e64 6f77 5f73 697a 6573 2c20 6465 7363  ndow_sizes, desc
+0002dbb0: 3d22 436f 6d70 7574 6520 4831 3222 293a  ="Compute H12"):
+0002dbc0: 0a20 2020 2020 2020 2020 2020 2068 312c  .            h1,
+0002dbd0: 2068 3132 2c20 6831 3233 2c20 6832 5f68   h12, h123, h2_h
+0002dbe0: 3120 3d20 616c 6c65 6c2e 6d6f 7669 6e67  1 = allel.moving
+0002dbf0: 5f67 6172 7564 5f68 2868 742c 2073 697a  _garud_h(ht, siz
+0002dc00: 653d 7769 6e64 6f77 5f73 697a 6529 0a20  e=window_size). 
+0002dc10: 2020 2020 2020 2020 2020 2063 616c 6962             calib
+0002dc20: 7261 7469 6f6e 5f72 756e 735b 7374 7228  ration_runs[str(
+0002dc30: 7769 6e64 6f77 5f73 697a 6529 5d20 3d20  window_size)] = 
+0002dc40: 6831 320a 0a20 2020 2020 2020 2072 6574  h12..        ret
+0002dc50: 7572 6e20 6361 6c69 6272 6174 696f 6e5f  urn calibration_
+0002dc60: 7275 6e73 0a0a 2020 2020 4064 6f63 280a  runs..    @doc(.
+0002dc70: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
+0002dc80: 2250 6c6f 7420 6831 3220 4757 5353 2063  "Plot h12 GWSS c
+0002dc90: 616c 6962 7261 7469 6f6e 2064 6174 6120  alibration data 
+0002dca0: 666f 7220 6469 6666 6572 656e 7420 7769  for different wi
+0002dcb0: 6e64 6f77 2073 697a 6573 2e22 2c0a 2020  ndow sizes.",.  
+0002dcc0: 2020 2020 2020 7061 7261 6d65 7465 7273        parameters
+0002dcd0: 3d64 6963 7428 0a20 2020 2020 2020 2020  =dict(.         
+0002dce0: 2020 2074 6974 6c65 3d22 506c 6f74 2074     title="Plot t
+0002dcf0: 6974 6c65 2e22 2c0a 2020 2020 2020 2020  itle.",.        
+0002dd00: 2020 2020 7368 6f77 3d22 4966 2054 7275      show="If Tru
+0002dd10: 652c 2073 686f 7720 7468 6520 706c 6f74  e, show the plot
+0002dd20: 2e22 2c0a 2020 2020 2020 2020 292c 0a20  .",.        ),. 
+0002dd30: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
+0002dd40: 745f 6831 325f 6361 6c69 6272 6174 696f  t_h12_calibratio
+0002dd50: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
+0002dd60: 0a20 2020 2020 2020 2063 6f6e 7469 673a  .        contig:
+0002dd70: 2062 6173 655f 7061 7261 6d73 2e63 6f6e   base_params.con
+0002dd80: 7469 672c 0a20 2020 2020 2020 2061 6e61  tig,.        ana
+0002dd90: 6c79 7369 733a 2068 6170 5f70 6172 616d  lysis: hap_param
+0002dda0: 732e 616e 616c 7973 6973 203d 2044 4546  s.analysis = DEF
+0002ddb0: 4155 4c54 2c0a 2020 2020 2020 2020 7361  AULT,.        sa
+0002ddc0: 6d70 6c65 5f71 7565 7279 3a20 4f70 7469  mple_query: Opti
+0002ddd0: 6f6e 616c 5b62 6173 655f 7061 7261 6d73  onal[base_params
+0002dde0: 2e73 616d 706c 655f 7175 6572 795d 203d  .sample_query] =
+0002ddf0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+0002de00: 616d 706c 655f 7365 7473 3a20 4f70 7469  ample_sets: Opti
+0002de10: 6f6e 616c 5b62 6173 655f 7061 7261 6d73  onal[base_params
+0002de20: 2e73 616d 706c 655f 7365 7473 5d20 3d20  .sample_sets] = 
+0002de30: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
+0002de40: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
+0002de50: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
+0002de60: 636f 686f 7274 5f73 697a 655d 203d 2068  cohort_size] = h
+0002de70: 3132 5f70 6172 616d 732e 636f 686f 7274  12_params.cohort
+0002de80: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
+0002de90: 2020 2020 2020 206d 696e 5f63 6f68 6f72         min_cohor
+0002dea0: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
+0002deb0: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
+0002dec0: 7365 5f70 6172 616d 732e 6d69 6e5f 636f  se_params.min_co
+0002ded0: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
+0002dee0: 2020 5d20 3d20 6831 325f 7061 7261 6d73    ] = h12_params
+0002def0: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
+0002df00: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+0002df10: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
+0002df20: 653a 204f 7074 696f 6e61 6c5b 0a20 2020  e: Optional[.   
+0002df30: 2020 2020 2020 2020 2062 6173 655f 7061           base_pa
+0002df40: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
+0002df50: 7369 7a65 0a20 2020 2020 2020 205d 203d  size.        ] =
+0002df60: 2068 3132 5f70 6172 616d 732e 6d61 785f   h12_params.max_
+0002df70: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
+0002df80: 756c 742c 0a20 2020 2020 2020 2077 696e  ult,.        win
+0002df90: 646f 775f 7369 7a65 733a 2068 3132 5f70  dow_sizes: h12_p
+0002dfa0: 6172 616d 732e 7769 6e64 6f77 5f73 697a  arams.window_siz
+0002dfb0: 6573 203d 2068 3132 5f70 6172 616d 732e  es = h12_params.
+0002dfc0: 7769 6e64 6f77 5f73 697a 6573 5f64 6566  window_sizes_def
+0002dfd0: 6175 6c74 2c0a 2020 2020 2020 2020 7261  ault,.        ra
+0002dfe0: 6e64 6f6d 5f73 6565 643a 2062 6173 655f  ndom_seed: base_
+0002dff0: 7061 7261 6d73 2e72 616e 646f 6d5f 7365  params.random_se
+0002e000: 6564 203d 2034 322c 0a20 2020 2020 2020  ed = 42,.       
+0002e010: 2074 6974 6c65 3a20 4f70 7469 6f6e 616c   title: Optional
+0002e020: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0002e030: 2020 2020 2020 7368 6f77 3a20 626f 6f6c        show: bool
+0002e040: 203d 2054 7275 652c 0a20 2020 2029 202d   = True,.    ) -
+0002e050: 3e20 6770 6c74 5f70 6172 616d 732e 6669  > gplt_params.fi
+0002e060: 6775 7265 3a0a 2020 2020 2020 2020 2320  gure:.        # 
+0002e070: 6765 7420 4831 3220 7661 6c75 6573 0a20  get H12 values. 
+0002e080: 2020 2020 2020 2063 616c 6962 7261 7469         calibrati
+0002e090: 6f6e 5f72 756e 7320 3d20 7365 6c66 2e68  on_runs = self.h
+0002e0a0: 3132 5f63 616c 6962 7261 7469 6f6e 280a  12_calibration(.
+0002e0b0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0002e0c0: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
+0002e0d0: 2020 2020 2020 2061 6e61 6c79 7369 733d         analysis=
+0002e0e0: 616e 616c 7973 6973 2c0a 2020 2020 2020  analysis,.      
+0002e0f0: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
+0002e100: 7279 3d73 616d 706c 655f 7175 6572 792c  ry=sample_query,
+0002e110: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+0002e120: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
+0002e130: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
+0002e140: 2020 7769 6e64 6f77 5f73 697a 6573 3d77    window_sizes=w
+0002e150: 696e 646f 775f 7369 7a65 732c 0a20 2020  indow_sizes,.   
+0002e160: 2020 2020 2020 2020 2063 6f68 6f72 745f           cohort_
+0002e170: 7369 7a65 3d63 6f68 6f72 745f 7369 7a65  size=cohort_size
+0002e180: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
+0002e190: 6e5f 636f 686f 7274 5f73 697a 653d 6d69  n_cohort_size=mi
+0002e1a0: 6e5f 636f 686f 7274 5f73 697a 652c 0a20  n_cohort_size,. 
+0002e1b0: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
+0002e1c0: 6f68 6f72 745f 7369 7a65 3d6d 6178 5f63  ohort_size=max_c
+0002e1d0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
+0002e1e0: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
+0002e1f0: 6565 643d 7261 6e64 6f6d 5f73 6565 642c  eed=random_seed,
+0002e200: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0002e210: 2020 2020 2320 636f 6d70 7574 6520 7375      # compute su
+0002e220: 6d6d 6172 6965 730a 2020 2020 2020 2020  mmaries.        
+0002e230: 7135 3020 3d20 5b6e 702e 6d65 6469 616e  q50 = [np.median
+0002e240: 2863 616c 6962 7261 7469 6f6e 5f72 756e  (calibration_run
+0002e250: 735b 7374 7228 7769 6e64 6f77 295d 2920  s[str(window)]) 
+0002e260: 666f 7220 7769 6e64 6f77 2069 6e20 7769  for window in wi
+0002e270: 6e64 6f77 5f73 697a 6573 5d0a 2020 2020  ndow_sizes].    
+0002e280: 2020 2020 7132 3520 3d20 5b0a 2020 2020      q25 = [.    
+0002e290: 2020 2020 2020 2020 6e70 2e70 6572 6365          np.perce
+0002e2a0: 6e74 696c 6528 6361 6c69 6272 6174 696f  ntile(calibratio
+0002e2b0: 6e5f 7275 6e73 5b73 7472 2877 696e 646f  n_runs[str(windo
+0002e2c0: 7729 5d2c 2032 3529 2066 6f72 2077 696e  w)], 25) for win
+0002e2d0: 646f 7720 696e 2077 696e 646f 775f 7369  dow in window_si
+0002e2e0: 7a65 730a 2020 2020 2020 2020 5d0a 2020  zes.        ].  
+0002e2f0: 2020 2020 2020 7137 3520 3d20 5b0a 2020        q75 = [.  
+0002e300: 2020 2020 2020 2020 2020 6e70 2e70 6572            np.per
+0002e310: 6365 6e74 696c 6528 6361 6c69 6272 6174  centile(calibrat
+0002e320: 696f 6e5f 7275 6e73 5b73 7472 2877 696e  ion_runs[str(win
+0002e330: 646f 7729 5d2c 2037 3529 2066 6f72 2077  dow)], 75) for w
+0002e340: 696e 646f 7720 696e 2077 696e 646f 775f  indow in window_
+0002e350: 7369 7a65 730a 2020 2020 2020 2020 5d0a  sizes.        ].
+0002e360: 2020 2020 2020 2020 7130 3520 3d20 5b0a          q05 = [.
+0002e370: 2020 2020 2020 2020 2020 2020 6e70 2e70              np.p
+0002e380: 6572 6365 6e74 696c 6528 6361 6c69 6272  ercentile(calibr
+0002e390: 6174 696f 6e5f 7275 6e73 5b73 7472 2877  ation_runs[str(w
+0002e3a0: 696e 646f 7729 5d2c 2035 2920 666f 7220  indow)], 5) for 
+0002e3b0: 7769 6e64 6f77 2069 6e20 7769 6e64 6f77  window in window
+0002e3c0: 5f73 697a 6573 0a20 2020 2020 2020 205d  _sizes.        ]
+0002e3d0: 0a20 2020 2020 2020 2071 3935 203d 205b  .        q95 = [
+0002e3e0: 0a20 2020 2020 2020 2020 2020 206e 702e  .            np.
+0002e3f0: 7065 7263 656e 7469 6c65 2863 616c 6962  percentile(calib
+0002e400: 7261 7469 6f6e 5f72 756e 735b 7374 7228  ration_runs[str(
+0002e410: 7769 6e64 6f77 295d 2c20 3935 2920 666f  window)], 95) fo
+0002e420: 7220 7769 6e64 6f77 2069 6e20 7769 6e64  r window in wind
+0002e430: 6f77 5f73 697a 6573 0a20 2020 2020 2020  ow_sizes.       
+0002e440: 205d 0a0a 2020 2020 2020 2020 2320 6d61   ]..        # ma
+0002e450: 6b65 2070 6c6f 740a 2020 2020 2020 2020  ke plot.        
+0002e460: 6669 6720 3d20 626f 6b65 682e 706c 6f74  fig = bokeh.plot
+0002e470: 7469 6e67 2e66 6967 7572 6528 7769 6474  ting.figure(widt
+0002e480: 683d 3730 302c 2068 6569 6768 743d 3430  h=700, height=40
+0002e490: 302c 2078 5f61 7869 735f 7479 7065 3d22  0, x_axis_type="
+0002e4a0: 6c6f 6722 290a 2020 2020 2020 2020 6669  log").        fi
+0002e4b0: 672e 7061 7463 6828 0a20 2020 2020 2020  g.patch(.       
+0002e4c0: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
+0002e4d0: 7320 2b20 7769 6e64 6f77 5f73 697a 6573  s + window_sizes
+0002e4e0: 5b3a 3a2d 315d 2c0a 2020 2020 2020 2020  [::-1],.        
+0002e4f0: 2020 2020 7137 3520 2b20 7132 355b 3a3a      q75 + q25[::
+0002e500: 2d31 5d2c 0a20 2020 2020 2020 2020 2020  -1],.           
+0002e510: 2061 6c70 6861 3d30 2e37 352c 0a20 2020   alpha=0.75,.   
+0002e520: 2020 2020 2020 2020 206c 696e 655f 7769           line_wi
+0002e530: 6474 683d 322c 0a20 2020 2020 2020 2020  dth=2,.         
+0002e540: 2020 206c 6567 656e 645f 6c61 6265 6c3d     legend_label=
+0002e550: 2232 352d 3735 2522 2c0a 2020 2020 2020  "25-75%",.      
+0002e560: 2020 290a 2020 2020 2020 2020 6669 672e    ).        fig.
+0002e570: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
+0002e580: 2020 2077 696e 646f 775f 7369 7a65 7320     window_sizes 
+0002e590: 2b20 7769 6e64 6f77 5f73 697a 6573 5b3a  + window_sizes[:
+0002e5a0: 3a2d 315d 2c0a 2020 2020 2020 2020 2020  :-1],.          
+0002e5b0: 2020 7139 3520 2b20 7130 355b 3a3a 2d31    q95 + q05[::-1
+0002e5c0: 5d2c 0a20 2020 2020 2020 2020 2020 2061  ],.            a
+0002e5d0: 6c70 6861 3d30 2e35 2c0a 2020 2020 2020  lpha=0.5,.      
+0002e5e0: 2020 2020 2020 6c69 6e65 5f77 6964 7468        line_width
+0002e5f0: 3d32 2c0a 2020 2020 2020 2020 2020 2020  =2,.            
+0002e600: 6c65 6765 6e64 5f6c 6162 656c 3d22 352d  legend_label="5-
+0002e610: 3935 2522 2c0a 2020 2020 2020 2020 290a  95%",.        ).
+0002e620: 2020 2020 2020 2020 6669 672e 6c69 6e65          fig.line
+0002e630: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
+0002e640: 6e64 6f77 5f73 697a 6573 2c20 7135 302c  ndow_sizes, q50,
+0002e650: 206c 696e 655f 636f 6c6f 723d 2262 6c61   line_color="bla
+0002e660: 636b 222c 206c 696e 655f 7769 6474 683d  ck", line_width=
+0002e670: 342c 206c 6567 656e 645f 6c61 6265 6c3d  4, legend_label=
+0002e680: 226d 6564 6961 6e22 0a20 2020 2020 2020  "median".       
+0002e690: 2029 0a20 2020 2020 2020 2066 6967 2e63   ).        fig.c
+0002e6a0: 6972 636c 6528 7769 6e64 6f77 5f73 697a  ircle(window_siz
+0002e6b0: 6573 2c20 7135 302c 2063 6f6c 6f72 3d22  es, q50, color="
+0002e6c0: 626c 6163 6b22 2c20 6669 6c6c 5f63 6f6c  black", fill_col
+0002e6d0: 6f72 3d22 626c 6163 6b22 2c20 7369 7a65  or="black", size
+0002e6e0: 3d38 290a 0a20 2020 2020 2020 2066 6967  =8)..        fig
+0002e6f0: 2e78 6178 6973 2e74 6963 6b65 7220 3d20  .xaxis.ticker = 
+0002e700: 7769 6e64 6f77 5f73 697a 6573 0a20 2020  window_sizes.   
+0002e710: 2020 2020 2066 6967 2e78 5f72 616e 6765       fig.x_range
+0002e720: 203d 2062 6f6b 6568 2e6d 6f64 656c 732e   = bokeh.models.
+0002e730: 5261 6e67 6531 6428 7769 6e64 6f77 5f73  Range1d(window_s
+0002e740: 697a 6573 5b30 5d2c 2077 696e 646f 775f  izes[0], window_
+0002e750: 7369 7a65 735b 2d31 5d29 0a20 2020 2020  sizes[-1]).     
+0002e760: 2020 2069 6620 7469 746c 6520 6973 204e     if title is N
+0002e770: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002e780: 2074 6974 6c65 203d 2073 616d 706c 655f   title = sample_
+0002e790: 7175 6572 790a 2020 2020 2020 2020 6669  query.        fi
+0002e7a0: 672e 7469 746c 6520 3d20 7469 746c 650a  g.title = title.
+0002e7b0: 2020 2020 2020 2020 6966 2073 686f 773a          if show:
+0002e7c0: 0a20 2020 2020 2020 2020 2020 2062 6f6b  .            bok
+0002e7d0: 6568 2e70 6c6f 7474 696e 672e 7368 6f77  eh.plotting.show
+0002e7e0: 2866 6967 290a 2020 2020 2020 2020 7265  (fig).        re
+0002e7f0: 7475 726e 2066 6967 0a0a 2020 2020 4064  turn fig..    @d
+0002e800: 6f63 280a 2020 2020 2020 2020 7375 6d6d  oc(.        summ
+0002e810: 6172 793d 2252 756e 2068 3132 2067 656e  ary="Run h12 gen
+0002e820: 6f6d 652d 7769 6465 2073 656c 6563 7469  ome-wide selecti
+0002e830: 6f6e 2073 6361 6e2e 222c 0a20 2020 2020  on scan.",.     
+0002e840: 2020 2072 6574 7572 6e73 3d64 6963 7428     returns=dict(
+0002e850: 0a20 2020 2020 2020 2020 2020 2078 3d22  .            x="
+0002e860: 416e 2061 7272 6179 2063 6f6e 7461 696e  An array contain
+0002e870: 696e 6720 7468 6520 7769 6e64 6f77 2063  ing the window c
+0002e880: 656e 7472 6520 706f 696e 7420 6765 6e6f  entre point geno
+0002e890: 6d69 6320 706f 7369 7469 6f6e 732e 222c  mic positions.",
+0002e8a0: 0a20 2020 2020 2020 2020 2020 2068 3132  .            h12
+0002e8b0: 3d22 416e 2061 7272 6179 2077 6974 6820  ="An array with 
+0002e8c0: 6831 3220 7374 6174 6973 7469 6320 7661  h12 statistic va
+0002e8d0: 6c75 6573 2066 6f72 2065 6163 6820 7769  lues for each wi
+0002e8e0: 6e64 6f77 2e22 2c0a 2020 2020 2020 2020  ndow.",.        
+0002e8f0: 292c 0a20 2020 2029 0a20 2020 2064 6566  ),.    ).    def
+0002e900: 2068 3132 5f67 7773 7328 0a20 2020 2020   h12_gwss(.     
+0002e910: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0002e920: 2063 6f6e 7469 673a 2062 6173 655f 7061   contig: base_pa
+0002e930: 7261 6d73 2e63 6f6e 7469 672c 0a20 2020  rams.contig,.   
+0002e940: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
+0002e950: 3a20 6831 325f 7061 7261 6d73 2e77 696e  : h12_params.win
+0002e960: 646f 775f 7369 7a65 2c0a 2020 2020 2020  dow_size,.      
+0002e970: 2020 616e 616c 7973 6973 3a20 6861 705f    analysis: hap_
+0002e980: 7061 7261 6d73 2e61 6e61 6c79 7369 7320  params.analysis 
+0002e990: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
+0002e9a0: 2020 2073 616d 706c 655f 7175 6572 793a     sample_query:
+0002e9b0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
+0002e9c0: 6172 616d 732e 7361 6d70 6c65 5f71 7565  arams.sample_que
+0002e9d0: 7279 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ry] = None,.    
+0002e9e0: 2020 2020 7361 6d70 6c65 5f73 6574 733a      sample_sets:
+0002e9f0: 204f 7074 696f 6e61 6c5b 6261 7365 5f70   Optional[base_p
+0002ea00: 6172 616d 732e 7361 6d70 6c65 5f73 6574  arams.sample_set
+0002ea10: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+0002ea20: 2020 2063 6f68 6f72 745f 7369 7a65 3a20     cohort_size: 
+0002ea30: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0002ea40: 7261 6d73 2e63 6f68 6f72 745f 7369 7a65  rams.cohort_size
+0002ea50: 5d20 3d20 6831 325f 7061 7261 6d73 2e63  ] = h12_params.c
+0002ea60: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
+0002ea70: 6c74 2c0a 2020 2020 2020 2020 6d69 6e5f  lt,.        min_
+0002ea80: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+0002ea90: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
+0002eaa0: 2020 2062 6173 655f 7061 7261 6d73 2e6d     base_params.m
+0002eab0: 696e 5f63 6f68 6f72 745f 7369 7a65 0a20  in_cohort_size. 
+0002eac0: 2020 2020 2020 205d 203d 2068 3132 5f70         ] = h12_p
+0002ead0: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
+0002eae0: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
+0002eaf0: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+0002eb00: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
+0002eb10: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
+0002eb20: 7365 5f70 6172 616d 732e 6d61 785f 636f  se_params.max_co
+0002eb30: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
+0002eb40: 2020 5d20 3d20 6831 325f 7061 7261 6d73    ] = h12_params
+0002eb50: 2e6d 6178 5f63 6f68 6f72 745f 7369 7a65  .max_cohort_size
+0002eb60: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+0002eb70: 2020 7261 6e64 6f6d 5f73 6565 643a 2062    random_seed: b
+0002eb80: 6173 655f 7061 7261 6d73 2e72 616e 646f  ase_params.rando
+0002eb90: 6d5f 7365 6564 203d 2034 322c 0a20 2020  m_seed = 42,.   
+0002eba0: 2029 202d 3e20 5475 706c 655b 6e70 2e6e   ) -> Tuple[np.n
+0002ebb0: 6461 7272 6179 2c20 6e70 2e6e 6461 7272  darray, np.ndarr
+0002ebc0: 6179 5d3a 0a20 2020 2020 2020 2023 2063  ay]:.        # c
+0002ebd0: 6861 6e67 6520 7468 6973 206e 616d 6520  hange this name 
+0002ebe0: 6966 2079 6f75 2065 7665 7220 6368 616e  if you ever chan
+0002ebf0: 6765 2074 6865 2062 6568 6176 696f 7572  ge the behaviour
+0002ec00: 206f 6620 7468 6973 2066 756e 6374 696f   of this functio
+0002ec10: 6e2c 2074 6f0a 2020 2020 2020 2020 2320  n, to.        # 
+0002ec20: 696e 7661 6c69 6461 7465 2061 6e79 2070  invalidate any p
+0002ec30: 7265 7669 6f75 736c 7920 6361 6368 6564  reviously cached
+0002ec40: 2064 6174 610a 2020 2020 2020 2020 6e61   data.        na
+0002ec50: 6d65 203d 2073 656c 662e 5f68 3132 5f67  me = self._h12_g
+0002ec60: 7773 735f 6361 6368 655f 6e61 6d65 0a0a  wss_cache_name..
+0002ec70: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0002ec80: 2064 6963 7428 0a20 2020 2020 2020 2020   dict(.         
+0002ec90: 2020 2063 6f6e 7469 673d 636f 6e74 6967     contig=contig
+0002eca0: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
+0002ecb0: 616c 7973 6973 3d73 656c 662e 5f70 7265  alysis=self._pre
+0002ecc0: 705f 7068 6173 696e 675f 616e 616c 7973  p_phasing_analys
+0002ecd0: 6973 5f70 6172 616d 2861 6e61 6c79 7369  is_param(analysi
+0002ece0: 733d 616e 616c 7973 6973 292c 0a20 2020  s=analysis),.   
+0002ecf0: 2020 2020 2020 2020 2077 696e 646f 775f           window_
+0002ed00: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
+0002ed10: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
+0002ed20: 6d70 6c65 5f73 6574 733d 7365 6c66 2e5f  mple_sets=self._
+0002ed30: 7072 6570 5f73 616d 706c 655f 7365 7473  prep_sample_sets
+0002ed40: 5f70 6172 616d 2873 616d 706c 655f 7365  _param(sample_se
+0002ed50: 7473 3d73 616d 706c 655f 7365 7473 292c  ts=sample_sets),
+0002ed60: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
+0002ed70: 2e42 2e2c 2064 6f20 6e6f 7420 6265 2074  .B., do not be t
+0002ed80: 656d 7074 6564 2074 6f20 636f 6e76 6572  empted to conver
+0002ed90: 7420 7468 6973 2073 616d 706c 6520 7175  t this sample qu
+0002eda0: 6572 7920 696e 746f 2069 6e74 6567 6572  ery into integer
+0002edb0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+0002edc0: 6e64 6963 6573 2075 7369 6e67 205f 7072  ndices using _pr
+0002edd0: 6570 5f73 616d 706c 655f 7365 6c65 6374  ep_sample_select
+0002ede0: 696f 6e5f 7061 7261 6d73 2c20 6265 6361  ion_params, beca
+0002edf0: 7573 6520 7468 6520 696e 6469 6365 730a  use the indices.
+0002ee00: 2020 2020 2020 2020 2020 2020 2320 6172              # ar
+0002ee10: 6520 6469 6666 6572 656e 7420 696e 2074  e different in t
+0002ee20: 6865 2068 6170 6c6f 7479 7065 2064 6174  he haplotype dat
+0002ee30: 612e 0a20 2020 2020 2020 2020 2020 2073  a..            s
+0002ee40: 616d 706c 655f 7175 6572 793d 7361 6d70  ample_query=samp
+0002ee50: 6c65 5f71 7565 7279 2c0a 2020 2020 2020  le_query,.      
+0002ee60: 2020 2020 2020 636f 686f 7274 5f73 697a        cohort_siz
+0002ee70: 653d 636f 686f 7274 5f73 697a 652c 0a20  e=cohort_size,. 
+0002ee80: 2020 2020 2020 2020 2020 206d 696e 5f63             min_c
+0002ee90: 6f68 6f72 745f 7369 7a65 3d6d 696e 5f63  ohort_size=min_c
+0002eea0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
+0002eeb0: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
+0002eec0: 7274 5f73 697a 653d 6d61 785f 636f 686f  rt_size=max_coho
+0002eed0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
+0002eee0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+0002eef0: 3d72 616e 646f 6d5f 7365 6564 2c0a 2020  =random_seed,.  
+0002ef00: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0002ef10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0002ef20: 2020 7265 7375 6c74 7320 3d20 7365 6c66    results = self
+0002ef30: 2e72 6573 756c 7473 5f63 6163 6865 5f67  .results_cache_g
+0002ef40: 6574 286e 616d 653d 6e61 6d65 2c20 7061  et(name=name, pa
+0002ef50: 7261 6d73 3d70 6172 616d 7329 0a0a 2020  rams=params)..  
+0002ef60: 2020 2020 2020 6578 6365 7074 2043 6163        except Cac
+0002ef70: 6865 4d69 7373 3a0a 2020 2020 2020 2020  heMiss:.        
+0002ef80: 2020 2020 7265 7375 6c74 7320 3d20 7365      results = se
+0002ef90: 6c66 2e5f 6831 325f 6777 7373 282a 2a70  lf._h12_gwss(**p
+0002efa0: 6172 616d 7329 0a20 2020 2020 2020 2020  arams).         
+0002efb0: 2020 2073 656c 662e 7265 7375 6c74 735f     self.results_
+0002efc0: 6361 6368 655f 7365 7428 6e61 6d65 3d6e  cache_set(name=n
+0002efd0: 616d 652c 2070 6172 616d 733d 7061 7261  ame, params=para
+0002efe0: 6d73 2c20 7265 7375 6c74 733d 7265 7375  ms, results=resu
+0002eff0: 6c74 7329 0a0a 2020 2020 2020 2020 7820  lts)..        x 
+0002f000: 3d20 7265 7375 6c74 735b 2278 225d 0a20  = results["x"]. 
+0002f010: 2020 2020 2020 2068 3132 203d 2072 6573         h12 = res
+0002f020: 756c 7473 5b22 6831 3222 5d0a 0a20 2020  ults["h12"]..   
+0002f030: 2020 2020 2072 6574 7572 6e20 782c 2068       return x, h
+0002f040: 3132 0a0a 2020 2020 6465 6620 5f68 3132  12..    def _h12
+0002f050: 5f67 7773 7328 0a20 2020 2020 2020 2073  _gwss(.        s
+0002f060: 656c 662c 0a20 2020 2020 2020 2063 6f6e  elf,.        con
+0002f070: 7469 672c 0a20 2020 2020 2020 2061 6e61  tig,.        ana
+0002f080: 6c79 7369 732c 0a20 2020 2020 2020 2077  lysis,.        w
+0002f090: 696e 646f 775f 7369 7a65 2c0a 2020 2020  indow_size,.    
+0002f0a0: 2020 2020 7361 6d70 6c65 5f73 6574 732c      sample_sets,
+0002f0b0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+0002f0c0: 7175 6572 792c 0a20 2020 2020 2020 2063  query,.        c
+0002f0d0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
+0002f0e0: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
+0002f0f0: 697a 652c 0a20 2020 2020 2020 206d 6178  ize,.        max
+0002f100: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
+0002f110: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+0002f120: 642c 0a20 2020 2029 3a0a 2020 2020 2020  d,.    ):.      
+0002f130: 2020 6473 5f68 6170 7320 3d20 7365 6c66    ds_haps = self
+0002f140: 2e68 6170 6c6f 7479 7065 7328 0a20 2020  .haplotypes(.   
+0002f150: 2020 2020 2020 2020 2072 6567 696f 6e3d           region=
+0002f160: 636f 6e74 6967 2c0a 2020 2020 2020 2020  contig,.        
+0002f170: 2020 2020 616e 616c 7973 6973 3d61 6e61      analysis=ana
+0002f180: 6c79 7369 732c 0a20 2020 2020 2020 2020  lysis,.         
+0002f190: 2020 2073 616d 706c 655f 7175 6572 793d     sample_query=
+0002f1a0: 7361 6d70 6c65 5f71 7565 7279 2c0a 2020  sample_query,.  
+0002f1b0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+0002f1c0: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
+0002f1d0: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
+0002f1e0: 6f68 6f72 745f 7369 7a65 3d63 6f68 6f72  ohort_size=cohor
+0002f1f0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
+0002f200: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
+0002f210: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
+0002f220: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0002f230: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
+0002f240: 3d6d 6178 5f63 6f68 6f72 745f 7369 7a65  =max_cohort_size
+0002f250: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
+0002f260: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
+0002f270: 5f73 6565 642c 0a20 2020 2020 2020 2029  _seed,.        )
+0002f280: 0a0a 2020 2020 2020 2020 6774 203d 2061  ..        gt = a
+0002f290: 6c6c 656c 2e47 656e 6f74 7970 6544 6173  llel.GenotypeDas
+0002f2a0: 6b41 7272 6179 2864 735f 6861 7073 5b22  kArray(ds_haps["
+0002f2b0: 6361 6c6c 5f67 656e 6f74 7970 6522 5d2e  call_genotype"].
+0002f2c0: 6461 7461 290a 2020 2020 2020 2020 7769  data).        wi
+0002f2d0: 7468 2073 656c 662e 5f64 6173 6b5f 7072  th self._dask_pr
+0002f2e0: 6f67 7265 7373 2864 6573 633d 224c 6f61  ogress(desc="Loa
+0002f2f0: 6420 6861 706c 6f74 7970 6573 2229 3a0a  d haplotypes"):.
+0002f300: 2020 2020 2020 2020 2020 2020 6874 203d              ht =
+0002f310: 2067 742e 746f 5f68 6170 6c6f 7479 7065   gt.to_haplotype
+0002f320: 7328 292e 636f 6d70 7574 6528 290a 2020  s().compute().  
+0002f330: 2020 2020 2020 706f 7320 3d20 6473 5f68        pos = ds_h
+0002f340: 6170 735b 2276 6172 6961 6e74 5f70 6f73  aps["variant_pos
+0002f350: 6974 696f 6e22 5d2e 7661 6c75 6573 0a0a  ition"].values..
+0002f360: 2020 2020 2020 2020 6831 2c20 6831 322c          h1, h12,
+0002f370: 2068 3132 332c 2068 325f 6831 203d 2061   h123, h2_h1 = a
+0002f380: 6c6c 656c 2e6d 6f76 696e 675f 6761 7275  llel.moving_garu
+0002f390: 645f 6828 6874 2c20 7369 7a65 3d77 696e  d_h(ht, size=win
+0002f3a0: 646f 775f 7369 7a65 290a 0a20 2020 2020  dow_size)..     
+0002f3b0: 2020 2078 203d 2061 6c6c 656c 2e6d 6f76     x = allel.mov
+0002f3c0: 696e 675f 7374 6174 6973 7469 6328 706f  ing_statistic(po
+0002f3d0: 732c 2073 7461 7469 7374 6963 3d6e 702e  s, statistic=np.
+0002f3e0: 6d65 616e 2c20 7369 7a65 3d77 696e 646f  mean, size=windo
+0002f3f0: 775f 7369 7a65 290a 0a20 2020 2020 2020  w_size)..       
+0002f400: 2072 6573 756c 7473 203d 2064 6963 7428   results = dict(
+0002f410: 783d 782c 2068 3132 3d68 3132 290a 0a20  x=x, h12=h12).. 
+0002f420: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0002f430: 7375 6c74 730a 0a20 2020 2040 646f 6328  sults..    @doc(
+0002f440: 0a20 2020 2020 2020 2073 756d 6d61 7279  .        summary
+0002f450: 3d22 506c 6f74 2068 3132 2047 5753 5320  ="Plot h12 GWSS 
+0002f460: 6461 7461 2e22 2c0a 2020 2020 290a 2020  data.",.    ).  
+0002f470: 2020 6465 6620 706c 6f74 5f68 3132 5f67    def plot_h12_g
+0002f480: 7773 735f 7472 6163 6b28 0a20 2020 2020  wss_track(.     
+0002f490: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0002f4a0: 2063 6f6e 7469 673a 2062 6173 655f 7061   contig: base_pa
+0002f4b0: 7261 6d73 2e63 6f6e 7469 672c 0a20 2020  rams.contig,.   
+0002f4c0: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
+0002f4d0: 3a20 6831 325f 7061 7261 6d73 2e77 696e  : h12_params.win
+0002f4e0: 646f 775f 7369 7a65 2c0a 2020 2020 2020  dow_size,.      
+0002f4f0: 2020 616e 616c 7973 6973 3a20 6861 705f    analysis: hap_
+0002f500: 7061 7261 6d73 2e61 6e61 6c79 7369 7320  params.analysis 
+0002f510: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
+0002f520: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
+0002f530: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0002f540: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
+0002f550: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0002f560: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
+0002f570: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0002f580: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
+0002f590: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
+0002f5a0: 2020 2063 6f68 6f72 745f 7369 7a65 3a20     cohort_size: 
+0002f5b0: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0002f5c0: 7261 6d73 2e63 6f68 6f72 745f 7369 7a65  rams.cohort_size
+0002f5d0: 5d20 3d20 6831 325f 7061 7261 6d73 2e63  ] = h12_params.c
+0002f5e0: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
+0002f5f0: 6c74 2c0a 2020 2020 2020 2020 6d69 6e5f  lt,.        min_
+0002f600: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+0002f610: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
+0002f620: 2020 2062 6173 655f 7061 7261 6d73 2e6d     base_params.m
+0002f630: 696e 5f63 6f68 6f72 745f 7369 7a65 0a20  in_cohort_size. 
+0002f640: 2020 2020 2020 205d 203d 2068 3132 5f70         ] = h12_p
+0002f650: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
+0002f660: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
+0002f670: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+0002f680: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
+0002f690: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
+0002f6a0: 7365 5f70 6172 616d 732e 6d61 785f 636f  se_params.max_co
+0002f6b0: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
+0002f6c0: 2020 5d20 3d20 6831 325f 7061 7261 6d73    ] = h12_params
+0002f6d0: 2e6d 6178 5f63 6f68 6f72 745f 7369 7a65  .max_cohort_size
+0002f6e0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+0002f6f0: 2020 7261 6e64 6f6d 5f73 6565 643a 2062    random_seed: b
+0002f700: 6173 655f 7061 7261 6d73 2e72 616e 646f  ase_params.rando
+0002f710: 6d5f 7365 6564 203d 2034 322c 0a20 2020  m_seed = 42,.   
+0002f720: 2020 2020 2074 6974 6c65 3a20 4f70 7469       title: Opti
+0002f730: 6f6e 616c 5b67 706c 745f 7061 7261 6d73  onal[gplt_params
+0002f740: 2e74 6974 6c65 5d20 3d20 4e6f 6e65 2c0a  .title] = None,.
+0002f750: 2020 2020 2020 2020 7369 7a69 6e67 5f6d          sizing_m
+0002f760: 6f64 653a 2067 706c 745f 7061 7261 6d73  ode: gplt_params
+0002f770: 2e73 697a 696e 675f 6d6f 6465 203d 2067  .sizing_mode = g
+0002f780: 706c 745f 7061 7261 6d73 2e73 697a 696e  plt_params.sizin
+0002f790: 675f 6d6f 6465 5f64 6566 6175 6c74 2c0a  g_mode_default,.
+0002f7a0: 2020 2020 2020 2020 7769 6474 683a 2067          width: g
+0002f7b0: 706c 745f 7061 7261 6d73 2e77 6964 7468  plt_params.width
+0002f7c0: 203d 2067 706c 745f 7061 7261 6d73 2e77   = gplt_params.w
+0002f7d0: 6964 7468 5f64 6566 6175 6c74 2c0a 2020  idth_default,.  
+0002f7e0: 2020 2020 2020 6865 6967 6874 3a20 6770        height: gp
+0002f7f0: 6c74 5f70 6172 616d 732e 6865 6967 6874  lt_params.height
+0002f800: 203d 2032 3030 2c0a 2020 2020 2020 2020   = 200,.        
+0002f810: 7368 6f77 3a20 6770 6c74 5f70 6172 616d  show: gplt_param
+0002f820: 732e 7368 6f77 203d 2054 7275 652c 0a20  s.show = True,. 
+0002f830: 2020 2020 2020 2078 5f72 616e 6765 3a20         x_range: 
+0002f840: 4f70 7469 6f6e 616c 5b67 706c 745f 7061  Optional[gplt_pa
+0002f850: 7261 6d73 2e78 5f72 616e 6765 5d20 3d20  rams.x_range] = 
+0002f860: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2067  None,.    ) -> g
+0002f870: 706c 745f 7061 7261 6d73 2e66 6967 7572  plt_params.figur
+0002f880: 653a 0a20 2020 2020 2020 2023 2063 6f6d  e:.        # com
+0002f890: 7075 7465 2048 3132 0a20 2020 2020 2020  pute H12.       
+0002f8a0: 2078 2c20 6831 3220 3d20 7365 6c66 2e68   x, h12 = self.h
+0002f8b0: 3132 5f67 7773 7328 0a20 2020 2020 2020  12_gwss(.       
+0002f8c0: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
+0002f8d0: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+0002f8e0: 616e 616c 7973 6973 3d61 6e61 6c79 7369  analysis=analysi
+0002f8f0: 732c 0a20 2020 2020 2020 2020 2020 2077  s,.            w
+0002f900: 696e 646f 775f 7369 7a65 3d77 696e 646f  indow_size=windo
+0002f910: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
+0002f920: 2020 2020 636f 686f 7274 5f73 697a 653d      cohort_size=
+0002f930: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+0002f940: 2020 2020 2020 2020 206d 696e 5f63 6f68           min_coh
+0002f950: 6f72 745f 7369 7a65 3d6d 696e 5f63 6f68  ort_size=min_coh
+0002f960: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
+0002f970: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
+0002f980: 5f73 697a 653d 6d61 785f 636f 686f 7274  _size=max_cohort
+0002f990: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+0002f9a0: 2020 2073 616d 706c 655f 7175 6572 793d     sample_query=
+0002f9b0: 7361 6d70 6c65 5f71 7565 7279 2c0a 2020  sample_query,.  
+0002f9c0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+0002f9d0: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
+0002f9e0: 732c 0a20 2020 2020 2020 2020 2020 2072  s,.            r
+0002f9f0: 616e 646f 6d5f 7365 6564 3d72 616e 646f  andom_seed=rando
+0002fa00: 6d5f 7365 6564 2c0a 2020 2020 2020 2020  m_seed,.        
+0002fa10: 290a 0a20 2020 2020 2020 2023 2064 6574  )..        # det
+0002fa20: 6572 6d69 6e65 2058 2061 7869 7320 7261  ermine X axis ra
+0002fa30: 6e67 650a 2020 2020 2020 2020 785f 6d69  nge.        x_mi
+0002fa40: 6e20 3d20 785b 305d 0a20 2020 2020 2020  n = x[0].       
+0002fa50: 2078 5f6d 6178 203d 2078 5b2d 315d 0a20   x_max = x[-1]. 
+0002fa60: 2020 2020 2020 2069 6620 785f 7261 6e67         if x_rang
+0002fa70: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0002fa80: 2020 2020 2020 2078 5f72 616e 6765 203d         x_range =
+0002fa90: 2062 6f6b 6568 2e6d 6f64 656c 732e 5261   bokeh.models.Ra
+0002faa0: 6e67 6531 6428 785f 6d69 6e2c 2078 5f6d  nge1d(x_min, x_m
+0002fab0: 6178 2c20 626f 756e 6473 3d22 6175 746f  ax, bounds="auto
+0002fac0: 2229 0a0a 2020 2020 2020 2020 2320 6372  ")..        # cr
+0002fad0: 6561 7465 2061 2066 6967 7572 650a 2020  eate a figure.  
+0002fae0: 2020 2020 2020 7877 6865 656c 5f7a 6f6f        xwheel_zoo
+0002faf0: 6d20 3d20 626f 6b65 682e 6d6f 6465 6c73  m = bokeh.models
+0002fb00: 2e57 6865 656c 5a6f 6f6d 546f 6f6c 280a  .WheelZoomTool(.
+0002fb10: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
+0002fb20: 6e73 696f 6e73 3d22 7769 6474 6822 2c20  nsions="width", 
+0002fb30: 6d61 696e 7461 696e 5f66 6f63 7573 3d46  maintain_focus=F
+0002fb40: 616c 7365 0a20 2020 2020 2020 2029 0a20  alse.        ). 
+0002fb50: 2020 2020 2020 2069 6620 7469 746c 6520         if title 
+0002fb60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002fb70: 2020 2020 2074 6974 6c65 203d 2073 616d       title = sam
+0002fb80: 706c 655f 7175 6572 790a 2020 2020 2020  ple_query.      
+0002fb90: 2020 6669 6720 3d20 626f 6b65 682e 706c    fig = bokeh.pl
+0002fba0: 6f74 7469 6e67 2e66 6967 7572 6528 0a20  otting.figure(. 
+0002fbb0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+0002fbc0: 3d74 6974 6c65 2c0a 2020 2020 2020 2020  =title,.        
+0002fbd0: 2020 2020 746f 6f6c 733d 5b22 7870 616e      tools=["xpan
+0002fbe0: 222c 2022 787a 6f6f 6d5f 696e 222c 2022  ", "xzoom_in", "
+0002fbf0: 787a 6f6f 6d5f 6f75 7422 2c20 7877 6865  xzoom_out", xwhe
+0002fc00: 656c 5f7a 6f6f 6d2c 2022 7265 7365 7422  el_zoom, "reset"
+0002fc10: 5d2c 0a20 2020 2020 2020 2020 2020 2061  ],.            a
+0002fc20: 6374 6976 655f 7363 726f 6c6c 3d78 7768  ctive_scroll=xwh
+0002fc30: 6565 6c5f 7a6f 6f6d 2c0a 2020 2020 2020  eel_zoom,.      
+0002fc40: 2020 2020 2020 6163 7469 7665 5f64 7261        active_dra
+0002fc50: 673d 2278 7061 6e22 2c0a 2020 2020 2020  g="xpan",.      
+0002fc60: 2020 2020 2020 7369 7a69 6e67 5f6d 6f64        sizing_mod
+0002fc70: 653d 7369 7a69 6e67 5f6d 6f64 652c 0a20  e=sizing_mode,. 
+0002fc80: 2020 2020 2020 2020 2020 2077 6964 7468             width
+0002fc90: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
+0002fca0: 2020 2020 6865 6967 6874 3d68 6569 6768      height=heigh
+0002fcb0: 742c 0a20 2020 2020 2020 2020 2020 2074  t,.            t
+0002fcc0: 6f6f 6c62 6172 5f6c 6f63 6174 696f 6e3d  oolbar_location=
+0002fcd0: 2261 626f 7665 222c 0a20 2020 2020 2020  "above",.       
+0002fce0: 2020 2020 2078 5f72 616e 6765 3d78 5f72       x_range=x_r
+0002fcf0: 616e 6765 2c0a 2020 2020 2020 2020 2020  ange,.          
+0002fd00: 2020 795f 7261 6e67 653d 2830 2c20 3129    y_range=(0, 1)
+0002fd10: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0002fd20: 2020 2020 2023 2070 6c6f 7420 4831 320a       # plot H12.
+0002fd30: 2020 2020 2020 2020 6669 672e 6369 7263          fig.circ
+0002fd40: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+0002fd50: 783d 782c 0a20 2020 2020 2020 2020 2020  x=x,.           
+0002fd60: 2079 3d68 3132 2c0a 2020 2020 2020 2020   y=h12,.        
+0002fd70: 2020 2020 7369 7a65 3d33 2c0a 2020 2020      size=3,.    
+0002fd80: 2020 2020 2020 2020 6c69 6e65 5f77 6964          line_wid
+0002fd90: 7468 3d30 2e35 2c0a 2020 2020 2020 2020  th=0.5,.        
+0002fda0: 2020 2020 6c69 6e65 5f63 6f6c 6f72 3d22      line_color="
+0002fdb0: 626c 6163 6b22 2c0a 2020 2020 2020 2020  black",.        
+0002fdc0: 2020 2020 6669 6c6c 5f63 6f6c 6f72 3d4e      fill_color=N
+0002fdd0: 6f6e 652c 0a20 2020 2020 2020 2029 0a0a  one,.        )..
+0002fde0: 2020 2020 2020 2020 2320 7469 6479 2075          # tidy u
+0002fdf0: 7020 7468 6520 706c 6f74 0a20 2020 2020  p the plot.     
+0002fe00: 2020 2066 6967 2e79 6178 6973 2e61 7869     fig.yaxis.axi
+0002fe10: 735f 6c61 6265 6c20 3d20 2248 3132 220a  s_label = "H12".
+0002fe20: 2020 2020 2020 2020 6669 672e 7961 7869          fig.yaxi
+0002fe30: 732e 7469 636b 6572 203d 205b 302c 2031  s.ticker = [0, 1
+0002fe40: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+0002fe50: 626f 6b65 685f 7374 796c 655f 6765 6e6f  bokeh_style_geno
+0002fe60: 6d65 5f78 6178 6973 2866 6967 2c20 636f  me_xaxis(fig, co
+0002fe70: 6e74 6967 290a 0a20 2020 2020 2020 2069  ntig)..        i
+0002fe80: 6620 7368 6f77 3a0a 2020 2020 2020 2020  f show:.        
+0002fe90: 2020 2020 626f 6b65 682e 706c 6f74 7469      bokeh.plotti
+0002fea0: 6e67 2e73 686f 7728 6669 6729 0a0a 2020  ng.show(fig)..  
+0002feb0: 2020 2020 2020 7265 7475 726e 2066 6967        return fig
+0002fec0: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+0002fed0: 2020 2020 7375 6d6d 6172 793d 2250 6c6f      summary="Plo
+0002fee0: 7420 6831 3220 4757 5353 2064 6174 612e  t h12 GWSS data.
+0002fef0: 222c 0a20 2020 2029 0a20 2020 2064 6566  ",.    ).    def
+0002ff00: 2070 6c6f 745f 6831 325f 6777 7373 280a   plot_h12_gwss(.
+0002ff10: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0002ff20: 2020 2020 2020 636f 6e74 6967 3a20 6261        contig: ba
+0002ff30: 7365 5f70 6172 616d 732e 636f 6e74 6967  se_params.contig
+0002ff40: 2c0a 2020 2020 2020 2020 7769 6e64 6f77  ,.        window
+0002ff50: 5f73 697a 653a 2068 3132 5f70 6172 616d  _size: h12_param
+0002ff60: 732e 7769 6e64 6f77 5f73 697a 652c 0a20  s.window_size,. 
+0002ff70: 2020 2020 2020 2061 6e61 6c79 7369 733a         analysis:
+0002ff80: 2068 6170 5f70 6172 616d 732e 616e 616c   hap_params.anal
+0002ff90: 7973 6973 203d 2044 4546 4155 4c54 2c0a  ysis = DEFAULT,.
+0002ffa0: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+0002ffb0: 6574 733a 204f 7074 696f 6e61 6c5b 6261  ets: Optional[ba
+0002ffc0: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
+0002ffd0: 5f73 6574 735d 203d 204e 6f6e 652c 0a20  _sets] = None,. 
+0002ffe0: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
+0002fff0: 6572 793a 204f 7074 696f 6e61 6c5b 6261  ery: Optional[ba
+00030000: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
+00030010: 5f71 7565 7279 5d20 3d20 4e6f 6e65 2c0a  _query] = None,.
+00030020: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
+00030030: 697a 653a 204f 7074 696f 6e61 6c5b 6261  ize: Optional[ba
+00030040: 7365 5f70 6172 616d 732e 636f 686f 7274  se_params.cohort
+00030050: 5f73 697a 655d 203d 2068 3132 5f70 6172  _size] = h12_par
+00030060: 616d 732e 636f 686f 7274 5f73 697a 655f  ams.cohort_size_
+00030070: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+00030080: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+00030090: 3a20 4f70 7469 6f6e 616c 5b0a 2020 2020  : Optional[.    
+000300a0: 2020 2020 2020 2020 6261 7365 5f70 6172          base_par
+000300b0: 616d 732e 6d69 6e5f 636f 686f 7274 5f73  ams.min_cohort_s
+000300c0: 697a 650a 2020 2020 2020 2020 5d20 3d20  ize.        ] = 
+000300d0: 6831 325f 7061 7261 6d73 2e6d 696e 5f63  h12_params.min_c
+000300e0: 6f68 6f72 745f 7369 7a65 5f64 6566 6175  ohort_size_defau
+000300f0: 6c74 2c0a 2020 2020 2020 2020 6d61 785f  lt,.        max_
+00030100: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+00030110: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
+00030120: 2020 2062 6173 655f 7061 7261 6d73 2e6d     base_params.m
+00030130: 6178 5f63 6f68 6f72 745f 7369 7a65 0a20  ax_cohort_size. 
+00030140: 2020 2020 2020 205d 203d 2068 3132 5f70         ] = h12_p
+00030150: 6172 616d 732e 6d61 785f 636f 686f 7274  arams.max_cohort
+00030160: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
+00030170: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
+00030180: 6564 3a20 6261 7365 5f70 6172 616d 732e  ed: base_params.
+00030190: 7261 6e64 6f6d 5f73 6565 6420 3d20 3432  random_seed = 42
+000301a0: 2c0a 2020 2020 2020 2020 7469 746c 653a  ,.        title:
+000301b0: 204f 7074 696f 6e61 6c5b 6770 6c74 5f70   Optional[gplt_p
+000301c0: 6172 616d 732e 7469 746c 655d 203d 204e  arams.title] = N
+000301d0: 6f6e 652c 0a20 2020 2020 2020 2073 697a  one,.        siz
+000301e0: 696e 675f 6d6f 6465 3a20 6770 6c74 5f70  ing_mode: gplt_p
+000301f0: 6172 616d 732e 7369 7a69 6e67 5f6d 6f64  arams.sizing_mod
+00030200: 6520 3d20 6770 6c74 5f70 6172 616d 732e  e = gplt_params.
+00030210: 7369 7a69 6e67 5f6d 6f64 655f 6465 6661  sizing_mode_defa
+00030220: 756c 742c 0a20 2020 2020 2020 2077 6964  ult,.        wid
+00030230: 7468 3a20 6770 6c74 5f70 6172 616d 732e  th: gplt_params.
+00030240: 7769 6474 6820 3d20 6770 6c74 5f70 6172  width = gplt_par
+00030250: 616d 732e 7769 6474 685f 6465 6661 756c  ams.width_defaul
+00030260: 742c 0a20 2020 2020 2020 2074 7261 636b  t,.        track
+00030270: 5f68 6569 6768 743a 2067 706c 745f 7061  _height: gplt_pa
+00030280: 7261 6d73 2e74 7261 636b 5f68 6569 6768  rams.track_heigh
+00030290: 7420 3d20 3137 302c 0a20 2020 2020 2020  t = 170,.       
+000302a0: 2067 656e 6573 5f68 6569 6768 743a 2067   genes_height: g
+000302b0: 706c 745f 7061 7261 6d73 2e67 656e 6573  plt_params.genes
+000302c0: 5f68 6569 6768 7420 3d20 6770 6c74 5f70  _height = gplt_p
+000302d0: 6172 616d 732e 6765 6e65 735f 6865 6967  arams.genes_heig
+000302e0: 6874 5f64 6566 6175 6c74 2c0a 2020 2020  ht_default,.    
+000302f0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00030300: 2020 2023 2067 7773 7320 7472 6163 6b0a     # gwss track.
+00030310: 2020 2020 2020 2020 6669 6731 203d 2073          fig1 = s
+00030320: 656c 662e 706c 6f74 5f68 3132 5f67 7773  elf.plot_h12_gws
+00030330: 735f 7472 6163 6b28 0a20 2020 2020 2020  s_track(.       
+00030340: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
+00030350: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+00030360: 616e 616c 7973 6973 3d61 6e61 6c79 7369  analysis=analysi
+00030370: 732c 0a20 2020 2020 2020 2020 2020 2077  s,.            w
+00030380: 696e 646f 775f 7369 7a65 3d77 696e 646f  indow_size=windo
+00030390: 775f 7369 7a65 2c0a 2020 2020 2020 2020  w_size,.        
+000303a0: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
+000303b0: 7361 6d70 6c65 5f73 6574 732c 0a20 2020  sample_sets,.   
+000303c0: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
+000303d0: 7175 6572 793d 7361 6d70 6c65 5f71 7565  query=sample_que
+000303e0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+000303f0: 636f 686f 7274 5f73 697a 653d 636f 686f  cohort_size=coho
+00030400: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
+00030410: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
+00030420: 7369 7a65 3d6d 696e 5f63 6f68 6f72 745f  size=min_cohort_
+00030430: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+00030440: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
+00030450: 653d 6d61 785f 636f 686f 7274 5f73 697a  e=max_cohort_siz
+00030460: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
+00030470: 616e 646f 6d5f 7365 6564 3d72 616e 646f  andom_seed=rando
+00030480: 6d5f 7365 6564 2c0a 2020 2020 2020 2020  m_seed,.        
+00030490: 2020 2020 7469 746c 653d 7469 746c 652c      title=title,
+000304a0: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+000304b0: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
+000304c0: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
+000304d0: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
+000304e0: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+000304f0: 743d 7472 6163 6b5f 6865 6967 6874 2c0a  t=track_height,.
+00030500: 2020 2020 2020 2020 2020 2020 7368 6f77              show
+00030510: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00030520: 290a 0a20 2020 2020 2020 2066 6967 312e  )..        fig1.
+00030530: 7861 7869 732e 7669 7369 626c 6520 3d20  xaxis.visible = 
+00030540: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+00030550: 2070 6c6f 7420 6765 6e65 730a 2020 2020   plot genes.    
+00030560: 2020 2020 6669 6732 203d 2073 656c 662e      fig2 = self.
+00030570: 706c 6f74 5f67 656e 6573 280a 2020 2020  plot_genes(.    
+00030580: 2020 2020 2020 2020 7265 6769 6f6e 3d63          region=c
+00030590: 6f6e 7469 672c 0a20 2020 2020 2020 2020  ontig,.         
+000305a0: 2020 2073 697a 696e 675f 6d6f 6465 3d73     sizing_mode=s
+000305b0: 697a 696e 675f 6d6f 6465 2c0a 2020 2020  izing_mode,.    
+000305c0: 2020 2020 2020 2020 7769 6474 683d 7769          width=wi
+000305d0: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
+000305e0: 2068 6569 6768 743d 6765 6e65 735f 6865   height=genes_he
+000305f0: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+00030600: 2020 785f 7261 6e67 653d 6669 6731 2e78    x_range=fig1.x
+00030610: 5f72 616e 6765 2c0a 2020 2020 2020 2020  _range,.        
+00030620: 2020 2020 7368 6f77 3d46 616c 7365 2c0a      show=False,.
+00030630: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00030640: 2020 2023 2063 6f6d 6269 6e65 2070 6c6f     # combine plo
+00030650: 7473 2069 6e74 6f20 6120 7369 6e67 6c65  ts into a single
+00030660: 2066 6967 7572 650a 2020 2020 2020 2020   figure.        
+00030670: 6669 6720 3d20 626f 6b65 682e 6c61 796f  fig = bokeh.layo
+00030680: 7574 732e 6772 6964 706c 6f74 280a 2020  uts.gridplot(.  
+00030690: 2020 2020 2020 2020 2020 5b66 6967 312c            [fig1,
+000306a0: 2066 6967 325d 2c0a 2020 2020 2020 2020   fig2],.        
+000306b0: 2020 2020 6e63 6f6c 733d 312c 0a20 2020      ncols=1,.   
+000306c0: 2020 2020 2020 2020 2074 6f6f 6c62 6172           toolbar
+000306d0: 5f6c 6f63 6174 696f 6e3d 2261 626f 7665  _location="above
+000306e0: 222c 0a20 2020 2020 2020 2020 2020 206d  ",.            m
+000306f0: 6572 6765 5f74 6f6f 6c73 3d54 7275 652c  erge_tools=True,
+00030700: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+00030710: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
+00030720: 6d6f 6465 2c0a 2020 2020 2020 2020 290a  mode,.        ).
+00030730: 0a20 2020 2020 2020 2062 6f6b 6568 2e70  .        bokeh.p
+00030740: 6c6f 7474 696e 672e 7368 6f77 2866 6967  lotting.show(fig
+00030750: 290a 0a20 2020 2040 646f 6328 0a20 2020  )..    @doc(.   
+00030760: 2020 2020 2073 756d 6d61 7279 3d22 2222       summary="""
+00030770: 0a20 2020 2020 2020 2020 2020 2052 756e  .            Run
+00030780: 2061 2048 3158 2067 656e 6f6d 652d 7769   a H1X genome-wi
+00030790: 6465 2073 6361 6e20 746f 2064 6574 6563  de scan to detec
+000307a0: 7420 6765 6e6f 6d65 2072 6567 696f 6e73  t genome regions
+000307b0: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
+000307c0: 2020 7368 6172 6564 2073 656c 6563 7469    shared selecti
+000307d0: 7665 2073 7765 6570 7320 6265 7477 6565  ve sweeps betwee
+000307e0: 6e20 7477 6f20 636f 686f 7274 732e 0a20  n two cohorts.. 
+000307f0: 2020 2020 2020 2022 2222 2c0a 2020 2020         """,.    
+00030800: 2020 2020 7265 7475 726e 733d 6469 6374      returns=dict
+00030810: 280a 2020 2020 2020 2020 2020 2020 783d  (.            x=
+00030820: 2241 6e20 6172 7261 7920 636f 6e74 6169  "An array contai
+00030830: 6e69 6e67 2074 6865 2077 696e 646f 7720  ning the window 
+00030840: 6365 6e74 7265 2070 6f69 6e74 2067 656e  centre point gen
+00030850: 6f6d 6963 2070 6f73 6974 696f 6e73 2e22  omic positions."
+00030860: 2c0a 2020 2020 2020 2020 2020 2020 6831  ,.            h1
+00030870: 783d 2241 6e20 6172 7261 7920 7769 7468  x="An array with
+00030880: 2048 3158 2073 7461 7469 7374 6963 2076   H1X statistic v
+00030890: 616c 7565 7320 666f 7220 6561 6368 2077  alues for each w
+000308a0: 696e 646f 772e 222c 0a20 2020 2020 2020  indow.",.       
+000308b0: 2029 2c0a 2020 2020 290a 2020 2020 6465   ),.    ).    de
+000308c0: 6620 6831 785f 6777 7373 280a 2020 2020  f h1x_gwss(.    
+000308d0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000308e0: 2020 636f 6e74 6967 3a20 6261 7365 5f70    contig: base_p
+000308f0: 6172 616d 732e 636f 6e74 6967 2c0a 2020  arams.contig,.  
+00030900: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
+00030910: 653a 2068 3132 5f70 6172 616d 732e 7769  e: h12_params.wi
+00030920: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
+00030930: 2020 2063 6f68 6f72 7431 5f71 7565 7279     cohort1_query
+00030940: 3a20 6261 7365 5f70 6172 616d 732e 7361  : base_params.sa
+00030950: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
+00030960: 2020 2020 636f 686f 7274 325f 7175 6572      cohort2_quer
+00030970: 793a 2062 6173 655f 7061 7261 6d73 2e73  y: base_params.s
+00030980: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+00030990: 2020 2020 2061 6e61 6c79 7369 733a 2068       analysis: h
+000309a0: 6170 5f70 6172 616d 732e 616e 616c 7973  ap_params.analys
+000309b0: 6973 203d 2044 4546 4155 4c54 2c0a 2020  is = DEFAULT,.  
+000309c0: 2020 2020 2020 7361 6d70 6c65 5f73 6574        sample_set
+000309d0: 733a 204f 7074 696f 6e61 6c5b 6261 7365  s: Optional[base
+000309e0: 5f70 6172 616d 732e 7361 6d70 6c65 5f73  _params.sample_s
+000309f0: 6574 735d 203d 204e 6f6e 652c 0a20 2020  ets] = None,.   
+00030a00: 2020 2020 2063 6f68 6f72 745f 7369 7a65       cohort_size
+00030a10: 3a20 4f70 7469 6f6e 616c 5b62 6173 655f  : Optional[base_
+00030a20: 7061 7261 6d73 2e63 6f68 6f72 745f 7369  params.cohort_si
+00030a30: 7a65 5d20 3d20 6831 325f 7061 7261 6d73  ze] = h12_params
+00030a40: 2e63 6f68 6f72 745f 7369 7a65 5f64 6566  .cohort_size_def
+00030a50: 6175 6c74 2c0a 2020 2020 2020 2020 6d69  ault,.        mi
+00030a60: 6e5f 636f 686f 7274 5f73 697a 653a 204f  n_cohort_size: O
+00030a70: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+00030a80: 2020 2020 2062 6173 655f 7061 7261 6d73       base_params
+00030a90: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
+00030aa0: 0a20 2020 2020 2020 205d 203d 2068 3132  .        ] = h12
+00030ab0: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
+00030ac0: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
+00030ad0: 0a20 2020 2020 2020 206d 6178 5f63 6f68  .        max_coh
+00030ae0: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
+00030af0: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
+00030b00: 6261 7365 5f70 6172 616d 732e 6d61 785f  base_params.max_
+00030b10: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
+00030b20: 2020 2020 5d20 3d20 6831 325f 7061 7261      ] = h12_para
+00030b30: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
+00030b40: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
+00030b50: 2020 2020 7261 6e64 6f6d 5f73 6565 643a      random_seed:
+00030b60: 2062 6173 655f 7061 7261 6d73 2e72 616e   base_params.ran
+00030b70: 646f 6d5f 7365 6564 203d 2034 322c 0a20  dom_seed = 42,. 
+00030b80: 2020 2029 202d 3e20 5475 706c 655b 6e70     ) -> Tuple[np
+00030b90: 2e6e 6461 7272 6179 2c20 6e70 2e6e 6461  .ndarray, np.nda
+00030ba0: 7272 6179 5d3a 0a20 2020 2020 2020 2023  rray]:.        #
+00030bb0: 2063 6861 6e67 6520 7468 6973 206e 616d   change this nam
+00030bc0: 6520 6966 2079 6f75 2065 7665 7220 6368  e if you ever ch
+00030bd0: 616e 6765 2074 6865 2062 6568 6176 696f  ange the behavio
+00030be0: 7572 206f 6620 7468 6973 2066 756e 6374  ur of this funct
+00030bf0: 696f 6e2c 2074 6f0a 2020 2020 2020 2020  ion, to.        
+00030c00: 2320 696e 7661 6c69 6461 7465 2061 6e79  # invalidate any
+00030c10: 2070 7265 7669 6f75 736c 7920 6361 6368   previously cach
+00030c20: 6564 2064 6174 610a 2020 2020 2020 2020  ed data.        
+00030c30: 6e61 6d65 203d 2073 656c 662e 5f68 3178  name = self._h1x
+00030c40: 5f67 7773 735f 6361 6368 655f 6e61 6d65  _gwss_cache_name
+00030c50: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+00030c60: 203d 2064 6963 7428 0a20 2020 2020 2020   = dict(.       
+00030c70: 2020 2020 2063 6f6e 7469 673d 636f 6e74       contig=cont
+00030c80: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+00030c90: 616e 616c 7973 6973 3d73 656c 662e 5f70  analysis=self._p
+00030ca0: 7265 705f 7068 6173 696e 675f 616e 616c  rep_phasing_anal
+00030cb0: 7973 6973 5f70 6172 616d 2861 6e61 6c79  ysis_param(analy
+00030cc0: 7369 733d 616e 616c 7973 6973 292c 0a20  sis=analysis),. 
+00030cd0: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+00030ce0: 775f 7369 7a65 3d77 696e 646f 775f 7369  w_size=window_si
+00030cf0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+00030d00: 2320 4e2e 422e 2c20 646f 206e 6f74 2062  # N.B., do not b
+00030d10: 6520 7465 6d70 7465 6420 746f 2063 6f6e  e tempted to con
+00030d20: 7665 7274 2074 6865 7365 2073 616d 706c  vert these sampl
+00030d30: 6520 7175 6572 6965 7320 696e 746f 2069  e queries into i
+00030d40: 6e74 6567 6572 0a20 2020 2020 2020 2020  nteger.         
+00030d50: 2020 2023 2069 6e64 6963 6573 2075 7369     # indices usi
+00030d60: 6e67 205f 7072 6570 5f73 616d 706c 655f  ng _prep_sample_
+00030d70: 7365 6c65 6374 696f 6e5f 7061 7261 6d73  selection_params
+00030d80: 2c20 6265 6361 7573 6520 7468 6520 696e  , because the in
+00030d90: 6469 6365 730a 2020 2020 2020 2020 2020  dices.          
+00030da0: 2020 2320 6172 6520 6469 6666 6572 656e    # are differen
+00030db0: 7420 696e 2074 6865 2068 6170 6c6f 7479  t in the haploty
+00030dc0: 7065 2064 6174 612e 0a20 2020 2020 2020  pe data..       
+00030dd0: 2020 2020 2063 6f68 6f72 7431 5f71 7565       cohort1_que
+00030de0: 7279 3d63 6f68 6f72 7431 5f71 7565 7279  ry=cohort1_query
+00030df0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00030e00: 686f 7274 325f 7175 6572 793d 636f 686f  hort2_query=coho
+00030e10: 7274 325f 7175 6572 792c 0a20 2020 2020  rt2_query,.     
+00030e20: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+00030e30: 7473 3d73 656c 662e 5f70 7265 705f 7361  ts=self._prep_sa
+00030e40: 6d70 6c65 5f73 6574 735f 7061 7261 6d28  mple_sets_param(
+00030e50: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
+00030e60: 6c65 5f73 6574 7329 2c0a 2020 2020 2020  le_sets),.      
+00030e70: 2020 2020 2020 636f 686f 7274 5f73 697a        cohort_siz
+00030e80: 653d 636f 686f 7274 5f73 697a 652c 0a20  e=cohort_size,. 
+00030e90: 2020 2020 2020 2020 2020 206d 696e 5f63             min_c
+00030ea0: 6f68 6f72 745f 7369 7a65 3d6d 696e 5f63  ohort_size=min_c
+00030eb0: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
+00030ec0: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
+00030ed0: 7274 5f73 697a 653d 6d61 785f 636f 686f  rt_size=max_coho
+00030ee0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
+00030ef0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+00030f00: 3d72 616e 646f 6d5f 7365 6564 2c0a 2020  =random_seed,.  
+00030f10: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00030f20: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00030f30: 2020 7265 7375 6c74 7320 3d20 7365 6c66    results = self
+00030f40: 2e72 6573 756c 7473 5f63 6163 6865 5f67  .results_cache_g
+00030f50: 6574 286e 616d 653d 6e61 6d65 2c20 7061  et(name=name, pa
+00030f60: 7261 6d73 3d70 6172 616d 7329 0a0a 2020  rams=params)..  
+00030f70: 2020 2020 2020 6578 6365 7074 2043 6163        except Cac
+00030f80: 6865 4d69 7373 3a0a 2020 2020 2020 2020  heMiss:.        
+00030f90: 2020 2020 7265 7375 6c74 7320 3d20 7365      results = se
+00030fa0: 6c66 2e5f 6831 785f 6777 7373 282a 2a70  lf._h1x_gwss(**p
+00030fb0: 6172 616d 7329 0a20 2020 2020 2020 2020  arams).         
+00030fc0: 2020 2073 656c 662e 7265 7375 6c74 735f     self.results_
+00030fd0: 6361 6368 655f 7365 7428 6e61 6d65 3d6e  cache_set(name=n
+00030fe0: 616d 652c 2070 6172 616d 733d 7061 7261  ame, params=para
+00030ff0: 6d73 2c20 7265 7375 6c74 733d 7265 7375  ms, results=resu
+00031000: 6c74 7329 0a0a 2020 2020 2020 2020 7820  lts)..        x 
+00031010: 3d20 7265 7375 6c74 735b 2278 225d 0a20  = results["x"]. 
+00031020: 2020 2020 2020 2068 3178 203d 2072 6573         h1x = res
+00031030: 756c 7473 5b22 6831 7822 5d0a 0a20 2020  ults["h1x"]..   
+00031040: 2020 2020 2072 6574 7572 6e20 782c 2068       return x, h
+00031050: 3178 0a0a 2020 2020 6465 6620 5f68 3178  1x..    def _h1x
+00031060: 5f67 7773 7328 0a20 2020 2020 2020 2073  _gwss(.        s
+00031070: 656c 662c 0a20 2020 2020 2020 2063 6f6e  elf,.        con
+00031080: 7469 672c 0a20 2020 2020 2020 2061 6e61  tig,.        ana
+00031090: 6c79 7369 732c 0a20 2020 2020 2020 2077  lysis,.        w
+000310a0: 696e 646f 775f 7369 7a65 2c0a 2020 2020  indow_size,.    
+000310b0: 2020 2020 7361 6d70 6c65 5f73 6574 732c      sample_sets,
+000310c0: 0a20 2020 2020 2020 2063 6f68 6f72 7431  .        cohort1
+000310d0: 5f71 7565 7279 2c0a 2020 2020 2020 2020  _query,.        
+000310e0: 636f 686f 7274 325f 7175 6572 792c 0a20  cohort2_query,. 
+000310f0: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
+00031100: 7a65 2c0a 2020 2020 2020 2020 6d69 6e5f  ze,.        min_
+00031110: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00031120: 2020 2020 206d 6178 5f63 6f68 6f72 745f       max_cohort_
+00031130: 7369 7a65 2c0a 2020 2020 2020 2020 7261  size,.        ra
+00031140: 6e64 6f6d 5f73 6565 642c 0a20 2020 2029  ndom_seed,.    )
+00031150: 3a0a 2020 2020 2020 2020 2320 6163 6365  :.        # acce
+00031160: 7373 2068 6170 6c6f 7479 7065 2064 6174  ss haplotype dat
+00031170: 6173 6574 7320 666f 7220 6561 6368 2063  asets for each c
+00031180: 6f68 6f72 740a 2020 2020 2020 2020 6473  ohort.        ds
+00031190: 3120 3d20 7365 6c66 2e68 6170 6c6f 7479  1 = self.haploty
+000311a0: 7065 7328 0a20 2020 2020 2020 2020 2020  pes(.           
+000311b0: 2072 6567 696f 6e3d 636f 6e74 6967 2c0a   region=contig,.
+000311c0: 2020 2020 2020 2020 2020 2020 616e 616c              anal
+000311d0: 7973 6973 3d61 6e61 6c79 7369 732c 0a20  ysis=analysis,. 
+000311e0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+000311f0: 655f 7175 6572 793d 636f 686f 7274 315f  e_query=cohort1_
+00031200: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
+00031210: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
+00031220: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
+00031230: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
+00031240: 697a 653d 636f 686f 7274 5f73 697a 652c  ize=cohort_size,
+00031250: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00031260: 5f63 6f68 6f72 745f 7369 7a65 3d6d 696e  _cohort_size=min
+00031270: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
+00031280: 2020 2020 2020 2020 2020 6d61 785f 636f            max_co
+00031290: 686f 7274 5f73 697a 653d 6d61 785f 636f  hort_size=max_co
+000312a0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+000312b0: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
+000312c0: 6564 3d72 616e 646f 6d5f 7365 6564 2c0a  ed=random_seed,.
+000312d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000312e0: 2020 6473 3220 3d20 7365 6c66 2e68 6170    ds2 = self.hap
+000312f0: 6c6f 7479 7065 7328 0a20 2020 2020 2020  lotypes(.       
+00031300: 2020 2020 2072 6567 696f 6e3d 636f 6e74       region=cont
+00031310: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+00031320: 616e 616c 7973 6973 3d61 6e61 6c79 7369  analysis=analysi
+00031330: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
+00031340: 616d 706c 655f 7175 6572 793d 636f 686f  ample_query=coho
+00031350: 7274 325f 7175 6572 792c 0a20 2020 2020  rt2_query,.     
+00031360: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+00031370: 7473 3d73 616d 706c 655f 7365 7473 2c0a  ts=sample_sets,.
+00031380: 2020 2020 2020 2020 2020 2020 636f 686f              coho
+00031390: 7274 5f73 697a 653d 636f 686f 7274 5f73  rt_size=cohort_s
+000313a0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+000313b0: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+000313c0: 3d6d 696e 5f63 6f68 6f72 745f 7369 7a65  =min_cohort_size
+000313d0: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+000313e0: 785f 636f 686f 7274 5f73 697a 653d 6d61  x_cohort_size=ma
+000313f0: 785f 636f 686f 7274 5f73 697a 652c 0a20  x_cohort_size,. 
+00031400: 2020 2020 2020 2020 2020 2072 616e 646f             rando
+00031410: 6d5f 7365 6564 3d72 616e 646f 6d5f 7365  m_seed=random_se
+00031420: 6564 2c0a 2020 2020 2020 2020 290a 0a20  ed,.        ).. 
+00031430: 2020 2020 2020 2023 206c 6f61 6420 6461         # load da
+00031440: 7461 2069 6e74 6f20 6d65 6d6f 7279 0a20  ta into memory. 
+00031450: 2020 2020 2020 2067 7431 203d 2061 6c6c         gt1 = all
+00031460: 656c 2e47 656e 6f74 7970 6544 6173 6b41  el.GenotypeDaskA
+00031470: 7272 6179 2864 7331 5b22 6361 6c6c 5f67  rray(ds1["call_g
+00031480: 656e 6f74 7970 6522 5d2e 6461 7461 290a  enotype"].data).
+00031490: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+000314a0: 662e 5f64 6173 6b5f 7072 6f67 7265 7373  f._dask_progress
+000314b0: 2864 6573 633d 224c 6f61 6420 6861 706c  (desc="Load hapl
+000314c0: 6f74 7970 6573 2066 6f72 2063 6f68 6f72  otypes for cohor
+000314d0: 7420 3122 293a 0a20 2020 2020 2020 2020  t 1"):.         
+000314e0: 2020 2068 7431 203d 2067 7431 2e74 6f5f     ht1 = gt1.to_
+000314f0: 6861 706c 6f74 7970 6573 2829 2e63 6f6d  haplotypes().com
+00031500: 7075 7465 2829 0a20 2020 2020 2020 2067  pute().        g
+00031510: 7432 203d 2061 6c6c 656c 2e47 656e 6f74  t2 = allel.Genot
+00031520: 7970 6544 6173 6b41 7272 6179 2864 7332  ypeDaskArray(ds2
+00031530: 5b22 6361 6c6c 5f67 656e 6f74 7970 6522  ["call_genotype"
+00031540: 5d2e 6461 7461 290a 2020 2020 2020 2020  ].data).        
+00031550: 7769 7468 2073 656c 662e 5f64 6173 6b5f  with self._dask_
+00031560: 7072 6f67 7265 7373 2864 6573 633d 224c  progress(desc="L
+00031570: 6f61 6420 6861 706c 6f74 7970 6573 2066  oad haplotypes f
+00031580: 6f72 2063 6f68 6f72 7420 3222 293a 0a20  or cohort 2"):. 
+00031590: 2020 2020 2020 2020 2020 2068 7432 203d             ht2 =
+000315a0: 2067 7432 2e74 6f5f 6861 706c 6f74 7970   gt2.to_haplotyp
+000315b0: 6573 2829 2e63 6f6d 7075 7465 2829 0a20  es().compute(). 
+000315c0: 2020 2020 2020 2070 6f73 203d 2064 7331         pos = ds1
+000315d0: 5b22 7661 7269 616e 745f 706f 7369 7469  ["variant_positi
+000315e0: 6f6e 225d 2e76 616c 7565 730a 0a20 2020  on"].values..   
+000315f0: 2020 2020 2023 2072 756e 2048 3158 2073       # run H1X s
+00031600: 6361 6e0a 2020 2020 2020 2020 6831 7820  can.        h1x 
+00031610: 3d20 5f6d 6f76 696e 675f 6831 7828 6874  = _moving_h1x(ht
+00031620: 312c 2068 7432 2c20 7369 7a65 3d77 696e  1, ht2, size=win
+00031630: 646f 775f 7369 7a65 290a 0a20 2020 2020  dow_size)..     
+00031640: 2020 2023 2063 6f6d 7075 7465 2077 696e     # compute win
+00031650: 646f 7720 6d69 6470 6f69 6e74 730a 2020  dow midpoints.  
+00031660: 2020 2020 2020 7820 3d20 616c 6c65 6c2e        x = allel.
+00031670: 6d6f 7669 6e67 5f73 7461 7469 7374 6963  moving_statistic
+00031680: 2870 6f73 2c20 7374 6174 6973 7469 633d  (pos, statistic=
+00031690: 6e70 2e6d 6561 6e2c 2073 697a 653d 7769  np.mean, size=wi
+000316a0: 6e64 6f77 5f73 697a 6529 0a0a 2020 2020  ndow_size)..    
+000316b0: 2020 2020 7265 7375 6c74 7320 3d20 6469      results = di
+000316c0: 6374 2878 3d78 2c20 6831 783d 6831 7829  ct(x=x, h1x=h1x)
+000316d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000316e0: 2072 6573 756c 7473 0a0a 2020 2020 4064   results..    @d
+000316f0: 6f63 280a 2020 2020 2020 2020 7375 6d6d  oc(.        summ
+00031700: 6172 793d 2222 220a 2020 2020 2020 2020  ary=""".        
+00031710: 2020 2020 5275 6e20 616e 6420 706c 6f74      Run and plot
+00031720: 2061 2048 3158 2067 656e 6f6d 652d 7769   a H1X genome-wi
+00031730: 6465 2073 6361 6e20 746f 2064 6574 6563  de scan to detec
+00031740: 7420 6765 6e6f 6d65 2072 6567 696f 6e73  t genome regions
+00031750: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00031760: 6820 7368 6172 6564 2073 656c 6563 7469  h shared selecti
+00031770: 7665 2073 7765 6570 7320 6265 7477 6565  ve sweeps betwee
+00031780: 6e20 7477 6f20 636f 686f 7274 732e 0a20  n two cohorts.. 
+00031790: 2020 2020 2020 2022 2222 0a20 2020 2029         """.    )
+000317a0: 0a20 2020 2064 6566 2070 6c6f 745f 6831  .    def plot_h1
+000317b0: 785f 6777 7373 5f74 7261 636b 280a 2020  x_gwss_track(.  
+000317c0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000317d0: 2020 2020 636f 6e74 6967 3a20 6261 7365      contig: base
+000317e0: 5f70 6172 616d 732e 636f 6e74 6967 2c0a  _params.contig,.
+000317f0: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
+00031800: 697a 653a 2068 3132 5f70 6172 616d 732e  ize: h12_params.
+00031810: 7769 6e64 6f77 5f73 697a 652c 0a20 2020  window_size,.   
+00031820: 2020 2020 2063 6f68 6f72 7431 5f71 7565       cohort1_que
+00031830: 7279 3a20 6261 7365 5f70 6172 616d 732e  ry: base_params.
+00031840: 636f 686f 7274 315f 7175 6572 792c 0a20  cohort1_query,. 
+00031850: 2020 2020 2020 2063 6f68 6f72 7432 5f71         cohort2_q
+00031860: 7565 7279 3a20 6261 7365 5f70 6172 616d  uery: base_param
+00031870: 732e 636f 686f 7274 325f 7175 6572 792c  s.cohort2_query,
+00031880: 0a20 2020 2020 2020 2061 6e61 6c79 7369  .        analysi
+00031890: 733a 2068 6170 5f70 6172 616d 732e 616e  s: hap_params.an
+000318a0: 616c 7973 6973 203d 2044 4546 4155 4c54  alysis = DEFAULT
+000318b0: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
+000318c0: 5f73 6574 733a 204f 7074 696f 6e61 6c5b  _sets: Optional[
+000318d0: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
+000318e0: 6c65 5f73 6574 735d 203d 204e 6f6e 652c  le_sets] = None,
+000318f0: 0a20 2020 2020 2020 2063 6f68 6f72 745f  .        cohort_
+00031900: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b62  size: Optional[b
+00031910: 6173 655f 7061 7261 6d73 2e63 6f68 6f72  ase_params.cohor
+00031920: 745f 7369 7a65 5d20 3d20 6831 325f 7061  t_size] = h12_pa
+00031930: 7261 6d73 2e63 6f68 6f72 745f 7369 7a65  rams.cohort_size
+00031940: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00031950: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
+00031960: 653a 204f 7074 696f 6e61 6c5b 0a20 2020  e: Optional[.   
+00031970: 2020 2020 2020 2020 2062 6173 655f 7061           base_pa
+00031980: 7261 6d73 2e6d 696e 5f63 6f68 6f72 745f  rams.min_cohort_
+00031990: 7369 7a65 0a20 2020 2020 2020 205d 203d  size.        ] =
+000319a0: 2068 3132 5f70 6172 616d 732e 6d69 6e5f   h12_params.min_
+000319b0: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
+000319c0: 756c 742c 0a20 2020 2020 2020 206d 6178  ult,.        max
+000319d0: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
+000319e0: 7469 6f6e 616c 5b0a 2020 2020 2020 2020  tional[.        
+000319f0: 2020 2020 6261 7365 5f70 6172 616d 732e      base_params.
+00031a00: 6d61 785f 636f 686f 7274 5f73 697a 650a  max_cohort_size.
+00031a10: 2020 2020 2020 2020 5d20 3d20 6831 325f          ] = h12_
+00031a20: 7061 7261 6d73 2e6d 6178 5f63 6f68 6f72  params.max_cohor
+00031a30: 745f 7369 7a65 5f64 6566 6175 6c74 2c0a  t_size_default,.
+00031a40: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
+00031a50: 6565 643a 2062 6173 655f 7061 7261 6d73  eed: base_params
+00031a60: 2e72 616e 646f 6d5f 7365 6564 203d 2034  .random_seed = 4
+00031a70: 322c 0a20 2020 2020 2020 2074 6974 6c65  2,.        title
+00031a80: 3a20 4f70 7469 6f6e 616c 5b67 706c 745f  : Optional[gplt_
+00031a90: 7061 7261 6d73 2e74 6974 6c65 5d20 3d20  params.title] = 
+00031aa0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7369  None,.        si
+00031ab0: 7a69 6e67 5f6d 6f64 653a 2067 706c 745f  zing_mode: gplt_
+00031ac0: 7061 7261 6d73 2e73 697a 696e 675f 6d6f  params.sizing_mo
+00031ad0: 6465 203d 2067 706c 745f 7061 7261 6d73  de = gplt_params
+00031ae0: 2e73 697a 696e 675f 6d6f 6465 5f64 6566  .sizing_mode_def
+00031af0: 6175 6c74 2c0a 2020 2020 2020 2020 7769  ault,.        wi
+00031b00: 6474 683a 2067 706c 745f 7061 7261 6d73  dth: gplt_params
+00031b10: 2e77 6964 7468 203d 2067 706c 745f 7061  .width = gplt_pa
+00031b20: 7261 6d73 2e77 6964 7468 5f64 6566 6175  rams.width_defau
+00031b30: 6c74 2c0a 2020 2020 2020 2020 6865 6967  lt,.        heig
+00031b40: 6874 3a20 6770 6c74 5f70 6172 616d 732e  ht: gplt_params.
+00031b50: 6865 6967 6874 203d 2032 3030 2c0a 2020  height = 200,.  
+00031b60: 2020 2020 2020 7368 6f77 3a20 6770 6c74        show: gplt
+00031b70: 5f70 6172 616d 732e 7368 6f77 203d 2054  _params.show = T
+00031b80: 7275 652c 0a20 2020 2020 2020 2078 5f72  rue,.        x_r
+00031b90: 616e 6765 3a20 4f70 7469 6f6e 616c 5b67  ange: Optional[g
+00031ba0: 706c 745f 7061 7261 6d73 2e78 5f72 616e  plt_params.x_ran
+00031bb0: 6765 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ge] = None,.    
+00031bc0: 2920 2d3e 2067 706c 745f 7061 7261 6d73  ) -> gplt_params
+00031bd0: 2e66 6967 7572 653a 0a20 2020 2020 2020  .figure:.       
+00031be0: 2023 2063 6f6d 7075 7465 2048 3158 0a20   # compute H1X. 
+00031bf0: 2020 2020 2020 2078 2c20 6831 7820 3d20         x, h1x = 
+00031c00: 7365 6c66 2e68 3178 5f67 7773 7328 0a20  self.h1x_gwss(. 
+00031c10: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00031c20: 673d 636f 6e74 6967 2c0a 2020 2020 2020  g=contig,.      
+00031c30: 2020 2020 2020 616e 616c 7973 6973 3d61        analysis=a
+00031c40: 6e61 6c79 7369 732c 0a20 2020 2020 2020  nalysis,.       
+00031c50: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
+00031c60: 3d77 696e 646f 775f 7369 7a65 2c0a 2020  =window_size,.  
+00031c70: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
+00031c80: 5f73 697a 653d 636f 686f 7274 5f73 697a  _size=cohort_siz
+00031c90: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00031ca0: 696e 5f63 6f68 6f72 745f 7369 7a65 3d6d  in_cohort_size=m
+00031cb0: 696e 5f63 6f68 6f72 745f 7369 7a65 2c0a  in_cohort_size,.
+00031cc0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00031cd0: 636f 686f 7274 5f73 697a 653d 6d61 785f  cohort_size=max_
+00031ce0: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00031cf0: 2020 2020 2020 2020 2063 6f68 6f72 7431           cohort1
+00031d00: 5f71 7565 7279 3d63 6f68 6f72 7431 5f71  _query=cohort1_q
+00031d10: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
+00031d20: 2020 636f 686f 7274 325f 7175 6572 793d    cohort2_query=
+00031d30: 636f 686f 7274 325f 7175 6572 792c 0a20  cohort2_query,. 
+00031d40: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00031d50: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
+00031d60: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00031d70: 7261 6e64 6f6d 5f73 6565 643d 7261 6e64  random_seed=rand
+00031d80: 6f6d 5f73 6565 642c 0a20 2020 2020 2020  om_seed,.       
+00031d90: 2029 0a0a 2020 2020 2020 2020 2320 6465   )..        # de
+00031da0: 7465 726d 696e 6520 5820 6178 6973 2072  termine X axis r
+00031db0: 616e 6765 0a20 2020 2020 2020 2078 5f6d  ange.        x_m
+00031dc0: 696e 203d 2078 5b30 5d0a 2020 2020 2020  in = x[0].      
+00031dd0: 2020 785f 6d61 7820 3d20 785b 2d31 5d0a    x_max = x[-1].
+00031de0: 2020 2020 2020 2020 6966 2078 5f72 616e          if x_ran
+00031df0: 6765 2069 7320 4e6f 6e65 3a0a 2020 2020  ge is None:.    
+00031e00: 2020 2020 2020 2020 785f 7261 6e67 6520          x_range 
+00031e10: 3d20 626f 6b65 682e 6d6f 6465 6c73 2e52  = bokeh.models.R
+00031e20: 616e 6765 3164 2878 5f6d 696e 2c20 785f  ange1d(x_min, x_
+00031e30: 6d61 782c 2062 6f75 6e64 733d 2261 7574  max, bounds="aut
+00031e40: 6f22 290a 0a20 2020 2020 2020 2023 2063  o")..        # c
+00031e50: 7265 6174 6520 6120 6669 6775 7265 0a20  reate a figure. 
+00031e60: 2020 2020 2020 2078 7768 6565 6c5f 7a6f         xwheel_zo
+00031e70: 6f6d 203d 2062 6f6b 6568 2e6d 6f64 656c  om = bokeh.model
+00031e80: 732e 5768 6565 6c5a 6f6f 6d54 6f6f 6c28  s.WheelZoomTool(
+00031e90: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00031ea0: 656e 7369 6f6e 733d 2277 6964 7468 222c  ensions="width",
+00031eb0: 206d 6169 6e74 6169 6e5f 666f 6375 733d   maintain_focus=
+00031ec0: 4661 6c73 650a 2020 2020 2020 2020 290a  False.        ).
+00031ed0: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
+00031ee0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00031ef0: 2020 2020 2020 7469 746c 6520 3d20 6622        title = f"
+00031f00: 436f 686f 7274 2031 3a20 7b63 6f68 6f72  Cohort 1: {cohor
+00031f10: 7431 5f71 7565 7279 7d5c 6e43 6f68 6f72  t1_query}\nCohor
+00031f20: 7420 323a 207b 636f 686f 7274 325f 7175  t 2: {cohort2_qu
+00031f30: 6572 797d 220a 2020 2020 2020 2020 6669  ery}".        fi
+00031f40: 6720 3d20 626f 6b65 682e 706c 6f74 7469  g = bokeh.plotti
+00031f50: 6e67 2e66 6967 7572 6528 0a20 2020 2020  ng.figure(.     
+00031f60: 2020 2020 2020 2074 6974 6c65 3d74 6974         title=tit
+00031f70: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00031f80: 746f 6f6c 733d 5b22 7870 616e 222c 2022  tools=["xpan", "
+00031f90: 787a 6f6f 6d5f 696e 222c 2022 787a 6f6f  xzoom_in", "xzoo
+00031fa0: 6d5f 6f75 7422 2c20 7877 6865 656c 5f7a  m_out", xwheel_z
+00031fb0: 6f6f 6d2c 2022 7265 7365 7422 5d2c 0a20  oom, "reset"],. 
+00031fc0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+00031fd0: 655f 7363 726f 6c6c 3d78 7768 6565 6c5f  e_scroll=xwheel_
+00031fe0: 7a6f 6f6d 2c0a 2020 2020 2020 2020 2020  zoom,.          
+00031ff0: 2020 6163 7469 7665 5f64 7261 673d 2278    active_drag="x
+00032000: 7061 6e22 2c0a 2020 2020 2020 2020 2020  pan",.          
+00032010: 2020 7369 7a69 6e67 5f6d 6f64 653d 7369    sizing_mode=si
+00032020: 7a69 6e67 5f6d 6f64 652c 0a20 2020 2020  zing_mode,.     
+00032030: 2020 2020 2020 2077 6964 7468 3d77 6964         width=wid
+00032040: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00032050: 6865 6967 6874 3d68 6569 6768 742c 0a20  height=height,. 
+00032060: 2020 2020 2020 2020 2020 2074 6f6f 6c62             toolb
+00032070: 6172 5f6c 6f63 6174 696f 6e3d 2261 626f  ar_location="abo
+00032080: 7665 222c 0a20 2020 2020 2020 2020 2020  ve",.           
+00032090: 2078 5f72 616e 6765 3d78 5f72 616e 6765   x_range=x_range
+000320a0: 2c0a 2020 2020 2020 2020 2020 2020 795f  ,.            y_
+000320b0: 7261 6e67 653d 2830 2c20 3129 2c0a 2020  range=(0, 1),.  
+000320c0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000320d0: 2023 2070 6c6f 7420 4831 580a 2020 2020   # plot H1X.    
+000320e0: 2020 2020 6669 672e 6369 7263 6c65 280a      fig.circle(.
+000320f0: 2020 2020 2020 2020 2020 2020 783d 782c              x=x,
+00032100: 0a20 2020 2020 2020 2020 2020 2079 3d68  .            y=h
+00032110: 3178 2c0a 2020 2020 2020 2020 2020 2020  1x,.            
+00032120: 7369 7a65 3d33 2c0a 2020 2020 2020 2020  size=3,.        
+00032130: 2020 2020 6c69 6e65 5f77 6964 7468 3d30      line_width=0
+00032140: 2e35 2c0a 2020 2020 2020 2020 2020 2020  .5,.            
+00032150: 6c69 6e65 5f63 6f6c 6f72 3d22 626c 6163  line_color="blac
+00032160: 6b22 2c0a 2020 2020 2020 2020 2020 2020  k",.            
+00032170: 6669 6c6c 5f63 6f6c 6f72 3d4e 6f6e 652c  fill_color=None,
+00032180: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00032190: 2020 2020 2320 7469 6479 2075 7020 7468      # tidy up th
+000321a0: 6520 706c 6f74 0a20 2020 2020 2020 2066  e plot.        f
+000321b0: 6967 2e79 6178 6973 2e61 7869 735f 6c61  ig.yaxis.axis_la
+000321c0: 6265 6c20 3d20 2248 3158 220a 2020 2020  bel = "H1X".    
+000321d0: 2020 2020 6669 672e 7961 7869 732e 7469      fig.yaxis.ti
+000321e0: 636b 6572 203d 205b 302c 2031 5d0a 2020  cker = [0, 1].  
+000321f0: 2020 2020 2020 7365 6c66 2e5f 626f 6b65        self._boke
+00032200: 685f 7374 796c 655f 6765 6e6f 6d65 5f78  h_style_genome_x
+00032210: 6178 6973 2866 6967 2c20 636f 6e74 6967  axis(fig, contig
+00032220: 290a 0a20 2020 2020 2020 2069 6620 7368  )..        if sh
+00032230: 6f77 3a0a 2020 2020 2020 2020 2020 2020  ow:.            
+00032240: 626f 6b65 682e 706c 6f74 7469 6e67 2e73  bokeh.plotting.s
+00032250: 686f 7728 6669 6729 0a0a 2020 2020 2020  how(fig)..      
+00032260: 2020 7265 7475 726e 2066 6967 0a0a 2020    return fig..  
+00032270: 2020 4064 6f63 280a 2020 2020 2020 2020    @doc(.        
+00032280: 7375 6d6d 6172 793d 2222 220a 2020 2020  summary=""".    
+00032290: 2020 2020 2020 2020 5275 6e20 616e 6420          Run and 
+000322a0: 706c 6f74 2061 2048 3158 2067 656e 6f6d  plot a H1X genom
+000322b0: 652d 7769 6465 2073 6361 6e20 746f 2064  e-wide scan to d
+000322c0: 6574 6563 7420 6765 6e6f 6d65 2072 6567  etect genome reg
+000322d0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+000322e0: 2077 6974 6820 7368 6172 6564 2073 656c   with shared sel
+000322f0: 6563 7469 7665 2073 7765 6570 7320 6265  ective sweeps be
+00032300: 7477 6565 6e20 7477 6f20 636f 686f 7274  tween two cohort
+00032310: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00032320: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
+00032330: 745f 6831 785f 6777 7373 280a 2020 2020  t_h1x_gwss(.    
+00032340: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00032350: 2020 636f 6e74 6967 3a20 6261 7365 5f70    contig: base_p
+00032360: 6172 616d 732e 636f 6e74 6967 2c0a 2020  arams.contig,.  
+00032370: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
+00032380: 653a 2068 3132 5f70 6172 616d 732e 7769  e: h12_params.wi
+00032390: 6e64 6f77 5f73 697a 652c 0a20 2020 2020  ndow_size,.     
+000323a0: 2020 2063 6f68 6f72 7431 5f71 7565 7279     cohort1_query
+000323b0: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
+000323c0: 686f 7274 315f 7175 6572 792c 0a20 2020  hort1_query,.   
+000323d0: 2020 2020 2063 6f68 6f72 7432 5f71 7565       cohort2_que
+000323e0: 7279 3a20 6261 7365 5f70 6172 616d 732e  ry: base_params.
+000323f0: 636f 686f 7274 325f 7175 6572 792c 0a20  cohort2_query,. 
+00032400: 2020 2020 2020 2061 6e61 6c79 7369 733a         analysis:
+00032410: 2068 6170 5f70 6172 616d 732e 616e 616c   hap_params.anal
+00032420: 7973 6973 203d 2044 4546 4155 4c54 2c0a  ysis = DEFAULT,.
+00032430: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+00032440: 6574 733a 204f 7074 696f 6e61 6c5b 6261  ets: Optional[ba
+00032450: 7365 5f70 6172 616d 732e 7361 6d70 6c65  se_params.sample
+00032460: 5f73 6574 735d 203d 204e 6f6e 652c 0a20  _sets] = None,. 
+00032470: 2020 2020 2020 2063 6f68 6f72 745f 7369         cohort_si
+00032480: 7a65 3a20 4f70 7469 6f6e 616c 5b62 6173  ze: Optional[bas
+00032490: 655f 7061 7261 6d73 2e63 6f68 6f72 745f  e_params.cohort_
+000324a0: 7369 7a65 5d20 3d20 6831 325f 7061 7261  size] = h12_para
+000324b0: 6d73 2e63 6f68 6f72 745f 7369 7a65 5f64  ms.cohort_size_d
+000324c0: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+000324d0: 6d69 6e5f 636f 686f 7274 5f73 697a 653a  min_cohort_size:
+000324e0: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
+000324f0: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
+00032500: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
+00032510: 7a65 0a20 2020 2020 2020 205d 203d 2068  ze.        ] = h
+00032520: 3132 5f70 6172 616d 732e 6d69 6e5f 636f  12_params.min_co
+00032530: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
+00032540: 742c 0a20 2020 2020 2020 206d 6178 5f63  t,.        max_c
+00032550: 6f68 6f72 745f 7369 7a65 3a20 4f70 7469  ohort_size: Opti
+00032560: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
+00032570: 2020 6261 7365 5f70 6172 616d 732e 6d61    base_params.ma
+00032580: 785f 636f 686f 7274 5f73 697a 650a 2020  x_cohort_size.  
+00032590: 2020 2020 2020 5d20 3d20 6831 325f 7061        ] = h12_pa
+000325a0: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
+000325b0: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
+000325c0: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+000325d0: 643a 2062 6173 655f 7061 7261 6d73 2e72  d: base_params.r
+000325e0: 616e 646f 6d5f 7365 6564 203d 2034 322c  andom_seed = 42,
+000325f0: 0a20 2020 2020 2020 2074 6974 6c65 3a20  .        title: 
+00032600: 4f70 7469 6f6e 616c 5b67 706c 745f 7061  Optional[gplt_pa
+00032610: 7261 6d73 2e74 6974 6c65 5d20 3d20 4e6f  rams.title] = No
+00032620: 6e65 2c0a 2020 2020 2020 2020 7369 7a69  ne,.        sizi
+00032630: 6e67 5f6d 6f64 653a 2067 706c 745f 7061  ng_mode: gplt_pa
+00032640: 7261 6d73 2e73 697a 696e 675f 6d6f 6465  rams.sizing_mode
+00032650: 203d 2067 706c 745f 7061 7261 6d73 2e73   = gplt_params.s
+00032660: 697a 696e 675f 6d6f 6465 5f64 6566 6175  izing_mode_defau
+00032670: 6c74 2c0a 2020 2020 2020 2020 7769 6474  lt,.        widt
+00032680: 683a 2067 706c 745f 7061 7261 6d73 2e77  h: gplt_params.w
+00032690: 6964 7468 203d 2067 706c 745f 7061 7261  idth = gplt_para
+000326a0: 6d73 2e77 6964 7468 5f64 6566 6175 6c74  ms.width_default
+000326b0: 2c0a 2020 2020 2020 2020 7472 6163 6b5f  ,.        track_
+000326c0: 6865 6967 6874 3a20 6770 6c74 5f70 6172  height: gplt_par
+000326d0: 616d 732e 7472 6163 6b5f 6865 6967 6874  ams.track_height
+000326e0: 203d 2031 3930 2c0a 2020 2020 2020 2020   = 190,.        
+000326f0: 6765 6e65 735f 6865 6967 6874 3a20 6770  genes_height: gp
+00032700: 6c74 5f70 6172 616d 732e 6765 6e65 735f  lt_params.genes_
+00032710: 6865 6967 6874 203d 2067 706c 745f 7061  height = gplt_pa
+00032720: 7261 6d73 2e67 656e 6573 5f68 6569 6768  rams.genes_heigh
+00032730: 745f 6465 6661 756c 742c 0a20 2020 2029  t_default,.    )
+00032740: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00032750: 2020 2320 6777 7373 2074 7261 636b 0a20    # gwss track. 
+00032760: 2020 2020 2020 2066 6967 3120 3d20 7365         fig1 = se
+00032770: 6c66 2e70 6c6f 745f 6831 785f 6777 7373  lf.plot_h1x_gwss
+00032780: 5f74 7261 636b 280a 2020 2020 2020 2020  _track(.        
+00032790: 2020 2020 636f 6e74 6967 3d63 6f6e 7469      contig=conti
+000327a0: 672c 0a20 2020 2020 2020 2020 2020 2061  g,.            a
+000327b0: 6e61 6c79 7369 733d 616e 616c 7973 6973  nalysis=analysis
+000327c0: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+000327d0: 6e64 6f77 5f73 697a 653d 7769 6e64 6f77  ndow_size=window
+000327e0: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+000327f0: 2020 2063 6f68 6f72 7431 5f71 7565 7279     cohort1_query
+00032800: 3d63 6f68 6f72 7431 5f71 7565 7279 2c0a  =cohort1_query,.
+00032810: 2020 2020 2020 2020 2020 2020 636f 686f              coho
+00032820: 7274 325f 7175 6572 793d 636f 686f 7274  rt2_query=cohort
+00032830: 325f 7175 6572 792c 0a20 2020 2020 2020  2_query,.       
+00032840: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
+00032850: 3d73 616d 706c 655f 7365 7473 2c0a 2020  =sample_sets,.  
+00032860: 2020 2020 2020 2020 2020 636f 686f 7274            cohort
+00032870: 5f73 697a 653d 636f 686f 7274 5f73 697a  _size=cohort_siz
+00032880: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00032890: 696e 5f63 6f68 6f72 745f 7369 7a65 3d6d  in_cohort_size=m
+000328a0: 696e 5f63 6f68 6f72 745f 7369 7a65 2c0a  in_cohort_size,.
+000328b0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+000328c0: 636f 686f 7274 5f73 697a 653d 6d61 785f  cohort_size=max_
+000328d0: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+000328e0: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
+000328f0: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
+00032900: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
+00032910: 746c 653d 7469 746c 652c 0a20 2020 2020  tle=title,.     
+00032920: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+00032930: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
+00032940: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+00032950: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
+00032960: 2020 2020 2068 6569 6768 743d 7472 6163       height=trac
+00032970: 6b5f 6865 6967 6874 2c0a 2020 2020 2020  k_height,.      
+00032980: 2020 2020 2020 7368 6f77 3d46 616c 7365        show=False
+00032990: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000329a0: 2020 2020 2066 6967 312e 7861 7869 732e       fig1.xaxis.
+000329b0: 7669 7369 626c 6520 3d20 4661 6c73 650a  visible = False.
+000329c0: 0a20 2020 2020 2020 2023 2070 6c6f 7420  .        # plot 
+000329d0: 6765 6e65 730a 2020 2020 2020 2020 6669  genes.        fi
+000329e0: 6732 203d 2073 656c 662e 706c 6f74 5f67  g2 = self.plot_g
+000329f0: 656e 6573 280a 2020 2020 2020 2020 2020  enes(.          
+00032a00: 2020 7265 6769 6f6e 3d63 6f6e 7469 672c    region=contig,
+00032a10: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+00032a20: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
+00032a30: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
+00032a40: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
+00032a50: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+00032a60: 743d 6765 6e65 735f 6865 6967 6874 2c0a  t=genes_height,.
+00032a70: 2020 2020 2020 2020 2020 2020 785f 7261              x_ra
+00032a80: 6e67 653d 6669 6731 2e78 5f72 616e 6765  nge=fig1.x_range
+00032a90: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
+00032aa0: 6f77 3d46 616c 7365 2c0a 2020 2020 2020  ow=False,.      
+00032ab0: 2020 290a 0a20 2020 2020 2020 2023 2063    )..        # c
+00032ac0: 6f6d 6269 6e65 2070 6c6f 7473 2069 6e74  ombine plots int
+00032ad0: 6f20 6120 7369 6e67 6c65 2066 6967 7572  o a single figur
+00032ae0: 650a 2020 2020 2020 2020 6669 6720 3d20  e.        fig = 
+00032af0: 626f 6b65 682e 6c61 796f 7574 732e 6772  bokeh.layouts.gr
+00032b00: 6964 706c 6f74 280a 2020 2020 2020 2020  idplot(.        
+00032b10: 2020 2020 5b66 6967 312c 2066 6967 325d      [fig1, fig2]
+00032b20: 2c0a 2020 2020 2020 2020 2020 2020 6e63  ,.            nc
+00032b30: 6f6c 733d 312c 0a20 2020 2020 2020 2020  ols=1,.         
+00032b40: 2020 2074 6f6f 6c62 6172 5f6c 6f63 6174     toolbar_locat
+00032b50: 696f 6e3d 2261 626f 7665 222c 0a20 2020  ion="above",.   
+00032b60: 2020 2020 2020 2020 206d 6572 6765 5f74           merge_t
+00032b70: 6f6f 6c73 3d54 7275 652c 0a20 2020 2020  ools=True,.     
+00032b80: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+00032b90: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
+00032ba0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00032bb0: 2020 2062 6f6b 6568 2e70 6c6f 7474 696e     bokeh.plottin
+00032bc0: 672e 7368 6f77 2866 6967 290a 0a20 2020  g.show(fig)..   
+00032bd0: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
+00032be0: 756d 6d61 7279 3d22 5275 6e20 6948 5320  ummary="Run iHS 
+00032bf0: 4757 5353 2e22 2c0a 2020 2020 2020 2020  GWSS.",.        
+00032c00: 7265 7475 726e 733d 6469 6374 280a 2020  returns=dict(.  
+00032c10: 2020 2020 2020 2020 2020 783d 2241 6e20            x="An 
+00032c20: 6172 7261 7920 636f 6e74 6169 6e69 6e67  array containing
+00032c30: 2074 6865 2077 696e 646f 7720 6365 6e74   the window cent
+00032c40: 7265 2070 6f69 6e74 2067 656e 6f6d 6963  re point genomic
+00032c50: 2070 6f73 6974 696f 6e73 2e22 2c0a 2020   positions.",.  
+00032c60: 2020 2020 2020 2020 2020 6968 733d 2241            ihs="A
+00032c70: 6e20 6172 7261 7920 7769 7468 2069 4853  n array with iHS
+00032c80: 2073 7461 7469 7374 6963 2076 616c 7565   statistic value
+00032c90: 7320 666f 7220 6561 6368 2077 696e 646f  s for each windo
+00032ca0: 772e 222c 0a20 2020 2020 2020 2029 2c0a  w.",.        ),.
+00032cb0: 2020 2020 290a 2020 2020 6465 6620 6968      ).    def ih
+00032cc0: 735f 6777 7373 280a 2020 2020 2020 2020  s_gwss(.        
+00032cd0: 7365 6c66 2c0a 2020 2020 2020 2020 636f  self,.        co
+00032ce0: 6e74 6967 3a20 6261 7365 5f70 6172 616d  ntig: base_param
+00032cf0: 732e 636f 6e74 6967 2c0a 2020 2020 2020  s.contig,.      
+00032d00: 2020 616e 616c 7973 6973 3a20 6861 705f    analysis: hap_
+00032d10: 7061 7261 6d73 2e61 6e61 6c79 7369 7320  params.analysis 
+00032d20: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
+00032d30: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
+00032d40: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+00032d50: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
+00032d60: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00032d70: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
+00032d80: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+00032d90: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
+00032da0: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
+00032db0: 2020 2077 696e 646f 775f 7369 7a65 3a20     window_size: 
+00032dc0: 6968 735f 7061 7261 6d73 2e77 696e 646f  ihs_params.windo
+00032dd0: 775f 7369 7a65 203d 2069 6873 5f70 6172  w_size = ihs_par
+00032de0: 616d 732e 7769 6e64 6f77 5f73 697a 655f  ams.window_size_
+00032df0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+00032e00: 2070 6572 6365 6e74 696c 6573 3a20 6968   percentiles: ih
+00032e10: 735f 7061 7261 6d73 2e70 6572 6365 6e74  s_params.percent
+00032e20: 696c 6573 203d 2069 6873 5f70 6172 616d  iles = ihs_param
+00032e30: 732e 7065 7263 656e 7469 6c65 735f 6465  s.percentiles_de
+00032e40: 6661 756c 742c 0a20 2020 2020 2020 2073  fault,.        s
+00032e50: 7461 6e64 6172 6469 7a65 3a20 6968 735f  tandardize: ihs_
+00032e60: 7061 7261 6d73 2e73 7461 6e64 6172 6469  params.standardi
+00032e70: 7a65 203d 2054 7275 652c 0a20 2020 2020  ze = True,.     
+00032e80: 2020 2073 7461 6e64 6172 6469 7a61 7469     standardizati
+00032e90: 6f6e 5f62 696e 733a 204f 7074 696f 6e61  on_bins: Optiona
+00032ea0: 6c5b 6968 735f 7061 7261 6d73 2e73 7461  l[ihs_params.sta
+00032eb0: 6e64 6172 6469 7a61 7469 6f6e 5f62 696e  ndardization_bin
+00032ec0: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+00032ed0: 2020 2073 7461 6e64 6172 6469 7a61 7469     standardizati
+00032ee0: 6f6e 5f6e 5f62 696e 733a 2069 6873 5f70  on_n_bins: ihs_p
+00032ef0: 6172 616d 732e 7374 616e 6461 7264 697a  arams.standardiz
+00032f00: 6174 696f 6e5f 6e5f 6269 6e73 203d 2069  ation_n_bins = i
+00032f10: 6873 5f70 6172 616d 732e 7374 616e 6461  hs_params.standa
+00032f20: 7264 697a 6174 696f 6e5f 6e5f 6269 6e73  rdization_n_bins
+00032f30: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00032f40: 2020 7374 616e 6461 7264 697a 6174 696f    standardizatio
+00032f50: 6e5f 6469 6167 6e6f 7374 6963 733a 2069  n_diagnostics: i
+00032f60: 6873 5f70 6172 616d 732e 7374 616e 6461  hs_params.standa
+00032f70: 7264 697a 6174 696f 6e5f 6469 6167 6e6f  rdization_diagno
+00032f80: 7374 6963 7320 3d20 4661 6c73 652c 0a20  stics = False,. 
+00032f90: 2020 2020 2020 2066 696c 7465 725f 6d69         filter_mi
+00032fa0: 6e5f 6d61 663a 2069 6873 5f70 6172 616d  n_maf: ihs_param
+00032fb0: 732e 6669 6c74 6572 5f6d 696e 5f6d 6166  s.filter_min_maf
+00032fc0: 203d 2069 6873 5f70 6172 616d 732e 6669   = ihs_params.fi
+00032fd0: 6c74 6572 5f6d 696e 5f6d 6166 5f64 6566  lter_min_maf_def
+00032fe0: 6175 6c74 2c0a 2020 2020 2020 2020 636f  ault,.        co
+00032ff0: 6d70 7574 655f 6d69 6e5f 6d61 663a 2069  mpute_min_maf: i
+00033000: 6873 5f70 6172 616d 732e 636f 6d70 7574  hs_params.comput
+00033010: 655f 6d69 6e5f 6d61 6620 3d20 6968 735f  e_min_maf = ihs_
+00033020: 7061 7261 6d73 2e63 6f6d 7075 7465 5f6d  params.compute_m
+00033030: 696e 5f6d 6166 5f64 6566 6175 6c74 2c0a  in_maf_default,.
+00033040: 2020 2020 2020 2020 6d69 6e5f 6568 683a          min_ehh:
+00033050: 2069 6873 5f70 6172 616d 732e 6d69 6e5f   ihs_params.min_
+00033060: 6568 6820 3d20 6968 735f 7061 7261 6d73  ehh = ihs_params
+00033070: 2e6d 696e 5f65 6868 5f64 6566 6175 6c74  .min_ehh_default
+00033080: 2c0a 2020 2020 2020 2020 6d61 785f 6761  ,.        max_ga
+00033090: 703a 2069 6873 5f70 6172 616d 732e 6d61  p: ihs_params.ma
+000330a0: 785f 6761 7020 3d20 6968 735f 7061 7261  x_gap = ihs_para
+000330b0: 6d73 2e6d 6178 5f67 6170 5f64 6566 6175  ms.max_gap_defau
+000330c0: 6c74 2c0a 2020 2020 2020 2020 6761 705f  lt,.        gap_
+000330d0: 7363 616c 653a 2069 6873 5f70 6172 616d  scale: ihs_param
+000330e0: 732e 6761 705f 7363 616c 6520 3d20 6968  s.gap_scale = ih
+000330f0: 735f 7061 7261 6d73 2e67 6170 5f73 6361  s_params.gap_sca
+00033100: 6c65 5f64 6566 6175 6c74 2c0a 2020 2020  le_default,.    
+00033110: 2020 2020 696e 636c 7564 655f 6564 6765      include_edge
+00033120: 733a 2069 6873 5f70 6172 616d 732e 696e  s: ihs_params.in
+00033130: 636c 7564 655f 6564 6765 7320 3d20 5472  clude_edges = Tr
+00033140: 7565 2c0a 2020 2020 2020 2020 7573 655f  ue,.        use_
+00033150: 7468 7265 6164 733a 2069 6873 5f70 6172  threads: ihs_par
+00033160: 616d 732e 7573 655f 7468 7265 6164 7320  ams.use_threads 
+00033170: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00033180: 6d69 6e5f 636f 686f 7274 5f73 697a 653a  min_cohort_size:
+00033190: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
+000331a0: 2020 2020 2020 2062 6173 655f 7061 7261         base_para
+000331b0: 6d73 2e6d 696e 5f63 6f68 6f72 745f 7369  ms.min_cohort_si
+000331c0: 7a65 0a20 2020 2020 2020 205d 203d 2069  ze.        ] = i
+000331d0: 6873 5f70 6172 616d 732e 6d69 6e5f 636f  hs_params.min_co
+000331e0: 686f 7274 5f73 697a 655f 6465 6661 756c  hort_size_defaul
+000331f0: 742c 0a20 2020 2020 2020 206d 6178 5f63  t,.        max_c
+00033200: 6f68 6f72 745f 7369 7a65 3a20 4f70 7469  ohort_size: Opti
+00033210: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
+00033220: 2020 6261 7365 5f70 6172 616d 732e 6d61    base_params.ma
+00033230: 785f 636f 686f 7274 5f73 697a 650a 2020  x_cohort_size.  
+00033240: 2020 2020 2020 5d20 3d20 6968 735f 7061        ] = ihs_pa
+00033250: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
+00033260: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
+00033270: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+00033280: 643a 2062 6173 655f 7061 7261 6d73 2e72  d: base_params.r
+00033290: 616e 646f 6d5f 7365 6564 203d 2034 322c  andom_seed = 42,
+000332a0: 0a20 2020 2029 202d 3e20 5475 706c 655b  .    ) -> Tuple[
+000332b0: 6e70 2e6e 6461 7272 6179 2c20 6e70 2e6e  np.ndarray, np.n
+000332c0: 6461 7272 6179 5d3a 0a20 2020 2020 2020  darray]:.       
+000332d0: 2023 2063 6861 6e67 6520 7468 6973 206e   # change this n
+000332e0: 616d 6520 6966 2079 6f75 2065 7665 7220  ame if you ever 
+000332f0: 6368 616e 6765 2074 6865 2062 6568 6176  change the behav
+00033300: 696f 7572 206f 6620 7468 6973 2066 756e  iour of this fun
+00033310: 6374 696f 6e2c 2074 6f0a 2020 2020 2020  ction, to.      
+00033320: 2020 2320 696e 7661 6c69 6461 7465 2061    # invalidate a
+00033330: 6e79 2070 7265 7669 6f75 736c 7920 6361  ny previously ca
+00033340: 6368 6564 2064 6174 610a 2020 2020 2020  ched data.      
+00033350: 2020 6e61 6d65 203d 2073 656c 662e 5f69    name = self._i
+00033360: 6873 5f67 7773 735f 6361 6368 655f 6e61  hs_gwss_cache_na
+00033370: 6d65 0a0a 2020 2020 2020 2020 7061 7261  me..        para
+00033380: 6d73 203d 2064 6963 7428 0a20 2020 2020  ms = dict(.     
+00033390: 2020 2020 2020 2063 6f6e 7469 673d 636f         contig=co
+000333a0: 6e74 6967 2c0a 2020 2020 2020 2020 2020  ntig,.          
+000333b0: 2020 616e 616c 7973 6973 3d73 656c 662e    analysis=self.
+000333c0: 5f70 7265 705f 7068 6173 696e 675f 616e  _prep_phasing_an
+000333d0: 616c 7973 6973 5f70 6172 616d 2861 6e61  alysis_param(ana
+000333e0: 6c79 7369 733d 616e 616c 7973 6973 292c  lysis=analysis),
+000333f0: 0a20 2020 2020 2020 2020 2020 2077 696e  .            win
+00033400: 646f 775f 7369 7a65 3d77 696e 646f 775f  dow_size=window_
+00033410: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+00033420: 2020 7065 7263 656e 7469 6c65 733d 7065    percentiles=pe
+00033430: 7263 656e 7469 6c65 732c 0a20 2020 2020  rcentiles,.     
+00033440: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
+00033450: 7a65 3d73 7461 6e64 6172 6469 7a65 2c0a  ze=standardize,.
+00033460: 2020 2020 2020 2020 2020 2020 7374 616e              stan
+00033470: 6461 7264 697a 6174 696f 6e5f 6269 6e73  dardization_bins
+00033480: 3d73 7461 6e64 6172 6469 7a61 7469 6f6e  =standardization
+00033490: 5f62 696e 732c 0a20 2020 2020 2020 2020  _bins,.         
+000334a0: 2020 2073 7461 6e64 6172 6469 7a61 7469     standardizati
+000334b0: 6f6e 5f6e 5f62 696e 733d 7374 616e 6461  on_n_bins=standa
+000334c0: 7264 697a 6174 696f 6e5f 6e5f 6269 6e73  rdization_n_bins
+000334d0: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+000334e0: 616e 6461 7264 697a 6174 696f 6e5f 6469  andardization_di
+000334f0: 6167 6e6f 7374 6963 733d 7374 616e 6461  agnostics=standa
+00033500: 7264 697a 6174 696f 6e5f 6469 6167 6e6f  rdization_diagno
+00033510: 7374 6963 732c 0a20 2020 2020 2020 2020  stics,.         
+00033520: 2020 2066 696c 7465 725f 6d69 6e5f 6d61     filter_min_ma
+00033530: 663d 6669 6c74 6572 5f6d 696e 5f6d 6166  f=filter_min_maf
+00033540: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00033550: 6d70 7574 655f 6d69 6e5f 6d61 663d 636f  mpute_min_maf=co
+00033560: 6d70 7574 655f 6d69 6e5f 6d61 662c 0a20  mpute_min_maf,. 
+00033570: 2020 2020 2020 2020 2020 206d 696e 5f65             min_e
+00033580: 6868 3d6d 696e 5f65 6868 2c0a 2020 2020  hh=min_ehh,.    
+00033590: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+000335a0: 6564 6765 733d 696e 636c 7564 655f 6564  edges=include_ed
+000335b0: 6765 732c 0a20 2020 2020 2020 2020 2020  ges,.           
+000335c0: 206d 6178 5f67 6170 3d6d 6178 5f67 6170   max_gap=max_gap
+000335d0: 2c0a 2020 2020 2020 2020 2020 2020 6761  ,.            ga
+000335e0: 705f 7363 616c 653d 6761 705f 7363 616c  p_scale=gap_scal
+000335f0: 652c 0a20 2020 2020 2020 2020 2020 2075  e,.            u
+00033600: 7365 5f74 6872 6561 6473 3d75 7365 5f74  se_threads=use_t
+00033610: 6872 6561 6473 2c0a 2020 2020 2020 2020  hreads,.        
+00033620: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
+00033630: 7365 6c66 2e5f 7072 6570 5f73 616d 706c  self._prep_sampl
+00033640: 655f 7365 7473 5f70 6172 616d 2873 616d  e_sets_param(sam
+00033650: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
+00033660: 7365 7473 292c 0a20 2020 2020 2020 2020  sets),.         
+00033670: 2020 2023 204e 2e42 2e2c 2064 6f20 6e6f     # N.B., do no
+00033680: 7420 6265 2074 656d 7074 6564 2074 6f20  t be tempted to 
+00033690: 636f 6e76 6572 7420 7468 6973 2073 616d  convert this sam
+000336a0: 706c 6520 7175 6572 7920 696e 746f 2069  ple query into i
+000336b0: 6e74 6567 6572 0a20 2020 2020 2020 2020  nteger.         
+000336c0: 2020 2023 2069 6e64 6963 6573 2075 7369     # indices usi
+000336d0: 6e67 205f 7072 6570 5f73 616d 706c 655f  ng _prep_sample_
+000336e0: 7365 6c65 6374 696f 6e5f 7061 7261 6d73  selection_params
+000336f0: 2c20 6265 6361 7573 6520 7468 6520 696e  , because the in
+00033700: 6469 6365 730a 2020 2020 2020 2020 2020  dices.          
+00033710: 2020 2320 6172 6520 6469 6666 6572 656e    # are differen
+00033720: 7420 696e 2074 6865 2068 6170 6c6f 7479  t in the haploty
+00033730: 7065 2064 6174 612e 0a20 2020 2020 2020  pe data..       
+00033740: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
+00033750: 793d 7361 6d70 6c65 5f71 7565 7279 2c0a  y=sample_query,.
+00033760: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+00033770: 636f 686f 7274 5f73 697a 653d 6d69 6e5f  cohort_size=min_
+00033780: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00033790: 2020 2020 2020 2020 206d 6178 5f63 6f68           max_coh
+000337a0: 6f72 745f 7369 7a65 3d6d 6178 5f63 6f68  ort_size=max_coh
+000337b0: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
+000337c0: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+000337d0: 643d 7261 6e64 6f6d 5f73 6565 642c 0a20  d=random_seed,. 
+000337e0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+000337f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00033800: 2020 2072 6573 756c 7473 203d 2073 656c     results = sel
+00033810: 662e 7265 7375 6c74 735f 6361 6368 655f  f.results_cache_
+00033820: 6765 7428 6e61 6d65 3d6e 616d 652c 2070  get(name=name, p
+00033830: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
+00033840: 2020 2020 2020 2065 7863 6570 7420 4361         except Ca
+00033850: 6368 654d 6973 733a 0a20 2020 2020 2020  cheMiss:.       
+00033860: 2020 2020 2072 6573 756c 7473 203d 2073       results = s
+00033870: 656c 662e 5f69 6873 5f67 7773 7328 2a2a  elf._ihs_gwss(**
+00033880: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00033890: 2020 2020 7365 6c66 2e72 6573 756c 7473      self.results
+000338a0: 5f63 6163 6865 5f73 6574 286e 616d 653d  _cache_set(name=
+000338b0: 6e61 6d65 2c20 7061 7261 6d73 3d70 6172  name, params=par
+000338c0: 616d 732c 2072 6573 756c 7473 3d72 6573  ams, results=res
+000338d0: 756c 7473 290a 0a20 2020 2020 2020 2078  ults)..        x
+000338e0: 203d 2072 6573 756c 7473 5b22 7822 5d0a   = results["x"].
+000338f0: 2020 2020 2020 2020 6968 7320 3d20 7265          ihs = re
+00033900: 7375 6c74 735b 2269 6873 225d 0a0a 2020  sults["ihs"]..  
+00033910: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
+00033920: 6968 730a 0a20 2020 2064 6566 205f 6968  ihs..    def _ih
+00033930: 735f 6777 7373 280a 2020 2020 2020 2020  s_gwss(.        
+00033940: 7365 6c66 2c0a 2020 2020 2020 2020 2a2c  self,.        *,
+00033950: 0a20 2020 2020 2020 2063 6f6e 7469 672c  .        contig,
+00033960: 0a20 2020 2020 2020 2061 6e61 6c79 7369  .        analysi
+00033970: 732c 0a20 2020 2020 2020 2073 616d 706c  s,.        sampl
+00033980: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
+00033990: 7361 6d70 6c65 5f71 7565 7279 2c0a 2020  sample_query,.  
+000339a0: 2020 2020 2020 7769 6e64 6f77 5f73 697a        window_siz
+000339b0: 652c 0a20 2020 2020 2020 2070 6572 6365  e,.        perce
+000339c0: 6e74 696c 6573 2c0a 2020 2020 2020 2020  ntiles,.        
+000339d0: 7374 616e 6461 7264 697a 652c 0a20 2020  standardize,.   
+000339e0: 2020 2020 2073 7461 6e64 6172 6469 7a61       standardiza
+000339f0: 7469 6f6e 5f62 696e 732c 0a20 2020 2020  tion_bins,.     
+00033a00: 2020 2073 7461 6e64 6172 6469 7a61 7469     standardizati
+00033a10: 6f6e 5f6e 5f62 696e 732c 0a20 2020 2020  on_n_bins,.     
+00033a20: 2020 2073 7461 6e64 6172 6469 7a61 7469     standardizati
+00033a30: 6f6e 5f64 6961 676e 6f73 7469 6373 2c0a  on_diagnostics,.
+00033a40: 2020 2020 2020 2020 6669 6c74 6572 5f6d          filter_m
+00033a50: 696e 5f6d 6166 2c0a 2020 2020 2020 2020  in_maf,.        
+00033a60: 636f 6d70 7574 655f 6d69 6e5f 6d61 662c  compute_min_maf,
+00033a70: 0a20 2020 2020 2020 206d 696e 5f65 6868  .        min_ehh
+00033a80: 2c0a 2020 2020 2020 2020 6d61 785f 6761  ,.        max_ga
+00033a90: 702c 0a20 2020 2020 2020 2067 6170 5f73  p,.        gap_s
+00033aa0: 6361 6c65 2c0a 2020 2020 2020 2020 696e  cale,.        in
+00033ab0: 636c 7564 655f 6564 6765 732c 0a20 2020  clude_edges,.   
+00033ac0: 2020 2020 2075 7365 5f74 6872 6561 6473       use_threads
+00033ad0: 2c0a 2020 2020 2020 2020 6d69 6e5f 636f  ,.        min_co
+00033ae0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+00033af0: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
+00033b00: 7a65 2c0a 2020 2020 2020 2020 7261 6e64  ze,.        rand
+00033b10: 6f6d 5f73 6565 642c 0a20 2020 2029 3a0a  om_seed,.    ):.
+00033b20: 2020 2020 2020 2020 6473 5f68 6170 7320          ds_haps 
+00033b30: 3d20 7365 6c66 2e68 6170 6c6f 7479 7065  = self.haplotype
+00033b40: 7328 0a20 2020 2020 2020 2020 2020 2072  s(.            r
+00033b50: 6567 696f 6e3d 636f 6e74 6967 2c0a 2020  egion=contig,.  
+00033b60: 2020 2020 2020 2020 2020 616e 616c 7973            analys
+00033b70: 6973 3d61 6e61 6c79 7369 732c 0a20 2020  is=analysis,.   
+00033b80: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
+00033b90: 7175 6572 793d 7361 6d70 6c65 5f71 7565  query=sample_que
+00033ba0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+00033bb0: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
+00033bc0: 6c65 5f73 6574 732c 0a20 2020 2020 2020  le_sets,.       
+00033bd0: 2020 2020 206d 696e 5f63 6f68 6f72 745f       min_cohort_
+00033be0: 7369 7a65 3d6d 696e 5f63 6f68 6f72 745f  size=min_cohort_
+00033bf0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+00033c00: 2020 6d61 785f 636f 686f 7274 5f73 697a    max_cohort_siz
+00033c10: 653d 6d61 785f 636f 686f 7274 5f73 697a  e=max_cohort_siz
+00033c20: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
+00033c30: 616e 646f 6d5f 7365 6564 3d72 616e 646f  andom_seed=rando
+00033c40: 6d5f 7365 6564 2c0a 2020 2020 2020 2020  m_seed,.        
+00033c50: 290a 0a20 2020 2020 2020 2067 7420 3d20  )..        gt = 
+00033c60: 616c 6c65 6c2e 4765 6e6f 7479 7065 4461  allel.GenotypeDa
+00033c70: 736b 4172 7261 7928 6473 5f68 6170 735b  skArray(ds_haps[
+00033c80: 2263 616c 6c5f 6765 6e6f 7479 7065 225d  "call_genotype"]
+00033c90: 2e64 6174 6129 0a20 2020 2020 2020 2077  .data).        w
+00033ca0: 6974 6820 7365 6c66 2e5f 6461 736b 5f70  ith self._dask_p
+00033cb0: 726f 6772 6573 7328 6465 7363 3d22 4c6f  rogress(desc="Lo
+00033cc0: 6164 2068 6170 6c6f 7479 7065 7322 293a  ad haplotypes"):
+00033cd0: 0a20 2020 2020 2020 2020 2020 2068 7420  .            ht 
+00033ce0: 3d20 6774 2e74 6f5f 6861 706c 6f74 7970  = gt.to_haplotyp
+00033cf0: 6573 2829 2e63 6f6d 7075 7465 2829 0a0a  es().compute()..
+00033d00: 2020 2020 2020 2020 6163 203d 2068 742e          ac = ht.
+00033d10: 636f 756e 745f 616c 6c65 6c65 7328 6d61  count_alleles(ma
+00033d20: 785f 616c 6c65 6c65 3d31 290a 2020 2020  x_allele=1).    
+00033d30: 2020 2020 706f 7320 3d20 6473 5f68 6170      pos = ds_hap
+00033d40: 735b 2276 6172 6961 6e74 5f70 6f73 6974  s["variant_posit
+00033d50: 696f 6e22 5d2e 7661 6c75 6573 0a0a 2020  ion"].values..  
+00033d60: 2020 2020 2020 6966 2066 696c 7465 725f        if filter_
+00033d70: 6d69 6e5f 6d61 6620 3e20 303a 0a20 2020  min_maf > 0:.   
+00033d80: 2020 2020 2020 2020 2061 6620 3d20 6163           af = ac
+00033d90: 2e74 6f5f 6672 6571 7565 6e63 6965 7328  .to_frequencies(
+00033da0: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00033db0: 6620 3d20 6e70 2e6d 696e 2861 662c 2061  f = np.min(af, a
+00033dc0: 7869 733d 3129 0a20 2020 2020 2020 2020  xis=1).         
+00033dd0: 2020 206d 6166 5f66 696c 7465 7220 3d20     maf_filter = 
+00033de0: 6d61 6620 3e20 6669 6c74 6572 5f6d 696e  maf > filter_min
+00033df0: 5f6d 6166 0a20 2020 2020 2020 2020 2020  _maf.           
+00033e00: 2068 7420 3d20 6874 2e63 6f6d 7072 6573   ht = ht.compres
+00033e10: 7328 6d61 665f 6669 6c74 6572 2c20 6178  s(maf_filter, ax
+00033e20: 6973 3d30 290a 2020 2020 2020 2020 2020  is=0).          
+00033e30: 2020 706f 7320 3d20 706f 735b 6d61 665f    pos = pos[maf_
+00033e40: 6669 6c74 6572 5d0a 2020 2020 2020 2020  filter].        
+00033e50: 2020 2020 6163 203d 2061 635b 6d61 665f      ac = ac[maf_
+00033e60: 6669 6c74 6572 5d0a 0a20 2020 2020 2020  filter]..       
+00033e70: 2023 2063 6f6d 7075 7465 2069 4853 0a20   # compute iHS. 
+00033e80: 2020 2020 2020 2069 6873 203d 2061 6c6c         ihs = all
+00033e90: 656c 2e69 6873 280a 2020 2020 2020 2020  el.ihs(.        
+00033ea0: 2020 2020 683d 6874 2c0a 2020 2020 2020      h=ht,.      
+00033eb0: 2020 2020 2020 706f 733d 706f 732c 0a20        pos=pos,. 
+00033ec0: 2020 2020 2020 2020 2020 206d 696e 5f6d             min_m
+00033ed0: 6166 3d63 6f6d 7075 7465 5f6d 696e 5f6d  af=compute_min_m
+00033ee0: 6166 2c0a 2020 2020 2020 2020 2020 2020  af,.            
+00033ef0: 6d69 6e5f 6568 683d 6d69 6e5f 6568 682c  min_ehh=min_ehh,
+00033f00: 0a20 2020 2020 2020 2020 2020 2069 6e63  .            inc
+00033f10: 6c75 6465 5f65 6467 6573 3d69 6e63 6c75  lude_edges=inclu
+00033f20: 6465 5f65 6467 6573 2c0a 2020 2020 2020  de_edges,.      
+00033f30: 2020 2020 2020 6d61 785f 6761 703d 6d61        max_gap=ma
+00033f40: 785f 6761 702c 0a20 2020 2020 2020 2020  x_gap,.         
+00033f50: 2020 2067 6170 5f73 6361 6c65 3d67 6170     gap_scale=gap
+00033f60: 5f73 6361 6c65 2c0a 2020 2020 2020 2020  _scale,.        
+00033f70: 2020 2020 7573 655f 7468 7265 6164 733d      use_threads=
+00033f80: 7573 655f 7468 7265 6164 732c 0a20 2020  use_threads,.   
+00033f90: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00033fa0: 2320 7265 6d6f 7665 2061 6e79 204e 614e  # remove any NaN
+00033fb0: 730a 2020 2020 2020 2020 6e61 5f6d 6173  s.        na_mas
+00033fc0: 6b20 3d20 7e6e 702e 6973 6e61 6e28 6968  k = ~np.isnan(ih
+00033fd0: 7329 0a20 2020 2020 2020 2069 6873 203d  s).        ihs =
+00033fe0: 2069 6873 5b6e 615f 6d61 736b 5d0a 2020   ihs[na_mask].  
+00033ff0: 2020 2020 2020 706f 7320 3d20 706f 735b        pos = pos[
+00034000: 6e61 5f6d 6173 6b5d 0a20 2020 2020 2020  na_mask].       
+00034010: 2061 6320 3d20 6163 5b6e 615f 6d61 736b   ac = ac[na_mask
+00034020: 5d0a 0a20 2020 2020 2020 2023 2074 616b  ]..        # tak
+00034030: 6520 6162 736f 6c75 7465 2076 616c 7565  e absolute value
+00034040: 0a20 2020 2020 2020 2069 6873 203d 206e  .        ihs = n
+00034050: 702e 6661 6273 2869 6873 290a 0a20 2020  p.fabs(ihs)..   
+00034060: 2020 2020 2069 6620 7374 616e 6461 7264       if standard
+00034070: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
+00034080: 2069 6873 2c20 5f20 3d20 616c 6c65 6c2e   ihs, _ = allel.
+00034090: 7374 616e 6461 7264 697a 655f 6279 5f61  standardize_by_a
+000340a0: 6c6c 656c 655f 636f 756e 7428 0a20 2020  llele_count(.   
+000340b0: 2020 2020 2020 2020 2020 2020 2073 636f               sco
+000340c0: 7265 3d69 6873 2c0a 2020 2020 2020 2020  re=ihs,.        
+000340d0: 2020 2020 2020 2020 6161 633d 6163 5b3a          aac=ac[:
+000340e0: 2c20 315d 2c0a 2020 2020 2020 2020 2020  , 1],.          
+000340f0: 2020 2020 2020 6269 6e73 3d73 7461 6e64        bins=stand
+00034100: 6172 6469 7a61 7469 6f6e 5f62 696e 732c  ardization_bins,
+00034110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034120: 206e 5f62 696e 733d 7374 616e 6461 7264   n_bins=standard
+00034130: 697a 6174 696f 6e5f 6e5f 6269 6e73 2c0a  ization_n_bins,.
+00034140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034150: 6469 6167 6e6f 7374 6963 733d 7374 616e  diagnostics=stan
+00034160: 6461 7264 697a 6174 696f 6e5f 6469 6167  dardization_diag
+00034170: 6e6f 7374 6963 732c 0a20 2020 2020 2020  nostics,.       
+00034180: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00034190: 6966 2077 696e 646f 775f 7369 7a65 3a0a  if window_size:.
+000341a0: 2020 2020 2020 2020 2020 2020 6968 7320              ihs 
+000341b0: 3d20 616c 6c65 6c2e 6d6f 7669 6e67 5f73  = allel.moving_s
+000341c0: 7461 7469 7374 6963 280a 2020 2020 2020  tatistic(.      
+000341d0: 2020 2020 2020 2020 2020 6968 732c 2073            ihs, s
+000341e0: 7461 7469 7374 6963 3d6e 702e 7065 7263  tatistic=np.perc
+000341f0: 656e 7469 6c65 2c20 7369 7a65 3d77 696e  entile, size=win
+00034200: 646f 775f 7369 7a65 2c20 713d 7065 7263  dow_size, q=perc
+00034210: 656e 7469 6c65 730a 2020 2020 2020 2020  entiles.        
+00034220: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00034230: 2020 706f 7320 3d20 616c 6c65 6c2e 6d6f    pos = allel.mo
+00034240: 7669 6e67 5f73 7461 7469 7374 6963 2870  ving_statistic(p
+00034250: 6f73 2c20 7374 6174 6973 7469 633d 6e70  os, statistic=np
+00034260: 2e6d 6561 6e2c 2073 697a 653d 7769 6e64  .mean, size=wind
+00034270: 6f77 5f73 697a 6529 0a0a 2020 2020 2020  ow_size)..      
+00034280: 2020 7265 7375 6c74 7320 3d20 6469 6374    results = dict
+00034290: 2878 3d70 6f73 2c20 6968 733d 6968 7329  (x=pos, ihs=ihs)
+000342a0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000342b0: 2072 6573 756c 7473 0a0a 2020 2020 4064   results..    @d
+000342c0: 6f63 280a 2020 2020 2020 2020 7375 6d6d  oc(.        summ
+000342d0: 6172 793d 2252 756e 2061 6e64 2070 6c6f  ary="Run and plo
+000342e0: 7420 6948 5320 4757 5353 2064 6174 612e  t iHS GWSS data.
+000342f0: 222c 0a20 2020 2029 0a20 2020 2064 6566  ",.    ).    def
+00034300: 2070 6c6f 745f 6968 735f 6777 7373 5f74   plot_ihs_gwss_t
+00034310: 7261 636b 280a 2020 2020 2020 2020 7365  rack(.        se
+00034320: 6c66 2c0a 2020 2020 2020 2020 636f 6e74  lf,.        cont
+00034330: 6967 3a20 6261 7365 5f70 6172 616d 732e  ig: base_params.
+00034340: 636f 6e74 6967 2c0a 2020 2020 2020 2020  contig,.        
+00034350: 616e 616c 7973 6973 3a20 6861 705f 7061  analysis: hap_pa
+00034360: 7261 6d73 2e61 6e61 6c79 7369 7320 3d20  rams.analysis = 
+00034370: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
+00034380: 2073 616d 706c 655f 7365 7473 3a20 4f70   sample_sets: Op
+00034390: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+000343a0: 6d73 2e73 616d 706c 655f 7365 7473 5d20  ms.sample_sets] 
+000343b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000343c0: 7361 6d70 6c65 5f71 7565 7279 3a20 4f70  sample_query: Op
+000343d0: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+000343e0: 6d73 2e73 616d 706c 655f 7175 6572 795d  ms.sample_query]
+000343f0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00034400: 2077 696e 646f 775f 7369 7a65 3a20 6968   window_size: ih
+00034410: 735f 7061 7261 6d73 2e77 696e 646f 775f  s_params.window_
+00034420: 7369 7a65 203d 2069 6873 5f70 6172 616d  size = ihs_param
+00034430: 732e 7769 6e64 6f77 5f73 697a 655f 6465  s.window_size_de
+00034440: 6661 756c 742c 0a20 2020 2020 2020 2070  fault,.        p
+00034450: 6572 6365 6e74 696c 6573 3a20 6968 735f  ercentiles: ihs_
+00034460: 7061 7261 6d73 2e70 6572 6365 6e74 696c  params.percentil
+00034470: 6573 203d 2069 6873 5f70 6172 616d 732e  es = ihs_params.
+00034480: 7065 7263 656e 7469 6c65 735f 6465 6661  percentiles_defa
+00034490: 756c 742c 0a20 2020 2020 2020 2073 7461  ult,.        sta
+000344a0: 6e64 6172 6469 7a65 3a20 6968 735f 7061  ndardize: ihs_pa
+000344b0: 7261 6d73 2e73 7461 6e64 6172 6469 7a65  rams.standardize
+000344c0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+000344d0: 2073 7461 6e64 6172 6469 7a61 7469 6f6e   standardization
+000344e0: 5f62 696e 733a 204f 7074 696f 6e61 6c5b  _bins: Optional[
+000344f0: 6968 735f 7061 7261 6d73 2e73 7461 6e64  ihs_params.stand
+00034500: 6172 6469 7a61 7469 6f6e 5f62 696e 735d  ardization_bins]
+00034510: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00034520: 2073 7461 6e64 6172 6469 7a61 7469 6f6e   standardization
+00034530: 5f6e 5f62 696e 733a 2069 6873 5f70 6172  _n_bins: ihs_par
+00034540: 616d 732e 7374 616e 6461 7264 697a 6174  ams.standardizat
+00034550: 696f 6e5f 6e5f 6269 6e73 203d 2069 6873  ion_n_bins = ihs
+00034560: 5f70 6172 616d 732e 7374 616e 6461 7264  _params.standard
+00034570: 697a 6174 696f 6e5f 6e5f 6269 6e73 5f64  ization_n_bins_d
+00034580: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+00034590: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
+000345a0: 6469 6167 6e6f 7374 6963 733a 2069 6873  diagnostics: ihs
+000345b0: 5f70 6172 616d 732e 7374 616e 6461 7264  _params.standard
+000345c0: 697a 6174 696f 6e5f 6469 6167 6e6f 7374  ization_diagnost
+000345d0: 6963 7320 3d20 4661 6c73 652c 0a20 2020  ics = False,.   
+000345e0: 2020 2020 2066 696c 7465 725f 6d69 6e5f       filter_min_
+000345f0: 6d61 663a 2069 6873 5f70 6172 616d 732e  maf: ihs_params.
+00034600: 6669 6c74 6572 5f6d 696e 5f6d 6166 203d  filter_min_maf =
+00034610: 2069 6873 5f70 6172 616d 732e 6669 6c74   ihs_params.filt
+00034620: 6572 5f6d 696e 5f6d 6166 5f64 6566 6175  er_min_maf_defau
+00034630: 6c74 2c0a 2020 2020 2020 2020 636f 6d70  lt,.        comp
+00034640: 7574 655f 6d69 6e5f 6d61 663a 2069 6873  ute_min_maf: ihs
+00034650: 5f70 6172 616d 732e 636f 6d70 7574 655f  _params.compute_
+00034660: 6d69 6e5f 6d61 6620 3d20 6968 735f 7061  min_maf = ihs_pa
+00034670: 7261 6d73 2e63 6f6d 7075 7465 5f6d 696e  rams.compute_min
+00034680: 5f6d 6166 5f64 6566 6175 6c74 2c0a 2020  _maf_default,.  
+00034690: 2020 2020 2020 6d69 6e5f 6568 683a 2069        min_ehh: i
+000346a0: 6873 5f70 6172 616d 732e 6d69 6e5f 6568  hs_params.min_eh
+000346b0: 6820 3d20 6968 735f 7061 7261 6d73 2e6d  h = ihs_params.m
+000346c0: 696e 5f65 6868 5f64 6566 6175 6c74 2c0a  in_ehh_default,.
+000346d0: 2020 2020 2020 2020 6d61 785f 6761 703a          max_gap:
+000346e0: 2069 6873 5f70 6172 616d 732e 6d61 785f   ihs_params.max_
+000346f0: 6761 7020 3d20 6968 735f 7061 7261 6d73  gap = ihs_params
+00034700: 2e6d 6178 5f67 6170 5f64 6566 6175 6c74  .max_gap_default
+00034710: 2c0a 2020 2020 2020 2020 6761 705f 7363  ,.        gap_sc
+00034720: 616c 653a 2069 6873 5f70 6172 616d 732e  ale: ihs_params.
+00034730: 6761 705f 7363 616c 6520 3d20 6968 735f  gap_scale = ihs_
+00034740: 7061 7261 6d73 2e67 6170 5f73 6361 6c65  params.gap_scale
+00034750: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00034760: 2020 696e 636c 7564 655f 6564 6765 733a    include_edges:
+00034770: 2069 6873 5f70 6172 616d 732e 696e 636c   ihs_params.incl
+00034780: 7564 655f 6564 6765 7320 3d20 5472 7565  ude_edges = True
+00034790: 2c0a 2020 2020 2020 2020 7573 655f 7468  ,.        use_th
+000347a0: 7265 6164 733a 2069 6873 5f70 6172 616d  reads: ihs_param
+000347b0: 732e 7573 655f 7468 7265 6164 7320 3d20  s.use_threads = 
+000347c0: 5472 7565 2c0a 2020 2020 2020 2020 6d69  True,.        mi
+000347d0: 6e5f 636f 686f 7274 5f73 697a 653a 204f  n_cohort_size: O
+000347e0: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+000347f0: 2020 2020 2062 6173 655f 7061 7261 6d73       base_params
+00034800: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
+00034810: 0a20 2020 2020 2020 205d 203d 2069 6873  .        ] = ihs
+00034820: 5f70 6172 616d 732e 6d69 6e5f 636f 686f  _params.min_coho
+00034830: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
+00034840: 0a20 2020 2020 2020 206d 6178 5f63 6f68  .        max_coh
+00034850: 6f72 745f 7369 7a65 3a20 4f70 7469 6f6e  ort_size: Option
+00034860: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
+00034870: 6261 7365 5f70 6172 616d 732e 6d61 785f  base_params.max_
+00034880: 636f 686f 7274 5f73 697a 650a 2020 2020  cohort_size.    
+00034890: 2020 2020 5d20 3d20 6968 735f 7061 7261      ] = ihs_para
+000348a0: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
+000348b0: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
+000348c0: 2020 2020 7261 6e64 6f6d 5f73 6565 643a      random_seed:
+000348d0: 2062 6173 655f 7061 7261 6d73 2e72 616e   base_params.ran
+000348e0: 646f 6d5f 7365 6564 203d 2034 322c 0a20  dom_seed = 42,. 
+000348f0: 2020 2020 2020 2070 616c 6574 7465 3a20         palette: 
+00034900: 6968 735f 7061 7261 6d73 2e70 616c 6574  ihs_params.palet
+00034910: 7465 203d 2069 6873 5f70 6172 616d 732e  te = ihs_params.
+00034920: 7061 6c65 7474 655f 6465 6661 756c 742c  palette_default,
+00034930: 0a20 2020 2020 2020 2074 6974 6c65 3a20  .        title: 
+00034940: 4f70 7469 6f6e 616c 5b67 706c 745f 7061  Optional[gplt_pa
+00034950: 7261 6d73 2e74 6974 6c65 5d20 3d20 4e6f  rams.title] = No
+00034960: 6e65 2c0a 2020 2020 2020 2020 7369 7a69  ne,.        sizi
+00034970: 6e67 5f6d 6f64 653a 2067 706c 745f 7061  ng_mode: gplt_pa
+00034980: 7261 6d73 2e73 697a 696e 675f 6d6f 6465  rams.sizing_mode
+00034990: 203d 2067 706c 745f 7061 7261 6d73 2e73   = gplt_params.s
+000349a0: 697a 696e 675f 6d6f 6465 5f64 6566 6175  izing_mode_defau
+000349b0: 6c74 2c0a 2020 2020 2020 2020 7769 6474  lt,.        widt
+000349c0: 683a 2067 706c 745f 7061 7261 6d73 2e77  h: gplt_params.w
+000349d0: 6964 7468 203d 2067 706c 745f 7061 7261  idth = gplt_para
+000349e0: 6d73 2e77 6964 7468 5f64 6566 6175 6c74  ms.width_default
+000349f0: 2c0a 2020 2020 2020 2020 6865 6967 6874  ,.        height
+00034a00: 3a20 6770 6c74 5f70 6172 616d 732e 6865  : gplt_params.he
+00034a10: 6967 6874 203d 2032 3030 2c0a 2020 2020  ight = 200,.    
+00034a20: 2020 2020 7368 6f77 3a20 6770 6c74 5f70      show: gplt_p
+00034a30: 6172 616d 732e 7368 6f77 203d 2054 7275  arams.show = Tru
+00034a40: 652c 0a20 2020 2020 2020 2078 5f72 616e  e,.        x_ran
+00034a50: 6765 3a20 4f70 7469 6f6e 616c 5b67 706c  ge: Optional[gpl
+00034a60: 745f 7061 7261 6d73 2e78 5f72 616e 6765  t_params.x_range
+00034a70: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
+00034a80: 2d3e 2067 706c 745f 7061 7261 6d73 2e66  -> gplt_params.f
+00034a90: 6967 7572 653a 0a20 2020 2020 2020 2023  igure:.        #
+00034aa0: 2063 6f6d 7075 7465 2069 6873 0a20 2020   compute ihs.   
+00034ab0: 2020 2020 2078 2c20 6968 7320 3d20 7365       x, ihs = se
+00034ac0: 6c66 2e69 6873 5f67 7773 7328 0a20 2020  lf.ihs_gwss(.   
+00034ad0: 2020 2020 2020 2020 2063 6f6e 7469 673d           contig=
+00034ae0: 636f 6e74 6967 2c0a 2020 2020 2020 2020  contig,.        
+00034af0: 2020 2020 616e 616c 7973 6973 3d61 6e61      analysis=ana
+00034b00: 6c79 7369 732c 0a20 2020 2020 2020 2020  lysis,.         
+00034b10: 2020 2077 696e 646f 775f 7369 7a65 3d77     window_size=w
+00034b20: 696e 646f 775f 7369 7a65 2c0a 2020 2020  indow_size,.    
+00034b30: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
+00034b40: 6c65 733d 7065 7263 656e 7469 6c65 732c  les=percentiles,
+00034b50: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00034b60: 6e64 6172 6469 7a65 3d73 7461 6e64 6172  ndardize=standar
+00034b70: 6469 7a65 2c0a 2020 2020 2020 2020 2020  dize,.          
+00034b80: 2020 7374 616e 6461 7264 697a 6174 696f    standardizatio
+00034b90: 6e5f 6269 6e73 3d73 7461 6e64 6172 6469  n_bins=standardi
+00034ba0: 7a61 7469 6f6e 5f62 696e 732c 0a20 2020  zation_bins,.   
+00034bb0: 2020 2020 2020 2020 2073 7461 6e64 6172           standar
+00034bc0: 6469 7a61 7469 6f6e 5f6e 5f62 696e 733d  dization_n_bins=
+00034bd0: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
+00034be0: 6e5f 6269 6e73 2c0a 2020 2020 2020 2020  n_bins,.        
+00034bf0: 2020 2020 7374 616e 6461 7264 697a 6174      standardizat
+00034c00: 696f 6e5f 6469 6167 6e6f 7374 6963 733d  ion_diagnostics=
+00034c10: 7374 616e 6461 7264 697a 6174 696f 6e5f  standardization_
+00034c20: 6469 6167 6e6f 7374 6963 732c 0a20 2020  diagnostics,.   
+00034c30: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00034c40: 6d69 6e5f 6d61 663d 6669 6c74 6572 5f6d  min_maf=filter_m
+00034c50: 696e 5f6d 6166 2c0a 2020 2020 2020 2020  in_maf,.        
+00034c60: 2020 2020 636f 6d70 7574 655f 6d69 6e5f      compute_min_
+00034c70: 6d61 663d 636f 6d70 7574 655f 6d69 6e5f  maf=compute_min_
+00034c80: 6d61 662c 0a20 2020 2020 2020 2020 2020  maf,.           
+00034c90: 206d 696e 5f65 6868 3d6d 696e 5f65 6868   min_ehh=min_ehh
+00034ca0: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+00034cb0: 785f 6761 703d 6d61 785f 6761 702c 0a20  x_gap=max_gap,. 
+00034cc0: 2020 2020 2020 2020 2020 2067 6170 5f73             gap_s
+00034cd0: 6361 6c65 3d67 6170 5f73 6361 6c65 2c0a  cale=gap_scale,.
+00034ce0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+00034cf0: 7564 655f 6564 6765 733d 696e 636c 7564  ude_edges=includ
+00034d00: 655f 6564 6765 732c 0a20 2020 2020 2020  e_edges,.       
+00034d10: 2020 2020 2075 7365 5f74 6872 6561 6473       use_threads
+00034d20: 3d75 7365 5f74 6872 6561 6473 2c0a 2020  =use_threads,.  
+00034d30: 2020 2020 2020 2020 2020 6d69 6e5f 636f            min_co
+00034d40: 686f 7274 5f73 697a 653d 6d69 6e5f 636f  hort_size=min_co
+00034d50: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+00034d60: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+00034d70: 745f 7369 7a65 3d6d 6178 5f63 6f68 6f72  t_size=max_cohor
+00034d80: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
+00034d90: 2020 2020 7361 6d70 6c65 5f71 7565 7279      sample_query
+00034da0: 3d73 616d 706c 655f 7175 6572 792c 0a20  =sample_query,. 
+00034db0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00034dc0: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
+00034dd0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00034de0: 7261 6e64 6f6d 5f73 6565 643d 7261 6e64  random_seed=rand
+00034df0: 6f6d 5f73 6565 642c 0a20 2020 2020 2020  om_seed,.       
+00034e00: 2029 0a0a 2020 2020 2020 2020 2320 6465   )..        # de
+00034e10: 7465 726d 696e 6520 5820 6178 6973 2072  termine X axis r
+00034e20: 616e 6765 0a20 2020 2020 2020 2078 5f6d  ange.        x_m
+00034e30: 696e 203d 2078 5b30 5d0a 2020 2020 2020  in = x[0].      
+00034e40: 2020 785f 6d61 7820 3d20 785b 2d31 5d0a    x_max = x[-1].
+00034e50: 2020 2020 2020 2020 6966 2078 5f72 616e          if x_ran
+00034e60: 6765 2069 7320 4e6f 6e65 3a0a 2020 2020  ge is None:.    
+00034e70: 2020 2020 2020 2020 785f 7261 6e67 6520          x_range 
+00034e80: 3d20 626f 6b65 682e 6d6f 6465 6c73 2e52  = bokeh.models.R
+00034e90: 616e 6765 3164 2878 5f6d 696e 2c20 785f  ange1d(x_min, x_
+00034ea0: 6d61 782c 2062 6f75 6e64 733d 2261 7574  max, bounds="aut
+00034eb0: 6f22 290a 0a20 2020 2020 2020 2023 2063  o")..        # c
+00034ec0: 7265 6174 6520 6120 6669 6775 7265 0a20  reate a figure. 
+00034ed0: 2020 2020 2020 2078 7768 6565 6c5f 7a6f         xwheel_zo
+00034ee0: 6f6d 203d 2062 6f6b 6568 2e6d 6f64 656c  om = bokeh.model
+00034ef0: 732e 5768 6565 6c5a 6f6f 6d54 6f6f 6c28  s.WheelZoomTool(
+00034f00: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00034f10: 656e 7369 6f6e 733d 2277 6964 7468 222c  ensions="width",
+00034f20: 206d 6169 6e74 6169 6e5f 666f 6375 733d   maintain_focus=
+00034f30: 4661 6c73 650a 2020 2020 2020 2020 290a  False.        ).
+00034f40: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
+00034f50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00034f60: 2020 2020 2020 7469 746c 6520 3d20 7361        title = sa
+00034f70: 6d70 6c65 5f71 7565 7279 0a20 2020 2020  mple_query.     
+00034f80: 2020 2066 6967 203d 2062 6f6b 6568 2e70     fig = bokeh.p
+00034f90: 6c6f 7474 696e 672e 6669 6775 7265 280a  lotting.figure(.
+00034fa0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+00034fb0: 653d 7469 746c 652c 0a20 2020 2020 2020  e=title,.       
+00034fc0: 2020 2020 2074 6f6f 6c73 3d5b 2278 7061       tools=["xpa
+00034fd0: 6e22 2c20 2278 7a6f 6f6d 5f69 6e22 2c20  n", "xzoom_in", 
+00034fe0: 2278 7a6f 6f6d 5f6f 7574 222c 2078 7768  "xzoom_out", xwh
+00034ff0: 6565 6c5f 7a6f 6f6d 2c20 2272 6573 6574  eel_zoom, "reset
+00035000: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00035010: 6163 7469 7665 5f73 6372 6f6c 6c3d 7877  active_scroll=xw
+00035020: 6865 656c 5f7a 6f6f 6d2c 0a20 2020 2020  heel_zoom,.     
+00035030: 2020 2020 2020 2061 6374 6976 655f 6472         active_dr
+00035040: 6167 3d22 7870 616e 222c 0a20 2020 2020  ag="xpan",.     
+00035050: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+00035060: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
+00035070: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+00035080: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
+00035090: 2020 2020 2068 6569 6768 743d 6865 6967       height=heig
+000350a0: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
+000350b0: 746f 6f6c 6261 725f 6c6f 6361 7469 6f6e  toolbar_location
+000350c0: 3d22 6162 6f76 6522 2c0a 2020 2020 2020  ="above",.      
+000350d0: 2020 2020 2020 785f 7261 6e67 653d 785f        x_range=x_
+000350e0: 7261 6e67 652c 0a20 2020 2020 2020 2029  range,.        )
+000350f0: 0a0a 2020 2020 2020 2020 6966 2077 696e  ..        if win
+00035100: 646f 775f 7369 7a65 3a0a 2020 2020 2020  dow_size:.      
+00035110: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00035120: 6e63 6528 7065 7263 656e 7469 6c65 732c  nce(percentiles,
+00035130: 2069 6e74 293a 0a20 2020 2020 2020 2020   int):.         
+00035140: 2020 2020 2020 2070 6572 6365 6e74 696c         percentil
+00035150: 6573 203d 2028 7065 7263 656e 7469 6c65  es = (percentile
+00035160: 732c 290a 0a20 2020 2020 2020 2023 2061  s,)..        # a
+00035170: 6464 2061 6e20 656d 7074 7920 6469 6d65  dd an empty dime
+00035180: 6e73 696f 6e20 746f 2069 6873 2061 7272  nsion to ihs arr
+00035190: 6179 2069 6620 3144 0a20 2020 2020 2020  ay if 1D.       
+000351a0: 2069 6873 203d 206e 702e 7265 7368 6170   ihs = np.reshap
+000351b0: 6528 6968 732c 2028 6968 732e 7368 6170  e(ihs, (ihs.shap
+000351c0: 655b 305d 2c20 2d31 2929 0a20 2020 2020  e[0], -1)).     
+000351d0: 2020 2062 6f6b 6568 5f70 616c 6574 7465     bokeh_palette
+000351e0: 203d 2062 6f6b 6568 2e70 616c 6574 7465   = bokeh.palette
+000351f0: 732e 616c 6c5f 7061 6c65 7474 6573 5b70  s.all_palettes[p
+00035200: 616c 6574 7465 5d0a 2020 2020 2020 2020  alette].        
+00035210: 666f 7220 6920 696e 2072 616e 6765 2869  for i in range(i
+00035220: 6873 2e73 6861 7065 5b31 5d29 3a0a 2020  hs.shape[1]):.  
+00035230: 2020 2020 2020 2020 2020 6968 735f 7065            ihs_pe
+00035240: 7263 203d 2069 6873 5b3a 2c20 695d 0a20  rc = ihs[:, i]. 
+00035250: 2020 2020 2020 2020 2020 2069 6620 6968             if ih
+00035260: 732e 7368 6170 655b 315d 203e 3d20 333a  s.shape[1] >= 3:
+00035270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035280: 2063 6f6c 6f72 203d 2062 6f6b 6568 5f70   color = bokeh_p
+00035290: 616c 6574 7465 5b69 6873 2e73 6861 7065  alette[ihs.shape
+000352a0: 5b31 5d5d 5b69 5d0a 2020 2020 2020 2020  [1]][i].        
+000352b0: 2020 2020 656c 6966 2069 6873 2e73 6861      elif ihs.sha
+000352c0: 7065 5b31 5d20 3d3d 2032 3a0a 2020 2020  pe[1] == 2:.    
+000352d0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+000352e0: 7220 3d20 626f 6b65 685f 7061 6c65 7474  r = bokeh_palett
+000352f0: 655b 335d 5b69 5d0a 2020 2020 2020 2020  e[3][i].        
+00035300: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00035310: 2020 2020 2020 2020 2020 636f 6c6f 7220            color 
+00035320: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+00035330: 2020 2020 2320 706c 6f74 2069 6873 0a20      # plot ihs. 
+00035340: 2020 2020 2020 2020 2020 2066 6967 2e63             fig.c
+00035350: 6972 636c 6528 0a20 2020 2020 2020 2020  ircle(.         
+00035360: 2020 2020 2020 2078 3d78 2c0a 2020 2020         x=x,.    
+00035370: 2020 2020 2020 2020 2020 2020 793d 6968              y=ih
+00035380: 735f 7065 7263 2c0a 2020 2020 2020 2020  s_perc,.        
+00035390: 2020 2020 2020 2020 7369 7a65 3d33 2c0a          size=3,.
+000353a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000353b0: 6c69 6e65 5f77 6964 7468 3d30 2e31 352c  line_width=0.15,
+000353c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000353d0: 206c 696e 655f 636f 6c6f 723d 2262 6c61   line_color="bla
+000353e0: 636b 222c 0a20 2020 2020 2020 2020 2020  ck",.           
+000353f0: 2020 2020 2066 696c 6c5f 636f 6c6f 723d       fill_color=
+00035400: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
+00035410: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00035420: 7469 6479 2075 7020 7468 6520 706c 6f74  tidy up the plot
+00035430: 0a20 2020 2020 2020 2066 6967 2e79 6178  .        fig.yax
+00035440: 6973 2e61 7869 735f 6c61 6265 6c20 3d20  is.axis_label = 
+00035450: 2269 6873 220a 2020 2020 2020 2020 7365  "ihs".        se
+00035460: 6c66 2e5f 626f 6b65 685f 7374 796c 655f  lf._bokeh_style_
+00035470: 6765 6e6f 6d65 5f78 6178 6973 2866 6967  genome_xaxis(fig
+00035480: 2c20 636f 6e74 6967 290a 0a20 2020 2020  , contig)..     
+00035490: 2020 2069 6620 7368 6f77 3a0a 2020 2020     if show:.    
+000354a0: 2020 2020 2020 2020 626f 6b65 682e 706c          bokeh.pl
+000354b0: 6f74 7469 6e67 2e73 686f 7728 6669 6729  otting.show(fig)
+000354c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000354d0: 2066 6967 0a0a 2020 2020 4064 6f63 280a   fig..    @doc(.
+000354e0: 2020 2020 2020 2020 7375 6d6d 6172 793d          summary=
+000354f0: 2252 756e 2061 6e64 2070 6c6f 7420 6948  "Run and plot iH
+00035500: 5320 4757 5353 2064 6174 612e 222c 0a20  S GWSS data.",. 
+00035510: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
+00035520: 745f 6968 735f 6777 7373 280a 2020 2020  t_ihs_gwss(.    
+00035530: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00035540: 2020 636f 6e74 6967 3a20 6261 7365 5f70    contig: base_p
+00035550: 6172 616d 732e 636f 6e74 6967 2c0a 2020  arams.contig,.  
+00035560: 2020 2020 2020 616e 616c 7973 6973 3a20        analysis: 
+00035570: 6861 705f 7061 7261 6d73 2e61 6e61 6c79  hap_params.analy
+00035580: 7369 7320 3d20 4445 4641 554c 542c 0a20  sis = DEFAULT,. 
+00035590: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+000355a0: 7473 3a20 4f70 7469 6f6e 616c 5b62 6173  ts: Optional[bas
+000355b0: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
+000355c0: 7365 7473 5d20 3d20 4e6f 6e65 2c0a 2020  sets] = None,.  
+000355d0: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
+000355e0: 7279 3a20 4f70 7469 6f6e 616c 5b62 6173  ry: Optional[bas
+000355f0: 655f 7061 7261 6d73 2e73 616d 706c 655f  e_params.sample_
+00035600: 7175 6572 795d 203d 204e 6f6e 652c 0a20  query] = None,. 
+00035610: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
+00035620: 7a65 3a20 6968 735f 7061 7261 6d73 2e77  ze: ihs_params.w
+00035630: 696e 646f 775f 7369 7a65 203d 2069 6873  indow_size = ihs
+00035640: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
+00035650: 697a 655f 6465 6661 756c 742c 0a20 2020  ize_default,.   
+00035660: 2020 2020 2070 6572 6365 6e74 696c 6573       percentiles
+00035670: 3a20 6968 735f 7061 7261 6d73 2e70 6572  : ihs_params.per
+00035680: 6365 6e74 696c 6573 203d 2069 6873 5f70  centiles = ihs_p
+00035690: 6172 616d 732e 7065 7263 656e 7469 6c65  arams.percentile
+000356a0: 735f 6465 6661 756c 742c 0a20 2020 2020  s_default,.     
+000356b0: 2020 2073 7461 6e64 6172 6469 7a65 3a20     standardize: 
+000356c0: 6968 735f 7061 7261 6d73 2e73 7461 6e64  ihs_params.stand
+000356d0: 6172 6469 7a65 203d 2054 7275 652c 0a20  ardize = True,. 
+000356e0: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
+000356f0: 7a61 7469 6f6e 5f62 696e 733a 204f 7074  zation_bins: Opt
+00035700: 696f 6e61 6c5b 6968 735f 7061 7261 6d73  ional[ihs_params
+00035710: 2e73 7461 6e64 6172 6469 7a61 7469 6f6e  .standardization
+00035720: 5f62 696e 735d 203d 204e 6f6e 652c 0a20  _bins] = None,. 
+00035730: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
+00035740: 7a61 7469 6f6e 5f6e 5f62 696e 733a 2069  zation_n_bins: i
+00035750: 6873 5f70 6172 616d 732e 7374 616e 6461  hs_params.standa
+00035760: 7264 697a 6174 696f 6e5f 6e5f 6269 6e73  rdization_n_bins
+00035770: 203d 2069 6873 5f70 6172 616d 732e 7374   = ihs_params.st
+00035780: 616e 6461 7264 697a 6174 696f 6e5f 6e5f  andardization_n_
+00035790: 6269 6e73 5f64 6566 6175 6c74 2c0a 2020  bins_default,.  
+000357a0: 2020 2020 2020 7374 616e 6461 7264 697a        standardiz
+000357b0: 6174 696f 6e5f 6469 6167 6e6f 7374 6963  ation_diagnostic
+000357c0: 733a 2069 6873 5f70 6172 616d 732e 7374  s: ihs_params.st
+000357d0: 616e 6461 7264 697a 6174 696f 6e5f 6469  andardization_di
+000357e0: 6167 6e6f 7374 6963 7320 3d20 4661 6c73  agnostics = Fals
+000357f0: 652c 0a20 2020 2020 2020 2066 696c 7465  e,.        filte
+00035800: 725f 6d69 6e5f 6d61 663a 2069 6873 5f70  r_min_maf: ihs_p
+00035810: 6172 616d 732e 6669 6c74 6572 5f6d 696e  arams.filter_min
+00035820: 5f6d 6166 203d 2069 6873 5f70 6172 616d  _maf = ihs_param
+00035830: 732e 6669 6c74 6572 5f6d 696e 5f6d 6166  s.filter_min_maf
+00035840: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00035850: 2020 636f 6d70 7574 655f 6d69 6e5f 6d61    compute_min_ma
+00035860: 663a 2069 6873 5f70 6172 616d 732e 636f  f: ihs_params.co
+00035870: 6d70 7574 655f 6d69 6e5f 6d61 6620 3d20  mpute_min_maf = 
+00035880: 6968 735f 7061 7261 6d73 2e63 6f6d 7075  ihs_params.compu
+00035890: 7465 5f6d 696e 5f6d 6166 5f64 6566 6175  te_min_maf_defau
+000358a0: 6c74 2c0a 2020 2020 2020 2020 6d69 6e5f  lt,.        min_
+000358b0: 6568 683a 2069 6873 5f70 6172 616d 732e  ehh: ihs_params.
+000358c0: 6d69 6e5f 6568 6820 3d20 6968 735f 7061  min_ehh = ihs_pa
+000358d0: 7261 6d73 2e6d 696e 5f65 6868 5f64 6566  rams.min_ehh_def
+000358e0: 6175 6c74 2c0a 2020 2020 2020 2020 6d61  ault,.        ma
+000358f0: 785f 6761 703a 2069 6873 5f70 6172 616d  x_gap: ihs_param
+00035900: 732e 6d61 785f 6761 7020 3d20 6968 735f  s.max_gap = ihs_
+00035910: 7061 7261 6d73 2e6d 6178 5f67 6170 5f64  params.max_gap_d
+00035920: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+00035930: 6761 705f 7363 616c 653a 2069 6873 5f70  gap_scale: ihs_p
+00035940: 6172 616d 732e 6761 705f 7363 616c 6520  arams.gap_scale 
+00035950: 3d20 6968 735f 7061 7261 6d73 2e67 6170  = ihs_params.gap
+00035960: 5f73 6361 6c65 5f64 6566 6175 6c74 2c0a  _scale_default,.
+00035970: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+00035980: 6564 6765 733a 2069 6873 5f70 6172 616d  edges: ihs_param
+00035990: 732e 696e 636c 7564 655f 6564 6765 7320  s.include_edges 
+000359a0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+000359b0: 7573 655f 7468 7265 6164 733a 2069 6873  use_threads: ihs
+000359c0: 5f70 6172 616d 732e 7573 655f 7468 7265  _params.use_thre
+000359d0: 6164 7320 3d20 5472 7565 2c0a 2020 2020  ads = True,.    
+000359e0: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
+000359f0: 697a 653a 204f 7074 696f 6e61 6c5b 0a20  ize: Optional[. 
+00035a00: 2020 2020 2020 2020 2020 2062 6173 655f             base_
+00035a10: 7061 7261 6d73 2e6d 696e 5f63 6f68 6f72  params.min_cohor
+00035a20: 745f 7369 7a65 0a20 2020 2020 2020 205d  t_size.        ]
+00035a30: 203d 2069 6873 5f70 6172 616d 732e 6d69   = ihs_params.mi
+00035a40: 6e5f 636f 686f 7274 5f73 697a 655f 6465  n_cohort_size_de
+00035a50: 6661 756c 742c 0a20 2020 2020 2020 206d  fault,.        m
+00035a60: 6178 5f63 6f68 6f72 745f 7369 7a65 3a20  ax_cohort_size: 
+00035a70: 4f70 7469 6f6e 616c 5b0a 2020 2020 2020  Optional[.      
+00035a80: 2020 2020 2020 6261 7365 5f70 6172 616d        base_param
+00035a90: 732e 6d61 785f 636f 686f 7274 5f73 697a  s.max_cohort_siz
+00035aa0: 650a 2020 2020 2020 2020 5d20 3d20 6968  e.        ] = ih
+00035ab0: 735f 7061 7261 6d73 2e6d 6178 5f63 6f68  s_params.max_coh
+00035ac0: 6f72 745f 7369 7a65 5f64 6566 6175 6c74  ort_size_default
+00035ad0: 2c0a 2020 2020 2020 2020 7261 6e64 6f6d  ,.        random
+00035ae0: 5f73 6565 643a 2062 6173 655f 7061 7261  _seed: base_para
+00035af0: 6d73 2e72 616e 646f 6d5f 7365 6564 203d  ms.random_seed =
+00035b00: 2034 322c 0a20 2020 2020 2020 2070 616c   42,.        pal
+00035b10: 6574 7465 3a20 6968 735f 7061 7261 6d73  ette: ihs_params
+00035b20: 2e70 616c 6574 7465 203d 2069 6873 5f70  .palette = ihs_p
+00035b30: 6172 616d 732e 7061 6c65 7474 655f 6465  arams.palette_de
+00035b40: 6661 756c 742c 0a20 2020 2020 2020 2074  fault,.        t
+00035b50: 6974 6c65 3a20 4f70 7469 6f6e 616c 5b67  itle: Optional[g
+00035b60: 706c 745f 7061 7261 6d73 2e74 6974 6c65  plt_params.title
+00035b70: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00035b80: 2020 7369 7a69 6e67 5f6d 6f64 653a 2067    sizing_mode: g
+00035b90: 706c 745f 7061 7261 6d73 2e73 697a 696e  plt_params.sizin
+00035ba0: 675f 6d6f 6465 203d 2067 706c 745f 7061  g_mode = gplt_pa
+00035bb0: 7261 6d73 2e73 697a 696e 675f 6d6f 6465  rams.sizing_mode
+00035bc0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00035bd0: 2020 7769 6474 683a 2067 706c 745f 7061    width: gplt_pa
+00035be0: 7261 6d73 2e77 6964 7468 203d 2067 706c  rams.width = gpl
+00035bf0: 745f 7061 7261 6d73 2e77 6964 7468 5f64  t_params.width_d
+00035c00: 6566 6175 6c74 2c0a 2020 2020 2020 2020  efault,.        
+00035c10: 7472 6163 6b5f 6865 6967 6874 3a20 6770  track_height: gp
+00035c20: 6c74 5f70 6172 616d 732e 7472 6163 6b5f  lt_params.track_
+00035c30: 6865 6967 6874 203d 2031 3730 2c0a 2020  height = 170,.  
+00035c40: 2020 2020 2020 6765 6e65 735f 6865 6967        genes_heig
+00035c50: 6874 3a20 6770 6c74 5f70 6172 616d 732e  ht: gplt_params.
+00035c60: 6765 6e65 735f 6865 6967 6874 203d 2067  genes_height = g
+00035c70: 706c 745f 7061 7261 6d73 2e67 656e 6573  plt_params.genes
+00035c80: 5f68 6569 6768 745f 6465 6661 756c 742c  _height_default,
+00035c90: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00035ca0: 2020 2020 2020 2020 2320 6777 7373 2074          # gwss t
+00035cb0: 7261 636b 0a20 2020 2020 2020 2066 6967  rack.        fig
+00035cc0: 3120 3d20 7365 6c66 2e70 6c6f 745f 6968  1 = self.plot_ih
+00035cd0: 735f 6777 7373 5f74 7261 636b 280a 2020  s_gwss_track(.  
+00035ce0: 2020 2020 2020 2020 2020 636f 6e74 6967            contig
+00035cf0: 3d63 6f6e 7469 672c 0a20 2020 2020 2020  =contig,.       
+00035d00: 2020 2020 2061 6e61 6c79 7369 733d 616e       analysis=an
+00035d10: 616c 7973 6973 2c0a 2020 2020 2020 2020  alysis,.        
+00035d20: 2020 2020 7361 6d70 6c65 5f73 6574 733d      sample_sets=
+00035d30: 7361 6d70 6c65 5f73 6574 732c 0a20 2020  sample_sets,.   
+00035d40: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
+00035d50: 7175 6572 793d 7361 6d70 6c65 5f71 7565  query=sample_que
+00035d60: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+00035d70: 7769 6e64 6f77 5f73 697a 653d 7769 6e64  window_size=wind
+00035d80: 6f77 5f73 697a 652c 0a20 2020 2020 2020  ow_size,.       
+00035d90: 2020 2020 2070 6572 6365 6e74 696c 6573       percentiles
+00035da0: 3d70 6572 6365 6e74 696c 6573 2c0a 2020  =percentiles,.  
+00035db0: 2020 2020 2020 2020 2020 7061 6c65 7474            palett
+00035dc0: 653d 7061 6c65 7474 652c 0a20 2020 2020  e=palette,.     
+00035dd0: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
+00035de0: 7a65 3d73 7461 6e64 6172 6469 7a65 2c0a  ze=standardize,.
+00035df0: 2020 2020 2020 2020 2020 2020 7374 616e              stan
+00035e00: 6461 7264 697a 6174 696f 6e5f 6269 6e73  dardization_bins
+00035e10: 3d73 7461 6e64 6172 6469 7a61 7469 6f6e  =standardization
+00035e20: 5f62 696e 732c 0a20 2020 2020 2020 2020  _bins,.         
+00035e30: 2020 2073 7461 6e64 6172 6469 7a61 7469     standardizati
+00035e40: 6f6e 5f6e 5f62 696e 733d 7374 616e 6461  on_n_bins=standa
+00035e50: 7264 697a 6174 696f 6e5f 6e5f 6269 6e73  rdization_n_bins
+00035e60: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+00035e70: 616e 6461 7264 697a 6174 696f 6e5f 6469  andardization_di
+00035e80: 6167 6e6f 7374 6963 733d 7374 616e 6461  agnostics=standa
+00035e90: 7264 697a 6174 696f 6e5f 6469 6167 6e6f  rdization_diagno
+00035ea0: 7374 6963 732c 0a20 2020 2020 2020 2020  stics,.         
+00035eb0: 2020 2066 696c 7465 725f 6d69 6e5f 6d61     filter_min_ma
+00035ec0: 663d 6669 6c74 6572 5f6d 696e 5f6d 6166  f=filter_min_maf
+00035ed0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00035ee0: 6d70 7574 655f 6d69 6e5f 6d61 663d 636f  mpute_min_maf=co
+00035ef0: 6d70 7574 655f 6d69 6e5f 6d61 662c 0a20  mpute_min_maf,. 
+00035f00: 2020 2020 2020 2020 2020 206d 696e 5f65             min_e
+00035f10: 6868 3d6d 696e 5f65 6868 2c0a 2020 2020  hh=min_ehh,.    
+00035f20: 2020 2020 2020 2020 6d61 785f 6761 703d          max_gap=
+00035f30: 6d61 785f 6761 702c 0a20 2020 2020 2020  max_gap,.       
+00035f40: 2020 2020 2067 6170 5f73 6361 6c65 3d67       gap_scale=g
+00035f50: 6170 5f73 6361 6c65 2c0a 2020 2020 2020  ap_scale,.      
+00035f60: 2020 2020 2020 696e 636c 7564 655f 6564        include_ed
+00035f70: 6765 733d 696e 636c 7564 655f 6564 6765  ges=include_edge
+00035f80: 732c 0a20 2020 2020 2020 2020 2020 2075  s,.            u
+00035f90: 7365 5f74 6872 6561 6473 3d75 7365 5f74  se_threads=use_t
+00035fa0: 6872 6561 6473 2c0a 2020 2020 2020 2020  hreads,.        
+00035fb0: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
+00035fc0: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
+00035fd0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+00035fe0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
+00035ff0: 3d6d 6178 5f63 6f68 6f72 745f 7369 7a65  =max_cohort_size
+00036000: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
+00036010: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
+00036020: 5f73 6565 642c 0a20 2020 2020 2020 2020  _seed,.         
+00036030: 2020 2074 6974 6c65 3d74 6974 6c65 2c0a     title=title,.
+00036040: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
+00036050: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
+00036060: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
+00036070: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
+00036080: 2020 2020 2020 2020 2020 6865 6967 6874            height
+00036090: 3d74 7261 636b 5f68 6569 6768 742c 0a20  =track_height,. 
+000360a0: 2020 2020 2020 2020 2020 2073 686f 773d             show=
+000360b0: 4661 6c73 652c 0a20 2020 2020 2020 2029  False,.        )
+000360c0: 0a0a 2020 2020 2020 2020 6669 6731 2e78  ..        fig1.x
+000360d0: 6178 6973 2e76 6973 6962 6c65 203d 2046  axis.visible = F
+000360e0: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
+000360f0: 706c 6f74 2067 656e 6573 0a20 2020 2020  plot genes.     
+00036100: 2020 2066 6967 3220 3d20 7365 6c66 2e70     fig2 = self.p
+00036110: 6c6f 745f 6765 6e65 7328 0a20 2020 2020  lot_genes(.     
+00036120: 2020 2020 2020 2072 6567 696f 6e3d 636f         region=co
+00036130: 6e74 6967 2c0a 2020 2020 2020 2020 2020  ntig,.          
+00036140: 2020 7369 7a69 6e67 5f6d 6f64 653d 7369    sizing_mode=si
+00036150: 7a69 6e67 5f6d 6f64 652c 0a20 2020 2020  zing_mode,.     
+00036160: 2020 2020 2020 2077 6964 7468 3d77 6964         width=wid
+00036170: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00036180: 6865 6967 6874 3d67 656e 6573 5f68 6569  height=genes_hei
+00036190: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
+000361a0: 2078 5f72 616e 6765 3d66 6967 312e 785f   x_range=fig1.x_
+000361b0: 7261 6e67 652c 0a20 2020 2020 2020 2020  range,.         
+000361c0: 2020 2073 686f 773d 4661 6c73 652c 0a20     show=False,. 
+000361d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+000361e0: 2020 2320 636f 6d62 696e 6520 706c 6f74    # combine plot
+000361f0: 7320 696e 746f 2061 2073 696e 676c 6520  s into a single 
+00036200: 6669 6775 7265 0a20 2020 2020 2020 2066  figure.        f
+00036210: 6967 203d 2062 6f6b 6568 2e6c 6179 6f75  ig = bokeh.layou
+00036220: 7473 2e67 7269 6470 6c6f 7428 0a20 2020  ts.gridplot(.   
+00036230: 2020 2020 2020 2020 205b 6669 6731 2c20           [fig1, 
+00036240: 6669 6732 5d2c 0a20 2020 2020 2020 2020  fig2],.         
+00036250: 2020 206e 636f 6c73 3d31 2c0a 2020 2020     ncols=1,.    
+00036260: 2020 2020 2020 2020 746f 6f6c 6261 725f          toolbar_
+00036270: 6c6f 6361 7469 6f6e 3d22 6162 6f76 6522  location="above"
+00036280: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+00036290: 7267 655f 746f 6f6c 733d 5472 7565 2c0a  rge_tools=True,.
+000362a0: 2020 2020 2020 2020 2020 2020 7369 7a69              sizi
+000362b0: 6e67 5f6d 6f64 653d 7369 7a69 6e67 5f6d  ng_mode=sizing_m
+000362c0: 6f64 652c 0a20 2020 2020 2020 2029 0a0a  ode,.        )..
+000362d0: 2020 2020 2020 2020 626f 6b65 682e 706c          bokeh.pl
+000362e0: 6f74 7469 6e67 2e73 686f 7728 6669 6729  otting.show(fig)
+000362f0: 0a0a 2020 2020 6465 6620 5f67 6172 7564  ..    def _garud
+00036300: 5f67 3132 3328 7365 6c66 2c20 6774 293a  _g123(self, gt):
+00036310: 0a20 2020 2020 2020 2022 2222 436f 6d70  .        """Comp
+00036320: 7574 6520 4761 7275 6427 7320 4731 3233  ute Garud's G123
+00036330: 2e22 2222 0a0a 2020 2020 2020 2020 2320  ."""..        # 
+00036340: 636f 6d70 7574 6520 6469 706c 6f74 7970  compute diplotyp
+00036350: 6520 6672 6571 7565 6e63 6965 730a 2020  e frequencies.  
+00036360: 2020 2020 2020 6672 715f 636f 756e 7465        frq_counte
+00036370: 7220 3d20 5f64 6970 6c6f 7479 7065 5f66  r = _diplotype_f
+00036380: 7265 7175 656e 6369 6573 2867 7429 0a0a  requencies(gt)..
+00036390: 2020 2020 2020 2020 2320 636f 6e76 6572          # conver
+000363a0: 7420 746f 2061 7272 6179 206f 6620 736f  t to array of so
+000363b0: 7274 6564 2066 7265 7175 656e 6369 6573  rted frequencies
+000363c0: 0a20 2020 2020 2020 2066 203d 206e 702e  .        f = np.
+000363d0: 736f 7274 286e 702e 6672 6f6d 6974 6572  sort(np.fromiter
+000363e0: 2866 7271 5f63 6f75 6e74 6572 2e76 616c  (frq_counter.val
+000363f0: 7565 7328 292c 2064 7479 7065 3d66 6c6f  ues(), dtype=flo
+00036400: 6174 2929 5b3a 3a2d 315d 0a0a 2020 2020  at))[::-1]..    
+00036410: 2020 2020 2320 636f 6d70 7574 6520 4731      # compute G1
+00036420: 3233 0a20 2020 2020 2020 2067 3132 3320  23.        g123 
+00036430: 3d20 6e70 2e73 756d 2866 5b3a 335d 2920  = np.sum(f[:3]) 
+00036440: 2a2a 2032 202b 206e 702e 7375 6d28 665b  ** 2 + np.sum(f[
+00036450: 333a 5d20 2a2a 2032 290a 0a20 2020 2020  3:] ** 2)..     
+00036460: 2020 2023 2054 6865 7365 206f 7468 6572     # These other
+00036470: 2073 7461 7469 7374 6963 7320 6172 6520   statistics are 
+00036480: 6e6f 7420 6375 7272 656e 746c 7920 6e65  not currently ne
+00036490: 6564 6564 2c20 6275 7420 6c65 6176 696e  eded, but leavin
+000364a0: 6720 6865 7265 0a20 2020 2020 2020 2023  g here.        #
+000364b0: 2063 6f6d 6d65 6e74 6564 206f 7574 2066   commented out f
+000364c0: 6f72 2066 7574 7572 6520 7265 6665 7265  or future refere
+000364d0: 6e63 652e 2e2e 0a0a 2020 2020 2020 2020  nce.....        
+000364e0: 2320 636f 6d70 7574 6520 4731 0a20 2020  # compute G1.   
+000364f0: 2020 2020 2023 2067 3120 3d20 6e70 2e73       # g1 = np.s
+00036500: 756d 2866 2a2a 3229 0a0a 2020 2020 2020  um(f**2)..      
+00036510: 2020 2320 636f 6d70 7574 6520 4731 320a    # compute G12.
+00036520: 2020 2020 2020 2020 2320 6731 3220 3d20          # g12 = 
+00036530: 6e70 2e73 756d 2866 5b3a 325d 2920 2a2a  np.sum(f[:2]) **
+00036540: 2032 202b 206e 702e 7375 6d28 665b 323a   2 + np.sum(f[2:
+00036550: 5d20 2a2a 2032 2920 2023 2074 7970 653a  ] ** 2)  # type:
+00036560: 2069 676e 6f72 655b 696e 6465 785d 0a0a   ignore[index]..
+00036570: 2020 2020 2020 2020 2320 636f 6d70 7574          # comput
+00036580: 6520 4732 2f47 310a 2020 2020 2020 2020  e G2/G1.        
+00036590: 2320 6732 203d 2067 3120 2d20 665b 305d  # g2 = g1 - f[0]
+000365a0: 202a 2a20 3220 2023 2074 7970 653a 2069   ** 2  # type: i
+000365b0: 676e 6f72 655b 696e 6465 785d 0a20 2020  gnore[index].   
+000365c0: 2020 2020 2023 2067 325f 6731 203d 2067       # g2_g1 = g
+000365d0: 3220 2f20 6731 0a0a 2020 2020 2020 2020  2 / g1..        
+000365e0: 7265 7475 726e 2067 3132 330a 0a20 2020  return g123..   
+000365f0: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
+00036600: 756d 6d61 7279 3d22 5275 6e20 6120 4731  ummary="Run a G1
+00036610: 3233 2067 656e 6f6d 652d 7769 6465 2073  23 genome-wide s
+00036620: 656c 6563 7469 6f6e 2073 6361 6e2e 222c  election scan.",
+00036630: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
+00036640: 3d64 6963 7428 0a20 2020 2020 2020 2020  =dict(.         
+00036650: 2020 2078 3d22 416e 2061 7272 6179 2063     x="An array c
+00036660: 6f6e 7461 696e 696e 6720 7468 6520 7769  ontaining the wi
+00036670: 6e64 6f77 2063 656e 7472 6520 706f 696e  ndow centre poin
+00036680: 7420 6765 6e6f 6d69 6320 706f 7369 7469  t genomic positi
+00036690: 6f6e 732e 222c 0a20 2020 2020 2020 2020  ons.",.         
+000366a0: 2020 2067 3132 333d 2241 6e20 6172 7261     g123="An arra
+000366b0: 7920 7769 7468 2047 3132 3320 7374 6174  y with G123 stat
+000366c0: 6973 7469 6320 7661 6c75 6573 2066 6f72  istic values for
+000366d0: 2065 6163 6820 7769 6e64 6f77 2e22 2c0a   each window.",.
+000366e0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+000366f0: 0a20 2020 2064 6566 2067 3132 335f 6777  .    def g123_gw
+00036700: 7373 280a 2020 2020 2020 2020 7365 6c66  ss(.        self
+00036710: 2c0a 2020 2020 2020 2020 636f 6e74 6967  ,.        contig
+00036720: 3a20 6261 7365 5f70 6172 616d 732e 636f  : base_params.co
+00036730: 6e74 6967 2c0a 2020 2020 2020 2020 7769  ntig,.        wi
+00036740: 6e64 6f77 5f73 697a 653a 2067 3132 335f  ndow_size: g123_
+00036750: 7061 7261 6d73 2e77 696e 646f 775f 7369  params.window_si
+00036760: 7a65 2c0a 2020 2020 2020 2020 7369 7465  ze,.        site
+00036770: 733a 2067 3132 335f 7061 7261 6d73 2e73  s: g123_params.s
+00036780: 6974 6573 203d 2044 4546 4155 4c54 2c0a  ites = DEFAULT,.
+00036790: 2020 2020 2020 2020 7369 7465 5f6d 6173          site_mas
+000367a0: 6b3a 2062 6173 655f 7061 7261 6d73 2e73  k: base_params.s
+000367b0: 6974 655f 6d61 736b 203d 2044 4546 4155  ite_mask = DEFAU
+000367c0: 4c54 2c0a 2020 2020 2020 2020 7361 6d70  LT,.        samp
+000367d0: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
+000367e0: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+000367f0: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
+00036800: 652c 0a20 2020 2020 2020 2073 616d 706c  e,.        sampl
+00036810: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
+00036820: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+00036830: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
+00036840: 6e65 2c0a 2020 2020 2020 2020 6d69 6e5f  ne,.        min_
+00036850: 636f 686f 7274 5f73 697a 653a 204f 7074  cohort_size: Opt
+00036860: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
+00036870: 2020 2062 6173 655f 7061 7261 6d73 2e6d     base_params.m
+00036880: 696e 5f63 6f68 6f72 745f 7369 7a65 0a20  in_cohort_size. 
+00036890: 2020 2020 2020 205d 203d 2067 3132 335f         ] = g123_
+000368a0: 7061 7261 6d73 2e6d 696e 5f63 6f68 6f72  params.min_cohor
+000368b0: 745f 7369 7a65 5f64 6566 6175 6c74 2c0a  t_size_default,.
+000368c0: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
+000368d0: 7274 5f73 697a 653a 204f 7074 696f 6e61  rt_size: Optiona
+000368e0: 6c5b 0a20 2020 2020 2020 2020 2020 2062  l[.            b
+000368f0: 6173 655f 7061 7261 6d73 2e6d 6178 5f63  ase_params.max_c
+00036900: 6f68 6f72 745f 7369 7a65 0a20 2020 2020  ohort_size.     
+00036910: 2020 205d 203d 2067 3132 335f 7061 7261     ] = g123_para
+00036920: 6d73 2e6d 6178 5f63 6f68 6f72 745f 7369  ms.max_cohort_si
+00036930: 7a65 5f64 6566 6175 6c74 2c0a 2020 2020  ze_default,.    
+00036940: 2020 2020 7261 6e64 6f6d 5f73 6565 643a      random_seed:
+00036950: 2062 6173 655f 7061 7261 6d73 2e72 616e   base_params.ran
+00036960: 646f 6d5f 7365 6564 203d 2034 322c 0a20  dom_seed = 42,. 
+00036970: 2020 2029 202d 3e20 5475 706c 655b 6e70     ) -> Tuple[np
+00036980: 2e6e 6461 7272 6179 2c20 6e70 2e6e 6461  .ndarray, np.nda
+00036990: 7272 6179 5d3a 0a20 2020 2020 2020 2023  rray]:.        #
+000369a0: 2063 6861 6e67 6520 7468 6973 206e 616d   change this nam
+000369b0: 6520 6966 2079 6f75 2065 7665 7220 6368  e if you ever ch
+000369c0: 616e 6765 2074 6865 2062 6568 6176 696f  ange the behavio
+000369d0: 7572 206f 6620 7468 6973 2066 756e 6374  ur of this funct
+000369e0: 696f 6e2c 2074 6f0a 2020 2020 2020 2020  ion, to.        
+000369f0: 2320 696e 7661 6c69 6461 7465 2061 6e79  # invalidate any
+00036a00: 2070 7265 7669 6f75 736c 7920 6361 6368   previously cach
+00036a10: 6564 2064 6174 610a 2020 2020 2020 2020  ed data.        
+00036a20: 6e61 6d65 203d 2073 656c 662e 5f67 3132  name = self._g12
+00036a30: 335f 6777 7373 5f63 6163 6865 5f6e 616d  3_gwss_cache_nam
+00036a40: 650a 0a20 2020 2020 2020 2069 6620 7369  e..        if si
+00036a50: 7465 7320 3d3d 2044 4546 4155 4c54 3a0a  tes == DEFAULT:.
+00036a60: 2020 2020 2020 2020 2020 2020 7369 7465              site
+00036a70: 7320 3d20 7365 6c66 2e5f 6465 6661 756c  s = self._defaul
+00036a80: 745f 7068 6173 696e 675f 616e 616c 7973  t_phasing_analys
+00036a90: 6973 0a20 2020 2020 2020 2076 616c 6964  is.        valid
+00036aa0: 5f73 6974 6573 203d 2073 656c 662e 7068  _sites = self.ph
+00036ab0: 6173 696e 675f 616e 616c 7973 6973 5f69  asing_analysis_i
+00036ac0: 6473 202b 2028 2261 6c6c 222c 2022 7365  ds + ("all", "se
+00036ad0: 6772 6567 6174 696e 6722 290a 2020 2020  gregating").    
+00036ae0: 2020 2020 6966 2073 6974 6573 206e 6f74      if sites not
+00036af0: 2069 6e20 7661 6c69 645f 7369 7465 733a   in valid_sites:
+00036b00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00036b10: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00036b20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00036b30: 2249 6e76 616c 6964 2076 616c 7565 2066  "Invalid value f
+00036b40: 6f72 2060 7369 7465 7360 2070 6172 616d  or `sites` param
+00036b50: 6574 6572 2c20 6d75 7374 2062 6520 6f6e  eter, must be on
+00036b60: 6520 6f66 207b 7661 6c69 645f 7369 7465  e of {valid_site
+00036b70: 737d 2e22 0a20 2020 2020 2020 2020 2020  s}.".           
+00036b80: 2029 0a0a 2020 2020 2020 2020 7061 7261   )..        para
+00036b90: 6d73 203d 2064 6963 7428 0a20 2020 2020  ms = dict(.     
+00036ba0: 2020 2020 2020 2063 6f6e 7469 673d 636f         contig=co
+00036bb0: 6e74 6967 2c0a 2020 2020 2020 2020 2020  ntig,.          
+00036bc0: 2020 7369 7465 733d 7369 7465 732c 0a20    sites=sites,. 
+00036bd0: 2020 2020 2020 2020 2020 2073 6974 655f             site_
+00036be0: 6d61 736b 3d73 6974 655f 6d61 736b 2c0a  mask=site_mask,.
+00036bf0: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
+00036c00: 6f77 5f73 697a 653d 7769 6e64 6f77 5f73  ow_size=window_s
+00036c10: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+00036c20: 2073 616d 706c 655f 7365 7473 3d73 656c   sample_sets=sel
+00036c30: 662e 5f70 7265 705f 7361 6d70 6c65 5f73  f._prep_sample_s
+00036c40: 6574 735f 7061 7261 6d28 7361 6d70 6c65  ets_param(sample
+00036c50: 5f73 6574 733d 7361 6d70 6c65 5f73 6574  _sets=sample_set
+00036c60: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+00036c70: 2320 4e2e 422e 2c20 646f 206e 6f74 2062  # N.B., do not b
+00036c80: 6520 7465 6d70 7465 6420 746f 2063 6f6e  e tempted to con
+00036c90: 7665 7274 2074 6869 7320 7361 6d70 6c65  vert this sample
+00036ca0: 2071 7565 7279 2069 6e74 6f20 696e 7465   query into inte
+00036cb0: 6765 720a 2020 2020 2020 2020 2020 2020  ger.            
+00036cc0: 2320 696e 6469 6365 7320 7573 696e 6720  # indices using 
+00036cd0: 5f70 7265 705f 7361 6d70 6c65 5f73 656c  _prep_sample_sel
+00036ce0: 6563 7469 6f6e 5f70 6172 616d 732c 2062  ection_params, b
+00036cf0: 6563 6175 7365 2074 6865 2069 6e64 6963  ecause the indic
+00036d00: 6573 0a20 2020 2020 2020 2020 2020 2023  es.            #
+00036d10: 2061 7265 2064 6966 6665 7265 6e74 2069   are different i
+00036d20: 6e20 7468 6520 6861 706c 6f74 7970 6520  n the haplotype 
+00036d30: 6461 7461 2e0a 2020 2020 2020 2020 2020  data..          
+00036d40: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
+00036d50: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+00036d60: 2020 2020 2020 2020 206d 696e 5f63 6f68           min_coh
+00036d70: 6f72 745f 7369 7a65 3d6d 696e 5f63 6f68  ort_size=min_coh
+00036d80: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
+00036d90: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
+00036da0: 5f73 697a 653d 6d61 785f 636f 686f 7274  _size=max_cohort
+00036db0: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+00036dc0: 2020 2072 616e 646f 6d5f 7365 6564 3d72     random_seed=r
+00036dd0: 616e 646f 6d5f 7365 6564 2c0a 2020 2020  andom_seed,.    
+00036de0: 2020 2020 290a 0a20 2020 2020 2020 2074      )..        t
+00036df0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00036e00: 7265 7375 6c74 7320 3d20 7365 6c66 2e72  results = self.r
+00036e10: 6573 756c 7473 5f63 6163 6865 5f67 6574  esults_cache_get
+00036e20: 286e 616d 653d 6e61 6d65 2c20 7061 7261  (name=name, para
+00036e30: 6d73 3d70 6172 616d 7329 0a0a 2020 2020  ms=params)..    
+00036e40: 2020 2020 6578 6365 7074 2043 6163 6865      except Cache
+00036e50: 4d69 7373 3a0a 2020 2020 2020 2020 2020  Miss:.          
+00036e60: 2020 7265 7375 6c74 7320 3d20 7365 6c66    results = self
+00036e70: 2e5f 6731 3233 5f67 7773 7328 2a2a 7061  ._g123_gwss(**pa
+00036e80: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+00036e90: 2020 7365 6c66 2e72 6573 756c 7473 5f63    self.results_c
+00036ea0: 6163 6865 5f73 6574 286e 616d 653d 6e61  ache_set(name=na
+00036eb0: 6d65 2c20 7061 7261 6d73 3d70 6172 616d  me, params=param
+00036ec0: 732c 2072 6573 756c 7473 3d72 6573 756c  s, results=resul
+00036ed0: 7473 290a 0a20 2020 2020 2020 2078 203d  ts)..        x =
+00036ee0: 2072 6573 756c 7473 5b22 7822 5d0a 2020   results["x"].  
+00036ef0: 2020 2020 2020 6731 3233 203d 2072 6573        g123 = res
+00036f00: 756c 7473 5b22 6731 3233 225d 0a0a 2020  ults["g123"]..  
+00036f10: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
+00036f20: 6731 3233 0a0a 2020 2020 6465 6620 5f67  g123..    def _g
+00036f30: 3132 335f 6777 7373 280a 2020 2020 2020  123_gwss(.      
+00036f40: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00036f50: 2a2c 0a20 2020 2020 2020 2063 6f6e 7469  *,.        conti
+00036f60: 672c 0a20 2020 2020 2020 2073 6974 6573  g,.        sites
+00036f70: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
+00036f80: 6173 6b2c 0a20 2020 2020 2020 2077 696e  ask,.        win
+00036f90: 646f 775f 7369 7a65 2c0a 2020 2020 2020  dow_size,.      
+00036fa0: 2020 7361 6d70 6c65 5f73 6574 732c 0a20    sample_sets,. 
+00036fb0: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
+00036fc0: 6572 792c 0a20 2020 2020 2020 206d 696e  ery,.        min
+00036fd0: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
+00036fe0: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
+00036ff0: 5f73 697a 652c 0a20 2020 2020 2020 2072  _size,.        r
+00037000: 616e 646f 6d5f 7365 6564 2c0a 2020 2020  andom_seed,.    
+00037010: 293a 0a20 2020 2020 2020 2067 742c 2070  ):.        gt, p
+00037020: 6f73 203d 2073 656c 662e 5f6c 6f61 645f  os = self._load_
+00037030: 6461 7461 5f66 6f72 5f67 3132 3328 0a20  data_for_g123(. 
+00037040: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00037050: 673d 636f 6e74 6967 2c0a 2020 2020 2020  g=contig,.      
+00037060: 2020 2020 2020 7369 7465 733d 7369 7465        sites=site
+00037070: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
+00037080: 6974 655f 6d61 736b 3d73 6974 655f 6d61  ite_mask=site_ma
+00037090: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
+000370a0: 7361 6d70 6c65 5f73 6574 733d 7361 6d70  sample_sets=samp
+000370b0: 6c65 5f73 6574 732c 0a20 2020 2020 2020  le_sets,.       
+000370c0: 2020 2020 2073 616d 706c 655f 7175 6572       sample_quer
+000370d0: 793d 7361 6d70 6c65 5f71 7565 7279 2c0a  y=sample_query,.
+000370e0: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+000370f0: 636f 686f 7274 5f73 697a 653d 6d69 6e5f  cohort_size=min_
+00037100: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00037110: 2020 2020 2020 2020 206d 6178 5f63 6f68           max_coh
+00037120: 6f72 745f 7369 7a65 3d6d 6178 5f63 6f68  ort_size=max_coh
+00037130: 6f72 745f 7369 7a65 2c0a 2020 2020 2020  ort_size,.      
+00037140: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+00037150: 643d 7261 6e64 6f6d 5f73 6565 642c 0a20  d=random_seed,. 
+00037160: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00037170: 2020 6731 3233 203d 2061 6c6c 656c 2e6d    g123 = allel.m
+00037180: 6f76 696e 675f 7374 6174 6973 7469 6328  oving_statistic(
+00037190: 6774 2c20 7374 6174 6973 7469 633d 7365  gt, statistic=se
+000371a0: 6c66 2e5f 6761 7275 645f 6731 3233 2c20  lf._garud_g123, 
+000371b0: 7369 7a65 3d77 696e 646f 775f 7369 7a65  size=window_size
+000371c0: 290a 2020 2020 2020 2020 7820 3d20 616c  ).        x = al
+000371d0: 6c65 6c2e 6d6f 7669 6e67 5f73 7461 7469  lel.moving_stati
+000371e0: 7374 6963 2870 6f73 2c20 7374 6174 6973  stic(pos, statis
+000371f0: 7469 633d 6e70 2e6d 6561 6e2c 2073 697a  tic=np.mean, siz
+00037200: 653d 7769 6e64 6f77 5f73 697a 6529 0a0a  e=window_size)..
+00037210: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
+00037220: 3d20 6469 6374 2878 3d78 2c20 6731 3233  = dict(x=x, g123
+00037230: 3d67 3132 3329 0a0a 2020 2020 2020 2020  =g123)..        
+00037240: 7265 7475 726e 2072 6573 756c 7473 0a0a  return results..
+00037250: 2020 2020 4064 6f63 280a 2020 2020 2020      @doc(.      
+00037260: 2020 7375 6d6d 6172 793d 2250 6c6f 7420    summary="Plot 
+00037270: 4731 3233 2047 5753 5320 6461 7461 2e22  G123 GWSS data."
+00037280: 2c0a 2020 2020 290a 2020 2020 6465 6620  ,.    ).    def 
+00037290: 706c 6f74 5f67 3132 335f 6777 7373 5f74  plot_g123_gwss_t
+000372a0: 7261 636b 280a 2020 2020 2020 2020 7365  rack(.        se
+000372b0: 6c66 2c0a 2020 2020 2020 2020 636f 6e74  lf,.        cont
+000372c0: 6967 3a20 6261 7365 5f70 6172 616d 732e  ig: base_params.
+000372d0: 636f 6e74 6967 2c0a 2020 2020 2020 2020  contig,.        
+000372e0: 7769 6e64 6f77 5f73 697a 653a 2067 3132  window_size: g12
+000372f0: 335f 7061 7261 6d73 2e77 696e 646f 775f  3_params.window_
+00037300: 7369 7a65 2c0a 2020 2020 2020 2020 7369  size,.        si
+00037310: 7465 733a 2067 3132 335f 7061 7261 6d73  tes: g123_params
+00037320: 2e73 6974 6573 203d 2044 4546 4155 4c54  .sites = DEFAULT
+00037330: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
+00037340: 6173 6b3a 2062 6173 655f 7061 7261 6d73  ask: base_params
+00037350: 2e73 6974 655f 6d61 736b 203d 2044 4546  .site_mask = DEF
+00037360: 4155 4c54 2c0a 2020 2020 2020 2020 7361  AULT,.        sa
+00037370: 6d70 6c65 5f73 6574 733a 204f 7074 696f  mple_sets: Optio
+00037380: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
+00037390: 7361 6d70 6c65 5f73 6574 735d 203d 204e  sample_sets] = N
+000373a0: 6f6e 652c 0a20 2020 2020 2020 2073 616d  one,.        sam
+000373b0: 706c 655f 7175 6572 793a 204f 7074 696f  ple_query: Optio
+000373c0: 6e61 6c5b 6261 7365 5f70 6172 616d 732e  nal[base_params.
+000373d0: 7361 6d70 6c65 5f71 7565 7279 5d20 3d20  sample_query] = 
+000373e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d69  None,.        mi
+000373f0: 6e5f 636f 686f 7274 5f73 697a 653a 204f  n_cohort_size: O
+00037400: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+00037410: 2020 2020 2062 6173 655f 7061 7261 6d73       base_params
+00037420: 2e6d 696e 5f63 6f68 6f72 745f 7369 7a65  .min_cohort_size
+00037430: 0a20 2020 2020 2020 205d 203d 2067 3132  .        ] = g12
+00037440: 335f 7061 7261 6d73 2e6d 696e 5f63 6f68  3_params.min_coh
+00037450: 6f72 745f 7369 7a65 5f64 6566 6175 6c74  ort_size_default
+00037460: 2c0a 2020 2020 2020 2020 6d61 785f 636f  ,.        max_co
+00037470: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
+00037480: 6e61 6c5b 0a20 2020 2020 2020 2020 2020  nal[.           
+00037490: 2062 6173 655f 7061 7261 6d73 2e6d 6178   base_params.max
+000374a0: 5f63 6f68 6f72 745f 7369 7a65 0a20 2020  _cohort_size.   
+000374b0: 2020 2020 205d 203d 2067 3132 335f 7061       ] = g123_pa
+000374c0: 7261 6d73 2e6d 6178 5f63 6f68 6f72 745f  rams.max_cohort_
+000374d0: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
+000374e0: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+000374f0: 643a 2062 6173 655f 7061 7261 6d73 2e72  d: base_params.r
+00037500: 616e 646f 6d5f 7365 6564 203d 2034 322c  andom_seed = 42,
+00037510: 0a20 2020 2020 2020 2074 6974 6c65 3a20  .        title: 
+00037520: 4f70 7469 6f6e 616c 5b67 706c 745f 7061  Optional[gplt_pa
+00037530: 7261 6d73 2e74 6974 6c65 5d20 3d20 4e6f  rams.title] = No
+00037540: 6e65 2c0a 2020 2020 2020 2020 7369 7a69  ne,.        sizi
+00037550: 6e67 5f6d 6f64 653a 2067 706c 745f 7061  ng_mode: gplt_pa
+00037560: 7261 6d73 2e73 697a 696e 675f 6d6f 6465  rams.sizing_mode
+00037570: 203d 2067 706c 745f 7061 7261 6d73 2e73   = gplt_params.s
+00037580: 697a 696e 675f 6d6f 6465 5f64 6566 6175  izing_mode_defau
+00037590: 6c74 2c0a 2020 2020 2020 2020 7769 6474  lt,.        widt
+000375a0: 683a 2067 706c 745f 7061 7261 6d73 2e77  h: gplt_params.w
+000375b0: 6964 7468 203d 2067 706c 745f 7061 7261  idth = gplt_para
+000375c0: 6d73 2e77 6964 7468 5f64 6566 6175 6c74  ms.width_default
+000375d0: 2c0a 2020 2020 2020 2020 6865 6967 6874  ,.        height
+000375e0: 3a20 6770 6c74 5f70 6172 616d 732e 6865  : gplt_params.he
+000375f0: 6967 6874 203d 2032 3030 2c0a 2020 2020  ight = 200,.    
+00037600: 2020 2020 7368 6f77 3a20 6770 6c74 5f70      show: gplt_p
+00037610: 6172 616d 732e 7368 6f77 203d 2054 7275  arams.show = Tru
+00037620: 652c 0a20 2020 2020 2020 2078 5f72 616e  e,.        x_ran
+00037630: 6765 3a20 4f70 7469 6f6e 616c 5b67 706c  ge: Optional[gpl
+00037640: 745f 7061 7261 6d73 2e78 5f72 616e 6765  t_params.x_range
+00037650: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
+00037660: 2d3e 2067 706c 745f 7061 7261 6d73 2e66  -> gplt_params.f
+00037670: 6967 7572 653a 0a20 2020 2020 2020 2023  igure:.        #
+00037680: 2063 6f6d 7075 7465 2047 3132 330a 2020   compute G123.  
+00037690: 2020 2020 2020 782c 2067 3132 3320 3d20        x, g123 = 
+000376a0: 7365 6c66 2e67 3132 335f 6777 7373 280a  self.g123_gwss(.
+000376b0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000376c0: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
+000376d0: 2020 2020 2020 2073 6974 6573 3d73 6974         sites=sit
+000376e0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+000376f0: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
+00037700: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
+00037710: 2077 696e 646f 775f 7369 7a65 3d77 696e   window_size=win
+00037720: 646f 775f 7369 7a65 2c0a 2020 2020 2020  dow_size,.      
+00037730: 2020 2020 2020 6d69 6e5f 636f 686f 7274        min_cohort
+00037740: 5f73 697a 653d 6d69 6e5f 636f 686f 7274  _size=min_cohort
+00037750: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+00037760: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
+00037770: 7a65 3d6d 6178 5f63 6f68 6f72 745f 7369  ze=max_cohort_si
+00037780: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+00037790: 7361 6d70 6c65 5f71 7565 7279 3d73 616d  sample_query=sam
+000377a0: 706c 655f 7175 6572 792c 0a20 2020 2020  ple_query,.     
+000377b0: 2020 2020 2020 2073 616d 706c 655f 7365         sample_se
+000377c0: 7473 3d73 616d 706c 655f 7365 7473 2c0a  ts=sample_sets,.
+000377d0: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+000377e0: 6f6d 5f73 6565 643d 7261 6e64 6f6d 5f73  om_seed=random_s
+000377f0: 6565 642c 0a20 2020 2020 2020 2029 0a0a  eed,.        )..
+00037800: 2020 2020 2020 2020 2320 6465 7465 726d          # determ
+00037810: 696e 6520 5820 6178 6973 2072 616e 6765  ine X axis range
+00037820: 0a20 2020 2020 2020 2078 5f6d 696e 203d  .        x_min =
+00037830: 2078 5b30 5d0a 2020 2020 2020 2020 785f   x[0].        x_
+00037840: 6d61 7820 3d20 785b 2d31 5d0a 2020 2020  max = x[-1].    
+00037850: 2020 2020 6966 2078 5f72 616e 6765 2069      if x_range i
+00037860: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00037870: 2020 2020 785f 7261 6e67 6520 3d20 626f      x_range = bo
+00037880: 6b65 682e 6d6f 6465 6c73 2e52 616e 6765  keh.models.Range
+00037890: 3164 2878 5f6d 696e 2c20 785f 6d61 782c  1d(x_min, x_max,
+000378a0: 2062 6f75 6e64 733d 2261 7574 6f22 290a   bounds="auto").
+000378b0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+000378c0: 6520 6120 6669 6775 7265 0a20 2020 2020  e a figure.     
+000378d0: 2020 2078 7768 6565 6c5f 7a6f 6f6d 203d     xwheel_zoom =
+000378e0: 2062 6f6b 6568 2e6d 6f64 656c 732e 5768   bokeh.models.Wh
+000378f0: 6565 6c5a 6f6f 6d54 6f6f 6c28 0a20 2020  eelZoomTool(.   
+00037900: 2020 2020 2020 2020 2064 696d 656e 7369           dimensi
+00037910: 6f6e 733d 2277 6964 7468 222c 206d 6169  ons="width", mai
+00037920: 6e74 6169 6e5f 666f 6375 733d 4661 6c73  ntain_focus=Fals
+00037930: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
+00037940: 2020 2020 6966 2074 6974 6c65 2069 7320      if title is 
+00037950: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00037960: 2020 7469 746c 6520 3d20 7361 6d70 6c65    title = sample
+00037970: 5f71 7565 7279 0a20 2020 2020 2020 2066  _query.        f
+00037980: 6967 203d 2062 6f6b 6568 2e70 6c6f 7474  ig = bokeh.plott
+00037990: 696e 672e 6669 6775 7265 280a 2020 2020  ing.figure(.    
+000379a0: 2020 2020 2020 2020 7469 746c 653d 7469          title=ti
+000379b0: 746c 652c 0a20 2020 2020 2020 2020 2020  tle,.           
+000379c0: 2074 6f6f 6c73 3d5b 2278 7061 6e22 2c20   tools=["xpan", 
+000379d0: 2278 7a6f 6f6d 5f69 6e22 2c20 2278 7a6f  "xzoom_in", "xzo
+000379e0: 6f6d 5f6f 7574 222c 2078 7768 6565 6c5f  om_out", xwheel_
+000379f0: 7a6f 6f6d 2c20 2272 6573 6574 225d 2c0a  zoom, "reset"],.
+00037a00: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+00037a10: 7665 5f73 6372 6f6c 6c3d 7877 6865 656c  ve_scroll=xwheel
+00037a20: 5f7a 6f6f 6d2c 0a20 2020 2020 2020 2020  _zoom,.         
+00037a30: 2020 2061 6374 6976 655f 6472 6167 3d22     active_drag="
+00037a40: 7870 616e 222c 0a20 2020 2020 2020 2020  xpan",.         
+00037a50: 2020 2073 697a 696e 675f 6d6f 6465 3d73     sizing_mode=s
+00037a60: 697a 696e 675f 6d6f 6465 2c0a 2020 2020  izing_mode,.    
+00037a70: 2020 2020 2020 2020 7769 6474 683d 7769          width=wi
+00037a80: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
+00037a90: 2068 6569 6768 743d 6865 6967 6874 2c0a   height=height,.
+00037aa0: 2020 2020 2020 2020 2020 2020 746f 6f6c              tool
+00037ab0: 6261 725f 6c6f 6361 7469 6f6e 3d22 6162  bar_location="ab
+00037ac0: 6f76 6522 2c0a 2020 2020 2020 2020 2020  ove",.          
+00037ad0: 2020 785f 7261 6e67 653d 785f 7261 6e67    x_range=x_rang
+00037ae0: 652c 0a20 2020 2020 2020 2020 2020 2079  e,.            y
+00037af0: 5f72 616e 6765 3d28 302c 2031 292c 0a20  _range=(0, 1),. 
+00037b00: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00037b10: 2020 2320 706c 6f74 2047 3132 330a 2020    # plot G123.  
+00037b20: 2020 2020 2020 6669 672e 6369 7263 6c65        fig.circle
+00037b30: 280a 2020 2020 2020 2020 2020 2020 783d  (.            x=
+00037b40: 782c 0a20 2020 2020 2020 2020 2020 2079  x,.            y
+00037b50: 3d67 3132 332c 0a20 2020 2020 2020 2020  =g123,.         
+00037b60: 2020 2073 697a 653d 332c 0a20 2020 2020     size=3,.     
+00037b70: 2020 2020 2020 206c 696e 655f 7769 6474         line_widt
+00037b80: 683d 302e 352c 0a20 2020 2020 2020 2020  h=0.5,.         
+00037b90: 2020 206c 696e 655f 636f 6c6f 723d 2262     line_color="b
+00037ba0: 6c61 636b 222c 0a20 2020 2020 2020 2020  lack",.         
+00037bb0: 2020 2066 696c 6c5f 636f 6c6f 723d 4e6f     fill_color=No
+00037bc0: 6e65 2c0a 2020 2020 2020 2020 290a 0a20  ne,.        ).. 
+00037bd0: 2020 2020 2020 2023 2074 6964 7920 7570         # tidy up
+00037be0: 2074 6865 2070 6c6f 740a 2020 2020 2020   the plot.      
+00037bf0: 2020 6669 672e 7961 7869 732e 6178 6973    fig.yaxis.axis
+00037c00: 5f6c 6162 656c 203d 2022 4731 3233 220a  _label = "G123".
+00037c10: 2020 2020 2020 2020 6669 672e 7961 7869          fig.yaxi
+00037c20: 732e 7469 636b 6572 203d 205b 302c 2031  s.ticker = [0, 1
+00037c30: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+00037c40: 626f 6b65 685f 7374 796c 655f 6765 6e6f  bokeh_style_geno
+00037c50: 6d65 5f78 6178 6973 2866 6967 2c20 636f  me_xaxis(fig, co
+00037c60: 6e74 6967 290a 0a20 2020 2020 2020 2069  ntig)..        i
+00037c70: 6620 7368 6f77 3a0a 2020 2020 2020 2020  f show:.        
+00037c80: 2020 2020 626f 6b65 682e 706c 6f74 7469      bokeh.plotti
+00037c90: 6e67 2e73 686f 7728 6669 6729 0a0a 2020  ng.show(fig)..  
+00037ca0: 2020 2020 2020 7265 7475 726e 2066 6967        return fig
+00037cb0: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+00037cc0: 2020 2020 7375 6d6d 6172 793d 2250 6c6f      summary="Plo
+00037cd0: 7420 4731 3233 2047 5753 5320 6461 7461  t G123 GWSS data
+00037ce0: 2e22 2c0a 2020 2020 290a 2020 2020 6465  .",.    ).    de
+00037cf0: 6620 706c 6f74 5f67 3132 335f 6777 7373  f plot_g123_gwss
+00037d00: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00037d10: 2020 2020 2020 2020 636f 6e74 6967 3a20          contig: 
+00037d20: 6261 7365 5f70 6172 616d 732e 636f 6e74  base_params.cont
+00037d30: 6967 2c0a 2020 2020 2020 2020 7769 6e64  ig,.        wind
+00037d40: 6f77 5f73 697a 653a 2067 3132 335f 7061  ow_size: g123_pa
+00037d50: 7261 6d73 2e77 696e 646f 775f 7369 7a65  rams.window_size
+00037d60: 2c0a 2020 2020 2020 2020 7369 7465 733a  ,.        sites:
+00037d70: 2067 3132 335f 7061 7261 6d73 2e73 6974   g123_params.sit
+00037d80: 6573 203d 2044 4546 4155 4c54 2c0a 2020  es = DEFAULT,.  
+00037d90: 2020 2020 2020 7369 7465 5f6d 6173 6b3a        site_mask:
+00037da0: 2062 6173 655f 7061 7261 6d73 2e73 6974   base_params.sit
+00037db0: 655f 6d61 736b 203d 2044 4546 4155 4c54  e_mask = DEFAULT
+00037dc0: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
+00037dd0: 5f73 6574 733a 204f 7074 696f 6e61 6c5b  _sets: Optional[
+00037de0: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
+00037df0: 6c65 5f73 6574 735d 203d 204e 6f6e 652c  le_sets] = None,
+00037e00: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+00037e10: 7175 6572 793a 204f 7074 696f 6e61 6c5b  query: Optional[
+00037e20: 6261 7365 5f70 6172 616d 732e 7361 6d70  base_params.samp
+00037e30: 6c65 5f71 7565 7279 5d20 3d20 4e6f 6e65  le_query] = None
+00037e40: 2c0a 2020 2020 2020 2020 6d69 6e5f 636f  ,.        min_co
+00037e50: 686f 7274 5f73 697a 653a 204f 7074 696f  hort_size: Optio
+00037e60: 6e61 6c5b 0a20 2020 2020 2020 2020 2020  nal[.           
+00037e70: 2062 6173 655f 7061 7261 6d73 2e6d 696e   base_params.min
+00037e80: 5f63 6f68 6f72 745f 7369 7a65 0a20 2020  _cohort_size.   
+00037e90: 2020 2020 205d 203d 2067 3132 335f 7061       ] = g123_pa
+00037ea0: 7261 6d73 2e6d 696e 5f63 6f68 6f72 745f  rams.min_cohort_
+00037eb0: 7369 7a65 5f64 6566 6175 6c74 2c0a 2020  size_default,.  
+00037ec0: 2020 2020 2020 6d61 785f 636f 686f 7274        max_cohort
+00037ed0: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
+00037ee0: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
+00037ef0: 655f 7061 7261 6d73 2e6d 6178 5f63 6f68  e_params.max_coh
+00037f00: 6f72 745f 7369 7a65 0a20 2020 2020 2020  ort_size.       
+00037f10: 205d 203d 2067 3132 335f 7061 7261 6d73   ] = g123_params
+00037f20: 2e6d 6178 5f63 6f68 6f72 745f 7369 7a65  .max_cohort_size
+00037f30: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00037f40: 2020 7261 6e64 6f6d 5f73 6565 643a 2062    random_seed: b
+00037f50: 6173 655f 7061 7261 6d73 2e72 616e 646f  ase_params.rando
+00037f60: 6d5f 7365 6564 203d 2034 322c 0a20 2020  m_seed = 42,.   
+00037f70: 2020 2020 2074 6974 6c65 3a20 4f70 7469       title: Opti
+00037f80: 6f6e 616c 5b67 706c 745f 7061 7261 6d73  onal[gplt_params
+00037f90: 2e74 6974 6c65 5d20 3d20 4e6f 6e65 2c0a  .title] = None,.
+00037fa0: 2020 2020 2020 2020 7369 7a69 6e67 5f6d          sizing_m
+00037fb0: 6f64 653a 2067 706c 745f 7061 7261 6d73  ode: gplt_params
+00037fc0: 2e73 697a 696e 675f 6d6f 6465 203d 2067  .sizing_mode = g
+00037fd0: 706c 745f 7061 7261 6d73 2e73 697a 696e  plt_params.sizin
+00037fe0: 675f 6d6f 6465 5f64 6566 6175 6c74 2c0a  g_mode_default,.
+00037ff0: 2020 2020 2020 2020 7769 6474 683a 2067          width: g
+00038000: 706c 745f 7061 7261 6d73 2e77 6964 7468  plt_params.width
+00038010: 203d 2067 706c 745f 7061 7261 6d73 2e77   = gplt_params.w
+00038020: 6964 7468 5f64 6566 6175 6c74 2c0a 2020  idth_default,.  
+00038030: 2020 2020 2020 7472 6163 6b5f 6865 6967        track_heig
+00038040: 6874 3a20 6770 6c74 5f70 6172 616d 732e  ht: gplt_params.
+00038050: 7472 6163 6b5f 6865 6967 6874 203d 2031  track_height = 1
+00038060: 3730 2c0a 2020 2020 2020 2020 6765 6e65  70,.        gene
+00038070: 735f 6865 6967 6874 3a20 6770 6c74 5f70  s_height: gplt_p
+00038080: 6172 616d 732e 6765 6e65 735f 6865 6967  arams.genes_heig
+00038090: 6874 203d 2067 706c 745f 7061 7261 6d73  ht = gplt_params
+000380a0: 2e67 656e 6573 5f68 6569 6768 745f 6465  .genes_height_de
+000380b0: 6661 756c 742c 0a20 2020 2029 3a0a 2020  fault,.    ):.  
+000380c0: 2020 2020 2020 2320 6777 7373 2074 7261        # gwss tra
+000380d0: 636b 0a20 2020 2020 2020 2066 6967 3120  ck.        fig1 
+000380e0: 3d20 7365 6c66 2e70 6c6f 745f 6731 3233  = self.plot_g123
+000380f0: 5f67 7773 735f 7472 6163 6b28 0a20 2020  _gwss_track(.   
+00038100: 2020 2020 2020 2020 2063 6f6e 7469 673d           contig=
+00038110: 636f 6e74 6967 2c0a 2020 2020 2020 2020  contig,.        
+00038120: 2020 2020 7369 7465 733d 7369 7465 732c      sites=sites,
+00038130: 0a20 2020 2020 2020 2020 2020 2073 6974  .            sit
+00038140: 655f 6d61 736b 3d73 6974 655f 6d61 736b  e_mask=site_mask
+00038150: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+00038160: 6e64 6f77 5f73 697a 653d 7769 6e64 6f77  ndow_size=window
+00038170: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+00038180: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
+00038190: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
+000381a0: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
+000381b0: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
+000381c0: 792c 0a20 2020 2020 2020 2020 2020 206d  y,.            m
+000381d0: 696e 5f63 6f68 6f72 745f 7369 7a65 3d6d  in_cohort_size=m
+000381e0: 696e 5f63 6f68 6f72 745f 7369 7a65 2c0a  in_cohort_size,.
+000381f0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00038200: 636f 686f 7274 5f73 697a 653d 6d61 785f  cohort_size=max_
+00038210: 636f 686f 7274 5f73 697a 652c 0a20 2020  cohort_size,.   
+00038220: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
+00038230: 7365 6564 3d72 616e 646f 6d5f 7365 6564  seed=random_seed
+00038240: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
+00038250: 746c 653d 7469 746c 652c 0a20 2020 2020  tle=title,.     
+00038260: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+00038270: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
+00038280: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+00038290: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
+000382a0: 2020 2020 2068 6569 6768 743d 7472 6163       height=trac
+000382b0: 6b5f 6865 6967 6874 2c0a 2020 2020 2020  k_height,.      
+000382c0: 2020 2020 2020 7368 6f77 3d46 616c 7365        show=False
+000382d0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000382e0: 2020 2020 2066 6967 312e 7861 7869 732e       fig1.xaxis.
+000382f0: 7669 7369 626c 6520 3d20 4661 6c73 650a  visible = False.
+00038300: 0a20 2020 2020 2020 2023 2070 6c6f 7420  .        # plot 
+00038310: 6765 6e65 730a 2020 2020 2020 2020 6669  genes.        fi
+00038320: 6732 203d 2073 656c 662e 706c 6f74 5f67  g2 = self.plot_g
+00038330: 656e 6573 280a 2020 2020 2020 2020 2020  enes(.          
+00038340: 2020 7265 6769 6f6e 3d63 6f6e 7469 672c    region=contig,
+00038350: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+00038360: 696e 675f 6d6f 6465 3d73 697a 696e 675f  ing_mode=sizing_
+00038370: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
+00038380: 2020 7769 6474 683d 7769 6474 682c 0a20    width=width,. 
+00038390: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+000383a0: 743d 6765 6e65 735f 6865 6967 6874 2c0a  t=genes_height,.
+000383b0: 2020 2020 2020 2020 2020 2020 785f 7261              x_ra
+000383c0: 6e67 653d 6669 6731 2e78 5f72 616e 6765  nge=fig1.x_range
+000383d0: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
+000383e0: 6f77 3d46 616c 7365 2c0a 2020 2020 2020  ow=False,.      
+000383f0: 2020 290a 0a20 2020 2020 2020 2023 2063    )..        # c
+00038400: 6f6d 6269 6e65 2070 6c6f 7473 2069 6e74  ombine plots int
+00038410: 6f20 6120 7369 6e67 6c65 2066 6967 7572  o a single figur
+00038420: 650a 2020 2020 2020 2020 6669 6720 3d20  e.        fig = 
+00038430: 626f 6b65 682e 6c61 796f 7574 732e 6772  bokeh.layouts.gr
+00038440: 6964 706c 6f74 280a 2020 2020 2020 2020  idplot(.        
+00038450: 2020 2020 5b66 6967 312c 2066 6967 325d      [fig1, fig2]
+00038460: 2c0a 2020 2020 2020 2020 2020 2020 6e63  ,.            nc
+00038470: 6f6c 733d 312c 0a20 2020 2020 2020 2020  ols=1,.         
+00038480: 2020 2074 6f6f 6c62 6172 5f6c 6f63 6174     toolbar_locat
+00038490: 696f 6e3d 2261 626f 7665 222c 0a20 2020  ion="above",.   
+000384a0: 2020 2020 2020 2020 206d 6572 6765 5f74           merge_t
+000384b0: 6f6f 6c73 3d54 7275 652c 0a20 2020 2020  ools=True,.     
+000384c0: 2020 2020 2020 2073 697a 696e 675f 6d6f         sizing_mo
+000384d0: 6465 3d73 697a 696e 675f 6d6f 6465 2c0a  de=sizing_mode,.
+000384e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000384f0: 2020 2062 6f6b 6568 2e70 6c6f 7474 696e     bokeh.plottin
+00038500: 672e 7368 6f77 2866 6967 290a 0a20 2020  g.show(fig)..   
+00038510: 2064 6566 205f 6c6f 6164 5f64 6174 615f   def _load_data_
+00038520: 666f 725f 6731 3233 280a 2020 2020 2020  for_g123(.      
+00038530: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00038540: 2a2c 0a20 2020 2020 2020 2063 6f6e 7469  *,.        conti
+00038550: 672c 0a20 2020 2020 2020 2073 6974 6573  g,.        sites
+00038560: 2c0a 2020 2020 2020 2020 7369 7465 5f6d  ,.        site_m
+00038570: 6173 6b2c 0a20 2020 2020 2020 2073 616d  ask,.        sam
+00038580: 706c 655f 7365 7473 2c0a 2020 2020 2020  ple_sets,.      
+00038590: 2020 7361 6d70 6c65 5f71 7565 7279 2c0a    sample_query,.
+000385a0: 2020 2020 2020 2020 6d69 6e5f 636f 686f          min_coho
+000385b0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
+000385c0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
+000385d0: 2c0a 2020 2020 2020 2020 7261 6e64 6f6d  ,.        random
+000385e0: 5f73 6565 642c 0a20 2020 2029 3a0a 2020  _seed,.    ):.  
+000385f0: 2020 2020 2020 6465 6275 6720 3d20 7365        debug = se
+00038600: 6c66 2e5f 6c6f 672e 6465 6275 670a 2020  lf._log.debug.  
+00038610: 2020 2020 2020 6473 5f73 6e70 7320 3d20        ds_snps = 
+00038620: 7365 6c66 2e73 6e70 5f63 616c 6c73 280a  self.snp_calls(.
+00038630: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00038640: 6f6e 3d63 6f6e 7469 672c 0a20 2020 2020  on=contig,.     
+00038650: 2020 2020 2020 2073 616d 706c 655f 7175         sample_qu
+00038660: 6572 793d 7361 6d70 6c65 5f71 7565 7279  ery=sample_query
+00038670: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
+00038680: 6d70 6c65 5f73 6574 733d 7361 6d70 6c65  mple_sets=sample
+00038690: 5f73 6574 732c 0a20 2020 2020 2020 2020  _sets,.         
+000386a0: 2020 2073 6974 655f 6d61 736b 3d73 6974     site_mask=sit
+000386b0: 655f 6d61 736b 2c0a 2020 2020 2020 2020  e_mask,.        
+000386c0: 2020 2020 6d69 6e5f 636f 686f 7274 5f73      min_cohort_s
+000386d0: 697a 653d 6d69 6e5f 636f 686f 7274 5f73  ize=min_cohort_s
+000386e0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+000386f0: 206d 6178 5f63 6f68 6f72 745f 7369 7a65   max_cohort_size
+00038700: 3d6d 6178 5f63 6f68 6f72 745f 7369 7a65  =max_cohort_size
+00038710: 2c0a 2020 2020 2020 2020 2020 2020 7261  ,.            ra
+00038720: 6e64 6f6d 5f73 6565 643d 7261 6e64 6f6d  ndom_seed=random
+00038730: 5f73 6565 642c 0a20 2020 2020 2020 2029  _seed,.        )
+00038740: 0a0a 2020 2020 2020 2020 6774 203d 2061  ..        gt = a
+00038750: 6c6c 656c 2e47 656e 6f74 7970 6544 6173  llel.GenotypeDas
+00038760: 6b41 7272 6179 2864 735f 736e 7073 5b22  kArray(ds_snps["
+00038770: 6361 6c6c 5f67 656e 6f74 7970 6522 5d2e  call_genotype"].
+00038780: 6461 7461 290a 2020 2020 2020 2020 7769  data).        wi
+00038790: 7468 2073 656c 662e 5f64 6173 6b5f 7072  th self._dask_pr
+000387a0: 6f67 7265 7373 2864 6573 633d 224c 6f61  ogress(desc="Loa
+000387b0: 6420 6765 6e6f 7479 7065 7322 293a 0a20  d genotypes"):. 
+000387c0: 2020 2020 2020 2020 2020 2067 7420 3d20             gt = 
+000387d0: 6774 2e63 6f6d 7075 7465 2829 0a20 2020  gt.compute().   
+000387e0: 2020 2020 2070 6f73 203d 2064 735f 736e       pos = ds_sn
+000387f0: 7073 5b22 7661 7269 616e 745f 706f 7369  ps["variant_posi
+00038800: 7469 6f6e 225d 2e76 616c 7565 730a 0a20  tion"].values.. 
+00038810: 2020 2020 2020 2069 6620 7369 7465 7320         if sites 
+00038820: 696e 2073 656c 662e 7068 6173 696e 675f  in self.phasing_
+00038830: 616e 616c 7973 6973 5f69 6473 3a0a 2020  analysis_ids:.  
+00038840: 2020 2020 2020 2020 2020 6465 6275 6728            debug(
+00038850: 2273 7562 7365 7474 696e 6720 746f 2068  "subsetting to h
+00038860: 6170 6c6f 7479 7065 2070 6f73 6974 696f  aplotype positio
+00038870: 6e73 2229 0a20 2020 2020 2020 2020 2020  ns").           
+00038880: 2068 6170 6c6f 7479 7065 5f70 6f73 203d   haplotype_pos =
+00038890: 2073 656c 662e 5f68 6170 6c6f 7479 7065   self._haplotype
+000388a0: 5f73 6974 6573 5f66 6f72 5f63 6f6e 7469  _sites_for_conti
+000388b0: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+000388c0: 2020 2063 6f6e 7469 673d 636f 6e74 6967     contig=contig
+000388d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000388e0: 2020 616e 616c 7973 6973 3d73 6974 6573    analysis=sites
+000388f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00038900: 2020 6669 656c 643d 2250 4f53 222c 0a20    field="POS",. 
+00038910: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00038920: 6e6c 696e 655f 6172 7261 793d 5472 7565  nline_array=True
+00038930: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00038940: 2020 6368 756e 6b73 3d22 6e61 7469 7665    chunks="native
+00038950: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00038960: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
+00038970: 2020 2020 2020 2068 6170 5f73 6974 655f         hap_site_
+00038980: 6d61 736b 203d 206e 702e 696e 3164 2870  mask = np.in1d(p
+00038990: 6f73 2c20 6861 706c 6f74 7970 655f 706f  os, haplotype_po
+000389a0: 732c 2061 7373 756d 655f 756e 6971 7565  s, assume_unique
+000389b0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+000389c0: 2020 2070 6f73 203d 2070 6f73 5b68 6170     pos = pos[hap
+000389d0: 5f73 6974 655f 6d61 736b 5d0a 2020 2020  _site_mask].    
+000389e0: 2020 2020 2020 2020 6774 203d 2067 742e          gt = gt.
+000389f0: 636f 6d70 7265 7373 2868 6170 5f73 6974  compress(hap_sit
+00038a00: 655f 6d61 736b 2c20 6178 6973 3d30 290a  e_mask, axis=0).
+00038a10: 0a20 2020 2020 2020 2065 6c69 6620 7369  .        elif si
+00038a20: 7465 7320 3d3d 2022 7365 6772 6567 6174  tes == "segregat
+00038a30: 696e 6722 3a0a 2020 2020 2020 2020 2020  ing":.          
+00038a40: 2020 6465 6275 6728 2273 7562 7365 7474    debug("subsett
+00038a50: 696e 6720 746f 2073 6567 7265 6761 7469  ing to segregati
+00038a60: 6e67 2073 6974 6573 2229 0a20 2020 2020  ng sites").     
+00038a70: 2020 2020 2020 2061 6320 3d20 6774 2e63         ac = gt.c
+00038a80: 6f75 6e74 5f61 6c6c 656c 6573 286d 6178  ount_alleles(max
+00038a90: 5f61 6c6c 656c 653d 3329 0a20 2020 2020  _allele=3).     
+00038aa0: 2020 2020 2020 2073 6567 203d 2061 632e         seg = ac.
+00038ab0: 6973 5f73 6567 7265 6761 7469 6e67 2829  is_segregating()
+00038ac0: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+00038ad0: 203d 2070 6f73 5b73 6567 5d0a 2020 2020   = pos[seg].    
+00038ae0: 2020 2020 2020 2020 6774 203d 2067 742e          gt = gt.
+00038af0: 636f 6d70 7265 7373 2873 6567 2c20 6178  compress(seg, ax
+00038b00: 6973 3d30 290a 0a20 2020 2020 2020 2065  is=0)..        e
+00038b10: 6c69 6620 7369 7465 7320 3d3d 2022 616c  lif sites == "al
+00038b20: 6c22 3a0a 2020 2020 2020 2020 2020 2020  l":.            
+00038b30: 6465 6275 6728 2275 7369 6e67 2061 6c6c  debug("using all
+00038b40: 2073 6974 6573 2229 0a0a 2020 2020 2020   sites")..      
+00038b50: 2020 7265 7475 726e 2067 742c 2070 6f73    return gt, pos
+00038b60: 0a0a 2020 2020 4064 6f63 280a 2020 2020  ..    @doc(.    
+00038b70: 2020 2020 7375 6d6d 6172 793d 2247 656e      summary="Gen
+00038b80: 6572 6174 6520 6731 3233 2047 5753 5320  erate g123 GWSS 
+00038b90: 6361 6c69 6272 6174 696f 6e20 6461 7461  calibration data
+00038ba0: 2066 6f72 2064 6966 6665 7265 6e74 2077   for different w
+00038bb0: 696e 646f 7720 7369 7a65 732e 222c 0a20  indow sizes.",. 
+00038bc0: 2020 2020 2020 2072 6574 7572 6e73 3d22         returns="
+00038bd0: 2222 0a20 2020 2020 2020 2020 2020 2041  "".            A
+00038be0: 206c 6973 7420 6f66 2067 3132 3320 6361   list of g123 ca
+00038bf0: 6c69 6272 6174 696f 6e20 7275 6e20 6172  libration run ar
+00038c00: 7261 7973 2066 6f72 2065 6163 6820 7769  rays for each wi
+00038c10: 6e64 6f77 2073 697a 652c 2063 6f6e 7461  ndow size, conta
+00038c20: 696e 696e 670a 2020 2020 2020 2020 2020  ining.          
+00038c30: 2020 7661 6c75 6573 2061 6e64 2070 6572    values and per
+00038c40: 6365 6e74 696c 6573 2e0a 2020 2020 2020  centiles..      
+00038c50: 2020 2222 222c 0a20 2020 2029 0a20 2020    """,.    ).   
+00038c60: 2064 6566 2067 3132 335f 6361 6c69 6272   def g123_calibr
+00038c70: 6174 696f 6e28 0a20 2020 2020 2020 2073  ation(.        s
+00038c80: 656c 662c 0a20 2020 2020 2020 2063 6f6e  elf,.        con
+00038c90: 7469 673a 2062 6173 655f 7061 7261 6d73  tig: base_params
+00038ca0: 2e63 6f6e 7469 672c 0a20 2020 2020 2020  .contig,.       
+00038cb0: 2073 6974 6573 3a20 6731 3233 5f70 6172   sites: g123_par
+00038cc0: 616d 732e 7369 7465 7320 3d20 4445 4641  ams.sites = DEFA
+00038cd0: 554c 542c 0a20 2020 2020 2020 2073 6974  ULT,.        sit
+00038ce0: 655f 6d61 736b 3a20 6261 7365 5f70 6172  e_mask: base_par
+00038cf0: 616d 732e 7369 7465 5f6d 6173 6b20 3d20  ams.site_mask = 
+00038d00: 4445 4641 554c 542c 0a20 2020 2020 2020  DEFAULT,.       
+00038d10: 2073 616d 706c 655f 7175 6572 793a 204f   sample_query: O
+00038d20: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+00038d30: 616d 732e 7361 6d70 6c65 5f71 7565 7279  ams.sample_query
+00038d40: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00038d50: 2020 7361 6d70 6c65 5f73 6574 733a 204f    sample_sets: O
+00038d60: 7074 696f 6e61 6c5b 6261 7365 5f70 6172  ptional[base_par
+00038d70: 616d 732e 7361 6d70 6c65 5f73 6574 735d  ams.sample_sets]
+00038d80: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00038d90: 206d 696e 5f63 6f68 6f72 745f 7369 7a65   min_cohort_size
+00038da0: 3a20 4f70 7469 6f6e 616c 5b0a 2020 2020  : Optional[.    
+00038db0: 2020 2020 2020 2020 6261 7365 5f70 6172          base_par
+00038dc0: 616d 732e 6d69 6e5f 636f 686f 7274 5f73  ams.min_cohort_s
+00038dd0: 697a 650a 2020 2020 2020 2020 5d20 3d20  ize.        ] = 
+00038de0: 6731 3233 5f70 6172 616d 732e 6d69 6e5f  g123_params.min_
+00038df0: 636f 686f 7274 5f73 697a 655f 6465 6661  cohort_size_defa
+00038e00: 756c 742c 0a20 2020 2020 2020 206d 6178  ult,.        max
+00038e10: 5f63 6f68 6f72 745f 7369 7a65 3a20 4f70  _cohort_size: Op
+00038e20: 7469 6f6e 616c 5b0a 2020 2020 2020 2020  tional[.        
+00038e30: 2020 2020 6261 7365 5f70 6172 616d 732e      base_params.
+00038e40: 6d61 785f 636f 686f 7274 5f73 697a 650a  max_cohort_size.
+00038e50: 2020 2020 2020 2020 5d20 3d20 6731 3233          ] = g123
+00038e60: 5f70 6172 616d 732e 6d61 785f 636f 686f  _params.max_coho
+00038e70: 7274 5f73 697a 655f 6465 6661 756c 742c  rt_size_default,
+00038e80: 0a20 2020 2020 2020 2077 696e 646f 775f  .        window_
+00038e90: 7369 7a65 733a 2067 3132 335f 7061 7261  sizes: g123_para
+00038ea0: 6d73 2e77 696e 646f 775f 7369 7a65 7320  ms.window_sizes 
+00038eb0: 3d20 6731 3233 5f70 6172 616d 732e 7769  = g123_params.wi
+00038ec0: 6e64 6f77 5f73 697a 6573 5f64 6566 6175  ndow_sizes_defau
+00038ed0: 6c74 2c0a 2020 2020 2020 2020 7261 6e64  lt,.        rand
+00038ee0: 6f6d 5f73 6565 643a 2062 6173 655f 7061  om_seed: base_pa
+00038ef0: 7261 6d73 2e72 616e 646f 6d5f 7365 6564  rams.random_seed
+00038f00: 203d 2034 322c 0a20 2020 2029 202d 3e20   = 42,.    ) -> 
+00038f10: 4c69 7374 5b6e 702e 6e64 6172 7261 795d  List[np.ndarray]
+00038f20: 3a0a 2020 2020 2020 2020 2320 6368 616e  :.        # chan
+00038f30: 6765 2074 6869 7320 6e61 6d65 2069 6620  ge this name if 
+00038f40: 796f 7520 6576 6572 2063 6861 6e67 6520  you ever change 
+00038f50: 7468 6520 6265 6861 7669 6f75 7220 6f66  the behaviour of
+00038f60: 2074 6869 7320 6675 6e63 7469 6f6e 2c20   this function, 
+00038f70: 746f 0a20 2020 2020 2020 2023 2069 6e76  to.        # inv
+00038f80: 616c 6964 6174 6520 616e 7920 7072 6576  alidate any prev
+00038f90: 696f 7573 6c79 2063 6163 6865 6420 6461  iously cached da
+00038fa0: 7461 0a20 2020 2020 2020 206e 616d 6520  ta.        name 
+00038fb0: 3d20 7365 6c66 2e5f 6731 3233 5f63 616c  = self._g123_cal
+00038fc0: 6962 7261 7469 6f6e 5f63 6163 6865 5f6e  ibration_cache_n
+00038fd0: 616d 650a 0a20 2020 2020 2020 2070 6172  ame..        par
+00038fe0: 616d 7320 3d20 6469 6374 280a 2020 2020  ams = dict(.    
+00038ff0: 2020 2020 2020 2020 636f 6e74 6967 3d63          contig=c
+00039000: 6f6e 7469 672c 0a20 2020 2020 2020 2020  ontig,.         
+00039010: 2020 2073 6974 6573 3d73 6974 6573 2c0a     sites=sites,.
+00039020: 2020 2020 2020 2020 2020 2020 7369 7465              site
+00039030: 5f6d 6173 6b3d 7365 6c66 2e5f 7072 6570  _mask=self._prep
+00039040: 5f73 6974 655f 6d61 736b 5f70 6172 616d  _site_mask_param
+00039050: 2873 6974 655f 6d61 736b 3d73 6974 655f  (site_mask=site_
+00039060: 6d61 736b 292c 0a20 2020 2020 2020 2020  mask),.         
+00039070: 2020 2077 696e 646f 775f 7369 7a65 733d     window_sizes=
+00039080: 7769 6e64 6f77 5f73 697a 6573 2c0a 2020  window_sizes,.  
+00039090: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+000390a0: 5f73 6574 733d 7365 6c66 2e5f 7072 6570  _sets=self._prep
+000390b0: 5f73 616d 706c 655f 7365 7473 5f70 6172  _sample_sets_par
+000390c0: 616d 2873 616d 706c 655f 7365 7473 3d73  am(sample_sets=s
+000390d0: 616d 706c 655f 7365 7473 292c 0a20 2020  ample_sets),.   
+000390e0: 2020 2020 2020 2020 2023 204e 2e42 2e2c           # N.B.,
+000390f0: 2064 6f20 6e6f 7420 6265 2074 656d 7074   do not be tempt
+00039100: 6564 2074 6f20 636f 6e76 6572 7420 7468  ed to convert th
+00039110: 6973 2073 616d 706c 6520 7175 6572 7920  is sample query 
+00039120: 696e 746f 2069 6e74 6567 6572 0a20 2020  into integer.   
+00039130: 2020 2020 2020 2020 2023 2069 6e64 6963           # indic
+00039140: 6573 2075 7369 6e67 205f 7072 6570 5f73  es using _prep_s
+00039150: 616d 706c 655f 7365 6c65 6374 696f 6e5f  ample_selection_
+00039160: 7061 7261 6d73 2c20 6265 6361 7573 6520  params, because 
+00039170: 7468 6520 696e 6469 6365 730a 2020 2020  the indices.    
+00039180: 2020 2020 2020 2020 2320 6172 6520 6469          # are di
+00039190: 6666 6572 656e 7420 696e 2074 6865 2068  fferent in the h
+000391a0: 6170 6c6f 7479 7065 2064 6174 612e 0a20  aplotype data.. 
+000391b0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+000391c0: 655f 7175 6572 793d 7361 6d70 6c65 5f71  e_query=sample_q
+000391d0: 7565 7279 2c0a 2020 2020 2020 2020 2020  uery,.          
+000391e0: 2020 6d69 6e5f 636f 686f 7274 5f73 697a    min_cohort_siz
+000391f0: 653d 6d69 6e5f 636f 686f 7274 5f73 697a  e=min_cohort_siz
+00039200: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00039210: 6178 5f63 6f68 6f72 745f 7369 7a65 3d6d  ax_cohort_size=m
+00039220: 6178 5f63 6f68 6f72 745f 7369 7a65 2c0a  ax_cohort_size,.
+00039230: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+00039240: 6f6d 5f73 6565 643d 7261 6e64 6f6d 5f73  om_seed=random_s
+00039250: 6565 642c 0a20 2020 2020 2020 2029 0a0a  eed,.        )..
+00039260: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00039270: 2020 2020 2020 2020 2063 616c 6962 7261           calibra
+00039280: 7469 6f6e 5f72 756e 7320 3d20 7365 6c66  tion_runs = self
+00039290: 2e72 6573 756c 7473 5f63 6163 6865 5f67  .results_cache_g
+000392a0: 6574 286e 616d 653d 6e61 6d65 2c20 7061  et(name=name, pa
+000392b0: 7261 6d73 3d70 6172 616d 7329 0a0a 2020  rams=params)..  
+000392c0: 2020 2020 2020 6578 6365 7074 2043 6163        except Cac
+000392d0: 6865 4d69 7373 3a0a 2020 2020 2020 2020  heMiss:.        
+000392e0: 2020 2020 6361 6c69 6272 6174 696f 6e5f      calibration_
+000392f0: 7275 6e73 203d 2073 656c 662e 5f67 3132  runs = self._g12
+00039300: 335f 6361 6c69 6272 6174 696f 6e28 2a2a  3_calibration(**
+00039310: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00039320: 2020 2020 7365 6c66 2e72 6573 756c 7473      self.results
+00039330: 5f63 6163 6865 5f73 6574 286e 616d 653d  _cache_set(name=
+00039340: 6e61 6d65 2c20 7061 7261 6d73 3d70 6172  name, params=par
+00039350: 616d 732c 2072 6573 756c 7473 3d63 616c  ams, results=cal
+00039360: 6962 7261 7469 6f6e 5f72 756e 7329 0a0a  ibration_runs)..
+00039370: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00039380: 616c 6962 7261 7469 6f6e 5f72 756e 730a  alibration_runs.
+00039390: 0a20 2020 2064 6566 205f 6731 3233 5f63  .    def _g123_c
+000393a0: 616c 6962 7261 7469 6f6e 280a 2020 2020  alibration(.    
+000393b0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000393c0: 2020 2a2c 0a20 2020 2020 2020 2063 6f6e    *,.        con
+000393d0: 7469 672c 0a20 2020 2020 2020 2073 6974  tig,.        sit
+000393e0: 6573 2c0a 2020 2020 2020 2020 7369 7465  es,.        site
+000393f0: 5f6d 6173 6b2c 0a20 2020 2020 2020 2073  _mask,.        s
+00039400: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+00039410: 2020 2020 2073 616d 706c 655f 7365 7473       sample_sets
+00039420: 2c0a 2020 2020 2020 2020 6d69 6e5f 636f  ,.        min_co
+00039430: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+00039440: 2020 206d 6178 5f63 6f68 6f72 745f 7369     max_cohort_si
+00039450: 7a65 2c0a 2020 2020 2020 2020 7769 6e64  ze,.        wind
+00039460: 6f77 5f73 697a 6573 2c0a 2020 2020 2020  ow_sizes,.      
+00039470: 2020 7261 6e64 6f6d 5f73 6565 642c 0a20    random_seed,. 
+00039480: 2020 2029 3a0a 2020 2020 2020 2020 6774     ):.        gt
+00039490: 2c20 5f20 3d20 7365 6c66 2e5f 6c6f 6164  , _ = self._load
+000394a0: 5f64 6174 615f 666f 725f 6731 3233 280a  _data_for_g123(.
+000394b0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000394c0: 6967 3d63 6f6e 7469 672c 0a20 2020 2020  ig=contig,.     
+000394d0: 2020 2020 2020 2073 6974 6573 3d73 6974         sites=sit
+000394e0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+000394f0: 7369 7465 5f6d 6173 6b3d 7369 7465 5f6d  site_mask=site_m
+00039500: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
+00039510: 2073 616d 706c 655f 7175 6572 793d 7361   sample_query=sa
+00039520: 6d70 6c65 5f71 7565 7279 2c0a 2020 2020  mple_query,.    
+00039530: 2020 2020 2020 2020 7361 6d70 6c65 5f73          sample_s
+00039540: 6574 733d 7361 6d70 6c65 5f73 6574 732c  ets=sample_sets,
+00039550: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00039560: 5f63 6f68 6f72 745f 7369 7a65 3d6d 696e  _cohort_size=min
+00039570: 5f63 6f68 6f72 745f 7369 7a65 2c0a 2020  _cohort_size,.  
+00039580: 2020 2020 2020 2020 2020 6d61 785f 636f            max_co
+00039590: 686f 7274 5f73 697a 653d 6d61 785f 636f  hort_size=max_co
+000395a0: 686f 7274 5f73 697a 652c 0a20 2020 2020  hort_size,.     
+000395b0: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
+000395c0: 6564 3d72 616e 646f 6d5f 7365 6564 2c0a  ed=random_seed,.
+000395d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000395e0: 2020 2063 616c 6962 7261 7469 6f6e 5f72     calibration_r
+000395f0: 756e 7320 3d20 6469 6374 2829 0a20 2020  uns = dict().   
+00039600: 2020 2020 2066 6f72 2077 696e 646f 775f       for window_
+00039610: 7369 7a65 2069 6e20 7365 6c66 2e5f 7072  size in self._pr
+00039620: 6f67 7265 7373 2877 696e 646f 775f 7369  ogress(window_si
+00039630: 7a65 732c 2064 6573 633d 2243 6f6d 7075  zes, desc="Compu
+00039640: 7465 2067 3132 3322 293a 0a20 2020 2020  te g123"):.     
+00039650: 2020 2020 2020 2067 3132 3320 3d20 616c         g123 = al
+00039660: 6c65 6c2e 6d6f 7669 6e67 5f73 7461 7469  lel.moving_stati
+00039670: 7374 6963 280a 2020 2020 2020 2020 2020  stic(.          
+00039680: 2020 2020 2020 6774 2c20 7374 6174 6973        gt, statis
+00039690: 7469 633d 7365 6c66 2e5f 6761 7275 645f  tic=self._garud_
+000396a0: 6731 3233 2c20 7369 7a65 3d77 696e 646f  g123, size=windo
+000396b0: 775f 7369 7a65 0a20 2020 2020 2020 2020  w_size.         
+000396c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000396d0: 2063 616c 6962 7261 7469 6f6e 5f72 756e   calibration_run
+000396e0: 735b 7374 7228 7769 6e64 6f77 5f73 697a  s[str(window_siz
+000396f0: 6529 5d20 3d20 6731 3233 0a0a 2020 2020  e)] = g123..    
+00039700: 2020 2020 7265 7475 726e 2063 616c 6962      return calib
+00039710: 7261 7469 6f6e 5f72 756e 730a 0a20 2020  ration_runs..   
+00039720: 2040 646f 6328 0a20 2020 2020 2020 2073   @doc(.        s
+00039730: 756d 6d61 7279 3d22 506c 6f74 2067 3132  ummary="Plot g12
+00039740: 3320 4757 5353 2063 616c 6962 7261 7469  3 GWSS calibrati
+00039750: 6f6e 2064 6174 6120 666f 7220 6469 6666  on data for diff
+00039760: 6572 656e 7420 7769 6e64 6f77 2073 697a  erent window siz
+00039770: 6573 2e22 2c0a 2020 2020 290a 2020 2020  es.",.    ).    
+00039780: 6465 6620 706c 6f74 5f67 3132 335f 6361  def plot_g123_ca
+00039790: 6c69 6272 6174 696f 6e28 0a20 2020 2020  libration(.     
+000397a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+000397b0: 2063 6f6e 7469 673a 2062 6173 655f 7061   contig: base_pa
+000397c0: 7261 6d73 2e63 6f6e 7469 672c 0a20 2020  rams.contig,.   
+000397d0: 2020 2020 2073 6974 6573 3a20 6731 3233       sites: g123
+000397e0: 5f70 6172 616d 732e 7369 7465 732c 0a20  _params.sites,. 
+000397f0: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+00039800: 3a20 6261 7365 5f70 6172 616d 732e 7369  : base_params.si
+00039810: 7465 5f6d 6173 6b20 3d20 4445 4641 554c  te_mask = DEFAUL
+00039820: 542c 0a20 2020 2020 2020 2073 616d 706c  T,.        sampl
+00039830: 655f 7175 6572 793a 204f 7074 696f 6e61  e_query: Optiona
+00039840: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+00039850: 6d70 6c65 5f71 7565 7279 5d20 3d20 4e6f  mple_query] = No
+00039860: 6e65 2c0a 2020 2020 2020 2020 7361 6d70  ne,.        samp
+00039870: 6c65 5f73 6574 733a 204f 7074 696f 6e61  le_sets: Optiona
+00039880: 6c5b 6261 7365 5f70 6172 616d 732e 7361  l[base_params.sa
+00039890: 6d70 6c65 5f73 6574 735d 203d 204e 6f6e  mple_sets] = Non
+000398a0: 652c 0a20 2020 2020 2020 206d 696e 5f63  e,.        min_c
+000398b0: 6f68 6f72 745f 7369 7a65 3a20 4f70 7469  ohort_size: Opti
+000398c0: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
+000398d0: 2020 6261 7365 5f70 6172 616d 732e 6d69    base_params.mi
+000398e0: 6e5f 636f 686f 7274 5f73 697a 650a 2020  n_cohort_size.  
+000398f0: 2020 2020 2020 5d20 3d20 6731 3233 5f70        ] = g123_p
+00039900: 6172 616d 732e 6d69 6e5f 636f 686f 7274  arams.min_cohort
+00039910: 5f73 697a 655f 6465 6661 756c 742c 0a20  _size_default,. 
+00039920: 2020 2020 2020 206d 6178 5f63 6f68 6f72         max_cohor
+00039930: 745f 7369 7a65 3a20 4f70 7469 6f6e 616c  t_size: Optional
+00039940: 5b0a 2020 2020 2020 2020 2020 2020 6261  [.            ba
+00039950: 7365 5f70 6172 616d 732e 6d61 785f 636f  se_params.max_co
+00039960: 686f 7274 5f73 697a 650a 2020 2020 2020  hort_size.      
+00039970: 2020 5d20 3d20 6731 3233 5f70 6172 616d    ] = g123_param
+00039980: 732e 6d61 785f 636f 686f 7274 5f73 697a  s.max_cohort_siz
+00039990: 655f 6465 6661 756c 742c 0a20 2020 2020  e_default,.     
+000399a0: 2020 2077 696e 646f 775f 7369 7a65 733a     window_sizes:
+000399b0: 2067 3132 335f 7061 7261 6d73 2e77 696e   g123_params.win
+000399c0: 646f 775f 7369 7a65 7320 3d20 6731 3233  dow_sizes = g123
+000399d0: 5f70 6172 616d 732e 7769 6e64 6f77 5f73  _params.window_s
+000399e0: 697a 6573 5f64 6566 6175 6c74 2c0a 2020  izes_default,.  
+000399f0: 2020 2020 2020 7261 6e64 6f6d 5f73 6565        random_see
+00039a00: 643a 2062 6173 655f 7061 7261 6d73 2e72  d: base_params.r
+00039a10: 616e 646f 6d5f 7365 6564 203d 2034 322c  andom_seed = 42,
+00039a20: 0a20 2020 2020 2020 2074 6974 6c65 3a20  .        title: 
+00039a30: 4f70 7469 6f6e 616c 5b67 706c 745f 7061  Optional[gplt_pa
+00039a40: 7261 6d73 2e74 6974 6c65 5d20 3d20 4e6f  rams.title] = No
+00039a50: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
+00039a60: 2020 2023 2067 6574 2067 3132 3320 7661     # get g123 va
+00039a70: 6c75 6573 0a20 2020 2020 2020 2063 616c  lues.        cal
+00039a80: 6962 7261 7469 6f6e 5f72 756e 7320 3d20  ibration_runs = 
+00039a90: 7365 6c66 2e67 3132 335f 6361 6c69 6272  self.g123_calibr
+00039aa0: 6174 696f 6e28 0a20 2020 2020 2020 2020  ation(.         
+00039ab0: 2020 2063 6f6e 7469 673d 636f 6e74 6967     contig=contig
+00039ac0: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00039ad0: 7465 733d 7369 7465 732c 0a20 2020 2020  tes=sites,.     
+00039ae0: 2020 2020 2020 2073 6974 655f 6d61 736b         site_mask
+00039af0: 3d73 6974 655f 6d61 736b 2c0a 2020 2020  =site_mask,.    
+00039b00: 2020 2020 2020 2020 7361 6d70 6c65 5f71          sample_q
+00039b10: 7565 7279 3d73 616d 706c 655f 7175 6572  uery=sample_quer
+00039b20: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
+00039b30: 616d 706c 655f 7365 7473 3d73 616d 706c  ample_sets=sampl
+00039b40: 655f 7365 7473 2c0a 2020 2020 2020 2020  e_sets,.        
+00039b50: 2020 2020 7769 6e64 6f77 5f73 697a 6573      window_sizes
+00039b60: 3d77 696e 646f 775f 7369 7a65 732c 0a20  =window_sizes,. 
+00039b70: 2020 2020 2020 2020 2020 206d 696e 5f63             min_c
+00039b80: 6f68 6f72 745f 7369 7a65 3d6d 696e 5f63  ohort_size=min_c
+00039b90: 6f68 6f72 745f 7369 7a65 2c0a 2020 2020  ohort_size,.    
+00039ba0: 2020 2020 2020 2020 6d61 785f 636f 686f          max_coho
+00039bb0: 7274 5f73 697a 653d 6d61 785f 636f 686f  rt_size=max_coho
+00039bc0: 7274 5f73 697a 652c 0a20 2020 2020 2020  rt_size,.       
+00039bd0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+00039be0: 3d72 616e 646f 6d5f 7365 6564 2c0a 2020  =random_seed,.  
+00039bf0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00039c00: 2023 2063 6f6d 7075 7465 2073 756d 6d61   # compute summa
+00039c10: 7269 6573 0a20 2020 2020 2020 2071 3530  ries.        q50
+00039c20: 203d 205b 6e70 2e6d 6564 6961 6e28 6361   = [np.median(ca
+00039c30: 6c69 6272 6174 696f 6e5f 7275 6e73 5b73  libration_runs[s
+00039c40: 7472 2877 696e 646f 7729 5d29 2066 6f72  tr(window)]) for
+00039c50: 2077 696e 646f 7720 696e 2077 696e 646f   window in windo
+00039c60: 775f 7369 7a65 735d 0a20 2020 2020 2020  w_sizes].       
+00039c70: 2071 3235 203d 205b 0a20 2020 2020 2020   q25 = [.       
+00039c80: 2020 2020 206e 702e 7065 7263 656e 7469       np.percenti
+00039c90: 6c65 2863 616c 6962 7261 7469 6f6e 5f72  le(calibration_r
+00039ca0: 756e 735b 7374 7228 7769 6e64 6f77 295d  uns[str(window)]
+00039cb0: 2c20 3235 2920 666f 7220 7769 6e64 6f77  , 25) for window
+00039cc0: 2069 6e20 7769 6e64 6f77 5f73 697a 6573   in window_sizes
+00039cd0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00039ce0: 2020 2071 3735 203d 205b 0a20 2020 2020     q75 = [.     
+00039cf0: 2020 2020 2020 206e 702e 7065 7263 656e         np.percen
+00039d00: 7469 6c65 2863 616c 6962 7261 7469 6f6e  tile(calibration
+00039d10: 5f72 756e 735b 7374 7228 7769 6e64 6f77  _runs[str(window
+00039d20: 295d 2c20 3735 2920 666f 7220 7769 6e64  )], 75) for wind
+00039d30: 6f77 2069 6e20 7769 6e64 6f77 5f73 697a  ow in window_siz
+00039d40: 6573 0a20 2020 2020 2020 205d 0a20 2020  es.        ].   
+00039d50: 2020 2020 2071 3035 203d 205b 0a20 2020       q05 = [.   
+00039d60: 2020 2020 2020 2020 206e 702e 7065 7263           np.perc
+00039d70: 656e 7469 6c65 2863 616c 6962 7261 7469  entile(calibrati
+00039d80: 6f6e 5f72 756e 735b 7374 7228 7769 6e64  on_runs[str(wind
+00039d90: 6f77 295d 2c20 3529 2066 6f72 2077 696e  ow)], 5) for win
+00039da0: 646f 7720 696e 2077 696e 646f 775f 7369  dow in window_si
+00039db0: 7a65 730a 2020 2020 2020 2020 5d0a 2020  zes.        ].  
+00039dc0: 2020 2020 2020 7139 3520 3d20 5b0a 2020        q95 = [.  
+00039dd0: 2020 2020 2020 2020 2020 6e70 2e70 6572            np.per
+00039de0: 6365 6e74 696c 6528 6361 6c69 6272 6174  centile(calibrat
+00039df0: 696f 6e5f 7275 6e73 5b73 7472 2877 696e  ion_runs[str(win
+00039e00: 646f 7729 5d2c 2039 3529 2066 6f72 2077  dow)], 95) for w
+00039e10: 696e 646f 7720 696e 2077 696e 646f 775f  indow in window_
+00039e20: 7369 7a65 730a 2020 2020 2020 2020 5d0a  sizes.        ].
+00039e30: 0a20 2020 2020 2020 2023 206d 616b 6520  .        # make 
+00039e40: 706c 6f74 0a20 2020 2020 2020 2066 6967  plot.        fig
+00039e50: 203d 2062 6f6b 6568 2e70 6c6f 7474 696e   = bokeh.plottin
+00039e60: 672e 6669 6775 7265 2877 6964 7468 3d37  g.figure(width=7
+00039e70: 3030 2c20 6865 6967 6874 3d34 3030 2c20  00, height=400, 
+00039e80: 785f 6178 6973 5f74 7970 653d 226c 6f67  x_axis_type="log
+00039e90: 2229 0a20 2020 2020 2020 2066 6967 2e70  ").        fig.p
+00039ea0: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
+00039eb0: 2020 7769 6e64 6f77 5f73 697a 6573 202b    window_sizes +
+00039ec0: 2077 696e 646f 775f 7369 7a65 735b 3a3a   window_sizes[::
+00039ed0: 2d31 5d2c 0a20 2020 2020 2020 2020 2020  -1],.           
+00039ee0: 2071 3735 202b 2071 3235 5b3a 3a2d 315d   q75 + q25[::-1]
+00039ef0: 2c0a 2020 2020 2020 2020 2020 2020 616c  ,.            al
+00039f00: 7068 613d 302e 3735 2c0a 2020 2020 2020  pha=0.75,.      
+00039f10: 2020 2020 2020 6c69 6e65 5f77 6964 7468        line_width
+00039f20: 3d32 2c0a 2020 2020 2020 2020 2020 2020  =2,.            
+00039f30: 6c65 6765 6e64 5f6c 6162 656c 3d22 3235  legend_label="25
+00039f40: 2d37 3525 222c 0a20 2020 2020 2020 2029  -75%",.        )
+00039f50: 0a20 2020 2020 2020 2066 6967 2e70 6174  .        fig.pat
+00039f60: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+00039f70: 7769 6e64 6f77 5f73 697a 6573 202b 2077  window_sizes + w
+00039f80: 696e 646f 775f 7369 7a65 735b 3a3a 2d31  indow_sizes[::-1
+00039f90: 5d2c 0a20 2020 2020 2020 2020 2020 2071  ],.            q
+00039fa0: 3935 202b 2071 3035 5b3a 3a2d 315d 2c0a  95 + q05[::-1],.
+00039fb0: 2020 2020 2020 2020 2020 2020 616c 7068              alph
+00039fc0: 613d 302e 352c 0a20 2020 2020 2020 2020  a=0.5,.         
+00039fd0: 2020 206c 696e 655f 7769 6474 683d 322c     line_width=2,
+00039fe0: 0a20 2020 2020 2020 2020 2020 206c 6567  .            leg
+00039ff0: 656e 645f 6c61 6265 6c3d 2235 2d39 3525  end_label="5-95%
+0003a000: 222c 0a20 2020 2020 2020 2029 0a20 2020  ",.        ).   
+0003a010: 2020 2020 2066 6967 2e6c 696e 6528 0a20       fig.line(. 
+0003a020: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+0003a030: 775f 7369 7a65 732c 2071 3530 2c20 6c69  w_sizes, q50, li
+0003a040: 6e65 5f63 6f6c 6f72 3d22 626c 6163 6b22  ne_color="black"
+0003a050: 2c20 6c69 6e65 5f77 6964 7468 3d34 2c20  , line_width=4, 
+0003a060: 6c65 6765 6e64 5f6c 6162 656c 3d22 6d65  legend_label="me
+0003a070: 6469 616e 220a 2020 2020 2020 2020 290a  dian".        ).
+0003a080: 2020 2020 2020 2020 6669 672e 6369 7263          fig.circ
+0003a090: 6c65 2877 696e 646f 775f 7369 7a65 732c  le(window_sizes,
+0003a0a0: 2071 3530 2c20 636f 6c6f 723d 2262 6c61   q50, color="bla
+0003a0b0: 636b 222c 2066 696c 6c5f 636f 6c6f 723d  ck", fill_color=
+0003a0c0: 2262 6c61 636b 222c 2073 697a 653d 3829  "black", size=8)
+0003a0d0: 0a0a 2020 2020 2020 2020 6669 672e 7861  ..        fig.xa
+0003a0e0: 7869 732e 7469 636b 6572 203d 2077 696e  xis.ticker = win
+0003a0f0: 646f 775f 7369 7a65 730a 2020 2020 2020  dow_sizes.      
+0003a100: 2020 6669 672e 785f 7261 6e67 6520 3d20    fig.x_range = 
+0003a110: 626f 6b65 682e 6d6f 6465 6c73 2e52 616e  bokeh.models.Ran
+0003a120: 6765 3164 2877 696e 646f 775f 7369 7a65  ge1d(window_size
+0003a130: 735b 305d 2c20 7769 6e64 6f77 5f73 697a  s[0], window_siz
+0003a140: 6573 5b2d 315d 290a 2020 2020 2020 2020  es[-1]).        
+0003a150: 6966 2074 6974 6c65 2069 7320 4e6f 6e65  if title is None
+0003a160: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+0003a170: 746c 6520 3d20 7361 6d70 6c65 5f71 7565  tle = sample_que
+0003a180: 7279 0a20 2020 2020 2020 2066 6967 2e74  ry.        fig.t
+0003a190: 6974 6c65 203d 2074 6974 6c65 0a20 2020  itle = title.   
+0003a1a0: 2020 2020 2062 6f6b 6568 2e70 6c6f 7474       bokeh.plott
+0003a1b0: 696e 672e 7368 6f77 2866 6967 290a 0a20  ing.show(fig).. 
+0003a1c0: 2020 2040 646f 6328 0a20 2020 2020 2020     @doc(.       
+0003a1d0: 2073 756d 6d61 7279 3d22 2222 0a20 2020   summary=""".   
+0003a1e0: 2020 2020 2020 2020 2048 6965 7261 7263           Hierarc
+0003a1f0: 6869 6361 6c6c 7920 636c 7573 7465 7220  hically cluster 
+0003a200: 6861 706c 6f74 7970 6573 2069 6e20 7265  haplotypes in re
+0003a210: 6769 6f6e 2061 6e64 2070 726f 6475 6365  gion and produce
+0003a220: 2061 6e20 696e 7465 7261 6374 6976 6520   an interactive 
+0003a230: 706c 6f74 2e0a 2020 2020 2020 2020 2222  plot..        ""
+0003a240: 222c 0a20 2020 2020 2020 2070 6172 616d  ",.        param
+0003a250: 6574 6572 733d 6469 6374 280a 2020 2020  eters=dict(.    
+0003a260: 2020 2020 2020 2020 6b77 6172 6773 3d22          kwargs="
+0003a270: 5061 7373 6564 2074 6872 6f75 6768 2074  Passed through t
+0003a280: 6f20 6070 782e 7363 6174 7465 7228 2960  o `px.scatter()`
+0003a290: 2e22 2c0a 2020 2020 2020 2020 292c 0a20  .",.        ),. 
+0003a2a0: 2020 2029 0a20 2020 2064 6566 2070 6c6f     ).    def plo
+0003a2b0: 745f 6861 706c 6f74 7970 655f 636c 7573  t_haplotype_clus
+0003a2c0: 7465 7269 6e67 280a 2020 2020 2020 2020  tering(.        
+0003a2d0: 7365 6c66 2c0a 2020 2020 2020 2020 7265  self,.        re
+0003a2e0: 6769 6f6e 3a20 6261 7365 5f70 6172 616d  gion: base_param
+0003a2f0: 732e 7265 6769 6f6e 2c0a 2020 2020 2020  s.region,.      
+0003a300: 2020 616e 616c 7973 6973 3a20 6861 705f    analysis: hap_
+0003a310: 7061 7261 6d73 2e61 6e61 6c79 7369 7320  params.analysis 
+0003a320: 3d20 4445 4641 554c 542c 0a20 2020 2020  = DEFAULT,.     
+0003a330: 2020 2073 616d 706c 655f 7365 7473 3a20     sample_sets: 
+0003a340: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0003a350: 7261 6d73 2e73 616d 706c 655f 7365 7473  rams.sample_sets
+0003a360: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0003a370: 2020 7361 6d70 6c65 5f71 7565 7279 3a20    sample_query: 
+0003a380: 4f70 7469 6f6e 616c 5b62 6173 655f 7061  Optional[base_pa
+0003a390: 7261 6d73 2e73 616d 706c 655f 7175 6572  rams.sample_quer
+0003a3a0: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
+0003a3b0: 2020 2063 6f6c 6f72 3a20 706c 6f74 6c79     color: plotly
+0003a3c0: 5f70 6172 616d 732e 636f 6c6f 7220 3d20  _params.color = 
+0003a3d0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7379  None,.        sy
+0003a3e0: 6d62 6f6c 3a20 706c 6f74 6c79 5f70 6172  mbol: plotly_par
+0003a3f0: 616d 732e 7379 6d62 6f6c 203d 204e 6f6e  ams.symbol = Non
+0003a400: 652c 0a20 2020 2020 2020 206c 696e 6b61  e,.        linka
+0003a410: 6765 5f6d 6574 686f 643a 2068 6170 636c  ge_method: hapcl
+0003a420: 7573 745f 7061 7261 6d73 2e6c 696e 6b61  ust_params.linka
+0003a430: 6765 5f6d 6574 686f 6420 3d20 6861 7063  ge_method = hapc
+0003a440: 6c75 7374 5f70 6172 616d 732e 6c69 6e6b  lust_params.link
+0003a450: 6167 655f 6d65 7468 6f64 5f64 6566 6175  age_method_defau
+0003a460: 6c74 2c0a 2020 2020 2020 2020 636f 756e  lt,.        coun
+0003a470: 745f 736f 7274 3a20 6861 7063 6c75 7374  t_sort: hapclust
+0003a480: 5f70 6172 616d 732e 636f 756e 745f 736f  _params.count_so
+0003a490: 7274 203d 2054 7275 652c 0a20 2020 2020  rt = True,.     
+0003a4a0: 2020 2064 6973 7461 6e63 655f 736f 7274     distance_sort
+0003a4b0: 3a20 6861 7063 6c75 7374 5f70 6172 616d  : hapclust_param
+0003a4c0: 732e 6469 7374 616e 6365 5f73 6f72 7420  s.distance_sort 
+0003a4d0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0003a4e0: 2063 6f68 6f72 745f 7369 7a65 3a20 4f70   cohort_size: Op
+0003a4f0: 7469 6f6e 616c 5b62 6173 655f 7061 7261  tional[base_para
+0003a500: 6d73 2e63 6f68 6f72 745f 7369 7a65 5d20  ms.cohort_size] 
+0003a510: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0003a520: 7261 6e64 6f6d 5f73 6565 643a 2062 6173  random_seed: bas
+0003a530: 655f 7061 7261 6d73 2e72 616e 646f 6d5f  e_params.random_
+0003a540: 7365 6564 203d 2034 322c 0a20 2020 2020  seed = 42,.     
+0003a550: 2020 2077 6964 7468 3a20 706c 6f74 6c79     width: plotly
+0003a560: 5f70 6172 616d 732e 7769 6474 6820 3d20  _params.width = 
+0003a570: 3130 3030 2c0a 2020 2020 2020 2020 6865  1000,.        he
+0003a580: 6967 6874 3a20 706c 6f74 6c79 5f70 6172  ight: plotly_par
+0003a590: 616d 732e 6865 6967 6874 203d 2035 3030  ams.height = 500
+0003a5a0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+0003a5b0: 6773 2c0a 2020 2020 2920 2d3e 2070 6c6f  gs,.    ) -> plo
+0003a5c0: 746c 795f 7061 7261 6d73 2e66 6967 7572  tly_params.figur
+0003a5d0: 653a 0a20 2020 2020 2020 2066 726f 6d20  e:.        from 
+0003a5e0: 7363 6970 792e 636c 7573 7465 722e 6869  scipy.cluster.hi
+0003a5f0: 6572 6172 6368 7920 696d 706f 7274 206c  erarchy import l
+0003a600: 696e 6b61 6765 0a0a 2020 2020 2020 2020  inkage..        
+0003a610: 6672 6f6d 202e 706c 6f74 6c79 5f64 656e  from .plotly_den
+0003a620: 6472 6f67 7261 6d20 696d 706f 7274 2063  drogram import c
+0003a630: 7265 6174 655f 6465 6e64 726f 6772 616d  reate_dendrogram
+0003a640: 0a0a 2020 2020 2020 2020 6465 6275 6720  ..        debug 
+0003a650: 3d20 7365 6c66 2e5f 6c6f 672e 6465 6275  = self._log.debu
+0003a660: 670a 0a20 2020 2020 2020 2064 735f 6861  g..        ds_ha
+0003a670: 7073 203d 2073 656c 662e 6861 706c 6f74  ps = self.haplot
+0003a680: 7970 6573 280a 2020 2020 2020 2020 2020  ypes(.          
+0003a690: 2020 7265 6769 6f6e 3d72 6567 696f 6e2c    region=region,
+0003a6a0: 0a20 2020 2020 2020 2020 2020 2061 6e61  .            ana
+0003a6b0: 6c79 7369 733d 616e 616c 7973 6973 2c0a  lysis=analysis,.
+0003a6c0: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+0003a6d0: 6c65 5f71 7565 7279 3d73 616d 706c 655f  le_query=sample_
+0003a6e0: 7175 6572 792c 0a20 2020 2020 2020 2020  query,.         
+0003a6f0: 2020 2073 616d 706c 655f 7365 7473 3d73     sample_sets=s
+0003a700: 616d 706c 655f 7365 7473 2c0a 2020 2020  ample_sets,.    
+0003a710: 2020 2020 2020 2020 636f 686f 7274 5f73          cohort_s
+0003a720: 697a 653d 636f 686f 7274 5f73 697a 652c  ize=cohort_size,
+0003a730: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
+0003a740: 646f 6d5f 7365 6564 3d72 616e 646f 6d5f  dom_seed=random_
+0003a750: 7365 6564 2c0a 2020 2020 2020 2020 290a  seed,.        ).
+0003a760: 0a20 2020 2020 2020 2067 7420 3d20 616c  .        gt = al
+0003a770: 6c65 6c2e 4765 6e6f 7479 7065 4461 736b  lel.GenotypeDask
+0003a780: 4172 7261 7928 6473 5f68 6170 735b 2263  Array(ds_haps["c
+0003a790: 616c 6c5f 6765 6e6f 7479 7065 225d 2e64  all_genotype"].d
+0003a7a0: 6174 6129 0a20 2020 2020 2020 2077 6974  ata).        wit
+0003a7b0: 6820 7365 6c66 2e5f 6461 736b 5f70 726f  h self._dask_pro
+0003a7c0: 6772 6573 7328 6465 7363 3d22 4c6f 6164  gress(desc="Load
+0003a7d0: 2068 6170 6c6f 7479 7065 7322 293a 0a20   haplotypes"):. 
+0003a7e0: 2020 2020 2020 2020 2020 2068 7420 3d20             ht = 
+0003a7f0: 6774 2e74 6f5f 6861 706c 6f74 7970 6573  gt.to_haplotypes
+0003a800: 2829 2e63 6f6d 7075 7465 2829 0a0a 2020  ().compute()..  
+0003a810: 2020 2020 2020 6465 6275 6728 226c 6f61        debug("loa
+0003a820: 6420 7361 6d70 6c65 206d 6574 6164 6174  d sample metadat
+0003a830: 6122 290a 2020 2020 2020 2020 6466 5f73  a").        df_s
+0003a840: 616d 706c 6573 203d 2073 656c 662e 7361  amples = self.sa
+0003a850: 6d70 6c65 5f6d 6574 6164 6174 6128 0a20  mple_metadata(. 
+0003a860: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+0003a870: 655f 7365 7473 3d73 616d 706c 655f 7365  e_sets=sample_se
+0003a880: 7473 2c20 7361 6d70 6c65 5f71 7565 7279  ts, sample_query
+0003a890: 3d73 616d 706c 655f 7175 6572 790a 2020  =sample_query.  
+0003a8a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0003a8b0: 6465 6275 6728 2261 6c69 676e 2073 616d  debug("align sam
+0003a8c0: 706c 6520 6d65 7461 6461 7461 2077 6974  ple metadata wit
+0003a8d0: 6820 6861 706c 6f74 7970 6573 2229 0a20  h haplotypes"). 
+0003a8e0: 2020 2020 2020 2070 6861 7365 645f 7361         phased_sa
+0003a8f0: 6d70 6c65 7320 3d20 6473 5f68 6170 735b  mples = ds_haps[
+0003a900: 2273 616d 706c 655f 6964 225d 2e76 616c  "sample_id"].val
+0003a910: 7565 732e 746f 6c69 7374 2829 0a20 2020  ues.tolist().   
+0003a920: 2020 2020 2064 665f 7361 6d70 6c65 735f       df_samples_
+0003a930: 7068 6173 6564 203d 2028 0a20 2020 2020  phased = (.     
+0003a940: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
+0003a950: 732e 7365 745f 696e 6465 7828 2273 616d  s.set_index("sam
+0003a960: 706c 655f 6964 2229 2e6c 6f63 5b70 6861  ple_id").loc[pha
+0003a970: 7365 645f 7361 6d70 6c65 735d 2e72 6573  sed_samples].res
+0003a980: 6574 5f69 6e64 6578 2829 0a20 2020 2020  et_index().     
+0003a990: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
+0003a9a0: 6275 6728 2273 6574 2075 7020 706c 6f74  bug("set up plot
+0003a9b0: 7469 6e67 206f 7074 696f 6e73 2229 0a20  ting options"). 
+0003a9c0: 2020 2020 2020 2068 6f76 6572 5f64 6174         hover_dat
+0003a9d0: 6120 3d20 5b0a 2020 2020 2020 2020 2020  a = [.          
+0003a9e0: 2020 2273 616d 706c 655f 6964 222c 0a20    "sample_id",. 
+0003a9f0: 2020 2020 2020 2020 2020 2022 7061 7274             "part
+0003aa00: 6e65 725f 7361 6d70 6c65 5f69 6422 2c0a  ner_sample_id",.
+0003aa10: 2020 2020 2020 2020 2020 2020 2273 616d              "sam
+0003aa20: 706c 655f 7365 7422 2c0a 2020 2020 2020  ple_set",.      
+0003aa30: 2020 2020 2020 2274 6178 6f6e 222c 0a20        "taxon",. 
+0003aa40: 2020 2020 2020 2020 2020 2022 636f 756e             "coun
+0003aa50: 7472 7922 2c0a 2020 2020 2020 2020 2020  try",.          
+0003aa60: 2020 2261 646d 696e 315f 6973 6f22 2c0a    "admin1_iso",.
+0003aa70: 2020 2020 2020 2020 2020 2020 2261 646d              "adm
+0003aa80: 696e 315f 6e61 6d65 222c 0a20 2020 2020  in1_name",.     
+0003aa90: 2020 2020 2020 2022 6164 6d69 6e32 5f6e         "admin2_n
+0003aaa0: 616d 6522 2c0a 2020 2020 2020 2020 2020  ame",.          
+0003aab0: 2020 226c 6f63 6174 696f 6e22 2c0a 2020    "location",.  
+0003aac0: 2020 2020 2020 2020 2020 2279 6561 7222            "year"
+0003aad0: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
+0003aae0: 6f6e 7468 222c 0a20 2020 2020 2020 205d  onth",.        ]
+0003aaf0: 0a0a 2020 2020 2020 2020 6966 2063 6f6c  ..        if col
+0003ab00: 6f72 2061 6e64 2063 6f6c 6f72 206e 6f74  or and color not
+0003ab10: 2069 6e20 686f 7665 725f 6461 7461 3a0a   in hover_data:.
+0003ab20: 2020 2020 2020 2020 2020 2020 686f 7665              hove
+0003ab30: 725f 6461 7461 2e61 7070 656e 6428 636f  r_data.append(co
+0003ab40: 6c6f 7229 0a20 2020 2020 2020 2069 6620  lor).        if 
+0003ab50: 7379 6d62 6f6c 2061 6e64 2073 796d 626f  symbol and symbo
+0003ab60: 6c20 6e6f 7420 696e 2068 6f76 6572 5f64  l not in hover_d
+0003ab70: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+0003ab80: 2068 6f76 6572 5f64 6174 612e 6170 7065   hover_data.appe
+0003ab90: 6e64 2873 796d 626f 6c29 0a0a 2020 2020  nd(symbol)..    
+0003aba0: 2020 2020 706c 6f74 5f6b 7761 7267 7320      plot_kwargs 
+0003abb0: 3d20 6469 6374 280a 2020 2020 2020 2020  = dict(.        
+0003abc0: 2020 2020 7465 6d70 6c61 7465 3d22 7369      template="si
+0003abd0: 6d70 6c65 5f77 6869 7465 222c 0a20 2020  mple_white",.   
+0003abe0: 2020 2020 2020 2020 2068 6f76 6572 5f6e           hover_n
+0003abf0: 616d 653d 2273 616d 706c 655f 6964 222c  ame="sample_id",
+0003ac00: 0a20 2020 2020 2020 2020 2020 2068 6f76  .            hov
+0003ac10: 6572 5f64 6174 613d 686f 7665 725f 6461  er_data=hover_da
+0003ac20: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
+0003ac30: 7265 6e64 6572 5f6d 6f64 653d 2273 7667  render_mode="svg
+0003ac40: 222c 0a20 2020 2020 2020 2029 0a0a 2020  ",.        )..  
+0003ac50: 2020 2020 2020 6465 6275 6728 2273 7065        debug("spe
+0003ac60: 6369 616c 2068 616e 646c 696e 6720 666f  cial handling fo
+0003ac70: 7220 7461 786f 6e20 636f 6c6f 7222 290a  r taxon color").
+0003ac80: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
+0003ac90: 203d 3d20 2274 6178 6f6e 223a 0a20 2020   == "taxon":.   
+0003aca0: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+0003acb0: 6574 7570 5f74 6178 6f6e 5f63 6f6c 6f72  etup_taxon_color
+0003acc0: 7328 706c 6f74 5f6b 7761 7267 7329 0a0a  s(plot_kwargs)..
+0003acd0: 2020 2020 2020 2020 6465 6275 6728 2261          debug("a
+0003ace0: 7070 6c79 2061 6e79 2075 7365 7220 6f76  pply any user ov
+0003acf0: 6572 7269 6465 7322 290a 2020 2020 2020  errides").      
+0003ad00: 2020 706c 6f74 5f6b 7761 7267 732e 7570    plot_kwargs.up
+0003ad10: 6461 7465 286b 7761 7267 7329 0a0a 2020  date(kwargs)..  
+0003ad20: 2020 2020 2020 6465 6275 6728 2243 7265        debug("Cre
+0003ad30: 6174 6520 6465 6e64 726f 6772 616d 2077  ate dendrogram w
+0003ad40: 6974 6820 706c 6f74 6c79 2229 0a20 2020  ith plotly").   
+0003ad50: 2020 2020 2023 2073 6574 206c 6162 656c       # set label
+0003ad60: 7320 6173 2074 6865 2069 6e64 6578 2077  s as the index w
+0003ad70: 6869 6368 2077 6520 6578 7472 6163 7420  hich we extract 
+0003ad80: 746f 2072 656f 7264 6572 206d 6574 6164  to reorder metad
+0003ad90: 6174 610a 2020 2020 2020 2020 6c65 6166  ata.        leaf
+0003ada0: 5f6c 6162 656c 7320 3d20 6e70 2e61 7261  _labels = np.ara
+0003adb0: 6e67 6528 6874 2e73 6861 7065 5b31 5d29  nge(ht.shape[1])
+0003adc0: 0a20 2020 2020 2020 2023 2067 6574 2074  .        # get t
+0003add0: 6865 206d 6178 2064 6973 7461 6e63 652c  he max distance,
+0003ade0: 2072 6571 7569 7265 6420 746f 2073 6574   required to set
+0003adf0: 2078 6d69 6e2c 2078 6d61 782c 2077 6869   xmin, xmax, whi
+0003ae00: 6368 2077 6520 6e65 6564 2078 6d69 6e20  ch we need xmin 
+0003ae10: 746f 2062 6520 736c 6967 6874 6c79 2062  to be slightly b
+0003ae20: 656c 6f77 2030 0a20 2020 2020 2020 206d  elow 0.        m
+0003ae30: 6178 5f64 6973 7420 3d20 5f67 6574 5f6d  ax_dist = _get_m
+0003ae40: 6178 5f68 616d 6d69 6e67 5f64 6973 7461  ax_hamming_dista
+0003ae50: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+0003ae60: 2068 742e 542c 206d 6574 7269 633d 2268   ht.T, metric="h
+0003ae70: 616d 6d69 6e67 222c 206c 696e 6b61 6765  amming", linkage
+0003ae80: 5f6d 6574 686f 643d 6c69 6e6b 6167 655f  _method=linkage_
+0003ae90: 6d65 7468 6f64 0a20 2020 2020 2020 2029  method.        )
+0003aea0: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
+0003aeb0: 7065 6374 696f 6e20 5079 5479 7065 4368  pection PyTypeCh
+0003aec0: 6563 6b65 720a 2020 2020 2020 2020 6669  ecker.        fi
+0003aed0: 6720 3d20 6372 6561 7465 5f64 656e 6472  g = create_dendr
+0003aee0: 6f67 7261 6d28 0a20 2020 2020 2020 2020  ogram(.         
+0003aef0: 2020 2068 742e 542c 0a20 2020 2020 2020     ht.T,.       
+0003af00: 2020 2020 2064 6973 7466 756e 3d6c 616d       distfun=lam
+0003af10: 6264 6120 783a 205f 6861 6d6d 696e 675f  bda x: _hamming_
+0003af20: 746f 5f73 6e70 7328 7829 2c0a 2020 2020  to_snps(x),.    
+0003af30: 2020 2020 2020 2020 6c69 6e6b 6167 6566          linkagef
+0003af40: 756e 3d6c 616d 6264 6120 783a 206c 696e  un=lambda x: lin
+0003af50: 6b61 6765 2878 2c20 6d65 7468 6f64 3d6c  kage(x, method=l
+0003af60: 696e 6b61 6765 5f6d 6574 686f 6429 2c0a  inkage_method),.
+0003af70: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+0003af80: 6c73 3d6c 6561 665f 6c61 6265 6c73 2c0a  ls=leaf_labels,.
+0003af90: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0003afa0: 725f 7468 7265 7368 6f6c 643d 302c 0a20  r_threshold=0,. 
+0003afb0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+0003afc0: 5f73 6f72 743d 636f 756e 745f 736f 7274  _sort=count_sort
+0003afd0: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
+0003afe0: 7374 616e 6365 5f73 6f72 743d 6469 7374  stance_sort=dist
+0003aff0: 616e 6365 5f73 6f72 742c 0a20 2020 2020  ance_sort,.     
+0003b000: 2020 2029 0a20 2020 2020 2020 2066 6967     ).        fig
+0003b010: 2e75 7064 6174 655f 7472 6163 6573 280a  .update_traces(.
+0003b020: 2020 2020 2020 2020 2020 2020 686f 7665              hove
+0003b030: 7269 6e66 6f3d 2279 222c 0a20 2020 2020  rinfo="y",.     
+0003b040: 2020 2020 2020 206c 696e 653d 6469 6374         line=dict
+0003b050: 2877 6964 7468 3d30 2e35 2c20 636f 6c6f  (width=0.5, colo
+0003b060: 723d 2262 6c61 636b 2229 2c0a 2020 2020  r="black"),.    
+0003b070: 2020 2020 290a 0a20 2020 2020 2020 2074      )..        t
+0003b080: 6974 6c65 5f6c 696e 6573 203d 205b 5d0a  itle_lines = [].
+0003b090: 2020 2020 2020 2020 6966 2073 616d 706c          if sampl
+0003b0a0: 655f 7365 7473 2069 7320 6e6f 7420 4e6f  e_sets is not No
+0003b0b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0003b0c0: 7469 746c 655f 6c69 6e65 732e 6170 7065  title_lines.appe
+0003b0d0: 6e64 2866 2273 616d 706c 6520 7365 7473  nd(f"sample sets
+0003b0e0: 3a20 7b73 616d 706c 655f 7365 7473 7d22  : {sample_sets}"
+0003b0f0: 290a 2020 2020 2020 2020 6966 2073 616d  ).        if sam
+0003b100: 706c 655f 7175 6572 7920 6973 206e 6f74  ple_query is not
+0003b110: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0003b120: 2020 2074 6974 6c65 5f6c 696e 6573 2e61     title_lines.a
+0003b130: 7070 656e 6428 6622 7361 6d70 6c65 2071  ppend(f"sample q
+0003b140: 7565 7279 3a20 7b73 616d 706c 655f 7175  uery: {sample_qu
+0003b150: 6572 797d 2229 0a20 2020 2020 2020 2074  ery}").        t
+0003b160: 6974 6c65 5f6c 696e 6573 2e61 7070 656e  itle_lines.appen
+0003b170: 6428 6622 6765 6e6f 6d69 6320 7265 6769  d(f"genomic regi
+0003b180: 6f6e 3a20 7b72 6567 696f 6e7d 2028 7b68  on: {region} ({h
+0003b190: 742e 7368 6170 655b 305d 7d20 534e 5073  t.shape[0]} SNPs
+0003b1a0: 2922 290a 2020 2020 2020 2020 7469 746c  )").        titl
+0003b1b0: 6520 3d20 223c 6272 3e22 2e6a 6f69 6e28  e = "<br>".join(
+0003b1c0: 7469 746c 655f 6c69 6e65 7329 0a0a 2020  title_lines)..  
+0003b1d0: 2020 2020 2020 6669 672e 7570 6461 7465        fig.update
+0003b1e0: 5f6c 6179 6f75 7428 0a20 2020 2020 2020  _layout(.       
+0003b1f0: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
+0003b200: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+0003b210: 6967 6874 3d68 6569 6768 742c 0a20 2020  ight=height,.   
+0003b220: 2020 2020 2020 2020 2074 6974 6c65 3d74           title=t
+0003b230: 6974 6c65 2c0a 2020 2020 2020 2020 2020  itle,.          
+0003b240: 2020 6175 746f 7369 7a65 3d54 7275 652c    autosize=True,
+0003b250: 0a20 2020 2020 2020 2020 2020 2068 6f76  .            hov
+0003b260: 6572 6d6f 6465 3d22 636c 6f73 6573 7422  ermode="closest"
+0003b270: 2c0a 2020 2020 2020 2020 2020 2020 706c  ,.            pl
+0003b280: 6f74 5f62 6763 6f6c 6f72 3d22 7768 6974  ot_bgcolor="whit
+0003b290: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+0003b2a0: 7961 7869 735f 7469 746c 653d 2244 6973  yaxis_title="Dis
+0003b2b0: 7461 6e63 6520 286e 6f2e 2053 4e50 7329  tance (no. SNPs)
+0003b2c0: 222c 0a20 2020 2020 2020 2020 2020 2078  ",.            x
+0003b2d0: 6178 6973 5f74 6974 6c65 3d22 4861 706c  axis_title="Hapl
+0003b2e0: 6f74 7970 6573 222c 0a20 2020 2020 2020  otypes",.       
+0003b2f0: 2020 2020 2073 686f 776c 6567 656e 643d       showlegend=
+0003b300: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
+0003b310: 0a20 2020 2020 2020 2023 2052 6570 6561  .        # Repea
+0003b320: 7420 7468 6520 6461 7461 6672 616d 6520  t the dataframe 
+0003b330: 736f 2074 6865 7265 2069 7320 6f6e 6520  so there is one 
+0003b340: 726f 7720 6f66 206d 6574 6164 6174 6120  row of metadata 
+0003b350: 666f 7220 6561 6368 2068 6170 6c6f 7479  for each haploty
+0003b360: 7065 0a20 2020 2020 2020 2064 665f 7361  pe.        df_sa
+0003b370: 6d70 6c65 735f 7068 6173 6564 5f68 6170  mples_phased_hap
+0003b380: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
+0003b390: 280a 2020 2020 2020 2020 2020 2020 6e70  (.            np
+0003b3a0: 2e72 6570 6561 7428 6466 5f73 616d 706c  .repeat(df_sampl
+0003b3b0: 6573 5f70 6861 7365 642e 7661 6c75 6573  es_phased.values
+0003b3c0: 2c20 322c 2061 7869 733d 3029 0a20 2020  , 2, axis=0).   
+0003b3d0: 2020 2020 2029 0a20 2020 2020 2020 2064       ).        d
+0003b3e0: 665f 7361 6d70 6c65 735f 7068 6173 6564  f_samples_phased
+0003b3f0: 5f68 6170 732e 636f 6c75 6d6e 7320 3d20  _haps.columns = 
+0003b400: 6466 5f73 616d 706c 6573 5f70 6861 7365  df_samples_phase
+0003b410: 642e 636f 6c75 6d6e 730a 2020 2020 2020  d.columns.      
+0003b420: 2020 2320 7365 6c65 6374 206f 6e6c 7920    # select only 
+0003b430: 636f 6c75 6d6e 7320 696e 2068 6f76 6572  columns in hover
+0003b440: 5f64 6174 610a 2020 2020 2020 2020 6466  _data.        df
+0003b450: 5f73 616d 706c 6573 5f70 6861 7365 645f  _samples_phased_
+0003b460: 6861 7073 203d 2064 665f 7361 6d70 6c65  haps = df_sample
+0003b470: 735f 7068 6173 6564 5f68 6170 735b 686f  s_phased_haps[ho
+0003b480: 7665 725f 6461 7461 5d0a 2020 2020 2020  ver_data].      
+0003b490: 2020 6465 6275 6728 2252 656f 7264 6572    debug("Reorder
+0003b4a0: 2068 6170 6c6f 7479 7065 206d 6574 6164   haplotype metad
+0003b4b0: 6174 6120 746f 2061 6c69 676e 2077 6974  ata to align wit
+0003b4c0: 6820 6861 706c 6f74 7970 6520 636c 7573  h haplotype clus
+0003b4d0: 7465 7269 6e67 2229 0a20 2020 2020 2020  tering").       
+0003b4e0: 2064 665f 7361 6d70 6c65 735f 7068 6173   df_samples_phas
+0003b4f0: 6564 5f68 6170 7320 3d20 6466 5f73 616d  ed_haps = df_sam
+0003b500: 706c 6573 5f70 6861 7365 645f 6861 7073  ples_phased_haps
+0003b510: 2e6c 6f63 5b0a 2020 2020 2020 2020 2020  .loc[.          
+0003b520: 2020 6669 672e 6c61 796f 7574 2e78 6178    fig.layout.xax
+0003b530: 6973 5b22 7469 636b 7465 7874 225d 0a20  is["ticktext"]. 
+0003b540: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0003b550: 2066 6967 2e75 7064 6174 655f 7861 7865   fig.update_xaxe
+0003b560: 7328 6d69 7272 6f72 3d46 616c 7365 2c20  s(mirror=False, 
+0003b570: 7368 6f77 6772 6964 3d54 7275 652c 2073  showgrid=True, s
+0003b580: 686f 7774 6963 6b6c 6162 656c 733d 4661  howticklabels=Fa
+0003b590: 6c73 652c 2074 6963 6b73 3d22 2229 0a20  lse, ticks=""). 
+0003b5a0: 2020 2020 2020 2066 6967 2e75 7064 6174         fig.updat
+0003b5b0: 655f 7961 7865 7328 0a20 2020 2020 2020  e_yaxes(.       
+0003b5c0: 2020 2020 206d 6972 726f 723d 4661 6c73       mirror=Fals
+0003b5d0: 652c 2073 686f 7767 7269 643d 5472 7565  e, showgrid=True
+0003b5e0: 2c20 7368 6f77 6c69 6e65 3d54 7275 652c  , showline=True,
+0003b5f0: 2072 616e 6765 3d5b 2d32 2c20 6d61 785f   range=[-2, max_
+0003b600: 6469 7374 202b 2031 5d0a 2020 2020 2020  dist + 1].      
+0003b610: 2020 290a 0a20 2020 2020 2020 2064 6562    )..        deb
+0003b620: 7567 2822 4164 6420 7363 6174 7465 7220  ug("Add scatter 
+0003b630: 706c 6f74 2077 6974 6820 686f 7665 7220  plot with hover 
+0003b640: 7465 7874 2229 0a20 2020 2020 2020 2066  text").        f
+0003b650: 6967 2e61 6464 5f74 7261 6365 7328 0a20  ig.add_traces(. 
+0003b660: 2020 2020 2020 2020 2020 206c 6973 7428             list(
+0003b670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b680: 2070 782e 7363 6174 7465 7228 0a20 2020   px.scatter(.   
+0003b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b6a0: 2064 665f 7361 6d70 6c65 735f 7068 6173   df_samples_phas
+0003b6b0: 6564 5f68 6170 732c 0a20 2020 2020 2020  ed_haps,.       
+0003b6c0: 2020 2020 2020 2020 2020 2020 2078 3d66               x=f
+0003b6d0: 6967 2e6c 6179 6f75 742e 7861 7869 735b  ig.layout.xaxis[
+0003b6e0: 2274 6963 6b76 616c 7322 5d2c 0a20 2020  "tickvals"],.   
+0003b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b700: 2079 3d6e 702e 7265 7065 6174 282d 312c   y=np.repeat(-1,
+0003b710: 206c 656e 2868 742e 5429 292c 0a20 2020   len(ht.T)),.   
+0003b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b730: 2063 6f6c 6f72 3d63 6f6c 6f72 2c0a 2020   color=color,.  
+0003b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b750: 2020 7379 6d62 6f6c 3d73 796d 626f 6c2c    symbol=symbol,
+0003b760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b770: 2020 2020 202a 2a70 6c6f 745f 6b77 6172       **plot_kwar
+0003b780: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+0003b790: 2020 2020 292e 7365 6c65 6374 5f74 7261      ).select_tra
+0003b7a0: 6365 7328 290a 2020 2020 2020 2020 2020  ces().          
+0003b7b0: 2020 290a 2020 2020 2020 2020 290a 0a20    ).        ).. 
+0003b7c0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+0003b7d0: 670a 0a20 2020 2040 646f 6328 0a20 2020  g..    @doc(.   
+0003b7e0: 2020 2020 2073 756d 6d61 7279 3d22 2222       summary="""
+0003b7f0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
+0003b800: 7374 7275 6374 2061 206d 6564 6961 6e2d  struct a median-
+0003b810: 6a6f 696e 696e 6720 6861 706c 6f74 7970  joining haplotyp
+0003b820: 6520 6e65 7477 6f72 6b20 616e 6420 6469  e network and di
+0003b830: 7370 6c61 7920 6974 2075 7369 6e67 0a20  splay it using. 
+0003b840: 2020 2020 2020 2020 2020 2043 7974 6f73             Cytos
+0003b850: 6361 7065 2e0a 2020 2020 2020 2020 2222  cape..        ""
+0003b860: 222c 0a20 2020 2020 2020 2065 7874 656e  ",.        exten
+0003b870: 6465 645f 7375 6d6d 6172 793d 2222 220a  ded_summary=""".
+0003b880: 2020 2020 2020 2020 2020 2020 4120 6861              A ha
+0003b890: 706c 6f74 7970 6520 6e65 7477 6f72 6b20  plotype network 
+0003b8a0: 7072 6f76 6964 6573 2061 2076 6973 7561  provides a visua
+0003b8b0: 6c69 7361 7469 6f6e 206f 6620 7468 6520  lisation of the 
+0003b8c0: 6765 6e65 7469 6320 6469 7374 616e 6365  genetic distance
+0003b8d0: 0a20 2020 2020 2020 2020 2020 2062 6574  .            bet
+0003b8e0: 7765 656e 2068 6170 6c6f 7479 7065 5f20  ween haplotype_ 
+0003b8f0: 4561 6368 206e 6f64 6520 696e 2074 6865  Each node in the
+0003b900: 206e 6574 776f 726b 2072 6570 7265 7365   network represe
+0003b910: 6e74 7320 6120 756e 6971 7565 0a20 2020  nts a unique.   
+0003b920: 2020 2020 2020 2020 2068 6170 6c6f 7479           haploty
+0003b930: 7065 2e20 5468 6520 7369 7a65 2028 6172  pe. The size (ar
+0003b940: 6561 2920 6f66 2074 6865 206e 6f64 6520  ea) of the node 
+0003b950: 6973 2073 6361 6c65 6420 6279 2074 6865  is scaled by the
+0003b960: 206e 756d 6265 7220 6f66 0a20 2020 2020   number of.     
+0003b970: 2020 2020 2020 2074 696d 6573 2074 6861         times tha
+0003b980: 7420 756e 6971 7565 2068 6170 6c6f 7479  t unique haploty
+0003b990: 7065 2077 6173 206f 6273 6572 7665 6420  pe was observed 
+0003b9a0: 7769 7468 696e 2074 6865 2073 656c 6563  within the selec
+0003b9b0: 7465 6420 7361 6d70 6c65 732e 0a20 2020  ted samples..   
+0003b9c0: 2020 2020 2020 2020 2041 2063 6f6e 6e65           A conne
+0003b9d0: 6374 696f 6e20 6265 7477 6565 6e20 7477  ction between tw
+0003b9e0: 6f20 6e6f 6465 7320 7265 7072 6573 656e  o nodes represen
+0003b9f0: 7473 2061 2073 696e 676c 6520 534e 5020  ts a single SNP 
+0003ba00: 6469 6666 6572 656e 6365 0a20 2020 2020  difference.     
+0003ba10: 2020 2020 2020 2062 6574 7765 656e 2074         between t
+0003ba20: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
+0003ba30: 2068 6170 6c6f 7479 7065 732e 0a20 2020   haplotypes..   
+0003ba40: 2020 2020 2022 2222 2c0a 2020 2020 290a       """,.    ).
+0003ba50: 2020 2020 6465 6620 706c 6f74 5f68 6170      def plot_hap
+0003ba60: 6c6f 7479 7065 5f6e 6574 776f 726b 280a  lotype_network(.
+0003ba70: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0003ba80: 2020 2020 2020 7265 6769 6f6e 3a20 6261        region: ba
+0003ba90: 7365 5f70 6172 616d 732e 7265 6769 6f6e  se_params.region
+0003baa0: 2c0a 2020 2020 2020 2020 616e 616c 7973  ,.        analys
+0003bab0: 6973 3a20 6861 705f 7061 7261 6d73 2e61  is: hap_params.a
+0003bac0: 6e61 6c79 7369 7320 3d20 4445 4641 554c  nalysis = DEFAUL
+0003bad0: 542c 0a20 2020 2020 2020 2073 616d 706c  T,.        sampl
+0003bae0: 655f 7365 7473 3a20 4f70 7469 6f6e 616c  e_sets: Optional
+0003baf0: 5b62 6173 655f 7061 7261 6d73 2e73 616d  [base_params.sam
+0003bb00: 706c 655f 7365 7473 5d20 3d20 4e6f 6e65  ple_sets] = None
+0003bb10: 2c0a 2020 2020 2020 2020 7361 6d70 6c65  ,.        sample
+0003bb20: 5f71 7565 7279 3a20 4f70 7469 6f6e 616c  _query: Optional
+0003bb30: 5b62 6173 655f 7061 7261 6d73 2e73 616d  [base_params.sam
+0003bb40: 706c 655f 7175 6572 795d 203d 204e 6f6e  ple_query] = Non
+0003bb50: 652c 0a20 2020 2020 2020 206d 6178 5f64  e,.        max_d
+0003bb60: 6973 743a 2068 6170 6e65 745f 7061 7261  ist: hapnet_para
+0003bb70: 6d73 2e6d 6178 5f64 6973 7420 3d20 6861  ms.max_dist = ha
+0003bb80: 706e 6574 5f70 6172 616d 732e 6d61 785f  pnet_params.max_
+0003bb90: 6469 7374 5f64 6566 6175 6c74 2c0a 2020  dist_default,.  
+0003bba0: 2020 2020 2020 636f 6c6f 723a 204f 7074        color: Opt
+0003bbb0: 696f 6e61 6c5b 6861 706e 6574 5f70 6172  ional[hapnet_par
+0003bbc0: 616d 732e 636f 6c6f 725d 203d 204e 6f6e  ams.color] = Non
+0003bbd0: 652c 0a20 2020 2020 2020 2063 6f6c 6f72  e,.        color
+0003bbe0: 5f64 6973 6372 6574 655f 7365 7175 656e  _discrete_sequen
+0003bbf0: 6365 3a20 4f70 7469 6f6e 616c 5b68 6170  ce: Optional[hap
+0003bc00: 6e65 745f 7061 7261 6d73 2e63 6f6c 6f72  net_params.color
+0003bc10: 5f64 6973 6372 6574 655f 7365 7175 656e  _discrete_sequen
+0003bc20: 6365 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ce] = None,.    
+0003bc30: 2020 2020 636f 6c6f 725f 6469 7363 7265      color_discre
+0003bc40: 7465 5f6d 6170 3a20 4f70 7469 6f6e 616c  te_map: Optional
+0003bc50: 5b68 6170 6e65 745f 7061 7261 6d73 2e63  [hapnet_params.c
+0003bc60: 6f6c 6f72 5f64 6973 6372 6574 655f 6d61  olor_discrete_ma
+0003bc70: 705d 203d 204e 6f6e 652c 0a20 2020 2020  p] = None,.     
+0003bc80: 2020 2063 6174 6567 6f72 795f 6f72 6465     category_orde
+0003bc90: 7273 3a20 4f70 7469 6f6e 616c 5b68 6170  rs: Optional[hap
+0003bca0: 6e65 745f 7061 7261 6d73 2e63 6174 6567  net_params.categ
+0003bcb0: 6f72 795f 6f72 6465 725d 203d 204e 6f6e  ory_order] = Non
+0003bcc0: 652c 0a20 2020 2020 2020 206e 6f64 655f  e,.        node_
+0003bcd0: 7369 7a65 5f66 6163 746f 723a 2068 6170  size_factor: hap
+0003bce0: 6e65 745f 7061 7261 6d73 2e6e 6f64 655f  net_params.node_
+0003bcf0: 7369 7a65 5f66 6163 746f 7220 3d20 6861  size_factor = ha
+0003bd00: 706e 6574 5f70 6172 616d 732e 6e6f 6465  pnet_params.node
+0003bd10: 5f73 697a 655f 6661 6374 6f72 5f64 6566  _size_factor_def
+0003bd20: 6175 6c74 2c0a 2020 2020 2020 2020 6c61  ault,.        la
+0003bd30: 796f 7574 3a20 6861 706e 6574 5f70 6172  yout: hapnet_par
+0003bd40: 616d 732e 6c61 796f 7574 203d 2068 6170  ams.layout = hap
+0003bd50: 6e65 745f 7061 7261 6d73 2e6c 6179 6f75  net_params.layou
+0003bd60: 745f 6465 6661 756c 742c 0a20 2020 2020  t_default,.     
+0003bd70: 2020 206c 6179 6f75 745f 7061 7261 6d73     layout_params
+0003bd80: 3a20 4f70 7469 6f6e 616c 5b68 6170 6e65  : Optional[hapne
+0003bd90: 745f 7061 7261 6d73 2e6c 6179 6f75 745f  t_params.layout_
+0003bda0: 7061 7261 6d73 5d20 3d20 4e6f 6e65 2c0a  params] = None,.
+0003bdb0: 2020 2020 2020 2020 7365 7276 6572 5f70          server_p
+0003bdc0: 6f72 743a 204f 7074 696f 6e61 6c5b 6461  ort: Optional[da
+0003bdd0: 7368 5f70 6172 616d 732e 7365 7276 6572  sh_params.server
+0003bde0: 5f70 6f72 745d 203d 204e 6f6e 652c 0a20  _port] = None,. 
+0003bdf0: 2020 2020 2020 2073 6572 7665 725f 6d6f         server_mo
+0003be00: 6465 3a20 4f70 7469 6f6e 616c 5b0a 2020  de: Optional[.  
+0003be10: 2020 2020 2020 2020 2020 6461 7368 5f70            dash_p
+0003be20: 6172 616d 732e 7365 7276 6572 5f6d 6f64  arams.server_mod
+0003be30: 650a 2020 2020 2020 2020 5d20 3d20 6461  e.        ] = da
+0003be40: 7368 5f70 6172 616d 732e 7365 7276 6572  sh_params.server
+0003be50: 5f6d 6f64 655f 6465 6661 756c 742c 0a20  _mode_default,. 
+0003be60: 2020 2020 2020 2068 6569 6768 743a 2064         height: d
+0003be70: 6173 685f 7061 7261 6d73 2e68 6569 6768  ash_params.heigh
+0003be80: 7420 3d20 3635 302c 0a20 2020 2020 2020  t = 650,.       
+0003be90: 2077 6964 7468 3a20 4f70 7469 6f6e 616c   width: Optional
+0003bea0: 5b64 6173 685f 7061 7261 6d73 2e77 6964  [dash_params.wid
+0003beb0: 7468 5d20 3d20 2231 3030 2522 2c0a 2020  th] = "100%",.  
+0003bec0: 2020 293a 0a20 2020 2020 2020 2069 6d70    ):.        imp
+0003bed0: 6f72 7420 6461 7368 5f63 7974 6f73 6361  ort dash_cytosca
+0003bee0: 7065 2061 7320 6379 746f 0a20 2020 2020  pe as cyto.     
+0003bef0: 2020 2066 726f 6d20 6461 7368 2069 6d70     from dash imp
+0003bf00: 6f72 7420 6463 632c 2068 746d 6c0a 2020  ort dcc, html.  
+0003bf10: 2020 2020 2020 6672 6f6d 2064 6173 682e        from dash.
+0003bf20: 6465 7065 6e64 656e 6369 6573 2069 6d70  dependencies imp
+0003bf30: 6f72 7420 496e 7075 742c 204f 7574 7075  ort Input, Outpu
+0003bf40: 740a 2020 2020 2020 2020 6672 6f6d 206a  t.        from j
+0003bf50: 7570 7974 6572 5f64 6173 6820 696d 706f  upyter_dash impo
+0003bf60: 7274 204a 7570 7974 6572 4461 7368 0a0a  rt JupyterDash..
+0003bf70: 2020 2020 2020 2020 6966 206c 6179 6f75          if layou
+0003bf80: 7420 213d 2022 636f 7365 223a 0a20 2020  t != "cose":.   
+0003bf90: 2020 2020 2020 2020 2063 7974 6f2e 6c6f           cyto.lo
+0003bfa0: 6164 5f65 7874 7261 5f6c 6179 6f75 7473  ad_extra_layouts
+0003bfb0: 2829 0a20 2020 2020 2020 2023 206c 6561  ().        # lea
+0003bfc0: 7665 2074 6869 7320 666f 7220 7573 6572  ve this for user
+0003bfd0: 2063 6f64 652c 2069 6620 6e65 6564 6564   code, if needed
+0003bfe0: 2028 646f 6573 6e27 7420 7365 656d 206e   (doesn't seem n
+0003bff0: 6563 6573 7361 7279 206f 6e20 636f 6c61  ecessary on cola
+0003c000: 6229 0a20 2020 2020 2020 2023 204a 7570  b).        # Jup
+0003c010: 7974 6572 4461 7368 2e69 6e66 6572 5f6a  yterDash.infer_j
+0003c020: 7570 7974 6572 5f70 726f 7879 5f63 6f6e  upyter_proxy_con
+0003c030: 6669 6728 290a 0a20 2020 2020 2020 2064  fig()..        d
+0003c040: 6562 7567 203d 2073 656c 662e 5f6c 6f67  ebug = self._log
+0003c050: 2e64 6562 7567 0a0a 2020 2020 2020 2020  .debug..        
+0003c060: 6465 6275 6728 2261 6363 6573 7320 6861  debug("access ha
+0003c070: 706c 6f74 7970 6573 2064 6174 6173 6574  plotypes dataset
+0003c080: 2229 0a20 2020 2020 2020 2064 735f 6861  ").        ds_ha
+0003c090: 7073 203d 2073 656c 662e 6861 706c 6f74  ps = self.haplot
+0003c0a0: 7970 6573 280a 2020 2020 2020 2020 2020  ypes(.          
+0003c0b0: 2020 7265 6769 6f6e 3d72 6567 696f 6e2c    region=region,
+0003c0c0: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+0003c0d0: 706c 655f 7365 7473 3d73 616d 706c 655f  ple_sets=sample_
+0003c0e0: 7365 7473 2c0a 2020 2020 2020 2020 2020  sets,.          
+0003c0f0: 2020 7361 6d70 6c65 5f71 7565 7279 3d73    sample_query=s
+0003c100: 616d 706c 655f 7175 6572 792c 0a20 2020  ample_query,.   
+0003c110: 2020 2020 2020 2020 2061 6e61 6c79 7369           analysi
+0003c120: 733d 616e 616c 7973 6973 2c0a 2020 2020  s=analysis,.    
+0003c130: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+0003c140: 6562 7567 2822 6163 6365 7373 2073 616d  ebug("access sam
+0003c150: 706c 6520 6d65 7461 6461 7461 2229 0a20  ple metadata"). 
+0003c160: 2020 2020 2020 2064 665f 7361 6d70 6c65         df_sample
+0003c170: 7320 3d20 7365 6c66 2e73 616d 706c 655f  s = self.sample_
+0003c180: 6d65 7461 6461 7461 280a 2020 2020 2020  metadata(.      
+0003c190: 2020 2020 2020 7361 6d70 6c65 5f71 7565        sample_que
+0003c1a0: 7279 3d73 616d 706c 655f 7175 6572 792c  ry=sample_query,
+0003c1b0: 2073 616d 706c 655f 7365 7473 3d73 616d   sample_sets=sam
+0003c1c0: 706c 655f 7365 7473 0a20 2020 2020 2020  ple_sets.       
+0003c1d0: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
+0003c1e0: 6728 2273 6574 7570 2068 6170 6c6f 7479  g("setup haploty
+0003c1f0: 7065 206d 6574 6164 6174 6122 290a 2020  pe metadata").  
+0003c200: 2020 2020 2020 7361 6d70 6c65 735f 7068        samples_ph
+0003c210: 6173 6564 203d 2064 735f 6861 7073 5b22  ased = ds_haps["
+0003c220: 7361 6d70 6c65 5f69 6422 5d2e 7661 6c75  sample_id"].valu
+0003c230: 6573 0a20 2020 2020 2020 2064 665f 7361  es.        df_sa
+0003c240: 6d70 6c65 735f 7068 6173 6564 203d 2028  mples_phased = (
+0003c250: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+0003c260: 7361 6d70 6c65 732e 7365 745f 696e 6465  samples.set_inde
+0003c270: 7828 2273 616d 706c 655f 6964 2229 2e6c  x("sample_id").l
+0003c280: 6f63 5b73 616d 706c 6573 5f70 6861 7365  oc[samples_phase
+0003c290: 645d 2e72 6573 6574 5f69 6e64 6578 2829  d].reset_index()
+0003c2a0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0003c2b0: 2020 2064 665f 6861 7073 203d 2064 665f     df_haps = df_
+0003c2c0: 7361 6d70 6c65 735f 7068 6173 6564 2e6c  samples_phased.l
+0003c2d0: 6f63 5b64 665f 7361 6d70 6c65 735f 7068  oc[df_samples_ph
+0003c2e0: 6173 6564 2e69 6e64 6578 2e72 6570 6561  ased.index.repea
+0003c2f0: 7428 3229 5d2e 7265 7365 745f 696e 6465  t(2)].reset_inde
+0003c300: 7828 0a20 2020 2020 2020 2020 2020 2064  x(.            d
+0003c310: 726f 703d 5472 7565 0a20 2020 2020 2020  rop=True.       
+0003c320: 2029 0a0a 2020 2020 2020 2020 6465 6275   )..        debu
+0003c330: 6728 226c 6f61 6420 6861 706c 6f74 7970  g("load haplotyp
+0003c340: 6573 2229 0a20 2020 2020 2020 2067 7420  es").        gt 
+0003c350: 3d20 616c 6c65 6c2e 4765 6e6f 7479 7065  = allel.Genotype
+0003c360: 4461 736b 4172 7261 7928 6473 5f68 6170  DaskArray(ds_hap
+0003c370: 735b 2263 616c 6c5f 6765 6e6f 7479 7065  s["call_genotype
+0003c380: 225d 2e64 6174 6129 0a20 2020 2020 2020  "].data).       
+0003c390: 2077 6974 6820 7365 6c66 2e5f 6461 736b   with self._dask
+0003c3a0: 5f70 726f 6772 6573 7328 6465 7363 3d22  _progress(desc="
+0003c3b0: 4c6f 6164 2068 6170 6c6f 7479 7065 7322  Load haplotypes"
+0003c3c0: 293a 0a20 2020 2020 2020 2020 2020 2068  ):.            h
+0003c3d0: 7420 3d20 6774 2e74 6f5f 6861 706c 6f74  t = gt.to_haplot
+0003c3e0: 7970 6573 2829 2e63 6f6d 7075 7465 2829  ypes().compute()
+0003c3f0: 0a0a 2020 2020 2020 2020 6465 6275 6728  ..        debug(
+0003c400: 2263 6f75 6e74 2061 6c6c 656c 6573 2061  "count alleles a
+0003c410: 6e64 2073 656c 6563 7420 7365 6772 6567  nd select segreg
+0003c420: 6174 696e 6720 7369 7465 7322 290a 2020  ating sites").  
+0003c430: 2020 2020 2020 6163 203d 2067 742e 636f        ac = gt.co
+0003c440: 756e 745f 616c 6c65 6c65 7328 6d61 785f  unt_alleles(max_
+0003c450: 616c 6c65 6c65 3d31 290a 2020 2020 2020  allele=1).      
+0003c460: 2020 6c6f 635f 7365 6720 3d20 6163 2e69    loc_seg = ac.i
+0003c470: 735f 7365 6772 6567 6174 696e 6728 290a  s_segregating().
+0003c480: 2020 2020 2020 2020 6874 5f73 6567 203d          ht_seg =
+0003c490: 2068 745b 6c6f 635f 7365 675d 0a0a 2020   ht[loc_seg]..  
+0003c4a0: 2020 2020 2020 6465 6275 6728 2269 6465        debug("ide
+0003c4b0: 6e74 6966 7920 6469 7374 696e 6374 2068  ntify distinct h
+0003c4c0: 6170 6c6f 7479 7065 7322 290a 2020 2020  aplotypes").    
+0003c4d0: 2020 2020 6874 5f64 6973 7469 6e63 745f      ht_distinct_
+0003c4e0: 7365 7473 203d 2068 745f 7365 672e 6469  sets = ht_seg.di
+0003c4f0: 7374 696e 6374 2829 0a20 2020 2020 2020  stinct().       
+0003c500: 2023 2066 696e 6420 696e 6469 6365 7320   # find indices 
+0003c510: 6f66 2064 6973 7469 6e63 7420 6861 706c  of distinct hapl
+0003c520: 6f74 7970 6573 202d 206a 7573 7420 6e65  otypes - just ne
+0003c530: 6564 206f 6e65 2070 6572 2073 6574 0a20  ed one per set. 
+0003c540: 2020 2020 2020 2068 745f 6469 7374 696e         ht_distin
+0003c550: 6374 5f69 6e64 6963 6573 203d 205b 6d69  ct_indices = [mi
+0003c560: 6e28 7329 2066 6f72 2073 2069 6e20 6874  n(s) for s in ht
+0003c570: 5f64 6973 7469 6e63 745f 7365 7473 5d0a  _distinct_sets].
+0003c580: 2020 2020 2020 2020 2320 7265 6f72 6465          # reorde
+0003c590: 7220 6279 2069 6e64 6578 202d 2054 4f44  r by index - TOD
+0003c5a0: 4f20 6973 2074 6869 7320 6e65 6365 7373  O is this necess
+0003c5b0: 6172 793f 0a20 2020 2020 2020 2069 7820  ary?.        ix 
+0003c5c0: 3d20 6e70 2e61 7267 736f 7274 2868 745f  = np.argsort(ht_
+0003c5d0: 6469 7374 696e 6374 5f69 6e64 6963 6573  distinct_indices
+0003c5e0: 290a 2020 2020 2020 2020 6874 5f64 6973  ).        ht_dis
+0003c5f0: 7469 6e63 745f 696e 6469 6365 7320 3d20  tinct_indices = 
+0003c600: 5b68 745f 6469 7374 696e 6374 5f69 6e64  [ht_distinct_ind
+0003c610: 6963 6573 5b69 5d20 666f 7220 6920 696e  ices[i] for i in
+0003c620: 2069 785d 0a20 2020 2020 2020 2068 745f   ix].        ht_
+0003c630: 6469 7374 696e 6374 5f73 6574 7320 3d20  distinct_sets = 
+0003c640: 5b68 745f 6469 7374 696e 6374 5f73 6574  [ht_distinct_set
+0003c650: 735b 695d 2066 6f72 2069 2069 6e20 6978  s[i] for i in ix
+0003c660: 5d0a 2020 2020 2020 2020 2320 6f62 7461  ].        # obta
+0003c670: 696e 2061 6e20 6172 7261 7920 6f66 2064  in an array of d
+0003c680: 6973 7469 6e63 7420 6861 706c 6f74 7970  istinct haplotyp
+0003c690: 6573 0a20 2020 2020 2020 2068 745f 6469  es.        ht_di
+0003c6a0: 7374 696e 6374 203d 2068 745f 7365 672e  stinct = ht_seg.
+0003c6b0: 7461 6b65 2868 745f 6469 7374 696e 6374  take(ht_distinct
+0003c6c0: 5f69 6e64 6963 6573 2c20 6178 6973 3d31  _indices, axis=1
+0003c6d0: 290a 2020 2020 2020 2020 2320 636f 756e  ).        # coun
+0003c6e0: 7420 686f 7720 6d61 6e79 206f 6273 6572  t how many obser
+0003c6f0: 7661 7469 6f6e 7320 7065 7220 6469 7374  vations per dist
+0003c700: 696e 6374 2068 6170 6c6f 7479 7065 0a20  inct haplotype. 
+0003c710: 2020 2020 2020 2068 745f 636f 756e 7473         ht_counts
+0003c720: 203d 205b 6c65 6e28 7329 2066 6f72 2073   = [len(s) for s
+0003c730: 2069 6e20 6874 5f64 6973 7469 6e63 745f   in ht_distinct_
+0003c740: 7365 7473 5d0a 0a20 2020 2020 2020 2064  sets]..        d
+0003c750: 6562 7567 2822 636f 6e73 7472 7563 7420  ebug("construct 
+0003c760: 6d65 6469 616e 206a 6f69 6e69 6e67 206e  median joining n
+0003c770: 6574 776f 726b 2229 0a20 2020 2020 2020  etwork").       
+0003c780: 2068 745f 6469 7374 696e 6374 5f6d 6a6e   ht_distinct_mjn
+0003c790: 2c20 6564 6765 732c 2061 6c74 5f65 6467  , edges, alt_edg
+0003c7a0: 6573 203d 206d 6564 6961 6e5f 6a6f 696e  es = median_join
+0003c7b0: 696e 675f 6e65 7477 6f72 6b28 0a20 2020  ing_network(.   
+0003c7c0: 2020 2020 2020 2020 2068 745f 6469 7374           ht_dist
+0003c7d0: 696e 6374 2c20 6d61 785f 6469 7374 3d6d  inct, max_dist=m
+0003c7e0: 6178 5f64 6973 740a 2020 2020 2020 2020  ax_dist.        
+0003c7f0: 290a 2020 2020 2020 2020 6564 6765 7320  ).        edges 
+0003c800: 3d20 6e70 2e74 7269 7528 6564 6765 7329  = np.triu(edges)
+0003c810: 0a20 2020 2020 2020 2061 6c74 5f65 6467  .        alt_edg
+0003c820: 6573 203d 206e 702e 7472 6975 2861 6c74  es = np.triu(alt
+0003c830: 5f65 6467 6573 290a 0a20 2020 2020 2020  _edges)..       
+0003c840: 2064 6562 7567 2822 7365 7475 7020 636f   debug("setup co
+0003c850: 6c6f 7273 2229 0a20 2020 2020 2020 2063  lors").        c
+0003c860: 6f6c 6f72 5f76 616c 7565 7320 3d20 4e6f  olor_values = No
+0003c870: 6e65 0a20 2020 2020 2020 2063 6f6c 6f72  ne.        color
+0003c880: 5f76 616c 7565 735f 6469 7370 6c61 7920  _values_display 
+0003c890: 3d20 4e6f 6e65 0a20 2020 2020 2020 2063  = None.        c
+0003c8a0: 6f6c 6f72 5f64 6973 6372 6574 655f 6d61  olor_discrete_ma
+0003c8b0: 705f 6469 7370 6c61 7920 3d20 4e6f 6e65  p_display = None
+0003c8c0: 0a20 2020 2020 2020 2068 745f 636f 6c6f  .        ht_colo
+0003c8d0: 725f 636f 756e 7473 203d 204e 6f6e 650a  r_counts = None.
+0003c8e0: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
+0003c8f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0003c900: 2020 2020 2020 2020 2020 2320 7361 6e69            # sani
+0003c910: 7469 7365 2063 6f6c 6f72 2063 6f6c 756d  tise color colum
+0003c920: 6e20 2d20 6e65 6365 7373 6172 7920 746f  n - necessary to
+0003c930: 2061 766f 6964 2067 7265 7920 7069 6520   avoid grey pie 
+0003c940: 6368 6172 7420 7365 676d 656e 7473 0a20  chart segments. 
+0003c950: 2020 2020 2020 2020 2020 2064 665f 6861             df_ha
+0003c960: 7073 5b22 7061 7274 6974 696f 6e22 5d20  ps["partition"] 
+0003c970: 3d20 6466 5f68 6170 735b 636f 6c6f 725d  = df_haps[color]
+0003c980: 2e73 7472 2e72 6570 6c61 6365 2872 225c  .str.replace(r"\
+0003c990: 5722 2c20 2222 2c20 7265 6765 783d 5472  W", "", regex=Tr
+0003c9a0: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
+0003c9b0: 2023 2065 7874 7261 6374 2061 6c6c 2075   # extract all u
+0003c9c0: 6e69 7175 6520 7661 6c75 6573 206f 6620  nique values of 
+0003c9d0: 7468 6520 636f 6c6f 7220 636f 6c75 6d6e  the color column
+0003c9e0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+0003c9f0: 6f72 5f76 616c 7565 7320 3d20 6466 5f68  or_values = df_h
+0003ca00: 6170 735b 2270 6172 7469 7469 6f6e 225d  aps["partition"]
+0003ca10: 2e75 6e69 7175 6528 290a 2020 2020 2020  .unique().      
+0003ca20: 2020 2020 2020 636f 6c6f 725f 7661 6c75        color_valu
+0003ca30: 6573 5f6d 6170 7069 6e67 203d 2064 6963  es_mapping = dic
+0003ca40: 7428 7a69 7028 6466 5f68 6170 735b 2270  t(zip(df_haps["p
+0003ca50: 6172 7469 7469 6f6e 225d 2c20 6466 5f68  artition"], df_h
+0003ca60: 6170 735b 636f 6c6f 725d 2929 0a20 2020  aps[color])).   
+0003ca70: 2020 2020 2020 2020 2063 6f6c 6f72 5f76           color_v
+0003ca80: 616c 7565 735f 6469 7370 6c61 7920 3d20  alues_display = 
+0003ca90: 5b63 6f6c 6f72 5f76 616c 7565 735f 6d61  [color_values_ma
+0003caa0: 7070 696e 675b 635d 2066 6f72 2063 2069  pping[c] for c i
+0003cab0: 6e20 636f 6c6f 725f 7661 6c75 6573 5d0a  n color_values].
+0003cac0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+0003cad0: 6f75 6e74 2063 6f6c 6f72 2076 616c 7565  ount color value
+0003cae0: 7320 666f 7220 6561 6368 2064 6973 7469  s for each disti
+0003caf0: 6e63 7420 6861 706c 6f74 7970 650a 2020  nct haplotype.  
+0003cb00: 2020 2020 2020 2020 2020 6874 5f63 6f6c            ht_col
+0003cb10: 6f72 5f63 6f75 6e74 7320 3d20 5b0a 2020  or_counts = [.  
+0003cb20: 2020 2020 2020 2020 2020 2020 2020 6466                df
+0003cb30: 5f68 6170 732e 696c 6f63 5b6c 6973 7428  _haps.iloc[list(
+0003cb40: 7329 5d5b 2270 6172 7469 7469 6f6e 225d  s)]["partition"]
+0003cb50: 2e76 616c 7565 5f63 6f75 6e74 7328 292e  .value_counts().
+0003cb60: 746f 5f64 6963 7428 290a 2020 2020 2020  to_dict().      
+0003cb70: 2020 2020 2020 2020 2020 666f 7220 7320            for s 
+0003cb80: 696e 2068 745f 6469 7374 696e 6374 5f73  in ht_distinct_s
+0003cb90: 6574 730a 2020 2020 2020 2020 2020 2020  ets.            
+0003cba0: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+0003cbb0: 6620 636f 6c6f 7220 3d3d 2022 7461 786f  f color == "taxo
+0003cbc0: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
+0003cbd0: 2020 2020 2320 7370 6563 6961 6c20 6361      # special ca
+0003cbe0: 7365 2c20 7374 616e 6461 7264 6973 6520  se, standardise 
+0003cbf0: 7461 786f 6e20 636f 6c6f 7273 2061 6e64  taxon colors and
+0003cc00: 206f 7264 6572 0a20 2020 2020 2020 2020   order.         
+0003cc10: 2020 2020 2020 2063 6f6c 6f72 5f70 6172         color_par
+0003cc20: 616d 7320 3d20 7365 6c66 2e5f 7365 7475  ams = self._setu
+0003cc30: 705f 7461 786f 6e5f 636f 6c6f 7273 2829  p_taxon_colors()
+0003cc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003cc50: 2063 6f6c 6f72 5f64 6973 6372 6574 655f   color_discrete_
+0003cc60: 6d61 7020 3d20 636f 6c6f 725f 7061 7261  map = color_para
+0003cc70: 6d73 5b22 636f 6c6f 725f 6469 7363 7265  ms["color_discre
+0003cc80: 7465 5f6d 6170 225d 0a20 2020 2020 2020  te_map"].       
+0003cc90: 2020 2020 2020 2020 2063 6f6c 6f72 5f64           color_d
+0003cca0: 6973 6372 6574 655f 6d61 705f 6469 7370  iscrete_map_disp
+0003ccb0: 6c61 7920 3d20 636f 6c6f 725f 6469 7363  lay = color_disc
+0003ccc0: 7265 7465 5f6d 6170 0a20 2020 2020 2020  rete_map.       
+0003ccd0: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
+0003cce0: 795f 6f72 6465 7273 203d 2063 6f6c 6f72  y_orders = color
+0003ccf0: 5f70 6172 616d 735b 2263 6174 6567 6f72  _params["categor
+0003cd00: 795f 6f72 6465 7273 225d 0a0a 2020 2020  y_orders"]..    
+0003cd10: 2020 2020 2020 2020 656c 6966 2063 6f6c          elif col
+0003cd20: 6f72 5f64 6973 6372 6574 655f 6d61 7020  or_discrete_map 
+0003cd30: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0003cd40: 2020 2020 2020 2020 2023 2073 6574 2075           # set u
+0003cd50: 7020 6120 636f 6c6f 7220 7061 6c65 7474  p a color palett
+0003cd60: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0003cd70: 2020 6966 2063 6f6c 6f72 5f64 6973 6372    if color_discr
+0003cd80: 6574 655f 7365 7175 656e 6365 2069 7320  ete_sequence is 
+0003cd90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0003cda0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0003cdb0: 2863 6f6c 6f72 5f76 616c 7565 7329 203c  (color_values) <
+0003cdc0: 3d20 3130 3a0a 2020 2020 2020 2020 2020  = 10:.          
+0003cdd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0003cde0: 6c6f 725f 6469 7363 7265 7465 5f73 6571  lor_discrete_seq
+0003cdf0: 7565 6e63 6520 3d20 7078 2e63 6f6c 6f72  uence = px.color
+0003ce00: 732e 7175 616c 6974 6174 6976 652e 506c  s.qualitative.Pl
+0003ce10: 6f74 6c79 0a20 2020 2020 2020 2020 2020  otly.           
+0003ce20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0003ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ce40: 2020 2020 2020 2063 6f6c 6f72 5f64 6973         color_dis
+0003ce50: 6372 6574 655f 7365 7175 656e 6365 203d  crete_sequence =
+0003ce60: 2070 782e 636f 6c6f 7273 2e71 7561 6c69   px.colors.quali
+0003ce70: 7461 7469 7665 2e41 6c70 6861 6265 740a  tative.Alphabet.
+0003ce80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ce90: 2023 206d 6170 2076 616c 7565 7320 746f   # map values to
+0003cea0: 2063 6f6c 6f72 730a 2020 2020 2020 2020   colors.        
+0003ceb0: 2020 2020 2020 2020 636f 6c6f 725f 6469          color_di
+0003cec0: 7363 7265 7465 5f6d 6170 203d 207b 0a20  screte_map = {. 
+0003ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cee0: 2020 2076 3a20 6320 666f 7220 762c 2063     v: c for v, c
+0003cef0: 2069 6e20 7a69 7028 636f 6c6f 725f 7661   in zip(color_va
+0003cf00: 6c75 6573 2c20 6379 636c 6528 636f 6c6f  lues, cycle(colo
+0003cf10: 725f 6469 7363 7265 7465 5f73 6571 7565  r_discrete_seque
+0003cf20: 6e63 6529 290a 2020 2020 2020 2020 2020  nce)).          
+0003cf30: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0003cf40: 2020 2020 2020 2020 636f 6c6f 725f 6469          color_di
+0003cf50: 7363 7265 7465 5f6d 6170 5f64 6973 706c  screte_map_displ
+0003cf60: 6179 203d 207b 0a20 2020 2020 2020 2020  ay = {.         
+0003cf70: 2020 2020 2020 2020 2020 2076 3a20 630a             v: c.
+0003cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cf90: 2020 2020 666f 7220 762c 2063 2069 6e20      for v, c in 
+0003cfa0: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
+0003cfb0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+0003cfc0: 6f72 5f76 616c 7565 735f 6469 7370 6c61  or_values_displa
+0003cfd0: 792c 2063 7963 6c65 2863 6f6c 6f72 5f64  y, cycle(color_d
+0003cfe0: 6973 6372 6574 655f 7365 7175 656e 6365  iscrete_sequence
+0003cff0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003d000: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0003d010: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+0003d020: 2020 2064 6562 7567 2822 636f 6e73 7472     debug("constr
+0003d030: 7563 7420 6772 6170 6822 290a 2020 2020  uct graph").    
+0003d040: 2020 2020 616e 6f6e 5f77 6964 7468 203d      anon_width =
+0003d050: 206e 702e 7371 7274 2830 2e33 202a 206e   np.sqrt(0.3 * n
+0003d060: 6f64 655f 7369 7a65 5f66 6163 746f 7229  ode_size_factor)
+0003d070: 0a20 2020 2020 2020 2067 7261 7068 5f6e  .        graph_n
+0003d080: 6f64 6573 2c20 6772 6170 685f 6564 6765  odes, graph_edge
+0003d090: 7320 3d20 6d6a 6e5f 6772 6170 6828 0a20  s = mjn_graph(. 
+0003d0a0: 2020 2020 2020 2020 2020 2068 745f 6469             ht_di
+0003d0b0: 7374 696e 6374 3d68 745f 6469 7374 696e  stinct=ht_distin
+0003d0c0: 6374 2c0a 2020 2020 2020 2020 2020 2020  ct,.            
+0003d0d0: 6874 5f64 6973 7469 6e63 745f 6d6a 6e3d  ht_distinct_mjn=
+0003d0e0: 6874 5f64 6973 7469 6e63 745f 6d6a 6e2c  ht_distinct_mjn,
+0003d0f0: 0a20 2020 2020 2020 2020 2020 2068 745f  .            ht_
+0003d100: 636f 756e 7473 3d68 745f 636f 756e 7473  counts=ht_counts
+0003d110: 2c0a 2020 2020 2020 2020 2020 2020 6874  ,.            ht
+0003d120: 5f63 6f6c 6f72 5f63 6f75 6e74 733d 6874  _color_counts=ht
+0003d130: 5f63 6f6c 6f72 5f63 6f75 6e74 732c 0a20  _color_counts,. 
+0003d140: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0003d150: 3d63 6f6c 6f72 2c0a 2020 2020 2020 2020  =color,.        
+0003d160: 2020 2020 636f 6c6f 725f 7661 6c75 6573      color_values
+0003d170: 3d63 6f6c 6f72 5f76 616c 7565 732c 0a20  =color_values,. 
+0003d180: 2020 2020 2020 2020 2020 2065 6467 6573             edges
+0003d190: 3d65 6467 6573 2c0a 2020 2020 2020 2020  =edges,.        
+0003d1a0: 2020 2020 616c 745f 6564 6765 733d 616c      alt_edges=al
+0003d1b0: 745f 6564 6765 732c 0a20 2020 2020 2020  t_edges,.       
+0003d1c0: 2020 2020 206e 6f64 655f 7369 7a65 5f66       node_size_f
+0003d1d0: 6163 746f 723d 6e6f 6465 5f73 697a 655f  actor=node_size_
+0003d1e0: 6661 6374 6f72 2c0a 2020 2020 2020 2020  factor,.        
+0003d1f0: 2020 2020 616e 6f6e 5f77 6964 7468 3d61      anon_width=a
+0003d200: 6e6f 6e5f 7769 6474 682c 0a20 2020 2020  non_width,.     
+0003d210: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
+0003d220: 6275 6728 2270 7265 7061 7265 2067 7261  bug("prepare gra
+0003d230: 7068 2064 6174 6120 666f 7220 6379 746f  ph data for cyto
+0003d240: 7363 6170 6522 290a 2020 2020 2020 2020  scape").        
+0003d250: 656c 656d 656e 7473 203d 205b 7b22 6461  elements = [{"da
+0003d260: 7461 223a 206e 7d20 666f 7220 6e20 696e  ta": n} for n in
+0003d270: 2067 7261 7068 5f6e 6f64 6573 5d20 2b20   graph_nodes] + 
+0003d280: 5b0a 2020 2020 2020 2020 2020 2020 7b22  [.            {"
+0003d290: 6461 7461 223a 2065 7d20 666f 7220 6520  data": e} for e 
+0003d2a0: 696e 2067 7261 7068 5f65 6467 6573 0a20  in graph_edges. 
+0003d2b0: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
+0003d2c0: 2020 6465 6275 6728 2264 6566 696e 6520    debug("define 
+0003d2d0: 6e6f 6465 2073 7479 6c65 2229 0a20 2020  node style").   
+0003d2e0: 2020 2020 206e 6f64 655f 7374 796c 6520       node_style 
+0003d2f0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+0003d300: 2277 6964 7468 223a 2022 6461 7461 2877  "width": "data(w
+0003d310: 6964 7468 2922 2c0a 2020 2020 2020 2020  idth)",.        
+0003d320: 2020 2020 2268 6569 6768 7422 3a20 2264      "height": "d
+0003d330: 6174 6128 7769 6474 6829 222c 0a20 2020  ata(width)",.   
+0003d340: 2020 2020 2020 2020 2022 7069 652d 7369           "pie-si
+0003d350: 7a65 223a 2022 3130 3025 222c 0a20 2020  ze": "100%",.   
+0003d360: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
+0003d370: 6620 636f 6c6f 7220 616e 6420 636f 6c6f  f color and colo
+0003d380: 725f 6469 7363 7265 7465 5f6d 6170 2069  r_discrete_map i
+0003d390: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0003d3a0: 2020 2020 2020 2020 2320 6865 7265 2061          # here a
+0003d3b0: 7265 2074 6865 2073 7479 6c65 7320 7768  re the styles wh
+0003d3c0: 6963 6820 636f 6e74 726f 6c20 7468 6520  ich control the 
+0003d3d0: 6469 7370 6c61 7920 6f66 206e 6f64 6573  display of nodes
+0003d3e0: 2061 7320 7069 650a 2020 2020 2020 2020   as pie.        
+0003d3f0: 2020 2020 2320 6368 6172 7473 0a20 2020      # charts.   
+0003d400: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+0003d410: 2876 2c20 6329 2069 6e20 656e 756d 6572  (v, c) in enumer
+0003d420: 6174 6528 636f 6c6f 725f 6469 7363 7265  ate(color_discre
+0003d430: 7465 5f6d 6170 2e69 7465 6d73 2829 293a  te_map.items()):
+0003d440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d450: 206e 6f64 655f 7374 796c 655b 6622 7069   node_style[f"pi
+0003d460: 652d 7b69 202b 2031 7d2d 6261 636b 6772  e-{i + 1}-backgr
+0003d470: 6f75 6e64 2d63 6f6c 6f72 225d 203d 2063  ound-color"] = c
+0003d480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d490: 206e 6f64 655f 7374 796c 655b 0a20 2020   node_style[.   
+0003d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d4b0: 2066 2270 6965 2d7b 6920 2b20 317d 2d62   f"pie-{i + 1}-b
+0003d4c0: 6163 6b67 726f 756e 642d 7369 7a65 220a  ackground-size".
+0003d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d4e0: 5d20 3d20 6622 6d61 7044 6174 6128 7b76  ] = f"mapData({v
+0003d4f0: 7d2c 2030 2c20 3130 302c 2030 2c20 3130  }, 0, 100, 0, 10
+0003d500: 3029 220a 2020 2020 2020 2020 6e6f 6465  0)".        node
+0003d510: 5f73 7479 6c65 7368 6565 7420 3d20 7b0a  _stylesheet = {.
+0003d520: 2020 2020 2020 2020 2020 2020 2273 656c              "sel
+0003d530: 6563 746f 7222 3a20 226e 6f64 6522 2c0a  ector": "node",.
+0003d540: 2020 2020 2020 2020 2020 2020 2273 7479              "sty
+0003d550: 6c65 223a 206e 6f64 655f 7374 796c 652c  le": node_style,
+0003d560: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0003d570: 2020 2064 6562 7567 286e 6f64 655f 7374     debug(node_st
+0003d580: 796c 6573 6865 6574 290a 0a20 2020 2020  ylesheet)..     
+0003d590: 2020 2064 6562 7567 2822 6465 6669 6e65     debug("define
+0003d5a0: 2065 6467 6520 7374 796c 6522 290a 2020   edge style").  
+0003d5b0: 2020 2020 2020 6564 6765 5f73 7479 6c65        edge_style
+0003d5c0: 7368 6565 7420 3d20 7b0a 2020 2020 2020  sheet = {.      
+0003d5d0: 2020 2020 2020 2273 656c 6563 746f 7222        "selector"
+0003d5e0: 3a20 2265 6467 6522 2c0a 2020 2020 2020  : "edge",.      
+0003d5f0: 2020 2020 2020 2273 7479 6c65 223a 207b        "style": {
+0003d600: 2263 7572 7665 2d73 7479 6c65 223a 2022  "curve-style": "
+0003d610: 6265 7a69 6572 222c 2022 7769 6474 6822  bezier", "width"
+0003d620: 3a20 322c 2022 6f70 6163 6974 7922 3a20  : 2, "opacity": 
+0003d630: 302e 357d 2c0a 2020 2020 2020 2020 7d0a  0.5},.        }.
+0003d640: 0a20 2020 2020 2020 2064 6562 7567 2822  .        debug("
+0003d650: 6465 6669 6e65 2073 7479 6c65 2066 6f72  define style for
+0003d660: 2073 656c 6563 7465 6420 6e6f 6465 2229   selected node")
+0003d670: 0a20 2020 2020 2020 2073 656c 6563 7465  .        selecte
+0003d680: 645f 7374 796c 6573 6865 6574 203d 207b  d_stylesheet = {
+0003d690: 0a20 2020 2020 2020 2020 2020 2022 7365  .            "se
+0003d6a0: 6c65 6374 6f72 223a 2022 3a73 656c 6563  lector": ":selec
+0003d6b0: 7465 6422 2c0a 2020 2020 2020 2020 2020  ted",.          
+0003d6c0: 2020 2273 7479 6c65 223a 207b 0a20 2020    "style": {.   
+0003d6d0: 2020 2020 2020 2020 2020 2020 2022 626f               "bo
+0003d6e0: 7264 6572 2d77 6964 7468 223a 2022 3370  rder-width": "3p
+0003d6f0: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
+0003d700: 2020 2020 2262 6f72 6465 722d 7374 796c      "border-styl
+0003d710: 6522 3a20 2273 6f6c 6964 222c 0a20 2020  e": "solid",.   
+0003d720: 2020 2020 2020 2020 2020 2020 2022 626f               "bo
+0003d730: 7264 6572 2d63 6f6c 6f72 223a 2022 626c  rder-color": "bl
+0003d740: 6163 6b22 2c0a 2020 2020 2020 2020 2020  ack",.          
+0003d750: 2020 7d2c 0a20 2020 2020 2020 207d 0a0a    },.        }..
+0003d760: 2020 2020 2020 2020 6465 6275 6728 2263          debug("c
+0003d770: 7265 6174 6520 6669 6775 7265 206c 6567  reate figure leg
+0003d780: 656e 6422 290a 2020 2020 2020 2020 6966  end").        if
+0003d790: 2063 6f6c 6f72 2069 7320 6e6f 7420 4e6f   color is not No
+0003d7a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0003d7b0: 6c65 6765 6e64 5f66 6967 203d 2070 6c6f  legend_fig = plo
+0003d7c0: 746c 795f 6469 7363 7265 7465 5f6c 6567  tly_discrete_leg
+0003d7d0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0003d7e0: 2020 2020 2063 6f6c 6f72 3d63 6f6c 6f72       color=color
+0003d7f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003d800: 2020 636f 6c6f 725f 7661 6c75 6573 3d63    color_values=c
+0003d810: 6f6c 6f72 5f76 616c 7565 735f 6469 7370  olor_values_disp
+0003d820: 6c61 792c 0a20 2020 2020 2020 2020 2020  lay,.           
+0003d830: 2020 2020 2063 6f6c 6f72 5f64 6973 6372       color_discr
+0003d840: 6574 655f 6d61 703d 636f 6c6f 725f 6469  ete_map=color_di
+0003d850: 7363 7265 7465 5f6d 6170 5f64 6973 706c  screte_map_displ
+0003d860: 6179 2c0a 2020 2020 2020 2020 2020 2020  ay,.            
+0003d870: 2020 2020 6361 7465 676f 7279 5f6f 7264      category_ord
+0003d880: 6572 733d 6361 7465 676f 7279 5f6f 7264  ers=category_ord
+0003d890: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
+0003d8a0: 2029 0a20 2020 2020 2020 2020 2020 206c   ).            l
+0003d8b0: 6567 656e 645f 636f 6d70 6f6e 656e 7420  egend_component 
+0003d8c0: 3d20 6463 632e 4772 6170 6828 0a20 2020  = dcc.Graph(.   
+0003d8d0: 2020 2020 2020 2020 2020 2020 2069 643d               id=
+0003d8e0: 226c 6567 656e 6422 2c0a 2020 2020 2020  "legend",.      
+0003d8f0: 2020 2020 2020 2020 2020 6669 6775 7265            figure
+0003d900: 3d6c 6567 656e 645f 6669 672c 0a20 2020  =legend_fig,.   
+0003d910: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0003d920: 6669 673d 6469 6374 280a 2020 2020 2020  fig=dict(.      
+0003d930: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0003d940: 7370 6c61 794d 6f64 6542 6172 3d46 616c  splayModeBar=Fal
+0003d950: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0003d960: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0003d970: 2020 2029 0a20 2020 2020 2020 2065 6c73     ).        els
+0003d980: 653a 0a20 2020 2020 2020 2020 2020 206c  e:.            l
+0003d990: 6567 656e 645f 636f 6d70 6f6e 656e 7420  egend_component 
+0003d9a0: 3d20 6874 6d6c 2e44 6976 2829 0a0a 2020  = html.Div()..  
+0003d9b0: 2020 2020 2020 6465 6275 6728 2264 6566        debug("def
+0003d9c0: 696e 6520 6379 746f 7363 6170 6520 636f  ine cytoscape co
+0003d9d0: 6d70 6f6e 656e 7422 290a 2020 2020 2020  mponent").      
+0003d9e0: 2020 6966 206c 6179 6f75 745f 7061 7261    if layout_para
+0003d9f0: 6d73 2069 7320 4e6f 6e65 3a0a 2020 2020  ms is None:.    
+0003da00: 2020 2020 2020 2020 6772 6170 685f 6c61          graph_la
+0003da10: 796f 7574 5f70 6172 616d 7320 3d20 6469  yout_params = di
+0003da20: 6374 2829 0a20 2020 2020 2020 2065 6c73  ct().        els
+0003da30: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+0003da40: 7261 7068 5f6c 6179 6f75 745f 7061 7261  raph_layout_para
+0003da50: 6d73 203d 2064 6963 7428 2a2a 6c61 796f  ms = dict(**layo
+0003da60: 7574 5f70 6172 616d 7329 0a20 2020 2020  ut_params).     
+0003da70: 2020 2067 7261 7068 5f6c 6179 6f75 745f     graph_layout_
+0003da80: 7061 7261 6d73 5b22 6e61 6d65 225d 203d  params["name"] =
+0003da90: 206c 6179 6f75 740a 2020 2020 2020 2020   layout.        
+0003daa0: 6772 6170 685f 6c61 796f 7574 5f70 6172  graph_layout_par
+0003dab0: 616d 732e 7365 7464 6566 6175 6c74 2822  ams.setdefault("
+0003dac0: 7061 6464 696e 6722 2c20 3130 290a 2020  padding", 10).  
+0003dad0: 2020 2020 2020 6772 6170 685f 6c61 796f        graph_layo
+0003dae0: 7574 5f70 6172 616d 732e 7365 7464 6566  ut_params.setdef
+0003daf0: 6175 6c74 2822 616e 696d 6174 6522 2c20  ault("animate", 
+0003db00: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+0003db10: 6379 746f 7363 6170 655f 636f 6d70 6f6e  cytoscape_compon
+0003db20: 656e 7420 3d20 6379 746f 2e43 7974 6f73  ent = cyto.Cytos
+0003db30: 6361 7065 280a 2020 2020 2020 2020 2020  cape(.          
+0003db40: 2020 6964 3d22 6379 746f 7363 6170 6522    id="cytoscape"
+0003db50: 2c0a 2020 2020 2020 2020 2020 2020 656c  ,.            el
+0003db60: 656d 656e 7473 3d65 6c65 6d65 6e74 732c  ements=elements,
+0003db70: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0003db80: 6f75 743d 6772 6170 685f 6c61 796f 7574  out=graph_layout
+0003db90: 5f70 6172 616d 732c 0a20 2020 2020 2020  _params,.       
+0003dba0: 2020 2020 2073 7479 6c65 7368 6565 743d       stylesheet=
+0003dbb0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0003dbc0: 2020 6e6f 6465 5f73 7479 6c65 7368 6565    node_styleshee
+0003dbd0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0003dbe0: 2020 2065 6467 655f 7374 796c 6573 6865     edge_styleshe
+0003dbf0: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+0003dc00: 2020 2020 7365 6c65 6374 6564 5f73 7479      selected_sty
+0003dc10: 6c65 7368 6565 742c 0a20 2020 2020 2020  lesheet,.       
+0003dc20: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
+0003dc30: 2020 2020 7374 796c 653d 7b0a 2020 2020      style={.    
+0003dc40: 2020 2020 2020 2020 2020 2020 2320 7769              # wi
+0003dc50: 6474 6820 616e 6420 6865 6967 6874 206e  dth and height n
+0003dc60: 6565 6465 6420 746f 2067 6574 2063 7974  eeded to get cyt
+0003dc70: 6f73 6361 7065 2063 6f6d 706f 6e65 6e74  oscape component
+0003dc80: 2074 6f20 6469 7370 6c61 790a 2020 2020   to display.    
+0003dc90: 2020 2020 2020 2020 2020 2020 2277 6964              "wid
+0003dca0: 7468 223a 2022 3130 3025 222c 0a20 2020  th": "100%",.   
+0003dcb0: 2020 2020 2020 2020 2020 2020 2022 6865               "he
+0003dcc0: 6967 6874 223a 2022 3130 3025 222c 0a20  ight": "100%",. 
+0003dcd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0003dce0: 6261 636b 6772 6f75 6e64 2d63 6f6c 6f72  background-color
+0003dcf0: 223a 2022 7768 6974 6522 2c0a 2020 2020  ": "white",.    
+0003dd00: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+0003dd10: 2020 2020 2020 2023 2065 6e61 626c 6520         # enable 
+0003dd20: 7365 6c65 6374 696e 6720 6d75 6c74 6970  selecting multip
+0003dd30: 6c65 206e 6f64 6573 2077 6974 6820 7368  le nodes with sh
+0003dd40: 6966 7420 636c 6963 6b20 616e 6420 6472  ift click and dr
+0003dd50: 6167 0a20 2020 2020 2020 2020 2020 2062  ag.            b
+0003dd60: 6f78 5365 6c65 6374 696f 6e45 6e61 626c  oxSelectionEnabl
+0003dd70: 6564 3d54 7275 652c 0a20 2020 2020 2020  ed=True,.       
+0003dd80: 2020 2020 2023 2070 7265 7665 6e74 2061       # prevent a
+0003dd90: 6363 6964 656e 7461 6c6c 7920 7a6f 6f6d  ccidentally zoom
+0003dda0: 696e 6720 6f75 7420 746f 206f 626c 6976  ing out to obliv
+0003ddb0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+0003ddc0: 6d69 6e5a 6f6f 6d3d 302e 312c 0a20 2020  minZoom=0.1,.   
+0003ddd0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0003dde0: 6465 6275 6728 2263 7265 6174 6520 6461  debug("create da
+0003ddf0: 7368 2061 7070 2229 0a20 2020 2020 2020  sh app").       
+0003de00: 2061 7070 203d 204a 7570 7974 6572 4461   app = JupyterDa
+0003de10: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
+0003de20: 2264 6173 682d 6379 746f 7363 6170 652d  "dash-cytoscape-
+0003de30: 6e65 7477 6f72 6b22 2c0a 2020 2020 2020  network",.      
+0003de40: 2020 2020 2020 2320 7468 6973 2073 7479        # this sty
+0003de50: 6c65 7368 6565 7420 6973 2075 7365 6420  lesheet is used 
+0003de60: 746f 2070 726f 7669 6465 2073 7570 706f  to provide suppo
+0003de70: 7274 2066 6f72 2061 2072 6f77 7320 616e  rt for a rows an
+0003de80: 6420 636f 6c75 6d6e 730a 2020 2020 2020  d columns.      
+0003de90: 2020 2020 2020 2320 6c61 796f 7574 206f        # layout o
+0003dea0: 6620 7468 6520 636f 6d70 6f6e 656e 7473  f the components
+0003deb0: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
+0003dec0: 6572 6e61 6c5f 7374 796c 6573 6865 6574  ernal_stylesheet
+0003ded0: 733d 5b22 6874 7470 733a 2f2f 636f 6465  s=["https://code
+0003dee0: 7065 6e2e 696f 2f63 6872 6964 6479 702f  pen.io/chriddyp/
+0003def0: 7065 6e2f 6257 4c77 6750 2e63 7373 225d  pen/bWLwgP.css"]
+0003df00: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+0003df10: 2020 2020 2320 7468 6973 2069 7320 616e      # this is an
+0003df20: 206f 7074 696d 6973 6174 696f 6e2c 2069   optimisation, i
+0003df30: 7427 7320 6765 6e65 7261 6c6c 7920 6661  t's generally fa
+0003df40: 7374 6572 2074 6f20 7365 7276 6520 7363  ster to serve sc
+0003df50: 7269 7074 2066 696c 6573 2066 726f 6d20  ript files from 
+0003df60: 4344 4e0a 2020 2020 2020 2020 6170 702e  CDN.        app.
+0003df70: 7363 7269 7074 732e 636f 6e66 6967 2e73  scripts.config.s
+0003df80: 6572 7665 5f6c 6f63 616c 6c79 203d 2046  erve_locally = F
+0003df90: 616c 7365 0a20 2020 2020 2020 2061 7070  alse.        app
+0003dfa0: 2e6c 6179 6f75 7420 3d20 6874 6d6c 2e44  .layout = html.D
+0003dfb0: 6976 280a 2020 2020 2020 2020 2020 2020  iv(.            
+0003dfc0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0003dfd0: 2020 6874 6d6c 2e44 6976 280a 2020 2020    html.Div(.    
+0003dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dff0: 6379 746f 7363 6170 655f 636f 6d70 6f6e  cytoscape_compon
+0003e000: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+0003e010: 2020 2020 2020 2020 2063 6c61 7373 4e61           classNa
+0003e020: 6d65 3d22 6e69 6e65 2063 6f6c 756d 6e73  me="nine columns
+0003e030: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0003e040: 2020 2020 2020 2073 7479 6c65 3d7b 0a20         style={. 
+0003e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e060: 2020 2020 2020 2023 2072 6571 7569 7265         # require
+0003e070: 6420 746f 2067 6574 2063 7974 6f73 6361  d to get cytosca
+0003e080: 7065 2063 6f6d 706f 6e65 6e74 2074 6f20  pe component to 
+0003e090: 7368 6f77 202e 2e2e 0a20 2020 2020 2020  show ....       
+0003e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e0b0: 2023 206d 756c 7469 706c 7920 6279 2066   # multiply by f
+0003e0c0: 6163 746f 7220 3c31 2074 6f20 7072 6576  actor <1 to prev
+0003e0d0: 656e 7420 7363 726f 6c6c 206f 7665 7266  ent scroll overf
+0003e0e0: 6c6f 770a 2020 2020 2020 2020 2020 2020  low.            
+0003e0f0: 2020 2020 2020 2020 2020 2020 2268 6569              "hei
+0003e100: 6768 7422 3a20 6622 7b68 6569 6768 7420  ght": f"{height 
+0003e110: 2a20 2e39 337d 7078 222c 0a20 2020 2020  * .93}px",.     
+0003e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e130: 2020 2022 626f 7264 6572 223a 2022 3170     "border": "1p
+0003e140: 7820 736f 6c69 6420 626c 6163 6b22 2c0a  x solid black",.
+0003e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e160: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
+0003e170: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+0003e180: 2020 2020 2020 2020 2020 6874 6d6c 2e44            html.D
+0003e190: 6976 280a 2020 2020 2020 2020 2020 2020  iv(.            
+0003e1a0: 2020 2020 2020 2020 6c65 6765 6e64 5f63          legend_c
+0003e1b0: 6f6d 706f 6e65 6e74 2c0a 2020 2020 2020  omponent,.      
+0003e1c0: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+0003e1d0: 6173 734e 616d 653d 2274 6872 6565 2063  assName="three c
+0003e1e0: 6f6c 756d 6e73 222c 0a20 2020 2020 2020  olumns",.       
+0003e1f0: 2020 2020 2020 2020 2020 2020 2073 7479               sty
+0003e200: 6c65 3d7b 0a20 2020 2020 2020 2020 2020  le={.           
+0003e210: 2020 2020 2020 2020 2020 2020 2022 6865               "he
+0003e220: 6967 6874 223a 2066 227b 6865 6967 6874  ight": f"{height
+0003e230: 202a 202e 3933 7d70 7822 2c0a 2020 2020   * .93}px",.    
+0003e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e250: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+0003e260: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+0003e270: 2020 2020 2020 6874 6d6c 2e44 6976 2869        html.Div(i
+0003e280: 643d 226f 7574 7075 7422 292c 0a20 2020  d="output"),.   
+0003e290: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
+0003e2a0: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+0003e2b0: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
+0003e2c0: 2020 2264 6566 696e 6520 6120 6361 6c6c    "define a call
+0003e2d0: 6261 636b 2066 756e 6374 696f 6e20 746f  back function to
+0003e2e0: 2064 6973 706c 6179 2069 6e66 6f72 6d61   display informa
+0003e2f0: 7469 6f6e 2061 626f 7574 2074 6865 2073  tion about the s
+0003e300: 656c 6563 7465 6420 6e6f 6465 220a 2020  elected node".  
+0003e310: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0003e320: 2040 6170 702e 6361 6c6c 6261 636b 284f   @app.callback(O
+0003e330: 7574 7075 7428 226f 7574 7075 7422 2c20  utput("output", 
+0003e340: 2263 6869 6c64 7265 6e22 292c 2049 6e70  "children"), Inp
+0003e350: 7574 2822 6379 746f 7363 6170 6522 2c20  ut("cytoscape", 
+0003e360: 2274 6170 4e6f 6465 4461 7461 2229 290a  "tapNodeData")).
+0003e370: 2020 2020 2020 2020 6465 6620 6469 7370          def disp
+0003e380: 6c61 795f 7461 705f 6e6f 6465 5f64 6174  lay_tap_node_dat
+0003e390: 6128 6461 7461 293a 0a20 2020 2020 2020  a(data):.       
+0003e3a0: 2020 2020 2069 6620 6461 7461 2069 7320       if data is 
+0003e3b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0003e3c0: 2020 2020 2020 7265 7475 726e 2022 436c        return "Cl
+0003e3d0: 6963 6b20 6f72 2074 6170 2061 206e 6f64  ick or tap a nod
+0003e3e0: 6520 666f 7220 6d6f 7265 2069 6e66 6f72  e for more infor
+0003e3f0: 6d61 7469 6f6e 2e22 0a20 2020 2020 2020  mation.".       
+0003e400: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003e410: 2020 2020 2020 2020 2020 206e 203d 2064             n = d
+0003e420: 6174 615b 2263 6f75 6e74 225d 0a20 2020  ata["count"].   
+0003e430: 2020 2020 2020 2020 2020 2020 2074 6578               tex
+0003e440: 7420 3d20 6622 4e6f 2e20 6861 706c 6f74  t = f"No. haplot
+0003e450: 7970 6573 3a20 7b6e 7d22 0a20 2020 2020  ypes: {n}".     
+0003e460: 2020 2020 2020 2020 2020 2073 656c 6563             selec
+0003e470: 7465 645f 636f 6c6f 725f 6461 7461 203d  ted_color_data =
+0003e480: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0003e490: 2020 2020 2020 2063 6f6c 6f72 5f76 5f64         color_v_d
+0003e4a0: 6973 706c 6179 3a20 696e 7428 6461 7461  isplay: int(data
+0003e4b0: 2e67 6574 2863 6f6c 6f72 5f76 2c20 3029  .get(color_v, 0)
+0003e4c0: 202a 206e 202f 2031 3030 290a 2020 2020   * n / 100).    
+0003e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e4e0: 666f 7220 636f 6c6f 725f 762c 2063 6f6c  for color_v, col
+0003e4f0: 6f72 5f76 5f64 6973 706c 6179 2069 6e20  or_v_display in 
+0003e500: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
+0003e510: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+0003e520: 6f72 5f76 616c 7565 732c 2063 6f6c 6f72  or_values, color
+0003e530: 5f76 616c 7565 735f 6469 7370 6c61 790a  _values_display.
+0003e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e550: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0003e560: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0003e570: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
+0003e580: 5f63 6f6c 6f72 5f64 6174 6120 3d20 736f  _color_data = so
+0003e590: 7274 6564 280a 2020 2020 2020 2020 2020  rted(.          
+0003e5a0: 2020 2020 2020 2020 2020 7365 6c65 6374            select
+0003e5b0: 6564 5f63 6f6c 6f72 5f64 6174 612e 6974  ed_color_data.it
+0003e5c0: 656d 7328 292c 206b 6579 3d6c 616d 6264  ems(), key=lambd
+0003e5d0: 6120 6974 656d 3a20 6974 656d 5b31 5d2c  a item: item[1],
+0003e5e0: 2072 6576 6572 7365 3d54 7275 650a 2020   reverse=True.  
+0003e5f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0003e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e610: 636f 6c6f 725f 7465 7874 7320 3d20 5b0a  color_texts = [.
+0003e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e630: 2020 2020 6622 7b63 6f6c 6f72 5f76 7d3a      f"{color_v}:
+0003e640: 207b 636f 6c6f 725f 6e7d 220a 2020 2020   {color_n}".    
+0003e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e660: 666f 7220 636f 6c6f 725f 762c 2063 6f6c  for color_v, col
+0003e670: 6f72 5f6e 2069 6e20 7365 6c65 6374 6564  or_n in selected
+0003e680: 5f63 6f6c 6f72 5f64 6174 610a 2020 2020  _color_data.    
+0003e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e6a0: 6966 2063 6f6c 6f72 5f6e 203e 2030 0a20  if color_n > 0. 
+0003e6b0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0003e6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e6d0: 2069 6620 636f 6c6f 725f 7465 7874 733a   if color_texts:
+0003e6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e6f0: 2020 2020 2063 6f6c 6f72 5f74 6578 7473       color_texts
+0003e700: 203d 2022 3b20 222e 6a6f 696e 2863 6f6c   = "; ".join(col
+0003e710: 6f72 5f74 6578 7473 290a 2020 2020 2020  or_texts).      
+0003e720: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0003e730: 7874 202b 3d20 6622 2028 7b63 6f6c 6f72  xt += f" ({color
+0003e740: 5f74 6578 7473 7d29 220a 2020 2020 2020  _texts})".      
+0003e750: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0003e760: 2074 6578 740a 0a20 2020 2020 2020 2064   text..        d
+0003e770: 6562 7567 2822 7365 7420 7570 2072 756e  ebug("set up run
+0003e780: 2070 6172 616d 6574 6572 7322 290a 2020   parameters").  
+0003e790: 2020 2020 2020 2320 776f 726b 6172 6f75        # workarou
+0003e7a0: 6e64 2077 6569 7264 206d 7970 7920 6275  nd weird mypy bu
+0003e7b0: 6720 6865 7265 0a20 2020 2020 2020 2072  g here.        r
+0003e7c0: 756e 5f70 6172 616d 733a 2044 6963 745b  un_params: Dict[
+0003e7d0: 7374 722c 2041 6e79 5d20 3d20 6469 6374  str, Any] = dict
+0003e7e0: 2829 0a20 2020 2020 2020 2069 6620 6865  ().        if he
+0003e7f0: 6967 6874 2069 7320 6e6f 7420 4e6f 6e65  ight is not None
+0003e800: 3a0a 2020 2020 2020 2020 2020 2020 7275  :.            ru
+0003e810: 6e5f 7061 7261 6d73 5b22 6865 6967 6874  n_params["height
+0003e820: 225d 203d 2068 6569 6768 740a 2020 2020  "] = height.    
+0003e830: 2020 2020 6966 2077 6964 7468 2069 7320      if width is 
+0003e840: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0003e850: 2020 2020 2020 7275 6e5f 7061 7261 6d73        run_params
+0003e860: 5b22 7769 6474 6822 5d20 3d20 7769 6474  ["width"] = widt
+0003e870: 680a 2020 2020 2020 2020 6966 2073 6572  h.        if ser
+0003e880: 7665 725f 706f 7274 2069 7320 6e6f 7420  ver_port is not 
+0003e890: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0003e8a0: 2020 7275 6e5f 7061 7261 6d73 5b22 706f    run_params["po
+0003e8b0: 7274 225d 203d 2073 6572 7665 725f 706f  rt"] = server_po
+0003e8c0: 7274 0a20 2020 2020 2020 2069 6620 7365  rt.        if se
+0003e8d0: 7276 6572 5f6d 6f64 6520 6973 206e 6f74  rver_mode is not
+0003e8e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0003e8f0: 2020 2072 756e 5f70 6172 616d 735b 226d     run_params["m
+0003e900: 6f64 6522 5d20 3d20 7365 7276 6572 5f6d  ode"] = server_m
+0003e910: 6f64 650a 0a20 2020 2020 2020 2064 6562  ode..        deb
+0003e920: 7567 2822 6c61 756e 6368 2074 6865 2064  ug("launch the d
+0003e930: 6173 6820 6170 7022 290a 2020 2020 2020  ash app").      
+0003e940: 2020 2320 544f 444f 2049 2064 6f6e 2774    # TODO I don't
+0003e950: 2074 6869 6e6b 2074 6869 7320 6163 7475   think this actu
+0003e960: 616c 6c79 2072 6574 7572 6e73 2061 6e79  ally returns any
+0003e970: 7468 696e 670a 2020 2020 2020 2020 7265  thing.        re
+0003e980: 7475 726e 2061 7070 2e72 756e 5f73 6572  turn app.run_ser
+0003e990: 7665 7228 2a2a 7275 6e5f 7061 7261 6d73  ver(**run_params
+0003e9a0: 290a 0a0a 6465 6620 5f68 616d 6d69 6e67  )...def _hamming
+0003e9b0: 5f74 6f5f 736e 7073 2868 293a 0a20 2020  _to_snps(h):.   
+0003e9c0: 2022 2222 0a20 2020 2043 6c75 7374 6572   """.    Cluster
+0003e9d0: 2068 6170 6c6f 7479 7065 2061 7272 6179   haplotype array
+0003e9e0: 2061 6e64 2072 6574 7572 6e20 7468 6520   and return the 
+0003e9f0: 6e75 6d62 6572 206f 6620 534e 5020 6469  number of SNP di
+0003ea00: 6666 6572 656e 6365 730a 2020 2020 2222  fferences.    ""
+0003ea10: 220a 2020 2020 6672 6f6d 2073 6369 7079  ".    from scipy
+0003ea20: 2e73 7061 7469 616c 2e64 6973 7461 6e63  .spatial.distanc
+0003ea30: 6520 696d 706f 7274 2070 6469 7374 0a0a  e import pdist..
+0003ea40: 2020 2020 6469 7374 203d 2070 6469 7374      dist = pdist
+0003ea50: 2868 2c20 6d65 7472 6963 3d22 6861 6d6d  (h, metric="hamm
+0003ea60: 696e 6722 290a 2020 2020 6469 7374 202a  ing").    dist *
+0003ea70: 3d20 682e 7368 6170 655b 315d 0a20 2020  = h.shape[1].   
+0003ea80: 2072 6574 7572 6e20 6469 7374 0a0a 0a64   return dist...d
+0003ea90: 6566 205f 6765 745f 6d61 785f 6861 6d6d  ef _get_max_hamm
+0003eaa0: 696e 675f 6469 7374 616e 6365 2868 2c20  ing_distance(h, 
+0003eab0: 6d65 7472 6963 3d22 6861 6d6d 696e 6722  metric="hamming"
+0003eac0: 2c20 6c69 6e6b 6167 655f 6d65 7468 6f64  , linkage_method
+0003ead0: 3d22 7369 6e67 6c65 2229 3a0a 2020 2020  ="single"):.    
+0003eae0: 2222 220a 2020 2020 4669 6e64 2074 6865  """.    Find the
+0003eaf0: 206d 6178 696d 756d 2068 616d 6d69 6e67   maximum hamming
+0003eb00: 2064 6973 7461 6e63 6520 6265 7477 6565   distance betwee
+0003eb10: 6e20 6861 706c 6f74 7970 6573 0a20 2020  n haplotypes.   
+0003eb20: 2022 2222 0a20 2020 2066 726f 6d20 7363   """.    from sc
+0003eb30: 6970 792e 636c 7573 7465 722e 6869 6572  ipy.cluster.hier
+0003eb40: 6172 6368 7920 696d 706f 7274 206c 696e  archy import lin
+0003eb50: 6b61 6765 0a0a 2020 2020 7a20 3d20 6c69  kage..    z = li
+0003eb60: 6e6b 6167 6528 682c 206d 6574 7269 633d  nkage(h, metric=
+0003eb70: 6d65 7472 6963 2c20 6d65 7468 6f64 3d6c  metric, method=l
+0003eb80: 696e 6b61 6765 5f6d 6574 686f 6429 0a0a  inkage_method)..
+0003eb90: 2020 2020 2320 4765 7420 7468 6520 6469      # Get the di
+0003eba0: 7374 616e 6365 7320 636f 6c75 6d6e 0a20  stances column. 
+0003ebb0: 2020 2064 6973 7473 203d 207a 5b3a 2c20     dists = z[:, 
+0003ebc0: 325d 0a20 2020 2023 2043 6f6e 7665 7274  2].    # Convert
+0003ebd0: 2074 6f20 7468 6520 6e75 6d62 6572 206f   to the number o
+0003ebe0: 6620 534e 5020 6469 6666 6572 656e 6365  f SNP difference
+0003ebf0: 730a 2020 2020 6469 7374 7320 2a3d 2068  s.    dists *= h
+0003ec00: 2e73 6861 7065 5b31 5d0a 2020 2020 2320  .shape[1].    # 
+0003ec10: 5265 7475 726e 2074 6865 206d 6178 696d  Return the maxim
+0003ec20: 756d 0a20 2020 2072 6574 7572 6e20 6469  um.    return di
+0003ec30: 7374 732e 6d61 7828 290a 0a0a 6465 6620  sts.max()...def 
+0003ec40: 5f64 6970 6c6f 7479 7065 5f66 7265 7175  _diplotype_frequ
+0003ec50: 656e 6369 6573 2867 7429 3a0a 2020 2020  encies(gt):.    
+0003ec60: 2222 2243 6f6d 7075 7465 2064 6970 6c6f  """Compute diplo
+0003ec70: 7479 7065 2066 7265 7175 656e 6369 6573  type frequencies
+0003ec80: 2c20 7265 7475 726e 696e 6720 6120 6469  , returning a di
+0003ec90: 6374 696f 6e61 7279 2074 6861 7420 6d61  ctionary that ma
+0003eca0: 7073 0a20 2020 2064 6970 6c6f 7479 7065  ps.    diplotype
+0003ecb0: 2068 6173 6820 7661 6c75 6573 2074 6f20   hash values to 
+0003ecc0: 6672 6571 7565 6e63 6965 732e 2222 220a  frequencies.""".
+0003ecd0: 2020 2020 2320 544f 444f 2063 6f75 6c64      # TODO could
+0003ece0: 2075 7365 2066 6173 7465 7220 6861 7368   use faster hash
+0003ecf0: 696e 670a 2020 2020 6e20 3d20 6774 2e73  ing.    n = gt.s
+0003ed00: 6861 7065 5b31 5d0a 2020 2020 6861 7368  hape[1].    hash
+0003ed10: 6573 203d 205b 6861 7368 2867 745b 3a2c  es = [hash(gt[:,
+0003ed20: 2069 5d2e 746f 6279 7465 7328 2929 2066   i].tobytes()) f
+0003ed30: 6f72 2069 2069 6e20 7261 6e67 6528 6e29  or i in range(n)
+0003ed40: 5d0a 2020 2020 636f 756e 7473 203d 2043  ].    counts = C
+0003ed50: 6f75 6e74 6572 2868 6173 6865 7329 0a20  ounter(hashes). 
+0003ed60: 2020 2066 7265 7173 203d 207b 6b65 793a     freqs = {key:
+0003ed70: 2063 6f75 6e74 202f 206e 2066 6f72 206b   count / n for k
+0003ed80: 6579 2c20 636f 756e 7420 696e 2063 6f75  ey, count in cou
+0003ed90: 6e74 732e 6974 656d 7328 297d 0a20 2020  nts.items()}.   
+0003eda0: 2072 6574 7572 6e20 6672 6571 730a 0a0a   return freqs...
+0003edb0: 6465 6620 5f68 6170 6c6f 7479 7065 5f66  def _haplotype_f
+0003edc0: 7265 7175 656e 6369 6573 2868 293a 0a20  requencies(h):. 
+0003edd0: 2020 2022 2222 436f 6d70 7574 6520 6861     """Compute ha
+0003ede0: 706c 6f74 7970 6520 6672 6571 7565 6e63  plotype frequenc
+0003edf0: 6965 732c 2072 6574 7572 6e69 6e67 2061  ies, returning a
+0003ee00: 2064 6963 7469 6f6e 6172 7920 7468 6174   dictionary that
+0003ee10: 206d 6170 730a 2020 2020 6861 706c 6f74   maps.    haplot
+0003ee20: 7970 6520 6861 7368 2076 616c 7565 7320  ype hash values 
+0003ee30: 746f 2066 7265 7175 656e 6369 6573 2e22  to frequencies."
+0003ee40: 2222 0a20 2020 2023 2054 4f44 4f20 636f  "".    # TODO co
+0003ee50: 756c 6420 7573 6520 6661 7374 6572 2068  uld use faster h
+0003ee60: 6173 6869 6e67 0a20 2020 206e 203d 2068  ashing.    n = h
+0003ee70: 2e73 6861 7065 5b31 5d0a 2020 2020 6861  .shape[1].    ha
+0003ee80: 7368 6573 203d 205b 6861 7368 2868 5b3a  shes = [hash(h[:
+0003ee90: 2c20 695d 2e74 6f62 7974 6573 2829 2920  , i].tobytes()) 
+0003eea0: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
+0003eeb0: 295d 0a20 2020 2063 6f75 6e74 7320 3d20  )].    counts = 
+0003eec0: 436f 756e 7465 7228 6861 7368 6573 290a  Counter(hashes).
+0003eed0: 2020 2020 6672 6571 7320 3d20 7b6b 6579      freqs = {key
+0003eee0: 3a20 636f 756e 7420 2f20 6e20 666f 7220  : count / n for 
+0003eef0: 6b65 792c 2063 6f75 6e74 2069 6e20 636f  key, count in co
+0003ef00: 756e 7473 2e69 7465 6d73 2829 7d0a 2020  unts.items()}.  
+0003ef10: 2020 7265 7475 726e 2066 7265 7173 0a0a    return freqs..
+0003ef20: 0a64 6566 205f 6861 706c 6f74 7970 655f  .def _haplotype_
+0003ef30: 6a6f 696e 745f 6672 6571 7565 6e63 6965  joint_frequencie
+0003ef40: 7328 6861 2c20 6862 293a 0a20 2020 2022  s(ha, hb):.    "
+0003ef50: 2222 436f 6d70 7574 6520 7468 6520 6a6f  ""Compute the jo
+0003ef60: 696e 7420 6672 6571 7565 6e63 7920 6f66  int frequency of
+0003ef70: 2068 6170 6c6f 7479 7065 7320 696e 2074   haplotypes in t
+0003ef80: 776f 2064 6966 6665 7265 6e63 650a 2020  wo difference.  
+0003ef90: 2020 636f 686f 7274 732e 2052 6574 7572    cohorts. Retur
+0003efa0: 6e73 2061 2064 6963 7469 6f6e 6172 7920  ns a dictionary 
+0003efb0: 6d61 7070 696e 6720 6861 706c 6f74 7970  mapping haplotyp
+0003efc0: 6520 6861 7368 2076 616c 7565 7320 746f  e hash values to
+0003efd0: 0a20 2020 2074 6865 2070 726f 6475 6374  .    the product
+0003efe0: 206f 6620 6672 6571 7565 6e63 6965 7320   of frequencies 
+0003eff0: 696e 2065 6163 6820 636f 686f 7274 2e22  in each cohort."
+0003f000: 2222 0a20 2020 2066 7271 6120 3d20 5f68  "".    frqa = _h
+0003f010: 6170 6c6f 7479 7065 5f66 7265 7175 656e  aplotype_frequen
+0003f020: 6369 6573 2868 6129 0a20 2020 2066 7271  cies(ha).    frq
+0003f030: 6220 3d20 5f68 6170 6c6f 7479 7065 5f66  b = _haplotype_f
+0003f040: 7265 7175 656e 6369 6573 2868 6229 0a20  requencies(hb). 
+0003f050: 2020 206b 6579 7320 3d20 7365 7428 6672     keys = set(fr
+0003f060: 7161 2e6b 6579 7328 2929 207c 2073 6574  qa.keys()) | set
+0003f070: 2866 7271 622e 6b65 7973 2829 290a 2020  (frqb.keys()).  
+0003f080: 2020 6a6f 696e 745f 6672 6571 7320 3d20    joint_freqs = 
+0003f090: 7b6b 6579 3a20 6672 7161 2e67 6574 286b  {key: frqa.get(k
+0003f0a0: 6579 2c20 3029 202a 2066 7271 622e 6765  ey, 0) * frqb.ge
+0003f0b0: 7428 6b65 792c 2030 2920 666f 7220 6b65  t(key, 0) for ke
+0003f0c0: 7920 696e 206b 6579 737d 0a20 2020 2072  y in keys}.    r
+0003f0d0: 6574 7572 6e20 6a6f 696e 745f 6672 6571  eturn joint_freq
+0003f0e0: 730a 0a0a 6465 6620 5f68 3178 2868 612c  s...def _h1x(ha,
+0003f0f0: 2068 6229 3a0a 2020 2020 2222 2243 6f6d   hb):.    """Com
+0003f100: 7075 7465 2048 3158 2c20 7468 6520 7375  pute H1X, the su
+0003f110: 6d20 6f66 206a 6f69 6e74 2068 6170 6c6f  m of joint haplo
+0003f120: 7479 7065 2066 7265 7175 656e 6369 6573  type frequencies
+0003f130: 2062 6574 7765 656e 0a20 2020 2074 776f   between.    two
+0003f140: 2063 6f68 6f72 7473 2c20 7768 6963 6820   cohorts, which 
+0003f150: 6973 2061 2073 756d 6d61 7279 2073 7461  is a summary sta
+0003f160: 7469 7374 6963 2075 7365 6675 6c20 666f  tistic useful fo
+0003f170: 7220 6465 7465 6374 696e 670a 2020 2020  r detecting.    
+0003f180: 7368 6172 6564 2073 656c 6563 7469 7665  shared selective
+0003f190: 2073 7765 6570 732e 2222 220a 2020 2020   sweeps.""".    
+0003f1a0: 6a66 203d 205f 6861 706c 6f74 7970 655f  jf = _haplotype_
+0003f1b0: 6a6f 696e 745f 6672 6571 7565 6e63 6965  joint_frequencie
+0003f1c0: 7328 6861 2c20 6862 290a 2020 2020 7265  s(ha, hb).    re
+0003f1d0: 7475 726e 206e 702e 7375 6d28 6c69 7374  turn np.sum(list
+0003f1e0: 286a 662e 7661 6c75 6573 2829 2929 0a0a  (jf.values()))..
+0003f1f0: 0a64 6566 205f 6d6f 7669 6e67 5f68 3178  .def _moving_h1x
+0003f200: 2868 612c 2068 622c 2073 697a 652c 2073  (ha, hb, size, s
+0003f210: 7461 7274 3d30 2c20 7374 6f70 3d4e 6f6e  tart=0, stop=Non
+0003f220: 652c 2073 7465 703d 4e6f 6e65 293a 0a20  e, step=None):. 
+0003f230: 2020 2022 2222 436f 6d70 7574 6520 4831     """Compute H1
+0003f240: 5820 696e 206d 6f76 696e 6720 7769 6e64  X in moving wind
+0003f250: 6f77 732e 0a0a 2020 2020 5061 7261 6d65  ows...    Parame
+0003f260: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+0003f270: 2d2d 2d0a 2020 2020 6861 203a 2061 7272  ---.    ha : arr
+0003f280: 6179 5f6c 696b 652c 2069 6e74 2c20 7368  ay_like, int, sh
+0003f290: 6170 6520 286e 5f76 6172 6961 6e74 732c  ape (n_variants,
+0003f2a0: 206e 5f68 6170 6c6f 7479 7065 7329 0a20   n_haplotypes). 
+0003f2b0: 2020 2020 2020 2048 6170 6c6f 7479 7065         Haplotype
+0003f2c0: 2061 7272 6179 2066 6f72 2074 6865 2066   array for the f
+0003f2d0: 6972 7374 2063 6f68 6f72 742e 0a20 2020  irst cohort..   
+0003f2e0: 2068 6220 3a20 6172 7261 795f 6c69 6b65   hb : array_like
+0003f2f0: 2c20 696e 742c 2073 6861 7065 2028 6e5f  , int, shape (n_
+0003f300: 7661 7269 616e 7473 2c20 6e5f 6861 706c  variants, n_hapl
+0003f310: 6f74 7970 6573 290a 2020 2020 2020 2020  otypes).        
+0003f320: 4861 706c 6f74 7970 6520 6172 7261 7920  Haplotype array 
+0003f330: 666f 7220 7468 6520 7365 636f 6e64 2063  for the second c
+0003f340: 6f68 6f72 742e 0a20 2020 2073 697a 6520  ohort..    size 
+0003f350: 3a20 696e 740a 2020 2020 2020 2020 5468  : int.        Th
+0003f360: 6520 7769 6e64 6f77 2073 697a 6520 286e  e window size (n
+0003f370: 756d 6265 7220 6f66 2076 6172 6961 6e74  umber of variant
+0003f380: 7329 2e0a 2020 2020 7374 6172 7420 3a20  s)..    start : 
+0003f390: 696e 742c 206f 7074 696f 6e61 6c0a 2020  int, optional.  
+0003f3a0: 2020 2020 2020 5468 6520 696e 6465 7820        The index 
+0003f3b0: 6174 2077 6869 6368 2074 6f20 7374 6172  at which to star
+0003f3c0: 742e 0a20 2020 2073 746f 7020 3a20 696e  t..    stop : in
+0003f3d0: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+0003f3e0: 2020 2020 5468 6520 696e 6465 7820 6174      The index at
+0003f3f0: 2077 6869 6368 2074 6f20 7374 6f70 2e0a   which to stop..
+0003f400: 2020 2020 7374 6570 203a 2069 6e74 2c20      step : int, 
+0003f410: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0003f420: 2054 6865 206e 756d 6265 7220 6f66 2076   The number of v
+0003f430: 6172 6961 6e74 7320 6265 7477 6565 6e20  ariants between 
+0003f440: 7374 6172 7420 706f 7369 7469 6f6e 7320  start positions 
+0003f450: 6f66 2077 696e 646f 7773 2e20 4966 206e  of windows. If n
+0003f460: 6f74 0a20 2020 2020 2020 2067 6976 656e  ot.        given
+0003f470: 2c20 6465 6661 756c 7473 2074 6f20 7468  , defaults to th
+0003f480: 6520 7769 6e64 6f77 2073 697a 652c 2069  e window size, i
+0003f490: 2e65 2e2c 206e 6f6e 2d6f 7665 726c 6170  .e., non-overlap
+0003f4a0: 7069 6e67 2077 696e 646f 7773 2e0a 0a20  ping windows... 
+0003f4b0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+0003f4c0: 2d2d 2d2d 2d2d 0a20 2020 2068 3178 203a  ------.    h1x :
+0003f4d0: 206e 6461 7272 6179 2c20 666c 6f61 742c   ndarray, float,
+0003f4e0: 2073 6861 7065 2028 6e5f 7769 6e64 6f77   shape (n_window
+0003f4f0: 732c 290a 2020 2020 2020 2020 4831 5820  s,).        H1X 
+0003f500: 7661 6c75 6573 2028 7375 6d20 6f66 2073  values (sum of s
+0003f510: 7175 6172 6573 206f 6620 6a6f 696e 7420  quares of joint 
+0003f520: 6861 706c 6f74 7970 6520 6672 6571 7565  haplotype freque
+0003f530: 6e63 6965 7329 2e0a 2020 2020 2222 220a  ncies)..    """.
+0003f540: 0a20 2020 2061 7373 6572 7420 6861 2e6e  .    assert ha.n
+0003f550: 6469 6d20 3d3d 2068 622e 6e64 696d 203d  dim == hb.ndim =
+0003f560: 3d20 320a 2020 2020 6173 7365 7274 2068  = 2.    assert h
+0003f570: 612e 7368 6170 655b 305d 203d 3d20 6862  a.shape[0] == hb
+0003f580: 2e73 6861 7065 5b30 5d0a 0a20 2020 2023  .shape[0]..    #
+0003f590: 2063 6f6e 7374 7275 6374 206d 6f76 696e   construct movin
+0003f5a0: 6720 7769 6e64 6f77 730a 2020 2020 7769  g windows.    wi
+0003f5b0: 6e64 6f77 7320 3d20 616c 6c65 6c2e 696e  ndows = allel.in
+0003f5c0: 6465 785f 7769 6e64 6f77 7328 6861 2c20  dex_windows(ha, 
+0003f5d0: 7369 7a65 2c20 7374 6172 742c 2073 746f  size, start, sto
+0003f5e0: 702c 2073 7465 7029 0a0a 2020 2020 2320  p, step)..    # 
+0003f5f0: 636f 6d70 7574 6520 7374 6174 6973 7469  compute statisti
+0003f600: 6373 2066 6f72 2065 6163 6820 7769 6e64  cs for each wind
+0003f610: 6f77 0a20 2020 206f 7574 203d 206e 702e  ow.    out = np.
+0003f620: 6172 7261 7928 5b5f 6831 7828 6861 5b69  array([_h1x(ha[i
+0003f630: 3a6a 5d2c 2068 625b 693a 6a5d 2920 666f  :j], hb[i:j]) fo
+0003f640: 7220 692c 206a 2069 6e20 7769 6e64 6f77  r i, j in window
+0003f650: 735d 290a 0a20 2020 2072 6574 7572 6e20  s])..    return 
+0003f660: 6f75 740a                                out.
```

### Comparing `malariagen_data-7.5.0/malariagen_data/mjn.py` & `malariagen_data-7.6.0/malariagen_data/mjn.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/pf7.py` & `malariagen_data-7.6.0/malariagen_data/pf7.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/pf7_config.json` & `malariagen_data-7.6.0/malariagen_data/pf7_config.json`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/plasmodium.py` & `malariagen_data-7.6.0/malariagen_data/plasmodium.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/plotly_dendrogram.py` & `malariagen_data-7.6.0/malariagen_data/plotly_dendrogram.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/pv4.py` & `malariagen_data-7.6.0/malariagen_data/pv4.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/pv4_config.json` & `malariagen_data-7.6.0/malariagen_data/pv4_config.json`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/malariagen_data/util.py` & `malariagen_data-7.6.0/malariagen_data/util.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,17 +1,16 @@
 import hashlib
 import json
 import logging
 import re
 import sys
 import warnings
-from collections.abc import Mapping
 from enum import Enum
 from textwrap import dedent, fill
-from typing import IO, Optional, Tuple, Union
+from typing import IO, Dict, Hashable, List, Mapping, Optional, Tuple, Union
 from urllib.parse import unquote_plus
 
 try:
     from google import colab
 except ImportError:
     colab = None
 
@@ -467,35 +466,115 @@
 
     """
     pos = allel.SortedIndex(pos)
     loc_region = pos.locate_range(region.start, region.end)
     return loc_region
 
 
-def xarray_concat(
-    datasets,
-    dim,
-    data_vars="minimal",
-    coords="minimal",
-    compat="override",
-    join="override",
-    **kwargs,
-):
+def _simple_xarray_concat_arrays(
+    datasets: List[xr.Dataset], names: List[Hashable], dim: str
+) -> Mapping[Hashable, xr.DataArray]:
+    # Access the first dataset, this will be used as the template for
+    # any arrays that don't need to be concatenated.
+    ds0 = datasets[0]
+
+    # Set up return value, collection of concatenated arrays.
+    out: Dict[Hashable, xr.DataArray] = dict()
+
+    # Iterate over variable names.
+    for k in names:
+        # Access the variable from the virst dataset.
+        v = ds0[k]
+
+        if dim in v.dims:
+            # Dimension to be concatenated is present, need to concatenate.
+
+            # Figure out which axis corresponds to the given dimension.
+            axis = v.dims.index(dim)
+
+            # Access the xarray DataArrays to be concatenated.
+            xr_arrays = [ds[k] for ds in datasets]
+
+            # Check that all arrays have the same dimension as the same axis.
+            assert all([a.dims[axis] == dim for a in xr_arrays])
+
+            # Access the inner arrays - these are either numpy or dask arrays.
+            inner_arrays = [a.data for a in xr_arrays]
+
+            # Concatenate inner arrays, depending on their type.
+            if isinstance(inner_arrays[0], da.Array):
+                concatenated_array = da.concatenate(inner_arrays, axis=axis)
+            else:
+                concatenated_array = np.concatenate(inner_arrays, axis=axis)
+
+            # Store the result.
+            out[k] = xr.DataArray(data=concatenated_array, dims=v.dims)
+
+        else:
+            # No concatenation is needed, keep the variable from the first dataset.
+            out[k] = v
+
+    return out
+
+
+def simple_xarray_concat(
+    datasets: List[xr.Dataset], dim: str, attrs: Optional[Mapping] = None
+) -> xr.Dataset:
+    # Access the first dataset, this will be used as the template for
+    # any arrays that don't need to be concatenated.
+    ds0 = datasets[0]
+
+    if attrs is None:
+        # Copy attributes from the first dataset.
+        attrs = ds0.attrs
+
     if len(datasets) == 1:
-        return datasets[0]
-    else:
-        return xr.concat(
-            datasets,
-            dim=dim,
-            data_vars=data_vars,
-            coords=coords,
-            compat=compat,
-            join=join,
-            **kwargs,
-        )
+        # Fast path, nothing to concatenate.
+        return ds0
+
+    # Concatenate coordinate variables.
+    coords = _simple_xarray_concat_arrays(
+        datasets=datasets,
+        names=list(ds0.coords),
+        dim=dim,
+    )
+
+    # Concatenate data variables.
+    data_vars = _simple_xarray_concat_arrays(
+        datasets=datasets,
+        names=list(ds0.data_vars),
+        dim=dim,
+    )
+
+    return xr.Dataset(coords=coords, data_vars=data_vars, attrs=attrs)
+
+
+# xarray concat() function is very slow, don't use for now
+#
+# def xarray_concat(
+#     datasets,
+#     dim,
+#     data_vars="minimal",
+#     coords="minimal",
+#     compat="override",
+#     join="override",
+#     **kwargs,
+# ):
+#     if len(datasets) == 1:
+#         return datasets[0]
+#     else:
+#         return xr.concat(
+#             datasets,
+#             dim=dim,
+#             data_vars=data_vars,
+#             coords=coords,
+#             compat=compat,
+#             join=join,
+#             **kwargs,
+#         )
 
 
 def type_error(
     name,
     value,
     expectation,
 ):
```

### Comparing `malariagen_data-7.5.0/malariagen_data/veff.py` & `malariagen_data-7.6.0/malariagen_data/veff.py`

 * *Files identical despite different names*

### Comparing `malariagen_data-7.5.0/pyproject.toml` & `malariagen_data-7.6.0/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "malariagen_data"
-version = "7.5.0"
+version = "7.6.0"
 description = "A package for accessing and analysing MalariaGEN data."
 authors = [
     "Alistair Miles <alistair.miles@sanger.ac.uk>",
     "Chris Clarkson <cc28@sanger.ac.uk>",
     "Lee Hart <lee.hart@sanger.ac.uk>",
     "Kathryn Murie <km22@sanger.ac.uk>",
     "Nace Kranjc <n.kranjc@imperial.ac.uk>",
```

### Comparing `malariagen_data-7.5.0/PKG-INFO` & `malariagen_data-7.6.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: malariagen-data
-Version: 7.5.0
+Version: 7.6.0
 Summary: A package for accessing and analysing MalariaGEN data.
 License: MIT
 Author: Alistair Miles
 Author-email: alistair.miles@sanger.ac.uk
 Requires-Python: >=3.8,<3.11
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python :: 3
```

