# Comparing `tmp/odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1-py3-none-any.whl.zip` & `tmp/odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,32 +1,32 @@
-Zip file size: 56545 bytes, number of entries: 30
--rw-r--r--  2.0 unx     4963 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/README.rst
--rw-r--r--  2.0 unx       43 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/__init__.py
--rw-r--r--  2.0 unx      809 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/__manifest__.py
--rw-r--r--  2.0 unx     8146 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/i18n/account_journal_general_sequence.pot
--rw-r--r--  2.0 unx     9297 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/i18n/es.po
--rw-r--r--  2.0 unx     8293 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/i18n/hr.po
--rw-r--r--  2.0 unx       89 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/models/__init__.py
--rw-r--r--  2.0 unx     1295 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/models/account_journal.py
--rw-r--r--  2.0 unx     2248 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/models/account_move.py
--rw-r--r--  2.0 unx      265 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/models/account_move_line.py
--rw-r--r--  2.0 unx      513 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      111 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      276 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      299 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/readme/INSTALL.rst
--rw-r--r--  2.0 unx      725 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/readme/USAGE.rst
--rw-r--r--  2.0 unx      222 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/security/ir.model.access.csv
--rw-r--r--  2.0 unx    28942 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/static/description/icon.png
--rw-r--r--  2.0 unx    15045 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/static/description/index.html
--rw-r--r--  2.0 unx       29 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/tests/__init__.py
--rw-r--r--  2.0 unx     2921 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/tests/test_numbering.py
--rw-r--r--  2.0 unx     1111 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/views/account_journal.xml
--rw-r--r--  2.0 unx     1573 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/views/account_move.xml
--rw-r--r--  2.0 unx     1950 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/views/account_move_line.xml
--rw-r--r--  2.0 unx       43 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/wizards/__init__.py
--rw-r--r--  2.0 unx     2992 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard.py
--rw-r--r--  2.0 unx     1867 b- defN 22-Jun-30 02:36 odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard_views.xml
--rw-r--r--  2.0 unx     5595 b- defN 22-Jun-30 02:37 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 22-Jun-30 02:37 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 22-Jun-30 02:37 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3717 b- defN 22-Jun-30 02:37 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/RECORD
-30 files, 103476 bytes uncompressed, 50083 bytes compressed:  51.6%
+Zip file size: 56705 bytes, number of entries: 30
+-rw-r--r--  2.0 unx     4963 b- defN 23-Feb-01 02:50 odoo/addons/account_journal_general_sequence/README.rst
+-rw-r--r--  2.0 unx       43 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/__init__.py
+-rw-r--r--  2.0 unx      809 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/__manifest__.py
+-rw-r--r--  2.0 unx     8146 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/i18n/account_journal_general_sequence.pot
+-rw-r--r--  2.0 unx     9297 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/i18n/es.po
+-rw-r--r--  2.0 unx     8293 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/i18n/hr.po
+-rw-r--r--  2.0 unx       89 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/models/__init__.py
+-rw-r--r--  2.0 unx     1295 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/models/account_journal.py
+-rw-r--r--  2.0 unx     2248 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/models/account_move.py
+-rw-r--r--  2.0 unx      265 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/models/account_move_line.py
+-rw-r--r--  2.0 unx      513 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      111 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      276 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      299 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/readme/INSTALL.rst
+-rw-r--r--  2.0 unx      725 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/readme/USAGE.rst
+-rw-r--r--  2.0 unx      222 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/security/ir.model.access.csv
+-rw-r--r--  2.0 unx    28942 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/static/description/icon.png
+-rw-r--r--  2.0 unx    15045 b- defN 23-Feb-01 02:50 odoo/addons/account_journal_general_sequence/static/description/index.html
+-rw-r--r--  2.0 unx       29 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/tests/__init__.py
+-rw-r--r--  2.0 unx     3567 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/tests/test_numbering.py
+-rw-r--r--  2.0 unx     1111 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/views/account_journal.xml
+-rw-r--r--  2.0 unx     1573 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/views/account_move.xml
+-rw-r--r--  2.0 unx     1950 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/views/account_move_line.xml
+-rw-r--r--  2.0 unx       43 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/wizards/__init__.py
+-rw-r--r--  2.0 unx     3088 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard.py
+-rw-r--r--  2.0 unx     1867 b- defN 23-Feb-01 02:49 odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard_views.xml
+-rw-r--r--  2.0 unx     5595 b- defN 23-Feb-01 02:50 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Feb-01 02:50 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Feb-01 02:50 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     3717 b- defN 23-Feb-01 02:50 odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/RECORD
+30 files, 104218 bytes uncompressed, 50243 bytes compressed:  51.8%
```

## zipnote {}

```diff
@@ -72,20 +72,20 @@
 
 Filename: odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard.py
 Comment: 
 
 Filename: odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard_views.xml
 Comment: 
 
-Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/METADATA
+Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/WHEEL
+Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/top_level.txt
+Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/RECORD
+Filename: odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/account_journal_general_sequence/tests/test_numbering.py

```diff
@@ -1,40 +1,51 @@
 # Copyright 2022 Moduon
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html).
 from freezegun import freeze_time
 
-from odoo.tests.common import Form, tagged
+from odoo.tests.common import Form, new_test_user, tagged, users
 from odoo.tools import mute_logger
 
 from odoo.addons.account.tests.common import TestAccountReconciliationCommon
 
 
 @freeze_time("2022-05-11", tick=True)
 @tagged("post_install", "-at_install")
 class RenumberCase(TestAccountReconciliationCommon):
     @classmethod
     def setUpClass(cls):
         super().setUpClass()
+        cls.invoicer = new_test_user(
+            cls.env, "test_invoicer", "account.group_account_invoice"
+        )
+        cls.manager = new_test_user(
+            cls.env, "test_manager", "account.group_account_manager"
+        )
 
+    @users("test_invoicer")
     def test_invoice_gets_entry_number(self):
         # Draft invoice without entry number
         invoice = self._create_invoice()
         self.assertFalse(invoice.entry_number)
         # Gets one once posted
         invoice.action_post()
         self.assertTrue(invoice.entry_number.startswith("2022/"))
         # Lost number when canceled
         with mute_logger(
             "odoo.addons.account_journal_general_sequence.models.account_move"
         ):
             invoice.button_cancel()
         self.assertFalse(invoice.entry_number)
 
+    @users("test_manager")
     def test_renumber(self):
         # Post invoices in wrong order
+        next_year_invoice = self._create_invoice(
+            date_invoice="2023-12-31", auto_validate=True
+        )
         new_invoice = self._create_invoice(
             date_invoice="2022-05-10", auto_validate=True
         )
         old_invoice = self._create_invoice(
             date_invoice="2022-04-30", auto_validate=True
         )
         self.assertLess(new_invoice.entry_number, old_invoice.entry_number)
@@ -47,26 +58,29 @@
         # Add opening move
         opening_invoice = self._create_invoice(
             date_invoice="2022-01-01", auto_validate=True
         )
         self.assertGreater(opening_invoice.entry_number, new_invoice.entry_number)
         # Renumber again, starting from zero
         wiz_f = Form(self.env["account.move.renumber.wizard"])
-        wiz_f.starting_number = 0
         wiz = wiz_f.save()
         wiz.action_renumber()
-        self.assertEqual(opening_invoice.entry_number, "2022/0000000000")
+        self.assertEqual(opening_invoice.entry_number, "2022/0000000001")
+        self.assertEqual(old_invoice.entry_number, "2022/0000000002")
+        self.assertEqual(new_invoice.entry_number, "2022/0000000003")
+        self.assertEqual(next_year_invoice.entry_number, "2023/0000000001")
 
+    @users("test_invoicer")
     def test_install_no_entry_number(self):
         """No entry numbers assigned on module installation."""
         # Imitate installation environment
         self.env = self.env(
             context=dict(self.env.context, module="account_journal_general_sequence")
         )
-        self.env["ir.module.module"].search(
+        self.env["ir.module.module"].sudo().search(
             [("name", "=", "account_journal_general_sequence")]
         ).state = "to install"
         # Do some action that would make the move get an entry number
         invoice = self._create_invoice()
         self.assertFalse(invoice.entry_number)
         invoice.action_post()
         # Ensure there's no entry number
```

## odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard.py

```diff
@@ -68,15 +68,16 @@
         # Reset sequence
         future_ranges = self.env["ir.sequence.date_range"].search(
             [
                 ("date_from", ">", self.starting_date),
                 ("sequence_id", "=", self.sequence_id.id),
             ]
         )
-        future_ranges.unlink()
+        # Safe `sudo` calls; wizard only available for accounting managers
+        future_ranges.sudo().unlink()
         current_range = self.sequence_id._get_current_sequence(self.starting_date)
-        current_range.number_next = self.starting_number
-        self.sequence_id.number_next = self.starting_number
+        current_range.sudo().number_next = self.starting_number
+        self.sequence_id.sudo().number_next = self.starting_number
         # Renumber the moves
         moves.entry_number = False
         moves.flush(["entry_number"])
         moves._compute_entry_number()
```

## Comparing `odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/METADATA` & `odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-account-journal-general-sequence
-Version: 14.0.1.0.3.dev1
+Version: 14.0.1.0.3.dev3
 Summary: Add configurable sequence to account moves, per journal
 Home-page: https://github.com/OCA/account-financial-tools
 Author: Moduon, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/RECORD` & `odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/RECORD`

 * *Files 9% similar despite different names*

```diff
@@ -13,18 +13,18 @@
 odoo/addons/account_journal_general_sequence/readme/DESCRIPTION.rst,sha256=smDWoVXI_DZ8Atmml5S7vFMbpdABayCgE2je3YNbZsc,276
 odoo/addons/account_journal_general_sequence/readme/INSTALL.rst,sha256=0m2hFy7m2uvSrpc8pVUpd8W3IaCfWtTiBu1VY85PXXI,299
 odoo/addons/account_journal_general_sequence/readme/USAGE.rst,sha256=Cz9eUoOGvOdhiNb7ACcSwOqvAeyXDxtAAHcZEDaGZhE,725
 odoo/addons/account_journal_general_sequence/security/ir.model.access.csv,sha256=ncp_TUiQeYKcki_98FLBBDByD62Xcd5nz-8qmMdUsxU,222
 odoo/addons/account_journal_general_sequence/static/description/icon.png,sha256=dcjloBxfHaycFtsZBfehAegSPGdHicdK_tT94zC4E6Q,28942
 odoo/addons/account_journal_general_sequence/static/description/index.html,sha256=js8sM2wgfz46ztqLJQ1SgpDS_Bop-_c_7K5BZ82Y3_0,15045
 odoo/addons/account_journal_general_sequence/tests/__init__.py,sha256=mEEpt-FDvEib57w_8ESWNXtjvCTSwYBIkWPuPAtXsG4,29
-odoo/addons/account_journal_general_sequence/tests/test_numbering.py,sha256=6aTydpSIXh_U_5PnFroUOkenEZKg3-cR3Twjikq8NbM,2921
+odoo/addons/account_journal_general_sequence/tests/test_numbering.py,sha256=PqUftysp8CAhhd1mXLZDX4jM-VTFXhFqEwPwi9-AK-4,3567
 odoo/addons/account_journal_general_sequence/views/account_journal.xml,sha256=SUWZ6k_1U3bYLW0tmHueFySVtMipav-VCxeUC1HSbw8,1111
 odoo/addons/account_journal_general_sequence/views/account_move.xml,sha256=kilkesTNTxHa7ojv1IYidhHn5mFlcMQaw1iNPKY6dTM,1573
 odoo/addons/account_journal_general_sequence/views/account_move_line.xml,sha256=pq0f0zZaXxC5ArTbar4PJExNQcVEeA35xCV2ODyrtpE,1950
 odoo/addons/account_journal_general_sequence/wizards/__init__.py,sha256=LTx_UVX7mPQzvBJGWOMyESOrZGmh-zQEytueXplWi1Y,43
-odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard.py,sha256=MZZplshh9p-mY6Ur8qFw1HChyfbiOQZveuBKKewMZbM,2992
+odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard.py,sha256=qDoWFE4JY7e7Xry9aoybg62UTgKtS9dXMRji7wBQ8RA,3088
 odoo/addons/account_journal_general_sequence/wizards/account_move_renumber_wizard_views.xml,sha256=ePNunK80FvELl_FXtnT-uoaVgmpKtmzm0jATljUYVYQ,1867
-odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/METADATA,sha256=JcN0no-cgqZyYd8JERlLM_j-Wa_xrqO9aBZE3FxhJ28,5595
-odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev1.dist-info/RECORD,,
+odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/METADATA,sha256=qMe2wnbqvsIkQhLEgmT3L2dpRFzE9OZTfypL_5c4hFc,5595
+odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_account_journal_general_sequence-14.0.1.0.3.dev3.dist-info/RECORD,,
```

