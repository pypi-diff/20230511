# Comparing `tmp/odoo14_addon_endpoint-14.0.1.3.1.dev4-py3-none-any.whl.zip` & `tmp/odoo14_addon_endpoint-14.0.2.0.1.dev2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,30 +1,32 @@
-Zip file size: 33125 bytes, number of entries: 28
--rw-r--r--  2.0 unx     3320 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/README.rst
--rw-r--r--  2.0 unx       47 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/__init__.py
--rw-r--r--  2.0 unx      621 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/__manifest__.py
--rw-r--r--  2.0 unx       19 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/controllers/__init__.py
--rw-r--r--  2.0 unx     1892 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/controllers/main.py
--rw-r--r--  2.0 unx     3396 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/demo/endpoint_demo.xml
--rw-r--r--  2.0 unx     7095 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/i18n/endpoint.pot
--rw-r--r--  2.0 unx     7164 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/i18n/fr.po
--rw-r--r--  2.0 unx      603 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/migrations/14.0.1.1.0/pre-migrate.py
--rw-r--r--  2.0 unx       61 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/models/__init__.py
--rw-r--r--  2.0 unx      195 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/models/endpoint_endpoint.py
--rw-r--r--  2.0 unx     5852 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/models/endpoint_mixin.py
--rw-r--r--  2.0 unx       58 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx       43 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      316 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx       59 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/readme/ROADMAP.rst
--rw-r--r--  2.0 unx      180 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/security/ir.model.access.csv
--rw-r--r--  2.0 unx     9455 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/static/description/icon.png
--rw-r--r--  2.0 unx    12998 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/static/description/index.html
--rw-r--r--  2.0 unx       67 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/tests/__init__.py
--rw-r--r--  2.0 unx     1510 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/tests/common.py
--rw-r--r--  2.0 unx     6699 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/tests/test_endpoint.py
--rw-r--r--  2.0 unx     2861 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/tests/test_endpoint_controller.py
--rw-r--r--  2.0 unx     5379 b- defN 22-Sep-16 07:31 odoo/addons/endpoint/views/endpoint_view.xml
--rw-r--r--  2.0 unx     4003 b- defN 22-Sep-16 07:31 odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 22-Sep-16 07:31 odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 22-Sep-16 07:31 odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2756 b- defN 22-Sep-16 07:31 odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/RECORD
-28 files, 76746 bytes uncompressed, 28501 bytes compressed:  62.9%
+Zip file size: 35331 bytes, number of entries: 30
+-rw-r--r--  2.0 unx     3046 b- defN 23-May-11 16:30 odoo/addons/endpoint/README.rst
+-rw-r--r--  2.0 unx       81 b- defN 23-May-11 16:30 odoo/addons/endpoint/__init__.py
+-rw-r--r--  2.0 unx      660 b- defN 23-May-11 16:30 odoo/addons/endpoint/__manifest__.py
+-rw-r--r--  2.0 unx     2240 b- defN 23-May-11 16:30 odoo/addons/endpoint/hooks.py
+-rw-r--r--  2.0 unx       19 b- defN 23-May-11 16:30 odoo/addons/endpoint/controllers/__init__.py
+-rw-r--r--  2.0 unx     1913 b- defN 23-May-11 16:30 odoo/addons/endpoint/controllers/main.py
+-rw-r--r--  2.0 unx     3396 b- defN 23-May-11 16:30 odoo/addons/endpoint/demo/endpoint_demo.xml
+-rw-r--r--  2.0 unx     8405 b- defN 23-May-11 16:30 odoo/addons/endpoint/i18n/endpoint.pot
+-rw-r--r--  2.0 unx     7164 b- defN 23-May-11 16:30 odoo/addons/endpoint/i18n/fr.po
+-rw-r--r--  2.0 unx      603 b- defN 23-May-11 16:30 odoo/addons/endpoint/migrations/14.0.1.1.0/pre-migrate.py
+-rw-r--r--  2.0 unx      648 b- defN 23-May-11 16:30 odoo/addons/endpoint/migrations/14.0.2.0.0/post-migrate.py
+-rw-r--r--  2.0 unx       61 b- defN 23-May-11 16:30 odoo/addons/endpoint/models/__init__.py
+-rw-r--r--  2.0 unx      195 b- defN 23-May-11 16:30 odoo/addons/endpoint/models/endpoint_endpoint.py
+-rw-r--r--  2.0 unx     5927 b- defN 23-May-11 16:30 odoo/addons/endpoint/models/endpoint_mixin.py
+-rw-r--r--  2.0 unx       58 b- defN 23-May-11 16:30 odoo/addons/endpoint/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx       43 b- defN 23-May-11 16:30 odoo/addons/endpoint/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      316 b- defN 23-May-11 16:30 odoo/addons/endpoint/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx       59 b- defN 23-May-11 16:30 odoo/addons/endpoint/readme/ROADMAP.rst
+-rw-r--r--  2.0 unx      180 b- defN 23-May-11 16:30 odoo/addons/endpoint/security/ir.model.access.csv
+-rw-r--r--  2.0 unx     9455 b- defN 23-May-11 16:30 odoo/addons/endpoint/static/description/icon.png
+-rw-r--r--  2.0 unx    12603 b- defN 23-May-11 16:30 odoo/addons/endpoint/static/description/index.html
+-rw-r--r--  2.0 unx       67 b- defN 23-May-11 16:30 odoo/addons/endpoint/tests/__init__.py
+-rw-r--r--  2.0 unx     1510 b- defN 23-May-11 16:30 odoo/addons/endpoint/tests/common.py
+-rw-r--r--  2.0 unx     7741 b- defN 23-May-11 16:30 odoo/addons/endpoint/tests/test_endpoint.py
+-rw-r--r--  2.0 unx     2819 b- defN 23-May-11 16:30 odoo/addons/endpoint/tests/test_endpoint_controller.py
+-rw-r--r--  2.0 unx     6463 b- defN 23-May-11 16:30 odoo/addons/endpoint/views/endpoint_view.xml
+-rw-r--r--  2.0 unx     3728 b- defN 23-May-11 16:30 odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-11 16:30 odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-May-11 16:30 odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2956 b- defN 23-May-11 16:30 odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/RECORD
+30 files, 82453 bytes uncompressed, 30381 bytes compressed:  63.2%
```

## zipnote {}

```diff
@@ -3,14 +3,17 @@
 
 Filename: odoo/addons/endpoint/__init__.py
 Comment: 
 
 Filename: odoo/addons/endpoint/__manifest__.py
 Comment: 
 
+Filename: odoo/addons/endpoint/hooks.py
+Comment: 
+
 Filename: odoo/addons/endpoint/controllers/__init__.py
 Comment: 
 
 Filename: odoo/addons/endpoint/controllers/main.py
 Comment: 
 
 Filename: odoo/addons/endpoint/demo/endpoint_demo.xml
@@ -21,14 +24,17 @@
 
 Filename: odoo/addons/endpoint/i18n/fr.po
 Comment: 
 
 Filename: odoo/addons/endpoint/migrations/14.0.1.1.0/pre-migrate.py
 Comment: 
 
+Filename: odoo/addons/endpoint/migrations/14.0.2.0.0/post-migrate.py
+Comment: 
+
 Filename: odoo/addons/endpoint/models/__init__.py
 Comment: 
 
 Filename: odoo/addons/endpoint/models/endpoint_endpoint.py
 Comment: 
 
 Filename: odoo/addons/endpoint/models/endpoint_mixin.py
@@ -66,20 +72,20 @@
 
 Filename: odoo/addons/endpoint/tests/test_endpoint_controller.py
 Comment: 
 
 Filename: odoo/addons/endpoint/views/endpoint_view.xml
 Comment: 
 
-Filename: odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/METADATA
+Filename: odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/WHEEL
+Filename: odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/top_level.txt
+Filename: odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/RECORD
+Filename: odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/endpoint/README.rst

```diff
@@ -3,17 +3,17 @@
 ========
 
 .. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
-.. |badge1| image:: https://img.shields.io/badge/maturity-Alpha-red.png
+.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
-    :alt: Alpha
+    :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
     :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
     :alt: License: LGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fweb--api-lightgray.png?logo=github
     :target: https://github.com/OCA/web-api/tree/14.0/endpoint
     :alt: OCA/web-api
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
@@ -26,19 +26,14 @@
 
 Thanks to endpoint mixin the endpoint records are automatically registered as real Odoo routes.
 
 You can easily code what you want in the code snippet.
 
 NOTE: for security reasons any kind of RPC call is blocked on endpoint records.
 
-.. IMPORTANT::
-   This is an alpha version, the data model and design can change at any time without warning.
-   Only for development or testing purpose, do not use in production.
-   `More details on development status <https://odoo-community.org/page/development-status>`_
-
 **Table of contents**
 
 .. contents::
    :local:
 
 Configuration
 =============
```

## odoo/addons/endpoint/__init__.py

```diff
@@ -1,2 +1,3 @@
+from .hooks import post_init_hook
 from . import controllers
 from . import models
```

## odoo/addons/endpoint/__manifest__.py

```diff
@@ -1,21 +1,22 @@
 # Copyright 2021 Camptocamp SA
 # License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl).
 
 {
     "name": "Endpoint",
     "summary": """Provide custom endpoint machinery.""",
-    "version": "14.0.1.3.0",
+    "version": "14.0.2.0.0",
     "license": "LGPL-3",
-    "development_status": "Alpha",
+    "development_status": "Beta",
     "author": "Camptocamp,Odoo Community Association (OCA)",
     "maintainers": ["simahawk"],
     "website": "https://github.com/OCA/web-api",
     "depends": ["endpoint_route_handler", "rpc_helper"],
     "data": [
         "security/ir.model.access.csv",
         "views/endpoint_view.xml",
     ],
     "demo": [
         "demo/endpoint_demo.xml",
     ],
+    "post_init_hook": "post_init_hook",
 }
```

## odoo/addons/endpoint/controllers/main.py

```diff
@@ -8,16 +8,16 @@
 from werkzeug.exceptions import NotFound
 
 from odoo import http
 from odoo.http import Response, request
 
 
 class EndpointControllerMixin:
-    def _handle_endpoint(self, env, endpoint_route, **params):
-        endpoint = self._find_endpoint(env, endpoint_route)
+    def _handle_endpoint(self, env, model, endpoint_route, **params):
+        endpoint = self._find_endpoint(env, model, endpoint_route)
         if not endpoint:
             raise NotFound()
         endpoint._validate_request(request)
         result = endpoint._handle_request(request)
         return self._handle_result(result)
 
     def _handle_result(self, result):
@@ -37,18 +37,18 @@
         if headers is None:
             headers = {}
         headers["Content-Type"] = "application/json"
         resp = request.make_response(data, headers=headers)
         resp.status = str(status)
         return resp
 
-    def _find_endpoint(self, env, endpoint_route):
-        return env["endpoint.endpoint"]._find_endpoint(endpoint_route)
+    def _find_endpoint(self, env, model, endpoint_route):
+        return env[model]._find_endpoint(endpoint_route)
 
-    def auto_endpoint(self, endpoint_route, **params):
+    def auto_endpoint(self, model, endpoint_route, **params):
         """Default method to handle auto-generated endpoints"""
         env = request.env
-        return self._handle_endpoint(env, endpoint_route, **params)
+        return self._handle_endpoint(env, model, endpoint_route, **params)
 
 
 class EndpointController(http.Controller, EndpointControllerMixin):
     pass
```

## odoo/addons/endpoint/i18n/endpoint.pot

```diff
@@ -173,14 +173,37 @@
 #. module: endpoint
 #: model:ir.model.fields,field_description:endpoint.field_endpoint_endpoint__name
 #: model:ir.model.fields,field_description:endpoint.field_endpoint_mixin__name
 msgid "Name"
 msgstr ""
 
 #. module: endpoint
+#: model:ir.model.fields,help:endpoint.field_endpoint_endpoint__registry_sync
+#: model:ir.model.fields,help:endpoint.field_endpoint_mixin__registry_sync
+msgid ""
+"ON: the record has been modified and registry was not notified.\n"
+"No change will be active until this flag is set to false via proper action.\n"
+"\n"
+"OFF: record in line with the registry, nothing to do."
+msgstr ""
+
+#. module: endpoint
+#: model:ir.model.fields,field_description:endpoint.field_endpoint_endpoint__registry_sync
+#: model:ir.model.fields,field_description:endpoint.field_endpoint_mixin__registry_sync
+msgid "Registry Sync"
+msgstr ""
+
+#. module: endpoint
+#: model_terms:ir.ui.view,arch_db:endpoint.endpoint_endpoint_form_view
+msgid ""
+"Registry out of sync. Likely the record has been modified but not sync'ed "
+"with the routing registry."
+msgstr ""
+
+#. module: endpoint
 #: model_terms:ir.ui.view,arch_db:endpoint.endpoint_endpoint_form_view
 msgid "Request"
 msgstr ""
 
 #. module: endpoint
 #: model:ir.model.fields,field_description:endpoint.field_endpoint_endpoint__request_content_type
 #: model:ir.model.fields,field_description:endpoint.field_endpoint_mixin__request_content_type
@@ -208,14 +231,31 @@
 #. module: endpoint
 #: model:ir.model.fields,field_description:endpoint.field_endpoint_endpoint__route_type
 #: model:ir.model.fields,field_description:endpoint.field_endpoint_mixin__route_type
 msgid "Route Type"
 msgstr ""
 
 #. module: endpoint
+#: model:ir.actions.server,name:endpoint.server_action_registry_sync
+msgid "Sync registry"
+msgstr ""
+
+#. module: endpoint
+#: model_terms:ir.ui.view,arch_db:endpoint.endpoint_endpoint_search_view
+msgid "To sync"
+msgstr ""
+
+#. module: endpoint
+#: model_terms:ir.ui.view,arch_db:endpoint.endpoint_endpoint_form_view
+msgid ""
+"Use the action \"Sync registry\" to make changes effective once you are done"
+" with edits and creates."
+msgstr ""
+
+#. module: endpoint
 #: model:ir.model.fields,help:endpoint.field_endpoint_endpoint__route_group
 #: model:ir.model.fields,help:endpoint.field_endpoint_mixin__route_group
 msgid "Use this to classify routes together"
 msgstr ""
 
 #. module: endpoint
 #: code:addons/endpoint/models/endpoint_mixin.py:0
```

## odoo/addons/endpoint/models/endpoint_mixin.py

```diff
@@ -1,23 +1,20 @@
 # Copyright 2021 Camptocamp SA
 # @author: Simone Orsi <simone.orsi@camptocamp.com>
 # License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl).
 
 import textwrap
-from functools import partial
 
 import werkzeug
 
 from odoo import _, api, exceptions, fields, http, models
 from odoo.tools import safe_eval
 
 from odoo.addons.rpc_helper.decorator import disable_rpc
 
-from ..controllers.main import EndpointController
-
 
 @disable_rpc()  # Block ALL RPC calls
 class EndpointMixin(models.AbstractModel):
 
     _name = "endpoint.mixin"
     _inherit = "endpoint.route.handler"
     _description = "Endpoint mixin"
@@ -130,16 +127,20 @@
             [
                 not line.startswith("#")
                 for line in (snippet.splitlines())
                 if line.strip("")
             ]
         )
 
-    def _default_endpoint_handler(self):
-        return partial(EndpointController().auto_endpoint, self.route)
+    def _default_endpoint_options_handler(self):
+        return {
+            "klass_dotted_path": "odoo.addons.endpoint.controllers.main.EndpointController",
+            "method_name": "auto_endpoint",
+            "default_pargs": (self._name, self.route),
+        }
 
     def _validate_request(self, request):
         http_req = request.httprequest
         if self.request_method and self.request_method != http_req.method:
             self._logger.error("_validate_request: MethodNotAllowed")
             raise werkzeug.exceptions.MethodNotAllowed()
         if (
```

## odoo/addons/endpoint/static/description/index.html

### odoo/addons/endpoint/static/description/index.html

```diff
@@ -362,15 +362,15 @@
       <h1 class="title">Endpoint</h1>
       <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 !! This file is generated by oca-gen-addon-readme !!
 !! changes will be overwritten.                   !!
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
       <p>
         <a class="reference external" href="https://odoo-community.org/page/development-status">
-          <img alt="Alpha" src="https://img.shields.io/badge/maturity-Alpha-red.png"/>
+          <img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png"/>
         </a>
         <a class="reference external" href="http://www.gnu.org/licenses/lgpl-3.0-standalone.html">
           <img alt="License: LGPL-3" src="https://img.shields.io/badge/licence-LGPL--3-blue.png"/>
         </a>
         <a class="reference external" href="https://github.com/OCA/web-api/tree/14.0/endpoint">
           <img alt="OCA/web-api" src="https://img.shields.io/badge/github-OCA%2Fweb--api-lightgray.png?logo=github"/>
         </a>
@@ -378,22 +378,14 @@
           <img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png"/>
         </a>
       </p>
       <p>Provide an endpoint framework allowing users to define their own custom endpoint.</p>
       <p>Thanks to endpoint mixin the endpoint records are automatically registered as real Odoo routes.</p>
       <p>You can easily code what you want in the code snippet.</p>
       <p>NOTE: for security reasons any kind of RPC call is blocked on endpoint records.</p>
-      <div class="admonition important">
-        <p class="first admonition-title">Important</p>
-        <p class="last">
-          This is an alpha version, the data model and design can change at any time without warning.
-Only for development or testing purpose, do not use in production.
-          <a class="reference external" href="https://odoo-community.org/page/development-status">More details on development status</a>
-        </p>
-      </div>
       <p>
         <strong>Table of contents</strong>
       </p>
       <div class="contents local topic" id="contents">
         <ul class="simple">
           <li>
             <a class="reference internal" href="#configuration" id="id1">Configuration</a>
```

## odoo/addons/endpoint/tests/test_endpoint.py

```diff
@@ -1,14 +1,15 @@
 # Copyright 2021 Camptocamp SA
 # @author: Simone Orsi <simone.orsi@camptocamp.com>
 # License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl).
 
 import json
 import textwrap
 
+import mock
 import psycopg2
 import werkzeug
 
 from odoo import exceptions
 from odoo.tools.misc import mute_logger
 
 from .common import CommonEndpoint
@@ -41,28 +42,28 @@
                     "route": "/demo/2",
                     "exec_mode": "code",
                     "request_method": "GET",
                     "auth_type": "user_endpoint",
                 }
             )
         with self.assertRaisesRegex(
-            exceptions.UserError, r"Request method is required for"
+            exceptions.UserError, r"Request content type is required for POST and PUT."
         ):
             self.env["endpoint.endpoint"].create(
                 {
                     "name": "Endpoint 3",
                     "route": "/demo/3",
                     "exec_mode": "code",
                     "code_snippet": "foo = 1",
                     "request_method": "POST",
                     "auth_type": "user_endpoint",
                 }
             )
         with self.assertRaisesRegex(
-            exceptions.UserError, r"Request method is required for"
+            exceptions.UserError, r"Request content type is required for POST and PUT."
         ):
             self.endpoint.request_method = "POST"
 
     def test_endpoint_find(self):
         self.assertEqual(
             self.env["endpoint.endpoint"]._find_endpoint("/demo/one"), self.endpoint
         )
@@ -88,15 +89,15 @@
             }
         )
         with self._get_mocked_request() as req:
             result = self.endpoint._handle_request(req)
         payload = result["payload"]
         self.assertEqual(json.loads(payload), {"a": 1, "b": 2})
 
-    @mute_logger("endpoint.endpoint")
+    @mute_logger("endpoint.endpoint", "odoo.modules.registry")
     def test_endpoint_validate_request(self):
         endpoint = self.endpoint.copy(
             {
                 "route": "/wrong",
                 "request_method": "POST",
                 "request_content_type": "text/plain",
             }
@@ -107,14 +108,15 @@
         with self.assertRaises(werkzeug.exceptions.MethodNotAllowed):
             with self._get_mocked_request(
                 httprequest={"method": "GET"},
                 extra_headers=[("Content-type", "text/plain")],
             ) as req:
                 endpoint._validate_request(req)
 
+    @mute_logger("odoo.modules.registry")
     def test_routing(self):
         route, info, __ = self.endpoint._get_routing_info()
         self.assertEqual(route, "/demo/one")
         self.assertEqual(
             info,
             {
                 "auth": "user_endpoint",
@@ -156,43 +158,67 @@
                 "routes": ["/foo/new/one"],
                 "type": "http",
                 "csrf": False,
             },
         )
         type(endpoint)._endpoint_route_prefix = ""
 
+    @mute_logger("odoo.modules.registry")
     def test_unlink(self):
         endpoint = self.endpoint.copy(
             {
                 "route": "/delete/this",
                 "request_method": "POST",
                 "request_content_type": "text/plain",
                 "auth_type": "public",
                 "exec_as_user_id": self.env.user.id,
             }
         )
-        registry = endpoint._endpoint_registry
+        endpoint._handle_registry_sync()
+        key = endpoint._endpoint_registry_unique_key()
+        reg = endpoint._endpoint_registry
+        self.assertEqual(reg._get_rule(key).route, "/delete/this")
         endpoint.unlink()
-        http_id = self.env["ir.http"]._endpoint_make_http_id()
-        self.assertTrue(registry.routing_update_required(http_id))
+        self.assertEqual(reg._get_rule(key), None)
 
-    def test_archiving(self):
+    @mute_logger("odoo.modules.registry")
+    def test_archive(self):
         endpoint = self.endpoint.copy(
             {
                 "route": "/enable-disable/this",
                 "request_method": "POST",
                 "request_content_type": "text/plain",
                 "auth_type": "public",
                 "exec_as_user_id": self.env.user.id,
             }
         )
+        endpoint._handle_registry_sync()
         self.assertTrue(endpoint.active)
-        registry = endpoint._endpoint_registry
-        http_id = self.env["ir.http"]._endpoint_make_http_id()
-        fake_2nd_http_id = id(2)
-        registry.ir_http_track(http_id)
-        self.assertFalse(registry.routing_update_required(http_id))
-        self.assertFalse(registry.routing_update_required(fake_2nd_http_id))
-
+        key = endpoint._endpoint_registry_unique_key()
+        reg = endpoint._endpoint_registry
+        self.assertEqual(reg._get_rule(key).route, "/enable-disable/this")
         endpoint.active = False
-        self.assertTrue(registry.routing_update_required(http_id))
-        self.assertFalse(registry.routing_update_required(fake_2nd_http_id))
+        endpoint._handle_registry_sync()
+        self.assertEqual(reg._get_rule(key), None)
+
+    def test_registry_sync(self):
+        endpoint = self.env["endpoint.endpoint"].create(
+            {
+                "name": "New",
+                "route": "/not/active/yet",
+                "exec_mode": "code",
+                "code_snippet": "foo = 1",
+                "request_method": "GET",
+                "auth_type": "user_endpoint",
+            }
+        )
+        self.assertFalse(endpoint.registry_sync)
+        key = endpoint._endpoint_registry_unique_key()
+        reg = endpoint._endpoint_registry
+        self.assertEqual(reg._get_rule(key), None)
+        with mock.patch.object(type(self.env.cr.postcommit), "add") as mocked:
+            endpoint.registry_sync = True
+            partial_func = mocked.call_args[0][0]
+            self.assertEqual(partial_func.args, ([endpoint.id],))
+            self.assertEqual(
+                partial_func.func.__name__, "_handle_registry_sync_post_commit"
+            )
```

## odoo/addons/endpoint/tests/test_endpoint_controller.py

```diff
@@ -1,29 +1,30 @@
 # Copyright 2021 Camptocamp SA
 # @author: Simone Orsi <simone.orsi@camptocamp.com>
 # License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl).
 
 import json
 import os
-import unittest
+from unittest import skipIf
 
-from odoo.tests.common import HttpCase
+from odoo.tests.common import HttpSavepointCase
 from odoo.tools.misc import mute_logger
 
-# odoo.addons.base.models.res_users: Login successful for db:openerp_test login:admin from n/a
-# endpoint.endpoint: Registered controller /demo/one/new (auth: user_endpoint)
-# odoo.addons.endpoint.models.ir_http: DROPPED /demo/one
-# odoo.addons.endpoint.models.ir_http: LOADED /demo/one/new
-# odoo.addons.endpoint.models.ir_http: Endpoint routing map re-loaded
 
-
-@unittest.skipIf(os.getenv("SKIP_HTTP_CASE"), "EndpointHttpCase skipped")
-class EndpointHttpCase(HttpCase):
-    def setUp(self):
-        super().setUp()
+@skipIf(os.getenv("SKIP_HTTP_CASE"), "EndpointHttpCase skipped")
+class EndpointHttpCase(HttpSavepointCase):
+    @classmethod
+    def setUpClass(cls):
+        super().setUpClass()
+        # force sync for demo records
+        cls.env["endpoint.endpoint"].search([])._handle_registry_sync()
+
+    def tearDown(self):
+        self.env["ir.http"]._clear_routing_map()
+        super().tearDown()
 
     def test_call1(self):
         response = self.url_open("/demo/one")
         self.assertEqual(response.status_code, 401)
         # Let's login now
         self.authenticate("admin", "admin")
         response = self.url_open("/demo/one")
@@ -31,14 +32,16 @@
         self.assertEqual(response.content, b"ok")
 
     def test_call_route_update(self):
         # Ensure that a route that gets updated is not available anymore
         self.authenticate("admin", "admin")
         endpoint = self.env.ref("endpoint.endpoint_demo_1")
         endpoint.route += "/new"
+        # force sync
+        endpoint._handle_registry_sync()
         response = self.url_open("/demo/one")
         self.assertEqual(response.status_code, 404)
         response = self.url_open("/demo/one/new")
         self.assertEqual(response.status_code, 200)
         self.assertEqual(response.content, b"ok")
         # Archive it
         endpoint.active = False
```

## odoo/addons/endpoint/views/endpoint_view.xml

### odoo/addons/endpoint/views/endpoint_view.xml

```diff
@@ -5,16 +5,21 @@
   <record model="ir.ui.view" id="endpoint_endpoint_form_view">
     <field name="name">endpoint.endpoint.form</field>
     <field name="model">endpoint.endpoint</field>
     <field name="arch" type="xml">
       <form>
         <header/>
         <field name="active" invisible="1"/>
-        <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
+        <field name="registry_sync" invisible="1"/>
+        <widget name="web_ribbon" title="Archived" bg_color="bg-warning" attrs="{'invisible': [('active', '=', True)]}"/>
         <sheet>
+          <div class="alert alert-warning" role="alert" attrs="{'invisible': ['|', ('registry_sync', '=', True), ('id', '=', False)]}">
+            <p>Registry out of sync. Likely the record has been modified but not sync'ed with the routing registry.</p>
+            <p>Use the action &quot;Sync registry&quot; to make changes effective once you are done with edits and creates.</p>
+          </div>
           <div name="title" class="oe_title">
             <label for="name" class="oe_edit_only"/>
             <h1>
               <field name="name"/>
             </h1>
             <label for="route" class="oe_edit_only"/>
             <h2>
@@ -56,29 +61,32 @@
     <field name="model">endpoint.endpoint</field>
     <field name="arch" type="xml">
       <search>
         <field name="name"/>
         <field name="route"/>
         <field name="exec_mode"/>
         <field name="active"/>
+        <field name="registry_sync"/>
         <filter string="All" name="all" domain="['|', ('active', '=', False), ('active', '=', True)]"/>
+        <filter string="To sync" name="sync" domain="[('registry_sync', '=', False), ('active', 'in', (True, False))]"/>
         <separator/>
         <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
       </search>
     </field>
   </record>
   <record model="ir.ui.view" id="endpoint_endpoint_tree_view">
     <field name="name">endpoint.endpoint.tree</field>
     <field name="model">endpoint.endpoint</field>
     <field name="arch" type="xml">
-      <tree decoration-muted="(not active)">
+      <tree decoration-muted="(not active)" decoration-warning="(not registry_sync)">
         <field name="name"/>
         <field name="route"/>
         <field name="exec_mode"/>
         <field name="active" widget="boolean_toggle"/>
+        <field name="registry_sync"/>
       </tree>
     </field>
   </record>
   <record model="ir.actions.act_window" id="endpoint_endpoint_act_window">
     <field name="name">Endpoints</field>
     <field name="res_model">endpoint.endpoint</field>
     <field name="view_mode">tree,form</field>
```

## Comparing `odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/METADATA` & `odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/METADATA`

 * *Files 12% similar despite different names*

```diff
@@ -1,38 +1,38 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-endpoint
-Version: 14.0.1.3.1.dev4
+Version: 14.0.2.0.1.dev2
 Summary: Provide custom endpoint machinery.
 Home-page: https://github.com/OCA/web-api
 Author: Camptocamp,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
 Classifier: Framework :: Odoo :: 14.0
 Classifier: License :: OSI Approved :: GNU Lesser General Public License v3 (LGPLv3)
-Classifier: Development Status :: 3 - Alpha
+Classifier: Development Status :: 4 - Beta
 Requires-Python: >=3.6
 Requires-Dist: odoo14-addon-endpoint-route-handler
 Requires-Dist: odoo14-addon-rpc-helper
 Requires-Dist: odoo (<14.1dev,>=14.0a)
 
 ========
 Endpoint
 ========
 
 .. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
-.. |badge1| image:: https://img.shields.io/badge/maturity-Alpha-red.png
+.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
-    :alt: Alpha
+    :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
     :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
     :alt: License: LGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fweb--api-lightgray.png?logo=github
     :target: https://github.com/OCA/web-api/tree/14.0/endpoint
     :alt: OCA/web-api
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
@@ -45,19 +45,14 @@
 
 Thanks to endpoint mixin the endpoint records are automatically registered as real Odoo routes.
 
 You can easily code what you want in the code snippet.
 
 NOTE: for security reasons any kind of RPC call is blocked on endpoint records.
 
-.. IMPORTANT::
-   This is an alpha version, the data model and design can change at any time without warning.
-   Only for development or testing purpose, do not use in production.
-   `More details on development status <https://odoo-community.org/page/development-status>`_
-
 **Table of contents**
 
 .. contents::
    :local:
 
 Configuration
 =============
```

## Comparing `odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/RECORD` & `odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/RECORD`

 * *Files 6% similar despite different names*

```diff
@@ -1,28 +1,30 @@
-odoo/addons/endpoint/README.rst,sha256=7jpYba13T_Di8-cqutP8iCrB5B-9lLXoNVAYLxsCl6M,3320
-odoo/addons/endpoint/__init__.py,sha256=jQ-fltIs1ohXt7udDkkJwzh7ckauQW2rbmv1Wtg3SjQ,47
-odoo/addons/endpoint/__manifest__.py,sha256=xrcandXV7QD6VzBQ51ayExYlwH_bxCeeeiWUss0uMXg,621
+odoo/addons/endpoint/README.rst,sha256=4z4RwjoP5dyWWEViysQxNkVM9T3bDm6s4t7LcnEuTHM,3046
+odoo/addons/endpoint/__init__.py,sha256=dRAfW9BFM3vt1xgcL5hHgb3Jgqm4QaAJgiwwMShUSTc,81
+odoo/addons/endpoint/__manifest__.py,sha256=1_uoGTLki5sUhspo4edn5fd90FjBuucyX1Xk4BlTglI,660
+odoo/addons/endpoint/hooks.py,sha256=_0OjETqFx_AkJLU9w3st-zWo3XfD2_U23rSe6UHLaY4,2240
 odoo/addons/endpoint/controllers/__init__.py,sha256=4KFqEP2QHFbPN66eQJMdGsmNz2v7ywWv_FR1pW_kkLk,19
-odoo/addons/endpoint/controllers/main.py,sha256=M_fOMF8llQuNg3LIZoq5sZEyOOS6agdHRK7507Gm5Fo,1892
+odoo/addons/endpoint/controllers/main.py,sha256=5B6BLbwYQ3tiWpXBLaz-VYoLN0qmq43m7DWjCicVxxw,1913
 odoo/addons/endpoint/demo/endpoint_demo.xml,sha256=LYHbGoEl_94bJ9X-FTDLk71NLHfJfBepi7zVaY7JJQc,3396
-odoo/addons/endpoint/i18n/endpoint.pot,sha256=KnE7MOUDIMxyHTporjCha3kNvClhNQ9SXVet8lrzMf4,7095
+odoo/addons/endpoint/i18n/endpoint.pot,sha256=K309tCE0jnyAlSxNIvbnOK3e4e7xKcQa8RU0R5dTD-0,8405
 odoo/addons/endpoint/i18n/fr.po,sha256=L34rzr6z2Zn9bT_Ui31lfZaG9CFWfzrwpzYl_L9-7VI,7164
 odoo/addons/endpoint/migrations/14.0.1.1.0/pre-migrate.py,sha256=Ch93TPk5aF1SoGSDdtmyxTqzs-eJ7xApxExIX7JkMNA,603
+odoo/addons/endpoint/migrations/14.0.2.0.0/post-migrate.py,sha256=P2jvYnZiklSgrfAt8YbWkC2VU75oUPvf8QOBE7HXHwY,648
 odoo/addons/endpoint/models/__init__.py,sha256=yxrvs2SEykPiHhqCfdZGPwivPtWsKj6pP2kF8hOn6Q4,61
 odoo/addons/endpoint/models/endpoint_endpoint.py,sha256=Fr3yzGNmt1vZzLO2_6n-gg-ZdijQ9k2woc_Zf9uEE80,195
-odoo/addons/endpoint/models/endpoint_mixin.py,sha256=R8YOmA45jTzeVYD-cC--Yjo6AuLE3P9D2nWyGK6om1M,5852
+odoo/addons/endpoint/models/endpoint_mixin.py,sha256=LTJBYlXSFQplRD8kWmvBFjL3bEgvGaabvfRFPYKmb6Q,5927
 odoo/addons/endpoint/readme/CONFIGURE.rst,sha256=Rp9ia6G5l6CsnZklPXAEVah7cOAXCOHLux_3WQZEPLE,58
 odoo/addons/endpoint/readme/CONTRIBUTORS.rst,sha256=1ADhmOLCMAtDVg9t5Fstl0AwYHMzEiFSenM8tO5AtqY,43
 odoo/addons/endpoint/readme/DESCRIPTION.rst,sha256=sOE2YZey_S4cF4z_woo8B7_pEuHc4NA_7rkitnOb3f4,316
 odoo/addons/endpoint/readme/ROADMAP.rst,sha256=WT9QX7eeSyTyj8q0YZkVFY5Ucbn-FjK9szfcLrSd0Qw,59
 odoo/addons/endpoint/security/ir.model.access.csv,sha256=VfWyTPdM8Clp-1zANrZ_rcxefL4-QdL4hu8Ioa8A9lo,180
 odoo/addons/endpoint/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/endpoint/static/description/index.html,sha256=EgO94YErZHmd9OeeltSdFnB9eSkMKWP7KFqDMkxog-k,12998
+odoo/addons/endpoint/static/description/index.html,sha256=72E-uJpJWAo-iGdwAC3PQtVSeoycfpdf7N0D1LVfLpI,12603
 odoo/addons/endpoint/tests/__init__.py,sha256=-_pIt_B8gTI0YknCT1q7lZZs23uNH_VoQCgl9Nyey4o,67
 odoo/addons/endpoint/tests/common.py,sha256=WutB-HWGkJ83SxPjHMbIMZ6zM3kwH8K5Uz5YInZrttQ,1510
-odoo/addons/endpoint/tests/test_endpoint.py,sha256=TY6RJhwKNPQP1YdPq1_9TAySd8tgSnwzmJnkaIP8Ugg,6699
-odoo/addons/endpoint/tests/test_endpoint_controller.py,sha256=1s3g3kR88vNlDxJhQdDaPsPWA6vz9_wBWEUbwL3_7u4,2861
-odoo/addons/endpoint/views/endpoint_view.xml,sha256=r06RtvtudrVmXa61DBnMbXptPO_inyebnH02kuwts8Q,5379
-odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/METADATA,sha256=ZUP15q7V-UoKrC8Zj712ffieoRirPFxXqYCpO0Vc42A,4003
-odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_endpoint-14.0.1.3.1.dev4.dist-info/RECORD,,
+odoo/addons/endpoint/tests/test_endpoint.py,sha256=c8Bmx57z5Sip9MnIK1JA2sGp-amfxzOiGkbGMrbE5AQ,7741
+odoo/addons/endpoint/tests/test_endpoint_controller.py,sha256=4z0FZCbQhoeQyC1OVj32uH_Bb46hR4DzYa88Xb5gHn4,2819
+odoo/addons/endpoint/views/endpoint_view.xml,sha256=cVuzq3Oud3go5hcRGkSVOcWBjYTiF8yReEUz7nuDCP4,6463
+odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/METADATA,sha256=NHlTraAhyK8XQXWfEiHNZwqRQHuotsHIwDqxVxWXgcU,3728
+odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_endpoint-14.0.2.0.1.dev2.dist-info/RECORD,,
```

