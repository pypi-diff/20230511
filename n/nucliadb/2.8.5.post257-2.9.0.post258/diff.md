# Comparing `tmp/nucliadb-2.8.5.post257-py3-none-any.whl.zip` & `tmp/nucliadb-2.9.0.post258-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,306 +1,314 @@
-Zip file size: 516912 bytes, number of entries: 304
--rw-r--r--  2.0 unx      891 b- defN 23-May-11 12:09 nucliadb/__init__.py
--rw-r--r--  2.0 unx     1027 b- defN 23-May-11 12:09 nucliadb/app.py
--rw-r--r--  2.0 unx     4846 b- defN 23-May-11 12:09 nucliadb/config.py
--rw-r--r--  2.0 unx     1420 b- defN 23-May-11 12:09 nucliadb/purge.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-11 12:09 nucliadb/py.typed
--rw-r--r--  2.0 unx     2522 b- defN 23-May-11 12:09 nucliadb/run.py
--rw-r--r--  2.0 unx     1913 b- defN 23-May-11 12:09 nucliadb/settings.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/http_clients/__init__.py
--rw-r--r--  2.0 unx     1100 b- defN 23-May-11 12:09 nucliadb/http_clients/exceptions.py
--rw-r--r--  2.0 unx     4144 b- defN 23-May-11 12:09 nucliadb/http_clients/processing.py
--rw-r--r--  2.0 unx     1011 b- defN 23-May-11 12:09 nucliadb/ingest/__init__.py
--rw-r--r--  2.0 unx     6021 b- defN 23-May-11 12:09 nucliadb/ingest/app.py
--rw-r--r--  2.0 unx      995 b- defN 23-May-11 12:09 nucliadb/ingest/cache.py
--rw-r--r--  2.0 unx     6563 b- defN 23-May-11 12:09 nucliadb/ingest/chitchat.py
--rw-r--r--  2.0 unx     2425 b- defN 23-May-11 12:09 nucliadb/ingest/partitions.py
--rw-r--r--  2.0 unx    15823 b- defN 23-May-11 12:09 nucliadb/ingest/processing.py
--rw-r--r--  2.0 unx     5308 b- defN 23-May-11 12:09 nucliadb/ingest/purge.py
--rw-r--r--  2.0 unx    18976 b- defN 23-May-11 12:09 nucliadb/ingest/serialize.py
--rw-r--r--  2.0 unx     3025 b- defN 23-May-11 12:09 nucliadb/ingest/settings.py
--rw-r--r--  2.0 unx     2531 b- defN 23-May-11 12:09 nucliadb/ingest/txn_utils.py
--rw-r--r--  2.0 unx     4917 b- defN 23-May-11 12:09 nucliadb/ingest/utils.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/consumer/__init__.py
--rw-r--r--  2.0 unx    10672 b- defN 23-May-11 12:09 nucliadb/ingest/consumer/consumer.py
--rw-r--r--  2.0 unx     7071 b- defN 23-May-11 12:09 nucliadb/ingest/consumer/pull.py
--rw-r--r--  2.0 unx     5045 b- defN 23-May-11 12:09 nucliadb/ingest/consumer/service.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/fields/__init__.py
--rw-r--r--  2.0 unx    19273 b- defN 23-May-11 12:09 nucliadb/ingest/fields/base.py
--rw-r--r--  2.0 unx     6495 b- defN 23-May-11 12:09 nucliadb/ingest/fields/conversation.py
--rw-r--r--  2.0 unx     1223 b- defN 23-May-11 12:09 nucliadb/ingest/fields/date.py
--rw-r--r--  2.0 unx     1205 b- defN 23-May-11 12:09 nucliadb/ingest/fields/exceptions.py
--rw-r--r--  2.0 unx     5159 b- defN 23-May-11 12:09 nucliadb/ingest/fields/file.py
--rw-r--r--  2.0 unx     1523 b- defN 23-May-11 12:09 nucliadb/ingest/fields/generic.py
--rw-r--r--  2.0 unx     1235 b- defN 23-May-11 12:09 nucliadb/ingest/fields/keywordset.py
--rw-r--r--  2.0 unx     2250 b- defN 23-May-11 12:09 nucliadb/ingest/fields/layout.py
--rw-r--r--  2.0 unx     4084 b- defN 23-May-11 12:09 nucliadb/ingest/fields/link.py
--rw-r--r--  2.0 unx     1319 b- defN 23-May-11 12:09 nucliadb/ingest/fields/text.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/__init__.py
--rw-r--r--  2.0 unx     2631 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/driver.py
--rw-r--r--  2.0 unx      980 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/keys.py
--rw-r--r--  2.0 unx     7076 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/local.py
--rw-r--r--  2.0 unx     5400 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/pg.py
--rw-r--r--  2.0 unx     6146 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/redis.py
--rw-r--r--  2.0 unx     6313 b- defN 23-May-11 12:09 nucliadb/ingest/maindb/tikv.py
--rw-r--r--  2.0 unx     3495 b- defN 23-May-11 12:09 nucliadb/ingest/orm/__init__.py
--rw-r--r--  2.0 unx     6801 b- defN 23-May-11 12:09 nucliadb/ingest/orm/abc.py
--rw-r--r--  2.0 unx    20650 b- defN 23-May-11 12:09 nucliadb/ingest/orm/brain.py
--rw-r--r--  2.0 unx    15408 b- defN 23-May-11 12:09 nucliadb/ingest/orm/entities.py
--rw-r--r--  2.0 unx     1448 b- defN 23-May-11 12:09 nucliadb/ingest/orm/exceptions.py
--rw-r--r--  2.0 unx    12586 b- defN 23-May-11 12:09 nucliadb/ingest/orm/grpc_node_binding.py
--rw-r--r--  2.0 unx     4606 b- defN 23-May-11 12:09 nucliadb/ingest/orm/grpc_node_dummy.py
--rw-r--r--  2.0 unx    21247 b- defN 23-May-11 12:09 nucliadb/ingest/orm/knowledgebox.py
--rw-r--r--  2.0 unx     1730 b- defN 23-May-11 12:09 nucliadb/ingest/orm/labels.py
--rw-r--r--  2.0 unx     4291 b- defN 23-May-11 12:09 nucliadb/ingest/orm/local_node.py
--rw-r--r--  2.0 unx     2890 b- defN 23-May-11 12:09 nucliadb/ingest/orm/local_shard.py
--rw-r--r--  2.0 unx    11388 b- defN 23-May-11 12:09 nucliadb/ingest/orm/node.py
--rw-r--r--  2.0 unx     4312 b- defN 23-May-11 12:09 nucliadb/ingest/orm/nodes_manager.py
--rw-r--r--  2.0 unx    51458 b- defN 23-May-11 12:09 nucliadb/ingest/orm/resource.py
--rw-r--r--  2.0 unx     5115 b- defN 23-May-11 12:09 nucliadb/ingest/orm/shard.py
--rw-r--r--  2.0 unx     1739 b- defN 23-May-11 12:09 nucliadb/ingest/orm/synonyms.py
--rw-r--r--  2.0 unx     3340 b- defN 23-May-11 12:09 nucliadb/ingest/orm/utils.py
--rw-r--r--  2.0 unx    29054 b- defN 23-May-11 12:09 nucliadb/ingest/orm/processor/__init__.py
--rw-r--r--  2.0 unx     1694 b- defN 23-May-11 12:09 nucliadb/ingest/orm/processor/sequence_manager.py
--rw-r--r--  2.0 unx     3113 b- defN 23-May-11 12:09 nucliadb/ingest/service/__init__.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/service/exceptions.py
--rw-r--r--  2.0 unx    34487 b- defN 23-May-11 12:09 nucliadb/ingest/service/writer.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/tests/__init__.py
--rw-r--r--  2.0 unx     1096 b- defN 23-May-11 12:09 nucliadb/ingest/tests/conftest.py
--rw-r--r--  2.0 unx    25857 b- defN 23-May-11 12:09 nucliadb/ingest/tests/fixtures.py
--rw-r--r--  2.0 unx     7549 b- defN 23-May-11 12:09 nucliadb/ingest/tests/tikv.py
--rw-r--r--  2.0 unx    62843 b- defN 23-May-11 12:09 nucliadb/ingest/tests/vectors.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/__init__.py
--rw-r--r--  2.0 unx     1740 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/test_chitchat.py
--rw-r--r--  2.0 unx      833 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/consumer/__init__.py
--rw-r--r--  2.0 unx     5189 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/consumer/test_pull.py
--rw-r--r--  2.0 unx     2751 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/consumer/test_service.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/ingest/__init__.py
--rw-r--r--  2.0 unx    27277 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/ingest/test_ingest.py
--rw-r--r--  2.0 unx     2339 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/ingest/test_processing_engine.py
--rw-r--r--  2.0 unx     8606 b- defN 23-May-11 12:09 nucliadb/ingest/tests/integration/ingest/test_relations.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/__init__.py
--rw-r--r--  2.0 unx     1179 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_cache.py
--rw-r--r--  2.0 unx     4246 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_chitchat.py
--rw-r--r--  2.0 unx     1432 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_partitions.py
--rw-r--r--  2.0 unx     5538 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_processing.py
--rw-r--r--  2.0 unx     3414 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_purge.py
--rw-r--r--  2.0 unx      978 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_settings.py
--rw-r--r--  2.0 unx     1403 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_txn_utils.py
--rw-r--r--  2.0 unx     2895 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/test_utils.py
--rw-r--r--  2.0 unx      833 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/consumer/__init__.py
--rw-r--r--  2.0 unx     2041 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/consumer/test_pull.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/__init__.py
--rw-r--r--  2.0 unx     8991 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/test_brain.py
--rw-r--r--  2.0 unx     2706 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/test_cluster.py
--rw-r--r--  2.0 unx     4212 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/test_node.py
--rw-r--r--  2.0 unx     3141 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/test_processor.py
--rw-r--r--  2.0 unx     3772 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/test_resource.py
--rw-r--r--  2.0 unx     1401 b- defN 23-May-11 12:09 nucliadb/ingest/tests/unit/orm/test_shard.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/models/__init__.py
--rw-r--r--  2.0 unx     1599 b- defN 23-May-11 12:09 nucliadb/models/responses.py
--rw-r--r--  2.0 unx      914 b- defN 23-May-11 12:09 nucliadb/one/__init__.py
--rw-r--r--  2.0 unx     4549 b- defN 23-May-11 12:09 nucliadb/one/app.py
--rw-r--r--  2.0 unx     2359 b- defN 23-May-11 12:09 nucliadb/one/lifecycle.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/one/tests/__init__.py
--rw-r--r--  2.0 unx     1164 b- defN 23-May-11 12:09 nucliadb/one/tests/conftest.py
--rw-r--r--  2.0 unx     3762 b- defN 23-May-11 12:09 nucliadb/one/tests/fixtures.py
--rw-r--r--  2.0 unx     2561 b- defN 23-May-11 12:09 nucliadb/one/tests/test_basic.py
--rw-r--r--  2.0 unx     2492 b- defN 23-May-11 12:09 nucliadb/one/tests/test_delete_field.py
--rw-r--r--  2.0 unx     6087 b- defN 23-May-11 12:09 nucliadb/one/tests/test_fieldmetadata.py
--rw-r--r--  2.0 unx     4594 b- defN 23-May-11 12:09 nucliadb/one/tests/test_services.py
--rw-r--r--  2.0 unx     4067 b- defN 23-May-11 12:09 nucliadb/one/tests/test_upload_download.py
--rw-r--r--  2.0 unx     1328 b- defN 23-May-11 12:09 nucliadb/reader/__init__.py
--rw-r--r--  2.0 unx     3356 b- defN 23-May-11 12:09 nucliadb/reader/app.py
--rw-r--r--  2.0 unx     1366 b- defN 23-May-11 12:09 nucliadb/reader/lifecycle.py
--rw-r--r--  2.0 unx     2186 b- defN 23-May-11 12:09 nucliadb/reader/openapi.py
--rw-r--r--  2.0 unx     1365 b- defN 23-May-11 12:09 nucliadb/reader/run.py
--rw-r--r--  2.0 unx      872 b- defN 23-May-11 12:09 nucliadb/reader/api/__init__.py
--rw-r--r--  2.0 unx     2433 b- defN 23-May-11 12:09 nucliadb/reader/api/models.py
--rw-r--r--  2.0 unx      995 b- defN 23-May-11 12:09 nucliadb/reader/api/v1/__init__.py
--rw-r--r--  2.0 unx     9790 b- defN 23-May-11 12:09 nucliadb/reader/api/v1/download.py
--rw-r--r--  2.0 unx     3570 b- defN 23-May-11 12:09 nucliadb/reader/api/v1/knowledgebox.py
--rw-r--r--  2.0 unx    10721 b- defN 23-May-11 12:09 nucliadb/reader/api/v1/resource.py
--rw-r--r--  2.0 unx     1011 b- defN 23-May-11 12:09 nucliadb/reader/api/v1/router.py
--rw-r--r--  2.0 unx    10766 b- defN 23-May-11 12:09 nucliadb/reader/api/v1/services.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/reader/tests/__init__.py
--rw-r--r--  2.0 unx     1101 b- defN 23-May-11 12:09 nucliadb/reader/tests/conftest.py
--rw-r--r--  2.0 unx     4635 b- defN 23-May-11 12:09 nucliadb/reader/tests/fixtures.py
--rw-r--r--  2.0 unx     2749 b- defN 23-May-11 12:09 nucliadb/reader/tests/test_list_resources.py
--rw-r--r--  2.0 unx     9946 b- defN 23-May-11 12:09 nucliadb/reader/tests/test_reader_file_download.py
--rw-r--r--  2.0 unx    11383 b- defN 23-May-11 12:09 nucliadb/reader/tests/test_reader_resource.py
--rw-r--r--  2.0 unx     6535 b- defN 23-May-11 12:09 nucliadb/reader/tests/test_reader_resource_field.py
--rw-r--r--  2.0 unx     1535 b- defN 23-May-11 12:09 nucliadb/search/__init__.py
--rw-r--r--  2.0 unx     4381 b- defN 23-May-11 12:09 nucliadb/search/app.py
--rw-r--r--  2.0 unx     2310 b- defN 23-May-11 12:09 nucliadb/search/lifecycle.py
--rw-r--r--  2.0 unx     2206 b- defN 23-May-11 12:09 nucliadb/search/openapi.py
--rw-r--r--  2.0 unx    11236 b- defN 23-May-11 12:09 nucliadb/search/predict.py
--rw-r--r--  2.0 unx     1366 b- defN 23-May-11 12:09 nucliadb/search/run.py
--rw-r--r--  2.0 unx     1108 b- defN 23-May-11 12:09 nucliadb/search/settings.py
--rw-r--r--  2.0 unx     1238 b- defN 23-May-11 12:09 nucliadb/search/utilities.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/search/api/__init__.py
--rw-r--r--  2.0 unx     1077 b- defN 23-May-11 12:09 nucliadb/search/api/v1/__init__.py
--rw-r--r--  2.0 unx     6845 b- defN 23-May-11 12:09 nucliadb/search/api/v1/chat.py
--rw-r--r--  2.0 unx     1831 b- defN 23-May-11 12:09 nucliadb/search/api/v1/feedback.py
--rw-r--r--  2.0 unx     9436 b- defN 23-May-11 12:09 nucliadb/search/api/v1/find.py
--rw-r--r--  2.0 unx     6938 b- defN 23-May-11 12:09 nucliadb/search/api/v1/knowledgebox.py
--rw-r--r--  2.0 unx     4781 b- defN 23-May-11 12:09 nucliadb/search/api/v1/resource.py
--rw-r--r--  2.0 unx      980 b- defN 23-May-11 12:09 nucliadb/search/api/v1/router.py
--rw-r--r--  2.0 unx    11487 b- defN 23-May-11 12:09 nucliadb/search/api/v1/search.py
--rw-r--r--  2.0 unx     4212 b- defN 23-May-11 12:09 nucliadb/search/api/v1/suggest.py
--rw-r--r--  2.0 unx      833 b- defN 23-May-11 12:09 nucliadb/search/requesters/__init__.py
--rw-r--r--  2.0 unx     6752 b- defN 23-May-11 12:09 nucliadb/search/requesters/utils.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/search/search/__init__.py
--rw-r--r--  2.0 unx     2408 b- defN 23-May-11 12:09 nucliadb/search/search/cache.py
--rw-r--r--  2.0 unx     5337 b- defN 23-May-11 12:09 nucliadb/search/search/fetch.py
--rw-r--r--  2.0 unx    13815 b- defN 23-May-11 12:09 nucliadb/search/search/find_merge.py
--rw-r--r--  2.0 unx    18899 b- defN 23-May-11 12:09 nucliadb/search/search/merge.py
--rw-r--r--  2.0 unx      947 b- defN 23-May-11 12:09 nucliadb/search/search/metrics.py
--rw-r--r--  2.0 unx    10051 b- defN 23-May-11 12:09 nucliadb/search/search/paragraphs.py
--rw-r--r--  2.0 unx     9905 b- defN 23-May-11 12:09 nucliadb/search/search/query.py
--rw-r--r--  2.0 unx     2647 b- defN 23-May-11 12:09 nucliadb/search/search/shards.py
--rw-r--r--  2.0 unx     2055 b- defN 23-May-11 12:09 nucliadb/search/search/synonyms.py
--rw-r--r--  2.0 unx     2410 b- defN 23-May-11 12:09 nucliadb/search/search/utils.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/search/tests/__init__.py
--rw-r--r--  2.0 unx     1172 b- defN 23-May-11 12:09 nucliadb/search/tests/conftest.py
--rw-r--r--  2.0 unx     7759 b- defN 23-May-11 12:09 nucliadb/search/tests/fixtures.py
--rw-r--r--  2.0 unx    15809 b- defN 23-May-11 12:09 nucliadb/search/tests/node.py
--rw-r--r--  2.0 unx      833 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/__init__.py
--rw-r--r--  2.0 unx     1560 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/test_app.py
--rw-r--r--  2.0 unx     1776 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/test_find_orderer.py
--rw-r--r--  2.0 unx     1329 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/test_openapi.py
--rw-r--r--  2.0 unx     8495 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/test_predict.py
--rw-r--r--  2.0 unx     1258 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/test_run.py
--rw-r--r--  2.0 unx      833 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/search/__init__.py
--rw-r--r--  2.0 unx     3736 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/search/test_fetch.py
--rw-r--r--  2.0 unx     3771 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/search/test_paragraphs.py
--rw-r--r--  2.0 unx     2512 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/search/test_synonyms.py
--rw-r--r--  2.0 unx      833 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/search/requesters/__init__.py
--rw-r--r--  2.0 unx     2528 b- defN 23-May-11 12:09 nucliadb/search/tests/unit/search/requesters/test_utils.py
--rw-r--r--  2.0 unx     2285 b- defN 23-May-11 12:09 nucliadb/static/favicon.ico
--rw-r--r--  2.0 unx     3833 b- defN 23-May-11 12:09 nucliadb/static/index.html
--rw-r--r--  2.0 unx     2639 b- defN 23-May-11 12:09 nucliadb/static/logo.svg
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/tests/__init__.py
--rw-r--r--  2.0 unx     1000 b- defN 23-May-11 12:09 nucliadb/tests/conftest.py
--rw-r--r--  2.0 unx    11567 b- defN 23-May-11 12:09 nucliadb/tests/fixtures.py
--rw-r--r--  2.0 unx     7370 b- defN 23-May-11 12:09 nucliadb/tests/test_advanced_search.py
--rw-r--r--  2.0 unx    14764 b- defN 23-May-11 12:09 nucliadb/tests/test_api.py
--rw-r--r--  2.0 unx     1290 b- defN 23-May-11 12:09 nucliadb/tests/test_chat.py
--rw-r--r--  2.0 unx     3669 b- defN 23-May-11 12:09 nucliadb/tests/test_conversation.py
--rw-r--r--  2.0 unx     2052 b- defN 23-May-11 12:09 nucliadb/tests/test_counters.py
--rw-r--r--  2.0 unx    12302 b- defN 23-May-11 12:09 nucliadb/tests/test_entities.py
--rw-r--r--  2.0 unx    13274 b- defN 23-May-11 12:09 nucliadb/tests/test_entities_deprecated.py
--rw-r--r--  2.0 unx     3654 b- defN 23-May-11 12:09 nucliadb/tests/test_field_external_file.py
--rw-r--r--  2.0 unx     1487 b- defN 23-May-11 12:09 nucliadb/tests/test_field_ids.py
--rw-r--r--  2.0 unx     3591 b- defN 23-May-11 12:09 nucliadb/tests/test_find.py
--rw-r--r--  2.0 unx     4196 b- defN 23-May-11 12:09 nucliadb/tests/test_http_clients.py
--rw-r--r--  2.0 unx     1524 b- defN 23-May-11 12:09 nucliadb/tests/test_kb_slugs.py
--rw-r--r--  2.0 unx    11431 b- defN 23-May-11 12:09 nucliadb/tests/test_labels.py
--rw-r--r--  2.0 unx     6071 b- defN 23-May-11 12:09 nucliadb/tests/test_reindex.py
--rw-r--r--  2.0 unx     8516 b- defN 23-May-11 12:09 nucliadb/tests/test_relations.py
--rw-r--r--  2.0 unx     7072 b- defN 23-May-11 12:09 nucliadb/tests/test_resources.py
--rw-r--r--  2.0 unx    41877 b- defN 23-May-11 12:09 nucliadb/tests/test_search.py
--rw-r--r--  2.0 unx     9708 b- defN 23-May-11 12:09 nucliadb/tests/test_search_sorting.py
--rw-r--r--  2.0 unx     8918 b- defN 23-May-11 12:09 nucliadb/tests/test_suggest.py
--rw-r--r--  2.0 unx     6819 b- defN 23-May-11 12:09 nucliadb/tests/test_synonyms.py
--rw-r--r--  2.0 unx     2637 b- defN 23-May-11 12:09 nucliadb/tests/test_tokens.py
--rw-r--r--  2.0 unx     3159 b- defN 23-May-11 12:09 nucliadb/tests/test_upload.py
--rw-r--r--  2.0 unx     2585 b- defN 23-May-11 12:09 nucliadb/tests/test_usermetadata.py
--rw-r--r--  2.0 unx     8758 b- defN 23-May-11 12:09 nucliadb/tests/test_vectorset.py
--rw-r--r--  2.0 unx      919 b- defN 23-May-11 12:09 nucliadb/tests/knowledgeboxes/__init__.py
--rw-r--r--  2.0 unx     7049 b- defN 23-May-11 12:09 nucliadb/tests/knowledgeboxes/philosophy_books.py
--rw-r--r--  2.0 unx     3131 b- defN 23-May-11 12:09 nucliadb/tests/knowledgeboxes/ten_dummy_resources.py
--rw-r--r--  2.0 unx     2507 b- defN 23-May-11 12:09 nucliadb/tests/utils/__init__.py
--rw-r--r--  2.0 unx     2533 b- defN 23-May-11 12:09 nucliadb/tests/utils/entities.py
--rw-r--r--  2.0 unx     1325 b- defN 23-May-11 12:09 nucliadb/train/__init__.py
--rw-r--r--  2.0 unx     3340 b- defN 23-May-11 12:09 nucliadb/train/app.py
--rw-r--r--  2.0 unx     3832 b- defN 23-May-11 12:09 nucliadb/train/generator.py
--rw-r--r--  2.0 unx     1638 b- defN 23-May-11 12:09 nucliadb/train/lifecycle.py
--rw-r--r--  2.0 unx     1198 b- defN 23-May-11 12:09 nucliadb/train/models.py
--rw-r--r--  2.0 unx     8054 b- defN 23-May-11 12:09 nucliadb/train/nodes.py
--rw-r--r--  2.0 unx     1364 b- defN 23-May-11 12:09 nucliadb/train/run.py
--rw-r--r--  2.0 unx     5755 b- defN 23-May-11 12:09 nucliadb/train/servicer.py
--rw-r--r--  2.0 unx     1415 b- defN 23-May-11 12:09 nucliadb/train/settings.py
--rw-r--r--  2.0 unx     3271 b- defN 23-May-11 12:09 nucliadb/train/upload.py
--rw-r--r--  2.0 unx     6471 b- defN 23-May-11 12:09 nucliadb/train/uploader.py
--rw-r--r--  2.0 unx     3077 b- defN 23-May-11 12:09 nucliadb/train/utils.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/train/api/__init__.py
--rw-r--r--  2.0 unx      958 b- defN 23-May-11 12:09 nucliadb/train/api/models.py
--rw-r--r--  2.0 unx     1479 b- defN 23-May-11 12:09 nucliadb/train/api/utils.py
--rw-r--r--  2.0 unx      928 b- defN 23-May-11 12:09 nucliadb/train/api/v1/__init__.py
--rw-r--r--  2.0 unx     2066 b- defN 23-May-11 12:09 nucliadb/train/api/v1/check.py
--rw-r--r--  2.0 unx      910 b- defN 23-May-11 12:09 nucliadb/train/api/v1/router.py
--rw-r--r--  2.0 unx     1905 b- defN 23-May-11 12:09 nucliadb/train/api/v1/shards.py
--rw-r--r--  2.0 unx     1825 b- defN 23-May-11 12:09 nucliadb/train/api/v1/trainset.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/train/generators/__init__.py
--rw-r--r--  2.0 unx     3289 b- defN 23-May-11 12:09 nucliadb/train/generators/field_classifier.py
--rw-r--r--  2.0 unx     3594 b- defN 23-May-11 12:09 nucliadb/train/generators/paragraph_classifier.py
--rw-r--r--  2.0 unx     4767 b- defN 23-May-11 12:09 nucliadb/train/generators/sentence_classifier.py
--rw-r--r--  2.0 unx    10256 b- defN 23-May-11 12:09 nucliadb/train/generators/token_classifier.py
--rw-r--r--  2.0 unx     2144 b- defN 23-May-11 12:09 nucliadb/train/generators/utils.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/train/tests/__init__.py
--rw-r--r--  2.0 unx     1088 b- defN 23-May-11 12:09 nucliadb/train/tests/conftest.py
--rw-r--r--  2.0 unx     8951 b- defN 23-May-11 12:09 nucliadb/train/tests/fixtures.py
--rw-r--r--  2.0 unx     8132 b- defN 23-May-11 12:09 nucliadb/train/tests/test_field_classification.py
--rw-r--r--  2.0 unx     2729 b- defN 23-May-11 12:09 nucliadb/train/tests/test_get_entities.py
--rw-r--r--  2.0 unx     1660 b- defN 23-May-11 12:09 nucliadb/train/tests/test_get_info.py
--rw-r--r--  2.0 unx     1382 b- defN 23-May-11 12:09 nucliadb/train/tests/test_get_ontology.py
--rw-r--r--  2.0 unx     2201 b- defN 23-May-11 12:09 nucliadb/train/tests/test_get_ontology_count.py
--rw-r--r--  2.0 unx     1416 b- defN 23-May-11 12:09 nucliadb/train/tests/test_list_fields.py
--rw-r--r--  2.0 unx     2944 b- defN 23-May-11 12:09 nucliadb/train/tests/test_list_paragraphs.py
--rw-r--r--  2.0 unx     1423 b- defN 23-May-11 12:09 nucliadb/train/tests/test_list_resources.py
--rw-r--r--  2.0 unx     2863 b- defN 23-May-11 12:09 nucliadb/train/tests/test_list_sentences.py
--rw-r--r--  2.0 unx     8129 b- defN 23-May-11 12:09 nucliadb/train/tests/test_paragraph_classification.py
--rw-r--r--  2.0 unx     8349 b- defN 23-May-11 12:09 nucliadb/train/tests/test_sentence_classification.py
--rw-r--r--  2.0 unx    10122 b- defN 23-May-11 12:09 nucliadb/train/tests/test_token_classification.py
--rw-r--r--  2.0 unx     1328 b- defN 23-May-11 12:09 nucliadb/writer/__init__.py
--rw-r--r--  2.0 unx     3331 b- defN 23-May-11 12:09 nucliadb/writer/app.py
--rw-r--r--  2.0 unx      972 b- defN 23-May-11 12:09 nucliadb/writer/exceptions.py
--rw-r--r--  2.0 unx     2219 b- defN 23-May-11 12:09 nucliadb/writer/lifecycle.py
--rw-r--r--  2.0 unx     2186 b- defN 23-May-11 12:09 nucliadb/writer/openapi.py
--rw-r--r--  2.0 unx     1366 b- defN 23-May-11 12:09 nucliadb/writer/run.py
--rw-r--r--  2.0 unx     1062 b- defN 23-May-11 12:09 nucliadb/writer/settings.py
--rw-r--r--  2.0 unx     1036 b- defN 23-May-11 12:09 nucliadb/writer/utilities.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/writer/api/__init__.py
--rw-r--r--  2.0 unx     1021 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/__init__.py
--rw-r--r--  2.0 unx    22313 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/field.py
--rw-r--r--  2.0 unx     5395 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/knowledgebox.py
--rw-r--r--  2.0 unx    15253 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/resource.py
--rw-r--r--  2.0 unx     1034 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/router.py
--rw-r--r--  2.0 unx    14210 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/services.py
--rw-r--r--  2.0 unx    25744 b- defN 23-May-11 12:09 nucliadb/writer/api/v1/upload.py
--rw-r--r--  2.0 unx     1618 b- defN 23-May-11 12:09 nucliadb/writer/layouts/__init__.py
--rw-r--r--  2.0 unx     2115 b- defN 23-May-11 12:09 nucliadb/writer/layouts/v1.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/writer/resource/__init__.py
--rw-r--r--  2.0 unx     1425 b- defN 23-May-11 12:09 nucliadb/writer/resource/audit.py
--rw-r--r--  2.0 unx     9324 b- defN 23-May-11 12:09 nucliadb/writer/resource/basic.py
--rw-r--r--  2.0 unx    15875 b- defN 23-May-11 12:09 nucliadb/writer/resource/field.py
--rw-r--r--  2.0 unx     1708 b- defN 23-May-11 12:09 nucliadb/writer/resource/origin.py
--rw-r--r--  2.0 unx     1151 b- defN 23-May-11 12:09 nucliadb/writer/resource/slug.py
--rw-r--r--  2.0 unx     4991 b- defN 23-May-11 12:09 nucliadb/writer/resource/vectors.py
--rw-r--r--  2.0 unx      835 b- defN 23-May-11 12:09 nucliadb/writer/tests/__init__.py
--rw-r--r--  2.0 unx     1144 b- defN 23-May-11 12:09 nucliadb/writer/tests/conftest.py
--rw-r--r--  2.0 unx     4204 b- defN 23-May-11 12:09 nucliadb/writer/tests/fixtures.py
--rw-r--r--  2.0 unx    15962 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_fields.py
--rw-r--r--  2.0 unx    22630 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_files.py
--rw-r--r--  2.0 unx     1932 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_knowledgebox.py
--rw-r--r--  2.0 unx     4623 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_reprocess_file_field.py
--rw-r--r--  2.0 unx    19059 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_resources.py
--rw-r--r--  2.0 unx     5345 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_service.py
--rw-r--r--  2.0 unx     3596 b- defN 23-May-11 12:09 nucliadb/writer/tests/test_tus.py
--rw-r--r--  2.0 unx     2028 b- defN 23-May-11 12:09 nucliadb/writer/tests/tus.py
--rw-r--r--  2.0 unx     1287 b- defN 23-May-11 12:09 nucliadb/writer/tests/utils.py
--rw-r--r--  2.0 unx     4772 b- defN 23-May-11 12:09 nucliadb/writer/tus/__init__.py
--rw-r--r--  2.0 unx     4757 b- defN 23-May-11 12:09 nucliadb/writer/tus/dm.py
--rw-r--r--  2.0 unx     2186 b- defN 23-May-11 12:09 nucliadb/writer/tus/exceptions.py
--rw-r--r--  2.0 unx    13818 b- defN 23-May-11 12:09 nucliadb/writer/tus/gcs.py
--rw-r--r--  2.0 unx     5811 b- defN 23-May-11 12:09 nucliadb/writer/tus/local.py
--rw-r--r--  2.0 unx     8571 b- defN 23-May-11 12:09 nucliadb/writer/tus/s3.py
--rw-r--r--  2.0 unx     4682 b- defN 23-May-11 12:09 nucliadb/writer/tus/storage.py
--rw-r--r--  2.0 unx     2580 b- defN 23-May-11 12:09 nucliadb/writer/tus/utils.py
--rw-r--r--  2.0 unx     2913 b- defN 23-May-11 12:11 nucliadb-2.8.5.post257.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-May-11 12:11 nucliadb-2.8.5.post257.dist-info/WHEEL
--rw-r--r--  2.0 unx      790 b- defN 23-May-11 12:11 nucliadb-2.8.5.post257.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        9 b- defN 23-May-11 12:11 nucliadb-2.8.5.post257.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 23-May-11 12:11 nucliadb-2.8.5.post257.dist-info/zip-safe
--rw-rw-r--  2.0 unx    27638 b- defN 23-May-11 12:11 nucliadb-2.8.5.post257.dist-info/RECORD
-304 files, 1615907 bytes uncompressed, 473030 bytes compressed:  70.7%
+Zip file size: 527881 bytes, number of entries: 312
+-rw-r--r--  2.0 unx      891 b- defN 23-May-11 16:46 nucliadb/__init__.py
+-rw-r--r--  2.0 unx     1027 b- defN 23-May-11 16:46 nucliadb/app.py
+-rw-r--r--  2.0 unx     4846 b- defN 23-May-11 16:46 nucliadb/config.py
+-rw-r--r--  2.0 unx     1420 b- defN 23-May-11 16:46 nucliadb/purge.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-11 16:46 nucliadb/py.typed
+-rw-r--r--  2.0 unx     2522 b- defN 23-May-11 16:46 nucliadb/run.py
+-rw-r--r--  2.0 unx     1913 b- defN 23-May-11 16:46 nucliadb/settings.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/http_clients/__init__.py
+-rw-r--r--  2.0 unx     1100 b- defN 23-May-11 16:46 nucliadb/http_clients/exceptions.py
+-rw-r--r--  2.0 unx     4144 b- defN 23-May-11 16:46 nucliadb/http_clients/processing.py
+-rw-r--r--  2.0 unx     1011 b- defN 23-May-11 16:46 nucliadb/ingest/__init__.py
+-rw-r--r--  2.0 unx     6599 b- defN 23-May-11 16:46 nucliadb/ingest/app.py
+-rw-r--r--  2.0 unx      995 b- defN 23-May-11 16:46 nucliadb/ingest/cache.py
+-rw-r--r--  2.0 unx     6563 b- defN 23-May-11 16:46 nucliadb/ingest/chitchat.py
+-rw-r--r--  2.0 unx     2425 b- defN 23-May-11 16:46 nucliadb/ingest/partitions.py
+-rw-r--r--  2.0 unx    15817 b- defN 23-May-11 16:46 nucliadb/ingest/processing.py
+-rw-r--r--  2.0 unx     5308 b- defN 23-May-11 16:46 nucliadb/ingest/purge.py
+-rw-r--r--  2.0 unx    18891 b- defN 23-May-11 16:46 nucliadb/ingest/serialize.py
+-rw-r--r--  2.0 unx     3025 b- defN 23-May-11 16:46 nucliadb/ingest/settings.py
+-rw-r--r--  2.0 unx     2531 b- defN 23-May-11 16:46 nucliadb/ingest/txn_utils.py
+-rw-r--r--  2.0 unx     4917 b- defN 23-May-11 16:46 nucliadb/ingest/utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/__init__.py
+-rw-r--r--  2.0 unx    11281 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/auditing.py
+-rw-r--r--  2.0 unx    10516 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/consumer.py
+-rw-r--r--  2.0 unx     6886 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/pull.py
+-rw-r--r--  2.0 unx     6069 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/service.py
+-rw-r--r--  2.0 unx     3781 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/shard_creator.py
+-rw-r--r--  2.0 unx     2656 b- defN 23-May-11 16:46 nucliadb/ingest/consumer/utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/fields/__init__.py
+-rw-r--r--  2.0 unx    19273 b- defN 23-May-11 16:46 nucliadb/ingest/fields/base.py
+-rw-r--r--  2.0 unx     6495 b- defN 23-May-11 16:46 nucliadb/ingest/fields/conversation.py
+-rw-r--r--  2.0 unx     1223 b- defN 23-May-11 16:46 nucliadb/ingest/fields/date.py
+-rw-r--r--  2.0 unx     1205 b- defN 23-May-11 16:46 nucliadb/ingest/fields/exceptions.py
+-rw-r--r--  2.0 unx     5159 b- defN 23-May-11 16:46 nucliadb/ingest/fields/file.py
+-rw-r--r--  2.0 unx     1523 b- defN 23-May-11 16:46 nucliadb/ingest/fields/generic.py
+-rw-r--r--  2.0 unx     1235 b- defN 23-May-11 16:46 nucliadb/ingest/fields/keywordset.py
+-rw-r--r--  2.0 unx     2250 b- defN 23-May-11 16:46 nucliadb/ingest/fields/layout.py
+-rw-r--r--  2.0 unx     4084 b- defN 23-May-11 16:46 nucliadb/ingest/fields/link.py
+-rw-r--r--  2.0 unx     1319 b- defN 23-May-11 16:46 nucliadb/ingest/fields/text.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/__init__.py
+-rw-r--r--  2.0 unx     2631 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/driver.py
+-rw-r--r--  2.0 unx      980 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/keys.py
+-rw-r--r--  2.0 unx     7076 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/local.py
+-rw-r--r--  2.0 unx     5400 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/pg.py
+-rw-r--r--  2.0 unx     6146 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/redis.py
+-rw-r--r--  2.0 unx     6313 b- defN 23-May-11 16:46 nucliadb/ingest/maindb/tikv.py
+-rw-r--r--  2.0 unx     3483 b- defN 23-May-11 16:46 nucliadb/ingest/orm/__init__.py
+-rw-r--r--  2.0 unx     6783 b- defN 23-May-11 16:46 nucliadb/ingest/orm/abc.py
+-rw-r--r--  2.0 unx    20650 b- defN 23-May-11 16:46 nucliadb/ingest/orm/brain.py
+-rw-r--r--  2.0 unx    15267 b- defN 23-May-11 16:46 nucliadb/ingest/orm/entities.py
+-rw-r--r--  2.0 unx     1448 b- defN 23-May-11 16:46 nucliadb/ingest/orm/exceptions.py
+-rw-r--r--  2.0 unx    12586 b- defN 23-May-11 16:46 nucliadb/ingest/orm/grpc_node_binding.py
+-rw-r--r--  2.0 unx     4606 b- defN 23-May-11 16:46 nucliadb/ingest/orm/grpc_node_dummy.py
+-rw-r--r--  2.0 unx    21132 b- defN 23-May-11 16:46 nucliadb/ingest/orm/knowledgebox.py
+-rw-r--r--  2.0 unx     1730 b- defN 23-May-11 16:46 nucliadb/ingest/orm/labels.py
+-rw-r--r--  2.0 unx     5160 b- defN 23-May-11 16:46 nucliadb/ingest/orm/local_node.py
+-rw-r--r--  2.0 unx     2614 b- defN 23-May-11 16:46 nucliadb/ingest/orm/local_shard.py
+-rw-r--r--  2.0 unx    11289 b- defN 23-May-11 16:46 nucliadb/ingest/orm/node.py
+-rw-r--r--  2.0 unx     4278 b- defN 23-May-11 16:46 nucliadb/ingest/orm/nodes_manager.py
+-rw-r--r--  2.0 unx    51458 b- defN 23-May-11 16:46 nucliadb/ingest/orm/resource.py
+-rw-r--r--  2.0 unx     4227 b- defN 23-May-11 16:46 nucliadb/ingest/orm/shard.py
+-rw-r--r--  2.0 unx     1739 b- defN 23-May-11 16:46 nucliadb/ingest/orm/synonyms.py
+-rw-r--r--  2.0 unx     3340 b- defN 23-May-11 16:46 nucliadb/ingest/orm/utils.py
+-rw-r--r--  2.0 unx    20958 b- defN 23-May-11 16:46 nucliadb/ingest/orm/processor/__init__.py
+-rw-r--r--  2.0 unx     1694 b- defN 23-May-11 16:46 nucliadb/ingest/orm/processor/sequence_manager.py
+-rw-r--r--  2.0 unx     3113 b- defN 23-May-11 16:46 nucliadb/ingest/service/__init__.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/service/exceptions.py
+-rw-r--r--  2.0 unx    34177 b- defN 23-May-11 16:46 nucliadb/ingest/service/writer.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/tests/__init__.py
+-rw-r--r--  2.0 unx     1096 b- defN 23-May-11 16:46 nucliadb/ingest/tests/conftest.py
+-rw-r--r--  2.0 unx    25872 b- defN 23-May-11 16:46 nucliadb/ingest/tests/fixtures.py
+-rw-r--r--  2.0 unx     7549 b- defN 23-May-11 16:46 nucliadb/ingest/tests/tikv.py
+-rw-r--r--  2.0 unx    62843 b- defN 23-May-11 16:46 nucliadb/ingest/tests/vectors.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/__init__.py
+-rw-r--r--  2.0 unx     1740 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/test_chitchat.py
+-rw-r--r--  2.0 unx      833 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/consumer/__init__.py
+-rw-r--r--  2.0 unx     2549 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/consumer/test_auditing.py
+-rw-r--r--  2.0 unx     5169 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/consumer/test_pull.py
+-rw-r--r--  2.0 unx     2751 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/consumer/test_service.py
+-rw-r--r--  2.0 unx     2013 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/consumer/test_shard_creator.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/ingest/__init__.py
+-rw-r--r--  2.0 unx    25612 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/ingest/test_ingest.py
+-rw-r--r--  2.0 unx     2339 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/ingest/test_processing_engine.py
+-rw-r--r--  2.0 unx     8606 b- defN 23-May-11 16:46 nucliadb/ingest/tests/integration/ingest/test_relations.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/__init__.py
+-rw-r--r--  2.0 unx     1179 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_cache.py
+-rw-r--r--  2.0 unx     4246 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_chitchat.py
+-rw-r--r--  2.0 unx     1432 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_partitions.py
+-rw-r--r--  2.0 unx     5538 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_processing.py
+-rw-r--r--  2.0 unx     3414 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_purge.py
+-rw-r--r--  2.0 unx      978 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_settings.py
+-rw-r--r--  2.0 unx     1403 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_txn_utils.py
+-rw-r--r--  2.0 unx     2895 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/test_utils.py
+-rw-r--r--  2.0 unx      833 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/consumer/__init__.py
+-rw-r--r--  2.0 unx     2979 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/consumer/test_auditing.py
+-rw-r--r--  2.0 unx     2041 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/consumer/test_pull.py
+-rw-r--r--  2.0 unx     3868 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/consumer/test_shard_creator.py
+-rw-r--r--  2.0 unx     1934 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/consumer/test_utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/__init__.py
+-rw-r--r--  2.0 unx     8991 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/test_brain.py
+-rw-r--r--  2.0 unx     2736 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/test_cluster.py
+-rw-r--r--  2.0 unx     4020 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/test_node.py
+-rw-r--r--  2.0 unx     3141 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/test_processor.py
+-rw-r--r--  2.0 unx     3772 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/test_resource.py
+-rw-r--r--  2.0 unx     1401 b- defN 23-May-11 16:46 nucliadb/ingest/tests/unit/orm/test_shard.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/models/__init__.py
+-rw-r--r--  2.0 unx     1599 b- defN 23-May-11 16:46 nucliadb/models/responses.py
+-rw-r--r--  2.0 unx      914 b- defN 23-May-11 16:46 nucliadb/one/__init__.py
+-rw-r--r--  2.0 unx     4549 b- defN 23-May-11 16:46 nucliadb/one/app.py
+-rw-r--r--  2.0 unx     2359 b- defN 23-May-11 16:46 nucliadb/one/lifecycle.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/one/tests/__init__.py
+-rw-r--r--  2.0 unx     1164 b- defN 23-May-11 16:46 nucliadb/one/tests/conftest.py
+-rw-r--r--  2.0 unx     3762 b- defN 23-May-11 16:46 nucliadb/one/tests/fixtures.py
+-rw-r--r--  2.0 unx     2561 b- defN 23-May-11 16:46 nucliadb/one/tests/test_basic.py
+-rw-r--r--  2.0 unx     2492 b- defN 23-May-11 16:46 nucliadb/one/tests/test_delete_field.py
+-rw-r--r--  2.0 unx     6087 b- defN 23-May-11 16:46 nucliadb/one/tests/test_fieldmetadata.py
+-rw-r--r--  2.0 unx     4594 b- defN 23-May-11 16:46 nucliadb/one/tests/test_services.py
+-rw-r--r--  2.0 unx     4067 b- defN 23-May-11 16:46 nucliadb/one/tests/test_upload_download.py
+-rw-r--r--  2.0 unx     1328 b- defN 23-May-11 16:46 nucliadb/reader/__init__.py
+-rw-r--r--  2.0 unx     3356 b- defN 23-May-11 16:46 nucliadb/reader/app.py
+-rw-r--r--  2.0 unx     1366 b- defN 23-May-11 16:46 nucliadb/reader/lifecycle.py
+-rw-r--r--  2.0 unx     2186 b- defN 23-May-11 16:46 nucliadb/reader/openapi.py
+-rw-r--r--  2.0 unx     1365 b- defN 23-May-11 16:46 nucliadb/reader/run.py
+-rw-r--r--  2.0 unx      872 b- defN 23-May-11 16:46 nucliadb/reader/api/__init__.py
+-rw-r--r--  2.0 unx     2433 b- defN 23-May-11 16:46 nucliadb/reader/api/models.py
+-rw-r--r--  2.0 unx      995 b- defN 23-May-11 16:46 nucliadb/reader/api/v1/__init__.py
+-rw-r--r--  2.0 unx     9790 b- defN 23-May-11 16:46 nucliadb/reader/api/v1/download.py
+-rw-r--r--  2.0 unx     3570 b- defN 23-May-11 16:46 nucliadb/reader/api/v1/knowledgebox.py
+-rw-r--r--  2.0 unx    10673 b- defN 23-May-11 16:46 nucliadb/reader/api/v1/resource.py
+-rw-r--r--  2.0 unx     1011 b- defN 23-May-11 16:46 nucliadb/reader/api/v1/router.py
+-rw-r--r--  2.0 unx    10766 b- defN 23-May-11 16:46 nucliadb/reader/api/v1/services.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/reader/tests/__init__.py
+-rw-r--r--  2.0 unx     1101 b- defN 23-May-11 16:46 nucliadb/reader/tests/conftest.py
+-rw-r--r--  2.0 unx     4635 b- defN 23-May-11 16:46 nucliadb/reader/tests/fixtures.py
+-rw-r--r--  2.0 unx     2749 b- defN 23-May-11 16:46 nucliadb/reader/tests/test_list_resources.py
+-rw-r--r--  2.0 unx     9946 b- defN 23-May-11 16:46 nucliadb/reader/tests/test_reader_file_download.py
+-rw-r--r--  2.0 unx    11383 b- defN 23-May-11 16:46 nucliadb/reader/tests/test_reader_resource.py
+-rw-r--r--  2.0 unx     6535 b- defN 23-May-11 16:46 nucliadb/reader/tests/test_reader_resource_field.py
+-rw-r--r--  2.0 unx     1535 b- defN 23-May-11 16:46 nucliadb/search/__init__.py
+-rw-r--r--  2.0 unx     4381 b- defN 23-May-11 16:46 nucliadb/search/app.py
+-rw-r--r--  2.0 unx     2252 b- defN 23-May-11 16:46 nucliadb/search/lifecycle.py
+-rw-r--r--  2.0 unx     2206 b- defN 23-May-11 16:46 nucliadb/search/openapi.py
+-rw-r--r--  2.0 unx    11236 b- defN 23-May-11 16:46 nucliadb/search/predict.py
+-rw-r--r--  2.0 unx     1366 b- defN 23-May-11 16:46 nucliadb/search/run.py
+-rw-r--r--  2.0 unx     1108 b- defN 23-May-11 16:46 nucliadb/search/settings.py
+-rw-r--r--  2.0 unx     1238 b- defN 23-May-11 16:46 nucliadb/search/utilities.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/search/api/__init__.py
+-rw-r--r--  2.0 unx     1077 b- defN 23-May-11 16:46 nucliadb/search/api/v1/__init__.py
+-rw-r--r--  2.0 unx     6845 b- defN 23-May-11 16:46 nucliadb/search/api/v1/chat.py
+-rw-r--r--  2.0 unx     1831 b- defN 23-May-11 16:46 nucliadb/search/api/v1/feedback.py
+-rw-r--r--  2.0 unx     9436 b- defN 23-May-11 16:46 nucliadb/search/api/v1/find.py
+-rw-r--r--  2.0 unx     6938 b- defN 23-May-11 16:46 nucliadb/search/api/v1/knowledgebox.py
+-rw-r--r--  2.0 unx     4781 b- defN 23-May-11 16:46 nucliadb/search/api/v1/resource.py
+-rw-r--r--  2.0 unx      980 b- defN 23-May-11 16:46 nucliadb/search/api/v1/router.py
+-rw-r--r--  2.0 unx    11487 b- defN 23-May-11 16:46 nucliadb/search/api/v1/search.py
+-rw-r--r--  2.0 unx     4212 b- defN 23-May-11 16:46 nucliadb/search/api/v1/suggest.py
+-rw-r--r--  2.0 unx      833 b- defN 23-May-11 16:46 nucliadb/search/requesters/__init__.py
+-rw-r--r--  2.0 unx     6752 b- defN 23-May-11 16:46 nucliadb/search/requesters/utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/search/search/__init__.py
+-rw-r--r--  2.0 unx     2352 b- defN 23-May-11 16:46 nucliadb/search/search/cache.py
+-rw-r--r--  2.0 unx     5337 b- defN 23-May-11 16:46 nucliadb/search/search/fetch.py
+-rw-r--r--  2.0 unx    13815 b- defN 23-May-11 16:46 nucliadb/search/search/find_merge.py
+-rw-r--r--  2.0 unx    18899 b- defN 23-May-11 16:46 nucliadb/search/search/merge.py
+-rw-r--r--  2.0 unx      947 b- defN 23-May-11 16:46 nucliadb/search/search/metrics.py
+-rw-r--r--  2.0 unx    10051 b- defN 23-May-11 16:46 nucliadb/search/search/paragraphs.py
+-rw-r--r--  2.0 unx     9905 b- defN 23-May-11 16:46 nucliadb/search/search/query.py
+-rw-r--r--  2.0 unx     2647 b- defN 23-May-11 16:46 nucliadb/search/search/shards.py
+-rw-r--r--  2.0 unx     2055 b- defN 23-May-11 16:46 nucliadb/search/search/synonyms.py
+-rw-r--r--  2.0 unx     2410 b- defN 23-May-11 16:46 nucliadb/search/search/utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/search/tests/__init__.py
+-rw-r--r--  2.0 unx     1172 b- defN 23-May-11 16:46 nucliadb/search/tests/conftest.py
+-rw-r--r--  2.0 unx     7759 b- defN 23-May-11 16:46 nucliadb/search/tests/fixtures.py
+-rw-r--r--  2.0 unx    15809 b- defN 23-May-11 16:46 nucliadb/search/tests/node.py
+-rw-r--r--  2.0 unx      833 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/__init__.py
+-rw-r--r--  2.0 unx     1560 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/test_app.py
+-rw-r--r--  2.0 unx     1776 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/test_find_orderer.py
+-rw-r--r--  2.0 unx     1329 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/test_openapi.py
+-rw-r--r--  2.0 unx     8495 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/test_predict.py
+-rw-r--r--  2.0 unx     1258 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/test_run.py
+-rw-r--r--  2.0 unx      833 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/search/__init__.py
+-rw-r--r--  2.0 unx     3736 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/search/test_fetch.py
+-rw-r--r--  2.0 unx     3771 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/search/test_paragraphs.py
+-rw-r--r--  2.0 unx     2512 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/search/test_synonyms.py
+-rw-r--r--  2.0 unx      833 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/search/requesters/__init__.py
+-rw-r--r--  2.0 unx     2528 b- defN 23-May-11 16:46 nucliadb/search/tests/unit/search/requesters/test_utils.py
+-rw-r--r--  2.0 unx     2285 b- defN 23-May-11 16:46 nucliadb/static/favicon.ico
+-rw-r--r--  2.0 unx     3833 b- defN 23-May-11 16:46 nucliadb/static/index.html
+-rw-r--r--  2.0 unx     2639 b- defN 23-May-11 16:46 nucliadb/static/logo.svg
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/tests/__init__.py
+-rw-r--r--  2.0 unx     1000 b- defN 23-May-11 16:46 nucliadb/tests/conftest.py
+-rw-r--r--  2.0 unx    11567 b- defN 23-May-11 16:46 nucliadb/tests/fixtures.py
+-rw-r--r--  2.0 unx     7370 b- defN 23-May-11 16:46 nucliadb/tests/test_advanced_search.py
+-rw-r--r--  2.0 unx    14764 b- defN 23-May-11 16:46 nucliadb/tests/test_api.py
+-rw-r--r--  2.0 unx     1290 b- defN 23-May-11 16:46 nucliadb/tests/test_chat.py
+-rw-r--r--  2.0 unx     3669 b- defN 23-May-11 16:46 nucliadb/tests/test_conversation.py
+-rw-r--r--  2.0 unx     2052 b- defN 23-May-11 16:46 nucliadb/tests/test_counters.py
+-rw-r--r--  2.0 unx    12302 b- defN 23-May-11 16:46 nucliadb/tests/test_entities.py
+-rw-r--r--  2.0 unx    13274 b- defN 23-May-11 16:46 nucliadb/tests/test_entities_deprecated.py
+-rw-r--r--  2.0 unx     3654 b- defN 23-May-11 16:46 nucliadb/tests/test_field_external_file.py
+-rw-r--r--  2.0 unx     1487 b- defN 23-May-11 16:46 nucliadb/tests/test_field_ids.py
+-rw-r--r--  2.0 unx     3591 b- defN 23-May-11 16:46 nucliadb/tests/test_find.py
+-rw-r--r--  2.0 unx     4196 b- defN 23-May-11 16:46 nucliadb/tests/test_http_clients.py
+-rw-r--r--  2.0 unx     1524 b- defN 23-May-11 16:46 nucliadb/tests/test_kb_slugs.py
+-rw-r--r--  2.0 unx    11431 b- defN 23-May-11 16:46 nucliadb/tests/test_labels.py
+-rw-r--r--  2.0 unx     6071 b- defN 23-May-11 16:46 nucliadb/tests/test_reindex.py
+-rw-r--r--  2.0 unx     8516 b- defN 23-May-11 16:46 nucliadb/tests/test_relations.py
+-rw-r--r--  2.0 unx     7072 b- defN 23-May-11 16:46 nucliadb/tests/test_resources.py
+-rw-r--r--  2.0 unx    42333 b- defN 23-May-11 16:46 nucliadb/tests/test_search.py
+-rw-r--r--  2.0 unx     9708 b- defN 23-May-11 16:46 nucliadb/tests/test_search_sorting.py
+-rw-r--r--  2.0 unx     8918 b- defN 23-May-11 16:46 nucliadb/tests/test_suggest.py
+-rw-r--r--  2.0 unx     6819 b- defN 23-May-11 16:46 nucliadb/tests/test_synonyms.py
+-rw-r--r--  2.0 unx     2637 b- defN 23-May-11 16:46 nucliadb/tests/test_tokens.py
+-rw-r--r--  2.0 unx     3159 b- defN 23-May-11 16:46 nucliadb/tests/test_upload.py
+-rw-r--r--  2.0 unx     2585 b- defN 23-May-11 16:46 nucliadb/tests/test_usermetadata.py
+-rw-r--r--  2.0 unx     8758 b- defN 23-May-11 16:46 nucliadb/tests/test_vectorset.py
+-rw-r--r--  2.0 unx      919 b- defN 23-May-11 16:46 nucliadb/tests/knowledgeboxes/__init__.py
+-rw-r--r--  2.0 unx     7049 b- defN 23-May-11 16:46 nucliadb/tests/knowledgeboxes/philosophy_books.py
+-rw-r--r--  2.0 unx     3131 b- defN 23-May-11 16:46 nucliadb/tests/knowledgeboxes/ten_dummy_resources.py
+-rw-r--r--  2.0 unx     2507 b- defN 23-May-11 16:46 nucliadb/tests/utils/__init__.py
+-rw-r--r--  2.0 unx     2533 b- defN 23-May-11 16:46 nucliadb/tests/utils/entities.py
+-rw-r--r--  2.0 unx     1325 b- defN 23-May-11 16:46 nucliadb/train/__init__.py
+-rw-r--r--  2.0 unx     3340 b- defN 23-May-11 16:46 nucliadb/train/app.py
+-rw-r--r--  2.0 unx     3832 b- defN 23-May-11 16:46 nucliadb/train/generator.py
+-rw-r--r--  2.0 unx     1638 b- defN 23-May-11 16:46 nucliadb/train/lifecycle.py
+-rw-r--r--  2.0 unx     1198 b- defN 23-May-11 16:46 nucliadb/train/models.py
+-rw-r--r--  2.0 unx     7906 b- defN 23-May-11 16:46 nucliadb/train/nodes.py
+-rw-r--r--  2.0 unx     1364 b- defN 23-May-11 16:46 nucliadb/train/run.py
+-rw-r--r--  2.0 unx     5755 b- defN 23-May-11 16:46 nucliadb/train/servicer.py
+-rw-r--r--  2.0 unx     1415 b- defN 23-May-11 16:46 nucliadb/train/settings.py
+-rw-r--r--  2.0 unx     3271 b- defN 23-May-11 16:46 nucliadb/train/upload.py
+-rw-r--r--  2.0 unx     6419 b- defN 23-May-11 16:46 nucliadb/train/uploader.py
+-rw-r--r--  2.0 unx     3005 b- defN 23-May-11 16:46 nucliadb/train/utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/train/api/__init__.py
+-rw-r--r--  2.0 unx      958 b- defN 23-May-11 16:46 nucliadb/train/api/models.py
+-rw-r--r--  2.0 unx     1479 b- defN 23-May-11 16:46 nucliadb/train/api/utils.py
+-rw-r--r--  2.0 unx      928 b- defN 23-May-11 16:46 nucliadb/train/api/v1/__init__.py
+-rw-r--r--  2.0 unx     2066 b- defN 23-May-11 16:46 nucliadb/train/api/v1/check.py
+-rw-r--r--  2.0 unx      910 b- defN 23-May-11 16:46 nucliadb/train/api/v1/router.py
+-rw-r--r--  2.0 unx     1905 b- defN 23-May-11 16:46 nucliadb/train/api/v1/shards.py
+-rw-r--r--  2.0 unx     1825 b- defN 23-May-11 16:46 nucliadb/train/api/v1/trainset.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/train/generators/__init__.py
+-rw-r--r--  2.0 unx     3289 b- defN 23-May-11 16:46 nucliadb/train/generators/field_classifier.py
+-rw-r--r--  2.0 unx     3594 b- defN 23-May-11 16:46 nucliadb/train/generators/paragraph_classifier.py
+-rw-r--r--  2.0 unx     4767 b- defN 23-May-11 16:46 nucliadb/train/generators/sentence_classifier.py
+-rw-r--r--  2.0 unx    10256 b- defN 23-May-11 16:46 nucliadb/train/generators/token_classifier.py
+-rw-r--r--  2.0 unx     2092 b- defN 23-May-11 16:46 nucliadb/train/generators/utils.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/train/tests/__init__.py
+-rw-r--r--  2.0 unx     1088 b- defN 23-May-11 16:46 nucliadb/train/tests/conftest.py
+-rw-r--r--  2.0 unx     8939 b- defN 23-May-11 16:46 nucliadb/train/tests/fixtures.py
+-rw-r--r--  2.0 unx     8132 b- defN 23-May-11 16:46 nucliadb/train/tests/test_field_classification.py
+-rw-r--r--  2.0 unx     2729 b- defN 23-May-11 16:46 nucliadb/train/tests/test_get_entities.py
+-rw-r--r--  2.0 unx     1660 b- defN 23-May-11 16:46 nucliadb/train/tests/test_get_info.py
+-rw-r--r--  2.0 unx     1382 b- defN 23-May-11 16:46 nucliadb/train/tests/test_get_ontology.py
+-rw-r--r--  2.0 unx     2201 b- defN 23-May-11 16:46 nucliadb/train/tests/test_get_ontology_count.py
+-rw-r--r--  2.0 unx     1416 b- defN 23-May-11 16:46 nucliadb/train/tests/test_list_fields.py
+-rw-r--r--  2.0 unx     2944 b- defN 23-May-11 16:46 nucliadb/train/tests/test_list_paragraphs.py
+-rw-r--r--  2.0 unx     1423 b- defN 23-May-11 16:46 nucliadb/train/tests/test_list_resources.py
+-rw-r--r--  2.0 unx     2863 b- defN 23-May-11 16:46 nucliadb/train/tests/test_list_sentences.py
+-rw-r--r--  2.0 unx     8129 b- defN 23-May-11 16:46 nucliadb/train/tests/test_paragraph_classification.py
+-rw-r--r--  2.0 unx     8349 b- defN 23-May-11 16:46 nucliadb/train/tests/test_sentence_classification.py
+-rw-r--r--  2.0 unx    10122 b- defN 23-May-11 16:46 nucliadb/train/tests/test_token_classification.py
+-rw-r--r--  2.0 unx     1328 b- defN 23-May-11 16:46 nucliadb/writer/__init__.py
+-rw-r--r--  2.0 unx     3331 b- defN 23-May-11 16:46 nucliadb/writer/app.py
+-rw-r--r--  2.0 unx      972 b- defN 23-May-11 16:46 nucliadb/writer/exceptions.py
+-rw-r--r--  2.0 unx     2219 b- defN 23-May-11 16:46 nucliadb/writer/lifecycle.py
+-rw-r--r--  2.0 unx     2186 b- defN 23-May-11 16:46 nucliadb/writer/openapi.py
+-rw-r--r--  2.0 unx     1366 b- defN 23-May-11 16:46 nucliadb/writer/run.py
+-rw-r--r--  2.0 unx     1062 b- defN 23-May-11 16:46 nucliadb/writer/settings.py
+-rw-r--r--  2.0 unx     1036 b- defN 23-May-11 16:46 nucliadb/writer/utilities.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/writer/api/__init__.py
+-rw-r--r--  2.0 unx     1021 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/__init__.py
+-rw-r--r--  2.0 unx    22261 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/field.py
+-rw-r--r--  2.0 unx     5395 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/knowledgebox.py
+-rw-r--r--  2.0 unx    15201 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/resource.py
+-rw-r--r--  2.0 unx     1034 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/router.py
+-rw-r--r--  2.0 unx    14210 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/services.py
+-rw-r--r--  2.0 unx    25744 b- defN 23-May-11 16:46 nucliadb/writer/api/v1/upload.py
+-rw-r--r--  2.0 unx     1618 b- defN 23-May-11 16:46 nucliadb/writer/layouts/__init__.py
+-rw-r--r--  2.0 unx     2115 b- defN 23-May-11 16:46 nucliadb/writer/layouts/v1.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/writer/resource/__init__.py
+-rw-r--r--  2.0 unx     1425 b- defN 23-May-11 16:46 nucliadb/writer/resource/audit.py
+-rw-r--r--  2.0 unx     9324 b- defN 23-May-11 16:46 nucliadb/writer/resource/basic.py
+-rw-r--r--  2.0 unx    15875 b- defN 23-May-11 16:46 nucliadb/writer/resource/field.py
+-rw-r--r--  2.0 unx     1708 b- defN 23-May-11 16:46 nucliadb/writer/resource/origin.py
+-rw-r--r--  2.0 unx     1151 b- defN 23-May-11 16:46 nucliadb/writer/resource/slug.py
+-rw-r--r--  2.0 unx     4991 b- defN 23-May-11 16:46 nucliadb/writer/resource/vectors.py
+-rw-r--r--  2.0 unx      835 b- defN 23-May-11 16:46 nucliadb/writer/tests/__init__.py
+-rw-r--r--  2.0 unx     1144 b- defN 23-May-11 16:46 nucliadb/writer/tests/conftest.py
+-rw-r--r--  2.0 unx     4204 b- defN 23-May-11 16:46 nucliadb/writer/tests/fixtures.py
+-rw-r--r--  2.0 unx    15962 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_fields.py
+-rw-r--r--  2.0 unx    22630 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_files.py
+-rw-r--r--  2.0 unx     1932 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_knowledgebox.py
+-rw-r--r--  2.0 unx     4623 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_reprocess_file_field.py
+-rw-r--r--  2.0 unx    19059 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_resources.py
+-rw-r--r--  2.0 unx     5345 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_service.py
+-rw-r--r--  2.0 unx     3596 b- defN 23-May-11 16:46 nucliadb/writer/tests/test_tus.py
+-rw-r--r--  2.0 unx     2028 b- defN 23-May-11 16:46 nucliadb/writer/tests/tus.py
+-rw-r--r--  2.0 unx     1287 b- defN 23-May-11 16:46 nucliadb/writer/tests/utils.py
+-rw-r--r--  2.0 unx     4772 b- defN 23-May-11 16:46 nucliadb/writer/tus/__init__.py
+-rw-r--r--  2.0 unx     4757 b- defN 23-May-11 16:46 nucliadb/writer/tus/dm.py
+-rw-r--r--  2.0 unx     2186 b- defN 23-May-11 16:46 nucliadb/writer/tus/exceptions.py
+-rw-r--r--  2.0 unx    13818 b- defN 23-May-11 16:46 nucliadb/writer/tus/gcs.py
+-rw-r--r--  2.0 unx     5811 b- defN 23-May-11 16:46 nucliadb/writer/tus/local.py
+-rw-r--r--  2.0 unx     8571 b- defN 23-May-11 16:46 nucliadb/writer/tus/s3.py
+-rw-r--r--  2.0 unx     4682 b- defN 23-May-11 16:46 nucliadb/writer/tus/storage.py
+-rw-r--r--  2.0 unx     2580 b- defN 23-May-11 16:46 nucliadb/writer/tus/utils.py
+-rw-r--r--  2.0 unx     2913 b- defN 23-May-11 16:48 nucliadb-2.9.0.post258.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-11 16:48 nucliadb-2.9.0.post258.dist-info/WHEEL
+-rw-r--r--  2.0 unx      870 b- defN 23-May-11 16:48 nucliadb-2.9.0.post258.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        9 b- defN 23-May-11 16:48 nucliadb-2.9.0.post258.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 23-May-11 16:48 nucliadb-2.9.0.post258.dist-info/zip-safe
+-rw-rw-r--  2.0 unx    28486 b- defN 23-May-11 16:48 nucliadb-2.9.0.post258.dist-info/RECORD
+312 files, 1637968 bytes uncompressed, 482609 bytes compressed:  70.5%
```

## zipnote {}

```diff
@@ -60,23 +60,32 @@
 
 Filename: nucliadb/ingest/utils.py
 Comment: 
 
 Filename: nucliadb/ingest/consumer/__init__.py
 Comment: 
 
+Filename: nucliadb/ingest/consumer/auditing.py
+Comment: 
+
 Filename: nucliadb/ingest/consumer/consumer.py
 Comment: 
 
 Filename: nucliadb/ingest/consumer/pull.py
 Comment: 
 
 Filename: nucliadb/ingest/consumer/service.py
 Comment: 
 
+Filename: nucliadb/ingest/consumer/shard_creator.py
+Comment: 
+
+Filename: nucliadb/ingest/consumer/utils.py
+Comment: 
+
 Filename: nucliadb/ingest/fields/__init__.py
 Comment: 
 
 Filename: nucliadb/ingest/fields/base.py
 Comment: 
 
 Filename: nucliadb/ingest/fields/conversation.py
@@ -213,20 +222,26 @@
 
 Filename: nucliadb/ingest/tests/integration/test_chitchat.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/integration/consumer/__init__.py
 Comment: 
 
+Filename: nucliadb/ingest/tests/integration/consumer/test_auditing.py
+Comment: 
+
 Filename: nucliadb/ingest/tests/integration/consumer/test_pull.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/integration/consumer/test_service.py
 Comment: 
 
+Filename: nucliadb/ingest/tests/integration/consumer/test_shard_creator.py
+Comment: 
+
 Filename: nucliadb/ingest/tests/integration/ingest/__init__.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/integration/ingest/test_ingest.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/integration/ingest/test_processing_engine.py
@@ -261,17 +276,26 @@
 
 Filename: nucliadb/ingest/tests/unit/test_utils.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/unit/consumer/__init__.py
 Comment: 
 
+Filename: nucliadb/ingest/tests/unit/consumer/test_auditing.py
+Comment: 
+
 Filename: nucliadb/ingest/tests/unit/consumer/test_pull.py
 Comment: 
 
+Filename: nucliadb/ingest/tests/unit/consumer/test_shard_creator.py
+Comment: 
+
+Filename: nucliadb/ingest/tests/unit/consumer/test_utils.py
+Comment: 
+
 Filename: nucliadb/ingest/tests/unit/orm/__init__.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/unit/orm/test_brain.py
 Comment: 
 
 Filename: nucliadb/ingest/tests/unit/orm/test_cluster.py
@@ -888,26 +912,26 @@
 
 Filename: nucliadb/writer/tus/storage.py
 Comment: 
 
 Filename: nucliadb/writer/tus/utils.py
 Comment: 
 
-Filename: nucliadb-2.8.5.post257.dist-info/METADATA
+Filename: nucliadb-2.9.0.post258.dist-info/METADATA
 Comment: 
 
-Filename: nucliadb-2.8.5.post257.dist-info/WHEEL
+Filename: nucliadb-2.9.0.post258.dist-info/WHEEL
 Comment: 
 
-Filename: nucliadb-2.8.5.post257.dist-info/entry_points.txt
+Filename: nucliadb-2.9.0.post258.dist-info/entry_points.txt
 Comment: 
 
-Filename: nucliadb-2.8.5.post257.dist-info/top_level.txt
+Filename: nucliadb-2.9.0.post258.dist-info/top_level.txt
 Comment: 
 
-Filename: nucliadb-2.8.5.post257.dist-info/zip-safe
+Filename: nucliadb-2.9.0.post258.dist-info/zip-safe
 Comment: 
 
-Filename: nucliadb-2.8.5.post257.dist-info/RECORD
+Filename: nucliadb-2.9.0.post258.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## nucliadb/ingest/app.py

```diff
@@ -149,14 +149,27 @@
     consumer = await consumer_service.start_ingest_processed_consumer(SERVICE_NAME)
 
     await run_until_exit(
         [grpc_finalizer, consumer, metrics_server.shutdown] + finalizers
     )
 
 
+async def main_subscriber_workers():  # pragma: no cover
+    finalizers = await initialize()
+
+    metrics_server = await serve_metrics()
+
+    auditor_closer = await consumer_service.start_auditor()
+    shard_creator_closer = await consumer_service.start_shard_creator()
+
+    await run_until_exit(
+        [auditor_closer, shard_creator_closer, metrics_server.shutdown] + finalizers
+    )
+
+
 def setup_configuration():  # pragma: no cover
     setup_logging()
 
     assign_partitions(settings)
 
     errors.setup_error_handling(pkg_resources.get_distribution("nucliadb").version)
 
@@ -182,7 +195,15 @@
 
 def run_processed_consumer() -> None:  # pragma: no cover
     """
     Run the consumer + GRPC ingest service
     """
     setup_configuration()
     asyncio.run(main_ingest_processed_consumer())
+
+
+def run_subscriber_workers() -> None:  # pragma: no cover
+    """
+    Run the consumer + GRPC ingest service
+    """
+    setup_configuration()
+    asyncio.run(main_subscriber_workers())
```

## nucliadb/ingest/processing.py

```diff
@@ -18,15 +18,15 @@
 # along with this program. If not, see <http://www.gnu.org/licenses/>.
 #
 import base64
 import datetime
 import uuid
 from contextlib import AsyncExitStack
 from enum import Enum
-from typing import TYPE_CHECKING, Any, Dict, List, Optional
+from typing import TYPE_CHECKING, Any, Dict, Optional
 
 import aiohttp
 import jwt  # type: ignore
 from nucliadb_protos.resources_pb2 import CloudFile
 from nucliadb_protos.resources_pb2 import FieldFile as FieldFilePB
 from pydantic import BaseModel, Field
 
@@ -122,15 +122,15 @@
         )
     await processing_engine.initialize()
     set_utility(Utility.PROCESSING, processing_engine)
 
 
 class DummyProcessingEngine:
     def __init__(self):
-        self.calls: List[List[Any]] = []
+        self.calls: list[list[Any]] = []
 
     async def initialize(self):
         pass
 
     async def finalize(self):
         pass
```

## nucliadb/ingest/serialize.py

```diff
@@ -51,15 +51,15 @@
     Resource,
     ResourceData,
     TextFieldData,
     TextFieldExtractedData,
 )
 from nucliadb_models.search import ResourceProperties
 from nucliadb_models.vectors import UserVectorSet
-from nucliadb_utils.utilities import get_cache, get_storage
+from nucliadb_utils.utilities import get_storage
 
 
 async def set_resource_field_extracted_data(
     field: Field,
     field_data: ExtractedDataType,
     field_type_name: FieldTypeName,
     wanted_extracted_data: List[ExtractedDataTypeName],
@@ -429,17 +429,16 @@
     txn: Transaction,
     kbid: str,
     rid: Optional[str],
     slug: Optional[str] = None,
     service_name: Optional[str] = None,
 ) -> Optional[ORMResource]:
     storage = await get_storage(service_name=service_name)
-    cache = await get_cache()
 
-    kb = KnowledgeBox(txn, storage, cache, kbid)
+    kb = KnowledgeBox(txn, storage, kbid)
 
     if rid is None:
         if slug is None:
             raise ValueError("Either rid or slug parameters should be used")
 
         rid = await kb.get_resource_uuid_by_slug(slug)
         if rid is None:
@@ -453,12 +452,11 @@
     return orm_resource
 
 
 async def get_resource_uuid_by_slug(
     kbid: str, slug: str, service_name: Optional[str] = None
 ) -> Optional[str]:
     storage = await get_storage(service_name=service_name)
-    cache = await get_cache()
     driver = await get_driver()
     txn = await driver.begin()
-    kb = KnowledgeBox(txn, storage, cache, kbid)
+    kb = KnowledgeBox(txn, storage, kbid)
     return await kb.get_resource_uuid_by_slug(slug)
```

## nucliadb/ingest/consumer/consumer.py

```diff
@@ -30,15 +30,14 @@
 from nucliadb.ingest import logger
 from nucliadb.ingest.maindb.driver import Driver
 from nucliadb.ingest.orm.exceptions import DeadletteredError, SequenceOrderViolation
 from nucliadb.ingest.orm.processor import Processor, sequence_manager
 from nucliadb_telemetry import errors, metrics
 from nucliadb_telemetry.utils import set_info_on_span
 from nucliadb_utils import const
-from nucliadb_utils.audit.audit import AuditStorage
 from nucliadb_utils.cache import KB_COUNTER_CACHE
 from nucliadb_utils.cache.utility import Cache
 from nucliadb_utils.exceptions import ShardsNotFound
 from nucliadb_utils.nats import NatsConnectionManager
 from nucliadb_utils.storages.storage import Storage
 
 consumer_observer = metrics.Observer(
@@ -68,28 +67,25 @@
 class IngestConsumer:
     def __init__(
         self,
         driver: Driver,
         partition: str,
         storage: Storage,
         nats_connection_manager: NatsConnectionManager,
-        audit: Optional[AuditStorage],
         cache: Optional[Cache] = None,
     ):
         self.driver = driver
         self.partition = partition
-        self.storage = storage
-        self.audit = audit
         self.cache = cache
         self.nats_connection_manager = nats_connection_manager
         self.ack_wait = 10 * 60
         self.initialized = False
 
         self.lock = asyncio.Lock()
-        self.processor = Processor(driver, storage, audit, cache, partition)
+        self.processor = Processor(driver, storage, cache, partition)
 
     async def initialize(self):
         await self.setup_nats_subscription()
         self.initialized = True
 
     async def setup_nats_subscription(self):
         last_seqid = await sequence_manager.get_last_seqid(self.driver, self.partition)
```

## nucliadb/ingest/consumer/pull.py

```diff
@@ -29,15 +29,14 @@
 from nucliadb.http_clients.processing import ProcessingHTTPClient
 from nucliadb.ingest import logger, logger_activity
 from nucliadb.ingest.maindb.driver import Driver
 from nucliadb.ingest.orm.exceptions import ReallyStopPulling
 from nucliadb.ingest.orm.processor import Processor
 from nucliadb_telemetry import errors
 from nucliadb_utils import const
-from nucliadb_utils.audit.audit import AuditStorage
 from nucliadb_utils.cache.utility import Cache
 from nucliadb_utils.settings import nuclia_settings
 from nucliadb_utils.storages.storage import Storage
 from nucliadb_utils.utilities import get_transaction_utility, has_feature
 
 
 class PullWorker:
@@ -52,29 +51,25 @@
 
     def __init__(
         self,
         driver: Driver,
         partition: str,
         storage: Storage,
         pull_time_error_backoff: int,
-        audit: Optional[AuditStorage],
         cache: Optional[Cache] = None,
         local_subscriber: bool = False,
         pull_time_empty_backoff: float = 5.0,
     ):
-        self.driver = driver
         self.partition = partition
-        self.storage = storage
         self.pull_time_error_backoff = pull_time_error_backoff
         self.pull_time_empty_backoff = pull_time_empty_backoff
-        self.audit = audit
         self.local_subscriber = local_subscriber
         self.cache = cache
 
-        self.processor = Processor(driver, storage, audit, cache, partition)
+        self.processor = Processor(driver, storage, cache, partition)
 
     async def handle_message(self, payload: str) -> None:
         pb = BrokerMessage()
         pb.ParseFromString(base64.b64decode(payload))
 
         logger.debug(
             f"Resource: {pb.uuid} KB: {pb.kbid} ProcessingID: {pb.processing_id}"
```

## nucliadb/ingest/consumer/service.py

```diff
@@ -26,15 +26,24 @@
 from nucliadb.ingest.consumer.consumer import IngestConsumer, IngestProcessedConsumer
 from nucliadb.ingest.consumer.pull import PullWorker
 from nucliadb.ingest.orm import NODES
 from nucliadb.ingest.settings import settings
 from nucliadb.ingest.utils import get_driver
 from nucliadb_utils.exceptions import ConfigurationError
 from nucliadb_utils.settings import running_settings, transaction_settings
-from nucliadb_utils.utilities import get_audit, get_cache, get_nats_manager, get_storage
+from nucliadb_utils.utilities import (
+    get_audit,
+    get_cache,
+    get_nats_manager,
+    get_pubsub,
+    get_storage,
+)
+
+from .auditing import IndexAuditHandler, ResourceWritesAuditHandler
+from .shard_creator import ShardCreatorHandler
 
 
 def _handle_task_result(task: asyncio.Task) -> None:
     e = task.exception()
     if e:
         logger.exception(
             "Loop stopped by exception. This should not happen. Exiting.", exc_info=e
@@ -50,24 +59,22 @@
 
 async def start_pull_workers(
     service_name: Optional[str] = None,
 ) -> Callable[[], Awaitable[None]]:
     driver = await get_driver()
     cache = await get_cache()
     storage = await get_storage(service_name=service_name or SERVICE_NAME)
-    audit = get_audit()
     tasks = []
     for partition in settings.partitions:
         worker = PullWorker(
             driver=driver,
             partition=partition,
             storage=storage,
             pull_time_error_backoff=settings.pull_time_error_backoff,
             cache=cache,
-            audit=audit,
             local_subscriber=transaction_settings.transaction_local,
         )
         task = asyncio.create_task(worker.loop())
         task.add_done_callback(_handle_task_result)
         tasks.append(task)
 
     return partial(_exit_tasks, tasks)
@@ -85,24 +92,22 @@
     ):
         logger.warning("Initializion delayed 1s to receive some Nodes on the cluster")
         await asyncio.sleep(1)
 
     driver = await get_driver()
     cache = await get_cache()
     storage = await get_storage(service_name=service_name or SERVICE_NAME)
-    audit = get_audit()
     nats_connection_manager = get_nats_manager()
 
     for partition in settings.partitions:
         consumer = IngestConsumer(
             driver=driver,
             partition=partition,
             storage=storage,
             cache=cache,
-            audit=audit,
             nats_connection_manager=nats_connection_manager,
         )
         await consumer.initialize()
 
     return nats_connection_manager.finalize
 
 
@@ -125,21 +130,49 @@
     ):
         logger.warning("Initializion delayed 1s to receive some Nodes on the cluster")
         await asyncio.sleep(1)
 
     driver = await get_driver()
     cache = await get_cache()
     storage = await get_storage(service_name=service_name or SERVICE_NAME)
-    audit = get_audit()
     nats_connection_manager = get_nats_manager()
 
     consumer = IngestProcessedConsumer(
         driver=driver,
         partition="-1",
         storage=storage,
         cache=cache,
-        audit=audit,
         nats_connection_manager=nats_connection_manager,
     )
     await consumer.initialize()
 
     return nats_connection_manager.finalize
+
+
+async def start_auditor() -> Callable[[], Awaitable[None]]:
+    driver = await get_driver()
+    audit = get_audit()
+    assert audit is not None
+    pubsub = await get_pubsub()
+    storage = await get_storage(service_name=SERVICE_NAME)
+    index_auditor = IndexAuditHandler(driver=driver, audit=audit, pubsub=pubsub)
+    resource_writes_auditor = ResourceWritesAuditHandler(
+        driver=driver, storage=storage, audit=audit, pubsub=pubsub
+    )
+
+    await index_auditor.initialize()
+    await resource_writes_auditor.initialize()
+
+    return partial(
+        asyncio.gather, index_auditor.finalize(), resource_writes_auditor.finalize()  # type: ignore
+    )
+
+
+async def start_shard_creator() -> Callable[[], Awaitable[None]]:
+    driver = await get_driver()
+    pubsub = await get_pubsub()
+    storage = await get_storage(service_name=SERVICE_NAME)
+
+    shard_creator = ShardCreatorHandler(driver=driver, storage=storage, pubsub=pubsub)
+    await shard_creator.initialize()
+
+    return shard_creator.finalize
```

## nucliadb/ingest/orm/__init__.py

```diff
@@ -17,24 +17,24 @@
 # You should have received a copy of the GNU Affero General Public License
 # along with this program. If not, see <http://www.gnu.org/licenses/>.
 #
 from __future__ import annotations
 
 from dataclasses import dataclass
 from datetime import datetime
-from typing import TYPE_CHECKING, Any, Dict, List, Optional
+from typing import TYPE_CHECKING, Any, Optional
 
 from nucliadb.ingest.orm.exceptions import NodeClusterSmall
 from nucliadb.ingest.settings import settings
 from nucliadb_utils.clandestined import Cluster  # type: ignore
 
 if TYPE_CHECKING:  # pragma: no cover
     from nucliadb.ingest.orm.node import Node
 
-NODES: Dict[str, Node] = {}
+NODES: dict[str, Node] = {}
 
 
 @dataclass
 class ScoredNode:
     id: str
     shard_count: int
 
@@ -47,49 +47,50 @@
     def __init__(self):
         self.local_node = None
         self.date = datetime.now()
 
     def get_local_node(self):
         return self.local_node
 
-    def find_nodes(self, exclude_nodes: Optional[List[str]] = None) -> List[str]:
+    def find_nodes(self, avoid_nodes: Optional[list[str]] = None) -> list[str]:
         """
         Returns a list of node ids sorted by increasing shard count and load score.
-        It will exclude the node ids in `excluded_nodes` from the computation.
+        It will avoid the node ids in `avoid_nodes` from the computation if possible.
         It raises an exception if it can't find enough nodes for the configured replicas.
         """
         target_replicas = settings.node_replicas
         available_nodes = [
             ScoredNode(id=node_id, shard_count=node.shard_count)
             for node_id, node in NODES.items()
         ]
         if len(available_nodes) < target_replicas:
             raise NodeClusterSmall(
                 f"Not enough nodes. Total: {len(available_nodes)}, Required: {target_replicas}"
             )
 
-        if exclude_nodes:
-            available_nodes = list(
-                filter(lambda x: x.id not in exclude_nodes, available_nodes)  # type: ignore
-            )
-            if len(available_nodes) < target_replicas:
-                raise NodeClusterSmall(
-                    f"Could not find enough nodes. Available: {len(available_nodes)}, Required: {target_replicas}"  # noqa
-                )
-
         if settings.max_node_replicas >= 0:
             available_nodes = list(
                 filter(
                     lambda x: x.shard_count < settings.max_node_replicas, available_nodes  # type: ignore
                 )
             )
             if len(available_nodes) < target_replicas:
                 raise NodeClusterSmall(
                     f"Could not find enough nodes with available shards. Available: {len(available_nodes)}, Required: {target_replicas}"  # noqa
                 )
 
         # Sort available nodes by increasing shard_count
         sorted_nodes = sorted(available_nodes, key=lambda x: x.shard_count)
-        return [node.id for node in sorted_nodes][:target_replicas]
+        available_node_ids = [node.id for node in sorted_nodes]
+
+        avoid_nodes = avoid_nodes or []
+        # get preferred nodes first
+        preferred_nodes = [nid for nid in available_node_ids if nid not in avoid_nodes]
+        # now, add to the end of the last nodes
+        preferred_node_order = preferred_nodes + [
+            nid for nid in available_node_ids if nid not in preferred_nodes
+        ]
+
+        return preferred_node_order[:target_replicas]
 
 
 NODE_CLUSTER = ClusterObject()
```

## nucliadb/ingest/orm/abc.py

```diff
@@ -71,15 +71,15 @@
     async def add_resource(
         self,
         resource: PBBrainResource,
         txid: int,
         partition: str,
         kb: str,
         reindex_id: Optional[str] = None,
-    ) -> Optional[ShardCounter]:  # pragma: no cover
+    ) -> None:  # pragma: no cover
         pass
 
 
 class AbstractNode(metaclass=ABCMeta):
     label: str
 
     @property
```

## nucliadb/ingest/orm/entities.py

```diff
@@ -51,15 +51,14 @@
 )
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox
 from nucliadb.ingest.orm.node import Node
 from nucliadb.ingest.orm.nodes_manager import NodesManager
 from nucliadb.ingest.settings import settings
 from nucliadb.ingest.utils import get_driver
 from nucliadb_telemetry import errors
-from nucliadb_utils.utilities import get_cache
 
 
 class EntitiesManager:
     def __init__(
         self,
         knowledgebox: KnowledgeBox,
         txn: Transaction,
@@ -201,16 +200,15 @@
 
         eg = EntitiesGroup()
         eg.ParseFromString(payload)
         return eg
 
     async def get_indexed_entities_group(self, group: str) -> Optional[EntitiesGroup]:
         driver = await get_driver()
-        cache = await get_cache()
-        nodes_manager = NodesManager(driver=driver, cache=cache)
+        nodes_manager = NodesManager(driver=driver)
 
         async def do_entities_search(
             node: Node, shard_id: str, node_id: str
         ) -> RelationSearchResponse:
             request = RelationSearchRequest(
                 shard_id=shard_id,
                 prefix=RelationPrefixSearchRequest(
@@ -296,16 +294,15 @@
             if (exclude_deleted and group in deleted_groups) or group in visited_groups:
                 continue
             yield group
             visited_groups.add(group)
 
     async def get_indexed_entities_groups_names(self) -> Set[str]:
         driver = await get_driver()
-        cache = await get_cache()
-        nodes_manager = NodesManager(driver=driver, cache=cache)
+        nodes_manager = NodesManager(driver=driver)
 
         async def query_indexed_entities_group_names(
             node: Node, shard_id: str, node_id: str
         ) -> TypeList:
             return await node.reader.RelationTypes(ShardId(id=shard_id))  # type: ignore
 
         results = await nodes_manager.apply_for_all_shards(
```

## nucliadb/ingest/orm/knowledgebox.py

```diff
@@ -51,15 +51,14 @@
 from nucliadb.ingest.orm.synonyms import Synonyms
 from nucliadb.ingest.orm.utils import (
     compute_paragraph_key,
     get_basic,
     get_node_klass,
     set_basic,
 )
-from nucliadb_utils.cache.utility import Cache
 from nucliadb_utils.exceptions import ShardsNotFound
 from nucliadb_utils.settings import indexing_settings
 from nucliadb_utils.storages.storage import Storage
 from nucliadb_utils.utilities import get_audit, get_storage
 
 KB_RESOURCE = "/kbs/{kbid}/r/{uuid}"
 
@@ -76,21 +75,18 @@
 KB_TO_DELETE_STORAGE_BASE = "/storagetodelete/"
 
 KB_TO_DELETE = f"{KB_TO_DELETE_BASE}{{kbid}}"
 KB_TO_DELETE_STORAGE = f"{KB_TO_DELETE_STORAGE_BASE}{{kbid}}"
 
 
 class KnowledgeBox:
-    def __init__(
-        self, txn: Transaction, storage: Storage, cache: Union[Cache, None], kbid: str
-    ):
+    def __init__(self, txn: Transaction, storage: Storage, kbid: str):
         self.txn = txn
         self.storage = storage
         self.kbid = kbid
-        self.cache = cache
         self._config: Optional[KnowledgeBoxConfig] = None
         self.synonyms = Synonyms(self.txn, self.kbid)
 
     async def get_config(self) -> Optional[KnowledgeBoxConfig]:
         if self._config is None:
             payload = await self.txn.get(KB_UUID.format(kbid=self.kbid))
             if payload is not None:
```

## nucliadb/ingest/orm/local_node.py

```diff
@@ -18,38 +18,67 @@
 # along with this program. If not, see <http://www.gnu.org/licenses/>.
 #
 from __future__ import annotations
 
 from typing import Optional
 from uuid import uuid4
 
-from nucliadb_protos.noderesources_pb2 import Resource, ResourceID
-from nucliadb_protos.nodewriter_pb2 import OpStatus
-from nucliadb_protos.utils_pb2 import VectorSimilarity
-from nucliadb_protos.writer_pb2 import ShardObject as PBShard
-from nucliadb_protos.writer_pb2 import ShardReplica
-from nucliadb_protos.writer_pb2 import Shards as PBShards
-
 from nucliadb.ingest.maindb.driver import Transaction
 from nucliadb.ingest.orm import NODE_CLUSTER
 from nucliadb.ingest.orm.abc import AbstractNode
 from nucliadb.ingest.orm.grpc_node_binding import LocalReaderWrapper, LocalWriterWrapper
 from nucliadb.ingest.orm.local_shard import LocalShard
+from nucliadb_protos import (
+    nodereader_pb2,
+    noderesources_pb2,
+    nodesidecar_pb2,
+    nodewriter_pb2,
+    utils_pb2,
+    writer_pb2,
+)
 from nucliadb_utils.keys import KB_SHARDS
 
 
+class LocalNodeSidecarInterface:
+    """
+    backward compatibile interface for sidecar
+    type interactions when running standalone.
+
+    Right now, side car only provides cached counters.
+
+    Long term, this should be removed and any caching
+    should be done at the node reader.
+    """
+
+    def __init__(self, reader: LocalReaderWrapper):
+        self._reader = reader
+
+    async def GetCount(
+        self, shard_id: noderesources_pb2.ShardId
+    ) -> nodesidecar_pb2.Counter:
+        shard = await self._reader.GetShard(
+            nodereader_pb2.GetShardRequest(shard_id=shard_id)
+        )
+        response = nodesidecar_pb2.Counter()
+        if shard is not None:
+            response.resources = shard.resources
+            response.paragraphs = shard.paragraphs
+        return response
+
+
 class LocalNode(AbstractNode):
     _writer: LocalWriterWrapper
     _reader: LocalReaderWrapper
     label: str = "local"
 
     def __init__(self):
         self._writer = LocalWriterWrapper()
         self._reader = LocalReaderWrapper()
         self.address = "local"
+        self.sidecar = LocalNodeSidecarInterface(self._reader)
 
     @property
     def reader(self) -> LocalReaderWrapper:  # type: ignore
         return self._reader
 
     @property
     def writer(self) -> LocalWriterWrapper:  # type: ignore
@@ -57,63 +86,70 @@
 
     @classmethod
     async def get(cls, _) -> LocalNode:
         return NODE_CLUSTER.get_local_node()
 
     @classmethod
     async def create_shard_by_kbid(
-        cls, txn: Transaction, kbid: str, similarity: VectorSimilarity.ValueType
+        cls,
+        txn: Transaction,
+        kbid: str,
+        similarity: utils_pb2.VectorSimilarity.ValueType,
     ) -> LocalShard:
         node = NODE_CLUSTER.get_local_node()
         sharduuid = uuid4().hex
-        shard = PBShard(shard=sharduuid)
+        shard = writer_pb2.ShardObject(shard=sharduuid)
         shard_created = await node.new_shard(kbid, similarity=similarity)
-        sr = ShardReplica(node=str(node))
+        sr = writer_pb2.ShardReplica(node=str(node))
         sr.shard.CopyFrom(shard_created)
         shard.replicas.append(sr)
 
         key = KB_SHARDS.format(kbid=kbid)
         payload = await txn.get(key)
-        kb_shards = PBShards()
+        kb_shards = writer_pb2.Shards()
         if payload is not None:
             kb_shards.ParseFromString(payload)
         else:
             kb_shards.kbid = kbid
             kb_shards.actual = -1
             kb_shards.similarity = similarity
         kb_shards.shards.append(shard)
         kb_shards.actual += 1
         await txn.set(key, kb_shards.SerializeToString())
 
         return LocalShard(sharduuid=sharduuid, shard=shard, node=node)
 
     @classmethod
-    def create_shard_klass(cls, shard_id: str, pbshard: PBShard):
+    def create_shard_klass(cls, shard_id: str, pbshard: writer_pb2.ShardObject):
         node = NODE_CLUSTER.get_local_node()
         return LocalShard(sharduuid=shard_id, shard=pbshard, node=node)
 
     @classmethod
     async def get_current_active_shard(
         cls, txn: Transaction, kbid: str
     ) -> Optional[LocalShard]:
         key = KB_SHARDS.format(kbid=kbid)
         kb_shards_bytes: Optional[bytes] = await txn.get(key)
         if kb_shards_bytes is not None:
-            kb_shards = PBShards()
+            kb_shards = writer_pb2.Shards()
             kb_shards.ParseFromString(kb_shards_bytes)
-            shard: PBShard = kb_shards.shards[kb_shards.actual]
+            shard: writer_pb2.ShardObject = kb_shards.shards[kb_shards.actual]
             node = NODE_CLUSTER.get_local_node()
             return LocalShard(sharduuid=shard.shard, shard=shard, node=node)
         else:
             return None
 
-    async def add_resource(self, req: Resource) -> OpStatus:
+    async def add_resource(
+        self, req: noderesources_pb2.Resource
+    ) -> nodewriter_pb2.OpStatus:
         return await self.writer.SetResource(req)
 
-    async def delete_resource(self, req: ResourceID) -> OpStatus:
+    async def delete_resource(
+        self, req: noderesources_pb2.ResourceID
+    ) -> nodewriter_pb2.OpStatus:
         return await self.writer.RemoveResource(req)
 
     def __str__(self):
         return "LOCAL NODE"
 
     def __repr__(self):
         return "LOCAL NODE"
```

## nucliadb/ingest/orm/local_shard.py

```diff
@@ -22,15 +22,15 @@
 from typing import TYPE_CHECKING, Dict, Optional
 
 from nucliadb_protos.noderesources_pb2 import Resource as PBBrainResource
 from nucliadb_protos.noderesources_pb2 import ResourceID
 from nucliadb_protos.noderesources_pb2 import ShardCleaned as PBShardCleaned
 from nucliadb_protos.writer_pb2 import ShardObject as PBShard
 
-from nucliadb.ingest.orm.abc import AbstractShard, ShardCounter
+from nucliadb.ingest.orm.abc import AbstractShard
 
 if TYPE_CHECKING:  # pragma: no cover
     from nucliadb.ingest.orm.local_node import LocalNode
 
 
 class LocalShard(AbstractShard):
     def __init__(self, sharduuid: str, shard: PBShard, node: LocalNode):
@@ -49,21 +49,18 @@
     async def add_resource(
         self,
         resource: PBBrainResource,
         txid: int,
         partition: str,
         kb: str,
         reindex_id: Optional[str] = None,
-    ) -> Optional[ShardCounter]:
+    ) -> None:
         for shardreplica in self.shard.replicas:
             resource.shard_id = resource.resource.shard_id = shardreplica.shard.id
-            res = await self.node.add_resource(resource)
-        # We don't have paragraphs returned from the writer SetResource, and
-        # we also don't need them here, as they are used for auditing purposes
-        return ShardCounter(shard=self.sharduuid, fields=res.count, paragraphs=0)
+            await self.node.add_resource(resource)
 
     async def clean_and_upgrade(self) -> Dict[str, PBShardCleaned]:
         shards_cleaned: Dict[str, PBShardCleaned] = {}
         for shardreplica in self.shard.replicas:
             replica_id = shardreplica.shard.id
             cleaned: PBShardCleaned = await self.node.clean_and_upgrade_shard(
                 replica_id
```

## nucliadb/ingest/orm/node.py

```diff
@@ -96,19 +96,18 @@
             kb_shards.similarity = similarity
         else:
             # New logic shard on an existing index
             kb_shards = PBShards()
             kb_shards.ParseFromString(kb_shards_binary)
 
         try:
-            # When choosing the nodes, we need to exclude nodes in which there is already a shard from the same KB
-            kb_nodes = [
+            existing_kb_nodes = [
                 replica.node for shard in kb_shards.shards for replica in shard.replicas
             ]
-            node_ids = NODE_CLUSTER.find_nodes(exclude_nodes=kb_nodes)
+            node_ids = NODE_CLUSTER.find_nodes(avoid_nodes=existing_kb_nodes)
         except NodeClusterSmall as err:
             errors.capture_exception(err)
             logger.error(
                 f"Shard creation for kbid={kbid} failed: Replication requirements could not be met."
             )
             raise
```

## nucliadb/ingest/orm/nodes_manager.py

```diff
@@ -30,17 +30,16 @@
 from nucliadb.ingest.orm.node import Node
 from nucliadb_telemetry import errors
 from nucliadb_utils.exceptions import ShardsNotFound
 from nucliadb_utils.keys import KB_SHARDS
 
 
 class NodesManager:
-    def __init__(self, driver: Driver, cache):
+    def __init__(self, driver: Driver):
         self.driver = driver
-        self.cache = cache
 
     async def get_shards_by_kbid_inner(self, kbid: str) -> PBShards:
         key = KB_SHARDS.format(kbid=kbid)
         async with self.driver.transaction() as txn:
             payload = await txn.get(key)
             if payload is None:
                 # could be None because /shards doesn't exist, or beacause the whole KB does not exist.
```

## nucliadb/ingest/orm/shard.py

```diff
@@ -18,32 +18,26 @@
 # along with this program. If not, see <http://www.gnu.org/licenses/>.
 #
 from __future__ import annotations
 
 import uuid
 from typing import Any, Dict, List, Optional, Tuple
 
-from lru import LRU  # type: ignore
 from nucliadb_protos.noderesources_pb2 import (
     Resource as PBBrainResource,  # type: ignore
 )
 from nucliadb_protos.noderesources_pb2 import ShardCleaned as PBShardCleaned
-from nucliadb_protos.noderesources_pb2 import ShardId
-from nucliadb_protos.nodesidecar_pb2 import Counter
 from nucliadb_protos.nodewriter_pb2 import IndexMessage, TypeMessage
 from nucliadb_protos.writer_pb2 import ShardObject as PBShard
 
 from nucliadb.ingest import SERVICE_NAME  # type: ignore
 from nucliadb.ingest.orm import NODES
-from nucliadb.ingest.orm.abc import AbstractShard, ShardCounter
-from nucliadb_telemetry import errors
+from nucliadb.ingest.orm.abc import AbstractShard
 from nucliadb_utils.utilities import get_indexing, get_storage
 
-SHARDS = LRU(100)
-
 
 class Shard(AbstractShard):
     def __init__(self, sharduuid: str, shard: PBShard, node: Optional[Any] = None):
         self.shard = shard
         self.sharduuid = sharduuid
         self.node = node
 
@@ -78,15 +72,15 @@
     async def add_resource(
         self,
         resource: PBBrainResource,
         txid: int,
         partition: str,
         kb: str,
         reindex_id: Optional[str] = None,
-    ) -> Optional[ShardCounter]:
+    ) -> None:
         if txid == -1 and reindex_id is None:
             # This means we are injecting a complete resource via ingest gRPC
             # outside of a transaction. We need to treat this as a reindex operation.
             reindex_id = uuid.uuid4().hex
 
         storage = await get_storage(service_name=SERVICE_NAME)
         indexing = get_indexing()
@@ -98,31 +92,18 @@
                 resource, reindex_id, partition, kb=kb, logical_shard=self.sharduuid
             )
         else:
             indexpb = await storage.indexing(
                 resource, txid, partition, kb=kb, logical_shard=self.sharduuid
             )
 
-        shard_counter: Optional[ShardCounter] = None
         for replica_id, node_id in self.indexing_replicas():
             indexpb.node = node_id
             indexpb.shard = replica_id
             await indexing.index(indexpb, node_id)
-            try:
-                counter: Counter = await NODES[node_id].sidecar.GetCount(ShardId(id=replica_id))  # type: ignore
-                shard_counter = ShardCounter(
-                    shard=self.sharduuid,
-                    # even though counter returns a `resources` value here,
-                    # `resources` here from a shard is actually more like `fields`
-                    fields=counter.resources,
-                    paragraphs=counter.paragraphs,
-                )
-            except Exception as exc:
-                errors.capture_exception(exc)
-        return shard_counter
 
     async def clean_and_upgrade(self) -> Dict[str, PBShardCleaned]:
         replicas_cleaned: Dict[str, PBShardCleaned] = {}
         for shardreplica in self.shard.replicas:
             node = NODES[shardreplica.node]
             replica_id = shardreplica.shard
             cleaned = await node.writer.CleanAndUpgradeShard(replica_id)  # type: ignore
```

## nucliadb/ingest/orm/processor/__init__.py

```diff
@@ -13,65 +13,46 @@
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 # GNU Affero General Public License for more details.
 #
 # You should have received a copy of the GNU Affero General Public License
 # along with this program. If not, see <http://www.gnu.org/licenses/>.
 #
-from enum import Enum
+import logging
 from typing import Dict, List, Optional, Tuple
 
-from nucliadb_protos.audit_pb2 import AuditField, AuditRequest, AuditShardCounter
 from nucliadb_protos.knowledgebox_pb2 import KnowledgeBox as KnowledgeBoxPB
 from nucliadb_protos.knowledgebox_pb2 import (
     KnowledgeBoxConfig,
     KnowledgeBoxID,
     KnowledgeBoxResponseStatus,
 )
 from nucliadb_protos.resources_pb2 import Metadata as PBMetadata
 from nucliadb_protos.utils_pb2 import VectorSimilarity
-from nucliadb_protos.writer_pb2 import BrokerMessage, FieldType, Notification
-from pydantic import BaseModel
+from nucliadb_protos.writer_pb2 import BrokerMessage, Notification
 
-from nucliadb.ingest import SERVICE_NAME, logger
 from nucliadb.ingest.maindb.driver import Driver, Transaction
 from nucliadb.ingest.orm.exceptions import (
     DeadletteredError,
     KnowledgeBoxConflict,
     KnowledgeBoxNotFound,
     SequenceOrderViolation,
 )
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox
 from nucliadb.ingest.orm.processor import sequence_manager
 from nucliadb.ingest.orm.resource import Resource
-from nucliadb.ingest.orm.shard import Shard, ShardCounter
+from nucliadb.ingest.orm.shard import Shard
 from nucliadb.ingest.orm.utils import get_node_klass, set_basic
-from nucliadb.ingest.settings import settings
 from nucliadb_telemetry import errors
 from nucliadb_utils import const
-from nucliadb_utils.audit.audit import AuditStorage
 from nucliadb_utils.cache.utility import Cache
 from nucliadb_utils.storages.storage import Storage
-from nucliadb_utils.utilities import get_cache, get_storage
+from nucliadb_utils.utilities import get_storage
 
-
-class TxnAction(Enum):
-    RESOURCE_CREATED = 0
-    RESOURCE_MODIFIED = 1
-
-
-class TxnResult(BaseModel):
-    action: TxnAction
-    counter: Optional[ShardCounter]
-
-
-AUDIT_TYPES: Dict[TxnAction, int] = {
-    TxnAction.RESOURCE_CREATED: AuditRequest.AuditType.NEW,
-    TxnAction.RESOURCE_MODIFIED: AuditRequest.AuditType.MODIFIED,
-}
+logger = logging.getLogger(__name__)
 
 
 class Processor:
     """
     This class is responsible for processing messages from the broker
     and attempts to manage sequencing correctly with a txn id implementation.
 
@@ -85,263 +66,74 @@
 
     messages: Dict[str, List[BrokerMessage]]
 
     def __init__(
         self,
         driver: Driver,
         storage: Storage,
-        audit: Optional[AuditStorage] = None,
         cache: Optional[Cache] = None,
         partition: Optional[str] = None,
     ):
         self.messages = {}
         self.driver = driver
         self.storage = storage
-        self.audit = audit
         self.partition = partition
         self.cache = cache
 
-    @staticmethod
-    def iterate_auditable_fields(resource_keys, message):
-        """
-        Generator that emits the combined list of field ids from both
-        the existing resource and message that needs to be considered
-        in the audit of fields.
-        """
-        yielded = set()
-
-        # Include all fields present in the message we are processing
-        for field_id in message.files.keys():
-            key = (field_id, FieldType.FILE)
-            yield key
-            yielded.add(key)
-
-        for field_id in message.conversations.keys():
-            key = (field_id, FieldType.CONVERSATION)
-            yield key
-            yielded.add(key)
-
-        for field_id in message.layouts.keys():
-            key = (field_id, FieldType.LAYOUT)
-            yield key
-            yielded.add(key)
-
-        for field_id in message.texts.keys():
-            key = (field_id, FieldType.TEXT)
-            yield key
-            yielded.add(key)
-
-        for field_id in message.keywordsets.keys():
-            key = (field_id, FieldType.KEYWORDSET)
-            yield key
-            yielded.add(key)
-
-        for field_id in message.datetimes.keys():
-            key = (field_id, FieldType.DATETIME)
-            yield key
-            yielded.add(key)
-
-        for field_id in message.links.keys():
-            key = (field_id, FieldType.LINK)
-            yield key
-            yielded.add(key)
-
-        # Include fields of the current resource
-        # We'll Ignore fields that are not in current message with the exception of DELETE resource
-        # message, then we want them all, because among other things we need to report all the individual
-        # sizes that disappear from storage
-
-        for field_type, field_id in resource_keys:
-            if field_type is FieldType.GENERIC:
-                continue
-
-            if not (
-                field_id in message.files
-                or message.type is BrokerMessage.MessageType.DELETE
-            ):
-                continue
-
-            # Avoid duplicates
-            if (field_type, field_id) in yielded:
-                continue
-
-            yield (field_id, field_type)
-
-    async def collect_audit_fields(self, message: BrokerMessage) -> List[AuditField]:
-        audit_storage_fields: List[AuditField] = []
-        txn = await self.driver.begin()
-
-        storage = await get_storage(service_name=SERVICE_NAME)
-        cache = await get_cache()
-        kb = KnowledgeBox(txn, storage, cache, message.kbid)
-        resource = Resource(txn, storage, kb, message.uuid)
-        field_keys = await resource.get_fields_ids()
-
-        for field_id, field_type in self.iterate_auditable_fields(field_keys, message):
-            field = await resource.get_field(field_id, field_type, load=True)
-            val = await field.get_value()
-
-            auditfield = AuditField()
-            auditfield.field_type = field_type
-            auditfield.field_id = field_id
-            if field_type is FieldType.FILE:
-                auditfield.filename = message.files[field_id].file.filename
-            if val is None:
-                # The field did not exist previously, so we are adding it now
-                auditfield.action = AuditField.FieldAction.ADDED
-                if field_type is FieldType.FILE:
-                    auditfield.size = auditfield.size_delta = message.files[
-                        field_id
-                    ].file.size
-            elif message.type is BrokerMessage.MessageType.DELETE:
-                # The file did exist, and we are deleting the field as a side effect of deleting the resource
-                auditfield.action = AuditField.FieldAction.DELETED
-                if field_type is FieldType.FILE:
-                    auditfield.size = 0
-                    auditfield.size_delta = -val.file.size
-            else:
-                # The field did exist, so we are overwriting it, with a modified file
-                # in case of a file
-                auditfield.action = AuditField.FieldAction.MODIFIED
-                if field_type is FieldType.FILE:
-                    auditfield.size = message.files[field_id].file.size
-                    auditfield.size_delta = (
-                        val.file.size - message.files[field_id].file.size
-                    )
-
-            audit_storage_fields.append(auditfield)
-
-        if (
-            message.delete_fields
-            and message.type is not BrokerMessage.MessageType.DELETE
-        ):
-            # If we are fully deleting a resource we won't iterate the delete_fields (if any)
-            # Make no sense as we already collected all resource fields as deleted
-            for fieldid in message.delete_fields:
-                field = await resource.get_field(
-                    fieldid.field, FieldType.FILE, load=True
-                )
-                audit_field = AuditField()
-                audit_field.action = AuditField.FieldAction.DELETED
-                audit_field.field_id = fieldid.field
-                audit_field.field_type = fieldid.field_type
-                if fieldid.field_type is FieldType.FILE:
-                    val = await field.get_value()
-                    audit_field.size = 0
-                    audit_field.size_delta = -val.file.size
-                    audit_field.filename = val.file.filename
-                audit_storage_fields.append(audit_field)
-
-        await txn.abort()
-        return audit_storage_fields
-
     async def process(
         self,
         message: BrokerMessage,
         seqid: int,
         partition: Optional[str] = None,
         transaction_check: bool = True,
-    ):
+    ) -> None:
         partition = partition if self.partition is None else self.partition
         if partition is None:
             raise AttributeError("Can't process message from unknown partition")
 
         # When running in transactional mode, we need to check that
         # that the current message doesn't violate the sequence order for the
         # current partition
         if transaction_check:
             last_seqid = await sequence_manager.get_last_seqid(self.driver, partition)
             if last_seqid is not None and seqid <= last_seqid:
                 raise SequenceOrderViolation(last_seqid)
 
-        audit_type: Optional[int] = None
-        audit_fields = None
-        audit_shard_counter: Optional[AuditShardCounter] = None
-
         if message.type == BrokerMessage.MessageType.DELETE:
-            audit_fields = await self.collect_audit_fields(message)
             await self.delete_resource(message, seqid, partition, transaction_check)
-            audit_type = AuditRequest.AuditType.DELETED
         elif message.type == BrokerMessage.MessageType.AUTOCOMMIT:
-            audit_fields = await self.collect_audit_fields(message)
-            txn_result = await self.txn([message], seqid, partition, transaction_check)
-            if txn_result is not None:
-                audit_type = (
-                    AUDIT_TYPES.get(txn_result.action)
-                    if txn_result is not None
-                    else None
-                )
-                audit_shard_counter = (
-                    AuditShardCounter(
-                        shard=txn_result.counter.shard,
-                        paragraphs=txn_result.counter.paragraphs,
-                        fields=txn_result.counter.fields,
-                    )
-                    if txn_result.counter is not None
-                    else None
-                )
+            await self.txn([message], seqid, partition, transaction_check)
         elif message.type == BrokerMessage.MessageType.MULTI:
             # XXX Not supported right now
             # MULTI, COMMIT and ROLLBACK are all not supported in transactional mode right now
             # This concept is probably not tenable with current architecture because
             # of how nats works and how we would need to manage rollbacks.
             # XXX Should this be removed?
             await self.multi(message, seqid)
         elif message.type == BrokerMessage.MessageType.COMMIT:
-            audit_fields = await self.collect_audit_fields(message)
-            txn_result = await self.commit(message, seqid, partition)
-            if txn_result:
-                audit_type = (
-                    AUDIT_TYPES.get(txn_result.action)
-                    if txn_result is not None
-                    else None
-                )
-                audit_shard_counter = (
-                    AuditShardCounter(
-                        shard=txn_result.counter.shard,
-                        paragraphs=txn_result.counter.paragraphs,
-                        fields=txn_result.counter.fields,
-                    )
-                    if txn_result.counter is not None
-                    else None
-                )
+            await self.commit(message, seqid, partition)
         elif message.type == BrokerMessage.MessageType.ROLLBACK:
             await self.rollback(message, seqid, partition)
 
-        # There are some operations that doesn't require audit report by definition
-        # like rollback or multi and others because there was no action executed for
-        # some reason. This is signaled as audit_type == None
-        if self.audit is not None and audit_type is not None:
-            await self.audit.report(
-                message,
-                audit_type,
-                audit_fields=audit_fields,
-                counter=audit_shard_counter,
-            )
-        elif self.audit is None:
-            logger.warning("No audit defined")
-        elif audit_type is None and txn_result is not None:
-            logger.warning(f"Audit type empty txn_result: {txn_result.action}")
-
     async def get_resource_uuid(self, kb: KnowledgeBox, message: BrokerMessage) -> str:
         if message.uuid is None:
             uuid = await kb.get_resource_uuid_by_slug(message.slug)
         else:
             uuid = message.uuid
         return uuid
 
     async def delete_resource(
         self,
         message: BrokerMessage,
         seqid: int,
         partition: str,
         transaction_check: bool = True,
-    ):
+    ) -> None:
         txn = await self.driver.begin()
-        kb = KnowledgeBox(txn, self.storage, self.cache, message.kbid)
+        kb = KnowledgeBox(txn, self.storage, message.kbid)
 
         uuid = await self.get_resource_uuid(kb, message)
         shard_id = await kb.get_resource_shard_id(uuid)
         if shard_id is None:
             logger.warning(f"Resource {uuid} does not exist")
         else:
             node_klass = get_node_klass()
@@ -350,23 +142,31 @@
                 raise AttributeError("Shard not available")
             await shard.delete_resource(message.uuid, seqid, partition, message.kbid)
             try:
                 await kb.delete_resource(message.uuid)
             except Exception as exc:
                 await txn.abort()
                 await self.notify_abort(
-                    partition, seqid, message.multiid, message.kbid, message.uuid
+                    partition=partition,
+                    seqid=seqid,
+                    multi=message.multiid,
+                    kbid=message.kbid,
+                    rid=message.uuid,
                 )
                 raise exc
         if txn.open:
             if transaction_check:
                 await sequence_manager.set_last_seqid(txn, partition, seqid)
             await txn.commit()
         await self.notify_commit(
-            partition, seqid, message.multiid, message.kbid, message.uuid
+            partition=partition,
+            seqid=seqid,
+            multi=message.multiid,
+            message=message,
+            write_type=Notification.WriteType.DELETED,
         )
 
     async def commit_slug(self, resource: Resource) -> None:
         # Slug may have conflicts as its not partitioned properly,
         # so we commit it in a different transaction to make it as short as possible
         prev_txn = resource.txn
         async with self.driver.transaction() as txn:
@@ -377,33 +177,32 @@
 
     async def txn(
         self,
         messages: List[BrokerMessage],
         seqid: int,
         partition: str,
         transaction_check: bool = True,
-    ) -> Optional[TxnResult]:
+    ) -> None:
         if len(messages) == 0:
             return None
 
         txn = await self.driver.begin()
         kbid = messages[0].kbid
         if not await KnowledgeBox.exist_kb(txn, kbid):
             logger.warning(f"KB {kbid} is deleted: skiping txn")
             if transaction_check:
                 await sequence_manager.set_last_seqid(txn, partition, seqid)
             await txn.commit()
             return None
 
         multi = messages[0].multiid
-        kb = KnowledgeBox(txn, self.storage, self.cache, kbid)
+        kb = KnowledgeBox(txn, self.storage, kbid)
         uuid = await self.get_resource_uuid(kb, messages[0])
         resource: Optional[Resource] = None
         handled_exception = None
-        counter = None
         created = False
         shard: Optional[Shard] = None
 
         try:
             for message in messages:
                 if resource is not None:
                     assert resource.uuid == message.uuid
@@ -438,48 +237,50 @@
                         similarity = await kb.get_similarity()
                         shard = await node_klass.create_shard_by_kbid(
                             txn, kbid, similarity=similarity
                         )
                     await kb.set_resource_shard_id(uuid, shard.sharduuid)
 
                 if shard is not None:
-                    counter = await shard.add_resource(
+                    await shard.add_resource(
                         resource.indexer.brain, seqid, partition=partition, kb=kbid
                     )
-                    if (
-                        counter is not None
-                        and counter.fields > settings.max_shard_fields
-                    ):
-                        # shard is full, create a new one so next resource
-                        # is placed on a new shard
-                        similarity = await kb.get_similarity()
-                        shard = await node_klass.create_shard_by_kbid(
-                            txn, kbid, similarity=similarity
-                        )
                 else:
                     raise AttributeError("Shard is not available")
 
                 if transaction_check:
                     await sequence_manager.set_last_seqid(txn, partition, seqid)
                 await txn.commit()
 
                 if created or resource.slug_modified:
                     await self.commit_slug(resource)
 
-                await self.notify_commit(partition, seqid, multi, kbid, uuid)
+                await self.notify_commit(
+                    partition=partition,
+                    seqid=seqid,
+                    multi=multi,
+                    message=message,
+                    write_type=Notification.WriteType.CREATED
+                    if created
+                    else Notification.WriteType.MODIFIED,
+                )
             elif resource and resource.modified is False:
                 await txn.abort()
-                await self.notify_abort(partition, seqid, multi, kbid, uuid)
+                await self.notify_abort(
+                    partition=partition, seqid=seqid, multi=multi, kbid=kbid, rid=uuid
+                )
                 logger.warning(f"This message did not modify the resource")
         except Exception as exc:
             # As we are in the middle of a transaction, we cannot let the exception raise directly
             # as we need to do some cleanup. The exception will be reraised at the end of the function
             # and then handled by the top caller, so errors can be handled in the same place.
             await self.deadletter(messages, partition, seqid)
-            await self.notify_abort(partition, seqid, multi, kbid, uuid)
+            await self.notify_abort(
+                partition=partition, seqid=seqid, multi=multi, kbid=kbid, rid=uuid
+            )
             handled_exception = exc
         finally:
             if resource is not None:
                 resource.clean()
             # txn should be already commited or aborted, but in the event of an exception
             # it could be left open. Make sure to close it if it's still open
             if txn.open:
@@ -488,20 +289,15 @@
         if handled_exception is not None:
             if seqid == -1:
                 raise handled_exception
             else:
                 await self._mark_resource_error(resource, partition, seqid, shard, kbid)
                 raise DeadletteredError() from handled_exception
 
-        return TxnResult(
-            action=TxnAction.RESOURCE_CREATED
-            if created
-            else TxnAction.RESOURCE_MODIFIED,
-            counter=counter,
-        )
+        return None
 
     async def _mark_resource_error(
         self,
         resource: Optional[Resource],
         partition: str,
         seqid: int,
         shard: Optional[Shard],
@@ -530,37 +326,42 @@
 
             await shard.add_resource(
                 resource.indexer.brain, seqid, partition=partition, kb=kbid
             )
         except Exception:
             logger.warning("Error while marking resource as error", exc_info=True)
 
-    async def multi(self, message: BrokerMessage, seqid: int):
+    async def multi(self, message: BrokerMessage, seqid: int) -> None:
         self.messages.setdefault(message.multiid, []).append(message)
 
-    async def commit(self, message: BrokerMessage, seqid: int, partition: str):
+    async def commit(self, message: BrokerMessage, seqid: int, partition: str) -> None:
         if message.multiid not in self.messages:
             # Error
             logger.error(f"Closed multi {message.multiid}")
             await self.deadletter([message], partition, seqid)
-            return
         else:
-            return await self.txn(self.messages[message.multiid], seqid, partition)
+            await self.txn(self.messages[message.multiid], seqid, partition)
 
-    async def rollback(self, message: BrokerMessage, seqid: int, partition: str):
+    async def rollback(
+        self, message: BrokerMessage, seqid: int, partition: str
+    ) -> None:
         # Error
         logger.error(f"Closed multi {message.multiid}")
         del self.messages[message.multiid]
         await self.notify_abort(
-            partition, seqid, message.multiid, message.kbid, message.uuid
+            partition=partition,
+            seqid=seqid,
+            multi=message.multiid,
+            kbid=message.kbid,
+            rid=message.uuid,
         )
 
     async def deadletter(
         self, messages: List[BrokerMessage], partition: str, seqid: int
-    ):
+    ) -> None:
         for seq, message in enumerate(messages):
             await self.storage.deadletter(message, seq, seqid, partition)
 
     async def apply_resource(
         self,
         message: BrokerMessage,
         kb: KnowledgeBox,
@@ -608,68 +409,77 @@
             await resource.apply_fields(message)
             await resource.apply_extracted(message)
             return (resource, created)
 
         return None
 
     async def notify_commit(
-        self, partition: str, seqid: int, multi: str, kbid: str, uuid: str
+        self,
+        *,
+        partition: str,
+        seqid: int,
+        multi: str,
+        message: BrokerMessage,
+        write_type: Notification.WriteType.Value,  # type: ignore
     ):
-        message = Notification(
+        notification = Notification(
             partition=int(partition),
             seqid=seqid,
             multi=multi,
-            uuid=uuid,
-            kbid=kbid,
-            action=Notification.COMMIT,
+            uuid=message.uuid,
+            kbid=message.kbid,
+            action=Notification.Action.COMMIT,
+            # including the message here again might feel a bit unusual but allows
+            # us to react to these notifications with the original payload
+            write_type=write_type,
+            message=message,
         )
+
         await self.notify(
-            const.PubSubChannels.RESOURCE_NOTIFY.format(kbid=kbid),
-            message.SerializeToString(),
+            const.PubSubChannels.RESOURCE_NOTIFY.format(kbid=message.kbid),
+            notification.SerializeToString(),
         )
 
     async def notify_abort(
-        self, partition: str, seqid: int, multi: str, kbid: str, uuid: str
+        self, *, partition: str, seqid: int, multi: str, kbid: str, rid: str
     ):
         message = Notification(
             partition=int(partition),
             seqid=seqid,
             multi=multi,
-            uuid=uuid,
+            uuid=rid,
             kbid=kbid,
             action=Notification.ABORT,
         )
         await self.notify(
             const.PubSubChannels.RESOURCE_NOTIFY.format(kbid=kbid),
             message.SerializeToString(),
         )
 
     async def notify(self, channel, payload: bytes):
         if self.cache is not None and self.cache.pubsub is not None:
             await self.cache.pubsub.publish(channel, payload)
 
     # KB tools
     # XXX: Why are these utility functions here?
-
     async def get_kb_obj(
         self, txn: Transaction, kbid: KnowledgeBoxID
     ) -> Optional[KnowledgeBox]:
         uuid: Optional[str] = kbid.uuid
         if uuid == "":
             uuid = await KnowledgeBox.get_kb_uuid(txn, kbid.slug)
 
         if uuid is None:
             return None
 
         if not (await KnowledgeBox.exist_kb(txn, uuid)):
             return None
 
         storage = await get_storage()
-        cache = await get_cache()
-        kbobj = KnowledgeBox(txn, storage, cache, uuid)
+        kbobj = KnowledgeBox(txn, storage, uuid)
         return kbobj
 
     async def get_kb(self, slug: str = "", uuid: Optional[str] = "") -> KnowledgeBoxPB:
         txn = await self.driver.begin()
 
         if uuid == "" and slug != "":
             uuid = await KnowledgeBox.get_kb_uuid(txn, slug)
```

## nucliadb/ingest/service/writer.py

```diff
@@ -107,32 +107,30 @@
 from nucliadb.ingest.utils import get_driver
 from nucliadb_protos import writer_pb2_grpc
 from nucliadb_telemetry import errors
 from nucliadb_utils.cache import KB_COUNTER_CACHE
 from nucliadb_utils.keys import KB_SHARDS
 from nucliadb_utils.storages.storage import Storage, StorageField
 from nucliadb_utils.utilities import (
-    get_audit,
     get_cache,
     get_partitioning,
     get_storage,
     get_transaction_utility,
 )
 
 
 class WriterServicer(writer_pb2_grpc.WriterServicer):
     def __init__(self):
         self.partitions = settings.partitions
 
     async def initialize(self):
         storage = await get_storage(service_name=SERVICE_NAME)
-        audit = get_audit()
         driver = await get_driver()
         cache = await get_cache()
-        self.proc = Processor(driver=driver, storage=storage, audit=audit, cache=cache)
+        self.proc = Processor(driver=driver, storage=storage, cache=cache)
 
     async def finalize(self):
         ...
 
     async def GetKnowledgeBox(self, request: KnowledgeBoxID, context=None) -> KnowledgeBox:  # type: ignore
         response: KnowledgeBox = await self.proc.get_kb(
             slug=request.slug, uuid=request.uuid
@@ -172,17 +170,16 @@
         self, request: SetVectorsRequest, context=None
     ) -> SetVectorsResponse:
         response = SetVectorsResponse()
         response.found = True
 
         txn = await self.proc.driver.begin()
         storage = await get_storage(service_name=SERVICE_NAME)
-        cache = await get_cache()
 
-        kbobj = KnowledgeBoxORM(txn, storage, cache, request.kbid)
+        kbobj = KnowledgeBoxORM(txn, storage, request.kbid)
         resobj = ResourceORM(txn, storage, kbobj, request.rid)
 
         field = await resobj.get_field(
             request.field.field, request.field.field_type, load=True
         )
         if field.value is None:
             await txn.abort()
@@ -666,34 +663,32 @@
     async def GetResourceId(  # type: ignore
         self, request: ResourceIdRequest, context=None
     ) -> ResourceIdResponse:
         response = ResourceIdResponse()
         response.uuid = ""
         txn = await self.proc.driver.begin()
         storage = await get_storage(service_name=SERVICE_NAME)
-        cache = await get_cache()
 
-        kbobj = KnowledgeBoxORM(txn, storage, cache, request.kbid)
+        kbobj = KnowledgeBoxORM(txn, storage, request.kbid)
         rid = await kbobj.get_resource_uuid_by_slug(request.slug)
         if rid:
             response.uuid = rid
         await txn.abort()
         return response
 
     async def ResourceFieldExists(  # type: ignore
         self, request: ResourceFieldId, context=None
     ) -> ResourceFieldExistsResponse:
         response = ResourceFieldExistsResponse()
         response.found = False
         resobj = None
         txn = await self.proc.driver.begin()
         storage = await get_storage(service_name=SERVICE_NAME)
-        cache = await get_cache()
 
-        kbobj = KnowledgeBoxORM(txn, storage, cache, request.kbid)
+        kbobj = KnowledgeBoxORM(txn, storage, request.kbid)
         resobj = ResourceORM(txn, storage, kbobj, request.rid)
 
         if request.field != "":
             field = await resobj.get_field(request.field, request.field_type, load=True)
             if field.value is not None:
                 response.found = True
             else:
@@ -720,17 +715,16 @@
 
         await txn.abort()
         return response
 
     async def Index(self, request: IndexResource, context=None) -> IndexStatus:  # type: ignore
         txn = await self.proc.driver.begin()
         storage = await get_storage(service_name=SERVICE_NAME)
-        cache = await get_cache()
 
-        kbobj = KnowledgeBoxORM(txn, storage, cache, request.kbid)
+        kbobj = KnowledgeBoxORM(txn, storage, request.kbid)
         resobj = ResourceORM(txn, storage, kbobj, request.rid)
         bm = await resobj.generate_broker_message()
         transaction = get_transaction_utility()
         partitioning = get_partitioning()
         partition = partitioning.generate_partition(request.kbid, request.rid)
         await transaction.commit(bm, partition)
 
@@ -738,16 +732,15 @@
         await txn.abort()
         return response
 
     async def ReIndex(self, request: IndexResource, context=None) -> IndexStatus:  # type: ignore
         try:
             txn = await self.proc.driver.begin()
             storage = await get_storage(service_name=SERVICE_NAME)
-            cache = await get_cache()
-            kbobj = KnowledgeBoxORM(txn, storage, cache, request.kbid)
+            kbobj = KnowledgeBoxORM(txn, storage, request.kbid)
             resobj = ResourceORM(txn, storage, kbobj, request.rid)
             resobj.disable_vectors = not request.reindex_vectors
 
             brain = await resobj.generate_index_message()
             shard_id = await kbobj.get_resource_shard_id(request.rid)
             shard: Optional[Shard] = None
             node_klass = get_node_klass()
@@ -791,17 +784,16 @@
             await txn.abort()
             raise
 
     async def Export(self, request: ExportRequest, context=None):
         try:
             txn = await self.proc.driver.begin()
             storage = await get_storage(service_name=SERVICE_NAME)
-            cache = await get_cache()
 
-            kbobj = KnowledgeBoxORM(txn, storage, cache, request.kbid)
+            kbobj = KnowledgeBoxORM(txn, storage, request.kbid)
             async for resource in kbobj.iterate_resources():
                 yield await resource.generate_broker_message()
             await txn.abort()
         except Exception:
             logger.exception("Export", stack_info=True)
             raise
```

## nucliadb/ingest/tests/fixtures.py

```diff
@@ -36,27 +36,27 @@
 
 from nucliadb.ingest.consumer import service as consumer_service
 from nucliadb.ingest.maindb.driver import Driver
 from nucliadb.ingest.maindb.local import LocalDriver
 from nucliadb.ingest.maindb.redis import RedisDriver
 from nucliadb.ingest.maindb.tikv import TiKVDriver
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox
-from nucliadb.ingest.orm.node import Node
+from nucliadb.ingest.orm.node import NODES, Node
 from nucliadb.ingest.orm.processor import Processor
 from nucliadb.ingest.service.writer import WriterServicer
 from nucliadb.ingest.settings import DriverConfig, settings
 from nucliadb.ingest.tests.vectors import V1, V2, V3
 from nucliadb_models.cluster import MemberType
 from nucliadb_protos import resources_pb2 as rpb
 from nucliadb_protos import utils_pb2 as upb
 from nucliadb_protos import writer_pb2_grpc
 from nucliadb_utils import const
 from nucliadb_utils.audit.basic import BasicAuditStorage
 from nucliadb_utils.audit.stream import StreamAuditStorage
-from nucliadb_utils.cache.redis import RedisPubsub
+from nucliadb_utils.cache.nats import NatsPubsub
 from nucliadb_utils.cache.settings import settings as cache_settings
 from nucliadb_utils.cache.utility import Cache
 from nucliadb_utils.indexing import IndexingUtility
 from nucliadb_utils.settings import indexing_settings, transaction_settings
 from nucliadb_utils.storages.settings import settings as storage_settings
 from nucliadb_utils.store import MAIN
 from nucliadb_utils.utilities import (
@@ -71,22 +71,22 @@
     stop_transaction_utility,
 )
 
 logger = logging.getLogger(__name__)
 
 
 @pytest.fixture(scope="function")
-async def processor(maindb_driver, gcs_storage, cache, audit):
-    proc = Processor(maindb_driver, gcs_storage, audit, cache, partition="1")
+async def processor(maindb_driver, gcs_storage, cache):
+    proc = Processor(maindb_driver, gcs_storage, cache, partition="1")
     yield proc
 
 
 @pytest.fixture(scope="function")
-async def stream_processor(maindb_driver, gcs_storage, cache, stream_audit):
-    proc = Processor(maindb_driver, gcs_storage, stream_audit, cache, partition="1")
+async def stream_processor(maindb_driver, gcs_storage, cache):
+    proc = Processor(maindb_driver, gcs_storage, cache, partition="1")
     yield proc
 
 
 @pytest.fixture(scope="function")
 async def local_files():
     storage_settings.local_testing_files = f"{dirname(__file__)}"
 
@@ -237,32 +237,37 @@
 async def txn(maindb_driver):
     txn = await maindb_driver.begin()
     yield txn
     await txn.abort()
 
 
 @pytest.fixture(scope="function")
-async def cache(redis):
+async def pubsub(natsd):
     pubsub = get_utility(Utility.PUBSUB)
     if pubsub is None:
-        url = f"redis://{redis[0]}:{redis[1]}"
-        pubsub = RedisPubsub(url)
+        pubsub = NatsPubsub(hosts=[natsd])
         await pubsub.initialize()
         set_utility(Utility.PUBSUB, pubsub)
 
+    yield pubsub
+    await pubsub.finalize()
+    set_utility(Utility.PUBSUB, None)
+
+
+@pytest.fixture(scope="function")
+async def cache(pubsub):
     che = Cache(pubsub)
     await che.initialize()
     yield che
     await che.finalize()
-    await pubsub.finalize()
-    set_utility(Utility.PUBSUB, None)
 
 
 @pytest.fixture(scope="function")
 async def fake_node(_natsd_reset, indexing_utility_ingest):
+    NODES.clear()
     uuid1 = str(uuid.uuid4())
     uuid2 = str(uuid.uuid4())
     await Node.set(
         uuid1,
         address="nohost:9999",
         type=MemberType.IO,
         shard_count=0,
@@ -610,15 +615,15 @@
     return message1
 
 
 async def create_resource(storage, driver: Driver, cache, knowledgebox_ingest: str):
     txn = await driver.begin()
 
     rid = str(uuid.uuid4())
-    kb_obj = KnowledgeBox(txn, storage, cache, kbid=knowledgebox_ingest)
+    kb_obj = KnowledgeBox(txn, storage, kbid=knowledgebox_ingest)
     test_resource = await kb_obj.add_resource(uuid=rid, slug="slug")
     await test_resource.set_slug()
 
     # 1.  ROOT ELEMENTS
     # 1.1 BASIC
 
     basic = rpb.Basic(
```

## nucliadb/ingest/tests/integration/consumer/test_pull.py

```diff
@@ -89,15 +89,14 @@
 @pytest.fixture()
 async def pull_worker(redis_driver, pull_processor_api: PullProcessorAPI):
     worker = PullWorker(
         driver=redis_driver,
         partition="1",
         storage=None,  # type: ignore
         pull_time_error_backoff=5,
-        audit=None,
         pull_time_empty_backoff=0.1,
     )
 
     task = asyncio.create_task(worker.loop())
     yield worker
     task.cancel()
```

## nucliadb/ingest/tests/integration/ingest/test_ingest.py

```diff
@@ -45,27 +45,54 @@
 )
 from nucliadb_protos.resources_pb2 import Metadata as PBMetadata
 from nucliadb_protos.resources_pb2 import Origin, Paragraph
 from nucliadb_protos.utils_pb2 import Vector
 from nucliadb_protos.writer_pb2 import BrokerMessage
 
 from nucliadb.ingest import SERVICE_NAME
+from nucliadb.ingest.consumer.auditing import (
+    IndexAuditHandler,
+    ResourceWritesAuditHandler,
+)
 from nucliadb.ingest.orm.exceptions import DeadletteredError
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox
 from nucliadb.ingest.orm.processor import Processor
 from nucliadb.ingest.orm.resource import Resource
 from nucliadb_utils.audit.stream import StreamAuditStorage
 from nucliadb_utils.storages.storage import Storage
 from nucliadb_utils.utilities import Utility, get_indexing, get_storage, set_utility
 
 EXAMPLE_VECTOR = base64.b64decode(
     "k05VTVBZAQB2AHsnZGVzY3InOiAnPGY0JywgJ2ZvcnRyYW5fb3JkZXInOiBGYWxzZSwgJ3NoYXBlJzogKDc2OCwpLCB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogKIq+lgYUvvf7bTx39oo+fFaXPbx2a71RfiK/FBroPVTawr4UEm2+AgtuvWzTTT5ipjg9JflLvMdfub6fBIE+d7gmvnJPl75alUQ+n68Hv2BYJL20+74+bHDsPV/wTT63h4E9hes9PqxHXT6h/J079HfVPF/7BD3BSMO+PuA9PjJhtD4W6pq+rmwjPp+Fzz6xUfa+FMZtOutIBT4mPik+EbsAPyRePb41IVW+i+0RPT7GtL51USY+GRjRvjWD1z4+wq+9j9kqvmq/074hHBM+kh+ZPoRfmb6R0yi/kuirvlcqLj+Ss64+0cMBP2UKsD2LtpI9927BvtCfHb5KY7U+8s64vkcGX778+NY+2pMxPNowJD7R39u+dbmfPqbrL73bIby+Nbu8voH3kr4gps6+f3L6PuJFAb3PFWA+99BPPjkLzD0vc8m79JmtvWYnbL6W+6A+WUWEveVVED0V0h8+3zPWvv19Dr2igdC9JcGRPV568z41ZVu8mRxRvdkBQr73JHO+PFxkvtHatLzVgN49NEgav0l7ab276hK+ABMDvrRrJj4akbO++zFnPRzXoDyecdi+pGq4viUgiL4XXwK+tvcOPivvgD7PV0w+D7CwPmfoiL0REec+tsx1Pe2xkD6S9Jm+ZW09P1Obiz2Ov/Q+OtsBP8Xicj7WJpi9szGJvqvWvz4hFqG++ZuGvIAmMb0r+T2+wj9RPgZN0z7KwGI+ezogPgI78D6aUrW8etzkPHpSqb7c4Sg+b6BZvXlSrr6un6a8uUCrvhbBgb7PtwA+CsSwvQzyz73G1eq+plYZP/6I7r6BRsu992/gPuIBJj9aT8u94saNvdIDG76Zar4+GeRxvncSZz3citO+ILq6vmS3D78JHk6/NdeIPWYQwb0WZJW9OnwJPhdIQL7Gta6+MZWevpRNvr0ZH/c9B//hPtNUlL1pWhu/VliNvshFjT6laVS9EpjovQBHdb4HWMe+e/rfvrcSDz620/I+krapPlnIDz5uR1Y+znjqPTFM+T1+kK8+VMcevDegSjvM7fw+e0yKPbDoVz56wk4+EeoGvnq3rT76dbW+ghE6vvos0b6CqQu+p6JDPvzn2bogOui+oZU5v6/Pvr4siDI9Kv6Dvt6TQj51LqW+qYLsPmyjZT45DkG9MQivPgIHBT/qeRW/ghXOPkcJtL6MwhA/9F5PvbR7Jr4ftKA+mdkePwm2A77WpNU+Ho/NvsWEfL75zPS9v8ycvtXFVD5ONFI7mVkOPlFd7bzacZK7aSyRPkRrhz6e8+k+glJ5Pq9mmD0X95y+APOjPveVBb9yOgM+DLlMPkqCRb7CKwW8N+TevpZtmD5lbpq+n+tdPr4+m7661Wg+gd66ve5dzr2ZH7k+x/aNPo+0Kz4PMMa+voMGv+ud8r4Nape892YZPWlDL76twQi/RC2QPk8juz1uTwC9yf3rvn8RmD5LO0e+7t5CvvYTbb5O8UA/yrZqO7aZib6FBEe+n/xAv08BGr15Vxs/FNIevkbN1r3f2Hw+oj18PJwOnb3SDpo+wf67vvy3sj6qvRM/BrljPtrlBr4w2Ck9Jh6fPv6Vn75qa7w+eWShvj6bYj56q46+x41KPvQtqb2qXVm+DTmTPpvXWz5hUnC9f7ptPAu1tsDAcUa+ckyGvTeaIz3FcaC9Zu/cvYvjzD7WUdQ+P2DFvrbdHz4CfVe+HxwAP3HZy775Q7w+eg+svcccuTwLBFW+QkVhPuSSjLymH6g+DFBKviDgWz0wxyK+1C+3PSKk975Hkxi8FKzVvRnykD5lFCa/bqnBPRACHL5uUS+/Zb3FvoK66j5CHUu+vq4TvkxWfT5wv7o+wW79PJHsrD42Aau+SuQFvdzUnz50dEe+qZNjvmZ1LLxvt529oeHDPsv3dT5O+z69vOoevm/1Cz5O7NU9i6uHPibkEr6g5d2+LobFPn+KAT/gLsY+2jm4vlpyhD48l4g+yqx3Pql7yr5sIYK+7awLPlnODb+3e7i+t9RVPQC99z6SQJk+lbXoPbyAI7mKcCu/4kX9vFuhtL61fhq+UjGgvYxSvDzCzfw+24xfvs+Sjr782jy+kTzaPmEqtD6sN2c9otXavSqTiT5hM/q+MjAFP4kflT5JOe280NUmvrQtkT4f55m9CyFwPr8GF7wNzBm+x05SvsFJtz0MG9w+HCf/vn4mkr7iMiw+DmhCPUDI/j3PrVe+glX3vlpDPz8ucKG+MexCPgoBDD+FMn68BMDnvCf+UT3bgq4+srqvvYF8H7+1VKq9qbQTvY1tBL8epwC85PUdviSEhD7hg7e9jMUzvVuFz71qCf29IudEPsAwH767q809fL0uvrk+Mr7OTVy9TNcWvhnV3T4hOwq/F/E3P4UOXz4Vade+fK8TP5v4sr4Amf8+HCqPvmYV7Lo3UMK+0urYPrSH3zw/8oq9tAHCvvs5GD91e6w9GsqJPNRo7j5ffH6+X++MvKFQxj17Es6+TA5OvW8tAz8C4nU8tiHDvm5FZL5Kv3O+fuZ0Php/9j0Gyua+mSKVvs+pDT8+TwC/qS8Gvl/z0r5iVLq+a8e/vIXlIT4r7Ty+dqrXPmn9Db4p4PS+Kv0nPfnVUz7avj0+KVOTPkG3Kz68dQa+LSKGvXnRvjxnzyM92moTvy9SnD4F9Dw+mWoyvXpXRD8nm7I9O245P6KlZT4zCxc+baKLPsyE0rw8YHO+coGePfcAYT300Jw+UoeUvlvHFD7CjpC+p9KpvlteKrvgzwG8Sbg2vn8NDz5MDtW99URGvoaaxb0svk+9+cajvUvAab1qXpS91FSbvszYlj6f9oI+Ge5yPDdVxr45qV2+WmuxPcx+qj5l88W9ApSIvsFrwT4GT8c+Vg/0PjkNT745ezC/9ogqPm7bE7/Wh1O9b7NrvlVU/j4u3ga9mv+xvaHTtD76O40+LIyTvssUDT73Q5y+QO5TvX7bgj3gY5S+YTSfvpYeIL6a+Y29CLmZvda6xz6cC9Q+9sQSPwnG+j3RS927zvaAvq7iLz0CqPw9Fir+vNr7VT5qEgM+yhqtupy5q76uVtE7eZ+Nvi/7h75rkLq9vOW0O7QhFj7JCbc+3tp7vlpEOT9+aPc+hwnnvkqLPr0Ry/4+8zOaPfE0O70OJ6I9eQlJvbAU/T0KcaK8gS2Kvulxdj0u2JY+u4mxPN4vXj7B6xQ+LjBLvuTgJ77vq7M7KbcIvnbIdD0UQd++ZyuHvlaAPr4SeMw++sRuvZ7sXz3yJ5O9cSmPvZ8mRL7X2JM9trN4PpzLt70C3Og94uwLv4pACb8LWoY9Uz+ZPvE1Ij4R8HG9JVyJvvFOZz6XkIU+had5PvoQKT7h3CK+IzATv1U3qrxUum68B1bDviBzhz7u5XI9KXwkPoszXr6en5I9VNxMPAKusT5XGTg8Ne9GvC6yBz/EidM+V8T8u3LO1D7qSJa+AlsUPeb9pb0vNFK+lFCevTGrR70aeSu+zihyvOLan77CaxE/5ZnaPUv8Nr/hBhs+oCZBPttGqr5ZrwO+O0DGPU7JOD7FxdK+pw6CPWumgz6VB7++Gjb1vq6Ns7uZ1FI9VmTLPsl2iz7h5YI8CJYXvh6MSz6ucvc9qx1bPovgpT7ZWyO+Z+d1vrXkrz3VC8s+dmievuxuHb7MOXE+ewUCvJcPuT6n2Rc8mQyYvl45Gr1ER3c9LCZYvmqQhb1lVJu+V1acPZp63z5Cfmu+4NFZPvmBJb6cmAI+J0U7PsLkSb16KrO9wj4JPo4Fq7563+09jAw8vkYbbD7/Z5q7TH1kvnJrLb1mqkS+R+a9vX0ODD4p9ak+un8VO6mSp71C66w+FlLVPr/0Wb0eLR2+AneHvVTFHD/P0X0+TsQ4vlWQQzzP8no6VtEOPHLiG78Foyg+Un5OP/fFeL3uVxc+C1VzP9IInL2Zbbo8bw2Lvt5f0b4LY9w9LyaMvIcBc70K3bs+9lz5vTSTC7770MG+B4dHvvRFSz3lO6w9ENACv5NLBz20vSk+MuMQPLQYZr/2+6o+gzANvXGTjL259Qy9ZUMKPnyCC7498ww8oGGSvouNujyvJVW+TjmIvvI8KT667mq9MC6fvVUcvz0="  # noqa
 )
 
 
+@pytest.fixture(autouse=True)
+async def audit_consumers(
+    maindb_driver, gcs_storage, cache, stream_audit: StreamAuditStorage
+):
+    index_auditor = IndexAuditHandler(
+        driver=maindb_driver,
+        audit=stream_audit,
+        pubsub=cache.pubsub,
+    )
+    resource_writes_auditor = ResourceWritesAuditHandler(
+        driver=maindb_driver,
+        storage=gcs_storage,
+        audit=stream_audit,
+        pubsub=cache.pubsub,
+    )
+
+    await index_auditor.initialize()
+    await resource_writes_auditor.initialize()
+    yield
+    await index_auditor.finalize()
+    await resource_writes_auditor.finalize()
+
+
 @pytest.fixture()
 def kbid(
     local_files,
     gcs_storage: Storage,
     txn,
     cache,
     fake_node,
@@ -193,15 +220,15 @@
     message1: BrokerMessage = BrokerMessage()
     message1.ParseFromString(data)
     message1.kbid = kbid
     message1.ClearField("field_vectors")
     message1.source = BrokerMessage.MessageSource.WRITER
     await processor.process(message=message1, seqid=2)
 
-    kb_obj = KnowledgeBox(txn, gcs_storage, cache, kbid=kbid)
+    kb_obj = KnowledgeBox(txn, gcs_storage, kbid=kbid)
     r = await kb_obj.get(message1.uuid)
     assert r is not None
     field_obj = await r.get_field("wikipedia_ml", TEXT)
     ext1 = await field_obj.get_extracted_text()
     lfm1 = await field_obj.get_large_field_metadata()
     fm1 = await field_obj.get_field_metadata()
     basic = await r.get_basic()
@@ -233,15 +260,15 @@
         slug="slug1",
         type=BrokerMessage.AUTOCOMMIT,
     )
     message1.source = BrokerMessage.MessageSource.WRITER
     await processor.process(message=message1, seqid=1)
 
     storage = await get_storage(service_name=SERVICE_NAME)
-    kb = KnowledgeBox(txn, storage, None, knowledgebox_ingest)
+    kb = KnowledgeBox(txn, storage, knowledgebox_ingest)
     res = Resource(txn, storage, kb, rid)
     origin = await res.get_origin()
 
     # should not be set
     assert origin is None
 
     # now set the origin
@@ -251,15 +278,15 @@
             filename="file.png",
             url="http://www.google.com",
         )
     )
     await processor.process(message=message1, seqid=2)
 
     await txn.abort()  # force clearing txn cache from last pull
-    kb = KnowledgeBox(txn, storage, None, knowledgebox_ingest)
+    kb = KnowledgeBox(txn, storage, knowledgebox_ingest)
     res = Resource(txn, storage, kb, rid)
     origin = await res.get_origin()
 
     assert origin is not None
     assert origin.url == "http://www.google.com"
     assert origin.source == Origin.Source.API
     assert origin.filename == "file.png"
@@ -364,37 +391,30 @@
 
     auditreq = await get_audit_messages(psub)
 
     # Minimal assert to make sure we get the information from the node on the audit
     # gets from the sidecar to the audit report when adding or modifying a resource
     # The values are hardcoded on nucliadb/nucliadb/ingest/orm/grpc_node_dummy.py
 
-    assert auditreq.counter.paragraphs == 2
-    assert auditreq.counter.fields == 2
-    assert auditreq.counter.shard != ""
-
     assert auditreq.kbid == knowledgebox_ingest
     assert auditreq.rid == rid
     assert auditreq.type == AuditRequest.AuditType.NEW
 
     try:
         int(auditreq.trace_id)
     except ValueError:
         assert False, "Invalid trace ID"
 
     audit_by_fieldid = {audit.field_id: audit for audit in auditreq.fields_audit}
-    assert audit_by_fieldid["file_1"].action == AuditField.FieldAction.ADDED
+    assert audit_by_fieldid["file_1"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["file_1"].size == test_png_size
-    assert audit_by_fieldid["file_1"].size_delta == test_png_size
-    assert audit_by_fieldid["file_2"].action == AuditField.FieldAction.ADDED
+    assert audit_by_fieldid["file_2"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["file_2"].size == test_text_size
-    assert audit_by_fieldid["file_2"].size_delta == test_text_size
-    assert audit_by_fieldid["file_3"].action == AuditField.FieldAction.ADDED
+    assert audit_by_fieldid["file_3"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["file_3"].size == test_vectors_size
-    assert audit_by_fieldid["file_3"].size_delta == test_vectors_size
 
     #
     # Test 2: delete one of the previous field on the same resource
     #
 
     message.files.clear()
     fieldid = FieldID(field="file_1", field_type=FieldType.FILE)
@@ -403,31 +423,18 @@
     await stream_processor.process(message=message, seqid=2)
     auditreq = await get_audit_messages(psub)
 
     # Minimal assert to make sure we get the information from the node on the audit
     # gets from the sidecar to the audit report when adding or modifying a resource
     # The values are hardcoded on nucliadb/nucliadb/ingest/orm/grpc_node_dummy.py
 
-    assert auditreq.counter.paragraphs == 2
-    assert auditreq.counter.fields == 2
-    assert auditreq.counter.shard != ""
-
     assert auditreq.kbid == knowledgebox_ingest
     assert auditreq.rid == rid
     assert auditreq.type == AuditRequest.AuditType.MODIFIED
 
-    try:
-        int(auditreq.trace_id)
-    except ValueError:
-        assert False, "Invalid trace ID"
-
-    assert auditreq.fields_audit[0].action == AuditField.FieldAction.DELETED
-    assert auditreq.fields_audit[0].size == 0
-    assert auditreq.fields_audit[0].size_delta == -test_png_size
-
     #
     # Test 3: modify a file while adding and deleting other files
     #
 
     message = make_message(knowledgebox_ingest, rid)
     add_filefields(message, [("file_2", "file.png"), ("file_4", "text.pb")])
     fieldid = FieldID(field="file_3", field_type=FieldType.FILE)
@@ -436,53 +443,37 @@
     await stream_processor.process(message=message, seqid=3)
     auditreq = await get_audit_messages(psub)
 
     # Minimal assert to make sure we get the information from the node on the audit
     # gets from the sidecar to the audit report when adding or modifying a resource
     # The values are hardcoded on nucliadb/nucliadb/ingest/orm/grpc_node_dummy.py
 
-    assert auditreq.counter.paragraphs == 2
-    assert auditreq.counter.fields == 2
-    assert auditreq.counter.shard != ""
-
     assert auditreq.kbid == knowledgebox_ingest
     assert auditreq.rid == rid
     assert auditreq.type == AuditRequest.AuditType.MODIFIED
 
     audit_by_fieldid = {audit.field_id: audit for audit in auditreq.fields_audit}
     assert audit_by_fieldid["file_2"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["file_2"].size == test_png_size
-    assert audit_by_fieldid["file_2"].size_delta == test_text_size - test_png_size
-    assert audit_by_fieldid["file_4"].action == AuditField.FieldAction.ADDED
+    assert audit_by_fieldid["file_4"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["file_4"].size == test_text_size
-    assert audit_by_fieldid["file_4"].size_delta == test_text_size
     assert audit_by_fieldid["file_3"].action == AuditField.FieldAction.DELETED
     assert audit_by_fieldid["file_3"].size == 0
-    assert audit_by_fieldid["file_3"].size_delta == -test_vectors_size
 
     #
     # Test 4: delete resource
     #
 
     message = make_message(
         knowledgebox_ingest, rid, message_type=BrokerMessage.MessageType.DELETE
     )
     await stream_processor.process(message=message, seqid=4)
     auditreq = await get_audit_messages(psub)
 
-    # Currently where not updating audit counters on delete operations
-    assert not auditreq.HasField("counter")
-
-    audit_by_fieldid = {audit.field_id: audit for audit in auditreq.fields_audit}
-    assert audit_by_fieldid["file_2"].action == AuditField.FieldAction.DELETED
-    assert audit_by_fieldid["file_2"].size == 0
-    assert audit_by_fieldid["file_2"].size_delta == -test_png_size
-    assert audit_by_fieldid["file_4"].action == AuditField.FieldAction.DELETED
-    assert audit_by_fieldid["file_4"].size == 0
-    assert audit_by_fieldid["file_4"].size_delta == -test_text_size
+    assert auditreq.type == AuditRequest.AuditType.DELETED
 
     # Test 5: Delete knowledgebox
 
     txn = await redis_driver.begin()
     kb = await KnowledgeBox.get_kb(txn, knowledgebox_ingest)
 
     set_utility(Utility.AUDIT, stream_audit)
@@ -550,59 +541,33 @@
 
     auditreq = await get_audit_messages(psub)
 
     # Minimal assert to make sure we get the information from the node on the audit
     # gets from the sidecar to the audit report when adding or modifying a resource
     # The values are hardcoded on nucliadb/nucliadb/ingest/orm/grpc_node_dummy.py
 
-    assert auditreq.counter.paragraphs == 2
-    assert auditreq.counter.fields == 2
-    assert auditreq.counter.shard != ""
-
     assert auditreq.kbid == kbid
     assert auditreq.rid == rid
     assert auditreq.type == AuditRequest.AuditType.MODIFIED
 
-    assert len(auditreq.fields_audit) == 3
+    assert len(auditreq.fields_audit) == 4
     audit_by_fieldid = {audit.field_id: audit for audit in auditreq.fields_audit}
-    assert audit_by_fieldid["file_1"].action == AuditField.FieldAction.ADDED
+    assert audit_by_fieldid["file_1"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["text1"].action == AuditField.FieldAction.MODIFIED
     assert audit_by_fieldid["conv1"].action == AuditField.FieldAction.DELETED
 
     #
     # Test 2: delete resource
     #
 
     message = make_message(kbid, rid, message_type=BrokerMessage.MessageType.DELETE)
     await stream_processor.process(message=message, seqid=2)
     auditreq = await get_audit_messages(psub)
 
-    # Currently where not updating audit counters on delete operations
-    assert not auditreq.HasField("counter")
-
-    try:
-        int(auditreq.trace_id)
-    except ValueError:
-        assert False, "Invalid trace ID"
-
-    # We know what should be in the resource and all must me delete actions
-    audit_actions_by_fieldid = {
-        audit.field_id: audit.action for audit in auditreq.fields_audit
-    }
-
-    assert set(audit_actions_by_fieldid.keys()) == {
-        "text1",
-        "datetime1",
-        "layout1",
-        "link1",
-        "keywordset1",
-        "file1",
-        "file_1",
-    }
-    assert set(audit_actions_by_fieldid.values()) == {AuditField.FieldAction.DELETED}
+    assert auditreq.type == AuditRequest.AuditType.DELETED
 
     await txn.abort()
 
     await client.drain()
     await client.close()
 
 
@@ -621,15 +586,15 @@
     rid = test_resource.uuid
 
     message = make_message(kbid, rid)
     message.account_seq = 2
     add_filefields(message, [("file_1", "file.png")])
     await stream_processor.process(message=message, seqid=1)
 
-    kb_obj = KnowledgeBox(txn, gcs_storage, cache, kbid=kbid)
+    kb_obj = KnowledgeBox(txn, gcs_storage, kbid=kbid)
     r = await kb_obj.get(message.uuid)
     assert r is not None
 
     basic = await r.get_basic()
     assert basic is not None
     assert basic.last_account_seq == 2
     assert basic.queue == 0
@@ -672,12 +637,12 @@
     with patch.object(processor, "notify_commit") as mock_notify, pytest.raises(
         DeadletteredError
     ):
         # cause an error to force deadletter handling
         mock_notify.side_effect = Exception("test")
         await processor.process(message=message, seqid=1)
 
-    kb_obj = KnowledgeBox(txn, gcs_storage, cache, kbid=kbid)
+    kb_obj = KnowledgeBox(txn, gcs_storage, kbid=kbid)
     resource = await kb_obj.get(message.uuid)
 
     mock_notify.assert_called_once()
     assert resource.basic.metadata.status == PBMetadata.Status.ERROR  # type: ignore
```

## nucliadb/ingest/tests/unit/orm/test_cluster.py

```diff
@@ -46,20 +46,20 @@
     assert len(nodes_found) == settings.node_replicas
     assert nodes_found == ["node-0", "node-30"]
 
 
 def test_find_nodes_exclude_nodes(nodes):
     cluster = orm.ClusterObject()
     excluded_node = "node-0"
-    nodes_found = cluster.find_nodes(exclude_nodes=[excluded_node])
+    nodes_found = cluster.find_nodes(avoid_nodes=[excluded_node])
     assert nodes_found == ["node-30", "node-40"]
 
-    with pytest.raises(NodeClusterSmall):
-        all_nodes = list(nodes.keys())
-        cluster.find_nodes(exclude_nodes=all_nodes)
+    # even if all are used, still should find nodes
+    all_nodes = list(nodes.keys())
+    assert cluster.find_nodes(avoid_nodes=all_nodes) == ["node-0", "node-30"]
 
 
 def test_find_nodes_raises_error_if_not_enough_nodes_are_found(nodes):
     cluster = orm.ClusterObject()
 
     prev = settings.node_replicas
     settings.node_replicas = 200
```

## nucliadb/ingest/tests/unit/orm/test_node.py

```diff
@@ -93,19 +93,14 @@
     kb_shards = await get_kb_shards(txn, kbid)
     assert len(kb_shards.shards) == 2
     assert kb_shards.actual == 1
     assert len(kb_shards.shards[1].replicas) == 1
     # New shard has been created in a different node
     assert kb_shards.shards[1].replicas[0].node != node
 
-    # Attempting to create another shard should fail
-    # because we don't have sufficient nodes
-    with pytest.raises(NodeClusterSmall):
-        await Node.create_shard_by_kbid(txn, kbid)
-
 
 @pytest.mark.asyncio
 async def test_create_shard_by_kbid_insufficient_nodes(txn):
     with pytest.raises(NodeClusterSmall):
         await Node.create_shard_by_kbid(txn, "foo")
```

## nucliadb/reader/api/v1/resource.py

```diff
@@ -48,15 +48,15 @@
     ResourceList,
     ResourcePagination,
 )
 from nucliadb_models.search import ResourceProperties
 from nucliadb_protos import resources_pb2
 from nucliadb_telemetry import errors
 from nucliadb_utils.authentication import requires, requires_one
-from nucliadb_utils.utilities import get_audit, get_cache, get_storage
+from nucliadb_utils.utilities import get_audit, get_storage
 
 
 @api.get(
     f"/{KB_PREFIX}/{{kbid}}/resources",
     status_code=200,
     description="List of resources of a knowledgebox",
     tags=["Resources"],
@@ -228,22 +228,21 @@
             ExtractedDataTypeName.LINK,
             ExtractedDataTypeName.FILE,
         ]
     ),
     page: Union[Literal["last", "first"], int] = Query("last"),
 ) -> Response:
     storage = await get_storage(service_name=SERVICE_NAME)
-    cache = await get_cache()
     driver = await get_driver()
 
     txn = await driver.begin()
 
     pb_field_id = FIELD_NAMES_TO_PB_TYPE_MAP[field_type]
 
-    kb = ORMKnowledgeBox(txn, storage, cache, kbid)
+    kb = ORMKnowledgeBox(txn, storage, kbid)
 
     if rid is None:
         assert rslug is not None, "Either rid or rslug must be defined"
         rid = await kb.get_resource_uuid_by_slug(rslug)
         if rid is None:
             await txn.abort()
             raise HTTPException(status_code=404, detail="Resource does not exist")
```

## nucliadb/search/lifecycle.py

```diff
@@ -25,31 +25,29 @@
 from nucliadb.search.predict import start_predict_engine
 from nucliadb.search.search import paragraphs
 from nucliadb_telemetry.utils import clean_telemetry, setup_telemetry
 from nucliadb_utils.utilities import (
     Utility,
     clean_utility,
     finalize_utilities,
-    get_cache,
     get_utility,
     set_utility,
     start_audit_utility,
     stop_audit_utility,
 )
 
 
 async def initialize() -> None:
     await setup_telemetry(SERVICE_NAME)
 
     await start_ingest(SERVICE_NAME)
     await start_predict_engine()
 
     driver = await get_driver()
-    cache = await get_cache()
-    set_utility(Utility.NODES, NodesManager(driver=driver, cache=cache))
+    set_utility(Utility.NODES, NodesManager(driver=driver))
     await start_chitchat(SERVICE_NAME)
 
     await paragraphs.initialize_cache()
 
     await start_audit_utility(SERVICE_NAME)
```

## nucliadb/search/search/cache.py

```diff
@@ -23,15 +23,15 @@
 
 from lru import LRU  # type: ignore
 
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox as KnowledgeBoxORM
 from nucliadb.ingest.orm.resource import Resource as ResourceORM
 from nucliadb.ingest.txn_utils import get_transaction
 from nucliadb.search import SERVICE_NAME
-from nucliadb_utils.utilities import get_cache, get_storage
+from nucliadb_utils.utilities import get_storage
 
 rcache: ContextVar[Optional[Dict[str, ResourceORM]]] = ContextVar(
     "rcache", default=None
 )
 
 
 RESOURCE_LOCKS: Dict[str, asyncio.Lock] = LRU(1000)
@@ -53,16 +53,15 @@
     if uuid not in RESOURCE_LOCKS:
         RESOURCE_LOCKS[uuid] = asyncio.Lock()
 
     async with RESOURCE_LOCKS[uuid]:
         if uuid not in resource_cache:
             transaction = await get_transaction()
             storage = await get_storage(service_name=SERVICE_NAME)
-            cache = await get_cache()
-            kb = KnowledgeBoxORM(transaction, storage, cache, kbid)
+            kb = KnowledgeBoxORM(transaction, storage, kbid)
             orm_resource = await kb.get(uuid)
 
         if orm_resource is not None:
             resource_cache[uuid] = orm_resource
         else:
             orm_resource = resource_cache.get(uuid)
```

## nucliadb/tests/test_search.py

```diff
@@ -28,22 +28,30 @@
 from nats.aio.client import Client
 from nats.js import JetStreamContext
 from nucliadb_protos.audit_pb2 import AuditRequest, ClientType
 from nucliadb_protos.utils_pb2 import RelationNode
 from nucliadb_protos.writer_pb2 import BrokerMessage
 from nucliadb_protos.writer_pb2_grpc import WriterStub
 
+from nucliadb.ingest.consumer import shard_creator
 from nucliadb.ingest.settings import settings as ingest_settings
 from nucliadb.ingest.tests.vectors import V1
+from nucliadb.ingest.utils import get_driver
 from nucliadb.search.predict import PredictVectorMissing, SendToPredictError
 from nucliadb.search.search.query import pre_process_query
 from nucliadb.tests.utils import broker_resource, inject_message
 from nucliadb_protos import resources_pb2 as rpb
 from nucliadb_utils.audit.stream import StreamAuditStorage
-from nucliadb_utils.utilities import Utility, clean_utility, get_audit, set_utility
+from nucliadb_utils.utilities import (
+    Utility,
+    clean_utility,
+    get_audit,
+    get_storage,
+    set_utility,
+)
 
 
 @pytest.mark.asyncio
 async def test_simple_search_sc_2062(
     nucliadb_reader: AsyncClient,
     nucliadb_writer: AsyncClient,
     nucliadb_grpc: WriterStub,
@@ -1215,23 +1223,23 @@
             },
         )
         assert resp.status_code == 200
         predict_mock.detect_entities.assert_awaited_once()
 
 
 async def create_dummy_resources(
-    nucliadb_writer: AsyncClient, nucliadb_grpc: WriterStub, kbid, n=10
+    nucliadb_writer: AsyncClient, nucliadb_grpc: WriterStub, kbid, n=10, start=0
 ):
     payloads = [
         {
             "slug": f"dummy-resource-{i}",
             "title": f"Dummy resource {i}",
             "summary": f"Dummy resource {i} summary",
         }
-        for i in range(n)
+        for i in range(start, n)
     ]
     for payload in payloads:
         resp = await nucliadb_writer.post(
             f"/kb/{kbid}/resources",
             headers={"X-Synchronous": "true"},
             json=payload,
         )
@@ -1299,19 +1307,27 @@
 @pytest.fixture(scope="function")
 async def kb_with_two_logic_shards(
     max_shard_fields,
     nucliadb_manager: AsyncClient,
     nucliadb_writer: AsyncClient,
     nucliadb_grpc: WriterStub,
 ):
+    sc = shard_creator.ShardCreatorHandler(
+        driver=await get_driver(), storage=await get_storage(), pubsub=None  # type: ignore
+    )
     resp = await nucliadb_manager.post("/kbs", json={})
     assert resp.status_code == 201
     kbid = resp.json().get("uuid")
 
-    await create_dummy_resources(nucliadb_writer, nucliadb_grpc, kbid, n=10)
+    await create_dummy_resources(nucliadb_writer, nucliadb_grpc, kbid, n=8)
+
+    # trigger creating new shard manually here
+    await sc.process_kb(kbid)
+
+    await create_dummy_resources(nucliadb_writer, nucliadb_grpc, kbid, n=10, start=8)
 
     yield kbid
 
     resp = await nucliadb_manager.delete(f"/kb/{kbid}")
     assert resp.status_code == 200
```

## nucliadb/train/nodes.py

```diff
@@ -35,24 +35,22 @@
 
 from nucliadb.ingest.maindb.driver import Driver, Transaction
 from nucliadb.ingest.orm import NODE_CLUSTER, NODES
 from nucliadb.ingest.orm.entities import EntitiesManager
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox
 from nucliadb.ingest.orm.node import Node
 from nucliadb.ingest.orm.resource import KB_RESOURCE_SLUG_BASE
-from nucliadb_utils.cache.utility import Cache
 from nucliadb_utils.exceptions import ShardsNotFound
 from nucliadb_utils.keys import KB_SHARDS
 from nucliadb_utils.storages.storage import Storage
 
 
 class TrainNodesManager:
-    def __init__(self, driver: Driver, cache: Cache, storage: Storage):
+    def __init__(self, driver: Driver, storage: Storage):
         self.driver = driver
-        self.cache = cache
         self.storage = storage
 
     async def get_reader(self, kbid: str, shard: str) -> Tuple[Node, str]:
         shards = await self.get_shards_by_kbid_inner(kbid)
         try:
             shard_object: ShardObject = next(
                 filter(lambda x: x.shard == shard, shards.shards)
@@ -133,15 +131,15 @@
     async def get_kb_obj(self, txn: Transaction, kbid: str) -> Optional[KnowledgeBox]:
         if kbid is None:
             return None
 
         if not (await KnowledgeBox.exist_kb(txn, kbid)):
             return None
 
-        kbobj = KnowledgeBox(txn, self.storage, self.cache, kbid)
+        kbobj = KnowledgeBox(txn, self.storage, kbid)
         return kbobj
 
     async def get_kb_entities_manager(
         self, txn: Transaction, kbid: str
     ) -> Optional[EntitiesManager]:
         kbobj = await self.get_kb_obj(txn, kbid)
         if kbobj is None:
@@ -150,15 +148,15 @@
         manager = EntitiesManager(kbobj, txn)
         return manager
 
     async def kb_sentences(
         self, request: GetSentencesRequest
     ) -> AsyncIterator[TrainSentence]:
         txn = await self.driver.begin()
-        kb = KnowledgeBox(txn, self.storage, self.cache, request.kb.uuid)
+        kb = KnowledgeBox(txn, self.storage, request.kb.uuid)
         if request.uuid != "":
             # Filter by uuid
             resource = await kb.get(request.uuid)
             if resource:
                 async for sentence in resource.iterate_sentences(request.metadata):
                     yield sentence
         else:
@@ -167,30 +165,30 @@
                     yield sentence
         await txn.abort()
 
     async def kb_paragraphs(
         self, request: GetParagraphsRequest
     ) -> AsyncIterator[TrainParagraph]:
         txn = await self.driver.begin()
-        kb = KnowledgeBox(txn, self.storage, self.cache, request.kb.uuid)
+        kb = KnowledgeBox(txn, self.storage, request.kb.uuid)
         if request.uuid != "":
             # Filter by uuid
             resource = await kb.get(request.uuid)
             if resource:
                 async for paragraph in resource.iterate_paragraphs(request.metadata):
                     yield paragraph
         else:
             async for resource in kb.iterate_resources():
                 async for paragraph in resource.iterate_paragraphs(request.metadata):
                     yield paragraph
         await txn.abort()
 
     async def kb_fields(self, request: GetFieldsRequest) -> AsyncIterator[TrainField]:
         txn = await self.driver.begin()
-        kb = KnowledgeBox(txn, self.storage, self.cache, request.kb.uuid)
+        kb = KnowledgeBox(txn, self.storage, request.kb.uuid)
         if request.uuid != "":
             # Filter by uuid
             resource = await kb.get(request.uuid)
             if resource:
                 async for field in resource.iterate_fields(request.metadata):
                     yield field
         else:
@@ -199,15 +197,15 @@
                     yield field
         await txn.abort()
 
     async def kb_resources(
         self, request: GetResourcesRequest
     ) -> AsyncIterator[TrainResource]:
         txn = await self.driver.begin()
-        kb = KnowledgeBox(txn, self.storage, self.cache, request.kb.uuid)
+        kb = KnowledgeBox(txn, self.storage, request.kb.uuid)
         base = KB_RESOURCE_SLUG_BASE.format(kbid=request.kb.uuid)
         async for key in txn.keys(match=base, count=-1):
             # Fetch and Add wanted item
             rid = await txn.get(key)
             if rid is not None:
                 resource = await kb.get(rid.decode())
                 if resource is not None:
```

## nucliadb/train/uploader.py

```diff
@@ -37,24 +37,23 @@
 
 from nucliadb.ingest.orm.entities import EntitiesManager
 from nucliadb.ingest.orm.processor import Processor
 from nucliadb.ingest.utils import get_driver
 from nucliadb.train import SERVICE_NAME
 from nucliadb.train.models import RequestData
 from nucliadb.train.settings import settings
-from nucliadb_utils.utilities import get_audit, get_cache, get_storage
+from nucliadb_utils.utilities import get_cache, get_storage
 
 
 class UploadServicer:
     async def initialize(self):
         storage = await get_storage(service_name=SERVICE_NAME)
-        audit = get_audit()
         driver = await get_driver()
         cache = await get_cache()
-        self.proc = Processor(driver=driver, storage=storage, audit=audit, cache=cache)
+        self.proc = Processor(driver=driver, storage=storage, cache=cache)
 
     async def finalize(self):
         ...
 
     async def GetSentences(self, request: GetSentencesRequest, context=None):
         async for sentence in self.proc.kb_sentences(request):
             yield sentence
```

## nucliadb/train/utils.py

```diff
@@ -27,15 +27,14 @@
 from nucliadb.train.settings import settings
 from nucliadb_protos import train_pb2_grpc
 from nucliadb_telemetry.utils import setup_telemetry
 from nucliadb_utils.grpc import get_traced_grpc_server
 from nucliadb_utils.utilities import (
     Utility,
     clean_utility,
-    get_cache,
     get_storage,
     get_utility,
     set_utility,
 )
 
 
 async def start_train_grpc(service_name: Optional[str] = None):
@@ -71,19 +70,16 @@
         util = get_utility(Utility.TRAIN)
         await util.finalize()
         clean_utility(Utility.TRAIN)
 
 
 async def start_nodes_manager():
     driver = await get_driver()
-    cache = await get_cache()
     storage = await get_storage()
-    set_utility(
-        Utility.NODES, TrainNodesManager(driver=driver, cache=cache, storage=storage)
-    )
+    set_utility(Utility.NODES, TrainNodesManager(driver=driver, storage=storage))
 
 
 async def stop_nodes_manager():
     if get_utility(Utility.NODES):
         clean_utility(Utility.NODES)
```

## nucliadb/train/generators/utils.py

```diff
@@ -21,15 +21,15 @@
 from contextvars import ContextVar
 from typing import Dict, Optional
 
 from nucliadb.ingest.orm.knowledgebox import KnowledgeBox as KnowledgeBoxORM
 from nucliadb.ingest.orm.resource import Resource as ResourceORM
 from nucliadb.ingest.txn_utils import get_transaction
 from nucliadb.train import SERVICE_NAME
-from nucliadb_utils.utilities import get_cache, get_storage
+from nucliadb_utils.utilities import get_storage
 
 rcache: ContextVar[Optional[Dict[str, ResourceORM]]] = ContextVar(
     "rcache", default=None
 )
 
 
 def get_resource_cache(clear: bool = False) -> Dict[str, ResourceORM]:
@@ -42,15 +42,14 @@
 
 async def get_resource_from_cache(kbid: str, uuid: str) -> Optional[ResourceORM]:
     resouce_cache = get_resource_cache()
     orm_resource: Optional[ResourceORM] = None
     if uuid not in resouce_cache:
         transaction = await get_transaction()
         storage = await get_storage(service_name=SERVICE_NAME)
-        cache = await get_cache()
-        kb = KnowledgeBoxORM(transaction, storage, cache, kbid)
+        kb = KnowledgeBoxORM(transaction, storage, kbid)
         orm_resource = await kb.get(uuid)
         if orm_resource is not None:
             resouce_cache[uuid] = orm_resource
     else:
         orm_resource = resouce_cache.get(uuid)
     return orm_resource
```

## nucliadb/train/tests/fixtures.py

```diff
@@ -211,15 +211,15 @@
             break
         print(f"got {count}, retrying")
         await asyncio.sleep(2)
 
     # Add entities
     storage = await get_storage()
     txn = await driver.begin()
-    kb = KnowledgeBox(txn, storage, kbid=knowledgebox_ingest, cache=None)
+    kb = KnowledgeBox(txn, storage, kbid=knowledgebox_ingest)
     entities_manager = EntitiesManager(kb, txn)
     entities = EntitiesGroup()
     entities.entities["entity1"].value = "PERSON"
     await entities_manager.set_entities_group_force("group1", entities)
 
     # Add ontology
     labelset = LabelSet()
```

## nucliadb/writer/api/v1/field.py

```diff
@@ -48,15 +48,14 @@
 from nucliadb.writer.utilities import get_processing
 from nucliadb_models.resource import NucliaDBRoles
 from nucliadb_models.writer import ResourceFieldAdded, ResourceUpdated
 from nucliadb_telemetry.utils import set_info_on_span
 from nucliadb_utils.authentication import requires
 from nucliadb_utils.exceptions import LimitsExceededError, SendToProcessError
 from nucliadb_utils.utilities import (
-    get_cache,
     get_partitioning,
     get_storage,
     get_transaction_utility,
 )
 
 if TYPE_CHECKING:  # pragma: no cover
     SKIP_STORE_DEFAULT = False
@@ -630,19 +629,18 @@
     toprocess.kbid = kbid
     toprocess.uuid = rid
     toprocess.source = Source.HTTP
 
     set_info_on_span({"nuclia.rid": rid, "nuclia.kbid": kbid})
 
     storage = await get_storage(service_name=SERVICE_NAME)
-    cache = await get_cache()
     driver = await get_driver()
 
     async with driver.transaction() as txn:
-        kb = KnowledgeBox(txn, storage, cache, kbid)
+        kb = KnowledgeBox(txn, storage, kbid)
 
         resource = await kb.get(rid)
         if resource is None:
             raise HTTPException(status_code=404, detail="Resource does not exist")
 
         try:
             await extract_file_field(
```

## nucliadb/writer/api/v1/resource.py

```diff
@@ -73,15 +73,14 @@
     ResourceUpdated,
     UpdateResourcePayload,
 )
 from nucliadb_telemetry.utils import set_info_on_span
 from nucliadb_utils.authentication import requires
 from nucliadb_utils.exceptions import LimitsExceededError, SendToProcessError
 from nucliadb_utils.utilities import (
-    get_cache,
     get_ingest,
     get_partitioning,
     get_storage,
     get_transaction_utility,
 )
 
 if TYPE_CHECKING:  # pragma: no cover
@@ -334,19 +333,18 @@
     toprocess.kbid = kbid
     toprocess.uuid = rid
     toprocess.source = Source.HTTP
 
     set_info_on_span({"nuclia.rid": rid, "nuclia.kbid": kbid})
 
     storage = await get_storage(service_name=SERVICE_NAME)
-    cache = await get_cache()
     driver = await get_driver()
 
     txn = await driver.begin()
-    kb = KnowledgeBox(txn, storage, cache, kbid)
+    kb = KnowledgeBox(txn, storage, kbid)
 
     resource = await kb.get(rid)
     if resource is None:
         raise HTTPException(status_code=404, detail="Resource does not exist")
 
     await extract_fields(resource=resource, toprocess=toprocess)
```

## Comparing `nucliadb-2.8.5.post257.dist-info/METADATA` & `nucliadb-2.9.0.post258.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: nucliadb
-Version: 2.8.5.post257
+Version: 2.9.0.post258
 Summary: UNKNOWN
 Home-page: https://nucliadb.com
 Author: NucliaDB Community
 Author-email: nucliadb@nuclia.com
 License: BSD
 Project-URL: Nuclia, https://nuclia.com
 Project-URL: Github, https://github.com/nuclia/nucliadb
@@ -54,17 +54,17 @@
 Requires-Dist: mmh3 (>=3.0.0)
 Requires-Dist: httpx (>=0.23.0)
 Requires-Dist: types-pkg-resources (>=0.1.3)
 Requires-Dist: grpc-stubs (>=1.24.7)
 Requires-Dist: aiodns (>=3.0.0)
 Requires-Dist: types-orjson
 Requires-Dist: nucliadb-telemetry (>=1.9.2)
-Requires-Dist: nucliadb-utils[cache,fastapi,storages] (==2.8.5-post257)
-Requires-Dist: nucliadb-protos (==2.8.5-post257)
-Requires-Dist: nucliadb-models (==2.8.5-post257)
+Requires-Dist: nucliadb-utils[cache,fastapi,storages] (==2.9.0-post258)
+Requires-Dist: nucliadb-protos (==2.9.0-post258)
+Requires-Dist: nucliadb-models (==2.9.0-post258)
 Requires-Dist: nucliadb-contributor-assets (~=1.0.0)
 Requires-Dist: tikv-client (>=0.0.3)
 Requires-Dist: multidict (>=6.0.4)
 Requires-Dist: deprecated (>=1.2.12)
 Requires-Dist: asgiref (>=3.3.2)
 Requires-Dist: jmespath (>=1.0.0)
 Requires-Dist: idna (>=3.3)
```

## Comparing `nucliadb-2.8.5.post257.dist-info/entry_points.txt` & `nucliadb-2.9.0.post258.dist-info/entry_points.txt`

 * *Files 8% similar despite different names*

```diff
@@ -4,13 +4,14 @@
 nucliadb-extract-openapi-reader = nucliadb.reader.openapi:command_extract_openapi
 nucliadb-extract-openapi-search = nucliadb.search.openapi:command_extract_openapi
 nucliadb-extract-openapi-writer = nucliadb.writer.openapi:command_extract_openapi
 nucliadb-ingest = nucliadb.ingest.app:run_consumer
 nucliadb-ingest-orm-grpc = nucliadb.ingest.app:run_orm_grpc
 nucliadb-ingest-processed-consumer = nucliadb.ingest.app:run_processed_consumer
 nucliadb-ingest-purge = nucliadb.ingest.purge:run
+nucliadb-ingest-subscriber-workers = nucliadb.ingest.app:run_subscriber_workers
 nucliadb-purge = nucliadb.purge:purge
 nucliadb-reader = nucliadb.reader.run:run
 nucliadb-search = nucliadb.search.run:run
 nucliadb-train = nucliadb.train.run:run
 nucliadb-writer = nucliadb.writer.run:run
```

## Comparing `nucliadb-2.8.5.post257.dist-info/RECORD` & `nucliadb-2.9.0.post258.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -5,28 +5,31 @@
 nucliadb/py.typed,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 nucliadb/run.py,sha256=YyLvcZNw6xNocnrakZfyYhQzj5CdtnkPiR2oCCMU314,2522
 nucliadb/settings.py,sha256=YDtkhIXsc3GzpADSOEo2WZdcpowjCGhYnnAPU-sanMI,1913
 nucliadb/http_clients/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/http_clients/exceptions.py,sha256=47Y8OjkaGV_F18G07FpJhOzgWKUIexhlILyuVtICz8s,1100
 nucliadb/http_clients/processing.py,sha256=0fmP_arO5zxixF_C2ryLYDR7zZDUwPh0aTuRfMyAoI8,4144
 nucliadb/ingest/__init__.py,sha256=fsw3C38VP50km3R-nHL775LNGPpJ4JxqXJ2Ib1f5SqE,1011
-nucliadb/ingest/app.py,sha256=aMpD73HR4b3rJDXXrdcxYuH8EgZjVVbwYsGRnaeG6vQ,6021
+nucliadb/ingest/app.py,sha256=kkxZwVQT-Dqwx85YgGfIOrXgJlSBxFV9tU1rf-5jF4I,6599
 nucliadb/ingest/cache.py,sha256=XPmNNa6KP7P5Mp0Iivl3vIFFMz9rOs9POpHkzj9wpwU,995
 nucliadb/ingest/chitchat.py,sha256=cAOvLPjqKF3bFHW4B7FsjEu_nhO7tUsE227kfa_vDn8,6563
 nucliadb/ingest/partitions.py,sha256=a3fXq3DwRiDjcQNBcUtDTra8prIf-r5_z0B69ll_pag,2425
-nucliadb/ingest/processing.py,sha256=v3QWgPLE6oGxCVq6cepmS_w5wPH_x1o0QwuVQNKlvfg,15823
+nucliadb/ingest/processing.py,sha256=AZpyk6-PPtY0tatHRdapmvISUYsqkqmohw1PUXcJo50,15817
 nucliadb/ingest/purge.py,sha256=n-CqZj3QlZ5VaJWPRWpnnIq2f3cIY6zEsFn9WKh1fYU,5308
-nucliadb/ingest/serialize.py,sha256=Pji7bacI8YraJe1l5njS7UZ8urSyzHgxd597Z9lWlRE,18976
+nucliadb/ingest/serialize.py,sha256=Mzvg3Pmf65E1EwYrUSuiDrP--8sv6w-GGySlz7Re7tc,18891
 nucliadb/ingest/settings.py,sha256=ognLFuxAxk4ZFda3kefLJqE6wd4H25GGdjtkk01gZsM,3025
 nucliadb/ingest/txn_utils.py,sha256=qM5-531Yjjp_MRGlXNmTDkJVx2vmiFKMK6bho-rPSD8,2531
 nucliadb/ingest/utils.py,sha256=5rlBe_eQPdYiXdmIiKPZ7pvmnG-B9vcJXhGe3uOwMjc,4917
 nucliadb/ingest/consumer/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
-nucliadb/ingest/consumer/consumer.py,sha256=nhJSc0IaA-gf7laZyccYqVkbfBVUVhVI-p-CPz40e1A,10672
-nucliadb/ingest/consumer/pull.py,sha256=hgwNvGV0Llp5GZr7cpEWI0IdWis5U6QzQMWoSLLAt9k,7071
-nucliadb/ingest/consumer/service.py,sha256=mqInavoM_NqE9cd91SEKkUKhXfkEOB-z3ja41hT9KmY,5045
+nucliadb/ingest/consumer/auditing.py,sha256=KCt_BbXuUKE9suBxxSaXlxnERnn4Lm-Rat4dmP3hYkM,11281
+nucliadb/ingest/consumer/consumer.py,sha256=J5u8TnbJjYDmkBNaYZBJ0dmA5wR7sLO8Tc3Qck1tV5I,10516
+nucliadb/ingest/consumer/pull.py,sha256=RZaX2BUszEpg6aIIdcEoGuwXtgzKTM7TQz_IDVHRsw0,6886
+nucliadb/ingest/consumer/service.py,sha256=2V9KnM_fi-VcpqzlACFm4qY3ulcB_2bFkMktoJXubHU,6069
+nucliadb/ingest/consumer/shard_creator.py,sha256=83o2V7xQESuAUkYyocGTRyWDO7p61nW-cTXx2PeAAaY,3781
+nucliadb/ingest/consumer/utils.py,sha256=6zWurmmhOmu80uk-fjUhJB1rrulxArlhaUWFLIY-2Jg,2656
 nucliadb/ingest/fields/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/ingest/fields/base.py,sha256=B_YDbCMyULfQVqZAK5LAwPea1V5hpV8VTW_sw9Vca28,19273
 nucliadb/ingest/fields/conversation.py,sha256=QR1fesrRezXy-vRg9d20uedHB-9rxVkbJVriSKa2O6w,6495
 nucliadb/ingest/fields/date.py,sha256=jXMWfdCv87oVySDQORXhMZ1Zvpw_aOpcrYAfUSnL3uA,1223
 nucliadb/ingest/fields/exceptions.py,sha256=J0nqFK89OhckJ0GMPrT2vVAdIHpYwDK3UoYQXOHuA_M,1205
 nucliadb/ingest/fields/file.py,sha256=RtLlnDuT3bueO7V0gnm_i_P1lUCG9l6CZFky0fFCCgg,5159
 nucliadb/ingest/fields/generic.py,sha256=3bW323aCVapc_iFL4epcuYtY6L4tOsEQM5phCFYLnqU,1523
@@ -37,65 +40,70 @@
 nucliadb/ingest/maindb/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/ingest/maindb/driver.py,sha256=3XV-JAXj6Xv3HA4eWB1RS1KzmdmZ8kp8sCCRMNpHyS4,2631
 nucliadb/ingest/maindb/keys.py,sha256=dxDqDWai3fLG15GhLwqkOisMqk_dt6ZYKYEGvjnYeRU,980
 nucliadb/ingest/maindb/local.py,sha256=VuWDCb1SqDcHMZhC6FHOvoyJJ4xw4UbKxuMWTgQmOzc,7076
 nucliadb/ingest/maindb/pg.py,sha256=eFEqoZ0H8-JJHIECQP-62JrsRqsu5U8azl5BEhjr9c0,5400
 nucliadb/ingest/maindb/redis.py,sha256=Ivl1W1dNaPprUMDMHMH0WLSG1p_h5hV6bX6fyp9kQNs,6146
 nucliadb/ingest/maindb/tikv.py,sha256=nLog3QQE5icm5IwLRpLyPpbCTw5N4DO8Ir9SlyghcE8,6313
-nucliadb/ingest/orm/__init__.py,sha256=pBhYYVbyix55e0fuGPUEgJB4tVZOO3j4ZekDfajemYk,3495
-nucliadb/ingest/orm/abc.py,sha256=OBikXZ6IQMyCvKruSQepzuFo3s2f5bHwjeoyaOjOZHg,6801
+nucliadb/ingest/orm/__init__.py,sha256=FFljp-uSoL930KxtLjY6wIj6OeodAjC91Bt28eWXcPA,3483
+nucliadb/ingest/orm/abc.py,sha256=RHFhTaV6sSwYnZiz_O7FMEcRIlQVi5FQGaiUsEoC1FU,6783
 nucliadb/ingest/orm/brain.py,sha256=oCNOGsHj4muPlIj-1mp6kAj1fdE-z3MGQ_bbiSGlZic,20650
-nucliadb/ingest/orm/entities.py,sha256=tyDVXUC0O0qTkvpp1IVhaTj8w2zeEypgLdMsVgihm8k,15408
+nucliadb/ingest/orm/entities.py,sha256=gRK1930Sj_vUPoKlHzFomeFxUFkFVxQNhwwCGFkpwFM,15267
 nucliadb/ingest/orm/exceptions.py,sha256=EeEfwcbr9TkDI9eAaE0I2OzV9DAqIgl-WmuWUxNJVVM,1448
 nucliadb/ingest/orm/grpc_node_binding.py,sha256=AKIh9t7ma12sF4CfBn4PukZ0XtBQQcCQddNcGcV9_Zc,12586
 nucliadb/ingest/orm/grpc_node_dummy.py,sha256=26yAiDanI7woiIJSjvrDlLyCarlMwykJ-m9R8KZ8F-E,4606
-nucliadb/ingest/orm/knowledgebox.py,sha256=TFrlWOEfvTKdlYLbeqBLY9dD4KDMTet9UQ6euPK60oc,21247
+nucliadb/ingest/orm/knowledgebox.py,sha256=yuKMTmqw5vpMkEuxVkuFx31WMrGNGLX6RCLVuvMLtvE,21132
 nucliadb/ingest/orm/labels.py,sha256=2caUR5M5L3_tw2Sp9XyevO-yXdNpGUUxrR0vpQnTsmo,1730
-nucliadb/ingest/orm/local_node.py,sha256=-YukxuAPEr8AsXJsGfqNl9E25wuHs4ljrwG1TXrizLU,4291
-nucliadb/ingest/orm/local_shard.py,sha256=tUHe9Ml11azFZwBfrjINuglom4wMADF2uWS1tnaOOLg,2890
-nucliadb/ingest/orm/node.py,sha256=E3tofkSKvbs4zPY2OXDnz97hlB1QpLYSiygjtItNJr4,11388
-nucliadb/ingest/orm/nodes_manager.py,sha256=XE521hT_gm1MrJvribLFsk_Zj_9vQFcs6Xl7bHntn3c,4312
+nucliadb/ingest/orm/local_node.py,sha256=QXcH8fKtXupMjkVQ5DmpMUgOKcOl92lT5JBBHatmeQA,5160
+nucliadb/ingest/orm/local_shard.py,sha256=rGXoazoL2xzeHKnRLhtkVmE0F1eHijJj8hR8oDpoOTo,2614
+nucliadb/ingest/orm/node.py,sha256=SdGo5bCfi_aIpiOjFl7itdDQHlJB4U3f_eIA6BkGhZU,11289
+nucliadb/ingest/orm/nodes_manager.py,sha256=MxKYPkuve1DTfKVyI0_RjaV9QlNu2S1FVfr6x-nV_Ts,4278
 nucliadb/ingest/orm/resource.py,sha256=0zT2mtvv9g2k7U3ZKCS20GdERHutrd-hknUOB5TDuW0,51458
-nucliadb/ingest/orm/shard.py,sha256=pa_k2AI5P2noFwIhSjZCIqJC_Fq4wMtFztQIQ9ivXho,5115
+nucliadb/ingest/orm/shard.py,sha256=nVFmxl2iZjtJLz5uAPs90bISrJ8Im8pJhFRUXSlHdm0,4227
 nucliadb/ingest/orm/synonyms.py,sha256=BuqS8XxLLVP124zPLGISgrmQg94LdalaTHeOVp_6dIY,1739
 nucliadb/ingest/orm/utils.py,sha256=9vTugcLweai69WWinatWm1RTyukJEDDte3qXNLqS7pI,3340
-nucliadb/ingest/orm/processor/__init__.py,sha256=Ia23BhrKklpMANhKQTC3kcWetUp-BtSgP25rlj2ueQI,29054
+nucliadb/ingest/orm/processor/__init__.py,sha256=6xvUiwJru5yBYCyMHZGH8pIGCtce0jwDEuD_GXPUSb4,20958
 nucliadb/ingest/orm/processor/sequence_manager.py,sha256=PGouu9Xp_zdhfCTtRLCEW3uJ2XvHNIckNXvUdgxc0OM,1694
 nucliadb/ingest/service/__init__.py,sha256=2naoXev5p8R6jNlSKTgWfMk3z8sNjRGgkoLfZy5XI8U,3113
 nucliadb/ingest/service/exceptions.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
-nucliadb/ingest/service/writer.py,sha256=pZty0Cq5XY3iwV5ojvjD6RCU_F4uO2lk-LyeuGX2pl8,34487
+nucliadb/ingest/service/writer.py,sha256=svlPLggbY4NGO_PJCUrPhGC9K6d3yPxHqaJ1mZZxj80,34177
 nucliadb/ingest/tests/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/ingest/tests/conftest.py,sha256=vu6f6UsfajjAZwBcbecc7xvRZpr7Yqj7qxalHYtgRtE,1096
-nucliadb/ingest/tests/fixtures.py,sha256=UbPfayNe37x64u_PMcsjg6aV8RuyvCLVsUvq2AIsQrc,25857
+nucliadb/ingest/tests/fixtures.py,sha256=TlSg4mXUjjtVRmAPoPA3xVmv2iWaVPYS5zK_Yi7T0a8,25872
 nucliadb/ingest/tests/tikv.py,sha256=MGwBL9ezcOOR8JwttouQ8Qj6534d742i2A3TAumdrM4,7549
 nucliadb/ingest/tests/vectors.py,sha256=CcNKx-E8LPpyvRyljbmb-Tn_wST9Juw2CBoogWrKiTk,62843
 nucliadb/ingest/tests/integration/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/ingest/tests/integration/test_chitchat.py,sha256=_sCN6d5Val9CZGT9tXCWXYHMs79n77qUbav7qqJavi8,1740
 nucliadb/ingest/tests/integration/consumer/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
-nucliadb/ingest/tests/integration/consumer/test_pull.py,sha256=LgVpsjjDZXN03Twjv6zze-IfUxUCQ6k5f33cR6eM1-U,5189
+nucliadb/ingest/tests/integration/consumer/test_auditing.py,sha256=5VYFGUeaxd18mLtUfHCUPu9c1iAShNHNM5X_CSkIFSs,2549
+nucliadb/ingest/tests/integration/consumer/test_pull.py,sha256=TL35JQMXh14ohJMGyFRnPt9FYpTjW1aAZGY7wLqtTMw,5169
 nucliadb/ingest/tests/integration/consumer/test_service.py,sha256=Pol7e7qLCnujLzxvuwfZBGgjCH8mkUbgezgdfYlYoBA,2751
+nucliadb/ingest/tests/integration/consumer/test_shard_creator.py,sha256=AUwoMB_BHzEWZXVW0oH8QCsZLAO-Sf7VOfm-gJafU9A,2013
 nucliadb/ingest/tests/integration/ingest/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
-nucliadb/ingest/tests/integration/ingest/test_ingest.py,sha256=dTzOf9ZnnLgywLl4PKOlD3dKFyb_5EeKchvaPZt_bkA,27277
+nucliadb/ingest/tests/integration/ingest/test_ingest.py,sha256=iB2RdkXVlADex8gvJjyZs7x73eAF_-y4MquznZ3VLMM,25612
 nucliadb/ingest/tests/integration/ingest/test_processing_engine.py,sha256=EPXe105v5vHPHUuqHXnj74_AsSm_mAn52n1MjvR9P8w,2339
 nucliadb/ingest/tests/integration/ingest/test_relations.py,sha256=rIB4-LoWxrez66bIXGrIUwt-Lc4dzeJyIlgwkf1Jyn8,8606
 nucliadb/ingest/tests/unit/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/ingest/tests/unit/test_cache.py,sha256=zIUckaBdMFJ_gOoSCXmBFG0qJzenh0gQGs6DKAbqxCA,1179
 nucliadb/ingest/tests/unit/test_chitchat.py,sha256=y8uQbzU_55KgXuYazl07buzA-JHtunmzDMu5hbtGDbs,4246
 nucliadb/ingest/tests/unit/test_partitions.py,sha256=hN8ch_aHVas58-6q6B-__D-abNHJ4I--3vDpDVz4TS8,1432
 nucliadb/ingest/tests/unit/test_processing.py,sha256=h_gCWP8YBaMv8uxOGVlKFTMUQkhnXnbB0G2VQMniKGo,5538
 nucliadb/ingest/tests/unit/test_purge.py,sha256=Fsiq2Xb2QHarMV8Y09QDHEZ7tBMEXPvXYvUQ8U5dDG8,3414
 nucliadb/ingest/tests/unit/test_settings.py,sha256=DdCeFACJd6oMq1QP2Vfsdz604gLAielkXSSh6YruCrU,978
 nucliadb/ingest/tests/unit/test_txn_utils.py,sha256=NnpZkPe2sPacwB4mE-A-ijR4ZOBuxZON5Gton3HsM9s,1403
 nucliadb/ingest/tests/unit/test_utils.py,sha256=03u1kU3mKzKgkWZg1Jr8HPJsIOypWpQDGeQi8BBQs18,2895
 nucliadb/ingest/tests/unit/consumer/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
+nucliadb/ingest/tests/unit/consumer/test_auditing.py,sha256=243lrmOw6Duq5SbkYtf5oSYzcNHqNXIBIYXstiMTW_E,2979
 nucliadb/ingest/tests/unit/consumer/test_pull.py,sha256=96szQP4mAFaMyABtP7IhQclevTwMAkQgCN9DwvpBXzw,2041
+nucliadb/ingest/tests/unit/consumer/test_shard_creator.py,sha256=s9v62rFaUQ9_feeQHOVhnvh3lMrhFbH5Gqe-ZeQc5hQ,3868
+nucliadb/ingest/tests/unit/consumer/test_utils.py,sha256=sanGAv21LfsnmqqjbprnAY22n-MSvm-n34bzj0Hj4h0,1934
 nucliadb/ingest/tests/unit/orm/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/ingest/tests/unit/orm/test_brain.py,sha256=aL-lDK-xp5ZL6LD7tCAAy2QyA9yn66PwK4dFv_3Csss,8991
-nucliadb/ingest/tests/unit/orm/test_cluster.py,sha256=SimYa7eb8QJLTisqEOXVVX-ZvtBPQw9I3yI__zpvhQM,2706
-nucliadb/ingest/tests/unit/orm/test_node.py,sha256=FxSx1tKScjqZtreHqrbFwWsyOTbRPy94s8p0AbfC5C8,4212
+nucliadb/ingest/tests/unit/orm/test_cluster.py,sha256=KfyxSeYYdaOwc8v2iRwEvE0BuMs4yj9pgxJH9cTCFdg,2736
+nucliadb/ingest/tests/unit/orm/test_node.py,sha256=IVApkEmc45ISlTBWrHTwJNw00lz_q0I4MCEpJH4bdbg,4020
 nucliadb/ingest/tests/unit/orm/test_processor.py,sha256=UMmpAxmvmVm9V8nyWWTz7dKRf2vcdAhhQgBJvxHCaO8,3141
 nucliadb/ingest/tests/unit/orm/test_resource.py,sha256=bzBLZ0s4xwz4RxC6iKFunduH_oPGyVJCJuc87cVLpYU,3772
 nucliadb/ingest/tests/unit/orm/test_shard.py,sha256=Aek2qfvE2XPT9a2zz4Tg9IdlfjSlmxwPgRQ33qwn1W8,1401
 nucliadb/models/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/models/responses.py,sha256=qnuOoc7TrVSUnpikfTwHLKez47_DE4mSFzpxrwtqijA,1599
 nucliadb/one/__init__.py,sha256=M4YAQYYehaKJpZUa__l6DGhK2VGRejMAn33tXZuVwA0,914
 nucliadb/one/app.py,sha256=aB5T8ZPo1_6oYT8g51Wn0ncbJ6yy6cir7QXtAeSRqfA,4549
@@ -114,27 +122,27 @@
 nucliadb/reader/openapi.py,sha256=lb-QDOMxESUUjvtMEa6yHqqEng4zo21o9EM2uCVhl0g,2186
 nucliadb/reader/run.py,sha256=CullcE5ObNtyolRYrNFcXwEfZmfPyQc3ehZyS9eySio,1365
 nucliadb/reader/api/__init__.py,sha256=c-UD29C0FVzQDGEvslebDCKtvnyEcAbiDd-3Q_QgGN4,872
 nucliadb/reader/api/models.py,sha256=gB9QIhKhVFIaGOj-F9XVVr_TDGtg3oiU3WBGVVAsecA,2433
 nucliadb/reader/api/v1/__init__.py,sha256=3NX3_gljl2HAMiTHMgHWwc-qIR9bYKr0ggl37mGUQjc,995
 nucliadb/reader/api/v1/download.py,sha256=VfNUgpGZqW53Re3T6k5oy5jJjLW0SlBqruGLvrsjx8I,9790
 nucliadb/reader/api/v1/knowledgebox.py,sha256=nDN0jxI85cisQx_7R6JJwrHamc9_2Lyzfck0ZPYVzy4,3570
-nucliadb/reader/api/v1/resource.py,sha256=TPflmcFbItoW3lNQwYMmISRLf28PHrArz2z0UX1dVn0,10721
+nucliadb/reader/api/v1/resource.py,sha256=iQ8T7tjukyZIJk3msvg5qqNPnFoHvLT6W6lxZITiM_0,10673
 nucliadb/reader/api/v1/router.py,sha256=eyNmEGSP9zHkCIG5XlAXl6sukq950B7gFT3X2peMtIE,1011
 nucliadb/reader/api/v1/services.py,sha256=A6dcl6XfQf1fQdnZmObbk42KflWWmV0ngKoV1k6V1u8,10766
 nucliadb/reader/tests/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/reader/tests/conftest.py,sha256=j1YLBho3wV890KL-aH-WJ5MCh-fei6P2t7kYMPto5yo,1101
 nucliadb/reader/tests/fixtures.py,sha256=BX2TilVXSkZJyXX4HDpzIoR9SVpr-dtsPRBT-DjZGx4,4635
 nucliadb/reader/tests/test_list_resources.py,sha256=zHJLCn3Pi8unt-NGBTftND-2ByVpLd2nDgpfG_qp1JU,2749
 nucliadb/reader/tests/test_reader_file_download.py,sha256=TS1yD-xfVJuVbPesoErNRpTOvOkWCzuAl83pq_U3ZU8,9946
 nucliadb/reader/tests/test_reader_resource.py,sha256=WY5R8Zozi3R6lpkAwFyDxL3uGxMzGRl-iWVrEvHz4u0,11383
 nucliadb/reader/tests/test_reader_resource_field.py,sha256=YQ-U2mEGhs_rPGxcWPZmWLSEoCxBo3AVDtLZCtZrGb8,6535
 nucliadb/search/__init__.py,sha256=fwzdF6p7p9uDCtE38gTUxrRVIdbEDVQTAXWUMVKgSBM,1535
 nucliadb/search/app.py,sha256=w50PMZDmE95T8Th-Ggz_DSnJ2AqNxKfWeQG0c1L5v9A,4381
-nucliadb/search/lifecycle.py,sha256=8Axv7kz6Xa5if7sbYIRhHKwCd0c-_pFgf4qN5kbS-4c,2310
+nucliadb/search/lifecycle.py,sha256=O4J_MafpWAE-AoiEVDWIrBqftZQuuW2a9kBYuQuYPVI,2252
 nucliadb/search/openapi.py,sha256=VI3-DrfuX38IwRTC62QMs5mYe5v7v5KQ1BsiNT2sPH8,2206
 nucliadb/search/predict.py,sha256=dOJyYfY_8S9-q_tIOH-xtKJCyztMirLsRHtWc6rsYxE,11236
 nucliadb/search/run.py,sha256=1Ege7LyiOcX8vdqj1GQA_azVq3ivp4aTXJen2_ZjvJw,1366
 nucliadb/search/settings.py,sha256=AQUXreB6YjT48x-g09-om1TpA5dX9OLWhzTy6026LZ4,1108
 nucliadb/search/utilities.py,sha256=tlh048ZoFv-pUSjePiE-f_9J4nEqsJstQmhwS6Ke7Yw,1238
 nucliadb/search/api/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/search/api/v1/__init__.py,sha256=yljyGyrWNKsGuVewTnxB6CmDKGgdsu7dfkS67mZcUUA,1077
@@ -145,15 +153,15 @@
 nucliadb/search/api/v1/resource.py,sha256=i2LEtLeMyJyvS8HayIM0P8T2On0cQmLUAHqlYA8_pqs,4781
 nucliadb/search/api/v1/router.py,sha256=QCO76-kVgkIlX9sG9ygoruo_0amRYdqfqR53aQsWpCA,980
 nucliadb/search/api/v1/search.py,sha256=r0idrJrGfdFyqlwuxmj66chAJ2TyzsuLFEmiBIpdSEs,11487
 nucliadb/search/api/v1/suggest.py,sha256=fp0ef1BMhkjX8kyTmR3aEmKrXHg2Q6J6FdcTVoGSO2I,4212
 nucliadb/search/requesters/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
 nucliadb/search/requesters/utils.py,sha256=Y58tIkZaj7ncoyvFfFfJEyxmEUOO1fKSv8l-SUjALAU,6752
 nucliadb/search/search/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
-nucliadb/search/search/cache.py,sha256=UbphtFPAkWX4Ml6kE63KbtDBoRgK-QCaklw841biTmg,2408
+nucliadb/search/search/cache.py,sha256=gECk6MJhSy4S29RApqxFJDWbuMc4taj9qR-vBz1EbBU,2352
 nucliadb/search/search/fetch.py,sha256=UEDIkM9l_A87QPG_RCSPNd69cPo3noo40T8JFPP5VJA,5337
 nucliadb/search/search/find_merge.py,sha256=32UXIISW100EkVyM5zwg7a3tRJ7h-TfgHxEe-XTdJuE,13815
 nucliadb/search/search/merge.py,sha256=FaoZwrnzxsmGCHd9xQGXiwpgVY5PGa72WGqhXUVPov0,18899
 nucliadb/search/search/metrics.py,sha256=CerbY5THtN6JbyTIRFBLAYGObdbHNO_WPv4YJBwnf5s,947
 nucliadb/search/search/paragraphs.py,sha256=85MbCJ9qp_GRZZQQD-tBmlAKh9V8tvl2htlgz-ORCGQ,10051
 nucliadb/search/search/query.py,sha256=RHHoBnT4Zp7A0mCFUkmel8lMfdTOcQyV6Vtg7O5xxVs,9905
 nucliadb/search/search/shards.py,sha256=sgyhpE8mCqlXaUB9PNb7Zt_MFKgvEso9CNWJXQKzFcE,2647
@@ -193,15 +201,15 @@
 nucliadb/tests/test_find.py,sha256=GIfxUfPvzKnWlsLlCVUBUEectc0MZm8v0mzjp0bIdE0,3591
 nucliadb/tests/test_http_clients.py,sha256=rx2dqiiDbVRxgXu9RPaWDdEcnAUgH5V5oYouLkQ6D6Y,4196
 nucliadb/tests/test_kb_slugs.py,sha256=Oom9hvODXde6bDWCxGZAi2DlpcyDumVPALTOPjSyrws,1524
 nucliadb/tests/test_labels.py,sha256=QujoLGz09jv8ZmBlyQ_bF_w7EY-TzOc3g04XYI2zuAs,11431
 nucliadb/tests/test_reindex.py,sha256=bYMrIfBegHTlzc_ooNSvPD5apjaN7sv0R0IpHQK404M,6071
 nucliadb/tests/test_relations.py,sha256=5owU8nIyL8jpt-iHRweW6_U8ecmPy6TyzCHEeuR9T50,8516
 nucliadb/tests/test_resources.py,sha256=m83owYEsiVmDRCXuPIvSDgCcmLY1AVz5pp0VS58I5xg,7072
-nucliadb/tests/test_search.py,sha256=S7PI5sB7U0IgVRCX9ukGc9WIA5lrazQWA-7tBHdFNvk,41877
+nucliadb/tests/test_search.py,sha256=B0HFEL3FTheZe2GDrm09t-YpD7YJHaBMOxwMWGISlu0,42333
 nucliadb/tests/test_search_sorting.py,sha256=Rvc0csQthoe-vES68cuiR4Kr87aItuKPJhWHxCUKo8I,9708
 nucliadb/tests/test_suggest.py,sha256=zNJaL0HYO2cFmru6Lb3P_pJyhTmeB8ouklnnFo_PxCU,8918
 nucliadb/tests/test_synonyms.py,sha256=cTE-iDqKjbuW_cEzQSPlpd5K7wOT34n_Xuhle0ka1Hw,6819
 nucliadb/tests/test_tokens.py,sha256=qLZ2pX1CVAVuqhE9q51N1f5KYONaIY-qWuzy2fG5Oy8,2637
 nucliadb/tests/test_upload.py,sha256=_aspvFQmZs6tMGh7Wn9blAaotkN1N7PZiPAywb0UrcY,3159
 nucliadb/tests/test_usermetadata.py,sha256=9RBj2K-MGCpAvPMBmIA9hsk20TSaQqqd7WzdIa0o0-8,2585
 nucliadb/tests/test_vectorset.py,sha256=WrEAnCwN1LBF6_Hou-wpZPIa_xB20UGIxz6KyJzkmZI,8758
@@ -211,38 +219,38 @@
 nucliadb/tests/utils/__init__.py,sha256=9PJi9kuj_ABbacVFXEUlZe0n5BtjaWXZmKEv1LRo3-8,2507
 nucliadb/tests/utils/entities.py,sha256=IPTHEsYY6tryoxZhpz3dpkklw0AQm4_shk0Osj8Bnwk,2533
 nucliadb/train/__init__.py,sha256=qdZ6DeuwED8iIl32NVyDYWTy544FyHCZUQnQGnms604,1325
 nucliadb/train/app.py,sha256=wD__w3qNwoBrARdi3suPD-YbFZFj6zEVrY4fXOBi0qs,3340
 nucliadb/train/generator.py,sha256=bWd-6_nnvgb6xhTVl-mgTbdC3aysPF43Jw882IMW3pc,3832
 nucliadb/train/lifecycle.py,sha256=aqGlusk-r20jUrlTxoaqJq2VXIK18CKAh-slhfs10P0,1638
 nucliadb/train/models.py,sha256=BmgmMjDsu_1Ih5JDAqo6whhume90q0ASJcDP9dkMQm8,1198
-nucliadb/train/nodes.py,sha256=YQ77IdkyCMCovPqxErL8Di9pduSL0kzN6pXvjrToxNM,8054
+nucliadb/train/nodes.py,sha256=dhN6d-1gr7a7QxVO-c8U6qEUXDkD7HnTOnoAnr6ts-w,7906
 nucliadb/train/run.py,sha256=XflKrGcNGjZnCODNQWAe2XvR9cVd8K7TVD5HEkS9EIY,1364
 nucliadb/train/servicer.py,sha256=eCWU3MBbdFzpevAvGmgVsWTU1eJ0jVmslkZeyn9tWzc,5755
 nucliadb/train/settings.py,sha256=eXe87TjqtGTa-bCKRPDIWdyb7qsaUW3VbLXV-zGBQZk,1415
 nucliadb/train/upload.py,sha256=vui0GXaP7Zcn6WVzUMlcSwqNX-Yot7eFynw6pSs3Vgw,3271
-nucliadb/train/uploader.py,sha256=AarOaeSkxUGjlI8X2AXsZp4WAN4DoOExSSH7aB_sfHY,6471
-nucliadb/train/utils.py,sha256=xrqQr5BLHUf5rkNv2hKB7ebP1kkMnmxy296g1gETfH4,3077
+nucliadb/train/uploader.py,sha256=0pvIhyqFHoBsBYdTlIPLZ4CWOUDUkew3QjDUaR7GkJQ,6419
+nucliadb/train/utils.py,sha256=QjC-FZrz1e68-ARVScf526krqd7qr6_7I_VOZMWUeO4,3005
 nucliadb/train/api/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/train/api/models.py,sha256=YFKrXktdiE6yAa4TSHSYXzUZjADjssi4VHVn0Vf0m_0,958
 nucliadb/train/api/utils.py,sha256=zYbDiKJSsPP8tC7O2T8bfKkb_RTCxrq9JIcnLOSZixQ,1479
 nucliadb/train/api/v1/__init__.py,sha256=P4vCIv93r_Cq1WFDDNjy_Wg7zBkzx0S4euXwfPy1LA4,928
 nucliadb/train/api/v1/check.py,sha256=r1r4r8KiF7CZs-cEiWZQ-ZlvV4hRmqySjMRjmW82wk0,2066
 nucliadb/train/api/v1/router.py,sha256=ukdxn5q1oMar6NSPobgJczWsSxLCHw6DYKlb3zwCiSo,910
 nucliadb/train/api/v1/shards.py,sha256=EDV7fJkF-Elzpt0MSm-KxagzpAYks64Fr9NGW1vFdpM,1905
 nucliadb/train/api/v1/trainset.py,sha256=3EFwzn0zEF_IGhPT9DEXYZrCi3XB4HQLw2wnmUXGYeY,1825
 nucliadb/train/generators/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/train/generators/field_classifier.py,sha256=4hiJ_bvH3HY6dn8jZgc6YCDdeqHFd8YWuSB7jfuuyNc,3289
 nucliadb/train/generators/paragraph_classifier.py,sha256=oZ5GtMfk_sRhy9ClCGc2vGuIfHzBza7279sQeRy60as,3594
 nucliadb/train/generators/sentence_classifier.py,sha256=uZJzTK9v0LntPmSGPeIwp38xsMX9wioa5AxXXef4w9s,4767
 nucliadb/train/generators/token_classifier.py,sha256=i2PQJhrp8uqA8ey666O7WGiLx1qAc5VOg7e1I8NmDcs,10256
-nucliadb/train/generators/utils.py,sha256=Q-Vqy07lvYz8EFvbiGOxi3HPpFRhcld9DbWmq9khaQE,2144
+nucliadb/train/generators/utils.py,sha256=wuCMxWRK_oC682yNkAw-sg-Ot6b0iRDf8oiAQ_MFq_4,2092
 nucliadb/train/tests/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/train/tests/conftest.py,sha256=MNH2umE3OKnJLXK3U6kZmpfW0GQcoZtwK6NfilXKXRs,1088
-nucliadb/train/tests/fixtures.py,sha256=hOHa6am5ASPepuJaCvTlilyhyw-GKvdQ6g4983Qy6_w,8951
+nucliadb/train/tests/fixtures.py,sha256=fAz1gkbOdOuvR0xSbEtorwwrKxICS93Iu8FXL0a4tM8,8939
 nucliadb/train/tests/test_field_classification.py,sha256=Sg3V8dlKt9WgVqAQ2OLVz6CkbqNwK_jxAim4Fk1KmLc,8132
 nucliadb/train/tests/test_get_entities.py,sha256=ndcEemTcITB70X_GxSIkUiAoNOnpTamfyPaXVtXmgKQ,2729
 nucliadb/train/tests/test_get_info.py,sha256=uWKFC8uDXsmdzUp0xgNpEEuf5Ge9dNPE5CSfdZSDz_o,1660
 nucliadb/train/tests/test_get_ontology.py,sha256=Xjr-eIYQLzNkqFU3nwANmDi4fwY09VymdikC3ibgM8A,1382
 nucliadb/train/tests/test_get_ontology_count.py,sha256=hyarvQOw5PyeYVJ7Z6v4I1Yagi0PwrEiIs615tsM4Z8,2201
 nucliadb/train/tests/test_list_fields.py,sha256=V6YS2ao09AiheI6GKaC9GVLUG_ypf-WrvId_mRdBJB8,1416
 nucliadb/train/tests/test_list_paragraphs.py,sha256=fvDh-vvgTj-XonTS8t9CDq0eDGgNl8iWw3E9OBmGK7c,2944
@@ -257,17 +265,17 @@
 nucliadb/writer/lifecycle.py,sha256=YxWwD8A-f65KfwG_i4zD_37z1rsmbSyGae7ndJBfRVg,2219
 nucliadb/writer/openapi.py,sha256=bpH-pzxdDRb9Dy0OcaB1U0ziuvIG416akVr-Dwz3ywM,2186
 nucliadb/writer/run.py,sha256=MimcqtaTLDvyOG-oRC5RJSYjld810aMEOrruM2ZLcrg,1366
 nucliadb/writer/settings.py,sha256=rphXdqI238b1bch0elcY3aY4qxQYe_wllnW7MPjmZyU,1062
 nucliadb/writer/utilities.py,sha256=AZ5qEny1Xm0IDsFtH13oJa2usvJZK8f0FdgF1LrnLCw,1036
 nucliadb/writer/api/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/writer/api/v1/__init__.py,sha256=50S5JnDp00NP8YKLlaWZ_ZDmJr7bioFteB400iKcel8,1021
-nucliadb/writer/api/v1/field.py,sha256=qGywhrPmr7jCb7RgXsJGPS_jw9Fdlp9FJe51Fa-7SUg,22313
+nucliadb/writer/api/v1/field.py,sha256=IhQzgqMEUptjj4J_5PnX6aJm5nKyBGHGvaMCvOrUzAs,22261
 nucliadb/writer/api/v1/knowledgebox.py,sha256=OcO8Al5TWObVfe1EXzg4DQ6EN0iK-6ZJ46JZa4J3D9M,5395
-nucliadb/writer/api/v1/resource.py,sha256=DnswYP58jfKiLhhc3lmH4NXnZXCUrqCMpZFJrkiPk5k,15253
+nucliadb/writer/api/v1/resource.py,sha256=WcLA_aXPXd1eOkIiRHO20Jnc-l6ou1C9byLYnYvDBC8,15201
 nucliadb/writer/api/v1/router.py,sha256=RjuoWLpZer6Kl2BW_wznpNo6XL3BOpdTGqXZCn3QrrQ,1034
 nucliadb/writer/api/v1/services.py,sha256=N6RpYBq4CfELJ-5vIY-Qh_YXNqvFoTdmkuHGIAXwR3I,14210
 nucliadb/writer/api/v1/upload.py,sha256=mAXP6b3M0ecEsjScA7PnwRrWdhc8JPZtS8iXRbpNTD8,25744
 nucliadb/writer/layouts/__init__.py,sha256=5VKT5WJya1EoI5aKq9MwzkN37QWAoihVRJeXDmiPGYs,1618
 nucliadb/writer/layouts/v1.py,sha256=Yc2idmfrpCS8js_XJByNWA_tmt2WeKoWvidLHoTPXoo,2115
 nucliadb/writer/resource/__init__.py,sha256=cp15ZcFnHvpcu_5-aK2A4uUyvuZVV_MJn4bIXMa20ks,835
 nucliadb/writer/resource/audit.py,sha256=SXPu_hdNBlm9uCSl666UQL7hzMx9zYVbBLT_U7ro8Gs,1425
@@ -292,13 +300,13 @@
 nucliadb/writer/tus/dm.py,sha256=ULuP07lQOa4XDqLWwnfgNe8ReFsrxl3t4G9BWUY4uiY,4757
 nucliadb/writer/tus/exceptions.py,sha256=CmxYKnHXpXug25DYV4SpVAU47SGD-NVBd7pNTRbWHyk,2186
 nucliadb/writer/tus/gcs.py,sha256=DdnCTwtd3N87yaPUl-n3LJfUDdHVGav-w1LBOUnUNWg,13818
 nucliadb/writer/tus/local.py,sha256=BM2_uZwh3qd4CsGaIzNL4EBzv9lNjgtSP0cnLPdMJek,5811
 nucliadb/writer/tus/s3.py,sha256=5gpiYTGAJsLN2j55FBSq-E9kLbMn5tvNDZeNRzo3yj0,8571
 nucliadb/writer/tus/storage.py,sha256=Ba085-LkOjbHsYKh6u3NA40b1PSPzS20YHJqIa6kvG0,4682
 nucliadb/writer/tus/utils.py,sha256=40VRRKjKJgt-pYbWH9eX-jnQFze1_NkqI8ehe-wSZ8U,2580
-nucliadb-2.8.5.post257.dist-info/METADATA,sha256=DOaLYX6om1-wEMV7DIWhHtsGsTbfJYjWnHb0CL6PshY,2913
-nucliadb-2.8.5.post257.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-nucliadb-2.8.5.post257.dist-info/entry_points.txt,sha256=iMxmJxMdQ0sMN9yj0aD3NqHMpFyaikB_nlqjpwVtcnc,790
-nucliadb-2.8.5.post257.dist-info/top_level.txt,sha256=K5XbWCHfZ7wve-wIrOSTuE0y-jVJSKVS9ZTDJ4TKhKQ,9
-nucliadb-2.8.5.post257.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-nucliadb-2.8.5.post257.dist-info/RECORD,,
+nucliadb-2.9.0.post258.dist-info/METADATA,sha256=3an0YKdX3avlarM4c1OMrY_-qLrcKMBhH2h6kZyjSM4,2913
+nucliadb-2.9.0.post258.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+nucliadb-2.9.0.post258.dist-info/entry_points.txt,sha256=fQBjdTD_jVuIe0hksOon_DoqEH5PnAV_5rrH1IrdskI,870
+nucliadb-2.9.0.post258.dist-info/top_level.txt,sha256=K5XbWCHfZ7wve-wIrOSTuE0y-jVJSKVS9ZTDJ4TKhKQ,9
+nucliadb-2.9.0.post258.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+nucliadb-2.9.0.post258.dist-info/RECORD,,
```

